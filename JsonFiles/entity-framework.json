{"count":18895,"tag":"entity-framework","questions":[{"tags":["c#","asp.net-mvc","entity-framework","jqgrid"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13274096,"title":"Good programming principles while using EF/Code First/Repository Pattern/Table Per Type (TPT)?","body":"<p>Just curious.</p>\n\n<p>Say I have a Base entity and I'm deriving about 10 different child entities from it using the Table Per Type method. I also have a generic repository which can fetch me data from each of these child entities. I eventually want to map each of the child entities to a separate view model and link each of the view models to its own grid (JqGrid) on my website, with each grid having its own Create, Read, Update, Delete methods. I can do all of that, but I'm not sure what's the proper way to go about it while keeping code to a minimum.</p>\n\n<p>Right now, I have every field defined (from both the parent and child entity) in each of my view models. Is it better to have a \"parent\" view model and then deriving the child view models from it in order to mimic the inheritance structure of the entities? I wouldn't think so....having inheritance in view models doesn't make much sense to me.</p>\n\n<p>Also, I really don't want to duplicate CRUD operations for each grid. Is that considered good practice? Should each view model have its own set of CRUD operations in this case?</p>\n\n<p>Take 'Read' for instance. I'm basically returning JSON data based on the ID (key) field of the view model for each grid. And since all grids will have this ID column (part of the parent entity), should I only have one function that takes care of this for all grids? Should I be using reflections? Should I be making use of polymorphic properties of the parent/child entities?</p>\n\n<p>Or is it better to keep these operations separate for each grid?</p>\n\n<p>Hmmm..</p>\n"},{"tags":["c#",".net","entity-framework","oop","generics"],"answer_count":0,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":13279018,"title":"How to avoid the need to reference Entity Framework on my service layer?","body":"<p>While trying to create a data access layer for a new project, I ran into what I can only imagine as an OOP/Design/Generics problem (using EF 4.3 to access the database).</p>\n\n<p>Mainly I wanted to achieve two things with this data layer:</p>\n\n<ul>\n<li>Different Context objects I have on my project should share the same connection string.</li>\n<li>Abstract repository class with common implementation.</li>\n</ul>\n\n<p>For some reason, I cannot compile my solution without referencing EntityFramework on the service layer. What I'm looking for is a way to fix this. Here's what I have:</p>\n\n<pre><code>//Project/Namespace BusinessLogicLayer.DomainClasses\n//POCO classes mapped on Entity Framework.\n\n//Project/Namespace DataAccessLayer.Base\n//Base classes and interfaces for all data access layer, such as:\n\npublic abstract class BaseContext&lt;TContext&gt; : DbContext where TContext : DbContext\n{\n  //To allow multiple contexts sharing the same connection string\n  protected BaseContext(): base(\"name=MyConnectionString\") {}\n}\n\n//Generic interface for a read-only repository\npublic interface IReadOnlyRepository&lt;T&gt; : IDisposable where T : class\n\n//Generic interface for a read/write repository\npublic interface IRepository&lt;T&gt; : IReadOnlyRepository&lt;T&gt; where T : class\n\n//Basic implementation for a read-only repository\npublic abstract class BaseReadOnlyRepository&lt;C, T&gt; : IReadOnlyRepository&lt;T&gt;\n    where T : class\n    where C : BaseContext&lt;C&gt;, new()\n{\n}\n\n//Basic implementation for a read/write repository\npublic abstract class BaseRepository&lt;C, T&gt; : IRepository&lt;T&gt;\n    where T : class\n    where C : BaseContext&lt;C&gt;, new()\n{\n}\n\n//Project DataAccessLayer.AccountContext/ Namespace DataAccessLayer\n//Context class:\n\npublic class AccountContext : BaseContext&lt;AccountContext&gt; {}\n\n//With this, I can have simple repositories:\n\npublic class UserRepository : BaseRepository&lt;AccountContext, User&gt;\n{ //All implementation comes from the base abstract class, unless I need to change it (override methods)\n}\n</code></pre>\n\n<p>I have a service layer between data access and the application (Windows Forms). Because I have a generic repository, it seemed a good and logic idea to have generic services. In the end, very similar to the repository structure:</p>\n\n<pre><code>//Project/Namespace BusinessLogicLayer.Services\n//Service layer supposed to reference only the repository project and not Entity Framework.\n\n//Generic interface for a read-only service working with a read-only repository\npublic interface IReadOnlyService&lt;T&gt; where T : class {}\n\n//Generic interface for a read/write service working with a read/write repository\npublic interface IService&lt;T&gt; : IReadOnlyService&lt;T&gt; where T : class\n\n//Base implementation for a read-only service\npublic abstract class BaseReadOnlyService&lt;T, R&gt; : IReadOnlyService&lt;T&gt;\n    where T : class\n    where R : IReadOnlyRepository&lt;T&gt;, new()\n{\n}\n\n//Base implementation for a read/write service\npublic abstract class BaseService&lt;T, R&gt; : IService&lt;T&gt;\n    where T : class\n    where R : IRepository&lt;T&gt;, new()\n{\n}\n\n//Concrete sample service\npublic class UserService : BaseService&lt;User, UserRepository&gt;\n{ //As with the repository I can change the default behavior of implementation overriding methods\n}\n</code></pre>\n\n<p>With this setup, the only way to compile is to reference Entity Framework on the service layer project.\nHow can I avoid the need to reference Entity Framework there?</p>\n\n<p>At this point, I'm willing to even throw it all out and rebuild everything but this is the only way I found to make it work given my needs (DbContext sharing connection strings, generic repository to avoid replication of code).</p>\n\n<p>Appreciate any help. Thanks.</p>\n\n<p><em>--Edit--Including here some extra steps I did 3 hours after I posted the question--</em></p>\n\n<p>In order to figure this out, I started to create a sample project with the same code above plus some implementation to mimic the results on the original project as much as possible.</p>\n\n<p>I created the domain classes project, the whole base data layer project and then the context project. I noticed I need to reference Entity Framework on the context project even though the context class does not derive directly from DbContext. Instead, it derives from an abstract class that derives from DbContext. This is ok though since my context will have DbSets and any other implementation related to DbContext.</p>\n\n<p>Next is the repository project. Needs to reference all other three (domain, base data layer and context). My repository has no code. All funcionality lies on the ancestor. I try to compile the repository project and VS requires me to referente Entity Framework. I wonder if it's really just a matter of embedding libraries. If this is confirmed, it's going to be a surprise. Entity Framework library is present on the output of the other projects. Why would I need to reference it here too? What's making VS require this?</p>\n\n<p>Anyway, for testing purposes, I added the reference. After all, I'm inside the data layer. I can live with that. Moving on to the service layer. For the sake of simplicity, I put all of the service classes into the same project.</p>\n\n<p>One possible flaw is that one of the constraints for the service abstract classes is the repository interface. That requires me to add a reference to the base data layer on my service layer. Perhaps already here there is something I can do that allows me to use only the repository reference. I have no option but to reference base data layer.</p>\n\n<p>Lastly, my concrete service is created and VS gives me the following error message: The type 'System.Data.Entity.DbContext' is defined in an assembly that is not referenced. You must add a reference to assembly 'EntityFramework, Version=4.3.1.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.</p>\n\n<p>So, in the end, the only way to keep going is to reference Entity Framework on the service layer. And at some point, when building the Windows Forms App, I will also have to reference Entity Framework.</p>\n\n<p>What should I do to avoid having these references? What improvements can I have on this structure?</p>\n\n<p>What I know is that my app certainly doesn't have to know that Entity Framework is involved anywhere on the other layers. Neither does the service layer. Services will only consume repositories. Repositories can even be providing fake data for tests.</p>\n\n<p>In case anyone is interested, I uploaded the project I created while writing this. It's a 1,17Mb zip file with no binaries whatsoever (except the Entity Framework 4.3.1 dll that I got through Nuget). Link: <a href=\"http://www.mediafire.com/?b45zkedy2j7eocc\" rel=\"nofollow\">http://www.mediafire.com/?b45zkedy2j7eocc</a>.</p>\n\n<p>Again, thanks for helping.</p>\n"},{"tags":["c#","entity-framework","grid","devexpress","master-detail"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13281199,"title":"Create master/detail grids using XtraGrid Entity framework","body":"<p>I'm a beginner regarding C#, Entity and working with grids, so although I assume what I'm asking is somewhat general, I am a little lost.\nI have two tables in my SQL database: <code>PeriodicReports</code> and <code>PeriodicReportGroups</code>. Each reports group can have 1 or more periodic reports, so what I envisioned was a grid with rows that would have a + sign at the left and could be expanded, showing the related periodic reports for each group. I know this can be done because I've seen very similar examples in DevExpress support site, but although I've put time trying to understand them and apply them to my case, I still haven't figured how to do it. \nThis is what my code looks like. After using the Entity Framework with my tables, this class got created automatically:</p>\n\n<pre><code>public partial class ReportEntities : DbContext\n{\n    public ReportEntities()\n        : base(\"name=ReportEntities\")\n    {\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        throw new UnintentionalCodeFirstException();\n    }\n\n    public DbSet&lt;PeriodicReportGroup&gt; PeriodicReportGroups { get; set; }\n    public DbSet&lt;PeriodicReport&gt; PeriodicReports { get; set; }\n}\n</code></pre>\n\n<p>I created this interface and class myself in order to only show certain columns in my grid:</p>\n\n<pre><code>    public interface IPeriodicReportGroup\n{\n    string Name { get; }\n    string Description { get; }\n    bool Active { get; set; }\n}\n\npublic partial class PeriodicReportGroup : IPeriodicReportGroup\n{\n}\n</code></pre>\n\n<p>And in the other hand, I have my XtraForm with an XtraGrid:</p>\n\n<pre><code>public partial class Form1 : XtraForm\n{\n    public Form1()\n    {\n        InitializeComponent();\n        InitSkinGallery();\n        InitGrid();\n    }\n\n    BindingList&lt;IPeriodicReportGroup&gt; gridDataList = new BindingList&lt;IPeriodicReportGroup&gt;();\n\n    void InitGrid()\n    {\n        var database = new ReportEntities();\n\n        var reportGroups = database.PeriodicReportGroups.ToList( );\n\n        foreach (var group in reportGroups )\n            gridDataList.Add( group );\n\n        gridControl.DataSource = gridDataList;\n    }\n...\n</code></pre>\n\n<p>So far, I'm successfully putting the periodic report groups that I have in my DB in the grid, which is good. But I still have no clue on how exactly set up the details grid that will expand for each group, although I feel it should be something pretty standard. Can anybody offer some guidance? I'm not asking for somebody else to do my work, just something that can point me out in the right direction, because right now I'm pretty lost. \nI'd also love to be able to add new groups and new details on the run by inputting data into an empty row, is this possible? </p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":159,"score":8,"question_id":12652070,"title":"EF: In search of a design strategy for DatabaseFirst DbContext of a Modular Application","body":"<p>I'm looking for suggestions on how to approach using an ORM (in this case, EF5) in the design of modular Non-Monolithic applications, with a Core part and 3rd party Modules, where the Core has no direct Reference to the 3rd party Modules, and Modules only have a reference to Core/Common tables and classes. </p>\n\n<p>For arguments sake, a close enough analogy would be DNN.</p>\n\n<p>CodeFirst:</p>\n\n<p>With CodeFirst, the approach I used was to build up the model of the Db was via reflection: in the Core's DbContext's DbInitialation phase, I used Reflection to find any class in any dll (eg Core or various Modules) decorated with IDbInitializer (a custom contract containing an Execute() method) to define just the dll's structure. Each dll added to the DbModel what it knew about itself. \nAny subsequent Seeding was also handled in the same wa (searching for a specific IDbSeeder contract, and executing it).</p>\n\n<p>Pro: \n* the approach works for now.\n* The same core DbContext can be used across all respositories, as long as each repo uses dbContext.GetSet(), rather than expecting it to be a property of the dbContext. No biggie.\nCons: \n * it only works at startup (ie, adding new modules would require an AppPool refresh).\n * CodeFirst is great for a POC. But in EF5, it's not mature enough for Enterprise work <em>yet</em> (and I can't wait for EF6 for StoredProcs and other features to be added).\n * My DBA hates CodeFirst, at least for the Core, wanting to optimize that part with Stored Procs as much as as possible...We're a team, so I have to try to find a way to please him, if I can find a way... </p>\n\n<p>Database-first:</p>\n\n<p>The DbModel phase appears to be happening prior to the DbContext's constructor (reading from embedded *.edmx resource file).  DbInitialization is never invoked (as model is deemed complete), so I can't add more tables than what the Core knows about.</p>\n\n<p>If I can't add elements to the Model, dynamically, as one can with CodeFirst, it means that \n* either the Core DbContext's Model has to have knowledge of every table in the Db -- Core AND every 3rd party module. Making the application Monolithic and highly coupled, defeating the very thing I am trying to achieve.\n* Or each 3rd party has to create their own DbContext, importing Core tables, leading to\n   * versioning issues (module not updating their *.edmx's when Core's *.edmx is updated, etc.)\n   * duplication everywhere, in different memory contexts = hard to track down concurrency issues.</p>\n\n<p>At this point, it seems to me that the CodeFirst approach is the only way that Modular software can be achieved with EF. But hopefully someone else know's how to make DatabaseFirst shine -- is there any way of 'appending' DbSet's to the model created from the embedded *.edmx file?</p>\n\n<p>Or any other ideas?</p>\n"},{"tags":["asp.net","entity-framework","c#-4.0","code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":3020,"score":2,"question_id":4602954,"title":"How do i define Keys when working with \"EF-Code First\"?","body":"<p>I get a ModelValidationException (at the bottom) when working with \"EF-Code First\". It wants me to define a Key but I'm not sure what exactly it means...</p>\n\n<pre><code>public class Unit\n{\n    Guid id;\n    String public_id;\n    String name;\n    String additional_id;\n    String role;\n    Guid parent_id;\n    int client_id;\n    bool deleted;\n}\n\npublic class MyDataContext : DbContext\n{\n    public DbSet&lt;Unit&gt; Units { get; set; }\n\n    protected override void OnModelCreating(ModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;Unit&gt;().ToTable(\"sometable\");\n    }\n}\n\n[TestFixture]\npublic class FundsLibraryDataTests\n{\n    [Test]\n    public void Test()\n    {\n        MyDataContext database = new MyDataContext();\n        var o = database.Units;\n\n\n        Console.WriteLine(o.Count()); // This line throws!\n        Assert.IsTrue(true);\n    }\n}\n</code></pre>\n\n<blockquote>\n  <p>System.Data.Entity.ModelConfiguration.ModelValidationException : One or more validation errors were detected during model generation:</p>\n  \n  <p>System.Data.Edm.EdmEntityType: : EntityType 'Unit' has no key defined. Define the key for this EntityType.</p>\n  \n  <p>System.Data.Edm.EdmEntitySet: EntityType: The EntitySet Units is based on type Unit that has no keys defined.</p>\n</blockquote>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13260073,"title":"EF Code first lookup value without foreign key in model","body":"<p>I am working with a database that has two tables. \nIssues (contains a SubStatusID column that has int values. several of the rows have 0 value for this column)</p>\n\n<p>SubStatus table (contains SubStatusID, SubStatusText but there is no row with 0 value for SubStatusID...so I cannot use SubStatusID from this table as the foreign key association in my entity framework model).</p>\n\n<p>I also cannot change the data in any of the tables.</p>\n\n<p>When I pull the Issue record using EF 5, how can I also retrieve the value of the SubStatus column if Issue's SubStatusID is not 0</p>\n"},{"tags":["entity-framework","c#-4.0","expression-trees","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13274586,"title":"DBContext cache expression tree of a query","body":"<p>I'm actually working on a project who use a very big linq to entity query (around 250 lines) who works with a lot of different entities.</p>\n\n<p>This query depend of few parameters (3 or 4 max) so I think to \"store\" the expression tree of my query and modifying this one with just my few parameters like this.</p>\n\n<pre><code>IQueryable&lt;Foo&gt; myQuery = \n  GetBaseQuery()\n  .Where(a =&gt; a.Param1 == \"foo\")\n  .Where(a =&gt; a.Param2 == \"bar\");\n</code></pre>\n\n<p>Apart using compiled queries, is there a way to do that ? </p>\n\n<p>This problem has some conditions</p>\n\n<ul>\n<li>I use DbContext and changing to ObjectContext is difficialy possible and it seems that this is a pre requities for using compiled queries.</li>\n<li>I use Visual Studio 2010 so... i'm limited to .NET 4 and entity framework 4.3 (no .NET 4.5, EF5 and autocompiled queries unhopefully)</li>\n</ul>\n\n<p>So, Is there a way to</p>\n\n<ul>\n<li>Store an expression tree who will be just used as a \"base\" and will not take too much time to be generated ?</li>\n<li>Or using .NET 4.5 in visual studio 2010 ?</li>\n<li>Or using Compiled queries with a DbContext</li>\n</ul>\n\n<p>REALLY Thank's by advance !!!</p>\n"},{"tags":["entity-framework","backbone.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13278201,"title":"Linq Query to group Parent and respective child rentities","body":"<p>Here are my classes:</p>\n\n<pre><code>class Country\n{\n    public Country()\n    {\n        States = new List&lt;State&gt;();\n    }\n\n    public int Id { get; set; }\n    public int Name { get; set; }\n\n    public virtual ICollection&lt;State&gt; States  { get; set; }\n}\n\nclass State\n{\n    public State()\n    {\n        Counties = new List&lt;County&gt;();\n    }\n\n    public int Id { get; set; }\n    public int Name { get; set; }\n    public int CountryID { get; set; }\n\n    [ForeignKey(\"CountryID\")]\n    public virtual Country Country { get; set; }\n\n    public virtual ICollection&lt;County&gt; Counties { get; set; }\n}\n\nclass County\n{\n    public County()\n    {\n        Cities = new List&lt;City&gt;();\n    }\n\n    public int Id { get; set; }\n    public int Name { get; set; }\n    public int StateID { get; set; }\n\n    [ForeignKey(\"StateID\")]\n    public virtual State State { get; set; }\n\n    public virtual ICollection&lt;City&gt; Cities { get; set; }\n}\n\nclass City\n{\n    public int Id { get; set; }\n    public int Name { get; set; }\n    public int CountyID { get; set; }\n\n    [ForeignKey(\"CountyID\")]\n    public virtual County County { get; set; }\n}\n</code></pre>\n\n<p>I am having difficulty in creating the query that will give me all the records for each entities above grouped by Country, then State, then County, then City</p>\n\n<p>I am ultimately trying to put this into a backbone.js treeview.</p>\n\n<p><strong>What would be the correct Linq query for collecting the records in their respective groups</strong></p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13269433,"title":"Restrict DBSet to a subset of entities","body":"<p>I am building a multi-tenant application using EF 4, I have a shared database an many entities have a CustomerID field. I was wondering if there was a way I could enforce a CustomerID query at my DBSet level from my DBContext. </p>\n\n<p>I was hoping I could specify a CustomerID when I create my DB context, and wrap the DBSets to always include a (x => x.CustomerID == custID) so I don't need to worry about adding this logic all over my application, but I haven't been able to find anything that suggests its possible</p>\n\n<p>Many thanks</p>\n"},{"tags":["c#","wpf","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13275949,"title":"update dataGrid back to ef from anonymous type","body":"<p>The following code shows into dataGrid result from two tables</p>\n\n<p>But I understand that I can not update the data back into the DB (since it shows anonymous type)</p>\n\n<pre><code>public class NameAndDone\n{\n    public string document_Name { get; set; }\n    public bool ? document_Done { get; set; }\n}\n\n\n       vagEntities projectE = new vagEntities();\n       var doc = from c in projectE.Person_Documents\n                  join cw in projectE.Documents on c.Document_Id equals cw.Document_Id\n                  where c.Person_Id == selc   \n                  select new NameAndDone { document_Name = cw.Document_Name,document_Done = c.Document_done};\n\n       carsGrid.ItemsSource = doc;\n</code></pre>\n\n<p>and in the xaml </p>\n\n<pre><code>        &lt;DataGrid Grid.Row=\"1\" RowHeight=\"30\" AutoGenerateColumns=\"False\" Margin=\"15,15,15,96\" x:Name=\"carsGrid\" &gt;\n    &lt;DataGrid.Columns&gt;\n            &lt;DataGridTextColumn  Binding=\"{Binding Path=document_Name}\" MinWidth=\"100\" Header=\"Documents\"  /&gt;\n            &lt;DataGridCheckBoxColumn  Binding=\"{Binding Path=document_Done}\" Header=\"Done\" /&gt;\n        &lt;/DataGrid.Columns&gt;\n    &lt;/DataGrid&gt;\n</code></pre>\n\n<p>My question is: Is it possible to update with the saveChanges () function?\nOr I need to change all the code (hope not)</p>\n\n<p>Thanks in advance to anyone who helps (even if I can not understand)</p>\n\n<p>Please, does anyone have an idea?</p>\n"},{"tags":["c#","linq","entity-framework","casting"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":113,"score":4,"question_id":13276806,"title":"Converting from IEnumerable<IEnumerable<string>> to ICollection<T>","body":"<p>I'm trying to convert an <code>IEnumerable&lt;IEnumerable&lt;string&gt;&gt;</code> to <code>ICollection&lt;Character&gt;</code> but struggling to figure out the right way to do it since the structure of one object is different than the structure of the other.</p>\n\n<p>The reason for conversion is to take a json deserialization and insert that into a database via Entity Framework. The json data isn't normalized and doesn't match the exact structure of the database. In the database I have a <code>movie</code> and a <code>person</code> that have a many-to-many relationship. The bridge table between them is <code>characters</code>. But the json just has a movie object with an array of people objects and each person with an array of the characters they play (<code>IEnumerable&lt;IEnumerable&lt;string&gt;&gt;</code>).</p>\n\n<p>Basically, I need to convert each movie's people and their characters to each movie's character and its respective person.</p>\n\n<pre><code>var movie = dataContractMovies.Select(m =&gt; new Movie {\n    Title = m.Title,\n    // not sure how to convert each Person and their characters\n    Characters = // Need to take each Person and their Characters in m.Cast and cast to a new Character and a new Person for which the Character belongs to\n});\n</code></pre>\n\n<p><strong>Convert From</strong></p>\n\n<pre><code>public class MovieDataContract {\n    [DataMember(Name = \"title\")]\n    public string Title { get; set; }\n\n    [DataMember(Name = \"abridged_cast\")]\n    public virtual IEnumerable&lt;Person&gt; Cast { get; set; }\n}\n\n[DataContract]\npublic class Person {\n    [DataMember(Name = \"name\")]\n    public string Name { get; set; }\n\n    [DataMember(Name = \"characters\")]\n    public IEnumerable&lt;string&gt; Characters { get; set; }\n} \n</code></pre>\n\n<p><strong>Convert To</strong></p>\n\n<pre><code>public partial class Movie {\n    public string Title { get; set; }\n    public virtual ICollection&lt;Character&gt; Characters { get; set; }\n\n    public Movie() {\n        this.Characters = new HashSet&lt;Character&gt;();\n    }\n}\n\npublic partial class Character {\n    public string Name { get; set; }\n    public virtual Movie Movie { get; set; }\n    public virtual Person Person { get; set; }\n}\n\npublic partial class Person {\n    public string Name { get; set; }\n    public virtual ICollection&lt;Character&gt; Characters { get; set; }\n\n    public Person() {\n        this.Characters = new HashSet&lt;Character&gt;();\n    }\n}\n</code></pre>\n"},{"tags":[".net","sql-server","wpf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":10,"score":3,"question_id":13278889,"title":"How to add data to SQL Server Express database using Entity Framework","body":"<p>I'm writing simple program for my university. I created an Entity Framework model, draw diagrams, created database from model, applied SQL file on my database and now I'm trying to add some items to the DB. </p>\n\n<p>I'm doing it this way:</p>\n\n<pre><code>using (NewsletterEntities context = new NewsletterEntities())\n{\n   Sender newSender = new Sender();\n   newSender.Login = Login.Text;\n   newSender.Password = Password.Text;\n   newSender.Port = 23;\n   newSender.SMTP = SMTP.Text;\n   newSender.Email = Email.Text;\n   newSender.SenderID = 0;\n\n   context.Senders.AddObject(newSender);\n   context.SaveChanges();\n}\n</code></pre>\n\n<p>When I try to execute it it pops up with inner exception: </p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table 'Senders' when IDENTITY_INSERT is set to OFF.</p>\n</blockquote>\n\n<p>I was trying to look for the error, but I don't know much about entity framework and couldn't find anything specific.</p>\n\n<p>Can anyone help?</p>\n"},{"tags":["asp.net-mvc","linq","entity-framework","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13278891,"title":"Complex SQL to LINQ to populate Grid (Count items year by month) (MVC, EF Code First)","body":"<p>I have a grid that I want to fill with the following:</p>\n\n<p>It is tracking tickets that have been open each month for the last year. The grid is filtered by priority so I have a something like this:</p>\n\n<pre><code>| Mon | Critical | High | Tot |\n| Jan |    5     |  2   |  7  |\n| Feb |    2     |  3   |  5  |\n</code></pre>\n\n<p>This is my SQL statement:</p>\n\n<pre><code>SELECT\n    MONTH(CreateDate),\n    DATENAME(MONTH,m.CreateDate) AS 'Month',\n    SUM(CASE WHEN (m.PriorityId = 1) THEN 1 ELSE 0 END) AS 'Critical',\n    SUM(CASE WHEN (m.PriorityId = 2) THEN 1 ELSE 0 END) AS 'High',\n    SUM(CASE WHEN (m.PriorityId = 3) THEN 1 ELSE 0 END) AS 'Normal',\n    SUM(CASE WHEN (m.PriorityId = 4) THEN 1 ELSE 0 END) AS 'Low',\n    SUM(CASE WHEN (m.PriorityId = 5) THEN 1 ELSE 0 END) AS 'Not Ready',\n    Count(m.Id) AS Total\nFROM\n    tblMaintenanceTicket m\nINNER JOIN\n    tblPriority p\nON\n    p.Id = m.PriorityId\nWHERE\n    StatusId = 1\n    AND YEAR(CreateDate) = year(getdate())\nGROUP BY \n    MONTH(CreateDate),\n    DATENAME(MONTH,m.CreateDate)\nORDER BY\n    MONTH(CreateDate)\n</code></pre>\n\n<p>I am looking to convert this in VB LINQ but I am not sure this is the best method. I am also thinking calling a stored procedure, but I want to stay out of the DB really. I am using MVC 3 with the repository pattern, so calling my code is something like this output for JSON:</p>\n\n<pre><code>Dim tickets = ticketRepo.GetAll().Include(Function(p) p.Priority).ToArray()\n</code></pre>\n\n<p>Any assistance?</p>\n"},{"tags":["c#","entity-framework","nhibernate","orm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13277324,"title":"NHibernate, join between tables and return a specific type","body":"<p>I have 2 tables, I'd like place some fields in a result class, but I'm stuck. The code I want look like this with Entity Framework :</p>\n\n<pre><code>var res =   \n(from p in context.EstimationItem\n    join q in ...\n    select new EstimationWithDetail\n    {\n        Estimation = q.Estimation,\n        Id = q.Id,\n        FullName = q.Customer.FirstName + q.Customer.LastName\n\n    }).ToList();\n</code></pre>\n\n<p>In Nibernate, at this time, I have this, but I'm stuck ...</p>\n\n<pre><code>var res =\n    Session.QueryOver&lt;EstimationItem&gt;()\n    .JoinQueryOver(x =&gt; x.Estimation)\n    .Select(\n        x =&gt; x.Estimation.Reference,\n        x =&gt; x.Estimation.CreationDate,\n        x =&gt; x.Price,\n        x =&gt; x.Estimation.Customer.FirstName,\n        x =&gt; x.Estimation.Customer.LastName\n        )\n    .List();\n\npublic class Estimation\n{\n    public virtual string Reference { get; set; }\n    public virtual Customer Customer { get; set; }\n    public virtual DateTime CreationDate { get; set; }\n    public virtual decimal Total { get; set; }\n    public virtual IList&lt;EstimationItem&gt; EstimationItems { get; set; }\n}\n\npublic class EstimationItem\n{\n    public virtual decimal Price { get; set; }\n    public virtual int Quantity { get; set; }\n    public virtual Estimation Estimation { get; set; }\n    public virtual Product Product { get; set; }\n}\n\npublic class EstimationWithDetail\n{\n    public string Reference { get; set; }       //Estimation.Reference\n    public string FullName { get; set; }        //concat FirstName and LastName from Customer\n    public decimal Price { get; set; }          //Estimation.Total\n    public int Id { get; set; }                 //Estimation.Id\n    public DateTime CreationDate { get; set; }  //Estimation.CreationDate\n}\n</code></pre>\n\n<p><strong>Update 1</strong></p>\n\n<p>I tried the code but I get this error : \n<em>InvalidOperarionException, variable 'x' of type 'EstimationItem' referenced from scope '', but it is not defined</em></p>\n\n<pre><code>var res =\n    Session.QueryOver&lt;EstimationItem&gt;()\n    .JoinQueryOver(x =&gt; x.Estimation)\n    .Select(x =&gt; new EstimationWithDetail\n    {\n        Code = x.Estimation.Reference,\n        CreationDate = x.Estimation.CreationDate,\n        Price = x.Estimation.Total,\n        FullName = x.Estimation.Customer.FirstName + x.Estimation.Customer.LastName\n    })\n    .List&lt;EstimationWithDetail&gt;();\n</code></pre>\n\n<p><strong>Update 2 :</strong>\nI tried this too</p>\n\n<pre><code>Estimation a = null;\nCustomer b = null;\nvar res = Session.QueryOver&lt;EstimationItem&gt;()\n    .JoinAlias(c =&gt; c.Estimation, () =&gt; a)\n    .JoinAlias(c =&gt; c.Estimation.Customer, () =&gt; b)\n    .Select(x =&gt; new EstimationWithDetail\n    {\n        Code = a.Reference,\n        Id = a.Id,\n        FullName = b.LastName\n    })\n    .List&lt;EstimationWithDetail&gt;();\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":13,"score":-1,"question_id":13277044,"title":"Entity Framework database not showing","body":"<p>When I select 'add a new item' and then select 'ADO.NET Entity Data Model' and select 'Generate from database' in Visual Studio only some databases show up but other databases I have added don't? </p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13270379,"title":"Entity Framework performance issue while looping with more record","body":"<p>I have employee details of more than 4000 employees. While retrieving those rows, I am faced with performance issues due to the looping. So what can I do to improve performance?</p>\n\n<p>This is the looping I mentioned:</p>\n\n<pre><code>List&lt;EmployeesEntityObject&gt; lstEmployee = new List&lt;EmployeesEntityObject&gt;();\n\nforeach (var item in lst)\n{\n           EmployeesEntityObject obj = new EmployeesEntityObject();\n           obj.EmployeeID = item.EmployeeID;\n           obj.EmployeeName = item.EmployeeName;       \n           lstEmployee.Add(obj);\n}\n</code></pre>\n"},{"tags":["mysql","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":421,"score":1,"question_id":12181428,"title":"ASP.NET MVC 4 EF5 with MySQL","body":"<p>So I've just picked up VS2012 and I want to start an ASP.NET MVC 4 app with EF5.</p>\n\n<p>My host does not have MSSQL so I have to use MySQL.</p>\n\n<p>How do I tell my app that it should use MySQL? (I either want to use the devart MySQL connector or the one from mysql.com)</p>\n"},{"tags":["linq","entity-framework","logging","linq-to-entities","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13278294,"title":"EF Tracing Provider, Tracking Calling Method or Entity","body":"<p>I've gotten the EFTracingProvider to work with my code first application, but when logging, my application tries to log the calling class.  Since my context is always where the EFTracing Provider resides, that is what's getting stored in the calling class, even though the actual attempt to reference the entity happened in another class.</p>\n\n<p>Is there anyway to either track where the actual call happened, or to track which entity or DBSet in the context was trying to be accessed, which then caused the Tracing to fire?</p>\n"},{"tags":["entity-framework","ef-code-first","code-first","one-to-one"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13155385,"title":"Code First One to One relationship","body":"<p>I am writing a model, using Code First, with two entities: 'Action' and 'Permission'.</p>\n\n<p>Each Permission points to exactly one Action.\nNo two Permissions may point to the same Action.\nAn Action may exist without being pointed to by a Permission.</p>\n\n<p>Actions should not be aware of Permissions.</p>\n\n<p>My code is:</p>\n\n<pre><code>public Action\n{\n  public Guid Id {get; set;}\n  public string Name {get; set;}\n}\n\npublic Permission\n{\n  public Guid Id {get; set;}\n  public string Name {get; set;}\n\n  public Action Action {get; set;}\n}\n</code></pre>\n\n<p>Also, I configured Permission using the Fluent API:</p>\n\n<pre><code>modelBuilder.Entity&lt;Permission&gt;.HasRequired(p =&gt; p.Action).WithOptional()\n            .WillCascadeOnDelete();\n</code></pre>\n\n<hr>\n\n<p>When I try to delete an Action, I get the following error:</p>\n\n<blockquote>\n  <p>\"Adding a relationship with an entity which is in the Deleted state is\n  not allowed\".</p>\n</blockquote>\n\n<p>I tried deleting the Permission first, and then the Action. For that, i needed to fetch the Permission given the Action ID, but i get this error:</p>\n\n<pre><code>var permission = (from p in context.Permissions.Include(p =&gt; p.Action)\n                  where p.Action.Id == actionId\n                  select p).Single();\n</code></pre>\n\n<blockquote>\n  <p>\"Indexed properties are not supported\"</p>\n</blockquote>\n\n<p>What am I doing wrong? Is there a better approch to model this?</p>\n\n<p>Thanks! \nNir</p>\n"},{"tags":["wpf","entity-framework","data-binding","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13277327,"title":"How to bind entities from Entity Framework to DataGrid?","body":"<p>My XAML:</p>\n\n<pre><code>&lt;Window x:Class=\"Newsletter.UI.MessagesWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        Title=\"MessagesWindow\" Name=\"messagesWindow\" Height=\"576\" Width=\"1024\" WindowStartupLocation=\"CenterScreen\" Closed=\"MessagesWindowClosed\"&gt;\n    &lt;Window.Resources&gt;\n        &lt;Style TargetType=\"{x:Type Button}\"&gt;\n            &lt;Setter Property=\"Width\" Value=\"149\"/&gt;\n            &lt;Setter Property=\"Margin\" Value=\"10\"/&gt;\n        &lt;/Style&gt;\n    &lt;/Window.Resources&gt;\n    &lt;Grid&gt;\n        &lt;Grid.RowDefinitions&gt;\n            &lt;RowDefinition Height=\"75\"/&gt;\n            &lt;RowDefinition Height=\"*\"/&gt;\n        &lt;/Grid.RowDefinitions&gt;\n        &lt;StackPanel Grid.Row=\"0\"  Orientation=\"Horizontal\" HorizontalAlignment=\"Center\"&gt;\n            &lt;Grid&gt;\n                &lt;Grid.RowDefinitions&gt;\n                    &lt;RowDefinition Height=\"*\"/&gt;\n                    &lt;RowDefinition Height=\"*\"/&gt;\n                &lt;/Grid.RowDefinitions&gt;\n                &lt;Button Name=\"saveButton\" Grid.Row=\"0\" Content=\"Save\"  Margin=\"10,10,10,5\"/&gt;\n                &lt;TextBox Name=\"searchTextBox\" Grid.Row=\"1\"  Margin=\"10,5,10,10\"/&gt;\n            &lt;/Grid&gt;\n            &lt;Button Name=\"recipientsButton\" Content=\"RECIPIENTS\" Click=\"RecipientsButtonClick\" /&gt;\n            &lt;Button Name=\"createButton\" Content=\"CREATE\" Click=\"CreateButtonClick\" /&gt;\n            &lt;Button Name=\"removeButton\" Content=\"REMOVE\" /&gt;\n            &lt;Button Name=\"editButton\" Content=\"EDIT\" /&gt;\n            &lt;Button Name=\"resendButton\" Content=\"RESEND\"/&gt;\n        &lt;/StackPanel&gt;\n        &lt;DataGrid Name=\"gridMessages\" Grid.Row=\"1\"/&gt;\n    &lt;/Grid&gt;\n&lt;/Window&gt;\n</code></pre>\n\n<p>My .cs code:</p>\n\n<pre><code>private void messagesWindow_Loaded(object sender, RoutedEventArgs e)\n        {\n            using (NewsletterEntities context = new NewsletterEntities())\n            {\n                var query = from m in context.Messages select m;\n                var result = query.ToList();\n                gridMessages.DataContext = result;\n            }\n        }\n</code></pre>\n\n<p><code>Message</code> class generated by EF:</p>\n\n<pre><code>[EdmEntityTypeAttribute(NamespaceName=\"NewsletterModel\", Name=\"Message\")]\n[Serializable()]\n[DataContractAttribute(IsReference=true)]\npublic partial class Message : EntityObject\n{\n    #region Factory Method\n\n/// &lt;summary&gt;\n/// Create a new Message object.\n/// &lt;/summary&gt;\n/// &lt;param name=\"messageID\"&gt;Initial value of the MessageID property.&lt;/param&gt;\n/// &lt;param name=\"subject\"&gt;Initial value of the Subject property.&lt;/param&gt;\n/// &lt;param name=\"content\"&gt;Initial value of the Content property.&lt;/param&gt;\n/// &lt;param name=\"hasAttachments\"&gt;Initial value of the HasAttachments property.&lt;/param&gt;\n/// &lt;param name=\"senderID\"&gt;Initial value of the SenderID property.&lt;/param&gt;\n/// &lt;param name=\"date\"&gt;Initial value of the Date property.&lt;/param&gt;\npublic static Message CreateMessage(global::System.Int32 messageID, global::System.String subject, global::System.String content, global::System.Boolean hasAttachments, global::System.Int32 senderID, global::System.DateTime date)\n{\n    Message message = new Message();\n    message.MessageID = messageID;\n    message.Subject = subject;\n    message.Content = content;\n    message.HasAttachments = hasAttachments;\n    message.SenderID = senderID;\n    message.Date = date;\n    return message;\n}\n\n#endregion\n\n#region Primitive Properties\n\n/// &lt;summary&gt;\n/// No Metadata Documentation available.\n/// &lt;/summary&gt;\n[EdmScalarPropertyAttribute(EntityKeyProperty=true, IsNullable=false)]\n[DataMemberAttribute()]\npublic global::System.Int32 MessageID\n{\n    get\n    {\n        return _MessageID;\n    }\n    set\n    {\n        if (_MessageID != value)\n        {\n            OnMessageIDChanging(value);\n            ReportPropertyChanging(\"MessageID\");\n            _MessageID = StructuralObject.SetValidValue(value);\n            ReportPropertyChanged(\"MessageID\");\n            OnMessageIDChanged();\n        }\n    }\n}\nprivate global::System.Int32 _MessageID;\npartial void OnMessageIDChanging(global::System.Int32 value);\npartial void OnMessageIDChanged()\n</code></pre>\n\n<p>Unfortunately nothing happens, the DataGrid is empty.\nI'm new to data binding in WPF and EF. I hope this problem is simple but I have no idea how to solve it.</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13267721,"title":"LINQ Query - Only get Order and MAX Date from Child Collection","body":"<p>I'm trying to get a list that displays 2 values in a label from a parent and child (1-*) entity collection model.  </p>\n\n<p>I have 3 entities:</p>\n\n<ol>\n<li>[<strong>Customer</strong>]: CustomerId, Name, Address, ...  </li>\n<li>[<strong>Order</strong>]: OrderId, OrderDate, EmployeeId, Total, ... </li>\n<li>[<strong>OrderStatus</strong>]: OrderStatusId, StatusLevel, StatusDate, ...</li>\n</ol>\n\n<p>A <strong>Customer</strong> can have MANY <strong>Order</strong>, which in turn an Order can have MANY <strong>OrderStatus</strong>, i.e. \n[<strong>Customer</strong>] 1--* [<strong>Order</strong>] 1--* [<strong>OrderStatus</strong>]</p>\n\n<p>Given a CustomerId, I want to get all of the Orders (just OrderId) and the LATEST (MAX?) OrderStatus.StatusDate for that Order.</p>\n\n<p>I've tried a couple of attempts, but can seem to get the results I want.</p>\n\n<pre><code>private IQueryable&lt;Customer&gt; GetOrderData(string customerId)\n{\n     var ordersWithLatestStatusDate = Context.Customers\n\n     // Note: I am not sure if I should add the .Expand() extension methods here for the other two entity collections since I want these queries to be as performant as possible and since I am projecting below (only need to display 2 fields for each record in the IQueryable&lt;T&gt;, but thinking I should now after some contemplation.\n\n     .Where(x =&gt; x.CustomerId == SelectedCustomer.CustomerId)\n     .Select(x =&gt; new Custom \n     {\n         CustomerId = x.CustomerId,\n         ...\n         // I would like to project my Child and GrandChild Collections, i.e. Orders and OrderStatuses here but don't know how to do that. I learned that by projecting, one does not need to \"Include/Expand\" these extension methods.  \n     });\n     return ordersWithLatestStatusDate ;\n}\n</code></pre>\n\n<p>---- UPDATE 1 ----</p>\n\n<p>After the great solution from User: <a href=\"http://stackoverflow.com/users/470005/lazyberezovsky\">lazyberezovsky</a>, I tried the following:</p>\n\n<pre><code>var query = Context.Customers\n            .Where(c =&gt; c.CustomerId == SelectedCustomer.CustomerId)\n            .Select(o =&gt; new Customer \n            { \n                Name = c.Name, \n                LatestOrderDate = o.OrderStatus.Max(s =&gt; s.StatusDate) \n            });\n</code></pre>\n\n<p>In my hastiness from my initial posting, I didn't paste everything in correctly since it was mostly from memory and didn't have the exact code for reference at the time.  My method is a strongly-typed IQueryabled where I need it to return a collection of items of type T due to a constraint within a rigid API that I have to go through that has an IQueryable query as one of its parameters. I am aware I can add other entities/attributes by either using the extension methods .Expand() and/or .Select().  One will notice that my latest UPDATED query above has an added \"new Customer\" within the .Select() where it was once anonymous.  I'm positive that is why the query failed b/c it couldn't be turn into a valid Uri due to LatestOrderDate not being a property of Customer at the Server level.  FYI, upon seeing the first answer below, I had added that property to my client-side Customer class with simple { get; set; }.  So given this, can I somehow still have a Customer collection with the only bringing back those 2 fields from 2 different entities?  The solution below looked so promising and ingenious!</p>\n\n<p>---- END UPDATE 1 ----</p>\n\n<p>FYI, the technologies I'm using are OData (WCF), Silverlight, C#.</p>\n\n<p>Any tips/links will be appreciated.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13275020,"title":"Entity Framework, SET PK and FK for related table","body":"<p><img src=\"http://i.stack.imgur.com/zgJNC.png\" alt=\"enter image description here\"></p>\n\n<p>I want to make relation Table A and Table B in table A entity class.</p>\n\n<pre><code>[ForeignKey(\"newID\")]\npublic virtual ICollection&lt;TableB&gt; tableBs {get; set;}\n</code></pre>\n\n<p>then it look for newID_ID. </p>\n\n<p>How can I make relation newID and FK?</p>\n\n<p><strong>TableA.newID and TableB.FK</strong></p>\n\n<p><em>Not,\nTableA.newID = TableB.ID</em></p>\n"},{"tags":["c#","asp.net-mvc-3","linq","entity-framework","lambda"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13273012,"title":"How to combine two model list to one model","body":"<p>Please see code below :</p>\n\n<pre><code>public class NewsFilterModel\n{\n    public CtArticleDetail ArticleDetail { get; set; }\n\n    public PcPage Page { get; set; }\n}\n\npublic IEnumerable&lt;NewsFilterModel&gt; GetNewsFilterModelByTagNames(string tagNames, int status)\n{\n     var resultArticle = db.CtArticleDetail.Where(m =&gt; m.tagNames == tagNames);\n     var resultPage  = db.PcPage.Where(m =&gt; m.tagNames == tagNames);\n}\n</code></pre>\n\n<p>Can anyone please advice what the best way to combine two model to one model which is NewsFilterModel ?</p>\n\n<p>What I am trying to achieve is:</p>\n\n<p>NewsFilterModelList</p>\n\n<pre><code>1.Article1\n2.Page1\n3.Article2\n4.Page2\n5.Article3\n6.Page3\n</code></pre>\n\n<p>I've ended this like below: </p>\n\n<pre><code>foreach (var item in pageResult)\n            {\n                resultList.Add(new NewsFilterModel { ArticleDetail = null, Page = item, Date = item.UpdatedOn.ToDateTime() });\n            }\n\n            foreach (var item in tempArticleList)\n            {\n                resultList.Add(new NewsFilterModel { ArticleDetail = item, Page = null, Date = item.LiveDate.ToDateTime() });\n            }\n\n            return resultList.AsEnumerable();\n</code></pre>\n\n<p>Anyone has better idea, please advice.</p>\n"},{"tags":["c#","entity-framework","asp.net-web-api",".net-4.5"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":134,"score":3,"question_id":13077328,"title":"Serialization Issues with Web API and Entity Framework Contract First Many to Many Relationship","body":"<p>I am attempting to use EF with Code First and the Web API.  I don't have any problems until I get into serializing Many-to-Many relationships.  When I attempt to execute the following web api method below I get the following error message:</p>\n\n<pre><code>public class TagsController : ApiController\n{\n\n        private BlogDataContext db = new BlogDataContext();\n\n        // GET api/Tags\n        public IEnumerable&lt;Tag&gt; GetTags()\n        {\n            return db.Tags.AsEnumerable();\n        }\n}\n</code></pre>\n\n<p>I get the following error:</p>\n\n<blockquote>\n  <p>'System.Data.Entity.DynamicProxies.Tag_FF17EDDE6893000F7672649A39962DB0CA591C699DDB73E8C2A56203ED7C7B6D'\n  with data contract name\n  'Tag_FF17EDDE6893000F7672649A39962DB0CA591C699DDB73E8C2A56203ED7C7B6D:http://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies'\n  is not expected. Consider using a DataContractResolver or add any\n  types not known statically to the list of known types - for example,\n  by using the KnownTypeAttribute attribute or by adding them to the\n  list of known types passed to DataContractSerializer.</p>\n</blockquote>\n\n<p>I have read some SO articles (<a href=\"http://stackoverflow.com/questions/11315311/using-navigation-properties-in-entity-framework-code-first\">article 1</a>, <a href=\"http://stackoverflow.com/questions/9071118/efcf-many-to-many-in-a-detached-context\">article 2</a>) that the fix is to add the following attribute:</p>\n\n<blockquote>\n  <p>[DataContract (IsReference=true)]</p>\n</blockquote>\n\n<p>but this has had no effect.  Also using [IgnoreDataMember] does not have an effect.  The only option that does seem to work is to set Configuration.ProxyCreationEnabled to false.  Is this my only option?  Am I missing something?</p>\n\n<p><em><strong>Sample POCO objects:</em></strong></p>\n\n<p><strong>Tag</strong></p>\n\n<pre><code>[DataContract(IsReference = true)]\npublic class Tag\n{\n        public Tag()\n        {\n            this.Blogs = new HashSet&lt;Blog&gt;();\n        }\n\n        [Key]\n        [DataMember]\n        public int Id { get; set; }\n\n        [DataMember]\n        public string Name { get; set; }\n\n        [IgnoreDataMember]\n        public virtual ICollection&lt;Blog&gt; Blogs { get; set; }\n}\n</code></pre>\n\n<p><strong>Blog</strong></p>\n\n<pre><code>[DataContract(IsReference = true)]\npublic class Blog\n{\n    public Blog()\n    {\n        this.Tags = new HashSet&lt;Tag&gt;();\n    }\n\n    [Key]\n    [DataMember]\n    public int Id { get; set; }\n\n    [DataMember]\n    public string Name { get; set; }\n\n    [IgnoreDataMember]\n    public virtual ICollection&lt;Tag&gt; Tags { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework","asp.net-webforms"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13173530,"title":"How to retrieve data from my Entitiy Model in code-behind","body":"<p>I created my tables, then my <code>Entity Model</code> (<code>Model1.edmx</code>).\n<br>I can drag &amp; drop a <code>GridView</code> and <code>EntityDataSource</code> control, they work fine.</p>\n\n<p>but I need to use my data model in code-behind. \n<br>I should be able to query a single record.\n<br>For example, in <code>Page_Load</code> event I want to fill the textboxes with specific record.</p>\n\n<p>I don't know where to begin with, the namespaces, instantiating the object etc. Any help is appreciated.</p>\n\n<p>I'm using <code>WebForms</code>(c#) with <code>EntityFramework</code></p>\n"},{"tags":["linq","entity-framework","sorting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13273325,"title":"linq orderby first item in collection","body":"<p>How do you do OrderBy on a collection within an entity?</p>\n\n<p>For example, this sorts Customers by Name (string)</p>\n\n<pre><code>entities.Customers.OrderBy(c =&gt; c.Name) ...\n</code></pre>\n\n<p>If Customer had an Orders property that was a collection of Order entities and for some reason you wanted to sort Customers on that (lets say by order date), can you do that?</p>\n\n<pre><code>entities.Customers.OrderBy(c =&gt; c.Orders.?)\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13232660,"title":"Concurrency issues with EF5 / Base Repository","body":"<p>I've finished writing a new application which has now been deployed into the live environment however my global error handler is picking up these exceptions several times throughout the day. These errors come in batches and are one of the four in bold. </p>\n\n<p>MVC 4, IIS 6, Windows Server 2003, .Net .4.0, EF 5 (latest from NuGet)</p>\n\n<p><strong>The type 'ARandomModelInMyContext’ has been mapped more than once.</strong></p>\n\n<p><strong>Index was out of range. Must be non-negative and less than the size of the collection.</strong> </p>\n\n<pre><code>Parameter name: index\nSystem.ThrowHelper.ThrowArgumentOutOfRangeException() at System.Data.Metadata.Edm.MetadataCollection`1.get_Item(Int32 index) at System.Data.Mapping.DefaultObjectMappingItemCollection.ContainsMap(GlobalItem cspaceItem, ObjectTypeMapping&amp; map) at\n</code></pre>\n\n<p><strong>The context cannot be used while the model is being created.</strong></p>\n\n<pre><code>System.Data.Entity.Internal.LazyInternalContext.InitializeContext() at System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType) at System.Data.Entity.Internal.Linq.InternalSet`1.Initialize()\n</code></pre>\n\n<p><strong>The underlying provider failed on Open. The connection was not closed. The connection's current state is connecting.</strong></p>\n\n<p>The structure of the application is a pretty standard MVC4 application with a Service Layer and a repository layer.</p>\n\n<ul>\n<li>A service creates a repo in the constructor </li>\n<li>Repository creates a new Context in the repository constructor like so:</li>\n</ul>\n\n<p><code>public class MyRepository : BaseRepository&lt;MyModel&gt;, IMyRepository</code></p>\n\n<p>With the constructor:</p>\n\n<pre><code>public MyRepository() : base(new MyEntities())\n{\n}\n</code></pre>\n\n<p>Base Repository looks like this:</p>\n\n<pre><code>public class BaseRepository&lt;TEntity&gt; where TEntity : class\n{\n    internal CRMEntities Context;\n    internal DbSet&lt;TEntity&gt; dbSet;\n    public BaseRepository(MyEntities context)\n    {\n        this.Context = context;\n        dbSet = context.Set&lt;TEntity&gt;();\n    }\n}\n</code></pre>\n\n<p>There shouldn't be any concurrency issues as I'm not making directly using any threading or async.</p>\n\n<p>Any ideas? Can my repository structure be improved? I've made all the constructors DI-able however I'm not using an IoC container yet.</p>\n\n<p>Would wrapping the construction of the Context in the repository in lock be worth while? For example:  </p>\n\n<pre><code>public class BaseRepository&lt;TEntity&gt; where TEntity : class\n{\n    internal MyEntities Context;\n    internal DbSet&lt;TEntity&gt; dbSet;\n    private static object _lock = new object();\n\n    public BaseRepository(MyEntities context)\n    {\n        lock (_lock)\n        {\n            this.Context = context;\n            dbSet = context.Set&lt;TEntity&gt;();\n        }\n    }\n }\n</code></pre>\n"},{"tags":["c#","asp.net","visual-studio-2008","entity-framework"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":10580,"score":2,"question_id":1562807,"title":"Entity framework with \"Group By\" and/or \"Order by\"","body":"<p>Say we've got a project that allows user to download things. On the main page, I want to show the Most downloaded files ordered by the number of download! All that using EF.</p>\n\n<p>How can i do this !! I've tried many things with Group By (Its a nightmare when you've got a lot of informations in an object). And i still dunno how to do this...</p>\n\n<pre><code>var query = from details in m_context.TransactionDetails\n                        where details.Chanson != null\n                        group details by details.Items into AnItem\n                        orderby AnItem.Count()\n                        select new Item() {\n                            IdItem = Chansons.Key.IdItem,\n                            ItemState= Chansons.Key.ItemState,\n                            [...This object got something like 20 including links to other objects ... ]\n                        };\n</code></pre>\n\n<p>Anyone have an idea?</p>\n\n<p>Thanks :o)</p>\n\n<p>Oh and sorry for my english, I'm giving my best but im from Quebec (Usualy talk french).</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":10687261,"title":"change t4template to add Long Description","body":"<p>I use a t4template to create the C# classes for the entities. One thing missing in these generated classes is de documentation that I enter in the Entity Framework designer.</p>\n\n<p>Does anyone know which statement I can use to add the Long Description of a property to the generated code?</p>\n"},{"tags":["c#",".net","wpf","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":22,"down_vote_count":1,"view_count":4645,"score":21,"question_id":6089403,"title":"Delete all entities in Entity Framework","body":"<p>I want to delete content of all tables (all entities using Entity Framework 4+).\nHow can this be done?</p>\n\n<p>Thanks, James</p>\n"},{"tags":["entity-framework","join","linq-to-entities","entity-framework-4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13272945,"title":"Join in Linq-To-Entities when no ID properties available","body":"<p>Given an <code>Order</code> entity with many <code>OrderItem</code>s, whereas each has a <code>Discount</code>, we are trying to retrieve all Orders with at least one discount that is more than <code>50%</code> by joining orders and order items.</p>\n\n<p>There are a lot of articles about joining two entities in Linq-To-Entities, but they have all in common that they rely on the Foreign Key being exposed as a navigation property:</p>\n\n<pre><code>db.Orders.Join(\n    db.OrderItems.Where(i =&gt; i.Discount &gt; 50),\n    o =&gt; o.Id,\n    i =&gt; i.OrderId)\n</code></pre>\n\n<p>However, our <code>OrderItem</code>does not have an <code>OrderId</code> property. The <code>Order</code> has a <code>OrderItems</code> property to identify the relationship, the foreign key is managed by EF4.1 CodeFirst.</p>\n\n<p><strong>Question:</strong> Is there a way to perform a join by indicating <code>o =&gt; o.OrderItems</code> for identifying the relationship and have EF figure out which FK to use for the join?</p>\n\n<hr>\n\n<p>On the background: We have tried to use <code>.Any</code> no the <code>OrderItems</code> but <strong>DevArt dotConnect</strong> has a breaking issue with that:</p>\n\n<pre><code>db.Orders.Where(o =&gt; o.OrderItems.Any(i =&gt; i.Discount &gt; 50))\n</code></pre>\n"},{"tags":["c#",".net","entity-framework",".net-assembly"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13271262,"title":"Entity Framework meta data","body":"<p>I have a piece of code</p>\n\n<pre><code> using (InContext inContext = new InContext())\n</code></pre>\n\n<p>When I right click the definition, it points to <code>C:\\Users\\me\\AppData\\Local\\Temp\\....</code></p>\n\n<p>What is that? A defined dll?</p>\n\n<pre><code>    #region Assembly SharedObjects.dll, v4.0.30319\n   // C:\\source\\blah\\blah\\packages\\SharedObjects.1.0.4659.22817\\lib\\net40\\SharedObjects.dll\n    #endregion\n\n   using blahSharedObjects;\n   using System;\n   using System.Data.Entity;\n\n   namespace something\n   {\n       public class InContext : DbContext\n   {\n       public InContext();\n       public InContext(string connectionString);\n\n\n        public DbSet&lt;InDetails&gt; InDetailRecords { get; set; }\n        public string IPAddress { get; set; }\n\n        public string UserName { get; set; }\n\n   }\n</code></pre>\n\n<p>}</p>\n"},{"tags":["entity-framework","dynamic-data"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12724354,"title":"Error in Using Dynamic Data Entities WebSite in VS2012","body":"<p>I decided to use Dynamic Data Entities website in vs2012.\nSo, I created this website,then added App_Code directory and added a new edmx to it and named it myDB.edmx. After that I uncommented the code line in global.asax which registers the entity context :</p>\n\n<pre><code>DefaultModel.RegisterContext(typeof(myDBEntities), new ContextConfiguration() { ScaffoldAllTables = true });\n</code></pre>\n\n<p>But when I run the website this error occurs :</p>\n\n<pre><code>The context type 'myDBEntities' is not supported.\n</code></pre>\n\n<p>how can I fix it?</p>\n\n<p>p.s: You now there are some differences between using L2S by Dynamic Data L2S website AND using entity framework by Dynamic Data Entities website.</p>\n"},{"tags":["performance","entity-framework","generics","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13270418,"title":"Generics around Entityframework DbContext causes performance degradation?","body":"<p>I wrote a simple import/export application that transforms data from source->destination using EntityFramework and AutoMapper. It basically:</p>\n\n<ol>\n<li><strong>selects</strong> <code>batchSize</code> of records from the source table</li>\n<li>'<strong>maps</strong>' data from source->destination entity</li>\n<li><strong>add</strong> new destination entities to destination table and <strong>saves</strong> context</li>\n</ol>\n\n<p>I move around <em>500k records in under 5 minutes</em>. After I <em>refactored</em> the code <em>using generics</em> the performance <em>drops drastically to 250 records in 5 minutes.</em></p>\n\n<p><strong>Are my delegates that return <code>DbSet&lt;T&gt;</code> properties on the <code>DbContext</code> causing these problems? Or is something else going on?</strong></p>\n\n<h1>Fast non-generic code:</h1>\n\n<pre><code>public class Importer\n{        \n    public void ImportAddress()\n    {\n        const int batchSize = 50;\n        int done = 0;\n        var src = new SourceDbContext();\n\n        var count = src.Addresses.Count();\n\n        while (done &lt; count)\n        {\n            using (var dest = new DestinationDbContext())\n            {\n                var list = src.Addresses.OrderBy(x =&gt; x.AddressId).Skip(done).Take(batchSize).ToList();\n                list.ForEach(x =&gt; dest.Address.Add(Mapper.Map&lt;Addresses, Address&gt;(x)));\n\n                done += batchSize;\n\n                dest.SaveChanges();\n            }\n        }\n\n        src.Dispose();\n    }\n}\n</code></pre>\n\n<h1>(Very) slow generic code:</h1>\n\n<pre><code>public class Importer&lt;TSourceContext, TDestinationContext&gt;\n    where TSourceContext : DbContext\n    where TDestinationContext : DbContext\n{\n    public void Import&lt;TSourceEntity, TSourceOrder, TDestinationEntity&gt;(Func&lt;TSourceContext, DbSet&lt;TSourceEntity&gt;&gt; getSourceSet, Func&lt;TDestinationContext, DbSet&lt;TDestinationEntity&gt;&gt; getDestinationSet, Func&lt;TSourceEntity, TSourceOrder&gt; getOrderBy) \n        where TSourceEntity : class\n        where TDestinationEntity : class\n    {\n        const int batchSize = 50;\n        int done = 0;\n        var ctx = Activator.CreateInstance&lt;TSourceContext&gt;();\n        //Does this getSourceSet delegate cause problems perhaps?\n\n        //Added this\n        var set = getSourceSet(ctx);\n\n        var count = set.Count(); \n\n        while (done &lt; count)\n        {\n            using (var dctx = Activator.CreateInstance&lt;TDestinationContext&gt;())\n            {\n                var list = set.OrderBy(getOrderBy).Skip(done).Take(batchSize).ToList(); \n                //Or is the db-side paging mechanism broken by the getSourceSet delegate?\n                //Added this\n                var destSet = getDestinationSet(dctx);\n                list.ForEach(x =&gt; destSet.Add(Mapper.Map&lt;TSourceEntity, TDestinationEntity&gt;(x)));\n\n                done += batchSize;\n                dctx.SaveChanges();\n            }\n        }\n\n        ctx.Dispose();\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","entity-framework","objectcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13260422,"title":"ObjectContext Error in Dev but Not when Published","body":"<p>Given the classes below, firing up the website in Visual Studio gives me the following error when <code>home/index</code> is called (this is actually the inner exception).</p>\n\n<p><code>A transport-level error has occurred when receiving results from the server. (provider: Shared Memory Provider, error: 0 - The handle is invalid.)</code></p>\n\n<pre><code>at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\nat System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\nat System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\nat System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error)\nat System.Data.SqlClient.TdsParserStateObject.ReadSni(DbAsyncResult asyncResult, TdsParserStateObject stateObj)\nat System.Data.SqlClient.TdsParserStateObject.ReadNetworkPacket()\nat System.Data.SqlClient.TdsParserStateObject.ReadBuffer()\nat System.Data.SqlClient.TdsParserStateObject.ReadByte()\nat System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\nat System.Data.SqlClient.SqlDataReader.ConsumeMetaData()\nat System.Data.SqlClient.SqlDataReader.get_MetaData()\nat System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\nat System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\nat System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\nat System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\nat System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\nat System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\nat System.Data.Common.DbCommand.ExecuteReader(CommandBehavior behavior)\nat System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior)\n</code></pre>\n\n<p>However if I publish the exact same code locally and hit the site using WebMatrix, it works fine.</p>\n\n<p>I'm using SQL Server 2008 Express too if that makes a difference. Please advise if any more information is needed.</p>\n\n<p>Controller</p>\n\n<pre><code>public class HomeController : BaseController\n{\n    public ActionResult Index()\n    {\n        var candidates = BusinessObj.AllOf&lt;Candidate&gt;().ToList();\n        return View(candidates);\n    }\n}\n</code></pre>\n\n<p>BaseController</p>\n\n<pre><code>public class BaseController : Controller\n{\n    protected ITestBusinessObject BusinessObj { get; set; }\n\n    public BaseController()\n    {\n        BusinessObj = new Business.TestBusinessObj();\n    }\n}\n</code></pre>\n\n<p>TestBusinessObj (Entities is an EF edmx class)</p>\n\n<pre><code>public class TestBusiness : ITestBusinessObject\n{\n    private Entities DB = new Entities();\n    private string ContainerName = \"Entities\";\n\n    public IEnumerable&lt;T&gt; AllOf&lt;T&gt;() where T : class, new()\n    {\n        return DB.CreateObjectSet&lt;T&gt;(ContainerName.GetEntitySetName&lt;T&gt;());\n    }\n\n    private static string GetEntitySetName&lt;T&gt;(this string containerName) where T : new()\n    {\n        var name = new T().GetType().Name;\n        if (name.EndsWith(\"y\"))\n        {\n            name = name.Substring(0, name.Length - 1) + \"ies\";\n        }\n        else\n        {\n            name = name + \"s\";\n        }\n        return string.Format(\"{0}.{1}\", containerName, name);\n    }\n}\n</code></pre>\n"},{"tags":["c#","linq","entity-framework","c#-4.0","linq-to-sql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13269559,"title":"How to Group By multiple records according some criteria","body":"<p>please consider this scenario:</p>\n\n<p>I have data like this :</p>\n\n<pre><code> Id          Group            Value\n -----------------------------------\n 1            1                100\n 2            1                120\n 3            1                100\n 4            2                90\n 5            2                105\n 6            3                300\n 7            4                123\n 8            4                110\n 9            5                100\n 10           5                110\n</code></pre>\n\n<p>I want to do <code>GroupBy</code> on this data as <code>1,2,3</code> place in one group and <code>4,5</code> place in another group. How I can do this with <code>LINQ</code>?</p>\n\n<p>thanks</p>\n\n<hr>\n\n<p><strong>Edit 1)</strong></p>\n\n<p>I want to place <code>1,2,3</code> in one group and <code>4,5</code> in another group and perform <code>Count</code> aggregation on them and I get <strong>6</strong> for first group and <strong>4</strong> for secnd group</p>\n"},{"tags":["entity-framework","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":697,"score":1,"question_id":2630045,"title":"ADO.NET Entity Framework: Can I have multiple entity types for the same row","body":"<p>I have a base class Participants inherited by Artist, Author and TextWriter.\nI have only one table in the data store:\nParticipants {\n    ID,\n    FirstName,\n    LastName,\n    IsArtist,\n    IsAuthor,\n    IsTextWriter,\n}\nThe idea is to have a class for all the roles that a participant can have.</p>\n\n<p>I've managed to create the edmx file but when I try to get an Participant (as Artist) that is also an Author I receive the following error:</p>\n\n<p>All objects in the EntitySet 'Participants' must have unique primary keys. However, an instance of type 'Artist' and an instance of type 'Author' both have the same primary key value, 'EntitySet=Participants;ID=1'.</p>\n\n<p>Thank you</p>\n"},{"tags":["wpf","entity-framework","async-await"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13249086,"title":"async-await issue in EF 6","body":"<p>I'm trying async-await programming with entity-framework 6 (code first) + WPF and I can't see why the UI still freezes after I made the code asynchronous.\nHere is what I'm doing from the very first line:</p>\n\n<p>first there is an event handler responding to a click button:</p>\n\n<pre><code>private async void LoginButton_Click(object sender, RoutedEventArgs e) {\n  if (await this._service.Authenticate(username.Text, password.Password) != null)\n    this.Close();\n}\n</code></pre>\n\n<p>Then I have the Authenticate method in my service layer:</p>\n\n<pre><code>public async Task&lt;User&gt; Authenticate(string username, string password) {\n  CurrentUser = await this._context.GetUserAsync(username.ToLower().Trim(), password.EncryptPassword());\n  return CurrentUser;\n}\n</code></pre>\n\n<p>and at the end is the EF code in the context:</p>\n\n<pre><code>public async Task&lt;User&gt; GetUserAsync(string username, string password) {\n  return await this.People.AsNoTracking().OfType&lt;User&gt;().FirstOrDefaultAsync(u =&gt; u.Username == username &amp;&amp; u.Password == password);\n}\n</code></pre>\n\n<p><strong>Update:</strong> After some tracing the cause of UI freezing turned out to be the initialization process. UI thread blocks until the EF context is initialized and once that is done the actual querying/saving process is performed asynchronously. </p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13253315,"title":"Entity Framework does not generate association property","body":"<p>So.</p>\n\n<p>I'm having trouble fixing this little problem.</p>\n\n<p>I have several classes, and it's all nice and good. Right up until now. I have now added another class (MatchResult), and it works. \n<img src=\"http://i.stack.imgur.com/QYrFi.png\" alt=\"Before\"></p>\n\n<p>But when I try to make the correct association: </p>\n\n<p><img src=\"http://i.stack.imgur.com/ojGaq.png\" alt=\"enter image description here\"></p>\n\n<p>It fails with a runtime exception.</p>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>Schema specified is not valid. Errors: </p>\n  \n  <p>The relationship 'DbModel.FK_ProductPrice' was not loaded\n  because the type 'DbModel.Product' is not available.</p>\n  \n  <p>The following information may be useful in resolving the previous\n  error:</p>\n  \n  <p>The required property 'MatchResults' does not exist on the type\n  'PriceMonitor.Model.Product'.</p>\n  \n  <p>The relationship 'DbModel.FK_WebshopProduct' was not loaded\n  because the type 'DbModel.Product' is not available.</p>\n  \n  <p>The following information may be useful in resolving the previous\n  error:</p>\n  \n  <p>The required property 'MatchResults' does not exist on the type\n  'PriceMonitor.Model.Product'.</p>\n</blockquote>\n\n<p>It seems - for some reason - that EF does not create the MatchResults property on the Product class.</p>\n\n<p>This approach has worked on every single class I've ever made using EF. Up until now.</p>\n"},{"tags":["entity-framework","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13269996,"title":"Stored procedure arguments that doesn't map to object","body":"<p>I have an entity model, that updates with a stored procedure.\nOn of the arguments is the current username, and this is not included in the model.\nThe procedure accepts it as a blank, so in essence, I don't need to use it.\nBUT, in my function mapping, I can't see to just leave it blank. Atleast, my entity model will complain about it later.</p>\n\n<p>How do I handle cases like this?</p>\n"},{"tags":["c#","entity-framework","generics","types"],"answer_count":2,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":53,"score":5,"question_id":13269002,"title":"Getting List of Objects by a type given by a string","body":"<p>I get objects by</p>\n\n<pre><code>IEnumerable&lt;ObjectStateEntry&gt; om = context.ObjectStateManager.GetObjectStateEntries(System.Data.EntityState.Modified);        \n</code></pre>\n\n<p>How can I get a <code>List</code> of the objects with a type given by a string?</p>\n\n<pre><code>Type typ = Type.GetType(\"mytype\");\nvar om2 = om.Select(s =&gt; s.Entity).OfType&lt;typ&gt;(); // does not work\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-4","ef-code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":38,"score":2,"question_id":13268665,"title":"Modify Many-to-Many table Created By EF5 Code First","body":"<p>I have 2 classes and the one is a collection property of the other like below.</p>\n\n<pre><code>public class NotificationMessage\n{\n    public int ID { get; set; }\n    public string Message { get; set; }\n    public virtual ICollection&lt;Device&gt; Devices { get; set; }\n}\n\npublic class Device\n{\n    public int ID  { get; set; }\n    public string Token  { get; set; }\n    public virtual ICollection&lt;NotificationMessage&gt; NotificationMessages { get; set; }\n}\n\npublic class NotificationMessageDevice\n{\n    [Column(Order = 0), Key, ForeignKey(\"NotificationMessage\")]\n    public int NotificationMessageID { get; set; }\n\n    [Column(Order = 1), Key, ForeignKey(\"Device\")]\n    public int DeviceID { get; set; }\n\n\n    public virtual Device Device { get; set; }\n    public virtual NotificationMessage NotificationMessage { get; set; }\n}\n</code></pre>\n\n<p>When you create a relationship like above, the entity flamework is enough clever to create many to many relationship on Database by creating NotificationMessageDevices.</p>\n\n<p>The problem rises in here. Now I want to add CreateDate to the table 'NotificationMessageDevices' . What I have done is that I have created a new class called 'NotificationMessageDevice' in the way entity framework would create the table \"NotificationMessageDevices\" in existing database. I added new properties and called Update-Verbose. The very first exception was about missing ID property it wanted me to add public int ID {get;set;} however when I add this up it realizes the ID property is index property so that I need to remove all the data in that table. </p>\n\n<p>What is the workaround of this case on Entity Framework without data loss :) </p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":160,"score":4,"question_id":12707682,"title":"How to map a stored procedure using DBContext in ASP.NET MVC 3 Entity Framework","body":"<p>I do mapping here for tables.. How to map stored procedures here?</p>\n\n<pre><code>public class AppDBContext : DbContext\n{\n    public DbSet&lt;UserAccount&gt; UserAccount { get; set; }\n    public DbSet&lt;GetUserAccounts&gt; GetGetUserAccounts { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;UserAccount&gt;().ToTable(\"UserAccount\");\n        modelBuilder.Entity&lt;Customer&gt;().ToTable(\"Customer\");\n\n        base.OnModelCreating(modelBuilder);\n    }\n}\n</code></pre>\n"},{"tags":["sql-server","entity-framework","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13265914,"title":"How do I build my EF models so they are based on a stored procedure select","body":"<p>I am completely new to EF and a bit lost, to be honest.\nI have an existing database, and everything is going through stored procedures. Even the selects are stored procedures. \nMy model needs to use this, but I have no idea how to begin.\nI assume I can really use the auto-generate, if the objects are to be based on the stored procedures output, instead of the tables.</p>\n\n<p>I have tried googling, but to be honest, I don't think I know what to look for.</p>\n\n<p>If I create an empty entity framework model, and build all the objects myself, can I somehow get the data by executing a stored procedure instead of mapping directly to a table?</p>\n\n<p>And how do I do this? \nAny articles I need to read? My searching seems to always end up with fancy auto-generation articles, that seems to not apply in my case.</p>\n\n<p>I know this is kind of a broad question, but I am somewhat lost here. Any help is much appreciated.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>So, I have learnt that I can create a complex type, based on the stored select. But, I don't really see a way, to map update/insert/delete procedures onto this. I don't really understand how to link the entity type and the complex type together, if that is even possible or the way to do it.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13264676,"title":"Code first Type per hierarchy","body":"<p>I use EF 5 with the code first approach. Now I try to define a \"code\" table in which I want to have several different codes (like address code, medium code, etc.). In this table I just have the following properties: ID (Guid), Name (String), Description (String) and a discriminator (in this case something like the type of the code: address code, medium code, etc.).</p>\n\n<p>So I defined the following base class:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public abstract class Code : EntityBase\n{\n    public string Name { get; set; }\n    public string Beschreibung { get; set; }\n}\n</code></pre>\n\n<p>Then I derived two classes from code</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class AddressCode : Code {}\npublic class MediumCode : Code {}\n</code></pre>\n\n<p>The class EntityBase is abstract and just defines the Id property, we use it for every POCO class...</p>\n\n<p>The goal is that I can use AddressCode as a property on my address POCO class:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class Adresse : EntityBase\n{\n    #region Properties\n    public string Name1 { get; set; }\n\n    public virtual AddressCode AddressCode { get; set; }\n    #endregion\n}\n</code></pre>\n\n<p>The question now is, how can I explain EF how to do that? Anyone can help?</p>\n\n<p>Thanks\nMarco</p>\n\n<hr>\n\n<p>Thanks for your answer!</p>\n\n<p>I tried to do it like you said. Unfortunately I get an error because of my EntityBase class:</p>\n\n\n\n<pre><code>public abstract class EntityBase\n{\n    #region Properties\n\n    public virtual Guid Id { get; set; }\n\n    public virtual bool IsValid\n    {\n        get\n        {\n            {\n                return Validate();\n            }\n        }\n    }\n\n    [NotMappedAttribute]\n    public virtual IList&lt;ValidationFailure&gt; ValidationFailures { get; set; }\n\n    #endregion\n\n    #region Methods\n\n    private bool Validate()\n    {\n        var validatorFactory = new AttributedValidatorFactory();\n        IValidator validator = validatorFactory.GetValidator(GetType());\n\n        if (validator == null)\n        {\n            return true;\n        }\n\n        ValidationResult validationResult = validator.Validate(this);\n\n        ValidationFailures = validationResult.Errors;\n\n        return validationResult.IsValid;\n    }\n\n    #endregion\n}\n</code></pre>\n\n<p>The error message is:\nYou cannot use Ignore method on the property 'ValidationFailures' on type 'Entities.AdresseCode' because this type inherits from the type 'Entities.EntityBase' where this property is mapped. To exclude this property from your model, use NotMappedAttribute or Ignore method on the base type.</p>\n\n<p>As you can see I already defined the property ValidationFailures as NotMapped but still I get this error.. Do you have an idea?</p>\n\n<p>Thanks\nMarco</p>\n"},{"tags":["c#","sql-server","entity-framework","extended-properties"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13268446,"title":"Get Extended Property in edmx modeling Db","body":"<p>I have a database modelling by Entity Framework. I need to read the extended properties of each table through the object context associated to my Db. How can i do?</p>\n\n<p>Thank's in advance</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","automapper"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13266570,"title":"Automapper - Returning right value but not mapping","body":"<p>In my MVC webapplication I got the following automapper code:</p>\n\n<p><strong>The configure:</strong></p>\n\n<pre><code> public static void Configure()\n        {\n            Mapper.CreateMap&lt;string, List&lt;Ruimte&gt;&gt;().ConvertUsing&lt;StringCombinatieRuimtesConverter&gt;();\n        }\n</code></pre>\n\n<p><strong>The custom converter:</strong></p>\n\n<pre><code>public class StringCombinatieRuimtesConverter : ITypeConverter&lt;string, List&lt;Ruimte&gt;&gt;\n    {\n        #region Implementation of ITypeConverter&lt;in string,out List&lt;Ruimte&gt;&gt;\n\n        public List&lt;Ruimte&gt; Convert(ResolutionContext context)\n        {\n            if (context.SourceValue == null)\n            {\n                return new List&lt;Ruimte&gt;();\n            }\n\n            return context.SourceValue.ToString().Split(',').Select(r =&gt; new Ruimte { Id = int.Parse(r) }).ToList();\n        }\n\n        #endregion\n    }\n</code></pre>\n\n<p><strong>And I call it with the following code:</strong></p>\n\n<pre><code>            var ruimteList = new List&lt;Ruimte&gt;();\n\n            // Update the CombinatieVan\n            Mapper.Map(command.CombinatieRuimteVan, ruimteList);\n</code></pre>\n\n<p>If I debug the command.CombinatieRuimteVan is: 2,3,4,6. This is fine.\nNow if I debug the converter it does return 4 objects of the class \"Ruimte\" with as Id the numbers stated before. But after the Mapper.Map method is done the \"ruimteList\" is still an empty list.</p>\n\n<p>Does anyone know what is going wrong here? The automapper works fine on another spot in my application where I automap a whole entity containing the \"CombinatieRuimteVan\" set. But when I sololy convert the string to the list it doesn't seem to work.</p>\n"},{"tags":["asp.net","entity-framework","linq-to-sql","linq-to-entities","entity-relationship"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13261680,"title":"Insert record using entity Framework (database first)","body":"<p>there are 3 database tables (movies, reviews, users)</p>\n\n<p>the reviews table include ( MemeberID, MovieID, Review Text, Rate, ReviewDate)\n(the MemeberID, and MovieID in the Review are the FK of the members table and the movies table)\nThe Movie can have many reviews, and i'm trying to add review to a movie</p>\n\n<p>even I have movie class and the member class,  I have a problem, in order to insert review, i need to reference it to movie and users , link them, and i don't know how to do it</p>\n\n<p><strong>this code make a error:</strong></p>\n\n<pre><code>\" The relationship between the two objects cannot be defined because they are attached to different ObjectContext objects. \"\n</code></pre>\n\n<p>This is my code...</p>\n\n<pre><code>public bool InsertNewReview(Movie _TheMovie, Member _TheMember, string _Text, byte _Rate, DateTime _ReviewDate)\n    {\n\n       Review ReviewToInsert = new Review()\n            {\n                MovieID = _TheMovie.MovieID,\n                MemberID = _TheMember.MemberID,\n                Movie = _TheMovie,\n                Member =  _TheMember,\n                Rate = _Rate,\n                ReviewDate = _ReviewDate,\n                ReviewText = _Text\n            };\n\n        videoLib.Reviews.AddObject(ReviewToInsert);\n        videoLib.SaveChanges();\n\n            return true;\n\n    }\n</code></pre>\n\n<p>..</p>\n\n<p><strong>there are more data to insert to the Review class</strong></p>\n\n<p>Images: <a href=\"http://www.gamesff.com/1.png\" rel=\"nofollow\">here</a></p>\n\n<p>..</p>\n\n<p><strong>and the tables:</strong> (the \"all columns\" isn't a field in database tables)</p>\n\n<p>Images: <a href=\"http://www.gamesff.com/2.png\" rel=\"nofollow\">here</a></p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13266404,"title":"Entity framework: automatic deletion of parent entity","body":"<p>Consider the following model classes:</p>\n\n<pre><code> public class Thing\n{\n    public int Id { get; set; }\n    [Required]\n    public Text Subject { get; set; }\n    [Required]\n    public Text Body { get; set; }\n}\n\npublic class Text\n{\n    public int Id { get; set; }\n    public string Value { get; set; }\n}\n</code></pre>\n\n<p>The model is simple - each Thing must reference to two Text entities. Each Text entry at any point in time should be referenced only by a single entity of any other type (Thing is not the only one).</p>\n\n<p>Is it possible to configure EF5 to automatically delete all referenced Texts when Thing gets deleted (via <code>context.Set&lt;Thing&gt;().Remove</code>), or should it be done with a database trigger?</p>\n"},{"tags":["c#","entity-framework","ado.net"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13263557,"title":"db.savechanges() is not working","body":"<p>I'm following this tutorial <a href=\"http://msdn.microsoft.com/en-us/data/ff706685.aspx\" rel=\"nofollow\">Creating Master-Details Windows Forms with the Entity Framework</a>\nbut the <code>db.Savechanges()</code> isn't working if I modified some column or add a new row. According to this video tutorial it will work but it doesn't.</p>\n\n<p><b>Product_Form.cs</b></p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Drawing;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Windows.Forms;\n\nnamespace RemoteSynchronizer\n{\n    public partial class Product : Form\n    {\n\n        ProductsEntities db = new ProductsEntities();\n        public Product()\n        {\n            InitializeComponent();\n        }\n\n        private void Product_Form_Load(object sender, EventArgs e)\n        {\n            product_DBindingSource.DataSource = db.Product_D.ToList();\n        }\n\n        private void bindingNavigatorAddNewItem_Click(object sender, EventArgs e)\n        {\n\n        }\n\n        private void product_DBindingNavigatorSaveItem_Click(object sender, EventArgs e)\n        {\n            // Product_D obj = new Product_D();\n            // obj.PCode = pCodeTextBox.Text;\n            // obj.Name = nameTextBox.Text;\n            // obj.Batch = batchTextBox.Text;\n            // obj.Expiry = expiryTextBox.Text;\n            // obj.Price = priceTextBox.Text;\n\n            //try\n            // {\n            //     Product_D temp = db.Product_D.Single(t =&gt; t.PCode == pCodeTextBox.Text);\n\n            //     MessageBox.Show(\"Product Exists\");\n            // }\n            // catch \n            // {\n            //     db.Product_D.Add(obj);\n                 db.SaveChanges();\n\n             //}\n\n        }\n\n        private void bindingNavigatorDeleteItem_Click(object sender, EventArgs e)\n        {\n\n        }\n\n    }\n}\n</code></pre>\n\n<p>When I try to use comment method in code it gives an error</p>\n\n<p><b>Error</b></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>************** Exception Text **************\nSystem.Data.Entity.Infrastructure.DbUpdateException: Unable to update the EntitySet 'Product_D' because it has a DefiningQuery and no &lt;InsertFunction&gt; element exists in the &lt;ModificationFunctionMapping&gt; element to support the current operation. ---&gt; System.Data.UpdateException: Unable to update the EntitySet 'Product_D' because it has a DefiningQuery and no &lt;InsertFunction&gt; element exists in the &lt;ModificationFunctionMapping&gt; element to support the current operation.\n   at System.Data.SqlClient.SqlGen.DmlSqlGenerator.ExpressionTranslator.Visit(DbScanExpression expression)\n   at System.Data.Common.CommandTrees.DbScanExpression.Accept(DbExpressionVisitor visitor)\n   at System.Data.SqlClient.SqlGen.DmlSqlGenerator.GenerateInsertSql(DbInsertCommandTree tree, SqlVersion sqlVersion, List`1&amp; parameters)\n   at System.Data.SqlClient.SqlGen.SqlGenerator.GenerateSql(DbCommandTree tree, SqlVersion sqlVersion, List`1&amp; parameters, CommandType&amp; commandType, HashSet`1&amp; paramsToForceNonUnicode)\n   at System.Data.SqlClient.SqlProviderServices.CreateCommand(DbProviderManifest providerManifest, DbCommandTree commandTree)\n   at System.Data.SqlClient.SqlProviderServices.CreateCommand(DbCommandTree commandTree)\n   at System.Data.Mapping.Update.Internal.UpdateTranslator.CreateCommand(DbModificationCommandTree commandTree)\n   at System.Data.Mapping.Update.Internal.DynamicUpdateCommand.CreateCommand(UpdateTranslator translator, Dictionary`2 identifierValues)\n   at System.Data.Mapping.Update.Internal.DynamicUpdateCommand.Execute(UpdateTranslator translator, EntityConnection connection, Dictionary`2 identifierValues, List`1 generatedValues)\n   at System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager stateManager, IEntityAdapter adapter)\n   at System.Data.EntityClient.EntityAdapter.Update(IEntityStateManager entityCache)\n   at System.Data.Objects.ObjectContext.SaveChanges(SaveOptions options)\n   at System.Data.Entity.Internal.InternalContext.SaveChanges()\n   --- End of inner exception stack trace ---\n   at System.Data.Entity.Internal.InternalContext.SaveChanges()\n   at System.Data.Entity.Internal.LazyInternalContext.SaveChanges()\n   at System.Data.Entity.DbContext.SaveChanges()\n   at RemoteSynchronizer.Product.product_DBindingNavigatorSaveItem_Click(Object sender, EventArgs e) in e:\\Study\\Project\\RemoteSynchronizer\\RemoteSynchronizer\\Product_Form.cs:line 50\n   at System.Windows.Forms.ToolStripItem.RaiseEvent(Object key, EventArgs e)\n   at System.Windows.Forms.ToolStripButton.OnClick(EventArgs e)\n   at System.Windows.Forms.ToolStripItem.HandleClick(EventArgs e)\n   at System.Windows.Forms.ToolStripItem.HandleMouseUp(MouseEventArgs e)\n   at System.Windows.Forms.ToolStripItem.FireEventInteractive(EventArgs e, ToolStripItemEventType met)\n   at System.Windows.Forms.ToolStripItem.FireEvent(EventArgs e, ToolStripItemEventType met)\n   at System.Windows.Forms.ToolStrip.OnMouseUp(MouseEventArgs mea)\n   at System.Windows.Forms.Control.WmMouseUp(Message&amp; m, MouseButtons button, Int32 clicks)\n   at System.Windows.Forms.Control.WndProc(Message&amp; m)\n   at System.Windows.Forms.ScrollableControl.WndProc(Message&amp; m)\n   at System.Windows.Forms.ToolStrip.WndProc(Message&amp; m)\n   at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message&amp; m)\n   at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message&amp; m)\n   at System.Windows.Forms.NativeWindow.Callback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)\n\n\n************** Loaded Assemblies **************\nmscorlib\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.18010 built by: FX45RTMGDR\n    CodeBase: file:///C:/Windows/Microsoft.NET/Framework/v4.0.30319/mscorlib.dll\n----------------------------------------\nRemoteSynchronizer\n    Assembly Version: 1.0.0.0\n    Win32 Version: 1.0.0.0\n    CodeBase: file:///E:/Study/Project/RemoteSynchronizer/RemoteSynchronizer/bin/Debug/RemoteSynchronizer.exe\n----------------------------------------\nSystem.Windows.Forms\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Windows.Forms/v4.0_4.0.0.0__b77a5c561934e089/System.Windows.Forms.dll\n----------------------------------------\nSystem.Drawing\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Drawing/v4.0_4.0.0.0__b03f5f7f11d50a3a/System.Drawing.dll\n----------------------------------------\nSystem\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.18016 built by: FX45RTMGDR\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System/v4.0_4.0.0.0__b77a5c561934e089/System.dll\n----------------------------------------\nSystem.Configuration\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Configuration/v4.0_4.0.0.0__b03f5f7f11d50a3a/System.Configuration.dll\n----------------------------------------\nSystem.Xml\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Xml/v4.0_4.0.0.0__b77a5c561934e089/System.Xml.dll\n----------------------------------------\nSystem.Web\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/System.Web/v4.0_4.0.0.0__b03f5f7f11d50a3a/System.Web.dll\n----------------------------------------\nSystem.Core\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Core/v4.0_4.0.0.0__b77a5c561934e089/System.Core.dll\n----------------------------------------\nEntityFramework\n    Assembly Version: 5.0.0.0\n    Win32 Version: 5.0.20627.0\n    CodeBase: file:///E:/Study/Project/RemoteSynchronizer/RemoteSynchronizer/bin/Debug/EntityFramework.DLL\n----------------------------------------\nSystem.Data.Entity\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Data.Entity/v4.0_4.0.0.0__b77a5c561934e089/System.Data.Entity.dll\n----------------------------------------\nAnonymously Hosted DynamicMethods Assembly\n    Assembly Version: 0.0.0.0\n    Win32 Version: 4.0.30319.18010 built by: FX45RTMGDR\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/mscorlib/v4.0_4.0.0.0__b77a5c561934e089/mscorlib.dll\n----------------------------------------\nAccessibility\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/Accessibility/v4.0_4.0.0.0__b03f5f7f11d50a3a/Accessibility.dll\n----------------------------------------\nSystem.Data\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/System.Data/v4.0_4.0.0.0__b77a5c561934e089/System.Data.dll\n----------------------------------------\nSystem.Transactions\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/System.Transactions/v4.0_4.0.0.0__b77a5c561934e089/System.Transactions.dll\n----------------------------------------\nSystem.Numerics\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Numerics/v4.0_4.0.0.0__b77a5c561934e089/System.Numerics.dll\n----------------------------------------\nSystem.Data.OracleClient\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/System.Data.OracleClient/v4.0_4.0.0.0__b77a5c561934e089/System.Data.OracleClient.dll\n----------------------------------------\nSystem.Xml.Linq\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Xml.Linq/v4.0_4.0.0.0__b77a5c561934e089/System.Xml.Linq.dll\n----------------------------------------\nSystem.EnterpriseServices\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/System.EnterpriseServices/v4.0_4.0.0.0__b03f5f7f11d50a3a/System.EnterpriseServices.dll\n----------------------------------------\nEntityFrameworkDynamicProxies-RemoteSynchronizer\n    Assembly Version: 1.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Data.Entity/v4.0_4.0.0.0__b77a5c561934e089/System.Data.Entity.dll\n----------------------------------------\nSystem.Runtime.Serialization\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Runtime.Serialization/v4.0_4.0.0.0__b77a5c561934e089/System.Runtime.Serialization.dll\n----------------------------------------\nSystem.ComponentModel.DataAnnotations\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.ComponentModel.DataAnnotations/v4.0_4.0.0.0__31bf3856ad364e35/System.ComponentModel.DataAnnotations.dll\n----------------------------------------\nMicrosoft.SqlServer.Types\n    Assembly Version: 11.0.0.0\n    Win32 Version: 2011.0110.2100.060 ((SQL11_RTM).120210-1917 )\n    CodeBase: file:///C:/Windows/assembly/GAC_MSIL/Microsoft.SqlServer.Types/11.0.0.0__89845dcd8080cc91/Microsoft.SqlServer.Types.dll\n----------------------------------------\n\n************** JIT Debugging **************\nTo enable just-in-time (JIT) debugging, the .config file for this\napplication or computer (machine.config) must have the\njitDebugging value set in the system.windows.forms section.\nThe application must also be compiled with debugging\nenabled.\n\nFor example:\n\n&lt;configuration&gt;\n    &lt;system.windows.forms jitDebugging=\"true\" /&gt;\n&lt;/configuration&gt;\n\nWhen JIT debugging is enabled, any unhandled exception\nwill be sent to the JIT debugger registered on the computer\nrather than be handled by this dialog box.\n</code></pre>\n\n<p>How to get rid of this problem? I'm trying to solve this by simple method <code>db.savechanges()</code> but it won't work.</p>\n"},{"tags":["c#","sql-server","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13259655,"title":"Data integrity in Entity Framework","body":"<p>Are there any consensus as to what is considered the best method in always maintaining data integrity in Entity Framework. i.e. when adding or deleting entities, how do I make sure the loaded model is the most recent, and that nothing has changed on the db behind my back?</p>\n\n<p>A rough method that seem to work for me in the majority of cases, is to reload the context between sessions, i.e. not to have a persistent model, and reload/refresh in case of an error. This seems to work in cases of low data clashes, however is very costly when lots of changes happen in different services. Is there a flag to query if the data/row on disk have changed or event to make this refresh automatic, i.e. update any subscribers of certain tables/rows?</p>\n"},{"tags":["entity-framework","dataannotations"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":414,"score":0,"question_id":5591586,"title":"Dataannotation with EF","body":"<p>I have tried Dataannotation as described <a href=\"http://www.briankeating.net/blog/post/2011/02/28/Asp-MVC-Entity-Framework-and-Data-annotations.aspx\" rel=\"nofollow\">http://www.briankeating.net/blog/post/2011/02/28/Asp-MVC-Entity-Framework-and-Data-annotations.aspx</a>. But it does not worked for me. </p>\n\n<p>I have a table with the following structure </p>\n\n<pre><code> Table - Category\n            id int (pk not null)\n            CategoryName varchar(100) (null)\n</code></pre>\n\n<p>I already created my edmx file and all.</p>\n\n<p>I have created the Category.cs file also like below.</p>\n\n<pre><code>    [MetadataType(typeof(CategoryMetaData))]\n    public partial class Category\n    {\n    }\n    public class CategoryMetaData\n    {\n        [Required(ErrorMessage = \"Category Name is required.\")]\n        public object CategoryName;\n    }\n</code></pre>\n\n<p>But my validations are not working.</p>\n\n<p>Is there anything missed?</p>\n"},{"tags":["entity-framework","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13210202,"title":"How to save oldest photo if in form not attached newest file?","body":"<p>I have action method in my controller. If photo is attached in form my method work fine. If photo don't upload from form in Edit action my method to removes oldest photo from database. How to save oldest photo if in form not attached newest file?</p>\n\n<p>Model:</p>\n\n<pre><code>[DisplayColumn(\"LastName\")]\npublic class Driver\n{\n    [Key]\n    public int Id { get; set; }\n\n    [Display(Name=\"Full Name\")]\n    [DataType(DataType.Text)]\n    public string FullName\n    {\n        get { return string.Concat(FirstName.Substring(0, 1), \".\", LastName);}\n    }\n\n    [Required]\n    [Display(Name = \"First Name\")]\n    [DataType(DataType.Text)]\n    public string FirstName { get; set; }\n\n    [Display(Name = \"Middle Name\")]\n    [DataType(DataType.Text)]\n    public string MiddleName { get; set; }\n\n    [Required]\n    [Display(Name = \"Last Name\")]\n    [DataType(DataType.Text)]\n    public string LastName { get; set; }\n\n    public byte[] DriverPhoto { get; set; }\n\n}\n</code></pre>\n\n<p>Controller:</p>\n\n<pre><code>    [HttpPost]\n    public ActionResult Edit(Driver driver, HttpPostedFileBase fileUpload)\n    {\n        if(fileUpload != null)\n        {\n            var binaryReader = new BinaryReader(fileUpload.InputStream);\n            driver.DriverPhoto = binaryReader.ReadBytes(fileUpload.ContentLength);\n        }\n\n        if (ModelState.IsValid)\n        {\n\n            db.Entry(driver).State = EntityState.Modified;\n\n            db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n\n        return View(driver);\n    }\n</code></pre>\n"},{"tags":["entity-framework","concurrency","transactions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13247560,"title":"entity framework concurrency: transactions or concurrency fixed?","body":"<p>I need to make stock control, so I need to ensure that when I modified the amount of product, is doing in the right way. I am using Entity framework 4.0</p>\n\n<p>For example, if I use a transaction, when I load the record from the database, the recored is blocked, so I can substract or add to the loaded amount, the number of items that I need. However, this block the record in the database and perhaps for performance reasons is not the best way. This makes me ask when to use transactions with EF.</p>\n\n<p>The other option is to use the concurrency fixed of entity framework, using a timespan column to detect if the record has been changed. In this case, if the record has been modified between my load and my update, I get the exception of concurrency. But it could occur that in my exception handler, if I update my context with the database data, between my refresh and the savechanges could be changed again.</p>\n\n<p>Other problem is I finally can save the changes. For example, I have 10 units, I need to substract 8 but between my load and my update, other person substract 5 units. If I subtract 8, then in stock I have -3 units. This is not possible. If I have a transaction, I load the record, is blocked, so I can check if I have enough units, if yes, I can subtrack, if not, I send an exception.</p>\n\n<p>So my question is, I know that EF is a transaction by itself, but it exists also transactions in EF, so it would be useful in some cases. When to use EF and cocurrency fixed and when to use transactions?</p>\n\n<p>Thanks.\nDaimroc.</p>\n"},{"tags":["entity-framework","poco","navigation-properties"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":23,"score":0,"question_id":13256412,"title":"Entity Framework POCO - Navigation Property does not refresh","body":"<p>I have an issue with poco classes in EF 4.</p>\n\n<p>I have an Order entity wich contains a foreign key to a Customer entity. </p>\n\n<p>So, the Order class has a navigation property of type Customer.</p>\n\n<p>It's look like this :</p>\n\n<pre><code>public class Order\n{\n     public virtual int Id { get; set; }\n     public virtual CustomerId  { get; set; }\n     public virtual Customer customer { get; set;}\n     …\n}\n</code></pre>\n\n<p>When I load an order, the navigation property customer is correct, but if the CustomerId property changes, the navigation property is not refresh with the new customer.</p>\n\n<p>If I call the DetectChanges() method on the EF context, the navigation property is then refreshed.</p>\n\n<p>I've read that with all properties marked as virtual, the relationship synchronisation is automatic, but it's not the case here.</p>\n\n<p>Where did I go wrong ?</p>\n\n<p>Thanks for any help</p>\n"},{"tags":["oracle","entity-framework","ef-power-tools"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13261018,"title":"Unable to reverse-engineer code-first with EFPowerTools Beta2 VS2012","body":"<p>I want to reverse-engineer code first using PowerTools. It works when I reverse engineer from a local MS-SQL database, but not from Oracle DB. I get the following errors in the output console:</p>\n\n<pre><code>  System.Data.ProviderIncompatibleException: The provider did not return a ProviderManifestToken string. ---&gt; Oracle.DataAccess.Client.OracleException: ORA-1005: null password given; logon denied\n   at Oracle.DataAccess.Client.OracleException.HandleErrorHelper(Int32 errCode, OracleConnection conn, IntPtr opsErrCtx, OpoSqlValCtx* pOpoSqlValCtx, Object src, String procedure, Boolean bCheck)\n   at Oracle.DataAccess.Client.OracleException.HandleError(Int32 errCode, OracleConnection conn, IntPtr opsErrCtx, Object src)\n   at Oracle.DataAccess.Client.OracleConnection.Open()\n   at Oracle.DataAccess.Client.EFOracleProviderServices.GetDbProviderManifestToken(DbConnection connection)\n   at System.Data.Common.DbProviderServices.GetProviderManifestToken(DbConnection connection)\n   --- End of inner exception stack trace ---\n   at System.Data.Common.DbProviderServices.GetProviderManifestToken(DbConnection connection)\n   at System.Data.Entity.Design.EntityStoreSchemaGenerator.GetProviderSchemaMetadataWorkspace(DbProviderServices providerServices, DbConnection providerConnection, Version targetEntityFrameworkVersion)\n   at System.Data.Entity.Design.EntityStoreSchemaGenerator.CreateStoreSchemaConnection(String providerInvariantName, String connectionString, Version targetEntityFrameworkVersion)\n   at System.Data.Entity.Design.SsdlGenerator.EntityStoreSchemaGeneratorDatabaseSchemaLoader.CreateStoreSchemaConnection(String providerInvariantName, String connectionString, Version&amp; storeSchemaModelVersion)\n   at System.Data.Entity.Design.EntityStoreSchemaGenerator..ctor(String providerInvariantName, String connectionString, String namespaceName)\n   at Microsoft.DbContextPackage.Handlers.ReverseEngineerCodeFirstHandler.ReverseEngineerCodeFirst(Project project)\n</code></pre>\n\n<p>I can do normal generation of EF files by right-click project > add > ADO.NET Entity Data Model > choose \"from Existing DB\" and follow the rest of wizard. I like the powertools better though, for several reasons (mostly the mappings as .cs files). Why can I not reverse engineer when using Oracle? TIA</p>\n"},{"tags":["c#","database","entity-framework","ef-code-first","foreign-keys"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":72,"score":3,"question_id":13260306,"title":"Entity Framework 5: Code-First Cyclical Relationship Issues","body":"<p>I understand why EF does not allow \"cyclical references\" in the PK/FK relationships. I am looking for advice on how to alter my model to make the following scenario work.</p>\n\n<h3>Scenario</h3>\n\n<p>Three entities: <code>Employee</code>, <code>Agency</code>, <code>WorkRecord</code>. Their purpose is to log Employee time spent doing work. <code>Employee</code> then contains reference to the <code>Agency</code> he/she is employed by, and his/her <code>WorkRecord</code> contain reference to the <code>Agency</code> the work was done for.</p>\n\n<pre><code>public class Employee\n{\n    [Key]\n    public int Id { get; set; }\n\n    public string Name { get; set; }\n\n    public int AgencyId { get; set; }\n    public virtual Agency Agency { get; set; }\n\n    public virtual IEnumerable&lt;WorkRecord&gt; WorkRecords { get; set; }\n}\n\npublic class Agency\n{\n    [Key]\n    public int Id { get; set; } \n}\n\npublic class WorkRecord\n{\n    [Key]\n    public int Id { get; set; } \n\n    public int Hours { get; set; } \n\n    public int AgencyId { get; set; } \n    public virtual Agency Agency { get; set; } \n\n    public int EmployeeId { get; set; }\n    public virtual Employee { get; set; }\n}\n</code></pre>\n\n<p>Like this, it bitches: <code>FK_dbo.WorkRecords_dbo.Employees_EmployeeId</code> causes a cyclical reference.</p>\n\n<h3>Experiments</h3>\n\n<p>My first thought was because of the bi-directional virtual properties, so I decided to designate one of the two a top-level entity with a 1-way relationship:</p>\n\n<p>First, I designated <code>WorkRecord</code> as a top-level entity and remove the virtual <code>WorkRecords</code> reference reference from the <code>Employee</code> entity... the same message is produced.</p>\n\n<p>Second, I made <code>Employee</code> the top-level entity, leaving its virtual <code>WorkRecords</code> collection, and removing the virtual <code>Employee</code> reference property from the <code>WorkRecord</code> entity... works fine but does not achieve my goal.</p>\n\n<p>After more investigation, I find it is the Agency virtual reference property on both entities that causes the circular reference. If one entity removes this, the <code>Employee</code>/<code>WorkRecord</code> entity relationships work in all directions. </p>\n\n<h3>Question:</h3>\n\n<p>So, clear as i can ask - how can I express this business model, using <code>WorkRecord</code> as my top-level entity, without making EF5 upset?</p>\n"},{"tags":["asp.net","mysql","asp.net-mvc","entity-framework"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1666,"score":2,"question_id":1440496,"title":"Problems publishing website","body":"<p>Recently I've began experimenting with ASP.NET MVC and the Entity Framework. Since my hostingprovider only provides me with MySQL I've been trying to set that up.\nLocally everything works fine, but after I publish it I get the following error:</p>\n\n<pre><code>[ProviderIncompatibleException: The store provider factory type 'MySql.Data.MySqlClient.MySqlClientFactory' does not implement the IServiceProvider interface. Use a store provider that implements this interface.]\n</code></pre>\n\n<p>Since I'm rather inexperienced with the configuring this and google is lacking a good answer I thought I'd try here.\nMy best guess is something missing in the web.config file, but can't really make out what it is. </p>\n\n<p>Any help would be greatly appreciated!</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13256611,"title":"Can I call DbContext.SaveChanges in for loop","body":"<p>I am using EF5 and I am getting an error when I am calling context.SaveChanges in a for loop.</p>\n\n<p>If I am updating any entity, do I need to call SaveChanges to get the updated value of the entity with in the same context.</p>\n\n<p>For example,quantity of one line item is n. In my firts iteration I am reducing the quantity of line item by 1. So now the actual quantity is n-1. I have not yet called SaveChanges on context. In the next iteration for the same line item is the quantity would be n or n-1?</p>\n\n<p>Thanks</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","select","repository","columnname"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13258423,"title":"Column name Entity Framework base Repository","body":"<p><strong>IRepositoryBase</strong></p>\n\n<pre><code>IQueryable&lt;T&gt; GetAll(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null, params Expression&lt;Func&lt;T, object&gt;&gt;[] includes);\n</code></pre>\n\n<p><strong>RepositoryBase</strong></p>\n\n<pre><code> public IQueryable&lt;T&gt; GetAll([OptionalAttribute][DefaultParameterValueAttribute(null)]Expression&lt;Func&lt;T, bool&gt;&gt; predicate, params Expression&lt;Func&lt;T, object&gt;&gt;[] includes)     \n {\n   var set = CreateSet().IncludeMultiple(includes);\n   return (predicate == null) ? set : set.Where(predicate);            \n }\n</code></pre>\n\n<p><strong>IAccountService</strong></p>\n\n<pre><code>IEnumerable&lt;int&gt; GetAllReferenceIds();\n</code></pre>\n\n<p><strong>AccountService</strong></p>\n\n<pre><code>public IEnumerable&lt;int&gt; GetAllReferenceIds()       \n{    \n  var accountOwners = _accountOwnerRepository.GetAll();\n  return accountOwners.Select(m =&gt; m.ReferenceId).ToList();\n}\n</code></pre>\n\n<p><strong>AccountController</strong></p>\n\n<pre><code>public ActionResult ReferenceIdPartial()      \n{\n\nViewData[\"AccountOwners\"] = accountOwnerService.GetAllReferenceIds();\n\nreturn PartialView();\n\n}\n</code></pre>\n\n<p><strong>MVC Partial View</strong> - devexpress combobox mvc extension</p>\n\n<pre><code>settings.Properties.Columns.Add(\"ReferenceId\", \"Reference Id\", Unit.Percentage(100));\n</code></pre>\n\n<p>Error - column ReferenceId Not found</p>\n\n<p>I am sending a collection of int through GetReferenceIds()</p>\n\n<p>Is there a way to call the columns from Controller. Something like  AccountOwner(a=>a.ReferenceIds, select ReferenceIds) - I should be able to get the column name as well as the data. </p>\n\n<p>Thanks for your time. </p>\n"},{"tags":["sql-server","asp.net-mvc","linq","entity-framework","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":175,"score":1,"question_id":12928463,"title":"Sometimes get Timeout expired exception with Linq to EF and after a restart of server, it works fine","body":"<p>I have hosted my website at rackspace cloud server.</p>\n\n<p>Sometimes I get the below exception while fetching records from database. The strange thing is that everything works fine for a few days after a restart and also I get this exception in only a few places and not everywhere.</p>\n\n<pre><code>Exception: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.\n\nException Details: System.Data.SqlClient.SqlException: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\n\nStack Trace:\n\n\n[SqlException (0x80131904): Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.]\n   System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection) +404\n   System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning() +412\n   System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj) +1363\n   System.Data.SqlClient.SqlDataReader.ConsumeMetaData() +59\n   System.Data.SqlClient.SqlDataReader.get_MetaData() +118\n   System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString) +6387937\n   System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async) +6389506\n   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result) +538\n   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method) +28\n   System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method) +256\n   System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior) +19\n   System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior) +553\n\n[EntityCommandExecutionException: An error occurred while executing the command definition. See the inner exception for details.]\n   DataAccessLayer.dbCustomer.CompanyCustomerByLocationId(String sortExpression, Boolean asc, String nameSearchString, Int32 startRowIndex, Int32 maximumRows, Int32&amp; TotalRecord, Int64 companyId) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\DataAccessLayer\\dbCustomer.cs:508\n   BusinessLogic.Customer.CompanyCustomerByLocationId(String sortExpression, Boolean asc, String nameSearchString, Int32 startRowIndex, Int32 maximumRows, Int64 CompanyId) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\BusinessLogic\\Customer.cs:431\n   FutureZoom.Areas.Admin.Controllers.CompanyController.CustomerPaging(Int32 StartIndex, Int32 PageSize, String SortExp, Boolean Asc, String SearchExp, String Where) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\FutureZoom\\Areas\\Admin\\Controllers\\CompanyController.cs:552\n   lambda_method(Closure , ControllerBase , Object[] ) +362\n   System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters) +248\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +39\n   System.Web.Mvc.&lt;&gt;c__DisplayClass15.&lt;InvokeActionMethodWithFilters&gt;b__12() +125\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter(IActionFilter filter, ActionExecutingContext preContext, Func`1 continuation) +640\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodWithFilters(ControllerContext controllerContext, IList`1 filters, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +312\n   System.Web.Mvc.ControllerActionInvoker.InvokeAction(ControllerContext controllerContext, String actionName) +691\n   System.Web.Mvc.Controller.ExecuteCore() +162\n   System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext) +305\n   System.Web.Mvc.&lt;&gt;c__DisplayClassb.&lt;BeginProcessRequest&gt;b__5() +62\n   System.Web.Mvc.Async.&lt;&gt;c__DisplayClass1.&lt;MakeVoidDelegate&gt;b__0() +20\n   System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +469\n   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously) +375\n</code></pre>\n\n<p>My Linq query is mentioned below</p>\n\n<pre><code>query = context.Customers.Include(\"Company\").Include(\"Company.EmailCampaignerStatus\")\n                                           .OrderBy(m =&gt; m.EmailCampaignerStatus.FirstOrDefault().CreatedOn)                                           \n                                           .Where(m =&gt; m.FirstName.StartsWith(name) || m.LastName.StartsWith(name) || m.Email.StartsWith(name) || (m.FirstName + \" \" + m.LastName).StartsWith(name))\n                                           .Where(m =&gt; m.CompanyId == companyId)\n                                           .Where(m =&gt; m.CompanyLocationId == locationId)\n                                           .Skip(startRowIndex == 0 ? startRowIndex : startRowIndex - 1)\n                                           .Take(maximumRows)\n                                           .ToList();\n</code></pre>\n\n<p>Execution time for this query is not even 1 second on my local machine and also the same at server side after a restart but the execution time increases day by day and it fails to execute after few days (sometime fails and sometimes gives result).</p>\n\n<p>I observed that it took 31.05sec and fails and it take 51.09 sec and fails. Sometimes it takes more than 2 mins and gives result.</p>\n\n<p>I talked with rackspace people but they were unable to trace the actual cause for the same.</p>\n\n<p>Edit 1: I have seen below queries in SQL Profiler against my paging query</p>\n\n<pre><code>SELECT \n[Project3].[Id1] AS [Id], \n[Project3].[C1] AS [C1], \n[Project3].[Id] AS [Id1], \n[Project3].[CompanyId] AS [CompanyId], \n[Project3].[CompanyLocationId] AS [CompanyLocationId], \n[Project3].[FirstName] AS [FirstName], \n[Project3].[LastName] AS [LastName], \n[Project3].[Email] AS [Email], \n[Project3].[Address1] AS [Address1], \n[Project3].[Address2] AS [Address2], \n[Project3].[City] AS [City], \n[Project3].[State] AS [State], \n[Project3].[Country] AS [Country], \n[Project3].[Zip] AS [Zip], \n[Project3].[Phone] AS [Phone], \n[Project3].[SaleDate] AS [SaleDate], \n[Project3].[Notes] AS [Notes], \n[Project3].[Cost] AS [Cost], \n[Project3].[CreatedOn] AS [CreatedOn], \n[Project3].[ModifiedOn] AS [ModifiedOn], \n[Project3].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n[Project3].[Id2] AS [Id2], \n[Project3].[SubscriptionTypeId] AS [SubscriptionTypeId], \n[Project3].[PlanFeeAmount] AS [PlanFeeAmount], \n[Project3].[LoginId] AS [LoginId], \n[Project3].[IndustryTypeId] AS [IndustryTypeId], \n[Project3].[CompanyName] AS [CompanyName], \n[Project3].[NumberOfLocations] AS [NumberOfLocations], \n[Project3].[LogoImageName] AS [LogoImageName], \n[Project3].[WebsiteUrl] AS [WebsiteUrl], \n[Project3].[blsActive] AS [blsActive], \n[Project3].[Pending] AS [Pending], \n[Project3].[ExpiryDate] AS [ExpiryDate], \n[Project3].[C2] AS [C2], \n[Project3].[Id3] AS [Id3], \n[Project3].[UploadTicketId] AS [UploadTicketId], \n[Project3].[UploadStatus] AS [UploadStatus], \n[Project3].[CompanyId1] AS [CompanyId1], \n[Project3].[CompanyLocationId1] AS [CompanyLocationId1], \n[Project3].[CustomerId] AS [CustomerId], \n[Project3].[CreatedOn2] AS [CreatedOn1]\nFROM ( SELECT \n    [Limit2].[Id] AS [Id], \n    [Limit2].[CompanyId] AS [CompanyId], \n    [Limit2].[CompanyLocationId] AS [CompanyLocationId], \n    [Limit2].[FirstName] AS [FirstName], \n    [Limit2].[LastName] AS [LastName], \n    [Limit2].[Email] AS [Email], \n    [Limit2].[Address1] AS [Address1], \n    [Limit2].[Address2] AS [Address2], \n    [Limit2].[City] AS [City], \n    [Limit2].[State] AS [State], \n    [Limit2].[Country] AS [Country], \n    [Limit2].[Zip] AS [Zip], \n    [Limit2].[Phone] AS [Phone], \n    [Limit2].[SaleDate] AS [SaleDate], \n    [Limit2].[Notes] AS [Notes], \n    [Limit2].[Cost] AS [Cost], \n    [Limit2].[CreatedOn] AS [CreatedOn], \n    [Limit2].[ModifiedOn] AS [ModifiedOn], \n    [Limit2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n    [Limit2].[Id1] AS [Id1], \n    [Limit2].[CreatedOn1] AS [CreatedOn1], \n    [Limit2].[Id2] AS [Id2], \n    [Limit2].[SubscriptionTypeId] AS [SubscriptionTypeId], \n    [Limit2].[PlanFeeAmount] AS [PlanFeeAmount], \n    [Limit2].[LoginId] AS [LoginId], \n    [Limit2].[IndustryTypeId] AS [IndustryTypeId], \n    [Limit2].[CompanyName] AS [CompanyName], \n    [Limit2].[NumberOfLocations] AS [NumberOfLocations], \n    [Limit2].[WebsiteUrl] AS [WebsiteUrl], \n    [Limit2].[blsActive] AS [blsActive], \n    [Limit2].[Pending] AS [Pending], \n    [Limit2].[ExpiryDate] AS [ExpiryDate], \n    [Limit2].[LogoImageName] AS [LogoImageName], \n    [Limit2].[C1] AS [C1], \n    [Extent4].[Id] AS [Id3], \n    [Extent4].[UploadTicketId] AS [UploadTicketId], \n    [Extent4].[UploadStatus] AS [UploadStatus], \n    [Extent4].[CompanyId] AS [CompanyId1], \n    [Extent4].[CompanyLocationId] AS [CompanyLocationId1], \n    [Extent4].[CustomerId] AS [CustomerId], \n    [Extent4].[CreatedOn] AS [CreatedOn2], \n    CASE WHEN ([Extent4].[Id] IS NULL) THEN CAST(NULL AS int) ELSE 1 END AS [C2]\n    FROM   (SELECT TOP (20) [Project2].[Id] AS [Id], [Project2].[CompanyId] AS [CompanyId], [Project2].[CompanyLocationId] AS [CompanyLocationId], [Project2].[FirstName] AS [FirstName], [Project2].[LastName] AS [LastName], [Project2].[Email] AS [Email], [Project2].[Address1] AS [Address1], [Project2].[Address2] AS [Address2], [Project2].[City] AS [City], [Project2].[State] AS [State], [Project2].[Country] AS [Country], [Project2].[Zip] AS [Zip], [Project2].[Phone] AS [Phone], [Project2].[SaleDate] AS [SaleDate], [Project2].[Notes] AS [Notes], [Project2].[Cost] AS [Cost], [Project2].[CreatedOn] AS [CreatedOn], [Project2].[ModifiedOn] AS [ModifiedOn], [Project2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], [Project2].[Id1] AS [Id1], [Project2].[CreatedOn1] AS [CreatedOn1], [Project2].[Id2] AS [Id2], [Project2].[SubscriptionTypeId] AS [SubscriptionTypeId], [Project2].[PlanFeeAmount] AS [PlanFeeAmount], [Project2].[LoginId] AS [LoginId], [Project2].[IndustryTypeId] AS [IndustryTypeId], [Project2].[CompanyName] AS [CompanyName], [Project2].[NumberOfLocations] AS [NumberOfLocations], [Project2].[WebsiteUrl] AS [WebsiteUrl], [Project2].[blsActive] AS [blsActive], [Project2].[Pending] AS [Pending], [Project2].[ExpiryDate] AS [ExpiryDate], [Project2].[LogoImageName] AS [LogoImageName], [Project2].[C1] AS [C1]\n        FROM ( SELECT [Project2].[Id] AS [Id], [Project2].[CompanyId] AS [CompanyId], [Project2].[CompanyLocationId] AS [CompanyLocationId], [Project2].[FirstName] AS [FirstName], [Project2].[LastName] AS [LastName], [Project2].[Email] AS [Email], [Project2].[Address1] AS [Address1], [Project2].[Address2] AS [Address2], [Project2].[City] AS [City], [Project2].[State] AS [State], [Project2].[Country] AS [Country], [Project2].[Zip] AS [Zip], [Project2].[Phone] AS [Phone], [Project2].[SaleDate] AS [SaleDate], [Project2].[Notes] AS [Notes], [Project2].[Cost] AS [Cost], [Project2].[CreatedOn] AS [CreatedOn], [Project2].[ModifiedOn] AS [ModifiedOn], [Project2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], [Project2].[Id1] AS [Id1], [Project2].[CreatedOn1] AS [CreatedOn1], [Project2].[Id2] AS [Id2], [Project2].[SubscriptionTypeId] AS [SubscriptionTypeId], [Project2].[PlanFeeAmount] AS [PlanFeeAmount], [Project2].[LoginId] AS [LoginId], [Project2].[IndustryTypeId] AS [IndustryTypeId], [Project2].[CompanyName] AS [CompanyName], [Project2].[NumberOfLocations] AS [NumberOfLocations], [Project2].[WebsiteUrl] AS [WebsiteUrl], [Project2].[blsActive] AS [blsActive], [Project2].[Pending] AS [Pending], [Project2].[ExpiryDate] AS [ExpiryDate], [Project2].[LogoImageName] AS [LogoImageName], [Project2].[C1] AS [C1], row_number() OVER (ORDER BY [Project2].[CreatedOn1] ASC) AS [row_number]\n            FROM ( SELECT \n                [Filter1].[Id] AS [Id], \n                [Filter1].[CompanyId] AS [CompanyId], \n                [Filter1].[CompanyLocationId] AS [CompanyLocationId], \n                [Filter1].[FirstName] AS [FirstName], \n                [Filter1].[LastName] AS [LastName], \n                [Filter1].[Email] AS [Email], \n                [Filter1].[Address1] AS [Address1], \n                [Filter1].[Address2] AS [Address2], \n                [Filter1].[City] AS [City], \n                [Filter1].[State] AS [State], \n                [Filter1].[Country] AS [Country], \n                [Filter1].[Zip] AS [Zip], \n                [Filter1].[Phone] AS [Phone], \n                [Filter1].[SaleDate] AS [SaleDate], \n                [Filter1].[Notes] AS [Notes], \n                [Filter1].[Cost] AS [Cost], \n                [Filter1].[CreatedOn] AS [CreatedOn], \n                [Filter1].[ModifiedOn] AS [ModifiedOn], \n                [Filter1].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n                [Limit1].[Id] AS [Id1], \n                [Limit1].[CreatedOn] AS [CreatedOn1], \n                [Extent3].[Id] AS [Id2], \n                [Extent3].[SubscriptionTypeId] AS [SubscriptionTypeId], \n                [Extent3].[PlanFeeAmount] AS [PlanFeeAmount], \n                [Extent3].[LoginId] AS [LoginId], \n                [Extent3].[IndustryTypeId] AS [IndustryTypeId], \n                [Extent3].[CompanyName] AS [CompanyName], \n                [Extent3].[NumberOfLocations] AS [NumberOfLocations], \n                [Extent3].[WebsiteUrl] AS [WebsiteUrl], \n                [Extent3].[blsActive] AS [blsActive], \n                [Extent3].[Pending] AS [Pending], \n                [Extent3].[ExpiryDate] AS [ExpiryDate], \n                [Extent3].[LogoImageName] AS [LogoImageName], \n                1 AS [C1]\n                FROM    (SELECT [Extent1].[Id] AS [Id], [Extent1].[CompanyId] AS [CompanyId], [Extent1].[CompanyLocationId] AS [CompanyLocationId], [Extent1].[FirstName] AS [FirstName], [Extent1].[LastName] AS [LastName], [Extent1].[Email] AS [Email], [Extent1].[Address1] AS [Address1], [Extent1].[Address2] AS [Address2], [Extent1].[City] AS [City], [Extent1].[State] AS [State], [Extent1].[Country] AS [Country], [Extent1].[Zip] AS [Zip], [Extent1].[Phone] AS [Phone], [Extent1].[SaleDate] AS [SaleDate], [Extent1].[Notes] AS [Notes], [Extent1].[Cost] AS [Cost], [Extent1].[CreatedOn] AS [CreatedOn], [Extent1].[ModifiedOn] AS [ModifiedOn], [Extent1].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId]\n                    FROM [dbo].[Customer] AS [Extent1]\n                    WHERE (([Extent1].[FirstName] LIKE @p__linq__0 ESCAPE N'~') OR ([Extent1].[LastName] LIKE @p__linq__1 ESCAPE N'~') OR ([Extent1].[Email] LIKE @p__linq__2 ESCAPE N'~') OR ([Extent1].[FirstName] + N' ' + [Extent1].[LastName] LIKE @p__linq__3 ESCAPE N'~')) AND ([Extent1].[CompanyId] = @p__linq__4) AND ([Extent1].[CompanyLocationId] = @p__linq__5) ) AS [Filter1]\n                OUTER APPLY  (SELECT TOP (1) \n                    [Extent2].[Id] AS [Id], \n                    [Extent2].[CreatedOn] AS [CreatedOn]\n                    FROM [dbo].[EmailCampaignerStatus] AS [Extent2]\n                    WHERE [Filter1].[Id] = [Extent2].[CustomerId] ) AS [Limit1]\n                LEFT OUTER JOIN [dbo].[Company] AS [Extent3] ON [Filter1].[CompanyId] = [Extent3].[Id]\n            )  AS [Project2]\n        )  AS [Project2]\n        WHERE [Project2].[row_number] &gt; 0\n        ORDER BY [Project2].[CreatedOn1] ASC ) AS [Limit2]\n    LEFT OUTER JOIN [dbo].[EmailCampaignerStatus] AS [Extent4] ON [Limit2].[CompanyId] = [Extent4].[CompanyId]\n)  AS [Project3]\nORDER BY [Project3].[CreatedOn1] ASC, [Project3].[Id1] ASC, [Project3].[Id] ASC, [Project3].[Id2] ASC, [Project3].[C2] ASC\n\nSELECT \n[GroupBy1].[A1] AS [C1]\nFROM ( SELECT \n    COUNT(1) AS [A1]\n    FROM [dbo].[Customer] AS [Extent1]\n    WHERE (([Extent1].[FirstName] LIKE @p__linq__0 ESCAPE N'~') OR ([Extent1].[LastName] LIKE @p__linq__1 ESCAPE N'~') OR ([Extent1].[Email] LIKE @p__linq__2 ESCAPE N'~') OR ([Extent1].[FirstName] + N' ' + [Extent1].[LastName] LIKE @p__linq__3 ESCAPE N'~')) AND ([Extent1].[CompanyId] = @p__linq__4) AND ([Extent1].[CompanyLocationId] = @p__linq__5)\n)  AS [GroupBy1]\n\n\nSELECT \nCASE WHEN ( EXISTS (SELECT \n    1 AS [C1]\n    FROM [dbo].[CompanyReviewSites] AS [Extent1]\n    WHERE [Extent1].[CompanyLocationId] = @p__linq__0\n)) THEN cast(1 as bit) WHEN ( NOT EXISTS (SELECT \n    1 AS [C1]\n    FROM [dbo].[CompanyReviewSites] AS [Extent2]\n    WHERE [Extent2].[CompanyLocationId] = @p__linq__0\n)) THEN cast(0 as bit) END AS [C1]\nFROM  ( SELECT 1 AS X ) AS [SingleRowTable1]\n\nSELECT \n1 AS [C1], \n[Extent1].[Id] AS [Id], \n[Extent1].[RiviewSiteId] AS [RiviewSiteId], \n[Extent1].[URL] AS [URL], \n[Extent1].[CompanyId] AS [CompanyId], \n[Extent1].[CompanyLocationId] AS [CompanyLocationId], \n[Extent2].[Id] AS [Id1], \n[Extent2].[ReviewSiteName] AS [ReviewSiteName], \n[Extent2].[ImageName] AS [ImageName]\nFROM  [dbo].[CompanyReviewSites] AS [Extent1]\nINNER JOIN [dbo].[ReviewSites] AS [Extent2] ON [Extent1].[RiviewSiteId] = [Extent2].[Id]\nWHERE [Extent1].[CompanyLocationId] = @p__linq__0\n</code></pre>\n"},{"tags":["c#","linq","entity-framework","type-conversion","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13259608,"title":"Cannot convert source type 'void' to target type 'ICollection<Character>'","body":"<p>I have a <code>DataContract</code> class that I'm trying to convert to another class, <code>Movie</code> but for the property <code>Movie.Characters</code> I'm getting the error...</p>\n\n<blockquote>\n  <p>Cannot convert source type '<code>void</code>' to target type '<code>ICollection&lt;Character&gt;</code>'</p>\n</blockquote>\n\n<p>How can I create a new <code>Movie</code> so the <code>Character</code> property is set properly mapped to each <code>Person</code> and <code>Movie</code>?</p>\n\n<pre><code>var movies = dataContract.Movies.Select(m =&gt; new Movie {\n    Id = m.Id,\n    Title = m.Title,\n    Characters = m.AbridgedCast.ToList().ForEach(p =&gt; new Person { Name = p.Name, \n        RottenTomatoesId = p.Id, \n        Characters = p.Characters.ToList().ForEach(c =&gt; new Character { Name = c })})\n});\n</code></pre>\n\n<p><strong>MoviesDataContract.cs</strong></p>\n\n<pre><code>public class MoviesDataContract {\n    [DataMember(Name = \"total\")]\n    public int Total { get; set; }\n\n    [DataMember(Name = \"movies\")]\n    public IEnumerable&lt;Movie&gt; Movies { get; set; }\n\n    #region Internal Classes\n\n    [DataContract]\n    public class Movie {\n        [DataMember(Name = \"id\")]\n        public int Id { get; set; }\n\n        [DataMember(Name = \"title\")]\n        public string Title { get; set; }\n\n        [DataMember(Name = \"abridged_cast\")]\n        public virtual IEnumerable&lt;Person&gt; AbridgedCast { get; set; }\n    }\n\n    [DataContract]\n    public class Person {\n        [DataMember(Name = \"name\")]\n        public string Name { get; set; }\n\n        [DataMember(Name = \"id\")]\n        public int Id { get; set; }\n\n        [DataMember(Name = \"characters\")]\n        public IEnumerable&lt;string&gt; Characters { get; set; }\n    }\n\n    #endregion  \n}\n</code></pre>\n\n<p><strong>Movies.cs</strong></p>\n\n<pre><code>public partial class Movie {\n    public Movie() {\n        this.Characters = new HashSet&lt;Character&gt;();\n    }\n\n    public int Id { get; set; }\n    public string Title { get; set; }\n    public virtual ICollection&lt;Character&gt; Characters { get; set; }\n}\n\npublic partial class Character {\n    public System.Guid Id { get; set; }\n    public int MovieId { get; set; }\n    public System.Guid PersonId { get; set; }\n    public string Name { get; set; }\n\n    public virtual Movie Movie { get; set; }\n    public virtual Person Person { get; set; }\n}\n\npublic partial class Person {\n    public Person() {\n        this.Characters = new HashSet&lt;Character&gt;();\n    }\n\n    public System.Guid Id { get; set; }\n    public string Name { get; set; }\n    public int RottenTomatoesId { get; set; }\n\n    public virtual ICollection&lt;Character&gt; Characters { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework","json.net"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":771,"score":2,"question_id":7983428,"title":"json.net; serialize entity framework object (circular reference error)","body":"<p>I have an entity framework entity that i want to serialize as a json object. I looked around and found out that json.net (http://james.newtonking.com/projects/json-net.aspx) should be able to serialize objects with circular references \"out of the box\". So i tried using</p>\n\n<pre><code>string json = JsonConvert.SerializeObject(/* my ef entity */);\n</code></pre>\n\n<p>But im still getting the same error. The problem might be that i need to use <code>ReferenceLoopHandling.Ignore</code> and a <code>ContractResolver</code>, but im not sure how to use them. Any help is much appreciated! Thanks</p>\n"},{"tags":["c#","entity-framework","entity-framework-4.1","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13259299,"title":"EF DbContext.Set<T> filtered record only ... doesn't work","body":"<p>While developing a data access solution that utilizes generic repository and unit of work pattern over entity framework 4.2. I am seeing some abnormal behavior. To make my repositories generic, I have utilized the Set method of DbContext like:</p>\n\n<pre><code>public class MyGenericRepository&lt;T&gt; \n{\n     protected readonly IDbContext context;\n     public virtual IEnumerable&lt;T&gt; FindBy(Func&lt;T, bool&gt; predicate)\n     {\n        return context.GetDbSet&lt;T&gt;().Where(predicate).First();\n     }\n}\n</code></pre>\n\n<p>where IDbContext is like: </p>\n\n<pre><code>public interface IDbContext\n{\n    void Commit();\n    void Attach&lt;T&gt;(T obj) where T : class;\n    void Add&lt;T&gt;(T obj) where T : class;\n    DbSet&lt;T&gt; GetDbSet&lt;T&gt;() where T : class;\n    bool Remove&lt;T&gt;(T item) where T : class;\n}\n</code></pre>\n\n<p>The DbContext class implements the IDbContext as: </p>\n\n<pre><code>public partial class MyEntities : IDbContext\n{\n\n    public DbSet&lt;T&gt; GetDbSet&lt;T&gt;() where T : class\n    {\n        return this.Set&lt;T&gt;();\n    }\n}  \n</code></pre>\n\n<p>When I do repository.FindBy(c => c.CompanyId == 45), Sql Profiler shows the query to <strong>NOT</strong> contain any filter (company_id = 45). The query does a Select *.</p>\n\n<p>Expecting a filter to be present, i started researching and came across this,</p>\n\n<p><a href=\"http://social.msdn.microsoft.com/Forums/en/adodotnetentityframework/thread/7d6705ac-f875-4c89-960b-842be6f6e5ed\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en/adodotnetentityframework/thread/7d6705ac-f875-4c89-960b-842be6f6e5ed</a>\nand \n<a href=\"http://stackoverflow.com/questions/9362145/ef-dbcontext-sett-filtered-record-only\">EF DbContext.Set&lt;T&gt; filtered record only</a></p>\n\n<p>These threads confirms my thought process but the results are different. Any solutions?</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first","code-first-migrations"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":280,"score":0,"question_id":12573927,"title":"Database Initializer not being called in EF 5 + MVC 3","body":"<p>I know this question might be duplicated, but I haven't found any solution for my problem yet.</p>\n\n<p>I have:</p>\n\n<pre><code>protected void Application_Start()\n        {\n            Database.SetInitializer(new DatabaseSeeder());\n            DatabaseContext c = new DatabaseContext();\n            c.Database.Initialize(true);\n\n            AreaRegistration.RegisterAllAreas();\n\n            RegisterGlobalFilters(GlobalFilters.Filters);\n            RegisterRoutes(RouteTable.Routes);\n\n\n        }\n</code></pre>\n\n<p>my database seeder is:</p>\n\n<pre><code>public class DatabaseSeeder : DropCreateDatabaseAlways&lt;DatabaseContextBase&gt;\n    {\n        protected override void Seed(DatabaseContextBase context)\n        {\n            base.Seed(context);\n\n            var roles = new[] {\"Admin\", \"User\"};\n            foreach (var role in roles)\n            {\n                context.Roles.Add(new UserRole {FullName = role});\n            }\n\n            context.SaveChanges();\n        }\n    }\n</code></pre>\n\n<p>and my context is:</p>\n\n<pre><code>public abstract class DatabaseContextBase : DbContext\n    {\n        public DbSet&lt;UserRole&gt; Roles { get; set; }\n        public DbSet&lt;UserAndPermissionInGroup&gt; UserAndPermissions { get; set; }\n        public DbSet&lt;GeneralUser&gt; Users { get; set; }\n        public DbSet&lt;Group&gt; Groups { get; set; }\n        public DbSet&lt;Forum&gt; Forums { get; set; } \n\n        public DatabaseContextBase() :base(\"ForumDb\")\n        {\n\n        }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            base.OnModelCreating(modelBuilder);\n            modelBuilder.Entity&lt;Comment&gt;()\n                .HasRequired(e =&gt; e.Owner)\n                .WithMany(t =&gt; t.Comments)\n                .HasForeignKey(e =&gt; e.OwnerId)\n                .WillCascadeOnDelete(false);\n        }\n    }\n</code></pre>\n\n<p>And finally:</p>\n\n<pre><code>public class DatabaseContext : DatabaseContextBase\n\n{\n\n}\n</code></pre>\n\n<p>The problem is that, even with this initializer, I get the following error:</p>\n\n<blockquote>\n  <p>The model backing the 'DatabaseContext' context has changed since the\n  database was created. Consider using Code First Migrations to update\n  the database</p>\n</blockquote>\n\n<p>I am using EF 5 code first in an ASP.NET MVC 3 project. Any suggestions?</p>\n"},{"tags":["c#","linq","entity-framework","lambda"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13234447,"title":"Datetime check in Linq where statement","body":"<p>Please see the code below:</p>\n\n<pre><code>var pcPageList = db.PcPages\n        .Where(m =&gt; \n            m.Quarter == exactQuarter &amp;&amp; \n            m.Url == pageUrl &amp;&amp; \n            m.UpdatedOn.ToDateTime().Date.ToString(\"dd/MMM\").ToLower() == \"02/nov\")\n        .OrderBy(m =&gt; m.UpdatedOn)\n        .FirstOrDefault();\n</code></pre>\n\n<p>When I run this above, the application throws error says: \"ToDateTime\" is not implemented yet. Anyone please can advice ?</p>\n"},{"tags":["jquery","entity-framework","asp.net-mvc-3"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":429,"score":0,"question_id":6141216,"title":"mvc3 jquery ajax post error \"An entity object cannot be referenced by multiple instances of IEntityChangeTracker.\"","body":"<p>I've found a lot of posts about this error, but none of them helped, it seems that everybody else got this error in a different situation. But this is my first MVC project, so maybe I'm just not getting it :) So, I have a very simple ajax call:</p>\n\n<pre><code>         $.ajax({\n                type: \"POST\",\n                url: \"/Home/MyMethod\",\n                data: ({ SomeProperty:\"someValue\" }),\n                success: function (data) {\n                    var obj = jQuery.parseJSON(data);\n                    alert(obj.Status);\n                },\n                error: function () {\n                    alert(\"error\");\n                }\n            });\n</code></pre>\n\n<p>and the very simple <code>MyMethod</code> controller method:</p>\n\n<pre><code>        [HttpPost]\n        public JsonResult AddReport(MyModel model)\n        {\n            if (ModelState.IsValid)\n            {\n                db.MyModels.Add(model);\n                db.SaveChanges();\n                return Json(...);\n            }\n            else\n            {\n                //not good...\n            }\n        }\n</code></pre>\n\n<p>the line <code>db.MyModels.Add(model);</code> triggers the error. I have another controller in an admin area that handles the CRUD operations for the same model, and it's working just fine. I know that probably the problem is that the <code>model</code> is already attached to the <code>System.Data.Objects.ObjectContext</code> and I have to detach it, but I don't know how to do that. Any ideas?</p>\n"},{"tags":["entity-framework","entity-framework-4","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13257388,"title":"Multiple aggregates in linq to entities (code first)","body":"<p>Given the following model, I want to be able to retrieve the number of points gained for a single player and the average number of point gained for all players given a time period. This should be done in a single db query (I also want other stats e.g. avg points per team which will come later but the concept should be the same).</p>\n\n<p>Having a bad day and getting nowhere. Can someone help me out?</p>\n\n<pre><code>public class Player\n{\n    public int Id { get; set; }\n    public ICollection&lt;PlayerGame&gt; PlayerGames { get; set; }\n\n    ...\n}\n\npublic class PlayerGame\n{\n    public int Id { get; set; }\n\n    public int Points { get; set; }\n\n    public int PlayerId { get; set; }\n    public Player Player { get; set; }\n\n    public int GameId { get; set; }\n    public Game Game { get; set; }\n\n    ...\n}\n\npublic class Game\n{\n    public int Id { get; set; }\n\n    ...\n}\n</code></pre>\n"},{"tags":["c#","mysql","linq","entity-framework","entity-framework-5"],"answer_count":5,"favorite_count":3,"up_vote_count":5,"down_vote_count":1,"view_count":109,"score":4,"question_id":13257760,"title":"Why does Entity Framework SQL generation create a nested query?","body":"<p>Why does Entity Framework SQL generation create a nested query?</p>\n\n<p>I have this code</p>\n\n<pre><code>    var db = new Context();\n    var result = db.Network.Where(x =&gt; x.ServerID == serverId)\n        .OrderBy(x=&gt; x.StartTime)\n        .Take(limit);\n</code></pre>\n\n<p>Which will be transleted into this! (Note the dubble select statement)</p>\n\n<pre><code>SELECT\n`Project1`.`Id`, \n`Project1`.`ServerID`, \n`Project1`.`EventId`, \n`Project1`.`StartTime`\nFROM (SELECT\n`Extent1`.`Id`, \n`Extent1`.`ServerID`, \n`Extent1`.`EventId`, \n`Extent1`.`StartTime`\nFROM `Networkes` AS `Extent1`\n WHERE `Extent1`.`ServerID` = @p__linq__0) AS `Project1`\n ORDER BY \n`Project1`.`StartTime` DESC LIMIT 5\n</code></pre>\n\n<p>How could I change it into one <code>select</code> statement?\nI'm using MySQL and Entity Framework with code first</p>\n\n<h1>Update</h1>\n\n<p>I have the same result whatever type I use as parameter to the <code>OrderBy()</code> method.</p>\n\n<h1>Update 2 with some timeing</h1>\n\n<pre><code>Total Time (hh:mm:ss.ms)    05:34:13.000\nAverage Time (hh:mm:ss.ms)  25:42.000\nMax Time (hh:mm:ss.ms)  51:54.000\nCount   13\nFirst Seen  Nov 6, 12 19:48:19\nLast Seen   Nov 6, 12 20:40:22\n</code></pre>\n\n<p>Raw query:</p>\n\n<pre><code>SELECT `Project?`.`Id`, `Project?`.`ServerID`, `Project?`.`EventId`, `Project?`.`StartTime` FROM (SELECT `Extent?`.`Id`, `Extent?`.`ServerID`, `Extent?`.`EventId`, `Extent?`.`StartTime`, FROM `Network` AS `Extent?` WHERE `Extent?`.`ServerID` = ?) AS `Project?` ORDER BY `Project?`.`Starttime` DESC LIMIT ?\n</code></pre>\n\n<p>I use a program to take snapshots from the current process in MySQL.</p>\n\n<p>It's other querys that could be executed at the same time. But when I change it to just one SELECT statement, it NEVER goes over one second. Maybe I have something else that's going on, I'm asking couse I'm not so into DBs...</p>\n\n<h1>Update 3 The explain statement</h1>\n\n<p>The entity framework generated</p>\n\n<pre><code>'1', 'PRIMARY', '&lt;derived2&gt;', 'ALL', NULL, NULL, NULL, NULL, '46', 'Using filesort'\n'2', 'DERIVED', 'Extent?', 'ref', 'serveridneventid,serverid', 'serveridneventid', '109', '', '45', 'Using where'\n</code></pre>\n\n<p>One liner</p>\n\n<pre><code>'1', 'SIMPLE', 'network', 'ref', 'serveridneventid,serverid', 'serveridneventid', '109', 'const', '45', 'Using where; Using filesort'\n</code></pre>\n\n<p>This is from my QA enviroment, so the timeing I pasted above is not realted to this row count explain statements. I think that there is about 500,000 records that match one server id.</p>\n"},{"tags":["c#",".net","wpf","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":13256246,"title":"linq to entity framework with join","body":"<p>I have in my DB 2 tables: </p>\n\n<ol>\n<li><p>Documents (Document_Id ,document_Name) </p></li>\n<li><p>Person_Documents (person_ID ,Documet_Id document_Done)</p></li>\n</ol>\n\n<p>I use entity framework and ,and I want to fill <code>DataGrid</code> with the data <code>document_Name</code> and <code>document_Done</code>,</p>\n\n<p>I have tried the following with no results:</p>\n\n<pre><code>      vagEntities projectE = new vagEntities();\n      var doc = from c in projectE.Person_Documents                   \n          join cw in projectE.Documents on c.Document_Id equals cw.Document_Id\n          where c.Person_Id == 150\n          select c;\n\n      DocGrid.ItemsSource = doc;\n</code></pre>\n\n<p>Please, where am I wrong?\nun the xaml i write this</p>\n\n<pre><code>                &lt;DataGridTextColumn Binding=\"{Binding Path=Document_Name}\" MinWidth=\"100\"   Header=\"document\"  /&gt;\n\n            &lt;DataGridCheckBoxColumn  Binding=\"{Binding Path=Document_done}\" Header=\"Do\" /&gt;\n</code></pre>\n"},{"tags":["asp.net","asp.net-mvc","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1330,"score":1,"question_id":2435362,"title":"Error while updating Database record with Entity Framework on ASP.NET MVC Page","body":"<p>I have an ASP.NET Page that updates registered User Address Details for a selected record.\nBelow is the Update method that i am calling from Controller.</p>\n\n<p>When i am calling <strong>ApplyPropertyChanges</strong> method, I am getting the below error.\nDid anyone run into the same error while updating the record with Entity Framework. </p>\n\n<p>Appreciate your responses.</p>\n\n<p><strong>Error Message:</strong> </p>\n\n<p>The existing object in the ObjectContext is in the Added state. Changes can only be applied when the existing object is in an unchanged or modified state.</p>\n\n<p><strong>My Update Method Code:</strong></p>\n\n<pre><code>[HttpPost]\n    public bool UpdateAddressDetail([Bind(Prefix = \"RegUser\")] AddressDetail regUserAddress, \n                        FormCollection formData)\n    {\n    regUserAddress.AD_Id = 3;\n        regUserAddress.LastUpdated = HttpContext.User.Identity.Name;\n        regUserAddress.UpdatedOn = DateTime.Now;\n        regUserAddress.AddressType = ((AddressDetail)Session[\"CurrentAddress\"]).AddressType ?? \"Primary\";\n        regUserAddress.Phone = ((AddressDetail)Session[\"CurrentAddress\"]).Phone;\n        regUserAddress.Country = ((AddressDetail)Session[\"CurrentAddress\"]).AddressType ?? \"USA\";\n\n        miEntity.ApplyPropertyChanges(regUserAddress.EntityKey.EntitySetName, regUserAddress);\n        miEntity.SaveChanges();\n        return true;\n    }\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework","code-generation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13257097,"title":"What is EF Templated Code Generation used for?","body":"<p>I've seen several <a href=\"http://geekswithblogs.net/iupdateable/archive/2009/11/19/getting-started-with-entity-framework-4---templated-code-generation.aspx\" rel=\"nofollow\">examples</a> / tutorials of using Entity Framework with Templated Code Generation.</p>\n\n<p>What is this tool doing? Is creating a new DataContext and a new set of EntityObjects? or is replacing the old ones? Why you will use a Code Generation instead of working directly with the ones created by the designer?</p>\n"},{"tags":["silverlight","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13238412,"title":"Invalid Column Name on a stored procedure (Silverlight WCF)","body":"<p>I have a Silverlight 4 apps that use the entity framework with WCF RIA.</p>\n\n<p>All of a sudden a few (I think 3) stored procedures stop working.  Every users reprot the same problem All of them has the error message when the Silverlight app tries to execute the related query.</p>\n\n<p>Load operation failed for query 'SomeStoredProcedure'. An error occurred while executing the command definition. See the inner exception for details. InnerException message: Invalid column name 'someColumn'.</p>\n\n<p>at System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior)</p>\n\n<p>at System.Data.Objects.Internal.ObjectQueryExecutionPlan.Execute[TResultType](ObjectContext context, ObjectParameterCollection parameterValues)</p>\n\n<p>at System.Data.Objects.ObjectQuery<code>1.GetResults(Nullable</code>1 forMergeOption)</p>\n\n<p>at System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable.GetEnumerator()</p>\n\n<p>at System.Data.Objects.ObjectQuery`1.GetEnumeratorInternal()</p>\n\n<p>at System.Data.Objects.ObjectQuery.System.Collections.IEnumerable.GetEnumerator()</p>\n\n<p>at System.ServiceModel.DomainServices.Server.DomainService.Enumerate[T](IEnumerable enumerable, Int32 estimatedResultCount)</p>\n\n<p>at System.ServiceModel.DomainServices.Server.DomainService.Query(QueryDescription queryDescription, IEnumerable`1&amp; validationErrors, Int32&amp; totalCount)</p>\n\n<p>at System.ServiceModel.DomainServices.Hosting.QueryProcessor.Process[TEntity](DomainService domainService, DomainOperationEntry queryOperation, Object[] parameters, ServiceQuery serviceQuery, IEnumerable`1&amp; validationErrors, Int32&amp; totalCount)</p>\n\n<p>at System.ServiceModel.DomainServices.Hosting.QueryOperationBehavior`1.QueryOperationInvoker.InvokeCore(Object instance, Object[] inputs, Object[]&amp; outputs)</p>\n\n<p>Now the weird thing is:</p>\n\n<p>a) I have a development deployment of the same app, and that works fine when connecting to the production database.</p>\n\n<p>b) If I connect to the SSMS and execute the stored procedure, it returns the correct data.</p>\n\n<p>c) So what I did was simply recompile the stored procedure.  I basically select the stored procedure, click Modify.  It will generate the ALTER PROCEDURE script, I just hit execute without changing anything inside.  Now suddenly all three stored procedures work fine again, even though I only recompile one of them.</p>\n\n<p>To explain this better, this is what happen in sequential order:</p>\n\n<p>1) The Silverlight app suddenly complain some SP does not contain some column</p>\n\n<p>2) Runs the SP in SSMS, returns normal and expected result.</p>\n\n<p>3) Recompile the SP </p>\n\n<p>4) Runs the SP in SSMS, returns the exact same result as #2.</p>\n\n<p>5) The Silverlight app works again</p>\n\n<p>What is going on??</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","design-patterns","architecture","domain-driven-design"],"answer_count":5,"favorite_count":5,"up_vote_count":6,"down_vote_count":0,"view_count":8354,"score":6,"question_id":7927382,"title":"Sample N-tier ASP.NET MVC3 application with best practices (using EF 4.1)","body":"<p>I am looking for a sample ASP.NET MVC3 N-Tier application that demonstrates best practices (uses Domain Driven Design and Entity Framework 4.1 Code first). I found the following. which one do you recommend out of these (or any other one not in this list)?</p>\n\n<p><a href=\"http://efmvc.codeplex.com/\" rel=\"nofollow\">http://efmvc.codeplex.com/</a></p>\n\n<p><a href=\"http://prodinner.codeplex.com/\" rel=\"nofollow\">http://prodinner.codeplex.com/</a></p>\n\n<p><a href=\"http://www.dofactory.com/Framework/Framework.aspx\" rel=\"nofollow\">http://www.dofactory.com/Framework/Framework.aspx</a> (not free)</p>\n"},{"tags":["entity-framework","c#-4.0","predicatebuilder"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13256843,"title":"Using PredicateBuilder in Entity for Optional Filters","body":"<p>I am using EF4 with the following sample database:</p>\n\n<pre><code>Departments\nDepartmentID (uniqueidentifier, PK)\nName (nvarchar(50))\nManagerID (uniqueidentifier, FK to Employees table)\n\nEmployees\nEmployeeID (uniqueidentifier, PK)\nLastName (nvarchar(50))\nFirstName (nvarchar(50))\nTitle (nvarchar(50))\nOfficeID (uniqueidentifier, FK to Offices table)\n\nOffices\nOfficeID (uniqueidentifier, PK)\nStreet (nvarchar(100))\nCity (nvarchar(50))\nState (nvarchar(2))\nZip (nvarchar(5))\n\nEmployeeAssignments\nDepartmentID (uniqueidentifier, PK, FK to Departments table)\nEmployeeID (uniqueidentifier, PK, FK to Employees table)\n</code></pre>\n\n<p>I am trying to construct a query using the entities to filter the departments by the following criteria along with their intended result sets:</p>\n\n<ul>\n<li>Department name - Departments which have the specified name</li>\n<li>Manager ID - Departments which are managed by the specified employee</li>\n<li>Manager Office ID - Departments whose manager works at the specified office</li>\n<li>Manager State - Departments whose manager works at an office in the specified state</li>\n<li>Employee ID - Departments which are assigned to the specified employee</li>\n<li>Employee Title - Departments which contain at least one employee with the specified title</li>\n<li>Employee State - Departments which contain at least one employee whose office is in the specified state</li>\n</ul>\n\n<p>The final result set is intended to be all of the filters AND'ed together. However, many times only a few filters will be used so I would like to generate the query in such a way that performance is improved for simpler queries. For example, if the filter criteria do not include employee ID, employee title, or employee state, there is no need for the query to do a join on the EmployeeAssignments table.</p>\n\n<p>I am attempting to use the PredicateBuilder found here <a href=\"http://petemontgomery.wordpress.com/2011/02/10/a-universal-predicatebuilder/\" rel=\"nofollow\">http://petemontgomery.wordpress.com/2011/02/10/a-universal-predicatebuilder/</a> , which the author claims functions identically to the one included in LinqKit. My reason for using this PredicateBuilder rather than the one in LinqKit is that I am unable to cast the result of the LinqKit query to an ObjectQuery and call ToTraceString() to see the query which is generated. Although LinqPad would allow me to see the query that gets generated by LinqKit I would have to have our IT department install it on my computer and that has been painful in the past.</p>\n\n<p>My first attempt at this produced code like the following:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>Expression&lt;Func&lt;Department, bool&gt;&gt; departmentFilters = PredicateBuilder.True&lt;Department&gt;();\n\nif (IsValidParameter(managerID))\n    departmentFilters = departmentFilters.And(department =&gt; department.ManagerID == managerID);\n\nif (IsValidParameter(managerOfficeID))\n    departmentFilters = departmentFilters.And(department =&gt; department.Manager.OfficeID == managerOfficeID);\n\nif (IsValidParameter(managerState))\n    departmentFilters = departmentFilters.And(department =&gt; department.Manager.Office.State == managerState);\n\nreturn new DepartmentEntities().Departments.Where(departmentFilters);\n</code></pre>\n\n<p>However, this produces the following SQL:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT \n[Extent1].[DepartmentID] AS [DepartmentID], \n[Extent1].[Name] AS [Name], \n[Extent1].[ManagerID] AS [ManagerID]\nFROM    [dbo].[Departments] AS [Extent1]\nINNER JOIN [dbo].[Employees] AS [Extent2] ON [Extent1].[ManagerID] = [Extent2].[EmployeeID]\nLEFT OUTER JOIN [dbo].[Employees] AS [Extent3] ON [Extent1].[ManagerID] = [Extent3].[EmployeeID]\nINNER JOIN [dbo].[Offices] AS [Extent4] ON [Extent3].[OfficeID] = [Extent4].[OfficeID]\nWHERE ([Extent1].[ManagerID] = @p__linq__0) AND ([Extent2].[OfficeID] = @p__linq__1) AND ([Extent4].[State] = @p__linq__2)\n</code></pre>\n\n<p>This includes a superfluous join to Employees to get the manager information (Extent2 and Extent3). I understand why this is happening - when the query is constructed it has no way of knowing that the Manager I am talking about for both of the filters is the same. This isn't a huge problem here, however in my actual business case there are filters on tables that are 3-4 joins away - if I have 3 filters on that table that would cause a total of 6-8 extra joins.</p>\n\n<p>Here's the notional code of what I am trying to achieve:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>private IQueryable&lt;Department&gt; GetDepartments(string departmentName, Guid managerID, Guid managerOfficeID, string managerState, Guid employeeID, string employeeTitle, string employeeState)\n    {\n        DepartmentEntities context = new DepartmentEntities();\n\n        Expression&lt;Func&lt;Department, bool&gt;&gt; departmentFilters = PredicateBuilder.True&lt;Department&gt;();\n        Expression&lt;Func&lt;Employee, bool&gt;&gt; managerFilters = PredicateBuilder.True&lt;Employee&gt;();\n        Expression&lt;Func&lt;Office, bool&gt;&gt; managerOfficeFilters = PredicateBuilder.True&lt;Office&gt;();\n        Expression&lt;Func&lt;Employee, bool&gt;&gt; employeeFilters = PredicateBuilder.True&lt;Employee&gt;();\n        Expression&lt;Func&lt;Office, bool&gt;&gt; employeeOfficeFilters = PredicateBuilder.True&lt;Office&gt;();\n\n        if (IsValidParameter(departmentName))\n            departmentFilters = departmentFilters.And(department =&gt; department.Name == departmentName);\n\n        if (IsValidParameter(managerID))\n            departmentFilters = departmentFilters.And(department =&gt; department.ManagerID == managerID);\n\n        if (IsValidParameter(managerOfficeID))\n            managerFilters = managerFilters.And(manager =&gt; manager.OfficeID == managerOfficeID);\n\n        if (IsValidParameter(managerState))\n            managerOfficeFilters = managerOfficeFilters.And(office =&gt; office.State == managerState);\n\n        if (IsValidParameter(employeeID))\n            employeeFilters = employeeFilters.And(employee =&gt; employee.EmployeeID == employeeID);\n\n        if (IsValidParameter(employeeTitle))\n            employeeFilters = employeeFilters.And(employee =&gt; employee.Title == employeeTitle);\n\n        if (IsValidParameter(employeeState))\n            employeeOfficeFilters = employeeOfficeFilters.And(office =&gt; office.State == employeeState);\n\n        employeeFilters = employeeFilters.And(employee =&gt; employee.Office.Where(employeeOfficeFilters));\n\n        IQueryable&lt;Department&gt; departments = context.Departments;\n        departments = departments.Where(departmentFilters);\n        departments = departments.Where(department =&gt; department.Manager.Where(managerFilters));\n        departments = departments.Where(department =&gt; department.Manager.Office.Where(managerOfficeFilters));\n        departments = departments.Where(department =&gt; department.Employees.AsQueryable().Any(employeeFilters));\n\n        return departments;\n    }\n</code></pre>\n\n<p>The following 3 lines towards the end are incorrect (Office and Manager are the entities themselves, not an EntityCollection and therefore .Where() does not apply), but (hopefully) convey the functionality I'm trying to achieve:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>employeeFilters = employeeFilters.And(employee =&gt; employee.Office.Where(employeeOfficeFilters));\n...\ndepartments = departments.Where(department =&gt; department.Manager.Where(managerFilters));\ndepartments = departments.Where(department =&gt; department.Manager.Office.Where(managerOfficeFilters));\n</code></pre>\n\n<p>I have been going in circles and adding unnecessary layers of abstraction over what I feel is a simple problem. Am I missing something obvious, or is there a fundamental problem with what I am trying to achieve (avoiding excessive joins when some filters are not specified)?</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net-mvc","entity-framework","jqgrid-asp.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13245746,"title":"Entity sql datetime literal","body":"<p>I am stuck in the ObjectQuery class it always gives me the error as \nSystem.Data.Entity: The argument types 'Edm.DateTime' and 'Edm.String' are incompatible for this operation., near WHERE predicate</p>\n\n<p>Please suggest me the solution, i followed the above approach, but it did not work.</p>\n\n<p>my code is as follows:</p>\n\n<p>C# code:</p>\n\n<pre><code>var _dbModel = new VISAIntBPAEntities();\n        var serializer = new JavaScriptSerializer();\n        Filters f = (!_search || string.IsNullOrEmpty(filters)) ? null : serializer.Deserialize&lt;Filters&gt;(filters);\n        //if (f != null)\n        //{\n        //    if (f.rules[0].field == \"CreatedDate\")\n        //    {\n        //        Convert.ToDateTime(f.rules[0].data).ToString();\n        //    }\n        //}\n        ObjectQuery&lt;Jobs&gt; filteredQuery = (f == null ? _dbModel.Jobs : f.FilterObjectSet(_dbModel.Jobs));\n        //if (f != null)\n        //{\n        //    if (f.rules[0].field == \"CreatedDate\")\n        //    {\n        //        filteredQuery.Parameters.Add(new ObjectParameter(\"CreatedDate\", Convert.ToDateTime(f.rules[0].data)));\n        //    }\n        //}\n        if (f != null)\n        {\n            DateTime dateTimeValue = Convert.ToDateTime(f.rules[0].data);\n            filteredQuery = filteredQuery.Where(string.Format(\"(it.CreatedDate = DATETIME'{0:yyyy-mm-dd hh:mm}')\", dateTimeValue));\n        }\n        filteredQuery.MergeOption = MergeOption.NoTracking; // we don't want to update the data\n        var totalRecords = filteredQuery.Count();\n</code></pre>\n\n<p>Cleint side code:</p>\n\n<p>this code is in built using jqgrid, which has a column called CreatedDate, which fills in the dropdown, i have a sql query which fetches me the distinct date part from the database.\nI am doing filtering based on the string date selection in the dropdown.</p>\n\n<pre><code>{\n        name: 'CreatedDate', index: 'CreatedDate', width: 140, stype: 'select', async: false, sorttype: 'date',\n        edittype: 'select', editoptions: { value: getCreatedJobDate() }, editable: true, formatoptions: { newformat: 'm/d/Y' },\n        //editrules: { required: true },\n        searchoptions: {\n        value: getCreatedJobDate,\n        sopt: ['eq', 'ne', 'lt', 'le', 'gt', 'ge', 'de']\n        }\n        }\n</code></pre>\n\n<p>Please help me as i am stuck with this approach, i need to do this way only.\nThanks in advance.</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13256290,"title":"EF get Keyvalues of added objects","body":"<p>Is it possible to get the entity keyvalues of added objects?</p>\n\n<p>The keyvalues are set after context.SaveChanges(). But unfortunately after context.SaveChanges the EntityState.Added is gone.</p>\n"},{"tags":["linq","entity-framework","linq-to-sql","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13255894,"title":"LINQ getting distinct records based on an item value","body":"<p>I have following LINQ query</p>\n\n<pre><code> var unallocatedOrders = (from orderLine in context.OrderLineItemDboes\n     where (orderLine.Status == unallocated || orderLine.Status == null)\n         &amp;&amp; orderLine.orderline.order.order_status_fk == verified\n     group orderLine\n         by new { orderLine.orderline.ol_id,orderLine.orderline.order.order_id }\n         into g\n     select new { OrderLineId = g.Key.ol_id, Count = g.Count(), OrderId = g.Key.order_id })\n .ToList();\n</code></pre>\n\n<p>Above query giving me results in the following way</p>\n\n<pre><code>Order1 ol1 2\norder1 ol2 3\norder1 ol3 1\norder2 ol1 1\norder2 ol2 2\norder3 ol1 4\norder3 ol2 3\norder3 ol3 2\n</code></pre>\n\n<p>I need to iterate through the above list based on order ids and need to fetch corresponding lines and quantity. \nI need to get this line id and quantity to a Dictionary.\nCan somebody suggest how can I get it done.</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13256168,"title":"Entity Framework Entry Change Tracking Issues","body":"<p>I have the Profile model listed below.  This model is sent to the client via an ajax call and then updated and sent back to the server via another ajax call.  </p>\n\n<p>When the client makes changes they are responsible for setting the ObjectState of the model they are working with.  For example if they were changing the  Name property they would set the Name property to the new value and also set the ObjectState property to 2 (Modified) and to add a new Address to the Addresses they would set the ObjectState of the new Address to 1 (Added).  This all works great and the ApiController receives the new Profile object properly.</p>\n\n<pre><code>public enum ObjectState\n{\n    Unchanged = 0,\n    Added = 1,\n    Modified = 2,\n    Deleted = 3\n}\n\npublic interface IObjectState\n{\n    ObjectState ObjectState { get; set; }\n}\n\nstatic class EntityStateHelper\n{\n    public static EntityState ConvertState(ObjectState objectState)\n    {\n        switch (objectState)\n        {\n            case ObjectState.Added:\n                return EntityState.Added;\n            case ObjectState.Deleted:\n                return EntityState.Deleted;\n            case ObjectState.Modified:\n                return EntityState.Modified;\n            default:\n                return EntityState.Unchanged;\n        }\n    }\n}\n\n// Models\npublic class Profile : IObjectState\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public DateTime? BirthDay { get; set; }\n\n    // Navigation Properties\n    public ICollection&lt;Address&gt; Addresses { get; set; }\n\n    public ObjectState ObjectState { get; set; }\n}\n\npublic class Address : IObjectState\n{\n    public int Id { get; set; }\n    public string Street1 { get; set; }\n    public string Street2 { get; set; }\n    public string City { get; set; }\n    public string State { get; set; }\n    public string Zip { get; set; }\n    public ObjectState ObjectState { get; set; }\n}\n</code></pre>\n\n<p>Inside of my ProfileRepository I have actually have separated out Insert and Update and in the case of the Profile object, the client does not have a service call to delete a profile so really all they can do for a profile is modify it.  In my Update method I choose to go with <code>_context.Entry&lt;T&gt;(entity)</code> as apposed to <code>_context.Entry&lt;T&gt;(entity).State = EntityState.Modified</code> cause this throw the exception stating <em>An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key</em>.</p>\n\n<pre><code>public void Update(T entity)\n{\n    _context.Entry&lt;T&gt;(entity);\n    _context.ApplyStateChanges();\n}\n</code></pre>\n\n<p>First let me say that I don't actually have ApplyStateChanges in the Update method but for this sample it will show what is happening.  Below is the code for the ApplyStateChanges method.</p>\n\n<pre><code>public static class DbContextEntensions\n{\n    public static void ApplyStateChanges(this DbContext context)\n    {\n        foreach (var trackableEntry in context.ChangeTracker.Entries&lt;IObjectState&gt;())\n        {\n            IObjectState state = trackableEntry.Entity;\n            trackableEntry.State = EntityStateHelper.ConvertState(state.ObjectState);\n        }\n    }\n} \n</code></pre>\n\n<p>So here is the issue.  Let's say that the Profile at the client is that the Name property is John and the Addresses property contains 1 address.  If the client changes the Name to Steve and modifies the 1 Address all is good cause when ApplyStateChanges get called the DbEntityEntries for each get marked with the proper EntityState.  The problem comes about when the client adds a new Address to the Addresses collection with a State of 1 (Added).  When ApplyStateChanges gets called the call to <code>context.ChangeTracker.Entries&lt;IObjectState&gt;()</code> it does not return the newly added Address as an Entry that has changed by the ChangeTracker.</p>\n\n<p>I am pretty certain that the code <code>_context.Entry&lt;T&gt;(entity)</code> should be <code>_context.Entry&lt;T&gt;(entity).State = EntityState.Modified</code> but I can't seem to get around this exception no matter what I have tried.</p>\n\n<p>I am using EntityFramework 5.0 with .NET 4.0 meaning an EntityFramework version of 4.4.  What am I missing?  I have read what I feel is every article that I can find on the subject and this looks like it should work.  I got this State change tracking code from Julie Lerman's PluralSight video <a href=\"http://pluralsight.com/training/courses/TableOfContents?courseName=efarchitecture&amp;highlight=julie-lerman_efarchitecture-m2-boundedcontext!julie-lerman_efarchitecture-m3-archrepo!julie-lerman_efarchitecture-m4-testing!julie-lerman_efarchitecture-m1-overview#efarchitecture-m2-boundedcontext\" rel=\"nofollow\">Entity Framework in the Enterprise</a>.  </p>\n\n<p>Any help in pointing me in the right direction would be greatly appreciated.  </p>\n"},{"tags":["entity-framework","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":402,"score":2,"question_id":6427208,"title":"Entity Framework only with stored procedures","body":"<p>i have a question about the reasonableness of using entity framework only with stored procedures in our scenario.</p>\n\n<p>We plan to have an N-tier architecutre, with UI, BusinessLayer (BLL), DataAccessLayer(DAL) and a BusinessObjectDefinitions(BOD) layer. The BOD layer is known by all other layers and the results from executes queries in the DAL should be transformed into Objects (definied in the BOD) before passing into the BLL.</p>\n\n<p>We will only use stored procedures for all CRUD methods.\nSo in case of a select stored procedure, we would add a function import, create a complex type and when we execute the function, we tranform the values of the complex type into a class of BOD and pass that to the BLL.\nSo basicly, we have no Entities in the Model, just Complex types, that are transformed into Business Objects.</p>\n\n<p>I'm not sure if that all makes sense, since in my opinion, we lose a lot of the benefit, EF offers.</p>\n\n<p>Or am i totally wrong?</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":52,"score":4,"question_id":13254224,"title":"SQL Order by a float column not working","body":"<p>I have the following rows in my db:</p>\n\n<pre><code>ID       Weight\n-----------------------------\n897      1.46357497509608E-11\n689      6.67145488899268E-12\n896      6.63573718293682E-12\n615      5.14817058560092E-12\n822      5.14806820534293E-12\n</code></pre>\n\n<p>When I execute the following SQL query: </p>\n\n<pre><code>SELECT * \nFROM mytable \nORDER BY weight DESC\n</code></pre>\n\n<p>the data is being returned in the same order.</p>\n\n<p>P.S. the same thing is happening from a Linq query in an ASP.NET C# application</p>\n"},{"tags":["c#","entity-framework","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13255452,"title":"How to change an Entity source table after the context is created?","body":"<p>I have the same problem I explained at <a href=\"http://stackoverflow.com/questions/11142530/change-entity-map-to-another-unknown-table-at-runtime\">Change entity map to another &quot;unknown&quot; table at runtime</a> but now I need it after the context is created. I'm using Code First with EF version 4.1. Do I have to create again the entire context? </p>\n"},{"tags":["entity-framework","asp.net-mvc-4","dbcontext"],"answer_count":5,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":143,"score":5,"question_id":13067793,"title":"Manage the lifetime of dbContext","body":"<p>I would like to tie the lifetime of a dbContext to the lifetime of a session, to - for example - be able to commit or abandon changes on a group of mutations on the dbcontext over multiple requests.</p>\n\n<p>Are there any other (better?) ways to accomplish this? If no, what would be a suitable mechanism to create and dispose of the contexts? I am thinking about static hashtables with cleanup on session end, but maybe I'm doing it All Wrong. I am also thinking about the idea of only holding on to those contexts that have to do work over multiple requests, and keeping the rest per action. Any advice?</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13250882,"title":"Getting a SQL View via Entity Framework returns incorrect result","body":"<p>I have a very simple View in SQL Server which looks something like this, Where the <strong>Show</strong> is a result of <strong>LEFT JOIN</strong> with <strong>Character</strong> table:</p>\n\n<pre><code>+---------+----------+----------------------+  \n|  Name   | Surname  |         Show         |  \n+---------+----------+----------------------+  \n| Enoch   | Thompson | The Boardwalk Empire |  \n| Anthony | Soprano  | The Sopranos         |  \n| Walter  | White    | Breaking Bad         |  \n+---------+----------+----------------------+  \n</code></pre>\n\n<p>When I get this table via Entity Framework's <code>context.CharacterView.ToList()</code> in my application, the result looks like this: </p>\n\n<pre><code>+---------+----------+----------------------+  \n|  Name   | Surname  |         Show         |  \n+---------+----------+----------------------+  \n| Enoch   | Thompson | The Boardwalk Empire |  \n| Anthony | Soprano  | The Boardwalk Empire |  \n| Walter  | White    | The Boardwalk Empire |  \n+---------+----------+----------------------+  \n</code></pre>\n\n<p>However, in DB the CharacterView is <em>as it should be.</em></p>\n\n<hr>\n\n<h2>Create view query</h2>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE VIEW CharacterView AS\nSELECT c.Name AS [Name], \n       c.Surname AS [Surname], \n       s.Name AS [Show]\n\nFROM   [dbo].[Characters] AS c LEFT OUTER JOIN\n       [dbo].[Shows] AS scen ON c.ShowId = s.Id\n</code></pre>\n\n<hr>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12962448,"title":"Populating a property in an Entity when doing a LINQ to Entities query","body":"<p>I have an entity type, let's call it Transaction, created by entity framework version 1. I have added the following property:</p>\n\n<pre><code>public partial class Transaction\n{\n    public int CurrentMaxRevisionNumber { get; set; }\n}\n</code></pre>\n\n<p>And I have the following query:</p>\n\n<pre><code>public List&lt;Transaction&gt; GetTransactions(DateTime startDate, DateTime endDate)\n{\n   var query = from t in Repository.Transaction  \n       let currentMaxRevisionNumber = \n        Repository.Transaction.Where(t1 =&gt; t1.TransactionId == t.TransactionId)\n                               .Max(t1 =&gt; t.RevisionNumber)\n       where t.StartDate &gt;= startDate\n             &amp;&amp; t.EndDate &lt; endDate)\n    select t;\n\n    return query.ToList();\n}\n</code></pre>\n\n<p>The business rules for what we are trying to accomplish are the following:<br>\n- A new record for the transaction on the original date should be created with a code that indicates it has been soft deleted with an increased revision number.<br>\n- A new record for the transaction is to be created on the new date with an increased revision number.</p>\n\n<p>The problem is that the process that determines when the transaction will be processed is done sequentially one day at a time and transactions are being moved from date to date and sometimes back to their original ones constantly. This may result that the max revision number of a given transaction will be the one from the specific date and not the max for the transaction. That is the reason why I am trying to do the \"let\" in the query.</p>\n\n<p>Now the questions:<br>\n- How can I populate the CurrentMaxRevisionNumber property I created in the partial class with the query?<br>\n- Is there maybe another way I can accomplish this without having to do a query for each transaction since there may be several hundreds at any given date?</p>\n\n<p>Thanks for you help.</p>\n"},{"tags":["asp.net-mvc","linq","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13248860,"title":"Querying an auto-generated EF junction table","body":"<p>I have two models, Benefit and SchemeName</p>\n\n<p>Benefit - </p>\n\n<pre><code>[Key]\npublic int BenefitID { get; set; }\npublic string BenefitName { get; set; }\npublic string BenefitDescription { get; set; }\npublic virtual ICollection&lt;SchemeName&gt; SchemeNames { get; set; }\n</code></pre>\n\n<p>SchemeName</p>\n\n<pre><code>[Key]\npublic int SchemeNameID { get; set; }\npublic string Name { get; set; }\npublic virtual ICollection&lt;Benefit&gt; Benefits { get; set; }\n</code></pre>\n\n<p>This has created three tables in the database Benefits, SchemeNames and a joining table called SchemeNameBenefits.</p>\n\n<p>I am trying to populate a droplownlist that contains only the SchemeNames associated with a certain Benefit but am not sure how I can do this, can I reference the join table in my code?</p>\n\n<p>I started with the following (which returns all SchemeNames)</p>\n\n<pre><code>private void PopulatePensionSchemeName(object selectedPensionSchemeName = null)\n        {\n            var schemeNameQuery = from d in db.SchemeNames\n                                  orderby d.SchemeNameID\n                                  select d;\n\n            ViewBag.PensionSchemeNameID = new SelectList(schemeNameQuery, \"SchemeNameID\", \"Name\", selectedPensionSchemeName);\n        }\n</code></pre>\n\n<p>But I'm not sure how I can add this clause. Any pointers?</p>\n"},{"tags":["c#",".net","entity-framework","linq-to-entities","garbage-collection"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":72,"score":3,"question_id":13207390,"title":"How to update an existing object's properties using LINQ to Entities?","body":"<p>LINQ to Entities allows this:</p>\n\n<pre><code>context.User.Select(u =&gt; new Person\n{\n    Name = u.Name,\n    Parent = u.Parent.Name\n});\n</code></pre>\n\n<p>I need only two properties of a big <code>User</code> table and I get them using the <code>Select</code> method to create a <code>Person</code> object so I can do some processing with it. The thing is that I do this a lot (like twice a second) and it hurts the <code>GC</code>.</p>\n\n<p>So I decided to pool the <code>Person</code> objects but I have no idea how to update an existing object using LINQ to Entities. I can get it as an anonymous method like above and then assign its properties to the depooled object I guess, then I can return the depooled instance, this would at least make the anonymous instance go away in a lower generation of <code>GC</code> but...</p>\n\n<p>I'd really prefer something like this:</p>\n\n<pre><code>context.User.Select(u =&gt; People.Take(u.Name, u.Parent.Name))\n</code></pre>\n\n<p>Which throws a <code>NotSupportedException</code>.</p>\n\n<ul>\n<li>Can I use Entity Framework to update the values of an existing object?</li>\n<li>If so, how?</li>\n<li>If not, what alternatives do I have?</li>\n</ul>\n"},{"tags":["entity-framework","custom-attributes"],"answer_count":5,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":6861,"score":10,"question_id":1050714,"title":"Adding custom property attributes in Entity Framework code","body":"<p>Is there any way to add custom attributes to properties in EF generated code?  The only thing I can see as a plausible solution would be to come up with a custom T4 template.  However, because of the nature of the attribute it would be impossible to determine the correct attribute parameter per EF property.  </p>\n"},{"tags":["c#","sql-server","visual-studio","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13253976,"title":"SQL Server Express looking for database in wrong folder","body":"<p>Here is the general problem I'm having:</p>\n\n<p>At work, we have a Visual Studio project that has a SQL project with Entity Framekwork (in addition to a lot of other projects that are class libraries). We are using the same base code for all our projects and just copying it in to a new folder, and adding a new web project and deleting the old web project. We create the database during development automatically if they don't exist already using a DbContext Initializer (it's the <code>DropCreateDatabaseAlways</code> one). Often, whenever this happens and we try to connect to the database, we get the following error:</p>\n\n<p><code>Database 'C:\\\\www\\\\[old project]\\\\app\\\\Web\\\\App_Data\\\\[new project database name from connection string].mdf' already exists. Choose a different database name.\\r\\nCannot attach the file 'C:\\\\www\\\\[new project]\\\\app\\\\Web\\\\App_Data\\\\[new project database name from connection string].mdf' as database '[new project database name]'.\"}</code></p>\n\n<p>It's basically looking in the old folder for the new database, but not actually creating the database like it's supposed to.</p>\n\n<p>Basically it's looking for the database in a different directory than the current project, even though the connection string specifies to attach from the <code>|DataDirectory|</code>. Cleaning the solution, changing the connection string, changing the app.config file, restarting the machine, etc. doesn't help at all. If I rename the folder on the project, it'll work though. </p>\n\n<p>I'm honestly totally flummoxed as to what's going on. I'm fairly competent in and around VS 2010 and SQL Server, so I feel like I should be able to figure out what's going on. It might be something simple that I'm missing, but any help would be appreciated.</p>\n"},{"tags":["entity-framework","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":28,"score":3,"question_id":13253497,"title":"Code first EntityConfiguration","body":"<p>Is it possible to modify / replace an entity configuration in a context that is being inherited in a different context?</p>\n\n<p>Example:  I have Context in a project called Data.Access in a solution called Framework.  Its OnModelCreating function adds entity configurations thusly:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder) \n{\n   // TestEntityConfiguration is the configuration of an entity named TestEntity in the Framework solution\n   modelBuilder.Configurations.Add(new TestEntityConfiguration());\n\n   // multiple other configurations...\n}\n</code></pre>\n\n<p>In another solution called FrameworkConsumer, I have a Local.Data.Access project that has a Context class which extends Context from Data.Access in the Framework solution.  Its OnModelCreating function looks like this:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n   // Adds all the configurations from the Context in Data.Access in the Framework solution\n   base.OnModelCreating(modelBuilder);\n\n   // Other configurations local to the extended context go here...\n}\n</code></pre>\n\n<p>My question is this.  In the Local.Data.Access project in the FrameworkConsumer solution, if I wanted to add extra configuration settings or a different configuration for TestEntity, how can this be accomplished or can it be done?  I've tried adding another configuration however, I get errors stating that this Entity (TestEntity) has already been configured.  For now, my solution to add extra configuration was to use Database.ExecuteSqlCommand in the Dispose function in Local.Data.Access Context class.  Not elegant, but it works.  Any ideas / advice would be appreciated.</p>\n\n<p>Thanks</p>\n"},{"tags":["asp.net-mvc","sql-server-2008","entity-framework","entity-framework-4","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13252472,"title":"Entity Framework import and use stored procedure which returns different result sets depending on input","body":"<p>I am working on a migration project, where I am migrating an web forms app to a ASP.NET MVC 4 app.</p>\n\n<p>I have come across this one scenario with which I need a little help.</p>\n\n<p>In the old web form project I have stored proc like...</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[TestMultipleResultSet]\n    @input VARCHAR\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    IF NOT EXISTS\n    (\n        SELECT * FROM Electronics\n        WHERE name = @input\n    )\n    BEGIN\n        SELECT 101 AS errorcode\n        RETURN\n    END\n\n    SELECT * FROM Electronics \n    WHERE name = @input\nEND\n</code></pre>\n\n<p>like the above <code>if not exist</code> check, there are many other checks with gives different <code>select * from</code> as resultset.</p>\n\n<p>Now I want to use Entity framework to execute this stored procedure, so I imported the function and created a complex type using the <code>Get Column Information</code> + <code>Create Complex Type</code> option which EF provides.</p>\n\n<p>Now it runs when I enter a valid @input which executes <code>SELECT * FROM Electronics WHERE name = @input</code> but when I enter an input which is not present instead of returning me a 101 error code it gives me an error. An exception is thrown.</p>\n\n<p>Exception details</p>\n\n<blockquote>\n  <p>The data reader is incompatible with the specified 'testEFModel.GetTestResults_Result1'. A member of the type, 'id', does not have a corresponding column in the data reader with the same name.</p>\n</blockquote>\n\n<p>How should I solve this ?</p>\n"},{"tags":[".net","visual-studio-2010","entity-framework","visual-studio-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13251958,"title":"Entity Framework update schema without dropping / loosing data","body":"<p>I'm searching if there is a better way than <a href=\"http://stackoverflow.com/questions/3144117/entity-framework-4-update-database-schema-from-model-without-wiping-the-table\">\"Database Generation Power Pack\"</a> to update automatically the Database Schema from an Entity Framework design (Visual Studio 2010) to an MS-SQL Database without dropping any data. In fact, for example, we can't rename or delete a propriety with \"Database Generation Power Pack\".</p>\n\n<p>But, perhaps, it's integrated in Visual Studio 2012?</p>\n"},{"tags":["entity-framework","linq-to-entities","odata"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":29,"score":4,"question_id":13251313,"title":"What type should my list contain?","body":"<p>I have this query</p>\n\n<pre><code>List&lt;int&gt; AuctionIds = \n   (from a in _auctionContext.Auctions\n    where a.AuctionEventId == auction.AuctionEventId\n    select new { a.Id }).ToList();\n</code></pre>\n\n<p>But I receive a compile error</p>\n\n<pre><code>Cannot implicitly convert type 'System.Collections.Generic.List&lt;AnonymousType#1&gt;' to 'System.Collections.Generic.List&lt;int&gt;'\n</code></pre>\n\n<p>What type should AuctionIds be?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":36,"score":-1,"question_id":13251140,"title":"Entity Framework Code First NullReferenceException","body":"<p>I'm using Entity Framework Code First, I've an entity <code>Articolo</code> and <code>ZefiroContext : DbContext</code> which contains the following declaration:</p>\n\n<pre><code>public DbSet&lt;Articolo&gt; Articoli { get; set; }\n</code></pre>\n\n<p>When I run the following code:</p>\n\n<pre><code>var a = new ZefiroContext().Articoli;\nList&lt;Articolo&gt; r;\nif (a != null) \n    r = a.ToList();\nelse\n    r = new List&lt;Articolo&gt;();\n</code></pre>\n\n<p>I get a <code>NullReferenceException</code> at line <code>r = a.ToList();</code>. I have no <code>Articolo</code> entites in my database so I expect my variable <code>r</code> to point to an empty <code>List&lt;Articolo&gt;</code>.</p>\n"},{"tags":["entity-framework","ef-code-first","wcf-ria-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13251147,"title":"Nested object null on client side in CODE FIRST EF RIA Service","body":"<p>I have nested object in EF Code First using Silverlight RIA service, I am able to get the data at service side but when I see it on client side child objects are null. Could you please guide me what's wrong.</p>\n\n<pre><code>[HasSelfValidation]\npublic class Batch\n{\n\n    public int BatchId { get; set; }\n    public string BatchName { get; set; }\n    [Include]\n    [Composition]\n    [Association(\"FK_Batch_BathSetItemSet\", \"BatchId\", \"BatchSetIdItemSetId\")]\n    public virtual ICollection&lt;BatchSetItemSet&gt; BatchSetItemSets { get; set; }\n }\npublic class BatchSetItemSet\n{\n\n    public int BatchSetIdItemSetId { get; set; }\n    public int BatchId { get; set; }\n    public Nullable&lt;int&gt; ItemSetId { get; set; }\n    public string CreatedBy { get; set; }\n    public  Batch Batch { get; set; }\n     [Include]\n     [Composition]\n     [Association(\"FK_BathSetItemSet_ItemSet\", \"BatchSetIdItemSetId\", \"ItemSetId\")]\n    public  ItemSet ItemSet { get; set; }\n}\npublic class ItemSet\n{\n\n    public int ItemSetId { get; set; }\n    public int CustodianId { get; set; }\n    public string ItemSetName { get; set; }\n    public virtual ICollection&lt;BatchSetItemSet&gt; BatchSetItemSets { get; set; }\n    [Include]\n    [Composition]\n    [Association(\"FK_ItemSet_Custodian\", \"ItemSetId\", \"CustodianId\")]\n    public virtual Custodian Custodian { get; set; }\n}\n</code></pre>\n\n<p>and service call is :    <code>this.DbContext.Batches.Include(\"BatchSetItemSets.ItemSet.Custodian\").Where(x =&gt; x.BatchId == batchId).SingleOrDefault();</code>     </p>\n"},{"tags":["entity-framework","ria","lightspeed"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13251136,"title":"EF with KeyTable Sequence style PK","body":"<p>How to implement in EF5 a KeyTable style identity method</p>\n\n<p>\"Uses a table in the database to store the next Id, and advances this value every time a new block of Ids is required\" from <a href=\"http://www.mindscapehq.com/documentation/lightspeed/Controlling-the-Database-Mapping/Identity-Generation\" rel=\"nofollow\">LightSpeed</a></p>\n\n<p>I believe this is like Oracle sequences.</p>\n\n<p>This feels like it should be easy (as it is in LightSpeed).  This gives the ORM an easy way to do bulk inserts ie it can get 10 identities at a time, then do a bulk insert back to the db.</p>\n\n<p>Am using EF5 / WCF RIA Services (latest) talking to Silverlight.  The rest of the project uses bulk insert SSIS stuff.. and the SL project does some inserting.  So I need to follow this convention.  </p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13236116,"title":"Entity framework, problems updating related objects","body":"<p>I am currently working on a project using the latest version of Entity Framework and I have come across an issue which I can not seem to solve.  </p>\n\n<p>When it comes to updating existing objects, I can fairly easily update the object properties ok, until it comes to a property which is a reference to another class.</p>\n\n<p>In the below example I have a class called Foo, which stores various properties, with 2 of these being instances of other classes</p>\n\n<pre><code>public class Foo\n{\n     public int Id {get; set;}\n     public string Name {get; set;}\n     public SubFoo SubFoo {get; set}\n     public AnotherSubFoo AnotherSubFoo {get; set}\n}\n</code></pre>\n\n<p>When I use the below Edit method, I pass in the object I wish to update and I can manage to get the Name to properly update, however I have not managed to find a way in which to get the properties of the SubFoo to change.  For example, if the SubFoo class has a property of Name, and this has been changed and is different between my DB and the newFoo, it does not get updated.</p>\n\n<pre><code>public Foo Edit(Foo newFoo)\n{\n\n        var dbFoo = context.Foo\n                           .Include(x =&gt; x.SubFoo)\n                           .Include(x =&gt; x.AnotherSubFoo)\n                           .Single(c =&gt; c.Id == newFoo.Id);\n\n\n\n        var entry = context.Entry&lt;Foo&gt;(dbFoo);\n        entry.OriginalValues.SetValues(dbFoo);\n        entry.CurrentValues.SetValues(newFoo);\n\n        context.SaveChanges();\n\n        return newFoo;\n}\n</code></pre>\n\n<p>Any help or pointers would be greatly appreciated.</p>\n\n<p>UPDATE:\nBased on the comment by Slauma I have modified my method to </p>\n\n<pre><code>public Foo Edit(Foo newFoo)\n{\n\n        var dbFoo = context.Foo\n                           .Include(x =&gt; x.SubFoo)\n                           .Include(x =&gt; x.AnotherSubFoo)\n                           .Single(c =&gt; c.Id == newFoo.Id);\n\n\n\n        context.Entry(dbFoo).CurrentValues.SetValues(newFoo);\n        context.Entry(dbFoo.SubFoo).CurrentValues.SetValues(newFoo.SubFoo);\n\n        context.SaveChanges();\n\n        return newFoo;\n}\n</code></pre>\n\n<p>When running this now, I get the error </p>\n\n<pre><code>'The entity type Collection`1 is not part of the model for the current context.'\n</code></pre>\n\n<p>To try and get around this, I added code to try to attach the newFoo subclasses to the context, but this through an error saying that the ObjectManager already had an entity the same</p>\n\n<pre><code>An object with the same key already exists in the ObjectStateManager. The \nObjectStateManager cannot track multiple objects with the same key\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4.3"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":332,"score":5,"question_id":10623260,"title":"How can I disable model compatibility checking in Entity Framework 4.3?","body":"<p>I'm working with EF 4.3 and have a context which needs to talk to a database which was generated by another library using EF Code First 4.3.  The context is throwing an exception stating </p>\n\n<pre><code>The model backing the 'Context' context has changed since the\ndatabase was created. Consider using Code First Migrations to update \nthe database\n</code></pre>\n\n<p>In EF 4.1 this could be diabled by removing the <code>IncludeMetadataConvention</code> from the ModelBuilder.  However, in 4.3 this convention has been deprecated and no longer has an effect.</p>\n\n<p>How can I have an EF 4.3 context talk to an EF 4.3-generated database <em>built by a different context</em>?  The only option I've found (which is far from ideal) is to delete the metadata table, thereby causing <em>both</em> contexts to assume the database was not build by EF.</p>\n\n<p><strong>PS:</strong> I know this scenario is likely to raise questions about <em>why</em> I need to do this; I know it's far from ideal, but rest assured it's a problem I need to solve and have limited options to work with laterally.</p>\n"},{"tags":["c#","asp.net","asp.net-mvc","entity-framework","visual-studio-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13251060,"title":"EF 4: System.Data.Entity.Edm.EdmEntityType: Name: Each type name in a schema must be unique","body":"<p>I want to use EF code first approach.</p>\n\n<p>I have read this post:</p>\n\n<p><a href=\"http://weblogs.asp.net/scottgu/archive/2010/07/16/code-first-development-with-entity-framework-4.aspx\" rel=\"nofollow\">http://weblogs.asp.net/scottgu/archive/2010/07/16/code-first-development-with-entity-framework-4.aspx</a></p>\n\n<p>and created my BL classes</p>\n\n<pre><code>public class AppData\n{\n    public string Id { get; set; }\n\n    public string Url { get; set; }\n\n    public AppData_OptionsDialog OptionsDialog { get; set; }\n\n    public AppData_Compatibility Compatibility { get; set; }\n\n}\n\npublic class AppData_Compatibility\n{\n    public int Id { get; set; }\n\n    public string Platform { get; set; }\n\n    public string MaxVersion { get; set; }\n}\n\n\npublic class AppData_OptionsDialog\n{\n\n    public int Id { get; set; }\n\n    public string DisplayName { get; set; }\n\n    public string AppDesc { get; set; }\n\n    public string PrivacyPolicyUrl { get; set; }\n\n    public string TermsOfUseUrl { get; set; }\n\n}\n\n\npublic class AppsDataContext : System.Data.Entity.DbContext\n{\n    public AppsDataContext() : base(\"MaMDB\") { }\n\n    public DbSet&lt;Conduit.Mam.Common.BlData.AppsData.AppData&gt; AppsData { get; set; }\n\n    public DbSet&lt;Conduit.Mam.Common.BlData.AppsData.AppData_Compatibility&gt; AppData_Compatibilities { get; set; }\n\n    public DbSet&lt;Conduit.Mam.Common.BlData.AppsData.AppData_OptionsDialog&gt; AppData_OptionsDialogs { get; set; }       \n}\n</code></pre>\n\n<p>I have created corrisponding tables in the DB.</p>\n\n<p>I understand EF uses convention over configuration.</p>\n\n<p>So is it magically maps the classes to the DB? no need to generate an em</p>\n\n<p>I try to execute a test on of the methods:</p>\n\n<pre><code>    public IList&lt;Conduit.Mam.Common.BlData.AppsData.AppData&gt; GetAll()\n    {\n        var apps = from app in AppsDataContext.AppsData\n               select app;\n\n        return apps.ToList();\n    }\n</code></pre>\n\n<p>but get the following error:</p>\n\n<blockquote>\n  <p>One or more validation errors were detected during model generation:</p>\n  \n  <p>\\tSystem.Data.Entity.Edm.EdmEntityType: Name: Each type name in a\n  schema must be unique. Type name 'AppData_OptionsDialog' is already\n  defined. \\tSystem.Data.Entity.Edm.EdmEntityType: Name: Each type name\n  in a schema must be unique. Type name 'AppData_Compatibility' is\n  already defined.</p>\n</blockquote>\n\n<p>I have seen this answer, but it didn't help me</p>\n\n<p><a href=\"http://stackoverflow.com/questions/979664/entity-framework-error-the-entitycontainer-name-must-be-unique\">Entity Framework error - &quot;The EntityContainer name must be unique&quot;</a></p>\n"},{"tags":["asp.net-mvc","performance","entity-framework","iis","entity-framework-5"],"answer_count":0,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":64,"score":5,"question_id":13250679,"title":"How to \"warm-up\" Entity Framework? When does it get \"cold\"?","body":"<p>No, the answer to my second question is not the winter.</p>\n\n<p><strong>Preface:</strong></p>\n\n<p>I've been doing a lot of research on Entity Framework recently and something that keeps bothering me is its performance when the queries are not warmed-up, so called cold queries. </p>\n\n<p>I went through the <a href=\"http://msdn.microsoft.com/en-us/data/hh949853.aspx\">performance considerations</a> article for Entity Framework 5.0. The authors introduced the concept of <strong>Warm</strong> and <strong>Cold</strong> queries and how they differ, which I also noticed myself without knowing of their existence. Here it's probably worth to mention I only have six month of experience behind my back.</p>\n\n<p>Now I know what topics I can research into additionally if I want to understand the framework better in terms of performance. Unfortunately most of the information on the Internet is outdated or bloated with subjectivity, hence my inability to find any additional information on the <em>Warm</em> vs <em>Cold</em> queries topic.</p>\n\n<p>Basically what I've noticed so far is that whenever I have to recompile or the recycling hits in, my initial queries are getting very slow. Any subsequent data read is fast (<em>subjective</em>), as expected.</p>\n\n<p>We'll be migrating to Windows Server 2012, IIS8 and SQL Server 2012 and as a Junior I actually won myself the opportunity to test them before the rest. I'm very happy they introduced a warming-up module that will get my application ready for that first request. However, I'm not sure how to proceed with warming up my Entity Framework.</p>\n\n<p>What I already know is worth doing:</p>\n\n<ul>\n<li>Generate my Views in advance as suggested.</li>\n<li>Eventually move my models into a separate assembly.</li>\n</ul>\n\n<p>What I consider doing, by going with common sense, <strong>probably wrong approach</strong>:</p>\n\n<ul>\n<li>Doing dummy data reads at Application Start in order to warm things\nup, generate and validate the models.</li>\n</ul>\n\n<p><strong>Questions:</strong> </p>\n\n<ul>\n<li>What would be the best approach to have high availability on my Entity Framework at anytime?</li>\n<li>In what cases does the Entity Framework gets \"cold\" again? (Recompilation, Recycling, IIS Restart etc.)</li>\n</ul>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":26,"score":3,"question_id":13249888,"title":"How do I save object to database using EF and get primary key created back from database?","body":"<p>I'm developing a WCF JSon Web service with C#, .NET Framework 4.0, using <code>Entity Framework</code> to access database.</p>\n\n<p>I have to create a new <code>EReportDB.EReport</code> object, fill it, save it on database and get its new pk <code>EReportDb.Ereport.eReportId</code>.</p>\n\n<p>This is my code, but I don't know how to do it:</p>\n\n<pre><code>    public bool SaveEReport(EReportContract eContractReport)\n    {\n        if (eContractReport == null)\n            throw new ArgumentNullException(\"eContractReport\", \"SaveEReport: eReport is null\");\n\n        using (EReportDB.EReportEntities context = new EReportDB.EReportEntities())\n        {\n            EReportDB.EReport eReport = new EReportDB.EReport();\n            eReport.orderId = eContractReport.orderId;\n            eReport.timeIn = DateTime.Parse(eContractReport.timeIn, new CultureInfo(\"en-GB\", false));\n            eReport.timeOut = DateTime.Parse(eContractReport.timeOut, new CultureInfo(\"en-GB\", false));\n            eReport.isProducFact = eContractReport.isProducFact;\n            /*\n              ..snip..\n            */\n            eReport.olPkSizeRs_ = eContractReport.olPkSizeRs;\n            eReport.olPkWeightRs = eContractReport.olPkWeightRs;\n        }\n        return false;\n    }\n</code></pre>\n\n<p><strong>How can I do that?</strong></p>\n"},{"tags":[".net","entity-framework","collections","poco","automapper"],"answer_count":3,"favorite_count":8,"up_vote_count":16,"down_vote_count":0,"view_count":3510,"score":16,"question_id":3441916,"title":"Automapper : mapping issue with inheritance and abstract base class on collections with Entity Framework 4 Proxy Pocos","body":"<p>I am having an issue using AutoMapper (which is an excellent technology) to map a business object to a DTO where I have inheritance off of an abstract base class within a collection.</p>\n\n<p>Here are my objects:</p>\n\n<pre><code>abstract class Payment\nclass CashPayment : Payment\nclass CreditCardPayment : Payment\n</code></pre>\n\n<p>I also have an invoice object which contains a collection of payments like so:</p>\n\n<pre><code>    public class Invoice\n    {\n       ... properties...\n\n       public ICollection&lt;Payment&gt; Payments { get; set; }\n    }\n</code></pre>\n\n<p>I also have corresponding DTO versions of each of these objects.</p>\n\n<p>The DtoInvoice object is defined as:</p>\n\n<pre><code>[DataContract]\npublic class DtoInvoice\n{\n   ...properties...\n\n   [DataMember]\n   public List&lt;DtoPayment&gt; Payments { get; set; }\n}\n</code></pre>\n\n<p>This is what my Mapper definitions look like:</p>\n\n<pre><code>Mapper.CreateMap&lt;Invoice, DtoInvoice&gt;();\n\nMapper.CreateMap&lt;Payment, DtoPayment&gt;()\n  .Include&lt;CashPayment, DtoCashPayment&gt;()\n  .Include&lt;CreditCardPayment, DtoCreditCardPayment&gt;();\n\nMapper.CreateMap&lt;CashPayment, DtoCashPayment&gt;();\nMapper.CreateMap&lt;CreditCardPayment, DtoCreditCardPayment&gt;();\n</code></pre>\n\n<p>The code to perform the mapping looks like this:</p>\n\n<pre><code>var invoice = repo.GetInvoice(invoiceId);\n\nvar dtoInvoice = Mapper.Map&lt;Invoice, DtoInvoice&gt;(invoice);\n</code></pre>\n\n<p>So for example if my invoice object contains a collection of specific payments (say 1 cash and 1 credit card) when mapper tries to map them I get an error that the abstract class Payment cannot be created. If I remove the abstract keyword from the Payment object then the code works but I only get a collection of Payment object, I do not get their specific objects (Cash &amp; Credit Card payments).</p>\n\n<p>So the question is: How can I get AutoMapper to map the specific payment types and not the base class?</p>\n\n<hr>\n\n<p><strong>Update</strong></p>\n\n<p>I did some more digging and think I see a problem but am not sure how I can solve this with AutoMapper. I think this is more of an EF thing and not AutoMapper's fault. :-)</p>\n\n<p>In my code I am using Entity Framework 4 Proxy POCOs with lazy loading.</p>\n\n<p>So when I try to map an entity returned from EF that is a proxy POCO it gets that funny looking type like:</p>\n\n<pre><code>System.Data.Entity.DynamicProxies.CashPayment_86783D165755C316A2F58A4343EEC4842907C5539AF24F0E64AEF498B15105C2\n</code></pre>\n\n<p>So my theory is that when AutoMapper tries to map CashPayment to DtoCashPayment and the payment passed in is of the proxy type AutoMapper sees it as a \"non match\" and then maps the generic Payment type. But since Payment is an abstract class AutoMapper bombs with a \"System.InvalidOperationException: Instances of abstract classes cannot be created.\" exception.</p>\n\n<p>So the question is: Is there a way for me to use AutoMapper to map EF POCO proxy objects to Dtos.</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","ef-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13155292,"title":"Ignore pending migrations after database recreation","body":"<p>We am using code first EF 4.3.1 with database migrations. Sometimes we drop the database and let EF recreate it, mainly for local development purposes. </p>\n\n<p>There is a procedure which applies pending migrations and when the database is recreated the pending migrations aren't necessary and error is thrown when EF tries to apply them.</p>\n\n<p>I check the migration date from the string and if this is before the database creation date then I manually add it to the __migrationHistory table and don't apply the migration.</p>\n\n<p>This covers most of the scenarios except when someone recreates the database, updates from source control and retrieves oustanding migrations which are before the database creation date.</p>\n\n<p>I have also tried using a try catch around the dbMigrator.Update(migration) method call but if one migrations fails, further ones won't be applied as it remembers the exceptions.</p>\n\n<p>Has anyone found a way to get around this issue?</p>\n\n<p>This is the method I have written:</p>\n\n<pre><code>private static void ApplyMigration&lt;T, TU&gt;()\nwhere T : DbContext, new()\nwhere TU : DbMigrationsConfiguration, new()\n{\n    var migrationsAlreadyApplied = new List&lt;string&gt;();\n    var dbMigrator = new DbMigrator(new TU());\n\n    var creationMigrationId = dbMigrator.GetDatabaseMigrations().Single(m =&gt; m.Contains(\"InitialCreate\"));\n    var dbDateCreated = DateTime.ParseExact(creationMigrationId.Substring(0, 12), Constants.MigrationDateFormat, CultureInfo.InvariantCulture);\n\n    dbMigrator.GetPendingMigrations().ToList()\n                                    .ForEach(migration =&gt;\n                                    {\n                                        var migrationDate = DateTime.ParseExact(migration.Substring(0, 12), Constants.MigrationDateFormat, CultureInfo.InvariantCulture);\n\n                                        if (migrationDate &gt; dbDateCreated)\n                                            dbMigrator.Update(migration);\n                                        else\n                                            migrationsAlreadyApplied.Add(migration);\n                                    });\n\n    using (var dbContext = new T())\n    {\n        foreach(var migration in migrationsAlreadyApplied)\n            dbContext.Database.ExecuteSqlCommand(\"insert into __MigrationHistory \"\n                      + \"select '\" + migration + \"', Model, ProductVersion \"\n                      + \"from __MigrationHistory \"\n                      + \"where MigrationId = '\" + migration + \"'\");\n    }\n}\n</code></pre>\n"},{"tags":[".net","entity-framework","enterprise-library"],"answer_count":4,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":176,"score":2,"question_id":12282427,"title":"Transient Fault Handling with SQL Azure using Entity Framework","body":"<p>I currently use SQL Azure and Entity SQL in my application.</p>\n\n<p>e.g.</p>\n\n<pre><code>Entities model = new Entities();\ndb_Item item = model.db_Item.First();\n</code></pre>\n\n<p>Now I want to use the Transient Fault Handling out of the Enterprise Library but there are no examples or solutions that I can find that would allow me to do something like override the Entities class, so I don't have to update my code in hundreds of places.</p>\n\n<p>Could someone please provide more information on how this could be done?</p>\n"},{"tags":["c#",".net","linq","entity-framework","linq-to-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13248360,"title":"Retrieving Data from database within the last 7 days using linq","body":"<p>I have a <code>view</code> with data and I need to retrieve data only from the last 7 days. I know there is a function for this if I was using sql query. but I'm using Linq. </p>\n\n<p>here is my code:</p>\n\n<pre><code>                try\n                {\n                var query = (from bwl in mg.BarcodeWithLocation\n                             select new\n                             {\n                                 RequestID = bwl.RequestID,\n                                 Barcode = bwl.Barcode,\n                                 adrid = bwl.AdrID,\n                                 name = bwl.Name,\n                                 street = bwl.Street,\n                                 houseno = bwl.HouseNo,\n                                 postal = bwl.Postal,\n                                 city = bwl.City,\n                                 country = bwl.Country,\n                                 latitudetxt = bwl.Latitude == \"\" ? \"Location Unknown\" : \"View Map Location\",\n                                 latitude = bwl.Latitude,\n                                 longitude = bwl.Longitude,\n                                 date = bwl.ReceivedDate\n                             });\n\n                this.Grid.DataSource = query;\n                this.Grid.DataBind();\n                }\n                catch (Exception exception)\n                {\n                      Console.WriteLine(\"ERROR in GetNoLocationScan() method. Error Message : \" + exception.Message);\n                }\n</code></pre>\n\n<p>can anyone tell me how I do this in Linq ?</p>\n"},{"tags":["c#","entity-framework","ef-code-first","msdtc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12864594,"title":"EntityFramework CodeFirst and EDMX together in TransactionScope","body":"<p>I need to combine in one application </p>\n\n<ol>\n<li>code generated from DB to EDMX file before compilation and</li>\n<li>code generated and compiled during runtime by application itself, where generated code uses CodeFirst to access DB.</li>\n</ol>\n\n<p>Remark: Codes in 1. and 2. have different DbContexts, access same database, but different tables.</p>\n\n<p>It looks, that when I am using instances of type 1. and 2. in different transaction scopes, everything works fine. But when I try to use them together in one transaction scope, I get error (in case when EDMX is called first)</p>\n\n<pre><code>System.Reflection.TargetInvocationException: Exception has been thrown by the ta\nrget of an invocation. ---&gt; System.Data.ProviderIncompatibleException: An error\noccurred while getting provider information from the database. This can be cause\nd by Entity Framework using an incorrect connection string. Check the inner exce\nptions for details and ensure that the connection string is correct. ---&gt; System\n.Data.ProviderIncompatibleException: **The provider did not return a ProviderManif\nestToken string.** ---&gt; System.Transactions.TransactionException: **The operation is\n not valid for the state of the transaction.**\n</code></pre>\n\n<p>and error (in case when CodeFirst is used first)</p>\n\n<pre><code>System.Data.MetadataException: Schema specified is not valid. Errors:\n(0,0) : error 0175: **The specified store provider cannot be found in the configur\nation, or is not valid.**\n   at System.Data.Metadata.Edm.StoreItemCollection.Loader.ThrowOnNonWarningErrors()\n</code></pre>\n\n<p>To complicate my situation even more I have to add this: described behaviour I have only in case when DB is on remote server. If I am working with local DB, everything looks OK. My suspicion is that Distributed Transaction Coordinator can play its role...</p>\n\n<p>Main question: is it possible to combine EDMX and CodeFirst in one TransactionScope. If yes then how?</p>\n\n<p>Any help would be appreciated. Milos</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":187,"score":0,"question_id":11269822,"title":"The type initializer for threw an exception in entity framework model?","body":"<p>I have 2 projects A and B<br>\neach project has its own database and connect to it using entity framework and each project is working well alone<br>\nMy problem is that when I use the project B as a library inside the project A It gives me \"The type initializer for (MYCLASS) threw an exception\"<br>\nyou should know that (MYCLASS): is an Entity inside the project B</p>\n"},{"tags":["visual-studio","entity-framework","visual-studio-2012","edmx"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":151,"score":0,"question_id":12726586,"title":"Edmx designer and item template missing from VS2012","body":"<p>I am nearly sure this was available and working before, but at this site I have a very recent upgrade from VS2010 to VS2012. I find that if I double click an .edmx file, it by default opens in an XML editor. Also, the Enterprise Data Model item template is missing, so I must open the project in VS2010 just to add a new data model. Are there any known issues that could cause this?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13246731,"title":"Entity Framework without csdl and ssdl?","body":"<p>can we use entity framework without specifying csdl and ssdl, by just specifying mapping in the msl?</p>\n\n<p>can anyone suggest on an approach if i want to avoid csdl and ssdl? \nwhat we want is just to have mapping specified in the msl?</p>\n\n<p>I am new to EF so please bear with me if this question sounds absurd!!</p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":2,"up_vote_count":16,"down_vote_count":0,"view_count":6633,"score":16,"question_id":3377821,"title":"Entity Framework: How can I tell what version I am using?","body":"<p>I believe there are two versions 1 and 2? And version 2 is referred to as Entity Framework 4.0?</p>\n\n<p>How can I tell what version is being used in an application? </p>\n\n<p>This is in my web.config does this mean I am using version 2?</p>\n\n<pre><code>&lt;add assembly=\"System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n</code></pre>\n"},{"tags":["entity-framework","entity"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13244263,"title":"Entity Framework, mapping entity","body":"<p>I have Product table that have category1 and category2 field,</p>\n\n<p>and each field contain a number(ID) that indicate Category Table ID (FK).</p>\n\n<p>and I want to add entity for set category name when I retrieve data, but I don't know how to make category1_name and category2_name can have category name. (very hard to explain =3)</p>\n\n<p>EX)</p>\n\n<pre><code>public class Product\n{\n  [Key]\n  public int no {get; set;}\n  public int category1 {get; set;}  // category table ID number\n  public int category2 { get; set;} // category table ID number\n\n  public virtual Category category1_name {get; set;}\n  public virtual Category category2_name {get; set;}\n}\n\n\npublic class Category\n{\n  [Key]\n  public int no {get; set;}\n  public string category {get; set;}\n}\n</code></pre>\n\n<p>But when I try to retrieve data, I got an error,</p>\n\n<p><strong>Unknown column 'Extent1.category1_name_no' in 'on clause'</strong></p>\n\n<p>How can I mapping the category1_name to category table ID?</p>\n"},{"tags":["c#","entity-framework","exception-handling","assembly-references","csharpcodeprovider"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13235583,"title":"CSharpProvider runtime compilation failing to find a DLL","body":"<p>I am compiling a DLL at runtime using CSharpCodeProvider. My code runs fine on some machines but on otherse it fails with the following error:</p>\n\n<blockquote>\n  <p>error CS0006: Metadata file 'EntityFramework.dll' could not be found</p>\n</blockquote>\n\n<p>Here is a code snippet:</p>\n\n<pre><code>var csFile = ... // the file is in C:\\Program Data\\MyFolder\\InnerFolder\nusing (var provider = new CSharpCodeProvider())\n{\n    var parameters = new CompilerParameters\n    {\n        GenerateInMemory = false, // we want the dll saved to disk\n        GenerateExecutable = false,\n        CompilerOptions = \"/target:library\",\n\n        // the assembly is compiled to the same directory as the .cs file\n        OutputAssembly = GetNewCacheAssemblyPath(),\n    };\n\n    parameters.ReferencedAssemblies.AddRange(new[]\n        {\n            \"System.dll\", \n            \"System.Data.dll\", \n            \"System.Data.Entity.dll\", \n            \"EntityFramework.dll\",\n        });\n\n    var compilerResult = provider.CompileAssemblyFromFile(parameters, csFile);\n}\n</code></pre>\n\n<p>Any thoughts as to why this might be happening?</p>\n"},{"tags":["linq","entity-framework","linq-to-entities"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":146,"score":0,"question_id":9234265,"title":"LINQ to compare item in one list to any item in another","body":"<p>i wonder if someone could help me... Is there a LINQ query that will return a bool if any item from one IList&lt;> is contained int another IList&lt;>. These IList&lt;>'s are object and i need to compare one a single property of the object, the \"Name\" property in this case?</p>\n\n<p>Is there a LINQ query that can do this? If so could someone show me the correct implementation?</p>\n\n<p>Thank you</p>\n"},{"tags":["entity-framework","repository-pattern","unit-of-work"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13241682,"title":"Unit of Work, Generic Repository, EF 5.0 large number of records","body":"<p><strong>As per the profiler below, even with lazy loading being disabled, my query is taking a long time to return results:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/oKuIk.jpg\" alt=\"enter image description here\"></p>\n\n<p><strong>Here s my query:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/PurQu.jpg\" alt=\"enter image description here\"></p>\n\n<p><strong>Here is my repository, where I am doing something ridiculous, taking only ONE record:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/6vsJ6.jpg\" alt=\"enter image description here\"></p>\n\n<hr>\n\n<p>Questions:</p>\n\n<hr>\n\n<ol>\n<li><p>Could someone tell me what would be the correct procedure to take say, 100 records and return them as fast as possible so the user will not have to wait long (while using the Unit of Work / Repository pattern)?</p></li>\n<li><p>How would EF know how to paginate this info to a grid so the next batch of 100 records are available to the user, and the next batch, and so on?</p></li>\n</ol>\n\n<p><strong>I do not understand if I have .Take(1) why is the profiler returning 73,722 rows?</strong></p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13236272,"title":"How to access related objects after using statement has finished in Entity Framework?","body":"<p>I use the EF 3.5 in VS 2010. I have a method which returns a struct. In the struct there is an object armatuur. When the struct is returned i want to access the related objects from the armatuur instance.</p>\n\n<p>However</p>\n\n<p>the method returning the struct:</p>\n\n<pre><code>public LampPostDetail getLamppostInfo(int id)\n{\n    LampPostDetail lpd;\n\n    lpd.xPos = 0;\n    lpd.ypos = 0;\n    lpd.armatuur = new Armatuur();\n\n    //get the info from object\n    using (var db = new OvisionDBEntities())\n    {\n        var objects = from o in db.Objects\n                      where o.ObjectId == id\n                      select o;\n\n        foreach (OVSL.Data.Object o in objects)\n        {\n            lpd.xPos = o.XCoordinatie;\n            lpd.ypos = o.YCoordinatie;\n            lpd.armatuur = o.Armatuur; //which is a table in my db\n        }\n\n        return lpd;\n    }\n}\n</code></pre>\n\n<p>struct:</p>\n\n<pre><code>public struct LampPostDetail\n{\n    #region [ Data Members (14)]\n    //lamppost info\n    public double? xPos;\n    public double? ypos;\n\n    //a lamppost can have several armaturen\n    public OVSL.Data.Armatuur armatuur; //is a table in my db\n\n    #endregion [ Data Members ]\n}\n</code></pre>\n\n<p>when doing this in my client:</p>\n\n<pre><code> LampPostDetail lpd = client.getLamppostInfo(id);\n string brand = lpd.armatuur.producer.name; //producer is related object of armatuur\n</code></pre>\n\n<p>I get a ObjectDisposedException. I understand that this happens because the LampPostDetail object is disposed after the using block is finished. But how do i get this to work? Retrieving all information I need (like brand name e.g.) before I return it to the client is not not an option.</p>\n"},{"tags":["entity-framework","nhibernate","repository","repository-pattern","specification-pattern"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13230509,"title":"EF repository implementation to NHib","body":"<p>Below is an implementation for a generic repository desgned for use with Entity Framework. Ignoring its 'goodness' or 'badness' for this exercise...</p>\n\n<p>What would the code look like for this in NHibernate?</p>\n\n<p>Cheers,<br>\nBerryl</p>\n\n<pre><code>public class Repository&lt;T&gt; : IRepository&lt;T&gt; \nwhere T : class\n{\nprotected ObjectContext Context;\nprotected ObjectSet&lt;T&gt; QueryBase;\n\npublic Repository(ObjectContext context)\n{\n    Context = context;\n    QueryBase = context.CreateObjectSet&lt;T&gt;();\n}\n\npublic IEnumerable&lt;T&gt; Matches(ICriteria&lt;T&gt; criteria)\n{\n    var query = criteria.BuildQueryFrom(QueryBase);\n    return query.ToList();\n}\n\npublic void Save(T entity)\n{\n    QueryBase.AddObject(entity);\n}\n</code></pre>\n\n<h1>NOTE</h1>\n\n<p>This is NOT a question about how to design a repository or whether to use one or not. Just a straight forward translation from EF to NHib...</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":31,"score":1,"question_id":13241934,"title":"linq to entities cannot convert type Icollection to type List","body":"<p>I'm using Entity Framework.\nI have the following entities:</p>\n\n<pre><code>public class Articolo\n{\n    ..\n    public virtual ICollection&lt;Fornitore&gt; Fornitori { get; set; }\n}\n\npublic class Fornitore\n{\n  ...\n   public virtual ICollection&lt;Articoli&gt; Articoli { get; set; }    }\n</code></pre>\n\n<p>the following code:</p>\n\n<pre><code>List&lt;Fornitore&gt; result = new List&lt;Fornitore&gt;();\nvar r = zefiroContext.Articoli.Where(p =&gt; p.Id == IdArticolo).Select(p =&gt; p.Fornitori).ToList();\nresult = r;\n</code></pre>\n\n<p>gives a compiler error:</p>\n\n<blockquote>\n  <p>Cannot implicitly convert type 'System.Collections.Generic.List &lt;\n  System.Collections.Generic.ICollection &lt; prova2.Model.Fornitore>>' to\n  'System.Collections.Generic.List &lt; prova2.Model.Fornitore>'</p>\n</blockquote>\n\n<p>how can I get my <code>List &lt; Fornitore &gt;</code> ?</p>\n"},{"tags":["asp.net","json","asp.net-mvc-3","entity-framework","json.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13241404,"title":"Converting Entity Framework object to JSON (without object graph)","body":"<p>Suppose I have a object structure like this </p>\n\n<pre><code>Library 1 ---- 1+ Book 1 ---- 1+ Page\n</code></pre>\n\n<p>I want to serialize a json object of a book with an array of page objects.</p>\n\n<p>Using JSON.net serializer, I can get this to serialize without getting a circular reference, but the JSON still includes all of the properties of the book in each page, which includes data about the library...which can have data on other books which is a ton of noise.</p>\n\n<p>From the answer from this question - <a href=\"http://stackoverflow.com/questions/657939/serialize-entity-framework-objects-into-json\">Serialize Entity Framework objects into JSON</a>, I know that I can do generics, but is this really the only way? This just seems like a ton of extra work. Especially if for a Json result that is Book with and array of page objects in it.</p>\n\n<p>I am using Entity Framework 4.3.1 and Json.net 4.0.30319...</p>\n"},{"tags":[".net","entity-framework","postgresql","ado.net"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":5721,"score":3,"question_id":1576067,"title":"Entity Framework ObjectContext -> raw SQL calls to native DBMS","body":"<p>I have an app using the ADO.NET entity framework (the VS2008 version, not the newer, cooler one) and I need to be able to make a call down to the underlying DBMS (it's postgres) in order to call some SQL that Entity Framework doesn't support. </p>\n\n<p>Is there a way to go from an Entity Framework ObjectContext to something that will let me execute raw SQL? (I need to run a TRUNCATE TABLE before inserting)  I'm OK with a hacky solution (e.g. pull out the DBMS's connection string info from EF, and use that to create a connection using the postgres ADO.NET provider) but don't want to manage two sets of connection strings (one for entity framework, one for ADO.NET).</p>\n\n<p>I'm aware of the limitatons of Entity Framework's first version, but it's not worth the investment required to switch this app to another ORM, and using EF 4.0 isn't an option either.</p>\n\n<p>Any ideas?</p>\n\n<p>BTW, this is the same question as <a href=\"http://stackoverflow.com/questions/915329/is-it-possible-to-run-native-sql-with-entity-framework\">http://stackoverflow.com/questions/915329/is-it-possible-to-run-native-sql-with-entity-framework</a>, but the workaround described in that answer won't work for me since I really do need to execute raw SQL.</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13238758,"title":"Add a where clause specific to an included Entity","body":"<p>My data model has a number of tables with a common parent. I am using Entity Framework and have a navigation property from the child object back to the parent, and not the other way. The reason for this is there will be 100's of children of this common parent. The where criteria for every report will be the same, as an example:</p>\n\n<pre><code> crudEngine.Read&lt;ChildEntity&gt;()\n   .Include(parameters =&gt; parameters.ParentEntity)\n   .Where(parameter =&gt; parameter.ParentEntity.LastUser.Contains(searchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"year\", parameter.ParentEntity.CreationDate) == intSearchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"month\", parameter.ParentEntity.CreationDate) == intSearchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"day\", parameter.ParentEntity.CreationDate) == intSearchText) ||\n         (isDate &amp;&amp; SqlFunctions.DateAdd(\"dy\", SqlFunctions.DateDiff(\"dy\", \"1900-01-01\", parameter.ParentEntity.CreationDate), \"1900-01-01\") == dateSearchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"year\", parameter.ParentEntity.LastModifiedDate) == intSearchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"month\", parameter.ParentEntity.LastModifiedDate) == intSearchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"day\", parameter.ParentEntity.LastModifiedDate) == intSearchText) ||\n         (isDate &amp;&amp; SqlFunctions.DateAdd(\"dy\", SqlFunctions.DateDiff(\"dy\", \"1900-01-01\", parameter.ParentEntity.LastModifiedDate), \"1900-01-01\") == dateSearchText) ||\n          parameter.ParentEntity.CreationUser.Contains(searchText) ||\n          parameter.ParentEntity.Description.Contains(searchText)...\n</code></pre>\n\n<p>This same criteria will be used for every child entity that references <code>ParentEntity</code>. If possible, I would like to somehow separate this where section into its own function like this:</p>\n\n<pre><code>private Predicate&lt;ParentEntity&gt; GetParentWhere(string searchText)\n    {\n        int intSearchText;\n        bool isInt = int.TryParse(searchText, out intSearchText);\n\n        DateTime dateSearchText;\n        bool isDate = DateTime.TryParse(searchText, out dateSearchText);\n\n        SubmissionStatus submissionStatus;\n        bool isStatus = Enum.TryParse(searchText, true, out submissionStatus);\n\n        return parent =&gt;                \n               (isInt &amp;&amp; SqlFunctions.DatePart(\"year\", parent.CreationDate) == intSearchText) ||\n               (isInt &amp;&amp; SqlFunctions.DatePart(\"month\", parent.CreationDate) == intSearchText) ||\n               (isInt &amp;&amp; SqlFunctions.DatePart(\"day\", parent.CreationDate) == intSearchText) ||\n               (isDate &amp;&amp; SqlFunctions.DateAdd(\"dy\", SqlFunctions.DateDiff(\"dy\", \"1900-01-01\", parent.CreationDate), \"1900-01-01\") == dateSearchText) ||\n               (isInt &amp;&amp; SqlFunctions.DatePart(\"year\", parent.LastModifiedDate) == intSearchText) ||\n               (isInt &amp;&amp; SqlFunctions.DatePart(\"month\", parent.LastModifiedDate) == intSearchText) ||\n               (isInt &amp;&amp; SqlFunctions.DatePart(\"day\", parent.LastModifiedDate) == intSearchText) ||\n               (isDate &amp;&amp; SqlFunctions.DateAdd(\"dy\", SqlFunctions.DateDiff(\"dy\", \"1900-01-01\", parent.LastModifiedDate), \"1900-01-01\") == dateSearchText) ||\n               parent.CreationUser.Contains(searchText) ||\n               parent.Description.Contains(searchText) ||\n               parent.LastUser.Contains(searchText) ||\n               (isStatus &amp;&amp; parent.Status == (int) submissionStatus);\n\n    }\n</code></pre>\n\n<p>Then call this from my code, something like this:</p>\n\n<pre><code>        return crudEngine.Read&lt;ChildEntity&gt;().Include(parameters =&gt; parameters.ParentEntity)\n                         .Where(GetParentWhere(searchText));\n</code></pre>\n\n<p>This doesn't work however because the Where expression is typed with the child type, not the parent. Any thoughts on how to accomplish this? </p>\n\n<p>Thanks!</p>\n"},{"tags":["linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13230022,"title":"Linq Index in Include","body":"<p>I write program in Linq To EF4\nI have in DataBase  \"Items\" Table that it FK to \"Company\" Table.<br>\nThere are also \"Address\" Table that it FK to \"Company\" Table &amp; to \"City\" Table.<br>\nI want to return Item include the he address &amp; City.<br>\nBut I canot write so:</p>\n\n<pre><code>var items = context.Items.Include(\"Company.Address[0].City\").ToList();\n</code></pre>\n\n<p>because the Include not get \"[ ]\"</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":48,"score":3,"question_id":13236483,"title":"Make EF use local database in App_Data folder","body":"<p>I am using POCO approach on all my projects using Entity Framework. It's all good but I have one problem: It is creating database on my SQL Express, instead I want it to store my database in *.mdf file in App_Data folder.</p>\n"},{"tags":["c#",".net","linq","entity-framework","dynamic"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13233461,"title":"Dynamic conditions in Linq-to-Entities query","body":"<p>I'm trying to convert some old code that directly builds SQL queries to Entity Framework, and came across a problem that many seem to have (judging from the large number of questions surround that topic): how to express dynamic where conditions in linq.</p>\n\n<p>How could I express the following code with a linq query:</p>\n\n<pre><code>    switch (status) {\n        case \"0\":\n            sqlwhere = \" WHERE status &lt; 0 \";\n            break;\n        case \"-1\":\n            sqlwhere = \" WHERE status = -1 \";\n            break;\n        case \"-100\":\n            sqlwhere = \" WHERE status = -100 \";\n            break;\n        case \"1\":\n        default:\n            sqlwhere = \" WHERE status &gt;= 0 \";\n            break;\n    }\n\n    if (strsearch != \"\")\n        sqlwhere += \" AND desc LIKE '%\" + strsearch + \"%' \";\n\n    string sqlc = \"SELECT top 10 * FROM c \" + sqlwhere + \" order by date desc\";\n</code></pre>\n\n<p>I've read about <code>PredicateBuilder</code> and the dynamic Linq extensions in other posts, but I think that a simple case like could be solvable without external libraries.</p>\n\n<p>Using .net 4.5, EF 5.0, C#, can this be done in a \"dynamic\" way without building the complete linq statement for each single case?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":90,"score":-1,"question_id":9119691,"title":"Database joining in Entity Framework","body":"<p>I am new in ASP.NET MVC 3 and am searching on the Internet, but I found nothing on how I can <strong>use joining in ASP.NET MVC 3</strong>. For example, in my social networking project I want to get all the posts with comments. I am using:</p>\n\n<pre><code>var myobj = DB.Comments.Include(\"Post\").ToList();\n</code></pre>\n\n<p>But this shows only those posts which have comments. I want to show all posts and then their respective comments.</p>\n\n<p>I have asked a similar question and people replied that use</p>\n\n<pre><code>var myobj = DB.Post.Include(\"Comments\").ToList();\n</code></pre>\n\n<p>But that is wrong. My knowledge of databases is saying that a post has comments, not that the comments has posts. Simply COMMENT has a foreign key from POST.</p>\n\n<p>How do I resolve this in a simply database query or method?</p>\n\n<pre><code>    var myobj = from u in DB.Posts\n                    join b in DB.Comments\n                    on u.UserID equals b.UserID\n                    into obj\n                    from ua in obj.DefaultIfEmpty()\n                    select new { userComments = (ua == null) ? \"\" : ua.UserComments, UserPosts = u.UserPosts };\n    return view(myobj.ToList());\n</code></pre>\n\n<p>If I use the above then I can't pass it into the view, because it is an SQL query and the <code>and</code> view requires a model whatever the case. What is the complete solution in both cases, that is, from using the SQL query or is there any other method?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13238934,"title":"Is it possible to implement TPH inheritance using [IsNull]/[Is Not Null] condition?","body":"<pre><code>create table Test_Table\n(\n   ID int primary key identity,\n   C1 nvarchar(100) NULL\n)\n</code></pre>\n\n<p><code>Test_Table</code> is mapped to <code>Test_1</code> entity and is a parent of <code>Test_2</code> entity </p>\n\n<p>Is it possible to implement TPH inheritance where depending on whether or not discriminator column <code>C1</code> has a null value, a DB record would be materialized either as an entity of type <code>Test_1</code> or as an entity of type <code>Test_2</code>?  </p>\n\n<p>For this to work <code>Test_1</code>'s discriminatory column should be set to condition <code>[C1] Is Not Null</code> and <code>Test_2</code>'s discriminatory column should be set to condition <code>[C1] is null</code>. But problem is that condition <code>Is Not Null</code> requires us to also map <code>C1</code> column to a property, while <code>Is Null</code> doesn't allow <code>C1</code> to also be mapped to a property. </p>\n\n<p>So is it possible to implement such a condition using only conditional mappings?</p>\n\n<p>Thank you</p>\n"},{"tags":["entity-framework","mvvm","viewmodel","dry"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13238565,"title":"Need the same sort of data fetched from databse in many ViewModels","body":"<p>I'm working on project in <strong>WPF</strong>, using local database (via <em>SQL Express</em>) and <em>Entity Framework</em> as a <em>ORM</em>.</p>\n\n<p>I want to implement as many <strong>ViewModels</strong> as <strong>View</strong> classes. Kind of <strong>1 to 1</strong> relation, I've heard that's a good way to implement <em>MVVM</em> (if you don't agree, please share <em>why</em>). My vision of this is that every <em>ViewModel</em> serve its <em>View</em> (ie. sharing some data from database provided by <em>Model</em> layer). </p>\n\n<p>So every <em>View</em> has its <em>ViewModel</em> which is kind of servant. ;)</p>\n\n<p>During implementing this conception I came across the problem... Let's assume that at least 2 <em>ViewModels</em> want to get recent list of all the customers stored in database. </p>\n\n<p>What would I do in this case? I would have to add this code to all of these <em>ViewModels</em> (against <a href=\"http://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" rel=\"nofollow\">DRY</a>): </p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public ObservableCollection&lt;Customer&gt; Customers;\n\nprivate ObservableCollection&lt;Customer&gt; GetAllCustomers()\n{\n    var oc = new ObservableCollection&lt;Customer&gt;();\n\n    using (var db = new MyDbContext())\n    {\n        var query = from b in db.Customers\n                    orderby b.Surname\n                    select b;\n\n        foreach (var customer in query)\n        {\n            oc.Add(customer);\n        }\n    }\n\n    return oc;\n}\n</code></pre>\n\n<p>or (alternatively) I would make some static <code>FooClass</code> with the same code I wrote above, but singed as <strong>static</strong>. It's not very clever because such a <code>FooClass</code> would be big pile of mess after some time.</p>\n\n<p>I can't find any smarter solution. I'm sure you know how I should code it in clever way. So please help me. How should I provide the same functionality to many <em>ViewModels</em>?</p>\n"},{"tags":["linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13238361,"title":"Linq Cannot implicitity Convert DateTime,Double","body":"<p>I get the following:</p>\n\n<p>Cannot implicitly convert type <code>System.Collections.Generic.Dictionary&lt;System.DateTime?,double?&gt;</code> to <code>System.Collections.Generic.Dictionary&lt;System.DateTime,double&gt;</code> </p>\n\n<p>When I try to use a stored procedure within Entity Framework </p>\n\n<p>Here is the code that I have:</p>\n\n<pre><code>    private Dictionary&lt;DateTime, double&gt; GetData(string columnName)\n    {\n        return db.SysReading(columnName, Convert.ToString(LocId)).\n            ToDictionary( a =&gt; a.DateCollected, a =&gt; a.ElementReading);\n\n    }\n</code></pre>\n\n<p>I am using a call to a Stored Procedure called SysReading. When I convert it to a dictionary, the return type is nullable which I do not want. </p>\n"},{"tags":["c#","sql-server-2008","entity-framework","entity-framework-4.1","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":390,"score":0,"question_id":10153872,"title":"Tables with mapping not being created at the database","body":"<p>I've been trying to implement the Repository pattern using EntityFramework5. I already got the basics to work. My repositories are being loaded only when necessary and the data is being inserted/updated/retrieved in the database as it should.\nThe problem is: I can't get the tables with mapping to be correctly created, or even created at all.\nI've been reading some articles online, even here, talking about ways to work with mapped tables and create them in the database, but I haven't succeed. Hands my question here.</p>\n\n<p>How do I get it to work in my scenario?</p>\n\n<p>I'll explain what I'm doing so far:</p>\n\n<p>This method below is overriden to, supposedly, create the mappings and tables.</p>\n\n<p>PS: <code>Generics.InvokeGenericMethod</code> is a method I created and it's working. It does what it says :)</p>\n\n<pre><code>    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        foreach (Type entityType in Repositories.Keys)\n        {\n            //Invokes the Entity method from DbModelBuilder injecting the class type.\n            Generics.InvokeGenericMethod(modelBuilder, typeof(DbModelBuilder), entityType, \"Entity\", null);\n        }\n\n        foreach (GaiaEntityConfiguration config in EntityConfigurations)\n        {\n            //Defines each mapping existing in the context\n            config.SetConfiguration(modelBuilder);\n        }\n    }\n</code></pre>\n\n<p>The part that is not working is where I use SetConfiguration. SetConfiguration is a method I created for each class added to the context that has mapping, have that mapping mirrored to the database.</p>\n\n<p>Here's one example (in this case a recipient has many messages and messages have many recipients / many-to-many association):</p>\n\n<p>PS: I left the commented code so you can see one other approach I tried.</p>\n\n<pre><code>    public RecipientEntityConfiguration()\n    {\n        this.LeftKey = \"RecipientId\";\n        this.RightKey = \"MessageId\";\n        this.Schema = \"Hermes\";\n        this.TableName = \"RecipientMessage\";\n    }\n\n    public override void SetConfiguration(DbModelBuilder modelBuilder)\n    {\n        //EntityTypeConfiguration&lt;Recipient&gt; entityTypeConfiguration = new EntityTypeConfiguration&lt;Recipient&gt;();\n\n        //entityTypeConfiguration\n        //    .HasMany&lt;Message&gt;(r =&gt; r.Messages)\n        //    .WithMany(m =&gt; m.Recipients)\n        //    .Map(mr =&gt;\n        //    {\n        //        mr.MapLeftKey(this.LeftKey);\n        //        mr.MapRightKey(this.RightKey);\n        //        mr.ToTable(this.TableName, this.Schema);\n        //    });\n        modelBuilder.Entity&lt;Recipient&gt;()\n            .HasMany&lt;Message&gt;(r =&gt; r.Messages)\n            .WithMany(m =&gt; m.Recipients)\n            .Map(mr =&gt;\n            {\n                mr.MapLeftKey(this.LeftKey);\n                mr.MapRightKey(this.RightKey);\n                mr.ToTable(this.TableName, this.Schema);\n            });\n        //modelBuilder.Configurations.Add&lt;Recipient&gt;(entityTypeConfiguration);\n    }\n</code></pre>\n\n<p>When <code>this.Database.Initialize(false);</code> is called I get this error:</p>\n\n<pre><code>Value cannot be null.\nParameter name: key\n</code></pre>\n\n<p>StackTrace:</p>\n\n<pre><code>   at System.Collections.Generic.Dictionary`2.FindEntry(TKey key)\n   at System.Collections.Generic.Dictionary`2.TryGetValue(TKey key, TValue&amp; value)\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.SortedEntityTypeIndex.Add(EdmEntitySet entitySet, EdmEntityType entityType)\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.EntityMappingService.Analyze()\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.EntityMappingService.Configure()\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.ConfigureEntityTypes(DbDatabaseMapping databaseMapping, DbProviderManifest providerManifest)\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.Configure(DbDatabaseMapping databaseMapping, DbProviderManifest providerManifest)\n   at System.Data.Entity.DbModelBuilder.Build(DbProviderManifest providerManifest, DbProviderInfo providerInfo)\n   at System.Data.Entity.DbModelBuilder.Build(DbConnection providerConnection)\n   at System.Data.Entity.Internal.LazyInternalContext.CreateModel(LazyInternalContext internalContext)\n   at System.Data.Entity.Internal.RetryLazy`2.GetValue(TInput input)\n   at System.Data.Entity.Internal.LazyInternalContext.InitializeContext()\n   at System.Data.Entity.Internal.InternalContext.Initialize()\n   at System.Data.Entity.Database.Initialize(Boolean force)\n   at Gaia.Repository.GaiaContext..ctor(GaiaContextConfiguration config) in E:\\Gaia\\Gaia.Repository\\GaiaContext.cs:line 37\n   at Hermes.HMail.SendMessage(Int64 sender, Int64[] toUsers, String subject, String content, FileStream attachment) in G:\\Gaia\\Hermes\\HMail.cs:line 78\n   at Gaia.Controllers.ApplicationController.Test() in G:\\Gaia\\Gaia\\Controllers\\ApplicationController.cs:line 18\n   at lambda_method(Closure , ControllerBase , Object[] )\n   at System.Web.Mvc.ActionMethodDispatcher.&lt;&gt;c__DisplayClass1.&lt;WrapVoidAction&gt;b__0(ControllerBase controller, Object[] parameters)\n   at System.Web.Mvc.ActionMethodDispatcher.Execute(ControllerBase controller, Object[] parameters)\n   at System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters)\n   at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters)\n   at System.Web.Mvc.ControllerActionInvoker.&lt;&gt;c__DisplayClass15.&lt;InvokeActionMethodWithFilters&gt;b__12()\n   at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter(IActionFilter filter, ActionExecutingContext preContext, Func`1 continuation)\n</code></pre>\n\n<p>Any ideas?</p>\n\n<p>Thanks.</p>\n"},{"tags":["wpf","entity-framework","mvvm","command","viewmodel"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13237688,"title":"Create object from View input and pass it to ViewModel (in MVVM)","body":"<p>Recently I'm developing my first project using <strong><a href=\"http://en.wikipedia.org/wiki/Model_View_ViewModel\" rel=\"nofollow\">MVVM</a></strong> concept (I use <strong><a href=\"http://en.wikipedia.org/wiki/Windows_Presentation_Foundation\" rel=\"nofollow\">WPF</a></strong>). I've read many tutorials (ia. famous <a href=\"http://msdn.microsoft.com/en-us/magazine/dd419663.aspx\" rel=\"nofollow\">J.Smith's</a> one) about <strong>MVVM</strong> before I started writing a code. Everything I've read had been clear until I started to code...</p>\n\n<p>The problem is simple: in <em>View</em> layer I have a form with <code>TextBox</code>es. Let's say a few <code>TextBox</code>es, ie.: <strong>Name</strong>, <strong>Surname</strong>, <strong>Phone number</strong>. When user fills all of them and clicks <strong>OK</strong>-button, I want to add new person (with specified personal details) to my local <strong>Database</strong> (I use <em>Entity Framework</em> as a <a href=\"http://en.wikipedia.org/wiki/Object-relational_mapping\" rel=\"nofollow\">ORM</a>). </p>\n\n<p>To do this I need to write something like this: </p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;Button Name=\"MyButton\" Command=\"MyRelayCommandWhichNeedsAllOfTheTextboxes\" Content=\"OK\" /&gt;\n</code></pre>\n\n<p>Using <code>CommandParameter</code> I can pass one object from <em>View</em> to <em>ViewModel</em>. There are many textboxes so it's probably not a good idea. </p>\n\n<p>From <em>XAML</em> I can assign to <code>CommandParameter</code> whole form which needs to be filled by user. But then, inside <em>ViewModel</em>, I need to know all textboxes' names. The main assumption in MVVM is that all the layers (View, ViewModel and Model) have to be independent. </p>\n\n<p>What's the best solution? How can I pass input data from form to <em>ViewModel</em>?</p>\n"},{"tags":["entity-framework","c#-4.0","orm","code-first","lambda-functions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13211859,"title":"Mapping entities with fluent api on entity framework 5","body":"<p>I have a question. </p>\n\n<p>I have these two tables:\n<img src=\"http://i.stack.imgur.com/rfb8g.png\" alt=\"Tables\"></p>\n\n<p>The principal table is User with Customer dependence.</p>\n\n<p>The reverse engineer code first generated classes as follows:</p>\n\n<pre><code>public class User\n{\n    public User()\n    {\n        this.Customers = new List&lt;Customer&gt;();          \n    }\n\n    ...\n\n    public virtual ICollection&lt;Customer&gt; Customers { get; set; }\n\n}\n\npublic class Customer\n{\n    public Customer()\n    {\n    }\n\n    ...\n\n    public int UserID { get; set; }\n    public virtual User User { get; set; }\n\n}\n</code></pre>\n\n<p>I made the following modification in the user class:</p>\n\n<pre><code>public class User\n{\n    public User()\n    {          \n\n    }\n    public int CustomerID { get; set; }\n    public virtual Customer Customer { get; set; }\n\n}\n</code></pre>\n\n<p>Because the relationship is One-to–Zero-or-One.</p>\n\n<p>The original mapping is this:</p>\n\n<pre><code>// Relationships\n        this.HasRequired(t =&gt; t.User)\n            .WithMany(t =&gt; t.Customers)\n            .HasForeignKey(d =&gt; d.UserID);\n</code></pre>\n\n<p>And the modified mapping is  this :</p>\n\n<pre><code>this.HasRequired(t =&gt; t.User)\n            .WithOptional(t =&gt; t.Customer)\n            .Map(m =&gt; m.MapKey(\"UserID\"));\n</code></pre>\n\n<p>Is That correct?\nIf not, how would this mapping?</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13016674,"title":"Validations not show up using EF Code First with complex types","body":"<p>This is a continuation of this question <a href=\"http://stackoverflow.com/questions/13000887/model-class-and-mapping\">Model class and Mapping</a></p>\n\n<p>I had my Client class now working fine and it's defined as </p>\n\n<pre><code>using System;\n\nusing System.ComponentModel.DataAnnotations;\nusing System.ComponentModel;\n\nusing DataAnnotationsExtensions;\nusing System.ComponentModel.DataAnnotations.Schema;\nusing System.Collections.Generic;\n\nnamespace CardNumbers.Objects\n{\n    [ComplexType]\n    public class PhoneInfo\n    {\n        [DataType(DataType.PhoneNumber)]\n        [StringLength(10)]\n        [DisplayName(\"Phone\")]\n        public virtual string Phone { get; set; }\n\n        [StringLength(5)]\n        [DisplayName(\"Ext\")]\n        public virtual string Ext { get; set; }\n\n        public bool HasValue\n        {\n            get\n            {\n                return (Phone != null || Ext != null);\n            }\n        }\n\n    }\n\n      [ComplexType]\n      public class ContactDetail\n      {\n          //Constructor\n          public ContactDetail()\n          {\n              phoneInfo = new PhoneInfo();\n          }\n\n          [StringLength(100)]\n          [DisplayName(\"Contact Name\")]\n          [DisplayFormat(NullDisplayText = \"\")]\n          public virtual string Contact { get; set; }\n\n          [Email]\n          [StringLength(100)]\n          [DisplayName(\"Email\")]\n          public virtual string Email { get; set; }\n\n          public virtual PhoneInfo phoneInfo { get; set; }\n          public bool HasValue\n          {\n              get\n              {\n                  return (Contact != null || Email != null || phoneInfo.HasValue);\n              }\n          }\n      }\n\n/// &lt;summary&gt;\n/// Client class (Client No, Client Name, Address, Contact1, Contact2 info, Created By, Modified By (operator and date)\n/// &lt;/summary&gt;\n    public class Client\n    {\n        public Client()\n        {\n            Contact1 = new ContactDetail();\n            Contact2 = new ContactDetail();\n     }\n\n        [Key]\n        [Column(\"ClientId\",TypeName = \"int\")]\n        public virtual int Id { get; set; }\n        [Required]\n        [DisplayName(\"Client No\")]\n        [Column(\"client_no\", TypeName = \"smallint\")]\n        public virtual Int16 Number { get; set; }\n\n        [Required]\n        [Column(\"client_name\", TypeName = \"varchar\")]\n        [DisplayName(\"Client Name\")]\n        [MaxLength(30, ErrorMessage = \"Client Name should not be longer than 30 characters\" )]\n        [MinLength(3, ErrorMessage = \"Client Name is too short\")]\n        public virtual string Name { get; set; }\n\n        [DataType(DataType.MultilineText)]\n        public virtual string Address { get; set; }\n\n        public virtual ContactDetail Contact1 {get; set;}\n        public virtual ContactDetail Contact2 {get; set;}\n\n        [ForeignKey(\"EnteredByOperator\")]\n        public string EnteredBy { get; set; }\n\n        [InverseProperty(\"ClientsEnteredBy\")]\n        public virtual Operator EnteredByOperator { get; set; }\n\n        [ForeignKey(\"ModifiedByOperator\")]\n        public string ModifiedBy { get; set; }\n\n        [InverseProperty(\"ClientsUpdatedBy\")]\n        public virtual Operator ModifiedByOperator { get; set; }\n\n        [DataType(DataType.DateTime)]\n        [DisplayName(\"Created on\")]\n        public DateTime EnteredOn { get; set; }\n\n        [DataType(DataType.DateTime)]\n        [DisplayName(\"Modified on\")]\n        public DateTime? ModifiedOn { get; set; }\n\n        public virtual ICollection&lt;ClientOrder&gt; ClientOrders { get; set; }\n\n        public virtual ICollection&lt;Reorder&gt; Reorders { get; set; }\n    }\n}\n</code></pre>\n\n<p>I mapped column names using Fluent API and I also re-defined my original \"repository\" classes to be very similar to defined in this tutorial <a href=\"http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8\" rel=\"nofollow\">http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8</a></p>\n\n<p>This is my current partial view for the client form called _ClientForm:</p>\n\n<pre><code>@using WebDemo.Helper\n@model CardNumbers.Objects.Client\n&lt;fieldset&gt;\n    &lt;legend&gt;Client Info&lt;/legend&gt;\n\n    @Html.ValidationSummary(true)\n\n    &lt;input type=\"hidden\" id=\"fntype\" name=\"fntype\"&gt;\n    @Html.HiddenFor(model =&gt; model.Id)\n    @Html.EditorFor(model =&gt; model.Number, EditorTemplate.TextBox)\n\n    @Html.EditorFor(model =&gt; model.Name, EditorTemplate.TextBox)\n\n    @Html.EditorFor(model =&gt; model.Address, EditorTemplate.EditBox)\n\n    &lt;div id=\"ContactsInfo\"&gt;\n        @*Contact 1*@\n\n        &lt;div id=\"Contact1\"&gt;\n\n         @*@Html.EditorFor(model=&gt;model.Contact1)*@\n            @Html.EditorFor(model=&gt;model.Contact1.Contact, EditorTemplate.TextBox)\n            @Html.EditorFor(model=&gt;model.Contact1.Email, EditorTemplate.TextBox)\n        &lt;/div&gt;\n\n        @*Contact2*@\n        &lt;div id=\"Contact2\"&gt;\n\n        @*   @Html.EditorFor(model =&gt; model.Contact2)*@\n        &lt;/div&gt;\n    &lt;/div&gt;\n    @*&lt;div class=\"clear\"&gt;&lt;/div&gt;*@\n    &lt;div id=\"SaveCancel\" class=\"float-right\"&gt;\n        &lt;button type=\"Submit\" id=\"btnSave\"&gt;Save&lt;/button&gt;\n        &lt;button type=\"reset\" id=\"btnCancel\"&gt;Cancel&lt;/button&gt;\n    &lt;/div&gt;\n&lt;/fieldset&gt;\n</code></pre>\n\n<p>I already tried to revert to original way of only one level and I also commented the second Contact2 info but still the e-mail validation doesn't work and all other validations also don't seem to work.</p>\n\n<p>The EditorFor textboxes are defined based on this blog post <a href=\"http://fusionovation.com/post/2010/02/15/adding-a-rich-text-editor-to-asp-net-mvc-using-strongly-typed-helpers-dataannotations-amp-jquery.aspx\" rel=\"nofollow\">http://fusionovation.com/post/2010/02/15/adding-a-rich-text-editor-to-asp-net-mvc-using-strongly-typed-helpers-dataannotations-amp-jquery.aspx</a></p>\n\n<p>And these are two of the new EditorFor I added:\nPhoneInfo.cshtml</p>\n\n<pre><code>@using WebDemo.Helper\n@model CardNumbers.Objects.PhoneInfo\n\n&lt;div id=\"PhoneInfo\"&gt;\n    &lt;div class=\"float-left\"&gt;\n        @Html.EditorFor(model =&gt; model.Phone, EditorTemplate.TextBox)\n    &lt;/div&gt;\n    &lt;div class=\"float-right\"&gt;\n        @Html.EditorFor(model =&gt; model.Ext, EditorTemplate.TextBox)\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>And ContactDetail.cshtml</p>\n\n<pre><code>@using WebDemo.Helper\n@model CardNumbers.Objects.ContactDetail\n\n@Html.EditorFor(model =&gt; model.Contact, EditorTemplate.TextBox)\n@Html.EditorFor(model =&gt; model.Email, EditorTemplate.TextBox)\n@Html.EditorFor(model=&gt;model.phoneInfo)\n</code></pre>\n\n<p>So, as you can see, the code of the views is now very compact.</p>\n\n<p>However, with all of these in place the validations don't see to fire anymore. I used to test validation on EMail by typing some garbage. It used to provide a validation message near the textbox. Now I observe that the email textbox takes the red border, but there is no message.</p>\n\n<p>Do you see what I am missing now and if it's possible to use complex type and validations?</p>\n\n<p>To clarify, the _ClientForm is called from this Client view:</p>\n\n<pre><code>@model CardNumbers.Objects.Client\n\n@{\n    ViewBag.Title = \"Client\";\n}\n\n@section scripts {\n    &lt;script src=\"@Url.Content(\"~/Scripts/Clients.js\")\" type=\"text/javascript\" &gt;&lt;/script&gt;\n}\n\n &lt;form id=\"frmClientsSearch\"&gt;\n        &lt;label for=\"clientNo\"&gt;Client No: &lt;/label&gt;\n        &lt;input type=\"number\" name=\"searchClientNo\" class=\"numericOnly\" /&gt;&lt;br /&gt;\n        &lt;label for=\"clientName\"&gt;Client Name: &lt;/label&gt;\n        &lt;input type =  \"text\" size =25 value =\"Please enter the search value\" class=\"SelectOnEntry\"\n            name =\"searchClientName\" /&gt;\n\n       &lt;input type=\"button\" id=\"btnClientsSearch\" value =\"Find / Refresh\" /&gt;      \n&lt;/form&gt;\n&lt;div style=\"padding-left: 150px; padding-top: 50px; padding-bottom: 50px;\" id=\"ClientsResults\"&gt;\n    &lt;table id=\"flexClients\" style=\"display: none\"&gt;\n    &lt;/table&gt;\n&lt;/div&gt;\n&lt;div style=\"display: none\"&gt;\n   &lt;form id=\"sform\" title=\"Client Info\"&gt;\n\n\n        @{Html.RenderPartial(\"_ClientForm\", Model)   ;}\n\n    &lt;/form&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["c#","entity-framework","dbcontext"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13180262,"title":"Async notification when another application changes the database with entity framework 4.1 and DBContext","body":"<p>I have a REST web service that is used for comunication with multiple clients, some sort of chat, but I have to make all the changes into the database as soon as the clients comunicate something and then inform all the others clients when a change is made. </p>\n\n<p>I basically get a POST request and I have to reply as soon as an entry is mofified.  </p>\n\n<p>Now I make my thread sleep 1 second and then keep recreating the context every second for each request and if there are changes to the database I send the response. \nThis looks ugly to me and I wonder if there is some event or async method to be notified when a specific entry in the database is modified? </p>\n\n<p>Thank you Advance.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","ninject","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":13212817,"title":"using ninject to inject dependency to The Model classes or non-controller classes","body":"<p>I using Ninject 3 in Repository pattern in mvc 3 (steven sanderson Scaffolder).<br>\nand in ninject i have the class \"NinjectWebCommon\" which in the \"RegisterServices\" method i resolved the dependencies and i think im ready to go.  </p>\n\n<pre><code>  private static void RegisterServices(IKernel kernel)\n  {\n     kernel.Bind&lt;ICityRepository&gt;().To&lt;CityRepository&gt;();\n     kernel.Bind&lt;IVillageRepository &gt;().To&lt;VillageRepository&gt;();\n  }\n</code></pre>\n\n<p>i using my repositories in controllers using constructor injection and everything is fine.  </p>\n\n<pre><code>public class CityController : Controller\n{\n   private readonly ICityRepository cityRepository;\n\n   // If you are using Dependency Injection, you can delete the following constructor\n   //public CityController() : this(new CityRepository())\n   //{\n   //}\n\n   public CityController(ICityRepository cityRepository)\n   {\n      this.cityRepository = cityRepository;\n   }\n\n  // .........\n}\n</code></pre>\n\n<p>but when i use this repositories in other classes like Model(Entity) classes using property injection or field injection the dependency doesn't resolved and i get null reference exception on my Property or field.  </p>\n\n<pre><code>[MetadataType(typeof(CityMetadata))]\npublic partial class City : IValidatableObject\n{\n   [Inject]\n   public IVillageRepository VillageRepo { get; set; }\n\n   public IEnumerable&lt;ValidationResult&gt; Validate(ValidationContext validationContext)\n   {\n      var village = VillageRepo.Find(5); // will throw null reference exception on \"VillageRepo\"\n   }\n}\n\npublic partial class CityMetadata\n{\n   [ScaffoldColumn(false)]\n   public int ID { get; set; }\n\n   [Required(ErrorMessage = MetadataErrorMessages.Required)]\n   [StringLength(50, ErrorMessage = MetadataErrorMessages.ExceedMaxLength)]\n   public string Name { get; set; }\n}\n</code></pre>\n\n<p>i don't know why this happening. so whats the problem and how can i use the repositories in non-controller classes?<br>\nthanks in advance.  </p>\n"},{"tags":["c#","sql-server","entity-framework","database-connection"],"answer_count":9,"favorite_count":14,"up_vote_count":41,"down_vote_count":0,"view_count":47304,"score":41,"question_id":2475008,"title":"The underlying provider failed on Open","body":"<p>I was using .mdf for connect to DB and entityClient. Now I want to change the connection string so that there will be no .mdf</p>\n\n<p>Is this <code>connectionString</code> correct</p>\n\n<pre><code>&lt;connectionStrings&gt;\n&lt;!--&lt;add name=\"conString\" connectionString=\"metadata=res://*/conString.csdl|res://*/conString.ssdl|res://*/conString.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQL2008;AttachDbFilename=|DataDirectory|\\NData.mdf;Integrated Security=True;Connect Timeout=30;User Instance=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;--&gt;\n&lt;add name=\"conString\" connectionString=\"metadata=res://*/conString.csdl|res://*/conString.ssdl|res://*/conString.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQL2008;Initial Catalog=NData;Integrated Security=True;Connect Timeout=30;User Instance=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p></p>\n\n<p>because I always get error <code>The underlying provider failed on Open</code>?</p>\n"},{"tags":["c#","linq","entity-framework","lambda"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":186,"score":4,"question_id":1975556,"title":"Linq - OrderBy the minimum value of two columns using lambda expressions?","body":"<p>I have an entity set that contains two DateTime properties. I want to order the set by the minimum value of the two properties. How can I do this with a lambda expression.</p>\n"},{"tags":["c#","wpf","entity-framework"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13235190,"title":"Entity Framework Pre Generated View on custom queries","body":"<p>I have a following Data Structure EntityObject (Unit, Product, ...) 1 : 1 Translation 1:n Translation Items.</p>\n\n<p>To fill ComboBoxes and listViews i only need to query the Translations this way:</p>\n\n<pre><code>    public CollectionViewSource GetShowColumns()\n    {\n        CollectionViewSource result = new CollectionViewSource();\n        List&lt;UnitDTO&gt; units = new List&lt;UnitDTO&gt;();\n        var qry = from x in _context.Units\n                  select new\n                  {\n                      x.Name,\n                      x.Name.Translations,\n                      x.Id\n                  };\n\n        foreach (var temp in qry)\n        {\n            units.Add(new UnitDTO() { Id = temp.Id, Name = temp.Name });\n        }\n        result.Source = units;\n        return result;\n    }\n</code></pre>\n\n<p>My DTO Object contains an Id and Translation Property.</p>\n\n<p>I already used <a href=\"http://visualstudiogallery.msdn.microsoft.com/72a60b14-1581-4b9b-89f2-846072eff19d\" rel=\"nofollow\">EF Power Tools</a> To Prgenerate views. But i still experience a huge differnece between warm and cold queries.</p>\n\n<p>What shall i do ? </p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":51,"score":3,"question_id":13232256,"title":"Linq GroupBy and Lookup<TKey, TElement>.Item","body":"<p>I'm using LINQ in C@ </p>\n\n<p>This code result in <code>dates</code> of type <code>Lookup&lt;TKey, TElement&gt;</code></p>\n\n<pre><code>   var dates = timetableEvents.GroupBy(x =&gt; x.DateTimeStart);\n</code></pre>\n\n<p>I need instead just a list of DateTimeStart (of type DateTime).</p>\n\n<p>How should I change my LINQ expressions? I do not know where to start!</p>\n"},{"tags":["entity-framework","ef-code-first","poco",".net-4.5"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13205349,"title":"EF table splitting: InvalidOperationException - sequence contains more than one matching element","body":"<p>I have a repro for what I think might be an EF bug.  I would like to split one table across two entities.  Each of those entites contains a reference to a third entity.  The two references <strong>must</strong> be exposed with identical foreign key property names.  Since they map to columns in the same table, configuration (or, in this example, an attribute) is used to make the column names unique.</p>\n\n<p>When I try to load the model, I get the above exception from EF.  If I modify the name of one of the FK properties then the error goes away.</p>\n\n<p>Here is my model.  The code as-is works.  To reproduce the problem, rename <code>Foo2.Foo3Id1</code> to <code>Foo3Id</code>, which is the value that I need it to have.</p>\n\n<h1>Why Would You Want to Do That?</h1>\n\n<p>If you're wondering why I need the two properties to have the same name, here's the explanation.</p>\n\n<p>I have a table that contains several addresses (e.g. a postal address and a billing address).  This is an existing database, so I can't change the table structure.  Each address is represented by a series of standard columns.  The name of each column has a prefix identifying the kind of address and a suffix identifying the part of the address, e.g. <code>BillingAddressLine1</code>, <code>BillingAddressZipCode</code> and <code>PostalAddressLine1</code>.</p>\n\n<p>It would <em>seem</em> that using a complex type would handle this.  However, there is an added complication: each address contains a <code>CityId</code> that references a <code>Cities</code> table.  Complex types <a href=\"http://stackoverflow.com/a/7603303/439024\">don't support relationships and navigation properties</a>.  So my intended solution is to use table splitting instead, and to split each set of address properties into its own entity.  Each entity that represents an address either derives from a base type, say, <code>Address</code> or implements an interface, <code>IAddress</code>.</p>\n\n<p>With table splitting I'm careful to observe the restriction that where several types are mapped to the same table, <a href=\"http://stackoverflow.com/a/11884110/439024\">they must all have navigation properties to each other</a>.</p>\n\n<p>In the code below, <code>Foo1</code> and <code>Foo2</code> are both address types (and would implement some common interface).  <code>Foo3</code> is <code>City</code>.  This is the simplest repro of the problem that I could come up with.</p>\n\n<h1>Code Sample</h1>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        // Use NuGet to import EF 5 into the project.\n        // This code is just enough to cause the metadata to be loaded and therefore demo the error.\n        using (Context cx = new Context())\n        {\n            var qq = from f in cx.Foo3s\n                     where f.Foo1s.Any()\n                     select f;\n        }\n    }\n}\n\n[Table(\"Foo\")]\npublic class Foo1\n{\n    [Key]\n    public virtual int Id { get; set; }\n\n    [Required]\n    public virtual Foo2 Foo2 { get; set; }\n\n    [ForeignKey(\"Foo3\")]\n    [Column(\"Foo1_Foo3Id\")]\n    public virtual int? Foo3Id { get; set; }\n\n    public virtual Foo3 Foo3 { get; set; }\n}\n\n[Table(\"Foo\")]\npublic class Foo2\n{\n    [Key]\n    public virtual int Id { get; set; }\n\n    [Required]\n    public virtual Foo1 Foo1 { get; set; }\n\n    // Re-name the following property to Foo3Id (rather than Foo3Id1) and the model won't load.\n    // You get \"InvalidOperationException: Sequence contains more than one matching element.\"\n    [ForeignKey(\"Foo3\")]\n    [Column(\"Foo2_Foo3Id\")]\n    public virtual int? Foo3Id1 { get; set; }\n\n    public virtual Foo3 Foo3 { get; set; }\n}\n\n[Table(\"Foo3\")]\npublic class Foo3\n{\n    [Key]\n    public virtual int Id { get; set; }\n\n    [InverseProperty(\"Foo3\")]\n    public virtual ICollection&lt;Foo1&gt; Foo1s { get; set; }\n\n    [InverseProperty(\"Foo3\")]\n    public virtual ICollection&lt;Foo2&gt; Foo2s { get; set; }\n}\n\npublic class Context : DbContext\n{\n    public DbSet&lt;Foo3&gt; Foo3s { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        base.OnModelCreating(modelBuilder);\n\n        // Don't think we can configure 1:1 relationship using just attributes.\n        var foo2 = modelBuilder.Entity&lt;Foo2&gt;();\n        foo2.HasRequired(q =&gt; q.Foo1)\n            .WithRequiredPrincipal(q =&gt; q.Foo2);\n    }\n}\n</code></pre>\n\n<p>Is this a bug?  Am I doing something wrong?  Is it a known EF limitation?</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","edmx"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13233805,"title":"How To Handle Multiple Object Insertion In Entity Framework?","body":"<p>I Have List To Save In My Database \"Challan\" Table.\nCurrently I Use The <strong>ForEach Loop To Insert Objects In Database,With Each Iteration I use\nContext.SaveChanges() Method.</strong>\nIn Loop i also Call <strong>ManageStock() Function</strong> For Update Stock Of Product,Which is Reside in Other Class File.</p>\n\n<p>I Want To Save All List with Stock Management at a time,means if power failure or other Errors Occurred between insertion then saved record will be roll back And If Full Transaction Have No Error Then Only It Will Save With All Entries.</p>\n\n<p>How Can I Achieve This In Entity Framework?</p>\n"},{"tags":["c#","sql-server","asp.net-mvc","entity-framework","complex-data-types"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":69,"score":4,"question_id":13212338,"title":"Calling stored procedure in EF with Complex Data Type","body":"<p>I am new to working with <code>Entity Framework</code> in a sample <code>ASP.NET/MVC 3.0 VS2010</code> project. I have imported two stored procedures as Function Imports and, in doing so, created a complex data type for each.</p>\n\n<p>I am trying to run the following c# code:</p>\n\n<pre><code>public ComplexDataType RunStoredProc()\n{\n    var context = new DbEntities();\n    int param1 = 370;\n    int param2 = -1;\n    string param3 = \"Current\";\n\n    ComplexDataType result = new ComplexDataType;\n    result = context.StoredProc(param1, param2, param3);\n    return result;\n}\n</code></pre>\n\n<p>And I'm getting the error:</p>\n\n<pre><code>Cannot implicitly convert data type \n    System.Data.Objects.ObjectResult(ComplexDataType) to 'ComplexDataType'\n</code></pre>\n\n<p>What am I doing wrong? How do I properly store the results of the stored proc in a complex data type?</p>\n"},{"tags":["entity-framework","repository-pattern"],"answer_count":2,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":929,"score":5,"question_id":1641658,"title":"Repository Pattern and Entity Framework","body":"<p>Hi\nI looked at lot of examples online using Repository Pattern with EF. But none of them really talked about working with Related Entities. </p>\n\n<p>Like say User can have multiple addresses.</p>\n\n<pre><code>IUserRepository\nUser CreateUser();\nvoid UpdateUser();\n</code></pre>\n\n<p>Now if I were to add a Address to the User should, should it be on the Repository? OR \non the User instance</p>\n\n<p>I feel repository pattern shud be used for CRUD and Get Operations on the entity. But when it comes to working with related entities, they should really be defined on the entity[for the most part]</p>\n\n<p>Like in this scenario, address is useless without a user, shouldnt it be on the entity?</p>\n\n<p>any thoughts?</p>\n"},{"tags":["entity-framework","entity"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13232777,"title":"check constraint entity framework","body":"<p>IN EF can I add a check constraint so if my CustomerNotes entity has a boolean \"FollowUpRequired\" property I force user to enter a valid future date in the \"FollowUpDate\" property?</p>\n"},{"tags":["entity-framework","exception","oracle11g","insert-update"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13232188,"title":"Entity Framework - can't update record (so Identity or not?)","body":"<p>I try to update a record in Oracle DB using standard method:</p>\n\n<pre><code>- LINQ to get an entity (OK);\n- set new value to some of fields (just one for now) (OK, as well);\n- call SaveChanges() to submit (Exception!).\n</code></pre>\n\n<p>And it does not work!</p>\n\n<p>At first, I've got the next error message:</p>\n\n<p>\"Operation is not valid due to the current state of the object\"</p>\n\n<p>I've found some recommendation how to solve it - just change StoreGeneratedPattern to 'Identity' in my edmx file (both models). And yes, the error has disappeared.</p>\n\n<p>But I've got another error message instead:</p>\n\n<p>\"Modifying a column with the 'identity' pattern is not supported\"</p>\n\n<p>So, how can I update a record correctly?</p>\n"},{"tags":["c#","asp.net","entity-framework","ado.net","unit-of-work"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13232084,"title":"Is Unit of Work pattern about sharing the same DataContext?","body":"<p>I am using Entity Framework and I am trying to learn Unit of Work pattern in combination with Repository pattern.</p>\n\n<p>From what i understood until now, Unit of Work is responsible with keeping track of the changes made to the entity objects. However, isn't the DataContext doing the same thing?</p>\n\n<p>So, implementing unit of work pattern isn't like \"forcing\" you to use the same context across all methods?</p>\n\n<pre><code>public class EFUnitOfWork : IUnitOfWork\n{\n    EFContext context = new EFContext();\n    public void Commit()\n    {\n        context.SaveChanges();\n    }\n}\n\npublic class ProductsRepository(IUnitOfWork unitOfWork)\n{\n    /* CRUD methods here */\n}\n\npublic void InsertProducts()\n{\n    var unitOfWork = new EFUnitOfWork(); // &lt;-- this will normally be injected via constructor\n    var productsRepository = new ProductsRepository(unitOfWork);\n\n    productsRepository.Insert(new Product { Name = \"Product 1\", Description = \"Description\" });\n    productsRepository.Insert(new Product { Name = \"Product 2\", Description = \"Description\" });\n    productsRepository.Insert(new Product { Name = \"Product 3\", Description = \"Description\" });\n\n    unitOfWork.Commit();\n}\n</code></pre>\n\n<p>Is this the right way of using Unit of Work with Entity Framework?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13231032,"title":"Delete multiple rows with Entity Framework 5","body":"<p>I tried this piece of code :</p>\n\n<pre><code>context.Database.ExecuteSqlCommand\n(\"DELETE [MYSCHEMA].TABLE1 Where TABLE2.Id = 5\");\n</code></pre>\n\n<p>But I get this exception : <em>Cannot call methods on nvarchar.</em></p>\n\n<p>Currently I use a loop but I'd like avoid this.</p>\n\n<p>Thanks,</p>\n"},{"tags":[".net","entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":85,"score":6,"question_id":13223353,"title":"Regarding the new EF5 auto-compiled queries feature","body":"<p>I've made few tests regarding the new EF5 auto-compiled queries feature. The problem is that I don't see any difference in the performance. </p>\n\n<p>I've made one project with .NET 4.0 and EF4.0 without using compiled queries. \nI've made another project with .NET 4.0 and EF4.0 with compiled queries - there was 50% improvement in performance. </p>\n\n<p>And then I tried to create a project with EF 5.0, in which there was basically no difference in performance. </p>\n\n<p>All the projects were asp.net mvc (first two were version 3, the last one - version 4). </p>\n\n<p>Am I missing something here ? Is there something special I need to do to enable the auto-compile feature ? I just created MVC 4 project with pre-build EF5 inside. </p>\n\n<p>The query I am testing with is rather verbose, three joins and multiple filters inside. </p>\n\n<p>Thank you</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":16,"score":2,"question_id":13219819,"title":"How to create new base line / reset in EF code first?","body":"<p>So when prototyping an application using Entity Framework code first, I ended up with a lot of migrations. </p>\n\n<p>I'm not interested in keeping all the classes that were generated, I want to say: ok, this is my base line for v1.</p>\n\n<p>How can I reset EF Code first?</p>\n"},{"tags":["sql","json","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13226760,"title":"Execute SQL script in Entity Framework & convert the result to JSON","body":"<p>Hey Guys I want to execute this SQL script in Entity Framework &amp; return the result in <code>JSONResult</code> format to access in jQuery.. Please help!!!</p>\n\n<p>My Entity Framework model contains the tables &amp; databases mentioned in SQL script </p>\n\n<p>THANKS :-)</p>\n\n<pre><code>DECLARE @listCol VARCHAR(2000)\nDECLARE @query VARCHAR(4000)\nSELECT  @listCol = STUFF(( SELECT distinct  '], [' + [PSize]\n                           FROM     Pattern\n                         FOR\n                           XML PATH('')\n                         ), 1, 2, '') + ']'\nSET @query = 'SELECT * FROM\n      (SELECT PColour as Colour_Size_Matrix, PSize, PCode\n            FROM Pattern\n            ) src\nPIVOT (Count(PCode) FOR PSize\nIN (' + @listCol + ')) AS pvt'\nEXECUTE ( @query )\n</code></pre>\n"},{"tags":["c#","entity-framework",".net-4.0","ef-code-first","entity-framework-4.3"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13174247,"title":"EF Code First IDbSet<TEntity>.Attach() Conflicting changes to the role _ of the relationship _ have been detected","body":"<p>I have the following code:</p>\n\n<pre><code>using (var db = new SourceLogContext())\n{\n    db.LogEntries.Attach(this);\n    db.Entry(this).Collection(c =&gt; c.ChangedFiles).Load();\n}\n</code></pre>\n\n<p>And I'm getting the following exception:</p>\n\n<pre><code>System.InvalidOperationException occurred\n  Message=Conflicting changes to the role 'LogEntry_LogSubscription_Target' of the relationship 'SourceLog.Model.LogEntry_LogSubscription' have been detected.\n  Source=System.Data.Entity\n  StackTrace:\n       at System.Data.Objects.DataClasses.RelatedEnd.IncludeEntity(IEntityWrapper wrappedEntity, Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.EntityCollection`1.Include(Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.RelatedEnd.WalkObjectGraphToIncludeAllRelatedEntities(IEntityWrapper wrappedEntity, Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.RelatedEnd.AddGraphToObjectStateManager(IEntityWrapper wrappedEntity, Boolean relationshipAlreadyExists, Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.RelatedEnd.IncludeEntity(IEntityWrapper wrappedEntity, Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.EntityReference`1.Include(Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.RelationshipManager.AddRelatedEntitiesToObjectStateManager(Boolean doAttach)\n       at System.Data.Objects.ObjectContext.AttachTo(String entitySetName, Object entity)\n       at System.Data.Entity.Internal.Linq.InternalSet`1.&lt;&gt;c__DisplayClass2.&lt;Attach&gt;b__1()\n       at System.Data.Entity.Internal.Linq.InternalSet`1.ActOnSet(Action action, EntityState newState, Object entity, String methodName)\n       at System.Data.Entity.Internal.Linq.InternalSet`1.Attach(Object entity)\n       at System.Data.Entity.DbSet`1.Attach(TEntity entity)\n       at SourceLog.Model.LogEntry.LoadChangedFiles() in C:\\github.com\\tomhunter-gh\\SourceLog\\SourceLog.Model\\LogEntry.cs:line 62\n  InnerException: (empty)\n</code></pre>\n\n<p>The offending line is here: <a href=\"https://github.com/tomhunter-gh/SourceLog/blob/443fb74a37db89522f85b4dfc941c52922785e7a/SourceLog.Model/LogEntry.cs#L62\" rel=\"nofollow\">https://github.com/tomhunter-gh/SourceLog/blob/443fb74a37db89522f85b4dfc941c52922785e7a/SourceLog.Model/LogEntry.cs#L62</a></p>\n\n<p>The LogEntry has it's LogSubscription assigned here: <a href=\"https://github.com/tomhunter-gh/SourceLog/blob/443fb74a37db89522f85b4dfc941c52922785e7a/SourceLog.Model/LogSubscription.cs#L88\" rel=\"nofollow\">https://github.com/tomhunter-gh/SourceLog/blob/443fb74a37db89522f85b4dfc941c52922785e7a/SourceLog.Model/LogSubscription.cs#L88</a></p>\n\n<p>It looks like the assignment creates a new LogSubscription instance and assigns it, and then the Attach references a different instance (but with the same Id).  Why does this cause the error and how would I avoid it?</p>\n\n<p>In LogSubscription L88 I'm basically trying to add the LogEntry to the collection property of the LogSubscription but without loading the entire LogEntry collection.  Is this the correct way to do that?</p>\n"},{"tags":["sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13193770,"title":"EF generated SQL Query returns wrong result","body":"<p>I want to filter on a specific date. Because of the control I use I can also filter on a range of dates, but when I filter on a single date it should also work so I have total flexibility.</p>\n\n<p>When I filter on 2004-11-24 my code generates the following query with Entity Framework. However somehow the query returns me the results of 2004-11-25 instead of 2004-11-24.</p>\n\n<p>What is wrong with this query? </p>\n\n<pre><code>SELECT TOP (26) \n[Filter1].[Id] AS [Id], \n[Filter1].[AliquotId] AS [AliquotId], \n[Filter1].[ScientificStudyId] AS [ScientificStudyId], \n[Filter1].[ExpectedSpecimenId] AS [ExpectedSpecimenId], \n[Filter1].[ExpectedAliquotId] AS [ExpectedAliquotId], \n[Filter1].[VisitId] AS [VisitId], \n[Filter1].[BoxId] AS [BoxId], \n[Filter1].[ParticipantId] AS [ParticipantId], \n[Filter1].[Product] AS [Product], \n[Filter1].[BodyMaterial] AS [BodyMaterial], \n[Filter1].[AliquotNr] AS [AliquotNr], \n[Filter1].[ReservationName] AS [ReservationName], \n[Filter1].[Visit] AS [Visit], \n[Filter1].[Win32Color] AS [Win32Color], \n[Filter1].[Position] AS [Position], \n[Filter1].[Barcode] AS [Barcode], \n[Filter1].[Temperature] AS [Temperature], \n[Filter1].[DivergentStorageTemperature] AS [DivergentStorageTemperature], \n[Filter1].[BoxName] AS [BoxName], \n[Filter1].[CollectionDate] AS [CollectionDate], \n[Filter1].[Positioned] AS [Positioned], \n[Filter1].[CheckedOut] AS [CheckedOut], \n[Filter1].[CheckinDate] AS [CheckinDate], \n[Filter1].[CheckoutDate] AS [CheckoutDate], \n[Filter1].[LabelsPrinted] AS [LabelsPrinted], \n[Filter1].[ParticipantNr] AS [ParticipantNr], \n[Filter1].[Specimen] AS [Specimen], \n[Filter1].[ContainerType] AS [ContainerType], \n[Filter1].[ContainerTypeId] AS [ContainerTypeId], \n[Filter1].[Quantity] AS [Quantity], \n[Filter1].[Unit] AS [Unit], \n[Filter1].[QuantityUnit] AS [QuantityUnit], \n[Filter1].[StudyVersion] AS [StudyVersion], \n[Filter1].[ThawCount] AS [ThawCount], \n[Filter1].[Sop] AS [Sop], \n[Filter1].[NrOfRemarks] AS [NrOfRemarks], \n[Filter1].[RemarkSummary] AS [RemarkSummary]\nFROM ( SELECT [Extent1].[Id] AS [Id], [Extent1].[AliquotId] AS [AliquotId], [Extent1]. [ScientificStudyId] AS [ScientificStudyId], [Extent1].[ExpectedSpecimenId] AS [ExpectedSpecimenId], [Extent1].[ExpectedAliquotId] AS [ExpectedAliquotId], [Extent1].[VisitId] AS [VisitId], [Extent1].[BoxId] AS [BoxId], [Extent1].[ParticipantId] AS [ParticipantId], [Extent1].[Product] AS [Product], [Extent1].[BodyMaterial] AS [BodyMaterial], [Extent1].[AliquotNr] AS [AliquotNr], [Extent1].[ReservationName] AS [ReservationName], [Extent1].[Visit] AS [Visit], [Extent1].[Win32Color] AS [Win32Color], [Extent1].[Position] AS [Position], [Extent1].[Barcode] AS [Barcode], [Extent1].[Temperature] AS [Temperature], [Extent1].[DivergentStorageTemperature] AS [DivergentStorageTemperature], [Extent1].[BoxName] AS [BoxName], [Extent1].[CollectionDate] AS [CollectionDate], [Extent1].[Positioned] AS [Positioned], [Extent1].[CheckedOut] AS [CheckedOut], [Extent1].[CheckinDate] AS [CheckinDate], [Extent1].[CheckoutDate] AS [CheckoutDate], [Extent1].[LabelsPrinted] AS [LabelsPrinted], [Extent1].[ParticipantNr] AS [ParticipantNr], [Extent1].[Specimen] AS [Specimen], [Extent1].[ContainerType] AS [ContainerType], [Extent1].[ContainerTypeId] AS [ContainerTypeId], [Extent1].[Quantity] AS [Quantity], [Extent1].[Unit] AS [Unit], [Extent1].[QuantityUnit] AS [QuantityUnit], [Extent1].[StudyVersion] AS [StudyVersion], [Extent1].[ThawCount] AS [ThawCount], [Extent1].[Sop] AS [Sop], [Extent1].[NrOfRemarks] AS [NrOfRemarks], [Extent1].[RemarkSummary] AS [RemarkSummary], row_number() OVER (ORDER BY [Extent1].[CollectionDate] ASC) AS [row_number]\nFROM [dbo].[ClaimedAliquotPositionsReadModels] AS [Extent1]\nWHERE (cast('0ebebae6-594d-4be0-ac8b-a078013f1370' as uniqueidentifier) = [Extent1].[ScientificStudyId])\nAND ([Extent1].[CheckoutDate] &gt;= convert(datetime2, '2004-11-24 00:00:00.0000000', 121))\nAND ([Extent1].[CheckoutDate] &lt; convert(datetime2, '2004-11-25 00:00:00.0000000', 121))\n)  AS [Filter1]\nWHERE [Filter1].[row_number] &gt; 0\nORDER BY [Filter1].[CollectionDate] ASC\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":13225266,"title":"Save new record in Entity Framework","body":"<p>I have a litte problem about save new record to database by using Entity framework.</p>\n\n<p>Here the code: </p>\n\n<pre><code>using (_context)\n                {\n                    _context.AddToStudent(newStudent);\n                    _context.AddToStudentInfo(newStudentInfo);\n                    _context.SaveChanges();                   \n                    return true;\n                }\n</code></pre>\n\n<p>My question is : If 1 of 2 _context.AddTo fail so the SaveChanges will be terminated or it will save the one success ??? I appreciate any answer :)</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":314,"score":3,"question_id":4245219,"title":"EF4; Add foreign keys to model","body":"<p>I've got quite a large Entity Framework 4 model (model first), which at the moment has all the relationships defined as associations, without Foreign Key properties.</p>\n\n<p>Anyone know a way to add FK properties to the whole diagram other than by recreating the diagram from scratch or adding each one manually?</p>\n\n<p>I suppose one way would be to generate the database, then build a new model from the database, and then just go through cleaning up, unless there's any better suggestions?</p>\n\n<p>I'm thinking another way would be to write something to tweak the XML.</p>\n"},{"tags":["entity-framework","visual-studio-2012","dataannotations","ef-database-first"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13224834,"title":"ef5 database first data annotation","body":"<p>I am starting MVC4 with VS2012.  I am also using EF5 with the \"Database First\" method of creating my classes.</p>\n\n<p>However because the generated glasses can be regenerated I cannot put the Data Annotation details to assist with validation.</p>\n\n<p>I have seen some code snippets that use MetaData and partial classes but I was wondering if anyone knows of a small compilable example that I can look at and pull apart to better understand how the vasious classes interlink.</p>\n\n<p>Many many thanks for any help.\nDave</p>\n"},{"tags":["entity-framework","ado.net"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13222421,"title":"Entity Framework, database-first or model-first?","body":"<p>I'm starting a new project and I'm interested in using Entity Framework. However, since this is a new project, there isn't an existing model or database yet, so I could either use database-first or model-first in this situation.</p>\n\n<p>When starting with a blank slate like this, is it recommended to use model-first and let EF determine the database design or design the database yourself? I'm comfortable designing normalized databases so I'm not afraid of that aspect, but I'm not sure if there are maintainability and performance benefits from letting EF handle all the database design.</p>\n\n<p>Thanks in advance guys!</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":19,"score":3,"question_id":13222104,"title":"Entity Framework: EF gets related objects of an entity in different order","body":"<p>I'm working with MVC3 and Entity Framework 4.0. The situation is the following: I have an entity called \"Topics\" and a related entity called \"Questions\". To visualize the questions I have a Topics view and then in a foreach sentence inside the view, show the Questions related to that topic: </p>\n\n<p><code>\n<code>foreach(Questions Question in Topic.Questions)\n{\n//Show question info\n}</code>\n</code></p>\n\n<p>But anytime a question is updated in another view, when I go to the Topic view, the questions appear in a diferent order, most specifically, the question that was updated appears first.</p>\n\n<p>Anyone knows why is this behavior?. And how to stop it?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13219903,"title":"Migrate a given (old) database to current model","body":"<p>I am struggling with entity framework's migration quite a bit. Below is how I plan on using migrations, but I find no information on how to accomplish this:</p>\n\n<p>My users are creating databases (Sql Compact Server) on their premises with different versions of my software. Each version introduces a slightly changed EF model. As soon as a user updates to a newer version of the software and opens a database with a previous version of the model, I would like to have some sort of \"auto migration\" bring the given database up-to-date to the current model.</p>\n\n<p>Is there any way to do this? </p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12885116,"title":"DataBase.Exist() returns true even if the connection string has wrong database name in Entity Framework","body":"<p>I am new to EF 5.0, i have purposely set the wrong database name in connection string in Web.Config. i.e. Initial Catalog = \"Wrong Database Name\";</p>\n\n<p>Now I have created a boolean property, which detects whether the database exists or not. Like below - where context is the EFDbContext.</p>\n\n<pre><code>bool IsDatabaseExist = context.DataBase.Exists();\n</code></pre>\n\n<p>My question is, why this is always showing true, even if the DataBase name which I have provided is wrong ?</p>\n"},{"tags":["entity-framework","code-first-migrations"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":14,"score":-1,"question_id":13219609,"title":"Auto Migration or not?","body":"<p>I am using migration for WPF project. </p>\n\n<p>In development it is easy to use auto migration to update database changes, to make development process fast.</p>\n\n<p>Now when I want to deploy it to customer, should I continue using auto migration, or should I do the manual migration, so every-time I make changes, I need to create add-migration files?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13128623,"title":"When does an Entity show up in the collection of the Model","body":"<p>I use entity framework and have a set of users:</p>\n\n<pre><code> public class DbModel : DbContext\n {\n     public DbSet&lt;User&gt; Users { get; set; }\n</code></pre>\n\n<p>I add a User like so:</p>\n\n<pre><code>  User UserOne = new User();\n  model.Users.Add( UserOne );\n</code></pre>\n\n<p>I request the users count:\n      int userCount = model.Users.Count();</p>\n\n<p>userCount is \"0\" I would expect \"1\". Adding DetectChanges doen't help.\nAfter  \"model.SaveChanges()\" the Count = 1, but that is to late I need to combine the in memory stuff with the DB stuff for validation. Is there a way to do this?</p>\n\n<p>SOLUTION</p>\n\n<p>Using the answer of Erik Philips I wrote the following extension method for the DbSet</p>\n\n<pre><code>public static class DBSetExtentions\n{\n     public static IEnumerable&lt;T&gt; AllMembers&lt;T&gt;(\n         this DbSet&lt;T&gt; target, \n         Func&lt;T, bool&gt; selection\n         )  where T : class\n    {\n        return target.Local.Where(selection).Union(target.Where(selection));\n    }\n }\n</code></pre>\n\n<p>it allows me to do selections an validations accross <strong>all</strong> entities like:</p>\n\n<pre><code>    private void ValidateEmail(ValidationDto validationDto)\n    {\n\n        int usersWithSameEmail =\n            validationDto.Model.Users.AllMembers(\n                x =&gt; x.EmailAddress.Equals( EmailAddress ) ).Count();\n\n        if (usersWithSameEmail &gt; 1)\n        {\n            validationDto.Result.Add(new ValidationResult(\"Email address is in use\"));\n        }\n    }\n</code></pre>\n"},{"tags":["c#",".net","sql","entity-framework","entity-framework-4.1"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":97,"score":3,"question_id":13122940,"title":"String preparation when calling stored procedure in Entity Framework","body":"<p>Actually, I have code that uses Entity Framework 4.1 in Visual Studio 2010. Everything is working fine except for one thing : it doesn't seem to \"prepare\" the parameters like a good old <code>[parameters.Add]</code> habitually did.</p>\n\n<p>Here's my code : </p>\n\n<pre><code>using (MyEnterprisesEntities dataContext = new \n                             MyEnterprisesEntities(entityBuilder.ToString()))\n{\n         dataContext.CompanyInitializer(connection.Catalog,\n                                        args.CompanyId,\n                                        args.CompanyName);\n}\n</code></pre>\n\n<p>So, if my company's name is <code>O'Brian and sons</code> (actually it passed before through a WCF web service so it's more in this form: <code>O\\'Brian and sons</code>), it's seem to break my stored procedure (including the possibility of allowing SQL injection).</p>\n\n<p>Is there a way to avoid this situation with EDMX or the old way is more reliable ? </p>\n"},{"tags":["c#","entity-framework","linq-to-entities"],"answer_count":6,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2485,"score":3,"question_id":2772017,"title":"Linq-to-Entities Left JOIN","body":"<p>This is my query:</p>\n\n<pre><code>from forum in Forums\n    join post in Posts on forum equals post.Forum into postGroup    \n\n    from p in postGroup     \n    where p.ParentPostID==0\n\n    select new \n    {\n        forum.Title,\n        forum.ForumID,  \n        LastPostTitle = p.Title,\n        LastPostAddedDate = p.AddedDate         \n    }).OrderBy(o=&gt;o.ForumID) \n</code></pre>\n\n<p>Currently the Join is not left join, meaning if some forum doesn't have a post that belongs to it, it will not be returned.<br>\nThe forum without posts must be returned with null (or default) values for the post properties. </p>\n\n<p><strong>UPDATE</strong>  </p>\n\n<p>The result set should be some thing like that:</p>\n\n<pre><code>ForumId | ForumTitle | LastPostTitle | LastPostAddedDate  \n--------+------------+---------------+------------------\n4       |   Sport    |    blabla     |       12/4/2010  \n4       |   Sport    |    blabla     |       15/4/2010  \n6       |   Games    |    blabla     |       1/5/2010  \n7       |   Flame    |               |\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13179835,"title":"Create relationship between entity which doesn't exist in the db","body":"<p>All, I have 3 tables below.</p>\n\n<p><strong>1.TaskTableA</strong></p>\n\n<p><em><strong>id</em></strong>    uniqueidentifier (PK)</p>\n\n<p><em><strong>deployName</em></strong>  nvarchar(50)</p>\n\n<p><em><strong>hostip</em></strong>  nvarchar(50)</p>\n\n<p><strong>2.TaskTableB</strong></p>\n\n<p><em><strong>id</em></strong>   uniqueidentifier (PK)</p>\n\n<p><em><strong>filePath</em></strong> nvarchar(50)</p>\n\n<p><strong>3.TaskLogTable</strong></p>\n\n<p><em><strong>id</em></strong>   uniqueidentifier (PK)</p>\n\n<p><em><strong>status</em></strong> nvarchar(50)</p>\n\n<p><em><strong>taskid</em></strong>   uniqueidentifier </p>\n\n<p>TaskTableA and TaskTableB are two types of Tasks in my application.\nand All the Task logs are stored in the table TaskLogTable. I don't want create the TaskTableA  and TaskLogTable one2many relationship in DB. \nBut I want to the entities have relationship so that I can use the navigation property to load child table records. I don't know how to add code to make it . please help me , thanks.</p>\n"},{"tags":["entity-framework","exception-handling"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13189463,"title":"Handles SQL Exception from Entity Framework","body":"<p>In my sql stored procedure, i do some insertion and updating which in some scenarios throws Primary Key or unique key violation.</p>\n\n<p>When I try to execute this procedure from ADO.net, .net application also throws that exception and let me know that something wrong had happen.</p>\n\n<p>But when I try to execute this procedure from EF, it just executes. Neither it show anything nor update anything.</p>\n\n<p>How should I handle or notify user that something wrong had happen?</p>\n\n<p>Ado.Net code is </p>\n\n<pre><code> SqlConnection sqlConnection = new SqlConnection(@\"data source=database01; database=test; user id=test; password=test;\");\n        SqlCommand cmd = new SqlCommand(\"[uspUpdateTest]\", sqlConnection);\n        cmd.CommandType = System.Data.CommandType.StoredProcedure;\n        cmd.Parameters.AddWithValue(\"RunID\", RunID);\n        cmd.Parameters.AddWithValue(\"RunCode\", RunCode);\n        sqlConnection.Open();\n        var str = cmd.ExecuteNonQuery();\n</code></pre>\n\n<p>Entity Framework Code is</p>\n\n<pre><code> TestEntities context = new TestEntities();\n        var str=context.UpdateRun(RunID, RunCode);\n</code></pre>\n"},{"tags":["c#","entity-framework","entity","dispose","objectdisposedexception"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13217954,"title":"Object Instance has been disposed (EF)","body":"<p>I'm having some problems with retrieving my Project entity in the EntityFramework. It keeps giving me the Objest instance has been disposed error.</p>\n\n<p>I've got 2 instances, as seen in the image below.<img src=\"http://i.stack.imgur.com/CFO1i.jpg\" alt=\"enter image description here\"></p>\n\n<p>And the following code gives me the error:</p>\n\n<pre><code>    public Project GetProjectyById(int id)\n    {\n        using (var context = new CoderaDBEntities())\n        {\n            return context.Projects.First(c =&gt; c.Id == id);\n        }\n    }\n</code></pre>\n\n<p>Everything from Project is retrieved fine, but the Category object inside the Project object (the association) delivers me the object has been disposed error. What's going on?</p>\n\n<p>Thanks!</p>\n\n<p><strong>Edit: Does this association look odd to you?</strong></p>\n"},{"tags":["entity-framework","ef-code-first","dbcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13211683,"title":"Code first DbContext usage","body":"<p>I have been trying to work with Entity Framework's Code First. I wrote the below line of code</p>\n\n<pre><code>DbContext _context = new  DbContext(ConfigurationManager.ConnectionStrings[\"con\"].ConnectionString);\n</code></pre>\n\n<p>However on execution, the connection remains closed. Is there something wrong with this code??</p>\n\n<p>I have created a generic repository class using the DBContext shown below</p>\n\n<pre><code>public class GenericRepository&lt;T&gt; where T:class\n  {   \n\npublic DbContext _context = new DbContext(ConfigurationManager.ConnectionStrings[\"con\"].ConnectionString);\n\nprivate DbSet&lt;T&gt; _dbset;\n\npublic DbSet&lt;T&gt; Dbset\n{\n\n    set { _dbset = _context.Set&lt;T&gt;(); }\n    get { return _dbset; }\n\n}\n\npublic IQueryable&lt;T&gt; GetAll()\n{\n\n    return Dbset;\n}  \n}\n</code></pre>\n\n<p>and I then call this class on the page load event, where Teacher is an entity class which maps to a table in the database</p>\n\n<pre><code>protected void Page_Load(object sender, EventArgs e)\n{\n    GenericRepository&lt;Teacher&gt; studentrepository = new GenericRepository&lt;Teacher&gt;();\n    rptSchoolData.DataSource = studentrepository.GetAll().ToList();\n    rptSchoolData.DataBind();\n}\n</code></pre>\n\n<p>but the connection remains closed and there is also an InvalidOperation Exception in the ServerVersion of the context object.</p>\n\n<p>Am I missing something??</p>\n"},{"tags":["asp.net","entity-framework","c#-4.0","design-patterns","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13206361,"title":"When should I use EF code-first or model-first in my projects?","body":"<p>We have several ways to access the database with EF : code-first or model-first or database-first design... and I want to know when I use these ways to access the database ?....</p>\n\n<p>Is any standard for these technology for access to the database in my Asp.net web application or asp.net mvc web application?</p>\n"},{"tags":["silverlight","entity-framework","geospatial","silverlight-5.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13204365,"title":"Silverlight 5 - entity framework 5 and domain service exclude unsupported Geography type","body":"<p>I'm very new to Silverlight (this is my first test app) and I'm working through some walkthroughs on setting up a domain service for a silverlight 5 app that uses the Entity Framework.</p>\n\n<p>I have a \"TestApp1\" project and a \"TestApp1.Web\" project which were generated when I created the Silverlight project.</p>\n\n<p>I added an edmx model to the TestApp1.Web project and randomly picked a couple of tables out of a test db I have and one of them includes a Geography column (GeoLocation) which I see is now supported in EF5 (great!) but I'm getting an \"unsupported type\" error in my Silverlight project (TestApp1), how can exclude the GeoLocation property in my Domain Service so that my Silverlight App doesn't complain?</p>\n"},{"tags":["asp.net-mvc","entity-framework","design","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13204145,"title":"Implicit EF queries in Views cause DataReader-related InvalidOperationException","body":"<p>At some point of developing an ASP.NET MVC solution which uses EF as it's ORM I started to encouter a rare-discovered bug (or Heisenbug, as it totally disappears under step-by-step debugging).</p>\n\n<p>At SO, I found that the source of my bug may be either:</p>\n\n<ul>\n<li><code>DbContext</code> is a static Lazy&lt;>-wrapped field in my domain model, thus subject to <code>using(){}</code> idiom multiple result sets.</li>\n<li>My views themselves call HtmlHelper custom extension methods that have EF queries inside (e.g. DropDown select population, thumbnail link generation etc.).</li>\n</ul>\n\n<p>First problem was solved simply by adding <code>multipleactiveresultsets=True</code> to my <code>connectionString</code> definition.</p>\n\n<p>The latter hypothetically requires a switch to ViewModels, prepopulated inside controller actions. However, there many cases where use of ViewModel will be an overkill, requiring addition of dummy copy-create code that will cause maintenance overhead.</p>\n\n<p>My questions are:</p>\n\n<ul>\n<li>Why EF queries inside Views cause <code>There is already an open DataReader associated with this Command which must be closed first.</code> error? Do <em>they</em>?</li>\n<li>How to stop views executing queries without full codebase rewrite?</li>\n</ul>\n"},{"tags":["entity-framework","api","repository-pattern","unit-of-work"],"answer_count":1,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13211731,"title":"Unit of Work, LazyLoading Disabled, Generic Repository, IncludeMultiple<T>, Http 500 error","body":"<ol>\n<li><p>I have a Vehicle with an association to Model, Model has an association to Make.</p></li>\n<li><p>Here is my Generic Repository as pertaining to associations as LazyLoadingEnabled = false in my project:</p>\n\n<pre><code>public IQueryable&lt;T&gt; IncludeMultiple&lt;T1&gt;(params Expression&lt;Func&lt;T, object&gt;&gt;[] associations) where T1 : class\n{\n    var source = (IQueryable&lt;T&gt;)DbContext.Set&lt;T&gt;();\n    if (associations != null)\n    {\n        foreach (Expression&lt;Func&lt;T, object&gt;&gt; path in associations)\n            source = DbExtensions.Include&lt;T, object&gt;(source, path);\n    }\n    return source;\n}\n</code></pre></li>\n<li><p>In my api controller, I am using Unit of work pattern. Here is my GetAll method:</p>\n\n<pre><code>public IEnumerable&lt;Vehicle&gt; GetAll()\n{\n  var vehicles = Uow.VehicleRepository.IncludeMultiple&lt;Vehicle&gt;(c =&gt; c.VehicleModel).ToList();\n  return vehicles;\n}\n</code></pre></li>\n</ol>\n\n<p>Everything works fine and Json retrieves the Vehicle class data as well as the related VehicleModel class data.</p>\n\n<p>However, Vehicle has no direct association to VehicleMake, only VehicleModel does. Now, if my GetAll method has this:</p>\n\n<pre><code>    public IEnumerable&lt;Vehicle&gt; GetAll()\n    {\n      var vehicles = Uow.VehicleRepository.IncludeMultiple&lt;Vehicle&gt;(c =&gt; c.VehicleModel, c =&gt; c.VehicleModel.VehicleMake).ToList();\n      return vehicles;\n    }\n</code></pre>\n\n<p>while I see in debug that vehicles does indeed have the vehicles and their relevant VehicleModel and VehicleMake data, it returns a Http 500 error in Fiddler. </p>\n\n<hr>\n\n<p>Update:</p>\n\n<hr>\n\n<p>Added another association in Vehicle called \"Test\", with the GetAll method being:</p>\n\n<p>(c => c.VehicleModel, c => c.Test)</p>\n\n<p>No error, all data was returned via fiddler. So, it appears that a \"Non-direct association\" (ie Vehicle -> VehicleMake) is the cause of the error.</p>\n\n<hr>\n\n<p>Question:</p>\n\n<hr>\n\n<p>What would be the correct way to retrieving the relevant Vehicle data and its associated classes' data and return it to Json while not getting a Http 500 error?</p>\n"},{"tags":["entity-framework","entity-framework-5","c#-4.5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13206431,"title":"Entity Framework 5.0 Conventions","body":"<p>I am just beginning to learn Entity Framework (starting with 5.0) and running into some issues. After watching a few videos on Pluralsight, I decided to get creative and created an abstract base class that inherited from DbContext and exposed a single \"DataContext\" property that was a DbSet of a generic type. Something like this:</p>\n\n<pre><code>public abstract class BaseDataContext&lt;E&gt; : DbContext\n     where E : CustomEntity\n{\n      public DbSet&lt;E&gt; DataContext {get;set;}\n\n      public BaseDataContext()\n      {\n           Database.SetInitializer&lt;BaseDataContext&lt;E&gt;&gt;(null);\n      }\n }\n</code></pre>\n\n<p>This seemed to be working great until I started dealing with entities that had relationships with each other (parent/child). What was occurring is when I tried to add a new child entity to the database via a data class that inherited BaseDataContext is instead of just attaching the reference (meaning, taking the child and say \"your parent key is 123\"), it created another record with a new key for the parent and all other fields duplicated and made this new record the parent of the child. I tried just setting the key property of my child (nulling out the property that was exposed with the data), but that didn't change anything. I found a thread on SO (<a href=\"http://stackoverflow.com/questions/5823115/adding-user-to-a-role-inserts-a-duplicate-user-into-users-table\">here</a>) that said it wasn't a good idea to do multiple data contexts like what I was attempting to do and seemed to explain exactly what was happening.</p>\n\n<p>My question for this is, with the popularity EF seems to be gaining for everyone, is this the common approach? To create a single data context that is then passed around with constructors everywhere? Or is there a simpler way that is more common? This would especially apply if things get into background threads since passing a context there might get difficult.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13212578,"title":"Defining foreign key constraints with Entity Framework code-first","body":"<p>I have following entity class called <code>Code</code>. It stores categories of different kinds - the data for which I would have otherwise needed to create many small tables e.g. User Categories, Expense Categories, Address types, User Types, file formats etc.</p>\n\n<pre><code>public class Code\n{\n    public int Id { get; set; }\n    public string CodeType { get; set; }\n    public string CodeDescription { get; set; }\n\n\n    public virtual ICollection&lt;Expense&gt; Expenses { get; set; }\n    public virtual ICollection&lt;Address&gt; Addresses { get; set; }\n                   :\n                   : // many more\n\n}\n</code></pre>\n\n<p>The class <code>Expense</code> looks like this:</p>\n\n<pre><code>public class Expense\n{\n    public int Id { get; set; }\n\n    public int CategoryId { get; set; }\n    public virtual Code Category { get; set; }\n\n    public int SourceId { get; set; }\n\n    public double Amount { get; set; }\n    public DateTime ExpenseDate { get; set; }\n}\n</code></pre>\n\n<p>With the above class definitions, I have established 1:many relation between <code>Code</code> and <code>Expense</code> using the <code>CategoryId</code> mapping. </p>\n\n<p>My problem is, I want to map the <code>SourceId</code> field in <code>Expense</code> to the <code>Code</code> object. Which means, <code>Expense</code> object would contain </p>\n\n<pre><code>public Code Source { get; set; }\n</code></pre>\n\n<p>If I use this, at runtime I get an error about cyclic dependencies.</p>\n\n<p>Can someone please help?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":13,"score":3,"question_id":13212811,"title":"Entity Framework IN clause on navigation property","body":"<p>I have a object IQueryable which I am trying to dynamically add Where clauses, this works great for columns on Listing object, however now conditionally I would like to add a IN clause to a navigation property (ListingAmenities) which has columns ListingID, AmenityID</p>\n\n<p>I have critiera.AmenityIDs which may contain Amenities I like to filter the results on.</p>\n\n<p>I am trying to achieve the following if there is any amenityIDs in my array</p>\n\n<pre><code>select * from Listings l inner join ListingAmenities a on l.ListingID = a.ListingID where a.AmenityID IN(1,2,3)\n</code></pre>\n\n<p>here is my code (I am using EF5)</p>\n\n<pre><code>if (criteria.AmenityIDs.Count &gt; 0)\n        {\n            listings = listings.Where(x =&gt; x.ListingAmenities.Any(y =&gt; y.AmenityID == criteria.AmenityIDs));\n        }\n</code></pre>\n\n<p>which of course does not work.\nImportant note is that I am adding these WHERE clauses dynamically so that is why I am building up a IQueryable object</p>\n"},{"tags":["entity-framework","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13209676,"title":"Is it possible to keep many relations in one table column?","body":"<p>I use Entity Framework code first and I have problem because EF creates the <code>Event</code> table with two reference keys, one for class <code>ObjectOne</code>, and another for class <code>ObjectTwo</code>. </p>\n\n<p>Is it possible to keep values of Id in one column <code>Event.ObjectId</code> and the type of relation in properties <code>Event.Type</code>?</p>\n\n<p>I can do following mapping (in which I have only one column for FK). Is it possible to not create FK in database, because now I must add value that exists in <code>ObjectOne</code> table and <code>ObjectTwo</code> table and it's not a solution for me):</p>\n\n<pre><code> modelBuilder.Entity&lt;ObjectOne&gt;()\n            .HasMany(c =&gt; c.Events).WithOptional().HasForeignKey(x =&gt; x.ObjectId);\n        modelBuilder.Entity&lt;ObjectTwo&gt;()\n            .HasMany(c =&gt; c.Events).WithOptional().HasForeignKey(x =&gt; x.ObjectId);\n</code></pre>\n\n<p>Sample classes:</p>\n\n<pre><code> public class ObjectOne\n{\n    public int ObjectOneId { get; set; }\n    public ICollection&lt;Event&gt; Events { get; set; }\n}\n\npublic class ObjectTwo\n{\n    public int ObjectTwoId { get; set; }\n    public ICollection&lt;Event&gt; Events { get; set; }\n}\n\n\npublic class Event\n{\n    public int EventId { get; set; }\n    public int ObjectId { get; set; }\n    public string Type { get; set; }\n}\n\npublic class AddEvent : Event\n{\n}\n\npublic class Updated : Event\n{\n}\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["php",".net","database","entity-framework","orm"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2601,"score":3,"question_id":5532688,"title":"ORM for PHP like .NET Entity Framework","body":"<p>I'm a .NET developer and new in PHP. I want to know, is there a ORM for PHP like the Entity Framework in the Microsoft .NET Framework? </p>\n\n<p>Are there any utility applications to make working with data faster and easier?</p>\n"},{"tags":[".net","entity-framework","optimistic-concurrency"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13173415,"title":"Update properties of attached entity with databasevalue on query","body":"<p>I have entity classes that have an integer property (named ROW_VERSION) with ConcurrencyMode set to \"Fixed\" for optimistic concurrency checking. I increment the value of this column in my application code before saving an entity of this type (so StoreGeneratedPattern is set to None). This works well when saving changes.</p>\n\n<p>Now I also would like to detect a concurrency error when I have a previously loaded entity (with ROW_VERSION = x) and I create a new DbContext, attach this entity and issue a query involving this entity. The problem there is that if the ROW_VERSION was incremented by another client application (ROW_VERSION = x + 1), this isn't detected during my query, because the value of the attached entity has obviously priority (which totally makes sense for common column values).</p>\n\n<p>For my concurrency checking column on the other hand it would be nice, if the EF updates the value with the current databasevalue, so I can compare it with the expected value. Alternatively an exception thrown from the query execution would be acceptable.</p>\n\n<p>I'm using entity framework 4.3 with .NET 4.0.</p>\n\n<p>Edit (in response to the comment from Gert Arnold):</p>\n\n<p>I try to clarify my problem a little more ...</p>\n\n<p>Notes of how my application works generally:</p>\n\n<ul>\n<li><p>There is a treeview showing my available entity objects and on selecting one, the full entity is loaded from DB to be displayed in a detail view, where it can be edited</p></li>\n<li><p>Modifications to an entity object are not saved immediately but are cached in memory, so modifications of different entity objects can pile up and are saved all together, when the user hits the save button.</p></li>\n<li><p>DbContexts are created separately for queries and saving changes (i.e. I don't have the same DbContext all the time, but they are instantiated as needed).</p></li>\n<li><p>When an entity object is loaded to be display in the detail view, all previously modified entity objects (that are cached) are attached to the DbContext that is used for the query first. Then the actual query is issued. <strong>So if i query an entity object, that was modified before I will get the modified version as result and not the version from database (which could have changed in the meantime).</strong></p></li>\n</ul>\n\n<p>So here is an example that shows my problem:</p>\n\n<ol>\n<li><p>Client App 1 loads an entity object with ROW_VERSION = 1, disposes the DbContext and keeps the reference to this entity object for further editing.</p></li>\n<li><p>Client App 2 loads the same entity object mentioned in step 1, changes a property and saves the changes. This causes the ROW_VERSION in the DB to be incremented (it is 2 now).</p></li>\n<li><p>The user of Client App 1 now changes some properties of entity object (which is still in memory with a ROW_VERSION of 1).</p></li>\n<li><p>Before Client App 1 saves the changes, it loads some other entity objects for display, and eventually selects the entity object in question again (e.g. to review the changes made). This causes a query where the result will contain the already changed entity object (because it is attached to the DbContext before the actual query is sent to the database).</p>\n\n<p><strong>And here is my problem: At this point the entity framework could compare the ROW_VERSION of the attached object with that of the object in the actual query result, detect a mismatch and e.g. throw an exception.</strong></p>\n\n<p><strong>But instead the EF treats the ROW_VERSION property like all other properties which could just have been changed by the client.</strong></p></li>\n</ol>\n\n<p>So I wish the EF to treat the ROW_VERSION property specially and compare its values on every query to detect changes by other clients. This way I would detect concurrency situations earlier than when waiting for the SaveChanges call.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13210738,"title":"EF5 , Widows Forms , Dragging a chield entity from project datasource into a GridView creates only 2 columns","body":"<p>After moved to EF5, created a diagram with 2 tables linked thru a FKey like Order/Order Details , then create a new project datasource with the Order object , dragging a column into a text box creates a binding source successfully , but then dragging the child entity OrderDetails into a gridview creates only 2 columns Count &amp; IsReadOnly .</p>\n\n<p>VS2010 or 2012 , same\n.NET 4.0 or 4.5 , same problem</p>\n\n<p>return to EF4 , problem solved</p>\n"},{"tags":["entity-framework","mono"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":244,"score":0,"question_id":9767223,"title":"Mono + Entity Framework using MS DLL?","body":"<p>I know Mono has no EF implementation, and no plans to create one. </p>\n\n<p>Would it be possible, however, to simply take the relevant DLLs from .NET and add them into my Mono project in MonoDevelop? I may be completely misunderstanding how this is supposed to work; but wondered if this would then allow me to continue using EF + Mono rather than replacing the ORM.</p>\n\n<p>Thanks.</p>\n"},{"tags":["entity-framework","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2831,"score":4,"question_id":1546474,"title":"Is ADO.NET Entity framework database schema update possible?","body":"<p>I'm working on proof of concept application like crm and i need your some advice.\nMy application's data layer completely dynamic and run onto EF 3.5. When the user update the entity, change relation or add new column to the database, first i'm planning make for these with custom classes. After I rebuild my database model layer with new changes during the application runtime. And my model layer tie with tightly coupled to my project for easy reflecting model layer changes (It connected to my project via interfaces and loading onto to application domain in the runtime).</p>\n\n<p>I need to create dynamic entities, create entity relations and modify them during the runtime after that i need to create change database script for updating database schema. I know ADO.NET team says \"we will be able to provide this property in EF 4.0\", but i don't need to wait for them.</p>\n\n<p>How can i update database changes during the runtime via EF 3.5 ? </p>\n\n<p>For example, i need to create new entity or need to change some entity schema, add new properties or change property types after than how can apply these changes on the physical database schema  ?</p>\n\n<p>Any ideas ?   </p>\n"},{"tags":["entity-framework","hang","savechanges"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13207907,"title":"Entity Framework SaveChanges \"hangs\" the program","body":"<p>My code is pretty simple:</p>\n\n<pre><code>Context.AddObject(\"EntitiesSetName\", newObjectName);\nContext.SaveChanges();\n</code></pre>\n\n<p>It worked fine, but just one time – the first one. That time, I interrupted my program by Shift+F5 after the SaveChanges() was traced. It was a debug process, so I manually removed a newly created record from a DB and ran a program again in the debug mode. But it does not work anymore – it “hangs” when SaveChanges() is being called. </p>\n\n<p>Another strange thing that I see: \nIf I write before addObject() and SaveChanges() are called something like:</p>\n\n<pre><code>var tempResult = (from mydbRecord in Context \n                  where Context.myKey == 123 \n                  select mydbRecord.myKey).Count(); \n// 123 is the key value of the record that should be created before the program hangs.\n</code></pre>\n\n<p>tempResult will have the next value: 1. </p>\n\n<p>So, it seems that the record is created (when the program hung) and now exists, but when I check the DB manually using other tools – it does not!</p>\n\n<p>What do I do wrong? Is it some kind of cache issue or something else?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I've found a source of problem.\nIt was not EF problem at all, but it's a problem of the tool that I use to control the database manually (Benthic).</p>\n\n<p>My program falls into some kind of deadlock (when I call SaveChanges()) with the tool when the tool is connected into the same DB.</p>\n\n<p>So, the problem is in the synchronization area, imho, so my question can be marked as solved.</p>\n"},{"tags":["asp.net","entity-framework","json.net"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13209262,"title":"control [JsonIgnore] in ASP.NET Web API during runtime","body":"<p>As we know, ASP.NET web api (ApiController) gives JSON response automatically through NewtonSoft.JSON.</p>\n\n<p>My three-level <strong>1:MANY:1</strong> EF data model is queried in several ways and it works fine with applying [JsonIgnore] attribute to some virtual properties in order to eliminate reference circulation issue.\n(I use third solution in <a href=\"http://stackoverflow.com/questions/13060609/why-my-super-simple-asp-net-web-api-mvc4entity-framework-5-doesnt-work\">this(link)</a> answer)</p>\n\n<p>but my problem is, I sometimes need to use json-ignored properties to query with model.</p>\n\n<p>Is there any method to control <strong>[JsonIgnore]</strong> attribute during runtime?\nOr, is there any method to switch on-and-off property to be ignored in NewtonSoft.JSON during runtime?</p>\n"},{"tags":["entity-framework","foreign-keys","composite-key"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13205156,"title":"Composite Key Not Loading All Related Entities","body":"<p>I've been trying various solutions to this for a couple of hours now and I just cannot figure it out.  I'm using a custom membership provider in a system so have a roles table defined using code first like this:</p>\n\n<pre><code>public class UsersInRole\n{\n    [Key]\n    public long UserId { get; set; }\n\n    [Required]\n    public UserProfile UserProfile { get; set; }\n\n    [Key]\n    public long RoleId { get; set; }\n\n    [Required]\n    public webpages_Role Role { get; set; }\n}\n</code></pre>\n\n<p>When I script out this table all seems correct:</p>\n\n<pre><code>CREATE TABLE [dbo].[UsersInRoles](\n[UserId] [bigint] NOT NULL,\n[RoleId] [bigint] NOT NULL,\nCONSTRAINT [PK_dbo.UsersInRoles] PRIMARY KEY CLUSTERED \n(\n[UserId] ASC,\n[RoleId] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n\nALTER TABLE [dbo].[UsersInRoles]  WITH CHECK ADD  CONSTRAINT [FK_dbo.UsersInRoles_dbo.UserProfile_UserId] FOREIGN KEY([UserId])\nREFERENCES [dbo].[UserProfile] ([Id])\nON DELETE CASCADE\nGO\n\nALTER TABLE [dbo].[UsersInRoles] CHECK CONSTRAINT [FK_dbo.UsersInRoles_dbo.UserProfile_UserId]\nGO\n\nALTER TABLE [dbo].[UsersInRoles]  WITH CHECK ADD  CONSTRAINT [FK_dbo.UsersInRoles_dbo.Roles_RoleId] FOREIGN KEY([RoleId])\nREFERENCES [dbo].[Roles] ([RoleId])\nON DELETE CASCADE\nGO\n\nALTER TABLE [dbo].[UsersInRoles] CHECK CONSTRAINT [FK_dbo.UsersInRoles_dbo.Roles_RoleId]\nGO\n</code></pre>\n\n<p>The strange behaviour is only the UserProfile property is ever populated.  If I load the UsersInRole objects directly through the context I see the same behaviour.</p>\n\n<pre><code>var userInRoles = context.UsersInRoles.ToList();\n</code></pre>\n\n<p>The UserProfile properties are loaded but the Role property is always null.</p>\n\n<p>The UsersInRole entity has this composite key mapped:</p>\n\n<pre><code>HasKey(compKey =&gt; new { compKey.UserId, compKey.RoleId });\n</code></pre>\n\n<p>I've checked over and over the relationships and as far as I can tell this should be working fine.  The UserProfile id field is Id and the role id field is RoleId as the relationships state.  I can't see the wood for the trees now!!</p>\n\n<p>Any ideas would be appreciated.</p>\n"},{"tags":["asp.net","entity-framework",".net-4.0"],"answer_count":2,"favorite_count":4,"up_vote_count":23,"down_vote_count":0,"view_count":11975,"score":23,"question_id":1761362,"title":"Entity Framework One-To-One Mapping Issues","body":"<p>Using VS 2010 beta 2, ASP.NET MVC.</p>\n\n<p>I tried to create an Entity framework file and got the data from my database.</p>\n\n<p>There were some issues with the relationships, so I started to tweak things around, but I kept getting the following error for simple one-to-one relationships</p>\n\n<pre><code>Error   1\tError 113: Multiplicity is not valid in Role 'UserProfile' in relationship 'FK_UserProfiles_Users'. \nBecause the Dependent Role properties are not the key properties, the upper bound of the multiplicity of the Dependent Role must be *.  myEntities.edmx\t2024\n</code></pre>\n\n<p>My Users table is consists of some other many-to-many relationships to other tables, but when I try to make a one-to-one relationship with other tables, that error pops up.</p>\n\n<p><strong>Users Table</strong></p>\n\n<ul>\n<li>UserID</li>\n<li>Username</li>\n<li>Email</li>\n</ul>\n\n<p>etc..</p>\n\n<p><strong>UserProfiles Table</strong></p>\n\n<ul>\n<li>UserProfileID</li>\n<li>UserID (FK for Users Table)</li>\n<li>Location</li>\n<li>Birthday</li>\n</ul>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13207695,"title":"enum declaration in code first ef does not appear in database table","body":"<p>I create a sample project according to <a href=\"http://msdn.microsoft.com/en-us/data/hh859576\" rel=\"nofollow\">this article</a>, and I am also using EF 5.0, but when I look at the table, I cant see the \"Name\" field. here is my code :</p>\n\n<pre><code>class Program\n    {\n        static void Main(string[] args)\n        {\n            using (var context = new EnumTestContext())\n            {\n                context.Departments.Add(new Department { Name = DepartmentNames.English });\n\n                context.SaveChanges();\n\n                var department = (from d in context.Departments\n                                  where d.Name == DepartmentNames.English\n                                  select d).FirstOrDefault();\n\n                Console.WriteLine(\n                    \"DepartmentID: {0} Name: {1}\",\n                    department.DepartmentID,\n                    department.Name);\n            }\n        }\n    }\n\n    public enum DepartmentNames\n    {\n        English,\n        Math,\n        Economics\n    }\n\n    public partial class EnumTestContext : DbContext\n    {\n        public DbSet&lt;Department&gt; Departments { get; set; }\n\n        public EnumTestContext()\n            : base(\"name=Test_Connection\")\n        {\n\n        }\n    }\n\n    public partial class Department\n    {\n        public int DepartmentID { get; set; }\n        public DepartmentNames Name { get; set; }\n        public decimal Budget { get; set; }\n    }\n</code></pre>\n\n<p>and also my app.config:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;\n\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n  &lt;/configSections&gt;\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework\"&gt;\n      &lt;parameters&gt;\n        &lt;parameter value=\"v11.0\" /&gt;\n      &lt;/parameters&gt;\n    &lt;/defaultConnectionFactory&gt;\n  &lt;/entityFramework&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"Test_Connection\" connectionString=\"Data Source=127.0.0.1;Initial Catalog=TestEnumEF;Integrated Security=true;\" providerName=\"System.Data.SqlClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p><strong>Note</strong>: commenting \"entityFramework\" config section from above code does not have any effect.</p>\n\n<p>Thanks for your help.</p>\n\n<p><strong>Edited</strong>: \nI installed EF 5.0 from Nuget Package Manager, and While I was trying to install this, it said that EF version is 5.0 but in solution explorer, when I right clicked on Entityframework dll, the properties pan shows version is 4.4.0.0</p>\n"},{"tags":["c#","entity-framework","transactions","dapper","savechanges"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13202765,"title":"Custom atomic UPDATE commands inside SaveChanges()","body":"<p>For various reasons I need to be able to do several custom SQL <code>UPDATE</code> commands when I call <code>SaveChanges</code> on a <code>DbContext</code>. I want this to happen atomically so either both the regular <code>SaveChanges</code> and the SQL succeeds, or neither does.</p>\n\n<p>I don't know how to accomplish this though. What I've tried so far is this and various variations:</p>\n\n<p><a href=\"https://gist.github.com/4004127\" rel=\"nofollow\">EF transactions — Gist</a></p>\n\n<p>The error here is (on the <code>ExecuteSqlCommand</code> call):</p>\n\n<blockquote>\n  <p>ExecuteNonQuery requires the command to have a transaction when the connection assigned to the command is in a pending local transaction.</p>\n</blockquote>\n\n<p>Okay, fair enough. The <code>ExecuteSqlCommand</code> doesn't have an overload that accepts a transaction though. So, I installed the Dapper package and replaced the offending line with this Dapper call and I pass in the transaction:</p>\n\n<pre><code>this.Database.Connection\n  .Execute(\"insert into Tests (Foo, Bar) values ('test', 2)\", \n  transaction: tran);\n</code></pre>\n\n<p>but now the error happens on <code>base.SaveChanges()</code> and it gives me the following:</p>\n\n<blockquote>\n  <p>SqlConnection does not support parallel transactions.</p>\n</blockquote>\n\n<p>So apparently <code>SaveChanges</code> always creates a new transaction even though I created one on the connection of the datacontext already?</p>\n\n<p>Is there any way in which I can accomplish what I want?</p>\n\n<p>I'm using Entity Framework 5.0 Code First.</p>\n"},{"tags":["entity-framework",".net-4.5","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13204475,"title":"(EF 5 + .net 4,5) escalating transaction to DTC when querying using EF-Linq and SqlConnection","body":"<p>We recently upgraded our project to use .net 4.5 and EF 5. We use traditional SqlConnection to query legacy part of application and EF-Linq for rest.</p>\n\n<p>After upgrade code that used to work fine started throwing error regarding MSDTC service being not available. Turning MSDTC service on solves the problems.</p>\n\n<p><strong>Question is why my transactions are getting escalated? Has anything changed in .net 4.5 or EF 5?</strong></p>\n\n<p>For example i have piece of code wrapped in TransactionScope making two updates. First using SqlConnection then second using EF+Linq. Both using exactly same connectionstrings part, connecting to same database in sql server 2012. It get's escalated to DTC. And it used to not escalate using .net 4 and EF 4X.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13204187,"title":"Entity Framework Timeout when called from WCF","body":"<p>I have a .NET project that consists of the following:</p>\n\n<ol>\n<li>WCF web service</li>\n<li>Entity Framework data layer</li>\n</ol>\n\n<p>The ultimate issue described below is with the User table. The User table the schema is as follows:</p>\n\n<pre><code>CREATE TABLE [dbo].[User](\n    [Id] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY CLUSTERED,\n    [FirstName] [varchar](50) NOT NULL,\n    [LastName] [varchar](50) NOT NULL,\n    [Email] [varchar](50) NOT NULL,\n    [Username] [varchar](50) NOT NULL,\n    [Password] [varchar](250) NOT NULL,\n    [AuthenticationKey] [uniqueidentifier] NULL,\n    [Active] [bit] NOT NULL DEFAULT (1),\n    [Admin] [bit] NOT NULL DEFAULT (0),\n    [AutoSubmit] [bit] NOT NULL DEFAULT(0))\n\nCREATE UNIQUE NONCLUSTERED INDEX [IX_User] ON [dbo].[User] \n(\n        [Username] ASC\n)\n</code></pre>\n\n<p>If I run a query against the User table with 3 records in it, it executes in less than a second.</p>\n\n<p>I am running the following query against Entity Framework in a method called User.Validate().</p>\n\n<pre><code>database.User.Where(user =&gt; user.Username == userName &amp;&amp; user.Active).SingleOrDefault()\n</code></pre>\n\n<p>The above code executes ok when calling from a unit test. However, when calling from that method from a WCF web service, the following exception occurs:</p>\n\n<p><em>System.ServiceModel.FaultException: System.Web.Services.Protocols.SoapException: Server was unable to process request. ---> System.Data.EntityCommandExecutionException: An error occurred while executing the command definition. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding. ---> System.ComponentModel.Win32Exception: The wait operation timed out</em></p>\n\n<p>Under the covers of Entity Framework, the below query is what is run when the query timed out. If I run the query it executes in less than a second. What might be causing this timeout?</p>\n\n<pre><code>exec sp_executesql N'SELECT TOP (2) \n[Extent1].[Id] AS [Id], \n[Extent1].[FirstName] AS [FirstName], \n[Extent1].[LastName] AS [LastName], \n[Extent1].[Email] AS [Email], \n[Extent1].[Username] AS [Username], \n[Extent1].[Password] AS [Password], \n[Extent1].[AuthenticationKey] AS [AuthenticationKey], \n[Extent1].[Active] AS [Active], \n[Extent1].[Admin] AS [Admin], \n[Extent1].[AutoSubmit] AS [AutoSubmit]\nFROM [dbo].[User] AS [Extent1]\nWHERE [Extent1].[Username] = @p__linq__0',N'@p__linq__0 varchar(8000)',@p__linq__0='test1'\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12933661,"title":"EF 4.3+ How to get current database initialzer","body":"<p>How can I get the current database initializer, so I can test that the right one is set before automatic publish?</p>\n\n<p><strong>Edit</strong>: I want to create a test case that is testing if a team member forgot to remove a line like this:</p>\n\n<pre><code>Database.SetInitializer&lt;SomeModel&gt;(new DropCreateDatabaseAlways&lt;SomeModel&gt;());\n</code></pre>\n\n<p>but there is no method or property like Database.GetInitializer().</p>\n\n<p>is there a way to get current database initializer?</p>\n"},{"tags":["c#",".net","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":11655912,"title":"Entity Framework does not read FK Relationships, LINQ To SQL Does","body":"<p>I am trying to create an Entity Model from a database.  When I add the tables EF does not read my existing FK constraints.  If I make a Linq to SQL file in the same project and add the same tables it reads the constraints without issue.</p>\n\n<p>Whats the deal?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13184540,"title":"What are the ways to optimize Entity Framework queries with Contains()?","body":"<p>Wee load large object graph from DB.\nThe query has many Includes and Where()uses Contains() to filter the final result.\nContains is called for the collection containing about thousand entries.</p>\n\n<p>The profiler shows monstrous human-unreadable SQL.\nThe query cannot be precompiled because of Contains().</p>\n\n<p>Is there any ways for optimization of such queries?</p>\n\n<p><strong>Update</strong></p>\n\n<pre><code>public List&lt;Vulner&gt; GetVulnersBySecurityObjectIds(int[] softwareIds, int[] productIds)\n        {\n            var sw = new Stopwatch();\n\n            var query = from vulner in _businessModel.DataModel.VulnerSet\n                        join vt in _businessModel.DataModel.ObjectVulnerTieSet.Where(ovt =&gt; softwareIds.Contains(ovt.SecurityObjectId))\n                        on vulner.Id equals vt.VulnerId\n                        select vulner;\n\n            var result = ((ObjectQuery&lt;Vulner&gt;)query.OrderBy(v =&gt; v.Id).Distinct())\n                .Include(\"Descriptions\")\n                .Include(\"Data\")\n                .Include(\"VulnerStatuses\")\n                .Include(\"GlobalIdentifiers\")\n                .Include(\"ObjectVulnerTies\")\n                .Include(\"Object.ProductObjectTies.Product\")\n                .Include(\"VulnerComment\");\n\n            //Если переданы конкретные продукты, добавляем фильтрацию\n            if (productIds.HasValues())\n                result = (ObjectQuery&lt;Vulner&gt;)result.Where(v =&gt; v.Object.ProductObjectTies.Any(p =&gt; productIds.Contains(p.ProductId)));\n\n            sw.Start();\n            var str = result.ToTraceString();\n            sw.Stop();\n            Debug.WriteLine(\"Сборка запроса заняла {0} секунд.\", sw.Elapsed.TotalSeconds);\n            sw.Restart();\n            var list = result.ToList();\n            sw.Stop();\n            Debug.WriteLine(\"Получение уязвимостей заняло {0} секунд.\", sw.Elapsed.TotalSeconds);\n\n            return list;\n        }\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13202383,"title":"Return list of mapped classes - Entity Framework","body":"<p>I have this class that is linked to a View in the SQL Server:</p>\n\n<pre><code>[Table(\"V_Clients\")]\npublic class Client\n{\n    [Key]\n    public int ClientId { get; set; }\n    public short BranchId { get; set; }\n    public string CorporateName { get; set; }\n    public string TIN { get; set; }\n    public string Address { get; set; }\n    public string Phone { get; set; }\n    public string Id { get; set; }//NroCi\n    public short CityId { get; set; }\n    public short ZoneId { get; set; }\n    public short SubZoneId { get; set; }\n    public short VendorId { get; set; }\n    public short PriceListId { get; set; }\n    public short CollectorId { get; set; }\n\n    [ForeignKey(\"BranchId\")]\n    public virtual Branch Branch { get; set; }\n\n    [ForeignKey(\"CityId\")]\n    public virtual City City { get; set; }\n\n    [ForeignKey(\"ZoneId\")]\n    public virtual Zone Zone { get; set; }\n\n    [ForeignKey(\"SubZoneId\")]\n    public virtual SubZone SubZone { get; set; }\n\n    [ForeignKey(\"VendorId\")]\n    public virtual Vendor Vendor { get; set; }\n\n    [ForeignKey(\"PriceListId\")]\n    public virtual PriceList PriceLists {get;set;}\n\n    [ForeignKey(\"CollectorId\")]\n    public virtual Collector Collector { get; set; }\n}\n</code></pre>\n\n<p>but when I try to make a list of it like this:</p>\n\n<pre><code>public ActionResult Index()\n    {\n        var clients = db.Clients.Include(c =&gt; c.Branch).Include(c =&gt; c.City).Include(c =&gt; c.Zone).Include(c =&gt; c.SubZone).Include(c =&gt; c.Vendor).Include(c =&gt; c.PriceLists).Include(c =&gt; c.Collector);\n        return View(clients.ToList());\n    }\n</code></pre>\n\n<p>nothing happens. Could it be because of the relationships?</p>\n\n<p>Note: All classes are linked to views and work fine with the others except my <code>Client</code> class.</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13200242,"title":"Entity framework navigation property is null","body":"<p>I have 2 simple classes:</p>\n\n<pre><code>public class Setting\n{\n    [Key, DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Guid SettingId { get; set; }\n\n    [Required]\n    public String Name { get; set; }\n\n    public String Value { get; set; }\n\n    [Required]\n    public SettingCategory SettingCategory { get; set; }\n}\n\npublic class SettingCategory\n{\n    [Key, DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Guid SettingCategoryId { get; set; }\n\n    [Required]\n    public String Value { get; set; }\n\n    public ICollection&lt;Setting&gt; Settings { get; set; }\n}\n</code></pre>\n\n<p>When I retrieve a <code>SettingCategory</code> from the database the collection Settings is always null.</p>\n\n<p>When I make it a <code>virtual</code> then it will say: <code>The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.</code></p>\n\n<p>How can I access my <code>Settings</code> list?</p>\n\n<p>The other way around works, if I retrieve a <code>Setting</code> from the database the <code>SettingCategory</code> property is filled.</p>\n\n<p>This is my initial code-migrations script:</p>\n\n<pre><code>CreateTable(\n    \"dbo.Settings\",\n    c =&gt; new\n        {\n            SettingId = c.Guid(nullable: false, identity: true),\n            Name = c.String(nullable: false),\n            Value = c.String(),\n            SettingCategory_SettingCategoryId = c.Guid(nullable: false),\n        })\n    .PrimaryKey(t =&gt; t.SettingId)\n    .ForeignKey(\"dbo.SettingCategories\", t =&gt; t.SettingCategory_SettingCategoryId, cascadeDelete: true)\n    .Index(t =&gt; t.SettingCategory_SettingCategoryId);\n\nCreateTable(\n    \"dbo.SettingCategories\",\n    c =&gt; new\n        {\n            SettingCategoryId = c.Guid(nullable: false, identity: true),\n            Value = c.String(nullable: false),\n        })\n    .PrimaryKey(t =&gt; t.SettingCategoryId);\n</code></pre>\n\n<p>And this is the part that gets it from the database:</p>\n\n<pre><code>public SettingCategory Get(Guid settingCategoryId)\n{\n    using (var context = new BackofficeContext())\n    {\n        return context\n            .SettingCategories\n            .FirstOrDefault(s =&gt; s.SettingCategoryId == settingCategoryId);\n    }\n}\n</code></pre>\n\n<p><strong>Answer</strong></p>\n\n<p>I forgot the include in <code>.SettingCategories</code>, but I was trying it with a lambda:</p>\n\n<pre><code>public SettingCategory Get(Guid settingCategoryId)\n{\n    using (var context = new BackofficeContext())\n    {\n        return context\n            .SettingCategories\n            .Include(s =&gt; s.Settings)\n            .FirstOrDefault(s =&gt; s.SettingCategoryId == settingCategoryId);\n    }\n}\n</code></pre>\n\n<p>That doesn't work, but this does:</p>\n\n<pre><code>public SettingCategory Get(Guid settingCategoryId)\n{\n    using (var context = new BackofficeContext())\n    {\n        return context\n            .SettingCategories\n            .Include(\"Settings\")\n            .FirstOrDefault(s =&gt; s.SettingCategoryId == settingCategoryId);\n    }\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13187078,"title":"Unable to use EF EDMX from separate project","body":"<p>I have a simple solution with four projects; a console app for UI, domain objects, data repository, and an EF data model.</p>\n\n<p>The DataModel project contains the EF EDMX. It's separate as it may be consumed by other projects. I'm not sure about keeping it in its own project but, for now, it is.</p>\n\n<p>The DataLayer project contains the data repositories and datacontext classes. The DataLayer project references the DataModel and Domain projects.</p>\n\n<p>The Domain projects contains a T4 template and generated domain objects. This project references the DataModel project.</p>\n\n<p>I modified the app.config of the UI project to point to the DataModel project for the EDMX.</p>\n\n<p>When I run the application, I get an error: \"FileNotFoundException was unhandled. Unable to resolve assembly 'DataModel'.\" I noticed an assembly named DataModel was not in the Bin folder but all other expected files were present.</p>\n\n<p>I checked the Metadata Artifact Processing property on the EDMX. It was set to Embed in Output Assembly.</p>\n\n<p>If I move the EDMX from the DataModel project to the DataLayer project, everything works fine.</p>\n\n<p>How do I troubleshoot this further? Why can't I use the EDMX in the DataModel folder?</p>\n\n<p>Entity Framework 5\nVisual Studio 2010\nC# / .NET 4</p>\n"},{"tags":["c#","mysql","entity-framework","linq-to-entities","database-performance"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":13201049,"title":"MySQL with Entity Framework is slow because of derived tables. How can I fix it?","body":"<p>I am using MySQL Connector/Net 6.5.4 with LINQ to entities, and <strong>I frequently get terrible query performance because the entity framework generates queries that use derived tables.</strong> </p>\n\n<p>Here is a simplified example of what I've encountered several times. In C#, I write a query like this:</p>\n\n<pre><code>var culverCustomers = from cs in db.CustomerSummaries where cs.Street == \"Culver\";\n// later...\nvar sortedCustomers = culverCustomers.OrderBy(cs =&gt; cs.Name).ToList();\n</code></pre>\n\n<p>Instead of generating simple a query like this:</p>\n\n<pre><code>SELECT cust.id FROM customer_summary cust WHERE cust.street = \"Culver\" ORDER BY cust.name\n</code></pre>\n\n<p>The entity framework generates a query with a derived table like this:</p>\n\n<pre><code>SELECT Project1.id FROM (\n    SELECT cust.id, cust.name, cust.street FROM customer_summary cust\n    WHERE Project1.street = \"Culver\"\n) AS Project1 -- here is where the EF generates a pointless derived table\nORDER BY Project1.name\n</code></pre>\n\n<p>If I explain both queries I get this for the first query:</p>\n\n<pre><code>id, select_type, table, type, possible_keys, rows\n1,  PRIMARY,     addr,  ALL,  PRIMARY,       9\n1,  PRIMARY,     cust,  ref,  PRIMARY,       4\n</code></pre>\n\n<p>... and something awful like this for the entity framework query</p>\n\n<pre><code>id, select_type, table,      type, possible_keys, rows\n1,  PRIMARY,     &lt;derived2&gt;, ALL,                 9639 *** WTF!!!\n2,  DERIVED,     addr,       ALL,  PRIMARY,       9\n2,  DERIVED,     cust,       ref,  PRIMARY,       4\n</code></pre>\n\n<p>Note the first row, where MySQL explains that it's scanning <strong>9000+ records</strong>. Because of the derived table, MySQL is creating a temp table and loading every frigging row. (Or so I'm deducing based on articles like this one: <a href=\"http://www.mysqlperformanceblog.com/2006/08/31/derived-tables-and-views-performance/\" rel=\"nofollow\">Derived Tables and Views Performance</a>)</p>\n\n<p><strong>How can I prevent the Entity Framework from using a derived table, or how can I convince MySQL to do the obvious optimization for queries like this?</strong></p>\n\n<p>For completion, here is the view that is the source for this linq query:</p>\n\n<pre><code>create view  customer_summary as\nselect cust.id, cust.name, addr.street\ncustomers cust \njoin addresses addr\non addr.customer_id = cust.id\n</code></pre>\n"},{"tags":["c#","linq","entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":26,"score":2,"question_id":13200430,"title":"Cannot query property named \"group\" on EF object","body":"<p>I have an EF entity object <code>sysSettings</code> class that has a few properties. <code>group</code> and <code>name</code> is among these properties.</p>\n\n<p><code>quer</code> in the code below is an <code>IQueryable&lt;sysSettings&gt;</code> object.</p>\n\n<p>When trying to write the following query, I'm having difficulty with the second where clause.</p>\n\n<pre><code>var query = from setting in quer\n    where (setting.name.Equals(\"Url\") &amp;&amp; setting.group.Equals(\"system\"))\nselect setting;\n</code></pre>\n\n<p>It seems that when I have a property on an Entity object called <code>group</code> I cannot access that property from within the LINQ query.</p>\n\n<p>I think this might be because <code>group</code> may be a reserved/contextual work/action in LINQ.</p>\n\n<p>Changing the property name of the Entity is unfortunately not an option.</p>\n"},{"tags":["database","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13198869,"title":"Is there a command to check to see if a database exists from Entity Framework?","body":"<p>I may have worded the question poorly but in my global.asx file i use </p>\n\n<pre><code> if (System.Diagnostics.Debugger.IsAttached)\n        {\n            var test = new TestDbSeeder(App_Start.NinjectWebCommon.UcxDbContext);\n            test.seed();\n       }\n</code></pre>\n\n<p>This checks to see if the debugger is attached and runs my test seeder so that my acceptance tests always pass.</p>\n\n<p>I need to check to see if the database exists as well and if not run this code first:</p>\n\n<pre><code>  var test2 = new DataSeeder();\n  test2.Seed(App_Start.NinjectWebCommon.UcxDbContext);\n</code></pre>\n\n<p>This dataseeder is the actual data that has to always be in the database. Is there a command to check  if the database exists so that I can run that code block.  Thanks!</p>\n"},{"tags":["c#",".net","entity-framework","lambda"],"answer_count":8,"favorite_count":0,"up_vote_count":26,"down_vote_count":0,"view_count":20774,"score":26,"question_id":2058487,"title":"Entity Framework - Cannot convert lambda expression to type 'string' because it is not a delegate type","body":"<p>I am using Entity Framework in my C# based code.  I am running into an unexpected weirdness and am looking for suggestions.</p>\n\n<p>Case 1, 2, 3, 4...\nProjects:<br>\nRivWorks.dll<br>\nRivWorks.Service.dll<br>\nRivWorks.Alpha.dll  </p>\n\n<p>Samples (all of these work):<br/>\n<strong>RivWorks.Alpha.dll:</strong></p>\n\n<pre><code>public static bool EndNegotitation(long ProductID)\n{\n    var product = (from a in _dbFeed.AutoWithImage \n                   where a.AutoID == ProductID select a).FirstOrDefault();\n...\n}\n</code></pre>\n\n<p><strong>RivWorks.Service.dll</strong></p>\n\n<pre><code>public static RivWorks.Model.NegotiationAutos.AutoWithImage \n    GetProductById(long productId)\n{\n    var myProduct = from a in _dbFeed.AutoWithImage \n                    where a.AutoID == productId select a;\n\n    return myProduct.FirstOrDefault();\n}\npublic static List&lt;RivWorks.Model.NegotiationAutos.AutoWithImage&gt; \n    GetProductByCompany(Guid companyId)\n{\n    var myProduct = from a in _dbFeed.AutoWithImage \n                    where a.CompanyID == companyId select a;\n\n    return myProduct.ToList();\n}\n</code></pre>\n\n<p>etc</p>\n\n<p>Case \"weirdness\":<br>\nRivWorks.Web.Service.dll (WCF project)<br>\nContains the same references as the other projects.</p>\n\n<pre><code>public NegotiateSetup GetSetup(string method, string jsonInput)\n{\n    ...\n    long.TryParse(ProductID, out result);\n    var product = (from a in _dbFeed.AutoWithImage \n                   where a.AutoID == result select a).FirstOrDefault();\n    ...\n}\n</code></pre>\n\n<p>I am getting this compile time error (the word \"where\" is highlighted in my editor):<br/>\n<em>Cannot convert lambda expression to type 'string' because it is not a delegate type</em><br/></p>\n\n<p>Any ideas what would cause this?</p>\n"},{"tags":["entity-framework","design-patterns","domain-driven-design","repository-pattern"],"answer_count":5,"favorite_count":3,"up_vote_count":9,"down_vote_count":0,"view_count":150,"score":9,"question_id":13180501,"title":"What specific issue does the repository pattern solve?","body":"<p><em>(Note: My question has very similar concerns as the person who asked <a href=\"http://stackoverflow.com/questions/11618809/few-things-about-repository-pattern-that-i-simply-dont-understand\">this question</a> three months ago, but it was never answered.)</em></p>\n\n<p>I recently started working with MVC3 + Entity Framework and I keep reading that the best practice is to use the repository pattern to centralize access to the DAL. This is also accompanied with explanations that you want to keep the DAL separate from the domain and especially the view layer. But in the examples I've seen the repository is (or <em>appears to be</em>) simply returning DAL entities, i.e. in my case the repository would return EF entities.</p>\n\n<p>So my question is, what good is the repository if it only returns DAL entities? Doesn't this add a layer of complexity that doesn't eliminate the problem of passing DAL entities around between layers? If the repository pattern creates a \"single point of entry into the DAL\", how is that different from the context object? If the repository provides a mechanism to retrieve and persist DAL objects, how is that different from the context object?</p>\n\n<p>Also, I read in at least one place that the Unit of Work pattern centralizes repository access in order to manage the data context object(s), but I don't grok why this is important either.</p>\n\n<p>I'm 98.8% sure I'm missing something here, but from my readings I didn't see it. Of course I may just not be reading the right sources... :\\</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","asp.net","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13194650,"title":"Filter with EntityDatasource in ASP.NET webforms","body":"<p>I have two Classes (given via Entity Framework) which are in a many to many relationship:</p>\n\n<pre><code>Corporation which has the member Tags\n\nTag which has the member name\n</code></pre>\n\n<p>The EntityDataSource gives me the ObjectQuery which i want to filter in a given tagname but i don't know how.  I want to get all corporations, which have a tag with the name \"myname\". I don't know how to do the linq query</p>\n\n<p>When i query the entities i unfortunately don't get an Objectquery.</p>\n\n<pre><code>protected void EntityDataSource1_QueryCreated(object sender, QueryCreatedEventArgs e)\n{\n    // first try\n    var corps = e.Query.Cast&lt;Corporation&gt;(); \n    // of course doesn't work, because oyu can't access a member (name) of a collection (Tags) \n    // i don't know the right linq expression for this\n    e.Query = from c in corps where c.Tags.Name.Contains(\"myname\") select c; \n\n    // second try\n    var tags = from t in entities.Tags where t.Name.Contains(\"myname\") select t;\n    var filteredcorporations = from c in tags select c.Corporations;\n    // does not work because it is not a ObjectQuery&lt;Corporation&gt;\n    e.query = filteredcorporations; \n}\n</code></pre>\n\n<p>My EntityDataSource:</p>\n\n<pre><code>&lt;asp:EntityDataSource ID=\"EntityDataSource1\" runat=\"server\" ConnectionString=\"name=eodbEntities\" DefaultContainerName=\"eodbEntities\" EnableFlattening=\"False\" EntitySetName=\"Corporations\" OnQueryCreated=\"EntityDataSource1_QueryCreated\"&gt;\n&lt;/asp:EntityDataSource&gt;\n</code></pre>\n"},{"tags":["asp.net-mvc-3","entity-framework","validation","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13184018,"title":"How does validation work in database-first dbContext (EF4.3.1 & MVC3)?","body":"<p>How does validation work in database-first dbContext (EF4.3.1 &amp; MVC3)?</p>\n\n<p>I'm doing this (yes, it's VB):</p>\n\n<pre><code>If ModelState.IsValid Then\n\n                db.SaveChanges()\n</code></pre>\n\n<p>But the SaveChanges throws DbEntityValidationException \"Validation failed for one or more entities. See 'EntityValidationErrors' property for more details.\"</p>\n\n<p>I expect it to return the view again with the appropriate validation messages, but clearly I'm missing something because I don't know why it should work that way!  You would expect Google to help, but most examples seem to be code-first.</p>\n\n<p>This is database first, so the model has been generated. I would expected the validation constraints to be generated too (at least simple ones like NOT NULL in SQL Server) , but that doesn't seem to work.</p>\n\n<p>Oddly, some fields are working as explected and others aren't.  </p>\n\n<p>For example, I have a non-nullable text field in the database. It appears as non-nullable in the EF designer and in the generated code. But when I submit it, I get the exception instead of returning the form with the field highlighted.</p>\n\n<p>On the other hand, I have a date field that is non-nullable. It is checked prior to trying to update the database, and the form is presented again with the field highlighted for correction.</p>\n"},{"tags":["asp.net-mvc","entity-framework","postgresql","devart"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13187573,"title":"Entity Framework complaining about required fields when saveChanges even if valid data are setted","body":"<p>I'm using Entity Framework (DbContext with database first) with MVC. When user save from a form, I have a condition in the controller that send the entity to the <strong>update</strong> of <strong>insert</strong> method depending of some internal flag of mine.</p>\n\n<p>When sending entity to the update method, I flag it to modified using <code>context.Entry(myEntity).State = EntityState.Modified;</code>,  I call saveChanges() and everything work well.</p>\n\n<p>When sending the entity to the insert method, I flag it to added using <code>context.Entry(myEntity).State = EntityState.Added;</code> but when calling saveChanges() I receive error about 2 fields that are required...</p>\n\n<p>The problem is that thoses 2 fields are not empty and they effectively contain valid data just before saving... I have even try to force new values to thoses 2 fields just before saving but same error.</p>\n\n<p>It may be usefull to mention that I'm using Devart DotConnect For PostgreSQL as db provider.</p>\n\n<p>Any idea how to debug this problem?</p>\n\n<p><strong>EDIT:</strong> </p>\n\n<p>Here is the error:</p>\n\n<blockquote>\n  <p>Validation failed for one or more entities. See 'EntityValidationErrors' property for more details.</p>\n</blockquote>\n\n<p>When looking for this EntityValidationErrors I receive the 2 following specific errors:</p>\n\n<blockquote>\n  <p>The flg_actif field is required</p>\n  \n  <p>The user_creation field is required</p>\n</blockquote>\n\n<p>As mentionned before, those fields are filled with data just before saving so I don't understand what is happening.</p>\n\n<p>I'm using EF v4.0.30319 (system.data.entity=> v4.0 and EntityFramework=> v4.4)</p>\n\n<p><strong>EDIT2:</strong>\nJust to clarify a little bit more: The entity I'm trying to insert already exist in database. The form show the data of this database row. When saving, I decide if I update the row (this work well) but sometime, I need to insert the edited row as a new register instead of updating it to keep an history of the change in database.</p>\n"},{"tags":["jquery","asp.net-mvc","wcf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13196887,"title":"jQuery Autocomplete tied to WCF Service ASP.NET MVC","body":"<p>New to ASP.NET MVC and programming, and I have searched high and low for materials on this subject but haven't found a concrete answer for my particular problem.</p>\n\n<p>The project I am working on requires the use of WCF services.  Initially I started with a jQuery autocomplete function that worked, however moving the code to a WCF service has broken some communication.  The autocomplete functionality no longer works  </p>\n\n<p>WCF Service</p>\n\n<pre><code>public IList&lt;Location&gt; QuickSearchLocation(string term)\n    {\n        using (var db = new InspectionEntities())\n        {\n            //return all locations except the reserved \"Other\"\n            return db.Locations\n                .Where(r =&gt; r.LocationName.Contains(term) &amp;&amp; r.LocationId !=    Constants.OtherId)\n                .ToList();\n        }\n    } \n</code></pre>\n\n<p>The above code is meant to takes user input based on relation to child table.  If user input does not match data in child table, the users entry is saved to an \"other\" column in the main db.</p>\n\n<p>Controller</p>\n\n<pre><code>public ActionResult QuickSearchLocation(string term)\n    {\n        return Json(_service.QuickSearchLocation(term), JsonRequestBehavior.AllowGet);\n    }\n</code></pre>\n\n<p>View</p>\n\n<pre><code>div class=\"editor-field\"&gt;\n        @Html.TextBoxFor(m=&gt;m.LocationId,new {data_autocomplete =     Url.Action(\"QuickSearchLocation\", \"Inspection\")})\n</code></pre>\n\n<p>script</p>\n\n<pre><code>$(document).ready(function () {\n\n$(\":input[data-autocomplete]\").each(function () {\n\n    $(this).autocomplete({ source: $(this).attr(\"data-autocomplete\")});\n});\n</code></pre>\n\n<p>Any insight on my problem would be helpful.</p>\n"},{"tags":["entity-framework","migration","primary-key","constraints"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13196826,"title":"Entity Framework constraint naming in database","body":"<p>I have a problem with the naming of some primary keys in the database. On my development system the primary key constraints are named <code>PK_FullTableName</code>. Now on a production system the constraints are all named <code>PK_PartofTableName_3214EC27164452B1</code> (with different Hex characters for each table).</p>\n\n<p>The problem I have are the migrations. I have a code-based migration, that should change the primary key of a table and therefore has to drop the old constraint/primary key with <code>DropPrimaryKey(\"FullTableName\", new[] { \"Field1\", \"Field2\" });</code> </p>\n\n<p>On my development system everything works fine, on the productive system I get an SQL exception that the constraint <code>PK_FullTableName</code> could not be found and I cannot migrate.</p>\n\n<p>I don´t know why Entity Framework names the constraints different on these two systems. Does anyone know what this behavior is depending on? Is this naming from the EF or from the database(MSSQLExpress)? And is there a workaround?</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":12935730,"title":"EF 5 DBContext.Set<T>.Remove(entity) fails, but succeeds when I debug and step into","body":"<p>Got a very strange scenario here.</p>\n\n<p>Calling the following Code using DBContext the Remove Fails</p>\n\n<pre><code>int id = 5;\nvar sql = \"SELECT * from dbo.Product WHERE productId = @id\";\nvar data = dbContext.Set&lt;Product&gt;().SqlQuery(sql, new object[] {new SQLParameter(\"id\", id)});\n\nvar entityToDelete = data.AsQueryable().FirstOrDefault();\n\ndbContext.Set&lt;Product&gt;().Remove(entityToDelete); \ndbContext.SaveChanges();\n</code></pre>\n\n<p>I receive the following Error Message:</p>\n\n<blockquote>\n  <p>Entities in 'MyEntities.Products' participate in the\n  'FK_Product_ProductType' relationship. 0 related 'ProductType' were\n  found. 1 'ProductType' is expected.</p>\n</blockquote>\n\n<p>Now Every product has a foreign key reference to a ProductType.  There is actually a value set for this Foreign Key in the Database.</p>\n\n<p>Here is the kicker.  When I debug and step into the code line by line it succeeds?  Very strange?  Why is this happening?  any ideas?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>It succeeds when I watch the variable entityToDelete when Debugging.  But fails if I remove the watch.  Which makes me think it has something to do with Lazy Loading.</p>\n"},{"tags":["sql-server","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13196804,"title":"How to set collate on database when using EF code-first","body":"<p>I am trying to set collate to Latin1_General_100_CI_AS in a database created by EF code-first. I am using EF 5. To do this I am using a DbInitializer of type DropCreateDatabaseAlways and overriding the Seed method. In it I am executing the following code as the first statement.</p>\n\n<pre><code>context.Database.ExecuteSqlCommand(\"ALTER DATABASE EMR_SA COLLATE Latin1_General_100_CI_AS\");\n</code></pre>\n\n<p>This executes fine and does modify the database correctly, but the problem is that after this statement I seed some database values. When I try to commit these inserts I get the following  error </p>\n\n<pre><code>  InnerException: System.Data.SqlClient.SqlException\n   HResult=-2146232060\n   Message=Resetting the connection results in a different state than the initial login. The login fails.\n   Login failed for user \n</code></pre>\n\n<p>While writing this question it appears that this is a duplicate of <a href=\"http://stackoverflow.com/questions/12054930/set-database-collation-in-entity-framework-code-first-initializer\">this QA</a> but there is no answer for it.  I am hoping by resubmitting this question that someone has had experience since then that may allow them to answer this now. What is the best way to set collate on a database when using EF code-first?</p>\n"},{"tags":["c#","entity-framework","nunit","dbcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12882826,"title":"Why am I getting DbContext Has Changed exception when using NUnit?","body":"<p>I'm using Entity Framework 5 in my project. And I wanted to test some new funcionalities.</p>\n\n<p>What happened is that eventhough my db is UPDATED, (when I add a migration it does not add anything else) and eventhough if I run my project it runs just fine. When I try to test the project with NUNIT I get this exception:</p>\n\n<p><code>System.InvalidOperationException : The model backing the 'DbContext' context has changed since the database was created. Consider using Code First Migrations to update the database</code></p>\n\n<p>Has any of you have this problem? If so how can I solve it?</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13126872,"title":"EF5 Code First Migrations - DB Init running over and over","body":"<p>Got this weird thing going on with my new EF5 Code First app that's leveraging new new migrations support. One thing that I'm seeing is that the database seeding routine is running on the initial DB load, but what's strange is that it seems to run again after the app hasn't run in a while. Is this to be expected? What's the best way to keep this from happening?</p>\n\n<p>I get the whole .AddOrUpdate(), but still seems odd to have this run more than when the app first ran and created the DB schema. Ideas?</p>\n"},{"tags":["entity-framework",".net-3.5","connections"],"answer_count":2,"favorite_count":3,"up_vote_count":12,"down_vote_count":0,"view_count":4915,"score":12,"question_id":1282675,"title":"When does Entity Framework open and close Database Connections?","body":"<p>When I instance my \"Entities\" object in Entity Framework, and make a couple of queries using that Entities object, what happens to connections?</p>\n\n<ul>\n<li>Does it open a connection when I instance the object, and close it when I dispose of it?</li>\n<li>Or does it open and close a connection for each single query I execute?</li>\n</ul>\n\n<p>In either case, is it possible to change it so that it does the other thing?</p>\n\n<p>Thanks in advance!\nDaniel</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13194215,"title":"The property is not a declared property on type 'class'","body":"<p>I got the error <code>The property 'Rank' is not a declared property on type 'MasterUser'. Verify that the property has not been explicitly excluded from the model by using the Ignore method or NotMappedAttribute data annotation. Make sure that it is a valid primitive property.</code> I checked my model class and it is there.</p>\n\n<pre><code>public class MasterUser\n{\n    //many other properties...\n    public virtual char Rank { get; set; }\n    //more properties below\n}\n</code></pre>\n\n<p>I also checked my db context and it is also there and mapped perfectly.<br/></p>\n\n<pre><code>public class BBDataContext : DbContext\n{\n    public DbSet&lt;MasterUser&gt; Users { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        #region MUSR_USRID mapping\n\n        //Mapped properties above....\n        modelBuilder.Entity&lt;MasterUser&gt;()\n            .Property(usr =&gt; usr.Rank).HasColumnName(\"MUSR_RANK\");\n        //More mapped properties..\n\n        modelBuilder.Entity&lt;MasterUser&gt;().ToTable(\"dbo.MUSR_FIL\");\n        #endregion\n\n        base.OnModelCreating(modelBuilder);\n    }\n}\n</code></pre>\n\n<p>In the table, <code>MUSR_RANK</code> is nullable with a char datatype.</p>\n\n<p>How can I fix this? Does the database have an effect on this? I am currently using SQL Server 2000.</p>\n\n<p>Thanks for the help.</p>\n"},{"tags":["asp.net-mvc","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13181932,"title":"Update Related Entity Of Detached Entity","body":"<p>I'm having an issue <strong>updating</strong> an entity with multiple related entities. I've got a very simple model which consists of an article entity and a list of categories the article can be related to. You can choose from a check box list which of these categories are associated to it...which works fine.</p>\n\n<p>The problem crops up when I actually come to <strong>update</strong> an existing entity using the dbContext. As I am updating this entity, I have already detached it from the context ready to re-attach it later so the update can execute properly. </p>\n\n<p>I can see that after I posting the model, the category(s) are being added to the article entity just fine and it looks like it updates in the repository with no errors occurring. </p>\n\n<p>When I look in the database the article has updated as normal but the category(s) have not.</p>\n\n<p>Here is my (simplified) update code...</p>\n\n<pre><code>    public virtual bool Attach(T entity)\n    {\n        _dbContext.Entry(entity).State = EntityState.Modified;\n        _dbSet.Attach(entity);\n\n        return this.Commit();\n    }\n</code></pre>\n\n<p>Any help will be much appreciated.</p>\n"},{"tags":["c#","sql-server","asp.net-mvc","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13192696,"title":"Mapping stored procedures to entities with additional computed column","body":"<p>I am currently stuck with one of my projects and need some help..</p>\n\n<p>I created a table valued function in MSSQL that returns a table and a computed column (Distance) and have mapped it in Entity Framework 5 using the Entity Designer. </p>\n\n<p>The problem is that I can only map the results either as a complex type or an entity that is in my model class. I need to use one of the Navigation Property in the entity and hence, I am stuck with using my entity class. </p>\n\n<p>However, because the column Distance is not a real column in my table, I have no way of getting that value for every entity for the table valued function. </p>\n\n<p>Is there any way of hacking around this? I've tried using a partial class but the function would not map the Distance column as a property for me. </p>\n\n<p>Here's a little code to explain what I'm trying to do here :</p>\n\n<pre><code>IQueryable&lt;Deal&gt; deals = context.GetDealsByTypeLocationSearch(latitude, longitude);\nforeach (var d in deals)\n{\n  Console.Write(d.Distance); \n}\n</code></pre>\n\n<p>The distance value is null when I tried to create a partial class for my entity Deal.</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":81,"score":3,"question_id":12553073,"title":"Entity Framework Migration cascade delete is always true even WillCascadeOnDelete(false) in configuration","body":"<p>Why relations with  WillCascadeOnDelete(false) defined in configuration,  are always true in generated migration? </p>\n\n<p><strong>Here is the configuration code</strong></p>\n\n<pre><code> public class PartySuppliesConfiguration:EntityTypeConfiguration&lt;PartySupplies&gt;\n{\n    public PartySuppliesConfiguration()\n    {\n        HasKey(x =&gt; x.Id);\n        HasRequired(x=&gt;x.Supplier).WithMany().HasForeignKey(x=&gt;x.SupplierId).WillCascadeOnDelete(false);\n        HasRequired(x =&gt; x.Product).WithMany().HasForeignKey(x =&gt; x.ProductId).WillCascadeOnDelete(false);\n        HasRequired(x =&gt; x.Currency).WithMany().HasForeignKey(x =&gt; x.CurrencyId).WillCascadeOnDelete(false);\n        HasRequired(x =&gt; x.CreatedUser).WithMany().HasForeignKey(x =&gt; x.CreatedUserId).WillCascadeOnDelete(false);\n        Property(x =&gt; x.UnitPrice).HasColumnType(\"Money\");\n    }\n}\n</code></pre>\n\n<p><strong>and here is the generated migration</strong> </p>\n\n<pre><code> public override void Up()\n    {\n        CreateTable(\n            \"PartySupplies\",\n            c =&gt; new\n                {\n                    Id = c.Int(nullable: false, identity: true),\n                    SupplierId = c.Int(nullable: false),\n                    ProductId = c.Int(nullable: false),\n                    UnitPrice = c.Decimal(nullable: false, precision: 18, scale: 2),\n                    CurrencyId = c.Int(nullable: false),\n                    FromDate = c.DateTime(nullable: false),\n                    ThruDate = c.DateTime(),\n                    CreatedUserId = c.Int(nullable: false),\n                })\n            .PrimaryKey(t =&gt; t.Id)\n            .ForeignKey(\"Parties\", t =&gt; t.SupplierId, cascadeDelete: true)\n            .ForeignKey(\"Products\", t =&gt; t.ProductId, cascadeDelete: true)\n            .ForeignKey(\"Curencies\", t =&gt; t.CurrencyId, cascadeDelete: true)\n            .ForeignKey(\"Users\", t =&gt; t.CreatedUserId, cascadeDelete: true)\n            .Index(t =&gt; t.SupplierId)\n            .Index(t =&gt; t.ProductId)\n            .Index(t =&gt; t.CurrencyId)\n            .Index(t =&gt; t.CreatedUserId);\n\n    }\n</code></pre>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","mvc","entity-framework","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":293,"score":0,"question_id":10282061,"title":"HOw can I access two database in single .edmx file?","body":"<p>I have created mvc3 application.</p>\n\n<p>I have one <code>.edmx</code> already created which is based on <code>Db1</code> but now\nI have created a view which is based on <code>Database2</code> and I need to use this view inside my project.</p>\n\n<p>For that I need to update my EF <code>.edmx</code> file.\nbut when I right click and select option <code>Update model from Database</code>\ni'm only getting <code>all tables , view ,sps from</code>Db1<code>` its obvious\nBut as i need to use view which is from</code>Database2<code>how can i add it into my model</code>.edmx` file?\nplease help. </p>\n"},{"tags":["asp.net-mvc","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13191379,"title":"VS 2010 / MVC4 / EF5 Add new controller error","body":"<p>When I attempt to add a new controller, I get the following template error. I've tried setting my template back to normal and reinstalling mvc4 and ef5 to no avail.</p>\n\n<p>Error:</p>\n\n<pre><code>Error   1   Running transformation: System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---&gt; System.IO.FileNotFoundException: Unable to locate file\n   at Microsoft.VisualStudio.TextTemplating.VSHost.TextTemplatingService.ResolvePath(String path)\n   at Microsoft.VisualStudio.TextTemplating.VSHost.TextTemplatingService.ResolvePath(String path)\n   --- End of inner exception stack trace ---\n   at System.RuntimeMethodHandle._InvokeMethodFast(IRuntimeMethodInfo method, Object target, Object[] arguments, SignatureStruct&amp; sig, MethodAttributes methodAttributes, RuntimeType typeOwner)\n   at System.RuntimeMethodHandle.InvokeMethodFast(IRuntimeMethodInfo method, Object target, Object[] arguments, Signature sig, MethodAttributes methodAttributes, RuntimeType typeOwner)\n   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture, Boolean skipVisibilityChecks)\n   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)\n   at Microsoft.VisualStudio.TextTemplatingB214C175D962501244305AB8E4D64CC3.GeneratedTextTransformation.DynamicHost.ResolvePath(String path)\n   at Microsoft.VisualStudio.TextTemplatingB214C175D962501244305AB8E4D64CC3.GeneratedTextTransformation.EdmMetadataLoader.CreateEdmItemCollection(String sourcePath)\n   at Microsoft.VisualStudio.TextTemplatingB214C175D962501244305AB8E4D64CC3.GeneratedTextTransformation.TransformText()\n   at Microsoft.VisualStudio.TextTemplating.TransformationRunner.RunTransformation(TemplateProcessingSession session, String source, ITextTemplatingEngineHost host, String&amp; result)        1   1   \n</code></pre>\n"},{"tags":["c#","sql","entity-framework","sql-server-2012","filetable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13181645,"title":"Entity Framework 5.0 and FileTable","body":"<p>So say I have the following tables in my SQL Server 2012 DB:</p>\n\n<pre><code>Person\n  PersonId\n  FirstName\n  LastName\n\nPhoto\n  PhotoId\n  PersonId (fk)\n  DateTaken\n\nPhotoFileTable\n  (all the FileTable columns)\n</code></pre>\n\n<p>And the photos stored on disk are structured like this:\n\\\\myserver\\filestreamshare\\People\\PersonId\\Photo1.tif</p>\n\n<p>And very important:  There are a TON of photos ALREADY on disk that need to be added to the database- that's why I thought a FileTable would be cool as it automatically picks them up.</p>\n\n<p>So I need to do 2 things- first, relate the Photo table to the PhotoFileTable so that I can get all photos for a person.  And second (and more painful) I want to use Entity Framework 5.0 to do this.</p>\n\n<p>Using the edmx designer, I can't add a table that contains a hierarchyid.  Since that is the primary key it seems it should be used as a 1:1 mapping between PhotoId and path_locator (the FileTable hierarchyid).  But then I can't add the Photo table either.</p>\n\n<p>What's the best approach here?  At the end of the day, I want to have EF objects in C# to use.  It ideally would look something like:</p>\n\n<pre><code>class Person\n  List&lt;Photo&gt;\n\nclass Photo\n  Filestream (to lazy load the image from the filesystem to bitmapimage)\n  Path (?)\n\nor maybe\nclass Photo\n  BitmapImage (lazy load)\n</code></pre>\n\n<p>Am I going about this the wrong way?  Can I get there from here?  Thought or suggestions?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13156258,"title":"EF dbContext IQueryable methods dependencies not working","body":"<p>I've tried to add a few helper methods to my dbContext class like this</p>\n\n<pre><code>public IQueryable&lt;Tool&gt; GetAllToolsInCompanyGroup(string userName)\n{\n    var user = GetUserByName(userName);\n    return Tools.Where(t =&gt; Companies.Any(c =&gt; user.Company.CompanyGroupId == c.CompanyGroupId &amp;&amp; c.Id == t.CompanyId));\n}\n</code></pre>\n\n<p>But if I call that from my controller I get this exception:</p>\n\n<pre><code>Unable to create a constant value of type 'myNamespace.Models.Company'. Only primitive types or enumeration types are supported in this context.\n</code></pre>\n\n<p>If i do the exact same thing in in my controller like this:</p>\n\n<pre><code>db.Tools.Where(t =&gt; db.Companies.Any(c =&gt; user.Company.CompanyGroupId == c.CompanyGroupId &amp;&amp; c.Id == t.CompanyId))\n</code></pre>\n\n<p>it works. What am I doing wrong?</p>\n"},{"tags":["entity-framework","entitydatasource","entity-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":5071,"score":1,"question_id":2768953,"title":"How to implement EntityDataSource Where IN entity sql clause","body":"<p>I want to pass a number of values into a parameter of the <code>EntityDataSource</code>, e.g.:</p>\n\n<p><code>Where=\"it.ORDER_ID IN {@OrderIdList}\"</code> (this is a property on the EntityDataSource)</p>\n\n<pre><code>&lt;WhereParameters&gt;\n    &lt;asp:ControlParameter \n       Name=\"OrderIdList\" Type=\"Int16\" \n       ControlID=\"OrderFilterControl\" PropertyName=\"OrderIdList\" \n    /&gt;\n&lt;/WhereParameters&gt;\n</code></pre>\n\n<p>This doesn't work as <code>ORDER_ID</code> is of type <code>int32</code> and I need to pass in multiple values, e.g. <code>{1,2,3}</code> etc</p>\n\n<p>The next thing I tried was setting the <code>Where</code> clause in code-behind and this all works except I can't get data binding on <code>DropDownLists</code> to work. By this I mean no value is returned from the bound dropdownlists in the <code>EntityDataSource</code> Updating Event.</p>\n\n<p>My ideal solution would be to use a <code>WhereParameter</code> on the <code>EntityDataSource</code> but any help is appreciated. Thanks, Tony.</p>\n\n<hr>\n\n<p>A complete code example follows using the AdventureWorks db:</p>\n\n<pre><code>Public Class EntityDataSourceWhereInClause\nInherits System.Web.UI.Page\n\nProtected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load\n    CustomersEntityDataSource.Where = WhereClause ''# reset after each postback as its lost otherwise\nEnd Sub\n\nPrivate Sub cmdFilterCustomers_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmdFilterCustomers.Click\n    Dim CustomerIdList As New Generic.List(Of Int32)\n    For Each item As ListItem In CustomerIdCheckBoxList.Items\n        If item.Selected Then\n            CustomerIdList.Add(item.Value)\n        End If\n    Next\n\n    Dim CustomerCsvList As String = String.Join(\", \", CustomerIdList.Select(Function(o) o.ToString()).ToArray())\n    WhereClause = \"it.CustomerID IN {\" &amp; CustomerCsvList &amp; \"}\"\n\n    CustomersEntityDataSource.Where = WhereClause\n    FormView1.PageIndex = 0\n\nEnd Sub\n\n''#  save between postbacks the custom Where IN clause\nPublic Property WhereClause() As String\n    Get\n        Return ViewState(\"WhereClause\")\n    End Get\n    Set(ByVal value As String)\n        ViewState.Add(\"WhereClause\", value)\n    End Set\nEnd Property\n\nPrivate Sub CustomersEntityDataSource_Updating(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.EntityDataSourceChangingEventArgs) Handles CustomersEntityDataSource.Updating\n    Dim c = CType(e.Entity, EntityFrameworkTest.Customer)\n    If c.Title.Length = 0 Then\n        Response.Write(\"Title is empty string, so will save like this!\")\n    End If\nEnd Sub\n\nEnd Class\n\n&lt;%@ Page Language=\"vb\" AutoEventWireup=\"false\" CodeBehind=\"EntityDataSourceWhereInClause.aspx.vb\"\nInherits=\"EntityFrameworkTest.EntityDataSourceWhereInClause\" %&gt;\n\n\n&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head runat=\"server\"&gt;\n    &lt;title&gt;&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;form id=\"form1\" runat=\"server\"&gt;\n\n&lt;%''# filter control %&gt;\n&lt;div&gt;\n    &lt;asp:EntityDataSource ID=\"CustomerIdListEntityDataSource\" runat=\"server\" ConnectionString=\"name=AdventureWorksLT2008Entities\"\n        DefaultContainerName=\"AdventureWorksLT2008Entities\" EnableFlattening=\"False\"\n        EntitySetName=\"Customers\" Select=\"it.[CustomerID]\" OrderBy=\"it.[CustomerID]\"&gt;\n    &lt;/asp:EntityDataSource&gt;\n    &lt;asp:CheckBoxList ID=\"CustomerIdCheckBoxList\" runat=\"server\" DataSourceID=\"CustomerIdListEntityDataSource\"\n        DataTextField=\"CustomerID\" DataValueField=\"CustomerID\" RepeatDirection=\"Horizontal\"&gt;\n    &lt;/asp:CheckBoxList&gt;\n    &lt;asp:Button ID=\"cmdFilterCustomers\" runat=\"server\" Text=\"Apply Filter\" /&gt;\n&lt;/div&gt;\n\n&lt;%  \n    ''# you get this error passing in CSV in the where clause\n    ''# The element type 'Edm.Int32' and the CollectionType 'Transient.collection[Edm.String(Nullable=True,DefaultValue=,MaxLength=,Unicode=,FixedLength=)]' are not compatible. The IN expression only supports entity, primitive, and reference types.  Near WHERE predicate, line 6, column 15. \n    ''# so have coded it manually in code-behind Where=\"it.CustomerID IN {@OrderIdList}\"\n%&gt;\n&lt;asp:EntityDataSource ID=\"CustomersEntityDataSource\" runat=\"server\" ConnectionString=\"name=AdventureWorksLT2008Entities\"\n    DefaultContainerName=\"AdventureWorksLT2008Entities\" EnableFlattening=\"False\"\n    EnableUpdate=\"True\" EntitySetName=\"Customers\"\n    AutoGenerateOrderByClause=\"false\"&gt;\n&lt;/asp:EntityDataSource&gt;\n&lt;%''# updating works with DropDownLists until the Where clause is set in code %&gt;\n&lt;asp:FormView ID=\"FormView1\" runat=\"server\" AllowPaging=\"True\" CellPadding=\"4\" DataKeyNames=\"CustomerID\"\n    DataSourceID=\"CustomersEntityDataSource\" ForeColor=\"#333333\"&gt;\n    &lt;EditItemTemplate&gt;\n        CustomerID:\n        &lt;asp:Label ID=\"CustomerIDLabel1\" runat=\"server\" Text='&lt;%# Eval(\"CustomerID\") %&gt;' /&gt;\n        &lt;br /&gt;\n        NameStyle:\n        &lt;asp:CheckBox ID=\"NameStyleCheckBox\" runat=\"server\" Checked='&lt;%# Bind(\"NameStyle\") %&gt;' /&gt;\n        &lt;br /&gt;\n        Title:\n        &lt;%''# the SelectedValue is not Bound to the EF object if the Where clause is updated in code-behind %&gt;\n        &lt;asp:DropDownList ID=\"ddlTitleBound\" runat=\"server\" DataSourceID=\"TitleEntityDataSource\"\n            DataTextField=\"Title\" DataValueField=\"Title\" AutoPostBack=\"false\" AppendDataBoundItems=\"true\"\n            SelectedValue='&lt;%# Bind(\"Title\") %&gt;'&gt;\n        &lt;/asp:DropDownList&gt;\n        &lt;asp:EntityDataSource ID=\"TitleEntityDataSource\" runat=\"server\" ConnectionString=\"name=AdventureWorksLT2008Entities\"\n            DefaultContainerName=\"AdventureWorksLT2008Entities\" EnableFlattening=\"False\"\n            EntitySetName=\"Customers\" Select=\"it.[Title]\" GroupBy=\"it.[Title]\" ViewStateMode=\"Enabled\"&gt;\n        &lt;/asp:EntityDataSource&gt;\n        &lt;br /&gt;\n        FirstName:\n        &lt;asp:TextBox ID=\"FirstNameTextBox\" runat=\"server\" Text='&lt;%# Bind(\"FirstName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        MiddleName:\n        &lt;asp:TextBox ID=\"MiddleNameTextBox\" runat=\"server\" Text='&lt;%# Bind(\"MiddleName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        LastName:\n        &lt;asp:TextBox ID=\"LastNameTextBox\" runat=\"server\" Text='&lt;%# Bind(\"LastName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        Suffix:\n        &lt;asp:TextBox ID=\"SuffixTextBox\" runat=\"server\" Text='&lt;%# Bind(\"Suffix\") %&gt;' /&gt;\n        &lt;br /&gt;\n        CompanyName:\n        &lt;asp:TextBox ID=\"CompanyNameTextBox\" runat=\"server\" Text='&lt;%# Bind(\"CompanyName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        SalesPerson:\n        &lt;asp:TextBox ID=\"SalesPersonTextBox\" runat=\"server\" Text='&lt;%# Bind(\"SalesPerson\") %&gt;' /&gt;\n        &lt;br /&gt;\n        EmailAddress:\n        &lt;asp:TextBox ID=\"EmailAddressTextBox\" runat=\"server\" Text='&lt;%# Bind(\"EmailAddress\") %&gt;' /&gt;\n        &lt;br /&gt;\n        Phone:\n        &lt;asp:TextBox ID=\"PhoneTextBox\" runat=\"server\" Text='&lt;%# Bind(\"Phone\") %&gt;' /&gt;\n        &lt;br /&gt;\n        PasswordHash:\n        &lt;asp:TextBox ID=\"PasswordHashTextBox\" runat=\"server\" Text='&lt;%# Bind(\"PasswordHash\") %&gt;' /&gt;\n        &lt;br /&gt;\n        PasswordSalt:\n        &lt;asp:TextBox ID=\"PasswordSaltTextBox\" runat=\"server\" Text='&lt;%# Bind(\"PasswordSalt\") %&gt;' /&gt;\n        &lt;br /&gt;\n        rowguid:\n        &lt;asp:TextBox ID=\"rowguidTextBox\" runat=\"server\" Text='&lt;%# Bind(\"rowguid\") %&gt;' /&gt;\n        &lt;br /&gt;\n        ModifiedDate:\n        &lt;asp:TextBox ID=\"ModifiedDateTextBox\" runat=\"server\" Text='&lt;%# Bind(\"ModifiedDate\") %&gt;' /&gt;\n        &lt;br /&gt;\n        &lt;asp:LinkButton ID=\"UpdateButton\" runat=\"server\" CausesValidation=\"True\" CommandName=\"Update\"\n            Text=\"Update\" /&gt;\n        &amp;nbsp;&lt;asp:LinkButton ID=\"UpdateCancelButton\" runat=\"server\" CausesValidation=\"False\"\n            CommandName=\"Cancel\" Text=\"Cancel\" /&gt;\n    &lt;/EditItemTemplate&gt;\n    &lt;EditRowStyle BackColor=\"#999999\" /&gt;\n    &lt;FooterStyle BackColor=\"#5D7B9D\" Font-Bold=\"True\" ForeColor=\"White\" /&gt;\n    &lt;HeaderStyle BackColor=\"#5D7B9D\" Font-Bold=\"True\" ForeColor=\"White\" /&gt;\n    &lt;ItemTemplate&gt;\n        CustomerID:\n        &lt;asp:Label ID=\"CustomerIDLabel\" runat=\"server\" Text='&lt;%# Eval(\"CustomerID\") %&gt;' /&gt;\n        &lt;br /&gt;\n        NameStyle:\n        &lt;asp:CheckBox ID=\"NameStyleCheckBox\" runat=\"server\" Checked='&lt;%# Bind(\"NameStyle\") %&gt;'\n            Enabled=\"false\" /&gt;\n        &lt;br /&gt;\n        Title:\n        &lt;asp:Label ID=\"TitleLabel\" runat=\"server\" Text='&lt;%# Bind(\"Title\") %&gt;' /&gt;\n        &lt;br /&gt;\n        FirstName:\n        &lt;asp:Label ID=\"FirstNameLabel\" runat=\"server\" Text='&lt;%# Bind(\"FirstName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        MiddleName:\n        &lt;asp:Label ID=\"MiddleNameLabel\" runat=\"server\" Text='&lt;%# Bind(\"MiddleName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        LastName:\n        &lt;asp:Label ID=\"LastNameLabel\" runat=\"server\" Text='&lt;%# Bind(\"LastName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        Suffix:\n        &lt;asp:Label ID=\"SuffixLabel\" runat=\"server\" Text='&lt;%# Bind(\"Suffix\") %&gt;' /&gt;\n        &lt;br /&gt;\n        CompanyName:\n        &lt;asp:Label ID=\"CompanyNameLabel\" runat=\"server\" Text='&lt;%# Bind(\"CompanyName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        SalesPerson:\n        &lt;asp:Label ID=\"SalesPersonLabel\" runat=\"server\" Text='&lt;%# Bind(\"SalesPerson\") %&gt;' /&gt;\n        &lt;br /&gt;\n        EmailAddress:\n        &lt;asp:Label ID=\"EmailAddressLabel\" runat=\"server\" Text='&lt;%# Bind(\"EmailAddress\") %&gt;' /&gt;\n        &lt;br /&gt;\n        Phone:\n        &lt;asp:Label ID=\"PhoneLabel\" runat=\"server\" Text='&lt;%# Bind(\"Phone\") %&gt;' /&gt;\n        &lt;br /&gt;\n        PasswordHash:\n        &lt;asp:Label ID=\"PasswordHashLabel\" runat=\"server\" Text='&lt;%# Bind(\"PasswordHash\") %&gt;' /&gt;\n        &lt;br /&gt;\n        PasswordSalt:\n        &lt;asp:Label ID=\"PasswordSaltLabel\" runat=\"server\" Text='&lt;%# Bind(\"PasswordSalt\") %&gt;' /&gt;\n        &lt;br /&gt;\n        rowguid:\n        &lt;asp:Label ID=\"rowguidLabel\" runat=\"server\" Text='&lt;%# Bind(\"rowguid\") %&gt;' /&gt;\n        &lt;br /&gt;\n        ModifiedDate:\n        &lt;asp:Label ID=\"ModifiedDateLabel\" runat=\"server\" Text='&lt;%# Bind(\"ModifiedDate\") %&gt;' /&gt;\n        &lt;br /&gt;\n        &lt;asp:LinkButton ID=\"EditButton\" runat=\"server\" CausesValidation=\"False\" CommandName=\"Edit\"\n            Text=\"Edit\" /&gt;\n    &lt;/ItemTemplate&gt;\n    &lt;PagerSettings Position=\"Top\" /&gt;\n    &lt;PagerStyle BackColor=\"#284775\" ForeColor=\"White\" HorizontalAlign=\"Center\" /&gt;\n    &lt;RowStyle BackColor=\"#F7F6F3\" ForeColor=\"#333333\" /&gt;\n&lt;/asp:FormView&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>\n</p>\n"},{"tags":["c#","entity-framework","entity-relationship"],"answer_count":0,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":132,"score":5,"question_id":13086922,"title":"Parent object is in EntityState.Unchanged, but it still inserted in the Database","body":"<p>I have a simple snowflake schema out of which I generated my Entity Framework model.<br>\nThe problem is that I am trying to map a child entity to an <strong><em>existing parent and/or grandparent</em></strong> entity, but it still inserts it.  </p>\n\n<p><em>I followed this:</em>  </p>\n\n<blockquote>\n  <p><a href=\"http://stackoverflow.com/questions/5416323/insert-new-object-with-existing-object\"> Insert new object with existing object</a><br>\n  <a href=\"http://stackoverflow.com/questions/7884887/prevent-entity-framework-to-insert-values-for-navigational-properties\">Prevent Entity Framework to Insert Values for Navigational Properties</a></p>\n</blockquote>\n\n<p>The interesting thing is that even though the EntityState of the parent entities is \"Unchanged\" the Entity Framework still tries to insert it.</p>\n\n<hr>\n\n<h2>The Schema</h2>\n\n<p><img src=\"http://i.stack.imgur.com/RZDIs.jpg\" alt=\"enter image description here\"></p>\n\n<hr>\n\n<h2>CarRepository.Save() method</h2>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public void Save(Car car)\n    {\n        using (DBContext context = new DBContext())\n        {\n            // No need to save if it already exists\n            if ( context.Cars.FirstOrDefault(x =&gt; x.RegistrationNumber == car.RegistrationNumber) != null)\n            {\n                return;\n            }\n            else\n            {\n                // Check if the parent POCOs exist in the DB. \n                Model existingModel = context.Models.FirstOrDefault(x =&gt; x.Name == car.Model.Name);\n                Manufacturer existingManufacturer = context.Manufacturers.FirstOrDefault(x=&gt; x.Name == car.Model.Manufacturer.Name)\n                Trader existingTrader = context.Traders.FirstOrDefault(x=&gt; x.Name == car.Trader.Name)\n                TraderCompany existingTraderCompany = context.TraderCompanys.FirstOrDefault(x=&gt; x.Name == car.Trader.TraderCompany.Name)\n\n                context.ContextOptions.LazyLoadingEnabled = false;\n\n                //Attach to the context if existing in the DB, i.e mark the existing POCOs not to be added the DB\n                if (existingModel != null)\n                {\n                    car.Model = existingModel;\n                    Assert.IsTrue(context.ObjectStateManager.GetObjectStateEntry(car.Model).State == EntityState.Unchanged);\n                }\n\n                if (existingManufacturer != null)\n                {\n                    car.Model.Manufacturer = existingManufacturer;\n                    Assert.IsTrue(context.ObjectStateManager.GetObjectStateEntry(car.Model.Manufacturer).State == EntityState.Unchanged);\n                }\n\n                if (existingTrader != null)\n                {\n                    car.Trader = existingTrader;\n                    Assert.IsTrue(context.ObjectStateManager.GetObjectStateEntry(car.Trader).State == EntityState.Unchanged);\n                }\n\n                if (existingTraderCompany != null)\n                {\n                    car.Trader.TraderCompany = existingTraderCompany;\n                    Assert.IsTrue(context.ObjectStateManager.GetObjectStateEntry(car.Trader.TraderCompany).State == EntityState.Unchanged);\n                }\n\n                //Mark the Car for Addition to the DB\n                context.Cars.AddObject(car);\n                context.ObjectStateManager.ChangeObjectState(car, EntityState.Added);\n\n\n                //If the POCOs do not exist in the DB mark them for addition\n                if (existingModel == null)\n                {\n                   context.ObjectStateManager.ChangeObjectState(car.Model,EntityState.Added);\n                }\n\n                if (existingManufacturer == null)\n                {\n                    context.ObjectStateManager.ChangeObjectState(car.Model.Manufacturer,EntityState.Added);\n                }\n\n                if (existingTrader == null)\n                {\n                    context.ObjectStateManager.ChangeObjectState(car.Trader,EntityState.Added);\n                }\n\n                if (existingTraderCompany == null)\n                {\n                    context.ObjectStateManager.ChangeObjectState(car.Trader.TraderCompany,EntityState.Added);\n                }\n\n                context.SaveChanges();\n\n            }\n        }\n    }\n</code></pre>\n\n<hr>\n\n<h2>Edit:</h2>\n\n<p>After a few days of tinkering I managed to come up with a <strong><em>workaround</em></strong> which worked  for me.  </p>\n\n<p>It seems that the Car that is being passed to the CarRepository.Save() has some kind of <strong><em>internal context</em></strong> which is <strong><em>undetectable</em></strong>... That being so, it is <strong><em>impossible to detach it from that context/s</em></strong> and add it to the one in CarRepository.Save(). In order to actually add it to this context <em>I deep/lazy copy the Car object and its navigation properties</em>, if existing. </p>\n\n<hr>\n\n<h2>The workaround</h2>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public void Save(Car car)\n{\n    using (DBContext context = new DBContext())\n    {\n        // No need to save if it already exists\n        if ( context.Cars\n                    .Any(x =&gt; x.RegistrationNumber == car.RegistrationNumber))\n        {\n            return;\n        }\n        else\n        {\n            //Assign scalar properties to the deep copy\n            Car carToBeSaved = new Car \n            {\n                carToBeSaved.RegistrationNumber = car.RegistrationNumber,\n                carToBeSaved.Price = car.Price\n            }\n\n\n            //Car -&gt; Trader -&gt; ...\n            if(car.Trader != null)\n            {   \n                Trader existingTrader = \n                    context.Traders\n                           .FirstOrDefault(x =&gt; x.Name == car.Trader.Name);\n\n                //If exists in DB assign, if not deep copy\n                carToBeSaved.Trader = existingTrader ??\n                    new Trader\n                    {\n                        Name = car.Trader.Name,\n                        JobTitle = car.Trader.JobTitle\n                    }\n\n                //Car -&gt; Trader -&gt; TraderCompany\n                if(car.Trader.TraderCompany != null)\n                {\n                    TraderCompany existingTraderCompany = \n                        context.TradersCompanys\n                               .FirstOrDefault(x =&gt; x.Name == car.Trader\n                                                                 .TraderCompany\n                                                                 .Name);\n\n                    //If exists in DB assign, if not deep copy  \n                    carToBeSaved.Trader.TraderCompany = existingTraderCompany ??\n                        new TraderCompany\n                        {\n                            Name = car.Trader.TraderCompany.Name,\n                            Address = car.Trader.TraderCompany.Address,\n                            PhoneNumber = car.Trader.TraderCompany.PhoneNumber\n                        }\n                }\n            }\n\n            //Car -&gt; Model -&gt; ...\n            if(car.Model != null)\n            {   \n                Model existingModel = \n                    context.Models\n                           .FirstOrDefault(x =&gt; x.Name == car.Model.Name);\n\n                //If exists in DB assign, if not deep copy\n                carToBeSaved.Model = existingModel ??\n                    new Model\n                    {\n                        Name = car.Model.Name\n                    }\n\n                //Car -&gt; Model -&gt; Manufacturer\n                if(car.Model.Manufacturer != null)\n                {\n                    Manufacturer existingManufacturer = \n                        context.Manufacturers\n                               .FirstOrDefault(x =&gt; x.Name == car.Model\n                                                                 .Manufacturer\n                                                                 .Name);\n\n                    //If exists in DB assign, if not deep copy\n                    carToBeSaved.Model.Manufacturer = existingManufacturer ??\n                    new Manufacturer\n                        {\n                            Name = car.Model.Manufacturer.Name\n                        }\n                }\n            }\n\n            //Mark the Car for Addition to the DB\n            context.Cars.AddObject(car);\n            context.SaveChanges();\n\n        }\n    }\n}\n</code></pre>\n\n<p><em>If someone have any thoughts on this, please share.</em></p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","database","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13191517,"title":"Accessing properties of second table via element of first table","body":"<p>I have two tables which are in a relationship. They are called tblX and tblY.</p>\n\n<pre><code>var x = (from v in db.tblX select v).First();\n</code></pre>\n\n<p>Now x has these properties:</p>\n\n<pre><code>x.name\nx.id\nx.tblY\n</code></pre>\n\n<p>tblY has these properties: idY, nameY.</p>\n\n<p>After I use the linq statement above, I can get to idY without making a join. I can access x.tblY.idY and x.tblY.nameY. Is it ok if I access them like this? Is it a good programming practise?</p>\n"},{"tags":["c#","database","linq","entity-framework","types"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13191320,"title":"The property 'x' on 'tblX' could not be set to a 'null' value. You must set this property to a non-null value of type 'Int16'","body":"<pre><code>List&lt;tblX&gt; messages = (from x in db.tblX where x.msg_id == id_id \n                           || x.name == firstName  select x).ToList();\n</code></pre>\n\n<p>I get the error: </p>\n\n<blockquote>\n  <p>The property 'x' on 'tblX' could not be set to a 'null' value. You must set this property to a non-null value of type 'Int16'.</p>\n</blockquote>\n\n<p>I have a property msg_blocked in db, which is nullable and integer. I know that I need to make a conversion, but I don't use it or need it anywhere in my linq.</p>\n"},{"tags":["entity-framework","unit-testing","moq"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13132601,"title":"Unit test Entity Framework using moq","body":"<p>I'm using entity framework and trying to unit test my data services which are using EF.\nI'm not using repository and unit of work patterns.\nI tried the following approach to mock the context and DbSet:</p>\n\n<pre><code>private static Mock&lt;IEFModel&gt; context;\nprivate static Mock&lt;IDbSet&lt;CountryCode&gt;&gt; idbSet;\n\n    [ClassInitialize]\n    public static void Initialize(TestContext testContext)\n    {\n        context = new Mock&lt;IEFModel&gt;();\n\n        idbSet = new Mock&lt;IDbSet&lt;CountryCode&gt;&gt;();\n\n        context.Setup(c =&gt; c.CountryCodes).Returns(idbSet.Object);\n\n    }\n</code></pre>\n\n<p>I get null \"Object reference not set to an instance of an object\" error for idbSet \"Local\".\nIs there any way to mock idbSet like this?\nThanks</p>\n"},{"tags":[".net","entity-framework","enums","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13188857,"title":"EF5 code first enum support - define the enum inside the entity","body":"<p>Funny question..</p>\n\n<p>I have a type that has a Status field. For my convenience and order of things I want to define the enum for this status inside the Entity type:</p>\n\n<pre><code>public class User\n{\n  public enum Statuses\n  {\n     Active,\n     Suspended\n  }\n\n  public int ID { get; set; }\n  public Statuses Status { get; set; }\n}\n</code></pre>\n\n<p>For some reason the Status property isn't mapped to the database.</p>\n\n<p>Now the funny bit - if I take the enum definition out of User then it is mapped to the DB!</p>\n\n<p>I know that the quick answer would be to leave it outside the class, but that would require me to give the enum a longer name UserStatuses or something like that, as now it isn't scoped inside User.</p>\n\n<p>Did anyone encounter that issue? Is there a solution before I start compromising?</p>\n\n<p>Thanks!</p>\n"},{"tags":["database","entity-framework","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":13166823,"title":"The DELETE statement conflicted with the REFERENCE constraint \"FK_EntityAEntityB\"","body":"<p>I saw the answers about this topic but not exactly such as mine.</p>\n\n<p>I created a db schema by using EF1 in designer.\nI added relation <strong>One Or Zero To Many</strong> between 2 tables (<strong>EntityA</strong> and <strong>EntityB</strong>).\nNext I added one record to table EntityA and one record to EntityB which has id to EntityA record.\nAs I see in design mode (in MS SMS) that field EntityA_id (in table EntityB) is set to ALLOW NULL,\nI tried to delete the record in table EntityA.</p>\n\n<p>I expected that the record would be deleted and the field EntityA_id in table EntityB would be automatically set to NULL.\nUnfortunately I got exception: <strong>The DELETE statement conflicted with the REFERENCE constraint \"FK_EntityAEntityB\"</strong></p>\n\n<p>Why does the exception throw if the field with foreign key is set to ALLOW NULL?</p>\n"},{"tags":["c#","asp.net","linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":55,"score":3,"question_id":13189295,"title":"LINQ query to select best sellers","body":"<p>Could a smart guy help me write a LINQ query to get the best selling products, where I have these 2 tables/classes in the <a href=\"http://msdn.microsoft.com/en-us/data/ef.aspx\" rel=\"nofollow\">Entity Framework</a> model:</p>\n\n<pre><code>Orders (OrderedItems)\nOrderedItem (Product, Qty)\n</code></pre>\n\n<p>eg. (this obviously doesn't work)</p>\n\n<pre><code>Orders.OrderByDescending(o =&gt; Sum(o.OrderedItems.Qty))\n      .Select(o =&gt; o.OrderedItems.Product)\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","ado.net"],"answer_count":22,"favorite_count":37,"up_vote_count":166,"down_vote_count":0,"view_count":72954,"score":166,"question_id":689355,"title":"MetadataException: Unable to load the specified metadata resource","body":"<p>All of a sudden I keep getting a MetadataException on instantiating my generated ObjectContext class. The connectionstring in App.Config looks correct - hasn't changed since last it worked - and I've tried regenerating a new model (edmx-file) from the underlying database with no change.</p>\n\n<p>Anyone have any... ideas?</p>\n\n<p>Edit: I haven't changed any properties, I haven't changed the name of any output assemblies, I haven't tried to embed the EDMX in the assembly. I've merely waited 10 hours from leaving work until I got back. And then it wasn't working anymore.</p>\n\n<p>I've tried recreating the EDMX. I've tried recreating the project. I've even tried recreating the database, from scratch. No luck, whatsoever.</p>\n\n<p>I'm truly stumped.</p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13176900,"title":"Entity Framework 4.2 code first fluent api mapping intermediate table","body":"<p>How do I setup the mapping for these table relationships using code first and the fluent api?  </p>\n\n<p>I have a poco for all three entities created but most people don't have a poco for the \"intermediate\" table (<em>PlanUser</em>) so I couldn't find a good example to go off of. I need to tell EF to map the <em>PlanUser.PlanCustomerId</em> column to <em>Plan.CustomerId</em> but it either doesn't return the right results OR as in the current setup the mapping for <em>Plan</em> throws the error: </p>\n\n<blockquote>\n  <p>\"The specified association foreign key columns 'CustomerId' are\n  invalid. The number of columns specified must match the number of\n  primary key columns.\"</p>\n</blockquote>\n\n<p><img src=\"http://i.stack.imgur.com/imkTe.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/d3w4L.png\" alt=\"enter image description here\"></p>\n\n<pre><code>public class PlanUserMap : EntityTypeConfiguration&lt;PlanUser&gt;\n{\n    public PlanUserMap()\n    {\n        this.ToTable(\"PlanUser\");\n        this.HasKey(c =&gt; new { c.CustomerId, c.PlanCustomerId });\n\n        this.HasRequired(c =&gt; c.Plan).WithMany().HasForeignKey(x =&gt; x.CustomerId).WillCascadeOnDelete(false);\n        this.HasRequired(c =&gt; c.Customer).WithMany().HasForeignKey(x =&gt; x.CustomerId).WillCascadeOnDelete(false);\n    }\n}\n\npublic class PlanMap : EntityTypeConfiguration&lt;Plan&gt;\n{\n    public PlanMap()\n    {\n        this.ToTable(\"Plan\");\n        this.HasKey(c =&gt; c.CustomerId);\n        // the below line returns only 1 row for any given customer even if there are multiple PlanUser rows for that customer\n        //this.HasMany(c =&gt; c.PlanUsers).WithRequired().HasForeignKey(c =&gt; c.PlanCustomerId); \n        // this throws an error\n        this.HasMany(c =&gt; c.PlanUsers).WithMany().Map(m =&gt; m.MapLeftKey(\"PlanCustomerId\").MapRightKey(\"CustomerId\"));\n    }\n}\n\npublic partial class CustomerMap : EntityTypeConfiguration&lt;Customer&gt;\n{\n    public CustomerMap()\n    {\n        this.ToTable(\"Customer\");\n        this.HasKey(c =&gt; c.Id);\n        this.HasMany(c =&gt; c.PlanUsers).WithRequired().HasForeignKey(c =&gt; c.CustomerId);\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13186733,"title":"Create an complex helper with Ajax and model","body":"<p>I wish creating a mvc helper that return an Ajax Search, and the parameters that I pass is an string representing the table that i want searching. The helper goes opening an modal with the values and an dropDown with options for filtering the search. I have some questions about this:</p>\n\n<ol>\n<li><p>Is this possible?</p></li>\n<li><p>If possible, how i get the table based in an string? Example, the string \"people\" returning the People table. Fact, am using Entity Framework.</p></li>\n<li><p>I need create an dropDown where the  table columns are options for search. The user can pass an string and the helper needing adapting with these parameters. How i get the table columns? the names...</p></li>\n</ol>\n"},{"tags":["c#","sql","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":62,"score":0,"question_id":13185818,"title":"Using LINQ, How do I return objects from a GroupBy clause?","body":"<p>Thanks for looking!</p>\n\n<h1>Background</h1>\n\n<p>Within my C# code, I am calling a stored procedure from a MSSQL database that returns a history of orders that a user has made.  I use the Entity Framework for this.  Here is the code:</p>\n\n<pre><code>var db = new CustomerEntities();\nreturn db.GetOrderHistoryByUserId(id);\n</code></pre>\n\n<p>The output of this stored procedure is a list of orders with multiple records having the same <code>OrderNumber</code> because there may have been multiple products in a given order.  So I modified my code to look like this:</p>\n\n<pre><code>var db = new CustomerEntities();\nreturn db.GetOrderHistoryByUserId(id).GroupBy(p =&gt; p.OrderNumber);\n</code></pre>\n\n<p>I was hoping to now have a list of <code>Order</code> objects with nested <code>Product</code> objects, but instead this code essentially produced the same response as before.</p>\n\n<p>Ultimately, I just want to convert this query into a JSON response that looks something like this:</p>\n\n<pre><code>Orders : [\n{\nOrderNumber : 1,\nOrderTotal: $500,\nProducts: [\n  {ProductSku : 11111, ProductPrice: $200},\n  {ProductSku : 22222, ProductPrice: $300}\n]\n}\n]\n</code></pre>\n\n<p>I am using MVC 4 to aid in producing the JSON output, so I am already clear on that part, I just need to know how to consume the results of the stored procedure in a manner that produces an array of objects with the desired structure.</p>\n\n<h1>Question</h1>\n\n<p>Is there a way of producing this desired object structure with the original LINQ call to the stored procedure, or am I going to need to iterate the results of the stored procedure and construct a new object?</p>\n\n<p>Thanks for your help!</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":130,"score":3,"question_id":13148263,"title":"Entity Framework DbSet.Find throws exception","body":"<p>I'm following a very basic example of code-first Entity Framework (version 4.1) in ASP.NET MVC 4 (using the EBuy example in O'Reilly's Programming ASP.NET MVC 4). I've searched for solutions to this and so far have drawn blank. The basic problem is this code in my controller:</p>\n\n<pre><code>public ActionResult Details(long id)\n    {\n        using (var db = new EbuyDataContext())\n        {\n            var rep = db.Auctions;\n            var auction = rep.Find(id);\n            return View(auction);\n        }\n    }\n</code></pre>\n\n<p>throws an <strong>ArgumentNullException Value cannot be null. Parameter name: key.</strong> when it hits the rep.Find(id) call. Interestingly, when it breaks into the code, the db.Auctions property has the 'Expanding the Results View will enumerate the IEnumerable' and if clicked, it shows my expected two entities which have just been retrieved from the database. The rep object however, does have 'Children could not be evaluated' when it is inspected.</p>\n\n<p>Quite similar 'Create' code like this works okay:</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Create(Auction auction)\n    {\n        var db = new EbuyDataContext();\n        db.Auctions.Add(auction);\n        db.SaveChanges();\n\n        return View(auction);\n    }\n</code></pre>\n\n<p>This is my db context:</p>\n\n<pre><code>namespace Ebuy.DataAccess\n{\n    public class EbuyDataContext : DbContext\n    {\n        public DbSet&lt;Auction&gt; Auctions { get; set; } \n    }\n}\n</code></pre>\n\n<p>and this is my model class:</p>\n\n<pre><code>namespace Ebuy.DomainModel\n{\n    public class Auction\n    {\n        public long Id { get; set; }\n        public string Title { get; set; }\n        public string Description { get; set; }\n        public decimal StartPrice { get; set; }\n        public decimal CurrentPrice { get; set; }\n        public DateTime StartTime { get; set; }\n        public DateTime EndTime { get; set; }\n    }\n}\n</code></pre>\n\n<p>I did find one reference which talked about the POCO's and the dbcontext being in different namespaces or assemblies.\nDoes anyone know why the Create code works and the Find doesn't?</p>\n\n<p><strong>Edit:</strong> The stacktrace is:</p>\n\n<blockquote>\n  <p>System.ArgumentNullException was unhandled by user code<br>\n  Message=Value cannot be null. Parameter name: key   Source=mscorlib<br>\n  ParamName=key   StackTrace:\n         at System.Collections.Generic.Dictionary<code>2.FindEntry(TKey key)\n         at System.Collections.Generic.Dictionary</code>2.ContainsKey(TKey key)\n         at System.Data.Entity.Internal.InternalContext.TryUpdateEntitySetMappingsForType(Type\n  entityType)\n         at System.Data.Entity.Internal.InternalContext.IsEntityTypeMapped(Type\n  entityType)\n         at System.Data.Entity.Internal.Linq.InternalSet<code>1.Find(Object[] keyValues)\n         at System.Data.Entity.DbSet</code>1.Find(Object[] keyValues)\n         at Ebuy.Website.Controllers.AuctionsController.Details(Int64 id) in C:\\Users\\John\\Documents\\Visual Studio\n  2010\\Projects\\Ebuy.Website\\Ebuy.Website\\Controllers\\AuctionsController.cs:line\n  26\n         at lambda_method(Closure , ControllerBase , Object[] )\n         at System.Web.Mvc.ActionMethodDispatcher.Execute(ControllerBase controller, Object[] parameters)\n         at System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext\n  controllerContext, IDictionary<code>2 parameters)\n         at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext\n  controllerContext, ActionDescriptor actionDescriptor, IDictionary</code>2\n  parameters)\n         at System.Web.Mvc.Async.AsyncControllerActionInvoker.&lt;>c_<em>DisplayClass42.b</em>_41()\n         at System.Web.Mvc.Async.AsyncResultWrapper.&lt;>c_<em>DisplayClass8<code>1.&lt;BeginSynchronous&gt;b__7(IAsyncResult\n  _)\n         at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult</code>1.End()\n         at System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeActionMethod(IAsyncResult\n  asyncResult)\n         at System.Web.Mvc.Async.AsyncControllerActionInvoker.&lt;>c</em>_DisplayClass37.&lt;>c_<em>DisplayClass39.b</em>_33()\n         at System.Web.Mvc.Async.AsyncControllerActionInvoker.&lt;>c_<em>DisplayClass4f.b</em>_49()\n  InnerException:</p>\n</blockquote>\n\n<p><strong>Edit 2:</strong> The table does have the Id column as the primary key.\n<strong>Update:</strong> Based on nemesv's comment, I checked the versions. I'm using .NET Framework v 4.0. The MVC Web app, when created, used Nuget to get EF version 5.0 (although the actual reference is to EF runtime 4.0.30319 v4.4.0.0). I added the DataAccess project and gave it a reference to a <strong>different</strong> EF (runtime 4.0.30319 v4.1.0.0). I've changed the DataAccess project's reference to the same EF as the Web app and now I get a different exception: InvalidOperationException The context cannot be used while the model is being created. This appears to be an issue when using EF across an N-tier application, so I'll follow up this thread and report back.</p>\n\n<p><strong>Fix:</strong> I read some stuff about LazyLoading settings in EF and also how loading takes place when you access a property of an entity. As I'm not really accessing an entities property before I try and find one and thinking that perhaps LazyLoading is the default in EF 5.0, I added a default constructor to my EbuyDataContext class as follows:</p>\n\n<pre><code>public class EbuyDataContext : DbContext\n{\n    public EbuyDataContext()\n    {\n        //Configuration.LazyLoadingEnabled = false;\n    }\n\n    public DbSet&lt;Auction&gt; Auctions { get; set; } \n}\n</code></pre>\n\n<p>I also set the LazyLoadingEnabled parameter to false and then ran it and Voila! Success!\nHowever, I thought I would double-check this, so I commented out the LazyLoadingEnabled parameter, did a clean rebuild and it still worked. I commented out the default constructor and now it still works - did something else change when I ran it with the LazyLoadingEnabled parameter in place?</p>\n"},{"tags":["linq","entity-framework","sql-server-ce"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13169788,"title":"DateTime logic in LINQ for SQL Server CE","body":"<p>My object 'Job' has <code>LastTimeFinishedRunning</code> which is <code>DateTime</code> and <code>RunIntervalMinutes</code> which is an <code>int</code>. I need to add them together and compare against current time.</p>\n\n<p>Something like this:</p>\n\n<pre><code>Job jobToRun = ctx.Jobs.Where\n(job =&gt; DateTime.Now &gt; Job.LastTimeFinishedRunning.Add(TimeSpan.FromMinutes(job.RunIntervalMinutes))).FirstOrDefault();\n</code></pre>\n\n<p>Well, the <code>.Add()</code> doesn't work of course....</p>\n\n<p>neither works this:</p>\n\n<pre><code>DateTime.Now &gt; EntityFunctions.AddMinutes(job.LastTimeFinishedRunning, job.RunIntervalMinutes)\n</code></pre>\n\n<p>or this:</p>\n\n<pre><code>DateTime.Now &gt; System.Data.Objects.SqlClient.SqlFunctions.DateAdd(\"minute\", job.RunIntervalMinutes, job.LastTimeFinishedRunning)\n</code></pre>\n\n<p>...because it's SQL Server CE provider</p>\n\n<p>Any suggestions? Thx.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>I guess my only option here is to store ticks in <code>LastTimeFinishedRunning</code> by switching it from <code>DateTime</code> to <code>long</code> in DB. So the code would look something like this:</p>\n\n<pre><code>long ticks = DateTime.Now.Ticks;\nJob jobToRun = ctx.Jobs.Where\n(job =&gt; ticks &gt; Job.LastTimeFinishedRunning + job.RunIntervalMinutes * 1000 * 10000).FirstOrDefault();\n</code></pre>\n"},{"tags":["asp.net-mvc-3","entity-framework","unit-of-work","dbcontext","objectcontext"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2526,"score":1,"question_id":9176967,"title":"ObjectContext vs DbContext","body":"<p>I've DbContext class from there I have an implementation of Generic Repositories and unit of work in a such way that leads to use ObjectContext, I followed this link in general </p>\n\n<p><a href=\"http://elegantcode.com/2009/12/15/entity-framework-ef4-generic-repository-and-unit-of-work-prototype/\" rel=\"nofollow\">http://elegantcode.com/2009/12/15/entity-framework-ef4-generic-repository-and-unit-of-work-prototype/</a></p>\n\n<p>I've read lot of posts related to the ObjectContext vs DBContext which somewhat makes sense. But I've no idea about my current implementation. just wondering if its an anti-pattern or I'm playing  safe?</p>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13183398,"title":"Entity Framework one-to-many mapping","body":"<p>This is probably just some simple beginner's mistake, but I just can't seem to figure it out.</p>\n\n<p>I'm just trying to get started with entity framework (ef 5.0, .net 4.5), been rolling all my own sql statements until now. I'm trying to work with an existing database and EF code first, with two simple classes that have a one to many relationship: clips and clip_ratings (there can be zero or many ratings for each clip). the relevant parts of the classes are:</p>\n\n<pre><code>public class clip\n{\n    public clip()\n    {\n        this.Ratings = new List&lt;clip_ratings&gt;();\n    }\n\n    public virtual ICollection&lt;clip_ratings&gt; Ratings { get; set; }\n\n    public int clip_id { get; set; }\n    public Nullable&lt;int&gt; clip_type { get; set; }\n    // ...\n }\n\npublic class clip_ratings\n{\n    public int cr_id { get; set; }\n    public int cr_clip_id { get; set; }\n    // ...\n\n    [ForeignKey(\"cr_clip_id\")]\n    public clip Clip { get; set; }\n}\n</code></pre>\n\n<p>Now I'm trying to read some data from the DB:</p>\n\n<pre><code>           var query = from b in db.clips\n                        orderby b.clip_id where b.Ratings.Count &gt; 1\n                        select b;\n\n            foreach (var item in query)\n            {\n                Console.WriteLine(item.Ratings.Count +\" | \"+item.clip_linktext);\n            }\n</code></pre>\n\n<p>The query returns the correct resultset from the DB, however it errors on the item.Ratings.Count. When I just output item.clip_linktext all is fine, but with the item.Ratings.Count I get the following error:</p>\n\n<blockquote>\n  <p>More than one item in the metadata collection match the identity 'clip_ratings'.</p>\n</blockquote>\n\n<p>I've tried following all the MS EF tutorials and reading up on some more posts, but just can't seem to figure it out. Hope somebody here can help me along on this (and that it is easy to fix ;))</p>\n\n<p>update: adding the classMap.cs sources:</p>\n\n<pre><code>public class clipMap : EntityTypeConfiguration&lt;clip&gt;\n{\n    public clipMap()\n    {\n        // Primary Key\n        this.HasKey(t =&gt; t.clip_id);\n        // ...\n\n\n        // Table &amp; Column Mappings\n        this.ToTable(\"clips\");\n        this.Property(t =&gt; t.clip_id).HasColumnName(\"clip_id\");\n        this.Property(t =&gt; t.clip_type).HasColumnName(\"clip_type\");\n        ...\n     }\n }\n\npublic class clip_ratingsMap : EntityTypeConfiguration&lt;clip_ratings&gt;\n{\n    public clip_ratingsMap()\n    {\n        // Primary Key\n        this.HasKey(t =&gt; t.cr_id);\n        // Table &amp; Column Mappings\n        this.ToTable(\"clip_ratings\");\n        this.Property(t =&gt; t.cr_id).HasColumnName(\"cr_id\");\n        this.Property(t =&gt; t.cr_clip_id).HasColumnName(\"cr_clip_id\");\n        // ...\n    }\n}\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":108,"score":4,"question_id":13184760,"title":"must be non-nullable in order to use as parameter 'T'","body":"<p>I am trying to create a Code First class with my own object types and get this error:</p>\n\n<blockquote>\n  <p><code>.MTObject'</code> must be a non-nullable value type in order to use it as\n  parameter 'T' in the generic type or method\n  '<code>System.Data.Entity.ModelConfiguration.Configuration.StructuralTypeConfiguration&lt;TStructuralType&gt;.Property&lt;T&gt;(System.Linq.Expressions.Expression&lt;System.Func&lt;TStructuralType,T&gt;&gt;)</code>'</p>\n</blockquote>\n\n<p>Is there a way to declare my class property to get past this error?</p>\n\n<p>Code is below:</p>\n\n<pre><code>// Simple Example\n\npublic class MTObject\n{\n    public string Object { get; set; }\n\n    public MTObject()\n    {\n\n    }\n}\n\npublic class Person\n{\n    public decimal Id { get; set; }\n\n    //public string Name { get; set; }\n\n    public MTObject Name { get; set; }\n\n    public Int32 Age { get; set; }\n}\n\npublic class PersonConfiguration : EntityTypeConfiguration&lt;Person&gt;\n{\n    public PersonConfiguration() : base()\n    {\n        HasKey(p =&gt; p.Id);\n        Property(p =&gt; p.Id).HasColumnName(\"ID\").HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n        Property(p =&gt; p.Name).HasColumnName(\"NAME\").IsOptional();\n        Property(p =&gt; p.Age).HasColumnName(\"AGE\").IsOptional();\n        ToTable(\"Person\");\n    }\n}\n\npublic class PersonDataBase : DbContext\n{\n    public DbSet&lt;Person&gt; Persons { get; set; }\n\n    public PersonDataBase(string connectionString) : base(connectionString)\n    {\n        Database.CreateIfNotExists();\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new PersonConfiguration());\n        base.OnModelCreating(modelBuilder);\n    }\n}\n\n// End Simple EXample\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","web-config","connection-string"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":13093754,"title":"MVC3 Entity Connection string disappearing","body":"<p>I am having a very frustrating problem with my current project. It is continually losing the connection string binding for Entity models.</p>\n\n<p>I have multiple models for different databases in separate areas and was having no problems. Suddenly now whenever I try to update from the database I get the connection string setup prompt. I select for it to add it to the Web.config with the password but it doesn't ever pick it up there again. They all are still in the web config but it just doesn't see them.</p>\n\n<p>If I remove all the connection strings from the config file it will write the new one there. Then when I try to set up a Stored procedure/Function Import, I still get the statement in the lower box:</p>\n\n<pre><code>No database connection has been configured for this model.\n</code></pre>\n\n<p>I have tried rebuilding the project and creating the models again from scratch and that works for a while. When I try and bring the project in under Perforce source control, it winds up getting re-corrupted &amp; the connection string goes away. It affects all of my models too.</p>\n\n<p>I am also using EF 4.x DbContext Generator to create context files. They work fine. I am also able to run the application and it connects to the database just fine and returns data. No issues there. I am just unable to update Entity Complex types from the DB or import any more stored procedures. </p>\n\n<p>An even weirder occurrence was that I opened a broken project from a different directory then opened an uncorrupted copy it instantly became broken also. Contagious! </p>\n\n<p>Any thoughts on where to look into to see why this is happening? Has anyone else had this issue?</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-5","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13182669,"title":"Explicitly invoking DatabaseInitializer","body":"<p>I have a DbContext in an assembly that is shared between two service projects. I have both projects set to start for debugging in Visual Studio. This creates a race condition where the <code>DatabaseInitializer</code> in each service tries to update the database on startup.</p>\n\n<p>To prevent this, I modified my <code>DbContext</code> as follows so as to prevent the <code>DatabaseIntializer</code> from being automatically registered.</p>\n\n<pre><code>public EntityContext : DbContext\n{\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        Database.SetInitializer&lt;EntityContext&gt;(null);\n    }\n}\n</code></pre>\n\n<p>I wanted to disable the <code>DatabaseInitializer</code> inside the <code>DbContext</code> itself so that I would not have to duplicate that <code>SetInitializer()</code> call in every project that happened to reference my <code>DbContext</code>, and based on what I'd read, overriding <code>OnModelCreating()</code> seemed to be the way to do it.</p>\n\n<p>That prevents the <code>DatabaseInitializer</code> from running automatically, but I wanted to create a separate project that I could run manually in order to update the database. So I did something like the following:</p>\n\n<pre><code>static void Main(string[] args)\n{\n    Database.SetInitializer(new CreateDatabaseIfNotExists&lt;EntityContext&gt;());\n    new EntityContext().Database.Initialize(true);\n}\n</code></pre>\n\n<p>The problem is that this doesn't seem to work - the null initializer set in the <code>OnModelCreating()</code> method apparently overrides anything that I specify in any other call to <code>SetInitializer()</code>. Even if I move the <code>SetIntializer(null)</code> call to a static constructor of the <code>EntityContext</code> class so as to guarantee it is called first it still doesn't work. The only way it works is if I manually call the initializer as follows:</p>\n\n<pre><code>static void Main(string[] args)\n{\n    new CreateDatabaseIfNotExists&lt;EntityContext&gt;()\n        .InitializeDatabase(new EntityContext());\n}\n</code></pre>\n\n<p>But calling the <code>DatabaseInitializer.InitializeDatabase()</code> directly does not seem right, as the Entity Framework infrastructure is supposed to call that.</p>\n\n<p>Is this a bug in EF Code First? What is the \"correct\" way to go about this?</p>\n"},{"tags":["entity-framework","asp.net-mvc-3","frameworks","entity","code-first"],"answer_count":6,"favorite_count":5,"up_vote_count":14,"down_vote_count":0,"view_count":9924,"score":14,"question_id":6312336,"title":"How can I get my database to seed using Entity Framework CodeFirst?","body":"<p>The database is created successfully (as are the tables) but is not seeded. I have spent several hours and read tons of articles but have not been able to get it. Any suggestions?</p>\n\n<p>On a side note, is it possible to call the initializer without having a reference to my DatabaseContext in the client?</p>\n\n<p>I have included all the relevant code I could think of. If anything else would be helpful, please let me know.</p>\n\n<p>Things I've Tried:</p>\n\n<ol>\n<li>I deleted my connection string (since it defaults to sqlexpress anyways, just the name changed)</li>\n<li>I changed DropCreateDatabaseIfModelChanges to DropCreateDatabaseAlways, still the same.</li>\n</ol>\n\n<p>Edit: The really weird thing is it worked once, but I have no idea how or why it broke again. I am assuming connection strings, but who knows.</p>\n\n<p>DatabaseInitializer.cs</p>\n\n<pre><code>public class DatabaseInitializer : DropCreateDatabaseIfModelChanges&lt;DatabaseContext&gt;\n{\n  protected override void Seed(DatabaseContext context)\n  {\n    // Seeding data here\n    context.SaveChanges();\n  }\n}\n</code></pre>\n\n<p>DatabaseContext.cs</p>\n\n<pre><code>public class DatabaseContext : DbContext\n{\n  protected override void OnModelCreating(DbModelBuilder mb)\n  {\n    // Random mapping code\n  }\n\n  public DbSet&lt;Entity1&gt; Entities1 { get; set; }\n  public DbSet&lt;Entity2&gt; Entities2 { get; set; }\n\n}\n</code></pre>\n\n<p>Global.asax.cs - Application_Start()</p>\n\n<pre><code>protected void Application_Start()\n{\n  Database.SetInitializer&lt;DatabaseContext&gt;(new DatabaseInitializer());\n  AreaRegistration.RegisterAllAreas();\n  RegisterGlobalFilters(GlobalFilters.Filters);\n  RegisterRoutes(RouteTable.Routes);\n}\n</code></pre>\n\n<p>Client web.config</p>\n\n<pre><code>&lt;connectionStrings&gt;\n  &lt;add name=\"DatabaseContext\" connectionString=\"data source=.\\SQLEXPRESS;Database=Database;Integrated Security=SSPI;\" providerName=\"System.Data.SqlClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<h1>SOLUTION</h1>\n\n<p>For the sake of documentation, I am sharing my solution here. Navigating all the comments would be a pain anyways. In the end I had DatabaseInitializer and DatabaseContext in separate classes. I don't really understand while these tiny changes fixed it, but here it is.</p>\n\n<p>DatabaseInitializer.cs</p>\n\n<pre><code>public class DatabaseInitializer : CreateDatabaseIfNotExists&lt;DatabaseContext&gt;\n{\n  protected override void Seed(DatabaseContext context)\n  {\n    // Seed code here\n  }\n}\n</code></pre>\n\n<p>DatabaseContext.cs</p>\n\n<pre><code>public class DatabaseContext : DbContext\n{\n  public DatabaseContext() : base(\"MyDatabase\") { }\n\n  protected override void OnModelCreating(DbModelBuilder mb)\n  {\n    // Code here\n  }\n\n  public DbSet&lt;Entity&gt; Entities { get; set; }\n  // Other DbSets\n}\n</code></pre>\n\n<p>Global.asax.cs - Application_Start()</p>\n\n<pre><code>protected void Application_Start()\n{\n  Database.SetInitializer(new DatabaseInitializer());\n  AreaRegistration.RegisterAllAreas();\n  RegisterGlobalFilters(GlobalFilters.Filters);\n  RegisterRoutes(RouteTable.Routes);\n}\n</code></pre>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4.1","sql-server-ce"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12414263,"title":"EF 4.1 / SQL Server CE 4.0 without local SQL Server Express","body":"<p>I have an MVC3 project that uses EF 4.1 database first with a SQL Server CE database. On my dev box, which has SQL Server Express installed, everything works fine. However, when deploying to another server that does not have SQL Server Express installed (or any SQL Server Instance), the connection understandably fails. Is it possible to use EF 4.1 with a SQL Server CE database on a box that does not have a local SQL Server instance?  </p>\n\n<p>Even if I try to reference a remote SQL instance, I receive an error </p>\n\n<blockquote>\n  <p><em>Invalid value for key 'attachdbfilename'</em></p>\n</blockquote>\n\n<p>Here is what the connection string looks like:</p>\n\n<pre><code> &lt;add name=\"AlertsEntities\" connectionString=\"metadata=res://*/Models.AlertsModel.csdl|res://*/Models.AlertsModel.ssdl|res://*/Models.AlertsModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=.\\SQLEXPRESS;attachdbfilename=|DataDirectory|\\Alerts.mdf;integrated security=True;connect timeout=30;user instance=True;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13184099,"title":"Is there a way to Refresh only one Entity with all its child entities in a single call?","body":"<p>I have an entity with a bunch of child entities as properties. Users are presented with a list of entities, can select one to modify it, then Save or Cancel the changes. Saving and Cancelling is not required to switch between entities, so its possible that more than one object is <code>EntityState.Modified</code> at once.</p>\n\n<p>The Save button correctly works to save both the selected entity and all child entities, however the Cancel button is only reverting the changes made to the parent entity, without reverting changes to the child entities.</p>\n\n<p>Is there an easy way to revert all changes within the graph for that object, without looping through every navigation property?</p>\n\n<p>I am using the following code to revert the changes:</p>\n\n<pre><code>context.Connection.Open();\ncontext.Refresh(RefreshMode.StoreWins, MyEntity);\ncontext.Connection.Close();\n</code></pre>\n\n<p>A simplified sample of my entity class structure looks like this:</p>\n\n<pre><code>class MyEntity\n{\n    string Name;\n    IList&lt;Address&gt; Addresses;\n    IList&lt;Contact&gt; Contacts;\n    IList&lt;Note&gt; Notes;\n}\n\nclass Contact\n{\n    string Name;\n    string Title;\n    IList&lt;EmailAddress&gt; EmailAddresses;\n    IList&lt;Phone&gt; PhoneNumbers;\n}\n</code></pre>\n\n<p>I did see <a href=\"http://stackoverflow.com/q/1746941/302677\">this question</a>, however that solution would revert changes to all unsaved entities, and not just the selected entity.</p>\n\n<pre><code>Context.Refresh(RefreshMode.StoreWins, _\n    Context.ObjectStateManager.GetObjectStateEntries());\n</code></pre>\n"},{"tags":["c#","entity-framework","design-patterns","design"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":85,"score":3,"question_id":13183577,"title":"Is it a good practice to allow users to embed raw sql queries in an application?","body":"<p>I tried my best to come up with an appropriate title, excuses if it doesn't make much sense. I hope to explain it better below. We have an application that is based on .Net framework and uses SQL as data storage. As with any application, this application need to support extensibility, for example to support additional data transformations &amp; validations. </p>\n\n<p><strong>Example:</strong> Think of the application as a tool that provides a set of input tables the user can import data into using access or excel (there is UI &amp; grids already) to allow data import. Once the data is imported the tool creates an intermediate model and performs some calculations on the input data and later throws the results in pre-defined format. The input table schema and intermediate model schema is fixed, no changes will happen. The extensibility is needed in the stage where the intermediate model is derived from the input data. Allow users to be able to change the way the data gets derived, eg instead of grouping by one field allow grouping by multiple fields etc.</p>\n\n<p>To support this kind of flexibility, I see there are two basic approaches as I could see</p>\n\n<p>Option 1: Create a business model that maps to the sql data model and expose the business model to the user to allow them to override transformations &amp; create new transformations (e.g., using LINQ or plain C#)</p>\n\n<p>Option 2: Expose the entire sql data model and allow users to embed raw SQL queries to perform the transformations &amp; validations.</p>\n\n<p>My personal preference is to use Option 1, since I am not a big fan of allowing users to play with underlying data tables directly. I prefer more controlled access. However, this approach requires the user to have programming language (C# or VB). On the other hand Option 2, may just need someone who has knowledge of SQL programming to create raw queries and directly plug them into the application. But, I think this is a bad approach.</p>\n\n<p>The product management team is inclined to go with Option 2, as they feel it is more flexible and easy to implement from resource point of view.</p>\n\n<p>So, I am trying to come up with pros and cons of both approach to better support my inclination for Option 1. Basically, inclination to do the work in programming language in C# or VB .net rather than just using plain SQL queries.</p>\n\n<p>Kindly, share your thoughts and opinions.</p>\n"},{"tags":["entity-framework","unicode","indexing","sql-server-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13182748,"title":"How to use Unicode string for primary key in SQL Server","body":"<p>I am having trouble inserting a record with a primary key that only varies by some special Unicode characters. </p>\n\n<p>For example, if I have a record already in the database with a primary key of <code>\"test\"</code> and I try to insert another record that has a primary key of <code>\"test + '\\u13A4' + '\\u13B4' + '\\u13B9'\"</code> I get a duplicate key error. I am using EF 5 with SQL Server 2012. </p>\n\n<p>The primary key is defined as an <code>nvarchar</code> and the collation is set to <code>SQL_Latin1_General_CP1_CI_AS</code>. It can do a look-up on the primary key just fine if there are special Unicode characters in there but if it just varies by the Unicode special characters (as in the example above) I get the duplicate key error on inserts. How do you get around this issue?</p>\n"},{"tags":["entity-framework","parallel-processing","profiling","task-parallel-library","tpl-dataflow"],"answer_count":0,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":61,"score":4,"question_id":13182603,"title":"Entity Framework and Parallelism","body":"<p><strong>Background</strong></p>\n\n<p>I have an application that receives periodic data dumps (XML files) and imports them into an existing database using Entity Framework 5 (Code First).  The import happens via EF5 rather than say BULK INSERT or BCP because business rules that already exist in the entities must be applied.</p>\n\n<p>Processing seems to be CPU bound in the application itself (the extremely fast, write-cache enabled disk IO subsystem shows almost zero disk wait time throughout the process, and SQL Server shows no more than 8%-10% CPU time).</p>\n\n<p>To improve efficiency, I built a <a href=\"http://msdn.microsoft.com/en-us/library/hh228604.aspx\" rel=\"nofollow\">pipeline using TPL Dataflow</a> with components to:</p>\n\n<pre><code>Read &amp; Parse XML file\n        |\n        V\nCreate entities from XML Node\n        |\n        V\nBatch entities (BatchBlock, currently n=200)\n        |\n        V\nCreate new DbContext / insert batched entities / ctx.SaveChanges()\n</code></pre>\n\n<p>I see a substantial increase in performance by doing this, but can not get the CPU above about 60%.  </p>\n\n<p><strong>Analysis</strong></p>\n\n<p>Suspecting some sort of resource contention, I ran the process using the VS2012 Profiler's <em>Resource contention data (concurrency)</em> mode.</p>\n\n<p>The profiler shows me 52% contention for a resource labeled <em>Handle 2</em>.  Drilling in, I see that the method creating the most contention for <em>Handle 2</em> is </p>\n\n<pre><code>System.Data.Entity.Internal.InternalContext.SaveChanges()\n</code></pre>\n\n<p>Second place, at about 40% as many contentions as SaveChanges(), is</p>\n\n<pre><code>System.Data.Entity.DbSet`1.Add(!0)\n</code></pre>\n\n<p><strong>Questions</strong></p>\n\n<ul>\n<li>How can I figure out what <em>Handle 2</em> really is (e.g. part of TPL, part of EF)?</li>\n<li>Does EF throttle calls to separate DbContext instances from separate threads?  It seems there is a shared resource they are contending for.</li>\n<li>Is there anything that I can do to improve parallelism in this case?</li>\n</ul>\n\n<p><strong>UPDATE</strong></p>\n\n<p>For the run in question, the maximum degree of parallelism for the task that calls SaveChanges is set to 12 (I tried various values including Unbounded in previous runs).</p>\n"},{"tags":["c#","entity-framework","generics","linq-to-sql"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":92,"score":3,"question_id":13180227,"title":"Can I make the following IQueryable linq statment generic","body":"<p>Is there a way I can make the following db query builder generic?</p>\n\n<pre><code>private IQueryable&lt;Foo&gt; ByName(IQueryable&lt;Foo&gt; dbQuery, Query query)\n{\n    string[] searchTerms = query.Data.Replace(\" \",\"\").ToLower().Split(',');\n\n    if (query.Exclude)\n    {\n        return dbQuery.Where(x =&gt; searchTerms.All(\n            y =&gt; y != x.Name.Replace(\" \", \"\").ToLower()));\n    }\n\n    return dbQuery.Where(x =&gt; searchTerms.Any(\n        y =&gt; y == x.Name.Replace(\" \", \"\").ToLower()));\n}\n</code></pre>\n\n<p>I've got the same function for lots of different properties of Foo. ByCounty, ByTown, ByStreet etc etc.</p>\n\n<p>I've written some functions that return linq before like the following</p>\n\n<pre><code>public Expression&lt;Func&lt;Foo, bool&gt;&gt; FoosAreWithinDistanceFromGeocode(\n    double distance, Geocode geocode)\n{\n    double distanceSquare = distance * distance;\n    return foo =&gt; ( SqlFunctions.Square((double)(\n        foo.Address.Geocode.Easting - geocode.Easting)) +\n        SqlFunctions.Square((double)(fooAddress.Geocode.Northing - \n        geocode.Northing)) ) &lt;= distanceSquare;\n}\n</code></pre>\n\n<p>But I can't seem to find if the Linq-to-SQL stuff can't use generics or if it's possible to pass properties as generics and that kind of thing.</p>\n\n<hr>\n\n<p>EDIT: I have this working generically for a single search term. </p>\n\n<pre><code>Where [query.Data == \"Foo1\"]\n\nreturn dbQuery.Where(SearchMatch(\"Name\", query.Data));\n\npublic Expression&lt;Func&lt;Foo, bool&gt;&gt; SearchMatch(string propertyName, string searchTerm)\n{\n    var foo = Expression.Parameter(typeof(Foo), \"foo\");\n    var prop = Expression.Property(foo, propertyName);\n    var search = Expression.Constant(searchTerm);\n    var equal = Expression.Equal(prop, search);\n\n    return Expression.Lambda&lt;Func&lt;Foo, bool&gt;&gt;(equal, foo);\n}\n</code></pre>\n\n<p>Anyone have any ideas how to make it work for an array of strings?</p>\n"},{"tags":["linq","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2799,"score":2,"question_id":2356992,"title":"date difference with linq","body":"<p>With this code:</p>\n\n<pre><code> i.SpesaAlloggio = db.TDP_NotaSpeseSezB.Sum(p =&gt; p.Costo / (((DateTime)p.DayEnd)\n                    .Subtract((DateTime)p.DayStart).Days + 1));\n</code></pre>\n\n<p>I receive this error:</p>\n\n<pre><code>LINQ to Entities does not recognize the method \n'System.TimeSpan Subtract(System.DateTime)' method, and this method cannot be \ntranslated into a store expression.\n</code></pre>\n\n<p>How can I do this?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13179860,"title":"Entity Framework Exception when iterating over collection","body":"<p>I have built a simple file manager, that pulls data from two tables, Folders and Files.\nWhen you upload a file it gets written to disk on the server. When I need to delete a folder and all of it's sub-folders, sub-folder files and the parent folders files, I select the folder and then click delete, which executes the controller action below.</p>\n\n<p><strong>UPDATE</strong>\nIf I change any subsequent call to .ToList() it works.</p>\n\n<pre><code>    [HttpPost]\n    public JsonResult DeleteFolder(int folderID)\n    {\n        var repo = new FileManagerRepository();\n\n        var folder     = repo.GetFolder(folderID);\n        var subfolders = repo.GetSubFolders(folderID).ToList();\n        var files      = repo.GetFiles(folderID).ToList();\n\n        // delete sub-folders\n        if (subfolders.Count() != 0)\n        {\n            foreach (var subfolder in subfolders)\n            {\n                // delete sub-folder files\n                var subfiles = repo.GetFiles(subfolder.folder_id).ToList();\n                if (subfiles.Count() != 0)\n                {\n                    foreach (var file in subfiles)\n                    {\n                        repo.DeleteFile(file.file_id);\n                        System.IO.File.Delete(Server.MapPath(\"/content/upload/\" + file.file_name));\n                    }\n                }\n                repo.DeleteFolder(subfolder.folder_id);\n            }\n        }\n        // delete files\n        if (files.Count() != 0)\n        {\n            foreach (var file in files)\n            {\n                repo.DeleteFile(file.file_id);\n                System.IO.File.Delete(Server.MapPath(\"/content/upload\" + file.file_name));\n            }\n        }\n        // delete the folder            \n        if (folder != null)\n        {\n            repo.DeleteFolder(folder.folder_id);                \n        }\n        repo.Save();\n        return new JsonResult();\n    }\n</code></pre>\n\n<p>Now here is the FileManagerRepository</p>\n\n<pre><code> public class FileManagerRepository\n{\n    private readonly iau_idahoEntities db = new iau_idahoEntities();\n\n    public IQueryable&lt;folders&gt; GetParentFolders()\n    {\n        return db.folders.Where(f =&gt; f.parant_folder_id == 0);\n    }\n\n    public IQueryable&lt;folders&gt; GetSubFolders()\n    {\n        return db.folders.Where(f =&gt; f.parant_folder_id != 0);\n    }\n    public IQueryable&lt;folders&gt; GetSubFolders(int folder_id)\n    {\n        return db.folders.Where(f =&gt; f.parant_folder_id != 0 &amp;&amp; f.parant_folder_id == folder_id);\n    } \n\n\n    public IQueryable&lt;Files&gt; GetFiles(int id)\n    {\n        return db.Files.Where(f =&gt; f.folder_id == id);\n    }\n\n    public Files GetFile(int id)\n    {\n        return db.Files.SingleOrDefault(f =&gt; f.file_id == id);\n    }\n\n    public void UpdateDownloadCount(int id)\n    {\n        var file = GetFile(id);\n        file.downloaded += 1;         \n    }\n    public void AddFolder(int parentFolderID, string folderName)\n    {\n        var folder = new folders { create_date = DateTime.Now, parant_folder_id = parentFolderID, folder_name = folderName };\n        db.folders.AddObject(folder);\n    }\n\n    public void DeleteFolder(int folder_id)\n    {\n        var folder = db.folders.SingleOrDefault(f =&gt; f.folder_id == folder_id);\n        db.folders.DeleteObject(folder);\n    }\n    public void Save()\n    {\n        db.SaveChanges();\n    }\n\n    public void AddFile(int folder_id,string filename, string description)\n    {\n        var file = new Files { \n            folder_id = folder_id, \n            file_name = filename, \n            file_extension = filename.Substring(filename.Length - 3, 3), \n            description = description,\n            downloaded = 0, \n            physical_name = filename.Substring(0, filename.Length - 4), \n            upload_date = DateTime.Now \n        };\n        db.Files.AddObject(file);            \n    }\n\n    internal void DeleteFile(int fileID)\n    {\n        var fileToDelete = db.Files.SingleOrDefault(file =&gt; file.file_id == fileID);\n        db.Files.DeleteObject(fileToDelete);\n    }\n\n    internal folders GetFolder(int folderID)\n    {\n        return db.folders.SingleOrDefault(folder =&gt; folder.folder_id == folderID);\n    }\n}\n</code></pre>\n\n<p>The problem is I keep getting the following EF Exception:\n<strong>There is already an open DataReader associated with this Command which must be closed first</strong></p>\n\n<p>I've tried to add MultipleActiveResultSets = true, to my connection string in the web.config, but I still get the exception. I know why this exception is being thrown, but I don't know how to do what I need to and prevent it from throwing an exception.</p>\n\n<p>PLEASE HELP!!! </p>\n"},{"tags":["entity-framework","ado.net","odp.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13167108,"title":"Reset ADO.NET schema","body":"<p>I modified a schema (set a field to be non-nullable), but when I try to recreate the mapping with ADO.NET I only see the old schema.</p>\n\n<p>The .edmx file looks like this:</p>\n\n<pre><code>        &lt;EntityType Name=\"STG_DW_BUF_CODE_D\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"BUF_CODE_KEY\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Name=\"BUF_CODE_KEY\" Type=\"number\" Nullable=\"false\" /&gt;\n\n…\n      &lt;EntityType Name=\"STG_DW_REGION_D\"&gt;\n        &lt;Property Name=\"REGION_KEY\" Type=\"number\" /&gt;\n</code></pre>\n\n<p>The STG_DW_REGION_D view should have Nullable=\"false\" like the view above it.</p>\n\n<p>I can confirm the new schema has this field non-nullable through another SQL application, but I can't get ADO.NET to notice.</p>\n\n<p>I tried erasing the model and recreating it. I tried closing visual studio and starting it up again. It still sees the old schema.</p>\n\n<p>Does anyone know how to reset it? Any suggestions?</p>\n"},{"tags":["sql","entity-framework",".net-4.5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13167048,"title":"Why is the Audit Logout event for EF5, taking ~3 seconds for EF5?","body":"<p>I am trying to put together a prof of concept for changing our home grown ORM solution to EntityFramework 5, and the first problem I run into appears to be a serious show stopper.</p>\n\n<p>EF5 appears, our of the box, to take ~9x longer to execute a scalar sql operation than ad hock sql, BUT when I look at the sql code generated, the sql itself appears to be reasonably well written, and runs quickly.</p>\n\n<p>My C# code for both:</p>\n\n<pre><code> int surveyId = (from survey in upsEntities.Surveys where !survey.Deleted select survey.SurveyID).First();\n            Debug.WriteLine(\"Loading surveyId : {0} through Linq took {1}ms using EF5\", surveyId,\n                            sw.Elapsed.TotalMilliseconds);\n\n            sw.Restart();\n\n            string sql = \"Select top 1 surveyId from Survey where deleted = 0\";\n            object val = SMSDataManager.Instance.DataAccessManager.ExecuteScalar(sql);\n\n            Debug.WriteLine(\"Loading surveyId : {0} through AdHock SQL took {1}ms using OrmDataManager\", val,\n                           sw.Elapsed.TotalMilliseconds);\n</code></pre>\n\n<p>SQL Output:\nEF5: </p>\n\n<pre><code>SELECT TOP (1) \n[Extent1].[SurveyID] AS [SurveyID]\nFROM [dbo].[Survey] AS [Extent1]\nWHERE [Extent1].[Deleted] &lt;&gt; cast(1 as bit)\n</code></pre>\n\n<p>Adhock: <code>Select top 1 surveyId from Survey where deleted = 0</code></p>\n\n<blockquote>\n  <p>Loading surveyId : 1 through Linq took <strong>2965.8625ms using EF5</strong></p>\n  \n  <p>Loading surveyId : 1 through <strong>AdHock SQL took 384.8073ms</strong></p>\n</blockquote>\n\n<p>The duration between the two, according to the profiler is 1ms for EF5, vs 0ms for ad hock. Where the problem appears to lie is in the <strong>Audit Logout</strong> event <strong>for EF5, taking ~3 seconds,</strong> where my <strong>ad hock sql is taking ~.6 seconds</strong> for the same logout event.</p>\n\n<p>What is causing this huge overhead for EF5, and what can I do to mitigate, or explain this?</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13167563,"title":"entity framework 5.0 .load method and .local property are missing from entity","body":"<p>I'm using entity framework 5 and have two Visual Studio 2010 solutions. One is a small test solution with one project and one is a much larger solution with multiple projects where I'm doing the actual business application.</p>\n\n<p>The entities in the smaller solution have both the <strong>.Load()</strong> method and the <strong>.Local</strong> property.</p>\n\n<p>The entities in the larger solution have neither.</p>\n\n<p>I've referenced both <strong>system.data.entity</strong> and <strong>EntityFramework</strong> in the projects.</p>\n\n<p>I've compared the two solutions and can't figure out what is missing in the large one. Any pointers in what direction to look next would be appreciated.</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":3,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":4509,"score":12,"question_id":2720551,"title":"Can EF4 support batch updates?","body":"<p>Does Entity Framework v4 support batch updates/inserts so rather than sending >1 command to a db, it can send >1 command to the DB in one go?</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13169946,"title":"Why does EF create a new db instead of using the existing db?","body":"<p>I have an existing SQL Server Express database populated with data.</p>\n\n<p>I created a new VS solution built around EF 5. I generated the EDMX from the existing database and verified the connection string in the <code>app.config</code> points to the database on <code>.\\SQLEXPRESS</code>.</p>\n\n<p>I created a project for my domain objects.</p>\n\n<p>I added a <code>DbContext</code> generator. The domain objects are also generated.</p>\n\n<p>Everything builds and the console application runs.</p>\n\n<p>The problem, however, is a new database is created instead of using the existing database. </p>\n\n<p>Why does EF create a new empty database instead of using the existing database I specified? And how do I fix it?</p>\n\n<p>Here is the <code>DbContext</code> class:</p>\n\n<pre><code>public partial class ContactsEntities : DbContext\n{\n        public ContactsEntities()\n            : base(\"name=ContactsEntities\")\n        {\n        }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            throw new UnintentionalCodeFirstException();\n        }\n\n        public DbSet&lt;Address&gt; Addresses { get; set; }\n        public DbSet&lt;AddressType&gt; AddressTypes { get; set; }\n        public DbSet&lt;Person&gt; People { get; set; }\n        public DbSet&lt;Phone&gt; Phones { get; set; }\n        public DbSet&lt;PhoneType&gt; PhoneTypes { get; set; }\n}\n</code></pre>\n\n<p>And the entire <code>app.config</code>:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n  &lt;/configSections&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"ContactsEntities\" connectionString=\"metadata=res://*/PeopleModel.csdl|res://*/PeopleModel.ssdl|res://*/PeopleModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=(local)\\sqlexpress;initial catalog=Contacts;integrated security=True;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\" /&gt;\n  &lt;/entityFramework&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>And here is the PeopleContext scaffolded using the T4Scaffolding:</p>\n\n<pre><code>   public class PeopleContext : DbContext\n    {\n        // You can add custom code to this file. Changes will not be overwritten.\n        // \n        // If you want Entity Framework to drop and regenerate your database\n        // automatically whenever you change your model schema, add the following\n        // code to the Application_Start method in your Global.asax file.\n        // Note: this will destroy and re-create your database with every model change.\n        // \n        // System.Data.Entity.Database.SetInitializer(new System.Data.Entity.DropCreateDatabaseIfModelChanges&lt;DataLayer.Models.PeopleContext&gt;());\n\n        public DbSet&lt;Domain.Person&gt; People { get; set; }\n    }\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13176626,"title":"Entity Framework: Unable to load one or more of the requested types","body":"<p>I am getting a specific exception that I am confused about.  I recently changed the target framework of my application from .net Framework 4.0 client profile to .net Framework 4.5.  That has apparently caused my entity framework to go a little haywire. I get this exception when I run my application...</p>\n\n<pre><code>System.Reflection.ReflectionTypeLoadException: Unable to load one or more of the requested types. Retrieve the\nLoaderExceptions property for more information.\n   at System.Reflection.RuntimeModule.GetTypes(RuntimeModule module)\n   at System.Reflection.RuntimeModule.GetTypes()\n   at System.Reflection.Assembly.GetTypes()\n   at System.Data.EntityUtil.GetTypesSpecial(Assembly assembly)\n   at System.Data.Metadata.Edm.ObjectItemAttributeAssemblyLoader.LoadTypesFromAssembly()\n   at System.Data.Metadata.Edm.ObjectItemAssemblyLoader.Load()\n   at System.Data.Metadata.Edm.ObjectItemAttributeAssemblyLoader.Load()\n   at System.Data.Metadata.Edm.AssemblyCache.LoadAssembly(Assembly assembly, Boolean loadReferencedAssemblies, ObjectItemLoadingSessionData loadingData)\n</code></pre>\n\n<p>The thing is it used to work before I made this change... What did I manage to mess up?  Do I need to regenerate these entities?  How do I go about trouble shooting and fixing this problem?  Thanks.</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":28,"score":-1,"question_id":13175262,"title":"My application doesn't recognize System.Data.Entity.Infrastructure in a console application with entity framework","body":"<p>I have a console application where i add deom nuget ,Entity framework power tools.I create a new console application and with click right on the project i choose Entity Framework/EF Code First ,i completed the informations regarding the database and the application generated my code.I receive message that \"reverse engeneer complete \" but i have compilation errors .The program doesn't recognize System.Data.Entity.Infrastructure .\nI use Visual Studio 2010.</p>\n\n<p>The error message is :</p>\n\n<p>The type or namespace name 'Infrastructure' does not exist in the namespace 'System.Data.Entity' (are you missing an assembly reference?)   D:\\Lucru\\ASP.Net\\ConsoleApplicationUseEntityFramework\\ConsoleApplicationUseEntityFramework\\Models\\PraccticeContext.cs   </p>\n\n<p>Can somebody tell me what's the problem?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13174593,"title":"Entity Framework 5 Code first adding an image","body":"<p>I am writing a very small application with mvc4 and entity framework 5.</p>\n\n<p>I want to add a product and store and image for the product.</p>\n\n<p>I have a model</p>\n\n<pre><code>  [Table(\"CatalogItem\")]\npublic class CatalogItemModel\n{\n    [Key]\n    public int CatalogItemId { get; set; }\n\n    public string Description { get; set; }\n\n    public double Price { get; set; }\n\n    public int ProductCount { get; set; }\n\n    public string Size { get; set; }\n\n    public string Sku { get; set; }\n\n    [Column(TypeName = \"image\")]\n\n\n    public byte[] Image { get; set; }\n\n    [Display(Name = \"Display Catalog Item\")]\n    public bool DisplayItem { get; set; }\n}\n</code></pre>\n\n<p>My controller. This never gets hit.</p>\n\n<pre><code> [HttpPost]\n    public ActionResult Create(CatalogItemModel catalogitemmodel)\n    {\n        if (ModelState.IsValid)\n        {\n            db.CatalogItemModels.Add(catalogitemmodel);\n            db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n\n        return View(catalogitemmodel);\n    }\n</code></pre>\n\n<p>My views form</p>\n\n<pre><code>    &lt;fieldset&gt;\n    &lt;legend&gt;CatalogItemModel&lt;/legend&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Description)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Description)\n        @Html.ValidationMessageFor(model =&gt; model.Description)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Price)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Price)\n        @Html.ValidationMessageFor(model =&gt; model.Price)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.ProductCount)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.ProductCount)\n        @Html.ValidationMessageFor(model =&gt; model.ProductCount)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Size)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Size)\n        @Html.ValidationMessageFor(model =&gt; model.Size)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Sku)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Sku)\n        @Html.ValidationMessageFor(model =&gt; model.Sku)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.DisplayItem)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.DisplayItem)\n        @Html.ValidationMessageFor(model =&gt; model.DisplayItem)\n    &lt;/div&gt;\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(m=&gt;m.Image)\n    &lt;/div&gt;\n\n    &lt;input name=\"Image\" type=\"file\"/&gt;\n    &lt;p&gt;\n        &lt;input type=\"submit\" value=\"Create\" /&gt;\n    &lt;/p&gt;\n&lt;/fieldset&gt;\n</code></pre>\n\n<p>When I try posting a new catalog with an image within my file input however it throws an error </p>\n\n<blockquote>\n  <p>The input is not a valid Base-64 string as it contains a non-base 64 character, more than two padding characters, or an illegal character among the padding characters.</p>\n</blockquote>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13175927,"title":"Lookup related record during mass insert?","body":"<p>I'm creating 5000 records from a XML feed. These get inserted in a <code>List&lt;Person&gt;</code> and ultimately saved to the database. </p>\n\n<p>However, there is one column in the Person model that has a many-to-many relationship: <strong>CourseId</strong>.</p>\n\n<p>These (12000) courses have been imported previously. In the Person feed I was given a <code>&lt;CourseID&gt;xxx&lt;/CourseID&gt;</code> number which i can use to relate to a course in my table. This CourseId is not the auto-generated Primary Key, but a seperate column.</p>\n\n<p>What I want is to loop through the feed, fill the Person properties and also link it to all the courses that are in the feed.</p>\n\n<p>Is there a fast query command I can issue when I create a new Person?</p>\n\n<p>Something like:</p>\n\n<pre><code>pList.Add(new Person { Name = personName, Course = // fetch all courses for this person } )\n</code></pre>\n"},{"tags":["c#","sql","entity-framework","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13175756,"title":"Set custom model Id (primary key) in MVC 4","body":"<p>I want to know if it's possible to use custom ID Integers as primary key?</p>\n\n<p>So instead of the default Ids 1,2,3,4,5,... I would like to use fixed Ids like 1422,1424,1426, ...</p>\n\n<p>I get these Ids from a feed and I will be using relationships based on those values. In my current setup, I have a general Id (auto generated) and a second FeedId column. Can't I just replace to auto-generated Id so it uses the FeedId?</p>\n"},{"tags":["asp.net-mvc","entity-framework","azure"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":38,"score":3,"question_id":13174197,"title":"'Microsoft.SqlServer.Types' version 10 or higher could not be found on Azure","body":"<p>I'm trying to make a webapi in ASP.NET MVC 4. The webapi used Entity Framework 5 Spatial types and i have wrote a very simple code. </p>\n\n<pre><code>  public List&lt;Area&gt; GetAllAreas()\n    {\n        List&lt;Area&gt; aList = db.Areas.ToList();\n        return aList;\n    }\n</code></pre>\n\n<p>Area contains DbGeometry.</p>\n\n<p>When i run this local it works, but when i publish it to azure it gives me this error:</p>\n\n<blockquote>\n  <p>Spatial types and functions are not available for this provider because the assembly 'Microsoft.SqlServer.Types' version 10 or higher could not be found.</p>\n</blockquote>\n\n<p>Anyone know how to resolve this ? :)</p>\n\n<p>Thanks!</p>\n"},{"tags":["entity-framework","entity-framework-4.1","ef-code-first","entity-framework-ctp5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":10658533,"title":"Many to many relation with the same table with EF4.3 Code First","body":"<p>How to make a configuration with this schema? </p>\n\n<pre><code>CREATE TABLE Entity\n(\n    Id int identity primary key,\n    Name nvarchar(30)\n)\n\nCREATE TABLE Member\n(\n    ParentEntityId references Entity(Id),\n    ChildEntityId references Entity(Id)\n)\n</code></pre>\n"},{"tags":["sql-server-2008","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13174809,"title":"how do I select from stored procedure","body":"<p>I am trying to work with EF, for the first time ever. I'm not sure I fully understand EF yet.</p>\n\n<p>I already have a database with data in it, so I've generated my models from DB.\nOur current setup runs EVERYTHING through stored procedures, even selects.\nHowever, unless I'm mistaking, the models select directly into the tables, when I have generated them.</p>\n\n<p>Can I change this behaviour, so it calls the select procedure instead?</p>\n"},{"tags":["sql-server","entity-framework","entity-framework-4","nopcommerce"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12057458,"title":"Is it possible to limit number of connections used by Entity Framework?","body":"<p>I've noticed that on a NopCommerce site we host (which uses Entity Framework) that if I run a crawler on the site (to check for broken links) it knocks the entire webserver offline for a few minutes and no other hosted sites respond. This seems to be because Entity Framework is opening 30-odd database connections and runs hundreds of queries per second (about 20-40 per page view).</p>\n\n<p>I cannot change how EF is used by NopCommerce (it would take weeks) or change the version of EF being used, so can I mitigate the effects it has on SQL Server by limiting how many concurrent connections it uses, to give other sites hosted on the same server a fairer chance at database access?</p>\n\n<p>What I'm ideally looking to do, is limit the number of concurrent DB connections to about 10, for a particular application.</p>\n"},{"tags":["entity-framework","database-design","relational-database"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13156374,"title":"One to one relation in SQL database","body":"<p>I have two tables: \"Person\" and \"Details\". Person should have one to one relation with Details. I have two options:</p>\n\n<ol>\n<li>Write DetailsId in Details table and make it FK to Details.Id(PK);</li>\n<li>Make Details.PersonId as PK and FK at the same time to Person.Id;</li>\n</ol>\n\n<p>In both cases relationship is one to one. Can you explain which one is better and in what cases?</p>\n\n<p>EDIT:</p>\n\n<p>I'm using entity framework and want to get Detail like this: Person.Detail, not Person.Details.First()</p>\n"},{"tags":["c#","wcf","entity-framework","ninject"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13135532,"title":"Ninject in a N-Tier App using WCF and InRequestScope","body":"<p>I'm using Ninject 3.01.1.10 with WCF extenstion and Web extention (all from nuget)</p>\n\n<p>I am using NInject in a WCF Service (that has several client desktop apps) using Entity Framework and Repository pattern.</p>\n\n<p>Since I am using EF, I wanted to use the InRequestScope so that each repository is created every time there is a service request (as the EF good practices dictate).</p>\n\n<p>I installed everything through nuget and have NinjectWebCommon bootstrapper class registering the services in RegisterServices as the Ninject WCF sample shows. I also have the WCF Service in InstanceContextMode.PerCall as I read somewhere online.</p>\n\n<p>My question is: does all the chain of injected objects needs to be in InRequestScope so the scope works?</p>\n\n<p>My WCF service is being injected with a ServiceHandlerDispatcher in the constructor:</p>\n\n<pre><code>public VanillaService(IServiceHandlerDispatcher serviceHandlerDispatcher) { ... }\n</code></pre>\n\n<p>This ServiceHandlerDispatcher has a dictionary of objects ServiceHandler that, according to the client's handler request, call a Controller object. This controller object has methods that use the repositories.</p>\n\n<pre><code>public ServiceHandlerDispatcher(IMessageHandler[] messageHandlers) { ... }\n\npublic SaveSubmissionHandler(SubmissionController submissionController) { ... }\n\npublic SubmissionController(IRepository&lt;Submission&gt; submissionRepository) { ... }\n</code></pre>\n\n<p>So the chain is something like this: Service -> ServiceHandlerDispatcher -> ServiceHandler -> controller -> repository -> DB</p>\n\n<p>For performance and memory purposes, I wanted the ServiceHandlerDispatcher and all ServiceHandler in singleton scope but the repository objects in InRequestScope (so that in each call the EF's DbContext is disposed), since I can have dozens of ServiceHandler objects.</p>\n\n<p>Again, Service -> ServiceHandlerDispatcher (SingletonScope) -> ServiceHandler (SingletonScope) -> controller (none) -> repository (InRequestScope) -> DB</p>\n\n<p>Is this possible or do I have to have the kernel creating each ServiceHandler in each call?\nIf it's needed that every object in the chain needs to be InRequestScope, how to implement the ServiceHandler dictionary? With the Factory extension?</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13172666,"title":"Invalid attempt to read when no data is present error","body":"<p>This is my code:</p>\n\n<pre><code>var products = (from x in db.tblExample select x).ToList();\n</code></pre>\n\n<p>and I get \"Invalid attempt to read when no data is present\" error.\nThe table exists and has data in it. This query:</p>\n\n<pre><code>SELECT *\nFROM [myDatabase].[dbo].[tblExample]\n</code></pre>\n\n<p>works fine in Microsoft SQL server. How to resolve this?</p>\n"},{"tags":["c#","mysql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":13171678,"title":"EF, how to increase query performance","body":"<p>i have about <code>1 million</code> data in my database(<code>MySQL</code>)</p>\n\n<p>and there's a advancedSearch function which is <code>very slow</code>(more than 30 sec), because the SQL EntityFramework generated is not very good, SQL:</p>\n\n<pre><code>SELECT\n`Project1`.*\nFROM \n(\nSELECT\n`Extent1`.*\nFROM `tnews` AS `Extent1`\n WHERE `Extent1`.`Region` = 'Americas(2)'\n ) AS `Project1`\n ORDER BY \n`Project1`.`PnetDT` DESC LIMIT 0,20\n</code></pre>\n\n<p>C# function:</p>\n\n<pre><code>    private List&lt;CNNews&gt; AdvancedSearchAndPage(int pagenum, int pagesize,\n        AdvSearchArgs advArgs)\n    {\n        IQueryable&lt;CNNews&gt; result = _dbRawDataContext.CNNews.\n            OrderByDescending(n =&gt; n.PnetDT);\n\n        if (!string.IsNullOrWhiteSpace(advArgs.Feed))\n        {\n            result = result.Where(news =&gt; news.Feed == advArgs.Feed);\n        }\n\n        if (!string.IsNullOrWhiteSpace(advArgs.PNET))\n        {\n            result = result.Where(news=&gt;news.PNET == advArgs.PNET);\n        }\n\n        if (!string.IsNullOrWhiteSpace(advArgs.ProdCode))\n        {\n            result = (from news in result\n                      where news.ProdCode == advArgs.ProdCode\n                      select news);\n        }\n\n        if (!string.IsNullOrWhiteSpace(advArgs.Code))\n        {\n            result = (from news in result\n                      where news.Code == advArgs.Code\n                      select news);\n        }\n\n        if (!string.IsNullOrWhiteSpace(advArgs.BegineDate))\n        {\n            var begin = Convertion.ToDate(advArgs.BegineDate);\n            var end = Convertion.ToDate(advArgs.EndDate);\n\n            result = (from news in result\n                      where news.PnetDT &gt;= begin &amp;&amp; news.PnetDT &lt; end\n                      select news);\n        }\n\n        if (!string.IsNullOrWhiteSpace(advArgs.Region))\n        {\n            result = result.Where(x =&gt; x.Region == advArgs.RegionName);\n        }\n\n        var pagedList = result.\n            Skip(pagenum * pagesize).\n            Take(pagesize);\n        return pagedList.ToList();\n    }\n</code></pre>\n\n<p>if the SQL format like this, it will <code>very fast</code>:</p>\n\n<pre><code> SELECT\n*\nFROM `tnews` AS `Extent1`\n WHERE `Extent1`.`Region` = 'Americas(2)'\n ORDER BY \n `PnetDT` DESC LIMIT 0,20\n</code></pre>\n"},{"tags":["linq","entity-framework","enums"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13153646,"title":"Using Enums inside EF queries","body":"<p>I have following query (EF5, .NET4.5):</p>\n\n<pre><code>from p in repository\nselect new Person() {\n    Name = p.Name, \n    Birthday = p.Birthday,\n    MyEnumValue = MyEnum.Value1\n};\n</code></pre>\n\n<p>where <em>MyEnumValue</em> is <strong>enum</strong> defined like:</p>\n\n<pre><code>public enum MyEnum : byte\n{\n    Value1 = 1,\n    Value2 = 2\n}\n</code></pre>\n\n<p>At runtime this code causing the exception:</p>\n\n<p><em>The specified cast from a materialized 'System.Byte' type to the 'MyApp.Domain.Models.MyEnum' type is not valid.</em></p>\n\n<p>But if I change enum definition to</p>\n\n<pre><code>public enum MyEnum { ... }\n</code></pre>\n\n<p>all works fine.</p>\n\n<p>Is it possible to fix exception don't change MyEnum to int? (and without additional byte property :) )</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","plugins","mef","repository-pattern"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12172610,"title":"Entity Framework Plugin Architecture Recommendation","body":"<p>I am trying to build a modularized ASP.NET MVC application using Areas and Dependency Injection. The application currently consists of the following projects:</p>\n\n<ul>\n<li><strong>Framework.Contracts</strong> (Interfaces for Authentication Service, Authorization, Logging)</li>\n<li><strong>Framework</strong> (Implementation of Authentication Service, Authorization, ...)</li>\n<li><strong>Framework.Web</strong> (MVC Web Application)</li>\n</ul>\n\n<p>Each plugin consists of an MVC Area project, contracts and service implementation:</p>\n\n<ul>\n<li><strong>EmployeesPlugin.Contracts</strong> (Interfaces for IEmployeesService)</li>\n<li><strong>EmployeesPlugin</strong> (Implentation for IEmployeesService)</li>\n<li><strong>EmployeesPlugin.MVC</strong> </li>\n</ul>\n\n<p>I want to use Entity Framework Database First or Model First (since I have to connect an existing database). My problem is that I do not know how to loosly couple my entities. I do not want to put them into a single shared DatabaseLayer project. Rather I would like to define central entities (User, Settings, LogEntries, ...) for the Framework project and additional entities (like Employee, Company) for each plugin. </p>\n\n<p>After reading <a href=\"http://stackoverflow.com/questions/5260200/orm-architecture-one-or-multiple-models-entity-framework\">ORM Architecture: One or Multiple Models (Entity Framework)</a> I thought about creating multiple Models (i.e. Multiple Data Contexts). Actually I do not like the idea of having redudant code. </p>\n\n<p>I thought about creating interfaces that expose the properties of each entity. These interfaces will be put in a project per Plugin. Like <code>IEmployee</code> exposing <code>FirstName</code> and <code>LastName</code>. Then I started to create an <code>IEmployeeRepository</code> to return and create, edit and delete Employees. However creating employees does not work when only exposing <code>IEmployee</code> and no concrete class. </p>\n\n<p>Another problem is that the entity <code>Employee</code> contains references to entities in other projects/plugins. Lets say a employee hosts a number of projects. Thus I thought to create a generic <code>IEmployee</code> interface without the reference to the project and an <code>IEmployeeProjects</code> interface containing the reference to the projects. That way I could create a class <code>Employee</code> in a central database layer project that implement both <code>IEmployee</code> add `IEmployeeProjects:</p>\n\n<pre><code>public class Employee : IEmployee, IEmployeeProjects\n{   \n    // From IEmployee interface\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n\n    // From IEmployeeProject interface\n    public virtual ICollection&lt;Project&gt; Projects { get; set; }\n}\n</code></pre>\n\n<p>The problem is that I do not know how to plump things together using the Entity framework. </p>\n"},{"tags":[".net","entity-framework","entity-framework-4.1"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":935,"score":0,"question_id":5458925,"title":"type error in EF 4.1","body":"<p>I have created an entity and it has a key of type Int. when I run the project and use this entity I get following error:</p>\n\n<blockquote>\n  <p>The 'Id' property on 'Product' could\n  not be set to a 'Int64' value. You\n  must set this property to a non-null\n  value of type 'Int32'.</p>\n</blockquote>\n\n<p>How can I fix it ?</p>\n\n<p>Edit:</p>\n\n<p>I am using SQL server and entity framework 4.1. I get error in controller action: </p>\n\n<pre><code>public ActionResult Test(long id) \n{ \n    return View(repository.GetObligor(id)); \n}\n</code></pre>\n"},{"tags":["entity-framework","appharbor"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":397,"score":2,"question_id":8199500,"title":"Connection string \"Unable to load the specified metadata resource\" Issue","body":"<p>I am trying to connect my Entity Framework mappings to be integrated with an Sql server on a hosted site.</p>\n\n<p>This issue can be found in the following stack trace:</p>\n\n<pre><code>[MetadataException: Unable to load the specified metadata resource.]\n   System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.LoadResources(String assemblyName, String resourceName, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver) +387\n   System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource..ctor(String originalPath, String assemblyName, String resourceName, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver) +72\n   System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.CreateResourceLoader(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver) +222\n   System.Data.Metadata.Edm.MetadataArtifactLoader.Create(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver) +74\n   System.Data.Metadata.Edm.MetadataArtifactLoader.Create(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry) +68\n</code></pre>\n\n<p>I am assume that my connection string is not being setup correctly, as I need to generate this string dynamically at runtime. The String looks as follows:</p>\n\n<pre><code>&lt;add name=\"Model1Container-providerConnectionString\" \n     connectionString=\"data source=something.sqlserver.sequelizer.com;\n     User ID=**; \n     Password=**;\n     Initial Catalog=dbd5d3955e11834e1088929f9d005af0a8;\n     user instance=True;multipleactiveresultsets=True;App=EntityFramework\" /&gt;\n</code></pre>\n\n<p>Then on run time the string is constructed as follows:</p>\n\n<pre><code>    public static string GetConnectionString()\n    {\n        string baseConnectionString = ConfigurationManager.ConnectionStrings[\"Model1Container-providerConnectionString\"].ConnectionString;\n\n        EntityConnectionStringBuilder entityBuilder = new EntityConnectionStringBuilder();\n        entityBuilder.Provider = \"System.Data.SqlClient\";\n        entityBuilder.ProviderConnectionString = baseConnectionString;\n        entityBuilder.Metadata = @\"res://*/DBModel.csdl|res://*/DBModel.ssdl|res://*/DBModel.msl\";\n\n        return entityBuilder.ToString();\n    }\n}\n</code></pre>\n\n<p>Been working on this issue for a few days now, would very much appreciate the communities expertise in finding a working solution.</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":818,"score":3,"question_id":5500657,"title":"problem with navigation properties in entity framework","body":"<p>When I execute this query I can navigate in <code>TypeP</code> property:</p>\n\n<pre><code>var items = from item in context.ProductosBodegas.Include(\"Product.TypeP\")\n            select item;\n</code></pre>\n\n<p>But when I execute this query the <code>TypeP</code> Property is <code>null</code>:</p>\n\n<pre><code>var items = from item in context.ProductosBodegas.Include(\"Product.TypeP\")\n            select item.Product;\n</code></pre>\n\n<p>Why is this?</p>\n"},{"tags":["entity-framework","dynamics-crm-2011"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":13128563,"title":"Cannot add Currency field to Entity after Importing","body":"<p>A custom entity was created in our DEV environment.  It originally had a Currency field, but we decided to remove it and use a Float field for simplicity.  After exporting the solution and importing it into QA for the first time, I can no longer add a Currency field to the entity in QA (and the \"leftover\" transactioncurrencyid column in DEV did not get migrated to QA).</p>\n\n<p>The main problem is that I cannot remove the transactioncurrencyid column and now my Filtered views are different between DEV and QA which causes our SharePoint BCS process that relies on Entity Framework to fail.</p>\n\n<p>Is there any way to completely remove a currency field without recreating the entity?</p>\n\n<p>Plan B: Is there a way to restore a past copy of the entity (prior to removing the currency) from a backup and merge it into our presently broken version? </p>\n\n<p>Plan C: any other ideas (convert EF to use Stored Procs, etc)?</p>\n\n<p>Thanks!</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13167777,"title":"Entity Framework Update related entity","body":"<p>I get an error message while trying to update related entity.</p>\n\n<p>When create new one is OK.</p>\n\n<p>The error message say : </p>\n\n<p><em>A referential integrity constraint violation occurred: The property values that define the \nreferential constraints are not consistent between principal and dependent objects in the relationship.</em></p>\n\n<p><strong>Please review my codes, and advice me what I am doing wrong.</strong></p>\n\n<p>First of all, DB is Mysql MyISAM.</p>\n\n<p>Entity Class</p>\n\n<pre><code>[Table(\"note\")]\npublic class Note\n{\n    [Key]\n    public int id { get; set; }\n\n    [Required(ErrorMessage=\"Content is required\")]\n    [DisplayName(\"Note\")]\n    public string content { get; set; }\n    public DateTime date { get; set; }\n\n    [Required(ErrorMessage = \"User ID is required\")]\n    [DisplayName(\"User ID\")]\n    public string userId {get; set;}\n    public Boolean isPrivate { get; set; }\n\n    [DisplayName(\"Attach File\")]\n    public virtual ICollection&lt;AttachedFile&gt; AttachedFiles { get; set; }\n\n}\n\n[Table(\"attachedfile\")]\npublic class AttachedFile\n{\n    [Key]\n    public int id { get; set; }\n    public int noteId { get; set; }\n    public string fileName { get; set; }\n}\n</code></pre>\n\n<p>Controller,</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Index(Note note, HttpPostedFileBase attFile)\n{\n    try\n    {\n    if (ModelState.IsValid)\n    {\n        updateAttachFile(note, attFile);\n        if (note.id &gt; 0)\n        {\n        unitOfWork.NoteRepository.UpdateNote(note);\n        }\n        else\n        {\n        unitOfWork.NoteRepository.InsertNote(note);\n        }\n\n        unitOfWork.Save();\n        return RedirectToAction(\"Index\");\n    }\n    }catch(DataException){\n    ModelState.AddModelError(\"\", \"Unable to save changes. Try again please\");\n    }\n\n    var notes = unitOfWork.NoteRepository.GetNotes();\n    return View(new NoteViewModel() { noteList = notes.ToList(), note = new Note() });\n}\n\nprivate void updateAttachFile(Note note,HttpPostedFileBase attFile)\n{\n    if (attFile == null) return;\n\n    List&lt;AttachedFile&gt; list;\n    if (note.id &gt; 0)\n    {\n    list = unitOfWork.AttachedFileRepository.Get(filter: q =&gt; q.noteId.Equals(note.id)).ToList();\n    }\n    else\n    {\n    list = new List&lt;AttachedFile&gt;();\n    }\n\n    var fileName = Path.GetFileName(attFile.FileName);\n    fileName = fileName.Replace(\" \", \"\");\n    fileName = Regex.Replace(fileName, @\"\\s|\\$|\\#\\%\", \"\");\n    var path = Path.Combine(Server.MapPath(\"~/App_data/uploads\"), fileName);\n    attFile.SaveAs(path);\n\n    list.Add(new AttachedFile\n    {\n    fileName = fileName\n    });\n\n    note.AttachedFiles = list;\n}\n}\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/bXLpt.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","visual-studio","entity-framework","msbuild"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13105885,"title":"Entity Framework build exits with warnings and will not run tests after cloning the CodePlex repo","body":"<p>I am trying to build EF after following <a href=\"http://entityframework.codeplex.com/documentation\" rel=\"nofollow\">these instructions</a>. Everything seems to have completed successfully, but when I run build.cmd I get two warnings:</p>\n\n<blockquote>\n  <p>C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Microsoft.Common.targets(1578,5):\n  warning MSB3245: Could not resolve this reference. Could not locate\n  the assembl y \"Microsoft.VisualStudio.QualityTools.UnitTestFramework,\n  Version=10.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a,\n  processorArchitecture=MSIL\". Chec k to make sure the assembly exists\n  on disk. If this reference is required by your code, you may get\n  compilation errors. [C:\\Users\\Chasemedallion\\Documents\\entityframework\\test\\EntityFramework\\VBTests\\VBTests.vbproj]</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Microsoft.Common.targets(1988,5):\n  warning MSB3283: Cannot find wrapper assembly for type library\n  \"EnvDTE\". Verify  that (1) the COM component is registered correctly\n  and (2) your target platform is the same as the bitness of the COM\n  component. For example, if the COM component is 32-bit, your target\n  platform must not be 64-bit.\n  [C:\\Users\\Michael\\Documents\\Interests\\CS\\entityframework\\src\\EntityFramework.PowerShell\\EntityFramework.PowerShell.csproj]</p>\n</blockquote>\n\n<p>After the second warning, the command exits and does not run any tests, even when run with /t:Test. Can anyone give me pointers on what these errors are or how I can resolve them? Strangely, I see neither warning when I build from VS2012 Express (Desktop) with Ctrl+Shift+B.</p>\n\n<p>Also, I've confirmed that Microsoft.VisualStudio.QualityTools.UnitTestFramework.dll is in C:\\Program Files\\Microsoft Visual Studio 11.0\\Common7\\IDE\\PublicAssemblies.</p>\n"},{"tags":["sql-server-2008","entity-framework","sql-server-express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13168166,"title":"\"The underlying provider failed on Open\" Entity Framework error","body":"<p>I've been getting the error \"The underlying provider failed on Open.\" recently and I've been pulling my hair out trying to figure out why.  On closer inspection of the error the inner exception is \"The connection was not closed. The connection's current state is connecting.\" and the stack trace is </p>\n\n<pre><code>\"at System.Data.ProviderBase.DbConnectionClosedConnecting.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)\n   at System.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry)\n   at System.Data.SqlClient.SqlConnection.Open()\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\"\n</code></pre>\n\n<p>As far as I can tell the error seems to happen at random or possibly when making changes to the application.  Any help would be greatly appreciated.</p>\n\n<p>My current setup is</p>\n\n<ul>\n<li>IIS Express</li>\n<li>Microsoft SQL Server Express Edition</li>\n<li>Visual Studio 2012</li>\n<li>MVC Web API \\ Asp.net MVC 4</li>\n<li>Entity Framework 5</li>\n</ul>\n\n<p>My data layer is modeled off the Repository pattern and injected via Structure map.</p>\n\n<p><strong>Repository</strong></p>\n\n<pre><code>public class Repository&lt;T&gt; : IDisposable, IRepository&lt;T&gt; where T : class\n{\n    private readonly DbSet&lt;T&gt; _dbSet;\n    private readonly DbContext _dbContext;\n\n    public Repository(IDbContextFactory&lt;MyContext&gt; dbContextFactory)\n    {\n        _dbContext = dbContextFactory.Create();\n        _dbSet = _dbContext.Set&lt;T&gt;();\n    }\n\n    //removed for brevitity\n\n    public void Dispose()\n    {\n        _dbContext.Dispose();\n    }\n</code></pre>\n\n<p><strong>DbContextFactory</strong></p>\n\n<pre><code>public class MyContextFactor : IDbContextFactory&lt;MyContext&gt;, IDisposable\n{\n    private MyContext _dataContext;\n\n    public MyContextFactor Create()\n    {\n        return _dataContext ?? (_dataContext = new MyContext());\n    }\n\n    public void Dispose()\n    {\n        _dataContext.Dispose();\n    }\n}\n</code></pre>\n\n<p><strong>Structure Map Registry for IOC</strong></p>\n\n<pre><code>For(typeof(IDbContextFactory&lt;MyContext&gt;)).HybridHttpOrThreadLocalScoped().Use(typeof(MyContextFactory));\n</code></pre>\n\n<p><strong>Connection String</strong></p>\n\n<pre><code>&lt;add name=\"MyContextConnectionString\" connectionString=\"metadata=res://*/Model.MyProject.csdl|res://*/Model.MyProject.ssdl|res://*/Model.MyProject.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=(local);initial catalog=MyDB;User Id=SQLUser;Password=****;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\"/&gt;\n</code></pre>\n\n<p>Things I've attempted to fix the problem and so far haven't worked</p>\n\n<ul>\n<li>ensure context is per http context via structure map scope</li>\n<li>added dispose to repository</li>\n<li>added dispose to ContextFactory</li>\n<li>switched from Intergrated Sql auth to Sql authentication</li>\n</ul>\n"},{"tags":["asp.net-mvc","entity-framework","one-to-many"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13166025,"title":"Update EF ICollection property","body":"<p>How do I update a ICollection property in EF?</p>\n\n<p>I get this error message;</p>\n\n<p>\"Cannot implicitly convert type 'int' to '<code>System.Collections.Generic.ICollection&lt;MySolution.Domain.UserProfile&gt;</code>'\"</p>\n\n<p>My entities:</p>\n\n<pre><code>public class Department\n{\n    public virtual int Id { get; set; }\n    public virtual string DepartmentTitle { get; set; }\n    public virtual ICollection&lt;UserProfile&gt; UserProfiles { get; set; }\n\n}\n\npublic class UserProfile\n{\n    public virtual int UserId { get; set; }\n    public virtual string UserName { get; set; }\n    public virtual string FirstName { get; set; }\n    public virtual string LastName { get; set; }\n\n}\n</code></pre>\n\n<p>Code;</p>\n\n<pre><code>    var userProfile = _db.UserProfiles.Single(d =&gt; d.UserName == \"SomeUserName\");\n\n    var department = _db.Departments.Single(d =&gt; d.Id == variableDepartmentID);\n    department.UserProfiles = uProfile.UserId;\n    _db.UpdateDepartment(department);\n    _db.Save();\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":34,"score":2,"question_id":13110849,"title":"Entity Framework query - auto-compile is off, but still the second query is much faster","body":"<p>I got .net 4.0 with Entity Framework 4.0 with Visual Studio 2012 and Windows 7, 64bit architecture, 4 cores. </p>\n\n<p>I'm performing some tests on a console application with the AdventureWorks database. The thing that is bothering me is that the first time I take some products it takes much more time than the second time, I want to know why. </p>\n\n<p>I know that there are some tasks that Entity Framework perform during it's first query, so I executed some extra query ahead. </p>\n\n<p>For example, my main function contains the following : </p>\n\n<pre><code>using (var context = new Context())\n{\n   execute context.Clients.ToList();   // &lt;- this takes something like 300 ms\n}\n\nusing (var context = new Context())\n{\n   execute context.Products.ToList();   // &lt;- this takes something like 200 ms\n}\n\nusing (var context = new Context())\n{\n   execute context.Products.ToList();   // &lt;- this takes something like 10 ms\n}\n</code></pre>\n\n<p>So you see that the first query with all the \"first time execution\" things is taking 300 ms. </p>\n\n<p>The second takes 200s, and the third one, which is the same like the second takes only 10ms. </p>\n\n<p>So my question is : why is my third query taking such a small amount of time ? I do not use auto-compile (since there is no such in EF 4.0), or the CompiledQuery class. </p>\n\n<p>Also my first invocation to Products is not the first query on the model, so all the work for view generation should be already done. </p>\n\n<p>But still it takes so much time the first time and is so fast the second time I call Products. Does it cache something somewhere ?</p>\n\n<p>Another thing I noticed is that when I compile it for 64 bit, it takes a ridiculous amount of time, something like one second. And when I compile it for 32 bit, it takes the amount I had given. </p>\n\n<p>Can you give me some hints here ? </p>\n\n<p>Thanks </p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":6,"up_vote_count":13,"down_vote_count":0,"view_count":9207,"score":13,"question_id":2185155,"title":"Cloning data on Entity Framework","body":"<p>I am creating software where user can create new product based on older product.</p>\n\n<p>Now I need to make copying / cloning operations with Entity Framework. First I started writing like this:</p>\n\n<pre>\nforeach(sourcedata1 in table1)\n{\n   ... create new table\n   ... copy data\n   ... create Guid\n   ... add\n   foreach(sourcedata2 in table2)\n   {\n       ... create new table\n       ... copy data\n       ... create Guid\n       ... add       \n\n       ... and so on\n   }\n}\n</pre>\n\n<p>Problem is that this not a nice way to do it. Is there any easy way clone information (except Guid that needs to be generated for new rows) or should I manually copy everything?</p>\n\n<p><strong>Other solution</strong></p>\n\n<p>You could also use EmitMapper or AutoMapper to do copying of the properties.</p>\n"},{"tags":["c#",".net","winforms","entity-framework","version"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13157297,"title":"How can i retrieve the version of Entity Framework in a WinForms application","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/7315127/how-to-get-current-ef-version\">How to get current EF version</a>  </p>\n</blockquote>\n\n\n\n<p>In my windows forms application, I want to display the Entity Framework version being used by the applications .edmx files. Is it possible to get the Entity Framework version from the app.config file or the .edmx file in C#?.</p>\n"},{"tags":["visual-studio-2010","entity-framework",".net-3.5",".net-4.0","compatibility"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":791,"score":1,"question_id":4997890,"title":"Using Entity Framework 3.5 AND 4.0 in the Same Project","body":"<p>I'm wondering if using VS.Net 2010, I can have Entity Framework 3.5 code running along side 4.0 code. I have a project that I'm working on, some of it is currently written using EF 3.5. I'd like to start using EF 4.0 for anything new we add to the project, and convert the EF 3.5 stuff over a little at a time. Is it feasible to run the two side by side in the same project?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","automapper"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13163724,"title":"How can I accomplish the following mapping with Automapper?","body":"<p>I want to map the class (Entity),</p>\n\n<pre><code>public class Source {\n   public int x;\n   public string y;\n   public bool z;\n\n   public int a;\n   public int b;\n   public int c;\n\n   //bunch of other fields\n   //...\n   //..\n   //.\n}\n</code></pre>\n\n<p>to the following class (View Model):</p>\n\n<pre><code>public class Destination {\n   public MyClass1 A;\n   public MyClass2 B;\n}\n</code></pre>\n\n<p>where MyClass1, MyClass2 are defined as follows:</p>\n\n<pre><code>public class MyClass1 {\n   public int x;\n   public string y;\n   public bool z;\n}\n\npublic class MyClass2 {\n   public int a;\n   public int b;\n   public int c;\n}\n</code></pre>\n\n<p>Is this possible with Automapper?</p>\n"},{"tags":["c#","entity-framework","ef-code-first","sql-server-ce","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13162857,"title":"SqlCe Code First with Password EF5","body":"<p>I'm using Code First (EF5) with my WPF app, but I want the sdf file to be password protected. I've been googling and found nothing that could help me.</p>\n\n<p>I want to accomplish this inside my code, along with the <code>context.Database.Initialize(true)</code></p>\n"},{"tags":["c#","entity-framework","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13162944,"title":"Entity framework generic repository - Foreign key exception updating entity relationship","body":"<p>I have followed a EF repository pattern that I read about in Julie Lermans book Programming Entity Framework: Dbcontext</p>\n\n<p>I have an entity called Customer which has a many to many relationship with entity Favourite</p>\n\n<p>Here is some example code of an update to Customer</p>\n\n<pre><code>customer.CustomerLocation_ID = 5;     \n\ncustomer.Favourites.clear();\n\ncustomer.State = State.Modified;\ncustomerRepository.InsertOrUpdate(customer);\n</code></pre>\n\n<p>Insert will then do the following:</p>\n\n<pre><code>Entry(entity).State = EntityState.Modified;\n\nforeach (var entity in this.ChangeTracker.Entries&lt;IEntityState&gt;())\n{\n    IEntityState stateInfo = entity.Entity;\n    entity.State = StateHelpers.ConvertState(stateInfo.State);\n}\n</code></pre>\n\n<p>Then finally:</p>\n\n<pre><code>context.SaveChanges();\n</code></pre>\n\n<p>On save I get an unique key exception on Favourites because Favourites name is unique. But I am not adding anything into Favourites. </p>\n\n<p>When I remove the .clear() line, everything saves fine. </p>\n\n<p>Update:</p>\n\n<p>I added in this piece of code just trying out a few things and now it works. </p>\n\n<pre><code>foreach (var fav in customer.Favourites)\n{\n     fav.State = State.Modified;\n}\n</code></pre>\n\n<p>Does it mean that even though I am affecting the Customer I still need to mark the Favourites as modified so they are tracked and updated? I just didn't think I would have to do this.</p>\n"},{"tags":["c#","entity-framework","try-catch","repository-pattern","database-deadlocks"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":61,"score":4,"question_id":13159326,"title":"Implementing retry logic for deadlock exceptions","body":"<p>I've implemented a generic repository and was wondering if there is a smart way to implement a retry logic in case of a deadlock exception?</p>\n\n<p>The approach should be the same for all repository methods. So is there anyway I can avoid writing 'try/catch - call method again with retry-count', in every single method?</p>\n\n<p>Any suggetsion are welcome.</p>\n\n<p>A bit of my Repository code:</p>\n\n<pre><code>public class GenericRepository : IRepository\n{\n    private ObjectContext _context;\n\n    public List&lt;TEntity&gt; ExecuteStoreQuery&lt;TEntity&gt;(string commandText, params object[] parameters) where TEntity : class\n    {\n        List&lt;TEntity&gt; myList = new List&lt;TEntity&gt;();\n\n        var groupData = _context.ExecuteStoreQuery&lt;TEntity&gt;(commandText, parameters);\n\n        return myList;\n    }\n\n\n    public IQueryable&lt;TEntity&gt; GetQuery&lt;TEntity&gt;() where TEntity : class\n    {          \n        var entityName = GetEntityName&lt;TEntity&gt;();\n        return _context.CreateQuery&lt;TEntity&gt;(entityName);\n    }\n\n    public IEnumerable&lt;TEntity&gt; GetAll&lt;TEntity&gt;() where TEntity : class\n    {\n        return GetQuery&lt;TEntity&gt;().AsEnumerable();\n    }\n</code></pre>\n\n<p>EDIT: </p>\n\n<p><strong>1.Solution:</strong> </p>\n\n<p><em>Modified slightly from</em> <strong>chris.house.00</strong>'s <em>solution</em></p>\n\n<pre><code> public static T DeadlockRetryHelper&lt;T&gt;(Func&lt;T&gt; repositoryMethod, int maxRetries)\n    {\n        int retryCount = 0;\n\n        while (retryCount &lt; maxRetries)\n        {\n            try\n            {\n                return repositoryMethod();\n            }\n            catch (System.Data.SqlClient.SqlException e)\n            {\n                if (ex.Number == 1205)// Deadlock                         \n                    retryCount++;\n                else\n                    throw;                   \n            }\n        }\n        return default(T);\n    }\n</code></pre>\n\n<p>And you call it like this:</p>\n\n<pre><code>    public TEntity FirstOrDefault&lt;TEntity&gt;(Expression&lt;Func&lt;TEntity, bool&gt;&gt; predicate) where TEntity : class\n    {\n        return RetryUtility.DeadlockRetryHelper&lt;TEntity&gt;( () =&gt;p_FirstOrDefault&lt;TEntity&gt;(predicate), 3);\n    }\n\n    protected TEntity p_FirstOrDefault&lt;TEntity&gt;(Expression&lt;Func&lt;TEntity, bool&gt;&gt; predicate) where TEntity : class\n    {\n        return GetQuery&lt;TEntity&gt;().FirstOrDefault&lt;TEntity&gt;(predicate);\n    }\n</code></pre>\n"},{"tags":["c#","entity-framework","service","windows-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13161748,"title":"Use Entity Framework inside a ServiceBase class","body":"<p>I'm moving a routine that uses an Entity Framework edmx model to read data from a db and send to a web service.</p>\n\n<p>When the service tries to create the model, reading the connection string from the app.config I obtain the exception</p>\n\n<blockquote>\n  <p><em>Unable to initialize the configuration system</em> (translated into English)<br>\n  in System.Configuration.ConfigurationManager.get_ConnectionStrings()<br>\n  in System.Data.EntityClient.EntityConnection.ChangeConnectionString(String\n  newConnectionString)<br>\n  in System.Data.Objects.ObjectContext..ctor(String connectionString,\n  String defaultContainerName)</p>\n</blockquote>\n\n<p>Seems that I have some problems reading the config file.</p>\n\n<p>Same problem configuring system account or administrator.</p>\n\n<p>How can I solve this problem?</p>\n\n<p>luca</p>\n"},{"tags":["c#","entity-framework","datagridview","databound"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13155140,"title":"Filtering DataGridView rows when DataSource is bound to a EF5 Entity collection","body":"<p>I have a DataGridView which is databound to a BindingList</p>\n\n<pre><code>private void InitGrid()\n{\n    Ctx.MyEntitySet.Load();\n    dataGridView1.DataSource = Ctx.MyEntitySet.Local.ToBindingList();\n    dataGridView1.Columns[\"Id\"].Visible = false;\n    dataGridView1.Columns[\"UnwantedCol1\"].Visible = false;\n    dataGridView1.Columns[\"UnwantedCol2\"].Visible = false;\n    dataGridView1.Columns[\"UnwantedCol3\"].Visible = false;\n}\n</code></pre>\n\n<p>and a filtering TextBox, with a TextChanged event handled like this</p>\n\n<pre><code>private void textBoxFilter_TextChanged(object sender, EventArgs e)\n{\n    try\n    {\n        string filter = textBoxFilter.Text.Trim();\n        ((DataView)dataGridView1.DataSource).RowFilter = filter;\n        textBoxFilter.BackColor = SystemColors.AppWorkspace;\n    }\n    catch (Exception)\n    {\n        textBoxFilter.BackColor = Color.Red;\n        ToolTip tip = new ToolTip();\n        tip.SetToolTip(textBoxFilter, ex.Message);\n    }\n}\n</code></pre>\n\n<p>I run the code, the data is displayed correctly, but when I try to type something like <code>ColumnName like '%sometext%'</code> in my filter textbox, I get an exception saying I can't cast a 'System.Data.Entity.Internal.ObservableBackedBindingList`1[MyEntity]' to 'System.Data.DataView'.</p>\n\n<p>Can anyone give me a pointer?</p>\n\n<p>Thanks,\nF.</p>\n\n<p><strong>RESOLVED:</strong></p>\n\n<p>Added a generic extension method</p>\n\n<pre><code>public static class LocalExtensions\n{\n    public static IEnumerable&lt;T&gt; Filter&lt;T&gt;(this IEnumerable&lt;T&gt; list, Func&lt;T, bool&gt; filterParam)\n    {\n        return list.Where(filterParam);\n    }\n}\n</code></pre>\n\n<p>And modified TextChanged event handler like this:</p>\n\n<pre><code>private void textBoxFilter_TextChanged(object sender, EventArgs e)\n{\n    try\n    {\n        string filter = textBoxFilter.Text.Trim();\n\n        dataGridView1.DataSource =\n            Ctx.MyEntitySet.Local\n            .Filter(x =&gt;\n                x.EntityPropertyToSearchIn1.ToUpper().Contains(filter.ToUpper()) ||\n                x.EntityPropertyToSearchIn2.ToUpper().Contains(filter.ToUpper())\n            ).ToList();\n\n        textBoxFilter.BackColor = SystemColors.AppWorkspace;\n    }\n    catch (Exception)\n    {\n        textBoxFilter.BackColor = Color.Red;\n        ToolTip tip = new ToolTip();\n        tip.SetToolTip(textBoxFilter, ex.Message);\n    }\n}\n</code></pre>\n"},{"tags":["asp.net","entity-framework","dynamic-data","objectcontext","asp.net-dynamic-data"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13161198,"title":"Getting a reference of \"current\" ObjectContext inside an ASP.NET Dynamic Data application","body":"<p>This is the first time I use ASP.NET Dynamic Data, so excuse me if my question sounded stupid. Anyway, I need a way to access the <code>ObjectContext</code> instance the application uses to get and save data to the database. I do not want to create a new instance because that would beat the purpose of what I'm currently doing. So is that even possible?</p>\n"},{"tags":["sql","vb.net","entity-framework","stored-procedures","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13126213,"title":"Entity Framework does not map 2 columns from a SqlQuery calling a stored procedure","body":"<p>I'm using Code First and am trying to call a stored procedure and have it map to one of my classes. I created a stored procedure, BOMComponentChild, that returns details of a Component with information of its hierarchy in PartsPath and MyPath. I have a class for the output of this stored procedure. I'm having an issue where everything except the two columns, PartsPath and MyPath, are being mapped correctly with these two properties ending up as Nothing. I searched around and from my understanding the mapping bypasses any Entity Framework name mapping and uses column name to property name. The names are the same and I'm not sure why it is only these two columns.</p>\n\n<p>The last part of the stored procedure is:</p>\n\n<pre><code>SELECT   t.ParentID\n        ,t.ComponentID\n        ,c.PartNumber\n        ,t.PartsPath\n        ,t.MyPath\n        ,t.Layer\n        ,c.[Description]\n        ,loc.LocationID\n        ,loc.LocationName\n        ,CASE WHEN sup.SupplierID IS NULL THEN 1 ELSE sup.SupplierID END AS SupplierID\n        ,CASE WHEN sup.SupplierName IS NULL THEN 'Default' ELSE sup.SupplierName END AS SupplierName\n        ,c.Active\n        ,c.QA\n        ,c.IsAssembly\n        ,c.IsPurchasable\n        ,c.IsMachined\n        ,t.QtyRequired\n        ,t.TotalQty\n\nFROM    BuildProducts                       t \n        INNER JOIN [dbo].[BOMComponent]     c       ON c.ComponentID    = t.ComponentID         \n        LEFT JOIN [dbo].[BOMSupplier]       bsup    ON bsup.ComponentID = t.ComponentID AND bsup.IsDefault = 1\n        LEFT JOIN [dbo].[LookupSupplier]    sup     ON sup.SupplierID   = bsup.SupplierID\n        LEFT  JOIN [dbo].[LookupLocation]   loc     ON loc.LocationID   = c.LocationID\nWHERE \n        (@IsAssembly IS NULL OR IsAssembly = @IsAssembly)\nORDER BY\n         t.MyPath\n</code></pre>\n\n<p>and the class it maps to is:</p>\n\n<pre><code>Public Class BOMComponentChild\n\n        Public Property ParentID As Nullable(Of Integer)\n        Public Property ComponentID As Integer\n        Public Property PartNumber As String\n        Public Property MyPath As String\n        Public Property PartsPath As String\n        Public Property Layer As Integer\n        Public Property Description As String\n        Public Property LocationID As Integer\n        Public Property LocationName As String\n        Public Property SupplierID As Integer\n        Public Property SupplierName As String\n        Public Property Active As Boolean\n        Public Property QA As Boolean\n        Public Property IsAssembly As Boolean\n        Public Property IsPurchasable As Boolean\n        Public Property IsMachined As Boolean\n        Public Property QtyRequired As Integer\n        Public Property TotalQty As Integer\n\n        Public Property Children As IDictionary(Of String, BOMComponentChild) = New Dictionary(Of String, BOMComponentChild)\n\n    End Class\n</code></pre>\n\n<p>I am trying to call it like this:</p>\n\n<pre><code>Me.Database.SqlQuery(Of BOMComponentChild)(\"EXEC [BOMComponentChild] @ComponentID, @PathPrefix, @IsAssembly\", params).ToList()\n</code></pre>\n\n<p>When I run the stored procedure in management studio, the columns are correct and not null. I just can't figure out why these won't map as they are the important information in the stored procedure. The types for PartsPath and MyPath are varchar(50).</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>So I realized the only difference between those columns and the other ones is that they are made with casts. I replaced them in the end select with a static string and they were mapped correctly. When i replaced the last select with the 'test' i get the values are mapped. What is wrong with my CASTs if they are displayed correctly on in a SQL query.</p>\n\n<pre><code>;WITH BuildProducts ( ParentID, ComponentID, PartNumber\n                    ,PartsPath, MyPath, QtyRequired, TotalQty, Layer)\nAS\n(\n    SELECT   ...\n            ,@PathPrefix                        AS PartsPath\n            ,CAST(@PathPrefix +  \n                    CAST(ComponentID            AS varchar(4))  +\n                    '/'                         AS varchar(50)\n                  )                             AS MyPath\n            ,... \n    FROM    [dbo].[BOMComponent]            \n    WHERE   ...\n\n    UNION ALL\n\n    SELECT   ...\n            ,CAST(b.PartsPath + \n                    CAST(a.ParentID             AS varchar(4))  +\n                    '/'                         AS varchar(50)\n                  )                             AS PartsPath\n            ,CAST(b.PartsPath + \n                    CAST(a.ParentID             AS varchar(4))  +\n                    '/'                                         +\n                    CAST(a.ComponentID          AS varchar(4))  +\n                    '/'                         AS varchar(50)\n                  )                             AS MyPath\n            ,...\n    FROM    [dbo].[BOMAssembly]             a \n            INNER JOIN [dbo].[BOMComponent] c ON a.ComponentID = c.ComponentID\n            ...\n)\n\nSELECT  -- t.PartsPath\n        --,t.MyPath\n        'test' As PartsPath\n        ,'test' As MyPath\n        ,...\n\nFROM    BuildProducts                       t \n        ...\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":6,"up_vote_count":18,"down_vote_count":0,"view_count":5427,"score":18,"question_id":4995642,"title":"Add index with entity framework code first (CTP5)","body":"<p>Is there a way to get EF CTP5 to create an index when it creates a schema?</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13151503,"title":"Entity Framework - Store parent reference on child relationship (one -> many)","body":"<p>I have a setup like this:</p>\n\n<pre><code>[Table(\"tablename...\")]\npublic class Branch\n{\n    public Branch()\n    {\n        Users = new List&lt;User&gt;();\n    }\n    [Key]\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public List&lt;User&gt; Users { get; set; }\n}\n\n[Table(\"tablename...\")]\npublic class User\n{\n    [Key]\n    public int Id {get; set; }\n    public string Username { get; set; }\n    public string Password { get; set; }\n    [ForeignKey(\"ParentBranch\")]\n    public int? ParentBranchId { get; set; } // Is this possible?\n    public Branch ParentBranch { get; set; } // ???\n}\n</code></pre>\n\n<p>Is it possible for the User to know what parent branch it belongs to?  The code above does not populate the ParentBranch.</p>\n\n<p>Entity Framework version 5.0\n.NET 4.0\nc#</p>\n"},{"tags":["entity-framework","nhibernate","orm"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1095,"score":1,"question_id":6812865,"title":"Code First Entity Framework Or NHibernate","body":"<p>I'm pretty new to Code First EF 4.1 and NHibernate.\nI need to develop a ORM that must have following features.</p>\n\n<ol>\n<li>Perform CRUD with composite key</li>\n<li>Use Custom SQL Statement for some case.</li>\n<li>Can change connection at run time.</li>\n<li>Can Log SQL Statement before or after execution.</li>\n<li>Need to support Both MS SQL and Oracle.</li>\n</ol>\n\n<p>I'm a bit confuse which one to choose.\nPlease kindly advice.</p>\n"},{"tags":["performance","entity-framework","entity-framework-4","linq-to-entities"],"answer_count":2,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":1136,"score":6,"question_id":5458762,"title":"Entity Framework queries speed","body":"<p>Recently I started to learning Entity Framework.</p>\n\n<p>First question made in my mind is: </p>\n\n<p>When we want to use LINQ to fetching data in EF, every query like this:</p>\n\n<pre><code>var a = from p in contacts select p.name ;\n</code></pre>\n\n<p>will be converts to SQL commands like this :</p>\n\n<pre><code>select name from contacts\n</code></pre>\n\n<ol>\n<li>does this converting repeat every time that we are querying?</li>\n<li>I heard that stored procedures are cached in database, does this event happens in LINQ queries in Entity Framework ?</li>\n</ol>\n\n<p>And at last is my question clear?</p>\n"},{"tags":["javascript","entity-framework","breeze"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13091476,"title":"Uncaught Error: Unable to recognize DataType for: Edm.Self.Address with breezejs","body":"<p>I get the error when trying to use breezejs, the type is a complex type from entity framework (code first).</p>\n\n<p>Uncaught Error: Unable to recognize DataType for: Edm.Self.Address </p>\n\n<p>Are there any workarounds for using complex types with breezejs?.\nfrom my entity framework model:</p>\n\n<pre><code>public class Address\n{\n    public string Id { get; set; }\n    public string Street { get; set; }\n    public string City { get; set; }\n    public string ZipCode { get; set; }\n    public string Contry { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13129512,"title":"Can I exclude an update on a object in entity framework?","body":"<p>I have an object in my entity model ( it is a view in the db getting data over a linked server). Anyways, when I call contex.savechanges(), it updates everything that is changed in the object model. I don't want to update that certain object. Is there a way to exclude that object from updating? I haven't been able to find any properties or methods that would work.</p>\n\n<p>Thanks for any suggestions.\nBrian </p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13158486,"title":"Save stored procedure results in Dataset using Entity Framework","body":"<p>I use this method to query the database to get all the Valuations of a User. A table is returned with multiple rows and columns</p>\n\n<pre><code> public void UserValuationGet()\n {\n    using (FormValueEntities db = new FormValueEntities())\n    {\n      //Query the database for the Valuation\n      var valuation = db.ValuationOfUserGet(userName);         \n    }\n }\n</code></pre>\n\n<p>How can I save the valaution in a Dataset or is there any good tutorial on how to use the Entity Framework Complex types?</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":99,"score":1,"question_id":11508103,"title":"What are the Navigation Properties in Entity Framework","body":"<p>I am new to Entity Framework. When the Visual Studio creates Model diagram we can see mainly two things in Entities.Propertie and Navigation Properties,So what are these Navigation Properties? How to use them?</p>\n"},{"tags":["entity-framework","nhibernate","devexpress","upgrade","xpo"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":909,"score":1,"question_id":10679466,"title":"DevExpress XPO vs NHibernate vs Entity Framework: database upgrading issue","body":"<p>What is the best practice for upgrading the database using <em>ORM</em> (<a href=\"http://www.devexpress.com/Products/NET/ORM/\" rel=\"nofollow\">DevExpress XPO</a>, <a href=\"http://nhforge.org/Default.aspx\" rel=\"nofollow\">NHibernate</a> or <a href=\"http://msdn.microsoft.com/en-us/library/bb399572.aspx\" rel=\"nofollow\">MS Entity Framework</a>)?</p>\n\n<p>I'm starting a new project and have to pick an <em>ORM</em>. The development process requires of releasing intermediate test builds quite often and likely that each build will have changes in the database structure. Each new version has to upgrade the DB gently to keep current data. </p>\n\n<p>For old solutions I would provide a set of SQL scripts for upgrading the database from <em>v1</em> to <em>v2</em>, from <em>v2</em> to <em>v3</em>, etc. and execute them sequentially. </p>\n\n<p>But how is it going to work for <em>ORM</em>? Should I still write SQL scripts to upgrade the DB?</p>\n\n<p>I understand that simple adding new fields wouldn't cause a problem (e.g. see <a href=\"http://documentation.devexpress.com/#XPO/DevExpressXpoSession_UpdateSchematopic\" rel=\"nofollow\">UpdateSchema() method</a> for XPO), but what if I have to split a table and reallocate current records into 2 new tables?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":53,"score":3,"question_id":13130742,"title":"French accent not shown correctly in asp.net MVC view","body":"<p>I have an ASP.Net MVC View receiving a strongly typed model:</p>\n\n<p><code>@model MyApp.Models.MyModel</code></p>\n\n<p>When displaying properties values of this model, </p>\n\n<p>for example: <code>@Html.DisplayFor(model =&gt; model.myFrenchProperty)</code></p>\n\n<p>french characters are not shown correctly in browser.</p>\n\n<p>For example the french word \"Général\" is shown as \"GÃ©nÃ©ral\" in browser.</p>\n\n<p>I have try using @Html.Raw(Model.myFrenchProperty) but nothing change.</p>\n\n<p>My model is built with Entity Framework and data come from an UTF-8 encoded database.</p>\n\n<p>Any idea how to make this work properly?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13156165,"title":"In query in Entity Framework","body":"<p>I am working on Entity frame work, i have created a method which is returning List of my Table,\nI am retrieving data on base of grpID(which is foreign key, so i can have multiple records)\nI have saved these grpID's in an array so I want to run IN command on Entity framework so that i can get records in single List, How can i apply In command,my code is below</p>\n\n<pre><code> public List&lt;tblResource&gt; GetResources(long[] grpid)\n        {\n            try\n            {               \n                return dataContext.tblResource.Where(c =&gt; c.GroupId == grpid &amp;&amp; c.IsActive == true).ToList();//This code is not working as i am having array of groupIds\n\n            }\n            catch (Exception ex)\n            {                \n                return ex;\n            }\n        }\n</code></pre>\n"},{"tags":["asp.net-mvc","linq","entity-framework",".net-3.5"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":671,"score":2,"question_id":4645166,"title":"LINQ parent child relation","body":"<p>I'm working on the BLOG functionality in MVC. I need to be able to create 'blog comments'. So each comment may have a parent comment etc.</p>\n\n<p>Given table \"Comments\":\nCommentId -> int -> identity autoincrement\nPostId -> int\nParentId -> int\nComment -> string</p>\n\n<p><img src=\"http://i.stack.imgur.com/nxi2T.png\" alt=\"alt text\">       </p>\n\n<p>Is there a way to get a list of comments for a given article ordered by CreateDate and ParentId?</p>\n\n<p>Or maybe there is a better table design you may suggest. What is the best design when inserting Post comments like this?</p>\n\n<p>I'm using Entity framework.</p>\n\n<p>thanks</p>\n"},{"tags":["c#","entity-framework","automapper"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13156437,"title":"Mapping a DTO to an Entity with Automapper","body":"<p>I have an Entity Framework POCO with the following structure.</p>\n\n<pre><code>public class Entity\n{\n    public virtual int Id { get; set; }\n    public virtual string Name { get; set; }\n}\n</code></pre>\n\n<p>I've created a Data Transfer Object for this entity to be used by my views.</p>\n\n<pre><code>public class EntityDto\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n}\n</code></pre>\n\n<p>Now, I have the following mapping code in my Global.asax file.</p>\n\n<pre><code>Mapper.CreateMap&lt;Entity, EntityDto&gt;();\nMapper.CreateMap&lt;EntityDto, Entity&gt;(); // not sure whether I need this as well?\n</code></pre>\n\n<p>Everything is working fine, I pass the DTO to my views OK and I can create a new instance of <code>Entity</code> from my <code>EntityDto</code> model. The problem arises when I try to edit my <code>Entity</code>; I'm aware this is down to AutoMapper losing the Entity Key that EF creates to track changes to the object, but having read through a few sources there doesn't seem to be a definitive solution. Here is the action I'm using to edit my entity.</p>\n\n<pre><code>public ActionResult EditEntity(EntityDto model)\n{\n    var entity = context.Entities.Single(e =&gt; e.Id == model.Id);\n    entity = Mapper.Map&lt;EntityDto, Entity&gt;(model); // this loses the Entity Key stuff\n    context.SaveChanges();\n\n    return View(model);\n}\n</code></pre>\n\n<p>Now, what do I do to solve this?  Can I:</p>\n\n<ol>\n<li>Somehow tell AutoMapper to <code>.Ignore()</code> the Entity Key properties?</li>\n<li>Get AutoMapper to copy out the Entity Key properties?</li>\n<li><code>.Attach()</code> my mapped <code>Entity</code> and set the state to modified?</li>\n</ol>\n\n<p>Any help always appreciated.</p>\n"},{"tags":["c#","javascript","asp.net","entity-framework","typescript"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":13139963,"title":"Cannot successfully delete record from the database","body":"<p>Am I doing something wrong? Everything seems to be OK, but the record doesn't get deleted from the database:</p>\n\n<p>C#</p>\n\n<pre><code>    @{\n    WebSecurity.RequireAuthenticatedUser();\n\n    myModel.OSFEntities database = new myModel.OSFEntities();\n\n    var productInformation = Request[\"Pi\"];\n\n    int productId = Convert.ToInt32(productInformation.Substring(0, productInformation.LastIndexOf(\"-\")));\n    string productType = productInformation.Substring(productInformation.LastIndexOf(\"-\", productInformation.Length)).Replace(\"-\", String.Empty);\n    var userId = WebSecurity.CurrentUserId;\n    DateTime date = DateTime.Now;\n    int quantity = 1;\n    string quoteId = \"\";\n\n    if (Request[\"Action\"] == \"Remove\")\n    {\n        if (Session[\"QuoteId\"] != null)\n        {\n            quoteId = (String)Session[\"QuoteId\"];\n\n            myModel.Quote quotes = database.Quotes.FirstOrDefault(\n                q =&gt; q.UserId == userId &amp;&amp; q.QuoteId == quoteId &amp;&amp; q.ProductId == productId &amp;&amp; q.ProductType == productType);\n\n            database.Quotes.DeleteObject(quotes);\n            database.SaveChanges();\n        }\n    }\n}\n</code></pre>\n\n<p>TypeScript:</p>\n\n<pre><code>function RemoveProductFromCart(e) {\n    // Remove from their Cart.\n    xhr.onreadystatechange = function () {\n        if (xhr.readyState == 4) {\n            if (xhr.status == 200) {\n                // The data is now stored in the responseText.\n                // Change value in textbox to 0 so user knows it's been\n                // removed from their cart.\n                var el = &lt;HTMLInputElement&gt;document.getElementById(e.id + \"-TB\");\n                if (el != null) {\n                    el.value = \"0\";\n                }\n            }\n\n            else {\n                // Server responded with a different response code.\n                alert(xhr.statusText);\n            }\n\n        }\n    }\n\n    var parameters = \"Pi=\" + encodeURIComponent(e.id) + \"&amp;\" + \"Action=Remove\";\n\n    xhr.open(\"POST\", \"../Cart.cshtml\");\n    xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n    xhr.setRequestHeader(\"Content-length\", parameters.length.toString());\n    xhr.setRequestHeader(\"Connection\", \"close\");\n    xhr.send(parameters);\n\n    return e.id;\n}\n</code></pre>\n\n<p>While debugging with <kbd>F12</kbd> Dev Tools, I see:</p>\n\n<p><img src=\"http://i.stack.imgur.com/MUURA.png\" alt=\"enter image description here\"></p>\n\n<p>... which leads me to believe that it's something wrong with my C# code. Why won't it delete from the database?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":181,"score":1,"question_id":11973825,"title":"EntityObject 5.x and Self Tracking Entities 5.x","body":"<p>Does anyone know the if/when/where behind the self-tracking entities template for the latest version of EF? Our team would like to move forward to be able to take advantage of the performance improvements that the EF team has documented, but we haven't been able to find any reference to the new T4 templates for self-tracking entities, which we are dependent upon. </p>\n\n<p>We've tried firing up the old template, but the framework has changed too much.</p>\n\n<p>There's a thread on MSDN about it, but it has not been updated in a while. (http://social.msdn.microsoft.com/Forums/en-US/adodotnetentityframework/thread/4993d0bf-94e8-4d14-aff1-3458b4ad467f/#889cc5f1-e267-448a-ae82-e3d705b7dfa5)</p>\n\n<p>Thanks.</p>\n"},{"tags":["linq","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13156693,"title":"Linq Left outer Join with all columns select and bind to Gridview","body":"<p>I am trying to bind grid view with Linq Left outer join (I want to select all columns from \"prdct in context.Products\")My Query is</p>\n\n<pre><code>     gridProducts.DataSource = (from prdct in context.Products\n                                      join comp in context.ProductCompanies\n                                      on prdct.productCompany equals comp.prdctCompId into firstJoin\n                                      from fj in firstJoin.DefaultIfEmpty()\n\n                                      join cat in context.ProductCategories on prdct.productCategory equals cat.prdctCatId\n                                      into finalresult\n                                      from fr in finalresult.DefaultIfEmpty()\n                                      select new\n                                      {\n                                          prd = prdct,\n                                          fj.prdctCompName,\n                                          fr.prdctCatName\n\n                                      }).ToList();\n\n\n            gridProducts.DataBind();\n</code></pre>\n\n<p>I have checked the SQL generated by query it is showing records in SQL server but it throws error in my application while binding to gridveiw. Error is :</p>\n\n<pre><code>   The data source for GridView with id 'grdD' did not have any properties or attributes from which to generate columns.  Ensure that your data source has content.\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13156281,"title":"Using Entity Framework for runtime defined metadata","body":"<p>We are actually analyzing the impact of migrating our current DataBase management system to the Entity Framework. As of today (before the migration), the product gives the ability for the end users to create their own object types within the ASP .Net application from the admin interface. These object types are then translated to DB table creation/deletion/update both for the fields and the tables. Typically, one user can create a new MyCar object type from the end-user interface, create some attributes, and once validated he can then create new values. This is obviously reflected in the database as a new MyCar table, two fields, and new inserts.</p>\n\n<p>The main question I'm having relates to the way Entity Framework can be integrated so that we could as a first step query these tables through Linq queries. I know that ideally we should either use the code-first or the model-first approach but we want to proceed step by step.</p>\n\n<p>After making a few researches it turns out that:</p>\n\n<ol>\n<li>The Entity Framework doesn't provide the ability to directly update the internal metadata</li>\n<li>We could take advantage of the dynamic Type creation so that the Entity Framework would be based on a code-first model (runtime, but still code-first :-)) and the dynamic queyword would allow us to retrieve the attributes through late binding. See this <a href=\"http://www.codeproject.com/Articles/206416/Use-dynamic-type-in-Entity-Framework-4-1-SqlQuery\" rel=\"nofollow\">linq</a>.</li>\n</ol>\n\n<p>Hope that I provided the big picture. Please tell me if I'm missing anything and if the approach described in the second bullet point seems to be the right answer for my problem. One of the challenge is also that fields or types can be created: if I have to go through runtime-created types using reflection I won't be able to do that. In this case I could use appdomains (and recreate a new one whenever I have to do a reset) but this could introduce new issues (accessibility / performance / entity framework incompatiblility with types defined in other appdomains / ...).</p>\n\n<p>I know quite well IQToolkit and I know how I could redefine the metadata at runtime easily without having to introduce .Net types - in this regard IQToolkit could be the prefered solution...</p>\n\n<p>Any suggestion are welcome!</p>\n"},{"tags":["wpf","entity-framework","validation","data-annotation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13156048,"title":"Database first and Wpf Entity Framework validation","body":"<p>I need to validate some user input in a c-sharp wpf desktop application. I'm using Entity framework with database-first approach. This is the class generated from the database by the Entity framework:</p>\n\n<pre><code>namespace TestValidation\n{\n    using System;\n    using System.Collections.Generic;\n\n    public partial class person\n    {\n        public string Name { get; set; }\n        public string Surname { get; set; }\n    }\n}\n</code></pre>\n\n<p>I'm trying to use a buddy class with DataAnnotations to implement validation:</p>\n\n<pre><code>using System.ComponentModel.DataAnnotations;\n\n    namespace TestValidation\n    {\n        [MetadataType(typeof(person_validation))]\n        public partial class person\n        {\n            public class person_validation\n            {\n                [Required]\n                public string Name { get; set; }\n            }\n        }\n    }\n</code></pre>\n\n<p>This is my xaml form:</p>\n\n<pre><code>&lt;Window\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\" xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" xmlns:local=\"clr-namespace:TestValidation\" mc:Ignorable=\"d\" x:Class=\"TestValidation.MainWindow\"\n        Title=\"MainWindow\" Height=\"350\" Width=\"525\" Loaded=\"Window_Loaded_1\"&gt;\n    &lt;Window.Resources&gt;\n        &lt;CollectionViewSource x:Key=\"personViewSource\" d:DesignSource=\"{d:DesignInstance {x:Type local:person}, CreateList=True}\"/&gt;\n    &lt;/Window.Resources&gt;\n    &lt;Grid&gt;\n        &lt;Grid x:Name=\"grid1\" DataContext=\"{StaticResource personViewSource}\" HorizontalAlignment=\"Left\" Margin=\"129,95,0,0\" VerticalAlignment=\"Top\"&gt;\n            &lt;Grid.ColumnDefinitions&gt;\n                &lt;ColumnDefinition Width=\"Auto\"/&gt;\n                &lt;ColumnDefinition Width=\"Auto\"/&gt;\n            &lt;/Grid.ColumnDefinitions&gt;\n            &lt;Grid.RowDefinitions&gt;\n                &lt;RowDefinition Height=\"Auto\"/&gt;\n            &lt;/Grid.RowDefinitions&gt;\n            &lt;Label Content=\"Name:\" Grid.Column=\"0\" HorizontalAlignment=\"Left\" Margin=\"3\" Grid.Row=\"0\" VerticalAlignment=\"Center\"/&gt;\n            &lt;TextBox x:Name=\"nameTextBox\" Grid.Column=\"1\" HorizontalAlignment=\"Left\" Height=\"23\" Margin=\"3\" Grid.Row=\"0\" Text=\"{Binding Name, Mode=TwoWay, NotifyOnValidationError=true, ValidatesOnExceptions=true}\" VerticalAlignment=\"Center\" Width=\"120\"/&gt;\n        &lt;/Grid&gt;\n        &lt;Button Content=\"Button\" HorizontalAlignment=\"Left\" Margin=\"162,217,0,0\" VerticalAlignment=\"Top\" Width=\"75\" Click=\"Button_Click_1\"/&gt;\n\n    &lt;/Grid&gt;\n&lt;/Window&gt;\n</code></pre>\n\n<p>The validation of the property \"Name\" doesn't work. Where is the problem?\nthx</p>\n"},{"tags":["c#","entity-framework","ado.net","mapping","entity-framework-4.1"],"answer_count":3,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":753,"score":6,"question_id":5960522,"title":"Understanding Entity Framework 4.1 Conventions","body":"<p>Are there any decent articles online that explain in detail how the conventions work in EF 4.1?  There was an article linked from Scott Gu's blog, but it was dated 2010, I think it was then in CTP 4.  Not sure if the conventions have beem modified since then.  But I don't understand how it works.  For example how does it know to use the table SkillType if I have this code (what does it look for?):</p>\n\n<pre><code>public DbSet&lt;SkillType&gt; SkillTypes { get; set; }\n</code></pre>\n\n<p>This is just 1 of my confusions, then there is foreign keys, primary keys, etc.  I need to familiarise myself with these conventions so any goof articles that I can read please let me know.  I did Google and couldn't get anything solid and concrete.</p>\n"},{"tags":["entity-framework","postgresql","devart","dotconnect"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13147330,"title":"How to query an Entity Framework entity for null field value with DotConnect for PostgreSQL","body":"<p>I observe a strange behavior when querying for null field an Entity Framework entity with the Devart DotConnect for PostgreSQL connector.</p>\n\n<p>For example: If I made the 2 following tests:</p>\n\n<pre>\nvar test1 = context.blocs.Where(x => x.id_bloc == null);\n\nvar test2 = context.blocs.Where(x => x.id_bloc == 100);\n</pre>\n\n<p>When checking for EF auto-generated SQL query I obtain the following results:</p>\n\n<p>Result for test1:</p>\n\n<pre>\n{SELECT \n CAST(NULL AS int) AS \"C1\",\n CAST(NULL AS varchar) AS \"C2\",\n CAST(NULL AS varchar) AS \"C3\",\n CAST(NULL AS varchar) AS \"C4\"\nFROM  ( SELECT 1 AS X) AS \"SingleRowTable1\"\nWHERE true = false}\n</pre>\n\n<p>Result for test2:</p>\n\n<pre>\n{SELECT \n\"Extent1\".id_bloc,\n\"Extent1\".numero,\n\"Extent1\".nom,\n\"Extent1\".titre\nFROM \"role\".bloc AS \"Extent1\"\nWHERE \"Extent1\".id_bloc = 100}\n</pre>\n\n<p>The result when querying for null field is very strange... I was expecting a result similar to the test 2 result but with an <code>\"Extent1\".id_bloc IS NULL</code> WHERE clause...</p>\n\n<p>Is it a bug? How can I effectively query for null field?</p>\n"},{"tags":["entity-framework","parent-child"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13148585,"title":"Entity Framework - Add Child Entity","body":"<p>Entity Framework 5.0 Code first with existing database.  Reverse engineered the classes with power tools.  Everything is working great.  Database has two tables.  One parent and one child with foreign key back to parent ID.  ID's are all int with auto increment.  I've added a number of parent records and now want to add child records to specific parents.  The only way I can see to do this is find the appropriate parent ID by searching the Parents table for a name or some other property and return the ID.  Then use that ID in the foreign key property when adding the child.  I don't want to crate a new parent so is this the only way to add a child to an existing parent?  All of the internet examples seem to add a child along with adding a new parent and not add a child to an existing parent.  Any help would be greatly appreciated</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13151773,"title":"EF4.1 eager loading query","body":"<p>I am using EF to implement a search function to search cars on a website. It's working fine, but I would like to optimise performance.\nCars have a make and model, and a number of images.\nIt's easy enough to include the make and model using .Include(), but I am having trouble with the images... at the moment, the main query is being executed, and then EF queries the db for each search result to get the images. I'd like to include this all in the one query.\nI can use .Include(), but that obviously loads all images, and I actually only want one (any) image. Is there a way of doing this?</p>\n\n<p>Thanks heaps!</p>\n"},{"tags":["c#","xml","entity-framework","asp.net-mvc-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13137800,"title":"Import a remote XML file into MVC 4 Webapp","body":"<p>I have a webapp that needs to import 3 different remote XML files every night. These files have student and parent information, study information, etc.</p>\n\n<p>Can someone point me to information how to read the XML (via http) and then loop over every student so I can add information from the other XML files and store the relations into my database?</p>\n\n<p>Need some example code like:</p>\n\n<ul>\n<li>Open &amp; read Parents XML and store in database with fixed Ids from XML file</li>\n<li>Open &amp; read Students XML and store in database AND link to their respective parents using the parent id's from the parent XML</li>\n<li>Also store study information for every student</li>\n</ul>\n\n<p>I need to know what my strategy would be. What would the smartest and most efficient method be to accomplish this using Entity Framework? </p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13134763,"title":"Generic repository constructor","body":"<p>I am trying to work with generic repositories in entity framework and came across this code below:</p>\n\n<pre><code>public class GenericRepository&lt;TContext, TEntity&gt; : IGenericRepository&lt;TEntity&gt;\nwhere TContext : IUnitOfWork\nwhere TEntity : class\n{\nprotected TContext _context;\n/// &lt;summary&gt;\n/// Constructor that takes a context\n/// &lt;/summary&gt;\n/// &lt;param name=\"context\"&gt;An established data context&lt;/param&gt;\npublic GenericRepository(TContext context)\n{\n    _context = context;\n}\n\npublic IQueryable&lt;TEntity&gt; Select()\n{\n    return _context.Set&lt;TEntity&gt;().AsQueryable();\n}\n\npublic IEnumerable&lt;TEntity&gt; GetAll()\n{\n    return _context.Set&lt;TEntity&gt;().AsEnumerable();\n}\n\npublic IEnumerable&lt;TEntity&gt; Where(Func&lt;TEntity, bool&gt; predicate)\n{\n    return _context.Set&lt;TEntity&gt;().Where(predicate);\n}\n\npublic TEntity GetSingle(Func&lt;TEntity, bool&gt; predicate)\n{\n    return _context.Set&lt;TEntity&gt;().Single(predicate);\n}\n\npublic TEntity GetFirst(Func&lt;TEntity, bool&gt; predicate)\n{\n    return _context.Set&lt;TEntity&gt;().First(predicate);\n}\n\npublic void Add(TEntity entity)\n{\n    if (entity == null)\n        throw new ArgumentException(\"Cannot add a null entity\");\n\n    _context.Set&lt;TEntity&gt;().Add(entity);\n}\n\npublic void Delete(TEntity entity)\n{\n    if (entity == null)\n        throw new ArgumentException(\"Cannot delete a null entity\");\n\n    _context.Set&lt;TEntity&gt;().Remove(entity);\n}\n\npublic void Attach(TEntity entity)\n{\n    if (entity == null)\n        throw new ArgumentException(\"Cannot attach a null entity\");\n\n    _context.Set&lt;TEntity&gt;().Attach(entity);\n}\n\n#region IDisposable implementation\nprivate bool disposedValue;\n\npublic void Dispose(bool disposing)\n{\n    if (!this.disposedValue)\n    {\n        if (disposing)\n        {\n            // dispose managed state here if required\n        }\n        // dispose unmanaged objects and set large fields to null\n    }\n    this.disposedValue = true;\n}\n\npublic void Dispose()\n{\n    Dispose(true);\n    GC.SuppressFinalize(this);\n}\n#endregion\n }\n</code></pre>\n\n<p>However I find it a little difficult to understand the need for the constructor created</p>\n\n<pre><code>/// &lt;summary&gt;\n/// Constructor that takes a context\n/// &lt;/summary&gt;\n/// &lt;param name=\"context\"&gt;An established data context&lt;/param&gt;\npublic GenericRepository(TContext context)\n{\n    _context = context;\n}\n</code></pre>\n\n<p>Can someone please explain the use of this? </p>\n\n<p>Thanks</p>\n"},{"tags":[".net","entity-framework","dependency-injection","unit-of-work","ef-database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13151086,"title":"Entity Framework 4.1 Database First Dependency Injection Unit of Work","body":"<p>Ok, there are tons of examples using unit of work with dependency injection for Code First, using generic repositories and all that good stuff.</p>\n\n<p>Does anyone have an example doing this with Database First (edmx with dbContext Generator (T4)), Stored Procedures as Function Imports, Unit of Work with dependency injection. </p>\n"},{"tags":["c#","jquery","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":58,"score":3,"question_id":13148577,"title":"ASP.NET MVC 3 NOT showing appropriate view, action called using jquery","body":"<p>I have a small problem.</p>\n\n<p>My action is :</p>\n\n<pre><code> public ViewResult SearchForRooms(int HotelDDL) \n    {\n\n        List&lt;Room&gt; roomsInHotel = bl.ReturnRoomsPerHotel(HotelDDL);\n\n        return View(roomsInHotel);\n    }\n</code></pre>\n\n<p>Here is the jquery that is calling the action:</p>\n\n<pre><code>&lt;script type=\"text/javascript\" language=\"javascript\"&gt;\n    $(document).ready(function () {\n        $(\"#HotelDDL\").change(function () {\n\n            var text = $(\"#HotelDDL option:selected\").text();\n            var value = $(\"#HotelDDL option:selected\").val();\n            alert(\"Selected text=\" + text + \" Selected value= \" + value);\n\n            $.post(\"/Home/SearchForRooms\",\n            {\n                HotelDDL: $(\"#HotelDDL option:selected\").val() \n            });\n        });\n    });\n&lt;/script&gt;\n</code></pre>\n\n<p>And finally, here is the View that should be called:</p>\n\n<pre><code>@model IEnumerable&lt;RoomReservation.Entities.Entities.Room&gt;\n\n@{\n    ViewBag.Title = \"Search\";\n}\n\n&lt;h2&gt;Result&lt;/h2&gt;\n\n&lt;table&gt;\n    &lt;tr&gt;\n        &lt;th&gt;\n            City\n        &lt;/th&gt;\n        &lt;th&gt;\n            Hotel\n        &lt;/th&gt;\n        &lt;th&gt;\n            Room label\n        &lt;/th&gt;\n        &lt;th&gt;\n            Number of beds\n        &lt;/th&gt;\n        &lt;th&gt;\n            Price per night\n        &lt;/th&gt;\n        &lt;th&gt;&lt;/th&gt;\n    &lt;/tr&gt;\n\n@foreach (var item in Model) {\n    &lt;tr&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelitem=&gt;item.Hotel.City.Name)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelItem =&gt; item.Hotel.Name)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelItem =&gt; item.Name)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelItem =&gt; item.NumberOfBeds)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelItem =&gt; item.PricePerNight)\n        &lt;/td&gt;\n    &lt;/tr&gt;\n}\n&lt;/table&gt;\n</code></pre>\n\n<p>Everthing is working ok (databse return all rooms correctly) except final view rendering.\nI have tried Phil's tool but it doesn't give me any suspicious hints:</p>\n\n<pre><code>RouteDebug.RouteDebugger.RewriteRoutesForTesting(RouteTable.Routes);\n</code></pre>\n\n<p>So, why is it not showing after jscript send it's post method to <code>SearchForRooms()</code>?\nThank you</p>\n\n<p>P.S. If you need any other piece of code please just say so.</p>\n"},{"tags":[".net","linq","entity-framework","many-to-many","expression-trees"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":13102342,"title":"Build a nested lambda Expression Tree for an Entity Framework Many to Many relationship?","body":"<p>I am trying to build an Entity Framework 4 Many to Many relationship filter, this is for a Dynamic Data project.  I know that I need to build an Expression Tree at run time, and I am familiar with doing this for something like a simple where expression like this:</p>\n\n<pre><code>private MethodCallExpression BuiltMethodCall(IQueryable _query, Type _ObjType, string _ColumnToSearch, string _SearchValue)\n{\nConstantExpression value = Expression.Constant(_SearchValue);\nParameterExpression _parameter = Expression.Parameter(_ObjType, \"value\");\nMemberExpression _property = Expression.Property(_parameter, _ColumnToSearch);\nBinaryExpression comparison = Expression.Equal(_property, value);\nLambdaExpression lambda = Expression.Lambda(comparison, _parameter);\n\n//Ex: Customers.Select(c =&gt; c).Where(value =&gt; (value.City == \"Seattle\"))\nMethodCallExpression _where = Expression.Call(typeof(Queryable), \"Where\", new Type[] { _query.ElementType }, new Expression[] {\n    _query.Expression,\n    Expression.Quote(lambda)\n});\nreturn _where;\n\n}\n</code></pre>\n\n<p>Just for simplicity, these examples use the Northwind database where there is a many to many join of (Customers &lt;- CustomerCustomerDemo -> CustomerDemographics). What I am having trouble with is building the expression tree when there is a nested lambda like in the expression below, where I am retrieving all customers who have a specific customer demographic.</p>\n\n<pre><code>string custDemogID = \"3\";\n\n//Get customers who have a particular demog\ndynamic cust = context.Customers.Where(c =&gt; c.CustomerDemographics.Any(cd =&gt; cd.CustomerTypeID == custDemogID));\n</code></pre>\n\n<p>How do I build the Expression tree having a \"where\" call, that includes the nested lambda for the \"Any\"?  Any help is appreciated, even if it is pseudo code on how to do it.  There is not much out the on this, I am desperate, please help!</p>\n"},{"tags":["entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":10445111,"title":"What's the best way to compare a list<int> with the database table id column","body":"<p>I have a <code>List&lt;int&gt;</code> collection which contains ids, I want to query out all the records in one database table which id in the collection.</p>\n\n<p>I know I can write a method to traverse the collection and write linq to entities like <code>from t in context.table where t.id=id select t</code>, but it means I must hit database as many times as how many ids in the collection, it obviously isn't what I want.</p>\n\n<p>Anyone can help?\nThx in advance!</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":585,"score":0,"question_id":10789028,"title":"Could not load file or assembly 'MySite (from [Computername])' or one of its dependencies. (Exception from HRESULT: 0x80131040)","body":"<p><strong>Hi,</strong></p>\n\n<p>When running my ASP.NET MVC application (using VS mini IIS) I get the following exception after updating table in the EnityFrameworkModel:</p>\n\n<pre><code>Server Error in '/' Application.\n\nCould not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.IO.FileLoadException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)\n\nSource Error: \n\nAn unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n\nAssembly Load Trace: The following information can be helpful to determine why the assembly 'myApp (from my-pc)' could not be loaded.\n\n\n=== Pre-bind state information ===\nLOG: User = my-PC\\my\nLOG: DisplayName = myApp (from my-pc)\n (Partial)\nWRN: Partial binding information was supplied for an assembly:\nWRN: Assembly Name: myApp (from my-pc) | Domain ID: 4\nWRN: A partial bind occurs when only part of the assembly display name is provided.\nWRN: This might result in the binder loading an incorrect assembly.\nWRN: It is recommended to provide a fully specified textual identity for the assembly,\nWRN: that consists of the simple name, version, culture, and public key token.\nWRN: See whitepaper http://go.microsoft.com/fwlink/?LinkId=109270 for more information and common solutions to this issue.\nLOG: Appbase = file:///C:/Users/my/Documents/Visual Studio 2010/Projects/myApp/myApp.Website/\nLOG: Initial PrivatePath = C:\\Users\\my\\Documents\\Visual Studio 2010\\Projects\\myApp\\myApp.Website\\bin\nCalling assembly : (Unknown).\n===\nLOG: This bind starts in default load context.\nLOG: Using application configuration file: C:\\Users\\my\\Documents\\Visual Studio 2010\\Projects\\myApp\\myApp.Website\\web.config\nLOG: Using host configuration file: \nLOG: Using machine configuration file from C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\config\\machine.config.\nLOG: Policy not being applied to reference at this time (private, custom, partial, or location-based assembly bind).\nLOG: Attempting download of new URL file:///C:/Windows/Microsoft.NET/Framework/v4.0.30319/Temporary ASP.NET Files/root/9ac245ea/5244fde2/myApp (from my-pc).DLL.\nLOG: Attempting download of new URL file:///C:/Windows/Microsoft.NET/Framework/v4.0.30319/Temporary ASP.NET Files/root/9ac245ea/5244fde2/myApp (from my-pc)/myApp (from my-pc).DLL.\nLOG: Attempting download of new URL file:///C:/Users/my/Documents/Visual Studio 2010/Projects/myApp/myApp.Website/bin/myApp (from my-pc).DLL.\nWRN: Comparing the assembly name resulted in the mismatch: NAME\nERR: Failed to complete setup of assembly (hr = 0x80131040). Probing terminated.\n\nStack Trace: \n\n\n[FileLoadException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) +0\n   System.Reflection.RuntimeAssembly.nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) +39\n   System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection, Boolean suppressSecurityChecks) +132\n   System.Reflection.RuntimeAssembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection) +144\n   System.Reflection.Assembly.Load(String assemblyString) +28\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +46\n\n[ConfigurationErrorsException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +618\n   System.Web.Configuration.CompilationSection.LoadAllAssembliesFromAppDomainBinDirectory() +209\n   System.Web.Configuration.CompilationSection.LoadAssembly(AssemblyInfo ai) +130\n   System.Web.Compilation.BuildManager.GetReferencedAssemblies(CompilationSection compConfig) +178\n   System.Web.Compilation.BuildManager.GetPreStartInitMethodsFromReferencedAssemblies() +94\n   System.Web.Compilation.BuildManager.CallPreStartInitMethods() +332\n   System.Web.Hosting.HostingEnvironment.Initialize(ApplicationManager appManager, IApplicationHost appHost, IConfigMapPathFactory configMapPathFactory, HostingEnvironmentParameters hostingParameters, PolicyLevel policyLevel, Exception appDomainCreationException) +677\n\n[HttpException (0x80004005): Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Web.HttpRuntime.FirstRequestInit(HttpContext context) +9090876\n   System.Web.HttpRuntime.EnsureFirstRequestInit(HttpContext context) +97\n   System.Web.HttpRuntime.ProcessRequestInternal(HttpWorkerRequest wr) +258\n\nVersion Information: Microsoft .NET Framework Version:4.0.30319; ASP.NET Version:4.0.30319.272\n</code></pre>\n\n<p>This is what I have tried : </p>\n\n<ul>\n<li>Clean solution</li>\n<li>Stopd the mini IIS and restart</li>\n<li>Restarted Windows</li>\n</ul>\n\n<p>But I do still gott this problem?</p>\n\n<p>Edit1: </p>\n\n<p>When re-running I now get this : </p>\n\n<pre><code>    Server Error in '/' Application.\n\nCould not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.IO.FileLoadException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)\n\nSource Error: \n\nAn unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n\nAssembly Load Trace: The following information can be helpful to determine why the assembly 'myApp (from my-pc)' could not be loaded.\n\n\nWRN: Assembly binding logging is turned OFF.\nTo enable assembly bind failure logging, set the registry value [HKLM\\Software\\Microsoft\\Fusion!EnableLog] (DWORD) to 1.\nNote: There is some performance penalty associated with assembly bind failure logging.\nTo turn this feature off, remove the registry value [HKLM\\Software\\Microsoft\\Fusion!EnableLog].\n\nStack Trace: \n\n\n[FileLoadException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) +0\n   System.Reflection.RuntimeAssembly.nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) +39\n   System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection, Boolean suppressSecurityChecks) +132\n   System.Reflection.RuntimeAssembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection) +144\n   System.Reflection.Assembly.Load(String assemblyString) +28\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +46\n\n[ConfigurationErrorsException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +618\n   System.Web.Configuration.CompilationSection.LoadAllAssembliesFromAppDomainBinDirectory() +209\n   System.Web.Configuration.CompilationSection.LoadAssembly(AssemblyInfo ai) +130\n   System.Web.Compilation.BuildManager.GetReferencedAssemblies(CompilationSection compConfig) +178\n   System.Web.Compilation.BuildManager.GetPreStartInitMethodsFromReferencedAssemblies() +94\n   System.Web.Compilation.BuildManager.CallPreStartInitMethods() +332\n   System.Web.Hosting.HostingEnvironment.Initialize(ApplicationManager appManager, IApplicationHost appHost, IConfigMapPathFactory configMapPathFactory, HostingEnvironmentParameters hostingParameters, PolicyLevel policyLevel, Exception appDomainCreationException) +677\n\n[HttpException (0x80004005): Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Web.HttpRuntime.FirstRequestInit(HttpContext context) +9090876\n   System.Web.HttpRuntime.EnsureFirstRequestInit(HttpContext context) +97\n   System.Web.HttpRuntime.ProcessRequestInternal(HttpWorkerRequest wr) +258\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12922962,"title":"Rename table with Code First in Entity Framework","body":"<p>Does anyone knows if it is possible to <em>just</em> rename a database table with <code>Code First</code> in <code>Entity Framework 5</code>?</p>\n\n<p>I just have simple models and a database initializer, but since my database already contains data I've commented that initializer out. So, I <strong>don't</strong> want to <code>drop</code> and <code>create</code> a whole new database.</p>\n\n<p>When I add new columns to such a model I use the <code>Package Manager Console</code> and run <code>update-database</code>. to update my database. Does this also work for renaming tables? Does the <code>update-database</code> command automatically knows what the old name was?</p>\n\n<p>I don't have a lot of experience with CF yet and learning new stuff every day. Without CF it's 'easy' to just run an <code>alter table</code> command and refresh the dbml file... But with CF? I don't have a clue!</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13127781,"title":"SqlQuery against unknown (at compile time) type","body":"<p>I have an application where I have a list of database queries to execute.</p>\n\n<p>I know its possible to do something like:</p>\n\n<pre><code>var results = _db.Contacts.SqlQuery( sQuery );\n</code></pre>\n\n<p>and like: </p>\n\n<pre><code>var results = _db.Database.SqlQuery&lt;Contacts&gt;( sQuery );\n</code></pre>\n\n<p>But in my situation, I'm working only with metadata.  How can I do something like this:</p>\n\n<pre><code>string sBaseType = \"Contacts\";\nvar results = _db.Database.SqlQuery&lt;sBaseType&gt;( sQuery );\n</code></pre>\n\n<p>I had some success with <code>&lt;object&gt;</code>...it returned all the rows I expected it to, but its not in a very usable form.  Whats the best way to handle this variety of dynamic query?</p>\n\n<p>Edit -- \nWhat I'm hoping to find, is some mechanism rather like this:</p>\n\n<pre><code>var results = _db.Database[sBaseType].SqlQuery( sQuery );\n</code></pre>\n\n<p>So that I can avoid a construction that looks like :</p>\n\n<pre><code>if (sBaseType == \"Contacts\") {\n    var results = _db.Contacts.SqlQuery( sQuery );\n} else if  (sBaseType == \"Buildings\") {\n    var results = _db.Buildings.SqlQuery( sQuery );\n} else if  (sBaseType == \"Rooms\") {\n    var results = _db.Rooms.SqlQuery( sQuery );\n} else if  (sBaseType == \"Equipment\") {\n    var results = _db.Equipment.SqlQuery( sQuery );\n}\n</code></pre>\n\n<p>I don't need anything particularly fancy...I just am hoping to save building up a 100+ element if-elseif block...</p>\n"},{"tags":["asp.net","entity-framework","webforms","poco"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":62,"score":5,"question_id":13091075,"title":"Need example of a web form editing a parent entity object with children","body":"<p>I'm working on an \"edit\" page for an object.  On this page, I would like to have something like a DetailsView allowing editing of properties of the object as well as a GridView with children and allowing for simple Add/Edit/Delete of the children.  The updates to the parent or child objects shouldn't save to the database until a Save button is clicked.  I'm asp.net web forms and Entity Framework</p>\n\n<p>As a simple example, imagine a Project object with a collection of Resources.  I am building a page that allows a user to change Project properties such as ProjectName in a DetailsView as well as add/edit/deleting a Resource in a Gridview below.  One Save button at the bottom saves everything.</p>\n\n<p>I've found examples of this in MVC, but am having trouble finding a web forms example.  </p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":4159,"score":10,"question_id":4641251,"title":"Entity Framework Delete All on Submit","body":"<p>In LINQ to SQL, I could do: </p>\n\n<pre><code>context.User_Roles.DeleteAllOnSubmit(context.User_Roles.Where(ur =&gt; ur.UserId == user.UserId));\n</code></pre>\n\n<p>Whats the equivalent to this for entity framework?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13143874,"title":"Code-First MetaData","body":"<p>What should I use as MetaData while I'm using <strong>Code-First</strong> Approach\nvia <strong>EntityConnectionStringBuilder</strong></p>\n\n<pre><code>EntityConnectionStringBuilder entityBuilder;\nentityBuilder.MetaData = ??  // Metadata = @\"res://*/;\";\n</code></pre>\n\n<p>I got this error :</p>\n\n<pre><code>{\"The specified metadata path is not valid. A valid path must be either an existing directory, an existing file with extension '.csdl', '.ssdl', or '.msl', or a URI that identifies an embedded resource.\"}\n</code></pre>\n\n<ul>\n<li><p>I didn't make any model on this approach, As I thought it isn't needed.</p></li>\n<li><p>All I want is to do everything programmatically.</p></li>\n<li><p>Everything was working fine in Database-First Approach.</p></li>\n<li><p>Here I made the Connection String and passed it to the Context.</p></li>\n<li><p>The EF Version is 5.0. </p></li>\n<li><p>The database is existed.</p></li>\n<li><p>Should I use any thing else to avoid <code>MetaData</code> Checking, such as\ninitializers or ??</p></li>\n</ul>\n"},{"tags":["entity-framework","code-first-migrations"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":215,"score":4,"question_id":11105483,"title":"Add-Migration command fails with \"type is not resolved\"(where \"type\" is inner entity framework class) ","body":"<p>I have already used an entity framework with separate migration package(for 3.5 or 4.0, don't remember), and with included migrations api(4.3, 5.0).</p>\n\n<p>But today i have created a new project(empty MVC4.0 project), install latest stable EF(4.3) and recieve error below on the \"pm > Add-Migration initital\" command</p>\n\n<pre><code>System.Runtime.Serialization.SerializationException: Type is not resolved for member 'System.Data.Entity.Migrations.Design.ToolingFacade+GetPendingMigrationsRunner,EntityFramework    , Version=4.3.1.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.\n   at System.AppDomain.DoCallBack(CrossAppDomainDelegate callBackDelegate)\n   at System.Data.Entity.Migrations.Design.ToolingFacade.Run(BaseRunner runner)\n   at System.Data.Entity.Migrations.Design.ToolingFacade.GetPendingMigrations()\n   at System.Data.Entity.Migrations.AddMigrationCommand.&lt;&gt;c__DisplayClass2.&lt;.ctor&gt;b__0()\n   at System.Data.Entity.Migrations.MigrationsDomainCommand.Execute(Action command)\n</code></pre>\n\n<p>Then i am trying to switch to EF5.0 and an error still here, with one difference in a version:</p>\n\n<pre><code>System.Runtime.Serialization.SerializationException: Type is not resolved for member 'System.Data.Entity.Migrations.Design.ToolingFacade+GetPendingMigrationsRunner,EntityFramework      , Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.\n</code></pre>\n\n<p>It is first time when i recieve this error. The<br>\n    \"System.Data.Entity.Migrations.Design.ToolingFacade\" class exists and the \"GetPendingMigrationsRunner \" subclass in it also exists in a referenced EntityFramework assembly.</p>\n\n<p>Anyone knows what may cause an error? Migrations works ok for another project on MVC4.0, on those i have choosen standart(not empty) project template.</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities","entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13144622,"title":"Linq query syntax to method syntax when using multiple joins to introduce dynamic restrictions","body":"<p>I'm trying to translate a linq query using query keywords to the method syntax.\nMy ultimate goal is to be able to apply additonnal restrictions at runtime each time you see a <strong>Where</strong> clause in the query. I have a total of 14 different parameters to be applied. Some are mutually exclusive, other are inclusive.</p>\n\n<p>Here is the starting query :</p>\n\n<pre><code>query = from p in context.Person\nwhere p.Firstname.ToUpper().StartsWith(firstName.ToUpper())\njoin v in context.Visit on p.Id equals v.PersonId\nwhere !v.AccessionNumber.StartsWith(RISConst.PM_PREFIX)\njoin f in context.Finding on v.Id equals f.VisitId\njoin c in context.Consultation on f.Id equals c.FindingId\nwhere c.StudyId.ToUpper().CompareTo(studyId.ToUpper()) == 0\nselect v;\n</code></pre>\n\n<p>Using Jon Skeet's <a href=\"http://msmvps.com/blogs/jon_skeet/archive/2011/01/28/reimplementing-linq-to-objects-part-41-how-query-expressions-work.aspx\" rel=\"nofollow\">excellent blog post</a> I have been able to go that far :</p>\n\n<pre><code>query = context.Person.Where(p =&gt; p.Firstname.ToUpper().StartsWith(firstName.ToUpper()))\n.Join(context.Visit, p =&gt; p.Id, v =&gt; v.Id, (p, v) =&gt; new { p, v })\n.Where(z =&gt; z.v.AccessionNumber.StartsWith(RISConst.PM_PREFIX))\n.Select(z =&gt; z.v)\n.Join(context.Finding, v =&gt; v.Id, f =&gt; f.VisitId, (v, f) =&gt; new { v, f })\n.Select(t =&gt; t.f)\n.Join(context.Consultation, f =&gt; f.Id, c =&gt; c.FindingId, (f, c) =&gt; new { f, c })\n.Where( u =&gt; u.c.StudyId.ToUpper().CompareTo(studyId.ToUpper()) == 0)\n.Select(????);\n</code></pre>\n\n<p>Now I'm stuck because I need to return Visits. How can I do that ?</p>\n\n<p>Any Help appreciated.</p>\n"},{"tags":["c#","linq","entity-framework","repository","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13143268,"title":"How to include complex entity fields in a projected entity framework object?","body":"<p>I often use the <code>System.Data.Entity.DbExtensions</code> <code>Include()</code> method to cause complex entity fields to be included in query results from my repositories.  However, when I project my entities into new classes, I seem to lose this \"concretization\" of included complex entity fields.  For example, say I wanted to return an <code>Event</code> object from my repo, and be able to access the complex entity field <code>Assessment</code>:</p>\n\n<pre><code>public class EventRepository {\n...\n    public IList&lt;Event&gt; GetEvents() {\n        using (var context = new MyDatabaseContext()) {\n            return context.Events\n                .Include(evnt =&gt; evnt.ActualAssessment)\n                .ToList();\n        }\n    }\n...\n}\n</code></pre>\n\n<p>I can then run the following code without a hitch because of the <code>Include</code> I used above:</p>\n\n<pre><code>var repoEvents = new EventRepository();\nvar events = repoEvents.GetEvents();\nConsole.WriteLine(events[0].ActualAssessment.AssessmentDate.ToString());\n</code></pre>\n\n<p>But say I now want to project the <code>Event</code>s into a wrapper object <code>ExtendedEvent</code> with some extra info, like this:</p>\n\n<pre><code>public class EventRepository {\n...\n    public IList&lt;ExtendedEvent&gt; GetExtendedEvents() {\n        using (var context = new MyDatabaseContext()) {\n            return context.Events\n                .Include(evnt =&gt; evnt.ActualAssessment)\n                .Select(evnt =&gt; new {\n                    TheEvent = evnt,\n                    SomeExtraData = 123\n                })\n                .ToList()\n                .Select(evntInfo =&gt; {\n                    return new ExtendedEvent {\n                        TheEvent = evntInfo.TheEvent,\n                        SomeExtraData = evntInfo.SomeExtraData\n                    };\n                })\n                .ToList();\n        }\n    }\n...\n}\n</code></pre>\n\n<p>I now try and run this code:</p>\n\n<pre><code>var repoEvents = new EventRepository();\nvar extendedEvents = repoEvents.GetExtendedEvents();\nConsole.WriteLine(extendedEvents[0].TheEvent.ActualAssessment.AssessmentDate.ToString());\n</code></pre>\n\n<p>This gives me the error \"The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.\" - so <code>ActualAssessment</code> has not been eager-loaded despite my use of <code>Include</code>, apparently because I projected it into a new wrapper object.  How can I cause <code>ActualAssessment</code> to be included?</p>\n"},{"tags":["asp.net","asp.net-mvc","entity-framework","asp.net-mvc-4","simplemembership"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1060,"score":3,"question_id":12254701,"title":"SimpleMembershipProvider not working","body":"<p>I started a new internet project with VS2012 and am trying to just restructure my project a bit and I can't seem to keep the SimpleMemberhsipProvider working.  Basically, all I've done is move the models objects into a core project along with a couple other items.  I've implemented Ninject and am trying to abstract Entity a bit by using a repository pattern to get my data.  I really don't feel as though I've changed much with the current project, but for some reason when I start the application now I get:</p>\n\n<blockquote>\n  <p>{\"The Role Manager feature has not been enabled.\"}</p>\n</blockquote>\n\n<p>The ActionFilter that is supplied by the framework is where the error is thrown when:</p>\n\n<blockquote>\n  <p>WebSecurity.InitializeDatabaseConnection(\"DefaultConnection\", \"UserProfile\", \"Id\", \"UserName\", autoCreateTables: true); </p>\n</blockquote>\n\n<p>is called. </p>\n\n<p>Here is some of the stacktrace:</p>\n\n<blockquote>\n  <p>[ProviderException: The Role Manager feature has not been enabled.]<br>\n  System.Web.Security.Roles.EnsureEnabled() +9561885<br>\n  System.Web.Security.Roles.get_Provider() +8<br>\n  WebMatrix.WebData.WebSecurity.InitializeProviders(DatabaseConnectionInfo\n  connect, String userTableName, String userIdColumn, String\n  userNameColumn, Boolean autoCreateTables) +104<br>\n  WebMatrix.WebData.WebSecurity.InitializeDatabaseConnection(String\n  connectionStringName, String userTableName, String userIdColumn,\n  String userNameColumn, Boolean autoCreateTables) +100<br>\n  InoutBoard.Core.Infrastructure.Filters.SimpleMembershipInitializer..ctor()\n  in c:\\Users\\Kyle\\Documents\\Visual Studio\n  2012\\Projects\\InoutBoard\\InoutBoard.Core\\Infrastructure\\Filters\\InitializeSimpleMembershipAttribute.cs:42</p>\n  \n  <p>[InvalidOperationException: The ASP.NET Simple Membership database\n  could not be initialized. For more information, please see\n  http://go.microsoft.com/fwlink/?LinkId=256588]<br>\n  InoutBoard.Core.Infrastructure.Filters.SimpleMembershipInitializer..ctor()\n  in c:\\Users\\Kyle\\Documents\\Visual Studio\n  2012\\Projects\\InoutBoard\\InoutBoard.Core\\Infrastructure\\Filters\\InitializeSimpleMembershipAttribute.cs:46</p>\n</blockquote>\n\n<p>I'm hosting the code on github at the following link <a href=\"https://github.com/keroger2k/InoutBoard\" rel=\"nofollow\">https://github.com/keroger2k/InoutBoard</a></p>\n"},{"tags":["c#","wpf","entity-framework","serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13142992,"title":"Deep Clone Entity Without Serialization","body":"<p>I need to deep clone an Entity (To use an existing Entity as pattern for a new one). I found several approaches, but all include Serialization. Since our Entities derive from ObservableObject of the MVVM Toolkit that is not Serializeable we can't use those approaches.</p>\n\n<p>What would be the best way to do so?</p>\n\n<p>We are usinng .net 4.5 and EF5 and WPF.</p>\n"},{"tags":["c#","database","linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13138243,"title":"Entity Framework: Linq query finds entries by original data but returns reference to changed entry","body":"<p>I just spent some days now to find a bug caused by some strange behavior of the Entity Framework (version 4.4.0.0). For an explanation I wrote a small test program. At the end you'll find some questions I have about that.</p>\n\n<h2>Declaration</h2>\n\n<p>Here we have a class \"Test\" which represents our test dataset. It only has an ID (primary key) and a \"value\" property. In our TestContext we implement a DbSet Tests, which shall handle our \"Test\" objects as a database table.</p>\n\n<pre><code>public class Test\n{\n    public int ID { get; set; }\n    public int value { get; set; }\n}\n\npublic class TestContext : DbContext\n{\n    public DbSet&lt;Test&gt; Tests { get; set; }\n}\n</code></pre>\n\n<h2>Initialization</h2>\n\n<p>Now, we remove any (if existent) entries from our \"Tests\" table and add our one and only \"Test\" object. It has ID=1 (primary key) and value=10.</p>\n\n<pre><code>// Create a new DBContext...\nTestContext db = new TestContext();\n\n// Remove all entries...\nforeach (Test t in db.Tests) db.Tests.Remove(t);\ndb.SaveChanges();\n\n// Add one test entry...\ndb.Tests.Add(new Test { ID = 1, value = 10 });\ndb.SaveChanges();\n</code></pre>\n\n<h2>Tests</h2>\n\n<p>Finally, we run some tests. We select our entry by it's original value (=10) and we change the \"value\" of our entry to 4711. BUT, we do not call db.SaveChanges(); !!!</p>\n\n<pre><code>// Find our entry by it's value (=10)\nvar result = from r in db.Tests\n             where r.value == 10\n             select r;\nTest t2 = result.FirstOrDefault();\n\n// change its value from 10 to 4711...\nt2.value = 4711;\n</code></pre>\n\n<p>Now, we try to find the (old) entry by the original value (=10) and do some tests on the results of that.</p>\n\n<pre><code>// now we try to select it via its old value (==10)\nvar result2 = from r in db.Tests\n             where r.value == 10\n             select r;\n\n// Did we get it?\nif (result2.FirstOrDefault() != null &amp;&amp; result2.FirstOrDefault().value == 4711)\n{\n    Console.WriteLine(\"We found the changed entry by it's old value...\");\n}\n</code></pre>\n\n<p>When running the program we'll actually see \"We found the changed entry by it's old value...\". That means we have run a query for r.value == 10, found something... This would be acceptable. BUT, get receive the already changed object (not fulfilling value == 10)!!!</p>\n\n<p><strong>Note:</strong> You'll get an empty result set for \"where r.value == 4711\".</p>\n\n<p>In some further testing, we find out, that the Entity Framework always hands out a reference to the same object. If we change the value in one reference, it's changed in the other one too. Well, that's ok... but one should know it happens.</p>\n\n<pre><code>Test t3 = result2.FirstOrDefault();    \nt3.value = 42;\nif (t2.value == 42)\n{\n    Console.WriteLine(\"Seems as if we have a reference to the same object...\");\n}\n</code></pre>\n\n<h2>Summary</h2>\n\n<p>When running a LINQ query on the same Database Context (without calling SaveChanges()) we will receive references to the same object, if it has the same primary key. The strange thing is: Even, if we change an object we will find it (only!) by it's old values. But we will receive a reference to the already changed object. This means that the restrictions in our query (value == 10) is not guaranteed for any entries that we changed since our last call of SaveChanges().</p>\n\n<h2>Questions</h2>\n\n<p>Of course, I'll probably have to live with some effects here. But I, would like to avoid to \"SaveChanges()\" after every little change. Especially, because I would like to use it for transaction handling... to be able to revert some changes, if something goes wrong.</p>\n\n<p>I would be glad, if anyone could answer me one or even both of the following questions:</p>\n\n<ol>\n<li><p>Is there a possibility to change the behavior of entity framework to work as if I would communicate with a normal database during a transaction? If so... how to do it?</p></li>\n<li><p>Where is a good resource for answering \"How to use the context of entity framework?\" which answers questions like \"What can I rely on?\" and \"How to choose the scope of my DBContext object\"?</p></li>\n</ol>\n\n<h2>EDIT #1</h2>\n\n<p>Richard just explained how to access the original (unchanged) database values. While this is valuable and helpful I've got the urge to clarify the goal ... </p>\n\n<p>Let's have a look at what happens when using SQL. We setup a table \"Tests\":</p>\n\n<pre><code>CREATE TABLE Tests (ID INT, value INT, PRIMARY KEY(ID));\nINSERT INTO Tests (ID, value) VALUES (1,10);\n</code></pre>\n\n<p>Then we have a transaction, that first looks for entities whose values are 10. After this, we update the value of these entries and look again for those entries. In SQL we already work on the updated version, so we will not find any results for our second query. After all we do a \"rollback\", so the value of our entry should be 10 again...</p>\n\n<pre><code>START TRANSACTION;\n\nSELECT ID, value FROM Tests WHERE value=10; {1 result}\nUPDATE Tests SET value=4711 WHERE ID=1; {our update}\n\nSELECT ID, value FROM Tests WHERE value=10; {no result, as value is now 4711}\n\nROLLBACK; { just for testing transactions... }\n</code></pre>\n\n<p>I would like to have exactly this behavior for the Entity Framework (EF), where db.SaveChanges(); is equivalent to \"COMMIT\", where all LINQ queries are equivalent to \"SELECT\" statements and every write access to an entity is just like an \"UPDATE\". I don't care about when the EF does actually calls the UPDATE statement, but it should behave the same way as using a SQL Database the direct way... Of course, if \"SaveChanges()\" is called and returning successfully it should be guaranteed that all data was persisted correctly.</p>\n\n<p>Note: Yes, I could call db.SaveChanges() before every query, but then I would loose the possibility for a \"Rollback\".</p>\n\n<p>Regards,</p>\n\n<p>Stefan</p>\n"},{"tags":["entity-framework","asp.net-mvc-4","ef-database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13138429,"title":"Auto generate models in mvc 4 database first?","body":"<p>I created an mvc 4 web project using database first and entity framework but was surprised to see that default models were not generated automatically, is there a way to create them from my .edmx file or are there any other possibilities to save hand coding them?</p>\n\n<p>Any help would be much appreciated</p>\n\n<p>UPDATE: </p>\n\n<p>Sorry, should have mentioned I am looking for a solution to generate simple models with basic methods such as :</p>\n\n<pre><code>public class EditUserModel\n{\n    public int ID { get; set; }\n\n    [Required(ErrorMessage = \"Forename is required\")]\n    public string Forename { get; set; }\n\n    [Required(ErrorMessage = \"Surname is required\")]\n    public string Surname { get; set; }\n\n    [Required(ErrorMessage = \"Username is required\")]\n    public string Username { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13141862,"title":"Joining multiple tables using Entity Framework","body":"<p>i am trying to join 3 tables using EF but it throws an error saying </p>\n\n<pre><code>consider swaping conditions on either side of equals\n</code></pre>\n\n<p>can some one pls help</p>\n\n<pre><code> var billdata = from billtotal in context.billTotals\n                                   join billcard in context.billClubcards\n                                       on billtotal.OrderID equals billcard.OrderID\n\n                                   join billtender in context.billTenders\n                                       on billtender.OrderID equals billtotal.OrderID\n\n\n                                   select billtotal;\n</code></pre>\n"},{"tags":["entity-framework","security","breeze"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13091760,"title":"Data Security using Entity Framework","body":"<p>What options/solutions are there for securing data using Entity Framework?</p>\n\n<p>I do not talk about forms login and such here, just assume that the users are authenticated or not.</p>\n\n<p>To illustrate, i attached one of my web api controllers and i wonder if this is the way to do it. The reason why i ask is that i wonder if there are easier ways to do this than writing all this logic to what data to expose in all my controllers.</p>\n\n<p>Also, when looking into a system like breezejs and odata where i can add $expand=TrafficImages to my queries, i would not want users to be able to get my hole database. </p>\n\n<p>So to summarize, what ways are there to securing the data exposed such the users cant download sensible data.</p>\n\n<pre><code>[AllowAnonymous]\npublic object GetTheoryTests()\n{\n    var identity = ((ClaimsIdentity)((ClaimsPrincipal)HttpContext.Current.User).Identity);\n    //if (HttpContext.Current.User.Identity.IsAuthenticated)\n\n\n   if (!identity.IsAuthenticated)\n     return db.TheoryTests.Include(t=&gt;t.TrafficImages).Where(t=&gt;t.PublicAvalible)\n            .Select(t =&gt; new { Id = t.Id, Title = t.Title, Images = t.TrafficImages }).AsEnumerable();\n\n   if (User.IsInRole(\"WebAdmins\"))\n       return db.TheoryTests.AsEnumerable();\n\n    var key = identity.GetProvider();\n\n    var member = db.Members.Include(m=&gt;m.PayedTheoryTests).SingleOrDefault(m=&gt;m.Identities.Any(\n        i=&gt;i.identityprovider == key.provider &amp;&amp;\n        i.nameidentifier == key.id));\n        if(member!=null)\n            return db.TheoryTests.Include(t =&gt; t.TrafficImages).Where(t =&gt; t.PublicAvalible).Select(t =&gt; new { Id = t.Id, Title = t.Title, Images = t.TrafficImages }).AsEnumerable();\n        else\n            return db.TheoryTests.Include(t =&gt; t.TrafficImages).Where(t =&gt; t.PublicAvalible)\n                .Union(member.PayedTheoryTests).Select(t =&gt; new { Id = t.Id, Title = t.Title, Images = t.TrafficImages }).AsEnumerable();\n\n\n\n}\n</code></pre>\n\n<p>When thinking about it, what i miss is something like a viewmodel untop of my database depending on the state of the user. Would it be a solution to create two entity frameworks ontop of the same database, one for limited data display and one for more advanced operations?</p>\n"},{"tags":["c#","entity-framework","data-binding","datagridview"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13141562,"title":"DatagridViewColumn Showing Object DataMember instead of Object","body":"<p>I use EF5 with Winforms and have a one to many relationship.</p>\n\n<p>Each Product has one Company.</p>\n\n<p>I have a DataGridView showing all Products (via binding). Now i want to have one column which shows not the object Company but a DataMember (Name) of Company. Is this possible (via designer)?</p>\n\n<p>I tried setting PropertyName to \"Company.Name\" but it doesn't work.</p>\n\n<p>Edit: it would be even better if i have a dropdownfield showing all Company-Names and i can so select the Company which belongs to the product. But i think this is even more difficult.</p>\n"},{"tags":["entity-framework","crystal-reports","null","relationship","many-to-one"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13140281,"title":"Crystal Reports + Entity Framework Many-to-One Empty FK","body":"<p>I have a report with 5 tables, and I'm using the Entity Framework as the data management tool.</p>\n\n<p>The problem is:</p>\n\n<ul>\n<li>When I set the datasource of my report (this datasource is a list with one single data row from a table, that does the selecion based on its realtionship rules);</li>\n<li>The table comes with a FK field, but this field is showing empty on the report (the datasource contains the value of the FK Field, but the report does not.</li>\n<li>There's a another table on this relationship that does have an FK Field and its working perfectly. The problem is with the data of the main table (that contains the row i defined as datasource, and contains a value of the FK field....) of the relationship selecion rules (based on inner Joins). The value appears empty on report.</li>\n</ul>\n\n<p>The datasource of my report is an iQueryable&lt; T > casted to iEnumerable&lt; T > (where T is the table object of entity framework) </p>\n"},{"tags":["entity-framework","ado.net","windows-server-2008","windows-server-2003","msdtc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13139275,"title":"Is This MSDTC configuration Issue?","body":"<p>It seems I am running into the Microsoft Distributed Transaction Coordinator (MSDTC) related issue.</p>\n\n<p><strong>SCENARIO</strong></p>\n\n<p>I am using TransactionScope and with in the single scope it hits two different databases on different servers (for instance, <strong>DB_A</strong> running Windows Server 2003 and <strong>DB_B</strong> running Windows Server 2008). One database is accessed using Entity Framework 4.0 and another using normal ADO.NET APIs.</p>\n\n<p>When I run the application from my development machine (running WinXP) it commits and rollbacks both the connections accurately. But when I run the application, deployed on another server (for instance <strong>WAS_A</strong> running Windows Server 2003) it commits correctly but in case of exception is doesn't roll back the database activities on both the servers.</p>\n\n<p>I thought it would be the MSDTC configuration issue on the <strong>WAS_A</strong>. So I went to the MSDTC -> Security Configuration and checked all the available options (as I did previously on other machines). But still I am facing the same issue.</p>\n\n<p>Looking for your expert advices. :)</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13139274,"title":"Copy a large DB schema to create a new DB in EF Code first","body":"<p>I have a code first DB with a context , from which i need to create a new DB which uses that Data but modifies it say 5% of the fields and then adds 20 more tables . This migration will be a regular daily process where many new Dbs are created ( from many source DBs) .</p>\n\n<p>What is the best way to do this .. right now im using a rather horrible method which copies across one table after another ( using value mapper for fields) and then does a few parent patches ?  Its horrible because its slow but worse the order is dependent on relationships and Many to Many are a pain.  ( in addition i have to match up ids if the original table has an id missing) </p>\n\n<p>I thought of using an SQL query but that is a bit difficult as well for such an operation ( especially since the destination uses different classnames for inheritance)  and may be an issue if some Dbs move to Oracle. </p>\n\n<p>A brute copy which ignores foreign keys would be ideal.</p>\n\n<p>Any ideas ? And remember this is a 50 table DB.</p>\n"},{"tags":["entity-framework","tracking","self","entities"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13137966,"title":"Self Tracking Entities - Relationships not generated","body":"<p>I have added a Self-Tracking Entity Generator to my existing Entity Framework setup.</p>\n\n<p>Now when I retrieve a World record from the database, for example</p>\n\n<pre><code>public class World\n{\n    public Guid Id { get; set; }\n    public string Name { get; set; }\n    public string Universe { get; set; }\n    public EntityCollection&lt;Country&gt; Countries { get; set; }\n}\n</code></pre>\n\n<p>which has a 1 to Many relationship to the table Country, the collection Countries is 0 and I know that in the database the records in the Country table exist.</p>\n\n<p>By adding the Self-Tracking Entity Generator I have somehow destroyed the databases relationships.</p>\n\n<p>Does anyone know how I can use a Self-Tracking Entity Generator but preserve the relationships?</p>\n\n<p>Many thanks</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-viewmodel"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":32,"score":-1,"question_id":13132719,"title":"How to use ReadOnly data annotation on condition?","body":"<p>I want to apply ReadOnly data annotation on my ViewModel properties. But this need to be checked and should be applied, based upon some condition. </p>\n\n<p>For example if I have some field mapping saved into my Database table and then I want to check on the ViewModel properties, whether this need to be ReadOnly or Editable. </p>\n\n<p>I appreciate if you can share your thought here.</p>\n"},{"tags":["c#","asp.net",".net","entity-framework","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13136236,"title":"Losing reference to child object on query","body":"<p>I have 3 Entities (MasterDoc, Folder, User) that i link together in another Entity (Folder_User).</p>\n\n<pre><code>public class Folder_User\n{\n    public int Id { get; set; }\n    public MasterDoc MasterDoc { get; set; }\n    public User User { get; set; }\n    public Folder Folder { get; set; }\n}\n</code></pre>\n\n<p>After ive inserted an object of type Folder_User into the database, i can (on the same DbContext) query it and retreive the child objects.</p>\n\n<pre><code>public static List&lt;Folder_User&gt; GetAllFolder_USer(User user, DataModel dbContext)\n    {\n        List&lt;Folder_User&gt; list = null;\n\n        var query = from f in dbContext.Folder_User\n                     where f.User.Id == user.Id\n                     select f;\n\n        list = new List&lt;Folder_User&gt;(query);\n        return list;\n    }\n</code></pre>\n\n<p>But after a page-refresh (new dbcontext) when i run the same query the objects reference to MasterDoc is null.</p>\n\n<p>*I have tried turn of lazy loading but nothing seems to fix it.\n*Have also checked the database and the table is correctly containing a row with a MasterDoc Id.</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13136543,"title":"Serializing object with virtual properties using another lighter object","body":"<p>I have got a class which has many virtual properties lazy loaded</p>\n\n<pre><code>public class TestPlan\n{\n    public virtual ICollection&lt;Test&gt; Test { get; set; }\n    public virtual Commercial Commercial { get; set; }\n    ...\n}\n</code></pre>\n\n<p>and this class has to be serialized later in the program. The thing is, as those properties are virtual I've got an error (circular reference) everytime I try to serialize it. <strong>Now here is my question</strong>:</p>\n\n<p><em>My boss told me to use what he calls View Object which is the same object but without the unused properties.</em> What do you think of this? Should I set those unused properties to null or something?</p>\n\n<p><strong>Background</strong>: </p>\n\n<p>The serialized object is meant to be used in an infragistics grid (a nice array). I've already tried using the <code>[ScriptIgnore]</code> attribute on my virtuals but it didn't worked.</p>\n\n<p>I also tried retrieving my TestPlans as <code>database.TestPlans.AsNoTracking().ToList()</code> but got an error (When an object is returned with a NoTracking merge option, Load can only be called when the EntityCollection or EntityReference does not contain objects.)</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["asp.net-mvc","entity-framework","linq-to-entities","entity"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3025,"score":1,"question_id":1077342,"title":"Entity Framework - Update entity with child properties","body":"<p>I have an entity that has one child and I need to update it, but, in the TryUpdateModel  method, it does not accept an strong typed object (accepts only a FormCollection), and when I try to update it, I get the following error.</p>\n\n<p>{\"A relationship is being added or deleted from an AssociationSet 'FK__SG_Usuari__ID_Si__534D60F1'. With cardinality constraints, a corresponding 'SG_Usuario' must also be added or deleted.\"}</p>\n\n<p>The problem is that I can't load in the formcollection the child property, only an id, but not the entire object.</p>\n"},{"tags":["entity-framework","asp.net-membership","dbcontext"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13135585,"title":"Implementing custom MembershipProvider","body":"<p>First of all, If i am using entity framework's and inherit from <code>DbContext</code>, I need to override all and implement all the functions using my context or simple use <code>base.FunctionName()</code> inside each overriden function?</p>\n\n<p>Secondly, Where should I put the DbContext object? should i Make it a public member in my custom MembershipProvider and initiate it in the c'tor, or create context in each function? or create in each function using <code>using (var context = CustomDbContext())</code> inside each function? please explain why.</p>\n\n<p>Lastly, How can I implement a custom <code>MembershipUser</code> and get its value? I guess I should inherit\nfrom <code>MembershipUser</code>, but how I get the CustomMembershipUser from it in the most elegant way?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":447,"score":-4,"question_id":10256723,"title":"How to inherit from the DbContext Class","body":"<p>I am working on MVC and in the model I created a class that uses Entity\n Framework. I am trying to inherit from DBContext class but it is showing\n an error saying: \"The type or Namespace name DBContext doesn't exist\". I also\n added the \"System.data.Entity \" namespace.</p>\n\n<p>Example like :</p>\n\n<pre><code> public Class SampleEF :DBContext //Showing error\n{\n\n}\n</code></pre>\n\n<p>Can you please tell me how to use the DBContext class to work with EF?</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":507,"score":1,"question_id":2572093,"title":"Save entity with entity framework","body":"<p>I'm saving entities/records with the EF, but i'm curious if there is another way of doing it.</p>\n\n<p>I receive a class from a MVC controller method, so basicly i have all the info: the class's properties, including the primary key.\nWithout EF i would do a Sql update (update table set a=b, c=d where id = 5), but with EF i got no further than this:</p>\n\n<p>Get an object with ID of 5 \nUpdate the (existing) object with the new object\nSubmitchanges.</p>\n\n<p>What bothers me is that i have to get the object from the database first, where i have all the info to do an update statement.</p>\n\n<p>Is there another way of doing this?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","razor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13118982,"title":"EF: many-to-many field always null","body":"<p>when i try to save this model, the <code>menu.Roles</code> field is always <code>null</code>, and save change method doesn't change the <code>Roles</code> field</p>\n\n<p>tables are <code>Menu</code>, <code>RoleMenu</code> and <code>Role</code></p>\n\n<p>so, i have a pair <strong>many-2-many</strong> models:</p>\n\n<p>Menu has a <code>Roles</code> filed<br>\nRole has a <code>Menus</code> fields</p>\n\n<p>action method:</p>\n\n<pre><code>    [HttpPost]\n    public ActionResult Edit(Menu menu, IEnumerable&lt;int&gt; RoleIDs)\n    {\n        if (ModelState.IsValid)\n        {\n            var roles = _db.UserRoles.Where(rl =&gt; RoleIDs.Contains(rl.Id)).ToList();\n\n            menu.Roles = new List&lt;UserRole&gt;();\n            menu.Roles.AddRange(roles);\n\n            _db.Entry(menu).State = EntityState.Modified;\n            _db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n        ViewBag.ParentMenuId = new SelectList(_db.Menus, \"Id\", \"Name\", menu.ParentMenuId);\n        ViewBag.RoleIDs = new SelectList(_db.UserRoles.ToList(), \"Id\", \"Name\");\n        return View(menu);\n    }\n</code></pre>\n\n<p>view:</p>\n\n<pre><code>//...other VS auto generated fields...\n&lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Roles, \"Roles\")\n&lt;/div&gt;\n&lt;div class=\"editor-field\"&gt;\n        @Html.ListBox(\"RoleIDs\")\n        @Html.ValidationMessageFor(model =&gt; model.Roles)\n&lt;/div&gt;\n&lt;p&gt;\n        &lt;input type=\"submit\" value=\"Save\" /&gt;\n&lt;/p&gt;\n</code></pre>\n\n<p>mapping:</p>\n\n<pre><code>            modelBuilder.Entity&lt;Role&gt;()\n             .HasMany(role =&gt; role.Menus)\n             .WithMany(menu =&gt; menu.Roles)\n             .Map(m =&gt;\n              m.MapLeftKey(\"RoleId\").\n                 MapRightKey(\"MenuId\").\n                 ToTable(\"RoleMenu\"));\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4","poco","entity-framework-5","pluralize"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":99,"score":6,"question_id":11614098,"title":"Howto customize pluralisation for Entity Framwork 5","body":"<p>As my database was designed using german table- and column names, the default pluralisation feature of entity framework doesn't work for me.</p>\n\n<p>I have found a couple of resources where this is discussed, but none of them seem to work.</p>\n\n<p>What i have found:\nThere is the PluralisationService where i can add the mappings:</p>\n\n<pre><code>PluralizationService pluralizer =\n      PluralizationService.CreateService(CultureInfo.GetCultureInfo(\"en-us\"));\nICustomPluralizationMapping mapping = ps as ICustomPluralizationMapping;\nmapping.AddWord(\"Tabelle\", \"Tabellen\");\n</code></pre>\n\n<p>But what's next?\nI have tried to:</p>\n\n<pre><code>EntityModelSchemaGenerator generator = new EntityModelSchemaGenerator(container);\ngenerator.PluralizationService = pluralizer;\ngenerator.GenerateMetadata();\n</code></pre>\n\n<p>and put both of them in my POCO T4 Template. But it throwed the following exception:</p>\n\n<blockquote>The EntityContainer 'ContainerName' is not a store EntityContainer. Parameter name: storeEntityContainer<br>\n   at System.Data.Entity.Design.EntityModelSchemaGenerator.Initialize(...)<br>\n   at Microsoft.VisualStudio.TextTemplating...GeneratedTextTransformation.TransformText()<br>\n</blockquote>\n\n<p>ANY Help? Please!!! Thanks!!</p>\n"},{"tags":["c#",".net","entity-framework","inotifypropertychanged"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":518,"score":1,"question_id":11010718,"title":"How to get property change notifications with EF 4.x DbContext generator","body":"<p>I'm playing around with Entity Framework 4.3, and so I am using the DbContext Generator to create the context and entity classes. </p>\n\n<p>With the default EF 4 code generator template, entity classes implement INotifyPropertyChanged, and also add <code>Changing</code> and <code>Changed</code> partial methods in property setters.</p>\n\n<p>When I use the EF 4.x DbContext generator, as pictured below, the entity classes are much lighter, and do not include any means of tracking property changes.</p>\n\n<p><img src=\"http://i.stack.imgur.com/YRlrP.png\" alt=\"enter image description here\"></p>\n\n<p>Here is an example:</p>\n\n<pre><code>//------------------------------------------------------------------------------\n// &lt;auto-generated&gt;\n//    This code was generated from a template.\n//\n//    Manual changes to this file may cause unexpected behavior in your application.\n//    Manual changes to this file will be overwritten if the code is regenerated.\n// &lt;/auto-generated&gt;\n//------------------------------------------------------------------------------\n\nusing System;\nusing System.Collections.Generic;\n\nnamespace SomeNamespace\n{\n    public partial class SomeTable\n    {\n        public SomeTable()\n        {\n            this.Children = new HashSet&lt;Child&gt;();\n        }\n\n        public long parent_id { get; set; }\n        public long id { get; set; }\n        public string filename { get; set; }\n        public byte[] file_blob { get; set; }\n\n        public virtual Parent Parent { get; set; }\n        public virtual ICollection&lt;Child&gt; Children { get; set; }\n    }\n}\n</code></pre>\n\n<p>I must be missing an important piece of the puzzle, but my searches have been fruitless. So my question is: how can I have generated types included property change notifications with EF 4.3?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I fully agree with @derape answer's; but I am curious as to why I would need to change the <code>.tt</code> file when the EF 4 default code generation template <em>already</em> has the hooks. I mean what about when binding to a WPF <code>DependencyProperty</code>'? Without INotifyPropertyChanged, changes done by a command to a bunch of properties in a bunch of objects won't be reflected in the UI. What am I missing?</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13129405,"title":"Entity Framework 5 turn off auto compilation in RTM?","body":"<p>I see many examples over the internet on how to turn off the automatic compilation with:</p>\n\n<pre><code>using (var db = new SampleEntities())\n{\n    db.ContextOptions.DefaultQueryPlanCaching = false;\n}\n</code></pre>\n\n<p>However, I can't see this property anywhere on the db context. It doesn't even have ContextOptions.</p>\n\n<p>There is somewhere on the internet mentioned to cast it to IObjectContextAdapter, there I get ContextOptions, but still not that property</p>\n\n<pre><code>((IObjectContextAdapter)db).ObjectContext.ContextOptions.?\n</code></pre>\n\n<p>Note that I'm using the default generation in EF5 which uses DbContext and DbSets.</p>\n\n<p>How do I turn it off? Note also that this is RTM, not beta, or RC of .NET 4.5</p>\n"},{"tags":["c#","entity-framework"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1256,"score":0,"question_id":9287454,"title":"Check the existence of a record before inserting a new record","body":"<p>I'm using the Ado.net Entity Framework for the first time and I need to check if this record exist before I insert it to the database. Preferably I'd search if AuthodSSID exists  and not the key (AuthorID). I'm using VS2010, Framework 4. System.Data.Entity is 3.5.0.0.</p>\n\n<p>I googled, but found no answer for this question.</p>\n\n<pre><code>PublishingCompanyEntities publishContext;\npublishContext = new PublishingCompanyEntities();\n\nprivate void createNew_Click(object sender, EventArgs e)\n{\n    Author newAuthor = new Author();\n    newAuthor.FirstName = firstName.Text;\n    newAuthor.LastName = lastName.Text;\n    newAuthor.AuthodSSID = 20;\n    newAuthor.AuthorID = 10\n//Check if record exist here\n    publishContext.AddToAuthor(newAuthor);//insert if does not exist\n\n}\n</code></pre>\n"},{"tags":["c#","visual-studio-2010","entity-framework","unit-testing","rhino-mocks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13109192,"title":"shouldn't I mock the entities of EF when unittesting?","body":"<p>I use EF4.</p>\n\n<p>I read this post about mocking EF</p>\n\n<p><a href=\"http://www.codeproject.com/Articles/447988/How-to-Mock-Test-an-Entity-Framework-Model-First-P\" rel=\"nofollow\">http://www.codeproject.com/Articles/447988/How-to-Mock-Test-an-Entity-Framework-Model-First-P</a></p>\n\n<p>Sholdn't we abstract the entities types as well? </p>\n\n<p>In order to keep dicupling between the DAL and the BL?</p>\n\n<p>in the post above I see he used EF concrete generated entities types:</p>\n\n<pre><code>[TestMethod]\npublic void GetCustomer()\n{\n    ContextContainerMock container = new ContextContainerMock();\n    IMyEntities en = container.Current;\n\n\n**Customer c = new Customer { ID = 1, FirstName = \"John\", LastName = \"Doe\" };**\n    en.Customers.AddObject(c);\n\n    CustomerService service = new CustomerService(container);\n    var a = service.GetCustomer(1);\n\n    Assert.AreEqual(c.FirstName, a.FirstName);\n    Assert.AreEqual(c.LastName, a.LastName);\n}\n</code></pre>\n"},{"tags":["c#","silverlight","entity-framework","silverlight-5.0","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13128200,"title":"The underlying provider failed on Open","body":"<p>I'm using <code>EntityFramework</code> with <code>Windows Azure</code> platform. It works so well in <code>LOCAL</code> mode, but when I'm trying to run my <code>Silverlight</code> application on Web. I get an error:</p>\n\n<blockquote>\n  <p>The underlying provider failed on Open.</p>\n</blockquote>\n\n<pre><code>&lt;configuration&gt;\n  &lt;system.webServer&gt;\n    &lt;modules runAllManagedModulesForAllRequests=\"true\"&gt;\n      &lt;add name=\"DomainServiceModule\" preCondition=\"managedHandler\" type=\"System.ServiceModel.DomainServices.Hosting.DomainServiceHttpModule, System.ServiceModel.DomainServices.Hosting, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" /&gt;\n    &lt;/modules&gt;\n    &lt;validation validateIntegratedModeConfiguration=\"false\" /&gt;\n  &lt;/system.webServer&gt;\n  &lt;appSettings&gt;\n    &lt;add key=\"aspnet:UseTaskFriendlySynchronizationContext\" value=\"true\" /&gt;\n    &lt;add key=\"ValidationSettings:UnobtrusiveValidationMode\" value=\"WebForms\" /&gt;\n  &lt;/appSettings&gt;\n  &lt;system.web&gt;\n    &lt;httpModules&gt;\n      &lt;add name=\"DomainServiceModule\" type=\"System.ServiceModel.DomainServices.Hosting.DomainServiceHttpModule, System.ServiceModel.DomainServices.Hosting, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" /&gt;\n    &lt;/httpModules&gt;\n    &lt;customErrors mode=\"Off\" /&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.5\"&gt;\n      &lt;assemblies&gt;\n        &lt;add assembly=\"System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n      &lt;/assemblies&gt;\n    &lt;/compilation&gt;\n    &lt;httpRuntime requestValidationMode=\"4.5\" targetFramework=\"4.5\" encoderType=\"System.Web.Security.AntiXss.AntiXssEncoder, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\" /&gt;\n    &lt;pages controlRenderingCompatibilityVersion=\"4.5\" /&gt;\n    &lt;machineKey compatibilityMode=\"Framework45\" /&gt;\n  &lt;/system.web&gt;\n  &lt;system.serviceModel&gt;\n    &lt;serviceHostingEnvironment aspNetCompatibilityEnabled=\"true\" multipleSiteBindingsEnabled=\"true\" /&gt;\n  &lt;/system.serviceModel&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"DatabaseEntities\" connectionString=\"metadata=res://*/Model.csdl|res://*/Model.ssdl|res://*/Model.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=lnqg2ulkjr.database.windows.net;initial catalog=BuilderDatabase;persist security info=True;user id=XXXXX;password=XXXXX;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>I was checking that this is a problem in the connection string with <code>Integrated Security</code> but in my case I don't have that property. What could be the error?</p>\n"},{"tags":["c#","database","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":105,"score":0,"question_id":13116764,"title":"How to update relational database TABELS?","body":"<p>I am using Entity Framework 4.0. I am facing problem while updating data in the database. I am getting this exception :</p>\n\n<blockquote>\n  <p><em>An object with the same key already exists in the ObjectStateManager.</em><br>\n  <em>The ObjectStateManager cannot track multiple objects with the same key.</em></p>\n</blockquote>\n\n<p>I am working on the relational database. The following are 3 entities and there relation :</p>\n\n<pre><code>         1    to   *        1   to    *\nCeremony -----------&gt; Menu ------------&gt; CourseOption\n</code></pre>\n\n<p>Everything works fine, if I update the ceremony which already contains the <code>Menus</code> and <code>CourseOptions</code>. The problem comes when we insert new <code>Menu</code> and <code>CourseOption</code> entry in the ceremony at the time of update. Than I got the above mention exception.</p>\n\n<p><strong>C# code to update existing ceremony</strong></p>\n\n<pre><code>public HttpResponseMessage PutCeremony(int id, Ceremony ceremony)\n{\n    if (ModelState.IsValid &amp;&amp; id == ceremony.Id)\n    {\n       db.Entry(ceremony).State = EntityState.Modified;\n\n       try\n       {\n           db.SaveChanges();\n       }\n       catch (DbUpdateConcurrencyException)\n       {\n           return Request.CreateResponse(HttpStatusCode.NotFound);\n       }\n\n       return Request.CreateResponse(HttpStatusCode.OK, ceremony);\n    }\n    else\n    {\n       return Request.CreateResponse(HttpStatusCode.BadRequest);\n    }\n}\n</code></pre>\n\n<p>How can I get rid of this problem? Please help  </p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Today i spend a whole day in this, i read a lot of articals and stackoverflow question. I found that <code>once a product is fetched from the Context, the context is keeping track of it</code> so that why instead of using :</p>\n\n<pre><code>db.Entry(ceremony).State = EntityState.Modified;\n</code></pre>\n\n<p>I used </p>\n\n<pre><code>db.Entry(db.Ceremonies.Find(ceremony.Id)).CurrentValues.SetValues(ceremony);\n</code></pre>\n\n<p>Now by doing this change the exception gone and Ceremony entity properties are changing properly. But the ceremony related Menus entry and CourseOptions entry are not updating. Please give me suggestion guys. I am absolutely new in EF.  </p>\n"},{"tags":["c#","entity-framework","sql-server-ce-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13125305,"title":"SQL Server Compact Toolbox with disabled add connections options","body":"<p>The original problem is that I'm trying to use SQL CE 4.0 with Entity Framework 5. I have applied the service pack 1, applied different hot fix (as suggested in different forums and blogs).</p>\n\n<p>Now, I've read that SQL Server Compact Toolbox can manage these connections, but when I follow the steps, I get this menu :</p>\n\n<p><img src=\"http://i.stack.imgur.com/MCOat.png\" alt=\"enter image description here\"></p>\n\n<p>Where the two first items should be enabled. My project is a C# WPF project. I've also read (from some post over a year ago) that only Asp.Net projects are supported with this feature (Why??), is this why I get the disabled menu items?</p>\n"},{"tags":["entity-framework","rest","asp.net-mvc-4","asp.net-web-api"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13126711,"title":".Net MVC 4 REST Cannot send Object","body":"<p>I have build a .Net Mvc 4 application and now I want to extend it with REST.</p>\n\n<p>I am using the Entity Framework and I have the following problem.</p>\n\n<p>My goal is to have a system where categories have a number of products and where products can belong to multiple categories.</p>\n\n<p>As follows:</p>\n\n<pre><code>public class Categorie\n{\n    [Key]\n    public int Id { get; set; }\n    [Required]\n    public string Naam { get; set; }\n    [Required]\n    public string Omschrijving { get; set; }\n    public byte[] Plaatje { get; set; }\n    private List&lt;Product&gt; producten;\n    public virtual List&lt;Product&gt; Producten\n    {\n        get { return producten; }   \n        set { producten = value; }\n    }\n}\n\npublic class Product\n    {\n        [Key]\n        public int Id { get; set; }\n        [Required]\n        public string Naam { get; set; }\n        [Required]\n        public string Omschrijving { get; set; }\n        [Required]\n        public double Prijs { get; set; }\n        private List&lt;Categorie&gt; categorien = new List&lt;Categorie&gt;();\n\n        public virtual List&lt;Categorie&gt; Categorien\n        {\n            get { return categorien; }\n            set { categorien = value; }\n        }\n        [Required]\n        public byte[] Plaatje { get; set; }\n    }\n</code></pre>\n\n<p>NOTE: There are virtual properties in there so that my entity framework creates a merging table. Normally it links all the categorie's to the products and vice versa.</p>\n\n<p>And my rest looks like:</p>\n\n<pre><code>// GET api/Rest/5\n    public Product GetProduct(int id)\n    {\n        Product product = db.Producten.Find(id);\n        Product newProduct = new Product();\n        if (product == null)\n        {\n            throw new HttpResponseException(Request.CreateResponse(HttpStatusCode.NotFound));\n        }\n        else\n        {\n            product.Categorien = null;\n        }\n        newProduct.Id = product.Id;\n        newProduct.Naam = product.Naam;\n        newProduct.Omschrijving = product.Omschrijving;\n        newProduct.Plaatje = product.Plaatje;\n        newProduct.Prijs = product.Prijs;\n        newProduct.Categorien = product.Categorien;\n        return newProduct;\n    }\n</code></pre>\n\n<p>First problem: I cannot send any product aslong as it has a categorie. I have to make it null.\nSecond problem: I cannot send the original product because of the first problem.</p>\n"},{"tags":["entity-framework","connection-string","code-first"],"answer_count":8,"favorite_count":2,"up_vote_count":33,"down_vote_count":0,"view_count":19480,"score":33,"question_id":4741499,"title":"How to configure ProviderManifestToken for EF Code First","body":"<p>I have a asp.net MVC3 project using EF Code First.  For my unit testing I have been using SqlServerCE 4.0 and SqlExpress 2008.  Both have worked perfectly with EF generating my database as expected.</p>\n\n<p>However, when I run my application outside of a Unit Test and point it at my connection strings I get the error \"ProviderIncompatibleException: The provider did not return a ProviderManifestToken string\"</p>\n\n<p>I have read the MS documentation on this and it appears this is a SqlVersion token that the EF model generates.  The problem is that I am using the code first approach so I have no .edmx file nor do I know where to point my metadata info to because the db hasn't been generated yet.</p>\n\n<p>I know my connection strings as far as db name, username, and pass are correct because changing them to wrong values throws the expected error.  Not sure where to begin.</p>\n\n<p>Thanks.</p>\n\n<p>Here is my connection string:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n  &lt;add\n    name=\"SqlConnection\"\n    providerName=\"System.Data.SqlClient\"\n    connectionString=\"Data Source=WORKSTATION\\SQLEXPRESS;Initial Catalog=CodeFirst;Integrated Security=False;\n    Persist Security Info=False;User ID=CodeFirst_user;Password=password1;Connect Timeout=120;MultipleActiveResultSets=True;\"/&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13108202,"title":"Batching ExecuteSqlCommand statements on a code-first DbContext","body":"<p>I'm calling ExecuteSqlCommand several thousands times per minute and each one is a round-trip to the database.  The command itself calls a stored procedure and the parameters vary from INTs to NVARCHARS to \"Structured\" table-value parameters. When I look at the SQL commands generated by Entity Framework via SQL Profiler quite a sizeable chunk of data is being sent to the DB.</p>\n\n<p>Given that there is no return value from the SP, it's very much \"fire and forget\", I'd like to try to batch up the SQL commands and send, say, a batch of 10 at once.  Is this possible using Entity Framework?  Is there a way to get Entity Framework to return me the full SQL command per call and then I could concatenate the SQL myself and call ExecuteSqlCommand myself?</p>\n"},{"tags":["linq","entity-framework","linq-expressions","soft-delete","expressionvisitor"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12760933,"title":"ExpressionVisitor soft delete","body":"<p>We're having some issues implementing soft delete functionality with entity framework. The idea is to use a repository which is aware of the EF context. On the level of the repository we implemented a plugin system, these plugins get executed whenever an action is done on the repository. For example when we call <code>Repository.GetQuery&lt;Relation&gt;()</code> the plugins get executed. One of the plugins is a <code>LogicalDeletePlugin</code>, this plugin should add a <code>Where(x =&gt; x.IsDeleted)</code> statement to each table which is in the select. The idea was to implement this <code>IsDeleted</code> plugin using an <code>ExpressionVisitor</code> which visits the linq expression and finds all the \"table\" select statements and add the <code>IsDeleted</code> condition.</p>\n\n<p>To clarify the question/problem I'll explain the issue using some code examples. </p>\n\n<pre><code>void Main()\n{\nvar options = new ReadonlyRepositoryOptions() { ConnectionStringDelegate = () =&gt; Connection.ConnectionString };\nusing (var context = new ReadonlyObjectContextRepository&lt;PFishEntities&gt;(options))\n{\nvar query = context.GetQuery&lt;Relation&gt;()\n.Select(x =&gt; new {\nTest = x.Bonus,\nTestWorks = x.Bonus.Where(y =&gt; y.bonID == 100)\n});\n\nquery.InterceptWith(new TestVisitor()).ToList();\n}\n}\n\npublic class TestVisitor : ExpressionVisitor {\nprivate ParameterExpression Parameter { get; set; }\n\nprotected override Expression VisitBinary(BinaryExpression node) {\n\"VisitBinary\".Dump();\nExpression left = this.Visit(node.Left);\nExpression right = this.Visit(node.Right);\n\nvar newParams = new[] { Parameter };\nvar condition = (LambdaExpression)new LogicalDeletePlugin().QueryConditionals.First().Conditional;\nvar paramMap = condition.Parameters.Select((original, i) =&gt; new { original, replacement = newParams[i] }).ToDictionary(p =&gt; p.original, p =&gt; p.replacement);\n\nvar fixedBody = ParameterRebinder.ReplaceParameters(paramMap, condition.Body);\nreturn Expression.MakeBinary(ExpressionType.AndAlso, node, fixedBody, node.IsLiftedToNull, node.Method);\n    }\n\nprotected override Expression VisitParameter(ParameterExpression expr)\n{\nParameter = expr;\nreturn base.VisitParameter(expr);\n}\n}\nvoid Main()\n{\n    var options = new ReadonlyRepositoryOptions() { ConnectionStringDelegate = () =&gt; Connection.ConnectionString };\n    using (var context = new ReadonlyObjectContextRepository&lt;PFishEntities&gt;(options))\n    {\n        var query = context.GetQuery&lt;Relation&gt;()\n        .Select(x =&gt; new {\n            Test = x.Bonus,\n            TestWorks = x.Bonus.Where(y =&gt; y.bonID == 100)\n        });\n\n        query.InterceptWith(new TestVisitor()).ToList();\n    }\n}\n\npublic class TestVisitor : ExpressionVisitor {\n    private ParameterExpression Parameter { get; set; }\n\n    protected override Expression VisitBinary(BinaryExpression node) {\n        \"VisitBinary\".Dump();\n        Expression left = this.Visit(node.Left);\n        Expression right = this.Visit(node.Right);\n\n        var newParams = new[] { Parameter };\n        var condition = (LambdaExpression)new LogicalDeletePlugin().QueryConditionals.First().Conditional;\n        var paramMap = condition.Parameters.Select((original, i) =&gt; new { original, replacement = newParams[i] }).ToDictionary(p =&gt; p.original, p =&gt; p.replacement);\n        var fixedBody = ParameterRebinder.ReplaceParameters(paramMap, condition.Body);\n        return Expression.MakeBinary(ExpressionType.AndAlso, node, fixedBody, node.IsLiftedToNull, node.Method);\n    }\n\n    protected override Expression VisitParameter(ParameterExpression expr)\n    {\n        Parameter = expr;\n        return base.VisitParameter(expr);\n    }\n}\n</code></pre>\n\n<p>The above c# code will result in the following SQL code :</p>\n\n<pre><code>SELECT \n[UnionAll1].[relID] AS [C1], \n[UnionAll1].[C2] AS [C2], \n[UnionAll1].[C1] AS [C3], \n[UnionAll1].[bonID] AS [C4], \n[UnionAll1].[bonCUSTOMERID] AS [C5], \n[UnionAll1].[bonRELATIONARTICLEBONUSID] AS [C6], \n[UnionAll1].[bonINVOICEID] AS [C7], \n[UnionAll1].[bonSALEROWID] AS [C8], \n[UnionAll1].[bonVALUE] AS [C9], \n[UnionAll1].[bonPERCENTAGE] AS [C10], \n[UnionAll1].[bonMANUAL] AS [C11], \n[UnionAll1].[bonPAID] AS [C12], \n[UnionAll1].[IsDeleted] AS [C13], \n[UnionAll1].[InternalReference] AS [C14], \n[UnionAll1].[ConcurrencyToken] AS [C15], \n[UnionAll1].[Created] AS [C16], \n[UnionAll1].[CreatedBy] AS [C17], \n[UnionAll1].[Updated] AS [C18], \n[UnionAll1].[UpdatedBy] AS [C19], \n[UnionAll1].[DisplayMember] AS [C20], \n[UnionAll1].[ValueMember] AS [C21], \n[UnionAll1].[SearchField] AS [C22], \n[UnionAll1].[CreateDate] AS [C23], \n[UnionAll1].[C3] AS [C24], \n[UnionAll1].[C4] AS [C25], \n[UnionAll1].[C5] AS [C26], \n[UnionAll1].[C6] AS [C27], \n[UnionAll1].[C7] AS [C28], \n[UnionAll1].[C8] AS [C29], \n[UnionAll1].[C9] AS [C30], \n[UnionAll1].[C10] AS [C31], \n[UnionAll1].[C11] AS [C32], \n[UnionAll1].[C12] AS [C33], \n[UnionAll1].[C13] AS [C34], \n[UnionAll1].[C14] AS [C35], \n[UnionAll1].[C15] AS [C36], \n[UnionAll1].[C16] AS [C37], \n[UnionAll1].[C17] AS [C38], \n[UnionAll1].[C18] AS [C39], \n[UnionAll1].[C19] AS [C40], \n[UnionAll1].[C20] AS [C41], \n[UnionAll1].[C21] AS [C42], \n[UnionAll1].[C22] AS [C43]\nFROM  (SELECT \n    CASE WHEN ([Extent2].[bonID] IS NULL) THEN CAST(NULL AS int) ELSE 1 END AS [C1], \n    [Extent1].[relID] AS [relID], \n    1 AS [C2], \n    [Extent2].[bonID] AS [bonID], \n    [Extent2].[bonCUSTOMERID] AS [bonCUSTOMERID], \n    [Extent2].[bonRELATIONARTICLEBONUSID] AS [bonRELATIONARTICLEBONUSID], \n    [Extent2].[bonINVOICEID] AS [bonINVOICEID], \n    [Extent2].[bonSALEROWID] AS [bonSALEROWID], \n    [Extent2].[bonVALUE] AS [bonVALUE], \n    [Extent2].[bonPERCENTAGE] AS [bonPERCENTAGE], \n    [Extent2].[bonMANUAL] AS [bonMANUAL], \n    [Extent2].[bonPAID] AS [bonPAID], \n    [Extent2].[IsDeleted] AS [IsDeleted], \n    [Extent2].[InternalReference] AS [InternalReference], \n    [Extent2].[ConcurrencyToken] AS [ConcurrencyToken], \n    [Extent2].[Created] AS [Created], \n    [Extent2].[CreatedBy] AS [CreatedBy], \n    [Extent2].[Updated] AS [Updated], \n    [Extent2].[UpdatedBy] AS [UpdatedBy], \n    [Extent2].[DisplayMember] AS [DisplayMember], \n    [Extent2].[ValueMember] AS [ValueMember], \n    [Extent2].[SearchField] AS [SearchField], \n    [Extent2].[CreateDate] AS [CreateDate], \n    CAST(NULL AS bigint) AS [C3], \n    CAST(NULL AS bigint) AS [C4], \n    CAST(NULL AS bigint) AS [C5], \n    CAST(NULL AS bigint) AS [C6], \n    CAST(NULL AS bigint) AS [C7], \n    CAST(NULL AS decimal(20,4)) AS [C8], \n    CAST(NULL AS decimal(20,4)) AS [C9], \n    CAST(NULL AS bit) AS [C10], \n    CAST(NULL AS decimal(20,4)) AS [C11], \n    CAST(NULL AS bit) AS [C12], \n    CAST(NULL AS varchar(1)) AS [C13], \n    CAST(NULL AS varbinary(1)) AS [C14], \n    CAST(NULL AS datetimeoffset) AS [C15], \n    CAST(NULL AS varchar(1)) AS [C16], \n    CAST(NULL AS datetimeoffset) AS [C17], \n    CAST(NULL AS varchar(1)) AS [C18], \n    CAST(NULL AS varchar(1)) AS [C19], \n    CAST(NULL AS varchar(1)) AS [C20], \n    CAST(NULL AS varchar(1)) AS [C21], \n    CAST(NULL AS datetime2) AS [C22]\n    FROM  [dbo].[Relation] AS [Extent1]\n    LEFT OUTER JOIN [dbo].[Bonus] AS [Extent2] ON [Extent1].[relID] = [Extent2].[bonCUSTOMERID]\nUNION ALL\n    SELECT \n    2 AS [C1], \n    [Extent3].[relID] AS [relID], \n    2 AS [C2], \n    CAST(NULL AS bigint) AS [C3], \n    CAST(NULL AS bigint) AS [C4], \n    CAST(NULL AS bigint) AS [C5], \n    CAST(NULL AS bigint) AS [C6], \n    CAST(NULL AS bigint) AS [C7], \n    CAST(NULL AS decimal(20,4)) AS [C8], \n    CAST(NULL AS decimal(20,4)) AS [C9], \n    CAST(NULL AS bit) AS [C10], \n    CAST(NULL AS decimal(20,4)) AS [C11], \n    CAST(NULL AS bit) AS [C12], \n    CAST(NULL AS varchar(1)) AS [C13], \n    CAST(NULL AS varbinary(1)) AS [C14], \n    CAST(NULL AS datetimeoffset) AS [C15], \n    CAST(NULL AS varchar(1)) AS [C16], \n    CAST(NULL AS datetimeoffset) AS [C17], \n    CAST(NULL AS varchar(1)) AS [C18], \n    CAST(NULL AS varchar(1)) AS [C19], \n    CAST(NULL AS varchar(1)) AS [C20], \n    CAST(NULL AS varchar(1)) AS [C21], \n    CAST(NULL AS datetime2) AS [C22], \n    [Extent4].[bonID] AS [bonID], \n    [Extent4].[bonCUSTOMERID] AS [bonCUSTOMERID], \n    [Extent4].[bonRELATIONARTICLEBONUSID] AS [bonRELATIONARTICLEBONUSID], \n    [Extent4].[bonINVOICEID] AS [bonINVOICEID], \n    [Extent4].[bonSALEROWID] AS [bonSALEROWID], \n    [Extent4].[bonVALUE] AS [bonVALUE], \n    [Extent4].[bonPERCENTAGE] AS [bonPERCENTAGE], \n    [Extent4].[bonMANUAL] AS [bonMANUAL], \n    [Extent4].[bonPAID] AS [bonPAID], \n    [Extent4].[IsDeleted] AS [IsDeleted], \n    [Extent4].[InternalReference] AS [InternalReference], \n    [Extent4].[ConcurrencyToken] AS [ConcurrencyToken], \n    [Extent4].[Created] AS [Created], \n    [Extent4].[CreatedBy] AS [CreatedBy], \n    [Extent4].[Updated] AS [Updated], \n    [Extent4].[UpdatedBy] AS [UpdatedBy], \n    [Extent4].[DisplayMember] AS [DisplayMember], \n    [Extent4].[ValueMember] AS [ValueMember], \n    [Extent4].[SearchField] AS [SearchField], \n    [Extent4].[CreateDate] AS [CreateDate]\n    FROM  [dbo].[Relation] AS [Extent3]\n    INNER JOIN [dbo].[Bonus] AS [Extent4] ON ([Extent3].[relID] = [Extent4].[bonCUSTOMERID]) AND (100 = [Extent4].[bonID]) AND ([Extent4].[IsDeleted] &lt;&gt; cast(1 as bit))) AS [UnionAll1]\nORDER BY [UnionAll1].[relID] ASC, [UnionAll1].[C1] ASC\n</code></pre>\n\n<p>As you can see in the resulting SQL query the <code>IsDeleted</code> statements gets added to the <code>TestWorks = x.Bonus.Where(y =&gt; !y.IsDeleted)</code> \"select\" code. That's what the <code>TestVisitor</code> is currently doing. But the question is now how we can also implement this on the other selects, the <code>x =&gt; !x.IsDeleted</code> doesn't get added on the <code>Test = x.Bonus</code> part.</p>\n\n<p>Is the ExpressionVisitor the correct approach to get this done or should I go with another solution? All help is appreciated! If the explanation wasn't clear enough just let me know and I'll try to give some additional info!</p>\n\n<p>Edit:</p>\n\n<pre><code>protected override Expression VisitMember(MemberExpression node)\n    {\n        var test = typeof(bool);\n        if (node.Type != test &amp;&amp; node.Type != typeof(string))\n        {\n            var type = typeof(ArticleVat);\n            var condition = (LambdaExpression)Condition;\n            var newParams = new[] { Expression.Parameter(type, \"x\") };\n            var paramMap = condition.Parameters.Select((original, i) =&gt; new { original, replacement = newParams[i] }).ToDictionary(p =&gt; p.original, p =&gt; p.replacement);\n            var fixedBody = ParameterRebinder.ReplaceParameters(paramMap, condition.Body);\n            condition = Expression.Lambda(fixedBody, newParams);\n            var whereM = whereMethod.MakeGenericMethod(new [] { type });\n            var expr = Expression.Property(node.Expression, \"ArticleVat\");\n            var whereExpr = Expression.Call(whereM, expr, condition);\n//          whereExpr.Dump();\nnode.Dump();\n//          return Expression.MakeMemberAccess(whereExpr, node.Expression.Type.GetMember(node.Member.Name).Single());\n//           return Expression.MakeMemberAccess(\n//                whereExpr,\n//                node.Expression.Type.GetMember(node.Member.Name).Single());\n        }\n\n        return base.VisitMember(node);\n    }\n</code></pre>\n\n<p>The above is what I've added to the ExpressionVisitor. Now when I uncomment the return Expression.MamkeMemberaccess code an exception is thrown because it doesn't expect a MemberExpression or something.</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","razor"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13123266,"title":"refresh a partial view in a main view after an action occurs inside that partial view","body":"<p>I have a partial view that sits in my main view like this: </p>\n\n<pre><code> &lt;div id=\"complaintlist\"&gt;\n    @Html.Action(\"ShowCaseComplaints\", \"Cases\", new { caseid = Model.CasesID })\n&lt;/div&gt;\n</code></pre>\n\n<p>This is the partial view:</p>\n\n<pre><code>@model IEnumerable&lt;cummins_db.ViewModels.CaseComplaintsViewModel&gt;\n\n&lt;table width=\"100%\"&gt;\n &lt;tr&gt;\n    &lt;th&gt;&lt;/th&gt;\n    &lt;th&gt;&lt;/th&gt;\n    &lt;th&gt;Complaint Code&lt;/th&gt;\n    &lt;th&gt;Complaint Description&lt;/th&gt;\n    &lt;th&gt;Delete&lt;/th&gt;\n&lt;/tr&gt;  \n@foreach (var item in Model)\n    {\n&lt;tr&gt;\n    &lt;td&gt;\n         @Html.HiddenFor(modelItem =&gt; item.CasesID )    \n    &lt;/td&gt;\n    &lt;td&gt;\n        @Html.HiddenFor(modelItem =&gt; item.CaseComplaintID )    \n    &lt;/td&gt;\n    &lt;td&gt;\n        @Html.DisplayFor(modelItem =&gt; item.ComplaintCode )    \n    &lt;/td&gt;\n    &lt;td&gt;\n        @Html.DisplayFor(modelItem =&gt; item.ComplaintType)\n    &lt;/td&gt;\n    &lt;td&gt;\n        @Ajax.ActionLink(\"Delete\", \"RemoveCodeFromCase\", \"Cases\", new { caseid = item.CasesID, id = item.CaseComplaintID }, null)\n    &lt;/td&gt;        \n &lt;/tr&gt;\n    }\n &lt;/table&gt;\n</code></pre>\n\n<p>This partial view has an action that allows the user to remove a record from the model in the partial view. Here is the action called RemoveCodeFromCase:</p>\n\n<pre><code>public ActionResult RemoveCodeFromCase(int caseid, int id)\n        {\n        if (ModelState.IsValid)\n            {\n            CaseComplaint c = db.CaseComplaints.Find(id);\n            db.CaseComplaints.Remove(c);\n            db.SaveChanges();\n\n            var data = (from C in db.CaseComplaints\n                        where C.CasesID == caseid\n                        select new CaseComplaintsViewModel()\n                        {\n                            CasesID = C.CasesID,\n                            CaseComplaintID = C.ComplaintCodeID,\n                            ComplaintCode = C.ComplaintCode.ComplaintCodeName,\n                            ComplaintType = C.ComplaintCode.ComplaintType\n                        }).ToList();\n\n\n            return PartialView(\"_CaseComplaintCodes\", data);\n\n            }\n\n        return PartialView(\"_CaseComplaintCodes\");\n        }\n</code></pre>\n\n<p>I am trying to understand how to refresh my partial view after this action runs.</p>\n\n<p>Thx</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","entity-framework-4.3"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13122166,"title":"Defining foreign key in EF 4.3.1 Code first using TPH","body":"<p>I have created three different classes and one base class which store different types of addresses.\nBase class is postal address which has relation to User (to whom is current address attached) and Post, which contain information about zip code and city.</p>\n\n<pre><code>public class PostalAddress\n{\n    public virtual User User { get; set; }\n    public DateTime LastUsed { get; private set; }\n\n    public string OrientationNumber { get; set; }\n    public int UserId { get; set; }\n\n    public int PostId { get; set; }\n\n    public int Id { get; set; }\n    public virtual Post Post { get; private set; }\n\n    public string Street  { get; set; }\n}\n\npublic class Post\n{\n    public Post()\n    {\n        InvoicingAddresses = new List&lt;InvoicingAddress&gt;();\n        ShippingAddresses = new List&lt;ShippingAddress&gt;();\n        UserAddresses = new List&lt;UserAddress&gt;();\n    }\n\n    public virtual City City { get; set; }\n    public virtual ICollection&lt;InvoicingAddress&gt; InvoicingAddresses { get; private set; }\n    public virtual ICollection&lt;ShippingAddress&gt; ShippingAddresses { get; private set; }\n    public virtual ICollection&lt;UserAddress&gt; UserAddresses { get; private set; }\n    public int CityId { get; set; }\n    public int Id { get; set; }\n    public string ZipCode { get; set; }   \n}\n</code></pre>\n\n<p>Class PostalAddress is mapped using class PostalAddressMap</p>\n\n<pre><code>public class PostalAddressMap : EntityTypeConfiguration&lt;PostalAddress&gt;\n{\n    public PostalAddressMap()\n    {\n        // Primary Key\n        HasKey(t =&gt; t.Id);\n\n        // Properties\n        // Table &amp; Column Mappings\n        ToTable(\"PostalAddress\");\n        Property(t =&gt; t.Id).HasColumnName(\"Id\");\n        Property(t =&gt; t.LastUsed).HasColumnName(\"LastUsed\").HasColumnType(\"datetime2\");\n        Property(t =&gt; t.OrientationNumber).HasColumnName(\"OrientationNumber\");\n        Property(t =&gt; t.UserId).HasColumnName(\"UserId\");\n        Property(t =&gt; t.PostId).HasColumnName(\"PostId\");\n        Property(t =&gt; t.Street).HasColumnName(\"Street\");            \n\n        // Relationships\n        HasRequired(t =&gt; t.Post).WithMany(t =&gt; t.InvoicingAddresses).HasForeignKey(d =&gt; d.PostId);\n        HasRequired(t =&gt; t.User)\n            .WithMany(t =&gt; t.UserAddressess)\n            .HasForeignKey(d =&gt; d.UserId);\n\n\n    }\n}\n</code></pre>\n\n<p>Classes InvoicingAddress, ShippingAddress and UserAddress are inherited from PostalAddress class using <a href=\"http://weblogs.asp.net/manavi/archive/2010/12/24/inheritance-mapping-strategies-with-entity-framework-code-first-ctp5-part-1-table-per-hierarchy-tph.aspx\" rel=\"nofollow\">Table per hierarchy</a> approach. If I want to set relationships using line</p>\n\n<pre><code>        HasRequired(t =&gt; t.Post).WithMany(t =&gt; t.InvoicingAddresses).HasForeignKey(d =&gt; d.PostId);\n</code></pre>\n\n<p>I receive compiler error <strong>Cannot implicitly convert type 'System.Collections.Generic.ICollection&lt;InvoicingAddress&gt;' to 'System.Collections.Generic.ICollection&lt;PostalAddress&gt;'. An explicit conversion exists (are you missing a cast?)</strong></p>\n\n<p>Please, can you help me how can I set foreign key between PostalAddress child classes and other TPT types?</p>\n\n<p>Thank you for any helpful answer.</p>\n"},{"tags":["c#","sql-server-2008","entity-framework","exception-handling","foreign-keys"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":60,"score":0,"question_id":13123397,"title":"Getting INSERT statement conflicted with the FOREIGN KEY on SaveChanges()","body":"<p>I am new to working with the Entity Framework with SQL Server and I am having trouble inserting a record into my database. The problem is with 3 tables that are linked with primary keys and a foreign key and in the past I have not used databases with foreign keys.</p>\n\n<p>I am just trying to get some test data into the database for now but I keep getting the error: </p>\n\n<blockquote>\n  <p><em>INSERT statement conflicted with the FOREIGN KEY</em></p>\n</blockquote>\n\n<p>Can anyone help me get started with inserting into my database please? Here is the code I am using:</p>\n\n<pre><code>private void button3_Click(object sender, EventArgs e)\n{\n    TaxiDBEntities db = new TaxiDBEntities(); //connection to database\n    DriverStatus newDriverStatus = new DriverStatus(); // driver status object\n\n    /*populate the new driver object*/\n    //newDriverStatus.DriverID = Convert.ToInt32(driverComboBox.Text);\n    //newDriverStatus.Status = statusTextBox.Text;\n    //newDriverStatus.Area = areaTextBox.Text;\n\n    Driver driver = new Driver();\n\n    int driverIDInt = Convert.ToInt32(driverComboBox.Text);\n\n    //driver = db.Drivers.SingleOrDefault(p =&gt; p.DriverId == driverIDInt);\n    //if (driver == null)\n    //{\n        driver.DriverId = driverIDInt;\n        driver.Fname = \"test\";\n        driver.Lname = \"test\";\n    //}\n\n    db.DriverStatus.AddObject(newDriverStatus); // add driver object to entity model\n\n    DriverLog driverLog = new DriverLog();\n\n    driverLog.driverLogID = driverIDInt;\n    driverLog.DriverID = driverIDInt;\n    driverLog.date = DateTime.Now;\n\n    db.DriverLog.AddObject(driverLog);\n\n    DriverStatus driverStatus = new DriverStatus();\n\n    driverStatus.DriverID = driverIDInt;\n    driverStatus.Status = \"1\";\n    driverStatus.Area = \"1\";\n\n    db.DriverStatus.AddObject(driverStatus);\n\n    try\n    {\n        db.SaveChanges();\n    }\n    catch (Exception ex)\n    {\n        MessageBox.Show(ex.ToString());\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","context"],"answer_count":2,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":1143,"score":5,"question_id":5205606,"title":"EF Context Management","body":"<p>What is the best way to manage the context of Entity Framework when using MVC application?</p>\n\n<p>I am using a Repository/Service pattern.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>After looking through some of these questions: stackoverflow.com/users/587920/sam-striano, I am more confused then before. Some say use the context per repository, but wht if I want to use multiple repositories in one controller method?</p>\n\n<p>And to follow good separation design, how do you use UnitOfWork in the MVC app with out making it dependent on EF? I want to be able to unit test my controllers, model, services, etc. using a mock context?</p>\n"},{"tags":["c#","entity-framework","domain-driven-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12177875,"title":"DDD Database first . How to handle aggregates","body":"<p>I'm trying to learn the concept of DDD. I have made a project which i use the database first approach.\nIn the infrastructure i have added an edmx file witch i have chosen to auto generate the entites. Now in the \"Domain\" I'm trying to create aggregates.</p>\n\n<p>But here i got some problems. I´m trying to create a aggregate named \"User\" but User already exists in the entites that the ef autogenerated. Should i rename the aggregate \"User\" to something else and when getting data from the db map it from db entites to the aggregate.</p>\n\n<p>I'm doing it wrong ? Or shouldn't i autogenerate the entities or is the enties aggregates ?</p>\n\n<p>Plz advise and help.</p>\n\n<p><img src=\"http://i.stack.imgur.com/DXEz0.png\" alt=\"enter image description here\"></p>\n"},{"tags":["entity-framework","entity-framework-4","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13103358,"title":"How to write a dynamic where 'like' query in Entity framework?","body":"<p>Here is my code:</p>\n\n<pre><code>//order my baselist is context.Entity \npublic static GridData Getdata&lt;T&gt;(ObjectSet&lt;T&gt; baseList,\n    int currentPage,\n    int rowsPerPage,\n    string sortcolumn,\n    string sortord,\n    string searchQuery,\n    string searchColumns)where T: class{\nvar query = baseList.OrderBy(\"it.\" + sortcolumn + \" \" + sortord);\n        string strPredicate = string.Empty;\n        if (!string.IsNullOrEmpty(searchColumns))\n        {\n            strPredicate = \"it.\" + searchColumns + \" LIKE   @\" + searchColumns + \"  \";\n\n            query = baseList.Where(strPredicate, new ObjectParameter(searchColumns, searchQuery)).OrderBy(\"it.\" + sortcolumn + \" \" + sortord);\n        }\n}\n</code></pre>\n\n<p>My problem is i am trying to write down or form a like query in entity framework and seems like it does not support it.</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":168,"score":2,"question_id":12093135,"title":"Entity Framework concurrency issue using stored procedures","body":"<p>I am using ASP.NET to build a application for a retail company. I am using the Entity Framework (model-first) as my data access layer. I am using stored procedures to do my CRUD operations and all columns are mapped and seems to be correct as all CRUD functionality are working as expected. </p>\n\n<p>But I am having concurrency issues with the DELETE operation.</p>\n\n<p>I've added a <code>TimeStamp</code> column to the table I am doing the CRUD operation on. The UPDATE operation works fine as it is updating by primary key and the <code>TimeStamp</code> value. Thus if no rows are affected with the UPDATE operation, because of a change in the <code>TimeStamp</code> value, the Entity Framework throws a <code>OptimisticConcurrencyException</code>. </p>\n\n<p>The <code>DELETE</code> operation works on the same principle as it is deleting by primary key and the <code>TimeStamp</code> value. But no exception is thrown when the <code>TimeStamp</code> value does not match between the entity and the database.</p>\n\n<p>In the C# delete method I do retrieve the latest record first and then update the <code>TimeStamp</code> property to another <code>TimeStamp</code> value (It might be different to the retrieved value). After some investigation by using SQL Profiler I can see that the <code>DELETE</code> stored procedure is executed but the <code>TimeStamp</code> parameter that is passed to the stored procedure is the latest <code>TimeStamp</code> value <strong>and not the value that I have set the <code>TimeStamp</code> property to</strong>. Thus the record is deleted and the Entity Framework does not throw an exception.</p>\n\n<p>Why would the Entity Framework still pass the retrieved <code>TimeStamp</code> value to the Stored Procedure and not the value that I have assigned the property? Is this be design or am I missing something?</p>\n\n<p>Any help will be appreciated! (where is Julie Lerman when you need her! :-))</p>\n"},{"tags":["jquery",".net","asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13120862,"title":"ASP.net Dynamically add a table join and hook up existing table from user selection","body":"<p>I have a table that joins two together: table B contains key data that links table C to table A and retains the ability to have table C linked to any future table.</p>\n\n<p>I know how to create and add new entries of C based on user input and create table B from user input. However, to link table B to A and C, it requires input of the key data of A and C, then C 'exists in A'. From the users perspective, they want a clean interface, so they don't want to have to manually enter the key id of A and C when B is created.</p>\n\n<p>Instead, what I want is that the creation of the join table B is hidden and it appears they are just selecting C. So from a drop down list or multi box, they select their item, a new entry in B is added to the list&lt;> and the key data from A and C is assigned. </p>\n\n<p>With the inter-mixing of views and controllers, I am finding it very difficult getting this concept working and assigning to correct information.</p>\n\n<p>I have been following tutorials such as: <a href=\"http://www.asp.net/mvc/tutorials/javascript/working-with-the-dropdownlist-box-and-jquery/adding-a-new-category-to-the-dropdownlist-using-jquery-ui\" rel=\"nofollow\">http://www.asp.net/mvc/tutorials/javascript/working-with-the-dropdownlist-box-and-jquery/adding-a-new-category-to-the-dropdownlist-using-jquery-ui</a></p>\n\n<p>However this is very static.</p>\n\n<p>I will happily post my code, but it is pretty standard, Recipe is A, RecipeIngredient is B and Ingredient is C.</p>\n"},{"tags":["c#","mysql","linq","entity-framework","formatexception"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":13120426,"title":"Why is there an input string exception for a query without where clause?","body":"<p>Using ASP.NET MVC 2, Entity Framework, MySQL, VS2010 Ultimate. I have researched long but running out of clue for general Input Exception hit from my code. Although I have removed all the where clause:</p>\n\n<pre><code>var record = (from staff in pmsEntities.ef_staff                          \n                           select staff\n                           ).FirstOrDefault();\n</code></pre>\n\n<blockquote>\n  <p>[FormatException: Input string was not in a correct format.]    </p>\n\n<pre><code>System.Number.StringToNumber(String str, NumberStyles options, NumberBuffer&amp; number, NumberFormatInfo info, Boolean parseDecimal) +9594283    \nSystem.Number.ParseInt32(String s, NumberStyles style, NumberFormatInfo info) +119    \nSystem.String.System.IConvertible.ToInt32(IFormatProvider provider) +46    \nSystem.Convert.ChangeType(Object value, Type conversionType, IFormatProvider provider) +385   \nMySql.Data.Entity.EFMySqlDataReader.ChangeType(Object sourceValue, Type targetType) +566    \nMySql.Data.Entity.EFMySqlDataReader.GetValue(Int32 ordinal) +231    \nSystem.Data.Common.Internal.Materialization.ErrorHandlingValueReader`1.GetValue(DbDataReader reader, Int32 ordinal) +215    \nSystem.Data.Common.Internal.Materialization.Shaper.GetPropertyValueWithErrorHandling(Int32 ordinal, String propertyName, String typeName) +68    \nlambda_method(Closure , Shaper ) +1088    \nSystem.Data.Common.Internal.Materialization.Shaper.HandleEntityAppendOnly(Func`2 constructEntityDelegate, EntityKey entityKey, EntitySet entitySet) +218    \nlambda_method(Closure , Shaper ) +291    \nSystem.Data.Common.Internal.Materialization.Coordinator`1.ReadNextElement(Shaper shaper) +170    \nSystem.Data.Common.Internal.Materialization.SimpleEnumerator.MoveNext()  +84    \nSystem.Linq.Enumerable.FirstOrDefault(IEnumerable`1 source) +4187840    \nSystem.Data.Objects.ELinq.ObjectQueryProvider.&lt;GetElementFunction&gt;b__1(IEnumerable`1 sequence) +41    \nSystem.Data.Objects.ELinq.ObjectQueryProvider.ExecuteSingle(IEnumerable`1 query, Expression queryRoot) +59    \nSystem.Data.Objects.ELinq.ObjectQueryProvider.System.Linq.IQueryProvider.Execute(Expression expression) +150    \nSystem.Linq.Queryable.FirstOrDefault(IQueryable`1 source) +265    \nIDP.Models.Login.IsValid(String _username, String _pwd, Int32 _type) in C:\\Users\\george\\Desktop\\Um\\idp\\nur\\IDP\\IDP\\Models\\Login.cs:36\n</code></pre>\n</blockquote>\n"},{"tags":["c#","silverlight","entity-framework","domainservices"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13120252,"title":"DbGeography + entity framework 5 + Silverlight + DomainService","body":"<p>I have create Entity with DbGeography and add it to my Domainservice.\nBut my SL app didn't see this filed.\nHow can I use DbGeography in SL5 app?</p>\n"},{"tags":["entity-framework","entity-framework-4.1","ef-code-first","cascade"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13100690,"title":"Entity framework code first delete entities without parent","body":"<p>I have two entities Users and Phone. Relationship is one to one. Mapping is</p>\n\n<pre><code>public class User \n{\n    public virtual Phone Phone { get; set;}\n\n    public virtual int PhoneId { get; set;}\n}\n\npublic class Phone \n{\n    public virtual string Number { get; set;}\n}\n</code></pre>\n\n<p>My mapping for User is:</p>\n\n<pre><code>HasRequired(x =&gt; x.Phone).WithMany().HasForeignKey(x =&gt; x.PhoneId)\n</code></pre>\n\n<p>I have user with assigned phone.\nf.e.</p>\n\n<pre><code>Phone oldPhone = new Phone();\nPhone newPhone = new Phone();\nUser user = new User();\nuser.Phone = old;\n\n///Save user with phone.\n\nuser.Phone = newPhone;\n///Save user  with phone.\n</code></pre>\n\n<p>Now I have user with assigned phone - newPhone and not assigned oldPhone row in the DB.</p>\n\n<p>How can I setup mapping to delete entity without parent(oldPhone).</p>\n\n<p>EDITED.</p>\n\n<p>I have changed mapping according <a href=\"http://weblogs.asp.net/manavi/archive/2010/12/19/entity-association-mapping-with-code-first-one-to-one-shared-primary-key-associations.aspx\" rel=\"nofollow\">this</a> article to  </p>\n\n<pre><code> HasRequired(x =&gt; x.Phone).WithOptional();\n</code></pre>\n\n<p>For save I use this method:</p>\n\n<pre><code>public override void Save(TEntity entity)\n        {\n            if (entity == null)\n            {\n                throw new ArgumentNullException(\"entity\");\n            }\n\n            if (entity.Id &gt; 0)\n            {\n                DbContext.Set&lt;TEntity&gt;().Attach(entity);\n                DbContext.Entry(entity).State = System.Data.EntityState.Modified;\n            }\n            else\n            {\n                DbContext.Set&lt;TEntity&gt;().Add(entity);   \n            }            \n        } \n</code></pre>\n\n<p>When I attached new entity old ones doesn`t deleted from DB, so in my example I have two entities in DB oldPhone and newPhone. </p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13112219,"title":"Issues with Entity Framework Datetime Field and default values","body":"<p>Its properly because I do not understand completely, but I have had these issues a few days now. </p>\n\n<p>I have a datetime field and using entity framework.</p>\n\n<p>Scenarios:</p>\n\n<ol>\n<li><p>When I set the field to be computed (databasegenerated option) I cant update the field like this:</p>\n\n<pre><code>    db.ComputeUnites.Find(this._ComputeGuid).HeartBeat = DateTime.UtcNow;\n    db.SaveChanges();\n</code></pre></li>\n<li><p>When I don't set it to computed, and set it to required. I get an error when I try to add a new element that do not have the field set. (this makes sense, but I have set the default value on the server to set it to (<code>getutcdate()</code>)- so I hoped it would kick in when not set.</p></li>\n<li><p>I tried to set it to optional and with a default value again, then I can add new objects, but the default value is not used, instead 0:0:0 00:000 (don't remember the syntax correctly) times are inserted.</p></li>\n</ol>\n\n<p>What I would like is: When I do not set the field on a newly added object, the default value should be used. And if I provide or update the field, it should use the value coming from my c# class. </p>\n\n<p>What am I missing?</p>\n"},{"tags":["entity-framework","visual-studio-2012","redmine"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":13084415,"title":"EntityFramework tries to select a none existing column?","body":"<p>I have an issue and I just can't figure out what is causing the issue.</p>\n\n<p>I have a redmine database with a 'journals' table <a href=\"http://puu.sh/1iRIt\" rel=\"nofollow\">http://puu.sh/1iRIt</a>. \nUsing the Visual Studio 2012 plugin EntityFramework Power Tools this has been reverse engineered into the following class:</p>\n\n<pre><code>public class Journal\n    {\n        public int id { get; set; }\n        public int journalized_id { get; set; }\n        public string journalized_type { get; set; }\n        public int user_id { get; set; }\n        public string notes { get; set; }\n        public System.DateTime created_on { get; set; }\n    }\n</code></pre>\n\n<p>and the map:</p>\n\n<pre><code>public class JournalMap : EntityTypeConfiguration&lt;Journal&gt;\n    {\n        public JournalMap()\n        {\n            // Primary Key\n            this.HasKey(t =&gt; t.id);\n\n            // Properties\n            this.Property(t =&gt; t.journalized_type)\n                .IsRequired()\n                .HasMaxLength(30);\n\n            this.Property(t =&gt; t.notes)\n                .HasMaxLength(65535);\n\n            // Table &amp; Column Mappings\n            this.ToTable(\"journals\", \"redmine\");\n            this.Property(t =&gt; t.id).HasColumnName(\"id\");\n            this.Property(t =&gt; t.journalized_id).HasColumnName(\"journalized_id\");\n            this.Property(t =&gt; t.journalized_type).HasColumnName(\"journalized_type\");\n            this.Property(t =&gt; t.user_id).HasColumnName(\"user_id\");\n            this.Property(t =&gt; t.notes).HasColumnName(\"notes\");\n            this.Property(t =&gt; t.created_on).HasColumnName(\"created_on\");\n        }\n    }\n</code></pre>\n\n<p>Now when I try to perform a select on the journals database using LINQ:</p>\n\n<pre><code>return context.Journals.Where(c =&gt; c.journalized_id == task.id);\n\nI see that the following query is created:\n\n-       returnValue {SELECT\n`Extent1`.`id`, \n`Extent1`.`journalized_id`, \n`Extent1`.`journalized_type`, \n`Extent1`.`user_id`, \n`Extent1`.`notes`, \n`Extent1`.`created_on`, \n`Extent1`.`Issue_id`\nFROM `journals` AS `Extent1`\n WHERE `Extent1`.`journalized_id` = @p__linq__0}    \n\n\n System.Linq.IQueryable&lt;Synchronisation.Domain.Entities.Redmine.Journal&gt; {System.Data.Entity.Infrastructure.DbQuery&lt;Synchronisation.Domain.Entities.Redmine.Journal&gt;}\n</code></pre>\n\n<p>What I don't understand is where the \"Issue_id\" is coming from, this query is causing a EntityCommandExecutionException (Inner exception: {\"Unknown column 'Extent1.Issue_id' in 'field list'\"} )</p>\n\n<p>When I manually add the Issue_id column this problem is fixed (this fix must be reverted, no changes to the database structure are ment to be made)</p>\n\n<p>I have no clue where this \"Issue_id\" coming from, does anybody have an idea how to find this out?</p>\n\n<p>Cheers,\nRick</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13117331,"title":"Issue while updating the entry in the relational tables","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13116764/issue-with-updating-database-entity\">Issue with updating database entity</a>  </p>\n</blockquote>\n\n\n\n<p>I am working on the relational database with Entity FrameWork - 4.0. I am totally new for Entity FrameWork. I have 3 tables in my database with following relations :</p>\n\n<pre><code>         1   to   many       1   to  many\nCeremony -------------&gt; Menu ------------&gt; CourseOption\n</code></pre>\n\n<p>The problem is while updating the existing ceremony in the database. Suppose the <code>Ceremony</code> which i am going to update contains <code>1 menu</code> and <code>1 courseoption</code>. If i change the existing Menu and CourseOption property value than it works fine. Changes take place to the database correctly to the database. </p>\n\n<p><strong>Main Problem</strong> -> But if i add new Menu and CourseOption Or delete existing Menu and CourseOption than there will be no effect to database for this change.</p>\n\n<p><code>C#</code> code to update entry in the database :</p>\n\n<pre><code>db.Entry(ceremony).State = EntityState.Modified;\n</code></pre>\n\n<p>What i am missing ?</p>\n"},{"tags":["mysql","entity-framework","visual-studio-2012"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1246,"score":1,"question_id":11885645,"title":"Is MySQL Entity supported in Visual Studio Ultimate 2012 RC?","body":"<p>I installed  <a href=\"http://www.mysql.com/downloads/connector/net\" rel=\"nofollow\">MySQL connector for .Net v6.5</a> and it is supported by Entity Framework. When I use Visual Studio 2012 and try to add an ADO.NET Entity Data Model, I can't see MySQL. There are just Microsoft SQL Servers. It worked in VS 2010.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/10914894/entity-framework-5-0-entityobject-generator-not-available-in-visual-studio-2012\">This question</a> said that they are working on it - is there a conclusion?</p>\n"},{"tags":["sql-server-2008","entity-framework","views"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12239833,"title":"entity framework view does not show all rows when selecting","body":"<p>I have a regular view in sql server 2008 and I`m using entity framework generate design from database approach. I already know about the keys issues for views in entity framework but that is not my solution. When I  query select * from view, it brings out 3 rows which is right, but all the rows are the same and are the first row in the database view.</p>\n\n<p>some help would be very appreciated.</p>\n"},{"tags":["entity-framework","transactions"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":303,"score":2,"question_id":5044431,"title":"Entity Framework - Generic Transaction Methods","body":"<p>We're currently using transactions with the Entity Framework, but might be switching to some other ORM in the future.  What's the best way to implement the following...</p>\n\n<pre><code>BeginTransaction();\n\n//Some update/insert/delete operations here\nentity.Name = \"Joe\";\nSaveChanges();\n\nEndTransaction();\n</code></pre>\n\n<ul>\n<li>We don't want to use the \"using\" statement</li>\n<li>We need it to work with nested transactions</li>\n</ul>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12946512,"title":"Entity Framework updating [Timestamp] property on parent entity unexpectedly","body":"<p>I'm using Entity Framework 5.0 (for .NET 4) and making use of the <strong>TimestampAttribute</strong> for optimistic concurrency checking. However I'm seeing strange/unexpected behavior where the version/timestamp of parent entities are updated as a result only of their children being updated.</p>\n\n<p>This is best explained through example code.</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel.DataAnnotations;\nusing System.Data.Entity;\nusing System.Linq;\n\nnamespace ConsoleApplication1\n{\n    public abstract class Entity\n    {\n        public int Id { get; set; }\n        public string Name { get; set; }\n\n        /*[ConcurrencyCheck]\n        [DatabaseGenerated(DatabaseGeneratedOption.Computed)]\n        [Column(TypeName = \"rowversion\")]*/\n        [Timestamp]\n        public byte[] Version { get; set; }\n    }\n\n    public class Parent : Entity\n    {\n        public virtual List&lt;Child&gt; Children { get; set; }\n    }\n\n    public class Child : Entity\n    {\n        public virtual Parent Parent { get; set; }\n        // Uncommenting property below causes the parent version to be unexpectedly updated when its child is updated.\n        // This occurs regardless of whether the Version property is decorated with [Timestamp] or [ConcurrencyCheck].\n        //public int? ParentId { get; set; }\n    }\n\n    public class TestDbContext : DbContext\n    {\n        public DbSet&lt;Parent&gt; Parents { get; set; }\n        public DbSet&lt;Child&gt; Children { get; set; }\n    }\n\n    internal class Program\n    {\n        private static void Main(string[] args)\n        {\n            Database.SetInitializer(new DropCreateDatabaseIfModelChanges&lt;TestDbContext&gt;());\n            var child = new Child {Name = \"Child\"};\n            var parent = new Parent {Name = \"Parent\", Children = new List&lt;Child&gt; {child}};\n            using (var context = new TestDbContext())\n            {\n                context.Parents.Add(parent);\n                context.SaveChanges();\n                var originalParentVersion = parent.Version.ToArray();\n                child.Name = \"New Child Name\";\n                context.SaveChanges();\n                if (!originalParentVersion.SequenceEqual(parent.Version))\n                    throw new Exception(\"Not expected\");\n            }\n            Console.Write(\"Press any key to exit.\");\n            Console.ReadKey();\n        }\n    }\n}\n</code></pre>\n\n<p>If I run this simple console application as is, the 'Not expected' exception is not thrown. However, if I uncomment the ID foreign key property (ParentID) then the exception will be thrown.</p>\n\n<p>Can anyone explain this strange behavior? Is this a bug?</p>\n"},{"tags":["asp.net","asp.net-mvc","asp.net-mvc-3","entity-framework","poco"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13113566,"title":"Asp.net mvc, entity framework, Poco - Architecture","body":"<p>I have a \"small\" enterprise application, aspnet mvc 3 + entity framework with POCO entity and repository pattern. I structured the solution in 4 projects:</p>\n\n<ol>\n<li>POCO entities</li>\n<li>Domain model</li>\n<li>Services</li>\n<li>web application</li>\n</ol>\n\n<p>When the application performs a query on the database, use one of the services provided, the service uses the repository and the small classes, as a result I have some dynamic proxy objects that I would like to convert in my domain entities, before using them in mvc views, but I do not know how. Dovrebber be set as the translator?</p>\n\n<p>This approach is reasonable?</p>\n"},{"tags":["c#","asp.net","database","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1901,"score":0,"question_id":8978367,"title":"A database with the same name exists, or specified file cannot be opened, or it is located on UNC share. what does it means?","body":"<p>I Build an ASP.NET project with PL,BL,DAl, BE of Entity Data Model(=.edmx) which I generated from a service Based DB (= .mdf) which is located in my DAL project.</p>\n\n<p>I did copied the connectionString from the BE app.config to the PL web.config</p>\n\n<p><strong>what's wrong? why I get this error:</strong></p>\n\n<blockquote>\n  <p>System.Data.SqlClient.SqlException: An attempt to attach an auto-named\n  database for file C:\\Documents and Settings\\user\\שולחן העבודה\\למידה\n  אישית\\Lev\\Lev\\App_Data\\Midrasha.mdf failed. A database with the same\n  name exists, or specified file cannot be opened, or it is located on\n  UNC share.</p>\n</blockquote>\n\n<p>my code logic is PL->BL->DAL- > try to save the new object to the DB.\nthe code line which generate the problem is :</p>\n\n<pre><code>public void AddFeedback(Feedback feed)\n{\n    MidrashaEntities _context = new MidrashaEntities();\n    _context.Feedback.AddObject(feed);\n    _context.SaveChanges();  &lt;-------throw the exception\n}\n</code></pre>\n\n<p><code>Feedback</code> is a table in my DAL's SQL which I generate as Object entity.</p>\n"},{"tags":[".net","entity-framework","architecture","domain-driven-design"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":125,"score":0,"question_id":13067650,"title":"Bounded (Db)Contexts in Entity Framework Architecture","body":"<p>I have just watched Julie Lermans videos about using bounded contexts in EF (http://www.pluralsight.com/training/Courses/TableOfContents/efarchitecture) and I am now trying to work out the best way of implementing it (using POCOs). The two options I see are to either have one edmx model that defines everything and then handcraft the DbContexts to include the appropriate entities, or to have separate edmx models for each context and use the automatically created DbContexts.</p>\n\n<p>Has anyone any ideas of which is best or any pros/cons of either?</p>\n\n<p>IMHO: \nFor a single model it is a lot less classes and a lot more code re-use (though these classes are created automatically so really it will only be the extra functionality that will manually be duplicated), but I will have a lot of classes in one place and for classes that need to be specialised these will each have to have different names. E.g. Customer, CustomerForFunctionalityX, CustomerForFunctionalityB.</p>\n\n<p>With the separate models I can be much more stringent on what goes into a context as removing a property doesn't need to be a completely new entity, and I can name everything as I wish (i.e. all models can use a Customer object even if it differs between models), but now each context has entirely different entities even if they are all just mapping to the same table - which can also make it more difficult to pass them between contexts (this however shouldn't be needed too often otherwise it means the contexts have been defined wrong).</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-4","authorize"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":1,"view_count":111,"score":1,"question_id":13106487,"title":"Data level Authorization filter in ASP.Net MVC Entity Framework application","body":"<p>I was looking for a data level Authorization filter in my ASP.Net MVC 4 Application.<br>\nWe are using Entity Framework for Data access.</p>\n\n<p>The application need to display all the data but should restrict the access to certain fields in a table based on the user roles.</p>\n\n<p>eg: TASK table\n{\nint Id,\nstring TaskName,\nDateTime StartDate,\nDateTime EndDate\n}</p>\n\n<p>This whole data will be displayed to all the users and users have the options to edit the fields also. But should restrict the edit options like as follows<br>\nRole Admin can edit all the fields<br>\nRole Manager can Edit TaskName but cannot edit StartDate and EndDate<br>\nRole Users cannot Edit any of the fields  </p>\n\n<p>All these edit will be calling the Edit action in the TaskController.</p>\n\n<p>How can I implement the functionality in my application.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13114311,"title":"Entity Framework automatically assigns foreign key ?","body":"<p>I've come accross the following \"issue\" (it might just be a feature but that would be quite a strange one). Using Entity Framework 5, when inserting an entity without specifying the linked entity through foreign key, EF automatically assigns the value to the related entity (if inserted at the same moment. </p>\n\n<p>Alright, that's not very clear, so here's some code that reproduces the behavior :</p>\n\n<pre><code>[TestClass]\npublic class TestEntityFramework\n{\n    [TestMethod]\n    public void Test()\n    {\n        using (var context = new TestDataContext())\n        {\n            context.Foos.Add(new Foo { FooProp = \"FooProp\"});                \n            context.Bars.Add(new Bar {BarProp = \"BarProp\"});                \n            context.SaveChanges();\n        }\n    }       \n}\n\n\npublic class Foo\n{\n    [Key]\n    public int Id { get; set; }\n\n    public string FooProp { get; set; }\n}\n\npublic class Bar\n{\n    [Key]\n    public int Id { get; set; }\n\n    public int FooId { get; set; }\n    [ForeignKey(\"FooId\")]\n    public virtual Foo Foo { get; set; }\n\n    public string BarProp { get; set; }\n}\n\npublic class TestDataContext : DbContext\n{      \n    public virtual IDbSet&lt;Foo&gt; Foos { get; set; }\n    public virtual IDbSet&lt;Bar&gt; Bars { get; set; }        \n}\n</code></pre>\n\n<p>The Test method surprisingly works, no conflict.</p>\n\n<p>The Bar entity inserted gets linked to the Foo entity inserted at the same time even though I didn't specify it. </p>\n\n<p>However following codes both raises foreign key exceptions :</p>\n\n<pre><code>[TestMethod]\npublic void Test()\n{\n    using (var context = new TestDataContext())\n    {\n        context.Foos.Add(new Foo { FooProp = \"FooProp\"});\n        context.SaveChanges();\n        context.Bars.Add(new Bar {BarProp = \"BarProp\"});                \n        context.SaveChanges();\n    }\n}\n\n[TestMethod]\npublic void Test2()\n{\n    using (var context = new TestDataContext())\n    {\n        context.Foos.Add(new Foo { FooProp = \"FooProp\" });\n        context.Foos.Add(new Foo { FooProp = \"FooProp2\" });                \n        context.Bars.Add(new Bar { BarProp = \"BarProp\" });\n        context.SaveChanges();\n    }\n}     \n</code></pre>\n\n<p>Anyone knows if that behavior is expected ? Any thoughts ?</p>\n\n<p>Thanks </p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13114377,"title":"MVC Business logic helper","body":"<p>I have some common functions that apply throughout my application to update particular parts of the database when actions happen (Audit trail, modified dates etc). I'll use AuditTrail as an example.</p>\n\n<p><strong>Where should I be storing these functions?</strong></p>\n\n<p>Currently I am storing them in dbcontext classes</p>\n\n<pre><code>//... my db context class ...\n\npublic bool AddAuditEntry(int ID, string objectName)\n{\n    // Here I create a new AuditTrail object, assign values then insert into db.\n    // This mode doesn't have a controller.\n}\n\n// We also have a table that keeps track of modified state for \n// client side caching (nothing I have control over)\npublic bool ModifyObject(int ID)\n{\n    // Here I mark the object id with modified date then save to db\n    // This particular model doesn't have a controller either.\n}\n</code></pre>\n\n<p>I think they should belong in the model but I'm not quite sure how to implement it. Putting them in the controller isn't the best option as some of these relate only to a particular model class that may have no controller.</p>\n\n<p>My problem with them being in the model is what then is the best way to update entities?</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13113868,"title":"Does Entity Framework return the Entire Dataset?","body":"<p>Using:</p>\n\n<ul>\n<li><p>.Net 4.0</p></li>\n<li><p>EntityFramework 4.3</p></li>\n</ul>\n\n<p>IF I query a DBSet in this manner:</p>\n\n<pre><code>public DbSet&lt;Reciept&gt; Reciepts { get; set; }\nReciepts.Where(rec =&gt;rec.Number == reciept.Number &amp;&amp;\n                        rec.Project.ID == reciept.Project.ID);\n</code></pre>\n\n<p>Will the entire table be returned, and THEN filterd by my query?</p>\n\n<p>Or does it somehow translate this into SQL (Linq2SQL?), and return ONLY those rows?</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13109284,"title":"EF Code First: how to fix relationships using the fluent api","body":"<p>I've got a simple data model described with Enitity Framework but still can't fix a problem with the relationships in my model.\nI've tried some approaches using the Fluent API but always got non descriptive exceptions.</p>\n\n<p>Here's a code:</p>\n\n<pre><code>public abstract class Entity\n{\n    [Key, Column(Order = 1)]\n    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Int32 Id { get; set; }\n}\n\npublic class Language : Entity\n{\n    [Key, Column(Order = 2)]\n    public String Verbal { get; set; }\n\n    public virtual ICollection&lt;PostContent&gt; Contents { get; set; }\n}\n\npublic class Post : Entity\n{\n    public virtual ICollection&lt;PostContent&gt; Contents { get; set; }\n}\n\npublic class PostContent\n{\n    [Key, Column(Order = 1)]\n    public Int32 PostId { get; set; }\n\n    [Key, Column(Order = 2)]\n    public Int32 LanguageId { get; set; }\n\n    [ForeignKey(\"PostId\")]\n    public virtual Post Post { get; set; }\n\n    [ForeignKey(\"LanguageId\")]\n    public virtual Language Language { get; set; }\n\n    public String Content { get; set; }\n}\n\npublic class BlogContext : DbContext\n{\n    public DbSet&lt;Language&gt; Languages { get; set; }\n    public DbSet&lt;Post&gt; Posts { get; set; }\n    public DbSet&lt;PostContent&gt; PostContents { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        base.OnModelCreating(modelBuilder);\n    }\n}\n\npublic class BlogContextInitializer : DropCreateDatabaseIfModelChanges&lt;BlogContext&gt;\n{\n    protected override void Seed(BlogContext context)\n    {\n        //For test\n        context.Languages.Add(new Language { Verbal = \"Italian\" });\n        context.Languages.Add(new Language { Verbal = \"English\" });\n        context.SaveChanges();\n    }\n}\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        Database.SetInitializer&lt;BlogContext&gt;(new BlogContextInitializer());\n\n        using (BlogContext blogContext = new BlogContext())\n        {\n            //init on call.\n            var langs = blogContext.Set&lt;Language&gt;().AsEnumerable();\n            foreach (var lang in langs)\n            {\n                Console.WriteLine(\"Language Id: {0}, Verbal: {1}\", lang.Id, lang.Verbal);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I got:</p>\n\n<blockquote>\n  <p>\"The number of properties in the Dependent and Principal Roles in a\n  relationship constraint must be identical.\"</p>\n</blockquote>\n\n<p>So I'm looking for a solution of this problem.</p>\n"},{"tags":["entity-framework","c#-4.0","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13109589,"title":"How can I return DbSet<Entity> AsQueryable<EntityBase> in MVC4 api controller?","body":"<p>I am using MVC4 and entity framework. I would like to have ApiController called UserController to query users based on their properties.\nMy User entity has properties like name, phone number, address (complex type) and it should be possible to query and retrieve users based on this data. But user has also properties like password, lastsync, etc. which I do not want to be visible. Currently I don't have a solution. The following gives me the users, but with all the entities, also the ones I don't want to show.</p>\n\n<pre><code>public class UserController : BaseApiController\n{\n    public IQueryable&lt;User&gt; Get()\n    {\n        // _db is my entity framework DbContext\n        return _db.Users; \n    }\n}\n</code></pre>\n\n<p>I thought I would move all the \"publicly\" visible properties to ApiUser class and make User derive from ApiUser. Then my idea was to do like this:</p>\n\n<pre><code>public class UserController : BaseApiController\n{\n    public IQueryable&lt;ApiUser&gt; Get()\n    {\n        return _db.Users.AsQueryable&lt;ApiUser&gt;(); \n    }\n}\n</code></pre>\n\n<p>This unfortunately does not work I get the following exception:</p>\n\n<pre><code>[InvalidOperationException: The type Repository.User was not expected. Use the XmlInclude or SoapInclude attribute to specify types that are not known statically.]\n   Microsoft.Xml.Serialization.GeneratedAssembly.XmlSerializationWriterDelegatingEnumerable1.Write2_ApiUser(String n, String ns, ApiUser o, Boolean isNullable, Boolean needType) +171\n   Microsoft.Xml.Serialization.GeneratedAssembly.XmlSerializationWriterDelegatingEnumerable1.Write3_ArrayOfApiUser(Object o) +297\n</code></pre>\n\n<p>Do you know how I can achieve what I need?</p>\n"},{"tags":["entity-framework","ef-code-first","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13111971,"title":"EF 5.0 Code first EF Tracing with DBContext","body":"<p>I've a project using code first approach and EntityFramework 5.0 and im willing to add <a href=\"http://code.msdn.microsoft.com/EFProviderWrappers\" rel=\"nofollow\">tracing</a>  but haven't gone far, i've read <a href=\"http://stackoverflow.com/questions/12535079/how-to-configure-ef-tracing-provider-for-ef-code-first\">this link</a> but im unable to make it work using DbContext approach. Original EF Tracing/Caching was written using ObjectContext and after reading thru lots of pages i still can't figure out how to make it work properly. In the link provided above, i'm getting an error not finding NorthwindContext. </p>\n\n<p>Can someone provide some insight on where and how to compile a working solution using EFTracing with DBContext? A code Sample would be a huge help.</p>\n\n<p>Thanks,\nRicardo</p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":1214,"score":6,"question_id":2097947,"title":"Entity Framework: Setting update timestamp","body":"<p>All of our database tables have UpdateUserID and UpdateTS.  I'd like to have this set if my entity has changes.  Is there a way I can have this update on the spot conditionally?  </p>\n\n<p>If I manually set UpdateTS in code, then it will say that my entity has changed and will always update the object.</p>\n"},{"tags":["entity-framework","unit-testing","moq"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13072860,"title":"How do you mock adding items to a repository or DbContext using moq?","body":"<p>The examples I've seen for using moq for a repository only show how to mock things being returned. I have a somewhat strange requirement: when a query is executed, if a condition exists, a certain item should be added to the repository. I am wondering how to test this without querying the database. I know how to mock the condition existing, but then how do you setup the mock so that you can test that the certain item is added?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","iis","asp.net-mvc-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13112802,"title":"Deploying MVC 4 Application with Entity Framework","body":"<p>I've created an mvc application. I used entity framework to work with database. When I tested my application, I filled my database with some data through web interface of my application. When I deploy app on IIS server and copy .sdf file to deployed app's folder I get the error:</p>\n\n<blockquote>\n  <p>Access to the database file is not allowed. [ 1914,File name = C:\\last_project\\published\\App_Data\\Data.sdf,SeCreateFile ]</p>\n</blockquote>\n\n<p>How I can get working database in my deployed app?</p>\n"},{"tags":["entity-framework","import","loops","performance","savechanges"],"answer_count":3,"favorite_count":15,"up_vote_count":12,"down_vote_count":0,"view_count":5080,"score":12,"question_id":1930982,"title":"When should I call SaveChanges() when creating 1000's of Entity Framework objects? (like during an import)","body":"<p>I am running an import that will have 1000's of records on each run.  Just looking for some confirmation on my assumptions:</p>\n\n<p>Which of these makes the most sense:</p>\n\n<ol>\n<li>Run <code>SaveChanges()</code> every <code>AddToClassName()</code> call.</li>\n<li>Run <code>SaveChanges()</code> every <em>n</em> number of <code>AddToClassName()</code> calls.</li>\n<li>Run <code>SaveChanges()</code> after <em>all</em> of the <code>AddToClassName()</code> calls.</li>\n</ol>\n\n<p>The first option is probably slow right?  Since it will need to analyze the EF objects in memory, generate SQL, etc.</p>\n\n<p>I assume that the second option is the best of both worlds, since we can wrap a try catch around that <code>SaveChanges()</code> call, and only lose <em>n</em> number of records at a time, if one of them fails.  Maybe store each batch in an List&lt;>.  If the <code>SaveChanges()</code> call succeeds, get rid of the list.  If it fails, log the items.</p>\n\n<p>The last option would probably end up being very slow as well, since every single EF object would have to be in memory until <code>SaveChanges()</code> is called.  And if the save failed nothing would be committed, right?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","view","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13112035,"title":"MVC4 Model in View issue: in debug mode Model is missing details","body":"<p>I encountered a very strange (and annoying) issue:\nin MVC 4 web application while loading data from the database and using a foreach on the Model within the view:</p>\n\n<pre><code>@foreach (var meeting in Model)\n</code></pre>\n\n<p>i have a breakpoint in the method's beginning and examining the object meeting i see that it misses some data (reference to other tables). if I open (+) other object within meeting the missing data appears.</p>\n\n<p>Why?</p>\n\n<p>Thanks!</p>\n\n<p>here is my controller method:</p>\n\n<pre><code>        public ActionResult GetMeetingMR(int id = 0)\n    {\n        var meetingPurpose = db.MeetingPurposes.ToList();\n        ViewBag.MeetingPurpose = new SelectList(meetingPurpose, \"MeetingPurposeID\", \"MeetingPurposeName\");\n        ViewBag.MRID = id;\n        List&lt;Meeting&gt; meetings = (db.MortgageRequests.Find(id)).Meetings.ToList();\n        return View(meetings);\n\n    }\n</code></pre>\n"},{"tags":["c#","asp.net",".net","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13109684,"title":"Entity Framework Code First Error - EntityType 'Variable' has no key defined","body":"<p>I'm using Entity Framework 5 Code First in an ASP.NET MVC 4 project and I'm getting the following error:</p>\n\n<blockquote>\n  <p>One or more validation errors were detected during model generation:</p>\n  \n  <p>\\tSystem.Data.Entity.Edm.EdmEntityType: : EntityType 'Variable' has no key defined. Define the key for this EntityType.\n  \\tSystem.Data.Entity.Edm.EdmEntitySet: EntityType: EntitySet 'Variables' is based on type 'Variable' that has no keys defined.</p>\n  \n  <p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n  \n  <p>Exception Details: System.Data.Entity.ModelConfiguration.ModelValidationException: One or more validation errors were detected during model generation:</p>\n  \n  <p>\\tSystem.Data.Entity.Edm.EdmEntityType: : EntityType 'Variable' has no key defined. Define the key for this EntityType.\n  \\tSystem.Data.Entity.Edm.EdmEntitySet: EntityType: EntitySet 'Variables' is based on type 'Variable' that has no keys defined.</p>\n</blockquote>\n\n<p>This has been driving me nuts for the last hour. I have searched my solution and have nothing called 'Variable' at all!</p>\n\n<p>My context looks like this:</p>\n\n<pre><code>public class MyContext : DbContext, IDisposedTracker\n{\n\n    public DbSet&lt;Project&gt; Projects { get; set; }\n\n    public bool IsDisposed { get; set; }\n}\n</code></pre>\n\n<p>My model looks like this:</p>\n\n<pre><code>public class Project\n{\n    [Key]\n    public int Uid { get; set; }\n\n    public string Id { get; set; }\n\n    public string Name { get; set; }\n\n    public string Description { get; set; }\n\n    public List&lt;Task&gt; Tasks { get; internal set; }\n}\n</code></pre>\n\n<p>Task looks like this:</p>\n\n<pre><code>public class Task\n{\n    [Key]\n    public int Uid { get; set; }\n\n    public string Id;\n\n    public string Name;\n}\n</code></pre>\n"},{"tags":[".net","database","entity-framework","mvc","c#-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1563,"score":1,"question_id":6073623,"title":"Entity Framework Enums as POCO only","body":"<p>I am trying to save an Enum that exists in my model down to the database but everytime I do Entity Framwework complains that there is no look up table associated with the Enum. I do not want a look up table, I just want the enum to exist in code and be stored as integers in the database.</p>\n\n<blockquote>\n  <p>An error occurred while saving\n  entities that do not expose foreign\n  key properties for their\n  relationships. The EntityEntries\n  property will return null because a\n  single entity cannot be identified as\n  the source of the exception. Handling\n  of exceptions while saving can be made\n  easier by exposing foreign key\n  properties in your entity types. See\n  the InnerException for details.</p>\n  \n  <p>\"Cannot insert the value NULL into\n  column 'Type', table\n  'Test.dbo.Interests'; column\n  does not allow nulls. INSERT\n  fails.\\r\\nThe statement has been\n  terminated.</p>\n</blockquote>\n\n<p>The value for Type is definitely not null, EF just treats it that way cause it can't find a Foreign key table that I don't want in the first place. </p>\n\n<p><strong>How do I get entity framework to treat my enum as an int and then convert back out when I call down to the database to retrieve my model?</strong></p>\n"},{"tags":[".net","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":439,"score":1,"question_id":11101148,"title":"Entity Framework 5 Enums with Description attribute using Database First","body":"<p>I would like to something like this:</p>\n\n<pre><code>public enum States\n{\n    California,\n    [Description(\"New Mexico\")]\n    NewMexico,\n    [Description(\"New York\")]\n    NewYork,\n    [Description(\"South Carolina\")]\n    SouthCarolina,\n    Tennessee,\n    Washington\n}\n</code></pre>\n\n<p>So that when I'm making a Drop Down List using .NET MVC I can use spaces in my names. If I used Code First then I could do this but I am using Database First and the .edmx designer doesn't allow attributes on the generated states (as far as I know!). Any ideas on how I can do this? I am using .NET 4.5 and EF 5 beta.</p>\n"},{"tags":["c#","wcf","entity-framework","iis","serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":11039450,"title":"StackOverflowException serializing STE EF object graph","body":"<p>We have a .NET 4, WPF, WCF, EF 4, SQL 2008 application. One of our EF models is highly relational and in the case I'm describing could and probably does contain cycles. I've been asked to troubleshoot a case in the field where all of a sudden data from this STE EF model quit showing up in the WPF client. Upon closer examination, I found that the IIS W3WP process crashes when trying to retrieve (serialize) the STE EF object graph. I used Debug Diagnostics to capture the crash.</p>\n\n<p>When I looked at the generated crash report, I discovered it was a stack overflow exception (how appropriate). The stack trace in the crash report is rather large, but the top of the stack looks something like:</p>\n\n<pre><code>System.Xml.XmlBaseWriter.StartElement(System.String ByRef, System.String, System.String, System.Xml.XmlDictionaryString) \nSystem.Xml.XmlBaseWriter.WriteStartElement(System.String, System.Xml.XmlDictionaryString, System.Xml.XmlDictionaryString) \nSystem.Runtime.Serialization.XmlWriterDelegator.WriteStartElement(System.String, System.Xml.XmlDictionaryString, System.Xml.XmlDictionaryString) \nDynamicClass.WriteXXXDataToXml(System.Runtime.Serialization.XmlWriterDelegator, System.Object, System.Runtime.Serialization.XmlObjectSerializerWriteContext, System.Runtime.Serialization.ClassDataContract) \nSystem.Runtime.Serialization.ClassDataContract.WriteXmlValue(System.Runtime.Serialization.XmlWriterDelegator, System.Object, System.Runtime.Serialization.XmlObjectSerializerWriteContext) \nSystem.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(System.Runtime.Serialization.DataContract, System.Runtime.Serialization.XmlWriterDelegator, System.Object, System.RuntimeTypeHandle) \nSystem.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(System.Runtime.Serialization.XmlWriterDelegator, System.Object, Boolean, Boolean, Int32, System.RuntimeTypeHandle) \nSystem.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerializeReference(System.Runtime.Serialization.XmlWriterDelegator, System.Object, Boolean, Boolean, Int32, System.RuntimeTypeHandle) \n</code></pre>\n\n<p>What makes exceptionally odd is that when the WCF service is hosted in Visual Studio and I run from the dev environment, the serialization works perfectly, and I get data on the client.</p>\n\n<p>Could this be resolved by IIS settings? Why would it work with Visual Studio's dev IIS, but not with the production IIS?</p>\n\n<p>I'm not sure what is causing this problem or why the serializer is even barfing? </p>\n\n<p>Should I try another means of WCF serialization w/ STE EF4?</p>\n\n<p>Any input is appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":["silverlight","entity-framework","ef-code-first","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":13098862,"title":"Ria Services : Use Entity Framework Code First Classes From Another Project","body":"<p>I have a solution with this structure : </p>\n\n<blockquote>\n  <p><br> ProjectName.Domain ==> contains POCO classes (EntityFramework\n  code first classes) <br> ProjectName.DataAccess ==> contains DbContext\n  and EntityFramework mapping codes. <br> ProjectName.Task ==> It's my\n  bushiness layer . <br> ProjectName.Presnetation.MvcClient ==> It's\n  ASP.NET MVC web client. <br>\n  ProjectName.Presentation.SilverlightClient ==> It's Silverlight 5\n  client. <br> ProjectName.WCFRiaClassLibrary ==> It's layer between\n  business logic and Silverlight client</p>\n</blockquote>\n\n<p>I've decided to handle logic such as queries and CRUD operations in business logic and use ProjectName.Task in domain service class. <br> </p>\n\n<p>I can't find any sample that use EF code first approach and load entities from another project , can you please help or give me link ? because when I try to create my DomainService class without wizard I can't find generated proxy classes in silverlight client project . \nI'm doing something like this : </p>\n\n<pre><code>    [EnableClientAccess()]\n    public class CrudService : DomainService\n     {\n    private readonly IEntityTask _entityTask;\n\n    public CrudService(IEntityTask entityTask)\n    {\n        _entityTask = entityTask;\n    }\n\n    public IQueryable&lt;Entity&gt;  GetAll ()\n    {\n       return _entityTask.GetAll().AsQueryable();\n    }\n    }\n</code></pre>\n\n<p>Is this possible to use code first classes from another project with WCF Ria Service ? <br>\nWhat is wrong with my approach?</p>\n"},{"tags":["silverlight","entity-framework","ef-code-first","wcf-ria-services","silverlight-5.0"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":222,"score":5,"question_id":13059127,"title":"EF5 Code First and RIA Services Silverlight \"Object reference not set to an instance of an object\" error building client","body":"<p>I am working on setting up a new project using Code First for entity framework 5 in silverlight using RIA services.  I have created a test project due to some issues I have encountered and will post the code below.  </p>\n\n<p>Namely, I get an 'Object reference not set to an instance of an object' error anytime I attempt to build the silverlight client project which should generate the client proxy classes.  </p>\n\n<p>Just to be clear, this error is not while running or debugging the application, but when building it.</p>\n\n<p>I have isolated that this only happens if I have any navigation properties/Foreign Keys defined on my Code First classes.</p>\n\n<p>Any help tonight would be greatly appreciated.</p>\n\n<pre><code>    public class Person\n{\n    public int PersonId { get; set; }\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public DateTime? BirthDate { get; set; }\n\n    public virtual List&lt;Character&gt; Characters { get; set; }\n}\n\npublic class Character\n{\n    public int CharacterId { get; set; }\n    public int PersonId { get; set; }\n    public virtual Person Person { get; set; }\n    public string CharacterName { get; set; }\n}\n\npublic class CharacterDbContext : DbContext\n{\n    public DbSet&lt;Person&gt; Persons { get; set; }\n    public DbSet&lt;Character&gt; Characters { get; set; }\n\n    public CharacterDbContext()\n    {\n        if (HttpContext.Current == null)\n        {\n            Database.SetInitializer&lt;CharacterDbContext&gt;(null);\n        }\n    }\n}\n\n[EnableClientAccess]\npublic class CharacterDbService : DbDomainService&lt;CharacterDbContext&gt;\n{\n    #region Basic Methods for Person with the context property of Persons\n\n    [Query]\n    public IQueryable&lt;Person&gt; GetPersons()\n    {\n        return DbContext.Persons;\n    }\n\n    [Insert]\n    public void InsertPerson(Person entity)\n    {\n        DbEntityEntry&lt;Person&gt; entityEntry = DbContext.Entry(entity);\n        if (entityEntry.State != EntityState.Detached)\n        {\n            entityEntry.State = EntityState.Added;\n        }\n        else\n        {\n            DbContext.Persons.Add(entity);\n        }\n    }\n\n    [Update]\n    public void UpdatePerson(Person entity)\n    {\n        DbContext.Persons.AttachAsModified(entity, ChangeSet.GetOriginal(entity), DbContext);\n    }\n\n    [Delete]\n    public void DeletePerson(Person entity)\n    {\n        DbEntityEntry&lt;Person&gt; entityEntry = DbContext.Entry(entity);\n        if (entityEntry.State != EntityState.Deleted)\n        {\n            entityEntry.State = EntityState.Deleted;\n        }\n        else\n        {\n            DbContext.Persons.Attach(entity);\n            DbContext.Persons.Remove(entity);\n        }\n    }\n\n    #endregion\n\n    #region Basic Methods for Character with the context property of Characters\n\n    [Query]\n    public IQueryable&lt;Character&gt; GetCharacters()\n    {\n        return DbContext.Characters;\n    }\n\n    [Insert]\n    public void InsertCharacter(Character entity)\n    {\n        DbEntityEntry&lt;Character&gt; entityEntry = DbContext.Entry(entity);\n        if (entityEntry.State != EntityState.Detached)\n        {\n            entityEntry.State = EntityState.Added;\n        }\n        else\n        {\n            DbContext.Characters.Add(entity);\n        }\n    }\n\n    [Update]\n    public void UpdateCharacter(Character entity)\n    {\n        DbContext.Characters.AttachAsModified(entity, ChangeSet.GetOriginal(entity), DbContext);\n    }\n\n    [Delete]\n    public void DeleteCharacter(Character entity)\n    {\n        DbEntityEntry&lt;Character&gt; entityEntry = DbContext.Entry(entity);\n        if (entityEntry.State != EntityState.Deleted)\n        {\n            entityEntry.State = EntityState.Deleted;\n        }\n        else\n        {\n            DbContext.Characters.Attach(entity);\n            DbContext.Characters.Remove(entity);\n        }\n    }\n\n    #endregion\n}\n</code></pre>\n"},{"tags":["c#","asp.net-mvc","entity-framework","razor","partial-views"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13109812,"title":"@Html.Partial return: The model item passed into the dictionary is of type __ but this dictionary requires a model item of type __","body":"<p>I am trying to add a partial view to my MVC4 web application and I receive the following exception:</p>\n\n<blockquote>\n  <p>The model item passed into the dictionary is of type '...Meeting', but this dictionary requires a model item of type 'System.Collections.Generic.List`1[...UserProfile]'.</p>\n</blockquote>\n\n<p>what I did so far:</p>\n\n<ol>\n<li>i added to my controller this function:</li>\n</ol>\n\n<blockquote>\n<pre><code>public PartialViewResult GetUsers()\n        {\n            var usersList = (from users in db.Users select users).ToList();\n            return PartialView(usersList);\n        }\n</code></pre>\n</blockquote>\n\n<ol>\n<li>I added the parital view:</li>\n</ol>\n\n<blockquote>\n<pre><code>@model List&lt;UserProfile&gt;\n@{\n &lt;select id=\"Meeting_SetToUser\" name=\"Meeting.SetToUser\"&gt;\n        @foreach (var item in Model)\n        {\n            &lt;option value=\"@item.UserId\"&gt;@item.FirstName @item.LastName&lt;/option&gt;\n        }\n    &lt;/select&gt;\n}\n</code></pre>\n</blockquote>\n\n<ol>\n<li>i called the partialview from my view:</li>\n</ol>\n\n<blockquote>\n<pre><code>@Html.Partial(\"GetUsers\")\n</code></pre>\n</blockquote>\n\n<p>can you please direct me to were I am doing anything wrong?</p>\n\n<p>Thank you!</p>\n"},{"tags":["entity-framework","transactions"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3215,"score":0,"question_id":5855591,"title":"Bulk inserts with EntityFramework 4.0 causes abort of transaction","body":"<p>We are receiving a file from a client (Silverlight) via WCF and on the serverside I parse this file. Each line in the file is transformed into an object and stored into the database. if the file is very large (10000 entries and more), I get the following error (MSSQLEXPRESS):</p>\n\n<p>The transaction associated with the current connection has completed but has not been disposed. The transaction must be disposed before the connection can be used to execute SQL statements. </p>\n\n<p>I tried a lot (TransactionOptions timeout set and so on), but nothings works. The above exception message is either raised after 3000, sometimes after 6000 objects processed, but I can't succeed in processing all objects.</p>\n\n<p>I append my source, hopefully somebody got an idea and can help me:</p>\n\n<pre><code>public xxxResponse SendLogFile (xxxRequest request\n{\n   const int INTERMEDIATE_SAVE = 100;\n\n\n\n   using (var context = new EntityFramework.Models.Cubes_ServicesEntities())\n   {\n            // start a new transactionscope with the timeout of 0 (unlimited time for developing purposes)\n            using (var transactionScope = new TransactionScope(TransactionScopeOption.RequiresNew,\n            new TransactionOptions\n            {\n                IsolationLevel = System.Transactions.IsolationLevel.Serializable,\n                Timeout = TimeSpan.FromSeconds(0)\n            }))\n            {\n                try\n                {\n                    // open the connection manually to prevent undesired close of DB\n                    // (MSDTC)\n                    context.Connection.Open();\n                    int timeout = context.Connection.ConnectionTimeout;\n\n                    int Counter = 0;\n\n                    // read the file submitted from client\n                    using (var reader = new StreamReader(new MemoryStream(request.LogFile)))\n                    {\n                        try\n                        {\n                            while (!reader.EndOfStream)\n                            {\n                                Counter++;\n                                Counter2++;\n                                string line = reader.ReadLine();\n                                if (String.IsNullOrEmpty(line)) continue;\n\n                                // Create a new object\n                                DomainModel.LogEntry le = CreateLogEntryObject(line);\n\n                                // an attach it to the context, set its state to added.\n                                context.AttachTo(\"LogEntry\", le);\n                                context.ObjectStateManager.ChangeObjectState(le, EntityState.Added);\n\n                                // while not 100 objects were attached, go on\n                                if (Counter != INTERMEDIATE_SAVE) continue;\n\n                                // after 100 objects, make a call to SaveChanges.\n                                context.SaveChanges(SaveOptions.None);\n                                Counter = 0;\n                            }\n                        }\n                        catch (Exception exception)\n                        {\n                            // cleanup\n                            reader.Close();\n                            transactionScope.Dispose();\n                            throw exception;\n\n                        }\n\n                    }\n                    // do a final SaveChanges\n                    context.SaveChanges();\n                    transactionScope.Complete();\n                    context.Connection.Close();\n                }\n                catch (Exception e)\n                {\n                    // cleanup\n                    transactionScope.Dispose();\n                    context.Connection.Close();\n                    throw e;\n                }\n            }\n\n            var response = CreateSuccessResponse&lt;ServiceSendLogEntryFileResponse&gt;(\"SendLogEntryFile successful!\");\n            return response;\n        }\n    }\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":13105207,"title":"How do I prevent entity framework from creating extra tables","body":"<p>I have an issue when I upgraded entity framework to 5.0, to illustrate:</p>\n\n<pre><code>public class MyClass\n{\n   public Foo foo;\n\n   public ICollection&lt;Student&gt; Students{ get; set; }\n\n}\n\npublic class Student\n{\n   public int Id {get; set;}\n   public string s {get; set;}\n}\n\npublic class Foo\n{\n  public int data {get; set}\n  ...\n}\n</code></pre>\n\n<p>EF correctly creates a table called Students because I have defined a one-to-many relationship from MyClass to Student. I am using class Foo as encapsulation and have a 1-to-1 relationship. </p>\n\n<p>EF 4.0 did not create a separate table for <code>Foo</code>, instead used the property data as <code>Foo_data</code> within the MyClass table. With EF 5.0 I am getting another table for <code>Foo</code>.</p>\n\n<p>How can I tell EF not to create a table for <code>Foo</code>? </p>\n"},{"tags":["sql-server","entity-framework","ef-code-first","data-migration","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13103349,"title":"How to add a new code-first migration with a newly-generated database?","body":"<p>I've enabled code-first migrations on my entity framework project, and have added several migrations which do things like rename tables.  However, I have now deleted the database and caused entity framework to generate a brand new database based on my latest data model.  If I try to run:</p>\n\n<pre><code>PM&gt; Add-Migration TestMigration\n</code></pre>\n\n<p>... it tells me that I need to apply the existing migrations first.  So I run:</p>\n\n<pre><code>PM&gt; Update-Database\n</code></pre>\n\n<p>... but the trouble is that it's trying to update a database that doesn't need updating; it's already based on the latest data model.  So I get an error when it tries to rename a table that now doesn't exist.</p>\n\n<p>Is there some way I can indicate to data migrations that my database is up-to-date and doesn't need any migrations running on it?  What should I do?</p>\n"},{"tags":["c#","entity-framework","unit-testing","orm"],"answer_count":0,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13107882,"title":"mocking EF without repository pattern","body":"<p>I'm using Entity Framework 4.</p>\n\n<p>I have read this post:</p>\n\n<p><a href=\"http://www.nogginbox.co.uk/blog/mocking-entity-framework-data-context\" rel=\"nofollow\">http://www.nogginbox.co.uk/blog/mocking-entity-framework-data-context</a></p>\n\n<p>But in my code I don't see anything like  <code>EFContext</code> <code>Attach() Detach()</code> and other stuff that appears there.</p>\n\n<p>Mine is more like this diagram:</p>\n\n<p><a href=\"http://blogofrab.blogspot.co.il/2010/08/maintenance-free-mocking-for-unit.html\" rel=\"nofollow\">http://blogofrab.blogspot.co.il/2010/08/maintenance-free-mocking-for-unit.html</a></p>\n\n<p>and then I don't understand how mocking the Icontext will help mocking?</p>\n\n<p>The ORM to the DB lays inside <code>get property</code> and <code>AddTo methods</code></p>\n"},{"tags":["database","linq","query","entity-framework","linq-to-sql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13108228,"title":"Loading the last related record instantly for multiple parent records using Entity framework","body":"<p>Does anyone know a good approach using Entity Framework for the problem described below?</p>\n\n<p>I am trying for our next release to come up with a performant way to show the placed orders for the logged on customer.\nOf course paging is always a good technique to use when a lot of data is available I would like to see an answer without any paging techniques.</p>\n\n<p>Here's the story: a customer places an order which gets an orderstatus = PENDING. Depending on some strategy we move that order up the chain in order to get it APPROVED.\nEvery change of status is logged so we can see a trace for statusses and maybe even an extra line of comment per status which can provide some extra valuable information to whoever sees this order in an interface.</p>\n\n<p>So an Order is linked to a Customer. One order can have multiple orderstatusses stored in OrderStatusHistory.</p>\n\n<p>In my testscenario I am using a customer which has 100+ Orders each with about 5 records in the OrderStatusHistory-table.\nI would for now like to see all orders in one page not using paging where for each Order I show the last relevant Status and the extra comment (if there is any for this last status; both fields coming from OrderStatusHistory; the record with the highest Id for the given OrderId).</p>\n\n<p>There are multiple scenarios I have tried, but I would like to see any potential other solutions or comments on the things I have already tried.</p>\n\n<ul>\n<li>Trying to do Include() when getting Orders but this still results in multiple queries launched on the database. Each order triggers an extra query to the database to get all orderstatusses in the history table. So all statusses are queried here instead of just returning the last relevant one, plus 100 extra queries are launched for 100 orders. You can imagine the problem when there are 100000+ orders in the database.</li>\n<li>Having 2 computed columns on the database: LastStatus, LastStatusInformation and a regular Linq-Query which gets those columns which are available through the Entity-model.\nThe problem with this approach is the fact that those computed columns are determined using a scalar function which can not be changed without removing the formula from the computed column, etc...</li>\n</ul>\n\n<p>In the end I am very familiar with SQL and Stored procedures, but since the rest of the data-layer uses Entity Framework I would like to stick to it as long as possible, even though I have my doubts about performance.\nUsing the SQL approach I would write something like this:</p>\n\n<pre><code>WITH cte (RN, OrderId, [Status], Information)\nAS\n(\nSELECT ROW_NUMBER() OVER (PARTITION BY OrderId ORDER BY Id DESC), OrderId,    [Status], Information\nFROM OrderStatus\n)\nSELECT o.Id, cte.[Status], cte.Information AS StatusInformation, o.* FROM [Order] o\nINNER JOIN cte ON o.Id = cte.OrderId AND cte.RN = 1\nWHERE CustomerId = @CustomerId\nORDER BY 1 DESC;\n</code></pre>\n\n<p>which returns all orders for the customer with the statusinformation provided by the Common Table Expression.</p>\n\n<p>Does anyone know a good approach using Entity Framework?</p>\n"},{"tags":["c#","asp.net-mvc","performance","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13103852,"title":"I want to improve performance of my Edmx by using AutoDetectChanges","body":"<p>I have a reasonably large edmx generated from a database and I have been working on performance recently to improve my application I have read a number of articles in a variety of places some here some not</p>\n\n<p>this one on disabling auto detect of changes <a href=\"http://msdn.microsoft.com/en-us/data/jj556205.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/data/jj556205.aspx</a> </p>\n\n<p>this one on improving performance on delete <a href=\"http://stackoverflow.com/questions/10103310/dbcontext-is-very-slow-when-adding-and-deleting\">DbContext is very slow when adding and deleting</a></p>\n\n<p>this one (which I think is pretty good) <a href=\"http://www.codeproject.com/Articles/38922/Performance-and-the-Entity-Framework\" rel=\"nofollow\">http://www.codeproject.com/Articles/38922/Performance-and-the-Entity-Framework</a></p>\n\n<p>I am already using myentities.tablename.MergeOption = MergeOption.NoTracking, i am using compiledqueries, I am pregenerated my View using EdmGen, I have reduced the data I am fetching etc..  and, of course,  I have gained performance in leaps and bounds so that a page that was loading in 54 seconds is now taking 16.1 seconds - however I have to get it to 3 seconds So I am still looking for the next improvement </p>\n\n<p>so the research is all well and great and as a result  I have upgraded to the latest EntityFramework, I have regenerated my .edmx from db etc... and tried a variety of things but I simply cannot find a myEntities.Configuration.AutoDetectChangesEnabled in order to set it to false. Now I must be missing a simple easy trick - how do I get my edmx to have this option.</p>\n\n<p>I am in this environment.Net 4.0.3, visual studio 2010, latest version of EntityFramework, MVC 4.0... All I need is somebody to say \"aha\" you need to go and do this....</p>\n\n<p>Currently if I delete 1000 records from one of my larger tables (134million rows) it takes nearly 10 minutes to savechanges. So from what I have read AutoDetectChangesEnabled is what I need to alter but it doesnt exist in my classes? where is it what must I do to get it?</p>\n\n<p>Any help appreciated I am trying to solve this one quickly</p>\n\n<p>Regards Julian</p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2121,"score":2,"question_id":1684245,"title":"Running sql in entity framework?","body":"<p>Is there any way to run a sql statement straight from the entity framework generated calls? Or will I have to create a procedure then call that via the entity framework?</p>\n"},{"tags":["entity-framework","primary-key","case-insensitive","natural-key"],"answer_count":6,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1454,"score":3,"question_id":721873,"title":"Entity Framework and associations between string keys","body":"<p>I am new to Entity Framework, and ORM's for that mather.\nIn the project that I'm involed in we have a legacy database, \nwith all its keys as strings, case-insensitive.</p>\n\n<p>We are converting to MSSQL and want to use EF as ORM, \nbut have run in to a problem.</p>\n\n<p>Here is an example that illustrates our problem:</p>\n\n<p>TableA has a primary string key,\nTableB has a reference to this primary key.</p>\n\n<p>In LINQ we write something like:</p>\n\n<pre><code>\nvar result = from t in context.TableB select t.TableA;\nforeach( var r in result )\n    Console.WriteLine( r.someFieldInTableA );  \n</code></pre> \n\n<p>if TableA contains a primary key that reads \"A\", and TableB contains two rows that references TableA but with different cases in the referenceing field, \"a\" and \"A\".</p>\n\n<p>In our project we want both of the rows to endup in the result, but only the one\nwith the matching case will end up there.</p>\n\n<p>Using the SQL Profiler, I have noticed that both of the rows are selected.</p>\n\n<p>Is there a way to tell Entity Framework that the keys are case insensitive?\n<br><br><b>Edit:</b><br>We have now tested this with NHibernate and come to the conclution that NHibernate works with case-insensitive keys. So NHibernate might be a better choice for us.<br>I am however still interested in finding out if there is any way to change the behaviour of Entity Framework.</p>\n\n<hr>\n\n<p>Thanks for your answer!</p>\n\n<p>Problem is that if we add that constraint to the database now, \nthe legacy application might stop working because of how it is built.\nBest for us would be, if possible, to change the behavior of EF.\nI'm guessing it is not possible, but I'm giving it a shot.</p>\n\n<p><br>\nRegards,<br>\nFredrik</p>\n\n<p><b>edit:</b> The reason why I added an answer to my own question was that I added this question before I was a registerd user, and when I had registred my account I couldn't add comments or edit my post. Now the accounts are merged.</p>\n"},{"tags":["asp.net","asp.net-mvc-3","entity-framework","exception-handling","crud"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":13104018,"title":"Asp.Net MVC 3 prevent duplicate records","body":"<p>I'm new in Asp.net MVC 3 with Entity Framework.</p>\n\n<p>I followed a tutorial to make a simple program that add/edit and delete records from a SQL database.</p>\n\n<p>My question is how and where I must prevent the duplicate records? I have the \"firstName\" field as unique. So, when the user add a record from the form, how I can control that this record don't exist?</p>\n\n<p>Many thanks in advance.</p>\n"},{"tags":["sql","entity-framework","entity-framework-4","lambda"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13103946,"title":"Lambda expression to SQL query","body":"<p>I'm trying to build method that would delete all entries in specified table that match the condition.</p>\n\n<pre><code>    public void DeleteAll(Expression&lt;Func&lt;T, bool&gt;&gt; condition)\n    {\n        var service = PluralizationService.CreateService(new CultureInfo(\"en-US\"));\n        var tableName = service.Pluralize(typeof(T).Name);\n        Context.Database.ExecuteSqlCommand(string.Format(\"DELETE FROM {0} WHERE {1}\", tableName, condition));\n    }\n</code></pre>\n\n<p>Currently this is not working as I'm not able to properly convert condition given as lambda expression to meaningful SQL syntax that would fit after WHERE clause. I can do some things manually but I was wondering if there is a way to do it with means provided with .NET framework.</p>\n"},{"tags":["asp.net","sql-server","database","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":13086006,"title":"How can I force entity framework to insert identity columns?","body":"<p>I want to write some C# code to initialize my database with some seed data.  Clearly, this is going to require the ability to be able to set the values of various Identity columns when inserting.  I'm using a code-first approach.  By default, <code>DbContext</code> handles the database connection and so you can't <code>SET IDENTITY_INSERT [dbo].[MyTable] ON</code>.  So, what I've done so far is use the <code>DbContext</code> constructor that lets me specify a DB connection to be used.  Then, I set <code>IDENTITY_INSERT</code> to <code>ON</code> in that DB connection, and then try to insert my records using entity framework.  Here's an example of what I've got so far:</p>\n\n<pre><code>public class MyUserSeeder : IEntitySeeder {\n    public void InitializeEntities(AssessmentSystemContext context, SqlConnection connection) {\n        context.MyUsers.Add(new MyUser { MyUserId = 106, ConceptPersonId = 520476, Salutation = \"Mrs\", Firstname = \"Novelette\", Surname = \"Aldred\", Email = null, LoginId = \"520476\", Password=\"28c923d21b68fdf129b46de949b9f7e0d03f6ced8e9404066f4f3a75e115147489c9f68195c2128e320ca9018cd711df\", IsEnabled = true, SpecialRequirements = null });\n        try {\n            connection.Open();\n            SqlCommand cmd = new SqlCommand(\"SET IDENTITY_INSERT [dbo].[MyUser] ON\", connection);\n            int retVal = cmd.ExecuteNonQuery();\n            context.SaveChanges();\n        }\n        finally {\n            connection.Close();\n        }\n    }\n}\n</code></pre>\n\n<p>So close and yet so far - because, although <code>cmd.ExecuteNonQuery()</code> works fine, when I then run <code>context.SaveChanges()</code>, I'm informed that \"Explicit value must be specified for identity column in table 'MyUser' either when IDENTITY_INSERT is set to ON or when a replication user is inserting into a NOT FOR REPLICATION identity column.\"</p>\n\n<p>Presumably, because MyUserId (which is the Identity column in the MyUser table) is the primary key, entity framework doesn't try to set it when I call <code>context.SaveChanges()</code>, even though I gave the <code>MyUser</code> entity a value for the <code>MyUserId</code> property.</p>\n\n<p>Is there a way to force entity framework to try and insert even primary key values for an entity, then?  Or maybe a way to temporarily mark <code>MyUserId</code> as not being a primary key value, so EF tries to insert it?</p>\n"},{"tags":["c#","entity-framework","silverlight-4.0","entity-framework-4.1"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13099663,"title":"Not printing duplicate values using view in entity model","body":"<p>I am using entity model.i updated one view called SalesDetialView.</p>\n\n<p>In salesdetialview i have 3 entity keys. There are 1.Type 2.No, 3.Custmor\n<img src=\"http://i.stack.imgur.com/fpanX.png\" alt=\"enter image description here\"></p>\n\n<p>SQL : I am using this query(i am printing just 5 columns )</p>\n\n<p>select Customer,Type,No,Salesperson,amount from SalesDetailView \n<img src=\"http://i.stack.imgur.com/vFaU9.png\" alt=\"enter image description here\"></p>\n\n<p>But through entity model i am not getting duplicate values(No).see this below screen <img src=\"http://i.stack.imgur.com/MBbAw.png\" alt=\"enter image description here\"></p>\n\n<p>Now i have doubt why it is not showing duplicate values. Any thing related for entity keys  or any thing. Please suggest me where i am doing mistake.</p>\n"},{"tags":["asp.net-mvc","entity-framework","web-applications","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":13099929,"title":"MCV4 And Enitiy Framework. Without been able to directly connect to the database","body":"<p>I have a very strange situation which I am currently faced with.  I have been passed a project to uplift a website to use MVC4 &amp; the enitiy framework.  However due to the way that the original implementation was undertaken the database access is not direct from the website it's handed to a separate middle-ware application which we pass the name of a sql transaction we would like to have executed &amp; the required parameters, this then returns us a datatable object.</p>\n\n<p>My Question is this Without having to remove this middle-ware process could I create a MVC4 App with the use of the enitiy framework? </p>\n"},{"tags":["sql-server","silverlight","entity-framework","table","big"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":9748830,"title":"How to load silverlight Entities with a large number of records?","body":"<p>I have a big table in my SQL Server database with 38000 records! When loading this table in my Silverlight application, it shows 0 records loaded. When i load the same table with less records (1000 for example ) the entity is loaded with all records! </p>\n\n<p>Can anyone help me please? </p>\n\n<pre><code>      loadhabitaion = this.friendsContext.Load(this.friendsContext.GetHyd_poliQuery());\n      loadhabitaion.Completed += new EventHandler(loadhabitaion_Completed);\n      void loadhabitaion_Completed(object sender, EventArgs e)\n\n         {\n\n        MessageBox.Show(loadhabitaion.Entities.Count().ToString());\n          //it returns 0\n         }\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13094626,"title":"Entity Framework 5 Reverse Engineering and [Key] attribute","body":"<p>I'm reverse engineering a database with Entity Framework Power Tools beta 2, now, the POCOs created do not have the [Key] in the definition, but the mapping with Fluent has the  this.HasKey(t => t.EntityId);</p>\n\n<p>I have the POCOs in a separate project and and MVC 4 application which has a reference to it. When I try to add a controller it says then entities do not have the Key defined.\nExact message is:</p>\n\n<p><strong>System.Data.Entity.EdmEntityType: EntityType: 'Computer' has no key defined. Define the key for this EntityType.</strong></p>\n\n<p>Why the reverse engineering process do not add the [Key] attribute if it is mandatory? Or it is not mandatory and I'm missing something?</p>\n\n<p>Thanks in advance. Guillermo.</p>\n"},{"tags":["c#","database","entity-framework","table","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12420539,"title":"Code first database migration","body":"<p>We are using the Code-first approach without an Edmx file, its running fine to create database the first time.</p>\n\n<p>But if i am adding new data entities say new class to my database context then it is not able to add that to new table in that database.</p>\n\n<p>Say for example there are two table initially in database.\nex Database : DbTest\n   Table : Tbl1, Tbl2</p>\n\n<p>Now if i a add new table, say class name 'Tbl3', then it should be adding it into the existing database.</p>\n\n<p>Can any one please explain to me with an example how it can be achieved via code first approach?</p>\n\n<p>I have seen mentioned something like  <code>Database.SetInitializer(new ........)</code></p>\n\n<p>What do i need to put in the blank area of the constructor above?</p>\n"},{"tags":["c#","asp.net-mvc","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13098262,"title":"Using Find() with inheritance in entity frameowrk","body":"<p>I am trying to find a User entity in my \"Domain Entity\" DB Set.\nThe User entity is derived from a base type called Domain Entity.</p>\n\n<p>I want to use the following to find a user according to his ID</p>\n\n<pre><code>User userToDelte = db.DomainEntities.OfType&lt;User&gt;().Find(UserID);\n</code></pre>\n\n<p>But I get a compiler error :</p>\n\n<blockquote>\n  <p>'System.Linq.IQueryable' does not\n  contain a definition for 'Find' and no extension method 'Find'\n  accepting a first argument of type...</p>\n</blockquote>\n\n<p>Why can't I use <code>Find()</code> after I have used <code>OfType&lt;User&gt;()</code> ?</p>\n\n<p>P.S\nIt is important for me to get a strongly typed User entity because it has a navigation propertiy that include all of it's details in a separate table called \"UserDetails\" along with the user name and password.</p>\n"},{"tags":["wpf","entity-framework","dependency-injection","unity"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13098427,"title":"wpf architecture advice","body":"<p>I'm working on an app to be created in wpf. I want to structure the app with logical layers so have a solution with following projects:\nModel - entity framework classes representing db structure\nData - contains data context and the repository, unitwork, databasefactory classes and the interfaces for these.\nPresentation - actual wpf application with my views and view models.</p>\n\n<p>I wanted to implement unity based dependency injection to have my repositories injected into the view models but am stuck. Everytime i attempt to navigate to my view i get object not set to instance error, but doesn't indicate where.</p>\n\n<p>Does anyoneknow of a nice starter example that follows the pattern above? </p>\n\n<p>Thanks for any help you can offer.</p>\n"},{"tags":["c#","entity-framework","rest","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":114,"score":0,"question_id":13096930,"title":"How to use Entity Framework 5 (CodeFirst) with DataContract from REST service","body":"<p>I come from the web forms world, and I'm learning MVC4 and Entity Framework 5 with a code-first approach. This is my first time using EF code-first and I'm having some trouble understanding what EF needs from me to be able to create/update a database. </p>\n\n<p>I'm making a request to a RESTful service and deserializing the response into a <code>DataContract</code>. Ideally, I would like to be able to insert this <code>DataContract</code> into a database but I'm unsure how to generate the <code>DbContext</code> classes from the <code>DataContract</code> so EF can do it's thing. </p>\n\n<p>The simplified version of the <code>DataContract</code>...</p>\n\n<pre><code>[DataContract]\npublic class MoviesDataContract {\n    [DataMember(Name = \"total\")]\n    public int Total { get; set; }\n\n    [DataMember(Name = \"movies\")]\n    public IEnumerable&lt;Movie&gt; Movies { get; set; }\n\n    [DataMember(Name = \"link_template\")]\n    public string LinkTemplate { get; set; }\n}\n\n[DataContract]\npublic class Movie {\n    [DataMember(Name = \"id\")]\n    public int Id { get; set; }\n\n    [DataMember(Name = \"title\")]\n    public string Title { get; set; }\n\n    [IgnoreDataMember]\n    public int? Year {\n        get {\n            int i;\n            return int.TryParse(_year, out i) ? i : (int?)null;\n        } \n        set { _year = value.ToString(); }\n    }\n\n    [DataMember(Name = \"year\")]\n    private string _year { get; set; }\n}\n</code></pre>\n\n<p>Here's an example of the <code>DataContract</code> usage...</p>\n\n<pre><code>using(var response = (HttpWebResponse)request.GetResponse()) {\n    var serializer = new DataContractJsonSerializer(typeof (MoviesDataContract));\n    var dataContract = (MoviesDataContract)serializer.ReadObject(response.GetResponseStream());\n\n    var model = new List&lt;MovieViewModel&gt;();\n    dataContract.Movies.ToList().ForEach(movie =&gt; model.Add(new MovieViewModel {\n        Title = movie.Title,\n        Year = movie.Year\n    }));\n\n    // MovieDbContext doesn't exist and it's what I'm unsure of how to generate\n    // I would think it would work something like this though (once created)\n    var db = new MovieDbContext();\n    db.Add(dataContext);\n    db.SaveChanges();\n\n    return View(model);\n}\n</code></pre>\n\n<p>My Questions are...</p>\n\n<ol>\n<li>Is there a way to generate the <code>DbContext</code> classes from my <code>DataContract</code> or do I need to manually create them?</li>\n<li>Is there a better approach to using (or really saving to a db) Deserialized data with Entity Framework (especially EF5)?</li>\n<li>Could someone provide a link that discusses EF (4 or higher) being used in conjunction with a DataContract? I think I may not have a complete grasp on how to effectively use EF5.</li>\n</ol>\n"},{"tags":["c#","entity-framework","deadlock"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13097179,"title":"How to prevent EntityFramework deadlock when concurrently running these two statements","body":"<p>Calls into my web service use the following code to ensure that the caller has a valid session. If a valid session found then it updates the session details and saves the changes. All simple enough and works fine.</p>\n\n<pre><code>// Create the Entity Framework context\nusing(MyContext ctx = CreateMyContext())\n{\n     // Get the user session for the client session         \n     UserSession session = (from us in context.UserSessions.Include(\"UserEntity\")\n                            where us.SessionId = callerSessionId\n                            select us).FirstOrDefault&lt;UserSession&gt;();\n\n     if (session == null)\n         return false;\n     else\n     {\n         // Update session details\n         session.Calls++;\n         session.LastAccessed = DateTime.Now.Ticks;\n         Console.WriteLine(\"Call by User:{0}\", session.UserEntity.Name);\n\n         // Save session changes back to the server\n         ctx.SaveChanges();\n         return true;\n     }    \n}\n</code></pre>\n\n<p>All works fine until the same caller, and hence the same session, makes multiple concurrent calls (which is perfectly valid to happen). In this case I sometimes get a deadlock. Using SQL Server Profiler I can see the following is happening. </p>\n\n<p>Caller A performs the select and acquires a shared lock on the user session. Caller B performs the select and acquires a shared lock on the same user session. Caller A cannot perform its update because of Caller B's shared lock. Caller B cannot perform its update because of caller A's shared lock. Deadlock.</p>\n\n<p>This seems like a simple and classic deadlock scenario and there must be a simple method to resolve it. Surely almost all real world applications have this same problem.But none of the Entity Frameworks books I have mention anything about deadlocks.</p>\n"},{"tags":["asp.net-mvc","visual-studio-2010","entity-framework","nuget","class-library"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13036496,"title":"Install-package Entity framework error","body":"<p>I need help.\nWhen i'm trying to install Entity-framework to my class library in my solution, i'm getting an error:</p>\n\n<p><em>Exception calling \"CreateInstanceFrom\" with \"8\" argument(s): \"Could not load file or assembly 'file:///D:#work#web\\DanceClubCMS\\packages\\EntityFramework.5.0.0\\tools\\EntityFramework.PowerShell.dll' or one of its dependencies.\n Не удается найти указанный файл.\" =>  <strong>(translate from russian - file not found)</strong>\nAt D:#work#web\\DanceClubCMS\\packages\\EntityFramework.5.0.0\\tools\\install.ps1:10 char:34\n+     $appDomain.CreateInstanceFrom &lt;&lt;&lt;&lt; (\n    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException\n    + FullyQualifiedErrorId : DotNetMethodException</em></p>\n\n<p>please help me. How can i fix that problem?</p>\n"},{"tags":["sql","asp.net-mvc","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13096058,"title":"Joining two tables in linq method syntax, MVC EntityFramework","body":"<p>I'm working with two tables: CI_CLIENTRISK (SCD type 2)... and QB_INVOICES_HEADER (<a href=\"http://i47.tinypic.com/x42c69.png\" rel=\"nofollow\">edmx screenshot</a>).</p>\n\n<p>They can be joined via ClientID.  I want to essentially replicate this query:</p>\n\n<pre><code>SELECT a.ClientID,\n    MAX(b.InvoiceDt) AS MaxInvoiceDt\n    (omitted for brevity)\nFROM CI_CLIENTRISKADJS a\nINNER JOIN QB_INVOICES_HEADER b\nON a.ClientID = b.ClientID\nWHERE a.IsActive = 1\nGROUP BY a.ClientID\nORDER BY MaxInvoiceDt DESC\n</code></pre>\n\n<p>Here's what I have so far.  It's not returning any records.</p>\n\n<pre><code>using (var db = new PLOGITENS01Entities())\n        {\n        var rvClientRiskAdjs = db.CI_CLIENTRISKADJS\n            .Take(50)\n            .Join(db.QB_INVOICES_HEADER,\n                a =&gt; a.ClientID,\n                b =&gt; b.ClientID,\n                (a, b) =&gt; new { Risk = a, Invoices = b })\n            .Where(a =&gt; a.Risk.IsActive == 1)\n            .OrderByDescending(o =&gt; o.Invoices.InvoiceDt)\n            .Select(c =&gt; new ClientRiskModel()\n            {\n                ClientRiskId = c.Risk.ClientRiskID,\n                ClientName = c.Risk.CI_CLIENTLIST.ClientName,\n                ClientId = c.Risk.ClientID,\n                ClientRiskAdjs = c.Risk.ClientRiskAdjs,\n                RecordValidStartDt = c.Risk.RecordValidStartDt,\n                RecordValidEnddt = c.Risk.RecordValidEnddt,\n                IsActive = c.Risk.IsActive\n            })\n            .ToList();\n\n        return View(new GridModel(rvClientRiskAdjs));\n        }\n</code></pre>\n"},{"tags":["entity-framework","ado.net","navigation-properties"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13095215,"title":"Saving navigation property in ADO.NET Entity framework","body":"<p>I'm working with ADO.NET Entity Framework. I add a 'User' entity in a database with the following code:</p>\n\n<pre><code>user new_user = new user();\nnovus_daedalus_dbEntities dbEntity = new novus_daedalus_dbEntities();\n\nnew_user.CF = \"xyz\";\nnew_user.username = \"peter\";\nnew_user.password = \"pw\";\n\ndbEntity.user.Add(new_user);\ndbEntity.SaveChanges();\n</code></pre>\n\n<p>The CF attribute of the 'user' class is a foreign key to a 'people' class attribute. The database table 'people' has a record with CF='xyz'. When the method 'dbEntity.SaveChanges();' is executed, a new record in the 'user' database table is created without problem. The problem is that the navigation property 'new_user.people' is 'null', even after the execution of 'dbEntity.SaveChanges();'. Is it normal?</p>\n\n<p>Thanks!</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13094265,"title":"Single website multiple databases, database switching","body":"<p>I have created a content management system (CMS) for my company’s product databases. The CMS is based on asp.net scaffolding with many custom pages and actions mixed in. We have 7 products currently, all of which share the same database schema (Entity Framework model-first) and all run perfectly in the CMS. The issue is that every time we get a new product we must clone the CMS and change the connection string in the <code>app.config</code> to point to the correct database in order to work with the new database. While this works, it’s becoming bothersome to maintain and will fail us completely as we acquire more products. </p>\n\n<p>What I would like to do is have a centralized landing page where a user is directed to log in, then given the option to connect to and edit a specific product based on their selection. The idea is that we would have one CMS site which would be able to switch between the databases depending on the user. It is not an option to combine all of the product database in to a single master product database. </p>\n\n<p>I am not sure where to start to achieve this goal, or if this is even the correct plan to achieve my goal of having a single CMS to maintain, and am looking for some guidance in this. </p>\n"},{"tags":["entity-framework","computed-columns","ef-model-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12787102,"title":"SQL Server computed columns and EF model-first","body":"<p>I'm working with EF5 using the model-first approach.  I've designed the model and executed the SQL script which generated the corresponding database (using \"Generate Database from Model\").</p>\n\n<p>I then had to use UDFs to calculate a couple of column values (which requires dropping and re-adding the columns).  I've done that in SSMS and then used \"Update Model from Database...\" to reflect the changes in the model.</p>\n\n<p>Till this point, everything worked great.</p>\n\n<p>But from this point, every time I update the database from the model (as described above), the computed columns are overridden with \"standard\" columns.</p>\n\n<p>For example, following is an excerpt from the SQL script generated by EF:</p>\n\n<pre><code>-- Creating table 'ShipmentSet'\nCREATE TABLE [dbo].[ShipmentSet] (\n[Id] int IDENTITY(1,1) NOT NULL,\n[Details] nvarchar(128)  NOT NULL,\n[BarcodeValue] nvarchar(32)  NOT NULL,\n[ExecutionDate] datetime  NOT NULL,\n[RouteId] int  NOT NULL,\n[IsLocationBarcodeRequired] bit  NOT NULL,\n[IsPending] bit  NULL,\n[LastAction] tinyint  NULL\n);\nGO\n</code></pre>\n\n<p>The two last columns are computed columns, and their <code>StoreGeneratedPattern</code> in the model is defined as <code>Computed</code>.</p>\n\n<p>Is there a way to add the computed column formulas in the model? The SQL script drops the tables then re-creates them, so \"ignoring\" these columns won't do.</p>\n"},{"tags":["c#","asp.net-mvc","linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":13092098,"title":"Translate SQL query to LINQ (subqueries)","body":"<p>Hi have a site where users can vote on images.\nThe votes are stored in table Votes where I store the Id of the submission (FK_id)</p>\n\n<p><br />\nThe tables are:</p>\n\n<p><strong>Table Submissions</strong><br />\nId (uniqueidentifier)<br />\nName (varchar(50))<br />\nImage (varchar(50))<br /></p>\n\n<p><strong>Table Votes</strong><br />\nId (int)<br />\nFk_id (foreign key to Submissions.Id)<br /></p>\n\n<p>I'm new to linq so I don't know how to translate this:</p>\n\n<pre><code>SELECT *, \n    isnull((SELECT count(*) \n    FROM Votes\n    WHERE Fk_id = S.Id      \n    GROUP BY Fk_id),0) as Votes \nFROM Submissions S\n</code></pre>\n\n<p>I wanted something like this:</p>\n\n<pre><code>List&lt;Model&gt; = (from p in ????\n               select new Model\n               {\n                   Name = p.Name,\n                   Image = p.Image,\n                   Votes = p.Votes               \n               }).ToList();\n</code></pre>\n\n<p>Thank you.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4","nuget"],"answer_count":3,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":864,"score":7,"question_id":10219864,"title":"EF Code First: How do I see 'EntityValidationErrors' property from the nuget package console?","body":"<p>I'm at a loss for this:</p>\n\n<p>I've defined my classes for a entity framework (4.1.3) code first approach. Everything was fine (I was creating the tables etc.) until I started to Seed.</p>\n\n<p>Now when I do the </p>\n\n<pre><code>Add-Migration \"remigrate\" ; Update-Database;\n</code></pre>\n\n<p>I get an error on the package console \"Validation failed for one or more entities. See 'EntityValidationErrors' property for more details.\"</p>\n\n<p>I have a breakpoint in my Seed() method but because I'm running this on the console when the project is not running, I'm clueless as to how to get to the details (PS - I've seen the thread <a href=\"http://stackoverflow.com/questions/5400530/validation-failed-for-one-or-more-entities-while-saving-changes-to-sql-server-da\">Validation failed for one or more entities while saving changes to SQL Server Database</a> which shows how I can see the property.)</p>\n\n<p>I know that my Seed() method has a problem because if I put a return right after the method call, the error goes away. So how do I set my breakpoint so I can see what the validation error is? Kinda lost. Or is there some other way to trace it in the nuget console??</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13091029,"title":"Update EF from an object","body":"<p>I know to update an object in EF I can do something like...</p>\n\n<pre><code>var hotel = context.Hotels.SingleOrDefault(u =&gt; u.HotelID == editedHotel.HotelID);\n    hotel.Name= editedHotel.Name;\n    hotel.Address = editedHotel.Address;\n    hotel.RoomCount = editedHotel.RoomCount;\ncontext.SaveChanges();\n</code></pre>\n\n<p>but this gets quite long if a lot of fields need updating.</p>\n\n<p>Is there a way I can do something like...</p>\n\n<pre><code>    var hotel = context.Hotels.SingleOrDefault(u =&gt; u.HotelID == editedHotel.HotelID);\nhotel = editedHotel;\ncontext.SaveChanges();\n</code></pre>\n\n<p>...so all of the fields can be changed in one go?</p>\n"},{"tags":["c#","sql-server","entity-framework","foreign-keys"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13090735,"title":"inserting data into tables with foreign keys","body":"<p>I have 2 tables in ms sql server 2008 R2, one of which has foreign key relation to the other</p>\n\n<p>pretty simple:</p>\n\n<pre><code>tableA\nprefix nchar(10)\nvalue  nchar(50)\n\ntableB\nprefix nchar(10)\nvalue  nchar(50)\n\nALTER TABLE [dbo].[tableB]  \nWITH CHECK ADD  CONSTRAINT [FK_TableA_TableB] FOREIGN KEY([prefix])\nREFERENCES [dbo].[TableA] ([prefix])\n</code></pre>\n\n<p>I fill in data in the tables using the management studio edit table. ensuring each prefix in <code>tableB</code> has a matching prefix in <code>tableA</code>.</p>\n\n<p>Then I import the tables into visual studio C# to create an entity framework model.\nEverything seem to work fine until I start to reference data in <code>tableA</code> from <code>tableB</code> using the navigation handle, it comes up empty handed.</p>\n\n<p>i.e. <code>tableB.tableA</code>s come out as null.</p>\n\n<p>Is there a step that needs to be done to update foreign key relations in entity framework and/or ms sql server?</p>\n"},{"tags":["c#","sql-server","database","entity-framework","sql-server-ce"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13085764,"title":"Generating both SQL Server CE database and entity model at runtime","body":"<p>I am developing a desktop application where different users can use the application on the same machine, the application should generate a different SQL Server CE database file for each user where the databases have the same schema (structure), and then generate an entity model from that database, how should I go about doing this ? </p>\n\n<p>I am new to both the Entity Framework and the SQL Server CE engine, so I am willing to consider any solution.</p>\n"},{"tags":["c#","entity-framework","automapper"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13052970,"title":"Auto-generating EF \"where\" clause based on DTO","body":"<p>I'm trying to autogenerate the parameter to IQueryable.Where so I can select entities from my entity framework code first data context without writing and wiring up a lot of tedious mapping code.</p>\n\n<p>My project contains a bunch of DTOs that look like:-</p>\n\n<pre><code>class FooDto\n{\n  public string SomeProperty { get; set; }\n  public string SomeOtherProperty { get; set; }\n}\n</code></pre>\n\n<p>And a bunch of entities that look like:-</p>\n\n<pre><code>class Foo\n{\n  public string SomeProperty { get; set; }\n  public string SomeOtherProperty { get; set; }\n\n  // Some other properties here.\n}\n</code></pre>\n\n<p>The DTO contains the fields necessary to identify some subset of entities in my database. I use the DTOs to query an IQueryable of entities:-</p>\n\n<pre><code>var result = queryable.Where(\n  x =&gt; x.SomeProperty == dto.SomeProperty\n    &amp;&amp; x.SomeOtherProperty == dto.SomeOtherProperty)\n</code></pre>\n\n<p>The actual properties vary, but the queries are always of the shape <strong>\"Where all of the properties on the entity match all of the matching properties on the DTO\"</strong>. There's no more complicated query object functionality going around.</p>\n\n<p>There are many dozens of DTOs and entities. Creating/maintaining and wiring up all of these predicates is a challenging architectural issue. We're currently using the strategy pattern:-</p>\n\n<pre><code>public class FooDtoSelectStrategy : ISelectStrategy&lt;FooDto, FooEntity&gt;\n{\n  public Func&lt;FooEntity, bool&gt; GetPredicate(FooDto dto)\n  {\n    return x =&gt; x.SomeProperty == dto.SomeProperty\n             &amp;&amp; x.SomeOtherProperty == dto.SomeOtherProperty;\n  }\n}\n</code></pre>\n\n<p>Along with a pile of ninject bindings, but we've got some few dozens of these already and we're looking at hundreds more as our domain expands.</p>\n\n<p>We had a similar challenge mapping values from the entity to the DTO which we resolved using AutoMapper.</p>\n\n<p><strong>Can automapper (or a similar tool) create these predicates and allow us to implement a single <code>GenericPredicateProvider&lt;TDto, TEntity&gt;</code>?</strong></p>\n"},{"tags":["entity-framework","asp.net-mvc-4","sql-server-profiler"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13090602,"title":"SQL Server Profiler - Why are some calls RPC:BatchCompleted and Some Calls SQL:BatchCompleted","body":"<p>I will be the first to  admit that I often get confused when I use SQL Server profiler. </p>\n\n<p>Having said that, I decided to fire it up to see the SQL that was being generated by experimenting with the Include method of a Db Set. I was going through the music store example where there are Albums, Artists, and Genres.</p>\n\n<p>One thing I noticed was that some calls had an event class of <strong>SQL:BatchCompleted</strong> while others had an event class of <strong>RPC:Completed</strong>. It seemed like the lazy load calls were being traced under the RPC event class. </p>\n\n<p>What is the difference was between these two event classes and why does lazy loading result in an event class of RPC:Completed?</p>\n"},{"tags":["php","entity-framework","yii"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":40,"score":-1,"question_id":13087646,"title":"error when try to manage all entities of a class","body":"<p>i get this error when i try to do an admin action for list all entity instantiated of a specific class: </p>\n\n<blockquote>\n  <p>include(authenticate.php): failed to open stream: No such file or directory \n  /home/user/NetBeansProjects/yii/framework/YiiBase.php(423)</p>\n</blockquote>\n\n<pre><code>{\n412                             include($classFile);\n413                             if(YII_DEBUG &amp;&amp; basename(realpath($classFile))!==$className.'.php')\n414                                 throw new CException(Yii::t('yii','Class name \"{class}\" does not match class file \"{file}\".', array(\n415                                     '{class}'=&gt;$className,\n416                                     '{file}'=&gt;$classFile,\n417                                 )));\n418                             break;\n419                         }\n420                     }\n421                 }\n422                 else\n423                     include($className.'.php');\n424             }\n425             else  // class name with namespace in PHP 5.3\n426             {\n427                 $namespace=str_replace('\\\\','.',ltrim($className,'\\\\'));\n428                 if(($path=self::getPathOfAlias($namespace))!==false)\n429                     include($path.'.php');\n430                 else\n431                     return false;\n432             }\n433             return class_exists($className,false) || interface_exists($className,false);\n434         }\n435         return true;\n</code></pre>\n\n<p>CGridView in admin file of view folder</p>\n\n<pre><code>&lt;?php $this-&gt;widget('zii.widgets.grid.CGridView', array(\n    'id'=&gt;'utente-crea-evento-grid',\n    'dataProvider'=&gt;$model-&gt;search(),\n    'filter'=&gt;$model,\n    'columns'=&gt;array(\n        'id',\n        'status',\n        'username',\n        'password', other properties\n</code></pre>\n\n<p>admin action</p>\n\n<pre><code>public function actionAdmin()\n    {\n        $model=new UtenteCreaEvento('search');\n        $model-&gt;unsetAttributes();  // clear any default values\n        if(isset($_GET['UtenteCreaEvento']))\n            $model-&gt;attributes=$_GET['UtenteCreaEvento'];\n\n        $this-&gt;render('admin',array(\n            'model'=&gt;$model,\n        ));\n    }\n</code></pre>\n\n<p>more stack trace info</p>\n\n<pre><code>#0  \n+  /home/sigturk/NetBeansProjects/yii/framework/YiiBase.php(423): YiiBase::autoload()\n#1  \n+  /home/sigturk/NetBeansProjects/yii/framework/YiiBase.php(298): YiiBase::autoload(\"authenticate\")\n#2  \n+  /home/sigturk/NetBeansProjects/yii/framework/validators/CValidator.php(187): YiiBase::import(\"authenticate\", true)\n#3  \n+  /home/sigturk/NetBeansProjects/yii/framework/base/CModel.php(285): CValidator::createValidator(\"authenticate\", UtenteCreaEvento, \"password\", array())\n#4  \n+  /home/sigturk/NetBeansProjects/yii/framework/base/CModel.php(259): CModel-&gt;createValidators()\n#5  \n+  /home/sigturk/NetBeansProjects/yii/framework/web/helpers/CHtml.php(1871): CModel-&gt;getValidators(\"numTel\")\n#6  \n+  /home/sigturk/NetBeansProjects/yii/framework/web/helpers/CHtml.php(1217): CHtml::activeInputField(\"text\", UtenteCreaEvento, \"numTel\", array(\"name\" =&gt; \"UtenteCreaEvento[numTel]\", \"id\" =&gt; \"UtenteCreaEvento_numTel\"))\n#7  \n+  /home/sigturk/NetBeansProjects/yii/framework/web/widgets/CActiveForm.php(658): CHtml::activeTextField(UtenteCreaEvento, \"numTel\", array())\n#8  \n–  /home/sigturk/NetBeansProjects/sitoEventi/protected/views/utenteCreaEvento/_search.php(42): CActiveForm-&gt;textField(UtenteCreaEvento, \"numTel\")\n37         &lt;?php echo $form-&gt;textField($model,'cognome',array('size'=&gt;60,'maxlength'=&gt;128)); ?&gt;\n38     &lt;/div&gt;\n39 \n40     &lt;div class=\"row\"&gt;\n41         &lt;?php echo $form-&gt;label($model,'numTel'); ?&gt;\n42         &lt;?php echo $form-&gt;textField($model,'numTel'); ?&gt;\n43     &lt;/div&gt;\n44 \n45     &lt;div class=\"row\"&gt;\n46         &lt;?php echo $form-&gt;label($model,'numEventiCreati'); ?&gt;\n47         &lt;?php echo $form-&gt;textField($model,'numEventiCreati'); ?&gt;\n#9  \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CBaseController.php(127): require(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\")\n#10 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CBaseController.php(96): CBaseController-&gt;renderInternal(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\", array(\"model\" =&gt; UtenteCreaEvento), true)\n#11 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(870): CBaseController-&gt;renderFile(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\", array(\"model\" =&gt; UtenteCreaEvento), true)\n#12 \n–  /home/sigturk/NetBeansProjects/sitoEventi/protected/views/utenteCreaEvento/admin.php(40): CController-&gt;renderPartial(\"_search\", array(\"model\" =&gt; UtenteCreaEvento))\n35 \n36 &lt;?php echo CHtml::link('Advanced Search','#',array('class'=&gt;'search-button')); ?&gt;\n37 &lt;div class=\"search-form\" style=\"display:none\"&gt;\n38 &lt;?php $this-&gt;renderPartial('_search',array(\n39     'model'=&gt;$model,\n40 )); ?&gt;\n41 &lt;/div&gt;&lt;!-- search-form --&gt;\n42 \n43 &lt;?php $this-&gt;widget('zii.widgets.grid.CGridView', array(\n44     'id'=&gt;'utente-crea-evento-grid',\n45     'dataProvider'=&gt;$model-&gt;search(),\n#13 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CBaseController.php(127): require(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\")\n#14 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CBaseController.php(96): CBaseController-&gt;renderInternal(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\", array(\"model\" =&gt; UtenteCreaEvento), true)\n#15 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(870): CBaseController-&gt;renderFile(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\", array(\"model\" =&gt; UtenteCreaEvento), true)\n#16 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(783): CController-&gt;renderPartial(\"admin\", array(\"model\" =&gt; UtenteCreaEvento), true)\n#17 \n–  /home/sigturk/NetBeansProjects/sitoEventi/protected/controllers/UtenteCreaEventoController.php(146): CController-&gt;render(\"admin\", array(\"model\" =&gt; UtenteCreaEvento))\n141         if(isset($_GET['UtenteCreaEvento']))\n142             $model-&gt;attributes=$_GET['UtenteCreaEvento'];\n143 \n144         $this-&gt;render('admin',array(\n145             'model'=&gt;$model,\n146         ));\n147     }\n148 \n149     /**\n150      * Returns the data model based on the primary key given in the GET variable.\n151      * If the data model is not found, an HTTP exception will be raised.\n#18 */\n+  /home/sigturk/NetBeansProjects/yii/framework/web/actions/CInlineAction.php(50): UtenteCreaEventoController-&gt;actionAdmin()\n#19 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(309): CInlineAction-&gt;runWithParams(array())\n#20 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/filters/CFilterChain.php(134): CController-&gt;runAction(CInlineAction)\n#21 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/filters/CFilter.php(41): CFilterChain-&gt;run()\n#22 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(1146): CFilter-&gt;filter(CFilterChain)\n#23 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/filters/CInlineFilter.php(59): CController-&gt;filterAccessControl(CFilterChain)\n#24 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/filters/CFilterChain.php(131): CInlineFilter-&gt;filter(CFilterChain)\n#25 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(292): CFilterChain-&gt;run()\n#26 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(266): CController-&gt;runActionWithFilters(CInlineAction, array(\"accessControl\", \"postOnly + delete\"))\n#27 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CWebApplication.php(283): CController-&gt;run(\"admin\")\n#28 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CWebApplication.php(142): CWebApplication-&gt;runController(\"utenteCreaEvento/admin\")\n#29 \n+  /home/sigturk/NetBeansProjects/yii/framework/base/CApplication.php(162): CWebApplication-&gt;processRequest()\n#30 \n+  /home/sigturk/NetBeansProjects/sitoEventi/index.php(13): CApplication-&gt;run()\n</code></pre>\n\n<p>model</p>\n\n<pre><code>class UtenteCreaEvento extends CActiveRecord\n{\n    /**\n     * Returns the static model of the specified AR class.\n     * @param string $className active record class name.\n     * @return UtenteCreaEvento the static model class\n     */\n    public static function model($className=__CLASS__)\n    {\n        return parent::model($className);\n    }\n\n    /**\n     * @return string the associated database table name\n     */\n    public function tableName()\n    {\n        return 'tbl_utenteCreaEvento';\n    }\n\n    /**\n     * @return array validation rules for model attributes.\n     */\n    public function rules()\n    {\n        // NOTE: you should only define rules for those attributes that\n        // will receive user inputs.\n        return array(\n            array('username, password, nome, cognome, email', 'required'),\n            array('status, numTel, numEventiCreati, numFeedPositivi, statoCanone', 'numerical', 'integerOnly'=&gt;true),\n            array('username, password, nome, cognome', 'length', 'max'=&gt;128),\n                        array('password','length','min'=&gt;6),\n            array('password','authenticate'),\n                        array('email', 'length', 'max'=&gt;256),\n            array('email', 'email'),\n                        array('numTel, numEventiCreati, numFeedPositivi, statoCanone','safe'),\n            // The following rule is used by search().\n            // Please remove those attributes that should not be searched.\n            array('id, status, username, nome, cognome, numTel, numEventiCreati, numFeedPositivi, email, statoCanone, dataCreazioneProfilo', 'safe', 'on'=&gt;'search'),\n        );\n    }\n\n    /**\n     * @return array relational rules.\n     */\n    public function relations()\n    {\n        // NOTE: you may need to adjust the relation name and the related\n        // class name for the relations automatically generated below.\n        return array(\n            'eventiCreati' =&gt; array(self::HAS_MANY, 'Evento', 'creatoDa'),\n            'fotoCaricate' =&gt; array(self::HAS_MANY, 'Foto', 'caricataDaUtenteEventi'),\n        );\n    }\n\n    /**\n     * @return array customized attribute labels (name=&gt;label)\n     */\n    public function attributeLabels()\n    {\n        return array(\n            'id' =&gt; 'ID',\n            'status' =&gt; 'Status',\n            'username' =&gt; 'Username',\n            'password' =&gt; 'Password',\n            'nome' =&gt; 'Nome',\n            'cognome' =&gt; 'Cognome',\n            'numTel' =&gt; 'Num Tel',\n            'numEventiCreati' =&gt; 'Num Eventi Creati',\n            'numFeedPositivi' =&gt; 'Num Feed Positivi',\n            'email' =&gt; 'Email',\n            'statoCanone' =&gt; 'Stato Canone',\n            'dataCreazioneProfilo' =&gt; 'Data Creazione Profilo',\n        );\n    }\n\n    /**\n     * Retrieves a list of models based on the current search/filter conditions.\n     * @return CActiveDataProvider the data provider that can return the models based on the search/filter conditions.\n     */\n    public function search()\n    {\n        // Warning: Please modify the following code to remove attributes that\n        // should not be searched.\n\n        $criteria=new CDbCriteria;\n\n        $criteria-&gt;compare('id',$this-&gt;id,true);\n        $criteria-&gt;compare('status',$this-&gt;status);\n        $criteria-&gt;compare('username',$this-&gt;username,true);\n        $criteria-&gt;compare('password',$this-&gt;password,true);\n        $criteria-&gt;compare('nome',$this-&gt;nome,true);\n        $criteria-&gt;compare('cognome',$this-&gt;cognome,true);\n        $criteria-&gt;compare('numTel',$this-&gt;numTel);\n        $criteria-&gt;compare('numEventiCreati',$this-&gt;numEventiCreati);\n        $criteria-&gt;compare('numFeedPositivi',$this-&gt;numFeedPositivi);\n        $criteria-&gt;compare('email',$this-&gt;email,true);\n        $criteria-&gt;compare('statoCanone',$this-&gt;statoCanone);\n        $criteria-&gt;compare('dataCreazioneProfilo',$this-&gt;dataCreazioneProfilo,true);\n\n        return new CActiveDataProvider($this, array(\n            'criteria'=&gt;$criteria,\n        ));\n    }\n\n        /**\n     * This is invoked before the record is saved.\n     * @return boolean whether the record should be saved.\n     */\n    protected function beforeSave()\n    {\n              if ($this-&gt;isNewRecord)\n                $this-&gt;dataCreazioneProfilo = new CDbExpression('NOW()');\n              $this-&gt;status = 0;\n              $this-&gt;statoCanone = 0;\n\n            return parent::beforeSave();\n        }\n</code></pre>\n\n<p>controller</p>\n\n<pre><code>public function actionView($id)\n    {\n        $this-&gt;render('view',array(\n            'model'=&gt;$this-&gt;loadModel($id),\n        ));\n    }\n\n    /**\n     * Creates a new model.\n     * If creation is successful, the browser will be redirected to the 'view' page.\n     */\n    public function actionCreate()\n    {\n        $model=new UtenteCreaEvento;\n\n        // Uncomment the following line if AJAX validation is needed\n        // $this-&gt;performAjaxValidation($model);\n\n        if(isset($_POST['UtenteCreaEvento']))\n        {\n            $model-&gt;attributes=$_POST['UtenteCreaEvento'];\n            if($model-&gt;save())\n                $this-&gt;redirect(array('view','id'=&gt;$model-&gt;id));\n        }\n\n        $this-&gt;render('create',array(\n            'model'=&gt;$model,\n        ));\n    }\n\n    /**\n     * Updates a particular model.\n     * If update is successful, the browser will be redirected to the 'view' page.\n     * @param integer $id the ID of the model to be updated\n     */\n    public function actionUpdate($id)\n    {\n        $model=$this-&gt;loadModel($id);\n\n        // Uncomment the following line if AJAX validation is needed\n        // $this-&gt;performAjaxValidation($model);\n\n        if(isset($_POST['UtenteCreaEvento']))\n        {\n            $model-&gt;attributes=$_POST['UtenteCreaEvento'];\n            if($model-&gt;save())\n                $this-&gt;redirect(array('view','id'=&gt;$model-&gt;id));\n        }\n\n        $this-&gt;render('update',array(\n            'model'=&gt;$model,\n        ));\n    }\n\n    /**\n     * Deletes a particular model.\n     * If deletion is successful, the browser will be redirected to the 'admin' page.\n     * @param integer $id the ID of the model to be deleted\n     */\n    public function actionDelete($id)\n    {\n//      $this-&gt;loadModel($id)-&gt;delete();\n                $utentecreaEvento = new UtenteCreaEvento();\n                $utentecreaEvento = UtenteCreaEvento::model()-&gt;find('id',$id);\n                $utentecreaEvento-&gt;status = 0;\n\n        // if AJAX request (triggered by deletion via admin grid view), we should not redirect the browser\n        if(!isset($_GET['ajax']))\n            $this-&gt;redirect(isset($_POST['returnUrl']) ? $_POST['returnUrl'] : array('admin'));\n    }\n\n    /**\n     * Lists all models.\n     */\n    public function actionIndex()\n    {\n        $dataProvider=new CActiveDataProvider('UtenteCreaEvento');\n        $this-&gt;render('index',array(\n            'dataProvider'=&gt;$dataProvider,\n        ));\n    }\n\n    /**\n     * Manages all models.\n     */\n    public function actionAdmin()\n    {\n        $model=new UtenteCreaEvento('search');\n        $model-&gt;unsetAttributes();  // clear any default values\n        if(isset($_GET['UtenteCreaEvento']))\n            $model-&gt;attributes=$_GET['UtenteCreaEvento'];\n\n        $this-&gt;render('admin',array(\n            'model'=&gt;$model,\n        ));\n    }\n\n    /**\n     * Returns the data model based on the primary key given in the GET variable.\n     * If the data model is not found, an HTTP exception will be raised.\n     * @param integer the ID of the model to be loaded\n     */\n    public function loadModel($id)\n    {\n        $model=UtenteCreaEvento::model()-&gt;findByPk($id);\n        if($model===null)\n            throw new CHttpException(404,'The requested page does not exist.');\n        return $model;\n    }\n\n    /**\n     * Performs the AJAX validation.\n     * @param CModel the model to be validated\n     */\n    protected function performAjaxValidation($model)\n    {\n        if(isset($_POST['ajax']) &amp;&amp; $_POST['ajax']==='utente-crea-evento-form')\n        {\n            echo CActiveForm::validate($model);\n            Yii::app()-&gt;end();\n        }\n    }\n</code></pre>\n\n<p>i get this kind of error only when i try to manege the entities of this class but all other kind of actions don't gives any kind of problem.\nthanks in advance</p>\n"},{"tags":["entity-framework","ef-code-first","database-schema","initializer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13089448,"title":"How to check if database schema matches Entity Framework schema?","body":"<p>For my surprise, using the <strong>CreateDatabaseIfNotExists</strong> context initializer, the line</p>\n\n<pre><code>context.Database.Initialize(true)\n</code></pre>\n\n<p><strong>doesn't</strong> throw an exception if the schema does not match my code first schema.</p>\n\n<p>Is there a way to validate if the current database matches our schema before, for instance, we try to access a entity, whose table doesn't exist on the database anymore, and an exception is thrown by EF?</p>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13089350,"title":"EF 4.1 DB2 Default Value","body":"<p>I am trying to set a default value for a table using the example here:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/6846952/disabling-entity-frameworks-default-value-generation-code-first\">Disabling Entity Framework&#39;s default value generation (Code First)</a> </p>\n\n<p>I have seen variations of this example and I have tried them all, but I can't get any to work.  The problem is the class in <code>Model.tt</code> already has an empty constructor so I am getting a <code>Type [] already defines a member called [] with the same parameter types</code> exception.</p>\n\n<p>here is my class</p>\n\n<pre><code>namespace Project.DataModel\n{\n    public partial class APPLICANT\n    {\n        public APPLICANT()\n        {\n            EMAIL_ADDRESS = string.Empty;\n        }\n    }\n}\n</code></pre>\n\n<p>Here is the auto generated class in ProjectModel.tt.  I noticed the classes that do not have a relation defined do not have the empty constructor.  Could this be different because my data store is DB2?</p>\n\n<pre><code>    namespace Project.DataModel\n{\n    using System;\n    using System.Collections.Generic;\n\n    public partial class APPLICANT\n    {\n        public APPLICANT()\n        {\n            this.APPLICATION = new HashSet&lt;APPLICATION&gt;();\n        }\n\n        public int APPLICANT_ID { get; set; }\n        public string COMPLETE_NAME { get; set; }\n        public string PREVIOUS_NAME { get; set; }\n        public string SSN { get; set; }\n        public string EMAIL_ADDRESS { get; set; }\n\n        public virtual ICollection&lt;APPLICATION&gt; APPLICATION { get; set; }\n    }\n}\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13089496,"title":"Why I can't call DbContext.ObjectContext directly?","body":"<p>Why I can't call <code>DbContext.ObjectContext</code> directly? I can do this <code>((IObjectContextAdapter)context).ObjectContext</code></p>\n\n<p>I think the inside mechanism is the implicitly implementation of interface like this </p>\n\n<pre><code>class Program \n{ \n    static void Main(string[] args) \n    { \n        TestClass t = new TestClass(); \n        ((TestInterface)t).TestMethod(); \n        // I can't call t.TestMethod()\n        Console.ReadKey(); \n    } \n} \n\npublic interface TestInterface \n{ \n    void TestMethod(); \n} \n\npublic class TestClass : TestInterface \n{ \n    void TestInterface.TestMethod() \n    { \n        Console.WriteLine(\"abcdefg\"); \n    } \n}\n</code></pre>\n\n<p>I meet this problem before which is <code>IEnumerable&lt;T&gt;</code> inherits <code>IEnumerable</code>, it has the generic version <code>IEnumerator&lt;T&gt; GetEnumerator()</code> and non-generic version <code>IEnumerator GetEnumerator()</code>, but you can only call the generic one rather than the non-generic one. Its because that the non-generic one is not type-safe and the author wants to hide it.</p>\n\n<p>But what is the reason for the <a href=\"http://msdn.microsoft.com/en-us/library/system.data.entity.dbcontext%28v=vs.103%29.aspx\" rel=\"nofollow\">DbContext</a> class?</p>\n"},{"tags":["entity-framework","stored-procedures","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":41,"score":-1,"question_id":13088233,"title":"Accessing stored procedures in EF code-first (4.4)","body":"<p>Does anyone know a simple way to access a stored procedure using EF code first in the latest version of Entity Framework? I'm using 4.4 which I think is CTP release 5.</p>\n\n<p>I've searched for examples and tried lots but none seem to work.</p>\n\n<p>Any help appreciated.</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13088260,"title":"Entity Framework One-Zer-One different behavior","body":"<p>Suppose you want to create a parent-child relationship in a table of users that will be the type of zero to one, we want to add further in the same way gender.</p>\n\n<pre><code>public class Gender\n{\n    [Key]\n    public virtual int GenderID { get; set; }\n\n    public virtual string GenderName { get; set; }\n\n    public virtual ICollection&lt;UserProfile&gt; UserProfiles { get; set; }\n}\n</code></pre>\n\n<p>and Userprofile </p>\n\n<pre><code>public class UserProfile\n{\n\n    [Key]\n    public virtual int UserId { get; set; }\n\n    public virtual UserProfile UserParent { get; set; }\n\n    public virtual int? ParentUserId { get; set; }\n\n    public virtual String UserName { get; set; }\n\n    public virtual Gender Gender { get; set; }\n\n    public virtual int? GenderID { get; set; }\n\n  }\n</code></pre>\n\n<p>for clarity</p>\n\n<pre><code>       modelBuilder.Entity&lt;UserProfile&gt;()\n            .HasOptional(c =&gt; c.UserParent);\n\n        // User -&gt; Gender\n        modelBuilder.Entity&lt;UserProfile&gt;()\n            .HasOptional(g =&gt; g.Gender);\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/IhvGJ.png\" alt=\"enter image description here\"></p>\n\n<p>Everything looks good, but at the moment I can not retrieve the data obtained from the Parent UserName.</p>\n\n<pre><code>   public IQueryable&lt;UserProfileListViewModel&gt; UserAllVM\n    {\n        get\n        {\n            var uservm = context.UserProfiles\n                .Select(l =&gt; new UserProfileListViewModel\n                { \n                    UserId = l.UserId,\n                    UserName = l.UserName,\n                    ParentUserId = l.ParentUserId ?? 0,\n                    //ParentUserName = this.context.UserProfiles.Where(e =&gt; e.UserId == l.ParentUserId).FirstOrDefault().UserName ?? \"\",\n                    ParentUserName = l.UserParent.UserName, **// this way make always null**\n                    GenderID = l.GenderID ?? 0,\n                    GenderName = l.Gender.GenderName ?? \"\",\n                });\n\n            return uservm;\n        }\n    }\n</code></pre>\n\n<p>Commented out the way now obtains parent UserName. Question is why I can't retrive Parent UserName - I miss sth ?</p>\n\n<p>Tx for help</p>\n"},{"tags":["entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13088163,"title":"Difficulties while querying with LINQ Many to Many (MTM) association","body":"<p>IMHO, I think this is the hardest thing for me to get - the whole MTM side of LINQ and I need help.</p>\n\n<p>In SQL I have 3 tables: <code>Accounts</code>, <code>AccountsInFeatures</code> and <code>Features</code>. <code>AccountsInFeatures</code> simply has two primary key columns that link to <code>Accounts</code> to <code>Features</code>.</p>\n\n<p>In EF, <code>AccountsInFeatures</code> is not visible - I understand why - but I'm having problems creating the LINQ:</p>\n\n<p>Here's what I'm trying to do:</p>\n\n<pre><code>return (from a in _Store.Accounts\n        where a.AccountGUID == _AccountGUID\n        select new AccountDetails\n        {\n            AccountGUID = a.AccountGUID\n            AccountName = a.AccountName,\n            SelectedFeatures = a.Features.Select(f =&gt; f.FeatureGUID).ToList()\n        }).ToList();\n</code></pre>\n\n<p>Here's the definition for <code>AccountDetails</code>:</p>\n\n<pre><code>public class AccountDetails\n{\n    public Guid AccountGUID { get; set; }\n    public string AccountName { get; set; }  \n    public List&lt;Guid&gt; SelectedFeatures { get; set; }    \n}\n</code></pre>\n\n<p>How do I fill <code>\"SelectedFeatures\"</code> with a list of Features - is this possible? I'm close to just splitting this into two queries =)</p>\n"},{"tags":["c#","entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":30,"score":0,"question_id":13088041,"title":"Entity Framework ObjectSet","body":"<p>Quick question. Take the following method I wrote for my EF repository:</p>\n\n<pre><code>public virtual IEnumerable&lt;T&gt; SelectWhere(Expression&lt;Func&lt;T, bool&gt;&gt; predicate)\n{\n    using (CAMHS_DB db = new CAMHS_DB())\n    {\n        return db.CreateObjectSet&lt;T&gt;().Where(predicate).ToList&lt;T&gt;();\n    }\n}\n</code></pre>\n\n<p>Will EF apply my predicate before it goes to the DB and use it to return only the records I asked for, or will it return everything then apply the predicate??</p>\n\n<p>Thanks,\nWilky.</p>\n"},{"tags":["c#","linq","entity-framework","c#-3.0"],"answer_count":12,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":12048,"score":2,"question_id":2066084,"title":"\"IN\" Operator in Linq","body":"<p>I am trying to convert an old raw Sql query in Linq with Entity Framework here.</p>\n\n<p>It was using the IN operator with a collection of items. The query was something like that: </p>\n\n<pre><code>SELECT Members.Name\nFROM Members\nWHERE Members.ID IN ( SELECT DISTINCT ManufacturerID FROM Products WHERE Active = 1)\nORDER BY Members.Name ASC\n</code></pre>\n\n<p>Since the return of the subquery is not a single string but a collection of strings I can't use the <code>String.Contains()</code> method.</p>\n\n<p>I thought about doing something like : </p>\n\n<pre><code>var activeProducts = (\nfrom products in db.ProductSet\nwhere product.Active == true\nselect product.ManufacturerID);\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>var activeMembers = (\nfrom member in db.ContactSet\nwhere member.ID.ToString().Contains(activeProducts));\n</code></pre>\n\n<p>but it stops at the contains saying it has invalid arguments ... I can't select activeProducts.ManufacturerID because obviously the proprety is not there since it returns an IQueryable...</p>\n\n<p>Bottom line what I'm trying to do here is to return a list of members who have at least one active product.</p>\n\n<p>Any hint ?</p>\n\n<p>[edit]</p>\n\n<p>Here's the full query code ... I tried with the contains on the second expression, Linq didn't seem to like it : </p>\n\n<p><code>Server Error in '/' Application.\nLINQ to Entities does not recognize the method 'Boolean Contains[String](System.Linq.IQueryable``1[System.String], System.String)' method, and this method cannot be translated into a store expression.</code></p>\n\n<pre><code>    var activeProduct =(from product in Master.DataContext.ProductSet\n                        where product.Active == true\n                           &amp;&amp; product.ShowOnWebSite == true\n                           &amp;&amp; product.AvailableDate &lt;= DateTime.Today\n                           &amp;&amp; ( product.DiscontinuationDate == null || product.DiscontinuationDate &gt;= DateTime.Today )\n                        select product.ManufacturerID.ToString() );\n\n    var activeArtists = from artist in Master.DataContext.ContactSet\n                        where activeProduct.Contains(artist.ID.ToString())\n                        select artist;\n\n    NumberOfArtists = activeArtists.Count();\n\n    artistsRepeater.DataSource = activeArtists;\n    artistsRepeater.DataBind();\n</code></pre>\n\n<p>[More details]\nManufacturerID is a nullable GUID apparently...</p>\n\n<p>For some reason the ContactSet class do not contain any reference to the products I guess I will have to do a join query, no clues here.</p>\n"},{"tags":["entity-framework","ef-code-first","mapping"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13087667,"title":"Code First Inheritance Mapping","body":"<p>In code first, using Table Per Hierarchy inheritance (TPH), it automatically adds a where clause in the query, putting the value of the <code>Discriminator</code>.\nI have to use the TPH and retrieve all data without distinction? ie using inheritance, but we always come all the data.</p>\n\n<p>If I try to leave the <code>Discriminator</code> null as well as in the reference table inherited happens the following error when doing a search:</p>\n\n<pre><code>(1217.10): error 3032: Problem in mapping fragments starting at lines 1208, 1217: EntityTypes Repositorio.UseMensagens, Repositorio.EcmMensagens\nare being mapped to the same rows in table UseMensagens. Mapping conditions can be used to Distinguish the rows That these types are mapped to.\n</code></pre>\n\n<p>I always bring all data, regardless of Discriminator, is how to disable it?</p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":780,"score":1,"question_id":1514312,"title":"How to make \"1-to-1\" association works correctly in Entity Framework?","body":"<p>I have objects: \ntype A (Id, Name),\ntype B (AId, Description).</p>\n\n<p>I want to make relation 1-to-1 (and create it 1-to-[0..1]). All works great exept deleting objects of type A. When I'm trying to delete some object from type A exception occurs.</p>\n\n<p>A relationship is being added or deleted from an AssociationSet ‘...’. With cardinality constraints, a corresponding ‘...’ must also be added or deleted.</p>\n\n<p>Im searched for solution (found editing CSDL for many-to-many), but nothing helps. There is also cascade action defined in the table in Database.</p>\n\n<p>Any suggestions?</p>\n\n<p>UPD: Thanks for answers. \nLet's say more clear.</p>\n\n<ol>\n<li><p>I don't want to implement inheretance betwen A and B</p></li>\n<li><p>I try to fix problem by editing edmx file (like this <a href=\"http://codepolice.net/2008/12/16/cascade-delete-in-entity-framework/\" rel=\"nofollow\">http://codepolice.net/2008/12/16/cascade-delete-in-entity-framework/</a>), but no luck. Seems it's only worked for one-to-many.</p></li>\n<li><p>I just want to have 2 objects with one-to-one relation. For example, Order and OrderDetails. I expected automatic creating/deleting OrderDetails for every Order I have.</p></li>\n</ol>\n"},{"tags":["wcf","asp.net-mvc-3","entity-framework","odata"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":439,"score":1,"question_id":8083101,"title":"OData in MVC3 + EF layered architecture","body":"<p>I'm a total newbie to WCF-related stuff, so forgive my naive question, but I am not sure where to start in pinpointing an error while learning OData basics.</p>\n\n<p>I have an existing MVC3 application using a database, using the universal membership provider (added via nuget) and a small SDF database accessed via SQL Server Compact Edition Client Data Provider 4.0. I created it with the following steps:</p>\n\n<p>1) create a <strong>new library project for the data layer</strong>, add EDMX from a database, then add ADO.NET DB context and entities generators templates. </p>\n\n<p>2) create a <strong>new library project for generic data interfaces</strong>: a repository interface, implemented in (1), and the entities t4 template with its output, moved from (1) into this project (changing the TT <em>inputFile</em> parameter so that it refers to the EDMX in the other project).</p>\n\n<p>3) create a new <strong>MVC application</strong> which uses Ninject to instantiate the generic repository declared in (2) with the SDF-based repository implemented in (1).</p>\n\n<p>The web application works fine, and I can view and edit data. Now I should expose some of its functions via a WCF service and I was looking at OData for this. So I added a new WCF Data Service, and changed the generated code just to test it, by adding the name of my entities class (as implemented in (1)) and the name of an entity set, e.g.:</p>\n\n<pre><code>public class ProjectService : DataService&lt;OrganizerEntities&gt;\n{\n    public static void InitializeService(DataServiceConfiguration config)\n    {\n        config.SetEntitySetAccessRule(\"Projects\", EntitySetRights.AllRead);\n        config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;\n    }\n}\n</code></pre>\n\n<p>Anyway when I open the SVC in the browser I get a <em>Request Error</em>: <em>The server encountered an error processing the request. See server logs for more details.</em>. If I look at the log, I see first of all a warning like:</p>\n\n<blockquote>\n  <p>... \n  http://msdn.microsoft.com/it-IT/library/System.ServiceModel.EvaluationContextNotFound.aspx\n  <strong>Configuration evaluation context not found</strong>.\n  ...</p>\n</blockquote>\n\n<p>and then an <strong>ArgumentNullException</strong> exception whose details follow. In all the samples or tutorials I've found I see the typical not-so-real-world example where the data layer is not separated from the consumer application: create a new MVC app, add an EDMX, add a WCF Data Service, change some lines of generated code, and all magically works :). So I suppose this is related to my layered architecture, especially for the missing context warning. Could anyone help in using this service in a layered scenario like this? Thanks!</p>\n\n<blockquote>\n  <p>... Value cannot be null. Parameter name: key\n   at System.Collections.Generic.Dictionary<code>2.FindEntry(TKey\n  key) at System.Collections.Generic.Dictionary</code>2.get_Item(TKey key) at\n  System.Data.Services.Providers.ObjectContextServiceProvider.PopulateMetadata(IDictionary<code>2\n  knownTypes, IDictionary</code>2 childTypes, IDictionary<code>2 entitySets) at\n  System.Data.Services.Providers.BaseServiceProvider.PopulateMetadata()\n  at System.Data.Services.DataService</code>1.CreateProvider() at\n  System.Data.Services.DataService<code>1.HandleRequest() at\n  System.Data.Services.DataService</code>1.ProcessRequestForMessage(Stream\n  messageBody) at SyncInvokeProcessRequestForMessage(Object , Object[] ,\n  Object[] ) at\n  System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object\n  instance, Object[] inputs, Object[]&amp; outputs) at\n  System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage41(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage31(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage11(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc&amp;\n  rpc) at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean\n  isOperationContextSet) \n  System.ArgumentNullException: Value cannot be null.\n  Parameter name: key    at\n  System.Collections.Generic.Dictionary<code>2.FindEntry(TKey key)    at\n  System.Collections.Generic.Dictionary</code>2.get_Item(TKey key)    at\n  System.Data.Services.Providers.ObjectContextServiceProvider.PopulateMetadata(IDictionary<code>2\n  knownTypes, IDictionary</code>2 childTypes, IDictionary<code>2 entitySets)    at\n  System.Data.Services.Providers.BaseServiceProvider.PopulateMetadata() \n  at System.Data.Services.DataService</code>1.CreateProvider()    at\n  System.Data.Services.DataService<code>1.HandleRequest()    at\n  System.Data.Services.DataService</code>1.ProcessRequestForMessage(Stream\n  messageBody)    at SyncInvokeProcessRequestForMessage(Object ,\n  Object[] , Object[] )    at\n  System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object\n  instance, Object[] inputs, Object[]&amp; outputs)    at\n  System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage41(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage31(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage11(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc&amp;\n  rpc)    at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean\n  isOperationContextSet) ...</p>\n</blockquote>\n"},{"tags":["entity-framework","ef-migrations"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":249,"score":0,"question_id":9955180,"title":"Entity Framework 4.3 Migrations and Medium Trust","body":"<p>I would like to use the new migration feature of EF, but on my local machine when I simulate a Medium Trust environment adding \"trust level=Medium\" on the web.config file, I get this security exception:</p>\n\n<pre><code>   System.Reflection.RuntimeMethodInfo.GetMethodBody() +24\n   System.Data.Entity.Migrations.DbMigrator..ctor(DbMigrationsConfiguration configuration, DbContext usersContext) +1031\n   System.Data.Entity.Migrations.DbMigrator..ctor(DbMigrationsConfiguration configuration) +66\n   System.Data.Entity.MigrateDatabaseToLatestVersion`2.InitializeDatabase(TContext context) +52\n   System.Data.Entity.&lt;&gt;c__DisplayClass2`1.&lt;SetInitializerInternal&gt;b__0(DbContext c) +75\n   System.Data.Entity.Internal.&lt;&gt;c__DisplayClass8.&lt;PerformDatabaseInitialization&gt;b__6() +19\n   System.Data.Entity.Internal.InternalContext.PerformInitializationAction(Action action) +72\n   System.Data.Entity.Internal.InternalContext.PerformDatabaseInitialization() +185\n   System.Data.Entity.Internal.LazyInternalContext.&lt;InitializeDatabase&gt;b__4(InternalContext c) +7\n   System.Data.Entity.Internal.RetryAction`1.PerformAction(TInput input) +118\n   System.Data.Entity.Internal.LazyInternalContext.InitializeDatabaseAction(Action`1 action) +190\n   System.Data.Entity.Internal.LazyInternalContext.InitializeDatabase() +73\n   System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType) +28\n   System.Data.Entity.Internal.Linq.InternalSet`1.Initialize() +57\n   System.Data.Entity.Internal.Linq.InternalSet`1.get_InternalContext() +15\n   System.Data.Entity.Infrastructure.DbQuery`1.System.Linq.IQueryable.get_Provider() +37\n   System.Linq.Queryable.Where(IQueryable`1 source, Expression`1 predicate) +63\n</code></pre>\n\n<p>EF Migrations work in Full Trust only?</p>\n"},{"tags":["entity-framework","ef-code-first","ef-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":193,"score":2,"question_id":11611322,"title":"EF 4.3 Code First Migrations - Seed per migration","body":"<p>have recently started using Code First Migrations and was wanting to seed data in each <strong>Up</strong> method.</p>\n\n<p>is this possible?</p>\n\n<p>Ie.</p>\n\n<ol>\n<li>Create database table</li>\n<li>Fill with data</li>\n</ol>\n\n<p>for Drop:</p>\n\n<ol>\n<li>Delete data from joining table</li>\n<li>delete table </li>\n</ol>\n"},{"tags":["c#","entity-framework","sql-server-ce","prism","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":144,"score":0,"question_id":12883379,"title":"Connection String in a EF general DAL assembly","body":"<p><strong>The Structure of the project :</strong></p>\n\n<p>There is a modules folder which I need to add the database and make the repository just there,\nOther modules and assemblies could use that.\nNew : Changed it to previous proved state of placing the config file in the root application,\nstill there are errors.\nThis post is edited completely.</p>\n\n<hr>\n\n<p><strong>The Database Location :</strong></p>\n\n<h2>location : ....\\db\\db.sdf (2 levels upper from the sell's app.config)</h2>\n\n<p><strong>The App.Config file</strong></p>\n\n<p>location : modules\\ModuleX\\ (Formerly)</p>\n\n<h2>New Location : Shell\\ (Main Project)</h2>\n\n<p><strong>New Version :</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;startup&gt;\n    &lt;supportedRuntime version=\"v4.0\" sku=\".NETFramework,Version=v4.5\" /&gt;\n  &lt;/startup&gt;\n  &lt;configSections&gt;\n    &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n  &lt;/configSections&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"MyRecordzContext\" connectionString=\"metadata=res://*...\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;  \n</code></pre>\n\n<hr>\n\n<p><strong>2 Cases of suspect :</strong>\nproviderName=\"System.Data.EntityClient\"</p>\n\n<p>LocalDbConnectionFactory</p>\n\n<hr>\n\n<p><strong>Error Info :</strong></p>\n\n<p><em>Error Line :</em>\n            TblMyRecord MyRecord = context.MyRecords.First(w => w.MyRecord == stMyRecord);</p>\n\n<p><em>Error :</em>\n    No connection string named 'MyRecordzContext' could be found in the application config file.</p>\n\n<hr>\n\n<p><strong>Goal</strong> : How to change the connectionstring , my app.config to make the application work as expected</p>\n\n<hr>\n\n<p>Here EF 5.0, SQL CE , Prism, WPF, MVVM, C# were used</p>\n\n<hr>\n\n<p><strong>Error :</strong></p>\n\n<p>Error :\n    The type initializer for 'System.Windows.Application' threw an exception. </p>\n\n<p>Appears as the application runs.</p>\n\n<p>The error seems to be before any build.</p>\n\n<p><strong>Stack Trace :</strong></p>\n\n<pre><code>PresentationFramework.dll!System.Windows.Application.Application()\nXz.Shell.exe!Xz.Shell.App.App()\nXz.Shell.exe!Xz.Shell.App.Main()\n[Native to Managed Transition]\n[Managed to Native Transition]\nmscorlib.dll!System.AppDomain.ExecuteAssembly(string assemblyFile, System.Security.Policy.Evidence assemblySecurity, string[] args)\nMicrosoft.VisualStudio.HostingProcess.Utilities.dll!Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()\nmscorlib.dll!System.Threading.ThreadHelper.ThreadStart_Context(object state)\nmscorlib.dll!System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback callback, object state, bool preserveSyncCtx)\nmscorlib.dll!System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback callback, object state, bool preserveSyncCtx)\nmscorlib.dll!System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback callback, object state)\nmscorlib.dll!System.Threading.ThreadHelper.ThreadStart()\n[Native to Managed Transition]\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13085664,"title":"Schema not supported error in asp.net mvc web api","body":"<p>I am working on asp.net mvc 4 web api. I am using code first with existing database model. I have a single table in my database so i have the entity class like,</p>\n\n<pre><code>public class Tab1\n{\n[Key]\npublic int Field1{get; set;}\npublic string Field2{get; set;}\n}\n</code></pre>\n\n<p>I have DBContext file like,</p>\n\n<pre><code>public class MyDBContext:DbContext\n{\npublic DbSet&lt;Tab1&gt; Table{ get; set; }\n\n protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n           modelBuilder.Entity&lt;Bar&gt;().ToTable(\"bars\");\n        }\n}\n</code></pre>\n\n<p>and my Get Action is like</p>\n\n<pre><code> public List&lt;Bar&gt; GetTables()\n            {\n               MyDBContext context=new MyDBContext();\n                return context.Table.ToList();\n            }\n</code></pre>\n\n<p>But I am getting an error <strong>Schema specified is not valid error 0064: Facet 'MaxLength' must not be specified for type 'mediumtext'.</strong>. so please guide if i did any mistake in the process.</p>\n\n<p>Here i have one more class like</p>\n\n<pre><code>public class Tab2:Tab1\n{\npublic string Filed3{get; set;}\n}\n</code></pre>\n\n<p>I dont want to create table in database with tab2 since i used tab2 class for returning custom records. I got the above error due to Tab2 inheriting from tab1 when i remove class tab2 it works as usual. so please guide me.</p>\n"},{"tags":["asp.net-mvc","oracle","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13077810,"title":"Oracle Sequences, Entity Framework and getting nextval in an MVC3 View","body":"<p>I'm currently using Entity Framework inside an MVC3 application to connect to an Oracle Database. I want to write a new record to a table in the Oracle database which includes a sequence that defines it's primary key. Of course, the primary key is defined to be not null. All my views are written in ASP.Net instead of Razor.</p>\n\n<p>I see that most posts out there recommend setting a StoreGeneratedPattern directly on the edmx model. However, I notice that most edmx model examples like this one: <a href=\"http://stackoverflow.com/questions/7351260/oracle-entity-in-vs-entity-framework-doesnt-update-the-primary-key-in-code\">Oracle entity in VS entity framework doesnt update the primary key in code</a>  include the tables defined using EntityTypes -the table in question I want to do this on is actually encompassed in an EntitySet:</p>\n\n<pre><code>&lt;EntitySet Name=\"REGISTERED_PERSON\" EntityType=\"Model.Store.REGISTERED_PERSON\" store:Type=\"Tables\" Schema=\"MYSCHEMA\" /&gt;\n</code></pre>\n\n<p>and when I try to set StoreGeneratedPattern=Identity on this, I get an error that the StoreGeneratedPattern attribute is not allowed, presumably because it is not an EntityType. I had originally thought about just getting the max. registered_person_id from the database via LINQ statement and then assigning that into the model, but then the problem arises that you'd get a duplicate ID if two inserts were executed at the same time. </p>\n\n<p>I also checked the database and I don't have any triggers written. I know that in Oracle you can opt to select from dual to get the next value which is generated by the sequence, such as illustrated below:\n<br>select MY_SEQ.nextval,'some value' from dual</p>\n\n<p>This post here: <a href=\"http://stackoverflow.com/questions/2189114/postgresql-nextval-question-on-sequences\">postgresql nextval question on sequences</a> has a great title, but the problem with that is that I'm not working with postgresql or PHP, so unfortunately it doesn't help me. I also don't have any triggers written to fire the sequence upon insert of a record. </p>\n\n<p>How do I go about getting the nextvalue from the sequence and assign it to my Registered_Person_Id, preferably in the view before the entire model object gets passed back to the controller to insert in the database? </p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework","stored-procedures","ado.net"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":101,"score":3,"question_id":12710455,"title":"Why is my broken stored procedure being dropped?","body":"<p>I have an ASP.NET MVC 4 project configured to use Entity Framework 5, backed by a SQL Server database.</p>\n\n<p>One of the stored procedures in my DB performs an illegal operation: it tries to insert a <code>NULL</code> value into a <code>NOT NULL</code> column. Understandably, this fails.</p>\n\n<p>Inexplicably, Entity Framework (or some other component of my ASP.NET MVC stack, or perhaps my SQL Server database) then <strong>drops the stored procedure</strong> from the database!</p>\n\n<p>A screenshot of the error message I receive when I attempt to call my stored procedure is below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/3Nt2M.jpg\" alt=\"The error page displayed\"></p>\n\n<p>I can't seem to find any documentation on this behaviour. </p>\n\n<p><strong>Why is this happening, and what can I do to prevent stored procedures from being dropped?</strong></p>\n"},{"tags":[".net","asp.net-mvc-3","entity-framework","controller","httprequest"],"answer_count":4,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":1203,"score":7,"question_id":5425920,"title":"ASP.NET MVC: Controller created for every request?","body":"<p>Very simple question: Are controllers in ASP.NET created for every http request ? Or are they created at application startup and reused throughout requests ?</p>\n\n<p>For some particular http request only the requested controller will created ? Is that right ? </p>\n\n<p>If my previous assumptions are correct can I depend on it ? I want to create database context (Entity framework) that will live only for one request. If I create it as a property initialized in controller's constructor is it granted that new instance of context will be created on for every request ?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13086186,"title":"Create a many-to-many relationship with EntityFramework","body":"<p>I’m working on a project in <em>ASP.NET MVC 3</em> using <strong>EntityFramework</strong> and the problem I have is that I have one table with companies, and one table with categories.</p>\n\n<p>What I want to do is only insert the <strong>relationship</strong> I have between them, but haven’t managed to do that yet.</p>\n\n<p>If I try to grab it from the database like this:</p>\n\n<pre><code>var category = db.Category.Where(x =&gt; x.ID == currentCategoryID).FirstOrDefault();\ncompanyToUpdate.Category.Add(category);\n</code></pre>\n\n<p>But the problem with that is that category is then of type </p>\n\n<pre><code>{System.Data.Entity.DynamicProxies.Category_C66FA509B8CE171E77E12035BD64A5510586182A788CBB79855B613AEF6AA551}\n</code></pre>\n\n<p>and wont save because of that.</p>\n\n<p>So I tried the following:</p>\n\n<pre><code>var category = db.Category.Where(x =&gt; x.ID == currentCategoryID).FirstOrDefault();\ncategory = new Category {\n    ID = category.ID,\n    Title = category.Title\n}\ncompanyToUpdate.Category.Add(category);\n</code></pre>\n\n<p>But the problem with this method is that is adds a completely new element to the category table.</p>\n\n<p>Does anyone have any idea how i can <strong>only</strong> create the relationship between these two already existing elements?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13084159,"title":"passing parameters to stored procedure entity framework with sql server 2005","body":"<p>I have a stored proc which takes a int as parameter.  I am using entity framework code first along with MVC and I am making the call in this manner</p>\n\n<pre><code>        SqlParameter sa = new SqlParameter(\"@userId\", userId);\n        var query = from dashboardData in TBSCIDBContext.Database.SqlQuery&lt;MyNomination&gt;(\"sp_GetMyNominationList @userId\", sa)\n                    select dashboardData;\n        return query.ToList();\n</code></pre>\n\n<p>in profiler I get</p>\n\n<pre><code>exec sp_executesql N'sp_GetMyNominationList @userId',N'@userId int',@userId=4  \n</code></pre>\n\n<p>This executes correctly on using sql server 2008 but now my db is changed to 2005\nand the same exec statement gives me</p>\n\n<p>Incorrect syntax near 'sp_GetMyNominationList'. because I am running it in 2005. </p>\n\n<p>I have to use 2005 please tell me a way to make this run in 2005 so that the parameter is taken correctly by the sql profiler</p>\n"},{"tags":["c#","entity-framework","mvvm",".net-4.0","freeze"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13084672,"title":"Lazy Loading in EF4.0 is freezing UI","body":"<p>Hi I am designing an application using WPF, EF and MVVM (.NET4.0).</p>\n\n<p>I face issue with freezing UI when I'm binding data. I think this is because of lazy loading.</p>\n\n<p>MVVM:</p>\n\n<pre><code>        ThreadPool.QueueUserWorkItem(state =&gt;\n        {\n                IsProgressBarVisible(true);\n\n                var service = Context.SomeModel.ToList();\n                BgServiceCompleted(service);\n        });\n</code></pre>\n\n<p>XAML:</p>\n\n<pre><code>\"{Binding OrderItemViews.SOmeModel_A.SomeModel_B.SOmeField}\"\n\"{Binding OrderItemViews.Country.Name}\"\n</code></pre>\n\n<p>Some Model:</p>\n\n<pre><code>public class SomeModel_A\n{\n    public int Id { get; set; }\n    ....        \n    public int SomeB_Id { get; set; }\n    public virtual SomeModel_B SomeModel_B { get; set; }\n}\n</code></pre>\n\n<p>I found a solution for this problem.</p>\n\n<p>1) setting the IsAsync-Property in the ItemsSource-Binding.</p>\n\n<pre><code>\"{Binding OrderItemViews.SOmeModel_A.SomeModel_B.SOmeField, IsAsync=true}\"\n</code></pre>\n\n<p>The interface does not freeze, but the value appears after a while time. This will confuse some users. </p>\n\n<p>2) using Include for loading include data.\nFor instance: </p>\n\n<pre><code>Context.SomeModel.Include(a =&gt; a.SomeModel2).Load();\n</code></pre>\n\n<p>but in my case Context doesn't have <strong>Include</strong>. Why?</p>\n\n<p>Which the best way to solve this problem?</p>\n\n<p>Could you please give me a guidance on how should I do that or any useful resource I can read and learn about it?\nThanks</p>\n"},{"tags":["vb.net","entity-framework","sqlite","datasource"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12975032,"title":"Can't use SQLite Entity Framework as DataGridView DataSource","body":"<p>I've built an Entity Framework Model from a simple SQLite database using the 'Entity Data Model Wizard'</p>\n\n<p>This works fine and I've been programming aginst it for a while.</p>\n\n<p>However, I've just tried to use this SQLite entity framework model as a DataSource for a DataGridView and it cannot see it as a datasource. Everything suggests that this should be possible. Creating a DataSet from the same database works and the DataGridView can use this as a datasource.</p>\n\n<p>I would prefer to use the entity framework but can't understand why it's not seeing it as a valid datasource.</p>\n\n<p>Please help!</p>\n\n<p>As requested here is the app.config file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;&lt;/configSections&gt;\n  &lt;system.data&gt;\n    &lt;DbProviderFactories&gt;\n  &lt;add name=\"SQLite Data Provider\" invariant=\"System.Data.SQLite\" description=\".Net Framework Data Provider for SQLite\" type=\"System.Data.SQLite.SQLiteFactory, System.Data.SQLite\" /&gt;\n&lt;/DbProviderFactories&gt;\n  &lt;/system.data&gt;\n  &lt;system.diagnostics&gt;\n    &lt;sources&gt;\n      &lt;!-- This section defines the logging configuration for My.Application.Log --&gt;\n  &lt;source name=\"DefaultSource\" switchName=\"DefaultSwitch\"&gt;\n    &lt;listeners&gt;\n      &lt;add name=\"FileLog\" /&gt;\n      &lt;!-- Uncomment the below section to write to the Application Event Log --&gt;\n      &lt;!--&lt;add name=\"EventLog\"/&gt;--&gt;\n    &lt;/listeners&gt;\n  &lt;/source&gt;\n&lt;/sources&gt;\n&lt;switches&gt;\n  &lt;add name=\"DefaultSwitch\" value=\"Information\" /&gt;\n&lt;/switches&gt;\n&lt;sharedListeners&gt;\n  &lt;add name=\"FileLog\" type=\"Microsoft.VisualBasic.Logging.FileLogTraceListener, Microsoft.VisualBasic, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a, processorArchitecture=MSIL\" initializeData=\"FileLogWriter\" /&gt;\n  &lt;!-- Uncomment the below section and replace APPLICATION_NAME with the name of your application to write to the Application Event Log --&gt;\n  &lt;!--&lt;add name=\"EventLog\" type=\"System.Diagnostics.EventLogTraceListener\" initializeData=\"APPLICATION_NAME\"/&gt; --&gt;\n&lt;/sharedListeners&gt;\n  &lt;/system.diagnostics&gt;\n  &lt;startup useLegacyV2RuntimeActivationPolicy=\"true\"&gt;\n    &lt;supportedRuntime version=\"v4.0\" sku=\".NETFramework,Version=v4.0\" /&gt;\n  &lt;/startup&gt;\n  &lt;connectionStrings&gt;\n  &lt;add name=\"simpleEntities\" connectionString=\"metadata=res://*/GEM.Classes.test1.csdl|res://*/GEM.Classes.test1.ssdl|res://*/GEM.Classes.test1.msl;provider=System.Data.SQLite;provider connection string=&amp;quot;data source=E:\\simple.db3&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>As a test I've used a very simple database:</p>\n\n<pre><code>CREATE TABLE SETTINGS (\nKEY VARCHAR(50) PRIMARY KEY NOT NULL ,\nVALUE VARCHAR(255)  NULL DEFAULT NULL);\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12732161,"title":"How to automate setting ConcurrencyMode=Fixed on all RowVersion columns?","body":"<p>EF defaults to no concurrency control (last write wins) which allows lost updates.\nEnforcing optimistic concurrency checks can explicitly be configured by setting ConcurrencyMode=Fixed on a RowVersion column.</p>\n\n<p>How can we automate setting ConcurrencyMode=Fixed on RowVersion columns in all tables?\nHaving to do this manually when recreating an EF model from a database we risk forgetting it an running without concurrency control.</p>\n"},{"tags":[".net","entity-framework","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12956021,"title":"How to trace DbQuery parameter values","body":"<p>We are tracing the generated SQL using qry.ToString.\nHow can we trace the parameter values too.</p>\n\n<p>DbQuery (in contrast to ObjectQuery) does not have a Parameters property.</p>\n\n<p>Using SqlProfiler is not an option. We are tracing using log4net in production.</p>\n"},{"tags":["c#","entity-framework","dto"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13084110,"title":"Best practice to manage state of a disconnected entity passing to the UI and back to the business","body":"<p>I've read a couple of posts on how STEs are considered bad in n-tier web applications because they are bloated, and carry a lot of unnecessary weight. </p>\n\n<p>Are there any ways then, if I were to use DTOs, to be able to track which properties were modified by the UI layer before saving them back into the DB?</p>\n\n<p>I like the idea of STEs because they don't require me to update my 50 column table if the client only modified one of the field. (I'm assuming this is the main benefit of STEs?)</p>\n"},{"tags":["c#",".net","entity-framework","architecture"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13065146,"title":"Wrapping EntityFrameWork with IDal<T> interface","body":"<p>I want to wrap my <code>EntityFrameWork</code> class with <code>IDal&lt;T&gt;</code> interface with <code>CRUD operations</code> only.</p>\n\n<p>I thought to create BL Data Model corresponding to each Entity</p>\n\n<p>Meaning if I have <code>TempEntity</code> I'll create <code>TempBlObj</code> and interface <code>IDal&lt;TempBlObj&gt;</code></p>\n\n<p>Are there any guideliness to complete such task?</p>\n\n<p>I had a problem implementing <code>Save(TempBlObj)</code></p>\n\n<p>as saving in entity is done by:</p>\n\n<p><code>mDbEntities.SaveChanges();</code></p>\n\n<p>and this relays on change that had been done on entity reference.</p>\n\n<p>Any solutions?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I'm doing all this in order to mock my <code>IDal&lt;T&gt;</code> interface</p>\n\n<p>For example in order to change TempEntity.status</p>\n\n<p>I'll have to create a concrete method <code>ChangeStatus()</code> instead of generic <code>CRUD</code> : <code>Save(BlObj item)</code></p>\n\n<p>as save with entity is done like</p>\n\n<p><code>..take reference to some entity, do some change..</code> and</p>\n\n<p><code>mMamDbEntities.SaveChanges();</code></p>\n\n<p>I tried to add BlObjects in order to loosen dependency between the Bl and concrete EntityFW</p>\n\n<p><strong>More General:</strong></p>\n\n<p>When using ORM, what is the best practice for loose cupling, working with <code>IDal&lt;T&gt;</code> intreface (<code>CRUD</code> operations) ?</p>\n"},{"tags":["wcf","entity-framework","wcf-data-services","odata","change-tracking"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13082926,"title":"WCF Data Service Change Tracking: How to cancel save changes and revert to original values for an object","body":"<p>I have a WCF Data Service that is wrapping an Entity Framework 4 data model. I am connecting a WPF client to the service using the WCF Data Services Client library.</p>\n\n<p>Is it possible in WCF Data Services to undo / cancel changes to tracked objects ?</p>\n\n<p>scenario : In the UI I allow a user to edit an object. I have save and cancel buttons. If the user chooses to save I call SaveChanges() on my WCF context and changes are sent to the database via the WCF service. If the user clicks cancel I want to undo the changes and revert to the original property values of the current object.</p>\n\n<p>I know that the WCF data services client library has change tracking built in - but I cannot find any way at accessing this information.</p>\n\n<p>In Entity Framework the context supports the Refresh method and you can specify RefreshMode.StoreWins and pass in the object - this will effectively cancel / undo any changes.\ndocumented here  : <a href=\"http://msdn.microsoft.com/en-us/library/bb896255.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb896255.aspx</a></p>\n\n<p>Any suggestions on how I can achieve the same thing in WCF DataServices in my client application ?</p>\n\n<p>cheers\nChris</p>\n"},{"tags":["entity-framework","prism","connection-string"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13038354,"title":"Entity Connection in a Modular Prism Application","body":"<p><strong>Connection String Meta :</strong></p>\n\n<pre><code>                res://Xz.Business.xModule/Model.RecordzModel.csdl|\n                res://Xz.Business.xModule/Model.RecordzModel.ssdl|\n                res://Xz.Business.xModule/Model.RecordzModel.msl;\n</code></pre>\n\n<hr>\n\n<p><strong>Errors :</strong></p>\n\n<p><em>After Adding Business.xModule into the Config File's URI s :</em></p>\n\n<pre><code>+       base    {\"Unable to load the specified metadata resource.\"} System.Data.EntityException {System.Data.MetadataException}\n</code></pre>\n\n<p>--\n<em>After Adding Xz.Business.xModule into the Config File's URI s  :</em></p>\n\n<pre><code>+       base    {\"Unable to resolve assembly 'Xz.Business.xModule'.\":null}  System.IO.IOException {System.IO.FileNotFoundException}\n</code></pre>\n\n<hr>\n\n<p><strong>xModule Info :</strong></p>\n\n<p>The Assembly Name : Business.xModule</p>\n\n<p>Default Namespace : Xz.Business.xModule</p>\n\n<hr>\n\n<p><strong>Folder Locations :</strong></p>\n\n<p>Solution Folder and xModule Module Folder</p>\n\n<p>Solution Location..\\x1\\x2\\xModule Location</p>\n\n<p>Modules Location\nSolution Location..\\Build</p>\n\n<p>\"..\" Means a folder back.</p>\n\n<hr>\n\n<p><strong>Notes :</strong></p>\n\n<ol>\n<li>The modules have Post-Build Action which place the result assemblies into the \"Build Folder\"</li>\n<li>Other pieces of the config are correct.</li>\n<li>Unity, SQL CE, EF 5.0 were used.</li>\n</ol>\n\n<p>How to resolve this Entity Connection Problem ?</p>\n"},{"tags":["entity-framework","many-to-many","dynamic-data"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":105,"score":0,"question_id":8476583,"title":"How do I make a ManyToMany_Insert template for EF Dynamic Data?","body":"<p>I'm extremely new to Dynamic Data, but I'll fire this off anyway.</p>\n\n<p>I have an EF model set up, with a PJT table linking Shows and Genres. The EDMX correctly displays this as a * - * relationship between Shows and Genres, with navigation properties. Using Dynamic Data, I can create a Show item, but then only once it is created, can I edit it to link up the Genres (which are nicely displayed as check boxes).</p>\n\n<p>I've read this <a href=\"http://blogs.msdn.com/b/davidebb/archive/2008/10/25/a-many-to-many-field-template-for-dynamic-data.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/davidebb/archive/2008/10/25/a-many-to-many-field-template-for-dynamic-data.aspx</a> article which everyone refers to, but I can't see how to use the ManyToMany_Edit.ascx Field template on the Show insert page. Interestingly, in the ManyToMany_Edit.ascx.cs file that I have, there is a comment that says </p>\n\n<blockquote>\n  <p>// This field template is used both for Editing and Inserting</p>\n</blockquote>\n\n<p>But I can't see it being used for inserting!</p>\n\n<p>Any pointers would be greatly appreciated!</p>\n"},{"tags":["linq","entity-framework","linq-to-entities","entity"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13080190,"title":"Entity Frameworks: How to decrypt a field prior to OrderBy","body":"<p>I have an IQueryable list of Customer entities (EntityFrameworks).  I need to do an orderby on this IQueryable list but the issue is that the field that I want to use for ordering is encrypted in the database.  Is there any way that I can decrypt this field prior to ordering?  Can I write some kind of Linq extension for OrderBy.  Since there could be thousands of Customers, I don't want to materialize the list just so it can be sorted...</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities","linq-expressions"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":80,"score":4,"question_id":13056943,"title":"EF orderby / thenby combo extension method","body":"<p>I want to be able to apply combo <code>firstby / thenby</code> sorting as follows:</p>\n\n<pre><code>allOrders().sort(s =&gt; s.ProductName, s =&gt; s.OrderDate)\n</code></pre>\n\n<p>So using <a href=\"http://stackoverflow.com/a/5376637/1711500\">this post as inspiration</a>, I wrote this extension method, which compiles fine:</p>\n\n<pre><code>public static IQueryable&lt;T&gt; sort&lt;T&gt;(this IQueryable&lt;T&gt; entities, params \n  Expression&lt;Func&lt;T, object&gt;&gt;[] predicates) where T : class \n{\n  var sorted = entities.OrderBy(predicates[0]);\n  for (int i = 1; i &lt; predicates.Length; i++)\n    sorted = sorted.ThenBy(predicates[i]);\n\n  return sorted;\n}\n</code></pre>\n\n<p>And I also tried this succint version, which also compiles:</p>\n\n<pre><code>public static IQueryable&lt;T&gt; sort&lt;T&gt;(this IQueryable&lt;T&gt; entities, params \n  Expression&lt;Func&lt;T, object&gt;&gt;[] predicates) where T : class\n{\n  return predicates.Skip(1).Aggregate(\n    entities.OrderBy(predicates[0]),\n    (aggregate, currentPredicate) =&gt; aggregate.ThenBy(currentPredicate));\n}\n</code></pre>\n\n<p>However if I try sort by a <code>DateTime</code>, I get this exception:  </p>\n\n<blockquote>\n  <p><em>Unable to cast the type 'System.DateTime' to type 'System.Object'. LINQ to Entities only supports casting EDM primitive or enumeration types.</em></p>\n</blockquote>\n\n<p>What am I doing wrong? I am using EF5.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13077918,"title":"Updates are not factored to the database using Entity Framework","body":"<p>Following code doesn't update my database for the record found and when looking at Azure SQL Profiler I see only this update statement.</p>\n\n<pre><code>update [dbo].[Identities]\nset @p = 0\nwhere ([Id] = @0)\n</code></pre>\n\n<p>and the code:</p>\n\n<pre><code>using (var db = new context())\n{\n    var member = db.Identities.Include(\"Member\").Include(\"Roles\")\n                   .FirstOrDefault(i =&gt; id.Value == i.nameidentifier &amp;&amp; i.identityprovider == provider.Value);\n\n    if (member != null)\n    {\n        member.LastLoggedIn = DateTime.UtcNow;\n        db.SaveChanges();\n    }\n}\n</code></pre>\n"},{"tags":["c#","linq","entity-framework","generic-list"],"answer_count":1,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":101,"score":6,"question_id":13062462,"title":"Proper way to construct linq queries to achieve fastest performance?","body":"<p>Similar question have been asked here but none fits to my need.<br>\nI made test cases to see which is faster. But I feel my linq code is still slow. How do I construct the linq code for faster performance?  </p>\n\n<p>Others said using double <code>.Tolist()</code> can cause slower operation, when I test it, it shows that it is faster than any other tests.</p>\n\n<p>Test:  </p>\n\n<pre><code>Preparation\n---------------------------------------------------------------\nreturn Properties of UserInfo(userinf, true){\n    UserID = userinf.UserID;\n    FirstName = userinf.user.FirstName;\n    MiddleName = userinf.user.MiddleName;\n    LastName = userinf.user.LastName;\n    LoginID = userinf.user.LoginID;\n    Birthday = userinf.Birthday;\n}\n\nskip = 0;\ntake = 100;\n\ntotal table records = 304;\n\nLinq to Entity Framework \n</code></pre>\n\n<p>Fiddler: v2.4.0.0  </p>\n\n<pre><code>https://127.0.0.1/..../RetrieveUserInfo?skip=0&amp;take=100\n{\n    \"client\":{\n        \"SessionID\":\"5433ab64-7e0d-444f-b886-a901ea9a0601\"\n    },\n    \"session\":{\n        \"SessionID\":\"35b75daa-25ad-45a4-9f99-0e69ec3b66a4\"\n    }\n}\n</code></pre>\n\n<hr>\n\n<pre><code>//Test 1\n//1) 00:00:15.3068755 -- Attempt1\n//2) 00:00:13.8207905 -- Attempt2\n//3) 00:00:16.2489294 -- Attempt3\n\nvar list = (from usr in dbase.userinfoes\n            select usr).OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList();\n\nuserlist = (from i in list\n            select new UserInfo(i, true)).ToList();\n\n\n///Test 2\n//1) 00:00:15.3908803\n//2) 00:00:14.8818512\n//3) 00:00:19.4761140\n\nvar list = (from usr in dbase.userinfoes.AsEnumerable().OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList()\n            select new UserInfo(usr, true)).ToList();\n\n\n//Test 3\n//1) 00:00:30.1937270\n//2) 00:00:24.1003784\n//3) 00:00:28.8806519\n\nvar list = dbase.userinfoes.OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList();\nuserlist = (from i in list select new UserInfo(i, true)).ToList();\n\n\n//Test 4\n//1) 00:00:57.2652754\n//2) 00:00:54.4051118\n//3) 00:00:55.3251644\n\nvar list = (from usr in dbase.userinfoes\n            select usr).ToList();\n\nuserlist = (from i in list\n            select new UserInfo(i, true)).OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList();\n\n\n//Test 5\n//1) 00:01:06.8378229\n//2) 00:01:01.2845053\n//3) 00:00:55.0721499\n\nvar list = from usr in dbase.userinfoes\n           select usr;\n\nuserlist = (from i in list.AsEnumerable()\n            select new UserInfo(i, true)).OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList();\n\n\n// Test 6\n// VERY LONG. It tooks all records first and construct UserInfo one by one before doing the skip and take\n\nvar list = (from usr in dbase.userinfoes.AsEnumerable()\n            select new UserInfo(usr, true)).OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList();\n\n\n//Test 7\n// VERY LONG. It tooks all records first and construct UserInfo one by one before doing the skip and take\n\nvar list = from usr in dbase.userinfoes.AsEnumerable()\n           select new UserInfo(usr);\n</code></pre>\n\n<p>Proper code for faster search. Thanks to <code>casperOne</code> for pointing out that <strong>the ordering, skip and take are all performed on the server</strong> is more faster. </p>\n\n<p>Here is the final code:  </p>\n\n<pre><code>var list = (from usr in dbase.userinfoes\n                .OrderBy(i =&gt; i.UserID)\n                .Skip(skip)\n                .Take(take)\n                .AsEnumerable()\n            select new UserInfo(usr, true)).ToList();   \n\n1) 00:00:10.9210513\n2) 00:00:10.8270973\n3) 00:00:10.8250151\n</code></pre>\n\n<p>Thanks to <code>Richard Neil Ilagan</code> for the final code.</p>\n"},{"tags":["c#","entity-framework","find","dbcontext"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":129,"score":2,"question_id":13059548,"title":"DBContext Find with Includes - where lambda with Primary keys","body":"<p>I am writing a generic repository to interface with EF using DBContext. </p>\n\n<p>I have a generic Get() method which receives a primary key value and returns the entity:</p>\n\n<pre><code>public class DALRepository&lt;DALEntity&gt; : IDisposable, IGenericRepository&lt;DALEntity&gt; where DALEntity : class\n{\nprivate IDbSet&lt;DALEntity&gt; dbSet;\nprivate NWEntities context;\n\npublic DALRepository()\n{\n  context = new NWEntities();\n  context.Configuration.LazyLoadingEnabled = false;\n  dbSet = context.Set&lt;DALEntity&gt;();\n}\n</code></pre>\n\n<p>Here's a simple get method - just works on the PK - exactly what I want.</p>\n\n<pre><code>public DALEntity Get(string ID)\n{\n   return dbSet.Find(ID);\n}\n</code></pre>\n\n<p>I now want to change this to allow the consumer to pass in a list of includes - so as well as returning just a customer they can request to return the orders as well. Here's where I'm running into trouble. If I do this:</p>\n\n<pre><code>public DALEntity Get(string ID, IEnumerable&lt;string&gt; IncludeEntities = null)\n{\n      IQueryable&lt;DALEntity&gt; query = dbSet;\n      query = IncludeEntities.Aggregate(query, (current, includePath) =&gt; current.Include(includePath));\n}\n</code></pre>\n\n<p>I can't use find with the IQueryable.  And I can't Find() directly because I can't pass includes to it. If I use a where lambda instead on the IQueryable, how do I tell it to use the PK of the entity? I guess I could have a generic constraint that insists the generic type must implement some IPkey interface with a well-defined primary column name such as \"ID\", but then I can't use the entities generated by DBContext as they woudl have to implement this interface. I can change the T4 to do this if I need - and I've already changed it to emit XML comments so not too averse to that - but does anyone have a simpler way? I suppose what I need is an overloaded find() which accepts a list of includes.</p>\n\n<p>So my question is either how to use Find with includes, or how to write the lambda where it knows the PK? I can't receive such a lambda as a parameter as this will ultimately be consumed by a WCF service.</p>\n"},{"tags":["c#","entity-framework","insert","sql-update","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13078576,"title":"Bulk inserting and updating with Entity Framework (Probably a better alternative?)","body":"<p>I have a data set of devices, addresses, and companies that I need to import into our database, with the catch that our database may already include a specific device/address/company that is included in the new data set. If that is the case, I need to update that entry with the new information in the data set, excluding addresses. We check if an exact copy of that address exists, otherwise we make a new entry.</p>\n\n<p>My issue is that it is very slow to attempt to grab a device/company in EF and if it exist updated it, otherwise insert it. To fix this I tried to get all the companies, devices, and addresses and insert them into respective hashmaps, and check if the identifier of the new data exists in the hashmap. This hasn't led to any performance increases. I've included my code below. Typically I would do a batch insert, I'm not sure what I would do for a batch update though. Can someone advise a different route?</p>\n\n<pre><code>            var context = ObjectContextHelper.CurrentObjectContext;\n            var oldDevices = context.Devices;\n            var companies = context.Companies;\n            var addresses = context.Addresses;\n\n            Dictionary&lt;string, Company&gt; companyMap = new Dictionary&lt;string, Company&gt;(StringComparer.OrdinalIgnoreCase);\n            Dictionary&lt;string, Device&gt; deviceMap = new Dictionary&lt;string, Device&gt;(StringComparer.OrdinalIgnoreCase);\n            Dictionary&lt;string, Address&gt; addressMap = new Dictionary&lt;string, Address&gt;(StringComparer.OrdinalIgnoreCase);\n            foreach (Company c in companies)\n            {\n                if (c.CompanyAccountID != null &amp;&amp; !companyMap.ContainsKey(c.CompanyAccountID))\n                    companyMap.Add(c.CompanyAccountID, c);\n            }\n            foreach (Device d in oldDevices)\n            {\n                if (d.SerialNumber != null &amp;&amp; !deviceMap.ContainsKey(d.SerialNumber))\n                    deviceMap.Add(d.SerialNumber, d);\n            }\n            foreach (Address a in addresses)\n            {\n                string identifier = GetAddressIdentifier(a);\n                if (!addressMap.ContainsKey(identifier))\n                    addressMap.Add(identifier, a);\n            }\n\n            foreach (DeviceData.TabsDevice device in devices)\n            {\n                // update a device\n                Company tempCompany;\n                Address tempAddress;\n                Device currentDevice;\n                if (deviceMap.ContainsKey(device.SerialNumber)) //update a device\n                    deviceMap.TryGetValue(device.SerialNumber, out currentDevice);\n                else // insert a new device\n                    currentDevice = new Device();\n                currentDevice.SerialNumber = device.SerialNumber;\n                currentDevice.SerialNumberTABS = device.SerialNumberTabs;\n                currentDevice.Model = device.Model;\n                if (device.CustomerAccountID != null &amp;&amp; device.CustomerAccountID != \"\")\n                {\n                    companyMap.TryGetValue(device.CustomerAccountID, out tempCompany);\n                    currentDevice.CustomerID = tempCompany.CompanyID;\n                    currentDevice.CustomerName = tempCompany.CompanyName;\n\n                }\n                if (companyMap.TryGetValue(device.ServicingDealerAccountID, out tempCompany))\n                    currentDevice.CompanyID = tempCompany.CompanyID;\n                currentDevice.StatusID = 1;\n                currentDevice.Retries = 0;\n                currentDevice.ControllerFamilyID = 1;\n                if (currentDevice.EWBFrontPanelMsgOption == null) // set the Panel option to the default if it isn't set already\n                    currentDevice.EWBFrontPanelMsgOption = context.EWBFrontPanelMsgOptions.Where( i =&gt; i.OptionDescription.Contains(\"default\")).Single();\n                // link the device to the existing address as long as it is actually an address\n                if (addressMap.TryGetValue(GetAddressIdentifier(device.address), out tempAddress))\n                {\n                    if (GetAddressIdentifier(device.address) != \"\")\n                        currentDevice.Address = tempAddress;\n                    else\n                        currentDevice.Address = null;\n                }\n                else // insert a new Address and link the device to it (if not null)\n                {\n                    if (GetAddressIdentifier(device.address) == \"\")\n                        currentDevice.Address = null;\n                    else\n                    {\n                        tempAddress = new Address();\n                        tempAddress.Address1 = device.address.Address1;\n                        tempAddress.Address2 = device.address.Address2;\n                        tempAddress.Address3 = device.address.Address3;\n                        tempAddress.Address4 = device.address.Address4;\n                        tempAddress.City = device.address.City;\n                        tempAddress.Country = device.address.Country;\n                        tempAddress.PostalCode = device.address.PostalCode;\n                        tempAddress.State = device.address.State;\n                        addresses.AddObject(tempAddress);\n                        addressMap.Add(GetAddressIdentifier(tempAddress), tempAddress);\n                        currentDevice.Address = tempAddress;\n                    }\n                }\n                if (!deviceMap.ContainsKey(device.SerialNumber)) // if inserting, add to context\n                {\n                    oldDevices.AddObject(currentDevice);\n                    deviceMap.Add(device.SerialNumber, currentDevice);\n                }\n            }\n            context.SaveChanges();\n</code></pre>\n"},{"tags":["sql","entity-framework","application-role"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":33,"score":3,"question_id":13048888,"title":"how to enable SQL Application Role via Entity Framework","body":"<p>I'm now developing big government application with entity framework. at first i have one problem about enable SQL application role. with ado.net I'm using below code:</p>\n\n<pre><code>SqlCommand cmd = new SqlCommand(\"sys.sp_setapprole\");\n            cmd.CommandType = CommandType.StoredProcedure;\n            cmd.Connection = _sqlConn;\n            SqlParameter paramAppRoleName = new SqlParameter();\n            paramAppRoleName.Direction = ParameterDirection.Input;\n            paramAppRoleName.ParameterName = \"@rolename\";\n            paramAppRoleName.Value = \"AppRole\";\n            cmd.Parameters.Add(paramAppRoleName);\n\n            SqlParameter paramAppRolePwd = new SqlParameter();\n            paramAppRolePwd.Direction = ParameterDirection.Input;\n            paramAppRolePwd.ParameterName = \"@password\";\n            paramAppRolePwd.Value = \"123456\";\n            cmd.Parameters.Add(paramAppRolePwd);\n\n            SqlParameter paramCreateCookie = new SqlParameter();\n            paramCreateCookie.Direction = ParameterDirection.Input;\n            paramCreateCookie.ParameterName = \"@fCreateCookie\";\n            paramCreateCookie.DbType = DbType.Boolean;\n            paramCreateCookie.Value = 1;\n            cmd.Parameters.Add(paramCreateCookie);\n\n            SqlParameter paramEncrypt = new SqlParameter();\n            paramEncrypt.Direction = ParameterDirection.Input;\n            paramEncrypt.ParameterName = \"@encrypt\";\n            paramEncrypt.Value = \"none\";\n            cmd.Parameters.Add(paramEncrypt);\n\n            SqlParameter paramEnableCookie = new SqlParameter();\n            paramEnableCookie.ParameterName = \"@cookie\";\n            paramEnableCookie.DbType = DbType.Binary;\n            paramEnableCookie.Direction = ParameterDirection.Output;\n            paramEnableCookie.Size = 1000;\n            cmd.Parameters.Add(paramEnableCookie);\n\n            try\n            {\n                cmd.ExecuteNonQuery();\n                SqlParameter outVal = cmd.Parameters[\"@cookie\"];\n                // Store the enabled cookie so that approle  can be disabled with the cookie.\n                _appRoleEnableCookie = (byte[]) outVal.Value;\n\n            }\n            catch (Exception ex)\n            {\n                result = false;\n                msg = \"Could not execute enable approle proc.\" + Environment.NewLine + ex.Message;\n            }\n</code></pre>\n\n<p>But no matter how much I searched I could not find a way to implement on EF.</p>\n\n<p>my another question is: how to Add Application Role to Entity data model designer???</p>\n"},{"tags":["asp.net","entity-framework","connection-string","data-access-layer","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":13031965,"title":"No context type was found in the assembly","body":"<p>I'm using .NET 4.0, MVC3, and EF5 with code first.</p>\n\n<p>My project is split up into three layers, with the dependencies as indicated:</p>\n\n<p>Project.Web -> Project.BLL -> Project.DAL</p>\n\n<p>The Project.DAL layer contains my entity framework data context class and all my entities, but  my startup project is Project.Web, so it contains my Web.config, connection strings, and the actual SQL compact database.</p>\n\n<p>I'm trying to enable migrations so I can add a new table to my EF model without wiping the existing data. However, when I run \"Enable-Migrations\", I get</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>No context type was found in the assembly 'Project.Web'.\n</code></pre>\n\n<p>If I set the startup project as Project.DAL, the error changes to</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Could not load assembly 'Project.Web'. (If you are using Code First Migrations inside Visual Studio this can happen if the startUp project for your solution does not reference the project that contains your migrations. You can either change the startUp project for your solution or use the -StartUpProjectName parameter.)\n</code></pre>\n\n<p>Does anyone know why this error is being caused or what I can do to fix it?</p>\n"},{"tags":["vb.net","oracle","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13067511,"title":"How to get the Trigger value By method SaveChange In VB MVC?","body":"<p>I used SaveChange Function to save my data and Trigger In Oracle to create a new ID of data when i insert and how can i get this ID from Trigger in MVC3 ? Thx so much</p>\n"},{"tags":["c#","sql-server","linq","entity-framework","date"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13076094,"title":"How to query a date range from a varchar column using LINQ","body":"<p>I have inherited a large SQL Server database that has a certain table that has a certain date column that is a varchar(8) datatype in the <strong>yyyyMMdd</strong> date string format. Why it isn't a datetime datatype or something similar is beyond me. (maybe to save space? Legacy db ported to SQL Server long ago?)</p>\n\n<p>Withouting getting too flustered over the date wanna-be field, grabbing rows using a single date from this column is pretty straight forward using the Entity Framework (DBContext w/LINQ) as shown below:</p>\n\n<pre><code>var rows = cxt.TableOfRandomDateColumn.Where(x =&gt; x.Date == myDateStr).ToList();\n</code></pre>\n\n<p>That's about as easy as it gets. However, what if I wanted to grab a range of dates from this column? What would be the best way to go about doing something like that?</p>\n"},{"tags":["vb.net","entity-framework","ef-code-first","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13075344,"title":"EF 5.0 - Can't make bi-directional relationship work with Code First","body":"<p>I have a class called WidgetCollection.  It has an Items property exposing a List(Of Widget) and a SelectedWidget property.  I would expect EF to build the database as follows:</p>\n\n<ul>\n<li>Add a WidgetCollection_Id property in my Widgets table, specifying\nwhich WidgetCollection each widget is in</li>\n<li>Add a SelectedWidget_Id property in my WidgetCollection table, specifying which of the\nWidgets is selected</li>\n<li>Add a 1-to-many relationship from WidgetCollection.Id to Widget.WidgetCollection_Id</li>\n<li>Add a 1-to-0-or-1 relationship from Widget.Id to WidgetCollection.SelectedWidget_Id</li>\n</ul>\n\n<p>I can confirm that it does appear to build the database schema correctly, however I get the following error if I ever save the context after assigning to SelectedWidget:</p>\n\n<blockquote>\n  <p>System.Data.Entity.Infrastructure.DbUpdateException occurred\n    HResult=-2146233087\n    Message=An error occurred while saving entities that do not expose foreign key > properties for their relationships. The EntityEntries property will return null because a single entity cannot be identified as the source of the exception. Handling of exceptions while saving can be made easier by exposing foreign key properties in your entity types. </p>\n</blockquote>\n\n<p>With an inner exception of</p>\n\n<blockquote>\n  <p>Unable to determine a valid ordering for dependent operations. Dependencies may exist due to foreign key constraints, model requirements, or store-generated values.</p>\n</blockquote>\n\n<p>I can prevent this error by never assigning WidgetCollect.SelectedWidget.</p>\n\n<p>I guess the problem is that EF can't work out what to do with relationships in both directions, but I just can't find a way to point it in the right direction.  Example code follows, all suggestions welcome!</p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>Public Class Widget\n    Private miId As Integer\n    Public Property Id As Integer\n        Get\n            Return miId\n        End Get\n        Set(value As Integer)\n            miId = value\n        End Set\n    End Property\n\n    Private msName As String\n    Public Property Name As String\n        Get\n            Return msName\n        End Get\n        Set(value As String)\n            msName = value\n        End Set\n    End Property\nEnd Class\nPublic Class WidgetCollection\n    Private miId As Integer\n    Public Property Id As Integer\n        Get\n            Return miId\n        End Get\n        Set(value As Integer)\n            miId = value\n        End Set\n    End Property\n\n\n    Private msName As String\n    Public Property Name As String\n        Get\n            Return msName\n        End Get\n        Set(value As String)\n            msName = value\n        End Set\n    End Property\n\n    Private moSelectedWidget\n    Public Property SelectedWidget As Widget\n        Get\n            Return moSelectedWidget\n        End Get\n        Set(value As Widget)\n            moSelectedWidget = value\n        End Set\n    End Property\n\n    Private moWidgets As New List(Of Widget)\n    Public Property Widgets As List(Of Widget)\n        Get\n            Return moWidgets\n        End Get\n        Set(value As List(Of Widget))\n            moWidgets = value\n        End Set\n    End Property\n\nEnd Class\n\nPublic Class MyContext\n    Inherits DbContext\n    Public Property Widgets As DbSet(Of Widget)\n    Public Property WidgetCollections As DbSet(Of WidgetCollection)\nEnd Class\n\nClass Application\n    Public Sub New()\n        Database.DefaultConnectionFactory = New SqlCeConnectionFactory(\"System.Data.SqlServerCe.4.0\", \"\", \"Data Source=\\EFtest.sdf\")\n        Database.SetInitializer(New DropCreateDatabaseIfModelChanges(Of MyContext))\n        Dim oContext = New MyContext\n\n        Dim oWidgetA = New Widget With {.Name = \"Widget A\"}\n        Dim oWidgetB = New Widget With {.Name = \"Widget A\"}\n        Dim oWidgetCollection = New WidgetCollection With {.Name = \"My widget collection\"}\n        oWidgetCollection.Widgets.Add(oWidgetA)\n        oWidgetCollection.Widgets.Add(oWidgetB)\n        oWidgetCollection.SelectedWidget = oWidgetA  'Removing this line prevents error\n\n        oContext.WidgetCollections.Add(oWidgetCollection)\n        oContext.SaveChanges()\n    End Sub\nEnd Class\n</code></pre>\n"},{"tags":[".net","entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":13073221,"title":"EF SaveChanges not calling Validate (IValidatableObject)","body":"<p>By default, EF uses EntityObject when generating the objects. I've modified it to use my own AbstractEntityObject class. In doing so, I've added IValidatableObject as I was under the impression when you called context.SaveChanges() it would automatically call Validate and throw the exceptions.</p>\n\n<p>Here is what I have:</p>\n\n<pre><code>public abstract class AbstractEntityObject : EntityObject, IValidatableObject\n{\n    private readonly DBTable table;\n\n    protected AbstractEntityObject(DBTable table)\n    {\n        this.table = table;\n    }\n\n    public IEnumerable&lt;ValidationResult&gt; Validate(ValidationContext validationContext)\n    {\n        List&lt;OITValidationResult&gt; results = new List&lt;OITValidationResult&gt;();\n        List&lt;PropertyInfo&gt; properties = new List&lt;PropertyInfo&gt;(GetType().GetProperties());\n\n        foreach (DBField field in table.GetFields())\n        {\n            foreach (PropertyInfo prop in properties)\n                if (StringUtilities.EqualsIgnoreCase(field.FieldName, prop.Name))\n                {\n                    results.AddRange(field.Validate(prop.GetValue(this, null)));\n                    results.AddRange(AdditionalValidation(field, prop));\n                    properties.Remove(prop);\n                    break;\n                }\n        }\n\n        return results;\n    }\n\n    public abstract List&lt;OITValidationResult&gt; AdditionalValidation(DBField field, PropertyInfo prop);\n}\n\npublic abstract class AbstractTLMSEntityObject : AbstractEntityObject\n{\n    protected AbstractTLMSEntityObject(DBTable table) \n        : base(table)\n    {\n    }\n\n    public override List&lt;OITValidationResult&gt; AdditionalValidation(DBField field, PropertyInfo prop)\n    {\n        List&lt;OITValidationResult&gt; results = new List&lt;OITValidationResult&gt;();\n\n        if (!EntityState.Equals(EntityState.Unchanged))\n        {\n            if (StringUtilities.EqualsIgnoreCase(field.FieldName, \"userid\"))\n                prop.SetValue(this, TLMSDB.User.UserName, null);\n            else if (StringUtilities.EqualsIgnoreCase(prop.Name, \"dtmod\"))\n                prop.SetValue(this, DateTime.Now, null);\n        }\n\n        OITValidationResult additionalResult = AdditionalValidation(field.Field);\n        if (additionalResult != null)\n            results.Add(additionalResult);\n\n        return results;\n    }\n\n    /* By default there is no additional validation, subclasses should override this if they need additional validation */\n    public virtual OITValidationResult AdditionalValidation(Enum field)\n    {\n        return null;\n    }\n}\n</code></pre>\n\n<p>Then, I have the subclass, which is a partial class along with the one that EF creates:</p>\n\n<pre><code>public partial class CSDCrud\n{\n    public enum Fields\n    {\n        RECEIPT_NUMBER,\n        GRANT_ID,\n        GRANT_FUND,\n        TOTAL_ACRES\n    }\n\n    public CSDCrud() : base(CSDCrudDAO.Instance.Table)\n    {\n    }\n\n    public static String GetDataPropertyName(Enum field)\n    {\n        return CSDCrudDAO.Instance.Table.GetField(field).FieldName;\n    }\n}\n</code></pre>\n\n<p>CSDCrud inherits from AbstractTLMSEntityObject thanks to me changing that in the .tt file.</p>\n\n<p>Now here is where it gets weird. I have set it up so the DBField (referenced in the parent class) does self validation of the data. In this case, I have set it up so if receipt_number is required and thus will fail and throw an exception...In fact, the following occurs...</p>\n\n<pre><code>List&lt;OITValidationResult&gt; results = (List&lt;OITValidationResult&gt;)crudObject.Validate(null);\ntry\n{\n    CommonEntityManager.GetContext().CrudSet.AddObject(crudObject);\n    CommonEntityManager.GetContext().SaveChanges();\n    return true;\n}\ncatch (Exception ex)\n{\n    return false;\n}\n</code></pre>\n\n<p>As expected, results contains 1 item which is the proper error...however the SaveChanges saves it out just fine, without throwing an exception...what am I missing?</p>\n\n<p>edit: I should note, obviously I can use the SavingChanges event to add in my own handler, but I'm hoping to use the pre-existing infrastructure.</p>\n\n<pre><code>static void context_SavingChanges(object sender, EventArgs e)\n    {\n        foreach (ObjectStateEntry ose in context.ObjectStateManager.GetObjectStateEntries(EntityState.Modified))\n        {\n            List&lt;ValidationResult&gt; results = new List&lt;ValidationResult&gt;(((IValidatableObject)ose.Entity).Validate(null));\n            if (results.Count &gt; 0)\n                throw new CustomException(results);\n        }\n\n        foreach (ObjectStateEntry ose in context.ObjectStateManager.GetObjectStateEntries(EntityState.Added))\n        {\n            List&lt;ValidationResult&gt; results = new List&lt;ValidationResult&gt;(((IValidatableObject)ose.Entity).Validate(null));\n            if (results.Count &gt; 0)\n                throw new CustomException(results);\n        }\n    }\n</code></pre>\n"},{"tags":["sql-server","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":80,"score":3,"question_id":13035353,"title":"Using SQL Server named parameters with ExecuteStoreQuery and ExecuteStoreCommand","body":"<p>I am trying to use SQL Server named parameters with <code>ObjectContext.ExecuteStoreQuery</code> and <code>ObjectContext.ExecuteStoreCommand</code> when calling a stored procedure or a function directly.</p>\n\n<p>SQL Server named parameters are not the same with the Entity Framework named parameters - they allow me to execute a query similar with this one:</p>\n\n<pre><code>EXEC sp_GetData @firstParameter = 1, @thirdParameter = 2, @secondParameter = 1\n</code></pre>\n\n<p>The order of the parameters in this query does not matter as opposed with Entity Framework named parameters that are evaluated in order.</p>\n\n<p>I want to use SQL Server named parameters with Entity Framework so that if the order of the parameters is changed in the stored procedure the Entity Framework code calling it is not affected.</p>\n"},{"tags":["entity-framework","dbcontext","objectcontext"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13074468,"title":"How do I stop Entity Framework from generating BOTH ObjectContext and dbContext","body":"<h2>Background</h2>\n\n<ul>\n<li>Visual Studio 2012</li>\n<li>NEW Model.EDMX file created in VS2012</li>\n<li>Copied some of the EDMX xml from a previously created EDMX into the new one</li>\n</ul>\n\n<h2>Problem / Question</h2>\n\n<p>Now.  The EDMX (TT transform, custom tool, whatever, etc.) is generating BOTH DbContext classes (under the Model.tt/Model.Context.tt files) <em>and</em> ObjectContext classes (via the Model.designer.cs file).  See image below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/lr7gH.png\" alt=\"Both the Model.tt AND the Designer.cs files are defining my entities\"></p>\n\n<p>Everything builds fine and works with the DbContext (but obviously only if I delete the Designer.cs file just before building) but the Designer.cs - and its ObjectContext-based code - keeps reappearing.  How do I stop this behavior?!</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":49,"score":5,"question_id":13072304,"title":"Is it possible to test whether a given expression can be converted to SQL *without* connecting to a SQL database?","body":"<p>For example:-</p>\n\n<pre><code>// This one will be converted to SQL no problem\nExpression&lt;Func&lt;Foo, bool&gt;&gt; predicate = x =&gt; x.Name = \"Foo\";\n\n// This one will throw a NotSupportedException because the QueryProvider\n// doesn't support reference comparisons\nExpression&lt;Func&lt;Foo, bool&gt;&gt; predicate = x =&gt; x == someOtherFoo;\n\n// This one doesn't work because the query provider can't\n// handle IsAwesome()\nExpression&lt;Func&lt;Foo, bool&gt;&gt; predicate = x =&gt; x.IsAwesome();\n</code></pre>\n\n<p>I'm looking for a way to test this before runtime, ideally in an automated test isolated from the database.</p>\n\n<p>I spent some time trawling through MSDN trying to find how to instantiate my own QueryProvider, but my Google-fu appears to be failing me today.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["entity-framework","sql-server-ce"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2145,"score":1,"question_id":3674302,"title":"Can Entity Framework be used to generate SQL Server Compact database","body":"<p>I created a project as described <a href=\"http://technet.microsoft.com/en-us/library/cc835495%28SQL.100%29.aspx\" rel=\"nofollow\">here</a> using Visual Studio 2010 and .NET 4 (Win7/x64). Once I've change the platform target to 'Any CPU' the sample project works. However, if try to generate a model from entity data model (right-click the model and select 'Generate Database from Model'), I get the following error.</p>\n\n<p><em>Could not find the appropriate DbProviderManifest to generate the SSDL. The supplied provider invariant name 'System.Data.SqlServerCe.3.5' is not valid.</em></p>\n\n<p>I have a reference to System.Data.SqlServerCe on my project.</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":110,"score":3,"question_id":13007540,"title":"How to track changes of collections","body":"<p>I have a class that contains objects of another class:</p>\n\n<pre><code>public class Container\n{\n    public BindingList&lt;Item&gt; Items { get; set; }\n}\npublic class Item\n{\n    ...\n}\n</code></pre>\n\n<p>Objects of the <code>Container</code> are attached to a <code>DbContext</code>. I want to override the <code>DbContext's</code> <code>SaveChanges()</code> to send all changes via a WCF service.</p>\n\n<p>Primitive attributes are no problem. They are reflected in the <code>Entries</code>. But if the relationship between an <code>Item</code> and its <code>Container</code> changes (e.g. a new item is added or an existing item is deleted) there is no entry about that in the ChangeTracker.</p>\n\n<p>I could add a <code>ForeignKey</code> in the Item class to force a <code>Modified</code> entry, but this does not help me much, because I need to know the containing object.</p>\n\n<p>I also tried to convert the <code>DbContext</code> to <code>ObjectContext</code> to get all related items of an entity. But I see no way to get the actual object of a <code>RelatedEnd</code>.</p>\n\n<p>Is there a way to track changes of the contained collection?</p>\n\n<h2>Update</h2>\n\n<p>As requested, some code I already have:</p>\n\n<pre><code>//In a DbContext subclass\npublic override int SaveChanges()\n{\n    //get all modified entities\n    var changes = this.ChangeTracker.Entries();\n    foreach (var c in changes)\n    {\n        //check the state of the entity\n        switch (c.State)\n        {\n            //send according WCF callback to the clients\n            case System.Data.EntityState.Added:\n                App.Current.ServerManager.SendEvent(s =&gt; s.EntityAdded((IIdentifiable)c.Entity), causedBy);\n                break;\n            ...\n        }\n    }\n    return base.SaveChanges();\n}\n</code></pre>\n\n<p>With this code, I cannot detect changes of the <code>Items</code> collection.</p>\n"},{"tags":["sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13070365,"title":"Calling .Remove() is executing an UPDATE statement instead of a DELETE and results in error: \"Cannot insert value NULL into column\"","body":"<p>Here is the snippet of code where I am deleting my object:</p>\n\n<pre><code>var foo = this.repository.GetFoo();\n\nforeach (var item in foo.RelatedItems.ToList()) {\n    if (x == y) {\n        //Update happens here; this isn't executing however.\n    } else {\n        //This code block is executed; this is where I am telling the context to mark this object for deletion.\n        foo.RelatedItems.Remove(item);\n    }\n}\n\nthis.repository.Save();\n</code></pre>\n\n<p>When the <code>.Save()</code> is called, I am getting an error:  \"Cannot insert value NULL into column\".  I used the profiler to see what SQL was actually getting executed and it was:</p>\n\n<pre><code>update dbo.RelatedItems\nset foreignKey = null\nwhere id = X\n</code></pre>\n\n<p>I would expect a delete statement to be executed here, but, for some reason it's trying to update the record by setting the foreign key to null.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I added the following code to my repository class to solve the issue:</p>\n\n<pre><code>public void DeleteItem(Item item) {\n    context.Entry(item).State = System.Data.EntityState.Deleted;\n}\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first","asp.net-mvc-4","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":98,"score":3,"question_id":13070431,"title":"Unique Constraint with Entity Framework using Code First Migrations","body":"<p>I am doing entity framework (v 5) code first migrations, on an MVC 4 application. I would like to add a unique constraint at the database level. </p>\n\n<p>I know this can be done when creating the table, but I already have a table.\n<a href=\"http://msdn.microsoft.com/en-US/data/jj591621\" rel=\"nofollow\">http://msdn.microsoft.com/en-US/data/jj591621</a></p>\n\n<p>I have tried the following, marked as answer answer: <a href=\"http://stackoverflow.com/questions/6727738/unique-constraint-with-efcodefirst-and-sqlce4\">Unique constraint with EFCodeFirst and SqlCe4</a></p>\n\n<p>My database context differes slightly, I supply the connection name is as follows</p>\n\n<pre><code>public AppDatabaseContext() : base(\"MyConnectionDBContext\")\n</code></pre>\n\n<p>When I use the Package Management Console to update the database, the overridden seed method is not called:</p>\n\n<pre><code>protected override void Seed(AppDatabaseContext context)\n</code></pre>\n\n<p>I have also tried the following: <a href=\"http://romiller.com/2010/07/31/ef-ctp4-tips-tricks-running-additional-ddl/\" rel=\"nofollow\">http://romiller.com/2010/07/31/ef-ctp4-tips-tricks-running-additional-ddl/</a></p>\n\n<p>I did not use a nested class, this is because it seemed as if I had to registere the initializer via the app.config. I could not get it working while initializing it in code. The InitializeDatabase is called, but the following condition is never true:</p>\n\n<pre><code>(!context.Database.Exists() || !context.Database.ModelMatchesDatabase())\n</code></pre>\n\n<p>This is because this happens after the migrations have been run...</p>\n\n<p>I also tried this at one stage: <a href=\"http://stackoverflow.com/questions/4413084/unique-constraint-in-entity-framework-code-first\">Unique Constraint in Entity Framework Code First</a>, it was the same problem as before, this condition was never returning true.</p>\n\n<p>Ideally, I would like to include some standard SQL in my migration file. Is there a way to do that? If not, where can I see how to achieve this with using code first migrations?</p>\n\n<p>Thanks!</p>\n\n<p>UPDATE:</p>\n\n<p>Is there any reason why I can't use the SQL function? </p>\n\n<pre><code> public override void Up()\n {\n        AddColumn(\"Posts\", \"Abstract\", c =&gt; c.String());\n\n        Sql(\"UPDATE Posts SET Abstract = LEFT(Content, 100) WHERE Abstract IS NULL\");\n }\n</code></pre>\n\n<p>Obviously using the correct SQL...</p>\n"},{"tags":["c#","silverlight","entity-framework","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":11888372,"title":"Alternative to Interface w/ Ria Services","body":"<p>All of my Entities will have the following properties:</p>\n\n<pre><code>Employee CreatedBy { get; set; }\nEmployee ModifiedBy { get; set; }\nDateTime CreatedDate { get; set; }\nDateTime ModifiedDate { get; set; }\n</code></pre>\n\n<p>This is for a very large application and the entities are all pulled from different databases and, therefore, are in different <code>.edmx</code> files.</p>\n\n<p>Mostly, these will be displayed in a <code>DataGrid</code> and I want to have a tooltip display all of that information.  <code>Employee</code> is a View that is in every database.</p>\n\n<p>What I would normally do, would be to create an interface <code>IEmployee</code> that the <code>Employee</code> entity from each namespace would implement.  Then I would create an <code>IToolTipEnabled</code> interface with the properties listed above, and I would implement that wherever needed.</p>\n\n<p>Then, I would be able to use a single converter on the Silverlight side for the tooltip content.  As it is, I would have to basically create a new converter for each entity type, in order to get the cast right.</p>\n\n<p><strong>Is there a good way to do this?</strong></p>\n\n<p>Thanks for taking the time to read this and for any help/insight you might be able to provide!</p>\n\n<p><strong>EDIT: ken2k's solution is definitely the correct one, simply place the interfaces in a '.shared.cs' file and in that same shared file (or another <em>shared</em> file) put partial class definitions of the class implementing the interface.  That's all it takes.</strong></p>\n"},{"tags":["c#","wpf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13069597,"title":"Entity framework query completed event","body":"<p>So my Question is: Is there a Query completed event???</p>\n\n<p>I am using entity framework in order to query some data from a database and display it in a WPF application. My problem is that rendering finishes before entity framework has received the results from the database server, thus my list of data on the UI remains empty. In contrast if I enter debug mode and just wait a little before moving on to list the data, the query finishes and the data gets \nlisted.</p>\n\n<p>How should I approach this Problem??</p>\n\n<p><strong>EDIT:</strong>\nHere is my code:</p>\n\n<pre><code>public class DatabaseModel : DbContext, INotifyPropertyChanged\n    {\n        public ObservableCollection&lt;Employee&gt; observableCollection;\n        public event PropertyChangedEventHandler PropertyChanged;\n\n        public DbSet&lt;Employee&gt; Employees { get; set; }\n        public ObservableCollection&lt;Employee&gt; ObservableEmployees\n        {\n            get\n            {\n                return observableCollection;\n            }\n            set\n            {\n                observableCollection = value;\n                OnPropertyChanged(\"ObservableEmployees\");\n            }\n        }\n\n        public DatabaseModel()\n        {\n            ObservableEmployees = Employees.Local;\n        }\n\n        // Create the OnPropertyChanged method to raise the event \n        protected void OnPropertyChanged(string name)\n        {\n            PropertyChangedEventHandler handler = PropertyChanged;\n            if (handler != null)\n            {\n                handler(this, new PropertyChangedEventArgs(name));\n            }\n        }\n    }\n</code></pre>\n\n<p>And how I use My DataBinding through WPF:\nin App.Xaml I define an Instance of this Class...</p>\n\n<pre><code>&lt;Application.Resources&gt;\n        &lt;local_database:DatabaseModel x:Key=\"DatabaseInstance\"/&gt;\n&lt;/Application.Resources&gt;\n</code></pre>\n\n<p>And using the data in Mainwindow.XAML</p>\n\n<pre><code>&lt;ListBox ItemsSource=\"{Binding Source={StaticResource DatabaseInstance}, Path=ObservableEmployees, NotifyOnSourceUpdated=True}\" \n                             DisplayMemberPath=\"Name\"\n                             Binding.SourceUpdated=\"ListBox_SourceUpdated\"&gt;\n                    &lt;/ListBox&gt;\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13069612,"title":"Entity Framework Query Execution Results","body":"<p>We are contemplating the use of Entity Framework for a bulk upload job. Because we are interested in tracking the individual results of each recorded, I am trying to find out whether all items inserted are done as part of a transaction and if a single failure would cause a rollback, or if there is a way to track the result of each individual result.</p>\n\n<p>I was contemplating just looping through the items and calling Save() on each and wrapping that in a try/catch block, but just calling save() on the context seems more effective if I can tap into the individual results.</p>\n\n<p>Thanks!</p>\n"},{"tags":["entity-framework","entity-framework-4.1","ef-code-first","key","unique"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":684,"score":1,"question_id":7306356,"title":"How to add unique non primary-key field to entity using Entity Framework 4.1?","body":"<p>We are using Entity Framework 4.1 Code first.</p>\n\n<p>We've got user entity with primary key set to <code>UserId</code> and need <code>UserLogin</code> to be unique. How can it be done?</p>\n"},{"tags":["database","entity-framework","database-design","orm","mapping"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":13020230,"title":"Mapping 3 tables relation to single entity. ORM best practices?","body":"<p>after several attempts and some searching I finally decided to try it here.</p>\n\n<p>Short story: <strong>I have created quite a 'normalized' database design for content management system application and now I am trying to map it to EF entities.</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/SxOek.png\" alt=\"enter image description here\"></p>\n\n<p>I have M:N relationship between Pages and their content (ContentVersion table) - connected by table Content. This is because the application is multilingual and I am going to store recent history of content edits.</p>\n\n<p>Now, I could just create DbContext from my db, scaffold few controllers and have a solid base, but there would be a problem with that. When I would try to create new Page, I would be allowed to basically enter just a Title and Slug, but there would be no content for that page. I can of course connect that somehow with other entities and make some hierarchical business logic that would be updating several entities every time, but I first wanted to try a bit more abstract approach.</p>\n\n<p><strong>I think I basically need entity splitting over 3 related tables.</strong> I want to create an entity (let's call it FinalPage), that could be used to work with page as one piece -> use it to scaffold controllers etc.</p>\n\n<p>FinalPage is something that user fills up when creating a new Page, so it would contain:</p>\n\n<p><strong>Title</strong> (from Page entity)<br>\n<strong>Slug</strong> (from Page entity)<br>\n<strong>TemplateId</strong> (from Page entity)<br>\n<strong>LanguageId</strong> (from Content entity)<br>\n<strong>Title</strong> (from ContentVersion entity)<br>\n<strong>Body</strong> (from ContentVersion entity)<br>\n+ other related fields from ContentVersion entity</p>\n\n<p>When I would generate 'create new' page for it, I would fill everything and everything would get saved into appropriate tables.</p>\n\n<p>I tried creating new entity in my entity model, mapping properties to different tables.. tried several approaches, but never got working solution. Mostly because of typical 'you need to map every key' error. I was checking <a href=\"http://www.robbagby.com/entity-framework/entity-framework-modeling-entity-splitting/\" rel=\"nofollow\">this post from Rob Bagby</a>, but he was connecting just two tables, that shared same key. </p>\n\n<p>I also tried something what felt really silly... creating entity (entA) from Page and Content entities - connected by PageId property. And creating second one (entB) from Content and ContentVersion - connected by ContentId. Then I wanted to create third (entC) that would connect entA and entB. That also didn't work (and I am actually glad, because that would be really weird solution).</p>\n\n<p>I feel like I am:<br>\na.) Missing something obvious.<br>\nb.) Having a bad database design.<br>\nc.) Wanting too much from EF.</p>\n\n<p><strong>Any help is welcomed.<br>\n - If you see something terrible in the database design, please let me\n   know.<br>\n - If you know, how to achieve my goal, please share.<br>\n - If you have experience with this type of apps and have better solution,\n   I would like to hear about it.</strong></p>\n\n<p>I am also basically looking for some best-practices.</p>\n"},{"tags":["entity-framework","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13054088,"title":"Entity Framework Function Import Trims Leading Zeros From String","body":"<p>I have a funny issue with Entity Framework function import. I am importing a stored procedure from MS SQL Server 2008 R2, and it returns just one string. However, it is too complex for EF to infer this return type, so when defining function import I had to manually specify that the function returns a collection of scalars (<code>ObjectResult&lt;global::System.String&gt;</code>, as was generated).</p>\n\n<p>Sometimes, the procedure returns a string containing only digits and starting with zero (e.g., <code>01234</code>). When I access this result in the code, it turns out to be without the starting zero (<code>1234</code>)!</p>\n\n<p>I know several workarounds, so it is not a question. I want to understand what's going on.</p>\n\n<p>My wild guess is that in my case - when SP is too complex to \"predict\" its result - EF first tries to \"guess\" the type of the returned data by the format of that data. I.e., it sees a number (<code>01234</code>), and converts it into integer type (<code>int</code>, <code>short</code> - whatever). Then it sees that I want a <code>string</code>, and converts this number back into <code>string</code>, but of course during these conversions starting zero is lost. Is that true, or is there a better explanation?</p>\n\n<p>UPDATE: This is a screenshot for function import:</p>\n\n<p><img src=\"http://i.stack.imgur.com/ZHdcm.png\" alt=\"Function Import\"></p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13067288,"title":"Entity Framework Required Foreign Key = validation error on db.SaveChanges","body":"<p>I have these classes for my Company Entity </p>\n\n<pre><code>    public class Company\n    {\n        public Company()\n        {\n            this.Users = new HashSet&lt;User&gt;();\n            this.Tools = new HashSet&lt;Tool&gt;();\n        }\n\n        public int Id { get; set; }\n        public string Name { get; set; }\n        public string Address { get; set; }\n\n        public virtual ICollection&lt;User&gt; Users { get; set; }\n        public virtual ICollection&lt;Tool&gt; Tools { get; set; }\n        [Required]\n        public virtual CompanyGroup CompanyGroup { get; set; }\n    }\n\n    public class CompanyDto\n    {\n        public string Name { get; set; }\n        public string Address { get; set; }\n    }\n</code></pre>\n\n<p>in the CompaniesController i've added an additional class with the Id parameter for usage in edit/update methods like this</p>\n\n<pre><code>    public class CompanyViewEditModel : CompanyDto {\n        public int Id { get; set; }\n    }\n</code></pre>\n\n<p>The Edit Method looks like that:</p>\n\n<pre><code>        [HttpPost]\n        public ActionResult Edit(CompanyViewEditModel companyViewModel)\n        {\n            if (ModelState.IsValid)\n            {\n                var company = db.Companies.Find(companyViewModel.Id);\n                company.InjectFrom(companyViewModel);\n                db.Entry(company).State = EntityState.Modified;\n                db.SaveChanges();\n                return RedirectToAction(\"Index\");\n            }\n            return View(companyViewModel);\n        }\n</code></pre>\n\n<p>The InjectFrom Method is from ValueInjecter.</p>\n\n<p>Everything works as expected only the db.SaveChanges call fails, because of an validation exception. With some digging in the exceptionI've found out that he thinks the company is invalid because the field CompanyGroup is required but if i take a debugger look at the company variable even after the InjectFrom call everything seems to be fine. The corresponding company group is there.</p>\n"},{"tags":["entity-framework","c#-4.0","asp.net-mvc-4","objectstatemanager"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13063576,"title":"optimistic concurrency exception was handled by the user code","body":"<p>I'm using MVC4 with Entity Framework 4.1.</p>\n\n<p>Initially we have created an Ado.net entity model from database. In the .edmx file, some of the tables that are in the database are not visible as they dont posses the primary key on particular table.</p>\n\n<p>As our project is moving forward, we need to update to one of the log tables which dont have a primary key field.</p>\n\n<p>So, we modified our .edmx file instead of modifying in the database. our client asked us not to modify the database fields. we have modified the .edmx and created a pk on one of the exisiting field in the table(say <code>tbl_log</code> table).</p>\n\n<p>we are trying to update the tbl_log. But it gives an error message as <code>Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.</code></p>\n\n<p>I've seen much of questions in stack overflow and also googled a bit, but could not find any solution.</p>\n\n<p>Even i've tried refreshing the ObjectStateManager entries but it still points to the same error.</p>\n\n<p>Here is my code</p>\n\n<pre><code>    tbl_log log = new tbl_log();\n\n                    Entity.ObjectStateManager.GetObjectStateEntries(System.Data.EntityState.Modified);\n\n    log.LoginId = strLoginId;\n    log.Password = strPassword;\n    log.IPAddress = strIpAddress;\n    log.Date_Time = DateTime.Parse(DateTime.Now.ToString());\n    log.sessionId = new Guid(strSessionId);\n\n    Entity.AddTotbl_log(log);\n\nEntity.SaveChanges();// optimistic concurrency error\n</code></pre>\n\n<p>Please help</p>\n\n<p>Thanks,</p>\n\n<p>Karthik</p>\n"},{"tags":["entity-framework","visual-studio-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":140,"score":0,"question_id":13054212,"title":"VS 2012 - EF 5.0 - Update Model from Database - Not picking up table changes","body":"<p>In Visual Studio 2010 EF 4, I could add a new column to a database table, then click 'Update Model from Database' on my .edmx and all was good in the world.</p>\n\n<p>In Visual Studio 2012 EF 5, I alter a table, and then click 'Update Model from Database' and it does not pick up the changes to individual tables anymore.</p>\n\n<p>Am I missing something ... or is this a new 'feature' of VS2012?</p>\n\n<p><strong>Update</strong>\nThe only way I can get a table with an added column to reflect in the .EDMX file is to delete the table then 'Update Model from Database' and it will pick up the added column. However, it puts the added table far off to the left and I have to move it back in place. No <strong>biggie</strong> just an annoyance.</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-sql"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":392,"score":4,"question_id":8713879,"title":"LINQ many-to-many intersection","body":"<p>I'm trying to query <code>Posts</code> based on a list of <code>Tags</code>:</p>\n\n<pre><code>public class Post\n{\n  public int? Id {get;set;}\n  public string Name {get;set;}\n  public virtual ICollection&lt;Tag&gt; Tags {get;set;}\n}\npublic class Tag\n{\n  public int? Id {get;set;}\n  public string Name {get;set;}\n  public vritual ICollection&lt;Post&gt; Posts {get;set;}\n}\n</code></pre>\n\n<p>Now I want to return posts based a list of tags:\n<code>IList&lt;Tag&gt; searchTags = ParseTagsFromSearchString(\"tag1,tag2,tag3\"); // this function checks the tags in the database, so all the primary keys are available in the list</code></p>\n\n<p>When a post contains one or more tags that also exists in <code>searchTags</code> it should be included in the result. I have tried the following:</p>\n\n<pre><code>var q = from s in Context.Registrations\n                    where s.Tags.Intersect(tagList)\n                    select s;\n</code></pre>\n\n<p>Error: <code>Cannot implicitly convert type 'System.Collections.Generic.IEnumerable&lt;Models.Tag&gt;' to 'bool'</code></p>\n\n<pre><code>var q = from s in Context.Registrations\n                    where s.Tags.Any(t =&gt; tagList.Any(t2 =&gt; t.Id.Value == t2.Id.Value))\n                    select s;\n</code></pre>\n\n<p>Runtime error: <code>NotSupportedException: Unable to create a constant value of type 'Models.Tag'. Only primitive types ('such as Int32, String, and Guid') are supported in this context.</code>\nAny ideas?</p>\n\n<p>-- update Jan. 4:\nThe answers point to the right solution, but in my code I still have the NotSupportedException. Is it possible the nullable integer causes this since it is not a primitive type?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","mvc","poco","data-access-layer"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13059901,"title":"Passing POCOs or EF objects to the Web project?","body":"<p>Say I have a Visual studio solution with two projects: one web project, and one data project.</p>\n\n<p>Does it really matter whether I pass the EF object from the data project to the web project, or do I need to explicitly define POCOs in the data project to pass to the web project?</p>\n\n<p>It seems to me that needing to create POCOs instead of simply using EF objects adds yet another thing that needs to be done...and I don't particularly see the purpose.</p>\n"},{"tags":["entity-framework","attributes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13063229,"title":"Dynamic Attribute Binding + Unable to determine the principal end of an association between the types","body":"<p>I'm struggeling figuring the proper way of Solving \"Unable to determine the principal end of an association between the types\". The principal end of this association must be explicitly configured using either the relationship fluent API or data\"  Entity Framework</p>\n\n<p>I have an entity like.  </p>\n\n<pre><code>public partial class Document\n{\n     DocumentId {get; set;}\n     DocumentName{get; set;}\n}\n\npublic class SpecialDocument\n{\n     DocumentId {get; set;}  --&gt; this is actually a foreign key from Document  \n                                 at the same time it is also the primary key \n     SpecialDocumentName {get; set;}\n}\n</code></pre>\n\n<p>I found a solution like adding a ForeignKey attribute on the property.  </p>\n\n<pre><code>public partial class SpecialDocument\n{\n      [ForeignKey(\"Document\")]\n      DocumentId {get; set;)\n      SpecialDocumentName {get; set;}\n}\n</code></pre>\n\n<p>however the problem is the class is autogenerated, whenever i update the edmx file the SpecialDocument is overwritten so now i need to re-add the ForeginKey attribute. </p>\n\n<p>Is there something I can do to the separate partial class for the SpecialDocument or Dnyaminc Attribute Attachment to the Property? Thanks!</p>\n"},{"tags":["entity-framework","asp.net-web-api","json.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13064073,"title":"Handling entity framework relations in json.net","body":"<p>I have an ASP MVC Web Api project that outputs json using json.net. I have for example the following models:</p>\n\n<pre><code>public class ModelA\n{\n    public int Id {get;set;}\n    public string Name {get;set;}\n\n    [JsonIgnore]\n    public int TypeModelId {get;set;}\n    public virtual TypeModel TypeModel {get;set;}\n}\n\npublic class TypeModel\n{\n    [JsonIgnore]\n    public int Id {get;set;}\n\n    public string Name {get;set;}\n\n    [JsonIgnore]\n    public virtual IList&lt;ModelA&gt; ModelAs {get;set;}\n}\n</code></pre>\n\n<p>When I serialize a <code>ModelA</code> the output will be something like this:</p>\n\n<pre><code>[\n  {\n    \"Id\": 1,\n    \"Name\": \"test\",\n    \"TypeModel\": {\n      \"Name\": \"testtype1\"\n    }\n  }\n]\n</code></pre>\n\n<p>Is it possible using json.net to have an output like this..</p>\n\n<pre><code>[\n  {\n    \"Id\": 1,\n    \"Name\": \"test\",\n    \"TypeModel\": \"testtype1\"\n  }\n]\n</code></pre>\n\n<p>..or do I have to copy the contents of <code>ModelA</code> to a new class which stores the <code>TypeModel</code> relation as string instead of reference? Maybe there are better solutions?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13060518,"title":"Add entity in Entity Framework Insert Null Record","body":"<p>I'm trying to insert a new Entity in EF:</p>\n\n<pre><code>public class Ad\n{\n    // Primary properties\n    public int Kms { get; set; }\n\n    // Navigation properties\n    public virtual Model Model { get; set; }\n}\n</code></pre>\n\n<p>And I receive from the View the model like this (example values):</p>\n\n<p>kms = 222\nModel.Id = 3</p>\n\n<p>Then when I do the Add and SaveChanges of the Entity Framework, I get a NULL record inserted in the Model Table (that generated a new ID) and a record in the Ad Table with the new inserted Model Id.</p>\n\n<p>Why is this happening?</p>\n\n<p>Service Layer:</p>\n\n<pre><code>    public void CreateAd(CreateAdDto adDto)\n    {\n        var adDomain = Mapper.Map&lt;CreateAdDto, Ad&gt;(adDto);\n\n        _adRepository.Add(adDomain);\n        _adRepository.Save();\n    }\n</code></pre>\n\n<p>Repository:</p>\n\n<pre><code>    public void Add(T entity)\n    {\n        _dbSet.Add(entity);\n    }\n\n   public void Save()\n    {\n        try\n        {\n            _dataContext.SaveChanges();\n        }\n        catch (DbEntityValidationException e)\n        {\n            var s = e.EntityValidationErrors.ToList();\n            throw;\n        }\n    }\n</code></pre>\n\n<p>ViewModel:</p>\n\n<pre><code>public class CreateAdViewModel\n{\n    // Primary properties\n    public string Version { get; set; }\n    public int Kms { get; set; }\n    public int Year { get; set; }\n    public decimal Price { get; set; }\n\n    public int Make_Id { get; set; }\n    public int Model_Id { get; set; }\n\n    // Navigation properties\n    public IEnumerable&lt;SelectListItem&gt; MakeList { get; set; }\n    public IEnumerable&lt;SelectListItem&gt; ModelList { get; set; }\n}\n</code></pre>\n\n<p>Dto:</p>\n\n<pre><code>public class CreateAdDto\n{\n    // Primary properties\n    public int Kms { get; set; }\n    public int Model_Id { get; set; }\n}\n</code></pre>\n\n<p>The Mapping:</p>\n\n<pre><code>        Mapper.CreateMap&lt;CreateAdDto, Ad&gt;().ForMember(dest =&gt; dest.Model, opt =&gt; opt.MapFrom(src =&gt; new Model { Id = src.Model_Id }));\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first","t4","entity-framework-5","ef-power-tools"],"answer_count":1,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":279,"score":7,"question_id":12937193,"title":"Improve navigation property names when reverse engineering a database","body":"<p>I'm using Entity Framework 5 with Visual Studio with Entity Framework Power Tools Beta 2 to reverse engineer moderately sized databases (~100 tables).</p>\n\n<p>Unfortunately, the <strong>navigation properties do not have meaningful names</strong>. For example, if there are two tables:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE Contacts (\n    ContactID INT IDENTITY (1, 1) NOT NULL,\n    ...\n    CONSTRAINT PK_Contacts PRIMARY KEY CLUSTERED (ContactID ASC)\n}\n\nCREATE TABLE Projects (\n    ProjectID INT IDENTITY (1, 1) NOT NULL,\n    TechnicalContactID INT NOT NULL,\n    SalesContactID INT NOT NULL,\n    ...\n    CONSTRAINT PK_Projects PRIMARY KEY CLUSTERED (ProjectID ASC),\n    CONSTRAINT FK_Projects_TechnicalContact FOREIGN KEY (TechnicalContactID)\n        REFERENCES Contacts (ContactID),\n    CONSTRAINT FK_Projects_SalesContact FOREIGN KEY (SalesContactID)\n        REFERENCES Contacts (ContactID),\n    ...\n}\n</code></pre>\n\n<p>This will generate classes like this:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class Contact\n{\n     public Contact()\n     {\n          this.Projects = new List&lt;Project&gt;();\n          this.Projects1 = new List&lt;Project&gt;();\n     }\n     public int ContactID { get; set; }\n     // ...\n     public virtual ICollection&lt;Project&gt; Projects { get; set; }\n     public virtual ICollection&lt;Project&gt; Projects1 { get; set; }\n}\n\npublic class Project\n{\n     public Project()\n     {\n\n     }\n     public int ProjectID { get; set; }\n     public int TechnicalContactID { get; set; }\n     public int SalesContactID { get; set; }\n     // ...\n     public virtual Contact Contact { get; set; }\n     public virtual Contact Contact1 { get; set; }\n}\n</code></pre>\n\n<p>I see several variants which would all be better than this:</p>\n\n<ul>\n<li>Use the <strong>name of the foreign key</strong>: For example, everything after the last underscore (<code>FK_Projects_TechnicalContact</code> --> <code>TechnicalContact</code>). Though this probably would be the solution with the most control, this may be more difficult to integrate with the existing templates.</li>\n<li>Use the <strong>property name</strong> corresponding to the foreign key column: Strip off the suffix <code>ID</code> (<code>TechnicalContactID</code> --> <code>TechnicalContact</code>)</li>\n<li>Use the <strong>concatenation of property name and the existing solution</strong>: Example <code>TechnicalContactIDProjects</code> (collection) and <code>TechnicalContactIDContact</code></li>\n</ul>\n\n<p>Luckily, <a href=\"http://romiller.com/2012/05/09/customizing-reverse-engineer-code-first-in-the-ef-power-tools/\">it is possible to modify the templates by including them in the project</a>. </p>\n\n<p>The modifications would have to be made to <code>Entity.tt</code> and <code>Mapping.tt</code>. I find it difficult due to the lack of intellisense and debug possibilities to make those changes.</p>\n\n<hr>\n\n<p><em>Concatenating property names</em> (third in above list) is probably the easiest solution to implement.</p>\n\n<p><strong>How to change the creation of navigational properties in <code>Entity.tt</code> and <code>Mapping.tt</code> to achieve the following result</strong>:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class Contact\n{\n     public Contact()\n     {\n          this.TechnicalContactIDProjects = new List&lt;Project&gt;();\n          this.SalesContactIDProjects = new List&lt;Project&gt;();\n     }\n     public int ContactID { get; set; }\n     // ...\n     public virtual ICollection&lt;Project&gt; TechnicalContactIDProjects { get; set; }\n     public virtual ICollection&lt;Project&gt; SalesContactIDProjects { get; set; }\n}\n\npublic class Project\n{\n     public Project()\n     {\n\n     }\n     public int ProjectID { get; set; }\n     public int TechnicalContactID { get; set; }\n     public int SalesContactID { get; set; }\n     // ...\n     public virtual Contact TechnicalContactIDContact { get; set; }\n     public virtual Contact SalesContactIDContact { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework","migration"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":19,"score":2,"question_id":13059544,"title":"Restoring tables in entity framework","body":"<p>I am working with EF very first time. For some reason I was having difficulty to run my application and every time I was getting exception that your model is not synced up with the current database. I tried everything and since data wasn't important, I thought to re-create all tables by running all the migrations. So, I removed all tables and tried to run the following command. I am using model based approach here to define my entities.</p>\n\n<p><em>Update-database -targetMigration:<strong>InitialCreate</strong> -verbose</em></p>\n\n<p>I was under the impression that it will re-create all tables starting from the very first migration but it actually reverted all to that very first point. Now, whenever i run update-database command, I always get the following </p>\n\n<p><em>No pending explicit migrations.</em></p>\n\n<p>I am very confused what should I do to take my table generated back and set my app in working condition. Can anybody help?</p>\n\n<p>Thanks\n-Fahad</p>\n"},{"tags":["wcf","entity-framework","subsonic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":160,"score":0,"question_id":9362423,"title":"difference between Entity Framework and SubSonic , wcf data service","body":"<p>I am very confused with the use <strong>subsonic</strong> or <strong>ado.net entity framework</strong> or <strong>WCF Data Services</strong> Which one I should choose? \nI creating a middleware (web site) using asp.net mvc.\nI seek a compromise between power, speed of implementation, heavy at runtime, abstraction ...\nSo Which orm i should use?</p>\n"},{"tags":["c#","entity-framework","code-generation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13060614,"title":"Entity Framework DbContext code generation generates incorrect code","body":"<p>I'm using VS2010 with Entity Framework (file version is 4.4. product version is 5) </p>\n\n<p>I have installed the EF5.x <code>DbContext</code> generator.</p>\n\n<p>After creating my <code>.edmx</code> file, I right clicked on the empty space and added a new <code>DbContext</code> template, which generated the <code>context.tt</code> and <code>.tt</code> files. </p>\n\n<p>However, in the <code>.tt</code> files, this is how the auto generated code looks like:</p>\n\n<pre><code>namespace DataObjects.EntityFramework.Models\n{\n    using System;\n    using System.Collections.Generic;\n\n    public partial class SubSystem\n    {\n        public string SubSystemId { get; set; }\n        public string Description { get; set; }\n        public string Fmode { get; set; }\n        public Nullable&lt;System.DateTime&gt; LastBackup { get; set; }\n    }\n}\n</code></pre>\n\n<p>The problem is that the using statements are inside the namespace, which gives rise to a compilation error. </p>\n"},{"tags":["asp.net-mvc","entity-framework","mono","npgsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":110,"score":1,"question_id":13042289,"title":"Mono 4.5 profile, entity framework Npgsql - NpgsqlSystem.InvalidCastException Cannot cast from source type to destination type","body":"<p>I have getting \"System.InvalidCastException\nCannot cast from source type to destination type.\" when trying to access the database from asp.net mvc3 using mono 4.5 profile and postgres at the backend.</p>\n\n<p>Here is what my code looks like:</p>\n\n<pre><code>public class User\n{\n    public int Id { get; set; }\n    public string Username { get; set; }\n    public string PasswordHash { get; set; }\n    public string PasswordSalt { get; set; }    \n} // class\n</code></pre>\n\n<p>AppContext:</p>\n\n<pre><code>using System;\nusing System.Data.Entity;\nusing Npgsql;\nusing NpgsqlTypes;\n\nnamespace Web\n{\npublic class AppContext : DbContext\n{\n    public DbSet&lt;User&gt; Users { get; set; }\n\n    protected override void OnModelCreating (DbModelBuilder modelBuilder)\n    {\n        base.OnModelCreating (modelBuilder);\n    }   \n} // class\n} // namespace\n</code></pre>\n\n<p>Database schema (dbo)</p>\n\n<pre><code>CREATE TABLE dbo.\"Users\"\n(\n\"Id\" integer NOT NULL DEFAULT nextval('dbo.\"Users_Id_seq\"'::regclass),\n\"Username\" character varying(50) NOT NULL,\n\"PasswordHash\" character varying(255) NOT NULL,\n\"PasswordSalt\" character varying(128) NOT NULL,\nCONSTRAINT pk_users_id PRIMARY KEY (\"Id\")\n)\n\npublic class HomeController : Controller\n{\n    public ActionResult Index ()\n    {\n        var db = new AppContext();\n        var users = db.Users.Find(1);\n        ViewData [\"Message\"] = \"Welcome to ASP.NET MVC on Mono!\";\n        return View ();\n    }\n}\n</code></pre>\n\n<p>error i am getting is:</p>\n\n<pre><code>System.InvalidCastException\n\nCannot cast from source type to destination type.\n\nDescription: HTTP 500.Error processing request.\nDetails: Non-web exception. Exception origin (name of application or object): Npgsql.\nException stack trace:\nat Npgsql.NpgsqlFactory.CreateConnection () [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/Npgsql/Npgsql/NpgsqlFactory.cs:64\nat System.Data.Entity.Internal.LazyInternalConnection.CreateConnectionFromProviderName (string) [0x00007] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalConnection.cs:379\nat System.Data.Entity.Internal.LazyInternalConnection.InitializeFromConnectionStringSetting (System.Configuration.ConnectionStringSettings) [0x00045] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalConnection.cs:368\nat System.Data.Entity.Internal.LazyInternalConnection.TryInitializeFromAppConfig (string,System.Data.Entity.Internal.AppConfig) [0x0000e] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalConnection.cs:310\nat System.Data.Entity.Internal.LazyInternalConnection.Initialize () [0x00047] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalConnection.cs:242\nat System.Data.Entity.Internal.LazyInternalConnection.get_ProviderName () [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalConnection.cs:118\nat System.Data.Entity.Internal.LazyInternalContext.get_ProviderName () [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalContext.cs:290\nat System.Data.Entity.Internal.DefaultModelCacheKeyFactory.Create (System.Data.Entity.DbContext) [0x00022] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/DefaultModelCacheKeyFactory.cs:20\nat System.Data.Entity.Internal.LazyInternalContext.InitializeContext () [0x00091] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalContext.cs:388\nat System.Data.Entity.Internal.InternalContext.Initialize () [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/InternalContext.cs:421\nat System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType (System.Type) [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/InternalContext.cs:650\nat System.Data.Entity.Internal.Linq.InternalSet`1&lt;Web.Users&gt;.Initialize () &lt;0x0006f&gt;\nat System.Data.Entity.Internal.Linq.InternalSet`1&lt;Web.Users&gt;.get_InternalContext () &lt;0x00028&gt;\nat System.Data.Entity.Internal.Linq.InternalSet`1&lt;Web.Users&gt;.Find (object[]) &lt;0x0002e&gt;\nat System.Data.Entity.DbSet`1&lt;Web.Users&gt;.Find (object[]) &lt;0x0002f&gt;\nat Web.Controllers.HomeController.Index () [0x0001c] in /Users/nix/Documents/Projects/Dot.NET/Store/Web/Controllers/HomeController.cs:15\nat (wrapper dynamic-method) object.lambda_method (System.Runtime.CompilerServices.Closure,System.Web.Mvc.ControllerBase,object[]) &lt;IL 0x00006, 0x0003f&gt;\nat System.Web.Mvc.ActionMethodDispatcher.Execute (System.Web.Mvc.ControllerBase,object[]) [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/System.Web.Mvc3/Mvc/ActionMethodDispatcher.cs:27\nat System.Web.Mvc.ReflectedActionDescriptor.Execute (System.Web.Mvc.ControllerContext,System.Collections.Generic.IDictionary`2&lt;string, object&gt;) [0x00074] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/System.Web.Mvc3/Mvc/ReflectedActionDescriptor.cs:84\nat System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod (System.Web.Mvc.ControllerContext,System.Web.Mvc.ActionDescriptor,System.Collections.Generic.IDictionary`2&lt;string, object&gt;) [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/System.Web.Mvc3/Mvc/ControllerActionInvoker.cs:173\nat System.Web.Mvc.ControllerActionInvoker/&lt;InvokeActionMethodWithFilters&gt;c__AnonStorey3B.&lt;&gt;m__46 () [0x00014] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/System.Web.Mvc3/Mvc/ControllerActionInvoker.cs:216\nat System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter (System.Web.Mvc.IActionFilter,System.Web.Mvc.ActionExecutingContext,System.Func`1&lt;System.Web.Mvc.ActionExecutedContext&gt;) [0x00033] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/System.Web.Mvc3/Mvc/ControllerActionInvoker.cs:189\n</code></pre>\n\n<p>any suggestions or clue about whats going on?</p>\n"},{"tags":["vb.net","entity-framework","ef-code-first","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":140,"score":0,"question_id":11937169,"title":"Creating DBContext Initializer Getting 'Type argument <context> does not inherit from or implement the constraint type 'System.Data.Entity.DBContext'","body":"<p>I am trying to initialize a database using Database.SetInitializer but I am getting a  'Type argument  does not inherit from or implement the constraint type 'System.Data.Entity.DBContext' Error when my initializer class DOES inherit from DBContext. Any ideas? I'm new to Code First EF by the way!</p>\n\n<p>Context Class:</p>\n\n<pre><code>Imports System.Data.Entity\nImports System.Collections.Generic\nImports System.Data.Entity.Infrastructure\nImports System.Configuration\n\nPublic Class PropertyManagementContext\n    Inherits DbContext\n\n#Region \"Constructor\"\n    Public Sub New()\n        MyBase.New(\"Data Source=WSBS2K3SQL;Initial Catalog=AQUARIUS_TEST;Persist    Security Info=True;User ID=SomeUser;Password=SomePassword;\")\n\n    End Sub\n\n#End Region\n\n#Region \"Tables\"\n    Public Complexes As DbSet(Of Complex)\n    Public Buildings As DbSet(Of Building)\n    Public Units As DbSet(Of Unit)\n    Public Tenants As DbSet(Of Tenant)\n#End Region\n\nProtected Overrides Sub OnModelCreating(modelBuilder As DbModelBuilder)\n    MyBase.OnModelCreating(modelBuilder)\n\n    'Set the Primary Keys\n    modelBuilder.Entity(Of Complex).HasKey(Function(c) c.ComplexId)\n    modelBuilder.Entity(Of Building).HasKey(Function(b) b.BuildingId).HasKey(Function(b) b.ComplexId)\n    modelBuilder.Entity(Of Unit).HasKey(Function(u) u.UnitId).HasKey(Function(u) u.BuildingId)\n    modelBuilder.Entity(Of Tenant).HasKey(Function(t) t.TenantId)\n\n    'Set Complex Primary Key to Identity(MS SQL Auto-Increment)\n    modelBuilder.Entity(Of Complex).Property(Function(c) c.ComplexId) _\n    .HasDatabaseGeneratedOption(ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)\n\nEnd Sub\n\nEnd Class\n</code></pre>\n\n<p>Initializer Class:</p>\n\n<pre><code>Imports System.Collections.Generic\nImports System.Linq\nImports System.Text\nImports System.Data.Entity\n\nPublic Class PropertyManagementInitializer\n    Inherits DropCreateDatabaseAlways(Of PropertyManagementContext)\n\nProtected Overrides Sub Seed(context As PropertyManagementContext)\n    MyBase.Seed(context)\n\n    Dim complex As New Complex With {\n        .Name = \"SomeComplex\",\n        .City = \"SomeCity\",\n        .Address = \"SomeStreet\",\n        .PostalCode = \"R2R2R2\",\n        .Type = \"1\"\n    }\n    context.Complexes.Add(complex)\n\n    context.SaveChanges()\n\nEnd Sub\n\nEnd Class\n</code></pre>\n\n<p>Main Form where Database.SetInitializer() is called and giving the error:</p>\n\n<pre><code>Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load\n    Try    \n        Database.SetInitializer(Of PropertyManagementContext)(New PropertyManagementInitializer)\n\n    Catch ex As Exception\n        MessageBox.Show(ex.Message)\n    End Try\n\nEnd Sub\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13007850,"title":"EF5: prevent automatic column discovery","body":"<p>I use EF's code-first and \"fluent\" APIs. It automatically maps my entities' properties and navigation properties.</p>\n\n<p>I have lots of behavior and other properties in those classes, and so need to call <code>Ignore()</code> in such cases.</p>\n\n<p>Can I change it so it only maps what I <em>explicitly</em> specify using the fluent API? I want to work on a whitelist approach, rather than its current blacklist approach.</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13058928,"title":"Code First Parent/Child relationships when both parent and child use TPH inheritance","body":"<p>I am trying to map a parent/child collection scenario where both parent and child use TPH inheritance.  I have tried many scenarios--none of which has worked.  The key for me is that each parent can only have one type of child in the collection.  Below is a contrived example of what I'm trying to achieve:</p>\n\n<pre><code>public abstract class Order\n{\n    public int ID { get; set; }\n    public decimal Total { get; set; }\n}\n\npublic class SalesOrder : Order\n{\n    public bool Rush { get; set; }\n    public virtual ICollection&lt;SalesOrderLine&gt; OrderLines { get; set; }\n}\n\npublic class PurchaseOrder : Order\n{\n    public string Contact{ get; set; }\n    public virtual ICollection&lt;PurchaseOrderLine&gt; OrderLines { get; set; }\n}\n\npublic abstract class OrderLine\n{\n    public int ID { get; set; }\n    public int OrderID { get; set; }\n    public string Sku { get; set; }\n    public int Quantity { get; set; }\n    public decimal Amount { get; set; }\n}\n\npublic class SalesOrderLine : OrderLine\n{\n    public decimal Discount { get; set; }\n    public virtual SalesOrder Order { get; set; }\n}\n\npublic class PurchaseOrderLine : OrderLine\n{\npublic int VendorID { get; set; }\n    public virtual PurchaseOrder Order { get; set; }\n}\n</code></pre>\n\n<p>The SalesOrder and PurchaseOrder class use are mapped to an Order table using TPH.  And the SalesOrderLine and PurchaseOrderLine are mapped to an OrderLine table using TPH.</p>\n\n<p>Does EF support this and, if so, how can I acheive it?</p>\n"},{"tags":["c#","wcf","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":13036009,"title":"Update many entities in one WCF call versus hitting the WCF service for each entity to update","body":"<p>I work on a multi-tier application and I need to optimize a long-running process in three ways :</p>\n\n<ol>\n<li>Avoiding EF update concurrency problems.</li>\n<li>Improving speed.</li>\n<li>Informing the user of the progress.</li>\n</ol>\n\n<p>Actually, the client code calls a WCF service using a method <strong>that does all the work</strong> (<em>evaluating the number of entities to update</em>, <em>querying the entities to update</em>, <em>updating them</em> and finally, <em>saving them back to the database</em>).</p>\n\n<p>The process is very long and <strong>nothing is sent back to the user except the final result</strong> once the process is done. The user can stay in front of the wait form for up to 10 minutes, not knowing what is happening.</p>\n\n<p>The number, and depth of the queried entities can become really big and I sometimes hit OutOfMemoryExceptions. I had to change the service method to process entity updates 100 entities at a time, so my DbContext will be refreshed often and won't become too big.</p>\n\n<p>My actual problem is that I cannot inform the user each time an entity is updated because <strong>my service method does the whole process before returning it's result to the user.</strong></p>\n\n<p>I read about implementing a duplex service but since I have to return <strong>two different callbacks</strong> to the user (one callback to <em>return the number of entities to update</em> and another callback <em>for the result of each entity update</em>) I have to use multiple interface inheritance on a generic callback interface and it's becoming a little messy (well, to my taste).</p>\n\n<p>Wouldn't it be better to have one WCF service method to return the number of entities to evaluate, and another WCF method that will return a simple entity update result, which will be hit for every entity to update ? My DBContext will be living only for the time of a single entity update, so it would not grow very much, which I think is good. <strong>However, I am concerned about hitting the WCF service really often during that process</strong>.</p>\n\n<p>What are you thoughts ? What can you suggest ?</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13056735,"title":"Count and Group By an Entity (Not an Entity's Property)","body":"<p>I have the following entity model. I omitted a lot of properties on each entity for brevity's sake.</p>\n\n<pre><code>public sealed class Platform {\n    /// &lt;summary&gt;\n    /// Get and Set Platform's Unique Identifier.\n    /// &lt;/summary&gt;\n    public int Id { get; set; }\n\n    /// &lt;summary&gt;\n    /// Determine if an Object is Equal to This Platform.\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"obj\"&gt;\n    /// An object to compare.\n    /// &lt;/param&gt;\n    /// &lt;returns&gt;\n    /// A boolean true if the object is equal to this platform. A boolean false otherwise.\n    /// &lt;/returns&gt;\n    public override bool Equals(object obj) {\n        bool isObjectPlatform = obj is Platform;\n        bool isObjectIdEqual = isObjectPlatform &amp;&amp; (obj as Platform).Id == this.Id;\n\n        return isObjectIdEqual;\n    }\n\n    /// &lt;summary&gt;\n    /// Get Platform's Hash Code.\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;\n    /// The platform's hash code, equalling the platform's unique identifier.\n    /// &lt;/returns&gt;\n    public override int GetHashCode() {\n        return this.Id;\n    }\n}\n\npublic sealed class Capture {\n    /// &lt;summary&gt;\n    /// Get and Set Capture's Unique Identifier.\n    /// &lt;/summary&gt;\n    public int Id { get; set; }\n\n    /// &lt;summary&gt;\n    /// Get and Set Capture's Platform.\n    /// &lt;/summary&gt;\n    public Platform Platform { get; set; }\n\n    /// &lt;summary&gt;\n    /// Determine if an Object is Equal to This Capture.\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"obj\"&gt;\n    /// An object to compare.\n    /// &lt;/param&gt;\n    /// &lt;returns&gt;\n    /// A boolean true if the object is equal to this capture. A boolean false otherwise.\n    /// &lt;/returns&gt;\n    public override bool Equals(object obj) {\n        bool isObjectCapture = obj is Capture;\n        bool isObjectIdEqual = isObjectCapture &amp;&amp; (obj as Capture).Id == this.Id;\n\n        return isObjectIdEqual;\n    }\n\n    /// &lt;summary&gt;\n    /// Get Capture's Hash Code.\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;\n    /// The capture's hash code, equalling the capture's unique identifier.\n    /// &lt;/returns&gt;\n    public override int GetHashCode() {\n        return this.Id;\n    }\n}\n</code></pre>\n\n<p>What I basically want is a LINQ query, backed up by an EF of course, that will get me the count of <strong>Captures</strong> grouped by an entire <strong>Platform</strong> entity. I want to be able to return a reference to each <strong>Platform</strong>, instead of one of its properties, and the count of each <strong>Capture</strong> associated with it.</p>\n\n<p>I did this query and it works great:</p>\n\n<pre><code>var query = this._defaultContext.Captures\n                .Include(m =&gt; m.Platform)\n                .GroupBy(m =&gt; m.Platform.Id)\n                .Select(m =&gt; new {\n                    PlatformId = m.Key,\n                    Count = m.Count()\n                });\n</code></pre>\n\n<p>But as you can see, I am grouping by the <strong>Platform's</strong> <em>Id</em> property. What I would rather have is this:</p>\n\n<pre><code>var query = this._defaultContext.Captures\n                .Include(m =&gt; m.Platform)\n                .GroupBy(m =&gt; m.Platform)\n                .Select(m =&gt; new {\n                    Platform = m.Key,\n                    Count = m.Count()\n                });\n</code></pre>\n\n<p>This does not work. It just gets a count of 1 for each record in the database. It looks it does not know to group by an entire entity. I was hoping it could by differentiating between each <strong>Platform</strong> by way of the <strong>GetHashCode</strong> and <strong>Equals</strong> method implementations but no luck.</p>\n\n<p>Anyone ever run into a scenario like this? Any way around it? Or do I have to manually do it. I would hate that since it would probably result in some kind of N + 1 query.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":60,"score":0,"question_id":13057389,"title":"passing different objects of same base class to method","body":"<p>Basically, I would like to create a Method, that takes a base-class as a parameter, and can be used \"generic\" for derived classes</p>\n\n<p>ef-code-first classes:</p>\n\n<p>the base class</p>\n\n<pre><code>public abstract class BaseClass\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n}\n</code></pre>\n\n<p>derived classes:</p>\n\n<pre><code>public class DerivedA:BaseClass\n{\n    public string AValue {get;set;}\n    ...more specific fields\n}\n\n\npublic class DerivedB:BaseClass\n{\n    public string BValue {get;set;}\n    ..... more specific fields\n}\n</code></pre>\n\n<p>I call a \"generic Method\" with these slightly different objects:</p>\n\n<pre><code>System.Data.Entity.DbSet&lt;DerivedA&gt; _dA....\nSystem.Data.Entity.DbSet&lt;DerivedB&gt; _dB....\n\ngenericMethod(_dA.Where(a =&gt; a.Name.StartsWith(\"a name\")))); //&lt;-contains records\ngenericMethod(_dB.Where(a =&gt; a.Id==5)); //&lt;---- contains records\n</code></pre>\n\n<p>Both \"Where...\" contain records in debug (after clicking on Enumerate)</p>\n\n<p>now the method:</p>\n\n<pre><code>public string genericMethod(&lt;IQueryable&gt;BaseClass _myClass)\n{\n    foreach (BaseClass c in _myClass)  // &lt;-------class is empty - no records\n        {\n          // do something usefull...\n        }\n    return someResult \n}\n</code></pre>\n\n<p>But no records are contained, when inside the method.</p>\n\n<p>Is it possible, what I am trying to do...?\nDoes it make sense?</p>\n\n<p>There are no design-time or compile-time or runtime errors, but the passed object contains no records when passed to the method, but it contained records in the calling statement.</p>\n\n<p>What did I do wrong?</p>\n\n<p>Is there a better approach? - </p>\n\n<p>I need this Method, for manipulation of more than two (maybe ten) derived classes, and therefor I want it \"generic\".</p>\n\n<p>Thank you!</p>\n"},{"tags":["entity-framework","visual-studio-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":531,"score":0,"question_id":12375090,"title":"Entity Framework 5 and Visual Studio 2012 POCO Classes in Different Project","body":"<p>In VS 2010 and EF 4.4, you were able to move and edit .tt files when using the DBContext generator in Entity Framework such that your POCO objects where in a different project than your DBContext files. </p>\n\n<p>See <a href=\"http://stackoverflow.com/questions/5565633/separating-entity-framework-poco-and-objectcontext\">Here</a> and <a href=\"http://stackoverflow.com/questions/2464909/generate-poco-classes-in-different-project-to-the-project-with-entity-framework\">Here</a> for examples of what I am talking about.</p>\n\n<p>In VS2012 / EF5 this seems not to be possible. the POCO classes are generated as a subitem under the EDMX file. The files cannot be copied from within Visual Studio. Moving the files from Explorer does not help because the files you moved get recreated at compilation time.</p>\n\n<p>Am I missing something basic here?</p>\n\n<p>I am not using any code generation items with EF5 (whereas I was with EF4.x.) Could that be the difference?</p>\n"},{"tags":["c#","database","entity-framework","design","fluent-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13010263,"title":"Map entities to many-to-many junction table in EF 4.5","body":"<p>At the moment I’m mapping my existing DB tables to new EF 4.5 model via Fluent Api. I’ve got a questing on how to map following db structure to classes. </p>\n\n<pre><code>Students(pk Id...)\nCourses (pk Id...)\nStudents_Courses (pk Id, fk StudentId, fk CourseId)\nComments (pk Id, fk Students_Courses Id, comment, dateposted...)\n</code></pre>\n\n<p>The idea is that I may have many reviews per student_course pair. What is the best way to represent my classes in this scenario? \nThe problem here is that I’ll probably need to map Comment entity to Students_Courses table and somehow determine to which Student and Course (in terms of classes) this comment belongs.\nAny suggestions on the design?\nThanks!</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13055121,"title":"How can I include a collection's foreign key property in the controller query?","body":"<p>This may be a case of \"going too deep\", but I thought I would ask anyway.  I've got the following models:</p>\n\n<pre><code>public class Exam\n{\n    public int ID {get; set;}\n    //...other Exam properties\n    public virtual ICollection&lt;ExamResults&gt; Results {get; set;}\n}\n\npublic class ExamResults\n{\n    public int ExamId {get; set;}\n    //...other Exam Result properties\n    public int ExamDomainId {get; set;}\n    public virtual ExamDomain ExamDomain {get; set;}\n}\n\npublic class ExamDomain\n{\n    public int ID {get; set;}\n    public String DomainName {get; set;}\n    //...more stuff\n}\n</code></pre>\n\n<p>So in plain English, an Exam has a collection of ExamResults.  Each ExamResult has an ExamDomain, and each ExamDomain has a name.  </p>\n\n<p>The problem is this: My view creates a new database query every time I use</p>\n\n<pre><code>@Html.DisplayFor(e =&gt; e.exampleResult.ExamDomain.DomainName)\n</code></pre>\n\n<p>I cannot include ExamDomain in the initial controller query, as Exam does not have a navigation property with Exam.  Example:</p>\n\n<pre><code>//The below does not work because ExamResults is a collection, not a record\nvar exam = db.Exams.Include(e =&gt; e.ExamResults.ExamDomain)...\n\n//The code below also does not work, but it does run\nvar exam = db.Exams.Include(e =\n</code></pre>\n\n<p>With that said, how can I grab all the necessary DomainNames from the ExamDomain table without running an additional query for every ExamResult?</p>\n\n<p>PS: I do have a view model, but it shouldn't matter for the purpose of this question.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","design-patterns"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":50,"score":3,"question_id":13053544,"title":"Structure for switchable Data Access Layer","body":"<p>I need to write a Data Access Layer using Entity Framework. One of the requirements is to allow a configuration file to control where the data comes from. With one config setting it should come from a database; with another, from a web service.</p>\n\n<p>Now, my initial thought is to have 3 DataAccess classes:</p>\n\n<ul>\n<li>WidgetDataAccess</li>\n<li>WidgetDatabaseDataAccess</li>\n<li>WidgetWebServiceDataAccess</li>\n</ul>\n\n<p>They would all implement the same interface. WidgetDataAccess would read the config and delegate to the correct child class. That seems sensible, right?</p>\n\n<p>Is there any pattern that I should follow, or anyone with a better way to structure this?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13053883,"title":"MVC Entity Framework Partial Class access DB for property value","body":"<p>I am using Entity Framework mapped to my database. I have a Basket model which can have many BasketItem models, and I have Promotions and Coupons models.\nThis is for eCommerce checkout functionality and I just don't understand how this will work, here goes:</p>\n\n<p>Because my BasketItems have a foreign key relationship to the Basket if I want to sum up the Subtotal for my basket items in a partial class, I can do this:</p>\n\n<pre><code>        public decimal Subtotal {\n        get {\n            return this.BasketItems.Sum(pb =&gt; pb.Subtotal);\n            }\n        }\n</code></pre>\n\n<p>This is helpful because I can use this inside a view, there's no mucking around with passing a DB context through and it's DRY, etc. etc.</p>\n\n<p>Now I want to apply promotions or coupons to my Subtotal ideally I want it to look like this:</p>\n\n<pre><code>        public decimal DiscountedSubtotal {\n        get { \n            decimal promotions_discount = 0;\n            decimal coupons_discount = 0;\n            return Subtotal - promotions_discount - coupons_discount;\n            }\n        }\n</code></pre>\n\n<p>But there is no access to Promotions or Coupons without either creating some crazy and unnecessary relationships in my database or some light hacking to get this functionality to work. I don't know what I should do to overcome this problem.</p>\n\n<p><strong>Solution 1:</strong></p>\n\n<pre><code>        public decimal DiscountedSubtotal(DatabaseEntities db) {\n        decimal promotions_discount = from p in db.Promotions\n                                  select p.Amount;\n        decimal coupons_discount = from c in db.Coupons\n                               select c.Amount;\n        return Subtotal - promotions_discount - coupons_discount;\n        }\n</code></pre>\n\n<p>I don't want to use this in my View pages, plus I have to send through my context every time I want to use it.</p>\n\n<p><strong>Solution 2: (untested)</strong></p>\n\n<pre><code>    public List&lt;Promotion&gt; Promotions { get; set; }\n    public List&lt;Coupon&gt; Coupons { get; set; }\n\n    public Basket()\n        : base() {\n            DatabaseEntities db = new DatabaseEntities();\n            Promotions = db.Promotions.ToList();\n            Coupons = db.Coupons.ToList();\n    }\n</code></pre>\n\n<p>A bit of light hacking could provide me with references to promotions and coupons but i've had problems with creating new contexts before and I don't know if there is a better way to get me to the DiscountedSubtotal property I would ideally like.</p>\n\n<p>So to sum up my question, I would like to know the best way to get a DiscountedSubtotal property.</p>\n\n<p>Many thanks and apologies for such a long read :)</p>\n"},{"tags":["entity-framework","postgresql","devart","dotconnect"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12865017,"title":"Can't generate EF model correctly with Devart dotConnect for PostgreSQL product","body":"<p>I have problem when creating Entity Framework model from an existing PostgreSQL database with the Devart dotConnect for PostgreSQL product.\nThis product offer 2 ways of generating EF model from a database and neither seems to work.\n When using an ADO.Net Entity data Model with this Devart provider, the tables list appear empty in the wizard when generating model from database. \nWhen using the Devart Entity Model, the table list appear correctly in the wizard and model is generated but all navigations properties are missing and all not nullable fields are generated as entity keys.\nAnyone has experience with this product and can confirm me if I'm facing bugs or if I'm not using it correctly?\nThanks </p>\n\n<p>Etienne</p>\n"},{"tags":["c#","linq","entity-framework","linq-expressions"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13048608,"title":"Using a params array of linq Expressions","body":"<p>In EF, when you want to include a navigation property in the result of a query, you use <code>Include()</code>. Since some queries require calling this more than once, I tried to create a generic wrapper around this concept:</p>\n\n<pre><code>public IQueryable&lt;T&gt; FindAll&lt;P&gt;(params Expression&lt;Func&lt;T, P&gt;&gt;[] predicates) where P : class {\n  var entities = AllEntities();\n  foreach (var p in predicates) entities = entities.Include(p);\n  return entities;\n}\n</code></pre>\n\n<p>And call it as such:</p>\n\n<pre><code>var customers = FindAll(q =&gt; q.Orders, q =&gt; q.Invoices, q =&gt; q.Contacts);\n</code></pre>\n\n<p>Questions:  </p>\n\n<ol>\n<li>The function compiles, but when I call it: \"The type arguments for method cannot be inferred from the usage. Try specifying the type arguments explicitly.\" What am I doing wrong?  </li>\n<li>If I get it to work, can I call <code>Include()</code> the first time: <code>var customers = FindAll(q =&gt; q.Orders, q =&gt; q.Invoices);</code> and then again later in a separate step: <code>customers = customers.Include(p =&gt; p.Invoices);</code> or will that result in poor performance such that I should do the includes in one go?</li>\n</ol>\n\n<p><strong>EDIT:</strong><br>\nJonSkeet's answer is correct, of course, and yet <a href=\"http://stackoverflow.com/a/5376637/1711500\">there is this solution</a> which seems to do what I want. Not sure why it works however. Is it because of the <code>Aggregate()</code> function?</p>\n"},{"tags":["c#","entity-framework","entity-framework-4","servicestack"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13045247,"title":"How do I make the ServiceStack MiniProfiler work with EF?","body":"<p>ServiceStack includes the awesome <a href=\"http://miniprofiler.com/\" rel=\"nofollow\">MiniProfiler</a> built in. However, it is a different version, compiled into ServiceStack, in it's own namespace.</p>\n\n<p>I have got the profiler working with normal ADO.NET connections, but I am struggling to make it work with my Entity Framework 4.2 data contexts. </p>\n\n<p>Normally, one would use the MiniProfiler.EF NuGet package, but since it is built against the official MiniProfiler version it does not work.</p>\n\n<p>What is the easiest way of either:</p>\n\n<ul>\n<li>Swapping out the MiniProfiler in ServiceStack for the official version (I researched this and it does not seem easy, since SS generates the JavaScript for the profiler deep in some handlers) ?</li>\n<li>Or, making the built in profiler work with ServiceStack AND Entity Framework ? </li>\n</ul>\n"},{"tags":["silverlight","entity-framework","data-binding","ef-code-first","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13050820,"title":"Bind data from WCF Ria Services to data grid Entity Framework Code First","body":"<p>I've created simple POCO class like this : </p>\n\n<pre><code> public   class Entity\n{\n public int   Id { get; set; }\n public bool IsActive { get; set; }\n}\n</code></pre>\n\n<p>And this is my EF DbContext : </p>\n\n<pre><code>   public class SampleContext:DbContext \n    {\n             public DbSet&lt;Entity&gt; Entities { get; set; }\n\n    }\n</code></pre>\n\n<p>I defined sample logic layer like this : </p>\n\n<pre><code>       public class EntityTask : IEntityTask \n    {\n       #region Implementation of IEntityTask\n\n       public IEnumerable&lt;Entity&gt; GetAll()\n       {\n           var contex = new SampleContext();\n\n           return contex.Entities.ToList();\n       }\n\n       #endregion\n    }\n\n     public   interface IEntityTask\n {\n     IEnumerable&lt;Entity&gt; GetAll();\n\n }\n</code></pre>\n\n<p>This is DomainService class that defined in server project : </p>\n\n<pre><code>    [EnableClientAccess()]\npublic class CrudService : DomainService\n{\n    private readonly IEntityTask _entityTask;\n\n    public CrudService(IEntityTask entityTask)\n    {\n        _entityTask = entityTask;\n    }\n\n    public IQueryable&lt;Entity&gt;  GetAll ()\n    {\n       return _entityTask.GetAll().AsQueryable();\n    }\n}\n</code></pre>\n\n<p>After these steps I don't know how to bind data to DataGrid in silverlight project. \nI've checked many links on the web but many of them use wizard to bind data to datagrid. \nHow do I bind entities to DataGrid ? </p>\n"},{"tags":["c#","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13053507,"title":"Track Entity Framework Progress","body":"<p>I am using entity framework to insert a large amount of data.\nI would like to get a Progress for the inserts (display it to the user).</p>\n\n<p>Is there anything within EF to achive this?</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":159,"score":2,"question_id":12914247,"title":"MigrateDatabaseToLatestVersion and dbo.__MigrationHistory","body":"<p>I am trying to deploy an MVC4 application that is built using EF5 codefist and migrations.</p>\n\n<p>I want the app to update the database when I in the future deploy new versions of the app with new migrations, so in Global.asax I do this:</p>\n\n<pre><code>Database.SetInitializer(new MigrateDatabaseToLatestVersion&lt;GoDealMvc4Context, Configuration&gt;());\nusing (var ctx = new GoDealMvc4Context()) {\n    ctx.Database.Initialize(false);\n}\n</code></pre>\n\n<p>The initial database on the server is deployed by attaching an MDF file copied from my dev machine. This database contains the __MigrationsHistory system table. So this database should not need to execute any migrations, because it is up to date with latest migration.</p>\n\n<p>When I try to start the app on the server, it I get this error:</p>\n\n<pre><code>There is already an object named 'UserProfile' in the database.\n\n[SqlException (0x80131904): There is already an object named 'UserProfile' in the database.]\nSystem.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction) +388\nSystem.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose) +688\nSystem.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean&amp; dataReady) +4403\nSystem.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout) +2755286\nSystem.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite) +527\nSystem.Data.SqlClient.SqlCommand.ExecuteNonQuery() +290\nSystem.Data.Entity.Migrations.DbMigrator.ExecuteSql(DbTransaction transaction, MigrationStatement migrationStatement) +247\nSystem.Data.Entity.Migrations.DbMigrator.ExecuteStatements(IEnumerable`1 migrationStatements) +202\nSystem.Data.Entity.Migrations.DbMigrator.ApplyMigration(DbMigration migration, DbMigration lastMigration) +472\nSystem.Data.Entity.Migrations.DbMigrator.Upgrade(IEnumerable`1 pendingMigrations, String targetMigrationId, String lastMigrationId) +175\nSystem.Data.Entity.MigrateDatabaseToLatestVersion`2.InitializeDatabase(TContext context) +150\nSystem.Data.Entity.Internal.InternalContext.PerformInitializationAction(Action action) +66\nSystem.Data.Entity.Internal.InternalContext.PerformDatabaseInitialization() +225\nSystem.Data.Entity.Internal.RetryAction`1.PerformAction(TInput input) +208\nSystem.Data.Entity.Internal.LazyInternalContext.InitializeDatabaseAction(Action`1 action) +235\nGoDeal.Mvc4.MvcApplication.Application_Start() +342\n</code></pre>\n\n<p>So apparently the app thinks it needs to apply a migration even though the __MigrationHistory table is present in the database with this content:</p>\n\n<pre><code>MigrationId                 Model         ProductVersion\n201210161046508_initial     0x1F8...      5.0.0.net45\n</code></pre>\n\n<p>and the app contains a single migration class:</p>\n\n<pre><code>201210161046508_initial.cs:\n\npublic partial class initial : DbMigration\n{\n    public override void Up()\n    {\n        CreateTable(\n            \"dbo.UserProfile\",\n            ....\n</code></pre>\n\n<p>So my questions are:\n1) why do my application think it needs to apply this migration when the contents of the __MigrationsHistory table is as described.</p>\n\n<p>2) is this the recommended way of making an application that automatically applies new migrations wehn restarted on a new version.</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":13033059,"title":"Entity Framework: Using ExecuteSqlCommand to clear a table causes an exception because of the ObjectStateManager","body":"<p>I an using EF5 Code First and needed a way to clear a table quickly. I therefore produced a very simple method to use ExecuteSqlCommand to provide a fast table clear. The code is below:</p>\n\n<pre><code>    public void FastClearTable(Type tableType)\n    {\n        Context.Database.ExecuteSqlCommand(\n            string.Format(\"delete from {0}\", PluraliseTableName(tableType.Name)));\n    }\n</code></pre>\n\n<p>I use this to clear a table before recalculating it. Below I have listed a simplified version of my method below. Note that the key of the table is a string (i.e. not an identity key) so I am putting in new entries with the same keys as the entries deleted by the ExecuteSqlCommand.</p>\n\n<pre><code>public int ComputeNewTableContent( IRepository&lt;MyClass&gt; rep, IUnitOfWork uow)\n{\n     if ( rep.GetUntracked().Count() &gt; 0)\n           uow.FastClearTable( typeof(MyClass));\n\n     --- compute new entries and call rep.Insert( newEntry) for each one ---\n     uow.Commit();    //This calls DbContext.SaveChanges()\n}\n</code></pre>\n\n<p>This works fine the first time but if I run it again I get an exception on the SaveChanges() command, which is called by uow.Commit(). The exception is:</p>\n\n<p>Message=\"Exception has been thrown by the target of an invocation.\"</p>\n\n<p>InnerException Message=\"The changes to the database were committed successfully, but an error occurred while updating the object context. The ObjectContext might be in an inconsistent state. Inner exception message: <strong>AcceptChanges cannot continue because the object's key values conflict with another object in the ObjectStateManager. Make sure that the key values are unique before calling AcceptChanges</strong>.\"</p>\n\n<p>If found this archived MSDN <a href=\"http://social.msdn.microsoft.com/Forums/en/adonetefx/thread/8374c10b-5e45-4c17-a9e2-5ced6ad06c7d\" rel=\"nofollow\">post</a> and at the bottom the person had the same problem, but there wasn't an answer. My view is that the memory version of the data is still present and does not know about the ExecuteSqlCommand. However I don't don't know enough about EF yet to know how to fix it.</p>\n\n<p>I can of course get round it by using a 'normal' delete but I would appreciate someone explaining what is going on and how I could handle it. That would improve my knowledge of Entity Framework.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server-2008","entity-framework","datetime","compare","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":108,"score":4,"question_id":13034266,"title":"Entity Framework and DateTime comparison with millisecond precision","body":"<p>I've got a problem with Entity Framework (Code First) under C# regarding comparison of DateTime values. I use the below defined class Validity (simplified for this example) as a superclass of of other Entities that shall have a defined validity in time.</p>\n\n<pre><code>public abstract partial class Validity {\n    [Key]\n    public int ID { get; set; }\n\n    public DateTime? ValidFrom { get; set; }\n    public DateTime? ValidTo { get; set; }\n\n    /**\n     * @brief This method builds an IQueryable from another IQueryable,\n     * with added restriction on ValidityFrom/To\n     *\n     * An object's validitiy is defined to\n     *   1. start at timestamp ValidFrom (=inclusive) and\n     *   2. to end before ValidTo (=exclusive).\n     *   3. If ValidFrom or ValidTo is NULL, it means to be \"unbounded\"\n     *      in start or end time (respectively)\n     * \n     **/\n    public static IQueryable&lt;T&gt; isValidAt&lt;T&gt;(IQueryable&lt;T&gt; query, DateTime time) where T : Validity\n    {\n        return query.Where&lt;T&gt;(c =&gt; \n               (!c.ValidFrom.HasValue || time &gt;= c.ValidFrom)  // If ValidFrom != NULL, the given timestamp must be equal or \"after\" ValidFrom\n            &amp;&amp; (!c.ValidTo.HasValue || time &lt; c.ValidTo));     // If ValidTo != NULL, the given timestamp must be \"before\" ValidTo\n    }\n\n    /**\n     * @brief Shall invalidate the object at timestamp time (implicitly sets validTo attribute).\n     **/\n    public void inValidate(DateTime time)\n    {\n        ValidTo = time;\n    }\n}\n\npublic class Item : Validity {\n    public string property { get; set; }\n}\n</code></pre>\n\n<p>At the last three lines, you'll find the class \"Item\" which we'll take as an example. Let's have a look at this query:</p>\n\n<pre><code>DateTime requestTime = DateTime.Now;\nvar items = from n in Validity.isValidAt(db.Items, requestTime)\n            select n;\n</code></pre>\n\n<p>This query should return only return Objects of class Item which are \"valid\" at \"requestTime\". Note that for ValidTo == requestTime the Item is to be regarded as \"invalid\" (the timespan ValidFrom to ValidTo is -exclusive- ValidTo; see comments in source code above). </p>\n\n<h2>The Problem</h2>\n\n<p>I actually -have- results in my result set \"items\" having <code>ValidTo == requestTime</code>. \nI just checked this via</p>\n\n<pre><code>Item i= items.FirstOrDefault();\nif ((i.ValidFrom.HasValue &amp;&amp; i.ValidFrom &gt; requestTime)\n || (i.ValidTo.HasValue &amp;&amp; requestTime &gt;= i.ValidTo)) {\n\n   // ... SOME ERROR OUTPUT ...\n\n}\n</code></pre>\n\n<p>** NOTE: This error isn't happening seldom, but nearly all the time in the software as .inValidate(requestTime); is often called to invalidate an object. ** </p>\n\n<p>I manually checked via Microsoft SQL Server Management Studio (Microsoft SQL Server 2008 is used as backend) using the produced SQL query by LinQ. I had to declare/set @p_<em>linq</em>_0, @p_<em>linq</em>_1 myself (which both mean requestTime)...</p>\n\n<pre><code>DECLARE @p__linq__0 DATETIME\nDECLARE @p__linq__1 DATETIME\nSET @p__linq__0 = '2012-10-23 15:15:11.473'\nSET @p__linq__1 = '2012-10-23 15:15:11.473'\n</code></pre>\n\n<p>This actually works as expected. But if I use '2012-10-23 15:15:11' as a value instead, I'll receive wrong results (as expected). They are similiar to those in my program. So I guess that's the problem...</p>\n\n<p>In Database the \"DateTime\" has Milliseconds defined and ValidFrom/ValidTo are stored including Milliseconds. But I assume that the query doesn't include the milliseconds part of the timestamp for any reason... The variable requestTime how ever has the milliseconds value set.</p>\n\n<p>Unfortunately I don't know how to check the actual values sent in a query to verify this. I only know how to use the items.toString()-Method to output the generated SQL, which contains placeholders.</p>\n\n<p>I tried:\n1. <code>db.Log = Console.Out;</code> which didn't compile due to an error that \"db.Log\" would not be defined (also the auto completion didn't suggest \"Log\"). Whereas db is derived from DbContext.\n2. Also casting \"items\" to ObjectQuery and then using .ToTraceString() doesn't work, program crashes at runtime with error message that cast is invalid.</p>\n\n<p>If this is important: I use .NET 4.0 and EntityFramework.5.0.0.</p>\n\n<h2>Questions</h2>\n\n<ol>\n<li>How to Log/Output the complete SQL (including values of placeholders)?</li>\n<li>How to fix that problem in an elegant way? ...I don't mean a hack that just substracts a second from the 'time' which is assigned to \"ValidTo\" in inValidate()!</li>\n</ol>\n\n<p>Best regards,</p>\n\n<p>Stefan</p>\n\n<h2>EDIT (more details found)</h2>\n\n<p>I checked what happens via the SQL profiler, which seems fine. Timestamps with high (7 digits) precisions are supplied correctly when querying. BUT: I don't get the SELECT causing the incorrect result. So I guessed: it must be some caching. So I put a <code>db.SaveChanges();</code> directly before my LINQ query. Now I got all queries in the profiler.</p>\n\n<p>I tried the following code to change the datatype in database. As it was suggested by Slauma (see <a href=\"http://stackoverflow.com/a/8044310/270591\">http://stackoverflow.com/a/8044310/270591</a>).</p>\n\n<pre><code>modelBuilder.Entity&lt;Item&gt;().Property(f =&gt; f.ValidFrom)\n  .HasColumnType(\"datetime2\").HasPrecision(3);\nmodelBuilder.Entity&lt;Item&gt;().Property(f =&gt; f.ValidTo)\n  .HasColumnType(\"datetime2\").HasPrecision(3);\n</code></pre>\n\n<p>I dropped the whole database before restart... </p>\n\n<p><strong>Result:</strong> No success using HasPrecision(x); where x is one of 0, 3; (with or without db.SaveChanges() directly before); BUT: x = 7 fairly works with db.SaveChanges(); directly before the query... </p>\n\n<p>So, unfortunately this problem is still existent... </p>\n\n<h2>Current Workaround</h2>\n\n<p>I apply the following method to any DateTime value before assigning it to a database objects property. It just rounds the DateTime to full seconds precision (which I configured at the DB). Also this is applied to any DateTime used for comparison.</p>\n\n<p>Result: This is more a hack than a solution! I will need to write access functions for all setter methods, so that a direct assignment cannot happen by accident.</p>\n\n<pre><code>    public static DateTime DateTimeDBRound(DateTime time) {\n        DateTime t = time;\n        long fraction = (t.Ticks % TimeSpan.TicksPerSecond);\n        if (fraction &gt;= TimeSpan.TicksPerSecond / 2)\n        {\n            t = t.AddTicks(TimeSpan.TicksPerSecond - fraction);\n        }\n        else\n        {\n            t = t.AddTicks(-fraction);\n        }\n        return t;\n    }\n</code></pre>\n"},{"tags":["c#","sql","entity-framework","master-detail"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13046614,"title":"Select error on EF using existing master detail database","body":"<p>Entity Framework v5 looks cool and I try to switch from Linq-to-SQL with <strong>existing</strong> MSSQL (Azure) database.\nbut tutorials about EF are too complex to follow.</p>\n\n<p>The database schema is pretty simple as follows (generated by exist db).</p>\n\n<p><em>Sheets</em> and <em>SheetDetails</em> tables are connected with 1-to-many relationship.</p>\n\n<pre><code>CREATE TABLE [dbo].[Sheets] (\n    [Id]          INT            IDENTITY (1, 1) NOT NULL,\n    [Grade]       FLOAT (53)     CONSTRAINT [DF_Sheets_Grade] DEFAULT ((0)) NOT NULL,\n    [Title]       NVARCHAR (255) CONSTRAINT [DF_Sheets_Title] DEFAULT ('') NOT NULL,\n    [Description] NVARCHAR (255) NULL,\n    [Difficulty]  SMALLINT       CONSTRAINT [DF_Sheets_Difficulty] DEFAULT ((0)) NOT NULL,\n    [Writer]      NVARCHAR (255) CONSTRAINT [DF_Sheets_Writer] DEFAULT ('') NOT NULL,\n    [Tag]         NVARCHAR (255) NULL,\n    [Duration]    FLOAT (53)     CONSTRAINT [DF_Sheets_Duration] DEFAULT ((0)) NOT NULL,\n    [Timestamp]   DATETIME       CONSTRAINT [DF_Sheets_Timestamp] DEFAULT ((0)) NOT NULL,\n    [RowVersion]  ROWVERSION     NOT NULL,\n    CONSTRAINT [PK_Sheets] PRIMARY KEY CLUSTERED ([Id] ASC)\n);\n\nCREATE TABLE [dbo].[SheetDetails] (\n    [Id]                   INT        IDENTITY (1, 1) NOT NULL,\n    [Score]                FLOAT (53) CONSTRAINT [DF_SheetDetails_Score] DEFAULT ((0)) NOT NULL,\n    [Number]               SMALLINT   CONSTRAINT [DF_SheetDetails_Number] DEFAULT ((0)) NOT NULL,\n    [SubNumer]             SMALLINT   NULL,\n    [IsRandom]             BIT        CONSTRAINT [DF_SheetDetails_IsRandom] DEFAULT ((0)) NOT NULL,\n    [AnswerType]           SMALLINT   CONSTRAINT [DF_SheetDetails_AnswerType] DEFAULT ((0)) NOT NULL,\n    [RowVersion]           ROWVERSION NOT NULL,\n    [SheetDetail_Sheet]    INT        CONSTRAINT [DF_SheetDetails_SheetDetail_Sheet] DEFAULT ((0)) NOT NULL,\n    [SheetDetail_Question] INT        CONSTRAINT [DF_SheetDetails_SheetDetail_Question] DEFAULT ((0)) NOT NULL,\n    CONSTRAINT [SheetDetail_Sheet] FOREIGN KEY ([SheetDetail_Sheet]) REFERENCES [dbo].[Sheets] ([Id]) ON DELETE CASCADE\n);\n</code></pre>\n\n<p>Note that the FK name is SheetDetail_Sheet in SheetDetails table.</p>\n\n<p>Result diagram is as below.\n<img src=\"http://i.stack.imgur.com/T17kQ.png\" alt=\"enter image description here\"></p>\n\n<p>Next, maybe I need to write EntityTypeConfiguration.\nI tried it as question 1.</p>\n\n<p><strong>Question 1.</strong>\nI wrote model creating configuration as follows but no luck. is it wrong? hard to know how to write right configuration with this simple database model.</p>\n\n<pre><code>    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new SheetsConfiguration());\n        base.OnModelCreating(modelBuilder);\n    }\n\n    public class SheetsConfiguration : EntityTypeConfiguration&lt;Sheets&gt;\n    {\n        public SheetsConfiguration()\n            : base()\n        {\n            HasKey(p =&gt; p.Id);\n            Property(p =&gt; p.Id).HasColumnName(\"Id\").HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity).IsRequired();\n            Property(p =&gt; p.RowVersion).IsConcurrencyToken().IsRowVersion();\n            HasOptional(p =&gt; p.SheetDetails).WithMany().Map(x =&gt; x.MapKey(\"SheetDetail_Sheet\"));\n            ToTable(\"Sheets\");\n        }\n    }\n</code></pre>\n\n<p>I execute simple query using</p>\n\n<pre><code>var result = _db.Sheets.Where(sheet =&gt; sheet.Id == id).ToList();\n</code></pre>\n\n<p>And then, I got an error \"Invalid column name SheetDetail_Sheet\" with executed query as follows.</p>\n\n<pre><code>SELECT \n[Extent1].[Id] AS [Id], \n[Extent1].[Grade] AS [Grade], \n[Extent1].[Title] AS [Title], \n[Extent1].[Description] AS [Description], \n[Extent1].[Difficulty] AS [Difficulty], \n[Extent1].[Writer] AS [Writer], \n[Extent1].[Tag] AS [Tag], \n[Extent1].[Duration] AS [Duration], \n[Extent1].[Timestamp] AS [Timestamp], \n[Extent1].[RowVersion] AS [RowVersion], \n[Extent1].[SheetDetail_Sheet] AS [SheetDetail_Sheet]\nFROM [dbo].[Sheets] AS [Extent1]\nWHERE [Extent1].[Id] = @p__linq__0\n</code></pre>\n\n<p>I can understand because <strong>SheetDetail_Sheet is just an FK</strong> and not exist in the edmx properties and database column.\nHow can I fix it? </p>\n\n<p>I don't want to edit auto-generated model file because it can be overwritten. maybe it seems to be achieved with EntityTypeConfiguration.</p>\n\n<p><strong>Question 2.</strong>\nIs there any useful and lightweight reference with the commonly used master-detail database model? </p>\n\n<p>I'm in trouble to start with existing database.\nstackoverflow, asp.net, blogs, etc...to many tutorials but hard to find an example like my case.</p>\n\n<p>Thank you.</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-4.3"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13047868,"title":"Entity Framework Code First: Querying many to many navigation properties without loading into memory","body":"<p>I would like to know the best way to query a many to many relationship without first loading all of the relationship objects into memory.</p>\n\n<p>For example, Category and Article have a many to many relationship. This means my Category class has a (lazy-loaded) navigation property as so:</p>\n\n<pre><code>class Category\n{\n     public long Id {get; set;}\n     public ICollection&lt;Articles&gt; Articles {get; set;}\n}\n</code></pre>\n\n<p>If I want to select only the articles that are visible, I can query the navigation property like so:</p>\n\n<pre><code>category.Articles.Where(a =&gt; a.IsVisible)\n</code></pre>\n\n<p>However as far as I am aware, this will load all the related articles into memory before doing the IsVisible check.</p>\n\n<p>Is it possible to query the related articles without loading them into memory, i.e. act on an IQueryable rather than an ICollection? If this were a one to many relationship then I could query the Article DbSet directly to achieve what I am after but the many to many relationship is stored in a link table in sql, meaning I am unable to query this using a DbSet. Is my only option to write the raw sql manually that will query the link table?</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13046149,"title":"Why disposed the ObjectContext instance?","body":"<p>can someone help me here, why I get the exception \"The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.\" in the following section?</p>\n\n<pre><code>    public virtual IEnumerable&lt;TEntity&gt; Get(Expression&lt;Func&lt;TEntity, bool&gt;&gt; filter, Func&lt;IQueryable&lt;TEntity&gt;, IOrderedQueryable&lt;TEntity&gt;&gt; orderBy)\n    {\n        if (this.CheckAccess(this.OnCanRead))\n        {\n            try\n            {\n                Expression&lt;Func&lt;TEntity, bool&gt;&gt; baseFilter = this.GetFilter(this.OnFilter);\n\n                IQueryable&lt;TEntity&gt; result = this.Set.AsQueryable();\n\n                if (baseFilter != null)\n                {\n                    result = result.Where(baseFilter);\n                }\n\n                if (filter != null)\n                {\n                    result = result.Where(filter);\n                }\n\n                if (orderBy == null)\n                {\n                    return result.ToList();\n                }\n                else\n                {\n                    return orderBy(result).ToList();\n                }\n            }\n            catch (Exception)\n            {\n                throw;\n            }\n        }\n        else\n        {\n            throw new AccessException(\"CanRead\");\n        }\n    }\n</code></pre>\n\n<p>Before calling the following point still exists the ObjectContext:</p>\n\n<pre><code>                if (baseFilter != null)\n                {\n                    result = result.Where(baseFilter);\n                }\n\n                if (filter != null)\n                {\n                    result = result.Where(filter);\n                }\n</code></pre>\n\n<p>Why no longer?</p>\n\n<p><strong>- EDIT -</strong></p>\n\n<p>More Informations:</p>\n\n<p>Here the class using the function where the problem occurs:\n<a href=\"http://entityframeworkext.codeplex.com/SourceControl/changeset/view/16211#382544\" rel=\"nofollow\">DbContextRepository</a> </p>\n\n<p>In my program, there is a class called ShopRepository, which is derived from:</p>\n\n<pre><code>public class ShopRepository : DbContextRepository&lt;Shop&gt;\n</code></pre>\n\n<p>Furthermore, there is a DataManager in my program what the problematic function is called: </p>\n\n<pre><code>public static class DataManager\n{\n    public static void Initialize()\n    {\n        Initializer.Initializer.SetInitializer();\n\n        ObjectFactory.Configure(\n           x =&gt;\n           {\n               x.For&lt;DbContext&gt;().Use&lt;DataContext&gt;();\n               x.For&lt;IUnitOfWorkFactory&gt;().Use&lt;DbContextUnitOfWorkFactory&gt;();\n           }\n        );\n\n        DbContextUnitOfWorkFactory.SetDbContext(CreateContext);\n    }\n\n    private static DbContext CreateContext()\n    {\n        return new DataContext();\n    }\n\n    private static ShopRepository _shops;\n\n    public static ShopRepository Shops\n    {\n        get\n        {\n            if (DataManager._shops == null)\n            {\n                DataManager._shops = ObjectFactory.GetInstance&lt;ShopRepository&gt;();\n            }\n\n            return DataManager._shops;\n        }\n    }\n</code></pre>\n\n<p><strong>- EDIT -</strong></p>\n\n<p>I have found the problem, but I do not know how to fix it. \nIf in the ShopRepository the event OnFilter a dynamic value is returned, such as</p>\n\n<pre><code>x =&gt; x.InstallationId == InstallationRepository.CurrentInstallationId\n</code></pre>\n\n<p>then error occurs, if there a fixed value such as</p>\n\n<pre><code>x =&gt; x.InstallationId == 1\n</code></pre>\n\n<p>is returned, no error occurs. </p>\n"},{"tags":["asp.net-mvc","entity-framework","production-environment"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":105,"score":2,"question_id":13048898,"title":"Entity Framework 5 - Code First Production Preparation","body":"<p>As part of our intended migration from Linq2Sql to Entity Framework, we have created a small EF model consisting of ten entities.  Because we are working with a legacy application we are using the 'code first' option and manually mapping our POCO objects to tables within the database.  <strong>We do not want the Entity Framework code to update the database.</strong>  I believe that the following is all I need to do to achieve this - I would appreciate confirmation as I was not sure whether the SetInitializer code should go here or perhaps in the Global.asax code.</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n    Database.SetInitializer&lt;InboxDataContext&gt;(null);\n\n    modelBuilder.Configurations.Add(new Subscribers.Mapping.DataSourceMap());\n    modelBuilder.Configurations.Add(new Subscribers.Mapping.SubscriberMap());\n    ...\n}\n</code></pre>\n\n<p>As part of this update, we have created a small test page (MVC controller and views) and added it to our main application project.  During development and testing this has worked well.  The only thing we did notice is that if we updated the underlying EF model, the initial page load seemed to take several minutes to render.  I assumed this was because EF had to rebuild its views and mappings to reflect the changes - to my disgrace, I didn't worry too much about this as a) I don't have a full understanding of how this works and b) it only seemed happened on model changes.</p>\n\n<p>This morning we loaded this update to the production server for initial testing and this time the initial load problem became much worse - so much so in fact that the test page never loaded.</p>\n\n<p>So, to get to my questions:</p>\n\n<ol>\n<li>Is there anything else I should/should not be doing to prepare my\napplication for production? </li>\n<li>How can I improve the initial load performance?</li>\n<li>How can I find out why the initial load on the production server\nnever completes - I am not seeing any error messages?</li>\n</ol>\n\n<p>I did try downloading the Entity Framework Power Tools and running the 'Generate Views' option on the derived DbContext class, but since I could only run this in the development environment I was not sure whether this would work when copied to the production server - it didn't appear to.</p>\n\n<p>I should mention that the development environment contains just one hundred records in the main table and the production environment contains almost one million records (same schemas), again I wasn't sure if this would make any difference.</p>\n\n<p>Any help advice would be appreciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net-mvc","entity-framework","entity-framework-4","entity-framework-4.1","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13047845,"title":"How to include a child object's child object in Entity Framework 5","body":"<p>I am using <code>Entity Framework 5 code first</code> and <code>ASP.NET MVC 3</code>.</p>\n\n<p>I am struggling to get a child object's child object to populate.  Below are my classes..</p>\n\n<p>Application class;</p>\n\n<pre><code>public class Application\n{\n     // Partial list of properties\n\n     public virtual ICollection&lt;Child&gt; Children { get; set; }\n}\n</code></pre>\n\n<p>Child class:</p>\n\n<pre><code>public class Child\n{\n     // Partial list of properties\n\n     public int ChildRelationshipTypeId { get; set; }\n\n     public virtual ChildRelationshipType ChildRelationshipType { get; set; }\n}\n</code></pre>\n\n<p>ChildRelationshipType class:</p>\n\n<pre><code>public class ChildRelationshipType\n{\n     public int Id { get; set; }\n\n     public string Name { get; set; }\n}\n</code></pre>\n\n<p>Part of GetAll method in the repository to return all the applications:</p>\n\n<pre><code>return DatabaseContext.Applications\n     .Include(\"Children\");\n</code></pre>\n\n<p>The Child class contains a reference to the ChildRelationshipType class.  To work with an application's children I would have something like this:</p>\n\n<pre><code>foreach (Child child in application.Children)\n{\n     string childName = child.ChildRelationshipType.Name;\n}\n</code></pre>\n\n<p>I get an error here that the object context is already closed.</p>\n\n<p>How do I specify that each child object must include the ChildRelationshipType object like what I did above?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13048742,"title":"EF Code First Not creating database","body":"<p>I have copied my code across into a new project and I am failing to see any .mdf or .log files generated after running. Under Data Connections I can see and interact with the tables in the database, yet no files are created within the App_Data folder.</p>\n\n<p>Here is my DB context class:</p>\n\n<pre><code>public class BareCupboardDB : DbContext\n{\n    public DbSet&lt;Recipe&gt; Recipes { get; set; }\n    public DbSet&lt;NutritionalValue&gt; NutritionalValues { get; set; }\n    public DbSet&lt;RecipeStep&gt; RecipeSteps { get; set; }\n    public DbSet&lt;Ingredient&gt; Ingredients { get; set; }\n    public DbSet&lt;RecipeIngredient&gt; RecipeIngredients { get; set; }\n}\n</code></pre>\n\n<p>My Application_Start() code:</p>\n\n<pre><code>protected void Application_Start()\n    {\n        AreaRegistration.RegisterAllAreas();\n\n        WebApiConfig.Register(GlobalConfiguration.Configuration);\n        FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);\n        RouteConfig.RegisterRoutes(RouteTable.Routes);\n        BundleConfig.RegisterBundles(BundleTable.Bundles);\n        AuthConfig.RegisterAuth();\n\n        //System.Data.Entity.Database.SetInitializer(new BareCupboard.Models.RecipeContextInitializer());\n        Database.SetInitializer(new CreateDatabaseIfNotExists&lt;BareCupboardDB&gt;());\n\n        var context = new BareCupboardDB();\n        context.Database.Initialize(true);\n    }\n</code></pre>\n\n<p>And my connection string:</p>\n\n<pre><code>&lt;add name =\"testConnection\"\n     connectionString=\"data source= .\\SQLExpress;Integrated Security=SSPI;Initial Catalog=BareCupboardDB\"\n     providerName=\"System.Data.SqlClient\"/&gt;\n</code></pre>\n\n<p>As far as I can see, this should absolutely generate my database files.</p>\n\n<p>I appreciate any help.</p>\n\n<p>Many thanks.</p>\n"},{"tags":["sql","asp.net-mvc-3","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":223,"score":1,"question_id":11596699,"title":"Convert SQL to LINQ in MVC3 with Ninject","body":"<p>I'm using MVC3 and still learning LINQ.  I'm having some trouble trying to convert a query to LINQ to Entities.  I want to return an employee object.</p>\n\n<pre><code>SELECT E.EmployeeID, E.FirstName, E.LastName, MAX(EO.EmployeeOperationDate) AS \"Last Operation\"\nFROM Employees E \nINNER JOIN EmployeeStatus ES ON E.EmployeeID = ES.EmployeeID\nINNER JOIN EmployeeOperations EO ON ES.EmployeeStatusID = EO.EmployeeStatusID\nINNER JOIN Teams T ON T.TeamID = ES.TeamID\nWHERE T.TeamName = 'MyTeam'\nGROUP BY E.EmployeeID, E.FirstName, E.LastName\nORDER BY E.FirstName, E.LastName\n</code></pre>\n\n<p>What I have is a few tables, but I need to get only the newest status based on the EmployeeOpertionDate.  This seems to work fine in SQL.  I'm also using Ninject and set my query to return Ienumerable.  I played around with the group by option but it then returns IGroupable.  Any guidance on converting and returning the property object type would be appreciated. </p>\n\n<p>Edit:  I started writing this out in LINQ but I'm not sure how to properly return the correct type or cast this.</p>\n\n<pre><code>public IQueryable&lt;Employee&gt; GetEmployeesByTeam(int teamID)\n    {\n\n        var q = from E in context.Employees\n                join ES in context.EmployeeStatuses on E.EmployeeID equals ES.EmployeeID\n                join EO in context.EmployeeOperations on ES.EmployeeStatusID equals EO.EmployeeStatusID\n                join T in context.Teams on ES.TeamID equals T.TeamID\n                where T.TeamName == \"MyTeam\"\n                group E by E.EmployeeID into G\n                select G;\n        return q;\n    }\n</code></pre>\n\n<p>Edit2:</p>\n\n<p>This seems to work for me</p>\n\n<pre><code>public IQueryable&lt;Employee&gt; GetEmployeesByTeam(int teamID)\n    {\n\n        var q = from E in context.Employees\n                join ES in context.EmployeeStatuses on E.EmployeeID equals ES.EmployeeID\n                join EO in context.EmployeeOperations.OrderByDescending(eo =&gt; eo.EmployeeOperationDate) on ES.EmployeeStatusID equals EO.EmployeeStatusID\n                join T in context.Teams on ES.TeamID equals T.TeamID\n                where T.TeamID == teamID\n                group E by E.EmployeeID into G\n                select G.FirstOrDefault();\n        return q;\n    }\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":2,"favorite_count":6,"up_vote_count":10,"down_vote_count":0,"view_count":8203,"score":10,"question_id":7795300,"title":"Validation failed for one or more entities. See 'EntityValidationErrors' property for more details","body":"<p>I am having this error when seeding my database with code first approach.</p>\n\n<p>Validation failed for one or more entities. See 'EntityValidationErrors' property for more details.</p>\n\n<p>To be honest I dont know how to check the content of the validation errors, Visual Studio shows me that its an array with 8 objects. so 8 validation Errors.</p>\n\n<p>This was working with my previous model, but I made a few changes that I explain below:\n- I had an enum called Status, I changed it to a class called Status\n- I changed the class ApplicantsPositionHistory to have 2 foreign key to the same table</p>\n\n<p>Excuse me for the long code, but I have to paste it all.  The exception is thrown in the last line of the following code.</p>\n\n<pre><code>namespace Data.Model\n{  \n\n    public class Position\n    {\n        [DatabaseGenerated(System.ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)]   \n        public int PositionID { get; set; }\n\n        [Required(ErrorMessage = \"Position name is required.\")]\n        [StringLength(20, MinimumLength = 3, ErrorMessage = \"Name should not be longer than 20 characters.\")]\n        [Display(Name = \"Position name\")]              \n        public string name { get; set; }\n\n        [Required(ErrorMessage = \"Number of years is required\")] \n        [Display(Name = \"Number of years\")]        \n        public int yearsExperienceRequired { get; set; }\n\n        public virtual ICollection&lt;ApplicantPosition&gt; applicantPosition { get; set; }\n    }\n\n    public class Applicant\n    {\n        [DatabaseGenerated(System.ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)]      \n        public int ApplicantID { get; set; }\n\n        [Required(ErrorMessage = \"Name is required\")] \n        [StringLength(20, MinimumLength = 3, ErrorMessage=\"Name should not be longer than 20 characters.\")]\n        [Display(Name = \"First and LastName\")]\n        public string name { get; set; }\n\n        [Required(ErrorMessage = \"Telephone number is required\")] \n        [StringLength(10, MinimumLength = 3, ErrorMessage = \"Telephone should not be longer than 20 characters.\")]\n        [Display(Name = \"Telephone Number\")]\n        public string telephone { get; set; }\n\n        [Required(ErrorMessage = \"Skype username is required\")] \n        [StringLength(10, MinimumLength = 3, ErrorMessage = \"Skype user should not be longer than 20 characters.\")]\n        [Display(Name = \"Skype Username\")]\n        public string skypeuser { get; set; }\n\n        public byte[] photo { get; set; }\n\n        public virtual ICollection&lt;ApplicantPosition&gt; applicantPosition { get; set; }\n\n\n    }\n\n    public class ApplicantPosition\n    {\n        [Key]\n        [Column(\"ApplicantID\", Order = 0)]\n        public int ApplicantID { get; set; }\n\n        [Key]\n        [Column(\"PositionID\", Order = 1)]\n        public int PositionID { get; set; }\n\n        public virtual Position Position { get; set; }\n\n        public virtual Applicant Applicant { get; set; }\n\n        [Required(ErrorMessage = \"Applied date is required\")] \n        [DisplayFormat(DataFormatString = \"{0:d}\", ApplyFormatInEditMode = true)]\n        [Display(Name = \"Date applied\")]     \n        public DateTime appliedDate { get; set; }\n\n        [Column(\"StatusID\", Order = 0)]\n        public int StatusID { get; set; }\n\n        public Status CurrentStatus { get; set; }\n\n\n        //[NotMapped]\n        //public int numberOfApplicantsApplied\n        //{\n        //    get\n        //    {\n        //        int query =\n        //             (from ap in Position\n        //              where ap.Status == (int)Status.Applied\n        //              select ap\n        //                  ).Count();\n        //        return query;\n        //    }\n        //}\n    }\n\n\n    public class Address\n    {\n        [StringLength(20, MinimumLength = 3, ErrorMessage = \"Country should not be longer than 20 characters.\")]\n        public string Country { get; set; }\n\n        [StringLength(20, MinimumLength = 3, ErrorMessage = \"City  should not be longer than 20 characters.\")]\n        public string City { get; set; }\n\n        [StringLength(50, MinimumLength = 3, ErrorMessage = \"Address  should not be longer than 50 characters.\")]\n        [Display(Name = \"Address Line 1\")]     \n        public string AddressLine1 { get; set; }\n\n        [Display(Name = \"Address Line 2\")]\n        public string AddressLine2 { get; set; }   \n\n    }\n\n\n\n    public class ApplicationPositionHistory\n    {\n        [DatabaseGenerated(System.ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)]\n        public int ApplicationPositionHistoryID { get; set; }\n\n        public ApplicantPosition applicantPosition { get; set; }\n\n        [Column(\"oldStatusID\")]\n        public int oldStatusID { get; set; }\n\n        [Column(\"newStatusID\")]\n        public int newStatusID { get; set; }\n\n        public Status oldStatus { get; set; }\n\n        public Status newStatus { get; set; }\n\n        [StringLength(500, MinimumLength = 3, ErrorMessage = \"Comments  should not be longer than 500 characters.\")]\n        [Display(Name = \"Comments\")]\n        public string comments { get; set; }\n\n        [DisplayFormat(DataFormatString = \"{0:d}\", ApplyFormatInEditMode = true)]\n        [Display(Name = \"Date\")]     \n        public DateTime dateModified { get; set; }\n    }\n\n    public class Status\n    {\n        [DatabaseGenerated(System.ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)]\n        public int StatusID { get; set; }\n\n        [StringLength(20, MinimumLength = 3, ErrorMessage = \"Status  should not be longer than 20 characters.\")]\n        [Display(Name = \"Status\")]\n        public string status { get; set; }\n\n    }\n\n\n\n}\n\n\n\n\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Data.Entity;\nusing System.IO;\n\nnamespace Data.Model\n{\n    public class HRContextInitializer : DropCreateDatabaseAlways&lt;HRContext&gt;\n    {\n        protected override void Seed(HRContext context)\n        {\n            #region Status\n            Status applied = new Status() { status = \"Applied\" };\n            Status reviewedByHR = new Status() { status = \"Reviewed By HR\" };\n            Status approvedByHR = new Status() { status = \"Approved by HR\" };\n            Status rejectedByHR = new Status() { status = \"Rejected by HR\" };\n            Status assignedToTechnicalDepartment = new Status() { status = \"Assigned to Technical Department\" };\n            Status approvedByTechnicalDepartment = new Status() { status = \"Approved by Technical Department\" };\n            Status rejectedByTechnicalDepartment = new Status() { status = \"Rejected by Technical Department\" };\n\n            Status assignedToGeneralManager = new Status() { status = \"Assigned to General Manager\" };\n            Status approvedByGeneralManager = new Status() { status = \"Approved by General Manager\" };\n            Status rejectedByGeneralManager = new Status() { status = \"Rejected by General Manager\" };\n\n            context.Status.Add(applied);\n            context.Status.Add(reviewedByHR);\n            context.Status.Add(approvedByHR);\n            context.Status.Add(rejectedByHR);\n            context.Status.Add(assignedToTechnicalDepartment);\n            context.Status.Add(approvedByTechnicalDepartment);\n            context.Status.Add(rejectedByTechnicalDepartment);\n            context.Status.Add(assignedToGeneralManager);\n            context.Status.Add(approvedByGeneralManager);\n            context.Status.Add(rejectedByGeneralManager); \n            #endregion    \n\n            #region Position\n            Position netdeveloper = new Position() { name = \".net developer\", yearsExperienceRequired = 5 };\n            Position javadeveloper = new Position() { name = \"java developer\", yearsExperienceRequired = 5 };\n            context.Positions.Add(netdeveloper);\n            context.Positions.Add(javadeveloper); \n            #endregion\n\n            #region Applicants\n            Applicant luis = new Applicant()\n            {\n                name = \"Luis\",\n                skypeuser = \"le.valencia\",\n                telephone = \"0491732825\",\n                photo = File.ReadAllBytes(@\"C:\\Users\\LUIS.SIMBIOS\\Documents\\Visual Studio 2010\\Projects\\SlnHR\\HRRazorForms\\Content\\pictures\\1.jpg\")\n            };\n\n            Applicant john = new Applicant()\n            {\n                name = \"John\",\n                skypeuser = \"jo.valencia\",\n                telephone = \"3435343543\",\n                photo = File.ReadAllBytes(@\"C:\\Users\\LUIS.SIMBIOS\\Documents\\Visual Studio 2010\\Projects\\SlnHR\\HRRazorForms\\Content\\pictures\\2.jpg\")\n            };\n\n            context.Applicants.Add(luis);\n            context.Applicants.Add(john); \n            #endregion\n\n            #region ApplicantsPositions\n            ApplicantPosition appicantposition = new ApplicantPosition()\n            {\n                Applicant = luis,\n                Position = netdeveloper,\n                appliedDate = DateTime.Today,\n                StatusID = 1\n            };\n\n            ApplicantPosition appicantposition2 = new ApplicantPosition()\n            {\n                Applicant = john,\n                Position = javadeveloper,\n                appliedDate = DateTime.Today,\n                StatusID = 1\n            };        \n\n            context.ApplicantsPositions.Add(appicantposition);            \n            context.ApplicantsPositions.Add(appicantposition2); \n            #endregion\n\n            context.SaveChanges(); ---&gt;&gt; Error here\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":445,"score":0,"question_id":9472508,"title":"getdate() not working with Entity Framework","body":"<p>So I have a column named <code>Timestamp</code> in my database with a default value of <code>GetDate()</code>.  </p>\n\n<p>Whenever I use Entity Framework to insert a record, <code>Timestamp</code> is <code>null</code>.</p>\n\n<p>Why is this the case?</p>\n"},{"tags":["c#","database","sql-server-2008","entity-framework","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13046375,"title":"Removing Parent with one-to-many EntityFramework","body":"<p>I have this class ( Simplified )</p>\n\n<pre><code>public class User {\n    public string Username { get; set; }\n    public virtual Section Section { get; set; }\n}\n\npublic class Section {\n    public int DepartmentNumber { get; set; }\n    public virtual ICollection&lt;User&gt; DepartmentMembers { get; set; }\n}\n</code></pre>\n\n<p>What i try to achive is to delete a section. All users related to this section shoulde get a null value. This dosent work now because REFERENCE constraint \"FK_Users_Sections_Section\".</p>\n\n<p>What woulde be the correct way to do this? woulde i have to remove all users from this section before deleteing it? Is there a more elegant way to do this? Im using EntityFramework.</p>\n\n<p>My fluent API for this field:</p>\n\n<pre><code>modelBuilder.Entity&lt;User&gt;()\n            .HasOptional(u =&gt; u.Section)\n            .WithMany(s =&gt; s.DepartmentMembers)\n            .Map(m =&gt;\n                m.MapKey(\"Section\")\n            )\n            .WillCascadeOnDelete(false);\n</code></pre>\n\n<p>The WillCascadeOnDelete i have tried it by setting to false, removing the line and also adding the line with no arguments. </p>\n\n<p>I guess the solution is quit simple but i cant find any good explaination ( or mabye i dont understand the explainations i have been looking at. )</p>\n"},{"tags":[".net","entity-framework","dependency-injection","ef-code-first","ninject"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":13033731,"title":"injecting username as constructor parameter to repository using Ninject","body":"<p>I found serveral questions using parameter passing to a constructor but i can't translate it to my specific problem. </p>\n\n<p>I'm studying EF codefirst in combination with MVC.</p>\n\n<p>I've created an abstract class and an interface as a base:</p>\n\n<pre><code>public abstract class RepositoryBase&lt;C, T&gt; : IRepositoryBase&lt;T&gt; \n    where T: class where C : DbContext,  new()\n\npublic interface IRepositoryBase&lt;T&gt; where T : class\n</code></pre>\n\n<p>for my model repositories iv'e created in concrete class with an interface </p>\n\n<pre><code>public interface ICustomerRepository : IRepositoryBase&lt;Customer&gt;\n\npublic class CustomerRepository: RepositoryBase&lt;PNMP, Customer&gt;,\n    ICustomerRepository\n</code></pre>\n\n<p>the PNMP (my code first context) only has a constructor that accepts the user identity for tracking changes setting the internal parameter _username</p>\n\n<pre><code>public override int SaveChanges()\n{\n    var changeSet = ChangeTracker.Entries&lt;IDatabaseBaseType&gt;();\n\n    if (changeSet != null)\n    {\n        var modifiedEntries =\n            changeSet.Where(c =&gt; c.State== EntityState.Modified);\n\n        foreach (var entry in modifiedEntries)\n        {\n            entry.Entity.ModifiedDate = DateTime.Now;\n            entry.Entity.ModifiedBy = _username;\n        }\n\n        var addedEntries =\n            changeSet.Where(c =&gt; c.State == EntityState.Added);\n\n        foreach (var entry in addedEntries)\n        {\n            entry.Entity.CreatedDate = DateTime.Now;\n            entry.Entity.CreatedBy = _username;\n        }\n    }\n    return base.SaveChanges();\n}\n</code></pre>\n\n<p>how can i pass my identity variable to my constructor of the PNMP (context)</p>\n\n<p>I'm using Ninject.MVC3 for binding the concrete class to the interface using :</p>\n\n<pre><code>kernel.Bind&lt;ICustomerRepository&gt;().To&lt;CustomerRepository&gt;();\n</code></pre>\n"},{"tags":["c#","entity-framework",".net-4.0","exception-handling","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13046526,"title":"Notsupportedexception was unhandled by user code","body":"<p>My code:</p>\n\n<pre><code>i f(!string.IsNullOrWhiteSpace(gender))\n    if (gender == \"NULL\")\n        predicate = predicate.And(x =&gt; string.IsNullOrWhiteSpace(gender));\n    else\n        predicate = predicate.And(x =&gt; x.Gender == gender);\n</code></pre>\n\n<p>When gender is NULL and when I am executing the flowing line:</p>\n\n<pre><code>var filteredUsers = _personExtendedRepository.GetMany(predicate).ToList();\n</code></pre>\n\n<p>an error occurs:</p>\n\n<blockquote>\n  <p>\"LINQ to Entities does not recognize the method 'Boolean IsNullOrWhiteSpace(System.String)' method, and this method cannot be translated into a store expression.\"</p>\n</blockquote>\n\n<p><strong>Note</strong>:\nWhen I am executing the following line in SQL Server Management Studio:</p>\n\n<pre><code>SELECT * FROM UVW_Sample WHERE Gender IS NULL\n</code></pre>\n\n<p>Records are displaying. Please help how to solve this issue.</p>\n"},{"tags":["c#",".net","entity-framework","3-tier"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13045880,"title":"Layers and Entities?","body":"<p><em>(I'm gonna ask 2 question please).</em></p>\n\n<p>We use 3 layers: Bl , Dal , UI.</p>\n\n<p><img src=\"http://i.stack.imgur.com/vMlew.jpg\" alt=\"enter image description here\"></p>\n\n<p>We didn't want to build one big <code>BL</code> , <code>DAL</code> for All Objects.</p>\n\n<p>So we created this structure both for <code>Agents</code> and <code>Leads</code>.</p>\n\n<p>Now lets say I should write a method : </p>\n\n<pre><code>public Agent GetAgentByLead(Lead leadObj)\n {\n }\n</code></pre>\n\n<p><kbd>Question #1</kbd></p>\n\n<p>Where does this function should reside on : <code>AgentsBL</code> or <code>LeadsBL</code> ? </p>\n\n<p><kbd>Question #2</kbd></p>\n\n<p>Lets say I want to use Entity Framework.</p>\n\n<p>A query can be  : </p>\n\n<pre><code>var activeAgents= context.Agents.Where(c =&gt; c.ACTIVE).ToList();\n</code></pre>\n\n<p>This line can be executed in <code>myPage.aspx.cs</code> file.</p>\n\n<p>so <em>where</em> are the layers here ? Where will context resides ?</p>\n\n<p>I just dont see how EF deals with layers ( like my first question ) </p>\n\n<p>Any help please?</p>\n"},{"tags":["wpf","entity-framework","optimistic"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":38,"score":-3,"question_id":13045364,"title":"Entity Framework Timestamp Optimistic concurrency Client using WPF","body":"<blockquote>\n  <p>Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.</p>\n</blockquote>\n\n<p>This is because timestamp has changed after I save last time,how could I make the changed Timestamp return to the Client Entity. I try to reload the entity after the saveaction ，but it‘s not changed;Why??</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13045303,"title":"linq function to handle : both fields equal or both null or empty","body":"<p>Hi I have a linq query where I compare an object with all other entity stored in my database. Firstname and lastname are mandatory fields so I don't have to check for null. But in the case of street I have to do these checks. </p>\n\n<p>I want to match if both fields are null or empty strings or that they are the same. The below linq query is working fine. </p>\n\n<p>But I was wandering isn't there any way to make it more readable. For example with a custom function like <strong>Bool FieldsAreEqualOrBothNullOrEmpty(r.street, request.street)</strong> </p>\n\n<p>Can't figure how to do that and if it's possible. </p>\n\n<pre><code>var same = \n   from r in db.Requests\n   where r.firstName.ToLower() == request.firstName.ToLower()\n      &amp;&amp; r.lastName.ToLower() == request.lastName.ToLower()\n\n      //Seems long to just compare two fields\n      &amp;&amp; ( string.IsNullOrEmpty(r.street) &amp;&amp; string.IsNullOrEmpty(request.street) ) \n         || r.street.ToLower() == request.street.ToLower()\n\n      select r;\nreturn same;\n</code></pre>\n"},{"tags":["entity-framework","unit-testing","mocking","tdd"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13045499,"title":"Testing repository with DbContext - mocking issue concerning IDbSet","body":"<p>I am trying to test a repository that uses DbContext</p>\n\n<p>The issue I am running into is that DbCOntext wants to return DbSet for certain types</p>\n\n<p>I can't even mock IDbSet as it has a PRIVATE CTOR?!?!?!</p>\n\n<p>How is everyone getting over this?</p>\n"},{"tags":["entity-framework","architecture","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13044265,"title":"repositories, interfaces, aggregate roots etc with regard to table joins","body":"<p>I am slowly trying to improve my knowledge of Enterprise Application Development. With regard to best practices I have learned about creating concrete repository implementations of iRepository interfaces and so far it makes sense.</p>\n\n<p>Where I am challenged is when (as it often happens) I want to return data that is coming from two or more tables in one result set, and how to best approach this.</p>\n\n<p>I understand that identifying aggregate roots is probably the best way to go but am wondering how to approach this with regard to interfaces and repositories when it comes to using specific/custom repositories vs generic repositories.</p>\n\n<p>Generic Repositories seem like a great way to cut down on the need to create individual iRepositories for each required implementation, but the problem is that not all of my concrete classes have a need for all of the methods in the Generic Repository Interface, ie sometimes I will need more and other times I will need less.</p>\n\n<p>I am wondering what is the best practice to approach this situation? Do developers normally have one generic repository interface and then create more specific ones for more specific Data Access needs?</p>\n\n<p>I have used this project as a guideline for best practice:\n<a href=\"http://efmvc.codeplex.com/\" rel=\"nofollow\">http://efmvc.codeplex.com/</a></p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13042481,"title":"How to keep an edmx file up to date","body":"<p>I was given a project that has a DB-first generated edmx file. I'm  not really sure how to tell if it is in sync with my DB or not... I don't quite understand the Update Model screen in relation to what is going to actually get updated (I can't just look at the changes afterwards to see what changed because I am not familiar with the model).</p>\n\n<p>Also, is it better practice to use Update Model wizard or delete and regenerate the edmx each time. I inherently do not trust the output of these GUI DB creators (not sure if this is well grounded or not with this particular technology)</p>\n\n<p>I am on .Net 4</p>\n"},{"tags":["linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12976414,"title":"Entity Framework/ Linq - groupby and having clause","body":"<p>Given the query below</p>\n\n<pre><code>       public TrainingListViewModel(List&lt;int&gt; employeeIdList)\n        {\n            this.EmployeeOtherLeaveItemList =\n                CacheObjects.AllEmployeeOtherLeaves\n                .Where(x =&gt; x.OtherLeaveDate &gt;= Utility.GetToday() &amp;&amp;\n                    x.CancelDate.HasValue == false &amp;&amp;\n                    x.OtherLeaveId == Constants.TrainingId)\n                .OrderBy(x =&gt; x.OtherLeaveDate)\n                .Select(x =&gt; new EmployeeOtherLeaveItem\n                {\n                    EmployeeOtherLeave = x,\n                    SelectedFlag = false\n                }).ToList();\n        }\n</code></pre>\n\n<p>I want to put in the employeeIdList into the query.\nI want to retrieve all of the x.OtherLeaveDate values where the same x.OtherLeaveDate exists for each join where x.EmployeeId = (int employeeId in employeeIdList)</p>\n\n<p>For example if there are EmployeeIds 1, 2, 3 in employeeIdList and in the CacheObjects.AllEmployeeOtherLeaves collection there is a date 1/1/2001 for all 3 employees, then retreive that date.</p>\n"},{"tags":["entity-framework","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13040665,"title":"Get data from stored procedure","body":"<p>I made a stored procedure to get data like: <code>select * from customer</code> and then I made a model in Entity Framework through 1 function <code>getcustomer</code>. What code should I write to get the list from the stored procedure?</p>\n\n<pre><code>public List&lt;Customer&gt; getCustomerWithsp()\n    {\n        Database1Entities1 context = new Database1Entities1();\n        List&lt;Customer&gt; cust = new List&lt;Customer&gt;();\n        cust = context.getcustomer().tolist(); //What should I write here?\n        return cust;\n    }\n</code></pre>\n"},{"tags":["wcf","entity-framework",".net-4.0","self-tracking-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":53,"score":2,"question_id":13041984,"title":"WCF, Data-Updates & EntityReference object could not be serialized","body":"<p>I did a lot of stuff with WCF where I first thought: \"Hmm, this problem is weird\" - but after I figured each one out, it always made somehow sense (sometimes more, sometimes less).<br />\nBut now I'm at a point where I'm stuck and with all my imagination, I cannot think of a reason why this error appreas:</p>\n\n<blockquote>\n  <p>The EntityReference object could not be serialized. This type of object cannot be serialized when the RelationshipManager belongs to an entity object that does not implement IEntityWithRelationships.</p>\n</blockquote>\n\n<p>To put it in a context, let me tell you about my program in a nutshell:<br />\nI have a client which send's an ID to my WCF.\nIf this ID is in use, I'll grab it's related object from the EF (otherwiese I'll create a new one) and send it back.</p>\n\n<p>This all is done by Selftracking Entities - and getting the objects works fine, as well as the first update:</p>\n\n<pre><code>public static void UpdatePaperOnServer(ref PAPER p)\n{\n    var newP = ServiceClient.UpdatePaper(p);\n    p = newP;\n}\n</code></pre>\n\n<p>The reference \"p\" is a field in &lt; Program > and any changes will happen on this variable.<br /></p>\n\n<p>Here is the server-side implementation of UpdatePaper.<br />\nAs you can see, no magic will happen here neither:</p>\n\n<pre><code>public PAPER UpdatePaper(PAPER p)\n{\n    p.ChangePaperOnDb(); //Simple static DAL-Accessor, works fine\n\n    return p; //The Client should get any changes made by other users so far, that's why I'll give the obj back... or if it's a new obj and it has an ID now\n}\n</code></pre>\n\n<p>As I said, my first Update works fine, but as soon as I trigger the update-routine again, I'll get this error which I mentioned above.</p>\n\n<p>After spending some time with my good mate google, I found only an approach where they changed the .NET-Version from 4.0 to 3.5.\nBut I don't know if that would for me as I can't change the runtime from 4.0 to 3.5.</p>\n\n<p>If anyone has any clue what's going on - please let me know.\nThank you very much!</p>\n"},{"tags":[".net","database","oracle","entity-framework","ado.net"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13041163,"title":"Many-to-Many relationship in Entity Framework with relationship informantion","body":"<p>First said, this is my first experience using the Entity Framework so I apologize if this ends up being a newbie question.  Everything has gone well so far; but, I run into a situation that I am not sure what the best way to handle is.  </p>\n\n<p>I need to create a many-to-many relationship; but, the many-to-many table contains more than just the composite key.  In this case the Entity Framework does not see to recognize it as a many-to-many structure and so I don't seem to get the easy ability to get the collections without using the intervening table.  Is there a better way to do this?</p>\n\n<p>Simplified Example:</p>\n\n<ul>\n<li>A Unit can have many boards and a board could have been in many units</li>\n<li>When it is in a unit we need to record what slot it was in.</li>\n</ul>\n\n<p>Tables:</p>\n\n<pre><code>Unit\n UnitID(PK)\n UnitName\n\nBoard\n BoardID(PK)\n BoardName\n\nUnitBoard\n UnitID(PK,FK1)\n BoardID(PK,FK2)\n Slot\n</code></pre>\n\n<p>When I pull this into my code using an ADO.NET Entity Data Model, I don't see an easy way to get the collection of Boards associated to a Unit from the Unit Entity or visa-versa.</p>\n\n<p>Is there a better way to do this or do I just need to use the associated collection of UnitBoards then use that to build the collection of Units/Boards?</p>\n\n<p>This seems I am probably not the first person to went to do something like this.  Ex: I was thinking of Books and Owners wanting to also keep the related BookOwner information (like the purchase date).</p>\n"},{"tags":["entity-framework","sql-server-2005","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13039207,"title":"Entity Framework and date+time arithmetic","body":"<p>We have the situation where we have a SQL Server 2005 table with a Date column and a separate Time column.  When I try to query this table, I'd like to do the equivalent of the following SQL:</p>\n\n<p><code>where Date + Time &gt; @Something</code></p>\n\n<p><em>Some background info - the Date is stored as a date with a 00:00 time component, and the Time is stored as a Time with a 1900-01-01 date component - this means in SQL adding the two together get you a full DateTime.</em></p>\n\n<p>I know there are indexing implications above, but that is not what the question is about.</p>\n\n<p><strong>How do you do this in linq to entities?</strong></p>\n\n<p>Some other things to note:</p>\n\n<ul>\n<li>Changing the database schema is out of the question.</li>\n<li>This is SQL 2005 so no Time datatype, and no TimeSpan returned from EF (I have tried changing the EF model to try and cast it to a TimeSpan, but no dice)</li>\n<li>I want to try and stick to pure Linq-to-Entities and not go down the E-SQL / stored procedure / ExecuteQuery route.</li>\n</ul>\n"},{"tags":["c#","linq","entity-framework","data-structures","expression"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":85,"score":3,"question_id":13036583,"title":"Why is it better to use data structure in Entity Framework","body":"<p><a href=\"http://geekswithblogs.net/Martinez/archive/2009/06/29/understanding-expression-trees.aspx\" rel=\"nofollow\">http://geekswithblogs.net/Martinez/archive/2009/06/29/understanding-expression-trees.aspx</a></p>\n\n<p>By reading this article that expline what are Expression trees and what they are used for I have some question thats the article those not answer me clearly.</p>\n\n<p><strong>A.</strong> What is the difference between Data Structure and 'compiled piece of code'. \n * I know that data structure is Array,List,.. But this is not the answer I am looking for.</p>\n\n<p><strong>B.</strong> Why is it better to use data structure in Entity Framework than 'compiled piece of code' in terms of efficiency.</p>\n"},{"tags":["entity-framework","frameworks","ado.net","model","entity"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":45,"score":-1,"question_id":13037673,"title":"ADO.Net Entity Model (edmx) vs Entity Framework(v4.0 etc)","body":"<p>What are the benefits of using ADO.Net Entity Model and EF?</p>\n\n<p>Can we use both of them together in a project. I came across an example where, the user had used both edmx and ef for his application. I am not sure what is the purpose of that.</p>\n\n<p>Thanks </p>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4"],"answer_count":3,"favorite_count":4,"up_vote_count":8,"down_vote_count":0,"view_count":942,"score":8,"question_id":12502004,"title":"Entity Framework Code-First Issues (SimpleMembership UserProfile table)","body":"<p>If you've used ASP.NET MVC 4 you'll notice that the default for an Internet Application is to use the SimpleMembership provider, this is all well and good and works fine.</p>\n\n<p>The issue comes with the default database generation, they have a POCO for <code>UserProfile</code> defined like so:</p>\n\n<pre><code>[Table(\"UserProfile\")]\npublic class UserProfile\n{\n    [Key]\n    [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n    public int UserId { get; set; }\n    public string UserName { get; set; }\n}\n</code></pre>\n\n<p>.. which is then generated like this:</p>\n\n<pre><code>using (var context = new UsersContext())\n{\n    if (!context.Database.Exists())\n    {\n         // Create the SimpleMembership database without Entity Framework migration schema\n         ((IObjectContextAdapter)context).ObjectContext.CreateDatabase();\n    }\n}\n</code></pre>\n\n<p>This works fine, the database is generated just fine and works without issue. However, if I am to change the POCO like this and delete the database:</p>\n\n<pre><code>[Table(\"UserProfile\")]\npublic class UserProfile\n{\n    [Key]\n    [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n    public int UserId { get; set; }\n    public string EmailAddress { get; set; }\n\n    public string FirstName { get; set; }\n    public string Surname { get; set; }\n\n    public string Country { get; set; }\n\n    public string CompanyName { get; set; }\n}\n</code></pre>\n\n<p>Only the first 2 columns are generated, <code>UserId</code> and <code>EmailAddress</code>. It works just fine code-wise (talking login/registration), but obviously none of my other user data is stored.</p>\n\n<p>Am I missing something here? Surely it should generate the database based off the whole <code>UserProfile</code> object.</p>\n"},{"tags":["entity-framework","simplemembership"],"answer_count":4,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":681,"score":5,"question_id":12575311,"title":"Using SimpleMembership with EF model-first","body":"<p>Can <strong>SimpleMembership</strong> be used with <strong>EF model-first</strong>?  When I try it, I get \"Unable to find the requested .NET Framework Data Provider\" when I call <code>WebSecurity.InitializeDatabaseConnection.</code></p>\n\n<p>To put it another way: I can't get the call to <code>WebSecurity.InitializeDatabaseConnection</code> to work when the connection string employs the <code>System.Data.EntityClient</code> provider (as it does when using the <strong>model-first</strong> paradigm).</p>\n\n<p>To repro the issue, create an MVC 4 app, and replace the <strong>code-first</strong> UserProfile entity class (which you get for free with the MVC 4 template) with a <strong>model-first</strong> User class that you have created in the Entity Designer:</p>\n\n<ol>\n<li>Create an MVC 4 app in <strong>VS 2012</strong> and add a new, blank Entity Data\nModel.</li>\n<li>Add a new Entity named <code>User</code> to the model, with fields for <code>Id,</code>\n<code>UserName, and FullName</code>.  So, at this point, the <code>User</code> data entity is\nmapped to a <code>Users</code> table and is accessed via a funky connection\nstring that employs the <code>System.Data.EntityClient</code> provider.</li>\n<li>Verify that the <strong>EF</strong> can access the <code>User</code> entity.  One easy way to do\nthat is to scaffold out a Users controller based on the User table\nand its associated DbContext.</li>\n<li>Edit the <code>AccountModels.cs</code> file to remove the <code>UserProfile</code> class and\nits associated <code>UsersContext</code> class. Replace the references to the\n(now missing) <code>UserProfile</code> and <code>UsersContext</code> classes with references\nto your new User class and its associated <code>DbContext</code> class.</li>\n<li>Move the call to InitializeDatabaseConnection from the\nInitializeSimpleMembershipAttribute filter class to the\nApplication_Start method in Global.asax.cs.  While you're at it,\nmodify the arguments to use your new User entity's connection\nstring, table name, and UserId column name.</li>\n<li>Delete the (no longer used) <code>InitializeSimpleMembershipAttribute</code>\nclass and the references to it.</li>\n</ol>\n\n<p>When you run the repro, it will get an <strong>Exception</strong> at the call to <code>InitializeDatabaseConnection.</code></p>\n\n<p>Bob</p>\n"},{"tags":["c#","sql-server","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":13036635,"title":"Mapping 1 to 0-1 In Entity Framework","body":"<p>Doing Entity Framework (5) code first, although we are not generating our data model from the code--we just keep them in sync manually (less of a pain than it sounds).</p>\n\n<p>Trying to create a 1 to 0-1 relationship.  Here is the setup using a made-up example of a customer that could have 0 or 1 address:</p>\n\n<p><strong>Edit: original example was not right.  Customer can have 0-1 Addresses, Address has exactly 1 customer.  Table design and code both updated.</strong></p>\n\n<pre>\nAddress\n--------------\nAddressId (identity)\nAddressText\nCustomerId (Edit: this employs a unique constraint)\n</pre>\n\n<pre>\nCustomer\n--------------\nCustomerId (identity)\nCustomerName\n</pre>\n\n<p>Relevant part of Address mapping:</p>\n\n<pre><code>   this.HasKey(t =&gt; t.AddressId);\n   //SEE NOTE ON THIS BELOW\n   //this.Property(t =&gt;t.AddressId).\n                   HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n   this.HasRequired(t =&gt; t.Customer)\n       .WithOptional();\n</code></pre>\n\n<p>Relevant part of Customer mapping:</p>\n\n<pre><code>  this.HasKey(t =&gt; t.CustomerId);\n   this.HasOptional(b =&gt; b.Address)\n            .WithRequired(); \n</code></pre>\n\n<p>Note the line commented out in Customer.  If I include this, I get the following error:</p>\n\n<blockquote>\n  <p>A dependent property in a ReferentialConstraint is mapped to a\n  store-generated column. Column: 'CustomerId'.</p>\n</blockquote>\n\n<p>If I don't include it, I get:</p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table 'Customer'\n  when IDENTITY_INSERT is set to OFF.</p>\n</blockquote>\n\n<p>I have searched high and low, and the code above seems to be the recommended approach.  I have also seen some vague mention that 1:1 relationships can't be modeled unless the two tables share a key of the same name?</p>\n\n<p>Can this sort of relationship be modeled in code, and if so, what is the correct syntax?</p>\n"},{"tags":["sql-server","entity-framework","temporary-tables"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":427,"score":1,"question_id":9760323,"title":"Entity Framework and stored procedure returning temp table Issues","body":"<p>(Disclaimer - I'm not the database designer. I'm just the poor developer what has to make this work.)</p>\n\n<p>There are 17 (at the moment) tables with identical structure - name, address, phone number.</p>\n\n<p>Given a phone number, I have to check to see if there's a matching entry in any of the tables, then return that address.</p>\n\n<p>So, I created a view to get the list of tables (there's a ref table that holds that info), then I created a stored procedure to </p>\n\n<ol>\n<li>create a temp table, </li>\n<li>using cursors, check each table in the view for the phone number, using sql concatenation. If a record is found, insert it into the temp table. </li>\n<li>return the rows from the temp table. </li>\n</ol>\n\n<p>This all works in straight T-SQL. </p>\n\n<p>Now, I'm trying to use Entity Framework 4+ to call the stored procedure. But the function import interface won't generate columns. It says return type = none, and the LINQ code expects an int and won't compile. </p>\n\n<p>Any ideas on how to make this work? </p>\n\n<p>I know I can move the check tables part to code, if I absolutely have to, but I'd rather have the above method work. </p>\n"},{"tags":["sql-server","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":13035872,"title":"SQL Query to Entity Framework (ExecuteStoreQuery)","body":"<p>I have a SQL query that works fine and returns proper results</p>\n\n<pre><code> declare @memberId decimal\nset @memberId=100\n\nselect s.Id, s.StatusDate, s.StatusText, p.FirstName, p.LastName, p.Photo\n from MemberStatus s join Profile p on s.SenderId = p.MemberID\n where s.SenderId IN\n (\nselect f.MemberID as id from Member_FriendRequest f where (f.FriendID = @memberId ) and f.Status=2\nunion\nselect f.FriendID as id from Member_FriendRequest f where (f.MemberID=@memberId) and f.Status=2\nunion \nselect @memberId\n)\n</code></pre>\n\n<p>But when I try to use it in ASP.NET it never returns any result</p>\n\n<pre><code>     using (var db = new ExerciseProgramManagerEntities())\n            {\n                var pMmemberId = new SqlParameter(\"@memberId\", senderId);                                    \n\n                var result  = db.ExecuteStoreQuery&lt;DynamicObject&gt;(\"select s.Id, s.StatusDate, s.StatusText, p.FirstName, p.LastName, p.Photo \"+\n \"from MemberStatus s join Profile p on s.SenderId = p.MemberID \" +\n \"where s.SenderId IN \"+\n \"(\"+\n\"select f.MemberID as id from Member_FriendRequest f where (f.FriendID = @memberId ) and f.Status=2 \"+\n\"union \"+\n\"select f.FriendID as id from Member_FriendRequest f where (f.MemberID=@memberId) and f.Status=2 \" +\n\"union \"+\n\"select @memberId)\", pMmemberId);\n</code></pre>\n\n<p>What's wrong in my query?</p>\n"},{"tags":["c#",".net","wpf","database","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13035850,"title":"Creating multiple copies of same database from a single Entity Framework","body":"<p>I am creating a shopping application, which has many branches with different names.</p>\n\n<p>I am using Entity Framework in my WPF project, I am able to create a single database from my entity model.</p>\n\n<p>If my entity name is <code>JIMS</code>, a database with name <code>JIMS</code> is created. But I also want to create a new database in SQL Server using the same Entity Framework model with a different name for a different branch.</p>\n\n<p>So that the user can select the branch and there will be a separate database for it?</p>\n"},{"tags":["database","entity-framework","entity-framework-4",".net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13033880,"title":"One-way updates of columns using EntityFramework","body":"<p>EntityFramework 4.3.1.</p>\n\n<p>What is the best way to have calculated properties which should be stored in db, but are not intended to be retrieved from db?\nE.g.</p>\n\n<pre><code>    [Column(\"SOME_COLUMN\")]\n    public ulong SomeColumn\n    {\n        get { return /*calculate here*/; }\n    }\n</code></pre>\n\n<p>I want the value to be persisted when I'm saving to db. But of course - not getting updated when I load from db. I can have an empty setter alongside... But it doesn't seem to work when the column is Key.</p>\n\n<p>Can I have such a Key-column?</p>\n\n<p>Now I'm getting this error:</p>\n\n<p><strong>EntityFramework error: The value of a property that is part of an object's key does not match the corresponding property value stored in the ObjectContext. This can occur if properties that are part of the key return inconsistent or incorrect values or if DetectChanges is not called after changes are made to a property that is part of the key.</strong></p>\n"},{"tags":["c#","entity-framework","generics","reflection"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":765,"score":3,"question_id":6323765,"title":"Build an object from another object in C# using generic code","body":"<p>Let's say I have an object of Type User that looks like this:  </p>\n\n<pre><code>User {\n   Name = \"Bob\",\n   Email = \"Bob@gmail.com\",\n   Class = NULL\n}\n</code></pre>\n\n<p>Can anyone think of a way to take that object and create an object like this:</p>\n\n<pre><code>User {\n   Name = \"Bob\",\n   Email = \"Bob@gmail.com\"\n}\n</code></pre>\n\n<p>Using entirely generic code?  Meaning, I don't want to hard code anything to do with the Type, or the Properties because this code would need to be applied to every Entity on my site.  (the \"User\" type is an Entity by the way, so use that if it helps you code this better).  </p>\n\n<p>I'm just trying to come up with a solution to a problem I have and I BELIEVE that <a href=\"http://blogs.msdn.com/b/alexj/archive/2009/06/19/tip-26-how-to-avoid-database-queries-using-stub-entities.aspx\" rel=\"nofollow\">Stub Entities</a> may fix the problem, but I need to do it without hard coding any Types or Properties.</p>\n"},{"tags":["entity-framework","entity-framework-4","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13014150,"title":"Entity Framework - TPC - Override Primary Key Column Name","body":"<p>Here's my model:</p>\n\n<pre><code>public abstract class Entity\n{\n    public long Id { get; set; }\n}\n\npublic abstract class Audit : Entity\n{}\n\npublic class UserAudit : Audit\n{\n    public virtual User User { get; set; }\n}\n\npublic class User : Entity\n{}\n</code></pre>\n\n<p>Here's my DbContext:</p>\n\n<pre><code>public class TestDbContext : DbContext\n{\n    static TestDbContext()\n    {\n        Database.DefaultConnectionFactory = new SqlCeConnectionFactory(\"System.Data.SqlServerCe.4.0\");\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new AuditConfiguration());\n        modelBuilder.Configurations.Add(new UserAuditConfiguration());\n        modelBuilder.Configurations.Add(new UserConfiguration());\n    }\n}\n</code></pre>\n\n<p>And here's my mappings:</p>\n\n<pre><code>public abstract class EntityConfiguration&lt;T&gt; : EntityTypeConfiguration&lt;T&gt;\n    where T : Entity\n{\n    protected EntityConfiguration()\n    {\n        HasKey(t =&gt; t.Id);\n        Property(t =&gt; t.Id)\n            .HasColumnName(\"Key\");\n    }\n}\n\npublic class AuditConfiguration : EntityConfiguration&lt;Audit&gt;\n{}\n\npublic class UserAuditConfiguration : EntityTypeConfiguration&lt;UserAudit&gt;\n{\n    public UserAuditConfiguration()\n    {\n        Map(m =&gt;\n            {\n                m.MapInheritedProperties();\n                m.ToTable(\"UserAudits\");\n            });\n        HasRequired(u =&gt; u.User)\n            .WithMany()\n            .Map(m =&gt; m.MapKey(\"UserKey\"));\n    }\n}\n\npublic class UserConfiguration : EntityConfiguration&lt;User&gt;\n{}\n</code></pre>\n\n<p>When I try to generate a migration for this model, I get the following error:</p>\n\n<p>error 2010: The Column 'Id' specified as part of this MSL does not exist in MetadataWorkspace.</p>\n\n<p>If I comment out the \".HasColumnName\" call in the constructor of EntityConfiguration, the migration generates correctly (except of course that the column name is Id and not Key).</p>\n\n<p>Is TPC mappings supposed to support primary key columns that don't use the default column name?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12863470,"title":"Multi-target development of a Entity Framework based tool with legacy support","body":"<p>I am developing a (free, open-source) Entity Framework tool, it is basicaly an ADO.NET provider, but it uses some higher abstractions too (e.g. ObjectContext, EntityConnection). I want it to support almost all the legacy version of EF (EF4=&lt;). Until EF5 came out it was quite easy, because I had been able to develop it by targeting only .NET40. </p>\n\n<p>EF5 made the things more complicated, because some of the new features requires the .NET45 framework. On the other hand, EF5 supports .NET40 too. An on the top of that, EF is now developed independently from the .NET framework.</p>\n\n<p>For now, It is obvious that targeting both .NET40 and .NET45 is inevitable. But currently I have no idea what is the best way to setup a multi-target environment that can comply with the independently developed EF. I also haven't found any good document about this problem. </p>\n\n<p>Should I use multiple solution files? Multiple project files? Multiple solution configurations? Reference all version of EF somehow? Create an universal build script? If yes, how? How to run my unit test against different configurations? How to indicate that a test can/should fail in a specific configuration? What about the changed namespaces (e.g. ObjectContext)? Should I use #if directive to solve this conflict? What if a new EF release requires to implement a feature that will break the compatibilty with previous versions? I am really uncertain at this point.</p>\n"},{"tags":["c#","sql-server-2008","entity-framework","permissions"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13033458,"title":"Manage entity access and permissions with Entity Framework","body":"<p>In a web application using Entity Framework 4.1 we use SQL Server Membership to manage user access. However we need to implement a more granular set of roles a permission management.</p>\n\n<p>In the database we have already created the relative tables:</p>\n\n<pre><code>- Roles \n- Permissions \n- UserInRole (roles per user)\n- RolesPermissions (permissions associated to a role) \n</code></pre>\n\n<p>Using attributes on some of the core entities we restrict the access semantically with EF, as example, given a specific user, s/he can see only the relative shipped orders or inherent data.</p>\n\n<p>Now we would like to inject the permissions in it, meaning as example that a <em>customer</em> can see and create orders, while a <em>company</em> (these are two different roles) could only see orders for their products and also print reports.</p>\n\n<p>The idea would be to use attributes also for permissions at entity level and check if the current user owns proper rights when a method is invoked. For instance:</p>\n\n<pre><code>public void BeforeAdd()\n{\n   // Get required permissions for the specific entity (Order as example)\n\n   //Check that current user has permission of creating a new Order \n}\n</code></pre>\n\n<p>Such a method would be called by each entity, allowing to centralize the control over permissions at entity level.</p>\n\n<p>We use MVC as frontend and in there we have already implemented roles and permissions access. We need to make the same with the backend part (containing data layer). These are two separate servers communicating via web services. By implementing permission management on the back end part would strengthen the control over data access.</p>\n\n<p>Is there any pattern or best practice that we could follow (eventually using some built in features of EF) to achieve permissions management?</p>\n"},{"tags":["c#","entity-framework","mapping"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13031162,"title":"loading mapping table as an entity in entity framework","body":"<p>This is the latest entity framework with a code-first approach. \nOne customer can have multiple properties:</p>\n\n<pre><code>public class Customer\n{\n    [Key]\n    public int Id { get; set; }\n    public virtual List&lt;CustomerToPropertyMapping&gt; PropertyIds { get; set; }\n}   \n\n[Table(\"CustomerToProperty\")]\npublic class CustomerToPropertyMapping\n{\n    [Key, Column(Order = 1)]\n    public int PropertyId { get; set; }\n}\n</code></pre>\n\n<p>When I load the data, everything works fine. When I try to save a customer, I get</p>\n\n<blockquote>\n  <p>An error occurred while saving entities that do not expose foreign key\n  properties for their relationships. The EntityEntries property will\n  return null because a single entity cannot be identified as the source\n  of the exception. Handling of exceptions while saving can be made\n  easier by exposing foreign key properties in your entity types. See\n  the InnerException for details.</p>\n</blockquote>\n\n<p>The same happends even if I have </p>\n\n<pre><code>[Key, Column(Order = 0)]\nCustomerId \n</code></pre>\n\n<p>in the CustomerToPropertyMapping class.</p>\n\n<p>What is the correct way to retrieve the mappings and NOT the object it maps to?</p>\n"},{"tags":["entity-framework","wcf-data-services"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13032228,"title":"Keeping DB in sync with EF across projects","body":"<p>I am using model-first entity framework (edmx) to connect to my database across about 4 separate projects. </p>\n\n<p>Now, whenever I make a DB change I have to update the edmx for each project. I have considered creating a WCF Data Service, but I would still have to update the service reference in each project. </p>\n\n<p>Is there a better way to do this?</p>\n"},{"tags":["entity-framework","foreign-keys","entity-framework-4","associations","foreign-key-relationship"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":861,"score":5,"question_id":3714334,"title":"Having serious problems with Entity Framework & Foreign Keys :(","body":"<p>I've got the following entities on my EDMX :-\n<img src=\"http://i.stack.imgur.com/VtZ68.png\" alt=\"alt text\"></p>\n\n<p>These two entites were generated by <em>Update Model From Database</em>.</p>\n\n<p>Now, notice how my country has the following primary key :-</p>\n\n<p><strong>Name</strong> &amp; <strong>IsoCode</strong></p>\n\n<p>this is because each country is UNIQUE in the system by Name and IsoCode. </p>\n\n<p>Now, with my States ... it's similar. Primary Key is :-</p>\n\n<p><strong>Name</strong> &amp; <strong>CountryId</strong></p>\n\n<p>Each state is unique by name and per country.</p>\n\n<p>Now, the Foreign Key for States is a CountryId. This is the sql :-</p>\n\n<pre><code>ALTER TABLE [dbo].[States]  WITH CHECK ADD \n        CONSTRAINT [FK_States_Countries] FOREIGN KEY([CountryId])\nREFERENCES [dbo].[Countries] ([CountryId])\nON UPDATE CASCADE\nGO\n\nALTER TABLE [dbo].[States] CHECK CONSTRAINT [FK_States_Countries]\nGO\n</code></pre>\n\n<p>Pretty simple stuff.</p>\n\n<p>BUT EntityFramework doesn't like it :( It's assuming that i need to connect some properties from <code>State</code> entity to both primary key properties in the <code>Country</code> entity. </p>\n\n<p><strong>Is it possible to add an ASSOCIATION between Country and State on Country.CountryId &lt;-> State.CountryId ... like i have mapped in my DB ?</strong></p>\n\n<p>Cheers ;)</p>\n"},{"tags":["wpf","entity-framework","data-binding","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13027984,"title":"Refresh information gotten from navigation property EF","body":"<p>I have an Enity Model contains a UsersList entity associated to UserTasks with UserID. UserTasks is loaded in a DataGrid, I'm getting the UserName from UsersList using <code>NavigationProperty</code>. I've made a simple ChildWindow linked to the DataGrid's <code>SelectedItem</code> to edit selected task including the user (which is my problem).</p>\n\n<p>when selecting another user from a ComboBox and other information, All are updating normally in the DataGrid except the user Name.</p>\n\n<p>I did debug to see if the UserTasks object got the new UserID, I found that it did.</p>\n\n<p>What's missing to get DataGrid refresh the task's user name ?</p>\n"},{"tags":["c#","entity-framework","wpfdatagrid"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13008472,"title":"Unable Save change to Context from DataGrid","body":"<p>Recently i install VS2012 and Try remake my old WPF project. In VS2010 that code work and all updated or new rows in Datagrid saved in DB via Entity Model. In VS2012 new rows not being added in Database.</p>\n\n<pre><code>    MyEntities context = new MyEntities();\n\n    public MainWindow()\n    {\n        InitializeComponent();\n\n    }\n\n    private void Button_Click_1(object sender, RoutedEventArgs e)\n    {\n        var selected = from row in context.Sources\n                       select row;\n        Datagrid.ItemsSource = selected.ToList();\n    }\n\n    private void Button_Click_2(object sender, RoutedEventArgs e)\n    {\n        context.SaveChanges();\n    }\n</code></pre>\n\n<p>Why is new rows not being added?</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":7219,"score":2,"question_id":6012638,"title":"Create DataContext from Entity Framework connection string?","body":"<p>I'm trying to make this call in my code:</p>\n\n<pre><code>string conn = ConfigurationManager.ConnectionStrings[\"MyDBEntities\"].ConnectionString;\nDataContext context = new DataContext(conn);\nTable&lt;MyApp.Entities.Employee&gt; myTable = context.GetTable&lt;MyApp.Entities.Employee&gt;();\n</code></pre>\n\n<p>Here's my connection strings:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n  &lt;add name=\"MyDBEntities\" connectionString=\"metadata=res://*/Entities.MyDB.csdl|res://*/Entities.MyDB.ssdl|res://*/Entities.MyDB.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=STEVEN-PC;Initial Catalog=MyDB;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;add name=\"MyDB\" connectionString=\"Server=STEVEN-PC;Database=MyDB;Trusted_Connection=yes;\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>I get an error when creating the DataContext: <strong>Keyword not supported: 'metadata'.</strong></p>\n\n<p>If I use the second connection string, I get an error when trying to get the table: <strong>Server Error in '/' Application.\nThe type 'MyApp.Entities.Employee' is not mapped as a Table.</strong></p>\n\n<p>What am I doing wrong here?</p>\n"},{"tags":["asp.net","entity-framework","asp.net-membership"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13027507,"title":"Add navigation property to Membership schema","body":"<p>I have an Entity Data Model for my Web Site that includes a table with some extra data for the registered users (called UserInfo). Currently, I'm setting the id of the new rows of UserInfo using the <code>Membership.GetUser(...).ProviderKey</code>.</p>\n\n<p>What I want to do is to add a navigation property to my UserInfo table to point to the corresponding Membership row for that user but, due I have not the Membership schema in my Entity Designer, I can't figure out how to stablish this link between the tables.</p>\n\n<p>Any idea?</p>\n\n<p>Thanks very much,</p>\n"},{"tags":[".net","entity-framework","linqpad"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13031103,"title":"When using Entity Framework with LinqPad or EFProviderWrapperToolkit, table valued functions have an incorrect SQL parameter type","body":"<p>My Entity Framework application uses several table-valued-functions to do full-text searches in SQL Server 2008.</p>\n\n<p>My function parameters are always <code>strings</code> that translate to <code>nvarchar(4000)</code> in the store side. Everything works fine.</p>\n\n<p>However, whenever I call the same functions from inside <code>LinqPad</code> or using a custom EF provider, specifically <a href=\"http://code.msdn.microsoft.com/EFProviderWrappers-c0b88f32/sourcecode?fileId=19054&amp;pathId=791898583\" rel=\"nofollow\">EFProviderWrapperToolkit</a>, the string parameters are passed in as <code>nvarchar(1)</code> which stops them from working.</p>\n\n<p>I'm specially concerned about the EFProviderWrapperToolkit because I wan't it to be used as my log layer.</p>\n\n<p>Is there any way I can work around this?</p>\n\n<p>I'm using <code>EF 4.2 2012 June CTP</code>, if you think that upgrading to <code>5.0</code> will help, I can give it a try. I did not yet because I think upgrading to <code>5.0</code> will force me to upgrade to <code>.NET 4.5 and VS 2012</code> which will cause a huge impact now as my product is in production.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I just checked and the string parameters have been automatically imported this way:</p>\n\n<pre><code>&lt;Parameter Name=\"aProcessoSimplesTerm\" Type=\"nvarchar\" Mode=\"In\" /&gt;\n</code></pre>\n\n<p>You see that there's no size specification. I didn't change it, it is the way it has been imported. </p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13031041,"title":"Does Entity Framework(EF5) support XML data type yet?","body":"<p>I am thinking of using the XML data type in SQL Server 2008 R2, but also using EF with MVC. Does EF5 support the XML data type? If not then I will have to opt for a different DB design.</p>\n\n<p>Many thanks.</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13030960,"title":"multiply join in dynamic linq","body":"<p>im trying to join those tables i have to use dynamic linq,\n   it`s working fine if  the <strong>.Join(dbcontext.Providers)</strong> has and returning data \nwhen i dont have data on the  <strong>.Join(dbcontext.Providers)</strong> the all <strong>queryResolts</strong> returnig 0 results</p>\n\n<p>how can i get data even if one of the join returning 0 results</p>\n\n<pre><code>var queryResolts = dbcontext.Tracks\n            // Add Services\n            .Join(dbcontext.Services,\n                track =&gt; track.ServiceId,\n                service =&gt; service.ServiceId,\n                (track, service) =&gt; new { Track = track, Service = service })\n            // Add ServiceInterfaces\n            .Join(dbcontext.ServiceInterfaces,\n                ts =&gt; ts.Track.ServiceInterfaceId,\n                serviceInterface =&gt; serviceInterface.ServiceInterfaceId,\n                (ts, serviceInterface) =&gt; new { Track = ts.Track, Service = ts.Service, ServiceInterfaces = serviceInterface })\n            // Add Providers\n            .Join(dbcontext.Providers,\n                tss =&gt; tss.Track.ProviderId,\n                provider =&gt; provider.ProviderId,\n                (tss, provider) =&gt; new { Track = tss.Track, Service = tss.Service, ServiceInterfaces = tss.ServiceInterfaces, Providers = provider })\n            .Where(\"ServiceInterfaces.ServiceInterfaceName == @0\", \"PublishPolicyInterface2\")\n            .Select(y =&gt; y.Track) \n\n            ;\n</code></pre>\n\n<p>thanks</p>\n\n<p>miki</p>\n"},{"tags":["c#","entity-framework","assemblies","partial","edmx"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13030638,"title":"Partial class and edmx","body":"<p>My <code>edmx</code> file generate some <code>partial</code> classes. I want extend functionality adding one property, but <code>edmx</code> file is in another assembly. In this case they are like two unrelated classes. </p>\n\n<p>How can I solve this?</p>\n"},{"tags":["c#",".net","entity-framework","c#-4.0","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13030073,"title":"How to paginate data from child object in EF?","body":"<p>I have a problem.</p>\n\n<p>I want to paginate <code>ClassA</code>.</p>\n\n<p><code>ClassA</code> has a list of elements of type <code>ClassB</code>, and <code>ClassB</code> has a list of element of type <code>ClassC</code>. </p>\n\n<p><strong>How can I paginate data by the number of elements from <code>ClassC</code>?</strong></p>\n\n<pre><code>public class ClassA\n{\n    public ICollection&lt;ClassB&gt; ClassBCollection { get; set; }\n}\n\npublic class ClassB\n{\n    public ICollection&lt;ClassA&gt; ClassACollection { get; set; }\n\n    public ICollection&lt;ClassC&gt; ClassCCollection { get; set; }\n}\n\npublic class ClassC\n{\n    public ICollection&lt;ClassB&gt; ClassBCollection { get; set; }\n}\n</code></pre>\n\n<p><strong>ClassA</strong> &nbsp;| <strong>ClassB</strong>   &nbsp; | <strong>ClassC</strong> <br/>\nData1  | InnerData | InnerInnerData1 <br/>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| InnerInnerData2 <br/>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| InnerInnerData3 <br/>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| InnerInnerData4 <br/>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| InnerInnerData5 (Paginate here) <br/></p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#",".net","wpf","entity-framework","datagrid"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12266367,"title":"Save Extra Infromation after editing DataGrid","body":"<p>I have a <code>DataGrid</code> with a <code>DataGridCheckBoxColumn</code> and others.  The <code>DataGrid ItemSource</code> is mapped to a <code>ObservableCollection</code> that contains rows of <code>Tasks</code>. The Task class includes properties like <code>\"ID\", \"IsScheduled\", \"IsScheduled_Date\", \"IsScheduled_EditorID\", Etc.</code>  I am trying to figure how to make the one <code>DataGridCheckBoxColumn</code> field (<code>IsScheduled</code>) also save the date (<code>IsScheduled_Date</code>) and who made the change (<code>IsScheduled_EditorID</code>) when checked.</p>\n\n<p>(1) I have tried to make this save the extra data using multibinding, but my efforts have so far failed.  You can see follow my progress with solving a similar issue <a href=\"http://stackoverflow.com/questions/12073597/\">Here</a>.</p>\n\n<p>(2) I have tried having the <code>DataGrid</code> <code>CellEditEnding</code> event save the extra data but it ended up committing the extra data before the IsScheduled data was committed and caused troubles whenever the row and/or cell edit was canceled.</p>\n\n<p>(3) I have tried listening to the property change event in my Task class and assigning the additional changes there.  This seemed to work fine until I realized that when the data was first loaded it cause a change event that overwrote any earlier changes.</p>\n\n<h3>Added Information</h3>\n\n<hr>\n\n<p>The <code>Task</code> class is an <code>Entity Framework Class</code> that was generated from a DB. I was listening to the <code>OnIscheduledChanged</code> event and making the necessary changes because when I did it in the generated class it was always overwritten.</p>\n\n<h3>More Info</h3>\n\n<hr>\n\n<p>There seems to be some confusion about the Task class.  As I stated it is generated by the Entity Framework and a breakpoint shows the setters being called on load... Overwriting the change.  Not to mention any custom code being overwritten everytime the code regenerates.</p>\n\n<blockquote>\n<pre><code>    /// &lt;summary&gt;\n    /// No Metadata Documentation available.\n    /// &lt;/summary&gt;\n    [EdmScalarPropertyAttribute(EntityKeyProperty=false, IsNullable=false)]\n    [DataMemberAttribute()]\n    public global::System.Boolean IsScheduled\n    {\n        get\n        {\n            return _IsScheduled;\n        }\n        set\n        {\n            OnIsScheduledChanging(value);\n            ReportPropertyChanging(\"IsScheduled\");\n            _IsScheduled = StructuralObject.SetValidValue(value);\n            ReportPropertyChanged(\"IsScheduled\");\n            OnIsScheduledChanged();\n        }\n    }\n    private global::System.Boolean _IsScheduled;\n    partial void OnIsScheduledChanging(global::System.Boolean value);\n    partial void OnIsScheduledChanged();\n</code></pre>\n</blockquote>\n\n<p>Any Ideas?</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13028915,"title":"Is it possible to merge two sets of entities in EF 4.0?","body":"<p>at the moment I am writing an application that uses Entity Framework 4.0 as ORM and synchronises with some third party application using an WebService that receives some XML structure.</p>\n\n<p>Now this XML structure contains an object \"order\". Each order can have multiple \"lines\". The WebService get's invoked by the third party application everytime it changes the \"order\", for example when a user added and removed some lines and then \"updated\" the respective entity.</p>\n\n<p>Now I want to merge the \"new\" set of lines with the old one, so that new lines get added to my EF entity, old lines get removed and the other lines get updated.</p>\n\n<p>Is this possible?</p>\n\n<p>Update 1:</p>\n\n<p>My XML structure looks like this:</p>\n\n<pre><code>&lt;Order DocumentNumber=\"200\"&gt;\n  &lt;Description&gt;Test&lt;/Description&gt;\n  &lt;!-- Some more elements --&gt;\n  &lt;Lines Count=\"2\"&gt;\n    &lt;Line ID=\"0\"&gt;\n      &lt;Item&gt;A0000&lt;/Item&gt;\n      &lt;Warehouse&gt;123&lt;/Warehouse&gt;\n      &lt;Order&gt;200&lt;/Order&gt;\n      &lt;!-- ... --&gt;\n    &lt;/Line&gt;\n    &lt;Line ID=\"1\"&gt;\n      &lt;Item&gt;A0001&lt;/Item&gt;\n      &lt;Warehouse&gt;123&lt;/Warehouse&gt;\n      &lt;Order&gt;200&lt;/Order&gt;\n    &lt;/Line&gt;\n  &lt;/Lines&gt;\n&lt;/Order&gt;\n</code></pre>\n\n<p>The structure get's deserialized using the IXmlSerializeable interface:</p>\n\n<pre><code>public partial class Order : IXmlSerializeable\n{\n    // ...\n}\n</code></pre>\n\n<p>The class Order expands the object generated by EF (model first). The object generated by EF looks like this:</p>\n\n<pre><code>public partial class Order\n{\n    public Order()\n    {\n        this.Lines = new HashSet&lt;DocumentLine&gt;();\n    }\n\n    public int DocumentNumber;\n\n    public virtual ICollection&lt;DocumentLine&gt; Lines { get; set; }\n}\n</code></pre>\n\n<p>I think it is not worth mention the design of the DocumentLine object. If it is, than just ask for it :)</p>\n\n<p>The method ReadXml looks like this:</p>\n\n<pre><code>public void ReadXml(System.Xml.XmlReader reader)\n{\n    this.DocumentNumber = Convert.ToInt32(reader.GetAttribute(\"DocumentNumber\"));\n\n    // TODO: Deserialize DocumentLines and merge them with existing one's\n    // ...\n}\n</code></pre>\n\n<p>If the order get's inserted there is no problem. Generating a new Order instance results in an empty set of DocumentLines - each line of the XML structure will get inserted.</p>\n\n<p>But when I want to update an order I need to \"replace\" the old one with the new one. I was thinking about loading the existing entity and call the deserialization routine of it's object's instance. But then I need to merge the order's lines :-)</p>\n\n<p>Thanks in advance!</p>\n\n<p>Update 2:</p>\n\n<p>My current solution looks something like this:</p>\n\n<pre><code>private void DeserializePlannedItems(System.Xml.XmlReader Reader)\n{\n    // Create a Buffer for the lines that get parsed.\n    var linesBuffer = new Dictionary&lt;int, DocumentLine&gt;();\n\n    if (Reader.ReadToDescendant(\"Line\"))\n    {\n        do\n        {\n            // Read the current line\n            var currentLineReader = Reader.ReadSubtree();\n            int lineID = Convert.ToInt32(currentLineReader.GetAttribute(\"ID\"));\n\n            // Request the line from the existing ones.\n            var line = (from lines in this.Lines\n                        where lines.ID == lineID\n                        select lines).FirstOrDefault();\n\n            // In case the line does not exist create a new one and add it to the respective collection.\n            if (line == null)\n            {\n                line = new DocumentLine();\n                this.Lines.Add(line);\n            }\n\n            // Deserialisation.\n            line.ReadXml(currentLineReader);\n\n            // Add the line to the buffer\n            linesBuffer.Add(line.ID, line);\n        } while (Reader.ReadToNextSibling(\"Line\"));\n    }\n\n    // Remove all lines that are not inside the buffer.\n    var linesToDelete = (from lines in this.Lines\n                         where !linesBuffer.ContainsKey(lines.ID)\n                         select lines).ToList();\n\n    foreach (var lineToDelete in linesToDelete)\n        this.Lines.Remove(lineToDelete);\n}\n</code></pre>\n\n<p>The method handles one line and get's called for each line inside the XML structure. But I think it is not very handy and it would be cool if there's a way to merge two sets of entities, like I asked above - this would simplify my method!</p>\n\n<p>Thanks again :)</p>\n"},{"tags":["entity-framework","asp.net-mvc-4","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13020609,"title":"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key in EF5","body":"<p>using in EF5 and asp.Mvc4</p>\n\n<p>what I try to do is  to edit a responsable (current responsable ) activo  if the activo it in another responsable (previous responsable) , the previous responsable having that activo  will change the end date for the inicial date of the current responsable  to release this Activo, and then edit the current responsable (and erase the accesorios of the previos responsable)</p>\n\n<pre><code>//get the current responsable \n\nvar responsable = Mapper.Map&lt;ResponsableViewModel, Responsable&gt;(responsableViewModel);\n\n\n var responsable_anterior = Mis(r =&gt; r.Responsables).FirstOrDefault(r =&gt; r.ResponsableId == responsableViewModel.AnteriorResponsableId);\n\nresponsable_anterior.Fin = responsableViewModel.Inicio;\nvar responsable_anterior_accesorios =responsable_anterior.ResponsableAccesorios.Where(r =&gt; r.MarcaBaja == null).ToList(); \n\nforeach (var item in responsable_anterior_accesorios )\n{\n    item.MarcaBaja = DateTime.Now;\n//save the previous accecorios\n     Vmsb.Entry(item).State = EntityState.Modified;\n}\n//save the previous responsable\n                            Vmsb.Entry(responsable_anterior).State = EntityState.Modified;\n//Detach the previous responsable\n                            Vmsb.Detach(responsable_anterior);\n\n//save the current responsable\n Vmsb.Entry(responsable).State = EntityState.Modified;\n</code></pre>\n\n<p>and I get this error message I can't understand why I try Vmsb.Entry(responsable_anterior).CurrentValues.SetValues(model); but doesnt work for me</p>\n\n<p>An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key.</p>\n"},{"tags":["c#","entity-framework","entity","relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13029030,"title":"entity framework 4.0: changing relationship entity in the main entity also overwrites ID of the main entity","body":"<p>I got an entity \"LICENSE\" that contains some relationsships, including three 1..* relationships.\nI'm working on a GUI + Manager to allow to edit the entity and save it again, later.\nWhen I call the save event on a button I overwrite the properties and relationships of my pre loaded entity I'm editing by reading the values from my controls.</p>\n\n<p>I'm changing three relationships by loading the new selected entity with the same ObjectContext and overwrite the relationship itself. in 2 of 3 cases it works perfectly. even in the last case, the relationship is changed (another entity is stored) successful and the saving process could be done very well. However, in the third case there is a weird behaviour I don't understand neither know how to fix it:</p>\n\n<p>When I change the entity of the relationship, it overwrites the ID of my LICENSE object, that makes no sense at all.</p>\n\n<p>Here is the code:</p>\n\n<p>GUI:</p>\n\n<pre><code>private LICENSE lizenz { get; set; } // in the load event, this object will be filled correctly\n\nprivate string form2obj() // this method is getting called in my button save event\n{\n    //...\n    // I removed some conditions (they all successed on testing, so believe my controls are set right on testing this\n    this.lizenz.ADRESSE_KONTAKTE_Lieferant = LizenzManager.LoadContact(Convert.ToInt32(this.ddLieferantAnsp.SelectedValue)); // ADRESSE_KONTAKTE_Lieferant is a 1..* relationship, this.ddLieferantAnsp.SelectedValue contains the ID of the object I want to load into the relationship\n    this.lizenz.ADRESSE_KONTAKTE_Betreiber = LizenzManager.LoadContact(Convert.ToInt32(this.ddBetreiberAnsp.SelectedValue)); // ADRESSE_KONTAKTE_Betreiber is a 1..* relationship, this.ddBetreiberAnsp.SelectedValue contains the ID of the object I want to load into the relationship\n    this.lizenz.DB_TYPES = LizenzManager.LoadDatabaseType(Convert.ToInt32(this.ddDatenbanktyp.SelectedValue)); // DB_TYPES is a 1..* relationship, too, this.ddDatenbanktyp.SelectedValue contains the ID of the object I want to load into the relationship\n    // last line overwrites this.lizenz.ID with the value of Convert.ToInt32(this.ddDatenbanktyp.SelectedValue), this is wrong\n    //...\n}\n</code></pre>\n\n<p>BLL (LizenzManager):</p>\n\n<pre><code>// context is the same ObjectContext in all three calls!\n//...\npublic static ADRESSE_KONTAKTE LoadContact(int id)\n{\n    return context.ADRESSE_KONTAKTE.Where(x =&gt; x.ID == id).Single(); // this seems to success\n}\n\npublic static DB_TYPES LoadDatabaseType(int id)\n{\n    return context.DB_TYPES.Where(x =&gt; x.ID == id).Single(); // this works, but it overwrites the ID of my LICENSE object I load this into ...\n}\n//...\n</code></pre>\n\n<p>As you see, the loading ways are pretty much the same, both tables got the ID column, but the last relation overwrites this.lizenz.ID with the ID of the DB_TYPES entity I load.</p>\n\n<p>Could you explain me, how to fix this issue?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":46,"score":3,"question_id":13028142,"title":"EntityFramework Migrations - Seeding per Build Configuration","body":"<p>I am using EntityFramework 5 with Code First Migrations.  What I want to be able to do is specify different Seed data depending on the Build Configuration.  For example:</p>\n\n<pre><code>protected override void Seed(EFDbContext context)\n{\n    // This will be run in every Build configuration\n    context.Table1.AddOrUpdate(new Table1 { Field1 = \"Foo\", Field2 = \"Bar\" });\n\n    #if DEBUG\n    // This will only be executed if we are Debuging\n    context.Table1.AddOrUpdate(new Table1 { Field1 = \"Blah\", Field2 = \"De Blah\" });\n    context.Table2.AddOrUpdate(new Table2 { Field1 = \"Development Only\" });\n}\n</code></pre>\n\n<p>I know the code is probably wrong, I can figure out the correct method call once I know the best route to take for doing this.</p>\n\n<p>Does EF have any built in method I have missed for doing this kind of thing?</p>\n\n<p>Thanks</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>The code I used in the end was:</p>\n\n<pre><code>protected override void Seed(EFDbContext context)\n{\n    // This will be run in every Build configuration\n    context.Table1.AddOrUpdate(t = t.Field1, new Table1 { Field1 = \"Foo\", Field2 = \"Bar\" });\n\n    #if DEBUG\n        // This will only be executed if we are Debuging\n        context.Table1.AddOrUpdate(t = t.Field2, new Table1 { Field1 = \"Blah\", Field2 = \"De Blah\" });\n        context.Table2.AddOrUpdate(t = t.Field1, new Table2 { Field1 = \"Development Only\" });\n    #endif\n}\n</code></pre>\n\n<p>It was as Yannick said, but in the AddOrUpdate method, you need to pass in the field that EF will use to establish if it is a new entry.  Not part of my question, but thought I should provide the correct method for future reference.</p>\n"},{"tags":["c#","entity-framework","ef-code-first","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":92,"score":3,"question_id":13004219,"title":"Can an Entity Be Associated By More Than 1 Entity?","body":"<p>So let's assume I have the following entities and their context configuration set up as follows. I have omitted a lot of properties for brevity's sake:</p>\n\n<pre><code>public class Company {\n    public int Id { get; set; }\n    public Location Location { get; set; }\n}\n\npublic class Customer {\n    public int Id { get; set; }\n    public Location Location { get; set; }\n}\n\npublic class Location {\n    public int Id { get; set; }\n}\n\npublic sealed class EntityDefaultContext : DbContext {\n    protected override void OnModelCreating(DbModelBuilder modelBuilder) {\n        modelBuilder.Entity&lt;Company&gt;().HasKey(m =&gt; m.Id).ToTable(\"Company\");\n        modelBuilder.Entity&lt;Company&gt;().Property(m =&gt; m.Id).HasColumnName(\"Id\");\n        modelBuilder.Entity&lt;Company&gt;().HasRequired(m =&gt; m.Location).WithRequiredDependent().Map(m =&gt; m.MapKey(\"LocationId\"));\n\n        modelBuilder.Entity&lt;Customer&gt;().HasKey(m =&gt; m.Id).ToTable(\"Customer\");\n        modelBuilder.Entity&lt;Customer&gt;().Property(m =&gt; m.Id).HasColumnName(\"Id\");\n        modelBuilder.Entity&lt;Customer&gt;().HasRequired(m =&gt; m.Location).WithRequiredDependent().Map(m =&gt; m.MapKey(\"LocationId\"));\n\n        modelBuilder.Entity&lt;Location&gt;().HasKey(m =&gt; m.Id).ToTable(\"Location\");\n        modelBuilder.Entity&lt;Location&gt;().Property(m =&gt; m.Id).HasColumnName(\"Id\");\n    }\n}\n</code></pre>\n\n<p>So as you can see, both the Company and Customer entities hold a reference to the Location entity. Something that would normally be expected I believe.</p>\n\n<p>I set up my DB context for just that as you can also see. But the SQL that EF generates is terribly inefficient:</p>\n\n<pre><code>SELECT \n    [Extent1].[Id] AS [Id], \n    [Extent1].[LocationId] AS [LocationId], \n    [Extent3].[Id] AS [Id1]\nFROM\n    [dbo].[Customer] AS [Extent1]\nLEFT OUTER JOIN [dbo].[Company] AS [Extent2] ON [Extent1].[LocationId] = [Extent2].[LocationId]\nLEFT OUTER JOIN [dbo].[Company] AS [Extent3] ON [Extent1].[LocationId] = [Extent3].[LocationId]\nLEFT OUTER JOIN [dbo].[Company] AS [Extent4] ON [Extent1].[LocationId] = [Extent4].[LocationId]\n</code></pre>\n\n<p>This is generated when I do something like this:</p>\n\n<pre><code>var q = from c in defaultContext.Set&lt;Customer&gt;().Include(m =&gt; m.Location)\n        select c;\n</code></pre>\n\n<p>I am doing it like this for reasons that are not relevant to the question. The weird thing is that here is the SQL if I only configure the Location entity to be associated by only the Customer entity:</p>\n\n<pre><code>SELECT \n    [Extent1].[Id] AS [Id], \n    [Extent1].[LocationId] AS [LocationId]\nFROM\n    [dbo].[Customer] AS [Extent1]\nINNER JOIN [dbo].[Location] AS [Extent2] ON [Extent1].[LocationId] = [Extent2].[Id]\n</code></pre>\n\n<p>Which is what I would expect. This makes me think. Does EF not support this scenario? How could it not?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13027675,"title":"objectcontext.savechanges() Add two Item","body":"<p>Ok , consider this :</p>\n\n<pre><code>Entities _context = new Entities();\n\nUser user = _context.Users.Last();\n\nuser.Logs.Add(new Log());\n\n//user has one log item\n\n_context.SaveChanges();\n\n//after calling _context.SaveChanges() , user has two log items .\n</code></pre>\n\n<p>As I commented  , after call to _context.SaveChanges() , two item added to user object , So two object would be displayed on my bounded control for example datagrid . What's wrong ?</p>\n\n<p>Thanks for your answers.</p>\n"},{"tags":["entity-framework","visual-studio-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":407,"score":0,"question_id":10926313,"title":"how do you update an ADO.NET entity data model when the database tables structure has been modified in vs11","body":"<p>I am creating ado.net entity frameworks from table from by database. Because i am ina early stage i need to chnage the table structure quite often to add or remove fields.</p>\n\n<p>how do you update an ADO.NET entity data model when the database tables structure has been modified in vs11</p>\n"},{"tags":["sql-server","xml","entity-framework","database-design","entity-attribute-value"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13026351,"title":"Database Design to persist changing wizard/workflow data?","body":"<p>I need to create a wizard type web application to acquire data for a report. There are multiple sections so multiple wizard workflows. In addition a workflow could change ie a step could be added.</p>\n\n<p>I am considering the best database design, and started with a traditional \"ER design\" with explicit column names as is always recommended. I have been researching EAV with interest . However I now realise that I do have a problem with an explicit design when a workflow can change. So my current thinking is</p>\n\n<p>1) EAV with the use of Views (with \"instead of\" trigger for updates)\n2) Simply persist each step dataset as XML.</p>\n\n<p>Both present query issues, but I guess 1) is better although one could do string querying on XML using \"Like\" etc.</p>\n\n<p>I am also using MVC 3 and EF5, and would wish to leverage their facilities as much as possible and not \"fight\" the technology.</p>\n\n<p>I may also need to use some form of XML config file to help setup the razor view with the correct controls/layout.</p>\n\n<p>I would really appreciate some wisdom on the above. </p>\n\n<p>Many thanks.</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13025406,"title":"Inserting record instead of updating","body":"<p>I am developing an MVC app.</p>\n\n<p>When I try to updated record it showing error of DBEntityValidation exception,\n( beacuse its trying to add record in DB. This is my code) </p>\n\n<pre><code>public JsonResult SavePassword(int EmpId, string Password)\n    {\n        try\n        {\n\n\n        Employee e1 = db.Employees.First(i =&gt; i.Id == EmpId);\n        db.Entry(e1).State = EntityState.Modified;\n        e1.Password = Password;\n        db.SaveChanges();\n\n\n        return Json(EmpId);\n\n        }\n\n\n        catch (DbEntityValidationException e)\n        {\n            foreach (var eve in e.EntityValidationErrors)\n            {\n                Console.WriteLine(\"Entity of type \\\"{0}\\\" in state \\\"{1}\\\" has the following validation errors:\",\n                  eve.Entry.Entity.GetType().Name, eve.Entry.State);\n                foreach (var ve in eve.ValidationErrors)\n                {\n                    Console.WriteLine(\"- Property: \\\"{0}\\\", Error: \\\"{1}\\\"\", ve.PropertyName, ve.ErrorMessage);\n                }\n            }\n             throw;\n        }\n\n\n    }\n</code></pre>\n\n<p>In exception, it shows that validation msgs, which I have checked while adding new record.\nSo , I think its trying to add in DB insted of updating.</p>\n"},{"tags":["entity-framework","batch-processing","entity-framework-5"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":164,"score":0,"question_id":12751258,"title":"Batch update/delete EF5","body":"<p>What is the best way to deal with batch updates using (Entity Framework) EF5?\nI have 2 particular cases I'm interested in:</p>\n\n<ol>\n<li><p>Updating a field (e.g. UpdateDate)  for a list (List) of between 100 and 100.000  Id's, which the primary key. Calling each update separately seem to be to much overhead and takes a long time.</p></li>\n<li><p>Inserting many, also between the 100 and 100.000, of the same objects (e.g. Users) in a single go.</p></li>\n</ol>\n\n<p>Any good advice?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13019840,"title":"entity framework no PK's on tables","body":"<p>I'm using VS2012 and creating a sample Entity Framework project that reads and writes to some tables that are used for import purposes.   and do not have PK's or FK's in them - just null/notnull on the columns.</p>\n\n<p>Can/should EF be made to insert records on these tables without that cryptic error:</p>\n\n<blockquote>\n  <p><em>Unable to update the EntitySet because it has a DefiningQuery\n  and no  element exists in the\n   element to support the current\n  operation.</em></p>\n</blockquote>\n\n<p>Or should I be looking elsewhere for database I/O?</p>\n\n<p>Thanks!\nCorey.</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13022918,"title":"How to cancel DbSet.Add in EF5","body":"<p>All, Say you have some code like below. I want to know If It didn't run the <code>db.savechanges()</code>, Is it necessary to write some code to Cancel <code>db.DeployPackages.Add(package)</code> commonly?</p>\n\n<pre><code>HotDeployDbContext db = null;\n\n    using (db = new HotDeployDbContext())\n    {\n        DeployPackage package = new DeployPackage();\n        db.DeployPackages.Add(package);\n\n        //determine if save package to db based on some condition.\n        if (.....)\n        {\n            db.SaveChanges();\n        }\n        else\n        {\n            //how to cancel the db.DeployPackages.Add(package);\n        }\n    }\n</code></pre>\n\n<p><strong>Edited</strong></p>\n\n<p>Sometimes we do lot of things in one <code>Dbcontext</code>, like add data to multiple table. delete some data or update data . but what if we do need to cancel these before run <code>SaveChanges</code> based on some business condition? How can I make this .Thanks.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","iis","publish"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":198,"score":0,"question_id":11010131,"title":"Publish MVC 3.0 Site in IIS 7.0","body":"<p>I program website with MVC 3.0 which uses EntityFrame work 4.0, In controller layer I Have this:<br/></p>\n\n<pre><code>  public ViewResult Index()\n    {\n     return View(_DatabaseSMSEntities.People.ToList());\n    }\n</code></pre>\n\n<p>And in View Layer I used Telerik Grid:</p>\n\n<pre><code>&lt;% Html.Telerik().Grid&lt;ProjectWebsite.Models.People&gt;(Model)\n                    .Name(\"People\")\n                    .Columns(columns =&gt;\n                    {\n                        columns.Bound(o =&gt; o.PersonID).Format(\n                         \"&lt;a href='../WebPage/PersonSMSPage.aspx?personID=\" + \"{0}\" + @\"' &lt;br/&gt;runat=\"\"server\"\"&gt;\" +\n                         \"&lt;img src='../../Content/themes/base/images/RegisterSMS.png' &lt;br/&gt;alt='{0}' /&gt;\"&lt;br/&gt;\n                        );                                           \n\n                    })\n                    .RowAction(row =&gt;\n                    {\n                        if (row.Index == 0)\n                        { row.DetailRow.Expanded = false; }\n                    })                   \n                     .Render();%&gt;\n</code></pre>\n\n<p>I published it in IIS 7.0. But it does not work. </p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"ApplicationServices\" connectionString=\"data source=.\\SQLEXPRESS;Integrated Security=SSPI;AttachDBFilename=|DataDirectory|aspnetdb.mdf;User Instance=true\" providerName=\"System.Data.SqlClient\" /&gt;\n    &lt;add name=\"DatabaseSMSEntities\" connectionString=\"metadata=res://*/Models.ModelDatabaseSMS.csdl|res://*/Models.ModelDatabaseSMS.ssdl|res://*/Models.ModelDatabaseSMS.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQLEXPRESS;AttachDbFilename=|DataDirectory|\\DatabaseSMS.mdf;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n    &lt;add name=\"cn1\" connectionString=\"data source=~/ErrorsLog/Errors.db\" /&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>First, I  published it in D:\\Pardis, But I got error:</p>\n\n<pre><code>   CREATE DATABASE permission denied in database 'master'.\n    An attempt to attach an auto-named database for file D:\\Pardis\\App_Data\\DatabaseSMS.mdf failed. A database with the same name\nexists, or specified file cannot be opened, or it is located on UNC share.\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.Data.SqlClient.SqlException: CREATE DATABASE permission denied in database 'master'.\nAn attempt to attach an auto-named database for file D:\\Pardis\\App_Data\\DatabaseSMS.mdf failed. A database with the same name exists, or specified file cannot be opened, or it is located on UNC share.\n\nSource Error: \n\n\nLine 20:         public ViewResult Index()\nLine 21:         {\nLine 22:             return View(_DatabaseSMSEntities.People.ToList());\nLine 23:         }\nLine 24: \n</code></pre>\n\n<p>Then, I published it in Inetup but I got error.\nI do not have ASPNET user in user list to set security.</p>\n"},{"tags":["entity-framework","linq-to-entities","exists"],"answer_count":5,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":11961,"score":10,"question_id":1802286,"title":"Best way to check if object exists in Entity Framework?","body":"<p>What is the best way to check if an object exists in the database from a performance point of view? I'm using Entity Framework 1.0 (ASP.NET 3.5 SP1).</p>\n"},{"tags":["entity-framework","windows-8"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":13006980,"title":"Entity Framework and windows.winmd","body":"<p>I m developing an Windows 8 application (not Windows store app) using .Net 4 and EF.\nEverything is working fine until i want to add the Windows.winmd reference. I got the following exception :</p>\n\n<pre><code>System.Data.DataException occurred\n  HResult=-2146233087\n  Message=An exception occurred while initializing the database. See the InnerException for details.\n  Source=EntityFramework\n  StackTrace:\n       at System.Data.Entity.Internal.InternalContext.PerformInitializationAction(Action action)\n       at System.Data.Entity.Internal.InternalContext.PerformDatabaseInitialization()\n       at System.Data.Entity.Internal.LazyInternalContext.&lt;InitializeDatabase&gt;b__4(InternalContext c)\n       at System.Data.Entity.Internal.RetryAction`1.PerformAction(TInput input)\n       at System.Data.Entity.Internal.LazyInternalContext.InitializeDatabaseAction(Action`1 action)\n       at System.Data.Entity.Internal.LazyInternalContext.InitializeDatabase()\n       at System.Data.Entity.Internal.InternalContext.Initialize()\n       at System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType)\n       at System.Data.Entity.Internal.Linq.InternalSet`1.Initialize()\n       at System.Data.Entity.Internal.Linq.InternalSet`1.get_InternalContext()\n       at System.Data.Entity.Infrastructure.DbQuery`1.System.Linq.IQueryable.get_Provider()\n       at System.Linq.Queryable.OrderBy[TSource,TKey](IQueryable`1 source, Expression`1 keySelector)\n       at Yawd.Dal.Dal.getIncludeFolders() in c:\\Users\\Jeff\\Documents\\Visual Studio 2010\\Projects\\Yawd.old\\Yawd\\Dal\\Dal.cs:line 170\n  InnerException: System.Data.EntityCommandCompilationException\n       HResult=-2146232005\n       Message=An error occurred while preparing the command definition. See the inner exception for details.\n       Source=System.Data.Entity\n       StackTrace:\n            at System.Data.EntityClient.EntityCommandDefinition..ctor(DbProviderFactory storeProviderFactory, DbCommandTree commandTree)\n            at System.Data.EntityClient.EntityProviderServices.CreateCommandDefinition(DbProviderFactory storeProviderFactory, DbCommandTree commandTree)\n            at System.Data.EntityClient.EntityProviderServices.CreateDbCommandDefinition(DbProviderManifest providerManifest, DbCommandTree commandTree)\n            at System.Data.Common.DbProviderServices.CreateCommandDefinition(DbCommandTree commandTree)\n            at System.Data.Objects.Internal.ObjectQueryExecutionPlan.Prepare(ObjectContext context, DbQueryCommandTree tree, Type elementType, MergeOption mergeOption, Span span, ReadOnlyCollection`1 compiledQueryParameters, AliasGenerator aliasGenerator)\n            at System.Data.Objects.ELinq.ELinqQueryState.GetExecutionPlan(Nullable`1 forMergeOption)\n            at System.Data.Objects.ObjectQuery`1.GetResults(Nullable`1 forMergeOption)\n            at System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable&lt;T&gt;.GetEnumerator()\n            at System.Linq.Enumerable.FirstOrDefault[TSource](IEnumerable`1 source)\n            at System.Data.Objects.ELinq.ObjectQueryProvider.&lt;GetElementFunction&gt;b__1[TResult](IEnumerable`1 sequence)\n            at System.Data.Objects.ELinq.ObjectQueryProvider.ExecuteSingle[TResult](IEnumerable`1 query, Expression queryRoot)\n            at System.Data.Objects.ELinq.ObjectQueryProvider.System.Linq.IQueryProvider.Execute[S](Expression expression)\n            at System.Data.Entity.Internal.Linq.DbQueryProvider.Execute[TResult](Expression expression)\n            at System.Linq.Queryable.FirstOrDefault[TSource](IQueryable`1 source)\n            at System.Data.Entity.Internal.EdmMetadataRepository.QueryForModelHash(Func`2 createContext)\n            at System.Data.Entity.Internal.InternalContext.QueryForModelHash()\n            at System.Data.Entity.Internal.ModelCompatibilityChecker.CompatibleWithModel(InternalContext internalContext, ModelHashCalculator modelHashCalculator, Boolean throwIfNoMetadata)\n            at System.Data.Entity.Internal.InternalContext.CompatibleWithModel(Boolean throwIfNoMetadata)\n            at System.Data.Entity.Database.CompatibleWithModel(Boolean throwIfNoMetadata)\n            at System.Data.Entity.CreateDatabaseIfNotExists`1.InitializeDatabase(TContext context)\n            at System.Data.Entity.Internal.InternalContext.&lt;&gt;c__DisplayClass8.&lt;PerformDatabaseInitialization&gt;b__6()\n            at System.Data.Entity.Internal.InternalContext.PerformInitializationAction(Action action)\n       InnerException: System.IO.FileLoadException\n            HResult=-2146233067\n            Message=Could not load file or assembly 'Windows, Version=255.255.255.255, Culture=neutral, PublicKeyToken=null, ContentType=WindowsRuntime' or one of its dependencies. Operation is not supported. (Exception from HRESULT: 0x80131515)\n            Source=mscorlib\n            FileName=Windows, Version=255.255.255.255, Culture=neutral, PublicKeyToken=null, ContentType=WindowsRuntime\n            FusionLog=\"\"\n            StackTrace:\n                 at System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks)\n                 at System.Reflection.RuntimeAssembly.nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks)\n                 at System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, Evidence assemblySecurity, RuntimeAssembly reqAssembly, StackCrawlMark&amp; stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks)\n                 at System.Reflection.Assembly.Load(AssemblyName assemblyRef)\n                 at System.Data.Metadata.Edm.MetadataAssemblyHelper.SafeLoadReferencedAssembly(AssemblyName assemblyName)\n                 at System.Data.Metadata.Edm.MetadataAssemblyHelper.&lt;GetNonSystemReferencedAssemblies&gt;d__0.MoveNext()\n                 at System.Data.Metadata.Edm.ObjectItemCollection.ImplicitLoadViewsFromAllReferencedAssemblies(Assembly assembly)\n                 at System.Data.Mapping.StorageMappingItemCollection.ViewDictionary.SerializedCollectViewsFromReferencedAssemblies(MetadataWorkspace workspace, Dictionary`2 extentMappingViews)\n                 at System.Data.Mapping.StorageMappingItemCollection.ViewDictionary.SerializedGetGeneratedViews(EntityContainer container)\n                 at System.Data.Common.Utils.Memoizer`2.&lt;&gt;c__DisplayClass2.&lt;Evaluate&gt;b__0()\n                 at System.Data.Common.Utils.Memoizer`2.Result.GetValue()\n                 at System.Data.Common.Utils.Memoizer`2.Evaluate(TArg arg)\n                 at System.Data.Mapping.StorageMappingItemCollection.ViewDictionary.GetGeneratedView(EntitySetBase extent, MetadataWorkspace workspace, StorageMappingItemCollection storageMappingItemCollection)\n                 at System.Data.Metadata.Edm.MetadataWorkspace.GetGeneratedView(EntitySetBase extent)\n                 at System.Data.Query.PlanCompiler.PreProcessor.ExpandView(Node node, ScanTableOp scanTableOp, IsOfOp&amp; typeFilter)\n                 at System.Data.Query.PlanCompiler.PreProcessor.ProcessScanTable(Node scanTableNode, ScanTableOp scanTableOp, IsOfOp&amp; typeFilter)\n                 at System.Data.Query.PlanCompiler.PreProcessor.Visit(ScanTableOp op, Node n)\n                 at System.Data.Query.InternalTrees.ScanTableOp.Accept[TResultType](BasicOpVisitorOfT`1 v, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.VisitNode(Node n)\n                 at System.Data.Query.PlanCompiler.SubqueryTrackingVisitor.VisitChildren(Node n)\n                 at System.Data.Query.PlanCompiler.SubqueryTrackingVisitor.VisitRelOpDefault(RelOp op, Node n)\n                 at System.Data.Query.PlanCompiler.PreProcessor.Visit(ProjectOp op, Node n)\n                 at System.Data.Query.InternalTrees.ProjectOp.Accept[TResultType](BasicOpVisitorOfT`1 v, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.VisitNode(Node n)\n                 at System.Data.Query.PlanCompiler.SubqueryTrackingVisitor.VisitChildren(Node n)\n                 at System.Data.Query.PlanCompiler.SubqueryTrackingVisitor.VisitRelOpDefault(RelOp op, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.VisitSortOp(SortBaseOp op, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.Visit(ConstrainedSortOp op, Node n)\n                 at System.Data.Query.InternalTrees.ConstrainedSortOp.Accept[TResultType](BasicOpVisitorOfT`1 v, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.VisitNode(Node n)\n                 at System.Data.Query.PlanCompiler.SubqueryTrackingVisitor.VisitChildren(Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfNode.VisitDefault(Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfNode.VisitPhysicalOpDefault(PhysicalOp op, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.Visit(PhysicalProjectOp op, Node n)\n                 at System.Data.Query.InternalTrees.PhysicalProjectOp.Accept[TResultType](BasicOpVisitorOfT`1 v, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.VisitNode(Node n)\n                 at System.Data.Query.PlanCompiler.PreProcessor.Process(Dictionary`2&amp; tvfResultKeys)\n                 at System.Data.Query.PlanCompiler.PreProcessor.Process(PlanCompiler planCompilerState, StructuredTypeInfo&amp; typeInfo, Dictionary`2&amp; tvfResultKeys)\n                 at System.Data.Query.PlanCompiler.PlanCompiler.Compile(List`1&amp; providerCommands, ColumnMap&amp; resultColumnMap, Int32&amp; columnCount, Set`1&amp; entitySets)\n                 at System.Data.EntityClient.EntityCommandDefinition..ctor(DbProviderFactory storeProviderFactory, DbCommandTree commandTree)\n            InnerException: \n</code></pre>\n\n<p>If i remove the reference eveything is working fine.\nIf i don't use EF but only Windows.winmd everything is working fine too, but i can't use both in same app. </p>\n\n<p>Any clue on this ?</p>\n\n<p>Thanks for your time.</p>\n\n<p>Jeff</p>\n"},{"tags":["linq","entity-framework","design-patterns"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12999789,"title":"Entity Framework, LINQ and patterns","body":"<p>I've started using EF and LINQ in a project and I'm trying to decide on the best approach/pattern to use. Until now I've been using a custom persistence framework that was based on DataSets and XML configuration. Basically it was a VS Custom Tool that would read the XML configuration file and the DataSets and would generate Object Oriented classes with all the necessary properties/associations/methods. This auto-generated classes then were used from the UI and I had the flexibility to expose only what the UI would need.</p>\n\n<p>Now with EF and LINQ, I'm not comfortable with the idea that the UI can use directly the auto-generated classes and all the LINQ stuff. It seems that this approach would have a very tight integration between UI and the database.</p>\n\n<p>So I'm looking for some pattern that would \"hide\" all the EF and LINQ goodies and basically limit what the UI can do. Is there any standard way to do this?</p>\n"},{"tags":["entity-framework","views","ef-model-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13020114,"title":"entity framework model update performed -autogenerated code not updated","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12734333/entity-framework-5-update-model-from-database-does-not-generate-table-class\">Entity Framework 5 update model from database does not generate table class</a>  </p>\n</blockquote>\n\n\n\n<p>Answer: Thanks Pawel for the link:\nThere is a bug in VS2012 - edmx in nested folder doesnt update generated code: <a href=\"http://entityframework.codeplex.com/workitem/453\" rel=\"nofollow\">entityframework.codeplex.com/workitem/453</a> </p>\n\n<p>Workarounds:\n- Right click on .tt file and select \"Run Custom Tool\"\n- Drag .edmx out of the nested folder</p>\n\n<hr>\n\n<p>Using EF 5.0 and VS2012 - I am trying to update my model with some new views I added.  The intention is that these views only need to be read-only - so they don't need to be updateable.  I attempted to update my model from the db, selected the views I wanted to add, and continued.</p>\n\n<p>I've verified that the entity shows up in the edmx file, and that the defining query is not commented.  I can see the views in the designer, however, the auto-generated partial class definitions for the views I am adding are never created (none added under the *.tt) - so I can't query these view entities from the context object.</p>\n\n<p>I created a new entity model from scratch, and the view models are created as expected.  Am I missing a step somewhere?  I could drop\\recreate my model, but this isn't really a feasible solution long term as new views are added.</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4.1"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13020769,"title":"In EF 4, can a subset of columns be represented by a class in .NET","body":"<p>Let's say I have the following tables setup in SQL Server (2008)</p>\n\n<p><img src=\"http://i.stack.imgur.com/R4VFE.png\" alt=\"\"></p>\n\n<p>Is there a way to generate the EDMX such that in my project Height, Weight and Age are properties of a public non entity class called <code>Characteristics</code> and that in code, I can address them as</p>\n\n<pre><code>ABoy.Characteristics.Height\nABoy.Characteristics.Weight\nABoy.Characteristics.Age\n\nAGirl.Characteristics.Height\nAGirl.Characteristics.Weight\nAGirl.Characteristics.Age\n</code></pre>\n\n<p>I want to do this, because in my actual case, there other methods on my Characteristic class.\nI do not want a common table, because Characteristic need not necessarily be tracked by EF unless they are added to a BOY or GIRL class.</p>\n\n<p><strong>EDIT:</strong> Writing this down made me realize that I could just have a partial class with a Characteristic type exposed for BOY and GIRL and it would just return an object of type Characteristic. I would also have a tracker to always return the same object per instance of BOY or GIRL and to update it if a modification came in.\nI'll leave this open for other suggestions.</p>\n"},{"tags":["c#","sql","linq","entity-framework","linq-to-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":130,"score":0,"question_id":13012545,"title":"How to execute nested query in Linq","body":"<p>I have a LINQ class of this format in C#:</p>\n\n<pre><code>class Vehicle\n{\n  int _VehicleID\n  int _ModelID\n\n  EntetySet&lt;Cars&gt; _AllCars\n  EntetySet&lt;Bus&gt; _AllBus\n  EntetyRef&lt;Driver&gt; _Person\n}\n</code></pre>\n\n<p><strong>Cars table</strong></p>\n\n<pre><code>CarsID | Manufacturer | Type\n1000   | Honda        | Diesel\n1001   | Mitsubishi   | Petrol\n1002   | Maruti       | Diesel\n</code></pre>\n\n<p><strong>Bus table</strong></p>\n\n<pre><code>BusID | Manufacturer | Type\n2000  | Volvo        | Diesel\n2001  | TATA         | Petrol\n2002  | layland      | Petrol\n</code></pre>\n\n<p>From the UI, I will get a Vehicle ID as a parameter. Based on that, all the cars, Bus and its associated tables will get copied to a variable. That is:</p>\n\n<pre><code>Vehicle v1 = new Vehicle();\nv1 = dc.vehicle.where(v =&gt; v.vehicleID == param.vehicleID).findfirst();\n</code></pre>\n\n<p>My <code>v1</code> has all the table and its contents which satisfies the above condition. </p>\n\n<p>Now, I want to filter some more based on the table content present in table cars and bus; i.e based on type of vehicle petrol or diesel.</p>\n\n<p>If I want to copy all the petrol cars and Buses using a query statement in a single line, please tell me the way.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","entity-framework","webmethod"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13017964,"title":"Trying to .Include a navigation property when using a return value on a webmethod","body":"<p>So I am trying to have a web method return an object which has a 1 to many relationship in EF. I am expecting the XML to build child nodes for each item in the many relationship, but it appears that the only relationships being populated are the ones going back up, not the ones going down. Here's my code.</p>\n\n<pre><code>[WebMethod]\npublic Question GetCurrentQuestion(int TeamID)\n{\n    var db = new DSG_pepsicenter_stagingEntities();\n    return db.Questions.Include(\"QuestionAnswers\").First(n =&gt; n.TeamID == TeamID);\n}\n</code></pre>\n\n<p>Basically my Questions table belongs to a team, and has many Question Answers. However, the Question Answers  are not present in the serialization that happens in the web method. Is there a way to force this? I know if I force it I risk an error with circular references but this is preferred to building a DTO. Thanks!</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","localization","string-similarity"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":86,"score":5,"question_id":13019140,"title":"Recognizing similarity in strings","body":"<p>I'm working on a system which allows imported files to be localized into other languages. </p>\n\n<p>This is mostly a private project to get the hang of MVC3, EntityFramework, LINQ, etcetera. Therefore I like doing some crazy things to spice up the end result, one of those things would be the recognition of similar strings.</p>\n\n<p>Imagine you have the following list of strings - borrowed from a game I've worked with in the past:</p>\n\n<ul>\n<li>Megabeth: Holy Roller Uniform - Includes Head, Torso, and Legs</li>\n<li>Megabeth: Holy Roller Uniform Head</li>\n<li>Megabeth: Holy Roller Uniform Legs</li>\n<li>Megabeth: Holy Roller Uniform Torso</li>\n<li>Megabeth: PAX East 2012 Uniform - Includes Head, Torso, and Legs</li>\n<li>Megabeth: PAX East 2012 Uniform Head</li>\n<li>Megabeth: PAX East 2012 Uniform Legs</li>\n<li>Megabeth: PAX East 2012 Uniform Torso</li>\n</ul>\n\n<p>As you can see, once users have translated the first 4 strings, the following 4 share a lot of similarities, in this case:</p>\n\n<ul>\n<li>Megabeth</li>\n<li>Uniform</li>\n<li>Includes Head, Torso, and Legs</li>\n<li>Head</li>\n<li>Legs</li>\n<li>Torso</li>\n</ul>\n\n<p>Consider the first 4 strings are indeed already translated, when a user selects the 5th string from the list, what kind of algorithm or technique can I use to show the user the 1st string (and potentially others) under a sub-header of \"Similar strings\"?</p>\n\n<p>Edit - A little comment on the Levenshtein Distance:\nI'm currently targeting 10k strings in the database. Levenshtein Distance compares string per string, so in this case 10k x (10k -1) possible combinations. How would I approach this in a feasible way? Is there a better solution that this particular algorithm?</p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":13014802,"title":"EF stored procedure with dynamic number of columns in result set","body":"<p>At first I should note that I'm new in ASP.NET (however, I have some experience with C#) and Entity Framework. I work on a school project and there is quite complicated database containing energy consumption data. Those I need (<code>I</code> import, <code>E</code> export, reactive power <code>C</code> and <code>L</code>) are stored in one column as binary compressed so to get them out I have to use a stored procedure which calls some methods in custom assembly to decompress the column and restore the data.</p>\n\n<p>The stored procedure has 4 arguments:</p>\n\n<pre><code>@identify int,\n@startTime datetime,\n@endTime datetime,\n@args nvarchar(60) -- \"Selector\"\n</code></pre>\n\n<p>The <code>selector</code> is rather special, it's an argument where you specify what you want in the result set, e.g. <code>'i'</code> for Import column only, <code>'i,e'</code> for Import and Export. They designed it like this because it's faster if you need just one column rather then all columns (because of the way the compressed data are stored).</p>\n\n<p>So, I've created an ADO.NET Entity Model called <code>EnergyConsumptionDBModel</code>, imported the stored procedure and created complex type <code>EnergyConsumptionResult</code> for the stored procedure return type as follows:</p>\n\n<pre><code>public partial class EnergyConsumptionResult\n{\n    public System.DateTime Time { get; set; }\n    public double I { get; set; }\n    public double E { get; set; }\n    public double L { get; set; }\n    public double C { get; set; }\n}\n</code></pre>\n\n<p>The column <code>Time</code> is always present in the result set, but the rest depends on the <code>@args</code> argument of the stored procedure. For example if I pick <code>'i,e,c,l'</code> as an argument, it will return columns <code>Time, I, E, C, L</code> and everything is just fine but if I pick for example <code>'i'</code> it returns <code>Time, I</code> which gives me an exception:</p>\n\n<blockquote>\n  <p><em>The data reader is incompatible with the specified 'EnergyConsumptionDBModel.EnergyConsumptionResult'.</em><br>\n  <em>A member of the type, 'E', does not have a corresponding column in the data reader with the same name.</em></p>\n</blockquote>\n\n<p>So the question is, is there some simple way to solve this? Some kind of dynamic result mapping on complex type or is it much more simple to tell my colleague who designed the stored procedure to make it return all columns whatever is in <code>@args</code> but leave the un-used columns empty which is a solution my project leader may not like. Thanks for any help.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13017777,"title":"Design considerations for using EF objects in ASP.net MVC","body":"<p>I am using EF code first in one of my mvc 3 projects. I have a question about what patterns to use when passing a complex EF POCO object to and from the views.</p>\n\n<p>For example, a customer object has a list of orders and each order has a list of items.  The customer object will be sent to the view. The view updates the customer object and its inside objects (orders, items), then send it back the controller. The controller have EF to persist the customer object. </p>\n\n<p>My questions are following:</p>\n\n<ol>\n<li><p>Should I serialize the EF poco object to a JSON object so I can use it inside the view?</p></li>\n<li><p>How can I re-construct the customer object when I recieve updates from view?</p></li>\n<li><p>After the customer object is reconstructed, Is it possible to save the entire object graph (customer, orders, items) in one shot?</p></li>\n</ol>\n\n<p>Thanks</p>\n"},{"tags":["c#","json","entity-framework","entity-framework-4","json.net"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":37,"score":4,"question_id":13017360,"title":"Setting individual entity properties based on list of entity properties","body":"<p>I have an intermediary object between my Entity Framework entities and a JSON object that I serialize/deserialize in order to import and export to a text file.</p>\n\n<p>When I am exporting from the entity framework I use the following code to iterate through the entity types properties...If the property in the entity matches the property from an enum that I have, the property gets saved to the JSON object.  This stops entity specific properties from cluttering up my JSON.</p>\n\n<pre><code>var blockProperties = typeof(FixedLengthBlock).GetProperties(BindingFlags.Public | BindingFlags.Instance);\nforeach (var property in blockProperties)\n{\n\n    if (Enum.GetNames(typeof(ModuleSettingEnum)).Contains(property.Name.ToLower()) &amp;&amp; property.GetValue((FixedLengthBlock)element, null) != null)\n        blockJsonEntity.Properties.Add(property.Name, property.GetValue((FixedLengthBlock)element, null).ToString());\n}\n</code></pre>\n\n<p>While the above code works, I cannot think of a similar way to do the opposite.  When reading back from JSON I have the properties/values in a dictionary.  I know that I can run through the properties of the EF Entity and search the dictionary if it contains a key like this:</p>\n\n<pre><code>var blockProperties = typeof(FixedLengthBlock).GetProperties(BindingFlags.Public | BindingFlags.Instance);\nforeach (var property in blockProperties)\n{\n        if (block.Properties.ContainsKey(property.Name))\n   {\n     ???????What goes here??????\n   }\n}\n</code></pre>\n\n<p>How do I get the matched property into the newly created entity I've made to receive the information.  I'd really like to avoid a large switch statement.</p>\n\n<p>My Json object looks like this:</p>\n\n<pre><code>public class JsonEntity\n{\n    public string Name { get; set; }\n    public string Type { get; set; }\n    public Dictionary&lt;string, string&gt; Properties { get; set; }\n    public List&lt;JsonEntity&gt; SubEntities { get; set; } \n\n    public JsonEntity()\n    {\n        Properties = new Dictionary&lt;string, string&gt;();\n\n    }\n}\n</code></pre>\n"},{"tags":["mysql","entity-framework","entity"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1891,"score":4,"question_id":1902523,"title":"Entity Framework - MySQL - Datetime format issue","body":"<p>I have a simple table with few date fields.</p>\n\n<p>Whenever I run following query:</p>\n\n<pre><code>var docs = ( from d in base.EntityDataContext.document_reviews\nselect d ).ToList();\n</code></pre>\n\n<p>I get following exception:</p>\n\n<pre><code>Unable to convert MySQL date/time value to System.DateTime. \nMySql.Data.Types.MySqlConversionException: Unable to convert MySQL date/time value to System.DateTime\n</code></pre>\n\n<p>The document reviews table has two date/time fields. One of them is nullable.</p>\n\n<p>I have tried placing following in connection string:</p>\n\n<pre><code>Allow Zero Datetime=true;\n</code></pre>\n\n<p>But I am still getting exception.</p>\n\n<p>Anyone with a solution?</p>\n"},{"tags":["linq","entity-framework","linq-to-entities","iqueryable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13016811,"title":"IQueryable Where integer property expression usage?","body":"<p>So I have a query I'm constructing using Entity Framework, LINQ. Depending on the search parameter, and the type of the parameter being searched. </p>\n\n<p>I have created a function like this:</p>\n\n<pre><code>public static IQueryable&lt;T&gt; WhereInt&lt;T&gt;(this IQueryable&lt;T&gt; query, string propertyName, string contains)\n        {\n            var parameter = Expression.Parameter(typeof(T), \"type\");\n            var propertyExpression = Expression.Property(parameter, propertyName);\n\n            MethodInfo method = typeof(string).GetMethod(\"First\");\n            var someValue = Expression.Constant(contains, typeof(string));\n            var containsExpression = Expression.Call(propertyExpression, method, someValue);\n\n            return query.Where(Expression.Lambda&lt;Func&lt;T, bool&gt;&gt;(containsExpression, parameter));\n\n        }\n</code></pre>\n\n<p>Used as such:</p>\n\n<pre><code>WhereInt(DCs, searchfield, search);\n</code></pre>\n\n<p><code>searchfield</code> could be userid, username, integer or string, and ideally I want to do:</p>\n\n<pre><code>searchfield.value == search.toInt32()\n</code></pre>\n\n<p>sort of feature.</p>\n\n<p>I want to also make <code>DateTime</code> types searchable too. Maybe I'll make a <code>WhereDateTime</code> for that.</p>\n\n<p>I get an error on <code>var containsExpression = Expression.Call(propertyExpression, method, someValue);</code></p>\n\n<p>This works fine with strings, but fails with the error:</p>\n\n<pre><code>Value cannot be null.\nParameter name: method\n</code></pre>\n"},{"tags":["c#","sql-server","wcf","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":96,"score":4,"question_id":12999591,"title":"Better way to call a stored procedure using Entity Framework and return restfully from WCF?","body":"<p>I want to create a WCF service that calls a stored procedure in SQL Server using the Entity Framework and returns the result set to a browser.</p>\n\n<p>I imported the stored procedure using the function import in EF and I built a complex type. </p>\n\n<p>It seems that a complex type from the EF cannot be serialized and returned restfully. The only way I have made this work is to create a concrete class and build it from the complex type returned from EF. This works but it means if I have 30 stored procedures I would need to create 30 concrete classes which is somewhat of a pain.  </p>\n\n<p>Is there a better way to do this?</p>\n\n<p>WCF contract:</p>\n\n<pre><code>[ServiceContract]\npublic interface IService1\n{\n    [OperationContract,WebGet,XmlSerializerFormat]\n    List&lt;People&gt; usp_GetPeople();    \n}\n</code></pre>\n\n<p>Concrete class would need to be created for every procedure:</p>\n\n<pre><code>public class People\n{\n    public int person_id;\n    public string last_name;\n    public string first_name;\n    public string street_addr;\n    public string state_code;\n    public string postal_code;\n\n    public People(int person_id, string last_name, string first_name, string street_addr, string state_code, string postal_code)\n    {\n        this.person_id = person_id;\n        this.last_name = last_name;\n        this.street_addr = street_addr;\n        this.state_code = state_code;\n        this.postal_code = postal_code;\n    }\n\n    public People() { }\n}\n</code></pre>\n\n<p>WCF service:</p>\n\n<pre><code>public class Service1 : IService1\n{\n/// &lt;summary&gt;\n/// Call stored proc and return resultset.\n/// &lt;/summary&gt;\n/// &lt;returns&gt;List of resultset as concrete class People.&lt;/returns&gt;\npublic List&lt;People&gt; usp_GetPeople()\n{\n    try\n    {\n        using (var db = new demoEntities())\n        {\n            var res = db.usp_GetPeople();\n\n            List&lt;People&gt; lst = new List&lt;People&gt;();\n\n            foreach (usp_GetPeople_Result r in res)\n            {\n                People p = new People(r.person_id, r.last_name, r.first_name, r.street_addr, r.state_code, r.postal_code);\n                lst.Add(p);\n            }\n\n            return lst;\n        }\n    }\n    catch (Exception e)\n    {\n        Utility.Log(\"Error in usp_GetPeople. \" + e.ToString());\n        return null;\n    }\n}\n</code></pre>\n"},{"tags":["linq","entity-framework","include"],"answer_count":3,"favorite_count":5,"up_vote_count":14,"down_vote_count":0,"view_count":16581,"score":14,"question_id":3356541,"title":"Entity framework linq query Include() multiple children entities","body":"<p>This may be a really elementry question but whats a nice way to include multiple children entities when writing a query that spans THREE levels (or more)?</p>\n\n<p>i.e. I have 4 tables: <code>Company</code>, <code>Employee</code>, <code>Employee_Car</code> and <code>Employee_Country</code></p>\n\n<p>Company has a 1:m relationship with Employee.</p>\n\n<p>Employee has a 1:m relationship with both Employee_Car and Employee_Country.</p>\n\n<p>If i want to write a query that returns the data from all 4 the tables, I am currently writing:</p>\n\n<pre><code>Company company = context.Companies\n                         .Include(\"Employee.Employee_Car\")\n                         .Include(\"Employee.Employee_Country\")\n                         .FirstOrDefault(c =&gt; c.Id == companyID);\n</code></pre>\n\n<p>There has to be a more elegant way! This is long winded and generates horrendous SQL</p>\n\n<p>I am using EF4 with VS 2010</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#","entity-framework","wcf-data-services","odata","dataservice"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":75,"score":0,"question_id":13015816,"title":"WCF Data Client does not send entity properties values","body":"<p>When i try to send an instance of MULTIMEDIA type, with</p>\n\n<pre><code>hasStream=\"true\"\n</code></pre>\n\n<p>property set to true, the WCF Data Server seems not to receive entity data.</p>\n\n<p>On the client side i iterate over a collection of objects and i try to send them to another wcf data service. The reference to the \"other wcf data service\" is:</p>\n\n<pre><code>this.centralCtx\n</code></pre>\n\n<p>Also i set the saved stream for the each new entity and initialize all properties copying them from the source entity:</p>\n\n<pre><code>foreach (LOCAL_TYPE localObject in localObjects)\n{\n  if (entityName == \"MULTIMEDIA\")\n       {\n           CentralService.ARTICOLI article = null;\n           CentralService.MULTIMEDIA multimedia = new CentralService.MULTIMEDIA();\n           LocalService.MULTIMEDIA lMultimedia = localObject as LocalService.MULTIMEDIA;\n           multimedia.ID_MULTIMEDIA = lMultimedia.ID_MULTIMEDIA;\n           multimedia.DATA_CREAZIONE = lMultimedia.DATA_CREAZIONE;\n           multimedia.DATA_ULTIMA_MODIFICA = lMultimedia.DATA_ULTIMA_MODIFICA;\n           multimedia.ARTICOLO_ID = lMultimedia.ARTICOLO_ID;\n\n           this.centralCtx.TryGetEntity(\n           new Uri(this.centralCtx.BaseUri + \"ARTICOLI('\" + multimedia.ARTICOLO_ID \n           + \"')\", UriKind.Absolute), out article);\n\n           article.MULTIMEDIA.Add(multimedia);\n           this.centralCtx.AddRelatedObject(article, \"MULTIMEDIA\", multimedia);\n           DataServiceStreamResponse streamResponse = this.localCtx.GetReadStream(localObject);\n           this.centralCtx.SetSaveStream(multimedia, streamResponse.Stream, \n                      true, \"image/jpeg\", \"\");\n           //this.centralCtx.UpdateObject(article);\n        }\n        else {\n          CENTRAL_TYPE cloned = DbHelper.FlatCloneFromType&lt;LOCAL_TYPE, CENTRAL_TYPE&gt;\n                                     (localObject, centralCtx);\n          this.centralCtx.AddObject(entityName, cloned);\n        }\n      }\n\n      try\n      {\n         this.centralCtx.SaveChanges();\n         Notify(progressAction, \"Exported table \" + entityName, null);\n         successAction(this.Log);\n      }\n      catch (Exception ex)\n      {\n         Notify(progressAction, \"Error exporting table \" + entityName, ex);\n         this.synchResult = SynchResultType.Error;\n         exceptionAction(ex);\n      }\n</code></pre>\n\n<p>This is change interceptor code:</p>\n\n<pre><code>[ChangeInterceptor(\"MULTIMEDIA\")]\n    public void OnChangeMultimedia(MULTIMEDIA changedObject, UpdateOperations op)\n    {\n        switch (op)\n        {\n            case UpdateOperations.Add:\n                if(changedObject.ID_MULTIMEDIA == null)\n                    changedObject.ID_MULTIMEDIA = Guid.NewGuid().ToString();\n                changedObject.STATO_INTERNO = \"TRASFERITO\";\n                changedObject.DATA_ULTIMA_MODIFICA = changedObject.DATA_ULTIMA_MODIFICA == null\n                    ? DateTime.Now.ToLocalTime() : changedObject.DATA_ULTIMA_MODIFICA;\n                this.CurrentDataSource.SaveChanges();\n                break;\n            default: break;\n        }\n    }\n</code></pre>\n\n<p>All the properties of changedObject on the server inside MULTIMEDIA change interceptor are always null. Why???????????</p>\n"},{"tags":["asp.net","vb.net","entity-framework",".net-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":117,"score":4,"question_id":12991587,"title":"Setting values when a user updates a record using Entity Framework 4 and VB.NET in ASP.NET application","body":"<p>this is my first post, hopefully I'm following the rules!</p>\n\n<p>After a few weeks of banging my head against brick walls and endless hours of internet searches, I have decided I need to make my own post and hopefully find the answers and guidance from all you experts.</p>\n\n<p>I am building an ASP.NET application (in Visual Studio 2010) which uses an SQL 2008 database and Entity Framework 4 to join the two parts together.  I designed the database as a database project first, then built the Entity Model as a class project which is then referenced in the main ASP.NET project.  I believe this is called Database First in Entity Framwork terms?</p>\n\n<p>I'm fairly new to Web Apps (I mainly develop WinForms apps) and this is my first attempt at using Entity Framwork.</p>\n\n<p>I can just about understand C# so any code samples or snippets you might supply would be preferred in VB if possible.</p>\n\n<p>To give some background on where I am so far.  I built a regsitration page called register.aspx and created a wizard style form using ASP:Wizard with ASP:TextBox, ASP:DropdownList and ASP:CheckBoxList it's all laid out inside a HTML table and uses CSS for some of the formatting.  Once the user gets the the last page in the wizard and presses \"Finish\" I execute some code in the VB code behind file as follows:</p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>Protected Sub wizardRegister_FinishButtonClick(sender As Object, e As System.Web.UI.WebControls.WizardNavigationEventArgs) Handles wizardRegister.FinishButtonClick\n    Dim context As New CPMModel.CPMEntities\n    Dim person As New CPMModel.Person\n    Dim employee As New CPMModel.Employee\n\n    Dim newID As Guid = Guid.NewGuid\n\n    With person\n        .ID = newID\n        .UserID = txbx_UserName.Text\n        .Title = ddl_Title.SelectedValue\n        .FirstName = txbx_FirstName.Text\n        .MiddleInitial = txbx_MiddleInitial.Text\n        .FamilyName = txbx_FamilyName.Text\n        .Gender = ddl_Gender.SelectedValue\n        .DOB = txbx_DOB.Text\n        .RegistrationDate = Date.Now\n        .RegistrationMethod = \"W\"\n        .ContactMethodID = New Guid(ddl_ContactMethodList.SelectedValue)\n        .UserName = txbx_UserName.Text\n        If Not (My.Settings.AuthenticationUsingAD) Then\n            .Password = txbx_Password.Text ' [todo] write call to salted password hash function\n        End If\n        .IsRedundant = False\n        .IsLocked = False\n    End With\n\n    context.AddToPeople(person)\n\n    With employee\n        .ID = newID\n        .PayrollNumber = txbx_PayrollNumber.Text\n        .JobTitle = txbx_JobTitle.Text\n        .DepartmentID = ddl_DepartmentList.SelectedValue\n        .OfficeNumber = txbx_OfficeNumber.Text\n        .HomeNumber = txbx_HomeNumber.Text\n        .MobileNumber = txbx_MobileNumber.Text\n        .BleepNumber = txbx_BleepNumber.Text\n        .OfficeEmail = txbx_OfficeEmail.Text\n        .HomeEmail = txbx_HomeEmail.Text\n        .IsRedundant = False\n        .RedundantDate = Nothing\n\n         '--------------------------\n        .FiledBy = Threading.Thread.CurrentPrincipal.Identity.Name\n        .FiledLocation = My.Computer.Name\n        .FiledDateTimeStamp = Date.Now\n        '----------------------------\n    End With\n\n    context.AddToEmployees(employee)\n    context.SaveChanges()\nEnd Sub\n</code></pre>\n\n<p>The above works fine, seemed to be a sensible way of doing it (remember I'm new to Entity Framework) and gave me the results I extpected.</p>\n\n<p>I have another page called manage.aspx on this page is a tab control, each tab page contains a asp:DetailsView which is bound to an asp:EntityDataSource, I have enabled Update on all the Entity Data Sources and on some I have also enabled Insert, none of the have delete enabled.</p>\n\n<p>If I build and run the app at this stage everything works fine, you can press the \"edit\" link make changes and then press \"update\" and sure enough those updates are displayed on the screen instantly and the database does have the correct values in.</p>\n\n<p>Here's the problem, I need to intercept the update in the above code (the bold bit) notice there is a column in my database called FiledBy, FiledLocation, and FiledDateTimeStamp.  I don't want to show these columns to the user viewing the ASP.NET page but I want to update them when the user presses update (if there were any changes made).  I have tried converting the ASP:DetailsView into a template and then coding the HTML side with things like;</p>\n\n<pre><code>&lt;@# Eval(User.Name) #&gt;\n</code></pre>\n\n<p>I did manage to get it to put the correct values in the textboxes when in edit mode but I had the following problems;</p>\n\n<ol>\n<li>It didn't save to the database</li>\n<li>I have to show the textboxes which I don't want to do</li>\n</ol>\n\n<p>I have read on several other posts on here and other websites that you can override the SaveChanges part of the Entity Framwork model one example of this is in the code below;</p>\n\n<pre><code>public override int SaveChanges() \n{\nvar entities = ChangeTracker.Entries&lt;YourEntityType&gt;() \n                            .Where(e =&gt; e.State == EntityState.Added) \n                            .Select(e =&gt; e.Entity); \nvar currentDate = DateTime.Now; \nforeach(var entity in entities) \n{ \n    entity.Date = currentDate; \n} \n\nreturn base.SaveChanges(); \n} \n</code></pre>\n\n<p>The problem is, that whilst I understand the idea, and can just about transalate it to VB I have no idea how to implement this.  Where do I put the code?  How do I call the code? etc.</p>\n\n<p>I would ideally like to find a solution that meets the following requirements:</p>\n\n<ul>\n<li>Doesn't get overwritten if I was to regenerate / update the Entity Model</li>\n<li>Doesn't need to be copy and pasted for every table in my model (most but not all have the audit columns in)</li>\n<li>Can be used for other columns, for example, if a user make a selection in a check list I may want to write some value into another (not exposed to the user) column.</li>\n</ul>\n\n<p>Am I taking the right approach to displaying data in may webpages I certainly find the DataView and GridView limiting, I did think about creating a form like the registration form in table tags but have no Idea how to populate the textboxes etc with values from the database nor how to implement paging as many of the tables have one to many relationships, although saving changes would be easy if I did populate textboxes on a table.</p>\n\n<p>Thank you all in advance to anyone who offers there support.</p>\n\n<p>Kevin.</p>\n\n<p>Ok so I have now got closer, but still not got it working correctly.  I've used the following code to edit the value in the DetailsView on the Databound event.  If writes the correct timestamp into the read only textbox but does not right this value back to the database when you press the Update button on the DetailsView control.</p>\n\n<pre><code>Protected Sub dv_Employee_DataBound(sender As Object, e As EventArgs) Handles dv_Employee.DataBound\n    If dv_Employee.CurrentMode = DetailsViewMode.Edit Then\n        For Each row In dv_Employee.Rows\n            If row.Cells(0).Text = \"FiledDateTimeStamp\" Then\n                row.Cells(1).Text = Date.Now()\n            End If\n        Next\n    End If\nEnd Sub\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":13001441,"title":"Delete .mdf file from app_data causes exception cannot attach the file as database","body":"<p>I am building a web application using VS 2012 MVC4 code first. In order to recreate the <code>.mdf</code> file after I changed the model, I manually deleted the file from the app_data directory in VS. I have done this a few times before without any problem.</p>\n\n<p>Now I receive an exception: </p>\n\n<blockquote>\n  <p><em>The underlying provider failed on Open. ==> Cannot attach the file\n  <code>MYDB.mdf</code> as database <code>'MYDB'</code>.</em></p>\n</blockquote>\n\n<p>I will appreciate your help on how to recreate the <code>.mdf</code> file.</p>\n\n<p>Thank you!</p>\n"},{"tags":["wpf","entity-framework","visual-studio-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":231,"score":0,"question_id":12015311,"title":"Entity Framework With Visual Studio 2012 and WPF","body":"<p>I bought visual studio 2012, but I noticed that when I use WPF, connect a database with EF, it does not automatically create multiple classes in the data source to bind to Datagrid.  This is not the same behaviour as in Visual Studio 2010.</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","edmx"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13014819,"title":"edmx not taking defaults from DB","body":"<p>Here is my scenario. I have a SQL Server database that I am using as the backend. And my application is in ASP.net. I have defined defaults for 2 of the columns in the DB table, table name is <code>Car</code>.</p>\n\n<ol>\n<li>One of the columns in the <code>Car</code> table is called <code>Qty</code> and it's type is <code>Int</code>. I have set a default for this column in the database as 0 (zero)</li>\n<li>Another column in the <code>Car</code> table is called <code>Model</code> and it's type is <code>nvarchar(50)</code>. I have set a default for this column in the database as <code>*</code></li>\n</ol>\n\n<p>I want these defaults to show up in the edmx as well. My intention is that when I declare a new instance of class <code>Car</code> in code, I want the default value of <code>Qty</code> to show up as 0 (instead of null) and I want the default value of <code>Model</code> to show up as <code>*</code> (instead of null). </p>\n\n<p>So after doing quite a bit of reading I realized that I need to set <code>StoageGeneratedPattern = Computer</code> for both <code>Qty</code> and <code>Model</code> in the edmx file.</p>\n\n<p>It works perfectly for <code>Qty</code>. When I define a new instance of class <code>Car</code> and look at the properties, I see that <code>Qty</code> is 0. <strong>BUT</strong> for <code>Model</code>, the default is still <code>null</code> (instead of <code>*</code>). </p>\n\n<p>Here is what I have done. I have set <code>nullable = false</code> and <code>StorageGeneratedPattern = Computed</code>, in the CSDL content and in the SSDL content of the edmx file. I still can't seem to get <code>*</code> as the default value for <code>Model</code>. What am I missing here?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":13014872,"title":"Subtle difference in using object initialiser inline opposed to passing variable of one to EF Select","body":"<p>What's the difference between saving a Func as a variable and then passing it to a entity framework select opposed to typing the conversion inline inside of the select.</p>\n\n<pre><code>Func&lt;Models.Contact,ViewModels.Contact&gt; ToViewModel = \n    c =&gt; new ViewModels.Contact()\n    {\n        ID = c.ID,\n        ...\n        UserName = c.User.UserName\n    };\n\n...\n\nreturn dc.Contacts.Select(ToViewModel);\n</code></pre>\n\n<p>as opposed to</p>\n\n<pre><code>return dc.Contacts.Select(c =&gt; new ViewModels.Contact()\n{\n    ID = c.ID,\n    ...\n    UserName = c.User.UserName\n});\n</code></pre>\n\n<p>I ask this because although both methods work, they have subtly different reaction to nulls and a few other things and I can't understand why.</p>\n\n<p>For example in this case, a Contact may or may not have a User, so User may or may not be null. When typing the initialiser inline it will fail the property gracefully to null. However when passing the same initializer via the variable it will throw a NullReferenceException.</p>\n\n<p>Why is this?</p>\n\n<p>Note that the reason I want to save the initialiser is so that it can be reused in each of the CRUD operations for returning an object from a WebApi. It would be annoying to have to copy and paste the select around the class, especially if over time properties need to be added or removed from the response.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13012099,"title":"Entity Framework 5 code first newsequentialid() as PK","body":"<p>How can I use <code>newsequentialid()</code> as default value in the PK column?</p>\n\n<p>I have this annotation:</p>\n\n<pre><code>[Key, DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n</code></pre>\n\n<p>But this will generate random guid's I would like to have sequential guid's.</p>\n\n<p>I can set by hand the database to <code>newsequentialid()</code> as default value, but is there no better option? Or did the EF team forget about this option?</p>\n"},{"tags":["c#","entity-framework","linq-to-entities","count"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13012472,"title":"Group and Count in Entity Framework","body":"<p>I have a table with Logs and I am counting the Logs per day as follows:</p>\n\n<pre><code>// Count logs by day\nIList&lt;DataModel&gt; models = _context.Logs\n  .Where(x =&gt; x.Created &gt;= dateMinimum &amp;&amp; x.Created &lt;= dateMaximum)\n  .GroupBy(x =&gt; new { Year = x.Created.Year, Month = x.Created.Month, Day = x.Created.Day })\n  .Select(x =&gt; new { Year = x.Key.Year, Month = x.Key.Month, Day = x.Key.Day, Count = x.Count() })\n  .AsEnumerable()\n  .Select(x =&gt; new DataModel { Date = new DateTime(x.Year, x.Month, x.Day), LogsCount = x.Count })\n  .ToList();\n\n// Fill empty days with dates which contains all days in range\nmodels.AddRange(dates.Where(x =&gt; !models.Any(y =&gt; y.Date == x.Date)).Select(x =&gt; new DataModel { Date = x, LogsCount = 0 }));\n</code></pre>\n\n<p>This is working if I want to count all logs by day independently of the type.</p>\n\n<p>But I would like to count logs by day and type (Error, Warn, Info, ...).</p>\n\n<p>I tried to add x.Type to group but at the end I get only 3 items.</p>\n\n<p>At the moment my DataModel is the following:</p>\n\n<pre><code>public class DataModel\n{\n    public DateTime Date { get; set; }\n    public Int32 LogsCount { get; set; }\n}\n</code></pre>\n\n<p>But maybe it should be something like:</p>\n\n<pre><code>public class DataModel\n{\n    public DateTime Date { get; set; }\n    public KeyValuePair&lt;String, Int32&gt; LogsCount { get; set; }\n}\n</code></pre>\n\n<p>Where LogsCount has a string which holds the Type and Int32 which contains the count.</p>\n\n<p>How can I do this?</p>\n"},{"tags":["c#","wcf","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13006216,"title":"WCF -An error occurred while receiving the HTTP response","body":"<p>I try to get list from service like this:</p>\n\n<pre><code>   static void Main(string[] args)\n    {\n      MyClient proxy = new MyClient();\n      List&lt;X&gt; l = proxy.Func(1).ToList();\n    }\n</code></pre>\n\n<p>X is class from DLL of entity framework project.</p>\n\n<p>My function in service look like this:</p>\n\n<pre><code>    public List&lt;X&gt; Func(int NUM)\n    {                      \n        ProjectContext MyContext = new ProjectContext();\n        s = MyContext.X.ToList();\n        return s;\n\n    }\n</code></pre>\n\n<p>My context define like this:</p>\n\n<pre><code>public class ProjectContext : DbContext\n{\n\n    public ProjectContext ()\n        : base(\"name=ApplicationServices\")\n    {\n        this.Configuration.ProxyCreationEnabled=false;\n        this.Configuration.LazyLoadingEnabled = false;\n    }\n\n    public DbSet&lt;XX&gt; X{ get; set; }\n\n}\n</code></pre>\n\n<p>I get error: </p>\n\n<p>An error occurred while receiving the HTTP response to XXX. This could be due to the service endpoint binding not using the HTTP protocol. This could also be due to an HTTP request context being aborted by the server (possibly due to the service shutting down). See server logs for more details.</p>\n"},{"tags":["asp.net-mvc","entity-framework","domain-driven-design","poco"],"answer_count":5,"favorite_count":3,"up_vote_count":9,"down_vote_count":0,"view_count":229,"score":9,"question_id":12982680,"title":"Gave up DDD, but need some of its benefits","body":"<p>I'm giving up traditional DDD, which is often a massive timewaster, and forces me to do endless mapping: <code>data layer &lt;--&gt; domain layer &lt;--&gt; presentation layer</code>.</p>\n\n<p>For even a small change I must change data models, domain models, presentation models / viewmodels, then the repositories, manager/service classes, and of course the AutoMapper maps, and then test the whole thing! Each call requires calling a layer which calls a layer which calls the underlying code. <em>And I don't get anything in return other than \"you might need it in the future\"</em>. Meh.</p>\n\n<p><strong>My current approach</strong> is more pragmatic:  </p>\n\n<ul>\n<li>I don't worry about the difference between the \"data layer\" and \"domain layer\" any longer, as there's no point - the terms are interchangeable. I let EF do it's thing, and add interfaces and repositories on top when needed.  </li>\n<li>I've merged my \"data\" and \"domain\" projects (into \"core\", boring name, I know), and I could almost swear that Visual Studio is actually running faster.  </li>\n<li>I allow EF entities to go up and down the stack, but, I still map them to presentation models / viewmodels as usual.  </li>\n<li>For simple operations I call repositories directly from controllers, for complex operations I use domain managers/services as usual; the repositories never expose IQueryable.  </li>\n<li>I define entities/POCOs as partial classes, so I can add domain behavior separately in corresponding partial classes.</li>\n</ul>\n\n<p><strong>The problem:</strong> I now use the entities all over the place, so client code can see their <em>navigation properties</em>. And the models are always materialized after they leave a repository, so those navigation properties are often null.</p>\n\n<p><strong>Possible solutions:</strong><br>\n1. Live with it. It's ugly but preferable to the problems explained above.<br>\n2. For each entity, define an interface which hides the navigation properties; and make client code use the interfaces. But ironically, this means another layer (albeit thin and manageable).<br>\n3. What else?</p>\n\n<p>I'm not used to this sort of fast-and-loose programming style, so maybe I'm missing some obvious tricks. Is there anything else I should take into account? I'm sure there are other problems I will encounter soon.</p>\n\n<p><strong>EDIT:</strong>\nThis question is not about DDD. And note that many struggle with a traditional DDD approach -- <a href=\"http://stackoverflow.com/a/1961139/1711500\">Seemann appears to</a> arrive at <a href=\"http://blog.ploeh.dk/2012/02/09/IsLayeringWorthTheMapping.aspx\" rel=\"nofollow\">the same conclusion</a>, <a href=\"http://ayende.com/blog/4788/the-wages-of-sin-proper-and-improper-usage-of-abstracting-an-or-m#feedback\" rel=\"nofollow\">Rahien speaks about the \"Useless Abstraction For The Sake Of Abstraction Anti Pattern\"</a>, and Evans himself said DDD is only truly useful in 5% of cases. Also <a href=\"http://stackoverflow.com/a/796961/1711500\">see this thread</a>. Some of the comments/answers are predictably about how I'm doing DDD wrong, or how I can tweak my system to do it right. However, I'm not asking about DDD or bashing it for the cases where it is suitable, rather I'd like to know what others are doing in line with the thinking I've described above. It's not as if DDD is a panacea to all design ills, every decade a new process comes out (RUP anyone? XP, Agile, Booch, blah...). DDD is just the shiniest new one, and the most well known and used. But pragmatism should come first as I'm trying to build salable products that ship on time and are easy to maintain. The most useful programming axiom I've learned, <em>by far</em>, is YAGNI. <em>What I want is to change my system to a sort of \"DDD-lite\", where I get it's strong design/OOP/pattern philosophy, but without the fat.</em></p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","membership"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13008921,"title":"user role based data querying","body":"<p>I have a common problem as follows for a system. I'm developing the system with entity framework &amp; MVC3. I would like to know how to solve the following issue.</p>\n\n<p>I have users in a user table have the access to the system and the users are assigned to specific divisions within different departments. And also they will have the hierarchy where the managers can view the users who are working under their department/division.</p>\n\n<p>For example if the IT manager login into the system, I want to show only the people who are working in the IT division under him (the same department) &amp; I don't want to show all the other users details to him. Currently I'm using a long sql query to check and load the relevant users from that division, but I would like to do it through lINQ, with entity framework in any effective way.</p>\n\n<p>if anybody can suggest any changes in the database structure of the membership table and sample code to achieve this, it would be great. Please do let me know if the question is not clear.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13004081,"title":"Adding a new table to EF","body":"<p>We are upgrading an old VB6 application which sits on a SQL Server 2005 database, to an Entity Framework solution. The database remains the same, except - we're adding a new table. Is it possible with Entity Framework, to maintain the existing structure, when it gets installed on a client PC - and just add one new table?</p>\n\n<p>Is this how Code First will work? Can I be 100% certain that no other tables will be modified?</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13000744,"title":"Why does EF require the id of an entity as well as the reference","body":"<p>I've a question about Entity Framework. In a code first scenario I have a person class that references an address. In my domain I would have this as a reference to the Address class. All the examples of Entity Framework I've seen also require an AddressId field. This is something that I think shouldn't be there and isn't required in my domain driven model.</p>\n\n<p>Why does EF require this? Can I do without it (I don't believe NHibernate requires this).</p>\n\n<p>Thanks</p>\n\n<pre><code>public class Person()\n{\n    public int Id {get;set;}\n    public string Name {get;set;}\n    public Address Address {get;set;}\n    public int AddressId {get;set;} //Entity Framework seems to require this\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13010347,"title":"Entity Framework and Layer objects","body":"<p>I am little bit confuse while comparing my existing 3 Tier Web application with new requirement of 3 Tier Web Application with Entity Framework. </p>\n\n<p>In my previous application i had following layers:-</p>\n\n<ol>\n<li>Data Access layer (CRUD operation with Microsoft.Application.DataBlock)</li>\n<li>Business Logic (From where i am passing object to DAL).</li>\n<li>Presentation Layes (Which takes input and assign object to Business Layer.</li>\n<li>Objects (Employee Class, Department Class etc)</li>\n</ol>\n\n<p>When i use Entity framework i realize that properties or method which i created in previous application (Object) are same as in Data Access layer. I am wondering now why should i create object if i can get object from entities created with [Table] attribute.</p>\n\n<pre><code>Example\n//Entity\n[Table]\npublic class Employee\n{\n[Column]\npublic string EmployeeId{set; get;}\n\n[Column]\npublic string EmployeeName {set;get;}\n}\n\n//Object\n\n\npublic class Employee\n{\n\npublic string EmployeeId{set; get;}\n\n\npublic string EmployeeName {set;get;}\n}\n</code></pre>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":1032,"score":6,"question_id":592504,"title":"How can I see the Entity Framework's pending changes?","body":"<p>I'm creating an application with the ADO.NET Entity Framework.</p>\n\n<p>I can step through my code line-by-line while debugging and watch SQL Server Profiler for every query executed, but I can't figure out where all those SQL commands are coming from!</p>\n\n<p>Sometimes when I execute <code>SaveChanges()</code>, the Entity Framework performs unexpected, weird INSERTS.  They sometimes break the application.  I can't figure out what I'm doing to cause them.</p>\n\n<p>How can I monitor the pending changes that queue up waiting for a <code>SaveChanges()</code> call?</p>\n"},{"tags":["asp.net",".net","asp.net-mvc-3","entity-framework","entity"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":12963820,"title":"ASP.NET retrieving data from nowhere","body":"<p>I am going through <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3\" rel=\"nofollow\">ASP.NET MVC 3 tutorial</a>. Got to the point where <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-aspnet-mvc3/cs/adding-a-model\" rel=\"nofollow\">EnityFramework was used for model classes</a>. I ran the the application without having connection strings in the web.config specified and it worked.</p>\n\n<p>I could add, edit, delete records. And the weirdest thing is that they are sill there even after I stop development server and start debugging application again as if table was created somewhere in memory and stayed alive for some reason. Can anybody explain what was going on?</p>\n\n<p>Here's a link to an image:\noi48.tinypic.com/fnbeba.jpg</p>\n\n<p>Was it supposed to use the the connection string for which name matches the name of the class derived from DbContext?</p>\n\n<p>EDIT1:<br>\nBecause I had no connection string in web.config it was generated by Enity Framework using namespace and the name of the class derived from DBContext. By default EF uses SQL Express, hence database file was created in database server's DATA direcotry C:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.SQLEXPRESS\\MSSQL\\DATA.</p>\n\n<p>The last thing I don't understand why it wouldn't create the database file in App_Data dir if DBContext derived class is</p>\n\n<pre><code>public class MoviesDBContex : DbContext\n{\n    public DbSet&lt;Movie&gt; Movies { get; set; }\n\n    // Passing name of the connections string shouldn't be even necessary\n    public MoviesDBContex()\n        : base(\"MoviesDBContex\")\n    { }\n}\n</code></pre>\n\n<p>and web.config contains</p>\n\n<pre><code>  &lt;connectionStrings&gt;\n    &lt;add name=\"MoviesDBContext\"\n      connectionString=\"Data Source=|DataDirectory|Movies.sdf\"\n      providerName=\"System.Data.SqlClient\"/&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>Thist what the Microsoft guide about ER connections and models (msdn.microsoft.com/en-us/data/jj592674.aspx) says:</p>\n\n<blockquote>\n  <p>If the name of the connection string matches the name of your context (either with or without namespace qualification) then it will be found by DbContext when the parameterless constructor is used. If the connection string name is different from the name of your context then you can tell DbContext to use this connection in Code First mode by passing the connection string name to the DbContext constructor.</p>\n</blockquote>\n\n<p>Any idea why database file isn't created in App_Data?</p>\n\n<p>EDIT2:<br>\nThere was a missing 't' in the class name and hence it didn't match the name of the connection string.</p>\n\n<p>I does work as expected when provider is SQL Server Compact providerName=\"System.Data.SqlServerCe.4.0\", but if I change it to providerName=\"System.Data.SqlClient\" I get an exception added below. Shouldn't regular SQL Server be able to create a database file also?</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</p>\n  \n  <p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n</blockquote>\n"},{"tags":["entity-framework","entity-framework-4","entity"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13007473,"title":"Entity Framework (Add/Create) Object reference not set to an instance of an object... but it is?","body":"<p>I'm using entity framework to access an exsisting database. I can access the data but when I try to add new data I get a NullReferenceException \"Object reference not set to an instance of an object\", but it is?</p>\n\n<p>The DB connection is fine, I can access the data just fine:  <code>List&lt;log&gt; logs = db.log.ToList();</code></p>\n\n<p>The exception is thrown when using Add or Create:</p>\n\n<pre><code>db.log.Add(new log());\ndb.log.Create();\n</code></pre>\n\n<p>StackTrace:</p>\n\n<pre><code>at System.Data.Entity.DbSet`1.Create()\n</code></pre>\n\n<p>UPDATE:</p>\n\n<p>The Error only occurs OUTSIDE the namespace containing the DB Context. I can work around it by wrapping the classes to have their 'Add to DB context'-methods in the DBHandler namespace. But I would like an explanation to why this happens. Is it a bug or am I violating some sacred .net law?</p>\n\n<p>Thanks for your time!</p>\n"},{"tags":["mysql","wpf","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":764,"score":3,"question_id":10638456,"title":"Entity framework 5.0 code-first with MySQL in WPF","body":"<p>This walkthrough works great with SQL Express:\n<a href=\"http://msdn.microsoft.com/en-us/library/gg197522(v=VS.103).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/gg197522(v=VS.103).aspx</a></p>\n\n<p>I would like it to work with MySQL. I've done some research but none of the techniques I've found has been able to do it for me. Ideally I would like to do something like this:</p>\n\n<pre><code>      &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"MySql.Data.MySqlClient.MySqlClientFactory, MySql.Data\" /&gt;\n  &lt;/entityFramework&gt;\n</code></pre>\n\n<p>This doesn't work (I have MySQL Connector Net 6.5.4 installed &amp; MySql.Data referenced). I've tried deriving from IDbConnection factory as shown in this class here:\n<a href=\"http://www.vworker.com/RentACoder/misc/BidRequests/ShowBidRequest.asp?lngBidRequestId=1563829\" rel=\"nofollow\">http://www.vworker.com/RentACoder/misc/BidRequests/ShowBidRequest.asp?lngBidRequestId=1563829</a></p>\n\n<p>and then using:</p>\n\n<pre><code>      &lt;entityFramework&gt;\n&lt;defaultConnectionFactory type=\"SchoolModel.MySqlConnectionFactory, SchoolModel\" /&gt;\n</code></pre>\n\n<p></p>\n\n<p>but that doesn't work either. Can anybody please give me some pointers as to how to get this to work?</p>\n\n<p>Many thanks.</p>\n"},{"tags":["entity-framework","ef-code-first","wcf-ria-services","code-first","domain-service-class"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12843467,"title":"WCF Ria Services Wizard not working with CodeFirst","body":"<p>When using EF Code First, It appears WCF RIA Services Wizard (that runs when adding a new DomainService) in VS 2012 does not recognize the DbContexts defined in the project (it only recognizes the ObjectContext).    </p>\n\n<p>This means that when Adding a New Item in VS2012 and choosing Add DomainServiceClass, the wizard is not able to detect available context classes * combo list is empty *</p>\n\n<p>Please see the attached image</p>\n\n<p>Any idea what could be happening here?\nThanks,\n-Sumit<img src=\"http://i.stack.imgur.com/9b0HD.jpg\" alt=\"Please see the attached image\"></p>\n"},{"tags":["c#","asp.net","sql","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":110,"score":1,"question_id":13007056,"title":"LINQ Query to retrieve items","body":"<p>So I am using EF, I have the following entities:</p>\n\n<ul>\n<li><code>Website</code></li>\n<li><code>Sector</code></li>\n<li><code>Product</code></li>\n<li><code>Attribute</code></li>\n<li><code>AttributeTag</code></li>\n</ul>\n\n<p>The relationships are as follow:</p>\n\n<p><img src=\"http://i.stack.imgur.com/wvyAs.png\" alt=\"enter image description here\"></p>\n\n<p>I need to retrieve something that is not directly linked to the table. Such as products which needs a <code>Sector</code> object in order to retrieve only the specific <code>Products</code> using something such as <code>sector.Products</code>.</p>\n\n<p>But what if I need to retrieve all <code>Products</code> under a given <code>Website</code> instead of it's parent <code>Sector</code> ?</p>\n\n<p>In my specific situation, my questions are:\n1) How can I retrieve all the products given a specific <code>website_id</code> - (Disregarding the sector)\n2) How can I retrieve all the products that have a specific <code>tag_id</code> + <code>website_id</code>. (Also retrieve it's corresponding <code>Attribute</code>)</p>\n\n<p>Help is appreciated. Thanks!</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13003514,"title":"Entity Framework and Changing Views?","body":"<p>We have a client who had given us some code written in VB6 and is to be converted to .Net 4.0. Theirt database is, what can only be called, a catastrophy. But, we're not allowed to change it. So we're building an application on top of this shakey database.</p>\n\n<p>One thing they did was (Wait for it), create views based on a users selection of which columns should be displayed in a grid.</p>\n\n<p>Example, the Contacts screen lists all the contacts. They have a screen which reads the database, gets the fields from a View, and then presents the user with a list of possible columns. The user then selects a few (Surname, Firstname, DOB).</p>\n\n<p>The code then goes and creates a NEW view (or overwrites an existing one) with</p>\n\n<blockquote>\n  <p>'SELECT Surname, Firstname, DOB' from AnotherView WHERE ID=:ID'</p>\n</blockquote>\n\n<p>(AnotherView is a large view containing joins etc...)</p>\n\n<p>It then uses that view everytime the screen is viewed.</p>\n\n<p>So, the view changes.</p>\n\n<p>We're using Entity Framework. Is it possible to handle dynamic views? We use Linq in the presentation (I know, I know....) to mine the data. So can we somehow use Linq to select * from the view, and then present the grid? If the view is changing, though, we need to regenerate the EF model, no?</p>\n"},{"tags":["c#","asp.net","sql","linq","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":66,"score":-4,"question_id":13006952,"title":"LINQ Query to retrieve items","body":"<p>So I am using EF, I have the following entities:</p>\n\n<ul>\n<li><code>Website</code></li>\n<li><code>Sector</code></li>\n<li><code>Product</code></li>\n<li><code>Attribute</code></li>\n<li><code>AttributeTag</code></li>\n</ul>\n\n<p>The relationships are as follow:</p>\n\n<p><img src=\"http://i.stack.imgur.com/wvyAs.png\" alt=\"enter image description here\"></p>\n\n<p>The questions are:</p>\n\n<ol>\n<li>How can I retrieve all the products given a specific <code>website_id</code> - (Disregarding the sector)</li>\n<li>How can I retrieve all the products that have a specific <code>tag_id</code> + <code>website_id</code>. (Also retrieve it's corresponding <code>Attribute</code>)</li>\n</ol>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13005284,"title":"Using entity framework, how to map a function?","body":"<p>I'm using entity framework, and imagine that I have a function where returns a table with the following columns:</p>\n\n<ul>\n<li>StudentId : smallint</li>\n<li>TestTemplateId : smallint</li>\n<li>Date : date</li>\n</ul>\n\n<p>As you can see, I'm returning a table with only ids. In the application I have a classes like <code>Student</code> and <code>TestTemplate</code>, I don't know if it will be possible that the function can map to complex objects.</p>\n"},{"tags":["asp.net-mvc","entity-framework","azure","ef-code-first","unit-of-work"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13003241,"title":"Data tables not being created when deploying MVC4 to Azurewebsites","body":"<p>So after many many hours of figuring out why my database tables weren't being created when deploying to azure(using mvc4 code first entity framework), I finally came figured out that its the way I have my backend set up. I have my generic repository, unit of work, datacontext, etc..(which is not causing the problem). Whats causing my data tables(500 server error) not to create is my UnitOfWorkFilter. When I apply this it doesn't work, when I take away it works. So my question is does anybody know why this is causing the problem and what I can do to fix this problem because I would like to continue to use my filter. </p>\n\n<p>Here is my unit of work filter:</p>\n\n<pre><code>    public class UnitOfWorkFilter : System.Web.Mvc.ActionFilterAttribute\n    {\n\n    public override void OnActionExecuting(ActionExecutingContext filterContext)\n    {\n\n        var unitOfWork = DependencyResolver.Current.GetService&lt;IUnitOfWork&gt;();\n\n        unitOfWork.Begin();\n    }\n\n    public override void OnActionExecuted(ActionExecutedContext filterContext)\n    {\n        var unitOfWork = DependencyResolver.Current.GetService&lt;IUnitOfWork&gt;();\n        if (filterContext.Exception != null)\n        {\n            unitOfWork.Rollback();\n            return;\n        }\n        try\n        {\n            unitOfWork.Commit();\n        }\n        catch\n        {\n            unitOfWork.Rollback();\n            throw;\n        }\n        finally\n        {\n            unitOfWork.Dispose();\n        }\n    }\n}\n}\n</code></pre>\n"},{"tags":["mvc","entity-framework","sdf"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":209,"score":1,"question_id":10084312,"title":"sdf file not showing in App_Data (using MVC application)","body":"<p>I followed the \"Creating an Entity Framework Data Model for an ASP.NET MVC Application\" in ASP.net and changed it to meet my needs.\nI built the project and run it - everything works fine (I can view details, edit and save).\nI press \"Show all files\" and there is nothing under App_Data.\nI tried to read the related threads here but i couldn't fix it.\nI will appriciate any Idea!</p>\n\n<p>this is my connection string:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n&lt;add name=\"ApplicationServices\"\n     connectionString=\"data source=.\\SQLEXPRESS;Integrated Security=SSPI;AttachDBFilename=|DataDirectory|aspnetdb.mdf;User Instance=true\"\n     providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p></p>\n\n<p>Thank you!</p>\n"},{"tags":["entity-framework","insert","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13003345,"title":"How can I prevent EF from inserting an object that already exists in the db when adding one that contains this first one?","body":"<p>It's quite self-explainatory.\nI have a class that contains another\nLet's call them Subject and Classroom\n<code>public class Subject\n{\n   public Classroom Class {get; set;}\n}</code></p>\n\n<p>I'm using stateless facades, wich means my DbContext is disposed right after recovering the objects and is created to store the new ones.\nShouldn't it know that Classroom isn't a new object since it's ID is already in the DB?\nUsing the debugger I can track to the point right before I call the SaveChanges method and Classroom.id is the one I have on the database.\nWhat's the problem? EF adds a new Classroom with the exact properties as the previous one, but with a new PK.\nWhat am I doing wrong here?</p>\n\n<p>This is the code used for the general CRUD operations (They are in my DbContext) Both update and delete work just fine:</p>\n\n<p>`       public void Update(DbSet MySet, object Obj)\n        {\n            MySet.Attach(Obj);\n            var Entry = this.Entry(Obj);\n            Entry.State = EntityState.Modified;\n            this.SaveChanges();\n        }</p>\n\n<pre><code>    public void Insert(DbSet MySet, object Obj)\n    {\n        MySet.Add(Obj);\n        this.SaveChanges();\n    }\n\n\n    public void Delete(DbSet MySet, object Obj)\n    {\n        MySet.Attach(Obj);\n        var Entry = this.Entry(Obj);\n        Entry.State = EntityState.Deleted;\n        this.SaveChanges();\n    }\n</code></pre>\n\n<p>`</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":13003797,"title":"Get the Entity Framework Connection String","body":"<p>We use Entity Framework 5, but have a requirement to ALSO use a normal database connection from the application for some custom SQL we need to perform.</p>\n\n<p>So, I am creating a DatabaseAccess class which handles this connection. Is there a way that I can populate the connection string, by checking the Entity Framework connection string?</p>\n\n<p>So:</p>\n\n<pre><code>SqlConnection cnn;\nconnetionString = \"Data Source=ServerName;Initial Catalog=DatabaseName;User ID=UserName;Password=Password\"\n</code></pre>\n\n<p>Can I build that from checking Entity Framework?</p>\n"},{"tags":["c#","wcf","entity-framework","list"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12996366,"title":"Pass list to client in WCF","body":"<p>My function in service look like this:</p>\n\n<pre><code>    public List&lt;X&gt; GetAll(string num)\n    {\n       TheContext  Mycontext = new TheContext();\n        IEnumerable&lt;X&gt; MyIEnumerable =\n     ((IObjectContextAdapter)Mycontext)\n     .ObjectContext.ExecuteStoreQuery&lt;X&gt;(\"select * from dbo.XXX where y='\"+num+\"'\");\n\n        List&lt;X&gt; MyList = MyIEnumerable.ToList();\n        return MyList;\n    }\n</code></pre>\n\n<p>Here the list OK.</p>\n\n<p>My client look like this:</p>\n\n<pre><code>static void Main(string[] args)\n    {\n        MyClient proxy = new MyClient ();\n        List&lt;X&gt; MyClientList = proxy.GetAll(\"980\").ToList();\n        proxy.Close();\n        Console.ReadLine();\n    }\n</code></pre>\n\n<p>Here have error:</p>\n\n<p>An error occurred while receiving the HTTP response. This could be due to the service endpoint binding not using the HTTP protocol. This could also be due to an HTTP request context being aborted by the server (possibly due to the service shutting down). See server logs for more details.</p>\n\n<p>If i return from the function like this this work:</p>\n\n<pre><code>public List&lt;X&gt; GetAll(string num)\n {\n   List&lt;x&gt; MyList= new List&lt;x&gt;();\n   MyList.Add(new X(){...});\n   MyList.Add(new X(){...});\n   MyList.Add(new X(){...});   \n    return MyList;\n }\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":1,"view_count":3912,"score":3,"question_id":5517182,"title":"EF 4.1 SaveChanges not updating navigation or reference properties","body":"<p>I'm using code first and can add records without a problem. The database is created properly and is seeded without any problems. But calling SaveChanges() in my Edit action only updates the entity, not any of the navigation or reference properties.</p>\n\n<p>A simplified version of my model:</p>\n\n<pre><code>public class Contact : IMyBaseObject\n{\n    public Contact()\n    {\n       this.Delete = false;\n       this.ContactTypes = new HashSet&lt;ContactType&gt;();\n    }\n\n    public int Id {get; set;}\n\n    public string Name {get;set;}\n\n    public bool Delete {get;set;}\n\n    public virtual ICollection&lt;ContactType&gt; ContactTypes { get; set; }\n\n    public virtual USState USState { get; set; }\n\n}\n\npublic class ContactType : MyBaseObject\n{\n    public ContactType()\n    {\n    }\n\n    public int Id {get; set;}\n\n    public string Name {get;set;}\n\n    public virtual ICollection&lt;Contact&gt; Contacts {get;set;}\n}\n\npublic abstract class Territory : MyBaseObject\n{\n    public int Id {get; set;}\n\n    public string Name {get;set;}\n\n    public string Code {get;set;}\n}\n\npublic class USState : Territory\n{\n    public USState()\n    {\n    }\n\n    // Navigation properties\n    public virtual ICollection&lt;Contact&gt; Contacts { get; set; }\n}\n</code></pre>\n\n<p>I won't include the code, but I do have some custom model binding going on. My Edit action (using MVC 3) was not being populated with the ContactType or USState properties. The binding is properly returning a fully populated Contact object with the correct values from the form.</p>\n\n<p>If I understand EF 4.1 properly, I should only have to do the following to persist changes to the database when saving my Contact object:</p>\n\n<pre><code>if(ModelState.IsValid)\n{\n    context.Entry(contact).State = EntryState.Modified;\n    context.SaveChanges();\n}\n</code></pre>\n\n<p>However, only primitive properties are being updated when I do that. I have left out a few things in the above example: I'm using a transaction, a try catch block, and checking if it's a new record.</p>\n\n<p>I have used SQL Profiler and can confirm that the update queries for the ContactType and Territory tables are <strong>not</strong> being sent to the database server.</p>\n\n<p>The State properties of my navigation and reference properties are Modified, but I have also tried manually setting that:</p>\n\n<pre><code>    context.Entry(contact).Collections(\"ContactTypes\").EntityEntry.State = EntityState.Modified;\n    context.Entry(contact).Reference(\"USState\").EntityEntry.State = EntityState.Modified;\n</code></pre>\n\n<p>I could be mistaken, but I'm pretty sure my code was working under CTP5.</p>\n\n<p>Any ideas? At this point, I'm not sure how I should approach debugging this.</p>\n\n<p>Thanks, Steve</p>\n"},{"tags":["sql-server","performance","entity-framework","multi-tenant","parameter-sniffing"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":12979493,"title":"Multi-tenant SQL Server databases and parameter sniffing","body":"<p>I have a multi-tenant database in SQL Server 2012 where each tenant's rows are identified by a <code>tenant_id</code> column (aka the <a href=\"http://msdn.microsoft.com/en-us/library/aa479086.aspx\" rel=\"nofollow\">Shared Database, Shared Schema</a> approach). Some tenants, particularly the newer ones, have very few rows, while others have many.</p>\n\n<p>SQL Server's query optimizer normally builds a query plan based on the parameters provided during its first execution, then re-uses this plan for all future queries even if different parameters are provided. This is known as <a href=\"http://www.sommarskog.se/query-plan-mysteries.html\" rel=\"nofollow\">parameter sniffing</a>.</p>\n\n<p>The problem we have with our database is that SQL Server sometimes builds these plans based on parameters that point to a smaller tenant, which works fine for that tenant, but then when it reapplies the cached plan to a larger tenant it fails catastrophically (usually timing out, in fact). Typically we find out about this situation only when one of our larger tenants contacts us about experiencing time-out errors, then we have to get into the system and manually flush all the query plans to correct it.</p>\n\n<p>There is a query hint you can use to prevent SQL Server from caching query plans (<a href=\"http://www.benjaminnevarez.com/2010/06/how-optimize-for-unknown-works/\" rel=\"nofollow\"><code>OPTIMIZE FOR UNKNOWN</code></a>) but this results in some extra overhead since the query plan is being regenerated every time the query is called. An additional problem is that we're using Entity Framework which offers no ability to specify the <code>OPTIMIZE FOR UNKNOWN</code> hint on queries.</p>\n\n<p>So the question is -- what is the best practice for multi-tenant databases with regard to parameter sniffing? Is there a way to disable parameter sniffing database-wide without having to specify it on every query? If so, is that even the best approach? Should I be partitioning the data in some other way? Is there some other approach I'm not thinking of?</p>\n"},{"tags":["c#","entity-framework","ado.net","ado.net-entity-data-model","savechanges"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13002616,"title":"How to add new object to database?","body":"<p>I want to add a new book to my database, but it doesn't work.</p>\n\n<pre><code>class Program\n    {\n        static void Main(string[] args)\n        {\n            Knigi_DataEntities entities = new Knigi_DataEntities();\n                Books newBook = new Books();\n                newBook.Name = \"C# 4 How-to\";\n                newBook.Published = 2010;\n                newBook.Book_ID = 4;\n                entities.AddToBooks(newBook);\n                entities.SaveChanges();\n\n            Knigi_DataEntities ent = new Knigi_DataEntities(); \n                  foreach (var book in ent.Books)\n                {\n                    Console.WriteLine(\"{0}, {1} {2}  \",\n                    book.Book_ID, book.Name, book.Published);\n                }\n              }\n            }\n</code></pre>\n\n<p>but when I close <code>//entities.SaveChanges();</code>, the console displays objects that are already in my database. Therefore problems are caused by <code>entities.SaveChanges();</code>\n<br>Please tell me, how to add new objects?</p>\n"},{"tags":["entity-framework","asp.net-mvc-4"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":13002166,"title":"Asp.net MVC 4 Code First Return Specific Fields from Navigation Property","body":"<p>Been stuck on this for a while so i thought i would ask.  I am sure there is something simple i am missing here.  Trying to learn Asp.net mvc 4 on my own by building a simple app.  </p>\n\n<p>Here is the model:</p>\n\n<pre><code>public class Category\n{\n    public int Id { get; set; }\n    [Required]\n    [StringLength(32)]\n    public string Name { get; set; }\n    //public virtual ICollection&lt;Note&gt; Notes { get; set; }\n    private ICollection&lt;Note&gt; notes;\n    public ICollection&lt;Note&gt; Notes\n    {\n        get\n        {\n            return this.notes ?? (this.notes = new List&lt;Note&gt;());\n        }\n    }\n}\n\npublic class Note\n{\n    public int Id { get; set; }\n    [Required]\n    public string Content { get; set; }\n    [Required]\n    [StringLength(128)]\n    public string Topic { get; set; }\n    public int CategoryId { get; set; }\n    public virtual Category Category { get; set; }\n    public virtual IEnumerable&lt;Comment&gt; Comments { get; set; }\n    public virtual ICollection&lt;Tag&gt; Tags {get; set;}\n\n    public Note()\n    {\n        Tags = new HashSet&lt;Tag&gt;();\n    }\n}\npublic class Tag\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public virtual ICollection&lt;Note&gt; Notes { get; set; }\n\n    public Tag()\n    {\n        Notes = new HashSet&lt;Note&gt;();\n    }\n}\n</code></pre>\n\n<p>I call this method in a repository from the controller:</p>\n\n<pre><code> public IQueryable&lt;Note&gt; GetAll()\n    {\n        var query = _db.Notes.Include(x =&gt; x.Category).Include(y =&gt; y.Tags);\n        return query;\n    }\n</code></pre>\n\n<p>On the home controller i am trying to return a list of all the notes and wanted to include the category name that it belongs to as well as the tags that go with the note.  At first the did not show up so i read some tutorials about eager loading and figured out how to get them to show. </p>\n\n<p>However, my method is not that efficient.  The mini-profiler is barking at me for duplicate queries because the navigation properties for category and tags are sending queries for the notes again.  IS there any way to just return the properties i need for the category and tag objects?  </p>\n\n<p>I have tried several methods with no luck.  I was hoping i could do something like this:</p>\n\n<pre><code>var query = _db.Notes.Include(x =&gt; x.Category.Name).Include(y =&gt; y.Tags.Name);\n</code></pre>\n\n<p>But i get an error:  Cannot convert lambda expression to type 'string' because it is not a delegate type</p>\n\n<p>I have seen that error before that was caused by some missing using statements so i already double checked that.  </p>\n\n<p>Any suggestions?  Thanks for the help</p>\n"},{"tags":["c#","mysql","entity-framework","isolation-level"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12990743,"title":"Verify that I use ReadUncommitted Entity Framework and MySQL","body":"<p>I'm trying to implement a test project with a different <code>IsolationLevel</code>. I have this code</p>\n\n<pre><code>        var transactionOptions = new TransactionOptions();\n        transactionOptions.IsolationLevel = IsolationLevel.ReadUncommitted;\n\n        using (TransactionScope scope = new TransactionScope( TransactionScopeOption.RequiresNew, transactionOptions))\n        {\n\n            using (var uncommittedDb = new Context())\n            {\n                var query = uncommittedDb.TestTable;\n                var objects = query.ToTable(); // I have a breakpoint here\n            }\n        }\n</code></pre>\n\n<p>But I don't know if I'm doing right or how I can verify it? I can't see that my query has change if I break the application where the breakpoint is and hover the <code>query</code>. How can I verify that I'm doing right (or wrong ;-))? </p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13001613,"title":"Changed the Edmx and got errors","body":"<p>I tried to change the Entities Table Name and encountered an error.\nI just renamed <strong>TblRecord</strong> as the name was from the Table Name </p>\n\n<p>What is the mistake here and how to resolve it ?</p>\n\n<hr>\n\n<p><strong>Error :</strong></p>\n\n<pre><code>+       _innerException {\"The specified table does not exist. [ Records ]\"} System.Exception {System.Data.SqlServerCe.SqlCeException}\n</code></pre>\n\n<hr>\n\n<p><strong>The Edmx File</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;edmx:Edmx Version=\"3.0\" xmlns:edmx=\"http://schemas.microsoft.com/ado/2009/11/edmx\"&gt;\n  &lt;!-- EF Runtime content --&gt;\n  &lt;edmx:Runtime&gt;\n    &lt;!-- SSDL content --&gt;\n    &lt;edmx:StorageModels&gt;\n      &lt;Schema Namespace=\"Xz.Business.Matches.Store\" Alias=\"Self\" Provider=\"System.Data.SqlServerCe.4.0\" ProviderManifestToken=\"4.0\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/edm/ssdl\"&gt;\n        &lt;EntityContainer Name=\"XzBusinessMatchesStoreContainer\"&gt;\n          &lt;EntitySet Name=\"Records\" EntityType=\"Xz.Business.Matches.Store.Records\" store:Type=\"Tables\" /&gt;\n        &lt;/EntityContainer&gt;\n        &lt;EntityType Name=\"Records\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"Record\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Name=\"Record\" Type=\"nvarchar\" Nullable=\"false\" MaxLength=\"100\" /&gt;\n          &lt;Property Name=\"Relations\" Type=\"nvarchar\" MaxLength=\"450\" /&gt;\n        &lt;/EntityType&gt;\n      &lt;/Schema&gt;\n    &lt;/edmx:StorageModels&gt;\n    &lt;!-- CSDL content --&gt;\n    &lt;edmx:ConceptualModels&gt;\n      &lt;Schema Namespace=\"Xz.Business.Matches\" Alias=\"Self\" p1:UseStrongSpatialTypes=\"false\" xmlns:annotation=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\" xmlns:p1=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/edm\"&gt;\n        &lt;EntityContainer Name=\"RecordzEntities\" p1:LazyLoadingEnabled=\"true\"&gt;\n          &lt;EntitySet Name=\"Records\" EntityType=\"Xz.Business.Matches.TblRecord\" /&gt;\n        &lt;/EntityContainer&gt;\n        &lt;EntityType Name=\"TblRecord\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"Record\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Name=\"Record\" Type=\"String\" Nullable=\"false\" MaxLength=\"100\" Unicode=\"true\" FixedLength=\"false\" /&gt;\n          &lt;Property Name=\"Relations\" Type=\"String\" MaxLength=\"450\" Unicode=\"true\" FixedLength=\"false\" /&gt;\n        &lt;/EntityType&gt;\n      &lt;/Schema&gt;\n    &lt;/edmx:ConceptualModels&gt;\n    &lt;!-- C-S mapping content --&gt;\n    &lt;edmx:Mappings&gt;\n      &lt;Mapping Space=\"C-S\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/mapping/cs\"&gt;\n        &lt;EntityContainerMapping StorageEntityContainer=\"XzBusinessMatchesStoreContainer\" CdmEntityContainer=\"RecordzEntities\"&gt;\n          &lt;EntitySetMapping Name=\"Records\"&gt;\n            &lt;EntityTypeMapping TypeName=\"Xz.Business.Matches.TblRecord\"&gt;\n              &lt;MappingFragment StoreEntitySet=\"Records\"&gt;\n                &lt;ScalarProperty Name=\"Record\" ColumnName=\"Record\" /&gt;\n                &lt;ScalarProperty Name=\"Relations\" ColumnName=\"Relations\" /&gt;\n              &lt;/MappingFragment&gt;\n            &lt;/EntityTypeMapping&gt;\n          &lt;/EntitySetMapping&gt;\n        &lt;/EntityContainerMapping&gt;\n      &lt;/Mapping&gt;\n    &lt;/edmx:Mappings&gt;\n  &lt;/edmx:Runtime&gt;\n  &lt;!-- EF Designer content (DO NOT EDIT MANUALLY BELOW HERE) --&gt;\n  &lt;Designer xmlns=\"http://schemas.microsoft.com/ado/2009/11/edmx\"&gt;\n    &lt;Connection&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"MetadataArtifactProcessing\" Value=\"EmbedInOutputAssembly\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/Connection&gt;\n    &lt;Options&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"ValidateOnBuild\" Value=\"true\" /&gt;\n        &lt;DesignerProperty Name=\"EnablePluralization\" Value=\"True\" /&gt;\n        &lt;DesignerProperty Name=\"IncludeForeignKeysInModel\" Value=\"True\" /&gt;\n        &lt;DesignerProperty Name=\"CodeGenerationStrategy\" Value=\"None\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/Options&gt;\n    &lt;!-- Diagram content (shape and connector positions) --&gt;\n    &lt;Diagrams&gt;&lt;/Diagrams&gt;\n  &lt;/Designer&gt;\n&lt;/edmx:Edmx&gt;\n</code></pre>\n\n<p><em>This is EF5 &amp; VS12</em></p>\n"},{"tags":["c#","wpf","entity-framework","mvvm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":370,"score":0,"question_id":5461964,"title":"EF object property changing - MVVM","body":"<p>I have a viewmodel that has an EF object as one of its properties. The view has several text boxes wired up to that property via <code>Text=\"{Binding Path=MyEFTable.Column1}\"</code>.  I'm using the MVVM Light toolkit so my viewmodels inherit ViewModelBase and subsequently each property calls <code>RaisePropertyChanged()</code> when changed.</p>\n\n<p>I have noticed, however that changing <code>MyEFTable.Column1</code> does not set off any changes in the viewmodel.  I thought that EF objects tracked any changes, so I assumed that changing a column value in an EF object would cause the EF object itself to be changed. Is it no longer tracking changes since I am essentially copying the query result into a new <code>MyEFTable</code> object?</p>\n"},{"tags":["c#","entity-framework","c#-4.0","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13000748,"title":"Use string as type of DbSet like DbSet<string> in EF-CodeFirst","body":"<p>I want to have a list of string and save and load them to/from database using EF-CodeFirst. this is my DbContext class:</p>\n\n<pre><code>public class KeysDbContext : DbContext\n{\n    public DbSet&lt;string&gt; Keys { get; set; }\n}\n</code></pre>\n\n<p>but when I try to run the code I get this exception:<code>System.InvalidOperationException</code> : <code>The type 'System.String' was not mapped. Check that the type has not been explicitly excluded by using the Ignore method or NotMappedAttribute data annotation. Verify that the type was defined as a class, is not primitive, nested or generic, and does not inherit from EntityObject.</code></p>\n\n<p>How can I resolve the problem?</p>\n"},{"tags":["entity-framework","fluent"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13000887,"title":"Model class and Mapping","body":"<p>I have the Client class defined. I also have Mapping\\ClientMap.cs file that defines column names using Fluent API. However, I am not sure how to \"invoke\" it as I don't see the ClientMap.cs code being executed.</p>\n\n<p>I also have this:</p>\n\n<pre><code>namespace CardNumbers.Data\n{\n    public class Repository : DbContext, IRepository\n    {\n        public DbSet&lt;Client&gt; Clients { get; set; }\n        public DbSet&lt;ClientOrder&gt; ClientOrders { get; set; }\n        public DbSet&lt;Reorder&gt; Reorders { get; set; }\n        public DbSet&lt;Operator&gt; Operators { get; set; }\n</code></pre>\n\n<p>which I know is not a very good practice, but that's how we were building the application with the instructor.</p>\n\n<p>So, my question is - what do I need to add to make sure the Fluent API code is invoked in run-time?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":12978163,"title":"Entity - Schema Mapping and Namespaces","body":"<p>Added a Database and an Entity Model to my DAL Project.</p>\n\n<h2>got an error :</h2>\n\n<p><strong>Error :</strong></p>\n\n<pre><code> +      base    {\"Schema specified is not valid. Errors: \\r\\nMultiple types with the name 'TblRecord' exist in the EdmItemCollection in different namespaces.  Convention based mapping requires unique names without regard to namespace in the EdmItemCollection.\"}   System.Data.EntityException {System.Data.MetadataException}\n</code></pre>\n\n<hr>\n\n<p><strong>The Edmx File</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;edmx:Edmx Version=\"3.0\" xmlns:edmx=\"http://schemas.microsoft.com/ado/2009/11/edmx\"&gt;\n  &lt;!-- EF Runtime content --&gt;\n  &lt;edmx:Runtime&gt;\n    &lt;!-- SSDL content --&gt;\n    &lt;edmx:StorageModels&gt;\n      &lt;Schema Namespace=\"Xz.Business.Matches.Store\" Alias=\"Self\" Provider=\"System.Data.SqlServerCe.4.0\" ProviderManifestToken=\"4.0\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/edm/ssdl\"&gt;\n        &lt;EntityContainer Name=\"XzBusinessMatchesStoreContainer\"&gt;\n          &lt;EntitySet Name=\"Records\" EntityType=\"Xz.Business.Matches.Store.Records\" store:Type=\"Tables\" /&gt;\n        &lt;/EntityContainer&gt;\n        &lt;EntityType Name=\"Records\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"Record\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Name=\"Record\" Type=\"nvarchar\" Nullable=\"false\" MaxLength=\"100\" /&gt;\n          &lt;Property Name=\"Relations\" Type=\"nvarchar\" MaxLength=\"450\" /&gt;\n        &lt;/EntityType&gt;\n      &lt;/Schema&gt;\n    &lt;/edmx:StorageModels&gt;\n    &lt;!-- CSDL content --&gt;\n    &lt;edmx:ConceptualModels&gt;\n      &lt;Schema Namespace=\"Xz.Business.Matches\" Alias=\"Self\" p1:UseStrongSpatialTypes=\"false\" xmlns:annotation=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\" xmlns:p1=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/edm\"&gt;\n        &lt;EntityContainer Name=\"RecordzEntities\" p1:LazyLoadingEnabled=\"true\"&gt;\n          &lt;EntitySet Name=\"Records\" EntityType=\"Xz.Business.Matches.TblRecord\" /&gt;\n        &lt;/EntityContainer&gt;\n        &lt;EntityType Name=\"TblRecord\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"Record\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Name=\"Record\" Type=\"String\" Nullable=\"false\" MaxLength=\"100\" Unicode=\"true\" FixedLength=\"false\" /&gt;\n          &lt;Property Name=\"Relations\" Type=\"String\" MaxLength=\"450\" Unicode=\"true\" FixedLength=\"false\" /&gt;\n        &lt;/EntityType&gt;\n      &lt;/Schema&gt;\n    &lt;/edmx:ConceptualModels&gt;\n    &lt;!-- C-S mapping content --&gt;\n    &lt;edmx:Mappings&gt;\n      &lt;Mapping Space=\"C-S\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/mapping/cs\"&gt;\n        &lt;EntityContainerMapping StorageEntityContainer=\"XzBusinessMatchesStoreContainer\" CdmEntityContainer=\"RecordzEntities\"&gt;\n          &lt;EntitySetMapping Name=\"Records\"&gt;\n            &lt;EntityTypeMapping TypeName=\"Xz.Business.Matches.TblRecord\"&gt;\n              &lt;MappingFragment StoreEntitySet=\"Records\"&gt;\n                &lt;ScalarProperty Name=\"Record\" ColumnName=\"Record\" /&gt;\n                &lt;ScalarProperty Name=\"Relations\" ColumnName=\"Relations\" /&gt;\n              &lt;/MappingFragment&gt;\n            &lt;/EntityTypeMapping&gt;\n          &lt;/EntitySetMapping&gt;\n        &lt;/EntityContainerMapping&gt;\n      &lt;/Mapping&gt;\n    &lt;/edmx:Mappings&gt;\n  &lt;/edmx:Runtime&gt;\n  &lt;!-- EF Designer content (DO NOT EDIT MANUALLY BELOW HERE) --&gt;\n  &lt;Designer xmlns=\"http://schemas.microsoft.com/ado/2009/11/edmx\"&gt;\n    &lt;Connection&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"MetadataArtifactProcessing\" Value=\"EmbedInOutputAssembly\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/Connection&gt;\n    &lt;Options&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"ValidateOnBuild\" Value=\"true\" /&gt;\n        &lt;DesignerProperty Name=\"EnablePluralization\" Value=\"True\" /&gt;\n        &lt;DesignerProperty Name=\"IncludeForeignKeysInModel\" Value=\"True\" /&gt;\n        &lt;DesignerProperty Name=\"CodeGenerationStrategy\" Value=\"None\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/Options&gt;\n    &lt;!-- Diagram content (shape and connector positions) --&gt;\n    &lt;Diagrams&gt;&lt;/Diagrams&gt;\n  &lt;/Designer&gt;\n&lt;/edmx:Edmx&gt;\n</code></pre>\n\n<hr>\n\n<p><strong>Names &amp; Namespaces :</strong></p>\n\n<p>Project Name : Business.Matches\nDefault Namespace : Xz.Business.Matches</p>\n\n<p>I added an Entity Model with this definitions :</p>\n\n<p>Model : RecordzModel</p>\n\n<p>Context : RecordzContext</p>\n\n<p>Model Namespace : Xz.Business.Matches</p>\n"},{"tags":["oracle","entity-framework","blob","odata","dbcontext"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13000909,"title":"Inserting BLOB using OData and Oracle","body":"<p>When working with OData and Oracle i need to insert blob records in some table.\nI tried to follow example here : <a href=\"http://blogs.msdn.com/b/astoriateam/archive/2010/08/04/data-services-streaming-provider-series-implementing-a-streaming-provider-part-1.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/astoriateam/archive/2010/08/04/data-services-streaming-provider-series-implementing-a-streaming-provider-part-1.aspx</a>\nAs microsoft recomend i exclude my BLOB from data model.\nAt the end, data is sent to my service, in GetWriteStream() i write binary data to temporary file. Then in Dispose() i should insert it in database.\nBut...\nUsing DbContext, i cant do this :\nObjectStateEntry entry = \n            this.context.ObjectStateManager.GetObjectStateEntry(cachedEntity);</p>\n\n<p>converting this.context to dbcontext throw exception - DbContext cant be used because its disposed. \nI still cant understand how to do this?\nI didnt find any example in the internet where is described how to use OData with blobs and dbcontext to work with database directly.</p>\n\n<p>Using : WCF Data Services 5.1.0-rc2, Visual Studio 2012, Oracle 11.x with ODP</p>\n"},{"tags":["linq","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":12999457,"title":"How can I retrieve a composite class in EF Code First, having specified a relation on multi tier app?","body":"<p>I have an interesting problem :\nI created a class called, let's say, \"Container\" wich has a member of type \"Contained\"\nIt would look like:</p>\n\n<p><code>public class Container\n    {\n       public Contained cnt{ get; set; }\n    }\n</code></p>\n\n<p>The model contains both tables, and my DB looks like:\nContainers(PK:id FK:Contained_ContainedId)\nContained(PK:ContainedId)</p>\n\n<p>EF Code first correcty maps this atribute as a foreign key in the Contined table.\nThe problem comes when I want to retrieve these objects using LINQ:</p>\n\n<p><code>Container Con=(from Object in PersistentManager.Containers.OfType&lt;Container&gt; select Object).SingleOrDefault();</code></p>\n\n<p>This way (or either casting an anonymous type), I get a Container. The problem is, the reference to the Contained object is allways null. I think this is made on purpose for the sake of performance, but, this time, I need it to recover the full object.\nIntellitrace shows it's not even joining tables, so i guess something else should be specified\nAny ideas?</p>\n\n<p>Allrigth, thanks to Basic, I have solved the issue using the include clause.\nI think there SHOULD be a way to use lazy loading on context closed environment (multi tier patterns allways recomend disposing these objects)</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12962212,"title":"InvalidCastException from Entity.DynamicProxies.MyEntityClass to Entity.DbSet`1[MyEntityClass]","body":"<p>I am having difficulty understanding why I am getting an InvalidCastException\nHere is the error message that I'm getting:</p>\n\n<blockquote>\n  <p>Unable to cast object of type 'System.Data.Entity.DynamicProxies.Man_58184D79075BC811252680D7866D3D69D0C46FD038D3B123A5E3B102E1FC77A2' to type 'System.Data.Entity.DbSet`1[ConsoleApplication1.Man]'.</p>\n</blockquote>\n\n<ul>\n<li><strong>Man</strong> is the name of the entity class being passed to TEntity</li>\n<li>I've marked the location of the error with a comment in the code.</li>\n</ul>\n\n<p>The purpose of this repository class is to hold a given DbContext and DbSet, and call its methods to delete records and/or display all records of the given DbSet.  </p>\n\n<pre><code>public class Repository&lt;TEntity&gt; where TEntity : class\n{\n    private DbContext dbContext;\n    private DbSet&lt;TEntity&gt; dbSet { get; set; }\n    public Repository(DbContext dbContext)\n    {\n       this.dbContext = dbContext;\n       this.dbSet = this.dbContext.Set&lt;TEntity&gt;();\n    }\n\n    public void Delete(int id)\n    {\n         TEntity entity = dbSet.Find(id);\n         dbSet.Remove(entity);\n         dbContext.SaveChanges();\n    }\n\n    public void DisplayAll()\n    {\n        IQueryable Query = from item in dbContext.Set&lt;TEntity&gt;()  \n                           where true\n                           select item;\n\n        foreach (DbSet&lt;TEntity&gt; x in Query) //InvalidCastException\n        {\n            // print entity fields to console here.\n        }\n\n    }\n}\n</code></pre>\n\n<p>These are the lines in my main program that I use to create a Repository Object:</p>\n\n<p><strong>TestDataBaseEntities</strong> is the type of DbContext object I use to refer to my entity model.</p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        int myID;\n        var dbEntities = new TestDatabaseEntities();\n        Repository&lt;Man&gt; ManTracker = new Repository&lt;Man&gt;(dbEntities);\n\n        ManTracker.Display();  // exception thown in this method.\n        Console.WriteLine(\"Choose ID to delete from Men list\");\n        myID = int.Parse(Console.ReadLine());\n        ManTracker.Delete(myID);\n        ManTracker.Display();\n\n        Console.ReadLine();\n    }\n}\n</code></pre>\n"},{"tags":["linq","entity-framework"],"answer_count":1,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":6245,"score":12,"question_id":6919709,"title":"Only initializers, entity members, and entity navigation properties are supported","body":"<p>I'm getting this exception :</p>\n\n<p>The specified type member 'Paid' is not supported in LINQ to Entities. Only initializers, entity members, and entity navigation properties are supported.</p>\n\n<pre><code>    public ActionResult Index()\n    {\n        var debts = storeDB.Orders\n            .Where(o =&gt; o.Paid == false)\n            .OrderByDescending(o =&gt; o.DateCreated);\n\n        return View(debts);\n    }\n</code></pre>\n\n<p>My Model class</p>\n\n<pre><code>public partial class Order\n{\n    public bool Paid {\n        get {\n            return TotalPaid &gt;= Total;\n        }\n    }\n\n    public decimal TotalPaid {\n        get {\n            return Payments.Sum(p =&gt; p.Amount);\n        }\n    }\n</code></pre>\n\n<p>Payments is a Related table containing the field amount, The query works if I remove the Where clause showing correct information about the payments, any clue what's wrong with the code?</p>\n\n<p><strong>Solved like the answer suggested with :</strong></p>\n\n<pre><code>    public ActionResult Index()\n    {\n        var debts = storeDB.Orders\n            .OrderByDescending(o =&gt; o.DateCreated)\n            .ToList()\n            .Where(o =&gt; o.Paid == false);\n\n        return View(debts);\n    }\n</code></pre>\n"},{"tags":["linq","entity-framework","entity-framework-4.1","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12991571,"title":"Linq doubts with DB context","body":"<p>Hi I have a question that is braking my mind for some days.\nI have my SQL server Database and my C# application.\nIn the DB I have differemt tables, let me show you a simple ex\nTables:\nPerson\nRelationship\nCity</p>\n\n<p>Business Rules:\nThe person are from a City, so the person has IdCity\nA person has a relationship with other person, and about that relationship you need to save the starting date.</p>\n\n<p>In other projects I already did something like that, but in this proyect this is not working for me.</p>\n\n<p>When I retrieved with LinQ the information about the person, the city is not coming, and an error appears when I try \"person.city.description\", for ex.\nI try using Include(\"City\") in the linq query, but it didn't work. Besides that, I don't know how to manage the circular reference to the person to person relationship.</p>\n\n<p>One important thing, that I think that can be the problem, is that I rename all the tables from the DataModel, for example, the table in database is called Prd_City, so I change the Name and the Entity Set Name for City in c# project. So in the included I have to use the real table name, in other case the query fail, but if I use the real name nothing happens.</p>\n\n<pre><code>using (var context = new MyContext())\n{\n   List&lt;Person&gt; oPeople = (from p in context.Person.Include(\"Prd_City\")\n                           select p).ToList();\n   return oPeople ;\n}\n</code></pre>\n\n<p>Any help will be welcome.\nThanks!</p>\n"},{"tags":["c#","database","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12634495,"title":"Table missing from database when using CreateDatabase()","body":"<pre><code>MyEntities db = new MyEntities(theParameter);\n</code></pre>\n\n<p>Here is theParameter:</p>\n\n<pre><code> metadata=res://*/Models.My.csdl|res://*/Models.My.ssdl|res://*/Models.My.msl;provider=System.Data.SqlClient;provider connection string='Data Source=[correctIpAddress];Initial Catalog=testDbName;User ID=myUsername;Password=myPassword;MultipleActiveResultSets=True'\n</code></pre>\n\n<p>When I add watch to db, it has many tables, among them the table tblTestTable. After that I do:</p>\n\n<pre><code>db.CreateDatabase();\n</code></pre>\n\n<p>And in the newly created database there is no tblTestTable table. Why is this happening?</p>\n"},{"tags":["entity-framework","mapping","entity-framework-4","metadata"],"answer_count":11,"favorite_count":4,"up_vote_count":19,"down_vote_count":0,"view_count":17481,"score":19,"question_id":2350514,"title":"EF Mapping and metadata information could not be found for EntityType Error","body":"<p>I have encountered an exception when I using Entity Framework 4.0 RC.\nMy Entity Framework model is encapsulated in a private assembly whos name is Procurement.EFDataProvider and my POCO are inside of another assembly Procurement.Core\nThe relation between Core(Business Logic)and EFDataProvider(Data Access) is with a factory named DataProvider</p>\n\n<p>so when I try to create an objectset</p>\n\n<pre><code>objectSet = ObjectContext.CreateObjectSet&lt;TEntity&gt;();\n</code></pre>\n\n<p>I got an error:</p>\n\n<blockquote>\n  <p>Mapping and metadata information could not be found for EntityType 'Procurement.Core.Entities.OrganizationChart'.</p>\n</blockquote>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12998231,"title":"Entity Framework: how to map multiple tables with different keys to one entity?","body":"<p>I have a DB structure like this:</p>\n\n<pre><code>create table Person (\n  ID bigint identity not null,\n  FirstName varchar(100),\n  LastName varchar(100),\n  -- etc... lot's of generic fields that apply to a person, e.g. phone, address\n)\n\ncreate table Teacher (\n  ID bigint identity not null,\n  PersonID bigint not null,\n  EmploymentDate date,\n  -- plus a bunch of other teacher-specific fields\n)\n\ncreate table Student (\n  ID bigint identity not null,\n  PersonID bigint not null,\n  EnrollmentDate date,\n  -- plus a bunch of student-specific fields\n)\n\ncreate table SystemUser (\n  ID bigint identity not null,\n  PersonID bigint not null,\n  UserName varchar(50) not null,\n  -- plus any user specific fields\n)\n</code></pre>\n\n<p>The relationship between <code>Person</code> and all the other fields is 1 -> 0:1, and each of the \"subclasses\" of <code>Person</code> has a unique key on <code>PersonID</code>.  A <code>SystemUser</code> may be the same person as a <code>Teacher</code> or a <code>Student</code>; in fact you could conceivably have a person who is all three.</p>\n\n<p>Now, I want to make EF entities to represent <code>Teacher</code>, <code>Student</code> and <code>SystemUser</code>, each of which either actually inherits from <code>Person</code> (1st prize), or at least incorporates the <code>Person</code> fields in the class, implicitly mapping to both underlying tables.</p>\n\n<p>I've found plenty of examples online where they share the same primary key, but none where they do not share the same primary key, i.e. <code>PersonID</code> on the derived tables maps to <code>ID</code> on the <code>Person</code> table.</p>\n\n<p>How do you you do it?</p>\n"},{"tags":["c#","entity-framework","linq-to-entities","ef-code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12998156,"title":"Entity framework. Quering parent entity with subclass property loaded","body":"<p>There is a simple domain..</p>\n\n<pre><code>public abstract class UserComment\n{\n    public string Text { get; set; }\n}\n\npublic class BlogComment : UserComment\n{\n    public Blog Blog { get; set; }\n}\n\npublic class PhotoComment : UserComment\n{\n    public Photo Photo { get; set; }\n}\n</code></pre>\n\n<p>Is there way to query all entities of type <em>UserComment</em> with properties Blog and Photo loaded?</p>\n\n<pre><code>var comment = DbContext.Set&lt;UserComment&gt;()\n    .Include(x =&gt; x.Blog) // will not compile\n    .Include(x =&gt; x.Photo) // will not compile\n    .FirstOrDefault();\n\nif (comment is PhotoComment )\n{\n    string url = (comment as PhotoComment).Photo.Url;\n}\nif (comment is BlogComment)\n{\n    var dateCreated = (comment as BlogComment).Blog.DateCreated;\n}\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12998314,"title":"Entity Framework creating foreign record","body":"<p>I have a User table with foreign key pointing to the Address Table.</p>\n\n<pre><code>public User()\n{\n\n}\n\npublic int UserID { get; set; }\npublic string ReferenceNumber { get; set; }\npublic string FirstName { get; set; }\npublic string SecondName { get; set; }\npublic string Email { get; set; }\npublic string Password { get; set; }\npublic bool IsEnabled { get; set; }\npublic string TelephoneNumber { get; set; }\npublic string FaxNumber { get; set; }\npublic bool IsAccountant { get; set; }\npublic int AddressID { get; set; }\npublic virtual Address Address { get; set; }\n}\n</code></pre>\n\n<p>That's working fine in the view i.e. the user is asked to select AddressID when creating new 'User' record... However, what can I do if the Address record does not exist yet (apart from creating it first) is it possible to somehow point them to the Address View, force them to create Address first and pass the primary key back or put both views on the same page? Many thanks.</p>\n"},{"tags":["entity-framework","asp.net-mvc-3","ef-code-first"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":3357,"score":5,"question_id":5686272,"title":"MVC 3 & ASP.Net with Entity Framework scaffolding error : No model classes are available","body":"<p>I am trying to use MVC3 with the Entity framework with Code First, but the code Template generation process in MS Visual Web Developer 2010 - is not detecting my Model in the models folder - giving a message - \"No Model classes are available\" - although I do have model classes for which I want to create controllers.</p>\n\n<p>The templating option I've selected is \"Controller with read/write actions and views using the Entity Framework\".</p>\n\n<p>I've uninstalled and reinstalled Web Developer 2010, but still having the same error.</p>\n\n<p>Anyone know how I can get around this error?</p>\n"},{"tags":["c#","json","entity-framework","serialization","asp.net-mvc-3"],"answer_count":8,"favorite_count":8,"up_vote_count":16,"down_vote_count":0,"view_count":7787,"score":16,"question_id":5588143,"title":"EF 4.1 - Code First - JSON Circular Reference Serialization Error","body":"<p>I am getting an a Circular Reference Serialization Error although, to my knowledge I do not have any circular references. I am retrieving a set of Orders from the database and sending them to the client as JSON. All the code is shown below.</p>\n\n<p>This is the error:</p>\n\n<blockquote>\n  <p><strong>Error</strong></p>\n  \n  <p>A circular reference was detected\n  while serializing an object of type\n  'System.Data.Entity.DynamicProxies.Order_83CECF2AA4DE38232F9077D4B26941AB96BC61230419EA8AC42C9100E6072812'.\n  Description: An unhandled exception\n  occurred during the execution of the\n  current web request. Please review the\n  stack trace for more information about\n  the error and where it originated in\n  the code. </p>\n  \n  <p>Exception Details:\n  System.InvalidOperationException: A\n  circular reference was detected while\n  serializing an object of type\n  'System.Data.Entity.DynamicProxies.Order_83CECF2AA4DE38232F9077D4B26941AB96BC61230419EA8AC42C9100E6072812'.</p>\n  \n  <p>Source Error: </p>\n  \n  <p>An unhandled exception was generated\n  during the execution of the current\n  web request. Information regarding the\n  origin and location of the exception\n  can be identified using the exception\n  stack trace below.</p>\n</blockquote>\n\n<p>My classes are as follows:</p>\n\n<p><strong>Order</strong></p>\n\n<pre><code>public class Order\n{\n    [Key]\n    public int OrderId { get; set; }\n\n    public int PatientId { get; set; }\n    public virtual Patient Patient { get; set; }\n\n    public int CertificationPeriodId { get; set; }\n    public virtual CertificationPeriod CertificationPeriod { get; set; }\n\n    public int AgencyId { get; set; }\n    public virtual Agency Agency { get; set; }\n\n    public int PrimaryDiagnosisId { get; set; }\n    public virtual Diagnosis PrimaryDiagnosis { get; set; }\n\n    public int ApprovalStatusId { get; set; }\n    public virtual OrderApprovalStatus ApprovalStatus { get; set; }\n\n    public int ApproverId { get; set; }\n    public virtual User Approver { get; set; }\n\n    public int SubmitterId { get; set; }\n    public virtual User Submitter { get; set; }\n\n    public DateTime ApprovalDate { get; set; }\n\n    public DateTime SubmittedDate { get; set; }\n    public Boolean IsDeprecated { get; set; }\n}\n</code></pre>\n\n<p><strong>Patient</strong></p>\n\n<pre><code>public class Patient\n{\n    [Key]\n    public int PatientId { get; set; }\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public string MiddleInitial { get; set; }\n    public bool IsMale;\n    public DateTime DateOfBirth { get; set; }\n\n    public int PatientAddressId { get; set; }\n    public Address PatientAddress { get; set; }\n\n    public bool IsDeprecated { get; set; }\n}\n</code></pre>\n\n<p><strong>Certification Period</strong></p>\n\n<pre><code>public class CertificationPeriod\n{\n    [Key]\n    public int CertificationPeriodId { get; set; }\n    public DateTime startDate { get; set; }\n    public DateTime endDate { get; set; }\n    public bool isDeprecated { get; set; }\n}\n</code></pre>\n\n<p><strong>Agency</strong></p>\n\n<pre><code>public class Agency\n{\n    [Key]\n    public int AgencyId { get; set; }\n    public string Name { get; set; }\n\n    public int PatientAddressId { get; set; }\n    public virtual Address Address { get; set; }\n}\n</code></pre>\n\n<p><strong>Diagnosis</strong></p>\n\n<pre><code>public class Diagnosis\n{\n    [Key]\n    public int DiagnosisId { get; set; }\n    public string Icd9Code { get; set; }\n    public string Description { get; set; }\n    public DateTime DateOfDiagnosis { get; set; }\n    public string Onset { get; set; }\n    public string Details { get; set; }\n}\n</code></pre>\n\n<p><strong>OrderApprovalStatus</strong></p>\n\n<pre><code>public class OrderApprovalStatus\n{\n    [Key]\n    public int OrderApprovalStatusId { get; set; }\n    public string Status { get; set; }\n}\n</code></pre>\n\n<p><strong>User</strong></p>\n\n<pre><code>public class User\n{\n    [Key]\n    public int UserId { get; set; }\n    public string Login { get; set; }\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public string NPI { get; set; }\n    public string Email { get; set; }\n\n}\n</code></pre>\n\n<blockquote>\n  <p><strong>NOTE: ADDRESS CLASS IS NEW ADDITION DURING EDIT</strong></p>\n</blockquote>\n\n<p><strong>Address</strong></p>\n\n<pre><code>public class Address\n{\n    [Key]\n    public int AddressId { get; set; }\n    public string StreetAddress { get; set; }\n    public string City { get; set; }\n    public string State { get; set; }\n    public string Zip { get; set; }\n    public string Phone { get; set; }\n    public string Title { get; set; }\n    public string Label { get; set; }\n}\n</code></pre>\n\n<p>The code that executes the serialization is here:</p>\n\n<p><strong>Excerpt from OrderController</strong></p>\n\n<pre><code>    public ActionResult GetAll()\n    {\n        return Json(ppEFContext.Orders, JsonRequestBehavior.AllowGet);\n    }\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":701,"score":0,"question_id":4365552,"title":"Entity Framework 4.0 Update POCO relationship","body":"<p>I have created the POCO class and it's equivalent in edmx file (Category entity with only one way navigation property Parent) </p>\n\n<pre><code>public class Category {\n    public int ID {get;set;}\n    public string Name {get;set;}\n    public Category Parent {get;set;}\n} \n</code></pre>\n\n<p>And I have an issue with CRUD operations affecting Parent property:</p>\n\n<p>Retrieve looks like:</p>\n\n<pre><code>public void CanRetrieve() {\nvar category = context.Categories.Where(x =&gt; x.ID == id).FirstOrDefault();\ncotext.LoadProperty&lt;Category&gt; (category, c =&gt; c.Parent);\n\n}\n</code></pre>\n\n<p>ant is working fine (i get Category object with Parent property filled)</p>\n\n<p>Add looks like:</p>\n\n<pre><code>public void CanAdd() {\n    Category cat = new Category();\n    cat.Name = \"cat 1\";    \n    cat.Parent = new Category() {ID = 12}; //assuming that in the database there is a record with ID 12 \n    context.Categories.Attach(cat);\n    context.SaveChanges();\n}\n</code></pre>\n\n<p>Is also working fine (in the DB new record appears with Parent_ID field set to 12)</p>\n\n<p>And Update:</p>\n\n<pre><code>public void CanUpdate() {\n    Category cat = new Category();\n    cat.Name = \"cat 1\";    \n    cat.Parent = new Category() {ID = 12}; //assuming that in the database there is a record with ID 12 \n    context.Categories.Attach(cat);\n    //XXX    \n    context.SaveChanges()\n}\n</code></pre>\n\n<p>does anything. If I replace the //XXX line with the following line:</p>\n\n<pre><code>Context.ObjectStateManager.ChangeObjectState(cat, EntityState.Modified); \n</code></pre>\n\n<p>the value of Name property is updated form the source object (I guess other scalar properties would also be) but the Parent is ignored and the Parent_ID field in the base is preserved. </p>\n\n<p>My question is: How in this scenario can I tell the context I want the Parent property value also reflected to the database and can it be done without passing all the values of Parent property (only an ID, just like in Adding scenario)?</p>\n\n<p>Best regards, </p>\n\n<p>Andrzej</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12824776,"title":"Automatically delete orphaned childs: Childs will not be deleted for the second Commit","body":"<p>Further to question <a href=\"http://stackoverflow.com/questions/10835439/can-ef-automatically-delete-data-that-is-orphaned-where-the-parent-is-not-delet\">Can EF automatically delete data that is orphaned, where the parent is not deleted?</a></p>\n\n<p>I checked the solution, as @Ladislav suggested here\n<a href=\"http://stackoverflow.com/a/10838228/54801\">http://stackoverflow.com/a/10838228/54801</a>\n<strong>Unfortunately I noticed that the solution works partially.</strong></p>\n\n<p>If we take the following code:</p>\n\n<pre><code> for (int k = 0; k &lt; 2; k++)\n {\n     var parentObject= _context.Parents.Get(1704);\n     parentObject.ChildObjects.Clear();\n\n     var childObject= _context.ChildObjects.Get(1000*k /*diffrent child for each iteration*/ );\n     parentObject.ChildObjects.Add(childObject);\n\n     _context.Commit();\n  }\n</code></pre>\n\n<p>The first iteration (k=0) was carried out deletion. <strong>But the second iteration will not delete!</strong></p>\n\n<p>Does anyone have a solution to the problem?</p>\n\n<p>The problem can be \"solved\" as shown here:</p>\n\n<pre><code>if(k == 1)\n{\n    foreach (var project in tender.TenderProjects)\n      {\n         _context.Projects.Remove(project);\n      }\n   }\n</code></pre>\n\n<p>But it's definitely not ideal\nI want my services out of any ORM logic..</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>The Iteration is just an example of the real scenario. Real scenario, the user can add the parent entity's first child. save the data and go again to remove the first child and add two other childs in his place</p>\n"},{"tags":["entity-framework","mono","monodevelop"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12997772,"title":"monodevelop entity framework integration","body":"<p>I have the last git of mono &amp; monodevelop which support entity framework.\nI can add the reference in my project but it seems that monodevelop do not generate edmx file from database.</p>\n\n<p>Do you know if this feature exist or is there is a solution to generate ORM mapping from database.</p>\n\n<p>I have try the menu item [Tool->Database->Generate Linq class]</p>\n\n<p>I select the connexion database and test it successfully.\nBut when I valide I get an exception:\nMonoDevelop.Database.Sql.SqlMetalExecException: sqlmetal: Could not load databaseConnectionType type 'ByteFX.Data.MySqlClient.MySqlConnection, ByteFX.Data'.  Try using the --with-dbconnection=TYPE option.</p>\n\n<p>I do not understand this advice in exception...</p>\n"},{"tags":["winforms","entity-framework","data-binding"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":175,"score":0,"question_id":8984329,"title":"Adding a New Entity via Data Binding on a Details Form.","body":"<p>How can I use data binding on a details form to add a new entity to my data source? I have created an Object data source, and dragged it onto my form as 'details', which automatically adds a bindingSource and bindingNavigator control to my form, in addition to data bound detail fields. I have the following code which all executes with no exceptions, but no new Branch record gets added when I click 'Add New' and then 'Save'.</p>\n\n<pre><code>private void BranchEditForm_Load(object sender, EventArgs e)\n{\n    branchBindingSource.DataSource = _loansEntities.Branches;\n}\n\nprivate void branchBindingNavigatorSaveItem_Click(object sender, EventArgs e)\n{\n    _loansEntities.SaveChanges(SaveOptions.AcceptAllChangesAfterSave);\n}\n</code></pre>\n\n<p>I can't seem to find any Entity Framework data binding examples that don't just default to grids.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":63,"score":4,"question_id":12996314,"title":"EF multiple relationships","body":"<p>Using Entity Framework 5</p>\n\n<p>So I have a Customer. The Customer could have many Addresses, but at least one. One of the addresses would also be set as the primary address (required). I tried various mappings, but so far I get an error on build or when I seed the database.</p>\n\n<p>Customer:</p>\n\n<pre><code>public class Customer\n{\n    public int CustomerId { get; set;}\n    public String CustomerName { get; set; }\n    public int PrimaryAddressId { get; set; }\n    public virtual CustomerAddress PrimaryAddress { get; set; }\n    public virtual ICollection&lt;CustomerAddress&gt; CustomerAddresses { get; set; }    \n}\n</code></pre>\n\n<p>Address:</p>\n\n<pre><code>public class CustomerAddress : Address\n{\n    public int CustomerAddressId { get; set; }\n    public int CustomerId { get; set; }\n    public virtual Customer Customer { get; set; }\n}\n</code></pre>\n\n<p>This part of my mapping is working correctly. It is on CustomerAddress.</p>\n\n<pre><code>        this.HasRequired(c =&gt; c.Customer)\n            .WithMany(d =&gt; d.CustomerAddresses)\n            .HasForeignKey(c =&gt; c.CustomerId);\n</code></pre>\n\n<p>But how do I specify the correct mapping for setting PrimaryAddress in Customer? Or is it the wrong approach?</p>\n\n<p>Thanks</p>\n\n<p><strong>EDIT - Using both Arnolds and LueTM's answers:</strong></p>\n\n<p>This code is now working.</p>\n\n<p>Customer:</p>\n\n<pre><code>public class Customer\n{\n    public int CustomerId { get; set;}\n    public String CustomerName { get; set; }\n    // public int PrimaryAddressId { get; set; } created in mapping\n    public virtual CustomerAddress PrimaryAddress { get; set; }\n    public virtual ICollection&lt;CustomerAddress&gt; CustomerAddresses { get; set; }    \n}\n</code></pre>\n\n<p>Address:</p>\n\n<pre><code>public class CustomerAddress : Address\n{\n    public int CustomerAddressId { get; set; }\n    public int CustomerId { get; set; }\n    public virtual Customer Customer { get; set; }\n}\n</code></pre>\n\n<p>Customer mapping:</p>\n\n<pre><code>        modelBuilder.Entity&lt;Customer&gt;\n            .HasOptional(c =&gt; c.PrimaryAddress)\n            .WithOptionalDependent().Map(m =&gt; m.MapKey(\"PrimaryAddressId\"));\n\n        modelBuilder.Entity&lt;Customer&gt;\n            .HasMany(c =&gt; c.CustomerAddresses)\n            .WithRequired(c =&gt; c.Customer)\n            .HasForeignKey(c =&gt; c.CustomerId)\n            .WillCascadeOnDelete(false);\n</code></pre>\n\n<p>And I use a repository to make sure that a new address is created first, saved, and then also set as primary and saved again. The repository makes sure the primary is \"required\".</p>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4","visual-studio-2012","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12995349,"title":"What is the data annotation for changing nullable and not null data types?","body":"<p>I reckon this should be simple for experienced programmers but here it goes. I am working on a project using entity framework code first.I have also enabled migrations and set to auto (Lovely feature).</p>\n\n<p>I stupidly declared one of the datatype wrong in my entity class and now i realised that it wouldn't work with what i was trying to do. Must have been the auto complete feature. But anyways, the field was nullable and now that i have changed it to what i want, it has set the field to \"not null\".</p>\n\n<p>Originally: <code>public virtual Byte[] ImageData { get; set; }</code></p>\n\n<p>Changed to: <code>public virtual byte ImageData { get; set; }</code></p>\n\n<p>Now that i have changed and built the solution, <code>update-database -force</code> will not work and throws an error that:</p>\n\n<pre><code>Cannot insert the value NULL into column 'ImageData', column does not allow nulls. UPDATE fails. The statement has been terminated.\n</code></pre>\n\n<p>Is there a Data Annotation i could use to set this field back to nullable?</p>\n\n<p>eg: <code>[DataType(DataType.Upload)]</code></p>\n\n<p>I have looked through here for a considerable amount of time and i can't seem to find what i am looking for.</p>\n"},{"tags":["c#","sql","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12990960,"title":"Restoring virtual member in SqlQuery<>()","body":"<p>In order to enhance the request time of a page with a lot of data, I am trying to use Context.Database.SqlQuery method, instead of using LINQ</p>\n\n<pre><code>Context.Database.SqlQuery&lt;Inschrijving&gt;(\"select * from dbo.inschrijving join dbo.duif on dbo.duif.duifid = dbo.inschrijving.duifid  where vluchtid = {0} and duivenmelker_duivenmelkerid = {1}\",vluchtId, duivenmelker.DuivenmelkerId);\n</code></pre>\n\n<p>This works, but in my class i use virtual members. These are null with the sqlquery method.</p>\n\n<p>I have tried other types of joins, at the moment I am using a method to restore the virtual object with the id.</p>\n\n<p>snippet of the class with virtual object:</p>\n\n<pre><code>[Key,ForeignKey(\"Duif\"), Column(Order = 0)]\npublic int DuifId { get; set; }\npublic virtual Duif Duif { get; set; }\n</code></pre>\n\n<p>How could I restore the virtual members in the object (in a better way)?</p>\n\n<p>Is there a way to do this all at once in the sqlquery?</p>\n"},{"tags":["entity-framework","visual-studio-2008-sp1",".net-3.5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":4124091,"title":"Is Entity Framework included with .NET 3.5 SP1?","body":"<p>I use Visual Studio 2008 Professional with .NET 3.5 SP1 installed. It is not showing Entity Model when I select \"New Project\". The MSDN links show that it was included with .NET 3.5 SP1. </p>\n\n<p>Why it is not appearing on my VS 2008?</p>\n"},{"tags":["entity-framework","ef4-code-only"],"answer_count":1,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":389,"score":4,"question_id":4124092,"title":"Junction table with aditional columns in EF4 CTP4 Code First","body":"<p>Given this sql schema:</p>\n\n<pre><code>create table [dbo].[Courses_Students] (\n    [DummyColumn] [int] null,\n    [CourseId] [int] not null,\n    [StudentId] [int] not null,\n    primary key ([CourseId], [StudentId])\n);\n</code></pre>\n\n<p>How do I define the composite primary key and the additional columns in the <code>EntityConfiguration</code>?</p>\n"},{"tags":["c#","wpf","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12996163,"title":"Creating class files based on entities","body":"<p>I am trying to create class files for entities ( ORM => entity framework ) to create a better structured code-behind file system. The problem is that the entities are not being loaded if they are put in a separate class file. I am using c# / WPF</p>\n\n<p>I reference the entities a heck of a lot are there is a lot of logic created by manipulating the entities that have already been called. I have tried to narrow down my problem and am really struggling. I think the problem lies in the \"findResource\"</p>\n\n<pre><code>System.Windows.Data.CollectionViewSource employeesViewSource = ((System.Windows.Data.CollectionViewSource)(d.FindResource(\"employeesViewSource\")));\n</code></pre>\n\n<p>The \"d\" is an instance back to the main file. So its </p>\n\n<pre><code>Dashboard d = new Dashboard();\n</code></pre>\n\n<p>The entity becomes a collection resource which is referenced in the xaml in Dashbaord.xaml</p>\n\n<pre><code>&lt;CollectionViewSource x:Key=\"employeesViewSource\" d:DesignSource=\"{d:DesignInstance {x:Type my:Employee}, CreateList=True}\" /&gt;\n</code></pre>\n\n<p>which is then referenced in the listbox.</p>\n\n<p>its just not working though. And i am not to sure why. If i go through the debugger in VS and step through the processes it seems as it everything is working fine. It goes to the class file and runs through as it would otherwise but the results just do not show.</p>\n\n<p>//Example of one of the created entity classes which is called in the window_loaded event by Entity.LoadFarmFields();</p>\n\n<pre><code>public static void LoadFarmFields()\n{\n    var context = new LCEntities();\n    // Load data into EmployeeActivities. You can modify this code as needed.\n    System.Windows.Data.CollectionViewSource farmFieldsViewSource = ((System.Windows.Data.CollectionViewSource)(d.FindResource(\"farmFieldsViewSource\")));\n    System.Data.Objects.ObjectQuery&lt;Model.FarmField&gt; farmFieldsQuery = GetFarmFieldsQuery(context, d.txtbxFarmSearch.Text);\n    farmFieldsViewSource.Source = farmFieldsQuery.Execute(System.Data.Objects.MergeOption.AppendOnly);\n}\n\npublic static System.Data.Objects.ObjectQuery&lt;FarmField&gt; GetFarmFieldsQuery(LCEntities LCEntities, string searchCriteria)\n{\n   System.Data.Objects.ObjectQuery&lt;Model.FarmField&gt; farmFieldsQuery =\n       (from _ in LCEntities.FarmFields\n        where _.FarmFieldName.Contains(searchCriteria)\n        orderby _.FarmFieldName ascending\n        select _) as System.Data.Objects.ObjectQuery&lt;FarmField&gt;;\n        // Returns an ObjectQuery.\n   return farmFieldsQuery;\n}\n</code></pre>\n\n<p>Any suggestions? I feel like i am a bit out of my depth here. I normally just work on the ui >&lt;</p>\n"},{"tags":[".net","entity-framework","c#-4.0","sqlbulkcopy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":50,"score":-2,"question_id":12995854,"title":"SqlBulkCopy WriteToServer method","body":"<p>I want to write rows from my <code>List&lt;&gt;</code> collection into a database table. The problem is that using <code>SqlBulkCopy</code> data is not updated in the table after executing the method for writing to server.</p>\n\n<p>Here is a piece of code:</p>\n\n<pre><code>List&lt;TP_Margins&gt; modifiedMargins = new List&lt;TP_Margins&gt;();\n\nvar dataManager = RepositoryContextFactory.GetContext();\n\nusing (var bulkCopy = new SqlBulkCopy(dataManager.ConnectionString))\n{\n    bulkCopy.DestinationTableName = \"TP_Margins\";\n    bulkCopy.ColumnMappings.Add(new SqlBulkCopyColumnMapping(\"Id\", \"TP_Id\"));\n    bulkCopy.ColumnMappings.Add(new SqlBulkCopyColumnMapping(\"TRKey\", \"TP_TRKey\"));\n    bulkCopy.ColumnMappings.Add(new SqlBulkCopyColumnMapping(\"SvKey\", \"TP_SvKey\"));\n\n    bulkCopy.WriteToServer(modifiedMargins.AsDataReader());\n}\n</code></pre>\n\n<p>No exceptions or errors, but also no updates in database. Where I was wrong?</p>\n"},{"tags":["entity-framework","join"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":32,"score":0,"question_id":12995095,"title":"multiple join query in entity framework","body":"<p>I have following tables  </p>\n\n<p>tasks<br>\nid | name   | proj_id<br>\n1  | task1  | 1<br>\n2  | task2  | 1<br>\n3  | task3  | 1  </p>\n\n<p>projects<br>\nid | name<br>\n1  | sample proj1<br>\n2  | demo project  </p>\n\n<p>budget_versions<br>\nid | version_name| proj_id<br>\n1  | 50          | 1  </p>\n\n<p>budgets<br>\nid | cost  | budget_version_id | task_id<br>\n1  | 3000  | 1                 | 2<br>\n2  | 5000  | 1                 | 1  </p>\n\n<p>I need to join these tables to get a result as below using entity framework</p>\n\n<p>task_id | task_name | project_id | budget_version | budget_id | cost<br>\n1       | task1     | 1          | 1              | 2         |5000<br>\n2       | task2     | 1          | 1              | 1         |3000<br>\n3       | task3     | 1          | NULL           | NULL      |NULL   </p>\n\n<p>select tsk.id,tsk.name, tsk.project_id, bgtver.id, bgt.id, bgt.cost \nfrom TASK tsk\nleft outer join BUDGET_VERSIONS bgtver\non tsk.project_id= bgtver.project_id\nleft outer join BUDGETS bgt\non bgtver.id = bgt.budget_version_id  and tsk.id = bgt.task_id\nwhere bgtver.id = 1</p>\n\n<p>This is what I have tried so far  </p>\n\n<p>var budgetlists = _worker.Budgets.Get().GroupJoin(_worker.BudgetVersions.Get(),\n                                                             rb => rb.budget_version_id, rbv => rbv.id,\n                                                             (rb, rbrbv) => new {rb, rbrbv}).SelectMany(\n                                                               @t => @t.rbrbv.DefaultIfEmpty()).GroupJoin(\n                                                                 _worker.Tasks.Get(), rbrbv => rbrbv.id, tsk => tsk.id,\n                                                                 (rbrbv, tskrb) => new {rbrbv, tskrb}).SelectMany(\n                                                                   @p => @p.tskrb.DefaultIfEmpty());</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12349215,"title":"Entity Framework is there a way to see what is in cache?","body":"<p>Is there a way of looking at whats already in cache? I just want to ensure that I'm not making repeated database calls.</p>\n"},{"tags":["entity-framework","code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":274,"score":1,"question_id":7654879,"title":"EF Codefirst, One class, multiple tables with discriminator","body":"<p>I doing a little investigation and I am wondering if the following is possible.</p>\n\n<p>I am looking to create a BaseEntityWithDetails class that I can reuse for any type that I would like to have extendable. For example</p>\n\n<pre><code>public abstract class EntityDetail\n{\n}\n</code></pre>\n\n<p>This class is used to persist a key and value for the entity.</p>\n\n<p>\"Products\" would be extended by doing the following...</p>\n\n<pre><code>public class ProductDetail : EntityDetail\n{\n\n}\n\npublic class Product : BaseEntityWithDetails&lt;ProductDetail&gt;\n{\n\n}\n</code></pre>\n\n<p>The base class \"BaseEntityWithDetails\" will provide some helper methods for setting and getting. What do you think? </p>\n\n<p>What is the most effective way of mapping this with EF CodeFirst while being super easy to allow another type implement an DetailsEntityTypeConfiguration like the following</p>\n\n<pre><code>public class ProductMap : DetailsEntityTypeConfiguration&lt;Product, ProductDetail&gt;\n{\n}\n</code></pre>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12988981,"title":"Is there a baked in way to do Orderby or is this still state of the art for EF4.X","body":"<p><a href=\"http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx\" rel=\"nofollow\">http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx</a></p>\n\n<p>I looking to use EF with jqGrid and minimize plumbing. Therefore it interests me to find a generalized solution similiar to what Scott suggests. I am curious if this has been baked into EF or if this is still this is still the best way.</p>\n\n<p>Specifically:\nentity.Orderby(\"fieldName\");</p>\n"},{"tags":["entity-framework","build","export"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12991967,"title":"Entity Framework - Export Diagram from command line","body":"<p>Is there a way to export the entity framework diagram from the command line? I want to output a .png copy of the diagram as part of my CI builds.</p>\n\n<p>I assume you could re-use one of the libraries that Visual Studio uses, but I haven't been able to figure out which ones with ILSpy/dotpeek.</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12961148,"title":"How to associate one table to many parents using EF Code First","body":"<p>I am building a domain model that requires several tables to be able to be references by more than one possible parent table.  Something like you might have a table to store notes or files and those notes and/or files can be associated with different parent entities.  Not that the same \"file\" or \"note\" can be associate with multiple owners, but that of 10 rows in a \"files\" table, 3 of them might be owned by rows from a \"Customer\" table, 3 of them might be owned by rows from an \"Orders\" table, and 4 of them might be owned by rows from a \"Person\" table.</p>\n\n<p>The owning tables all have virtual ICollections of the child tables.</p>\n\n<p>When I ran my model through the code first migration for the initial migration, and looked at the generated fluent code, the table definition for these tables included multiple id columns that referred back to the source table, so that there would be a column \"customer_id,\" \"person_id,\" etc. (one for each possible \"owning entity.\"  This doesn't seem quite \"right.\"  Is there a better way to model this in EF with CodeFirst?  Like being able to use a discriminator column in the child table that provides a \"hint\" about the owning entity?</p>\n\n<p>Thanks,\n-MrB</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":65,"score":2,"question_id":12987738,"title":"I am getting less data using entity in MVVM","body":"<p>I added view into model. After that i created Domain service.</p>\n\n<p>I tried to add the view data to grid. </p>\n\n<pre><code>VReportViewer.GrdReport.ItemsSource = dcBusinessAccountingContext.SalesDetailViews;    \n</code></pre>\n\n<p>If i run with same view in sql server. I am getting 170 rows data. But using entity i am getting only 94 rows data.Can any body give me the idea any where i am doing mistake.</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":160,"score":1,"question_id":12990577,"title":"Entity Framework 5 Code First Relationships","body":"<p>I'm having trouble understanding how to create relationships between classes on a project that I'm building.</p>\n\n<p>I have a class <code>Photo</code> that has a required one-to-one relationship with <code>PhotoExif</code>, and <code>Photo</code> has an optional one-to-one relationship with <code>FeaturedPhoto</code>.</p>\n\n<p>I'm getting the error:</p>\n\n<blockquote>\n  <p>Unable to determine composite primary key ordering for type <code>Website.Models.PhotoExif</code>. Use the <code>ColumnAttribute</code> or the <code>HasKey</code> method to specify an order for composite primary keys.</p>\n</blockquote>\n\n<p>Help would be much appreciated.</p>\n\n<p><strong>Photo.cs</strong></p>\n\n<pre><code>public class Photo\n{\n    [Key]\n    public int PhotoID { get; set; }\n\n    public string Title { get; set; }\n\n    public string Description { get; set; }\n    public Orientation Orientation { get; set; }\n    public int Rating { get; set; }\n    public string URL { get; set; }\n    public string Filename { get; set; }\n    public DateTime DateAdded { get; set; }\n    public bool Hide { get; set; }\n    public string MetaDescription { get; set; }\n    public string MetaKeywords { get; set; }\n\n    public virtual PhotoExif PhotoExif { get; set; }\n} \n</code></pre>\n\n<p><strong>PhotoExif.cs</strong></p>\n\n<pre><code>public class PhotoExif\n{\n    [Key]\n    public int PhotoExifID { get; set; }\n\n    public int PhotoID { get; set; }\n\n    public string ShutterSpeed { get; set; }\n    public string Aperture { get; set; }\n    public string FocalLength { get; set; }\n    public int ISO { get; set; }\n    public string ExposureBias { get; set; }\n    public bool Flash { get; set; }\n    public string WhiteBalance { get; set; }\n    public string Lens { get; set; }\n    public DateTime DateTaken { get; set; }\n    public float Longitude { get; set; }\n    public float Latitude { get; set; }\n    public int Zoom { get; set; }\n    public string Location { get; set; }\n\n    public virtual Photo Photo { get; set; }\n}\n</code></pre>\n\n<p><strong>FeaturedPhoto.cs</strong></p>\n\n<pre><code>public class FeaturedPhoto\n{\n    [Key]\n    public int FeaturedPhotoID { get; set; }\n\n    public DateTime StartDate { get; set; }\n    public DateTime EndDate { get; set; }\n    public string InformationLocation { get; set; }\n    public string ImagePosition { get; set; }\n\n    public virtual Photo Photo { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","sql-server","entity-framework","tsql","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":69,"score":0,"question_id":12990538,"title":"How to convert this SQL query to LINQ to Entities query?","body":"<p>I need help to convert a SQL query to entity query in my C# code.\nThe query combines 4 different tables together which is as follows:</p>\n\n<pre><code>SELECT a.email,\n       a.status,\n       a.createdat,\n       b.unitprice,\n       c.name,\n       d.name,\n       e.name \nFROM Orders a, \n     Orderdetails b, \n     ServiceOptions c, \n     services d, \n     merchants e \nWHERE a.id=b.orderid AND c.id=b.serviceoptionid\n      AND c.serviceid=d.id AND d.merchantid=e.id\n</code></pre>\n"},{"tags":["performance","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12990662,"title":"EF5 .Local performance","body":"<p>I'm doing this on a table with ~43k rows:</p>\n\n<pre><code>MyDbContext.Stores.Load();\nMyDbContext.Stores.Local.Count.Dump(); //horrible performance!\n</code></pre>\n\n<p>I can see through the profiler that the first instruction fires up the select statement to fetch all rows. Actually the second instruction returns the correct value but after ~12 seconds, and it is not what I was expecting considering that all data should be in memory.\nWhat is wrong (or what is its real purpose) with .Local in Entity Framework?</p>\n"},{"tags":["asp.net","entity-framework","visual-studio-2012","code-first-migrations"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":226,"score":1,"question_id":12318107,"title":"Enabling Code First Entity Framework VS Web Express 2012","body":"<p>I am trying to enable Code First in my Visual Studio Web Express 2012. From what I have read so far I have to use the Package Manager Console and the command Enable-Migrations.  When I do this I get the following error. </p>\n\n<pre><code>Exception calling \"LoadFrom\" with \"1\" argument(s): \"Could not load file or assembly 'file:///E:\\Working\\wingtoysdl\\C#\\packages\\EntityFramework.5\n.0.0\\tools\\EntityFramework.PowerShell.Utility.dll' or one of its dependencies. Operation is not supported. (Exception from HRESULT: 0x80131515)\"\nAt E:\\Working\\wingtoysdl\\C#\\packages\\EntityFramework.5.0.0\\tools\\EntityFramework.psm1:398 char:62\n+     $utilityAssembly = [System.Reflection.Assembly]::LoadFrom &lt;&lt;&lt;&lt; ((Join-Path $toolsPath EntityFramework.PowerShell.Utility.dll))\n    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException\n    + FullyQualifiedErrorId : DotNetMethodException\n\nYou cannot call a method on a null-valued expression.\nAt E:\\Working\\wingtoysdl\\C#\\packages\\EntityFramework.5.0.0\\tools\\EntityFramework.psm1:399 char:50\n+     $dispatcher = $utilityAssembly.CreateInstance &lt;&lt;&lt;&lt; (\n    + CategoryInfo          : InvalidOperation: (CreateInstance:String) [], RuntimeException\n    + FullyQualifiedErrorId : InvokeMethodOnNull\n\nException calling \"CreateInstanceFrom\" with \"8\" argument(s): \"Could not load file or assembly 'file:///E:\\Working\\wingtoysdl\\C#\\packages\\EntityF\nramework.5.0.0\\tools\\EntityFramework.PowerShell.dll' or one of its dependencies. Operation is not supported. (Exception from HRESULT: 0x80131515\n)\"\nAt E:\\Working\\wingtoysdl\\C#\\packages\\EntityFramework.5.0.0\\tools\\EntityFramework.psm1:431 char:31\n+     $domain.CreateInstanceFrom &lt;&lt;&lt;&lt; (\n    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException\n    + FullyQualifiedErrorId : DotNetMethodException\n</code></pre>\n\n<p>As you can see it is a very large error making it very hard to google and troubleshoot. Does anyone have any ideas on how I can fix this?</p>\n"},{"tags":["c#","asp.net","entity-framework","asp.net-webforms",".net-4.5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":42,"score":-2,"question_id":12990585,"title":"Web page is blank at runtime","body":"<p>I just deployed a asp.net 4.5 web application with c#. When I go to the page it is blank on the site no errors are posted. When you view source there is no markup. I ftp'ed into the server to see if the files where there and what they looked like.  They are all there with the correct connections strings and so fourth. I then took the site and ran it locally looking at the production DB. Site works great!.\n So then i am confused and i make a template site and I don't change a thing besides the web config file and publish that. That site works fine so i don't get it not at all. i don't even know where to start to troubleshoot. Have any of you encountered this issue before?</p>\n\n<p>There were no error at any point of the build or publish. I am sorry for not posting code but i don't no what to post. </p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12990489,"title":".net linq entity framework groupby","body":"<p>I have a db table with columns like\nDaysInTrade, PercentGain</p>\n\n<p>i want a sum of PercentGain grouped by DaysInTrade</p>\n\n<p>so:</p>\n\n<pre><code>DaysInTrade,PercentGain\n1, 5\n1,6\n2,4\n</code></pre>\n\n<p>Would give me:</p>\n\n<pre><code>DaysInTrade, Sum\n1, 11\n2,4\n</code></pre>\n\n<p>I was not able to get intellisense working in the \"select new\" part unless I used something like Sum or Select.  the DIT column below shows up blank no matter if I do ts.DaysInTrade, or gts.DaysInTrade</p>\n\n<pre><code>        var partialQuery = (from ts in context.TradeSnapshots\n                            group ts by ts.DaysInTrade\n                            into gts\n                            select\n                            new\n                                {\n                                    profit = gts.Sum(s =&gt; s.PercentGain),\n                                    DIT = gts.Select(ts=&gt;ts.DaysInTrade)\n                                });\n        dataGridViewTradeSnapshots.DataSource = partialQuery.ToList(); \n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12966844,"title":"Dynamic query using OR and Contains in Entity Framework","body":"<p>Given a string like this:</p>\n\n<pre><code>var filterOptions = \"First Bank\";\n</code></pre>\n\n<p>And a table that has a Grantee column and a Grantor column, how do I create a query with EF that will generate the following where clause:</p>\n\n<pre><code>... where (Grantor like '%First%' and Grantor like '%Bank%') or (Grantee like '%First%' and Grantee like '%Bank%')\n</code></pre>\n\n<p>Keep in mind that filterOptions is a parm that is passed in, so it could just as easily contain 3 or 4 words rather than just two ... in which case each column would need additional like clauses.</p>\n\n<p>If it weren't for the OR part of this, I would do the following (which will help give a better idea of what I'm trying to accomplish.</p>\n\n<pre><code>foreach(var word in filterOptions)\n{\n    var text = \"%\" + word + \"%\";\n    query = query.Where(r =&gt; SqlMethods.Like(r.Grantee,text));\n}\n</code></pre>\n\n<p>Like I said, its trying to add the OR portion with the other column that throws me for a loop.</p>\n"},{"tags":["wpf","entity-framework","mvvm","usercontrols","binding"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1206,"score":3,"question_id":5359730,"title":"How to reuse entity framework datasource for multiple views WPF EF MVVM","body":"<p>Hi I am designing an application using WPF4, EF and MVVM. I want to be able to create reusable UserControls that I can use in multiple windows in the application, and have them draw data from the same source. </p>\n\n<p>Lets say I have a GraphView component and a TableView component that can appear on the same page or in different places in the application, and I want them to both reflect the same collection of filtered EF entities. MVVM common practice seems to require that each view has its own viewmodel. But should I be be using a joint viewmodel and bind both to it, so if you change the data or filter, both would update simultaneously? If not how should I handle this?</p>\n\n<p>Thanks for any advice!</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":59,"score":3,"question_id":12989699,"title":"Entity FrameWork many-to-many","body":"<pre><code>public class Project\n{\n\n\n    public virtual int ID { get; set; }\n\n    [Required]\n    public virtual String Title { get; set; }\n\n\n    public String Definition { get; set; }\n    public DateTime StartDate { get; set; }\n\n\n    [Required]\n    public int CreaterID { get; set; }\n\n    public virtual ICollection&lt;Status&gt; Status { get; set; }\n    public virtual ICollection&lt;Task&gt; Tasks { get; set; }\n    public virtual ICollection&lt;User&gt; Users { get; set; }\n\n    public Project()\n    {\n        Users = new HashSet&lt;User&gt;();\n    }\n\n\n}\n\n\npublic class User\n{\n    public int ID { get; set; }\n\n\n    [DisplayName(\"Kullanıcı Adı\")]\n    [Required]\n    [MinLength(5, ErrorMessage = \"Kullanıcı Adı En Az 5 Karakter Olmalıdır\")]\n    public string username { get; set; }\n\n    [DataType(DataType.Password)]\n    [DisplayName(\"Şifre\")]        \n    [Required]\n    [MinLength(3,ErrorMessage=\"Şifre En Az  3 Karakter Olmalıdır\")]\n    public string password { get; set; }\n\n    [Required]\n    public String Name { get; set; }\n\n    [Required]\n    public String Surname { get; set; }\n\n    public int? CreaterID { get; set; }\n    public int level { get; set; }\n\n    public ICollection&lt;Task&gt; Tasks { get; set; }\n    public ICollection&lt;Project&gt; Projects { get; set; }\n\n    public User()\n    {\n        Projects = new HashSet&lt;Project&gt;();\n    }\n}\n\n\npublic class TaskDB : DbContext\n{\n    public DbSet&lt;Comment&gt; Comments { get; set; }\n    public DbSet&lt;Project&gt; Projects { get; set; }\n    public DbSet&lt;Situation&gt; Situaitons { get; set; }\n    public DbSet&lt;Task&gt; Tasks { get; set; }\n    public DbSet&lt;User&gt; Users { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;Project&gt;().\n          HasMany(c =&gt; c.Users).\n          WithMany(p =&gt; p.Projects).\n          Map(\n           m =&gt;\n           {\n               m.MapLeftKey(\"ProjectId\");\n               m.MapRightKey(\"UserId\");\n               m.ToTable(\"ProjectUser\");\n           });\n    }\n\n}\n</code></pre>\n\n<p>If I add project , current user added to project users list but project not added current user's projects list \nThis is my project add code</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Create(Project proje,Status status)\n    {\n\n        proje.StartDate = DateTime.Now;\n        proje.Status = new HashSet&lt;Status&gt;();\n        var user = _db.Users.Single(r=&gt; r.ID == UserRole.ID);\n        proje.Users.Add(user);\n        proje.Status.Add(status);\n        user.Projects.Add(proje);\n\n\n        if (ModelState.IsValid)\n        {\n            var projeler = _db.Projects;\n            projeler.Add(proje);\n            _db.SaveChanges();\n\n            return RedirectToAction(\"Index\");\n\n        }\n\n\n            return View(proje);\n\n    }\n</code></pre>\n\n<p>I Search this problem's cause I did not find , I want to learn why entity framework add user to project's list but not add project to user's list </p>\n"},{"tags":["c#","entity-framework","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12989566,"title":"Code First - Self-referencing one to many relation","body":"<p>I've found a lot of similar questions here, but none of them seems to help me with my problem. Fluent api &amp; attributes didn't help. The database was created, but when adding an object to it, it crashed.\nI want to have a class that has a collection of itself. Here's the code I have:</p>\n\n<pre><code>[Table(\"UObjects\")]\npublic class UObject\n{\n    [Key]\n    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    [Browsable(false)]\n    public long ID { get; set; }\n    public string Name { get; set; }\n    [Browsable(false)]\n    public long? ParentID { get; set; }\n\n    public virtual UObject UParent { get; set; }\n    [Browsable(false)]\n    public virtual ICollection&lt;UObject&gt; UObjects { get; set; }\n}\n\n\npublic class MyContext : DbContext\n{\n    public DbSet&lt;UObject&gt; UObjects { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        // This fluent API didn't help\n        //modelBuilder.Entity&lt;UObject&gt;()\n        //        .HasOptional(u =&gt; u.UParent)\n        //        .WithMany(u =&gt; u.UObjects)\n        //        .HasForeignKey(u =&gt; u.ParentID);\n\n        //modelBuilder.Entity&lt;UObject&gt;()\n        //        .HasOptional(u =&gt; u.UParent)\n        //        .WithMany(u =&gt; u.UObjects)\n        //        .Map(c =&gt;\n        //        {\n        //            c.MapKey(\"ParentID\");\n        //            c.ToTable(\"UObjects\");\n        //        });\n    }\n}\n</code></pre>\n\n<p>Records in database are like this:</p>\n\n<pre><code>ID | Name       | ParentID\n------------------------------------\n1  | First      | 0\n2  | SubFirst   | 1\n3  | SubSecond  | 1\n4  | SubThird   | 2\n5  | SubFourth  | 2\n</code></pre>\n\n<p>So how my object should look after loading the entities is next:</p>\n\n<pre><code>   - First\n      - SubFirst\n         - SubThird\n         - SubFourth\n      - SubSecond\n</code></pre>\n\n<p>But every object has an empty collection. What should I do to make it work properly?</p>\n"},{"tags":["c#",".net","entity-framework","poco"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":12989192,"title":"Custom setter for C# model","body":"<p>I don't know how to make custom setter for C# data model. The scenario is pretty simple, I want my password to be automatically encrypted with SHA256 function. SHA256 function works very well (I've used in in gazillion of projects before).</p>\n\n<p>I've tried couple of things but when I run <code>update-database</code> it seems it's doing something recursively and my Visual Studio hangs (don't send error). Please help me understand how to make passwords be encrypted by default in model.</p>\n\n<h2>Code with what I've already tried</h2>\n\n<pre><code>public class Administrator\n{\n    public int ID { get; set; }\n    [Required]\n    public string Username { get; set; }\n    [Required]\n    public string Password\n    {\n        get\n        {\n            return this.Password;\n        }\n\n        set\n        {\n            // All this code is crashing Visual Studio\n\n            // value = Infrastructure.Encryption.SHA256(value);\n            // Password = Infrastructure.Encryption.SHA256(value);\n            // this.Password = Infrastructure.Encryption.SHA256(value);\n        }\n    }\n}\n</code></pre>\n\n<p>Seed</p>\n\n<pre><code>context.Administrators.AddOrUpdate(x =&gt; x.Username, new Administrator { Username = \"admin\", Password = \"123\" });\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12985774,"title":"Can a property not be both key and ForeignKey in entity framework","body":"<p>UPDATE</p>\n\n<p>I found out that adding a seperate key makes it work. So whats the deal with a property not being both key and ForeignKey to another table?</p>\n\n<pre><code>One or more validation errors were detected during model generation:\n\n\\tSystem.Data.Entity.Edm.EdmAssociationEnd: : Multiplicity is not valid in Role 'TrafficImageQuestionExtraInfo_TrafficImageQuestion_Source' in relationship 'TrafficImageQuestionExtraInfo_TrafficImageQuestion'. Because the Dependent Role refers to the key properties, the upper bound of the multiplicity of the Dependent Role must be '1'.\n\n\npublic class TrafficImageQuestionExtraInfoMap : EntityTypeConfiguration&lt;TrafficImageQuestionExtraInfo&gt;\n{\n    public TrafficImageQuestionExtraInfoMap()\n    {\n        this.HasKey(t =&gt; new { t.QuestionId, t.TrafficImageGuid });\n\n        this.Property(t =&gt; t.TrafficImageGuid).IsRequired();\n\n        this.Property(t =&gt; t.QuestionId).IsRequired();\n        this.Property(t =&gt; t.Key).IsRequired().HasMaxLength(50);\n        this.Property(t =&gt; t.Value).IsRequired().IsUnicode().HasMaxLength(128);\n        HasRequired(t =&gt; t.TrafficImageQuestion).WithMany(k =&gt; k.Properties).HasForeignKey(t =&gt; new { t.QuestionId, t.TrafficImageGuid });//.Map(m =&gt; m.MapKey(\"QuestionId\", \"TrafficImageGuid\")).WillCascadeOnDelete();\n    }\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>public class TrafficImageQuestionMap : EntityTypeConfiguration&lt;TrafficImageQuestion&gt;\n{\n    public TrafficImageQuestionMap()\n    {\n        // Primary Key\n        this.HasKey(t =&gt; new { t.QuestionId, t.TrafficImageGuid });\n\n        // Table &amp; Column Mappings\n        this.ToTable(\"TrafficImageQuestions\");\n        this.Property(t=&gt;t.QuestionId).IsRequired();\n\n        this.HasRequired(t =&gt; t.TrafficImage).\n            WithMany(t=&gt;t.TrafficImageQuestions).\n            HasForeignKey(t=&gt;t.TrafficImageGuid).WillCascadeOnDelete();\n        this.Property(t =&gt; t.\n            Answer).IsRequired();\n\n    }\n}\n</code></pre>\n"},{"tags":["php","jquery","asp.net-mvc","entity-framework","highcharts"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":12986341,"title":"Load data from database into highchart in MVC php using JSON","body":"<p>I am using MVC for Entity Framework &amp; developing aa application &amp; I want to upload data from database to show it into highchart's column-drilldown chart ?</p>\n\n<p>My Code For Binding is as below:</p>\n\n<pre><code>$result = mysql_query(\"select s.id, s.stage_name as stage, coalesce(sum(o.potential) *  (s.stage_weight / 100),0) as w_pot FROM s_stages as s \nleft join opps as o\nWHERE o.buy_stage = s.id\");\n$model[\"chart\"]=array();\nwhile($row = mysql_fetch_array($result)){\n    array_push($model[\"chart\"],\n        array(  \n            \"id\"=&gt;$row[\"s.id\"],\n            \"name\"=&gt;$row[\"stage\"],\n            \"w_pot\"=&gt;$row[\"w_pot\"]\n         ));\n}\n</code></pre>\n\n<p>and in view I have written code as below with its script code:</p>\n\n<pre><code>&lt;script src=\"http://code.highcharts.com/highcharts.js\"&gt;&lt;/script&gt;\n&lt;script src=\"http://code.highcharts.com/modules/exporting.js\"&gt;&lt;/script&gt;\n&lt;div id=\"container\" class=\"span6\" style=\"min-width: 400px; height: 400px; margin: 0 auto\"&gt;&lt;/div&gt;\n&lt;script type=\"text/javascript\"&gt;\n\n$(function () {\n    var chart;\n    $(document).ready(function() {\n\n        var colors = Highcharts.getOptions().colors,\n            categories = ['MSIE', 'Firefox', 'Chrome', 'Safari', 'Opera'],\n            name = 'Browser brands',\n            data = [{\n                    y: 55.11,\n                    color: colors[0],\n                    drilldown: {\n                        name: 'MSIE versions',\n                        categories: ['MSIE 6.0', 'MSIE 7.0', 'MSIE 8.0', 'MSIE 9.0'],\n                        data: [10.85, 7.35, 33.06, 2.81],\n                        color: colors[0]\n                    }\n                }, {\n                    y: 21.63,\n                    color: colors[1],\n                    drilldown: {\n                        name: 'Firefox versions',\n                        categories: ['Firefox 2.0', 'Firefox 3.0', 'Firefox 3.5', 'Firefox 3.6', 'Firefox 4.0'],\n                        data: [0.20, 0.83, 1.58, 13.12, 5.43],\n                        color: colors[1]\n                    }\n                }, {\n                    y: 11.94,\n                    color: colors[2],\n                    drilldown: {\n                        name: 'Chrome versions',\n                        categories: ['Chrome 5.0', 'Chrome 6.0', 'Chrome 7.0', 'Chrome 8.0', 'Chrome 9.0',\n                            'Chrome 10.0', 'Chrome 11.0', 'Chrome 12.0'],\n                        data: [0.12, 0.19, 0.12, 0.36, 0.32, 9.91, 0.50, 0.22],\n                        color: colors[2]\n                    }\n                }, {\n                    y: 7.15,\n                    color: colors[3],\n                    drilldown: {\n                        name: 'Safari versions',\n                        categories: ['Safari 5.0', 'Safari 4.0', 'Safari Win 5.0', 'Safari 4.1', 'Safari/Maxthon',\n                            'Safari 3.1', 'Safari 4.1'],\n                        data: [4.55, 1.42, 0.23, 0.21, 0.20, 0.19, 0.14],\n                        color: colors[3]\n                    }\n                }, {\n                    y: 2.14,\n                    color: colors[4],\n                    drilldown: {\n                        name: 'Opera versions',\n                        categories: ['Opera 9.x', 'Opera 10.x', 'Opera 11.x'],\n                        data: [ 0.12, 0.37, 1.65],\n                        color: colors[4]\n                    }\n                }];\n\n        function setChart(name, categories, data, color) {\nchart.xAxis[0].setCategories(categories, false);\nchart.series[0].remove(false);\nchart.addSeries({\nname: name,\ndata: data,\ncolor: color || 'white'\n}, false);\nchart.redraw();\n        }\n\n        chart = new Highcharts.Chart({\n            chart: {\n                renderTo: 'container',\n                type: 'column'\n            },\n            title: {\n                text: 'Browser market share, April, 2011'\n            },\n            subtitle: {\n                text: 'Click the columns to view versions. Click again to view brands.'\n            },\n            xAxis: {\n                categories: \n            },\n            yAxis: {\n                title: {\n                    text: ''\n                }\n            },\n            plotOptions: {\n                column: {\n                    cursor: 'pointer',\n                    point: {\n                        events: {\n                            click: function() {\n                                var drilldown = this.drilldown;\n                                if (drilldown) { // drill down\n                                    setChart(drilldown.name, drilldown.categories, drilldown.data, drilldown.color);\n                                } else { // restore\n                                    setChart(name, categories, data);\n                                }\n                            }\n                        }\n                    },\n                    dataLabels: {\n                        enabled: true,\n                        color: colors[0],\n                        style: {\n                            fontWeight: 'bold'\n                        },\n                        formatter: function() {\n                            return this.y +'%';\n                        }\n                    }\n                }\n            },\n            tooltip: {\n                formatter: function() {\n                    var point = this.point,\n                        s = this.x +':&lt;b&gt;'+ this.y +'% market share&lt;/b&gt;&lt;br/&gt;';\n                    if (point.drilldown) {\n                        s += 'Click to view '+ point.category +' versions';\n                    } else {\n                        s += 'Click to return to browser brands';\n                    }\n                    return s;\n                }\n            },\n            series: [{\n                name: name,\n                data: data,\n                color: 'white'\n            }],\n            exporting: {\n                enabled: false\n            }\n        });\n    });\n\n});\n&lt;/script&gt;\n</code></pre>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12986984,"title":"Entity Framework - Casting the retrieved Combobox value to string","body":"<p>Using Entity Framework, I have a Combobox showing a list of data retrieved from a database.</p>\n\n<pre><code>using System;  //I removed the other using statements here to preserve space\n\nnamespace ExTea_BackEnd\n{\n    public partial class frmAddBreakdown : Form\n    {\n        ExTeaEntities Breakdowns;\n        Breakdown_Type BreakdownTypes;\n\n        public frmAddBreakdown()\n        {\n            InitializeComponent();\n        }\n\n        private void cmbBreakdownType_SelectedIndexChanged(object sender, EventArgs e)\n        {\n            Breakdown_Type breakdownType = (Breakdown_Type)cmbBreakdownType.SelectedItem;\n            string selectedBreakdownTypeId = breakdownType.BrkdwnId;\n\n            IQueryable&lt;Breakdown_Type&gt; breakdownTypeQuery = from t in Breakdowns.Breakdown_Types\n                                                            where t.BrkdwnId == selectedBreakdownTypeId\n                                                            select t;\n            List&lt;Breakdown_Type&gt; selectedBreakdownId = breakdownTypeQuery.ToList();\n\n            if (selectedBreakdownId != null &amp;&amp; selectedBreakdownId.Count &gt; 0)\n            {\n                BreakdownTypes = selectedBreakdownId.First();\n                txtBreakdownId.Text = BreakdownTypes.BrkdwnId.ToString();\n            }\n            else\n            {\n                BreakdownTypes = null;\n            }\n        }\n\n        private void btnAdd_Click(object sender, EventArgs e)\n        {\n            try\n            {\n                Breakdown newBreakdown = new Breakdown();\n\n                Breakdown_Type breakdownType = (Breakdown_Type)cmbBreakdownType.SelectedItem;\n                newBreakdown.BrkdwnType = breakdownType.ToString();   //this is where the error occurs\n\n                newBreakdown.MachineId = txtMachineId.Text.Trim();\n                newBreakdown.MachineType = txtMachineType.Text.Trim();\n                newBreakdown.ReportedDate = dtpDate.Value;\n                newBreakdown.JobStatus = \"I\";\n\n                Breakdowns.AddToBreakdowns(newBreakdown);\n                int rowsAffected = Breakdowns.SaveChanges();\n                if (rowsAffected &gt; 0)\n                {\n                    MessageBox.Show(rowsAffected + \" records added!\", \"Save\", MessageBoxButtons.OK, MessageBoxIcon.Information);\n                }\n            }\n            catch (Exception ex)\n            {\n                MessageBox.Show(\"Error occured! \" + ex.Message);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I'm trying to save the data in the form back to the database, an error occurs when trying to cast the value selected from the Combobox. Even when I've casted it to the right type, it does not save the selected value! But this,</p>\n\n<p><img src=\"http://i.stack.imgur.com/w2FEU.png\" alt=\"enter image description here\"></p>\n\n<p>I'm clueless on what I'm doing wrong here? Can anyone please tell me how to correct this?</p>\n\n<p>Thank you.</p>\n"},{"tags":["entity-framework","datamodel","edmx"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2005,"score":2,"question_id":4617670,"title":"How to properly delete and re-add Entity Data Model","body":"<p>newbie to Entity Framework here.  Using VS 2010 and SQL Server 2008 express DB.</p>\n\n<p>I was having trouble refreshing an Entity Data Model after adding new tables.  So, I followed a suggestion I found here to just delete and regenerate the model.</p>\n\n<p>I get to the \"Choose Your Data Connection\" section of the Entity Data Model Wizard and \"Save entity connection settings in Web.config as:\" is checked.  However, my existing name has a 1 appended to it.  For example MyDatabaseEntities is now MyDatabaseEntities1.  Of course, I don't want the \"1\" appended.  I killed the existing connection string in Web.config and removed all references to that name in my solution.  Yet when I try to continue I'm presented with the following error:  </p>\n\n<p>\"'MyDatabaseEntites' conflicts with an existing property name in the Application Settings.  Please choose a different name\"     </p>\n\n<p>I can't find a reference to that name anywhere in the solution.  I can uncheck that option and it will continue, but it STILL won't add two of the tables in the database.  Next, I completely shut everything down, rebooted, and tried again.  This time I didn't get the error above, but two of my three new tables still do not get added to the edmx model.</p>\n\n<p>Any ideas are appreciated.  Also this seems like it's still pretty buggy even in VS2010/.NET 4.  Help restore my faith...I feel like abandoning Entity Framework at this point.  Based on my experience so far and some of the other issues posted here, I feel like I'm going to spend more time chasing Entity Framework strangeness than writing useful code.</p>\n\n<p>UPDATE:  I found a resolution.  The designer doesn't display errors.  You have have to look in the native XML (edmx file) to see the errors.  See here:  <a href=\"http://stackoverflow.com/questions/543971/ado-net-entity-framework-update-wizard-will-not-add-tables\">ADO.NET Entity Framework: Update Wizard will not add tables</a></p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12940042,"title":"IQueryable doesn't implement IDbAsyncEnumerable","body":"<p>The question was originally asked at <a href=\"http://entityframework.codeplex.com/discussions/399499#post928179\" rel=\"nofollow\">http://entityframework.codeplex.com/discussions/399499#post928179</a> .</p>\n\n<p>Good day! Please tell me if it is wrong place to post this question.</p>\n\n<p>I have a query as follows:</p>\n\n<pre><code>IQueryable&lt;Card&gt; cardsQuery =\n  dataContext.Cards\n  .Where(predicate)\n  .OrderByDescending(kc =&gt; kc.SendDate)\n  .AsQueryable();\n</code></pre>\n\n<p>Then I try:</p>\n\n<p><code>\nTask&lt;Card[]&gt; result = cardsQuery.ToArrayAsync();\n</code></p>\n\n<p>And then exception rises:</p>\n\n<p><code>The source IQueryable doesn't implement IDbAsyncEnumerable&lt;Models.Card&gt;</code></p>\n\n<p>I use modified version of 'EF 5.x DbCotext generator'.</p>\n\n<p>How to avoid it?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Important remark is that I have method to produce <code>IQuerayble&lt;Card&gt;</code> as follows:</p>\n\n<pre><code>class Repository {\n  public IQueryable&lt;Card&gt; GetKudosCards(Func&lt;Card, bool&gt; predicate) {\n    IEnumerable&lt;KudosCard&gt; kudosCards = kudosCardsQuery.Where(predicate);\n     return kudosCards\n            .OrderByDescending(kc =&gt; kc.SendDate)\n            .AsQueryable();\n  }\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":646,"score":3,"question_id":2947511,"title":"Entity Framework : How do you refresh the model when the db changes?","body":"<p>If you build the edmx file from the database and then the db changes, how do you get the model to pick up the change?</p>\n\n<p>Do you delete the whole model and regenerate or can you detect changes?</p>\n\n<p>I see a post mentioning a \"Update Your Model\" rt. mouse command on the edmx file, but I dont see it.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/690248/updating-your-edmx-to-reflect-changes-made-in-your-db-net-linq-to-entities\">Updating your edmx to reflect changes made in your db (.net linq-to-entities)</a></p>\n\n<p>I'm just starting out.</p>\n"},{"tags":["c#","asp.net","asp.net-mvc","entity-framework","sql-server-ce"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":194,"score":1,"question_id":9509563,"title":"EF will only let me choose SQL Server CE 3.5","body":"<p>I have a Visual Studio solution with two projects: <code>MyApp.MvcUI</code> and <code>MyApp.Domain</code> (class library).</p>\n\n<p><code>MyApp.MvcUI</code> contains my SQL Server CE 4 database.</p>\n\n<p><code>MyApp.Domain</code> is supposed to contain the Entity Framework EDMX file, but if I add it there I don't have the option to use SQL Server CE 4, only 3.5.</p>\n\n<p><img src=\"http://www.codetunnel.com/content/images/sqlce35only.jpg\" alt=\"\"></p>\n\n<p>If I add the EDMX in the <code>MvcUI</code> project then I am able to choose SQL Server CE 4.</p>\n\n<p>Question </p>\n\n<ol>\n<li><p>How can I put my Entity Framework content into the <code>MyApp.Domain</code> project and use a SQL Server CE 4 database that lives in the <code>MyApp.MvcUI</code> project?</p></li>\n<li><p>Once I solved that problem, what will the data source portion of my connection string in <code>App.Config</code> look like? I know the web project's connection string will simply look like this: </p>\n\n<pre><code>Data Source=|DataDirectory|\\CE4DB.sdf\n</code></pre>\n\n<p>but what will that look like in <code>App.Config</code> in the <code>MyApp.Domain</code> project? Will it be an absolute path like </p>\n\n<pre><code>C:\\Code\\MyProject\\MyApp.MvcUI\\App_Data\\CE4DB.sdf\n</code></pre></li>\n</ol>\n\n<p>If so, is there a way to make that a relative path so when people pull the project down from source control it will still work without path corrections?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12972497,"title":"How to seed data to a List<String> model member?","body":"<p>I have an Asp.Net MVC project up and running and I'm able to seed all the data I want to the database when my model changes except for one property which is of <code>List&lt;string&gt;</code> type.</p>\n\n<p>I've isolated that test case to better show the issue.</p>\n\n<p>Lets's say I've a simple <code>Person</code> model:</p>\n\n<pre><code>class Person\n{\n    public string Firstname { get; set; }\n    public string Lastname { get; set; }\n    public List&lt;string&gt; Children { get; set; }\n\n    public string ToString()\n    {\n        string children = \"\";\n\n        if (Children != null)\n        {\n            children = String.Join(\" - \", Children.ToArray());\n        }\n        else\n        {\n            children = \"none\";\n        }\n\n        return Firstname + \" \" + Lastname + \" -&gt; \" + children;\n    }\n}\n</code></pre>\n\n<p>When I use this model in an external Console application, I'm able to initialize all of its member.</p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        List&lt;Person&gt; myList = new List&lt;Person&gt; {\n            new Person { Firstname = \"John\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Bob\", \"Monica\" }},\n            new Person { Firstname = \"Bob\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Jack\", \"John II\" }},\n            new Person { Firstname = \"Monica\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Sue\", \"Mark\" }}\n        };\n\n        // output the list to screen\n        myList.ForEach(p =&gt; Console.WriteLine(p.ToString()));\n    }\n}\n</code></pre>\n\n<p>The output is then as expected:</p>\n\n<pre><code>John Doe -&gt; Bob - Monica\nBob Doe -&gt; Jack - John II\nMonica Doe -&gt; Sue - Mark\n</code></pre>\n\n<p>But now when I try to seed the same data into my database, the <code>Children</code> member is <code>null</code> !</p>\n\n<p>Here is how I'm trying to do it:</p>\n\n<pre><code>public class MySeedData : DropCreateDatabaseIfModelChanges&lt;MyDataBaseContextClass&gt;\n{\n    protected override void Seed(MyDataBaseContextClass context)\n    {\n        List&lt;Person&gt; myList = new List&lt;Person&gt; {\n            new Person { Firstname = \"John\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Bob\", \"Monica\" }},\n            new Person { Firstname = \"Bob\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Jack\", \"John II\" }},\n            new Person { Firstname = \"Monica\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Sue\", \"Mark\" }}\n        };\n        myList.ForEach(p =&gt; context.Persons.Add(p));\n    }\n}\n</code></pre>\n\n<p>I've tried a lot of different construction patterns but every time the <code>Children</code> member is <code>null</code> whenever I try to access it in one of my Views.</p>\n\n<p>At the moment, the only way I've found to have this member being not null is to initialize the list in the default constructor of the <code>Person</code> class...</p>\n\n<p>So how can I seed data to this <code>Children</code> member with different values for each person?</p>\n"},{"tags":["c#","asp.net","asp.net-mvc","vb.net","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":464,"score":1,"question_id":5284558,"title":"Entity Framework looking for wrong column","body":"<p>I'm brand new to the Entity Framework and trying to learn all it can offer.  I'm currently working my way through the <a href=\"http://www.asp.net/mvc/tutorials/mvc-music-store-part-4\" rel=\"nofollow\">MVC Music Store tutorial</a> which includes the following code:</p>\n\n<pre><code>public ActionResult Browse(string genre)\n {\n    // Retrieve Genre and its Associated Albums from database\n    var genreModel = storeDB.Genres.Include(\"Albums\")\n        .Single(g =&gt; g.Name == genre);\n\n    return View(genreModel);\n }\n</code></pre>\n\n<p>as I'm working in VB I converted it like so:</p>\n\n<pre><code>Function Browse(ByVal genre As String) As ActionResult\n\n            'Retrieve Genre and its Associated Albums from database\n            Dim genreModel = storeDB.Genres.Include(\"Albums\"). _\n                    Single(Function(g) g.Name = genre)\n\n            Return(View(genreModel))\n        End Function\n</code></pre>\n\n<p>The problem is I'm getting the following exception:</p>\n\n<blockquote>\n  <p>Invalid column name 'GenreGenreId'.</p>\n</blockquote>\n\n<p>Which I know is true, but I can't for the life of my work out where it's getting 'GenreGenreId' from.  Probably a basic question but I'll appreciate any help in the right direction.</p>\n\n<hr />\n\n<p>As per requested here is the source for my classes:</p>\n\n<p>Album.vb</p>\n\n<pre><code>Public Class Album\n\n    Private _title As String\n    Private _genre As Genre\n    Private _AlbumId As Int32\n    Private _GenreId As Int32\n    Private _ArtistId As Int32\n    Private _Price As Decimal\n    Private _AlbumArtUrl As String\n\n    Public Property Title As String\n        Get\n            Return _title\n        End Get\n        Set(ByVal value As String)\n            _title = value\n        End Set\n    End Property\n\n    Public Property AlbumId As Int16\n        Get\n            Return _AlbumId\n        End Get\n        Set(ByVal value As Int16)\n            _AlbumId = value\n        End Set\n    End Property\n\n    Public Property GenreId As Int16\n        Get\n            Return _GenreId\n        End Get\n        Set(ByVal value As Int16)\n            _GenreId = value\n        End Set\n    End Property\n\n    Public Property ArtistId As Int16\n        Get\n            Return _ArtistId\n        End Get\n        Set(ByVal value As Int16)\n            _ArtistId = value\n        End Set\n    End Property\n\n    Public Property AlbumArtUrl As String\n        Get\n            Return _AlbumArtUrl\n        End Get\n        Set(ByVal value As String)\n            _AlbumArtUrl = value\n        End Set\n    End Property\n\n    Public Property Price As Decimal\n        Get\n            Return _Price\n        End Get\n        Set(ByVal value As Decimal)\n            _Price = value\n        End Set\n    End Property\n\n    Public Property Genre As Genre\n        Get\n            Return _genre\n        End Get\n        Set(ByVal value As Genre)\n            _genre = value\n        End Set\n    End Property\n\n\nEnd Class\n</code></pre>\n\n<p>Genre.vb</p>\n\n<pre><code>Public Class Genre\n\n    Dim _genreId As Int32\n    Dim _Name As String\n    Dim _Description As String\n    Dim _Albums As List(Of Album)\n\n    Public Property GenreId As Int32\n        Get\n            Return _genreId\n        End Get\n        Set(ByVal value As Int32)\n            _genreId = value\n        End Set\n    End Property\n\n    Public Property Name As String\n        Get\n            Return _Name\n        End Get\n        Set(ByVal value As String)\n            _Name = value\n        End Set\n    End Property\n\n    Public Property Description As String\n        Get\n            Return _Description\n        End Get\n        Set(ByVal value As String)\n            _Description = value\n        End Set\n    End Property\n\n    Public Property Albums As List(Of Album)\n        Get\n            Return _Albums\n        End Get\n        Set(ByVal value As List(Of Album))\n            _Albums = value\n        End Set\n    End Property\n\nEnd Class\n</code></pre>\n\n<p>MusicStoreEntities.vb</p>\n\n<pre><code>Imports System.Data.Entity\n\nNamespace MvcApplication1\n\n    Public Class MusicStoreEntities\n        Inherits DbContext\n\n        Public Property Albums As DbSet(Of Album)\n        Public Property Genres As DbSet(Of Genre)\n\n    End Class\nEnd Namespace\n</code></pre>\n"},{"tags":[".net","sql-server","entity-framework","ews"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12974061,"title":"Use EWS API and SQL Server database as data sources","body":"<p>I am new to EF an am trying to build (what I think) is a rather simple application for my office. I am writing an application to track the projects we bid on. Each biditem will track (through navigation properties) which clients (bidders) we are bidding to (construction industry, so multiple clients per project), and project notes. </p>\n\n<p>I am planning on using EF (with SQL Server) for the bidtracker, but I want to use the EWS Managed API to get/maintain the contact info so that the office only has to maintain one contact list which is available through Outlook. </p>\n\n<p>So, is it possible to have mixed data sources (SQL Server and Exchange server) with Entity Framework? If so, can you point me to a good resource to help me wire it?</p>\n\n<p>Here is a simplified model (the <code>BidItem</code> and <code>Note</code> will be in SQL Server, the <code>Contact</code> will be from Exchange):</p>\n\n<p><img src=\"http://i.stack.imgur.com/29rCE.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["wpf","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12979344,"title":"Retrieving entity records before savingchanges","body":"<p>I just have not been able to find an answer to this anywhere and I'm hoping someone can help me.  I'm a newbie on WPF and Entity Framework, so probably doing this all wrong.</p>\n\n<p>I've got a situation where I'm creating new records and adding them to an Entity collection.  I do not want to perform a SaveChanges() on it yet to allow the user to finish everything they want to do and then do a final Save before leaving the form.  My problem is that after the records have been added to the Entity collection, I can not retrieve them back out for display 'until' they have had the SaveChanges() ran on the entity.</p>\n\n<p>This is basically a Master-Child display using two DataGrids but the Master grid source is a List&lt;> being built since one of the fields in the table needs to be converted to a more user friendly display.  And this is all coming from one table where I'm just grouping the data based on 3 of the fields (as the Master) and then displaying the child grid as the details of that grouping.</p>\n\n<p>This action is a 'Copy' action where I'm taking an existing DataGrid display of data and letting the user copy the data to a 'new' master group.  I'm using the following to create this new group of records.</p>\n\n<pre><code>            RateGroupRow rgr = new RateGroupRow();\n            rgr.StaffRole = rg.SelectedStaffRole;\n            rgr.Department = rg.SelectedDepartment;\n            rgr.PlanYear = rg.SelectedPlanYear;\n            _rateGroupQuery.Add(rgr);\n\n            foreach (var item in dgRateValues.Items)\n            {\n                if (item.GetType() == typeof(CommissionRate))\n                {\n                    CommissionRate cr = (CommissionRate)item;\n                    CommissionRate newcr = new CommissionRate();\n                    newcr.StaffRole = Common.StaffTextToStaffType(rgr.StaffRole);\n                    newcr.Department = rgr.Department;\n                    newcr.PlanYear = rgr.PlanYear;\n                    newcr.Low = cr.Low;\n                    newcr.High = cr.High;\n                    newcr.Rate = cr.Rate;\n                    Common.CommissionsEntities.CommissionRates.AddObject(newcr);\n                }\n            }\n            //TODO:  Don't want to do this SaveChanges here but for now that's the only way I can get these new records to be displayed in the data selection.\n            //Common.CommissionsEntities.SaveChanges();\n\n            dgRateGroups.ItemsSource = null;\n            dgRateGroups.ItemsSource = _rateGroupQuery;\n            dgRateGroups.SelectedIndex = dgRateGroups.Items.Count - 2;\n</code></pre>\n\n<p>After the Master record has been added to the _rateGroupQuery, the DataGrid (dgRateGroups) selects that row in which the SelectionChanged queries for the data to populate the details DataGrid as:</p>\n\n<pre><code>    dgRateValues.ItemsSource = null;\n    _CurrentSelectedStaffRole = rateGroupRow.StaffRole;\n    _CurrentSelectedDepartment = rateGroupRow.Department;\n    _CurrentSelectedPlanYear = rateGroupRow.PlanYear;\n    string StaffNameType = Common.StaffTextToStaffType(_CurrentSelectedStaffRole);\n\n    var CommissionRatesItems =\n        from cr in Common.CommissionsEntities.CommissionRates\n        where cr.StaffRole == StaffNameType &amp;&amp;\n              cr.Department == _CurrentSelectedDepartment &amp;&amp;\n              cr.PlanYear == _CurrentSelectedPlanYear\n        orderby cr.Low\n        select cr;\n    ObjectQuery&lt;CommissionRate&gt; CommissionRatesQuery = CommissionRatesItems as ObjectQuery&lt;CommissionRate&gt;;\n    dgRateValues.ItemsSource = CommissionRatesQuery.Execute(MergeOption.AppendOnly);\n</code></pre>\n\n<p>I get no records back from this select.  If I do the 'SaveChanges()' call after adding the records, then everything works fine.</p>\n\n<p>So is there a way to retrieve these newly added records prior to them being committed (SaveChanges) back to the database?</p>\n\n<p>Thank you,\nMike</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":12976813,"title":"Entity framework, referential integrity constraint violation occurred error on updating entity from disconnected area","body":"<p>I have below model</p>\n\n<pre><code>public class Order\n{\n    [Key]\n    public virtual string OrderNo {get;set;}\n    public virtual IList&lt;OrderItem&gt; Items {get;set;}\n}\n\npublic class OrderItem\n{\n    [Key]\n    public virtual string ItemNo {get; set;}\n    public virtual string ParentItemNo {get;set;}\n    public virtual string OrderNo {get;set;}\n\n    public virtual OrderItem ParentItem {get;set;}\n    public virtual IList&lt;OrderItem&gt; ChildItems {get;set;}\n    public virtual IList&lt;ItemProperty&gt; ItemProperties {get;set;}\n    public virtual Order Order {get;set;}\n}\n\npublic class ItemProperty\n{\n    [Key]\n    public virtual string PropertyNo {get; set;}\n    public virtual string ParentPropertyNo {get;set;}\n    public virtual string OrderItemNo {get;set;}\n\n    public virtual ItemProperty ParentProperty {get;set;}\n    public virtual IList&lt;ItemProperty&gt; ChildProperties {get;set;}\n    public virtual OrderItem OrderItem {get;set;}\n}\n</code></pre>\n\n<p>I'm running on disconnected area (with service our disconnected from the Entity Framework context)</p>\n\n<ol>\n<li>I create a order and save to database</li>\n</ol>\n\n<p>client:</p>\n\n<pre><code>service.CreateOrder(new Order() { OrderN=\"fksjdf1\" });\n</code></pre>\n\n<p>server:</p>\n\n<pre><code>using(EfDbContext context = new EfDbContext())\n{\n    context.Orders.Add(order);\n    context.SaveChanges();\n}\n</code></pre>\n\n<ol>\n<li>I need to add one or more OrderItems to previously added order</li>\n</ol>\n\n<p>client:</p>\n\n<pre><code>var order = service.GetOrder(\"fksjdf1\");\n\nvar item1 = new OrderItem();\nitem1.ItemNo=\"i1\";\nitem1.Order=order;\nitem1.OrderNo=order.OrderNo;\nitem1.ItemProperties.Add(new ItemProperty()\n    PropertyNo=\"p1\",\n    OrderItem = item1\n})\norder.Items.Add(item1);\n\nvar item2 = new OrderItem();\nitem2.ItemNo=\"i2\";\nitem2.Order=order;\nitem2.OrderNo=order.OrderNo;\nitem2.ItemProperties.Add(new ItemProperty()\n    PropertyNo=\"p2\",\n    OrderItem = item2\n});\nitem2.ItemProperties.Add(new ItemProperty()\n    PropertyNo=\"p3\",\n    OrderItem = item2\n})\norder.Items.Add(item2);\nservice.UpdateOrder(order);\n</code></pre>\n\n<p>server:</p>\n\n<pre><code>using(EfDbContext context = new EfDbContext())\n{\n    DbEntityEntry dbEntityEntry = context.Entry(order);\n    if (dbEntityEntry.State == EntityState.Detached)\n    {\n        // ERROR\n        context.Set&lt;Order&gt;().Attach(order);\n    }\n\n    dbEntityEntry.State = EntityState.Modified;\n    context.SaveChanges();\n}\n</code></pre>\n\n<p>Error: A referential integrity constraint violation occurred: The property values that define the referential constraints are not consistent between principal and dependent objects in the relationship.</p>\n\n<p>Why I see this error? Why I not update this entity?</p>\n\n<p>How can i use entity framework from disconnected area?</p>\n\n<p>EDIT 1:</p>\n\n<pre><code>public Order GetOrder(string orderNo)\n{\nusing (EfDbContext context = new EfDbContext())\n            {\n                context.Configuration.ProxyCreationEnabled = false;\n                var order = context.Orders\n                    .Include(o =&gt; o.OrderItems\n                                      .Select(z =&gt; z.ItemProperties\n                                                       .Select(y =&gt; y.ChildProperties)))\n                                                       .Where(o =&gt; o.OrderNo == orderNo)\n                    .FirstOrDefault();\n            }\n}\n</code></pre>\n"},{"tags":["entity-framework","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12917431,"title":"Entity Framework setting Identity Value with composite key Azure SQL","body":"<p>We've recently switched our existing product to using Entity Framework Code First Migrations. The transition has been rather painful, but we've gotten through almost all of it at this point. Now that we've got things working in our local environments we've pushed it out to our deployment environment. Unfortunately our deployment environment doesn't appear to support <strong>SOMETHING</strong> with the new EF Migrations.</p>\n\n<p>Our environment consists of two servers: a Web (.Net MVC3) server and a socket server, both running in Windows Azure. The problem only seems to occur in our socket server, and in fact Entity Framework is telling us that the database hash doesn't match (using <code>context.Database.CompatibleWithModel()</code>).</p>\n\n<p>If we ignore the fact that EF is telling us that our DB Model doesn't match our code model, the only error we encounter is the insertion of an entity object with a <strong>composite key</strong>. All other entities can be created fine. All of our entity classes derive from a base class:</p>\n\n<pre><code>class BaseEntity {\n    [HiddenInput(DisplayValue = false)]\n    [Key, Column(Order = 0)]\n    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public virtual long Id { get; set; }\n}\n</code></pre>\n\n<p>We had to add the 'Order' piece in order for EF to support the composite keys. The model that is having issues looks like:</p>\n\n<pre><code>class SubEntity {\n    [MaxLength(255)]\n    [Required]\n    [Key, Column(Order = 1)]\n    public string Name { get; set; }\n}\n</code></pre>\n\n<p>When we attempt to add a new <code>SubEntity</code> object to the context and save the changes, we get an error from SQL saying that we cannot set an explicit <code>Id</code>, and to use <code>IDENTITY_INSERT ON</code>.</p>\n\n<p><strong>The code works fine on our local machines, and in our web server. The DB model is compatible, and we can create 'SubEntity' objects without issue.</strong></p>\n\n<p>To me, it seems like EF, in the socket server environment, is ignoring the <code>[DatabaseGenerated]</code> Annotation when using a composite key. That would explain the error, and explain why the DB model is not compatible. Does this make sense? Is there something in the environment that would make EF behave differently?</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12883371,"title":"How to customize DbContext properties names in Entity Framework and stop being overwritted?","body":"<p>EF auto-generate the DbContext class from my edmx file (database first) and use table names as default names for all this DbContext properties (ex: <code>public DbSet&lt;Student&gt; student { get; set; }</code>)</p>\n\n<p>If I make some change in this file (ex: like renaming properties name from student to Students), my changes are lost everytime I save my model because EF regenerate the DbContext class file.</p>\n\n<p>How can I change this default behaviour and be able to make my customization and stop losing it?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":11918401,"title":"enable-migrations error : project failed to build","body":"<p>Using ASP.NET MVC4 with EF4.3</p>\n\n<p>Running Enable-Migrations from PM Console</p>\n\n<p>System.Management.Automation.RuntimeException: The project 'MyProj' failed to build.\nThe project 'MyProj' failed to build.</p>\n\n<p>The project builds (control-shift-B) </p>\n\n<p>Is there any way to get more detail on this error to diagnose?</p>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":297,"score":1,"question_id":10257360,"title":"How to update not every fields of an object using Entity Framework and EntityState.Modified","body":"<p>I need to update all fields except property1 and property2 for the given entity object.<br>\nHaving this code:  </p>\n\n<pre><code>    [HttpPost]\n    public ActionResult Add(object obj)\n    {\n        if (ModelState.IsValid)\n        {\n                context.Entry(obj).State = System.Data.EntityState.Modified;\n\n                context.SaveChanges();               \n         }\n        return View(obj);\n    }\n</code></pre>\n\n<p>How to change it to add an exception to obj.property1 and obj.property2 for not being updated with this code?  </p>\n"},{"tags":["mysql","performance","entity-framework"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":5402,"score":3,"question_id":1233245,"title":"How to optimize Entity Framework Queries","body":"<p>I am using Linq-To-Entities to do a query which is returning only 947 rows but taking 18 seconds to run. I have done a \"ToTraceString\" to get the underlying sql out and ran the same thing directly on the database and get the same timing. </p>\n\n<p>I have used the tuning advisor and created a couple of indexes although with little impact.</p>\n\n<p>Looking at the query execution plan there are a couple of nested loops which are taking up 95% of the time but these are already working on the indexes?</p>\n\n<p>Does anyone have any ideas on how to force some optimisation into the EF query??</p>\n\n<p>EDIT: Supplying additional information</p>\n\n<p>A basic ER diagram with for the three tables is as follows:</p>\n\n<pre><code>People &gt;----People_Event_Link ----&lt; Events\nP_ID        P_ID                    E_ID\n            E_ID\n</code></pre>\n\n<p>The linq that I am running is designed to get all Events back for a particular Person (using the P_ID):</p>\n\n<pre><code>        var query = from ev in genesisContext.Events\n                    join pe in genesisContext.People_Event_Link\n                    on ev equals pe.Event\n                    where pe.P_ID == key\n                    select ev;\n        return query;\n</code></pre>\n\n<p>Here is the generated SQL (deep breath!):</p>\n\n<pre><code>SELECT \n1 AS [C1], \n[Extent1].[E_ID] AS [E_ID], \n[Extent1].[E_START_DATE] AS [E_START_DATE], \n[Extent1].[E_END_DATE] AS [E_END_DATE], \n[Extent1].[E_COMMENTS] AS [E_COMMENTS], \n[Extent1].[E_DATE_ADDED] AS [E_DATE_ADDED], \n[Extent1].[E_RECORDED_BY] AS [E_RECORDED_BY], \n[Extent1].[E_DATE_UPDATED] AS [E_DATE_UPDATED], \n[Extent1].[E_UPDATED_BY] AS [E_UPDATED_BY], \n[Extent1].[ET_ID] AS [ET_ID], \n[Extent1].[L_ID] AS [L_ID]\nFROM  [dbo].[Events] AS [Extent1]\nINNER JOIN [dbo].[People_Event_Link] AS [Extent2] ON  EXISTS (SELECT \n    1 AS [C1]\n    FROM    ( SELECT 1 AS X ) AS [SingleRowTable1]\n    LEFT OUTER JOIN  (SELECT \n    \t[Extent3].[E_ID] AS [E_ID]\n    \tFROM [dbo].[Events] AS [Extent3]\n    \tWHERE [Extent2].[E_ID] = [Extent3].[E_ID] ) AS [Project1] ON 1 = 1\n    LEFT OUTER JOIN  (SELECT \n    \t[Extent4].[E_ID] AS [E_ID]\n    \tFROM [dbo].[Events] AS [Extent4]\n    \tWHERE [Extent2].[E_ID] = [Extent4].[E_ID] ) AS [Project2] ON 1 = 1\n    WHERE ([Extent1].[E_ID] = [Project1].[E_ID]) OR (([Extent1].[E_ID] IS NULL) AND ([Project2].[E_ID] IS NULL))\n)\nWHERE [Extent2].[P_ID] = 291\n</code></pre>\n"},{"tags":["mysql","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":12690775,"title":"Why EF generating a sub-query for a simle query?","body":"<p>There is a simple Linq to EF:</p>\n\n<pre><code>var query = from p in _db.Posts\n            where p.BlogtId == blogId\n            select p;\n</code></pre>\n\n<p>It generates SQL in this form:</p>\n\n<pre><code>SELECT\n`Extent1`.`PostId`, \n`Extent1`.`BlogId`, \n...\nFROM `Posts` AS `Extent1`\n WHERE `Extent1`.`BlogId` = @p__linq__0\n</code></pre>\n\n<p>But when I add a order by to this query </p>\n\n<pre><code>var query = from p in _db.Posts\n            where p.BlogId == blogId\n            orderby p.PublishDate\n            select p;\n</code></pre>\n\n<p>It generates this query </p>\n\n<pre><code>SELECT\n`Project1`.`PostId`, \n`Project1`.`BlogId`, \n...\nFROM (SELECT\n`Extent1`.`PostId`, \n`Extent1`.`BlogId`, \n...\nFROM `Posts` AS `Extent1`\n WHERE `Extent1`.`BlogId` = @p__linq__0) AS `Project1`\n ORDER BY \n`Project1`.`PublishDate` ASC\n</code></pre>\n\n<p>Why this generate a sub-query?There is a performance problem for this query in MySQL. MySQL is trying to execute the inner query which pulls back all the records in the database and then tries to sort theme.</p>\n\n<p>I need a solution to generate below sql by linq</p>\n\n<pre><code>SELECT\n`Extent1`.`PostId`, \n...\nFROM `Posts` AS `Extent1`\n WHERE `Extent1`.`BlogId` = @p__linq__0\n ORDER BY \n`Extent1`.`PublishDate` ASC\n</code></pre>\n"},{"tags":["c#","database","visual-studio-2010","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12975374,"title":"Code First with the Entity Framework throws a DbUpdateException when saving","body":"<p>I am trying to create my first database in a Visual Studio C# project and add an entity to this database. I have not yet managed to do so. When trying, I will get a <code>DbUpdateException</code> when calling <code>SaveChanges()</code> on the <code>DbContext</code>.</p>\n\n<p>I am trying to save the following entity:</p>\n\n<pre><code>public class TVSeriesReference : Reference\n{\n}\n</code></pre>\n\n<p><code>TVSeriesReference</code> does nothing but inherit <code>Reference</code>:</p>\n\n<pre><code>public class Reference\n{\n    /// &lt;summary&gt;\n    /// ID of the reference.\n    /// &lt;/summary&gt;\n    public int Id { get; set;  }\n\n    /// &lt;summary&gt;\n    /// Reference to the element in theTVDB.\n    /// &lt;/summary&gt;\n    public int TheTVDBId { get; set; }\n\n    /// &lt;summary&gt;\n    /// Whether or not the reference has been marked as watched.\n    /// &lt;/summary&gt;\n    public bool IsWatched { get; set; }\n}\n</code></pre>\n\n<p>I am using the following context:</p>\n\n<pre><code>public class Library : DbContext\n{\n    /// &lt;summary&gt;\n    /// Constructor using the base constructor.\n    /// This constructor names the database \"Library\".\n    /// &lt;/summary&gt;\n    public Library() : base(\"Library\")\n    {\n    }\n\n    /// &lt;summary&gt;\n    /// Set of TVSeriesReferences stored in the database.\n    /// &lt;/summary&gt;\n    public DbSet&lt;TVSeriesReference&gt; TVSeriesReferences { get; set; }\n\n    /// &lt;summary&gt;\n    /// Set of SeasonReferences stored in the database.\n    /// &lt;/summary&gt;\n    public DbSet&lt;SeasonReference&gt; SeasonReferences { get; set; }\n\n    /// &lt;summary&gt;\n    /// Set of EpisodeReferences stored in the database.\n    /// &lt;/summary&gt;\n    public DbSet&lt;EpisodeReference&gt; EpisodeReferences { get; set; }\n}\n</code></pre>\n\n<p>And this is how I try to create and save the entity to the database.</p>\n\n<pre><code>using (var db = new Library())\n{\n    var reference = new TVSeriesReference\n    {\n        Id = 2,\n        TheTVDBId = 1,\n        IsWatched = true\n     };\n\n     db.TVSeriesReferences.Add(reference);\n\n     try\n     {\n         db.SaveChanges();\n     }\n     catch (DbUpdateException e)\n     {\n         Debug.WriteLine(\"\\n\\n*** {0}\\n\\n\", e.InnerException);\n     }\n }\n</code></pre>\n\n<p><code>db.SaveChanges()</code> will throw the following exception:</p>\n\n<pre><code>System.Data.UpdateException: An error occurred while updating the entries. See the inner exception for details. ---&gt; System.Data.SqlClient.SqlException: Invalid object name 'dbo.TVSeriesReferences'.\n   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)\n   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean&amp; dataReady)\n   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()\n   at System.Data.SqlClient.SqlDataReader.get_MetaData()\n   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task&amp; task, Boolean asyncWrite)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, TaskCompletionSource`1 completion, Int32 timeout, Task&amp; task, Boolean asyncWrite)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\n   at System.Data.Common.DbCommand.ExecuteReader(CommandBehavior behavior)\n   at System.Data.Mapping.Update.Internal.DynamicUpdateCommand.Execute(UpdateTranslator translator, EntityConnection connection, Dictionary`2 identifierValues, List`1 generatedValues)\n   at System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager stateManager, IEntityAdapter adapter)\n   --- End of inner exception stack trace ---\n   at System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager stateManager, IEntityAdapter adapter)\n   at System.Data.EntityClient.EntityAdapter.Update(IEntityStateManager entityCache)\n   at System.Data.Objects.ObjectContext.SaveChanges(SaveOptions options)\n   at System.Data.Entity.Internal.InternalContext.SaveChanges()\n</code></pre>\n\n<p>I have been tearing my hair out for hours and hours now and I can't figure out what I am doing wrong. It seems that the tables (or maybe the entire database?) is not being created.\nIs there something I should have set up or have installed before this will work? I have installed NuGet and through that the Entity Framework.</p>\n\n<p>Is there anyone who can help me get this to work?</p>\n\n<p><strong>UPDATE</strong>: ConnectionStrings in <code>app.config</code></p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;connectionStrings&gt;\n    &lt;add name=\"Library\"\n         connectionString=\"Data Source=.\\SQLEXPRESS\"\n         providerName=\"System.Data.SqlServerCe.4.0\"/&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":5,"favorite_count":5,"up_vote_count":16,"down_vote_count":0,"view_count":7635,"score":16,"question_id":1131908,"title":"Calculated properties in Entity Framework","body":"<p>Suppose I have an employee object with the following properties:</p>\n\n<p>Name - string\nHours - single\nWage - single</p>\n\n<p>I want to add a property, Salary, which equals Hours * Wage. In an ordinary business object, I would simply code that up in the property, but this would presumably wiped out if the class needed to be regenerated.</p>\n\n<p>Is there an EF standard way to implement this without going through the trouble of mapping it to a database entity?</p>\n"},{"tags":["entity-framework","design","inheritance","tph"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12953428,"title":"Conditional Mapping in Entity Framework - OR operation with TPH","body":"<p>We have an entity like <code>Vehicle</code> and three derived entities such as <code>Car</code>, <code>Motorbike</code> and <code>Bicycle</code>.\nThis inheritance hierarchy is implemented with <strong>TPH</strong>.</p>\n\n<p>Here are entity mapping conditions:</p>\n\n<ul>\n<li><code>__disc__ = car</code> for Car</li>\n<li><code>__disc__ = motorbike</code> for Motorbike</li>\n<li><p><code>__disc__ = bicycle</code> for Bicycle</p>\n\n<p><em><strong>How can I</em></strong> derive another child from <code>Vehicle</code> like <code>MotorVehicle</code> with following mapping condition:</p></li>\n<li><p><code>__disc__ = car OR motorbike</code> for MotorVehicle</p></li>\n</ul>\n\n<p>I'd view in Database like this when I had this structure with <strong>TPT</strong>:</p>\n\n<pre><code>SELECT    Id\nFROM      Vehicles\nWHERE     (__Disc__ = N'car') OR (__Disc__ = N'motorbike')\n</code></pre>\n\n<p>I think this view is not required with TPH.</p>\n\n<p><em><strong>Please note that</em></strong> I can not change the inheritance like this: Vehicle&lt;-- MotorVehicle&lt;-- Car. Don't think about injecting the motor vehicles as the parent of car and other children because Car and Motorbike and Bicycle are already exists. I just want to assign some business to all motor vehicles.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12977961,"title":"System.ApplicationException","body":"<p>I am trying to rum my application and I am getting the following error as :\nSystem.Web.HttpUnhandledException: Exception of type 'System.Web.HttpUnhandledException' was thrown. </p>\n\n<p>The exception is thrown near the ** line of code:</p>\n\n<pre><code>public void LoadFromEntity(bool editable, string TabKey)\n    {\n        //Getting the FormMaster collection\n        **FormTemplate formTemplate = PolicyClassCollection.CachedPolicyClasses.FindBy((int)EnumPolicyClasses.PNI).FormTemplateCo**llection.Find(ft =&gt; ft.PolicyClassId == Utility.GetCurrentPolicyClassId() &amp;&amp; ft.DocumentType.DocumentTypeId == (int)EnumDocumentTypes.Coverage_Summary &amp;&amp; ft.PolicyTypeId == Utility.GetCurrentAccount().CurrentRisk.PolicyTypeId);\n\n        if (formTemplate != null)\n        {\n            //Set context string with current option number\n            this._Account.CurrentRisk.FormContextData = this.OptionNum.ToString();\n\n            //getting FormMasterID\n            Guid vsDatabaseId = formTemplate.FormFilingHistoryId;\n            string accountXmlString = this._Account.ToXML();\n\n            //Setting the parameters in PDFServiceParms class that are to be used in \"PDFService.aspx\" page.\n            PDFServiceParms pdfParams = new PDFServiceParms(FORM_MODE_EDIT, vsDatabaseId.ToString(), Model.AppConstants.FORM_TYPE_SELECTED_FORM, accountXmlString);\n\n            //Saving the parameters in the session. PDFService.aspx page reads the parameters from the session. Session key is passed in the \n            //query string when calling the PDFService.aspx page.\n            Session[AppConstants.SK_SUMMARY_PDF_PARAMS] = pdfParams;\n\n            //Setting the iFrame's source to PDFService.aspx page. The PDF document generated in this page is displayed in the iFrame.\n            this.iframePdf.Attributes[\"src\"] = ResolveClientUrl(AppConstants.PAGE_NAME_PDFSERVICE) + \"?datakey=\" + AppConstants.SK_SUMMARY_PDF_PARAMS;\n        }\n        else\n            throw new ApplicationException(\"FormMaster not found for PolicyClass = \" + Utility.GetCurrentPolicyClassId().ToString() + \" and DocumentType = \" + ((int)EnumDocumentTypes.Coverage_Summary).ToString());\n    }\n</code></pre>\n\n<p><strong>Exception thrown:</strong></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>System.Web.HttpUnhandledException: Exception of type 'System.Web.HttpUnhandledException' was thrown. ---&gt; System.ApplicationException: FormMaster not found for PolicyClass = 2 and DocumentType = 27\n   at PNI_SqbpeCovInfoPNISummary.LoadFromEntity(Boolean editable, String TabKey) in C:\\TFS\\Navigate Development\\NavigateWebApp\\PNI\\SqbpeCovInfoPNISummary.aspx.cs:line 95\n   at SQBPECoverageInformationMasterPNI.LoadFromEntity() in C:\\TFS\\Navigate Development\\NavigateWebApp\\PNI\\SQBPECoverageInformationMasterPNI.master.cs:line 188\n   at SQBPE.Page_Load(Object sender, EventArgs e) in C:\\TFS\\Navigate Development\\NavigateWebApp\\SQBPE.master.cs:line 55\n   at System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e)\n   at System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e)\n   at System.Web.UI.Control.OnLoad(EventArgs e)\n   at System.Web.UI.Control.LoadRecursive()\n   at System.Web.UI.Control.LoadRecursive()\n   at System.Web.UI.Control.LoadRecursive()\n   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)\n   --- End of inner exception stack trace ---\n   at System.Web.UI.Page.HandleError(Exception e)\n   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)\n   at System.Web.UI.Page.ProcessRequest(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)\n   at System.Web.UI.Page.ProcessRequest()\n   at System.Web.UI.Page.ProcessRequest(HttpContext context)\n   at ASP.pni_sqbpecovinfopnisummary_aspx.ProcessRequest(HttpContext context) in c:\\Windows\\Microsoft.NET\\Framework64\\v2.0.50727\\Temporary ASP.NET Files\\navigatewebapp\\253cae21\\57ec5e1d\\App_Web_sqbpecovinfopnisummary.aspx.41d7eb59.1z9y4p0a.0.cs:line 0\n   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()\n   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously)\n</code></pre>\n\n<p>can some one please let me know what need to be done for this.</p>\n"},{"tags":["entity-framework","ef-code-first","code-first","table-per-hierarchy","table-per-subclass"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12866227,"title":"Code First - Mapping when the Discriminator IS NULL or NOT NULL","body":"<p>I want to use TPH Inheritance in EF5 Code First. I want to base it on whether a column in the database is null or not.</p>\n\n<p>I found this link indicating it was not possible in EF4. <a href=\"http://stackoverflow.com/questions/5019717/entity-framework-4-tph-inheritance-in-features-ctp5-code-first-with-is-null\">Entity Framework 4 - TPH Inheritance in Features CTP5 (code first) with &quot;IS NULL&quot; discriminator</a></p>\n\n<p>Has this been fixed in EF5? If so, what is the syntax?</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","asp.net-mvc-4","asp.net-web-api"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12978053,"title":"Should I detach entity from EF context when exposed it through Web API","body":"<p>I am using EF5 code-first approach and I am just wondering should I detach entity from EF context when exposed it through the Web API?</p>\n\n<p>Let's say I have API action method</p>\n\n<pre><code>[HttpGet]\npublic HttpResponseMessage Get(int id)\n{\n    var user = _userRepository.GetById(id);\n\n    if (user != null)\n    {\n        // detach here???\n        _userRepository.Detach(user);\n\n        return Request.CreateResponse(HttpStatusCode.Found, user);\n    }\n\n    return Request.CreateErrorResponse(HttpStatusCode.NotFound, string.Format(\"No user with id={0} is found\", id));\n}\n</code></pre>\n\n<p>Actually what are the best practices for that? Should I create the projection of the entity and then exposed it?</p>\n"},{"tags":["c#","linq","entity-framework","reflection"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":12958278,"title":"How do I find out if an enum value is used at Runtime?","body":"<p>We are using a quasi dynamic method to create enums from sql lookup tables using t4 templates.  The template generates an enum for every table that conforms to the lookup patter.  Several of these enums are not being used in code, but any could be.</p>\n\n<p>This has been fine and dandy, but now we have been asked to create a lookup management interface so that users can add new values, edit descriptions, etc.</p>\n\n<p>They don't want to modify any items that are currently being used in code as an enum value, so is there a simple (or not so simple) way to query our assemblies to find out if an enum value is used?</p>\n\n<p>We have a lot of code similar to this made-up example:</p>\n\n<pre><code>public Role GetAdminRole\n{\n  using (myContext ctx = new myContext()\n  {\n    return ctx.Roles.Where(i=&gt; i.RoleId == (int)RoleEnum.Admin).SingleOrDefault();;\n  }\n}\n</code></pre>\n\n<p>Is there a way to use the Type.FindMembers() and build a filter that can query the internals of a method?</p>\n\n<p>I've looked at the <code>System.Reflection.Emit</code> namespace, which seemed promising based on the EnumBuilder class, but couldn't figure out how to hook up a builder to an existing assembly.  The <code>System.Diagnostics.CodeAnalysis</code> namespace sounds interesting, but it only contains two attributes (for suppressing warnings and excluding code from coverage).</p>\n\n<p>EDIT:  While poking through ILSpy I discovered that I knew, but didn't put together, that enum values in methods get converted to their integer value when used in the above manner when compiled.</p>\n"},{"tags":["c#","entity-framework","persistence","sql-server-express"],"answer_count":5,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":2196,"score":7,"question_id":875995,"title":"Entity Framework won't persist data in SQL Express (MDF)","body":"<p>I'm going crazy about this issue because I can't see what I'm doing wrong.</p>\n\n<p>I was developing an application using Entity Framework and storing data in a .mdf database. My code can read the data, apparently it can save too, but only apparently. It get no erros, while the program is running it act like the data was saved, I can for example save an object, dispose the context, create a new one, and then when I search my object it's there! But when I query the database to see the stored data there's nothing there. If I close the app and run it again, all data is gone. Here's a example code I wrote just to test:</p>\n\n<pre><code>        using (DatabaseEntities e = new DatabaseEntities())\n        {\n            for (int i = 0; i &lt; 50; i++)\n            {\n                User u = new User();\n                u.Nome = \"User\" + i.ToString();\n                e.AddToUser(u);\n            }\n            int c = e.SaveChanges(true);\n\n            List&lt;User&gt; us = e.User.Where&lt;User&gt;(x =&gt; x.ID &lt; 50).ToList&lt;User&gt;();\n\n            foreach (User u in us)\n                Console.WriteLine(\"ID: \" + u.ID + \" Hello from \" + u.Nome);\n\n            Console.ReadKey();\n        }\n</code></pre>\n\n<p>When I run this I get the 50 outputs, if I look the content of the c variable in the debug, there's 50 changes, everythings seems to be fine, but when I start my query browser and look in the content of my MDF database, there's nothing there.</p>\n\n<p>Probably it's something very simple but I can't see what it is, I need your help.</p>\n"},{"tags":["linq","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12974312,"title":"Entity Framework model.edmx and many to many relationships","body":"<p>In the database I have 3 tables, User, Group and a lookup table UserGroup which contains UserID and GroupId.</p>\n\n<p>I create a model.edmx and this allows me to:\nvar users = context.User\nvar groups = context.Group\nbut does not create an object for context.UserGroup.</p>\n\n<p>what is the syntax for getting all the users in a group, and all the groups that a user belongs to?</p>\n\n<pre><code>var results = from groups in db.Groups.Where(t =&gt; t.Users(u =&gt; u.UserID ==1))\nselect groups;\n</code></pre>\n"},{"tags":["wcf","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":12950145,"title":"WCF DataContractSerializer","body":"<p>I am getting the following error when trying to return a \nQuestionnaire object to the client. I added the KnowType[typeof(...)] in the Data Contract as suggested, but it still doesn't work.  Not knowing which type is unknown to the Serializer, I just threw in all classes that are in the EF model.  Can someone help?  Thanks.</p>\n\n<p>Here is the Service Contract</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Runtime.Serialization;\nusing System.ServiceModel;\nusing System.ServiceModel.Web;\nusing System.Text;\nusing QuestionnaireWcfServiceApp.Models;\n\nnamespace QuestionnaireWcfService\n{\n    [ServiceContract]\n    public interface IQuestionnaireService\n    {\n        [OperationContract]\n        QuestionnaireContract GetQuestionnaire(string questionnaireName);\n\n        [OperationContract]\n        QuestionChain LoadQuestion(int questionnaireID, int? questionID, int? userResponse);\n    }\n\n    [DataContract]\n    [KnownType(typeof(Questionnaire))]\n    [KnownType(typeof(Question))]\n    [KnownType(typeof(Choice))]\n    [KnownType(typeof(Decision))]\n    [KnownType(typeof(QuestionFlow))]\n    public class QuestionChain\n    {\n        [DataMember]\n        public Question Question { get; set; }\n\n        [DataMember]\n        public int? Decision {get;set;}\n    }\n\n    [DataContract]\n    [KnownType(typeof(Questionnaire))]\n    [KnownType(typeof(Question))]\n    [KnownType(typeof(Choice))]\n    [KnownType(typeof(Decision))]\n    [KnownType(typeof(QuestionFlow))]\n    public class QuestionnaireContract\n    {\n        [DataMember]\n        public Questionnaire Questionnaire { get; set; }\n    }\n}\n</code></pre>\n\n<p>Here is the Service.</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Runtime.Serialization;\nusing System.ServiceModel;\nusing System.ServiceModel.Web;\nusing System.Text;\nusing QuestionnaireWcfServiceApp.Models;\n\nnamespace QuestionnaireWcfService\n{\n    public class QuestionnaireService : IQuestionnaireService\n    {\n        QuestionnaireWcfServiceApp.Models.QuestionnaireEntities db = new QuestionnaireEntities();\n\n        public QuestionnaireContract GetQuestionnaire(string questionnaireName)\n        {\n            QuestionnaireContract questionnaireContract = new QuestionnaireContract();\n            if (!string.IsNullOrEmpty(questionnaireName))\n            {\n                Questionnaire thisQuestionnaire = (from q in db.Questionnaires where q.Name.Equals(questionnaireName) select q).FirstOrDefault();\n                if (thisQuestionnaire == null)\n                    throw new ArgumentNullException(\"Questionnaire ID is not found.\");\n                else\n                {\n                    questionnaireContract.Questionnaire = thisQuestionnaire;\n                    return questionnaireContract;\n                }\n            }\n            else\n                throw new ArgumentException(\"Questionnaire name is not specified.\");\n        }\n\n        public QuestionChain LoadQuestion(int questionnaireID, int? currentQuestionID, int? userResponse)\n        {\n            QuestionChain qc = new QuestionChain();\n            QuestionFlow thisFlow = null;\n            Question nextQuestion = null;           \n            Questionnaire thisQuestionnaire = (from q in db.Questionnaires where q.QuestionnaireId == questionnaireID select q).FirstOrDefault();\n\n            if (thisQuestionnaire == null)\n                throw new ArgumentNullException(\"Questionnaire ID is not found\");   //InvalidOperationException;\n\n            if (currentQuestionID.HasValue)\n            {\n                //QuestionID should never be changed after setup.  Change the QuestionText around the QuestionID\n                Question thisQuestion = thisQuestionnaire.Questions.Where(q =&gt; q.PKey.Equals(currentQuestionID)).FirstOrDefault();\n                if (thisQuestion == null)\n                    throw new ArgumentNullException(\"Question ID is not found\");\n                else\n                {\n                    if (userResponse.HasValue)\n                    {\n                        thisFlow = thisQuestion.QuestionFlows.First(f =&gt; f.QuestionId.Equals(currentQuestionID) &amp;&amp; f.ChoiceId.Equals(userResponse));\n                        if (thisFlow.Question1 != null)\n                        {\n                            nextQuestion = thisFlow.Question1;\n                            qc.Question = nextQuestion;\n                        }\n                        else\n                        {\n                            qc.Question = null;\n                            qc.Decision = thisFlow.Decision.Value;\n                        }\n                    }\n                    else\n                    {\n                        //can't happen. when reaches here, a userResponse must not be null\n                    }\n                }\n            }           \n            else\n            {\n                //default to question 1\n                nextQuestion = thisQuestionnaire.Questions.First(q =&gt; q.QuestionId.Equals(1));\n                if (nextQuestion == null)\n                    throw new ArgumentNullException(\"Question ID\");\n                else\n                    qc.Question = nextQuestion;\n            }\n            return qc;\n        }\n    }\n}\n</code></pre>\n\n<p>This is the exception in the Windows Application Log.</p>\n\n<pre><code>Exception: System.ServiceModel.CommunicationException: There was an error while trying to serialize parameter http://tempuri.org/:GetQuestionnaireResult. The InnerException message was 'Type System.Data.Entity.DynamicProxies.Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342' \nwith data contract name 'Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342:\nhttp://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies' \nis not expected. Consider using a DataContractResolver or add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.'.  Please see InnerException for more details. ---&gt; System.Runtime.Serialization.SerializationException: Type 'System.Data.Entity.DynamicProxies.Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342' with data contract name 'Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342:http://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies' is not expected. Consider using a DataContractResolver or add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.\n           at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeAndVerifyType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, Boolean verifyKnownType, RuntimeTypeHandle declaredTypeHandle, Type declaredType)\n           at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithXsiTypeAtTopLevel(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle originalDeclaredTypeHandle, Type graphType)\n           at System.Runtime.Serialization.DataContractSerializer.InternalWriteObjectContent(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.DataContractSerializer.InternalWriteObject(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.XmlObjectSerializer.WriteObjectHandleExceptions(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.XmlObjectSerializer.WriteObject(XmlDictionaryWriter writer, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameterPart(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           --- End of inner exception stack trace ---\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameterPart(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameter(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeBody(XmlDictionaryWriter writer, MessageVersion version, String action, MessageDescription messageDescription, Object returnValue, Object[] parameters, Boolean isRequest)\n           at System.ServiceModel.Dispatcher.OperationFormatter.SerializeBodyContents(XmlDictionaryWriter writer, MessageVersion version, Object[] parameters, Object returnValue, Boolean isRequest)\n           at System.ServiceModel.Dispatcher.OperationFormatter.OperationFormatterMessage.OperationFormatterBodyWriter.OnWriteBodyContents(XmlDictionaryWriter writer)\n           at System.ServiceModel.Channels.BodyWriterMessage.OnBodyToString(XmlDictionaryWriter writer)\n           at System.ServiceModel.Channels.Message.ToString(XmlDictionaryWriter writer)\n           at System.ServiceModel.Diagnostics.MessageLogTraceRecord.WriteTo(XmlWriter writer)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogInternal(MessageLogTraceRecord record)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogMessageImpl(Message&amp; message, XmlReader reader, MessageLoggingSource source)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogMessage(Message&amp; message, XmlReader reader, MessageLoggingSource source)\n         Process Name: WebDev.WebServer40\n         Process ID: 11620\n\n        Event Xml:\n        &lt;Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\"&gt;\n          &lt;System&gt;\n            &lt;Provider Name=\"System.ServiceModel 4.0.0.0\" /&gt;\n            &lt;EventID Qualifiers=\"49154\"&gt;5&lt;/EventID&gt;\n            &lt;Level&gt;2&lt;/Level&gt;\n            &lt;Task&gt;7&lt;/Task&gt;\n            &lt;Keywords&gt;0x80000000000000&lt;/Keywords&gt;\n            &lt;TimeCreated SystemTime=\"2012-10-18T07:32:11.000000000Z\" /&gt;\n            &lt;EventRecordID&gt;36499&lt;/EventRecordID&gt;\n            &lt;Channel&gt;Application&lt;/Channel&gt;\n            &lt;Computer&gt;Jon-PC&lt;/Computer&gt;\n            &lt;Security UserID=\"S-1-5-21-334737869-2079735299-2176000493-1000\" /&gt;\n          &lt;/System&gt;\n          &lt;EventData&gt;\n            &lt;Data&gt;System.ServiceModel.CommunicationException: There was an error while trying to serialize parameter http://tempuri.org/:GetQuestionnaireResult. The InnerException message was 'Type 'System.Data.Entity.DynamicProxies.Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342' with data contract name 'Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342:http://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies' is not expected. Consider using a DataContractResolver or add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.'.  Please see InnerException for more details. ---&amp;gt; System.Runtime.Serialization.SerializationException: Type 'System.Data.Entity.DynamicProxies.Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342' with data contract name 'Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342:http://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies' is not expected. Consider using a DataContractResolver or add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.\n           at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeAndVerifyType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, Boolean verifyKnownType, RuntimeTypeHandle declaredTypeHandle, Type declaredType)\n           at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithXsiTypeAtTopLevel(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle originalDeclaredTypeHandle, Type graphType)\n           at System.Runtime.Serialization.DataContractSerializer.InternalWriteObjectContent(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.DataContractSerializer.InternalWriteObject(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.XmlObjectSerializer.WriteObjectHandleExceptions(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.XmlObjectSerializer.WriteObject(XmlDictionaryWriter writer, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameterPart(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           --- End of inner exception stack trace ---\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameterPart(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameter(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeBody(XmlDictionaryWriter writer, MessageVersion version, String action, MessageDescription messageDescription, Object returnValue, Object[] parameters, Boolean isRequest)\n           at System.ServiceModel.Dispatcher.OperationFormatter.SerializeBodyContents(XmlDictionaryWriter writer, MessageVersion version, Object[] parameters, Object returnValue, Boolean isRequest)\n           at System.ServiceModel.Dispatcher.OperationFormatter.OperationFormatterMessage.OperationFormatterBodyWriter.OnWriteBodyContents(XmlDictionaryWriter writer)\n           at System.ServiceModel.Channels.BodyWriterMessage.OnBodyToString(XmlDictionaryWriter writer)\n           at System.ServiceModel.Channels.Message.ToString(XmlDictionaryWriter writer)\n           at System.ServiceModel.Diagnostics.MessageLogTraceRecord.WriteTo(XmlWriter writer)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogInternal(MessageLogTraceRecord record)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogMessageImpl(Message&amp;amp; message, XmlReader reader, MessageLoggingSource source)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogMessage(Message&amp;amp; message, XmlReader reader, MessageLoggingSource source)&lt;/Data&gt;\n            &lt;Data&gt;WebDev.WebServer40&lt;/Data&gt;\n            &lt;Data&gt;11620&lt;/Data&gt;\n          &lt;/EventData&gt;\n        &lt;/Event&gt;\n</code></pre>\n"},{"tags":["entity-framework","asp.net-mvc-4","many-to-many","bidirectional","self-referencing"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":12971885,"title":"asp.net mvc bi-directional self-referencing many-to-many","body":"<p>I am having difficulty setting up bi-directional self-referencing many-to-many mapping using EF in ASP.NET MVC4</p>\n\n<p>I have:</p>\n\n<pre><code>modelBuilder.Entity&lt;Item&gt;()\n    .HasMany(i =&gt; i.ChildItems)\n    .WithMany()\n    .Map(m =&gt; m.MapLeftKey(\"ItemID\")\n        .MapRightKey(\"ChildItemId\")\n        .ToTable(\"ItemChildItems\"));\n</code></pre>\n\n<p>So I am able to query Item.ChildItems no problem.</p>\n\n<p>However, I also want Item.Parents</p>\n\n<p>I am sure there must be an obvious solution to this but I am missing it. I have tried creating another entity Parent : Item and a separate mapping. I have also tried operating with two mapping tables. Both these become messy and I haven't managed to make them work anyway.</p>\n\n<p>I don't require any payload in the relationship. </p>\n\n<p>Any help greatly appreciated!</p>\n"},{"tags":["c#","linq","entity-framework","lambda"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12972938,"title":"Update child page's column in Linq","body":"<p>Please see the following code:</p>\n\n<pre><code>public void UpdateChildPagesReWrittenUrl(int parentPageId)\n    {\n        var childPageList = db.PcPages.Where(m =&gt; m.ParentID == parentPageId);\n\n        if (childPageList.Count() &gt; 0)\n        {\n            foreach (var item in childPageList)\n            {\n                db.ExecuteNonQuery(string.Format(\"UPDATE pcPage SET Url = {0}/{1} WHERE PageID = {2}\",\n                    GetRootUrl(item.ParentID),\n                    hnUrlHelper.UrlSafe(item.PageName), item.PageID));\n                db.SaveChanges();\n            }\n        }\n\n    }\n</code></pre>\n\n<p>I trying to update all the child pages url when a parent page updates the page name itself. This code I thought it working. but not.  Anyone can advise better in better way  please ?</p>\n"},{"tags":["vb.net","entity-framework","mef","abstraction","composition"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":146,"score":0,"question_id":8244039,"title":"Sharing Entity Framework models with other projects using MEF","body":"<p>I am currently developing a Windows service and I am am looking to use MEF to compose all of the services components at run time. The data access module (project) is using Entity Framework 4.1 and a Domain Service Class to perform CRUD operations on the entity model.</p>\n\n<p>The problem I have is how to share the models outside the DAL project when composing the DAL into the worker class in the main project.</p>\n\n<p>For exmaple this is one of the methods in the DAL contract interface</p>\n\n<pre><code>Function GetInspectionFaults() As IQueryable(Of InspectionFault)\n</code></pre>\n\n<p>This interface is currently in the DAL project (not the shared/referenced project containing the other contract interfaces) as it needs references to the entity model for the POCO types.</p>\n\n<p>How do I shared these POCO types?</p>\n\n<p>Phil</p>\n"},{"tags":["asp.net-mvc","entity-framework","multi-select","html.listboxfor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12972300,"title":"MVC MultiSelect Control for Day of week","body":"<p>I have a ASP.NET MVC 4 project with EF and I have a table <em>Orders</em> with a field <em>ShipmentDay</em> varchar(7)/string where I want to save in the database in witch days of the week the order can be shipped : 1000100 for Monday and Friday.</p>\n\n<p>Right now I have a ListBox :</p>\n\n<pre><code>@Html.ListBoxFor(model =&gt; model.ShipmentDay, new MultiSelectList(ViewBag.ShipmentDay))\n\nList&lt;string&gt; lbSDay = new List&lt;string&gt;();\nZileLiv.Add(\"Monday\"); ...\n\npublic ActionResult Create()\n{\n    ViewBag.lbSDay = lbSDay ;\n    return View();\n}\n</code></pre>\n\n<p><strong>Q:</strong> How can I make a custom multiselect control to select the days of week ?</p>\n"},{"tags":["c#","entity-framework","design-patterns","ef-code-first","domain-driven-design"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":124,"score":2,"question_id":12940954,"title":"Where to put Created date and Created by in DDD?","body":"<p>I use Entity Framework and want to use DDD principles. However there are some information regarding the entities that is on the borderline between what is logging/persistance information and what is information about the domain objects.</p>\n\n<p>I my situation these are put in an abstract base class that all entities inherit from:</p>\n\n<pre><code> public abstract class BaseEntity: IBaseEntity\n{\n\n    /// &lt;summary&gt;\n    /// The unique identifier\n    /// &lt;/summary&gt;\n    public int Id { get; set; }\n\n    /// &lt;summary&gt;\n    /// The user that created this instance\n    /// &lt;/summary&gt;\n    public User CreatedBy { get; set; }\n\n    /// &lt;summary&gt;\n    /// The date and time the object was created\n    /// &lt;/summary&gt;\n    public DateTime CreatedDate { get; set; }\n\n    /// &lt;summary&gt;\n    /// Which user was the last one to change this object\n    /// &lt;/summary&gt;\n    public User LastChangedBy { get; set; }\n\n    /// &lt;summary&gt;\n    /// When was the object last changed\n    /// &lt;/summary&gt;\n    public DateTime LastChangedDate { get; set; }\n\n    /// &lt;summary&gt;\n    /// This is the status of the entity. See EntityStatus documentation for more information.\n    /// &lt;/summary&gt;\n    public EntityStatus EntityStatus { get; set; }\n\n    /// &lt;summary&gt;\n    /// Sets the default value for a new object\n    /// &lt;/summary&gt;\n    protected BaseEntity()\n    {\n        CreatedDate = DateTime.Now;\n        EntityStatus = EntityStatus.Active;\n        LastChangedDate = DateTime.Now;\n    }\n\n}\n</code></pre>\n\n<p>Now a Domain Object can't be instansiated without providing the date and time. . However I feel it is the wrong place to put it. I can argue both was really. Maybe it should not be mixerd with the domain at all?</p>\n\n<p>Since I'm using EF Code First it makes sense to put it there, or else I would need to create new classes that inherit from the base class in the DAL also, duplicating code and needing to map to both domain objects and MVC models which does seem more messy than the approach above.</p>\n\n<p><strong>The question(s):</strong></p>\n\n<p>Is it Ok to use DateTime.Now in the Domain model at all? Where do you put this kind of information using DDD and EF Code First? Should User to be set in the domain object or require it in the Business Layer?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I think jgauffin har the right answer here - but it is really quite a fundamental change. However, on my search for an alternate solution I almost had it solved with this. I used the ChangeTracker.Entries to find ut if an entity is added or modified and set the fields accordingly. This is done in my UnitOfWork Save() method.</p>\n\n<p>The problem is loading navigation properties, like User (DateTime is set correctly). It might be since the user is a property on the abstract base class the entity inherits from. I also don't like putting strings in there, however it might solve some simple scenarios for someone so I post the solution here:</p>\n\n<pre><code>        public void SaveChanges(User changedBy)\n    {\n        foreach (var entry in _context.ChangeTracker.Entries&lt;BaseEntity&gt;())\n        {\n            if (entry.State == EntityState.Added)\n            {\n                entry.Entity.CreatedDate = DateTime.Now;\n                entry.Entity.LastChangedDate = DateTime.Now;\n                entry.Entity.CreatedBy = changedBy;\n                entry.Entity.LastChangedBy = changedBy;\n            }\n            if (entry.State == EntityState.Modified)\n            {\n                entry.Entity.CreatedDate = entry.OriginalValues.GetValue&lt;DateTime(\"CreatedDate\");\n                entry.Entity.CreatedBy = entry.OriginalValues.GetValue&lt;User&gt;(\"CreatedBy\");\n                entry.Entity.LastChangedDate = DateTime.Now;\n                entry.Entity.LastChangedBy = changedBy;\n            }\n        }\n\n\n        _context.SaveChanges();\n    }\n</code></pre>\n"},{"tags":["c#","mvc","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":1767,"score":5,"question_id":7348663,"title":"C# Entity-Framework: How can I combine a .Find and .Include on a Model Object?","body":"<p>I'm doing the mvcmusicstore practice tutorial. I noticed something when creating the scaffold for the album manager (add delete edit).</p>\n\n<p>I want to write code elegantly, so i'm looking for the clean way to write this.</p>\n\n<p>FYI i'm making the store more generic:</p>\n\n<p>Albums = Items</p>\n\n<p>Genres = Categories</p>\n\n<p>Artist = Brand</p>\n\n<p>Here is how the index is retrieved (generated by MVC):</p>\n\n<pre><code>var items = db.Items.Include(i =&gt; i.Category).Include(i =&gt; i.Brand);\n</code></pre>\n\n<p>Here is how the item for delete is retrieved:</p>\n\n<pre><code>Item item = db.Items.Find(id);\n</code></pre>\n\n<p>The first one brings back all the items and populates the category and brand models inside the item model. The second one, doesn't populate the category and brand.</p>\n\n<p>How can i write the second one to do the find AND populate whats inside (preferably in 1 line)... theoretically - something like:</p>\n\n<pre><code>Item item = db.Items.Find(id).Include(i =&gt; i.Category).Include(i =&gt; i.Brand);\n</code></pre>\n"},{"tags":["c#","asp.net-mvc","entity-framework","entity-framework-4.1","html.listboxfor"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":312,"score":1,"question_id":8157572,"title":"Edit View with child entity selection listbox and HTTPPost difficulties","body":"<p>Good day, all</p>\n\n<p>I have a Search Edit view which is strongly typed to my Search model class seen below (simplified).\n<img src=\"http://i.stack.imgur.com/cifHN.png\" alt=\"Searches and Custodians\"></p>\n\n<p>I want to display the custodians that are attributed to the Search being edited in a listbox showing all Custodians, with the current ones selected.</p>\n\n<p>My controller's Get Edit action is thus:</p>\n\n<pre><code>public ActionResult Edit(int id, int searchListId = 0)\n{\n    if (searchListId != 0)\n    {\n        Session[\"CurrentSearchListID\"] = searchListId;  \n    }\n    ProjectContext mydb = db;\n    Search search = Search.Find(mydb, id);\n\n    IEnumerable&lt;SelectListItem&gt; selectedItems =\n        from c in Custodian.List(mydb)\n        select new SelectListItem\n        {\n            Selected = (search.Custodians.Contains(c)),\n            Text = c.CustodianName,\n            Value = c.ToString()\n        };\n\n    ViewBag.Custodians = selectedItems;\n    return View(search);\n}\n</code></pre>\n\n<p>And my Views listbox is thus:</p>\n\n<pre><code>        @{\n            //List&lt;Kiersted.Keps.BusinessObjects.Custodian&gt; Custodians = ViewBag.Custodians;\n            IEnumerable&lt;SelectListItem&gt; SelectedItems = ViewBag.Custodians;\n        }\n\n        @Html.ListBox(\"Custodians\", SelectedItems);\n</code></pre>\n\n<p>This produces a listbox with the Custodians depicted, but none are selected (I have confirmed that several of the SelectListItems accurately describe the custodian as selected.  I have tried using ListBoxFor and it produces the same thing when populated with a MultiSelectList.</p>\n\n<p>Finally I decided to just force it to do what I want, but this does not return selected Custodians on Submit.</p>\n\n<pre><code>&lt;select id=\"Custodians\" multiple=\"multiple\" name=\"Custodians\"&gt;\n@foreach (Kiersted.Keps.BusinessObjects.Custodian cust in Custodians)\n{\n    if (Model.Custodians.Contains(cust))\n    {\n    &lt;option value=\"@cust.CustodianID\" selected=\"selected\"&gt;@cust.CustodianName&lt;/option&gt;\n    }\n    else\n    {\n    &lt;option value=\"@cust.CustodianID\" &gt;@cust.CustodianName&lt;/option&gt;\n    }\n}\n&lt;/select&gt;\n</code></pre>\n\n<p>Anyone know how you are <strong>supposed</strong> to do this?</p>\n\n<p>Edits:</p>\n\n<h1>ListBoxFor example</h1>\n\n<p>OK so after fiddling around with it for a while longer, I have now gotten Custodians selected in the listbox that correspond to the Search Custodians.  Below is the view code:</p>\n\n<pre><code>&lt;div class=\"editor-field\"&gt;\n    @Html.ListBoxFor(model =&gt; model.Custodians, allCustodians.Select(cust =&gt; new SelectListItem {\n                           Text = cust.CustodianName,\n                           Value = cust.CustodianID.ToString(),\n                           Selected = true}), \n                           new { Multiple = \"multiple\" })\n&lt;/div&gt;\n</code></pre>\n\n<p>If I select several more custodians, how do I get them (or their corresponding values rather) back to the control upon submit?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12562712,"title":"Multiple context for undo/redo","body":"<p>I'm trying to create a procedure for undo/redo with entity framework.</p>\n\n<p>I thought of creating a class like this:</p>\n\n<pre><code>public class multiContext\n{\n    public int _id { get; set; }\n    public undoEntities _context { get; set; }\n}\n</code></pre>\n\n<p>and for each modification create a new multiContext</p>\n\n<pre><code>private void btnSendB_Click(object sender, RoutedEventArgs e)\n{\n     multiContext nContext = new multiContext { _id = multiContextManager.getEntityID(listEntities), _context = new undoEntities};\n     listEntities.Add(nContext);\n     foreach (TB1 item in gridA.SelectedItems)\n     {\n         item.Status = \"B\";\n\n         nContext._context.Entry(item).State = System.Data.EntityState.Modified;\n         nContext._context.SaveChanges();\n     }\n\n     refreshGrids();\n }\n</code></pre>\n\n<p>but the problem is that when i SaveChanges(), it change all the context in the list.</p>\n\n<p>how can I save only the actual.</p>\n\n<p>thanks in advance</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","transactions","dbcontext"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1206,"score":0,"question_id":8655643,"title":".NET MVC 3 Rollback in Dbcontext","body":"<p>in MVC 3 is it possible to rollback the database after calling DbContext.SaveChanges() ?</p>\n\n<p>My entities class:</p>\n\n<pre><code>public class BipEntities : DbContext\n{\n    public DbSet&lt;Page&gt; Pages { get; set; }\n    public DbSet&lt;ImageFile&gt; ImageFiles { get; set; }\n}\n</code></pre>\n\n<p>What I'm trying to do is insert a ImageFile record into the db, then by using the auto-incremented id as the image filename, save the image file into somewhere else. \nWhen System.IO fails, I would like to rollback the database.</p>\n\n<pre><code>BipEntities db = new BipEntities();\ndb.Database.Connection.Open();\nDbTransaction tranx = db.Database.Connection.BeginTransaction();\n\nImageFile img = new ImageFile { CreatedAt = DateTime.Now };\ndb.ImageFiles.Add(img);\ndb.SaveChanges();\n\nstring filename = \"img\" + img.Id.ToString() + \".png\";\ntry {\n    //Works on system IO to process file\n    tranx.Commit();\n\n} Catch ( Exception) {\n    tranx.Rollback();\n}\n\ndb.Database.Connection.Close();\n</code></pre>\n\n<p>However, the above code gives me this error message:</p>\n\n<pre><code>EntityConnection can only be constructed with a closed DbConnection.\n</code></pre>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12958963,"title":"One-to-One mapping issue in EF Code First","body":"<p>Consider this scenario:</p>\n\n<pre><code>public class House\n{\n    public string Name { get; set; }\n    public virtual Person Person1 { get; set; }\n    public virtual Person Person2 { get; set; }\n}\n\npublic class Person\n{\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public House House { get; set; }\n}\n\n// Relationships\nthis.HasOptional(t =&gt; t.Person1)\n    .WithRequired(t =&gt; t.House);\nthis.HasOptional(t =&gt; t.Person2)\n    .WithRequired(t =&gt; t.House);\n</code></pre>\n\n<p>When I try to insert an instance of House a MetaDataException is thrown: </p>\n\n<blockquote>\n  <p>Schema specified is not valid. Errors:  (36,6) : error 0040: Type\n  House_Person1 is not defined in namespace Company.Models (Alias=Self).</p>\n</blockquote>\n\n<p>After a little more hacking, figured that this works:</p>\n\n<pre><code>// Relationships\nthis.HasOptional(t =&gt; t.Person1)\n    .WithRequired();\nthis.HasOptional(t =&gt; t.Person2)\n    .WithRequired();\n</code></pre>\n\n<p>But then I won't have the Person.House property populated by EF. Can I emulate this behavior (shown below)?</p>\n\n<pre><code>    public virtual Person Person1\n    {\n        get\n        {\n            return _person1;\n        }\n        set\n        {\n            _person1 = value;\n            _person1.Haushalt = this;\n        }\n    }\n\n    public virtual Person Person2\n    {\n        get\n        {\n            return _person2;\n        }\n        set\n        {\n            _person2 = value;\n            _person2.Haushalt = this;\n        }\n    }\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":362,"score":1,"question_id":9836966,"title":"MVC 3 EF - Adding new record using existing data","body":"<p>I have a db with two tables Invoices and Customers. Customers PK is FK in the Invoices table. I have a Create view in which user fills in invoice data. On this form I have a @Html.DropDownList with SelectList populated with the names of already existing in the db customers. On the basis of user selection customer data fields are autopopulated with customer data from the database via partial view:</p>\n\n<pre><code>@using (Ajax.BeginForm(\"CustomerSelect\", \"Invoice\", new AjaxOptions{\n            HttpMethod = \"GET\",\n            InsertionMode = InsertionMode.Replace,\n            UpdateTargetId = \"CustomerFields\"}))\n</code></pre>\n\n<p>This works well, but when I create the Submit button, it creates a new instance of the cutomer in the database, even though it should use the id of one retrieved from the db. When the partial view is displayed on the Create view it displayes proper Customer ID:</p>\n\n<pre><code>&lt;div class=\"editor-label\"&gt;\n    @Html.LabelFor(model =&gt; model.Customer)\n\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Customer)\n        @Html.ValidationMessageFor(model =&gt; model.Customer)\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>But when I look inside the invoice object in the httppost of controler Create method it shows shows a different (new) Customer ID:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Create(Invoice invoice)\n{\n    if (ModelState.IsValid)\n    {\n        db.Invoices.Add(invoice); **//invoice.Customer.CustomerID == 1**\n        db.SaveChanges(); **//invoice.Customer.CustomerID changes to next free in the db == 7**\n        return RedirectToAction(\"Index\");\n    }\n\n   return View(invoice);\n}\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":57,"score":4,"question_id":12926412,"title":"How to implement single SQL transaction for multiple ObjectContexts in EF4","body":"<p>I have a fairly big database with tables created for different business modules.</p>\n\n<p>We decided to create different edmx-files for different modules respectively.</p>\n\n<p>However, how can I prevent the usage of MSDTC when trying to implement a TransactionScope for a logical action that will incur writing to multiple tables in different edmx? Again, the underlying database is the same, I wouldn't want to use MSDTC for this scenario.</p>\n\n<p>Is there any way to pass in an opened SQL connection with active transaction?</p>\n\n<p>Thanks for help in advance.</p>\n\n<p>Regards,\nWilliam</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12968163,"title":"Entity Framework foreign keys are not mapped when using stored procedure","body":"<p>I am using Entity Framework (4.1) code-first .. </p>\n\n<p>I have two entity model classes :</p>\n\n<pre><code>public partial class PRODUCTS\n{\n    [Key]\n    public int PRODUCTS_ID { get; set; }\n\n    public string PRODUCTNAME { get; set; }\n\n    [ForeignKey(\"PACKINGTYPEID\")]\n    public virtual PACKINGTYPE PACKINGTYPE { get; set; }\n}\n\npublic partial class PACKINGTYPE \n{\npublic int ID {get;set;}\npublic string Name{get;set;}\n}\n</code></pre>\n\n<p>The product table has a foreign key referencing  the packing type table in the database.\nThe issue is that when I select the entity using linq </p>\n\n<pre><code>datacontext.PRODUCTS.where(p =&gt; p.PRODUCTS_ID == 1) \n</code></pre>\n\n<p>I get the corresponding <code>PACKINGTYPE</code> object .</p>\n\n<p>I have also a stored procedure which returns the product entity and I run code like this:</p>\n\n<pre><code>Context.Database.SqlQuery&lt;PRODUCTS&gt;(\"select * from PRODUCTS\").AsQueryable();\n</code></pre>\n\n<p>I get the correct mapped product object but the foreign field <code>PACKINGTYPE</code> is always null when I select using the second method</p>\n\n<p>Is there any workaround?</p>\n"},{"tags":["asp.net-mvc","entity-framework","ado.net","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12954104,"title":"willcascadeondelete in .netMVC4 is not working","body":"<p>I am creating .net MVC4 application. i have two entitites named group and groupmembers. group has a one to many relations with groupmembers.\nHere are my classes</p>\n\n<pre><code>public class Group\n  { \n    public int GroupId{get;set;}\n    public virtual ICollection&lt;GroupMember&gt; Members { get; set; }\n  }\n\npublic class GroupMember\n{\n  public int GroupMemberId { get; set; }\n\n    public int GroupId { get; set; }\n    public virtual Group Group { get; set; }\n\n    }\n</code></pre>\n\n<p>on the model side i am using the code</p>\n\n<pre><code> modelBuilder.Entity&lt;GroupMember&gt;()\n          .HasRequired(e =&gt; e.Group)\n            .WithMany()\n            .HasForeignKey(e =&gt; e.GroupId)\n           .WillCascadeOnDelete();\n</code></pre>\n\n<p>My problem is while deleting the group the members of the group is not getting deleted.Can any one please give me a solution</p>\n"},{"tags":["c#",".net","json","entity-framework","subsonic"],"answer_count":5,"favorite_count":2,"up_vote_count":20,"down_vote_count":0,"view_count":20055,"score":20,"question_id":1153385,"title":"A circular reference was detected while serializing an object of type 'SubSonic.Schema .DatabaseColumn'","body":"<p>I am trying to do a simple JSON return but I am having issues I have the following below.</p>\n\n<pre><code>public JsonResult GetEventData()\n        {\n            var data = Event.Find(x =&gt; x.ID != 0);\n            return Json(data);\n        }\n</code></pre>\n\n<p>I get a HTTP 500 with the exception as shown in the title of this question. I also tried</p>\n\n<pre><code>var data = Event.All().ToList()\n</code></pre>\n\n<p>That gave the same problem.</p>\n\n<p>Is this a bug or my implementation?</p>\n"},{"tags":["c#","asp.net-mvc","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12966932,"title":"Getting vote counts for a Post using Linq","body":"<p>Here's my database schema:</p>\n\n<pre><code>create table Post\n(\n    PostId int primary key identity,\n    ImageUrl nvarchar(1024) not null,\n    [Description] nvarchar(256) not null,\n    UserId int foreign key references [User](UserId),\n    DateOfPost datetime not null,\n    Score int\n)\n\ncreate table Vote\n(\n    VoteId int primary key identity,\n    UserId int foreign key references [User](UserId),\n    PostId int foreign key references Post(PostId),\n    VoteDirection bit not null,\n    DateOfVote datetime not null\n)\n</code></pre>\n\n<p>Basically, I want to order the Posts by <code>[VoteDirection == true] - [VoteDirection == false]</code>. So it 20 people votes \"true\", and 5 vote \"false\", the temporary score used for ordering would be 15.</p>\n\n<p>Is there also a way to select a range of date using the DateOfVote parameter?</p>\n\n<p>Here's what I've tried:</p>\n\n<pre><code>    // www.foo.com/top/today\n    public ActionResult Today()\n    {\n        var posts = postRepository.FindAllPosts().Where(x =&gt; x.DateOfPost == DateTime.Today)\n                                                 .OrderByDescending(x =&gt; x.Votes.Where(c =&gt; c.VoteDirection == true) - x.Votes.Where(c =&gt; c.VoteDirection == false));\n        return View(posts);\n    }\n</code></pre>\n\n<p>I'm getting the error:</p>\n\n<blockquote>\n  <p>Error 2   Operator '-' cannot be applied to operands of type\n  'System.Collections.Generic.IEnumerable'\n  and\n  'System.Collections.Generic.IEnumerable'</p>\n</blockquote>\n\n<p>Which is understandable, they're both collections not actual integers. But it should illustrate what I'm trying to do. Any suggestions?</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12633015,"title":"How to Add Table Prefix In Entity Framework Code First Globally?","body":"<p>I want to add all tables in the database with a prefix like 'pe_', then the mapping between a class and a table will be like this: Category(pe_Category), Product(pe_Product), etc.</p>\n\n<p>I know that with one single map, i can do like this:</p>\n\n<pre><code>[Table(\"pe_Category\")]\npublic class Category\n{\n    public int CategoryId { get; set; }\n}\n</code></pre>\n\n<p>But I don't like it cause there maybe have hundreds of entities.</p>\n\n<p>So I'm finding a way to add the prefix globally, just like this:</p>\n\n<pre><code>public class Category\n{\n    public int CategoryId { get; set; }\n}\n\npublic class Product\n{\n    public int ProductId { get; set; }\n}\n\n// Global config, will affect all entities\ntable.Name = \"pe_\" + Class.TypeName ;\n</code></pre>\n\n<p>Anybody can help me?</p>\n"},{"tags":["entity-framework","ef-code-first","t4"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":12926365,"title":"EF4 Code First pre-generated view has different hash values in other machines","body":"<p>My pre-generated views for EF4 Code First using this <a href=\"http://visualstudiogallery.msdn.microsoft.com/ae7730ce-ddab-470f-8456-1b313cd2c44d\" rel=\"nofollow\">T4 template</a> does not work in the build server. I am not re-generating the view in the build server, just compile and run the MSTest. Error is thrown when the tests are ran:</p>\n\n<blockquote>\n  <p>System.Data.MappingException: The mapping and metadata information for\n  EntityContainer 'DB' no longer matches the information used to create\n  the pre-generated views</p>\n</blockquote>\n\n<p>I ran the same template in another machine and the hash values are different. I guess this is the reason why its it does not work in the build server. The hash values are different at runtime in other machines, hence the verification fails and throws the exception.</p>\n\n<p>Im using:</p>\n\n<ul>\n<li>VS 2010 Pro</li>\n<li>.Net Framework v4.0.30319</li>\n<li>Entity Framework v4.2 (Code First)</li>\n<li><a href=\"http://visualstudiogallery.msdn.microsoft.com/ae7730ce-ddab-470f-8456-1b313cd2c44d\" rel=\"nofollow\">EF CodeFirst View Generation T4 Template for C#</a> (v1.0.1) - slightly modified GetEdmxSchemaVersion to return the correct EntityFrameworkVersions version for my setup.</li>\n<li>using Class Library project template</li>\n</ul>\n\n<p>The tests that I am running connects to a SQL DB file that is checked in with the code.</p>\n\n<p>I have checked the build server and its using the same EF dll version and .Net Framework version.</p>\n\n<p>Any idea why the hash values are different?  </p>\n\n<p><strong>UPDATE:</strong>\nI've generated and compared two XML file from two dev machines using <em>EdmxWriter.WriteEdmx()</em>. </p>\n\n<p>Here is schema version (the same in both machine):</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;Edmx Version=\"2.0\" xmlns=\"http://schemas.microsoft.com/ado/2008/10/edmx\"&gt;\n</code></pre>\n\n<p>The obvious difference are the order some nodes in the XML files. Here is an example:</p>\n\n<p>Machine 1:</p>\n\n<pre><code>&lt;EntityType Name=\"PersonEntity\" BaseType=\"Self.Entity\" /&gt;\n&lt;EntityType Name=\"CompanyEntity\" BaseType=\"Self.Entity\" /&gt;\n</code></pre>\n\n<p>Machine 2:</p>\n\n<pre><code>&lt;EntityType Name=\"CompanyEntity\" BaseType=\"Self.Entity\" /&gt;\n&lt;EntityType Name=\"PersonEntity\" BaseType=\"Self.Entity\" /&gt;\n</code></pre>\n\n<p>Any idea why they are in different order?</p>\n\n<p><strong>UPDATE 2:</strong>\nThe Edmx (xml) from the build server is also different for the other 2 dev machines. Again, the order of some nodes are different. </p>\n\n<p>Machine 1 and build server both have System.Data.Entity.dll (same File and Product version -- <em>v4.0.30319.1</em>) in %windir%\\Microsoft.NET\\assembly\\GAC_MSIL\\System.Data.Entity\\v4.0_4.0.0.0__b77a5c561934e089.</p>\n\n<p><strong>UPDATE 3:</strong>\nI also looked at the version of System.Data.Entity.Design.dll. The T4 template references this assembly. Machine 1 has two copies of this dll ... in GAC (v4.0.30319.233) and in C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework.NETFramework\\v4.0 (v4.0.30319.1). This is also true in the build server and Machine 2. I wonder if hash validation function during runtime is using this dll as its not referenced in my project. If it does, which version is used. But then again, the hash validation is successful in Machine 1.</p>\n"},{"tags":["entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1788,"score":3,"question_id":5923543,"title":"Unable to create a constant value of type 'System.Object'. Only primitive types ('such as Int32, String, and Guid') are supported in this context","body":"<p>I'm using MVC and Entity Framework.  I've created a class in my model folder with this code below.  I keep getting the error message above with both queries below.  I know there is a known issue on referencing non-scalar variables, but I'm not sure how to implement a workaround:</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/bb896317.aspx#Y1442\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb896317.aspx#Y1442</a></p>\n\n<pre><code>private MovieLibraryDBEntities movieLibraryDBEntitiesContext;\n\npublic int getNumberOfEntriesReserved()\n{\n    return (from m in movieLibraryDBEntitiesContext.Movies\n            where m.CheckedOut.Equals(1)\n            select m).Count();\n\n    //return movieLibraryDBEntitiesContext.Movies\n    //  .Where(e =&gt; e.CheckedOut.Equals(1))\n    //  .Select (e =&gt; e.Title).Count();\n}\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12965571,"title":"Map 1 to1 relationship with Fluent EF","body":"<p>I was hoping this would be fairly straight forward but I haven't had much luck. The database I'm working with has a table for users and a table for tokens, they relate to one another with a 1 to 1 relationship with tokens being as I understand it the <em>principal</em>.</p>\n\n<pre><code>public class Token\n{\n    public int ID { get; set; }\n    public string Location { get; set; }\n\n    public virtual User Contact { get; set; }\n}\n\npublic class User\n{\n    public int ID { get; set; }\n    public int TokenID { get; set; }\n    public string Name { get; set; }\n\n    public virtual Token Token { get; set; }\n}\n</code></pre>\n\n<p>So every User has an associated Token which belongs to that User only, and there also also other Tokens that relate to other objects which I will be mapping as well in a similar fashion.</p>\n\n<p>So far I have tried below as well as some variations and it hasn't worked as expected, I keep getting incorrect locations for users as it seems to be using User.ID to map to Token.ID instead of using User.TokenID.</p>\n\n<pre><code>modelBuilder.Entity&lt;User&gt;()\n    .HasRequired(p =&gt; p.Token)\n    .WithOptional(p =&gt; p.Contact);\n</code></pre>\n\n<p>I'm thinking I'm missing actually specifying the columns to use to map? I'm just unsure where to go from here. </p>\n\n<p><strong>Edit</strong> Previously when mapping relationships that use the WithRequired() extension method I've then been able to specify HasForeignKey() afterwards but WithOptional() doesn't seem to have this functionality.</p>\n"},{"tags":["sql-server","sql-server-2008","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12965181,"title":"How to create generic column in database table?","body":"<p>I have a table with a large number of very specific columns which are mostly \"Strings\". I believe this hardcoding of names will give me grief later on when rules changes. I am investigating the option of using a second table where each row is a column from the master table which could each have a lookup key for its name.</p>\n\n<p>I know this may seem anti ER best practice, but it would be flexible. I could use views with subselects ie Select (SQL1), (SQL2) etc from Table1. Not sure if one can update a multitable view though in SQLServer. </p>\n\n<p>Thoughts on the above greatly appreciated.</p>\n\n<p>Thanks,</p>\n\n<p>Ed</p>\n"},{"tags":["entity-framework","sharepoint","sharepoint2010","impersonation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":206,"score":0,"question_id":8327505,"title":"EF + UnitOfWork + SharePoint RunWithElevatedPrivileges","body":"<p>In our SharePoint application we have used the UnitOfWork + Repository patterns together with Entity Framework. To avoid the usage of the passthrough authentication we have developed a piece of code that impersonate a single user before creating the <code>ObjectContext</code> instance in a similar way that is described in \"<a href=\"http://stackoverflow.com/q/1954944/431537\">Impersonating user with Entity Framework</a>\" on this site.</p>\n\n<p>The only difference between our code and the referred question is that, to do the impersonation, we are using <code>RunWithElevatedPrivileges</code> to impersonate the Application Pool identity as in the following sample.</p>\n\n<pre><code>SPSecurity.RunWithElevatedPrivileges(delegate() { \n    using (SPSite site = new SPSite(url)) {\n        _context = new MyDataContext(ConfigSingleton.GetInstance().ConnectionString);\n    }\n});\n</code></pre>\n\n<p>We have done this way because we expected that creating the <code>ObjectContext</code> after impersonation and, due to the fact that Repositories are receiving the impersonated <code>ObjectContext</code> would solve our requirement.</p>\n\n<p>Unfortunately it's not so easy. In fact we experienced that, even if the <code>ObjectContext</code> is created before and under impersonation circumstances, the real connection is made just before executing the query, and so <strong>does not use impersonation</strong>, which break our requirement.</p>\n\n<p>I have checked the <code>ObjectContext</code> class to see if there was any event through which we can inject the impersonation but unfortunately found nothing.</p>\n\n<p>Any help?</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-3"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1043,"score":0,"question_id":4650136,"title":"Performance reprogramming website in MVC3 with Entity Framework","body":"<p>At the moment I have a fairly big website with about 10k visitors a day.</p>\n\n<p>This is a community website with news/blogs/videos and a big forum. </p>\n\n<p>This all runs on a self made PHP5 application which performance faily well, has good performance. The database is a MySQL5.1 database.</p>\n\n<p>Now I am getting fedup with PHP and the loose typed framework, lack of namespacing and a proper MVC setup, so I am thinking of rewriting the site in MVC3 ASP.NET.</p>\n\n<p>Now I have experience with this, but not in the MVC framework yet, and I have a few questions about the performance, especially the Entity Framework:\nIs it even worth using the entity framework? Will it cost alot of overhead and performance degration? I am not sure yet if I should switch to MSSQL.</p>\n"},{"tags":["vb.net","entity-framework","mvc","web-api"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12964520,"title":"MVC4 Web Api not returning Entity Framework IEnumerable()","body":"<p>I have a simple table as follows mapped with Entity Framework. I am trying to return just a very basic call of IEnumerable(Of MyTableObject) however MVC API is just bombing out with error code 500. When I try to return a IEnumerable(Of String) and select just a single column it does the same.</p>\n\n<p><img src=\"http://i.stack.imgur.com/NXthz.png\" alt=\"Entity Framework Model\"></p>\n\n<p>I try to return this model with the following code.</p>\n\n<pre><code>' GET api/chatlog\nPublic Function GetValues() As IEnumerable(Of ChatLog)\n    Using mcEntity As New McEntities\n\n        Return mcEntity.ChatLogs.ToList()\n    End Using\nEnd Function\n</code></pre>\n\n<p>Unfortunate for me with the return data. I get nothing?</p>\n\n<p>Does MVC Web API not support passing objects from EF down the pipe or do I manually have to Serialize this into XML?</p>\n\n<p>Fiddler throws \"HTTP/1.1 500 Internal Server Error\"</p>\n"},{"tags":["entity-framework","asp.net-mvc-4","visual-studio-2012","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12949409,"title":"How to write an Edit Action","body":"<p>I am trying to come up with an edit action. See below for what i have so far.</p>\n\n<p><strong>ViewModel:</strong></p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel.DataAnnotations;\nusing System.Linq;\nusing System.Web;\nusing System.Web.Mvc;\n\nnamespace GlobalUnitedSC.WebUI.Models\n{\npublic sealed class CreateMensPlayerViewModel\n{\n    //Player profile starts here\n\n    [HiddenInput(DisplayValue=false)]\n    public int MensTeamId { get; set; }\n\n    [HiddenInput(DisplayValue = false)]\n    public int PlayerId { get; set; }\n\n    [Required]\n    public string Name { get; set; }\n\n    [DataType(DataType.Date)]\n    public DateTime? BirthDate { get; set; }\n\n    [Required]\n    public string Position { get; set; }\n\n    public int ShirtNumber { get; set; }\n\n    [DataType(DataType.Date)]\n    public DateTime? Joined { get; set; }\n\n    public string Country { get; set; }\n\n    [DataType(DataType.MultilineText)]\n    public string Description { get; set; }\n\n    public byte[] ImageData { get; set; }\n\n    [HiddenInput(DisplayValue = false)]\n    public string ImageMimeType { get; set; }\n\n    [DataType(DataType.EmailAddress)]\n    public string EmailAddress { get; set; }\n\n    [DataType(DataType.PhoneNumber)]\n    public string PhoneNumber { get; set; }\n\n    //Player Statistics starts here\n    public int Games { get; set; }\n    public int Goals { get; set; }\n    public int Assists { get; set; }\n    public int TotalShots { get; set; }\n    public int ShotsOnGoal { get; set; }\n    public int FoulsDrawn { get; set; }\n    public int FoulsCommitted { get; set; }\n    public int Saves { get; set; }\n    public int BlueCards { get; set; }\n    public int YellowCards { get; set; }\n    public int RedCards { get; set; }\n }\n}\n</code></pre>\n\n<p><strong>Create Actions:</strong></p>\n\n<pre><code>    [HttpGet]\n    public ActionResult Create(int mensTeamId)\n    {\n        new CreateMensPlayerViewModel {MensTeamId = mensTeamId};\n\n        return View();\n    }\n\n    [HttpPost]\n    public ActionResult Create(CreateMensPlayerViewModel viewModel, HttpPostedFileBase  image)\n    {\n        if (ModelState.IsValid)\n        {\n            var mensTeam = _dataSource.MensTeams.Single(t =&gt; t.Id == viewModel.MensTeamId);\n            var mensPlayer = new MensPlayer\n                                 {\n                                     Name = viewModel.Name,\n                                     BirthDate = viewModel.BirthDate,\n                                     Position = viewModel.Position,\n                                     ShirtNumber = viewModel.ShirtNumber,\n                                     Joined = viewModel.Joined,\n                                     Country = viewModel.Country,\n                                     Description = viewModel.Description,\n                                     EmailAddress = viewModel.EmailAddress,\n                                     PhoneNumber = viewModel.PhoneNumber,\n                                     Games = viewModel.Games,\n                                     Goals = viewModel.Goals,\n                                     Assists = viewModel.Assists,\n                                     TotalShots = viewModel.TotalShots,\n                                     ShotsOnGoal = viewModel.ShotsOnGoal,\n                                     FoulsDrawn = viewModel.FoulsDrawn,\n                                     FoulsCommitted = viewModel.FoulsCommitted,\n                                     Saves = viewModel.Saves,\n                                     BlueCards = viewModel.BlueCards,\n                                     YellowCards = viewModel.YellowCards,\n                                     RedCards = viewModel.RedCards\n                                 };\n\n            mensTeam.MensPlayers.Add(mensPlayer);\n\n            _dataSource.Save();\n            TempData[\"message\"] = string.Format(\"{0} has been saved\", mensPlayer.Name);\n\n            return RedirectToAction(\"detail\", \"MensTeam\", new {id =         viewModel.MensTeamId});\n        }\n\n        return View(viewModel); \n    }\n</code></pre>\n\n<p><strong>HttpGet Edit Action</strong></p>\n\n<pre><code>[HttpGet]\n    public ActionResult Edit (int id)\n    {\n        var mensPlayer = _dataSource.MensPlayers.FirstOrDefault(p =&gt; p.Id == id);\n\n        return View(mensPlayer);\n    }\n</code></pre>\n\n<p>Now could anyone please help me with the HttpPost Edit action, preferably one based on the model class mentioned above?</p>\n\n<p>I was hoping it has something to do with the line below, if this creates a new player, what could i write to edit that player?</p>\n\n<pre><code>var mensPlayer = new MensPlayer {}\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first","asp.net-mvc-4","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12962737,"title":"Edit Method in MVC4 and Visual Studio 2012","body":"<p>Could someone please help me with the question i posted late last night. I am still stuck with the edit method. Link below:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/12949409/how-to-write-an-edit-action/12949879#comment17556226_12949879\">Last night question</a></p>\n\n<p>In addition to what was posted, i have also tried:</p>\n\n<p>HttpPost Edit:</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Edit(MensPlayer mensPlayer)\n    {\n        if (ModelState.IsValid)\n        {\n            //Save Player\n            _dataSource.Entry(mensPlayer).State = EntityState.Modified;\n           _dataSource.Save();\n\n           TempData[\"message\"] = string.Format(\"{0} has been saved\", mensPlayer.Name);\n            return RedirectToAction(\"Detail\", \"MensPlayer\", new {id = mensPlayer.Id});\n        }\n        return View(mensPlayer);\n    }\n</code></pre>\n\n<p>The Issue with the above method is around <code>Entry(mensPlayer).State</code>, code will not build at .Entry() and i don't seem to know where this method is being inherited. Mind you, this is the technique used in MVC-Music-Store sample.</p>\n\n<p>I have also tried this technique from Pro ASP.NET MVC3 Framework book.</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Edit(MensPlayer mensPlayer)\n    {\n        if (ModelState.IsValid)\n        {\n            //Save Player\n           _dataSource.Save();\n\n           TempData[\"message\"] = string.Format(\"{0} has been saved\", mensPlayer.Name);\n            return RedirectToAction(\"Detail\", \"MensPlayer\", new {id = mensPlayer.Id});\n        }\n        return View(mensPlayer);\n    }\n</code></pre>\n\n<p>This technique builds but doesn't seem to save changes to the database.</p>\n\n<p>How can i make it work? What am i missing?</p>\n\n<p><strong>The entire source code is on GitHub if anyone needs to look at the entire solution.</strong></p>\n\n<p><a href=\"https://github.com/komengem/GlobalUnitedSC\" rel=\"nofollow\">GitHub</a></p>\n\n<p>With Slauma's help below i have now modified as follows:</p>\n\n<p>Added <code>void Update();</code> to IDataSource and added the following to the Db class</p>\n\n<pre><code> void IDataSource.Update()\n    {\n        Entry(MensPlayers).State = EntityState.Modified;\n    }\n</code></pre>\n\n<p>HttpPost Edit:</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Edit(MensPlayer mensPlayer)\n    {\n        if (ModelState.IsValid)\n        {\n            //Save Player\n            _dataSource.Update();\n           _dataSource.Save();\n\n           TempData[\"message\"] = string.Format(\"{0} has been saved\", mensPlayer.Name);\n            return RedirectToAction(\"Detail\", \"MensPlayer\", new {id = mensPlayer.Id});\n        }\n        return View(mensPlayer);\n    }\n</code></pre>\n\n<p>All builds but then i get this error\n<strong>The entity type DbSet`1 is not part of the model for the current context.</strong></p>\n\n<p>Which is believed to originate from:</p>\n\n<pre><code>void IDataSource.Update()\n    {\n        Entry(MensPlayers).State = EntityState.Modified;\n    }\n</code></pre>\n"},{"tags":["entity-framework","entity-sql","createquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12945259,"title":"Entity SQL vs CreateQuery where one works and the other errors for the same query","body":"<p>I can use following line of code to create a query that only returns objects of 'ActivityEntity' type....</p>\n\n<pre><code>var q = CreateObjectSet&lt;EntityBase&gt;(\"EntityBases\").OfType&lt;ActivityEntity&gt;()\n</code></pre>\n\n<p>.. and running the query works as expected. But I want to actually create a query using the Entity SQL syntax and hence tried to convert the above to the following code...</p>\n\n<pre><code>string query = \"SELECT it FROM OFTYPE(MyContext.EntityBases, MyNamespace.ActivityEntity) AS it\";\nvar q = context.CreateQuery&lt;DbDataRecord&gt;(query.ToString(), new ObjectParameter[] { });\n</code></pre>\n\n<p>...except this gives the following error...</p>\n\n<blockquote>\n  <p>Type 'MyNamespace.ActivityEntity' could not be found. Make sure that the required \n  schemas are loaded and that the namespaces are imported correctly.</p>\n</blockquote>\n\n<p>...both sets of code are inside the same C# file and so there is no way there is an issue with the namespace because the strongly typed version of code works just fine. Any ideas how to go about resolving this issue?</p>\n\n<p><strong>NOTE:</strong></p>\n\n<p>Not sure if this makes a difference but the Entity Framework is setup with Code Generation Strategy of None and then I have build my own classes for use. But I have marked them with the EdmEntityTypeAttribute attribute.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12944820,"title":"Is there a generic way to get EF to return new model data and associated model data after committing changes?","body":"<p>Given the following two models:</p>\n\n<pre><code>public class Card\n{\n    public int CardId { get; set; }\n\n    public Media Media { get; set; }\n}\n\npublic class Media\n{\n    public int MediaId { get; set; }\n\n    [Required]\n    public string FileName { get; set; }\n}\n</code></pre>\n\n<p>And the following controller method:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Create(Card card)\n{\n    db.Media.Attach(card.Media);\n\n    ModelState.Remove(\"Media.FileName\");\n\n    if (ModelState.IsValid)\n    {\n        db.Cards.Add(card);                \n        db.SaveChanges();\n    }\n\n    return JsonNetSerializedResult(card);\n}\n</code></pre>\n\n<p>I want to create a new Card, but associate it with an existing Media object. I POST to \"Controller/Create\" and include a \"Media.MediaId\" parameter that contains the ID of the existing Media record and let EF make the association.</p>\n\n<p>However, after SaveChanges() is called, the only property updated on the Card instance is the CardId. I also need to retrieve the Media.FileName and set that property on the Card instance.</p>\n\n<p>Is there a generic way to tell EF that I want return the updated Card data, and to also return the associated Media data commiting the data?</p>\n"},{"tags":["c#","asp.net","entity-framework","compiled-query"],"answer_count":5,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":1210,"score":9,"question_id":4932594,"title":"When should I use a CompiledQuery?","body":"<p>I have a table:</p>\n\n<pre><code>-- Tag\n\nID  | Name\n-----------\n1   | c#\n2   | linq\n3   | entity-framework\n</code></pre>\n\n<p>I have a class that will have the following methods:</p>\n\n<pre><code>IEnumerable&lt;Tag&gt; GetAll();\nIEnumerable&lt;Tag&gt; GetByName();\n</code></pre>\n\n<p>Should I use a compiled query in this case?</p>\n\n<pre><code>static readonly Func&lt;Entities, IEnumerable&lt;Tag&gt;&gt; AllTags =\n    CompiledQuery.Compile&lt;Entities, IEnumerable&lt;Tag&gt;&gt;\n    (\n        e =&gt; e.Tags\n    );\n</code></pre>\n\n<p>Then my <code>GetByName</code> method would be:</p>\n\n<pre><code>IEnumerable&lt;Tag&gt; GetByName(string name)\n{\n    using (var db = new Entities())\n    {\n        return AllTags(db).Where(t =&gt; t.Name.Contains(name)).ToList();\n    }\n}\n</code></pre>\n\n<p>Which generates a <code>SELECT ID, Name FROM Tag</code> and execute <code>Where</code> on the code. Or should I avoid <code>CompiledQuery</code> in this case?</p>\n\n<p>Basically I want to know when I should use compiled queries. Also, on a website they are compiled only once for the entire application?</p>\n"},{"tags":["entity-framework","asp.net-web-api","audit-logging","objectstatemanager"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12962127,"title":"Dealing with complex properties with Entity Framework's ChangeTracker","body":"<p>I'll try and be as descriptive as I can in this post. I've read a dozen or more SO questions that were peripherally related to my issue, but so far none have matched up with what's going on.</p>\n\n<p>So, for performing audit-logging on our database transactions (create, update, delete), our design uses an IAuditable interface, like so:</p>\n\n<pre><code>public interface IAuditable\n{\n    Guid AuditTargetId { get; set; }\n\n    int? ContextId1 { get; }\n    int? ContextId2 { get; }\n    int? ContextId3 { get; }\n}\n</code></pre>\n\n<p>The three contextual IDs are related to how the domain model is laid out, and as noted, some or all of them may be null, depending on the entity being audited (they're used for filtering purposes for when admins only want to see the audit logs for a specific scope of the application). Any model that needs to be audited upon a CUD action just needs to implement this interface.</p>\n\n<p>The way that the audit tables themselves are being populated is through an AuditableContext that sits between the base DbContext and our domain's context. It contains the audit table DbSets, and it overrides the SaveChanges method using the EF ChangeTracker, like so:</p>\n\n<pre><code>foreach (var entry in ChangeTracker.Entries&lt;IAuditable&gt;())\n{\n    if (entry.State != EntityState.Modified &amp;&amp; \n        entry.State != EntityState.Added &amp;&amp; \n        entry.State != EntityState.Deleted)\n    {\n        continue;\n    }\n\n    // Otherwise, make audit records!\n}\n\nbase.SaveChanges();\n</code></pre>\n\n<p>The \"make audit records\" process is a slightly-complex bit of code using reflection and other fun things to extract out fields that need to be audited (there are ways for auditable models to have some of their fields \"opt out\" of auditing) and all that.</p>\n\n<p>So that logic is all well and good. The issues comes when I have an auditable model like this:</p>\n\n<pre><code>public class Foo: Model, IAuditable\n{\n    public int FooId { get; set; }\n\n    // other fields, blah blah blah...\n\n    public virtual Bar Bar { get; set; }\n\n    #region IAuditable members\n\n    // most of the auditable members are just pulling from the right fields\n\n    public int? ContextId3\n    {\n        get { return Bar.BarId; }\n    }\n\n    #endregion\n}\n</code></pre>\n\n<p>As is pointed out, for the most part, those contextual audit fields are just standard properties from the models. But there are some cases, like here, where the context id needs to be pulled from a virtual complex property.</p>\n\n<p>This ends up resulting in a <code>NullReferenceException</code> when trying to get that property out from within the SaveChanges() method - it says that the virtual Bar property does not exist. I've read some about how ChangeTracker is built to allow lazy-loading of complex properties, but I can't find the syntax to get it right. The fields don't exist in the \"original values\" list, and the object state manager doesn't have those fields, I guess because they come from the interface and not the entities directly being audited.</p>\n\n<p>So does anyone know how to get around this weird issue? Can I just force eager-loading of the entire object, virtual properties included, instead of the lazy loading that is apparently being stubborn?</p>\n\n<p>Sorry for the long-ish post, I feel like this is a really specific problem and the detail is probably needed.</p>\n\n<p>TIA! :)</p>\n"},{"tags":["c#","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12867141,"title":"Editing T4 files to customize entity class names and output file names","body":"<p>I'm using Entity Framework Reverse Engineer Code First on an existing database. The classes are created properly but I need to change the entity names. I want to prefix every entity class with \"EpiFlex\". If a SQL table name is Users, the resulting entity should be EpiFlexUsers and the output file should be EpiFlexUsers.cs.</p>\n\n<p>Is there a tag of some sort that I can add to the beginning of the T4 files to have that prefix added automatically or do I have to painstakingly go through each file and put the prefix ahead of the auto generated code?</p>\n\n<p>Or maybe I'm totally missing the point. Is there another way to specify custom naming of the entities?</p>\n"},{"tags":[".net","entity-framework","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12960571,"title":"Entity Framework Error: Unable to find the requested .Net Framework Data Provider. It may not be installed","body":"<p>I have developed application in EntityFramework. Following is the connectionstring and connector's detail </p>\n\n<pre><code>&lt;add name=\"toadbEntities\" connectionString=\"metadata=res://*/TOAModel.csdl|res://*/TOAModel.ssdl|res://*/TOAModel.msl;provider=MySql.Data.MySqlClient;provider connection string=&amp;quot;server=localhost;User Id=abc;password=xyz;Persist Security Info=True;database=toadb&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>it is giving the following Error\n\"Unable to find the requested .Net Framework Data Provider.  It may not be installed.</p>\n\n<p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n\n<p>Exception Details: System.ArgumentException: Unable to find the requested .Net Framework Data Provider.  It may not be installed.\"</p>\n\n<p>and here is the stacktrace of the exception .... local addresses of my system in it are seems to be the suspected problem. Any suggestion for the solution?</p>\n\n<p>[ArgumentException: Unable to find the requested .Net Framework Data Provider.  It may   not be installed.]\n   System.Data.Common.DbProviderFactories.GetFactory(String providerInvariantName) +1420503\n   System.Data.EntityClient.EntityConnection.GetFactory(String providerString) +35</p>\n\n<p>[ArgumentException: The specified store provider cannot be found in the configuration, or is not valid.]\n   System.Data.EntityClient.EntityConnection.GetFactory(String providerString) +62\n   System.Data.EntityClient.EntityConnection.ChangeConnectionString(String  newConnectionString) +263\n   System.Data.EntityClient.EntityConnection..ctor(String connectionString) +81\n   System.Data.Objects.ObjectContext.CreateEntityConnection(String connectionString) +42\n   System.Data.Objects.ObjectContext..ctor(String connectionString, String defaultContainerName) +16\n   TOAServices.toadbEntities..ctor() in C:\\Users\\farazsh\\Documents\\Visual Studio 2010\\Projects\\TravelOneassist\\TOAServices\\TOAModel.Designer.cs:44\n   TOAServices.Common.LogError(String apiMessage, String category, Exception ex, String pageName) in C:\\Users\\farazsh\\Documents\\Visual Studio 2010\\Projects\\TravelOneassist\\TOAServices\\Common.cs:37\n   _Default.Page_Load(Object sender, EventArgs e) in c:\\inetpub\\vhosts\\traveloneassist.com\\httpdocs\\Def.aspx.cs:85\n   System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) +14\n   System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) +35\n   System.Web.UI.Control.OnLoad(EventArgs e) +91\n   System.Web.UI.Control.LoadRecursive() +74\n   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) </p>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":346,"score":4,"question_id":7313991,"title":"Meaningful Names for Navigation Properties using Entity Framework","body":"<p>I am using the ADO .NET Entity Framework to import my model from a database.  A table in my db has a bunch of foreign keys, all with abstract names e.g. <code>FKDevice132610</code>.</p>\n\n<p>When I import the table into my model, it brings in navigation properties for each foreign key, however they are imported with names based on the table name they link to.  If there is more than one foreign key to a certain table, a number is appended on the end.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Oc1CJ.png\" alt=\"Ef model\"></p>\n\n<p>In this case Devices1 is ParentDevices and Devices2 is ChildDevices.  Is there a way I can enter this information into my foreign key (say using the description or the name) so that the Entity Framework will import meaningful names for my navigation properties?</p>\n"},{"tags":["entity-framework","entity-relationship"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12946051,"title":"Entity Framework unexpected behavior on Save Entity","body":"<p>I Have two Entities Fisioterapeuta and Paciente, one Fisioterapeuta have * Pacientes.\nWhen a Add a new Fisioterapeuta, its ok.</p>\n\n<p>In the Paciente form i have a DropDownList to select the Fisioterapeuta of the Paciente, so, the entity Paciente have a property of type Fisioterapeuta.</p>\n\n<p>When a add one patient, EF duplicates (creates another one) Fisioterapeuta.</p>\n\n<p>I know this occurs becouse the Paciente.Fisioterapeuta is != null, as i using a generic repository when a try to save the Paciente, the Fisioterapeuta goes togheter.</p>\n\n<p>Is there a way to avoid this behavior? how to handle this?</p>\n\n<p>PS: I'am using generic repository, so i cant override SaveChanges or do validations on save.</p>\n\n<h2>Edit1</h2>\n\n<p>folowing @Brad Christie sugestion i do the following:</p>\n\n<pre><code>Paciente p = (Paciente)grdEdicao.DataContext; //here the DataContext brings me the Fisioterapeuta on the property p.Fisioterapeuta\n\np.Fisioterapeuta = Repository&lt;Fisioterapeuta&gt;.GetByID((int)comboFisioterapeutas.SelectedValue); // i try to set the Fisioterapeuta getting it from the repository.\n</code></pre>\n\n<p>This change doesnt solve my problem.</p>\n\n<h2>Edit2</h2>\n\n<p>I created a github project to test it, here is <a href=\"https://github.com/Ewerton/RelatedEntities_EF\" rel=\"nofollow\">https://github.com/Ewerton/RelatedEntities_EF</a></p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12808536,"title":"Compound natural key in DbSet.AddOrUpdate","body":"<p>I'm trying to use the CodeFirst data migrations in EF5 with a table that has a composite natural key.  Is it possible to specify this in the first argument to DbSet.AddOrUpdate, like</p>\n\n<pre><code>context.Table1.AddOrUpdate(\n     t=&gt;t.Column1 &amp;&amp; t.Column2,\n     new Table1 { properties... }\n);\n</code></pre>\n\n<p>How would one specify using more than one property in this case?</p>\n\n<p>Thanks,\nMatthew</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12395253,"title":"EF and character PK/FK","body":"<p>I am a newbie in the EF. I read <a href=\"http://msdn.microsoft.com/en-us/data/gg193958.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/data/gg193958.aspx</a> and still confused.</p>\n\n<p>I have an existing database and I'm writing a Code First model. I have Operators table with op_code Char(6) Primary Key. In the Operator class I named it OperatorCode, e.g.</p>\n\n<pre><code>[Key]\n[Column(\"op_code\",TypeName = \"char\")]\n[DisplayName(\"Operator\")]\npublic virtual string OperatorCode { get; set; }\n</code></pre>\n\n<p>In several of my tables I have EnteredBy and in some ModifiedBy columns that are FK to the op_code.</p>\n\n<p>Say, for the Clients table I have both of these fields.</p>\n\n<p>So, I added to the Operator class at the bottom:</p>\n\n<pre><code>[InverseProperty(\"EnteredBy\")]\npublic virtual ICollection&lt;Client&gt; ClientsEnteredBy { get; set; }\n\n[InverseProperty(\"ModifiedBy\")]\npublic virtual ICollection&lt;Client&gt; ClientsUpdatedBy { get; set; }\n</code></pre>\n\n<p>and I added the following into the Client class:</p>\n\n<pre><code>public virtual Operator EnteredBy { get; set; }\npublic virtual Operator ModifiedBy { get; set; }\n</code></pre>\n\n<p>and I am getting a run-time error about EnteredBy_OperatorCode and ModifiedBy_OperatorCode columns.</p>\n\n<p>What should I fix /add to let EF know my column names?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["linq","entity-framework","lambda","listbox"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12959373,"title":"Error getting items from Entity Framework using Lambda query","body":"<p>I have a listbox that I am trying to populate with the result of a SQL Server query via a Entity Framework linq/lambda query. I am feeding the query with a value from a combobox.  I keep getting lot of errors like the following:  Unable to create a constant value of type 'System.Object'. Only primitive types ('such as Int32, String, and Guid') are supported in this context.</p>\n\n<p>Any suggestions on how to fix this?  I just want two fields to populate in a grid</p>\n\n<pre><code>       var pAt = ent.Patterns.Where(p =&gt; p.Case_Id == (cbCase.SelectedItem as Case).Case_Id).Select(x =&gt; new  Pattern{  PatternID = x.PatternID, Pattern1 = x.Pattern1 });\n\n        listBox1.DataSource = pAt;\n        listBox1.ValueMember = \"PatternID\";\n        listBox1.DisplayMember = \"Pattern1\";\n</code></pre>\n"},{"tags":["c#","sql-server","entity-framework","lambda","projection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12958673,"title":"Calculation in EF Projection","body":"<p>Is there a way I can achieve the following?</p>\n\n<pre><code>// colourInfo.Discount = 75, but can change\n// allPrice type has Part, Desc, Type\n\nvar a = allPricesForPgs.Where(x =&gt; x.PG == c &amp;&amp; x.ColourCode == colourInfo.ColourCode).Select(y=&gt; new AllPrice {Part=y.Part, Desc=y.Desc, Price=y.Price*(colourInfo.Discount/100)}));\n</code></pre>\n\n<p>I get the error : <strong>The entity or complex type 'Portal.AllPrice' cannot be constructed in a LINQ to Entities query.</strong></p>\n\n<p>It seems the EF cannot handle calculations, what are my options since I am getting a dynamic value from one table to do a calculation on another?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":12959021,"title":"Sorting DataGridView Entity Framework","body":"<pre><code>    var type = typeof(T);\n                var property = type.GetProperty(columnSelectName);\n                var parameter = Expression.Parameter(type, \"p\");\n                var propertyAccess = Expression.MakeMemberAccess(parameter, property);\n                var orderByExp = Expression.Lambda(propertyAccess, parameter);\n\n                if (dataGridView.Columns[e.ColumnIndex].HeaderCell.SortGlyphDirection != SortOrder.Ascending)\n                {\n                    MethodCallExpression resultExp = Expression.Call(typeof(Queryable), \"OrderBy\", new Type[] { type, property.PropertyType }, data.Expression, Expression.Quote(orderByExp));\n\n                    bindingSource.DataSource = data.Provider.CreateQuery&lt;T&gt;(resultExp);\n\n                    dataGridView.Columns[e.ColumnIndex].HeaderCell.SortGlyphDirection = SortOrder.Ascending;\n                }\n\n\npublic partial class Logs\n{\n    public string UserName\n    {\n        get\n        {\n            if (this.id_user.HasValue)\n                return this.Users.login;\n            else\n                return string.Empty;\n        }\n    }\n\n    public string TypeName\n    {\n        get\n        {\n            TypeLogs typeLogs = (TypeLogs)this.type;\n\n            switch (typeLogs)\n            {\n                case TypeLogs.LogOn:\n                    return \"Logowanie\";\n                case TypeLogs.LogOff:\n                    return \"Wylogowanie\";\n                case TypeLogs.LogOnFailed:\n                    return \"Nieudane logowanie\";\n                case TypeLogs.LogsDelete:\n                    return \"Usunięto logi\";\n                default:\n                    return string.Empty;\n            }\n        }\n    }\n</code></pre>\n\n<p>The specified type member 'Member' is not supported in LINQ to Entities. Only initializers, entity members, and entity navigation properties are supported.</p>\n\n<p>The specified type member 'Member' is not supported in LINQ to Entities. Only initializers, entity members, and entity navigation properties are supported.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12957991,"title":"EF5 : Manual table mapping","body":"<p>How to do manual table mapping in Entity Framework 5 using the Code First approach?</p>\n\n<p>What I mean by table mapping is to associate a table name from the database to an entity class with a different name.</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":64,"score":5,"question_id":12957715,"title":"How entity framework track the loaded entities? what are their life cycle?","body":"<p>I am relatively new to entity framework, all the documents or books I can find are talking about how to use the framework, or which model should be used, but short of explanation how the framework works in depth.</p>\n\n<p>For instance, when I load the entities from the database via either LINQ query or framework methods, are those entities thread safe? In another words can they be shared with other threads? If so how EF controls the consistency?</p>\n\n<p>When control goes out of context, are those entities gone or still in memory? After .SaveChanges are those entities gone? What is the life cycle?</p>\n\n<p>Can an expert in EF explain the above points in details please.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12958402,"title":"Preventing updates to specific entities in Entity Framework 5","body":"<p>Is there any way in code-first EF 5 to prevent updates on a specific entity/table? We are using EF in a WCF web service. We want updates to occur on one of the main objects, but not on some of the children. </p>\n\n<p>The idea being that if we have a main object like this:</p>\n\n<pre><code> class Person\n {\n       public Address { get; set; }\n       public string FirstName { get; set; }\n       public string LastName { get; set; }\n }\n\n class Address\n {\n       public string City { get; set; }\n       public string State { get; set; }\n }\n</code></pre>\n\n<p>We would want changes to <code>Person</code> persisted, but not changes to <code>Address</code>.</p>\n"},{"tags":["entity-framework","dll"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12953974,"title":"DLL of entity framework not work","body":"<p>In my project i use in dll of project in entity framework that I build, I have for example class like this:</p>\n\n<pre><code>public class Games\n{\n    public int GameID { get; set; }\n    public string Description { get; set; }\n    public float Time { get; set; }\n    public int Level { get; set; }\n\n    //Collection of all the players that play in the game\n    public virtual ICollection&lt;PlayerGame&gt; PlayersInGame { get; set; }\n\n}\n</code></pre>\n\n<p>in class player game define property of games like this:</p>\n\n<pre><code>    public virtual  Games Game { get; set; }\n</code></pre>\n\n<p>The constrains define on model building.</p>\n\n<p>Game in player game is foreign key in tables.</p>\n\n<p>when i test it on this project the collection fill details.</p>\n\n<p>but when i used the dll in other project the collection empty.</p>\n\n<p>the code in other project is like this:</p>\n\n<pre><code>GamesContext MyContext = new GamesContext();\nList&lt;Games&gt; GamesList= MyContext.GamesTbl.ToList();\n</code></pre>\n\n<p>in the context class i have the tables and the constrains and it work in the project of the entity frameWork!</p>\n"},{"tags":["wcf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12958312,"title":"FirstOrDefault not supported in EF","body":"<p>I am using EF and when I use FirstOrDefault on a table I get an error saying that it is not supported.  I am making the call over WCF.  Is this the issue?  Why is it not supported?  Why must I do a </p>\n\n<pre><code>Where(...).FirstOrDefault();\n</code></pre>\n\n<p>instead of just </p>\n\n<pre><code>FirstOrDefault();\n</code></pre>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4","visual-studio-2012"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12954600,"title":"Why incompatible types after extracting edmx from template ASP.Net MVC4","body":"<p>I'm new to .net, more of a Java guy, but I thought I was getting the hang of it. Only now after extracting an entity data model in a database first manner I suddenly get a couple of incompatible type errors (see below). I did nothing else.</p>\n\n<p>To reproduce:</p>\n\n<ol>\n<li>I created a template C# ASP.Net MVC4 internet application with account controller. </li>\n<li>Ran it and created a test account. </li>\n<li>Stopped debugging. </li>\n<li>Then extracted the .edmx via Project > Add new item > data > ADO.Net Entity Data Model using the default connection string. </li>\n<li><p>Then try to debug again and get the following errors:</p>\n\n<pre><code>Error   1   Cannot implicitly convert type 'MvcApplication1.Models.UserProfile' to 'MvcApplication1.UserProfile'    &lt;fileLocation&gt;  268 40  MvcApplication1\nError   2   The best overloaded method match for 'System.Data.Entity.DbSet&lt;MvcApplication1.Models.UserProfile&gt;.Add(MvcApplication1.Models.UserProfile)' has some invalid arguments  &lt;fileLocation&gt;  273 25  MvcApplication1\nError   3   Argument 1: cannot convert from 'MvcApplication1.UserProfile' to 'MvcApplication1.Models.UserProfile'   &lt;fileLocation&gt;  273 45  MvcApplication1\n</code></pre></li>\n</ol>\n\n<p>I can supply the code, but it's the default MS template code. </p>\n\n<p>I wanted to do the extraction this way, so I can expand upon the default MS model to further develop in a model first way.</p>\n\n<ul>\n<li>What's going wrong? </li>\n<li>How do I fix this? </li>\n<li>Or am I going about this\ncompletely wrong? (In which case I still want to fix it if possible.)</li>\n</ul>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":218,"score":0,"question_id":11792018,"title":"How to access context.Database.SqlQuery in Entity Framework?","body":"<p>I am trying to follow this tutorial:</p>\n\n<p><a href=\"http://blogs.msdn.com/b/diego/archive/2012/01/10/how-to-execute-stored-procedures-sqlquery-in-the-dbcontext-api.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/diego/archive/2012/01/10/how-to-execute-stored-procedures-sqlquery-in-the-dbcontext-api.aspx</a></p>\n\n<p>but can't seem to to access this method, it will not show up in intelli-sense</p>\n\n<pre><code>context.Database.SqlQuery\n</code></pre>\n\n<p>I am using the following code but can't seem to access the SqlQuery method:</p>\n\n<pre><code>using(Entities db = new Entities())\n{    \n}\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12957297,"title":"How to fasten this query on Entity Framework?","body":"<p>I have an events site. To query the events, i have to make a query with several tables involved. The problem is that this query is time consuming when not cached (3-4 sg in total). If i sum other queries made to the page for another data, it takes a pageload of 5-8 seg when not cached. \nI need to map the tables below to my Event class with the following properties (Im only writing main properties to try to minimize the problem :)</p>\n\n<pre><code>class Event\n\n  public string Name\n  public string Description\n  public DateTime Start\n  public DateTime End\n  public Location Location\n  public List&lt;Pages&gt; Topics\n  ... more simple properties\n\nclass Page\n\n      public string Name\n      public string Image\n\n\nclass Location\n\n      public string Name\n      public string Image\n      public string Address\n      public string PostalCode\n      public List&lt;Pages&gt; Topics\n  ... more simple properties\n</code></pre>\n\n<p>I have the following tables in my bd (SQL Server Express 2012)</p>\n\n<pre><code>Events (about 15000 records)\n----------\nIDEvent int --&gt; to the Pages table\nIDLocationPage int --&gt; to the Pages table\nStart datetime \nEnd datetime\n\nPages (about 15000 records)\n-------\nID int, PK\nName varchar\nDescription varchar\nIDImage int\n....More fields\n\n\nLocations (about 2000 records)\n-------------\nIDPage int --&gt; PK and FK to the Pages table\nAddress varchar\nPhone varchar\nPostal code varchar\n---more fields\n\n\nImages (about 9000 records)\n----------\nID int\nFile varchar -&gt;path to the file\n\n\nTopics (about 22000 records)\n--------\nIDPage int FK to the pages table\nIDTopic int FK to the pages table\n</code></pre>\n\n<p>As you can see, i have a table \"Events\" that for many properties navigates to the Pages table. The topics table relates each page with another pages.\nThe problem is that when i query this through Entity Framework and then i foreach the result and map it to my classes, it ends up with roundtrips to the database when bringing navigation properties (think about retrieving the image property, the topics, etc), then for each topic it retrieves the topic image, etc. it ends little optimous and if i try to do eager loading or proyection to bring only the fields i need, there are so much (note that i have to retrieve event properties, location properties, topics from event, from location, etc) that ends up with a sql timeout exception.\nMy query filters (in the where section) on start and end, may be the location, topics... etc</p>\n\n<p>I would like to know the best and more optimous way of executing the query. May be a view and then mapping it to Entity Framework? may be i cant use Entity Framework for this query and have to use another tech? This is the more complex query in the app, if i solve this query i can use Entity Framework for another querys or crud operations.</p>\n\n<p>Thanx</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12957438,"title":"How do I make an insert to a foreign key","body":"<p>I have 2 classes Bill and BillType. Each Bill should have a BillType and TypeId should be a FK. Using Code First, a column is added to my database table Bills called BillType_TypeId that has a FK relationship with the table BillTypes.</p>\n\n<pre><code>public class Bill\n{\n    [Key]\n    public int BillId { get; set; }\n\n    [Required, MaxLength(100)]\n    public string Name { get; set; }\n\n    [Required]\n    public decimal Amount { get; set; }\n\n    public System.DateTime DueDate { get; set; }\n\n    [Required]\n    public Guid UserId { get; set; }\n}\n\npublic class BillType\n{\n    [Key]\n    public int TypeId { get; set; }\n\n    [Required, MaxLength(100)]\n    public string Name { get; set; }\n\n    public virtual List&lt;Bill&gt; Bills { get; set; }\n}\n</code></pre>\n\n<p>My problem comes when I need to insert a TypeId into the Bills table. I've been using this code to insert:</p>\n\n<pre><code>public class BillActions\n{\n    private BillContext _db = new BillContext();\n\n    public Boolean InsertNewBill(int billType, string name, decimal amount, DateTime dueDate, Guid userId)\n    {\n        var bill = new Bill {                \n            xxx                              &lt;-- problem is here\n            Name = name,\n            Amount = amount,\n            DueDate = dueDate,\n            UserId = userId \n        };\n\n        _db.Bills.Add(bill);\n\n        _db.SaveChanges();\n        return true;\n    }\n}\n</code></pre>\n\n<p>There isn't an exposed object make equal to int billType. I'm not sure how to add it while still maintaining the FK constraints. How do I accomplish this. Also, I'm using Entity Framework 5.</p>\n"},{"tags":["c#","entity-framework","linq-to-entities","group-by"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":64,"score":3,"question_id":12957039,"title":"LINQ to Entities does not recognize the method 'System.String[] ToArray[String]","body":"<p>i have nearly 1 million data, which i definitely don't want to query all of them to memory and then group them, so i tried this, but linq2Entity does not recognize string.join(),  IEnumerable.toList(), or same things</p>\n\n<pre><code>                var capaHrs = (\n                from newsPerHr in _dbRawDataContext.CapacityPerHours\n                where newsPerHr.StreamDT &gt;= this.BeginDateTime\n                                &amp;&amp; newsPerHr.StreamDT &lt; this.EndDateTime\n                                &amp;&amp; newsPerHr.ServerName == this.ServerName\n                group newsPerHr by newsPerHr.StreamDT into grp\n                let MsgSizeTotal = (from i in grp select i.MsgSize).Sum(x =&gt; (int)x)\n                let MNumber = (from i in grp select i.MsgNumber).Sum(x =&gt; (int)x)\n                let Feeds = (from i in grp select i.FeedName).ToArray()\n                select new \n                {\n                    ServerName = ServerName,\n                    FeedName = Feeds,\n                    StreamDT = grp.Key,\n                    MsgSize = MsgSizeTotal,\n                    MsgNumber = MNumber\n                }).ToList();\n\n            _capacityData = capaHrs.Select(x =&gt; new CapacityPerHour {\n                ServerName = x.ServerName,\n                FeedName = string.Join(\", \",x.FeedName),\n                StreamDT = x.StreamDT,\n                MsgSize = x.MsgSize,\n                MsgNumber = x.MsgNumber\n            }).ToList();\n</code></pre>\n\n<p>how to make it work?</p>\n"},{"tags":["entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12932988,"title":"automatic refresh of cached entity framework results","body":"<p>I am performing an e.f query and storing the results as a list&lt;> in the cache.</p>\n\n<pre><code>     public static void ConstructPagesCache()\n    {\n        var db = new SomeUnitOfWork();\n\n        try\n        {\n            HttpContext.Current.Cache[\"Pages\"] = db.Pages.FindAll().ToList();\n        }\n        catch (Exception ex)\n        {\n            LogException(ex, \"some message\");\n            throw;\n        }\n        finally\n        {\n            db.Dispose();\n        }\n    }\n</code></pre>\n\n<p>What I want to be able to do if possible is have that list&lt;> update if something changes in the database.</p>\n\n<p>Is that possible with e.f using .net 4?</p>\n"},{"tags":["linq","entity-framework","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12956890,"title":"Linq Sentece Time out","body":"<p>I have a big one problem on linq, i have one sentence to fill one telerikRadGrid, is this: </p>\n\n<pre><code>    var coleccion = (from tab in tabReclamo\n                     join tabI in tabIntermediario on tab.IdIntermediario equals tabI.Id\n                     join tabR in tabReclamoEstatus on tab.IdReclamosEstatus equals tabR.IdReclamosEstatus\n                     join tabP in tabProveedor on tab.IdProveedor equals tabP.Id\n                     join tabS in tabServicio on tab.CodigoServicio equals tabS.CodigoServicio\n                     join tabA in tabAfiliado on tab.IdAfiliado equals tabA.Id\n                     join tabCert in tabCertificado on tabA.IdCertificado equals tabCert.Id\n                     join tabPo in tabPoliza on tabCert.IdPoliza equals tabPo.Id into x\n                     from y in x.DefaultIfEmpty()\n                     select new ReclamoDTO\n                     {\n                     Id = tab.Id,\n                     ReclamoId = tab.ReclamoId\n\n                     });\n\n                Conteo = coleccionconteo;\n                return UtilidadesDTO&lt;ReclamoDTO&gt;.EncriptarId(coleccion);\n            }\ncoleccion.count(); //count All registers on BD\ncoleccion.Skip((pagina - 1) * registros).Take(registros); // make pagination\n</code></pre>\n\n<p>the problem is that the firs sentence give me timeout becouse the BBDD have around 3KK of register, all joins made are necesary, how i can make pagination and count the total on one sentence??? or i need make one sentence that count, and another whit make the pagination. i try make the sentence linq whit skip and take but i dont know the real total of reg on BBDD.</p>\n\n<p>thanks.</p>\n\n<p>Sorry for my English</p>\n"},{"tags":["asp.net-mvc","entity-framework","design-patterns","domain-driven-design","repository-pattern"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":119,"score":1,"question_id":12918521,"title":"Where should the business logic be in this pattern?","body":"<p>This is my first attempt, after reading a lot about DDD, TDD and Repository / UnitOfWork paterns, to make my own application.</p>\n\n<p>I'm using Entity Framework, MVC 4 on .NET 4.0 (the server that will be running this application is a Windows 2003)</p>\n\n<p>This is the basic simplified pattern logic (The original one uses a IRepository, IUnitOfWork, GenericRepository and extends the EF POCOs with a IEntity interface to give access to the common ID field. But this simplified example will be enough to ask my question)</p>\n\n<pre><code>View -&gt; ViewModel -&gt; Controller &lt;- UnitOfWork &lt;- Repository &lt;- EntityFramework &lt;- Database\n</code></pre>\n\n<p><strong>View</strong></p>\n\n<pre><code>Model.Employee.GetSeniority()\n</code></pre>\n\n<p><strong>EmployeeDetailsViewModel</strong></p>\n\n<pre><code>Employee e { get; set; }\n</code></pre>\n\n<p><strong>Employee</strong></p>\n\n<pre><code>DateTime dateHired { get; set; }\nTimeSpan GetSeniority()\n{\n    return DateTime.Today - dateHired;\n}\n</code></pre>\n\n<p><strong>Controller EmployeeDetails()</strong></p>\n\n<pre><code>using(var unitOfWork = new UnitOfWork) {\n    return View(EmployeeDetailsViewModel model = new EmployeeDetailsViewModel {\n        e = unitOfWork.GetEmployeRepository().Find(o=&gt;o.id == id)\n    });\n}\n</code></pre>\n\n<p><strong>UnitOfWork GetEmployeRepository()</strong></p>\n\n<pre><code>return (_employeeRepository ?? _employeeRepository = new EmployeeRepository(this.dbContext));\n</code></pre>\n\n<p><strong>Repository Find()</strong></p>\n\n<pre><code>dbContext.Configuration.EnableProxyCreation = false;\nEmployee e = dbContext.Employees.Where(expression);\ndbContext.Configuration.EnableProxyCreation = true;\nreturn e;\n</code></pre>\n\n<p>Everything actually works properly. The problem is that I feel like something is terribly wrong here, and I'm not sure at which layer it should be fixed.</p>\n\n<p>After getting suggested, by a lot of people (Hi Darin), to always pass ViewModels to views and no models, I started doing this. However, what I'm doing (I think) isn't much better. I'm simply encapsulating my model in a viewmodel. At first, it didn't sound that bad since my Find() method would turn proxy off before getting an object, which would result in a persistance-ignorant POCO. However, now that I want to add some logic in the POCOs, I feel like there is something wrong.</p>\n\n<p>I think the problem resides in where my Business logic is and the fact that my Employee POCO should be mapped to a DTO object. However, where should I transfer the Employee POCO to a EmployeeDTO? Should that be the task of the Repository, the Controller or something else? I'm also unsure of where I should put my business logic (as simple as GetSeniority() displayed in the example). Should that be added to the EF POCO through partial classes or should that be in the DTOs? Or is there another missing step in the Employee -> EmployeeDTO transfer?</p>\n"},{"tags":["asp.net-mvc","entity-framework","automapper"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12941180,"title":"How can you deal with circular references when mapping?","body":"<p>Take this database for example</p>\n\n<p><strong>Employee</strong></p>\n\n<ul>\n<li>id - int (PK)</li>\n<li>name - varchar</li>\n</ul>\n\n<p><strong>Salary</strong></p>\n\n<ul>\n<li>id - int (PK)</li>\n<li>employee_id - int (FK)</li>\n<li>amount - float</li>\n</ul>\n\n<p>Entity Framework will generate models similar to these:</p>\n\n<pre><code>public partial class Employee\n{\n    public Employee()\n    {\n        this.Salaries = new HashSet&lt;Salary&gt;();\n    }\n    public int id { get; set; }\n    public string name { get; set; }\n}\n\npublic partial class Salary\n{\n    public int id { get; set; }\n    public int employee_id { get; set; }\n    public float amount  { get; set; }\n    public Employee employee { get; set; }\n}\n</code></pre>\n\n<p>The Emplyee references a list of his Salaries while each Salary points to which employee he owns. This results in a circular reference problem.</p>\n\n<p>I follow a repository pattern and use AutoMapper to transfer Employee to EmployeeDTO and Salary to SalaryDTO. I want those DTOs to keep infomation of it's children relationships. However, I dont want to do this recursively. I COULD do something like.</p>\n\n<pre><code>public partial class EmployeeDTO\n{\n    public EmployeeDTO()\n    {\n        this.Salaries = new HashSet&lt;SalaryChildDTO&gt;();\n    }\n    public int id { get; set; }\n    public string name { get; set; }\n}\n\npublic partial class SalaryChildDTO\n{\n    public int id { get; set; }\n    public float amount  { get; set; }\n}\n</code></pre>\n\n<p>But this would become a maintenance nightmare.</p>\n\n<p>How can I tell AutoMapper to only map a single decendant, or acheive a similar goal?</p>\n"},{"tags":["entity-framework","inheritance"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":12955555,"title":"Entity framework - Inheritance for tables","body":"<p>How can I manage the two following tables in Entity Framework :</p>\n\n<hr>\n\n<h2>Order</h2>\n\n<ul>\n<li>OrderId </li>\n<li>ProductId </li>\n<li>Date</li>\n</ul>\n\n<p>and</p>\n\n<hr>\n\n<h2>OrderArchive</h2>\n\n<ul>\n<li>OrderId </li>\n<li>ProductId </li>\n<li>Date</li>\n</ul>\n\n<p>In this schema orders are periodically transfered from the table Order to the table OrderArchive...\nNeither Table Per Type nor Table Per Hierarchy seems to fit my needs... I want to share the same methods for both object types.</p>\n\n<p>Note that I cannot change the database schema.\nThank you for your help.</p>\n"},{"tags":["entity-framework","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":12775543,"title":"Entity Framework Migrations: error on web server only","body":"<p>error 0175: The specified store provider cannot be found in the configuration, or is not valid</p>\n\n<p>I am using Entity Framework Code-First Migrations and everything is great locally.</p>\n\n<p>My DB is SQLServer 2008. (Also using SQL CE for local development)\nI can use the live SQL Server db connection string locally with no problem.</p>\n\n<p>Here is the Migration code in _appStart.cshtml:</p>\n\n<pre><code>@using EF = System.Data.Entity;\n@using TCommon = Told.Web.Common.Logic;\n@{\n    // Manually initialize\n    var initializer = new EF.MigrateDatabaseToLatestVersion&lt;TCommon.CommonContext, TCommon.Migrations.Configuration&gt;();\n    System.Data.Entity.Database.SetInitializer(initializer);\n    initializer.InitializeDatabase(new TCommon.CommonContext());\n\n    // DB Maintenance\n    TCommon.AppUserLogic.CleanDatabase();\n\n    // Asp.Net\n    WebSecurity.InitializeDatabaseConnection(\"ToldDB\", \"UserProfile\", \"UserId\", \"Email\", true);\n\n    // Common\n    TCommon.AppStart.Run();\n}\n</code></pre>\n\n<p>This works great locally. Either against a SQL CE or against my live database. It ran fine locally to migrate my live database to the latest version.</p>\n\n<p>However, when I put it on my web server, it throws this exception:</p>\n\n<h2>Exception</h2>\n\n<pre><code>Server Error in '/' Application.\n\nSchema specified is not valid. Errors: \n(0,0) : error 0175: The specified store provider cannot be found in the configuration, or is not valid.\n\n[MetadataException: Schema specified is not valid. Errors: \n(0,0) : error 0175: The specified store provider cannot be found in the configuration, or is not valid.]\n   System.Data.Metadata.Edm.Loader.ThrowOnNonWarningErrors() +8566285\n   System.Data.Metadata.Edm.Loader.LoadItems(IEnumerable`1 xmlReaders, IEnumerable`1 sourceFilePaths) +181\n   System.Data.Metadata.Edm.StoreItemCollection.Init(IEnumerable`1 xmlReaders, IEnumerable`1 filePaths, Boolean throwOnError, DbProviderManifest&amp; providerManifest, DbProviderFactory&amp; providerFactory, String&amp; providerManifestToken, Memoizer`2&amp; cachedCTypeFunction) +211\n   System.Data.Metadata.Edm.StoreItemCollection..ctor(IEnumerable`1 xmlReaders) +295\n   System.Data.Entity.Migrations.Extensions.XDocumentExtensions.GetStoreItemCollection(XDocument model, DbProviderInfo&amp; providerInfo) +180\n   System.Data.Entity.Migrations.Infrastructure.EdmModelDiffer.Diff(XDocument sourceModel, XDocument targetModel, String connectionString) +48\n   System.Data.Entity.Migrations.DbMigrator.IsModelOutOfDate(XDocument model, DbMigration lastMigration) +55\n   System.Data.Entity.Migrations.DbMigrator.Upgrade(IEnumerable`1 pendingMigrations, String targetMigrationId, String lastMigrationId) +269\n   System.Data.Entity.Migrations.DbMigrator.Update(String targetMigration) +456\n   System.Data.Entity.MigrateDatabaseToLatestVersion`2.InitializeDatabase(TContext context) +64\n</code></pre>\n\n<p>Now, this has something to do with the migration attempt. So when I wrap the migration call in a try-catch block, I can use the database fine (because I migrated the live db locally).</p>\n\n<pre><code>@using EF = System.Data.Entity;\n@using TCommon = Told.Web.Common.Logic;\n@{\n    // Manually initialize\n    var initializer = new EF.MigrateDatabaseToLatestVersion&lt;TCommon.CommonContext, TCommon.Migrations.Configuration&gt;();\n    System.Data.Entity.Database.SetInitializer(initializer);\n    try\n    {\n        initializer.InitializeDatabase(new TCommon.CommonContext());\n    }\n    catch (Exception ex)\n    {\n    }\n\n    var db = new TCommon.CommonContext();\n    var test = db.AppUsers.FirstOrDefault();\n\n    // DB Maintenance\n    TCommon.AppUserLogic.CleanDatabase();\n\n    // Asp.Net\n    WebSecurity.InitializeDatabaseConnection(\"ToldDB\", \"UserProfile\", \"UserId\", \"Email\", true);\n\n    // Common\n    TCommon.AppStart.Run();\n}\n</code></pre>\n\n<p>What would be causing the migration diff-check to fail when I try to run it on my web server?</p>\n\n<hr>\n\n<h3>Edit:</h3>\n\n<p>Here is the web.config for the Entity Framework:</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;configSections&gt;\n    ...\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\"/&gt;\n  &lt;/configSections&gt;\n  ...\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\"/&gt;\n  &lt;/entityFramework&gt;\n  &lt;system.web&gt;\n    &lt;trace enabled=\"true\" requestLimit=\"40\" localOnly=\"false\" pageOutput=\"true\"  /&gt;\n    &lt;customErrors mode=\"Off\"/&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.0\"&gt;\n      &lt;assemblies&gt;\n        &lt;add assembly=\"System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089\"/&gt;\n        &lt;add assembly=\"System.Web.Razor, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n      &lt;/assemblies&gt;\n    &lt;/compilation&gt;\n  &lt;/system.web&gt;\n  ...\n  &lt;connectionStrings&gt;\n    &lt;add name=\"ToldDB\" connectionString=\"...\" providerName=\"System.Data.SqlClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","visual-studio-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12954708,"title":"MVC 3 running on VS 2012 Error webdev.webserver40exe assertation failed","body":"<p>I've got a MVC 3 project which was converted to use MVC 4 using Visual Studio 4, I'm getting the following error</p>\n\n<p>webdev.webserver40exe - assertation failed</p>\n\n<p>I'm using the entity framework code first, I've changed the connection string to use SQL 2012 and can't seem to find a solution to this error.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["asp.net","asp.net-mvc","entity-framework","razor","objectstatemanager"],"answer_count":13,"favorite_count":3,"up_vote_count":28,"down_vote_count":0,"view_count":29179,"score":28,"question_id":1836173,"title":"Entity Framework: \"Store update, insert, or delete statement affected an unexpected number of rows (0).\"","body":"<p>I am using Entity Framework to populate a grid control. It sometimes when I make updates I get the following error:</p>\n\n<pre>\nStore update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.</pre>\n\n<p>I can't figure out how to reproduce this. But it might have something to do with how close together I make the updates. Has anyone seen this or does anyone know what the error message refers to?</p>\n\n<p>Edit: Unfortunately I am no longer at liberty to reproduce the problem I was having here, because I stepped away from this project and don't remember if I eventually found a solution, if another developer fixed it, or if I worked around it. Therefore I cannot accept any answers.</p>\n"},{"tags":[".net","asp.net-mvc","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12940909,"title":"MVC: Create relate entitiy when add one","body":"<p>So, my database now looks like:</p>\n\n<pre><code>Comment -&gt; Commentable \n\nCommentable -&gt; News\nCommentable -&gt; Files\nCommentable -&gt; Photo\n</code></pre>\n\n<p>This mean, when i add new entity (file or photo), i have to add new Commentable and insert this value to entity.</p>\n\n<p>What is the best practise of this? Should i override create function of entities, or put it into repository add function?</p>\n\n<p>Structure of tables looks like so, bcz i don't need to create for each entity own comments table.</p>\n\n<p><strong>Edit:</strong> My tables schema like here: <a href=\"http://stackoverflow.com/questions/10602562/one-table-vs-multiple-tables\">One table vs multiple tables</a> in Branko Dimitrijevic post</p>\n\n<p>When i want to add new file or event- at first, i have to generate new \"Commentable\" row and only after that- add with relate my entity.</p>\n\n<p>So, my question, where i have to put this logic or how to do that in the most correct practise?</p>\n\n<p>Thx.</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12949795,"title":"Use inserted record's identity without commiting","body":"<p>Let's say I have two tables: table Category and table Book</p>\n\n<p>I would like to add a Category, then use its ID for inserting a book (which has a CategoryId field pointing to the table Category). </p>\n\n<p>To get this info, I now commit my changes after inserting the category as it is not provided otherwise. </p>\n\n<p>Is there a way to point to this category when inserting my book without commiting after inserting the category?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["asp.net-mvc-3","sql-server-2008","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2144,"score":1,"question_id":10408182,"title":"A network-related or instance-specific error occurred while establishing a connection to SQL Server - ASP.NET MVC Entity Framework","body":"<p>I am using ASP.Net MVC 3 (Entity Framework) with Sql server 2008. Connection string is fine in web.config. But sometimes i get the following exception from my application:</p>\n\n<pre><code>    System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)\n\nGenerated: Wed, 02 May 2012 05:05:21 GMT\n\nSystem.Data.EntityException: The underlying provider failed on Open. ---&gt; System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\n   at System.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, Boolean encrypt, Boolean trustServerCert, Boolean integratedSecurity)\n   at System.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, SqlConnection owningObject)\n   at System.Data.SqlClient.SqlInternalConnectionTds.LoginWithFailover(Boolean useFailoverHost, ServerInfo primaryServerInfo, String failoverHost, String newPassword, Boolean redirectedUserInstance, SqlConnection owningObject, SqlConnectionString connectionOptions, TimeoutTimer timeout)\n   at System.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(SqlConnection owningObject, TimeoutTimer timeout, SqlConnectionString connectionOptions, String newPassword, Boolean redirectedUserInstance)\n   at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, Object providerInfo, String newPassword, SqlConnection owningObject, Boolean redirectedUserInstance)\n   at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection)\n   at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnection owningConnection, DbConnectionPool pool, DbConnectionOptions options)\n   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection)\n   at System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory)\n   at System.Data.SqlClient.SqlConnection.Open()\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\n   --- End of inner exception stack trace ---\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\n   at System.Data.EntityClient.EntityConnection.Open()\n   at System.Data.Objects.ObjectContext.EnsureConnection()\n   at System.Data.Objects.ObjectQuery`1.GetResults(Nullable`1 forMergeOption)\n   at System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable&lt;T&gt;.GetEnumerator()\n   at System.Linq.Enumerable.SingleOrDefault[TSource](IEnumerable`1 source)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.&lt;GetElementFunction&gt;b__2[TResult](IEnumerable`1 sequence)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.ExecuteSingle[TResult](IEnumerable`1 query, Expression queryRoot)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.System.Linq.IQueryProvider.Execute[S](Expression expression)\n   at System.Linq.Queryable.SingleOrDefault[TSource](IQueryable`1 source)\n   at MyApp.Data.UserRepository.GetUserDetails(String username)\n   at MyApp.Core.Services.SiteService.GetUserDetails(String username, Int64 userId)\n   at MyApp.PublicSite.Web.Controllers.BaseController.Initialize(RequestContext requestContext)\n   at System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext)\n   at MyApp.PublicSite.Web.Controllers.BaseController.Execute(RequestContext requestContext)\n   at System.Web.Mvc.ControllerBase.System.Web.Mvc.IController.Execute(RequestContext requestContext)\n   at System.Web.Mvc.MvcHandler.&lt;&gt;c__DisplayClass6.&lt;&gt;c__DisplayClassb.&lt;BeginProcessRequest&gt;b__5()\n   at System.Web.Mvc.Async.AsyncResultWrapper.&lt;&gt;c__DisplayClass1.&lt;MakeVoidDelegate&gt;b__0()\n   at System.Web.Mvc.Async.AsyncResultWrapper.&lt;&gt;c__DisplayClass8`1.&lt;BeginSynchronous&gt;b__7(IAsyncResult _)\n   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult`1.End()\n   at System.Web.Mvc.MvcHandler.&lt;&gt;c__DisplayClasse.&lt;EndProcessRequest&gt;b__d()\n   at System.Web.Mvc.SecurityUtil.&lt;GetCallInAppTrustThunk&gt;b__0(Action f)\n   at System.Web.Mvc.SecurityUtil.ProcessInApplicationTrust(Action action)\n   at System.Web.Mvc.MvcHandler.EndProcessRequest(IAsyncResult asyncResult)\n   at System.Web.Mvc.MvcHandler.System.Web.IHttpAsyncHandler.EndProcessRequest(IAsyncResult result)\n   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()\n   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously)\n</code></pre>\n\n<p>The Connection string is:</p>\n\n<pre><code>    &lt;connectionStrings&gt;\n    &lt;add name=\"MyAppDBContainer\" connectionString=\"metadata=res://*/MyAppDB.csdl|res://*/MyAppDB.ssdl|res://*/MyAppDB.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=SERVERNAME;initial catalog=MyAppDB;persist security info=True;user id=USERID;Password=PASSWORD;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>This exception occurs randomly and not able to get/reproduce it everytime. Any possible settings i may be missing here? Please suggest.</p>\n"},{"tags":["c#","linq","entity-framework","distinct"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":957,"score":2,"question_id":8536129,"title":"Distinct in Entity framework","body":"<p>I have a List of objects that some of them have the same Ids, so I would like to remove those elements that are duplicated. </p>\n\n<p>I tried with something like this:</p>\n\n<pre><code>List&lt;post&gt; posts = postsFromDatabase.Distinct().ToList();\n</code></pre>\n\n<p>But it doesn't work!</p>\n\n<p>So I wrote this method in order to avoid the duplicates:</p>\n\n<pre><code>public List&lt;Post&gt; PostWithOutDuplicates(List&lt;Post&gt; posts)\n    {\n        List&lt;Post&gt; postWithOutInclude = new List&lt;Post&gt;();\n        var noDupes = posts.Select(x =&gt; x.Id).Distinct();\n        if (noDupes.Count() &lt; posts.Count)\n        {\n            foreach (int idPost in noDupes)\n            {\n                postWithOutInclude.Add(posts.Where(x =&gt; x.Id == idPost).First());\n            }\n            return postWithOutInclude;\n        }\n        else\n        {\n            return posts;\n        }\n    }\n</code></pre>\n\n<p>Any ideas of how to improve the performance??</p>\n\n<p>Thanx in advance.</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":809,"score":1,"question_id":8163538,"title":"InvalidOperationException You must set this property to a non-null value of type string","body":"<p>The XX property on 'Table' could not be set to a 'Byte[]' value. You must set this property to a non-null value of type 'String'.</p>\n\n<p>I didn't create the mapping myself, this was generated from a db first scenario.  I am not inserting anything to a table, I'm just performing a select, this shouldn't happen at all?  Why am I getting this error and how do I fix it?  </p>\n"},{"tags":["json","wcf","entity-framework","c#-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":592,"score":2,"question_id":10930199,"title":"Endpoint not found WCF","body":"<p>I have WCF library that I hosted , the login function work well, but the second function ReturnCounter</p>\n\n<p>the interface is : </p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\n\nusing System.ServiceModel;\nusing System.ServiceModel.Web;\n\nnamespace PMAService\n{\n    [ServiceContract]\n    public interface IPMA\n    {\n        [OperationContract]\n        string Login(string username, string password);\n\n        [OperationContract]\n        List&lt;usp_ReturnEncounter_Result&gt; ReturnEncounter();\n\n\n\n    }\n}\n</code></pre>\n\n<p>and the code is </p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.ServiceModel.Web;\nusing System.Security.Cryptography;\nusing System.Web.Security;\n\nnamespace PMAService\n{\n    public class PMA : IPMA\n    {\n\n        [WebInvoke(Method = \"GET\",\n   ResponseFormat = WebMessageFormat.Json,\n   UriTemplate = \"LogIn/{username}/{password}\")]\n        public string Login(string username, string password)\n        {\n            if (Membership.ValidateUser(username, password))\n                return \"true\";\n            else\n                return \"false\";\n        }\n\n        // Method to retrieve the Counter \n        [WebInvoke(Method = \"GET\",\nResponseFormat = WebMessageFormat.Json,\nUriTemplate = \"ReturnEncounter\")]\n        public List&lt;usp_ReturnEncounter_Result&gt; ReturnEncounter()\n        {\n            using (PMAEntities context = new PMAEntities())\n            {\n              return   context.usp_ReturnEncounter().ToList();\n            }\n        }\n\n    }\n}\n</code></pre>\n\n<p>where I connect to Entity framework </p>\n\n<p>the web.config look like </p>\n\n<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;configuration&gt;\n  &lt;appSettings/&gt;\n  &lt;connectionStrings&gt;\n&lt;/connectionStrings&gt;\n  &lt;system.web&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.0\"/&gt;\n    &lt;roleManager enabled=\"true\" /&gt;\n    &lt;membership&gt;\n      &lt;providers&gt;\n        &lt;remove name=\"AspNetSqlMembershipProvider\"/&gt;\n        &lt;add name=\"AspNetSqlMembershipProvider\"\n             type=\"System.Web.Security.SqlMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\"\n             connectionStringName=\"Login\"\n             enablePasswordRetrieval=\"false\"\n             enablePasswordReset=\"true\"\n             requiresQuestionAndAnswer=\"false\"\n             applicationName=\"/\"\n             requiresUniqueEmail=\"false\"\n             passwordFormat=\"Hashed\"\n             maxInvalidPasswordAttempts=\"5\"\n             minRequiredPasswordLength=\"1\"\n             minRequiredNonalphanumericCharacters=\"0\"\n             passwordAttemptWindow=\"10\"\n             passwordStrengthRegularExpression=\"\" /&gt;\n      &lt;/providers&gt;\n    &lt;/membership&gt;\n\n    &lt;authentication mode=\"Windows\"/&gt;\n    &lt;customErrors mode=\"On\"/&gt;\n  &lt;/system.web&gt;\n  &lt;system.serviceModel&gt;\n    &lt;services&gt;\n      &lt;service name=\"PMAService.PMA\"&gt;\n        &lt;endpoint binding=\"webHttpBinding\" contract=\"PMAService.IPMA\" behaviorConfiguration=\"web\"&gt;\n        &lt;/endpoint&gt;\n      &lt;/service&gt;\n    &lt;/services&gt;\n    &lt;behaviors&gt;\n      &lt;endpointBehaviors&gt;\n        &lt;behavior name=\"web\"&gt;\n          &lt;webHttp /&gt;\n        &lt;/behavior&gt;\n      &lt;/endpointBehaviors&gt;\n    &lt;/behaviors&gt;\n  &lt;/system.serviceModel&gt;\n  &lt;startup&gt;\n    &lt;supportedRuntime version=\"v4.0\" sku=\".NETFramework,Version=v4.0\"/&gt;\n  &lt;/startup&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>the login/x/y work well, while ReturnCounter give the error endpoint not found </p>\n\n<p>any idea to fix that please </p>\n"},{"tags":["entity-framework","reverse-engineering"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12946930,"title":"EF Power Tools: modelEntityContainerName Invalid Characters","body":"<p>I know this has been asked before, but I'm trying to use EF Power Tools Beta 2 against a database with a hyphenated name, and I keep getting \"The modelEntityContainerName parameter 'DBName-ContinuedContext' contains characters that are not valid\". Is there an easy fix in the generation templates to avoid this error? Anybody? Thanks.</p>\n"},{"tags":["asp.net","asp.net-mvc","asp.net-mvc-3","entity-framework","entity-framework-4.3"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12946099,"title":"Keyword not supported: 'metadata'.? with Sql Connection in Entityt Framework with MVC3","body":"<p>I  am  using  Entity Framework 4 with my Asp.Net MVC3  application. My  problem  is  that  I  am  using  Entity Framework  to  perform  action  with  my  database ,  That  is  working  fine.  For  some  other  purpose I am  also  using  Sql Connection  to  Store  and  Retrieve  my  data  from database. I  am  getting  </p>\n\n<pre><code>[Keyword not supported: 'metadata']\n</code></pre>\n\n<p>error   while  connecting  with  my  database.</p>\n\n<p>This  is  my  web  config  </p>\n\n<pre><code>  &lt;add name=\"VibrantEntities\" connectionString=\"metadata=res://*/Vibrant.csdl|res://*/Vibrant.ssdl|res://*/Vibrant.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=KAPS-PC\\KAPSSERVER;initial catalog=vibrant;integrated security=True;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>I  am  using  class  Library,  So  this  is  my   App Config.</p>\n\n<pre><code>   &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.3.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n\n   &lt;add name=\"VibrantEntities\" connectionString=\"metadata=res://*/Vibrant.csdl|res://*/Vibrant.ssdl|res://*/Vibrant.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=KAPS-PC\\KAPSSERVER;initial catalog=vibrant;integrated security=True;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n"},{"tags":["entity-framework","sql-azure"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12942116,"title":"Save to multiple databases in a single transaction in SQL Azure Federation","body":"<p>I need to save to two different SQL Azure federated databases in a <strong>single transaction</strong> so I could rollback all changes if something fails. Right now, I have two separate code blocks that are transacting independently of each other. I tried using TransactionScope, but apparently SQL Azure does not support it.        </p>\n\n<pre><code>    using (EVENTContext dc = new EVENTContext(\nGetConnectionString(1)))\n    {\n        string federationCmdText = @\"USE FEDERATION [fed] ([dist] = '\"+ GetDist(1) +\"') WITH FILTERING = OFF, RESET\";\n        ((IObjectContextAdapter)dc).ObjectContext.Connection.Open();\n        dc.Database.ExecuteSqlCommand(federationCmdText);\n        dc.EVENTS.Add(e);\n        dc.SaveChanges();\n    }\n\n\n    using (EVENTContext dc = new EVENTContext(\nGetConnectionString(2)))\n    {\n        string federationCmdText = @\"USE FEDERATION [fed] ([dist] = '\"+ GetDist(2) +\"') WITH FILTERING = OFF, RESET\";\n        ((IObjectContextAdapter)dc).ObjectContext.Connection.Open();\n        dc.Database.ExecuteSqlCommand(federationCmdText);\n        dc.EVENTS.Add(e2);\n        dc.SaveChanges();\n    }\n</code></pre>\n\n<p>How can I save to multiple databases in a single transaction? I recently started reading about Unit of Work, but I'm not sure if that's what I need.</p>\n"},{"tags":["entity-framework","nested"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":2571,"score":2,"question_id":644743,"title":"Using ObjectQuery Include and using a nested where clause","body":"<p>Using entity framework, I'm trying to get back a customer with order details but I want to filter out those Orders that are active.</p>\n\n<p>Customer is our EntityObject which has a collection of Order EntityObjects.  CustomerDetails is our ObjectContext.</p>\n\n<p>The code below will attach all orders but I want to filter and only attach those that are active.  (Order.active == true).  How can I do this?  </p>\n\n<p>I know Include builds up a nested query statement (I can observe by using .ToTraceString().)  I was hoping to attach a Where clause to this nested select statement or the Include.</p>\n\n<pre><code>            Customer cust;\n        CustomerDetails custTable = new CustomerDetails();\n\n\n        cust = custTable.Customer\n            .Where(\"it.cust_id = \" + id)\n            .Include(\"Order\")  // But we only want Order.active == true!!!\n            .ToList().First();\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12945429,"title":"Can i overwrite the identity on insert in entity framework, without db writing it over","body":"<p>My column for the key</p>\n\n<pre><code>   this.Property(t =&gt; t.Guid).HasColumnName(\"Guid\")\n            .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n</code></pre>\n\n<p>And the insert.</p>\n\n<pre><code>         context.TrafficImages.Add(new TrafficImage { Guid = guids[i] });\n                context.SaveChanges();\n</code></pre>\n\n<p>When i save, the db writes its own guid. Anyway to let me write my own guid if i define it and if not the db will create one?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":436,"score":0,"question_id":11381744,"title":"The property 'Id' is part of the object's key information and cannot be modified","body":"<p>I am developing an asp.net mvc 3.0 app and using EF 4.1 for my data access layer and unit of work pattern.</p>\n\n<p>Here are my models :</p>\n\n<pre><code> public class UpdateUserViewModel\n    {\n        public User User { get; set; }\n    }\n\npublic partial class Role\n    {\n        public int Id { get; set; }\n\n     }\n\n\n    public partial class User\n    {\n        public Guid Id { get; set; }\n\n        public virtual Role Role { get; set; }\n    }\n</code></pre>\n\n<p>I pass UpdateUserViewModel to a view and then post the form in the view to the following action :</p>\n\n<pre><code>public ActionResult UpdateUser(User user)\n        {\n            var userObj = unitofwork.UserRepository.GetByID(user.Id);\n\n            TryUpdateModel(userObj, \"User\");\n\n            userObj.Role = unitofwork.RoleRepository.GetByID(user.Role.Id);\n\n            unitofwork.UserRepository.Update(userObj);\n\n            unitofwork.Save();\n        }\n</code></pre>\n\n<p>Problem raises when I Update user role in the view (it is a dropdown list) and try to update it. it gives me the following error :</p>\n\n<pre><code>The property 'Id' is part of the object's key information and cannot be modified. \n</code></pre>\n\n<p>But if i dont update the user role, it works fine.</p>\n\n<p>Would you help me please ?</p>\n"},{"tags":["c#","asp.net","entity-framework","entity-framework-4","connection-string"],"answer_count":2,"favorite_count":1,"up_vote_count":11,"down_vote_count":0,"view_count":12414,"score":11,"question_id":6232633,"title":"Entity Framework Timeouts","body":"<p>I am getting timeouts using the Entity Framework (EF) when using a function import that takes over 30 seconds to complete. I tried the following and have not been able to resolve this issue:</p>\n\n<p>I added Default Command Timeout=300000 to the connection string in the App.Config file in the project that has the EDMX file as suggested here: <a href=\"http://stackoverflow.com/questions/1718739/entity-framework-with-mysql-timeout-expired-while-generating-model\">Entity Framework with MySQL - Timeout Expired while Generating Model</a></p>\n\n<p>This is what my connection string looks like:</p>\n\n<pre><code>&lt;add \n    name=\"MyEntityConnectionString\" \n    connectionString=\"metadata=res://*/MyEntities.csdl|res://*/MyEntities.ssdl|res://*/MyEntities.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=trekdevbox;Initial Catalog=StarTrekDatabase;Persist Security Info=True;User ID=JamesTKirk;Password=IsFriendsWithSpock;MultipleActiveResultSets=True;Default Command Timeout=300000;&amp;quot;\" \n    providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>I tried setting the CommandTimeout in my repository directly like so:</p>\n\n<pre><code>private TrekEntities context = new TrekEntities();\n\npublic IEnumerable&lt;TrekMatches&gt; GetKirksFriends()\n{\n  this.context.CommandTimeout = 180;\n  return this.context.GetKirksFriends();\n}\n</code></pre>\n\n<p>What else can I do to get the EF from timing out? This only happens for very large datasets. Everything works fine with small datasets.</p>\n\n<p>Here is one of the errors I'm getting:</p>\n\n<blockquote>\n  <p>System.Data.EntityCommandExecutionException: An error occurred while executing the command definition. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.</p>\n</blockquote>\n\n<p>OK - I got this working and it's silly what happened. I had both the connection string with \"Default Command Timeout=300000\" and the CommandTimeout set to 180; When I removed the Default Command Timeout from the connection string, it worked. So the answer is to manually set the CommandTimeout in your repository on your context object like so:</p>\n\n<p>this.context.CommandTimeout = 180;\nApparently setting the timeout settings in the connection string has no effect on it.</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12927991,"title":"ASP.NET MVC Model Mixins?","body":"<p>I have a set of fields that I intend to share between multiple models. I want all the fields to be included in each entity's table (not just one table for the fields). I'm more familiar with languages such as Python, where this type of pattern is called a \"mixin\", essentially a class that doesn't exist on its own (it doesn't get instantiated/doesn't have a table in the case of a model class). Instead, the derived class simply inherits the fields and its table looks as if the fields were simply included right on the model class.</p>\n\n<p>The concept of a \"Complex Type\" in Entity Framework seems like a close proxy to what I'm looking for, but the inability to include navigation properties is a bit of killer. Is there any other way to do this, or if Complex Types are the answer, then what should I do about the navigation properties?</p>\n"},{"tags":["c#","entity-framework","transactions","transactionscope"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":179,"score":0,"question_id":12055511,"title":"Transaction scope timeout on 10 minutes","body":"<p>I have a long running transactionscope in c#. I told the scope that it should have a long timespan, but still I get a timeout. What could cause this?</p>\n\n<pre><code>TransactionOptions transactionOptions = new TransactionOptions();\ntransactionOptions.IsolationLevel = IsolationLevel.ReadCommitted;\ntransactionOptions.Timeout = TimeSpan.MaxValue;\nusing (var ts = new TransactionScope(TransactionScopeOption.Required, transactionOptions))\n{ \n          DoLongCode();\n}\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12941794,"title":"LINQ Query with Aggregates and Group By","body":"<p>i have the following SQL query...</p>\n\n<pre><code>    select  seaMake AS Make,\n        seaModel AS Model,\n        COUNT(*) AS [Count],\n        MIN(seaPrice) AS [From],\n        MIN(seaCapId) AS [CapId]\nfrom tblSearch \nwhere seaPrice &gt;= 2000\nand seaPrice &lt;= 7000\ngroup by seaMake, seaModel\norder by seaMake, seaModel\n</code></pre>\n\n<p>Im trying to write this as a LINQ to Entities Query, but im having problems. This is what i have so far but i cannot access the make and model values from the var S</p>\n\n<pre><code>var tester = from s in db.tblSearches\n             where s.seaPrice &gt;= 2000\n             &amp;&amp; s.seaPrice &lt;= 7000\n             orderby s.seaMake\n             group s by s.seaMake into g\n             select new\n             {\n                 make = g.seaMake,\n                 model = s.seaModel,\n                 count = g.Max(x =&gt; x.seaMake),\n                 PriceFrom = g.Min(s.seaPrice)\n              };\n</code></pre>\n\n<p>Where am i going wrong ?</p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":8,"up_vote_count":20,"down_vote_count":0,"view_count":7752,"score":20,"question_id":1158422,"title":"Entity Framework - Detach and keep related object graph","body":"<p>I've just started using Entity Framework rather than my normal NHiberante to see how EF works and so far I'm having lots of problems but one in particular is detaching an object and keeping the related child objects.<br />\nI bought the O'Reilly Entity Framework book which tells you \"yes entity framework by default doesn't keep the object graph when you detach\" but it doesn't show how you how to keep the graph!  Thanks O'Reilly thats really useful.  </p>\n\n<p>Anyway if anyone can help that would be great, code below:</p>\n\n<pre><code>        using (var creativeWorkshopEntities = new CreativeWorkshopEntities())\n        {\n            var q = from c in creativeWorkshopEntities.Job.Include(\"Files\")\n                    where c.Id == jobId\n                    select c;\n\n            var job = q.First();\n\n            creativeWorkshopEntities.Detach(job);\n\n            return job;\n        }\n</code></pre>\n\n<p>Thanks!</p>\n\n<p>Dan</p>\n"},{"tags":["c#","mysql","entity-framework","mysql-connector"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":149,"score":0,"question_id":12075506,"title":"ADO.Net Entity framework, Fatal error encountered during data read","body":"<p>I am getting the following error while using MySql with Entity framework. I have set the default connection timeout to 300000 on the connection string of EntityConnectionStringBuilder. How to resolve this in Entity framework?</p>\n\n<pre><code>    Unhandled Exception: System.Data.EntityCommandExecutionException: An    \n    error occurred while reading from the store provider's data reader. See the  \n    inner exception for details. ---&gt; MySql.Data.MySqlClient.MySqlException: Fatal \n    error encountered during data read. ---&gt; MySql.Data.MySqlClient.MySqlException: \n    Reading from the stream has failed. ---&gt; System.IO.EndOfStreamException: Attempted \n    to read past the end of the stream.\n</code></pre>\n\n<p>Update: How can we set net_read_timeout for ado.net entity framework?</p>\n"},{"tags":["c#","linq","entity-framework","tsql","group-by"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":11474469,"title":"How do I get a lambda query that is like this tsql query?","body":"<p>Having a T-SQL query:</p>\n\n<pre><code>select [ProductNumber] ,max([ProductRevNumber])\nfrom Products  \ngroup by [ProductNumber]\n</code></pre>\n\n<p>Attempted LINQ query:</p>\n\n<pre><code>ProductsDBContext.Products.GroupBy(x =&gt; x.ProductRevNumber)\n                          .Select(group =&gt; ProductNumber, \n                                           ProductRevNumber = group.Max(x =&gt; x.ProductRevNumber));\n</code></pre>\n\n<p>The lambda query doesn't work.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12939091,"title":"EF Code First table naming issues","body":"<p>I have a project built using EF code first. It also uses forms authentication. Until recently the membership database and the application database were being developed separately, but I want to combine them into one database for simplicity. </p>\n\n<p>One of the classes in my code first model is called \"Application\" so the EF-generated table is called \"Applications\" which conflicts with a membership table of the same name. This is an example of my current context:</p>\n\n<pre><code>public partial class ExampleContext : DbContext\n{\n    public DbSet&lt;Application&gt; Applications { get; set; }\n    public DbSet&lt;Status&gt; StatusTypes { get; set; } // notice the name of the property vs the name of the class\n}\n</code></pre>\n\n<p>I thought the table names were based on the names of the properties in the context, because it was generating a table named <code>StatusTypes</code> for all of the <code>Status</code> objects. But if I rename the <code>Applications</code> property to something like <code>MyApplications</code> it is still generating a table named <code>Applications</code>. So clearly it's not just the name of the property and I'm missing something.</p>\n\n<p>My question: how do I get EF to name this table differently?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","godaddy"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":535,"score":0,"question_id":10353595,"title":"Deploying EF Code First CREATE DATABASE permission denied","body":"<p>I am trying to deploy my site to a godaddy web host and I am receiving this error</p>\n\n<pre><code>CREATE DATABASE permission denied in database 'master'.\n</code></pre>\n\n<p>From what I have read, my only options are to either use another account that has permission to create a database, or manually create my database one table at a time. being that its a godaddy host I cant grant myself access, so is there any alternatives to manually creating the database.</p>\n\n<p><strong>Are there any tools that will help me auto generate insert.sql scripts from my local server ?</strong></p>\n\n<p>My connection string is</p>\n\n<pre><code>&lt;add name=\"DataContext\" \nconnectionString=\"Server=servername.db.9485321.hostedresource.com; \nDatabase=databasename; User ID=userid; Password=password; Trusted_Connection=False\" \nproviderName=\"System.Data.SqlClient\" /&gt; \n</code></pre>\n\n<p>I have also tried this in my Application_Start(), but it still tries to create a database</p>\n\n<pre><code>Database.SetInitializer&lt;MyContext&gt;(null);\n</code></pre>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":2,"up_vote_count":16,"down_vote_count":0,"view_count":7936,"score":16,"question_id":614809,"title":"Entity Framework .Include() Navigation of another Navigation property","body":"<p>I have an entity <em>Test</em>. It contains a Navaigation Property <em>Question</em> and <em>Question</em> contains a Navigation Property <em>QuestionLocale</em>.</p>\n\n<pre><code>var test = context.Tests\n       .Include(\"Question\")\n       .FirstOrDefault();\n</code></pre>\n\n<p>works as expected. But how is it possible to include the <em>QuestionLocale</em>?</p>\n"},{"tags":["c#","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":11993709,"title":"Why am I getting an error when editing relationships with EntityFramework?","body":"<p>I have three EntityFramework (4.3) objects, a Member, Address and a State. They look like this:</p>\n\n<pre><code>public class Member\n{\n    public int Id { get; set; }\n    public virtual Address Address { get; set; }\n    /*other properties removed for brevity*/\n}\n\npublic class Address\n{\n    public int Id { get; set; }\n    public virtual State State { get; set; }\n    /*other properties removed for brevity*/\n}\n\npublic class State\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string Abbreviation { get; set; }\n    public virtual ICollection&lt;Address&gt; Address { get; set; }\n}\n</code></pre>\n\n<p>When I update the address relationship, everything works fine. See code below:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Update(MemberUpdateModel model)\n{\n    if (!ModelState.IsValid)\n    {\n        model.SetStateSelectList(_db, model.SelectedStateId);\n        return View(model);\n    }\n\n    _db.Entry(model.Member).State = EntityState.Modified;\n    _db.Entry(model.Member.Address).State = EntityState.Modified;\n\n    _db.SaveChanges(); // works\n\n    return RedirectToAction(\"Index\");\n}\n</code></pre>\n\n<p>Then I add in the update for the Address/State relationship like this:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Update(MemberUpdateModel model)\n{\n    if (!ModelState.IsValid)\n    {\n        model.SetStateSelectList(_db, model.SelectedStateId);\n        return View(model);\n    }\n\n    _db.Entry(model.Member).State = EntityState.Modified;\n    _db.Entry(model.Member.Address).State = EntityState.Modified;\n\n    // added for address/state relationship\n    var selectedState = _db.States.FirstOrDefault(q =&gt; q.Id == model.SelectedStateId);\n    model.Member.Address.State = selectedState;\n\n    _db.SaveChanges();\n\n    return RedirectToAction(\"Index\");\n}\n</code></pre>\n\n<p>When we run the above code, we get the following error:</p>\n\n<pre><code>Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.Data.OptimisticConcurrencyException: Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.\n</code></pre>\n\n<p>What am I doing wrong to cause this behavior?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":37,"score":-2,"question_id":12940111,"title":"Can't determine neccessary type for database entity","body":"<p>My goal is to make a deletion function that uses LINQ to delete a record from a database table by finding the id the user inputs that matches the record's primary key.  </p>\n\n<ul>\n<li><p><strong>MyDBEntitiesClass</strong> is the argument that the function needs to be passed which tells it what DataTable to search. </p></li>\n<li><p><strong>IDontKnowWhatType</strong> is the type I'm asking for help in determining.</p></li>\n<li><p><strong>MyPrimaryKey</strong> needs to be replaced with something that references the primary key of MyDBEntitiesClass.</p></li>\n<li><p><strong>TestDatabaseEntities</strong> is the name of the connection string created by generating an entity model from my existing SQL server database.</p></li>\n</ul>\n\n<pre><code>public static void DeleteFrom(IDontKnowWhatType MyDBEntitiesClass)\n{\n\nvar dbEntities = new TestDatabaseEntities(); \n\n    //Prompt the user for an ID\n    Console.WriteLine(\"Select ID for deletion.\");\n\n    // save the ID to IDtoMark\n    int IDtoMark = int.Parse(Console.ReadLine());\n    try\n    {\n        // return a single record that matches IDtoMark \n        MyDbEntitiesClass x = dbEntities.MyDbEntitiesClass.Single(x => x.myPrimaryKey == IDtoMark);\n        //Remove the marked record, and save changes\n        dbEntities.MyDbEntitiesClass.Remove(x);\n        dbEntities.SaveChanges();\n    }\n    catch(Exception ex)\n    {\n        Console.WriteLine(ex.Message);\n    }\n}\n</code></pre>\n"},{"tags":["c#","mysql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":150,"score":0,"question_id":12410666,"title":"Unable to read data from the transport connection exception","body":"<p>I've got a MySQL 5.5 DB server, using Entity Framework 4.3, MySQL Connector 6.5.4.</p>\n\n<p>The problem that I'm seeing is that over a slow connection (~192kbs) seems to be fairly consistent.  </p>\n\n<p>The scenario is that I first call a method that looks like this:</p>\n\n<pre><code>using (var db = new IceCreamEntities(ConnectionString, null, null, null, \"infinite timeout\"))\n{\n   db.desserts.Add(myDessert);\n   db.SaveChanges()\n\n   db.dessertData.Add(new dessertBlob() { DessertId = myDessert.Id, Data = someData });\n}\n</code></pre>\n\n<p>and then I call closely after that (say, within 30 seconds or so) a method to get that back.  It looks like:</p>\n\n<pre><code>using (var db = new IceCreamEntities(ConnectionString, null, null, null, \"infinite timeout\"))\n{\n   var myDessertData = db.dessertData.Where(m =&gt; m.DessertId == myId).FirstOrDefault();\n   return myDessertData;\n}\n</code></pre>\n\n<p>Now, the <code>IceCreamEntities</code> constructor call there that I'm using does the following:</p>\n\n<pre><code>public IceCreamEntities(string connectionString, string unused2, string unused3, string unused4, string forLongRunningStuff)\n: base(connectionString)\n{\n   var objectContext = (this as IObjectContextAdapter).ObjectContext;\n   objectContext.CommandTimeout = 0;\n}\n</code></pre>\n\n<p><em>(there are a couple other constructors that are used with different timeouts, but that is probably not germane to the discussion)</em></p>\n\n<p>The blob I'm putting into that dessertData table is about 3 megabytes in size.  </p>\n\n<p>When I'm not on a slow connection, I don't see this problem.</p>\n\n<p>The exception I get is:</p>\n\n<blockquote>\n  <p>System.Data.EntityCommandExecutionException: An error occurred while\n  executing the command definition. See the inner exception for details.</p>\n  \n  <p>---> MySql.Data.MySqlClient.MySqlException: Fatal error encountered during command execution. </p>\n  \n  <p>---> MySql.Data.MySqlClient.MySqlException: Fatal error encountered attempting to read the resultset. </p>\n  \n  <p>---> MySql.Data.MySqlClient.MySqlException: Reading from the stream has failed.<br>\n  ---> System.IO.IOException: Unable to read data from the transport connection: An existing connection was forcibly closed by the remote\n  host. </p>\n  \n  <p>---> System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host</p>\n  \n  <p>at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32\n  offset, Int32 size)</p>\n  \n  <p>--- End of inner exception stack trace ---</p>\n  \n  <p>at\n  MySql.Data.Common.MyNetworkStream.HandleOrRethrowException(Exception\n  e)</p>\n  \n  <p>at MySql.Data.Common.MyNetworkStream.Read(Byte[] buffer, Int32\n  offset, Int32 count)</p>\n  \n  <p>at MySql.Data.MySqlClient.TimedStream.Read(Byte[] buffer, Int32\n  offset, Int32 count)</p>\n  \n  <p>at System.IO.BufferedStream.Read(Byte[] array, Int32 offset, Int32\n  count)</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlStream.ReadFully(Stream stream,\n  Byte[] buffer, Int32 offset, Int32 count)</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlStream.LoadPacket()</p>\n  \n  <p>--- End of inner exception stack trace ---</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlStream.LoadPacket()</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlStream.ReadPacket()</p>\n  \n  <p>at MySql.Data.MySqlClient.NativeDriver.FetchDataRow(Int32\n  statementId, Int32 columns)</p>\n  \n  <p>at MySql.Data.MySqlClient.Driver.FetchDataRow(Int32 statementId,\n  Int32 columns)</p>\n  \n  <p>at MySql.Data.MySqlClient.ResultSet.GetNextRow()</p>\n  \n  <p>at MySql.Data.MySqlClient.ResultSet..ctor(Driver d, Int32\n  statementId, Int32 numCols)</p>\n  \n  <p>at MySql.Data.MySqlClient.Driver.NextResult(Int32 statementId,\n  Boolean force)</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlDataReader.NextResult()</p>\n  \n  <p>--- End of inner exception stack trace ---</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlDataReader.NextResult()</p>\n  \n  <p>at\n  MySql.Data.MySqlClient.MySqlCommand.ExecuteReader(CommandBehavior\n  behavior)</p>\n  \n  <p>--- End of inner exception stack trace ---</p>\n  \n  <p>at\n  MySql.Data.MySqlClient.MySqlCommand.ExecuteReader(CommandBehavior\n  behavior)</p>\n  \n  <p>at\n  MySql.Data.Entity.EFMySqlCommand.ExecuteDbDataReader(CommandBehavior\n  behavior)</p>\n  \n  <p>at\n  System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand\n  entityCommand, CommandBehavior behavior)</p>\n  \n  <p>--- End of inner exception stack trace ---</p>\n  \n  <p>at\n  System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand\n  entityCommand, CommandBehavior behavior)</p>\n  \n  <p>at\n  System.Data.Objects.Internal.ObjectQueryExecutionPlan.Execute[TResultType](ObjectContext\n  context, ObjectParameterCollection parameterValues)</p>\n  \n  <p>at System.Data.Objects.ObjectQuery<code>1.GetResults(Nullable</code>1\n  forMergeOption)</p>\n  \n  <p>at\n  System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable.GetEnumerator()</p>\n  \n  <p>at System.Linq.Enumerable.FirstOrDefault[TSource](IEnumerable`1\n  source)</p>\n  \n  <p>at\n  System.Data.Entity.Internal.Linq.DbQueryProvider.Execute[TResult](Expression\n  expression)</p>\n  \n  <p>at System.Linq.Queryable.FirstOrDefault[TSource](IQueryable`1\n  source)</p>\n  \n  <p>at IceCream.Repository.GetDessertData(Int64 dessertId) in ....</p>\n</blockquote>\n\n<p>One other data point - I can call the method that does the add twice in a row with the same sized blob and I don't get this error (or the equivalent).  It only happens when I do an Add and then follow it up with the Retrieve.</p>\n\n<p>Any ideas how to address this?  I had thought that settting the command timeout value to 0 would solve my problems but it doesn't.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>One other point is that I did the math and 3 megabytes at 192mbs should take somewhere in the neighborhood of 128 seconds to transfer.</p>\n"},{"tags":["entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12939211,"title":"why the output always \"System.Object\"","body":"<p>in EF I want tto get the first value of query so I use </p>\n\n<pre><code>ExecuteStoreQuery&lt;object&gt;(Query, null).FirstOrDefault();\n</code></pre>\n\n<p>because I don't know what's the actual returned data type \nif the value comming is numeric is crash , so I used the following</p>\n\n<pre><code>ExecuteStoreQuery&lt;object&gt;(Query, null).Select(x =&gt; x.ToString()).FirstOrDefault() \n</code></pre>\n\n<p>but the resulted string  always <code>System.Object</code> </p>\n\n<p>any idea how to get the actual value </p>\n\n<p>Best regards</p>\n"},{"tags":["c#","visual-studio","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12939082,"title":"no POCO classes in EF 5.0","body":"<p>i used always EF 4.2 and gernerated my edmx model files with visual studio. I never used POCO and tt files (and have no idea about it).</p>\n\n<p>Now i updated to visual studio and EF 5.0.</p>\n\n<p>When i want to add a new model in VS all that POCO stuff is generated and i can't set a connection at runtime to my model. Is this still possible? With my former solution i easily could set the connection string at runtime in the constructor.\nIs it possible to generate my model file the old way without that POCO stuff?</p>\n\n<p>My model is now derived from DBContext and the former models are derived from ObjectContext.</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":118,"score":2,"question_id":12903732,"title":"Slow speed when using nested loops when comparing large data sets","body":"<p>I'm retrieving two lists of datasets using Linq to entities. They're both in the same Database, but I need to get one table converted into my Tasks Table because it's integrated into my Calendar. Not worth going into extreme detail here I'm sure but I would love to speed up the process of matching id's and Creating new Task objects. This is a Once and done snippet so even at a slow speed I can simply leave the program running overnight. However, for future reference I'd like some suggestions on increasing the efficiency.</p>\n\n<pre><code>var accounts = data.Accounts.ToList().OrderBy(a =&gt; a.ID);\nIncidents[] Incidents = data.Incidents.ToArray();\n\n        for (int i=0;i&lt;Incidents.Length;i++)\n        {\n            foreach (var a in accounts)\n            {\n                if (a.Acct_CID == Incidents[i].CustomerID)\n                {\n                    Tasks t = new Tasks();\n                    t.creator_id = a.ID;\n                    t.start_date = Incidents[i].DateOpened;\n                    t.end_date = Incidents[i].DateCLosed;\n                    t.product_code = Incidents[i].ProductCode;\n                    t.install_type = Incidents[i].InstallType;\n                    t.os = Incidents[i].OSType;\n                    t.details = Incidents[i].Description;\n                    t.solution = Incidents[i].Solution;\n                    t.creator_name = Incidents[i].TechID;\n                    t.category = Incidents[i].Title;\n                    t.text = \"Ticket for\" + \" \" + Incidents[i].Name;\n                    if (t.end_date == DateTime.MinValue || t.end_date == null)\n                        t.status_id = 6;\n                    else t.status_id = 7;\n                    data.Tasks.Add(t);\n                    break;\n                }\n            }\n        }\n        data.SaveChanges();\n</code></pre>\n"},{"tags":["c#",".net","sql-server","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12938691,"title":"EF Code First MetadataException","body":"<p>I've installed EF v5 via NuGet into a VS 2010 project. Here's the code:</p>\n\n<pre><code>public class HeliosCpDataContext : DbContext\n{\n    public HeliosCpDataContext() : base(Properties.Settings.Default.cn_HeliosCpNtAuth) {}\n    public IEnumerable&lt;Test&gt; GetTests()\n    {\n            return this.Database.SqlQuery&lt;Test&gt;(\"EXEC App.Test\");\n    }\n}\n\n   public class Test\n    {\n       public string OrderNumber { get; set; }\n       public int OrderId {get;set;}\n    }\n\n   CREATE PROC [dbo].[Test]\n   AS \n    SET NOCOUNT ON\n\n\nSELECT TOP 10 OrderNumber, OrderId\nFROM dbo.Orders o\n</code></pre>\n\n<p>Field [OrderNumber] is Varchar(20), [OrderId] is INT</p>\n\n<p>Here's the app.config:</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n  &lt;/configSections&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"HeliosCp.Data.Properties.Settings.cn_HeliosCpNtAuth\"\n      connectionString=\"Data Source=DCXVRSQ471;Initial Catalog=SCPT_HeliosCp;Integrated Security=True;MultipleActiveResultSets=True\"\n      providerName=\"System.Data.SqlClient\" /&gt;\n  &lt;/connectionStrings&gt;\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework\"&gt;\n      &lt;parameters&gt;\n        &lt;parameter value=\"v11.0\" /&gt;\n      &lt;/parameters&gt;\n    &lt;/defaultConnectionFactory&gt;\n  &lt;/entityFramework&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>When I try to execute:</p>\n\n<pre><code>  var context = new HeliosCp.Data.HeliosCpDataContext();\n  var test = context.GetTests().FirstOrDefault();\n</code></pre>\n\n<p>I get a MetadataException \"Schema specified is not valid. Errors: \n(137,6) : error 0063: Precision facet isn't allowed for properties of type int.\n(137,6) : error 0063: Scale facet isn't allowed for properties of type int.\"</p>\n\n<p>I've tried explicitly casting each field in the sproc as Varchar &amp; int, explicitly executing the query (\"SELECT TOP 10 ...\") via the SqlQuery function instead of the sproc, <em>removing</em> the query entirely from the sproc (i.e., leaving nothing in the body of the sproc), and I get the exact same Exception, every time. Any help will be greatly appreciated, thanks.</p>\n"},{"tags":["entity-framework","foreign-keys","many-to-many","constraints","database-migration"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12919200,"title":"Entity Framework migration could not create foreign key constraint","body":"<p>I had 2 tables:</p>\n\n<pre><code>public class Work\n{\n    public int WorkId { get; set; }\n    (...)\n}\n\npublic class Check\n{\n    public int CheckId { get; set; }\n    (...)\n}\n</code></pre>\n\n<p>Then I wanted to add a many to many relationship with payload between them so:</p>\n\n<pre><code>public class WorkCheck\n{\n    [Key, Column(Order = 0)]\n    [ForeignKey(\"Work\")]\n    public int WorkId { get; set; }\n    public virtual Work Work { get; set; }\n\n    [Key, Column(Order = 1)]\n    [ForeignKey(\"Check\")]\n    public int CheckId { get; set; }\n    public virtual Check Check { get; set; }\n\n    (...)\n}\n\n   public class Work\n    {\n        public int WorkId { get; set; }\n        (...)\n        public virtual IList&lt;WorkCheck&gt; WorkChecks { get; set; }\n    }\n\n    public class Check\n    {\n        public int CheckId { get; set; }\n        (...)\n        public virtual IList&lt;WorkCheck&gt; WorkChecks { get; set; }\n    }\n</code></pre>\n\n<p>In the package manager console I ran the command \"Add-Migration WorkCheckTableAdded\" and no errors were shown.</p>\n\n<p>But right after, when I executed the \"Update-Database -verbose\" command, I got the exception:\n<strong>\"Foreign key 'FK_dbo.WorkCheck_dbo.Work_WorkId' references invalid column 'WorkId' in referenced table 'dbo.Work'.\nCould not create constraint. See previous errors.\"</strong></p>\n"},{"tags":["c#",".net","entity-framework","memory-leaks","parallel-processing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12937855,"title":"Using statements / calling Dispose inside static methods","body":"<p>I am developing a utility class that contains static methods that will be frequently called by multiple threads. I am noticing that memory use is growing over time, so it seems to me that I have some memory leaks.</p>\n\n<p>Here is a simple example of the pattern I am using for these static methods:</p>\n\n<pre><code>public static int CreateNewThing(int IDofSomeDBObjectHoldingInfoToCreateNewThing)\n{\n    using(SomeDBContext context = new SomeDBContext(connectionString))\n    {\n        SomeDBObjectHoldingInfoToCreateNewThing createNewThingyInfo = context.SomeDBObjectsHoldingInfoToCreateNewThing.First(obj =&gt; obj.ID == IDofSomeDBObjectHoldingInfoToCreateNewThing);\n        // Do some stuff to create the new object\n        // Return the ID of the newly created thingy...\n        return theNewThingThatWasCreated.ID;\n     }\n}\n</code></pre>\n\n<p>My question is whether using 'using' statements or directly calling Dispose inside static methods actually clears up any memory. Granted, I haven't stated the overall architecture or purpose of this application, but I am also wondering if I'm using the best pattern here. What are the best practices for creating thread-safe utility classes in .NET?</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12934290,"title":"entity framework linq include and grouping","body":"<p>I'm trying  to  to do include and group in in one sentence </p>\n\n<pre><code>var instanceIdList = context.\n    Tracks.\n    Include(\"Services\").\n    GroupBy(x =&gt; x.ServiceId).\n    Take(top);\n</code></pre>\n\n<p>but when I check the result at debug I cant see any of the include values </p>\n\n<p>I tried to do in another way </p>\n\n<pre><code>var objectContext = ((IObjectContextAdapter)context).ObjectContext;\nvar set = objectContext.CreateObjectSet&lt;Track&gt;();\nvar instanceIdList = set.Include(\"Services\").GroupBy(x =&gt; x.ServiceId);\n</code></pre>\n\n<p>this is the classes :\n <em>Track</em></p>\n\n<pre><code>  public partial class Track\n{\n    public long Id { get; set; }\n    public System.Guid ServiceId { get; set; }\n    public Nullable&lt;System.Guid&gt; ServiceInterfaceId { get; set; }\n    public Nullable&lt;System.Guid&gt; ProviderId { get; set; }\n    public System.Guid ServiceInstanceId { get; set; }\n    public System.Guid ActivityParentId { get; set; }\n    public System.Guid ActivityInstanceId { get; set; }\n    public int ActivityType { get; set; }\n    public int ServiceRole { get; set; }\n    public int TrackOrder { get; set; }\n    public System.DateTime Datetime { get; set; }\n    public Nullable&lt;System.Guid&gt; MessageId { get; set; }\n    public int Status { get; set; }\n    public Nullable&lt;int&gt; ESBErrorCode { get; set; }\n    public Nullable&lt;int&gt; ESBTecnicalErrorCode { get; set; }\n    public string ErrorDescription { get; set; }\n    public string PortName { get; set; }\n    public string MachineName { get; set; }\n    public string ConsumerId { get; set; }\n    public string ExternalId { get; set; }\n    public string ConsumerMachineName { get; set; }\n    public int ServiceBehavior { get; set; }\n\n    public virtual Message Message { get; set; }\n}\n</code></pre>\n\n<p><em>Service</em></p>\n\n<pre><code>      public partial class Service\n      {\n        public Service()\n        {\n        this.Providers = new HashSet&lt;Provider&gt;();\n        this.ServiceInterfaces = new HashSet&lt;ServiceInterface&gt;();\n            }\n\n    public System.Guid ServiceId { get; set; }\n    public string ServiceName { get; set; }\n    public string ServiceNumber { get; set; }\n    public Nullable&lt;System.Guid&gt; ModelSchemaId { get; set; }\n\n    public virtual ICollection&lt;Provider&gt; Providers { get; set; }\n    public virtual ICollection&lt;ServiceInterface&gt; ServiceInterfaces { get; set; }\n}\n</code></pre>\n\n<p>but the result is the same</p>\n\n<p>thanks </p>\n\n<p>miki</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12937816,"title":"Unable to initialize the dbcontext with initial data in code first entity model","body":"<p>I am working on asp.net mvc. I am trying to implement Code-First Entity Model. I have follwed the following steps,</p>\n\n<p>1, I have created a class student.cs</p>\n\n<pre><code>public class Student\n{\n    public int StudentID { get; set; }\n    public string StudentName { get; set; }\n    public string Branch { get; set; }\n    public decimal Marks { get; set; }\n    public string Address { get; set; }\n}\n</code></pre>\n\n<p>2, I have craeted context class like,</p>\n\n<pre><code> public class StudentContext:DbContext\n    {\n        public StudentContext()\n        {\n            Database.SetInitializer(new StudentContextInitializer());\n        }\n\n        public DbSet&lt;Student&gt; Student { get; set; }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n        }\n    }\n</code></pre>\n\n<p>3, I have created studentcontextinitializer class like,</p>\n\n<pre><code>public class StudentContextInitializer : DropCreateDatabaseIfModelChanges&lt;StudentContext&gt;\n    {\n        protected override void Seed(StudentContext context)\n        {\n            context.Student.Add(new Student { StudentName=\"madhav\",Branch=\"CSE\",Marks=888,Address=\"AKP\" });\n            context.Student.Add(new Student { StudentName = \"Tirumalesh\", Branch = \"IT\", Marks = 988, Address = \"MDP\" });\n            context.Student.Add(new Student { StudentName = \"Venkat\", Branch = \"ECE\", Marks = 1000, Address = \"BZA\" });\n            context.SaveChanges();\n        }\n    }\n</code></pre>\n\n<p>I am successfully connected to database but i am unable to initialize the dbcontext with some data that means I have hard coded some records in studentcontextinitializer class but i am unable to bind that records into database table. so please guide me.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":12937165,"title":"EF with only a subset of existing tables","body":"<p>I got an existing database with many tables which are accessed using stored procedures only (no O/RM). I'd like to create new tables in this database using Entity Framework and the Code First approach. </p>\n\n<p>Do all the tables in my existing database need to be modelized in my Entity Framework classes? Will I be able to hand-code only the new classes I need in my <code>DbContext</code>? Other tables really need to stay untouched and away from O/RM for the moment.</p>\n\n<p><em><strong>Note:</strong> I'm going to be using the latest EF5.</em></p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12937132,"title":"EF - access saved objects once savechanges is called","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12933960/access-id-of-added-entity-before-savechanges-is-called\">access id of added entity before SaveChanges() is called</a>  </p>\n</blockquote>\n\n\n\n<p>Using EF 4.3.1, how do I get the list of saved objects once savechanges() has been called? I want to get a list of entities that have been added (EntityState = Added), lets call it A. Then I want to create a new list of entities with some of the properties of these entities in A, lets call it B. Then I want to call SaveChanges() i.e. push A and B to the db. Then I want to update each entity in list B with the id of the corresponding item in A.</p>\n\n<p>I'm having an issue getting the id once SaveChanges is called. How can I do this? All of this is occurring in the SaveChanges() which I've overridden.</p>\n"},{"tags":["c#",".net","oracle","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":358,"score":1,"question_id":7512562,"title":"Return entity key after savechanges doesn't work","body":"<p>I have this piece of code</p>\n\n<pre><code>            IMG_UPLOAD_FILES tObjUploadedFile = new IMG_UPLOAD_FILES();\n\n            tObjUploadedFile.UPLOAD_FILE_NAME = \"testname.png\";\n            tObjUploadedFile.SETTINGS_FOLDER_ID = 2;\n\n            dbHandler.IMG_UPLOAD_FILES.AddObject(tObjUploadedFile);\n            dbHandler.SaveChanges(SaveOptions.AcceptAllChangesAfterSave);\n\n            decimal tmpID= tObjUploadedFile.UPLOAD_FILE_ID;\n</code></pre>\n\n<p>the tmpID is still 0 and never return a key.</p>\n\n<p>I have set StoreGeneratedPattern to Identity on the required field.</p>\n\n<p>I'm using the latest ODB.NET from against the ORACLE database.</p>\n\n<p>\\T</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-3","code-first","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":5406,"score":1,"question_id":5465686,"title":"EF 4.1 Code First: \"non-null value of type 'DateTime'\" Issue","body":"<p>After initial dev and testing I have now pointed my MVC3 application at an existing database which contains live data.</p>\n\n<p>However I am getting this error related to the field called Date1 of type \"datetime\".</p>\n\n<pre><code>The 'Date1' property on 'StaffAttachment' could not be set to a 'null' value. You must set this property to a non-null value of type 'DateTime'. \n</code></pre>\n\n<p>Is this telling me that all rows in the date must have a date and not be null? What do I do if I dont want to set a date on specific row?</p>\n\n<p>Can anyone offer advice on resolving this issue?</p>\n\n<p>Thanks Paul</p>\n\n<p>EDIT 1 (Posting Model)</p>\n\n<pre><code>public class StaffAttachment\n{\n    [Key]\n    public int AttachmentID { get; set; }\n\n    public int? StaffID { get; set; }\n\n    public int? TypeID { get; set; }\n\n    [Required]\n    [DisplayName(\"Proof of ID\")]\n    public int? AttachmentTypeID { get; set; }\n\n    [Required]\n    [DisplayName(\"ID Reference\")]\n    public string Reference1 { get; set; }\n\n    public string Reference2 { get; set; }\n\n    public string DateType { get; set; }\n\n    [DisplayName(\"Expiry Date\")]\n    public DateTime Date1 { get; set; }\n\n    [Required]\n    public DateTime Date2 { get; set; }\n\n    public DateTime Date3 { get; set; }\n\n    public DateTime Date4 { get; set; }\n\n    public string AttachmentPath { get; set; }\n\n    public int? ValidatedUserID { get; set; }\n\n    public DateTime ValidatedDate { get; set; }\n\n    public int? CreatedUserID { get; set; }\n\n    public DateTime CreatedDate { get; set; }\n\n    public int? EditedUserID { get; set; }\n\n    public DateTime EditedDate { get; set; }\n\n    public TimeSpan TimeStamp { get; set; }\n\n    public string FileName { get; set; }\n\n    public byte[] FileImage { get; set; }\n\n    public int AttachmentSection { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework","savechanges","audit-logging"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12933960,"title":"access id of added entity before SaveChanges() is called","body":"<p>i'm using EF 4.3.1, I've overridden the SaveChanges() on the context so that I can get a list of the objects and their states and create entries in my audit log table. I need to store the id of the record in the audit log table so i have a reference to it. This is a problem when records are inserted, as I don't have access to the id before it's saved. Is there any way of getting the id at that point?</p>\n\n<pre><code>public override int SaveChanges()\n{\n        ChangeTracker.DetectChanges();\n\n        var objectStateManager = ((IObjectContextAdapter)this).ObjectContext.ObjectStateManager;\n        var modifiedAuditableEntities = objectStateManager.GetObjectStateEntries(EntityState.Modified | EntityState.Added).Where(e =&gt; (IAuditable)e.Entity != null);\n\n        foreach (var entry in modifiedAuditableEntities)\n        {\n            var entity = (IAuditable)entry.Entity;\n\n            if (entity != null)\n            {\n                switch (entry.State)\n                {\n                    case EntityState.Added:\n                        entity.IsAdded = true;\n                        break;\n                    case EntityState.Deleted:\n                        entity.IsDeleted = true;\n                        break;\n                    case EntityState.Modified:\n                        entity.IsModified = true;\n                        break;\n                }\n\n                this.EntitySet&lt;AuditLogEntry&gt;().Add(this.auditLogService.CreateAuditLogEntryForEntity((IAuditable)entry.Entity));\n            }\n        return base.SaveChanges();\n}\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-4","asp.net-web-api"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12844064,"title":"Easier way of avoiding duplicates in entity framework","body":"<p>Can anyone provide an easier more automatic way of doing this?  </p>\n\n<p>I have the following save method for a FilterComboTemplate model.  The data has been converted from json to a c# model entity by the webapi.</p>\n\n<p>So I don't create duplicate entries in the DeviceProperty table I have to go through each filter in turn and retrieve the assigned DeviceFilterProperty from the context and override the object in the filter.  See the code below.</p>\n\n<p>I have all the object Id's if they already exist so it seems like this should be handled automatically but perhaps that's just wishful thinking.</p>\n\n<pre><code>public void Save(FilterComboTemplate comboTemplate)\n{\n    // Set the Device Properties so we don't create dupes\n    foreach (var filter in comboTemplate.Filters)\n    {\n        filter.DeviceProperty = context.DeviceFilterProperties.Find(filter.DeviceFilterProperty.DeviceFilterPropertyId); \n    }\n\n    context.FilterComboTemplates.Add(comboTemplate);\n    context.SaveChanges();\n}\n</code></pre>\n\n<p>From here I'm going to have to check whether any of the filters exist too and then manually update them if they are different to what's in the database so as not to keep creating a whole new set after an edit of a FilterComboTemplate.</p>\n\n<p>I'm finding myself writing a lot of this type of code.  I've included the other model classes below for a bit of context.</p>\n\n<pre><code>public class FilterComboTemplate\n{\n    public FilterComboTemplate()\n    {\n        Filters = new Collection&lt;Filter&gt;();\n    }\n\n    [Key]\n    public int FilterComboTemplateId { get; set; }\n\n    [Required]\n    public string Name { get; set; }\n\n    [Required]\n    public ICollection&lt;Filter&gt; Filters { get; set; }\n}\n\npublic class Filter\n{\n    [Key]\n    public int FilterId { get; set; }\n\n    [Required]\n    public DeviceFilterProperty DeviceFilterProperty { get; set; }\n\n    [Required]\n    public bool Exclude { get; set; }\n\n    [Required]\n    public string Data1 { get; set; }\n}\n\npublic class DeviceFilterProperty\n{\n    [Key]\n    public int DeviceFilterPropertyId { get; set; }\n\n    [Required]\n    public string Name { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework","code-generation","t4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12934693,"title":"T4 template and EF with Code Generator from database schema Application","body":"<p>I am currently in process of putting a process (using a windows application) in place where EF's POCO objects classes can be generated by pointing this app to the database table(s).</p>\n\n<p>I have seen T4 templates and the VS Addin which helps to achieve this in VS. However it requires T4 template file on the VS solution. We do not want to go through this route. What we want is to just copy the classes generated by this app to the solution so it can be used.</p>\n\n<p>The way T4 template works is that as soon as you make a change in the template it applies to the Class file. What I would like to do is to point the new App to the database and say tables A,B,C. The app will read the columns,types,relationships and create corresponding classes to a folder. Developer then Copy these classes and paste into VS solution. Longer terms plan then to extend this app to write repository classes.</p>\n\n<p>I have rough idea but not a clear picture. Does anyone has any pointers about how about can I go to achieve this? </p>\n\n<p>Thanks</p>\n\n<p>Edit: This is purely in mind using EF Code first.</p>\n"},{"tags":["vb.net","entity-framework","dependency-injection","entity-framework-5","ef-database-first"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":256,"score":1,"question_id":12850340,"title":"Dependency Injection with Entity Framework 5 Database First. Getting Started?","body":"<p>I am looking at creating a VB.NET 11 WPF MVVM application using Entity Framework 5 and Database First (Connecting to SQL Server 2008 R2). </p>\n\n<p>I have chosen Database First, as I am migrating an existing solution to WPF MVVM, where the database already exists of course.</p>\n\n<p>I'd like to begin using Dependency Injection so I can Unit Test as much of my code as possible.</p>\n\n<p>I don't seem to be able to find a clear and concise walk-through of how to go about using Dependency Injection with EF DB-First, and in particular with vb.net. Although even a C# example would be fine I'm sure.</p>\n\n<p>What I'd really like is a simple step by step guide explaining how to setup the solution, how to setup each part ready for Dependency Injection etc, but these seem hard to come by.</p>\n\n<p>So far, I've created the Solution and it's Projects, as follows;</p>\n\n<ul>\n<li><strong>DBAccess</strong> - This houses nothing but my .edmx file, and a small mod to be able to supply the ConnectionString to the constructor.</li>\n<li><strong>DBControl</strong> - This houses the various classes which I use to provide a layer between my EDMX and my ViewModels. Specifically, I'm filling Complex Types (Which I have created using the designer) here for displaying \"Friendlier\" data via the UI, as well as converting these \"Friendly\" Complex Types to the mapped entities for saving / Updating. I have one class per table in my database. Each with two <em>\"FetchFriendlyRecords\"</em> methods (One accepts Filters) and an \"<em>AddUpdateFriendlyRecord</em>\" method. I have created an Interface for each class. Each class accepts a DbContext in it's constructor, and I'm simply passing my DBContext from the DBAccess Project.</li>\n<li><strong>MainUI</strong> - This houses my MVVM layers, and references each class in the DBControl Project in order to provide DataBinding etc.</li>\n</ul>\n\n<p>I've seen suggested that, instead of spending time writing a complex solution to be able to unit test with EF, it's simpler to create a firm mock database with test data populated, and simply point the code at the mock database, rather than the live one. However, I'd prefer to be able to create an in memory solution that would run without any need to hit SQL Server at all.</p>\n\n<p>Any help would be great, including telling me if I'm going about this all wrong!! </p>\n\n<p><strong>Update:</strong></p>\n\n<p>I have taken the solution provided by Paul Kirby below, and created a \"Sort of\" Repository Pattern I believe.</p>\n\n<p>I created an interface;</p>\n\n<pre><code>Public Interface IFriendlyRepository(Of T)\n        ReadOnly Property FriendlyRecords As ObservableCollection(Of T)\n        Function GetFilteredFriendlyRecords(predicates As List(of Func(Of T, Boolean))) As ObservableCollection(Of T)\n        Function AddEditFriendlyRecord(ByVal RecordToSave As T) As EntityException\n        Sub SaveData()\nEnd Interface\n</code></pre>\n\n<p>I then implemented this interface on a class by class basis;</p>\n\n<pre><code>Namespace Repositories\n    Public Class clsCurrenciesRepository\n        Implements Interfaces.IFriendlyRepository(Of CriticalPathDB.FriendlyCurrencies)\n\n        Private _DBContext As CriticalPathEntities                          'The Data Context\n\n        Public Sub New(ByVal Context As DbContext)   \n            _DBContext = Context\n        End Sub\n\n        Public ReadOnly Property FriendlyRecords As ObservableCollection(Of FriendlyCurrencies) Implements Interfaces.IFriendlyRepository(Of CriticalPathDB.FriendlyCurrencies).FriendlyRecords\n            Get\n                ' We need to convert the results of a Linq to SQL stored procedure to a list,\n                ' otherwise we get an error stating that the query cannot be enumerated twice!\n                Dim Query = (From Currencies In _DBContext.Currencies.ToList\n                             Group Join CreationUsers In _DBContext.Users.ToList\n                             On Currencies.CreationUserCode Equals CreationUsers.User_Code Into JoinedCreationUsers = Group\n                             From CreationUsers In JoinedCreationUsers.DefaultIfEmpty\n                             Group Join UpdateUsers In _DBContext.Users.ToList\n                             On Currencies.LastUpdateUserCode Equals UpdateUsers.User_Code Into JoinedUpdateUsers = Group\n                             From UpdateUsers In JoinedUpdateUsers.DefaultIfEmpty\n                             Where (Currencies.Deleted = False Or Currencies.Deleted Is Nothing)\n                             Order By Currencies.NAME\n                             Select New FriendlyCurrencies With {.Currency_Code = Currencies.Currency_Code,\n                                                                .NAME = Currencies.NAME,\n                                                                .Rate = Currencies.Rate,\n                                                                .CreatedBy = If(Currencies.CreationUserCode Is Nothing, \"\", CreationUsers.First_Name &amp; \" \" &amp; CreationUsers.Last_Name),\n                                                                .CreationDate = Currencies.CreationDate,\n                                                                .CreationUserCode = Currencies.CreationUserCode,\n                                                                .Deleted = Currencies.Deleted,\n                                                                .LastUpdateDate = Currencies.LastUpdateDate,\n                                                                .LastUpdatedBy = If(Currencies.LastUpdateUserCode Is Nothing, \"\", UpdateUsers.First_Name &amp; \" \" &amp; UpdateUsers.Last_Name),\n                                                                .LastUpdateUserCode = Currencies.LastUpdateUserCode}).ToList\n\n                Return New ObservableCollection(Of FriendlyCurrencies)(Query)\n            End Get\n        End Property\n\n        Public Function GetFilteredFriendlyRecords(predicates As List(of Func(Of FriendlyCurrencies, Boolean))) As ObservableCollection(Of FriendlyCurrencies) Implements Interfaces.IFriendlyRepository(Of CriticalPathDB.FriendlyCurrencies).GetFilteredFriendlyRecords\n            Dim ReturnQuery = FriendlyRecords.ToList\n\n            For Each Predicate As Func(Of FriendlyCurrencies, Boolean) In predicates\n                If Predicate IsNot Nothing Then\n                    ReturnQuery = ReturnQuery.Where(Predicate).ToList\n                End If\n            Next\n            Return New ObservableCollection(Of FriendlyCurrencies)(ReturnQuery)\n        End Function\n\n        Public Function AddEditFriendlyRecord(ByVal RecordToSave As FriendlyCurrencies) As EntityException Implements Interfaces.IFriendlyRepository(Of CriticalPathDB.FriendlyCurrencies).AddEditFriendlyRecord\n\n            Dim dbCurrency As New Currency\n            ' Check if this Staff Member Exists\n            Dim query = From c In _DBContext.Currencies\n                        Where c.Currency_Code = RecordToSave.Currency_Code\n                        Select c\n\n            ' If Asset exists, then edit.\n            If query.Count &gt; 0 Then\n                dbCurrency = query.FirstOrDefault\n            Else\n                'Do Nothing\n            End If\n\n            dbCurrency.Currency_Code = RecordToSave.Currency_Code\n            dbCurrency.NAME = RecordToSave.NAME\n            dbCurrency.CreationDate = RecordToSave.CreationDate\n            dbCurrency.CreationUserCode = RecordToSave.CreationUserCode\n            dbCurrency.LastUpdateDate = RecordToSave.LastUpdateDate\n            dbCurrency.LastUpdateUserCode = RecordToSave.LastUpdateUserCode\n            dbCurrency.Deleted = RecordToSave.Deleted\n\n            ' Save Asset Object to Database\n            If query.Count &gt; 0 Then\n                ' If Asset exists, then edit.\n                Try\n                    '_dbContext.SaveChanges           'We could save here but it's generally bad practice\n                Catch ex As EntityException\n                    Return ex\n                End Try\n            Else\n                Try\n                    _DBContext.Currencies.Add(dbCurrency)\n                    '_dbContext.SaveChanges           'We could save here but it's generally bad practice\n                Catch ex As EntityException\n                    Return ex\n                End Try\n            End If\n            Return Nothing\n        End Function\n\n        Public Sub SaveData() Implements Interfaces.IFriendlyRepository(Of CriticalPathDB.FriendlyCurrencies).SaveData\n            _DBContext.SaveChanges()\n        End Sub\n    End Class\nEnd Namespace\n</code></pre>\n\n<p>I used constructor injection to insert the dbContext into the class. </p>\n\n<p>I had hoped to be able to mock up a fake dbContext using my existing context and the <a href=\"http://effort.codeplex.com/\" rel=\"nofollow\">\"Effort\" Unit Testing Tool</a>.</p>\n\n<p>However, I don't seem to be able to get this to work.</p>\n\n<p>In the interim, in my Unit Test Project, I am dropping (If it already exists) and creating an empty test database, with the SQLCMD command, using the same schema as my live database.</p>\n\n<p>I then create a dbContext referencing the Test Database, populate it with test data, and test against this.</p>\n\n<p>As a note, I will be refactoring my \"Add/Edit\" method to work with an actual base Entity, rather than my \"Friendly\" complex version, this was the simplest method at the time.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","razor","content-management-system","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12915235,"title":"What content management systems are available for MVC3 or MVC4 with the Razor Syntax?","body":"<p>When mvc3 with razor first came out I was drawn to it and one of the first sites I created was a content management systems (CMS). I did this mostly because it was a simple way to learn mvc3, and because there were no other CMS's available to use.</p>\n\n<p>Lately I have come back to my old application, to make it more efficient and complete. I assume that by now there are a good amount of CMS's (free, open source and purchasable,) that are built with MVC3/MVC4. However, I've only found a couple that are MVC3/MVC4 and use the Razor Syntax. Since mvc3 and razor have been around for a while (not to exclude mvc4,) I want to know what CMS's are available for these frameworks? Especially if they use entity-framework?</p>\n\n<p>Also, which of these do you think is best, and why?</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework",".net-4.0","lazy-loading","eager-loading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12933340,"title":"Lazy Load Fail on Property using expression in relational tree","body":"<p>I have a function which returns a list via an expression.</p>\n\n<pre><code>  Public Function Debits() As List(Of GLCode)\n    Return GeneralLedgers.Select(Function(x) x.DebitCode).Distinct().ToList()\n  End Function\n</code></pre>\n\n<p>When trying to call this function from another expression I get the error \"The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.\" on DebitCode</p>\n\n<p>However I know the context is not being disposed as I can load the property from the Quickwatch window. Lazy loading is not loading the Debitcodes which are obviously needed.</p>\n\n<p>I can't use the context as Im inside an expression and so can't use Include either\nI have tried turning eagar loading on with on at the top level with no effect</p>\n\n<p>Any ideas :)</p>\n"},{"tags":["c#","entity-framework","orm"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12928803,"title":"How to specify left join in EF?","body":"<p>My model:</p>\n\n<pre><code>public partial class history_builds\n{\n    public int ID { get; set; }\n    public int build { get; set; }\n    public int br { get; set; }\n    public int tag { get; set; }\n    public string line { get; set; }\n    public int rev { get; set; }\n    public int user_ID { get; set; }\n    public string distrib_path { get; set; }\n    public string setup_path { get; set; }\n    public System.DateTime build_date { get; set; }\n    public string product { get; set; }\n}\n\npublic partial class history_uploads\n{\n    public int ID { get; set; }\n    public int ID_user { get; set; }\n    public string Line { get; set; }\n    public int Build { get; set; }\n    public string Distrib { get; set; }\n    public System.DateTime Time_upload { get; set; }\n    public int Status { get; set; }\n}\n\npublic partial class user\n{\n    public int ID { get; set; }\n    public string Name { get; set; }\n    public int ID_group { get; set; }\n}\n</code></pre>\n\n<p>Context:</p>\n\n<pre><code>public DbSet&lt;history_builds&gt; history_builds { get; set; }\npublic DbSet&lt;history_uploads&gt; history_uploads { get; set; }\npublic DbSet&lt;user&gt; users { get; set; }\n</code></pre>\n\n<p>I try to do left join like this <a href=\"http://stackoverflow.com/questions/5537995/entity-framework-left-join\">Entity framework left join</a>  </p>\n\n<pre><code>var items = entities.history_builds\n    .Join(\n        entities.users.DefaultIfEmpty(),\n        hb =&gt; hb.user_ID,\n        u =&gt; u.ID,\n        (hb, u) =&gt;\n            new {\n                hb.distrib_path,\n                hb.setup_path,\n                hb.build_date,\n                hb.build,\n                User = (u == null ? String.Empty : u.Name),\n                hb.rev\n            }\n    )\n    .Join(entities.history_uploads.DefaultIfEmpty(),\n        hb =&gt; hb.build,\n        hu =&gt; hu.Build,\n        (hb, hu) =&gt;\n            new HistoryBuidItem {\n                Revision = hb.rev,\n                Build = hb.build,\n                DistribPath = hb.distrib_path,\n                SetupPath = hb.setup_path,\n                BuildDate = hb.build_date,\n                User = hb.User,\n                IsUpload = (hu == null ? true : false)\n            }\n    )\n    .Where(x =&gt; ids.Contains(x.Revision))\n    .ToList();\n</code></pre>\n\n<p><strong>But it doesn't work, EF still emit inner join sql code, what is wrong?</strong></p>\n"},{"tags":["entity-framework","key"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12930785,"title":"key non identity on model creating","body":"<p>I do project in entity framework and i want my key to be <strong>non</strong> identity , i define it in the model building:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n  modelBuilder.Entity&lt;trip&gt;().HasKey(p =&gt;  p.trip_id );\n}\n</code></pre>\n"},{"tags":["entity-framework","many-to-many","fluent"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12918535,"title":"many to many 2 way relationship with EF5","body":"<p>I have the following fluent configuration for a simple many to many relationship between user and roles. I need navigation properties both ways, and therefore have a collection of Users in Role, and vice versa. </p>\n\n<p>When I insert a new entity into User, EF attempts to insert a Role_Id column, when I have mapped it using the following. The column is clearly RoleId, not Role_Id, moreover it's in a many to many table. There cannot be a Role_Id on the User.</p>\n\n<p>I imagine by having a collection on both sides EF is getting confused somehow.</p>\n\n<pre><code>modelBuilder.Entity&lt;User&gt;().HasMany(_ =&gt; _.Roles).WithMany()\n                        .Map(_ =&gt; \n                        {\n                            _.MapLeftKey(\"UserId\");\n                            _.MapRightKey(\"RoleId\");\n                            _.ToTable(\"UserRole\", \"dbo\");\n                        });         \n</code></pre>\n\n<p>When I attempt to create the relationship the other way, by putting the following configuration after the above one, I get an exception stating that the relationship is already defined.</p>\n\n<pre><code>modelBuilder.Entity&lt;Role&gt;().HasMany(_ =&gt; _.Users).WithMany()\n                    .Map(_ =&gt;\n                    {\n                        _.MapLeftKey(\"RoleId\");\n                        _.MapRightKey(\"UserId\");\n                        _.ToTable(\"UserRole\", \"dbo\");\n                    });         \n</code></pre>\n"},{"tags":["c#","entity-framework","linq-to-entities","poco"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":67,"score":2,"question_id":12921559,"title":"Update related property (like a trigger) in a POCO entity, is it possible?","body":"<p>I have the following POCO entity:</p>\n\n<pre><code>public class User \n{\n    [...other properties...]\n\n    public byte Status { get; set; }\n    public DateTime? DataStatus { get; set; }  \n}\n</code></pre>\n\n<p>What I want: inside the <code>set</code> method of the property <code>Status</code>, update <code>DataStatus</code> with the current date when <code>Status</code> is changed, is it possible? </p>\n"},{"tags":["entity-framework","web-config"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":12929598,"title":"Entity Framework 5 built in Database Initializers and Seed method in Code First","body":"<p>I'm using EF 5 and trying to figure out how different built in database initializers are calling the Seed() method. \nThese are my questions:</p>\n\n<p><strong>1. What is a good initializer for seeding the database only when the model changes?<br />\n 2. How to configure each db initializer in web.config?</strong> </p>\n\n<p>Clarifications for my first question:<br />\nSo far I know that these are the built in database initializers of EF 5:</p>\n\n<ul>\n<li>MigrateDatabaseToLatestVersion</li>\n<li>CreateDatabaseIfNotExists</li>\n<li>DropCreateDatabaseIfModelChanges</li>\n<li>DropCreateDatabaseAlways</li>\n</ul>\n\n<p>My problem is in understanding when the Seed method of each of these initializers is called. I've looked inside the EntityFramework dll and checked the code of each of these initializer's InitializeDatabase() method to check when each is called. This is what I found:</p>\n\n<p><strong>MigrateDatabaseToLatestVersion</strong>: I couldn't find out when the seed method is called but from my tests it is called every time the app runs, no matter if there are changes in the model.<br />\n<strong>CreateDatabaseIfNotExists</strong>: I could find that the Seed method is called only when creating the database. If it exists, no seed should be done.<br />\n<strong>DropCreateDatabaseIfModelChanges</strong>: It seems that InitializeDatabase method calls Seed() every time, no matter if the model changed or not. The call is outside the if(context.Dabase.Exists()) check. <br />\n<strong>DropCreateDatabaseAlways</strong>: It is obvious that this will always call Seed method.<br /></p>\n\n<p>Is this correct? If so, it doesn't seem like I could restrict seeding to the case in which the model changes and I should probably write a custom initializer.</p>\n\n<p>Regarding my 2nd question, I know how to configure the MigrateDatabaseToLatestVersion but i find it difficult to write as I don't know the meaning of this declaration (especially the '2 part - is it the value of an enum, in which case how should I figure what is the corresponding number of other initializers?):<br /></p>\n\n<pre><code>&lt;entityFramework&gt;\n&lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\"/&gt;\n&lt;contexts&gt;\n  &lt;context type=\"Digidata.MP.Data.ObjectContext, Digidata.MP.Data\"&gt;\n    &lt;databaseInitializer type=\"System.Data.Entity.MigrateDatabaseToLatestVersion`2[[Digidata.MP.Data.ObjectContext,  Digidata.MP.Data], [Digidata.MP.Data.Migrations.Configuration, Digidata.MP.Data]], EntityFramework\"/&gt;\n  &lt;/context&gt;\n&lt;/contexts&gt;\n</code></pre>\n\n<p></p>\n\n<p>Where can I find an explanation of how to declare the built in initializers in a config file?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12928296,"title":"Entity framework Data sorting","body":"<p>I am working on a project for UserStream(like fb) using entity framework, i have implemented it successfully, I want the functionality that if someone comment on a status/post that status/post should be shown on top,(like in FB)\nFor now the latest post is showing on top but i am unable to sort on the base of comments,below is my DB tables structure</p>\n\n<pre><code>tblPosts:                 tblUsers                     tblUserPosts:          tblPostComments\nPostId bigint PK          UserId bigint PK             UserPostID bigint PK   CommentID bigint PK\nDesc  text                Username  varchar(200)       UserID   bigint FK     PostId bigint FK\nType bingint              Password varchar(100)        PostId   bigint FK     Comment varchar(200)\nURL  varchar(200)                                                             Commentedby bigint FK\nPrivacy varchar(50)                                                           Postedon datetime\nPostedon datetime\n</code></pre>\n\n<p>On my cs code i am retrieving List of tblUserPosts then sorting it on the base of tblPosts Posteddate,but i am not having any information regarding tblPostComments, how can i sort records on the base of Comments as well</p>\n\n<p>This is how i am sorting records</p>\n\n<pre><code>List&lt;tblUserPosts&gt; objlst = new List&lt;tblUserPosts&gt;();\n//Adding items to objlst\n      UserStreamViewModel model = new UserStreamViewModel\n                {\n//I am not having d.tblPostComments or d.tblPosts.tblComments.PostedOn\n                    propResourcesList = objlst.OrderBy(d=&gt;d.tblPosts.PostedOn);\n\n                };\n</code></pre>\n"},{"tags":["linq","entity-framework","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":35,"score":-2,"question_id":12927915,"title":"Using Linq Retrieveing the data to SelectListItem","body":"<p>I have class studentList</p>\n\n<pre><code> public class studentList\n    {\n    public static IEnumerable&lt;SelectListItem&gt; GetStudents(int? ID)\n            {\n//code is required here\n    return ;\n            }\n        }\n</code></pre>\n\n<p>Iam getting ID into this method and now, I require all other IDs from the table, excluding the passed parameter ID using linq.</p>\n\n<p>I have Student table which contains Two fieds StudentID and StudentName,\nNow I require IDs and Names of the students in the above pattern..\nCould any one help me... </p>\n"},{"tags":["entity-framework","entity"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12927615,"title":"Entity Framework 5 Mapping error","body":"<p>I am using EF5. The problem is, if i did any changes ( eg : column name changed) in the Database (SQL) and then \"Update Model from Database...\", then each time i am getting the mapping error. </p>\n\n<p>It was this one before updating the entity\n-Property Type=\"String\" Name=\"Name\" MaxLength=\"50\" FixedLength=\"false\" Unicode=\"true\" />\n.\n.\n.</p>\n\n<p>and after update\n Property Type=\"String\" Name=\"Name\" MaxLength=\"50\" FixedLength=\"false\" Unicode=\"true\" />\n.\n.\n.\n. \nProperty Type=\"String\" Name=\"FullName\" MaxLength=\"50\" FixedLength=\"false\" Unicode=\"true\" /></p>\n\n<p><strong>But in XML view the two property type is existing.</strong>\nI have already updated the Model from database, but it <strong>is not reflected</strong> in the entity. Each time I have to delete the error occurred entity and re-add it again or otherwise i have to delete the property. </p>\n\n<p>How can i solve this problem ...?\nPlease help me...!!</p>\n\n<p>Thanks. :)</p>\n"},{"tags":["entity-framework","domain-driven-design","repository-pattern","aggregate","dbcontext"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":106,"score":2,"question_id":12917484,"title":"How to aggregate repositories?","body":"<p>I am working on a large-scale system for a telecom company. I am new to DDD and having hard time linking different pieces together. Our current system is build using NHibernate. It currently has well over 600 tables and all data access is done using NHibernate but for the new system we will be using EF. Below are few functional areas and examples of database tables in each functional area.</p>\n\n<p>Customers<br>\n    -----> CustomerDemographics<br>\n    -----> CustomerPayments<br>\n    -----> CustomerTransactions  </p>\n\n<p>RoutingEngine<br>\n    -----> InboundRoutes<br>\n    -----> OutboundRoutes  </p>\n\n<p>ProvisioningEngine<br>\n    -----> InboundSwithces<br>\n    -----> OutboundSwitches<br>\n    -----> RouterConfigs<br>\n    -----> GatewayConfigs  </p>\n\n<p>BillingEngine<br>\n    -----> InboundTraffic<br>\n    -----> OutboundTraffic  </p>\n\n<p>Since the system has to be unit-testable, I started abstracting actual entities with a repository pattern. One approach is to create one repository object for each  each database table. Of course all these repository classes could be  derived from a generic repository interface. However this will be adding quite a bit of overhead in terms of code base maintenance. In DDD, I read about this concept of Aggregates but I am not sure how it should be applied specially in context of EF. Should the Aggregate objects are container of these repositories or are these more of a container of related contexts (meaning something along the lines of Bounded DbContexts)?</p>\n"},{"tags":["entity-framework","mapping","entity","code-first","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12924362,"title":"Why is EF code first throwing model backing context exception? Using 4.0.3","body":"<p>Heres the exception:</p>\n\n<pre><code>&gt; The model backing the 'ScannerContext' context has changed since the\n&gt; database was created. Consider using Code First Migrations to update\n&gt; the database (http://go.microsoft.com/fwlink/?LinkId=238269).\n</code></pre>\n\n<p>I get this everytime i run my application. I cant figure out what it means. I think it means something isnt mapped correctly, but i cant figure out what. I am using the code first model, and i have an existing database that I want totally custom mappings for. Right now, I have everything in my classes named the same as my database to eliminate possible cuases.</p>\n\n<p>The Exception is thrown when i try to .Add() the entity to the context.</p>\n\n<p><strong>The Entity as it is in the Database</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/b5dyi.png\" alt=\"DBimage\"></p>\n\n<p><strong>The Entity in my DataLayer</strong></p>\n\n<pre><code>public class EAsset\n{\n    public int i_GID { get; set; }\n    public EAssetType Type { get; set; }\n    public EOrgEnvironment Environment { get; set; }\n    public EUser Contact { get; set; }\n    public string s_Name { get; set; }\n    public string s_Role { get; set; }\n    public DateTime d_Added { get; set; }\n    public DateTime d_LastUpdated { get; set; }\n    public bool b_Retired { get; set; }\n\n    public EAsset()\n    {\n        Type = new EAssetType();\n        Environment = new EOrgEnvironment();\n        Contact = new EUser();\n        d_Added = DateTime.Now;\n        d_LastUpdated = DateTime.Now;\n    }\n}\n</code></pre>\n\n<p><strong>The Context Object</strong> (with attempted table mapping and key assignment)</p>\n\n<pre><code>public class ScannerContext : DbContext\n{\n    public ScannerContext()\n        : base(\"LabDatabase\") { }\n\n    public DbSet&lt;EAsset&gt; EAssets { get; set; }\n    public DbSet&lt;EAssetType&gt; EAssetTypes { get; set; }\n    public DbSet&lt;EOrgEnvironment&gt; EOrgEnvironments { get; set; }\n    public DbSet&lt;EUser&gt; EUsers { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;EAsset&gt;().HasKey(k=&gt;k.i_GID).ToTable(\"t_Assets\");\n        modelBuilder.Entity&lt;EAssetType&gt;().HasKey(k =&gt; k.i_ID).ToTable(\"t_Asset_Types\");\n        modelBuilder.Entity&lt;EOrgEnvironment&gt;().HasKey(k =&gt; k.i_ID).ToTable(\"t_Org_Environments\");\n        modelBuilder.Entity&lt;EUser&gt;().HasKey(k =&gt; k.i_ID).ToTable(\"t_Users\");\n\n        base.OnModelCreating(modelBuilder);\n\n    }\n}\n</code></pre>\n\n<p><strong>The Program</strong></p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        EAsset Entity = new EAsset { s_Name = \"jewri-pc\" };\n        var sContext = new ScannerContext();\n        sContext.EAssets.Add(Entity);\n        sContext.SaveChanges();\n    }\n}\n</code></pre>\n"},{"tags":["c#",".net","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":12926483,"title":"How does Dispose work with Entity Framework","body":"<p>Can someone explain to me how and why do we need to use Dispose()? It's part of the default controller template that comes with ASP.NET MVC 4. Shouldn't the garbage collector in .NET automatically kick in when the object, in this case data from a database is no longer in use?</p>\n\n<p>Is it correct that Dispose() should be used when loading from a database but not regular object assignments?</p>\n"},{"tags":["json","entity-framework","serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":2648,"score":8,"question_id":4754375,"title":"How did I solve the Json serializing circular reference error?","body":"<p>There is post <a href=\"http://stackoverflow.com/questions/4606232/circular-reference-exception-with-json-serialisation-with-mvc3-and-ef4-ctp5w\">here</a> that asks how to solve the circular reference error when returning a serialized object via EF4 CTP5.  I ran into this same problem with a WCF web forms project a while back.</p>\n\n<p>I was able to \"solve\" this problem in my WCF/web forms project and in my MVC3 project.  I don't think it matters what type of project as this appears to be a EF serialization \"thing\".</p>\n\n<p>I solved the problem by disabling ProxyCreation in my ObjectContext constructor like this:</p>\n\n<pre><code>public class MyObjectContext : DbContext, IDbContext\n{\n     public MyObjectContext(string connectionStringName) : base(connectionStringName)\n     {\n        ((IObjectContextAdapter)this).ObjectContext.ContextOptions.ProxyCreationEnabled = false;\n     }\n     public DbSet&lt;Product&gt; Products {get;set;}\n     //etc.\n} \n</code></pre>\n\n<p>My question is: Could someone explain why this would seemingly solve the problem?</p>\n\n<p>I think the problem has to do with navigation properties in my POCO's but after that I am stumped.  Thanks.</p>\n"},{"tags":["entity-framework","table-relationships"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12915980,"title":"Multiple relationships between two tables","body":"<p>I am trying to persist an email object in the database using EF 5 code first</p>\n\n<p>My Classes are as follows:</p>\n\n<pre><code>public class Email\n{\n    public Email()\n    {\n        this.From = new EmailAddress();\n        this.To = new List&lt;EmailAddress&gt;();\n        this.Cc = new List&lt;EmailAddress&gt;();\n    }\n\n    public int Id { get; set; }\n    public EmailAddress From { get; set; }\n    public List&lt;EmailAddress&gt; To { get; set; }\n    public List&lt;EmailAddress&gt; Cc { get; set; }\n    //public List&lt;EmailAddress&gt; Bcc { get; set; }\n    public int EmailPriority { get; set; }\n    [MaxLength(78)]\n    public string Subject { get; set; }\n    public string HtmlBody { get; set; }\n    public string TextBody { get; set; }\n    public DateTime EmailCreated { get; set; }\n    public DateTime EmailSent { get; set; }\n}\npublic class EmailAddress\n{\n    public EmailAddress()\n    {}\n    public EmailAddress(string EmailAddress, string DisplayName)\n    {\n        this.Address = EmailAddress;\n        this.DisplayName = DisplayName;\n    }\n    public int Id { get; set; }\n    public Email Email { get; set; }\n    public int EmailAddressTypeId { get; set; }\n    public string Address { get; set; }\n    public string DisplayName { get; set; }\n}\n</code></pre>\n\n<p>It is creating duplicate email_Id fields in the EmailAddress table.</p>\n\n<p>Is there a way that I can specify the foreign key for the following fields to be EmailAddress.Email_Id:</p>\n\n<ul>\n<li>Email.To </li>\n<li>Email.Cc</li>\n<li>Email.Bcc</li>\n</ul>\n\n<p>I'm assuming that there would be some fluid config to not stick to the convention.</p>\n"},{"tags":["c#","database","entity-framework","sql-server-ce","entity"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12925784,"title":"Fastest Approach to check if Entity already Exists in Database?","body":"<p>At the moment I have something like this, to check if an Entity has already been added (simplified):</p>\n\n<pre><code>WinEveryBetBYeMiContext context = new WinEveryBetBYeMiContext();\nstring firstPlayerName = \"R.Federer\";\nforeach (var player in context.Players)\n{\n       if (player.Name == firstPlayerName)\n       {\n            //Player already exists\n       }\n }\n</code></pre>\n\n<p>But since there can be 100s of Players, this approach looks to me very bad and its also very slow.. </p>\n\n<p>I heard about LINQ TO SQL.. But I don't really know if its better, faster and more effective..\nMaybe someone has a good way to check such things and could help me out.?</p>\n"},{"tags":["sql","entity-framework","sql-injection"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12925649,"title":"When using DbSet<T>.SqlQuery(), how to use named parameters?","body":"<p>I'm a big fan of using named parameters instead of string-based parameter injection. It's type-safe and safe against most forms of SQL injection. In old ADO.NET, I would create a SqlCommand object and a bunch of SqlParameters for my query.</p>\n\n<pre><code>var sSQL = \"select * from Users where Name = @Name\";\nvar cmd = new SqlCommand(conn, sSQL);\ncmd.Parameters.AddWithValue(\"@Name\", \"Bob\");\ncmd.ExecuteReader();\n</code></pre>\n\n<p>Now, in Entity Framework, it appears (on this link) to have regressed to a simple String.Format statement and string injection again: (simplified for discussion)</p>\n\n<pre><code>MyRepository.Users.SqlQuery(\"Select * from Users where Name = {0}\", \"Bob\");\n</code></pre>\n\n<p>Is there a way to use named parameters with the Entity Framework DbSqlQuery class?</p>\n"},{"tags":["entity-framework","gridview"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1343,"score":1,"question_id":2053470,"title":"How to get the entity object from RowDataBound in a EntitydataSource bound gridview","body":"<p>I have a GridView that is bound to an Entity Framework object. I want to access the object in the RowDataBound event of the GridView. When I try to access the DataItem object i get an error stating Unable to cast object of type 'System.Data.Objects.MaterializedDataRecord' to type 'BBM.NailArtGallery.Model.Item'. Apparently the MaterializedDataRecord is some hidden property. Does anyone know how to get around this. My GridView is bound using and EntityDataSource Control. The code is below. </p>\n\n<pre><code>&lt;asp:EntityDataSource ID=\"EntityDataSource1\" runat=\"server\" AutoPage=\"true\" AutoSort=\"true\" OrderBy=\"it.ID\"\n    ConnectionString=\"name=Entities\" DefaultContainerName=\"Entities\" \n    EntitySetName=\"Items\" EntityTypeFilter=\"ItemImage\"  \n    Select=\"it.[ID], it.[Title], it.[IsFeatured], it.[ImageHome], it.[DateEntered]\"&gt;\n&lt;/asp:EntityDataSource&gt;\n\nif (e.Row.RowType == DataControlRowType.DataRow)\n        {          \n            ICustomTypeDescriptor descriptor = (ICustomTypeDescriptor)e.Row.DataItem;\n            if (descriptor != null)\n            {\n                var prop = (PropertyDescriptor)descriptor.GetProperties()[0];\n                Item image = (Item)descriptor.GetPropertyOwner(prop);\n\n            }\n\n        }\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":880,"score":2,"question_id":4545156,"title":"Unable to cast object of type 'System.Data.Objects.MaterializedDataRecord'","body":"<p>I have a GridView connected with the EntityDataSource.</p>\n\n<p>EntityDataSource has a internal parameter for Where Parameters. All is working fine till this point.</p>\n\n<pre><code>    &lt;asp:EntityDataSource ID=\"EntityDataSourceListAuthors\" runat=\"server\" ConnectionString=\"name=CmsConnectionStringEntityDataModel\"\n        DefaultContainerName=\"CmsConnectionStringEntityDataModel\" EnableFlattening=\"False\"\n        EntitySetName=\"CmsAuthors\" EntityTypeFilter=\"\" OrderBy=\"it.FirstName\" Select=\"it.AuthorId, it.UserId, it.FirstName, it.LastName, it.NoteInternal, it.ContentAuthor\"\n        Where=\"it.UserId = @ActiveUser\"&gt;\n    &lt;/asp:EntityDataSource&gt;\n</code></pre>\n\n<hr>\n\n<p>I use an Event RowDataBound an Entity Framework to retrieve a value for every single row and execute some logic.</p>\n\n<p>As soon as I run the code I receive this error:</p>\n\n<pre><code>Unable to cast object of type 'System.Data.Objects.MaterializedDataRecord' to type 'WebProject.DataAccess.DatabaseModels.CmsAuthor'.\n</code></pre>\n\n<p>It seems to me when adding parameters to EntityDataSource smt is changing so I am not able to use EF as before \nAny idea? Thanks Guys!</p>\n\n<hr>\n\n<pre><code>        protected void uxListAuthorsDisplayer_RowDataBound(object sender, GridViewRowEventArgs e)\n    {\n            switch (e.Row.RowType)\n            {\n                // In case type of row is DataRow (a data row of GridView) \n                case DataControlRowType.DataRow:\n                    // Display friendly User's Name instead of his Guid\n                    // Retrive underlying data from a single row rappresented in GridView (use Entity Framwork)                \n                    WebProject.DataAccess.DatabaseModels.CmsAuthor myRow = (WebProject.DataAccess.DatabaseModels.CmsAuthor)e.Row.DataItem;\n                    // Retrive the Guid for a User in a specific row\n                    Guid myUserGuid = (Guid)myRow.UserId;\n                    // Find out used UserName using Guid UserId\n                    MembershipUser mySelectedUser = Membership.GetUser(myUserGuid);\n                    // Write friendly User's Name instead of his Guid value in a specific Grid View Cell\n                    e.Row.Cells[3].Text = mySelectedUser.UserName;\n\n                    // Disable Delete Button if a Content has associated an Author\n                    // Use Entity Framwork for retriving data - Create a \"Context\" for a single Row\n                    using (CmsConnectionStringEntityDataModel context = new CmsConnectionStringEntityDataModel())\n                    {\n                        // Find out Row Id and create an varaible to store it\n                        int myWorkingRowId = myRow.AuthorId;\n                        // Find the Edit Link\n                        HyperLink myEditLink = (HyperLink)e.Row.FindControl(\"uxLinkEditButton\");\n                        // Find the Delete Button\n                        LinkButton myDeleteButton = (LinkButton)e.Row.FindControl(\"uxLinkDeleteButton\");\n                        // Find the System Note Label\n                        Label mySystemNote = (Label)e.Row.FindControl(\"uxSystemNoteDisplayer\");\n                        // Use of Lamba Espression with EF to check if an Author is associated with a Content\n                        CmsContent authorIdInContent = context.CmsContents.FirstOrDefault(x =&gt; x.AuthorId == myWorkingRowId);\n                        // Make visible or invisible the Delete Button if an Author is associated to a Content\n                        if (authorIdInContent != null)\n                        {\n                            myDeleteButton.Visible = false;\n                            mySystemNote.Text = \"Author is being used in Contents\";\n                        }\n                        else\n                        {\n                            myDeleteButton.Visible = true;\n                        }\n\n                        // Programmatically Limiting Functionality depending on User's Roles\n                        myEditLink.Visible = User.IsInRole(\"CMS-ADMINISTRATOR\") || User.IsInRole(\"CMS-AUTHOR\") || User.IsInRole(\"CMS-EDITOR\");\n                        myDeleteButton.Visible = User.IsInRole(\"CMS-ADMINISTRATOR\");\n                    }\n                    break;\n            }\n        }\n</code></pre>\n"},{"tags":["c#","performance","entity-framework","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":1279,"score":8,"question_id":4355474,"title":"How do I speed up DbSet.Add()?","body":"<p>I have to import about 30k rows from a CSV file to my SQL database, this sadly takes 20 minutes.</p>\n\n<p>Troubleshooting with a profiler shows me that <strong>DbSet.Add is taking the most time, but why?</strong></p>\n\n<p>I have these Entity Framework Code-First classes:</p>\n\n<pre><code>public class Article\n{\n    // About 20 properties, each property doesn't store excessive amounts of data\n}\n\npublic class Database : DbContext\n{\n    public DbSet&lt;Article&gt; Articles { get; set; }\n}\n</code></pre>\n\n<p>For each item in my for loop I do:</p>\n\n<pre><code>db.Articles.Add(article);\n</code></pre>\n\n<p>Outside the for loop I do:</p>\n\n<pre><code>db.SaveChanges();\n</code></pre>\n\n<p>It's connected with my local SQLExpress server,   but I guess there isn't anything written till SaveChanges is being called so I guess the server won't be the problem....</p>\n"},{"tags":["c#","asp.net","linq","entity-framework"],"answer_count":6,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":355,"score":2,"question_id":12767721,"title":"LINQ Query matching two lists of items","body":"<p>my issue is that I have an attribute as 'attribute' coming in from entity framework.\nSo I retrieve this object which has a list of attribute tags, they are accessible via <code>attribute.AttributeTags</code>. Now I have a <code>asp:TextBox</code> where users can edit, remove and add new tags (comma separated). (On page load I am adding the attribute tags to this <code>TextBox</code>)</p>\n\n<p>After a postback on the page I am returning the user input and splitting it into an array of strings and storing it in a variable called <code>AttributeTags</code>.</p>\n\n<p>Now, I would like to add new tags that are not contained in the original <code>attributes</code> list coming from EF and would like to <code>remove</code> the ones that are contained in <code>attributes</code> but not found in the user input string array <code>AttributeTags</code>.</p>\n\n<p>I am doing something like this:</p>\n\n<pre><code>        BusinessObjects.Attribute attribute = db.Attributes.FirstOrDefault(a =&gt; a.attribute_id == AttributeID);\n        string[] AttributeTags = txtAttributeTags.Text.Split(new string[] { \",\" }, StringSplitOptions.RemoveEmptyEntries);\n        foreach (var item in AttributeTags)\n        {\n            if (!attribute.AttributeTags.Any(t =&gt; t.value == item))\n            {\n                AttributeTag tag = new AttributeTag { value = item, timestamp = DateTime.Now };\n                attribute.AttributeTags.Add(tag);\n            }\n            else\n            {\n                AttributeTag tag = attribute.AttributeTags.FirstOrDefault(t =&gt; t.value == item);\n            }\n        }\n</code></pre>\n\n<p>But I'm sort of stuck here since i'm fairly new to LINQ and EF.</p>\n"},{"tags":["wpf","visual-studio-2010","entity-framework","datasource"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12916366,"title":"How to add an existing data model as a Data Source in Visual Studio 2010?","body":"<p>I'm experimenting with a simple WPF application with a .edmx file as the Data source in Visual Studio 2010. </p>\n\n<p>I don't know what I did, but suddenly the data source pane/window is now empty, but the .edmx file is still part of my project. </p>\n\n<p>The data source window only has the option to \"Add New Data Source\"; how do I make make it use the existing entity model as the data source? </p>\n"},{"tags":["asp.net","vb.net","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":155,"score":1,"question_id":12632164,"title":"EntityFramework using with database foreign key","body":"<p>Actually I spend whole day on the EntityFramework for foreign key.\nassume we have two table.\nProcess(app_id,process_id)\nLookupProcessId(process_id, process_description)</p>\n\n<p>you can understand two tables with names, first table ,use process_id to indicate every application, and description is in the seoncd table.\nActually i try many times and figure out  how to do inquery: it was like</p>\n\n<pre><code>Dim result = (from x in db.Processes where x.LookupProcess is (from m in db.LookupProcessIds where descr = \"example\" select m).FirstOrDefault() select x).FirstOrDefault()\n</code></pre>\n\n<p>First I want to ask is there easier way to do it.</p>\n\n<p>Second i want to ask question is about insert</p>\n\n<pre><code> p As New AmpApplication.CUEngData.Process\n    p.app_id=100\n    p.LookupProcess = (from m in db.LookupProcessIds where descr = \"example\" select m).FirstOrDefault()\n db.AddToProcesses(p)\n db.SaveChanges()\n</code></pre>\n\n<p>from appearance it looks fine, but it give me error says\nEntities in 'AmpCUEngEntities.Processes' participate in the 'FK_Process_LookupProcess' relationship. 0 related 'LookupProcess' were found. 1 'LookupProcess' is expected.</p>\n\n<p>can i ask is that insert wrong? and is that my query correct?</p>\n"},{"tags":["ruby-on-rails","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12923959,"title":"Equivalent to Rails' polymorphic associations in Entity Framework","body":"<p>I'm working to port part of an existing Ruby on Rails application to .NET MVC 4 and Entity Framework 5 (don't ask), and need some help replicating some ORM functionality, particularly Rails' polymorphic associations.</p>\n\n<p>I would rather not change the existing database structions.  I'll give one example of what I'm doing -- here's what the database looks like:</p>\n\n<pre><code>CREATE TABLE tags (\n    id integer PRIMARY KEY,\n    name nvarchar(128) NOT NULL,\n    UNIQUE (name)\n);\n\nCREATE TABLE taggings (\n    id integer PRIMARY KEY,\n    tag_id integer REFERENCES tags(id) ON DELETE CASCADE,\n    taggable_id integer,\n    taggable_type nvarchar(255),\n);\n\nCREATE TABLE stories (\n    id integer PRIMARY KEY,\n    name nvarchar(128) NOT NULL\n    [more stuff]\n);\n\nCREATE TABLE assets (\n    id integer PRIMARY KEY,\n    name nvarchar(128) NOT NULL\n    [more stuff]\n);\n</code></pre>\n\n<p>The Taggings model is associated with several others, such as Story, Asset, etc.  Records in this table looks like:</p>\n\n<pre><code>INSERT INTO taggings values (1, 1, 1234, 'Story');\nINSERT INTO taggings values (2, 343, 69, 'Asset');\nINSERT INTO taggings values (3, 200, 42, 'Asset');\n</code></pre>\n\n<p>Thus, both the Asset and Story models in the domain have a one-to-many relationship with Taggings.  I'd like to model (Fluent API) this relationship on my C# Story and Asset classes.  </p>\n\n<p>Is there a way to specify this, perhaps with an additional condition (Tagging.taggable_type = 'Story') when defining the relationship?  I don't need to navigate the other direction (from Tagging to Story/Asset).</p>\n"},{"tags":["c#","linq","entity-framework","resharper"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":12923497,"title":"Using Queryable instead of Extension Method","body":"<p>ReSharper has proposed me to make the following changes:</p>\n\n<p>From:</p>\n\n<pre><code>foreach (var item in db.Proposta.GroupBy(x =&gt; x.StatusProposta.Nome))\n{\n    ...\n}\n</code></pre>\n\n<p>To:</p>\n\n<pre><code>foreach (var item in Queryable.GroupBy(db.Proposta, x =&gt; x.StatusProposta.Nome))\n{\n    ...\n}\n</code></pre>\n\n<p>The message is: <strong>Invoke method 'GroupBy' as static method</strong></p>\n\n<p>I'm using <strong>Entity Framework</strong> and <strong>db</strong> is my context.</p>\n\n<p>I wonder what advantages may I get or problems I can avoid with such a change.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12907056,"title":"How to use updatable views in entity framework using code first","body":"<p>We're using entity framework code first for DB tables. Now the data base has been moved to another  dev server and the DBA has created updatable view to work with instead of tables. I changed the connection string and it started giving error \"CREATE TABLE permission denied in database............\"\nLooked like since the table is not there is the DB, EF is trying to create one. I followed the steps at \n<a href=\"http://blog.3d-logic.com/2012/05/28/entity-framework-code-first-and-pre-generated-views/\" rel=\"nofollow\">a link</a></p>\n\n<p><a href=\"http://blogs.msdn.com/b/alexj/archive/2009/09/01/tip-34-how-to-work-with-updatable-views.aspx\" rel=\"nofollow\">a link</a></p>\n\n<p>Basically created the edmx file and manually remove DefininingQuery tags and change store:views to tables and generate view and add to the project. But I am still getting the same error.                                                                                </p>\n\n<p>I am new to EF and not clearly understand what I am doing here. Basically I need to tell EF from here on wards use this database and instead of the tables used earlier, use these updatable views. I am not sure database migration is needed here. I would appreciate any help. thanks</p>\n"},{"tags":["sql-server","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12919896,"title":"Building Many-to-many query with EF","body":"<p>I'm using EF5 with .net 4.0 and I have 3 entities - User, Project and Interest. I connected User <em>Many2Many</em> Interest and Project <em>Many2Many</em> Interest using FluentAPI (it created additional 2 tables for each relation). Everything works great.</p>\n\n<p>What I want to do is to load all projects per user who has same interests. I tried</p>\n\n<pre><code>Project ... \n  .Where(p =&gt; p.Interests\n               .Any(t =&gt; user.Interests.All(i =&gt; i.Url == t.Url))); \n</code></pre>\n\n<p>(Interest has PK Url). When I perform this query, I get error</p>\n\n<blockquote>\n  <p>Unable to create a constant value of type 'DAL.Models.Interest'. Only primitive types or enumeration types are supported in this context.</p>\n</blockquote>\n\n<p>What is the right query?</p>\n"},{"tags":["c#",".net","entity-framework","sqldatareader"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":101,"score":4,"question_id":12853169,"title":"How does the Entity Framework walks through a collection that is too big?","body":"<p>I am new to Entity Framework.</p>\n\n<p>And I have one concern:</p>\n\n<p>I need to walktrhough a quite big amount of data that is gathered via a LINQ to Entities that combines couple of properties from different entities in an anonymous type.</p>\n\n<p>If I need to read the returned items of this query one by one until the end, am I under the risk of OutOfMemory exception as the collection is BIG or EF uses SqlDataReader implicitly?</p>\n\n<p>( Or should I use EntityDateReader to ensure that I am reading the Db in a sequential order (But then I have to generate my query as a string I guess) )</p>\n"},{"tags":[".net","linq","entity-framework",".net-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12921415,"title":"Decompiling Linq queries from .net assembly","body":"<p>I have to decompile an assembly that contains some linq-to-sql code (about 30 methods). I have tried many decompilers like dotpeek, Telerik's just decompile, RedGate's .NET reflactor (evaluation) but all of them decompile linq queries in form of dynamic linq. Is there a free reflactor that can extract original linq queries from .NET assembly?</p>\n\n<p>Regards</p>\n"},{"tags":["c","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12921095,"title":"Finde correct name for EF context","body":"<p>I've added a entity framework model from a database using the wizard called EnterpriseDownloadRepository.edmx</p>\n\n<p>I can't access it when trying to set up the context in the same project.</p>\n\n<p>var context = new FileDownloadEntites()</p>\n\n<p>\"FileDownloadEntites\"  is not recognized by visual studio 2012</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12921194,"title":"visual studio 2010 and entity framework 5.0, can I use it?","body":"<p>Well, really I wanted to update the 4.1 version of entity framework, so in tools-->library package manager-->package manager I use this command:</p>\n\n<p>Install-Package EntityFramework</p>\n\n<p>Then the update started. I saw a message saying that the version 5 is installed. I my project folder I can see two foloders, one with the net4 lib and other with the net5 library.</p>\n\n<p>However, in my references in the project, the 4.1 was replaced with the 4.4, not with the 5.0 version, so I would like to know if I can use the 5.0 version or only the 4.4 version. If I only can use the 4.4 version, why is installed the 5.0 version? I know that the 5.0 version is installed because if I try to install again entity framework through the package manager, I get the following message:</p>\n\n<p>\"'EntityFramework 5.0.0' already installed.\"</p>\n\n<p>Thanks.</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12920322,"title":"Entity Framework 5 Invalid column name","body":"<p>Using EF5 Code First fluent API I receive this error: \"Invalid column name Doctor_ID\" when loading an object.</p>\n\n<pre><code>public class User\n{\n    public int ID { get; set; }\n    ...\n}\n\npublic class Doctor : User\n{\n\n    public int? TitleID { get; set; }\n    public virtual Title Title { get; set; }\n}\n\n\npublic class UserMap : EntityTypeConfiguration&lt;User&gt;\n{\n    public UserMap()\n    {\n        this.ToTable(\"User\", \"Users\");\n\n        // Primary Key\n        this.HasKey(t =&gt; t.ID);\n\n        ...\n\n    }\n}\n\npublic class DoctorMap : EntityTypeConfiguration&lt;Doctor&gt;\n{\n    public DoctorMap()\n    {\n        // Table &amp; Column Mappings            \n        this.ToTable(\"Doctor\", \"Doctors\");\n\n        //this.Property(t =&gt; t.ID).HasColumnName(\"ID\");\n        this.Property(t =&gt; t.TitleID).HasColumnName(\"TitleID\");            \n\n        // Relationships\n        this.HasOptional(t =&gt; t.Title)\n            .WithMany(t =&gt; t.Doctors)\n            .HasForeignKey(d =&gt; d.TitleID);\n\n    }\n}    \n</code></pre>\n\n<p>The code executes the followings successfully:</p>\n\n<pre><code>return (from item in this.DataProvider.Users\n                    where\n                        item.Username == username &amp;&amp; item.Password == password\n                    select new UserBasicInfo() { ID = item.ID, FirstName = item.FirstName, LastName = item.FirstName, Username = item.Username }).FirstOrDefault();\n</code></pre>\n\n<p>After this code executes the followings which cause the \"Invalid column name Doctor_ID\" exception:</p>\n\n<pre><code>User user = this.DataProvider.Users.SingleOrDefault(item =&gt; item.ID == id);\n</code></pre>\n\n<p>the first line of code gets data from the users table only and that is why it executes successfully but why in the second EF5 fails to use ID as key for Doctor table when it accesses it?</p>\n\n<p>Note: I am using type per type TPT.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12920353,"title":"DBContext DBSet query and the no tracking option","body":"<p>Based on other posts such as <a href=\"http://stackoverflow.com/questions/7099134/entity-framework-and-dbcontext-object-tracking\">Entity Framework and DbContext - Object Tracking</a>\nit would appear the simplified DBContext interface doesnt expose the to set No tracking on basic queries.\nA little blog showing how with Object context\n<a href=\"http://blogs.microsoft.co.il/blogs/gilf/archive/2009/02/20/disabling-change-tracking-in-entity-framework.aspx\" rel=\"nofollow\">http://blogs.microsoft.co.il/blogs/gilf/archive/2009/02/20/disabling-change-tracking-in-entity-framework.aspx</a></p>\n\n<p>What is a good approach to loading results via the DbContext as not tracked?\nHow are the performance conscious doing this if using Dbcontext ?\nie have base GetList method I would like to improve for performance reasons.</p>\n\n<pre><code>public DbSet&lt;T&gt; EntityDbSet { get { return _context.Set&lt;T&gt;(); } }\npublic virtual IQueryable&lt;T&gt; GetList(Expression&lt;Func&lt;T, bool&gt;&gt; predicate)\n    {\n         return EntityDbSet.Where(predicate);\n    }\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc-3","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12920402,"title":"EF 4.1 in MVC 3 - Date from form submission overwriting default in DB","body":"<p>So I have a small table and one of the columns is a date, with a a default GETDATE() constraint for use as a timestamp.</p>\n\n<p>Neither the model, nor the ViewModel have a property for this date, but I have an edmx file, so obviously it does.  I don't capture the date at any point in the app.</p>\n\n<p>The issue is that when the changes are submitted to the db, the model contains the date '0001-01-01' and this is overwriting the default in the db.</p>\n\n<p>Is there some way to ignore date from the client side?</p>\n"},{"tags":["asp.net-mvc","entity-framework","design-patterns","repository-pattern"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":12920455,"title":"How should I implement the repository pattern for complex object models?","body":"<p>Our data model has almost 200 classes that can be separated out into about a dozen functional areas. It would have been nice to use domains, but the separation isn't that clean and we can't change it. We're redesigning our DAL to use Entity Framework and <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application\" rel=\"nofollow\">most of the recommendations that I've seen</a> suggest using a Repository pattern. However, none of the samples really deal with complex object models. Some implementations that I've found suggest the use of a repository-per-entity. This seems ridiculous and un-maintainable for large, complex models. Is it really necessary to create a UnitOfWork for each operation, and a Repository for each entity? I could end up with thousands of classes. I know this is unreasonable, but I've found very little guidance implementing Repository, Unit Of Work, and Entity Framework over complex models and realistic business applications.</p>\n"},{"tags":["c#",".net","linq","entity-framework","expression-trees"],"answer_count":5,"favorite_count":16,"up_vote_count":20,"down_vote_count":0,"view_count":20317,"score":20,"question_id":307512,"title":"How do I apply OrderBy on an IQueryable using a string column name within a generic extension method?","body":"<pre><code>public static IQueryable&lt;TResult&gt; ApplySortFilter&lt;T, TResult&gt;(this IQueryable&lt;T&gt; query, string columnName)\n  where T : EntityObject\n{\n  var param = Expression.Parameter(typeof(T), \"o\");\n  var body = Expression.PropertyOrField(param,columnName);\n\n  var sortExpression = Expression.Lambda(body, param);\n  return query.OrderBy(sortExpression);\n}\n</code></pre>\n\n<p>Because the type for OrderBy is not inferred from sortExpression I need to specify it something like this at run time:</p>\n\n<pre><code>var sortExpression = Expression.Lambda&lt;T, TSortColumn&gt;(body, param);\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>return query.OrderBy&lt;T, TSortColumn&gt;(sortExpression);\n</code></pre>\n\n<p>I don't think this is possible however as TSortColumn can only be determined during runtime.</p>\n\n<p>Is there a way around this?</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12918294,"title":"Is there a way to enforce Entity Framework to read one record from Db at a time while I enumerate?","body":"<p>Is there a way to enforce Entity Framework to read one record from Db at a time?</p>\n\n<p>Basicly to make it work like SqlDataReader. (I need to read forward only and I won't change the data at all!)</p>\n\n<p>To simplify what I ask with an example, in the loop below, I want EF to obtain 1 city on each iteration.</p>\n\n<pre><code>var context = new CityEntities();\n\nvar cities = from c in context.Cities\n             select c;\n\nforeach (var c in cities){\n Console.WriteLine(c); //I want to have only 1 city in the memory at this point\n}\n</code></pre>\n\n<p>(<strong>Why</strong> : Because I want to write the query by using the adventage of strongly typing and prevent writing the queris as string in my case)</p>\n"},{"tags":["asp.net","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12919250,"title":"Insert & Delete values in many to many relation table","body":"<p>I want to insert values to many to many relation table \nI'm using entity framework &amp; linq. and I want to build up the Insert query (.net Framework 4)</p>\n\n<p>following are the tables</p>\n\n<p>Menus -\n    menu_id,\n    menu_name,\n    menu_desc</p>\n\n<p>Cater  - cater_id,\n           cater_name, \n           enable_ind</p>\n\n<p>Relation table\nMenu_Cater -    menu_id,\n                    cater_id</p>\n\n<p>I have tried with couple of cases seems not working, \nif there is a SIMPLE way of implementing this insert &amp; delete</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12914611,"title":"How to Customize a \"complex\" mapping between model and database table in Entity Framework Code First","body":"<p>Is it possible to add a custom attribute(Data Annotation), named \"IP\" for example:</p>\n\n<pre><code>public class User\n{\n   public int UserId {get; set;}\n\n   [IP]\n   public string UserIP {get; set;}\n}\n</code></pre>\n\n<p>In this case, [IP] include [MaxLengt(20)] and [Column(\"IP\")], or more other data annotation.</p>\n\n<pre><code>public class User\n{\n   public int UserId {get; set;}\n\n   [MaxLength(20)]\n   [Column(\"IP\")]\n   public string UserIP {get; set;}\n}\n</code></pre>\n\n<p>I also need the [IP] data annotation can work in code first automatic migration.</p>\n\n<p>Any help will be appreciated. Thank you!</p>\n"},{"tags":["sql-server","sql-server-2008","entity-framework","asp.net-membership","connection-string"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12917410,"title":"Move ASPNETDB.mdf from local machine to SQL Server in production","body":"<p>so I have a problem which destroy my brain since a week. I'll try to be the more specific as possible.</p>\n\n<p>I have an Intranet Web Application in ASP.NET Razor MVC3 with <strong>Entity Framework Membership Provider</strong>. So, my ASPNETDB.mdf appears in my App_Data folder, and I also see it in my Server Explorer tab. Until there, everything is normal and alright. </p>\n\n<p>Now that my app is finish, I would like to move my ASPNETDB database on a distant sql server. So I'll do it, I joined my db in MSQL server management studio, and I changed my connection string from :</p>\n\n<pre><code>&lt;add name=\"ApplicationServices\" \nconnectionString=\"data source=.\\SQLEXPRESS;\n                  Integrated Security=SSPI;\n                  AttachDBFilename=|DataDirectory|FactuADH.dbo;\n                  User Instance=true\"    \nproviderName=\"System.Data.SqlServerCe.4.0\" /&gt;\n</code></pre>\n\n<p>to this one : </p>\n\n<pre><code>&lt;add name=\"ApplicationServices\"\n     connectionString=\"Server=SDCCID01;\n                       Initial Catalog=myDbName;\n                       User ID=myid;\n                       Password=mypswd\"\n     providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>So, to test it, I delete my ASPNETDB.mdf from my App_Data, and when I'll try to log on in my app, I can't. Other thing, when I shut down visual studio and re-open it, I have a new ASPNETDB.mdf database which is re-created (empty). It's look like my connection string have no impacte, even when I changed it, without delete my ASPNETDB from my App_Data folder, my application speak with my local aspnetdb, not one on my server. </p>\n\n<p>Any Idea ? </p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","entity-framework-4.3"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":36,"score":-1,"question_id":12916750,"title":"Using non primary unique keys in an association in EF 4.1+","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3992236/entity-framework-alternate-solution-to-using-non-primary-unique-keys-in-an-asso\">Entity Framework: Alternate solution to using non primary unique keys in an association</a>  </p>\n</blockquote>\n\n\n\n<p><a href=\"http://stackoverflow.com/questions/3992236/entity-framework-alternate-solution-to-using-non-primary-unique-keys-in-an-asso\">Entity Framework: Alternate solution to using non primary unique keys in an association</a></p>\n\n<p>Has this been solved yet? I can't seem to find any obvious place for a change log on the net.</p>\n"},{"tags":["entity-framework","wcf-data-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12674237,"title":"Why am i having problems with EF5 with WCF Service Application?","body":"<p>I have created EF Data Services  before but I'm receiving this message everytime I try and create a EF5 - WCF Service Application.</p>\n\n<blockquote>\n  <p>The operation 'ProcessRequestForMessage' could not be loaded because\n  it has a parameter or return type of type\n  System.ServiceModel.Channels.Message or a type that has\n  MessageContractAttribute and other parameters of different types. When\n  using System.ServiceModel.Channels.Message or types with\n  MessageContractAttribute, the method must not use any other types of\n  parameters.</p>\n</blockquote>\n\n<ol>\n<li>I create the WCF Service Application,  </li>\n<li>add references System.Data.Services</li>\n<li>Generate the EF Model</li>\n<li>Changed the Code Generation Strategy to \"Default\" and deleted the \".tt\"</li>\n<li>Inherit the DataService&lt; DBEntities> to my service class (Service1)</li>\n<li>Add the required \"InitilizeService\" routine</li>\n<li>No changes to web.config</li>\n</ol>\n\n<p>When i try and debug I get the message. I am using VS2012</p>\n\n<p>It was a while ago since i've used Data Services but looking at my old VS2010 project that works I have modified web.config to include a service with an endpoint with \"System.Data.Services.IRequestHandler\" as the contract. </p>\n\n<p>I also tried it again aswell as changing the binding to a \"webHttpBinding\" That didn't seem to work either. Any ideas? </p>\n\n<p>If all else fails i guess i can use Open Access ORM with its built in service generation tools because I can atleast get that working.</p>\n\n<p>Best Regards</p>\n\n<p>Chris Leach</p>\n"},{"tags":["c#","winforms","entity-framework","data-binding"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12916567,"title":"Entity Framework - Master-Detail w/Bridge Table","body":"<p>I'm attempting to implement the Entity Framework but seem to be having an issue when I'm trying to utilize a master-detail relationship.  Ideally, I'd like to be able to select a company from a combobox and then populate a subsequent combobox with a list of employee names for the selected company.  I seem to be running into issues trying to achieve this with a many-to-many relationship that has a bridge table containing some additional data.  The following is a simplified version of the three database tables I'm using:</p>\n\n<pre><code>create table Organization.Company\n(\n   CompanyID int not null,\n   CompanyName varchar(40) not null,\n   ServiceRepresentative varchar(20) not null,\n   primary key (CompanyID)\n)\n\ncreate table Person.Employment\n(\n   CompanyID int not null,\n   PersonID uniqueidentifier not null,\n   EmployeeID int not null,\n   FullTime bit not null,\n   HoursPerWeek float null,\n   primary key (CompanyID, PersonID),\n   constraint fk_Company_Employment foreign key (CompanyID) references Organization.Company(CompanyID),\n   constraint fk_Person_Employment foreign key (PersonID) references Person.ContactInfo(PersonID)\n)\n\ncreate table Person.ContactInfo\n(\n   PersonID uniqueidentifier not null,\n   FirstName varchar(40) not null,\n   LastName varchar(40) not null,\n   primary key (PersonID)\n)\n</code></pre>\n\n<p>Im my code-behind I have the following (WinForms):</p>\n\n<pre><code>    private orgEntities db;\n    private BindingSource companyBinding;\n    private BindingSource employeeBinding;\n\n    public MainForm()\n    {\n        InitializeComponent();\n\n        this.db = new orgEntities();\n        this.companyBinding = new BindingSource();\n        this.employeeBinding = new BindingSource();\n\n        this.companyBinding.DataSource = db.Companies.OrderBy(x =&gt; x.CompanyName);\n\n        this.employeeBinding.DataSource = companyBinding;\n        this.employeeBinding.DataMember = \"Employment\";\n\n        this.currentCompanyComboBox.DataSource = companyBinding;\n        this.currentCompanyComboBox.DisplayMember = \"CompanyName\";\n        this.currentCompanyComboBox.ValueMember = \"CompanyID\";\n\n        this.currentEmployeeComboBox.DataSource = employeeBinding;\n        this.currentEmployeeComboBox.DisplayMember = \"ContactInfo.FullName\";  // Generated by extension class\n        this.currentEmployeeComboBox.ValueMember = \"PersonID\";           \n    }\n</code></pre>\n\n<p>The issue I seem to be running into is that only one employee is displayed inside the combobox when a company is selected.  When I change the \"ContactInfo.FullName\" to \"EmployeeID\" I get the full list of EmployeeIDs.  I'm assuming that the entity framework is grabbing the first person and navigating to their FullName property which causes their information to be the only thing displayed.  </p>\n\n<p>Is there any way I can get the full list of names to display in this drop-down with the bridge table (Person.Employment) present or would I be better off just creating a view of combining the Employment and ContactInfo tables together and using that in the edmx file rather than the two separate tables?  </p>\n\n<p>I understand that I may be going about this the wrong way and I would be grateful if someone could point me in the right direction on this one.  Thank you and have a great day!</p>\n"},{"tags":["c#","asp.net",".net","entity-framework","data-binding"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12916270,"title":"Multiplicity constraint violated. The role '' of the relationship '' has multiplicity 1 or 0..1","body":"<p>I have a Tab object. This Tab object has many Questions. Here are my classes:</p>\n\n<pre><code>public abstract class Tab\n{\n    /// &lt;summary&gt; init default values &lt;/summary&gt;\n    public Tab()\n    {\n        // Do some init stuff\n    }\n    public int ID { get;set; }\n\n    //...\n\n    /// &lt;summary&gt; Question for this Tap. Like Quiz-App or Sweepstake &lt;/summary&gt;\n    public virtual ICollection&lt;Tabs.Question&gt; Questions { get; set; }\n\n    //...\n}\n\npublic class Question\n{\n    public int Id { get; set; }\n    public int OrderNumber { get; set; }\n    public string Text { get; set; }\n\n    public virtual Tab Tab { get; set; }\n }\n</code></pre>\n\n<p>And here is the configuration for both classes.</p>\n\n<pre><code>class TabConfig : EntityTypeConfiguration&lt;Tab&gt;\n{\n    public TabConfig()\n    {\n        this.Map(m =&gt; m.Requires(\"AppType\").HasValue&lt;byte&gt;((byte)ApplicationType.Application)).ToTable(\"TmTabs\");\n        this.HasKey(c =&gt; c.ID);\n        this.Property(p =&gt; p.ID).HasColumnName(\"ID\").IsRequired().HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n\n    }\n}\n\npublic class QuestionConfig : EntityTypeConfiguration&lt;Question&gt;\n{\n    public QuestionConfig()\n    {\n        ToTable(\"TmQuestions\");\n        HasKey(q =&gt; q.Id);\n        Property(q =&gt; q.Id).HasColumnName(\"Id\").HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n        Property(q =&gt; q.OrderNumber).HasColumnName(\"OrderNumber\").IsRequired();\n        Property(q =&gt; q.Text).HasColumnName(\"Text\").IsRequired();\n        HasRequired(q =&gt; q.Tab).WithMany(t =&gt; t.Questions).Map(q =&gt; q.MapKey(\"TmTabs_Id\")).WillCascadeOnDelete(false);\n    }\n}\n</code></pre>\n\n<p>And the configuration will be added to the built event like this.</p>\n\n<pre><code>public class ModelContext : DbContext\n{\n\n    public Guid ContractId { get; set; }\n\n    #region construction\n\n    public ModelContext()\n        : base(Tools.DatabaseTools.GetDefaultConnectionString())\n    {\n        ContractId = Guid.Empty;\n    }\n\n    public ModelContext(Guid contractGuid)\n        : base(Tools.DatabaseTools.GetConnectionString(contractGuid))\n    {\n        ContractId = contractGuid;            \n    }\n\n    public ModelContext(string connectionString)\n        : base(connectionString)\n    {\n        ContractId = Guid.Empty;\n    }\n\n    public ModelContext(string connectionString, Guid contractGuid)\n        : base(connectionString)\n    {\n        ContractId = contractGuid;\n    }\n\n\n    public DbSet&lt;Tab&gt; Tabs { get; set; }     \n    public DbSet&lt;Question&gt; Questions { get; set; }\n\n\n    protected override void OnModelCreating(DbModelBuilder builder)\n    {\n        builder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n\n        // tab-table\n        builder.Configurations.Add(new TabConfig());\n\n\n        // Qustions\n        builder.Configurations.Add(new ModelConfig.QuestionConfig());\n\n\n        base.OnModelCreating(builder);\n\n    }\n}\n</code></pre>\n\n<p>On my Edit-Form I bind the whole Tab object to a binding Source and I edit some property of the Tab object and I add Questions.</p>\n\n<p>If I save the Tab object the first time everything works fine. But if I edit the tab object I got this error:</p>\n\n<pre><code>Multiplicity constraint violated. The role 'Question_Tab_Target' of the relationship 'Tabmaker.Common.Question_Tab' has multiplicity 1 or 0..1.\n</code></pre>\n\n<p>The code for the Tab business layer is:</p>\n\n<pre><code>public bool SaveTab&lt;T&gt;(ModelContext context, T tab) where T:Tab\n    {\n        try\n        {\n            // add if detached\n            if (tab.ID == 0)\n            {\n                // new tab code\n            }\n\n\n            // attach/set to be modified if id!=0. if tab is not detached, the property \n            // changes were already tracked and nothing need to be done here\n            var state = context.Entry(tab).State;\n            if (state == EntityState.Detached || state == EntityState.Deleted)\n            {\n                context.Entry(tab).State = EntityState.Modified;\n            }\n            context.SaveChanges();\n            return true;\n        }\n        catch (Exception ex)\n        {\n            // Catch\n    return false\n        }\n    }\n</code></pre>\n\n<p>The error occurs if I ask for the state of the tab-entity:</p>\n\n<pre><code>var state = context.Entry(tab).State;\n</code></pre>\n\n<p>I hope I explained everything as good as possible.</p>\n"},{"tags":["c#",".net","asp.net-mvc","entity-framework"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":133,"score":0,"question_id":12913463,"title":"Throw and catch exception in same method","body":"<p>In my method that writes to a database, I handle errors as shown in the code below. In <code>catch (DbUpdateException ex)</code> I want to re-throw the exception and catch it in the last <code>catch (Exception ex)</code>.</p>\n\n<p>Is that possible and how to do that? Code below doesn't do that.</p>\n\n<pre><code>        using (Entities context = new Entities())\n        {\n            try\n            {\n                context.Office.Add(office);\n                retVal = context.SaveChanges();\n            }\n            catch (DbUpdateException ex)\n            {\n                SqlException innerException = ex.GetBaseException() as SqlException;\n                if (innerException != null &amp;&amp; innerException.Number == (int)SQLErrorCode.DUPLICATE_UNIQUE_CONSTRAINT)\n                {\n                    throw\n                        new Exception(\"Error ocurred\");\n                }\n                //This is momenty where exception is thrown.\n                else\n                {\n                    throw ex;\n                }\n            }\n            catch (Exception ex)\n            {\n                throw\n                    new Exception(\"Error\");\n            }\n        }\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":12840428,"title":"MVC Entity Framework Count","body":"<p>I would like to build a result like: <strong>CategoryID || Count(Searches) || CategoryName</strong> based on two Entity Framework based classes:</p>\n\n<pre><code>public class Category\n{\n    // Primary properties\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string SearchPreviewControllerAction { get; set; }\n}\n\npublic class Search\n{\n    // Primary properties\n    public int Id { get; set; }\n    public string SearchTitle { get; set; }\n    public string SearchStandard { get; set; }\n    public int CategoryId { get; set; }\n\n    // Navigation properties\n    public virtual Category Category { get; set; }\n}\n</code></pre>\n\n<p>I already made a SearchPreview method that returns the Searches based on a search like \"Aston Martin\" that will find in all categories with the words \"Aston Martin\".</p>\n\n<p>The challenge now is to build a method that returns, after the Search of the keywords \"Aston Martin\", in which categories there are those keywords including the count, like \"Auto: 2 | Seeling point: 3 | Shop: 2\"</p>\n\n<p>I am trying to avoid a query for each category to count the number of Searches entry, and I would like to find a <em>GroupBy</em> solution, that takes the SearchPreview method already executed and extract the <em>GroupBy</em> Categories that it contains.</p>\n\n<p>I am using the ViewModel <code>SearchPreviewListCategoriesViewModel</code> to map from the models using Automapper:</p>\n\n<pre><code>public class SearchPreviewListCategoriesViewModel\n{\n    public int CategoryID { get; set; }\n    public string Name { get; set; }\n    public string SearchPreviewControllerAction { get; set; }\n    public int SearchCount { get; set; }\n}\n</code></pre>\n\n<p>Hope somoeone can help me on this.</p>\n\n<p>Thank you.</p>\n\n<p>Regards,</p>\n\n<p>Patrick.</p>\n"},{"tags":["asp.net","asp.net-mvc-3","entity-framework","dbcontext","objectcontext"],"answer_count":1,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":1816,"score":5,"question_id":9020809,"title":"Why does Entity Framework automatically use the ObjectContext instead of the DbContext when mapping database tables using ADO.NET Entity datamodel","body":"<p>I am following the database approach first; I have created the tables in my SQL Server 2008 database, then I map those tables to Entity Framework classes using an ADO.NET Entity Data Model. But when I opened the designer.cs file I found the following code in the class definition which was created automatically:</p>\n\n<pre><code>public partial class PortalEntities : ObjectContext\n</code></pre>\n\n<p>so I have the following three question that get my confused:</p>\n\n<ol>\n<li><p>Why does my <code>PortalEntities</code> class derive from <code>ObjectContext</code> and not <code>DbContext</code> as I was expecting?</p></li>\n<li><p>Is there a major difference between <code>ObjectContext</code> &amp; <code>DbContext</code>, or they are mainly the same and offer that same capabilities</p></li>\n<li><p>When I try to write the something similar to the following code:</p>\n\n<pre><code>Student student = db.Students.Find(id);\n</code></pre></li>\n</ol>\n\n<p>I found that I cannot use <code>.Find()</code> method as I used to do using <code>DbContext</code>, so does this mean that <code>ObjectContext</code> &amp; <code>DbContext</code> have different methods that I can use?</p>\n\n<p>BR</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":135,"score":0,"question_id":12904692,"title":"EF 5 Code First Migration Bulk SQL Data Seeding","body":"<p>I am using EF5 with MVC4. The problem is that I have large data in my DB which I already imported from legacy DB. I want to load seed that data when model changes.\nMy question is how can I seed large amount of data that is already in my DB? </p>\n\n<pre><code>internal sealed class Configuration : MigrationsConfiguration&lt;VoiceLab.Models.EFDataContext&gt;\n{\n    public Configuration()\n    {\n        AutomaticMigrationsEnabled = true;\n    }\n\n    protected override void Seed(VoiceLab.Models.EFDataContext context)\n    {\n     //what to do here to seed thousands or records that are already in db\n    }\n\n}\n</code></pre>\n\n<p>thanks,</p>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":2057,"score":7,"question_id":8435462,"title":"Get Auto Identity Key after Insert via EF","body":"<p>Is there a straight forward way of retrieving a DB auto generated primary key when adding a record via Entity Framework 4.1? </p>\n\n<p>For example:</p>\n\n<pre><code>dbcontext.Entity_Tables.Add(new Entity_Table { item1 = val1, item2 = val2 });\ndbcontext.SaveChanges();\nnewPK = ???;\n</code></pre>\n\n<p>The SQL equivalent would be:</p>\n\n<pre><code>newPK = executeOnDB(\"INSERT INTO Entity_Table (item1, item2) VALUES (val1, val2);SELECT @@Indentity\";);\n</code></pre>\n\n<p>BTW I'm using MySQL but the SQL would be the same as on MSSQL</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12909876,"title":"Entity framework repeating records","body":"<p>I am working on an Entity framework project,In which i have created and entity class of a table</p>\n\n<p>and i am returning its records, below is my method of retrieving records</p>\n\n<pre><code> public UserResource GetData(long Id)\n        {\n            try\n            {\n\n                return dataContext.UserResources.Where(r =&gt; r.UserID == Id &amp;&amp; r.Resource.IsActive == true).FirstOrDefault();\n\n\n            }\n            catch (Exception ex)\n            {\n              throw ex;\n            }\n        }\n</code></pre>\n\n<p>and then on controller i am adding it to List</p>\n\n<pre><code>List&lt;UserResource&gt; objlst = new List&lt;UserResource&gt;();\nfor(int i=0;i&lt;100;i++)\n{\nvar data = objResourceRepository.GetData(userIds[i].UserID);\nif (data != null)\nobjlst.Add(data);\n}\n</code></pre>\n\n<p>userIds are coming from a separate Method\nThe problem  i am having is that the data is adding twice ie one record is adding two times, what is the problem with this code and what alternative should i use GetData() method?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":12911235,"title":"EF partial load","body":"<p>Is there any way to implement a partial load of entity(Entity Framework 5.0) without knowing beforehand which properties are needed?\nFor example, I'd like to have something like:</p>\n\n<pre><code>public class Repository&lt;TEntity&gt;\n{\n   public TEntity Get(int id, params Expression&lt;Func&lt;TEntity, object&gt;&gt;[] propertiesToLoad)\n   {\n       ...\n   }\n}\n\nvar user = repositoty.Get(10, u =&gt; u.Id, u =&gt; u.LastName, u =&gt; u.Email);\n</code></pre>\n\n<p>Or could anyone advice how to implement this manually using Expressions?</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12900758,"title":"Entity Framework Code First mapping situation","body":"<p>I'm trying to port an existing application (using pure ADO.Net) to a new one using EF 4.3 Code First. It is worth mentioning that this is the first time I'm using EF.</p>\n\n<p>Basically I have a suppliers table but with two specialization tables with attributes specific to each of the two types of suppliers.</p>\n\n<p>Here is what the existing database looks like:</p>\n\n<pre><code>create table Supplier(\nid_supplier int not null identity\n--Bunch of other attributes\n);\n\ncreate table Individual(\nid_individual int not null --not identity, gets the same value as the Supplier table\n--Attributes specific to individuals\n);\n\nalter table Individual add constraint fk_individual_supplier\nforeign key(id_individual) references Supplier(id_supplier);\n\ncreate table Corporation(\nid_corporation int not null --not identity, gets the same value as the Supplier table\n--Attributes specific to corporations\n);\n\nalter table Corporation add constraint fk_corporation_supplier\nforeign key(id_corporation) references Supplier(id_supplier);\n</code></pre>\n\n<p>So, as the tables show, a supplier can be either an individual or a corporation.</p>\n\n<p>The existing application is like this:</p>\n\n<ul>\n<li>abstract class Supplier with its attributes</li>\n<li>class Individual deriving from Supplier with its additional attributes</li>\n<li>class Corporation deriving from Supplier with its additional attributes</li>\n</ul>\n\n<p>The Ado.Net code currently works receiving Supplier objects, generating records on Individual table if the object passed is of Individual type or Corporation table if the object passed is of Corporation type.</p>\n\n<p>So, every record on Supplier will have a matching one on either Individual or Corporation. Also, Individual and Corporation tables does not have foreign keys to any other table of the database. Instead, the relations are all with the Supplier table. The table generating the ID is Supplier.</p>\n\n<p>How can I map this with Code First?</p>\n\n<p>At first I thought about keeping my structure, I mean, Supplier abstract class and Individual and Corporation deriving from that. Because I need Entity to insert on Supplier table first (generate identity field), it seems that both Individual and Corporation model classes would be mapped to Supplier table.</p>\n\n<p>But how would it be possible for it to receive the abstract class and insert on either one of the specialization tables depending on the type? I don't think this is possible without custom SQL which makes me think my approach is wrong.</p>\n\n<p>Thanks in advance for helping.</p>\n"},{"tags":["asp.net","sql","entity-framework","filestream"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":12910150,"title":"SQL Server 2008 R2 FILESTREAM using ASP.NET & Entity Framework","body":"<p>I have been searching now for 2 days and still struggling! Any advise would be greatly appreciated!</p>\n\n<p>I am busy creating a web app - an online vehicle trader project.</p>\n\n<p>Tech: VS2010, SQL Server 2008 R2, Entity Data Model 4 (EF), SQL Filestream For Images.</p>\n\n<p>I have my filestream setup correctly and can upload and download images (<code>varbinary(MAX)</code>). </p>\n\n<p>My problems/questions are:</p>\n\n<ol>\n<li><p>I have link in a data grid that will download the image. I don't want to download, I need to display the actual image in the grid.</p></li>\n<li><p>All of the above is done using ADO.NET, how can this be integrated into EF? My understanding is that EF does NOT support filestream? Has this changed in EF4?</p></li>\n</ol>\n\n<p>Maybe I have this whole thing backwards?</p>\n\n<p>Any advise, links to examples would be greatly appreciated!</p>\n"},{"tags":["c#","performance","entity-framework","sql-server-2008"],"answer_count":7,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":4379,"score":3,"question_id":3890974,"title":"Entity Framework 4 : Bad performance with SQL Server 2008","body":"<p>I'am developing a software based on Entity Framework to handle data in a MS SQL Server 2008 database.</p>\n\n<p><strong>[Trouble 1]</strong></p>\n\n<p>I've just tried to insert some small data (<strong>about 2 Mb</strong>) from my progam to the database : the performance are very bad ! It takes <strong>more than 1 minute</strong> to insert these datas !</p>\n\n<p>I've try to generate pre-compiled views, I've got the same results :-(</p>\n\n<p>All my code use a business layer (automatically generated from .edmx file with T4 template) to manage data in a service layer. It is very pratical to navigate in the relations of objects.</p>\n\n<p><strong>How can I improve the performance of these inserts with Entity Framework ?</strong></p>\n\n<p><strong>[Trouble 2]</strong></p>\n\n<p>Also, before inserting data in database with SaveChanges() method, I fill my object context with AddObject() method. I add about 100 000 small objects (about 2 Mb) to my object context with AddObject() : it takes a very long time (more than 10 minutes) !</p>\n\n<p><strong>How can I decrease this time ?</strong></p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>My program must save more than 50 Mb in database in less than 2-3 minutes ? Do you think it will be possible with EF ?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2266,"score":1,"question_id":7172725,"title":"Copy Entity Framework Object","body":"<p>I have a EF4.1 class X and I want to make copy of that plus all its child records.\nX.Y and X.Y.Z</p>\n\n<p>Now if I do the following it returns error.</p>\n\n<p>The property 'X.ID' is part of the object's key information and cannot be modified.</p>\n\n<pre><code>public void CopyX(long ID)\n{\n    var c = db.Xs.Include(\"Y\").Include(\"W\").Include(\"Y.Z\").SingleOrDefault(x =&gt; x.ID == ID);\n    if (c != null)\n    {\n        c.ID = 0;\n        c.Title = \"Copy Of \" + c.Title;\n        for (var m = 0; m &lt; c.Ys.Count; m++)\n        {\n            c.Ys[m].ID = 0;\n            c.Ys[m].XID=0-m;\n            for (var p = 0; p &lt; c.Ys[m].Zs.Count; p++)\n            {\n                c.Ys[m].Zs[p].XID = 0 - m;\n                c.Ys[m].Zs[p].ID = 0 - p;\n            }\n        }\n        for (var i = 0; i &lt; c.Ws.Count; i++)\n        {\n            c.Ws[i].ID = 0 - i;\n            c.Ws[i].XID = 0;\n        }\n        db.Entry&lt;Content&gt;(c).State = System.Data.EntityState.Added;\n        db.SaveChanges();\n    }\n}\n</code></pre>\n\n<p>Or Is there other way of making copy of entity objects. </p>\n\n<p>NOTE: there are multiple properties in each W,X,Y,Z.</p>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12907703,"title":"How to load a previous build of EntityFramework Version 4.4.0.0 once 5.0.0.0 is installed with NuGet","body":"<p>I have been working on this MVC3 project for months, and was trying to convert some tables that were used for listing values in a Form dropdown list into classes that were not mapped as tables. For some unknown reason I start getting this error using VS2012 Express \"Could not load file or assembly 'EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies\".  </p>\n\n<p>I tried to remove the EntityFramework reference, and than add it back with NewGet but the version offered through NewGet is 5.0.0.0. </p>\n\n<p>My question is how to reference the correct EntityFramework build 4.4.0.0 through NewGet when it only offers version 5.0.0.0?</p>\n"},{"tags":["c#",".net","sql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":110,"score":3,"question_id":12907509,"title":"entity framework not working on table without identity column","body":"<p>I have the following table:</p>\n\n<pre><code>create table tbl\n(\n    id int identity(1,1),\n    val varchar(100)\n)\n</code></pre>\n\n<p>Now when i use Entity Framework to map objects to this table, it works, however when i change the table definition as follows:</p>\n\n<pre><code>create table tbl1\n(\n    id int,\n    val varchar(100)\n)\n</code></pre>\n\n<p>Entity Framework does not maps objects to this table. Any clue as to why is this happening would be appreciated.</p>\n"},{"tags":["c#","sql-server","entity-framework","varbinary"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":107,"score":4,"question_id":12904416,"title":"If I Query a SQL Server VarBinary(MAX) Column, Will the Entire File be Loaded In Memory?","body":"<p>My application is using SQL Server 2008 and we need to add functionality for users to optionally be able to save any file of any size to a database table. I have set up the table similar to this format:</p>\n\n<ul>\n<li>FileStorageID - <code>int (indentity PK)</code> (This is also a foreign key to a different table)</li>\n<li>FileData - <code>varbinary(max)</code></li>\n<li>FileName - <code>varchar(1000)</code></li>\n</ul>\n\n<p>The <code>FileStorage</code> table has a zero-to-one relationship to another table <code>Documentation</code>. The idea is that users can write either write some text, upload a file, or both. </p>\n\n<p>This table looks as follows:</p>\n\n<ul>\n<li>DocumentationID - <code>int (identity PK</code>, FK to an \"IrrelevantInterestingObject\" table)</li>\n<li>Text - <code>varchar(max)</code></li>\n<li>FileStorageID - <code>int (FK</code> to aforementioned FileStorage table)</li>\n</ul>\n\n<p>My question is this: When I query the <code>Documentation</code> table using Entity Framework 5, and a file is present in the database, will the entire file be stored in memory? If yes, what would a reasonable threshold be before there is a noticeable performance issue?</p>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12904378,"title":"Does Entity Framework currently support custom functions in the Where clause?","body":"<p>Entity Framework currently supports table valued functions and custom functions defined in the SSDL, but I can't find any example of it being used as a criteria, in the <code>where</code> clause.</p>\n\n<p>Example:</p>\n\n<pre><code>var query = this.db.People;\nquery = query.Where(p =&gt; FullText.ContainsInName(p.Id, \"George\"));\n</code></pre>\n\n<p>In this example, <code>ContainsInName</code> is my custom function that I want to be executed in the <code>where</code> clause of the query.</p>\n\n<p>Is it supported?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12906601,"title":"Rollback transactions made by two different DBContext saves when an exception occurs","body":"<p>I need to save to two different databases after some user action. Currently, I have the following:</p>\n\n<pre><code>using (EFEntities1 dc = new EFEntities1())\n{\n     dc.USERS.Add(user);\n     dc.SaveChanges();\n}\n\nusing (EFEntities2 dc = new EFEntities2())\n{\n     dc.USERS.Add(user);\n     dc.SaveChanges();\n}\n</code></pre>\n\n<p>These are two separate code blocks within the same method, so I believe if the second one fails, the first one won't rollback. How do I make sure both transactions rollback if something fails?</p>\n"},{"tags":["c#","entity-framework","stored-procedures","entity-framework-4.1","fluent-interface"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1005,"score":3,"question_id":6297657,"title":"EF4.1 - Fluent API - SqlQuery - configuration mappings when calling sproc - Data reader is incompatible with specified entity type","body":"<p>The scenario - legacy application with 10 year history, has always used procedure calls for all data access - needs to be overhauled from a hybrid classic ASP and .NET set of pages.</p>\n\n<p>The goal - migrate to .NET 4.0 using EF 4.1 with Fluent API and continue using existing database sprocs as much as possible.</p>\n\n<p>Key classes:</p>\n\n<pre><code>public class EntityBase\n{\n    public int Id { get; set; }\n}\n\npublic class User : EntityBase\n{\n    public string UserName { get; set; }\n...\n}\n</code></pre>\n\n<p>Configurations:</p>\n\n<pre><code>internal class ConfigurationBase&lt;T&gt; : EntityTypeConfiguration&lt;T&gt; where T : EntityBase\n{\n    protected ConfigurationBase()\n    {\n        HasKey(t =&gt; t.Id);\n    }\n}\n\ninternal class UserConfiguration : ConfigurationBase&lt;User&gt;\n{\n    internal UserConfiguration()\n    {\n        Property(p =&gt; p.Id)\n            .HasColumnName(\"Person_Id\")\n        .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity)\n            .IsRequired();\n        Property(p =&gt; p.UserName)\n            .HasMaxLength(64);\n        ToTable(\"Person\");\n    }\n}\n</code></pre>\n\n<p>The context is all set up in DbContext.OnModelCreating as:</p>\n\n<pre><code>    public DbSet&lt;User&gt; Users { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new UserConfiguration());\n    }\n</code></pre>\n\n<p>And all is fine when I access the data directly via the context eg:</p>\n\n<pre><code>    public override IQueryable&lt;User&gt; GetAll()\n    {\n        return UnitOfWork.Context.Users;\n    }\n</code></pre>\n\n<p>But when I attempt to use an existing sproc which contains the following:</p>\n\n<pre><code>SELECT  p.Person_Id,\n        p.IsUser,\n        p.FirstName,\n        p.LastName,\n        p.UserName,\n        p.Email,\n        p.CreatedBy,\n        p.CreatedDate,\n        p.IsActive,\n        p.ModifiedBy,\n        p.ModifiedDate\nFROM    Person p \nWHERE   p.UserName = @UserName\nAND     p.IsActive = 1\n</code></pre>\n\n<p>I execute the following:</p>\n\n<pre><code>    public User AuthorizeUser(string userName)\n    {\n        SqlParameter p = new SqlParameter { \n            DbType = DbType.String,\n            ParameterName = \"UserName\",\n            Size = 64,\n            Value = userName\n        };\n        object[] parameters = new object[] {p};\n\n        return UnitOfWork.Context.Users.SqlQuery(CPODSStoredProcedures.User_AuthorizeUser, parameters).FirstOrDefault();\n    }\n</code></pre>\n\n<p>And I get:\nThe data reader is incompatible with the specified 'User'. A member of the type, 'Id', does not have a corresponding column in the data reader with the same name.</p>\n\n<p>I have traced the execution and the configurations are being read, so am I doing something wrong, or is the sproc execution by SqlQuery not paying attention to how the base Id is remapped to Person_Id in this case.</p>\n\n<p>Thanks in advance!\nG</p>\n"},{"tags":["c#","entity-framework","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12902766,"title":"Working with generic model Problems with missing references on visual studio 2012 entity framework","body":"<p>EntityFramework\nruntime v4.0.30319\nversion 5.0.0.0</p>\n\n<pre><code>public abstract class AbstractPessoaFisicaDao&lt;T&gt;:IBasePessoaFisicaDao&lt;T&gt; where T: class\n{\n\n    SupremaDesEntities entidades = new SupremaDesEntities();\n    Cadastro_PessoaFisica Pessoa = new Cadastro_PessoaFisica();\n\n    public void Add(T pEntity)\n    {\n        entidades.Cadastro_PessoaFisica.AddObject();\n    }\n</code></pre>\n\n<p>Error   1   'System.Data.Entity.DbSet' does not contain a definition for 'AddObject' and no extension method 'AddObject' accepting a first argument of type 'System.Data.Entity.DbSet' could be found (are you missing a using directive or an assembly reference?) c:\\users\\msbow\\documents\\visual studio 2012\\Projects\\Inside.Net.EF\\Inside.Net.EF.Data\\AbstractPessoaFisicaDao.cs    26  45  Inside.Net.EF.Data</p>\n\n<p>I was studying this in visual studio 2010, I now have the ultimate version 2012 and can not adjust this reference, already downloaded the framework and several dlls nothing.</p>\n"},{"tags":["entity-framework","poco","model-associations"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12905864,"title":"Entities POCO with EF, creating relationship with POCO","body":"<p><p>Hi good day&nbsp;</p><p>I hope you can help me, then I explain my problem:</p><p>These are my entities:</p><p>http://i.stack.imgur.com/OjZmX.jpg</p><p></p><p>I need to create with POCO such relationships for example resultadobusquedaofac with SDN, For this I use the POCO templates</p><p>http://i.stack.imgur.com/qYbzy.jpg<br /></p><p>then I myself believe partnerships within these entities: </p><p>ResultadoBusquedaOfac</p></p>\n\n<pre><code>public partial class ResultadoBusquedaOfac\n{\n    #region Primitive Properties\n\n    public virtual int ent_num\n    {\n        get;\n        set;\n    }\n\n    public virtual string SDN_Name\n    {\n        get;\n        set;\n    }\n\n    public virtual int KeyCliente\n    {\n        get;\n        set;\n    }\n\n    public virtual string HayCoincidencia\n    {\n        get;\n        set;\n    }\n\n    public virtual string HayCoincidenciaAlias\n    {\n        get;\n        set;\n    }\n\n    #endregion\n\n    public virtual ICollection&amp;lt;OFAC_SDN&amp;gt; OFAC_SDN\n    {\n        get\n        {\n            if (_oFAC_SDN == null)\n            {\n                var newCollection = new FixupCollection&amp;lt;OFAC_SDN&amp;gt;();\n                newCollection.CollectionChanged += FixupOFAC_SDN;\n                _oFAC_SDN = newCollection;\n            }\n            return _oFAC_SDN;\n        }\n        set\n        {\n            if (!ReferenceEquals(_oFAC_SDN, value))\n            {\n                var previousValue = _oFAC_SDN as FixupCollection&amp;lt;OFAC_SDN&amp;gt;;\n                if (previousValue != null)\n                {\n                    previousValue.CollectionChanged -= FixupOFAC_SDN;\n                }\n                _oFAC_SDN = value;\n                var newValue = value as FixupCollection&amp;lt;OFAC_SDN&amp;gt;;\n                if (newValue != null)\n                {\n                    newValue.CollectionChanged += FixupOFAC_SDN;\n                }\n            }\n        }\n    }\n    private ICollection&amp;lt;OFAC_SDN&amp;gt; _oFAC_SDN;&lt;/em&gt;&lt;/strong&gt;\n\n\n    private void FixupOFAC_SDN(object sender, NotifyCollectionChangedEventArgs e)\n    {\n        if (e.NewItems != null)\n        {\n            foreach (OFAC_SDN item in e.NewItems)\n            {\n                item.ResultadoBusquedaOfac = this;\n            }\n        }\n\n        if (e.OldItems != null)\n        {\n            foreach (OFAC_SDN item in e.OldItems)\n            {\n                if (ReferenceEquals(item.ResultadoBusquedaOfac, this))\n                {\n                    item.ResultadoBusquedaOfac = null;\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>}OFAC_SDN<br /><p></p></p>\n\n<pre><code>public partial class OFAC_SDN\n{\n    #region Primitive Properties\n\n   &lt;strong&gt;&lt;em&gt; public virtual Nullable&amp;lt;int&amp;gt; id_Ofac\n    {\n        get { return _id_Ofac; }\n        set\n        {\n            try\n            {\n                _settingFK = true;\n                if (_id_Ofac != value)\n                {\n                    if (ResultadoBusquedaOfac != null &amp;amp;&amp;amp; ResultadoBusquedaOfac.ent_num != value)\n                    {\n                        ResultadoBusquedaOfac = null;\n                    }\n                    _id_Ofac = value;\n                }\n            }\n            finally\n            {\n                _settingFK = false;\n            }\n        }\n    }\n    private Nullable&amp;lt;int&amp;gt; _id_Ofac;&lt;/em&gt;&lt;/strong&gt;\n\n    public virtual int ent_num\n    {\n        get;\n        set;\n    }\n\n    public virtual string SDN_Name\n    {\n        get;\n        set;\n    }\n\n    public virtual string SDN_Type\n    {\n        get;\n        set;\n    }\n\n    public virtual string Program\n    {\n        get;\n        set;\n    }\n\n    public virtual string Title\n    {\n        get;\n        set;\n    }\n\n    public virtual string Call_Sign\n    {\n        get;\n        set;\n    }\n\n    public virtual string Vess_type\n    {\n        get;\n        set;\n    }\n\n    public virtual string Tonnage\n    {\n        get;\n        set;\n    }\n\n    public virtual string GRT\n    {\n        get;\n        set;\n    }\n\n    public virtual string Vess_flag\n    {\n        get;\n        set;\n    }\n\n    public virtual string Vess_owner\n    {\n        get;\n        set;\n    }\n\n    public virtual string Remarks\n    {\n        get;\n        set;\n    }\n\n    #endregion\n    #region Navigation Properties\n\n    public virtual ResultadoBusquedaOfac ResultadoBusquedaOfac\n    {\n        get { return _resultadoBusquedaOfac; }\n        set\n        {\n            if (!ReferenceEquals(_resultadoBusquedaOfac, value))\n            {\n                var previousValue = _resultadoBusquedaOfac;\n                _resultadoBusquedaOfac = value;\n                FixupResultadoBusquedaOfac(previousValue);\n            }\n        }\n    }\n    private ResultadoBusquedaOfac _resultadoBusquedaOfac;&lt;/em&gt;&lt;/strong&gt;\n\n    public virtual ICollection&amp;lt;OFAC_ADD&amp;gt; OFAC_ADD\n    {\n        get\n        {\n            if (_oFAC_ADD == null)\n            {\n                var newCollection = new FixupCollection&amp;lt;OFAC_ADD&amp;gt;();\n                newCollection.CollectionChanged += FixupOFAC_ADD;\n                _oFAC_ADD = newCollection;\n            }\n            return _oFAC_ADD;\n        }\n        set\n        {\n            if (!ReferenceEquals(_oFAC_ADD, value))\n            {\n                var previousValue = _oFAC_ADD as FixupCollection&amp;lt;OFAC_ADD&amp;gt;;\n                if (previousValue != null)\n                {\n                    previousValue.CollectionChanged -= FixupOFAC_ADD;\n                }\n                _oFAC_ADD = value;\n                var newValue = value as FixupCollection&amp;lt;OFAC_ADD&amp;gt;;\n                if (newValue != null)\n                {\n                    newValue.CollectionChanged += FixupOFAC_ADD;\n                }\n            }\n        }\n    }\n    private ICollection&amp;lt;OFAC_ADD&amp;gt; _oFAC_ADD;\n\n    public virtual ICollection&amp;lt;OFAC_ALT&amp;gt; OFAC_ALT\n    {\n        get\n        {\n            if (_oFAC_ALT == null)\n            {\n                var newCollection = new FixupCollection&amp;lt;OFAC_ALT&amp;gt;();\n                newCollection.CollectionChanged += FixupOFAC_ALT;\n                _oFAC_ALT = newCollection;\n            }\n            return _oFAC_ALT;\n        }\n        set\n        {\n            if (!ReferenceEquals(_oFAC_ALT, value))\n            {\n                var previousValue = _oFAC_ALT as FixupCollection&amp;lt;OFAC_ALT&amp;gt;;\n                if (previousValue != null)\n                {\n                    previousValue.CollectionChanged -= FixupOFAC_ALT;\n                }\n                _oFAC_ALT = value;\n                var newValue = value as FixupCollection&amp;lt;OFAC_ALT&amp;gt;;\n                if (newValue != null)\n                {\n                    newValue.CollectionChanged += FixupOFAC_ALT;\n                }\n            }\n        }\n    }\n    private ICollection&amp;lt;OFAC_ALT&amp;gt; _oFAC_ALT;\n\n    #endregion\n\n    #region Association Fixup\n\n    private bool _settingFK;\n\n    private void FixupResultadoBusquedaOfac(ResultadoBusquedaOfac previousValue)\n    {\n        if (previousValue != null &amp;amp;&amp;amp; previousValue.OFAC_SDN.Contains(this))\n        {\n            previousValue.OFAC_SDN.Remove(this);\n        }\n\n        if (ResultadoBusquedaOfac != null)\n        {\n            if (!ResultadoBusquedaOfac.OFAC_SDN.Contains(this))\n            {\n                ResultadoBusquedaOfac.OFAC_SDN.Add(this);\n            }\n            if (id_Ofac != ResultadoBusquedaOfac.ent_num)\n            {\n                id_Ofac = ResultadoBusquedaOfac.ent_num;\n            }\n        }\n        else if (!_settingFK)\n        {\n            id_Ofac = null;\n        }\n     }\n\n    private void FixupOFAC_ADD(object sender, NotifyCollectionChangedEventArgs e)\n    {\n        if (e.NewItems != null)\n        {\n            foreach (OFAC_ADD item in e.NewItems)\n            {\n                item.OFAC_SDN = this;\n            }\n        }\n\n        if (e.OldItems != null)\n        {\n            foreach (OFAC_ADD item in e.OldItems)\n            {\n                if (ReferenceEquals(item.OFAC_SDN, this))\n                {\n                    item.OFAC_SDN = null;\n                }\n            }\n        }\n    }\n\n    private void FixupOFAC_ALT(object sender, NotifyCollectionChangedEventArgs e)\n    {\n        if (e.NewItems != null)\n        {\n            foreach (OFAC_ALT item in e.NewItems)\n            {\n                item.OFAC_SDN = this;\n            }\n        }\n\n        if (e.OldItems != null)\n        {\n            foreach (OFAC_ALT item in e.OldItems)\n            {\n                if (ReferenceEquals(item.OFAC_SDN, this))\n                {\n                    item.OFAC_SDN = null;\n                }\n            }\n        }\n    }\n\n    #endregion\n}\n</code></pre>\n\n<p>}<br /><p>Now when I run the test query:</p><p></p>\n    public partial class Form1 : Form\n    {\n        public Form1()\n        {\n            InitializeComponent();</p>\n\n<pre><code>        LegitimacionEntities context = new LegitimacionEntities();\n        var query = context.ResultadoBusquedaOfac.Include(\"OFAC_SDN\").Where(us =&amp;gt; us.ent_num.Equals(10)).First();\n\n        MessageBox.Show(query.SDN_Name);\n    }\n}\n</code></pre>\n\n<p>}<br /><p>throws me the following error:&nbsp;</p><p>A specified Include path is not valid. The EntityType 'LegitimacionModel.ResultadoBusquedaOfac' does not declare a navigation property with the name 'OFAC_SDN'.</p><p>And in addition to this then I have to pass the data by dataservice or WCF, right now I'm doing so to prove first that the relations are well before passing it to the above.</p><p>Many thanks in advance and I welcome your comments...</p><p>happy days</p><br /><br /></p>\n"},{"tags":["c#",".net","asp.net-mvc","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":93,"score":3,"question_id":12851199,"title":"Entity Framework: Check all relationships of an entity for foreign key use","body":"<p>I have an entity, let's call it <code>CommonEntity</code> that has a primary key used as a foreign key in many other entities. As the application is developed these links will continue to grow.</p>\n\n<p>I'd like a way to see if <code>CommonEntity</code> can be safely deleted (i.e. it's not used by any other entities).</p>\n\n<p>I realise I can do</p>\n\n<pre><code>if(!ce.EntityA.Any() &amp;&amp; !ce.EntityB.Any() ... &amp;&amp; !ce.EntityN.Any())\n{\n   //Delete\n}\n</code></pre>\n\n<p>but I'm hoping for a way to just check all of the relationships automatically, as I don't love the idea of having to come back and change this code manually every time we add a new relationship. Perhaps there is something in EF4+ that I'm not aware of?</p>\n\n<p>I thought it might be possible to use a transaction scope to just try and delete the object and roll it back if it fails, but I wasn't sure if there were any adverse side effects with this approach.</p>\n\n<p>Is there a better approach?</p>\n\n<p><strong>EDIT:</strong> Looks like VS2012 has used EF5 even though the project is .Net 4, so it has created the model with POCOs even though it was generated from a DB.</p>\n"},{"tags":[".net","asp.net-mvc-3","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12900829,"title":"Mapping built-in UserProfile to UserProfileId column in table","body":"<p>I have a table Tale with definition</p>\n\n<pre><code>public class Tale\n{\n    public int Id { get; set; }\n    public string Title { get; set; }\n    public string Text { get; set; }\n    public DateTime ReleaseDate { get; set; }\n\n    public int enum_TaleAuthorTypeId { get; set; }\n    public virtual enum_TaleAuthorType enum_TaleAuthorType { get; set; }\n\n    public int CommentableId { get; set; }\n    public virtual Commentable Commentable { get; set; }\n}\n</code></pre>\n\n<p>and when i type 'update-database' in console, i have nice relationships with one column for CommentableId and one for enum_TaleAuthorTypeId.</p>\n\n<p>Now, i'd like to add UserProfile and try to type something like:</p>\n\n<pre><code>public int UserProfileId { get; set; }\npublic virtual UserProfile UserProfile { get; set; }\n</code></pre>\n\n<p>but after add-migration, i have this:</p>\n\n<pre><code>AddColumn(\"dbo.Tales\", \"UserProfileId\", c =&gt; c.Int(nullable: false));\nAddColumn(\"dbo.Tales\", \"UserProfile_UserId\", c =&gt; c.Int());\n</code></pre>\n\n<p>How should i get just one column for value? Why it's create two columns?</p>\n"},{"tags":["c#","sql-server","entity-framework","orm","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":12,"down_vote_count":1,"view_count":135,"score":11,"question_id":12898790,"title":"CodeFirst loading 1 parent linked to 25 000 children is slow","body":"<p>I searched a lot on my performance problem and tried all sorts of different things, but I just can't seem to get it to work fast enough.  Here's my problem to it's simplest form:</p>\n\n<p>I'm using entity framework 5 and I want to be able to lazy load child instances of a parent when the user selects that parent, so I don't have to pull the entire database.  However I have been having performance problems with lazy loading the children.  I think the problem is the wire up of the navigation properties between the Parent and the children.  I'm also thinking it must be something I did wrong because I believe this is a simple case.</p>\n\n<p>So I put up a program to test a single lazy load to isolate the problem.</p>\n\n<p>Here's the Test:</p>\n\n<p>I created a POCO Parent class and a Child POCO Class.  Parent has n Children and Child has 1 Parent.  There's only 1 parent in the SQL Server database and 25 000 children for that single parent.  I tried different methods to load this data.  Whenever I load either the children and the parent in the same DbContext, it takes a really long time.  But if I load them in different DbContexts, it loads really fast.  However, I want those instances to be in the same DbContext.</p>\n\n<p><strong>Here is my test setup and everything you need to replicate it:</strong></p>\n\n<p><strong>POCOs:</strong></p>\n\n<pre><code>public class Parent\n{\n    public int ParentId { get; set; }\n\n    public string Name { get; set; }\n\n    public virtual List&lt;Child&gt; Childs { get; set; }\n}\n\npublic class Child\n{\n    public int ChildId { get; set; }\n\n    public int ParentId { get; set; }\n\n    public string Name { get; set; }\n\n    public virtual Parent Parent { get; set; }\n}\n</code></pre>\n\n<p><strong>DbContext:</strong></p>\n\n<pre><code>public class Entities : DbContext\n{\n    public DbSet&lt;Parent&gt; Parents { get; set; }\n\n    public DbSet&lt;Child&gt; Childs { get; set; }\n}\n</code></pre>\n\n<p><strong>TSQL Script to create the Database and data:</strong></p>\n\n<pre><code>USE [master]\nGO\n\nIF EXISTS(SELECT name FROM sys.databases\n    WHERE name = 'PerformanceParentChild')\n    alter database [PerformanceParentChild] set single_user with rollback immediate\n    DROP DATABASE [PerformanceParentChild]\nGO\n\nCREATE DATABASE [PerformanceParentChild]\nGO\nUSE [PerformanceParentChild]\nGO\nBEGIN TRAN T1;\nSET NOCOUNT ON\n\nCREATE TABLE [dbo].[Parents]\n(\n    [ParentId] [int] CONSTRAINT PK_Parents PRIMARY KEY,\n    [Name] [nvarchar](200) NULL\n)\nGO\n\nCREATE TABLE [dbo].[Children]\n(\n    [ChildId] [int] CONSTRAINT PK_Children PRIMARY KEY,\n    [ParentId] [int] NOT NULL,\n    [Name] [nvarchar](200) NULL\n)\nGO\n\nINSERT INTO Parents (ParentId, Name)\nVALUES (1, 'Parent')\n\nDECLARE @nbChildren int;\nDECLARE @childId int;\n\nSET @nbChildren = 25000;\nSET @childId = 0;\n\nWHILE @childId &lt; @nbChildren\nBEGIN\n   SET @childId = @childId + 1;\n   INSERT INTO [dbo].[Children] (ChildId, ParentId, Name)\n   VALUES (@childId, 1, 'Child #' + convert(nvarchar(5), @childId))\nEND\n\nCREATE NONCLUSTERED INDEX [IX_ParentId] ON [dbo].[Children] \n(\n    [ParentId] ASC\n)\nGO\n\nALTER TABLE [dbo].[Children] ADD CONSTRAINT [FK_Children.Parents_ParentId] FOREIGN KEY([ParentId])\nREFERENCES [dbo].[Parents] ([ParentId])\nGO\n\nCOMMIT TRAN T1;\n</code></pre>\n\n<p><strong>App.config containing the connection string:</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;connectionStrings&gt;\n    &lt;add\n      name=\"Entities\"\n      providerName=\"System.Data.SqlClient\"\n      connectionString=\"Server=localhost;Database=PerformanceParentChild;Trusted_Connection=true;\"/&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p><strong>Test console class:</strong></p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        List&lt;Parent&gt; parents;\n        List&lt;Child&gt; children;\n\n        Entities entities;\n        DateTime before;\n        TimeSpan childrenLoadElapsed;\n        TimeSpan parentLoadElapsed;\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            parents = entities.Parents.ToList();\n            parentLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load only the parent from DbSet:\" + parentLoadElapsed.TotalSeconds + \" seconds\");\n        }\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            children = entities.Childs.ToList();\n            childrenLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load only the children from DbSet:\" + childrenLoadElapsed.TotalSeconds + \" seconds\");\n        }\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            parents = entities.Parents.ToList();\n            parentLoadElapsed = DateTime.Now - before;\n\n            before = DateTime.Now;\n            children = entities.Childs.ToList();\n            childrenLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load the parent from DbSet:\" + parentLoadElapsed.TotalSeconds + \" seconds\" +\n                                               \", then load the children from DbSet:\" + childrenLoadElapsed.TotalSeconds + \" seconds\");\n        }\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            children = entities.Childs.ToList();\n            childrenLoadElapsed = DateTime.Now - before;\n\n            before = DateTime.Now;\n            parents = entities.Parents.ToList();\n            parentLoadElapsed = DateTime.Now - before;\n\n\n            System.Diagnostics.Debug.WriteLine(\"Load the children from DbSet:\" + childrenLoadElapsed.TotalSeconds + \" seconds\" +\n                                               \", then load the parent from DbSet:\" + parentLoadElapsed.TotalSeconds + \" seconds\");\n        }\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            parents = entities.Parents.ToList();\n            parentLoadElapsed = DateTime.Now - before;\n\n            before = DateTime.Now;\n            children = parents[0].Childs;\n            childrenLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load the parent from DbSet:\" + parentLoadElapsed.TotalSeconds + \" seconds\" +\n                                               \", then load the children from Parent's lazy loaded navigation property:\" + childrenLoadElapsed.TotalSeconds + \" seconds\");\n        }\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            parents = entities.Parents.Include(p =&gt; p.Childs).ToList();\n            parentLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load the parent from DbSet and children from include:\" + parentLoadElapsed.TotalSeconds + \" seconds\");\n\n        }\n\n        using (entities = new Entities())\n        {\n            entities.Configuration.ProxyCreationEnabled = false;\n            entities.Configuration.AutoDetectChangesEnabled = false;\n            entities.Configuration.LazyLoadingEnabled = false;\n            entities.Configuration.ValidateOnSaveEnabled = false;\n\n            before = DateTime.Now;\n            parents = entities.Parents.Include(p =&gt; p.Childs).ToList();\n            parentLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load the parent from DbSet and children from include:\" + parentLoadElapsed.TotalSeconds + \" seconds with everything turned off\");\n\n        }\n\n    }\n}\n</code></pre>\n\n<p><strong>Here are the results of those test:</strong></p>\n\n<p>Load only the parent from DbSet:0,972 seconds</p>\n\n<p>Load only the children from DbSet:0,714 seconds</p>\n\n<p>Load the parent from DbSet:0,001 seconds, then load the children from DbSet:8,6026 seconds</p>\n\n<p>Load the children from DbSet:0,6864 seconds, then load the parent from DbSet:7,5816159 seconds</p>\n\n<p>Load the parent from DbSet:0 seconds, then load the children from Parent's lazy loaded navigation property:8,5644549 seconds</p>\n\n<p>Load the parent from DbSet and children from include:8,6428788 seconds</p>\n\n<p>Load the parent from DbSet and children from include:9,1416586 seconds with everything turned off</p>\n\n<p><strong>Analysis</strong></p>\n\n<p>Whenever the parent and the children are in the same DbContext, it takes a long time (9 seconds) to wire everything up.  I even tried turning off everything from proxy creation to lazy loading, but to no avail.  Can someone please help me ?</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12904056,"title":"Entity Framework - TPH Query Issue","body":"<p>I have  model that looks something like this:</p>\n\n<pre><code>public abstract class Parent {}\n\npublic class Child1 : Parent {}\n\npublic class Child2 : Parent {}\n\npublic class SomeEntity \n{\n    public virtual Parent SomeParent { get; set; }\n}\n</code></pre>\n\n<p>I'd like to query the SomeEntity class and filter by the ones where SomeParent is a Child1.  I tried to write the following Linq query:</p>\n\n<pre><code>dbContext.Set&lt;SomeEntity&gt;().Where(s =&gt; s.SomeParent is Child1)\n</code></pre>\n\n<p>When i run this query, I get the following error:</p>\n\n<p>error 3032: Problem in mapping fragments starting at line 64:Condition member 'Parent.DiscriminatorColumn' with a condition other than 'IsNull=False' is mapped. Either remove the condition on Parent.DiscriminatorColumn or remove it from the mapping.</p>\n\n<p>Am I doing something wrong? Is this supposed to work?</p>\n"},{"tags":["asp.net","linq","entity-framework","entity"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":101,"score":2,"question_id":12901377,"title":"EntityFunction.TruncateTime not working in my query","body":"<p>I am using Linq to entityframework to query some infomration. I am trying to use entityfunction.truncatetime and it doesnt seem to work as expected. here is my sample query</p>\n\n<pre><code>From d In Request\nWhere d.Requestor= \"XXXX\" And d.ProcessedFlag = \"N\"\nSelect d.RequestID, RequestReason = d.RequestReason.ItemValue, RequestType =  d.RequestType.ItemValue, RequestedDate = EntityFunctions.TruncateTime(d.RequestedMoveDate)\n</code></pre>\n\n<p>The requesteddate doesnt seem to truncate the time part and I am still getting the both Date and time.</p>\n\n<p>Am I missing something here?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12903350,"title":"EF Code First different solutions/projects same database","body":"<p>I have 2 different MVC solutions (web apps) that are using Code First. The target for both these apps is the same database. When I started on my second app I initially got some errors about not being able to apply changes to the database (don't remember exactly what they were). I finally managed to just generate the script</p>\n\n<pre><code>update-database -Script\n</code></pre>\n\n<p>and ran it on the database and it worked. But what i did not realize for about a week is that my other app that uses Code first and talks to the same database but different tables stopped working. When i tried to compile it to debug the issue i got and error which pretty much meant the following:\n<strong>The backing context has changed and these changes need to be pushed to the database (update-database)</strong>\nbut when i try to update the database, it fails saying there are no migrations. </p>\n\n<p>Both my apps are MVC3 apps targeting .Net 4.0 in Visual Studio 2012.</p>\n\n<p>Any tips on how to fix this situation?</p>\n"},{"tags":["oracle","entity-framework","c#-4.0","pagination"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12902943,"title":"Oracle paging in Entity Framework returning different sets of records than intentionally","body":"<p>I thought I understood LINQ or did I, or it could be a nasty Oracle provider bug?</p>\n\n<p>Got a very frustrating situation where I want to implement paging in a knockout app.  Using Troy Goode's PagedList Mvc library, I can see where the code was transformed from a search returning two items into a 15 items result (I had set paging to be 15 items per).  Worked perfectly fine in SQL Server 2005/2008, but not so using Oracle.DataAccess.dll v11.2.3/v4.112.3 (depending how the version number gets read).</p>\n\n<p>I did the search result in Linq like thus:</p>\n\n<pre><code>var entities = _context.Entities;\n\nvar q = !string.IsNullOrEmpty(search)\n                        ? entities\n                            .Where(a =&gt; a.PRODUCT_NUM.ToUpper().Contains(search.ToUpper())\n                                     || a.PRINT_NAME.ToUpper().Contains(search.ToUpper()))\n                        : entities;   \n\nvar result = q.OrderBy(e =&gt; e.UPDATE_DATE == null)\n                             .ThenByDescending(e =&gt; e.UPDATE_DATE)\n                             .Select(r =&gt; new EntityModel\n                             {\n                                 Id = r.ID,\n                                 Num = r.PRODUCT_NUM,\n                                 Name = r.PRINT_NAME,\n                                 City = r.City.PRINT_NAME,\n                                 State = r.City.State.PRINT_NAME,\n                                 EntityType = r.ENTITY_TYPE,\n                                 CompanyType = r.COMPANY_TYPE,\n                                 UpdateDate = r.UPDATE_DATE\n                             })\n                             .ToPagedList(pageNumber, 15);\n</code></pre>\n\n<p>Now at this point, using the Immediate Window, I can have it return 2 items, however when it goes through the paging process, it comes back with 15 items. </p>\n\n<p>First thought, am I having an caching problem or something?  But delved into the PagedList library. <a href=\"https://github.com/TroyGoode/PagedList\" rel=\"nofollow\">https://github.com/TroyGoode/PagedList</a></p>\n\n<p>Let's look at the object passed thru to the PagedList and I'll show you the number of records returned. Inside the PagedList, the IQueryable object is called superset and returns a List eventually, but check out what I'm getting when I query the list via Immediate Window.  I just figured it'd be the best way to show you...</p>\n\n<pre><code>?superset.Take(pageSize).Count()\n2\n?superset.Count()\n51114\n?superset.Skip(0).Take(pageSize).Count()\n2\n?superset.ToList().Count()\n2\n?superset.Skip(0).Take(pageSize).ToList().Count()\n15\n?superset.Take(pageSize).ToList().Count()\n15\n</code></pre>\n\n<p>What's most interesting to me is that when we do a ToList(), it returns 15 records.  Is it an Oracle ODP.NET provider problem?  I fired up Ayende's Entity Framework Provider <a href=\"http://efprof.com/\" rel=\"nofollow\">efprof.com</a> and saw the Oracle query being generated, copy-pasted it to TOAD, and it indeeds returns 2 items and not 15.</p>\n\n<p>I'm definitely missing something.</p>\n\n<p>Thanks,\n-rob</p>\n"},{"tags":["c#","entity-framework",".net-3.5","edmx","database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12902864,"title":"Getting stackoverflow in entity framework with custom get","body":"<p>I'm trying to add business logic to my database first entity framework appplication. I want to limit the length of address1 to 35 and move the rest to address to. In the database the fields are Address1 and Address2, on my edmx it is address1 and address2. I extened the edmx using a partial. but when ever trying to call my custom get function I get an exception saying the current thread is in a stackoverflow.</p>\n\n<pre><code> public partial class EmployeeWithAddress\n    {\n        public string Address1\n        {\n            get\n            {\n                var employee = Common.LimitAddressFieldTo35(this);\n                address1 = employee.Address1;\n                address2 = employee.Address2;\n                return address1;\n            }\n            set { address1 = value; }\n        }\n\n        public string Address2 { get; set; }\n    }\n\nstatic public EmployeeWithAddress LimitAddressFieldTo35(EmployeeWithAddress employee)\n        {\n            var ee = employee;  \n            if (ee.Address1.Length &gt; 35)\n            {\n                var address = ee.Address1;\n                ee.Address1 = address.Substring(0, 35).Trim();\n                ee.Address2 =\n                    string.Concat(address.Substring(35, address.Length - 35) + \" \", employee.Address2).Trim();\n            }\n\n            return ee;\n        }\n</code></pre>\n\n<p>the exception occurs when calling LimitAddressFieldTo35.\nI am using the entity framework version included in .net 3.5</p>\n"},{"tags":["c#","entity-framework","mini-profiler"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":483,"score":2,"question_id":9344777,"title":"MvcMiniProfiler Unable to cast object of type EFProfiledDbConnection","body":"<p>I am trying to integrate MvcMiniProfiler  to my asp.net mvc+entity framewok project. Everything is ok for the first time web request but it is giving exception at the other requests.</p>\n\n<p>My Project is<br/>\nMVC 3<br/>\nEntity Framework 4.1 (DatabaseFirst + POCO Generator DbContext)<br/>\nMvcMiniProfiler.dll 1.9.0.0<br/>\nMvcMiniProfiler.EntityFramework.dll 1.9.1.0<br/>\nI install MvcMiniProfiler from Nu-Get</p>\n\n<p>Added below to global.asax</p>\n\n<pre><code>    protected void Application_BeginRequest()\n    {\n        if (Request.IsLocal)\n        {\n            MvcMiniProfiler.MiniProfiler.Start();\n            MiniProfilerEF.Initialize();       \n        }\n    }\n</code></pre>\n\n<p>Added below to web.config</p>\n\n<pre><code>   &lt;system.data&gt;\n    &lt;DbProviderFactories&gt;\n      &lt;remove invariant=\"MvcMiniProfiler.Data.ProfiledDbProvider\" /&gt;\n      &lt;add name=\"MvcMiniProfiler.Data.ProfiledDbProvider\" invariant=\"MvcMiniProfiler.Data.ProfiledDbProvider\" description=\"MvcMiniProfiler.Data.ProfiledDbProvider\" type=\"MvcMiniProfiler.Data.ProfiledDbProviderFactory, MvcMiniProfiler, Version=1.8.0.0, Culture=neutral, PublicKeyToken=b44f9351044011a3\" /&gt;\n    &lt;/DbProviderFactories&gt;\n  &lt;/system.data&gt;\n</code></pre>\n\n<p>I am getting this exception</p>\n\n<pre><code>    System.InvalidCastException was unhandled by user code\n  Message=Unable to cast object of type 'MvcMiniProfiler.Data.EFProfiledDbConnection' to type 'System.Data.SqlClient.SqlConnection'.\n  Source=System.Data\n  StackTrace:\n       at System.Data.SqlClient.SqlCommand.set_DbConnection(DbConnection value)\n       at System.Data.Common.DbCommand.set_Connection(DbConnection value)\n       at MvcMiniProfiler.Data.ProfiledDbCommand.set_DbConnection(DbConnection value) in C:\\Users\\sam\\Desktop\\mvc-mini-profiler\\MvcMiniProfiler\\Data\\ProfiledDbCommand.cs:line 118\n       at System.Data.Common.DbCommand.set_Connection(DbConnection value)\n       at System.Data.Common.Utils.CommandHelper.SetStoreProviderCommandState(EntityCommand entityCommand, EntityTransaction entityTransaction, DbCommand storeProviderCommand)\n       at System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior)\n       at System.Data.Objects.Internal.ObjectQueryExecutionPlan.Execute[TResultType](ObjectContext context, ObjectParameterCollection parameterValues)\n</code></pre>\n\n<p><br/>\nException is occured in EF calls</p>\n\n<pre><code>ModaEntitiesWrapper.GetInstance().Articles\n               .AsNoTracking()\n               .Where(p =&gt; p.StatusId == 1).ToList();\n</code></pre>\n\n<p>If I change version of MvcMiniProfiler.Data.ProfiledDbProvider in Web.Config from 1.8.0.0 to 1.9.0.0\nA new type of exception occured in MiniProfilerEF.Initialize() call.</p>\n\n<pre><code>System.IndexOutOfRangeException was unhandled by user code\n  Message=The given DataRow is not in the current DataRowCollection.\n  Source=System.Data\n  StackTrace:\n       at System.Data.DataRowCollection.Remove(DataRow row)\n       at MvcMiniProfiler.MiniProfilerEF.Initialize() \n</code></pre>\n"},{"tags":["asp.net","asp.net-mvc","asp.net-mvc-3","entity-framework","entity-framework-4.1"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":571,"score":1,"question_id":8004479,"title":"Entity Framework TryUpdateModel Child Objects?","body":"<p>I know most of you will suggest that I should use ViewModels specific to the form I am using, but I am curious as to why my child object is not binding on TryUpdateModel.</p>\n\n<pre><code>@using (Html.BeginForm()) {\n    @Html.ValidationSummary(true)\n    &lt;fieldset&gt;\n        &lt;legend&gt;User&lt;/legend&gt;\n\n        @Html.HiddenFor(model =&gt; model.UserId)\n    @Html.HiddenFor(model =&gt; model.PrimaryAddress.AddressId)\n    &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.PrimaryAddress.FirstName)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.PrimaryAddress.FirstName)\n            @Html.ValidationMessageFor(model =&gt; model.PrimaryAddress.FirstName)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.PrimaryAddress.LastName)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.PrimaryAddress.LastName)\n            @Html.ValidationMessageFor(model =&gt; model.PrimaryAddress.LastName)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.UserName)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.UserName)\n            @Html.ValidationMessageFor(model =&gt; model.UserName)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.Email)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.Email)\n            @Html.ValidationMessageFor(model =&gt; model.Email)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.IsApproved)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.IsApproved)\n            @Html.ValidationMessageFor(model =&gt; model.IsApproved)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.IsEmployee)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.IsEmployee)\n            @Html.ValidationMessageFor(model =&gt; model.IsEmployee)\n        &lt;/div&gt;\n\n        &lt;p&gt;\n            &lt;input type=\"submit\" value=\"Save\" /&gt;\n        &lt;/p&gt;\n    &lt;/fieldset&gt;\n}\n</code></pre>\n\n<p>And the controller code:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Edit(int id, FormCollection form)\n{\n    var user = Token.DB.Users.Include(\"PrimaryAddress\").Single(x =&gt; x.UserId == id);\n    if (TryUpdateModel(user, new string[] { \"UserName\", \"Email\", \"IsApproved\", \"IsEmployee\", \"PrimaryAddress.FirstName\", \"PrimaryAddress.LastName\" }))\n    {\n        try\n        {\n            Token.DB.SaveChanges();\n            return RedirectToAction(\"index\");\n        }\n        catch (Exception ex)\n        {\n            while (ex.InnerException != null)\n                ex = ex.InnerException;\n            if (ex.Message.ToLowerInvariant().Contains(\"unique\"))\n                ModelState.AddModelError(\"UserName\", \"UserName already exists\");\n        }\n    }\n    return View(User);\n}\n</code></pre>\n\n<p>The code doesn't throw any exceptions, it just doesn't populate the user.PrimaryAddress.FirstName or user.PrimaryAddress.LastName from the form. I'd like to know why?</p>\n\n<p>I already know I can fix the issue with a specific ViewModel and mapping the info in the background. I can also do something like this:</p>\n\n<pre><code>&lt;!-- Edit.cshtml --&gt;\n&lt;div class=\"editor-field\"&gt;\n    @Html.EditorFor(model =&gt; model.PrimaryAddress.FirstName, null, \"FirstName\")\n    @Html.ValidationMessageFor(model =&gt; model.PrimaryAddress.FirstName)\n&lt;/div&gt;\n\n&lt;div class=\"editor-label\"&gt;\n    @Html.LabelFor(model =&gt; model.PrimaryAddress.LastName)\n&lt;/div&gt;\n&lt;div class=\"editor-field\"&gt;\n    @Html.EditorFor(model =&gt; model.PrimaryAddress.LastName, null, \"LastName\")\n    @Html.ValidationMessageFor(model =&gt; model.PrimaryAddress.LastName)\n&lt;/div&gt;\n\n// UsersController.cs\nif (TryUpdateModel(user, new string[] { \"UserName\", \"Email\", \"IsApproved\", \"IsEmployee\"})\n&amp;&amp; TryUpdateModel(user.PrimaryAddress, new string[] {\"FirstName\", \"LastName\" }))\n</code></pre>\n\n<p>So the real question is why isn't it binding in the first example?</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":76,"score":7,"question_id":12900930,"title":"Data grouping in SQL","body":"<p>I am working on a small project using C# and EF5.0 and I need to group some data. Let say I have table of columns in a building like shown below.</p>\n\n<pre><code>+----------+--------Columns Table--+------+------+\n| ColumnID |ColumnName|Width|Length|Height|number| \n+----------+----------+-----+------+------+------+\n|        1 |   C101   |  50 |   70 | 250  | 1    |  \n|        2 |   C102   |  70 |   70 | 250  | 1    |    \n|        3 |   C103   |  70 |   60 | 250  | 1    |    \n|        4 |   C104   |  90 |   70 | 250  | 1    |     \n|        5 |   C105   |  40 |   50 | 250  | 1    |     \n|        6 |   C106   |  50 |   70 | 250  | 1    |    \n|        7 |   C107   |  50 |   60 | 250  | 1    |    \n|        8 |   C108   |  70 |   70 | 250  | 1    |     \n+----------+----------+-----+------+------+------+\n</code></pre>\n\n<p>I need a C# code to see the above data groupped like this:</p>\n\n<pre><code>+----------+---Groupped Columns Table-----+------+\n|G_ColumnID|ColumnName|Width|Length|Height|number| \n+----------+----------+-----+------+------+------+\n|        1 |C(101-106)|  50 |   70 | 250  | 2    |  \n|        2 |C(102-108)|  70 |   70 | 250  | 2    |    \n|        3 |   C103   |  70 |   60 | 250  | 1    |    \n|        4 |   C104   |  90 |   70 | 250  | 1    |     \n|        5 |   C105   |  40 |   50 | 250  | 1    |         \n|        6 |   C107   |  50 |   60 | 250  | 1    |            \n+----------+----------+-----+------+------+------+\n</code></pre>\n\n<p>I prefer clues than the exact solution.</p>\n\n<p><strong>EDIT :</strong> Below code shows my current state. I think I can find the columns with the same Height, Width and Length using this code. But I am not sure how to generate a new name for the group.</p>\n\n<pre><code>using (pehlivanEntities context = new pehlivanEntities())\n{           \n     foreach (var item in context.table1)\n     {               \n          int id = item.ColumnID;\n          foreach (var item2 in context.table1)\n          {\n               int id2 = item2.ColumnID;\n               if (id != id2)\n               {\n                   if (item.Width == item2.Width)\n                   {\n                       if (item.Length == item2.Length)\n                       {\n                            if (item.Height == item2.Height)\n                            {\n                               //Alter item.ColumnName\n                               //increase item.number by one\n                               //Remove item2\n                            }\n                       }\n                   }\n               }\n          }\n     }\n}\n</code></pre>\n"},{"tags":["linq","entity-framework","iqueryable","lambda-functions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12901060,"title":"SelectMany on an IQueryable ignores conditions?","body":"<p>I'm trying to use SelectMany to evaluate a first query with conditions, based on those results execute another query.  I've been told that SelectMany should be able to do this.  The problem I'm having is the SelectMany seems to ignore the conditions in the first lambda expression.  My problem may be with the first expression but I'm not really sure.  Any ideas what I'm doing wrong.  </p>\n\n<p>First</p>\n\n<pre><code>  //get source based on user and active flag\n  var query = _sourceRepository.GetTable().Where(s =&gt; s.ActionItemStates.Any(ais =&gt; ais.UserId == user.Id &amp;&amp; ais.IsActive == active));  \n</code></pre>\n\n<p>Second - ignores conditions in first</p>\n\n<pre><code>var queryActionItems = query.SelectMany(x =&gt; x.ActionItemStates).OrderBy(x =&gt; x.ActionItem.SortOrder);\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/R9ICL.png\" alt=\"enter image description here\"></p>\n"},{"tags":["entity-framework","datetime","comparison","esql","entity-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2509,"score":1,"question_id":1210905,"title":"Comparing Date / DateTime ine Entity SQL Where clause","body":"<p>I have a method which accepts an ObjectQuery and adds Where clauses to it depending on whether it receives values for various filter parameters. The method has to return an ObjectQuery. How can i do a basic Date comparison e.g. where dateX &lt; dateY.</p>\n\n<p>This is my current code:</p>\n\n<pre><code>if (myDateFilter != null)\n{\n    query = query.Where(\n        string.Format(\n            \"it.ExpireDate &lt; cast('{0}' as System.DateTime)\",\n            myDateFilter));\n}\n</code></pre>\n\n<p>With myDateFilter having a value of DateTime.Now, this code says: System.Data.SqlClient.SqlException: The conversion of a varchar data type to a datetime data type resulted in an out-of-range value.</p>\n\n<p>All the other paramaters are string or integer filters so weren't a problem to implement. Any ideas??</p>\n"},{"tags":["wcf","entity-framework","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":130,"score":0,"question_id":12875792,"title":"Entity Framework 5 command timeout error after changing target Framework version and re-installing EF","body":"<p>Here's the background: I built a new WCF service which uses EF5 and was targeting .Net Framework 4.5.  I've used code-first against an existing large legacy database.  All was working nicely until I came to deploy the service to a test server, when I discovered the test server (and therefore the production server since they are the same build) was not capable of supporting Framework 4.5.</p>\n\n<p>So, I downgraded the project to target Framework 4.0.  After re-coding all my entity mappings (to avoid using code in the DataAnnotations.Schema namespace specific to 4.5), I had this working again locally.  However, after deploying to the server I was hitting the error described here: <a href=\"http://stackoverflow.com/questions/9591929/can-anyone-spot-why-i-keep-getting-this-error-testing-the-ef-5-beta\">Can anyone spot why I keep getting this error testing the EF 5 beta</a>.</p>\n\n<p>After doing as suggested - uninstalling and re-installing EF5 via NuGet, I am now getting a timeout error when trying to test the service.</p>\n\n<p>Specifically the timeout occurs when attempting to execute the following Linq:</p>\n\n<pre><code>var games = from m in _db.Members\n        join s in _db.UkSyndicates\n            on m.MemberId equals s.MemberId\n        where m.PaymentMethod == \"Credit/Debit Card\"\n        &amp;&amp; EntityFunctions.TruncateTime(s.NextChargeDate) &lt;=  EntityFunctions.TruncateTime(DateTime.Now)\n        &amp;&amp; !string.IsNullOrEmpty(m.AibCustomerReference)\n        &amp;&amp; (m.StatusId == 105 || m.StatusId == 113)\n        select new BillingItem\n        {\n            Id = s.Id,\n            SyndicateId = s.SyndicateId,\n            MemberId = s.MemberId,\n            LastDrawId = s.LastDrawId,\n            LastPaidGame = s.LastPaidGame,\n            NextChargeDate = s.NextChargeDate,\n            Protected = s.Protected,\n            PaymentFrequency = (int)(s.PaymentFrequency*4),\n            CurrencyCode = m.CurrencyCode,\n            AibCustomerReference = m.AibCustomerReference,\n            WeeklyFee = (from f in _db.GameFees where f.FeeName == \"UK_LOTTO_FEE\" &amp;&amp; f.CurrencyCode == m.CurrencyCode select f.Amount).FirstOrDefault(),\n            GameCode = game,\n            PostCode = m.PostCode,\n            CountryCode = m.CountryCode,\n            EmailAddress = m.Email\n        };\n</code></pre>\n\n<p>There may well be a more efficient way to write this query - I'm fairly inexperienced with Linq and EF, but I would stress this did NOT time-out prior to the uninstall and re-install of EF.  In fact it returned data fairly quickly.</p>\n\n<p>I can't see any reason this would timeout after the re-install of EF, nothing in the code has changed, but need a solution to this fast!</p>\n\n<p>Thanks.</p>\n\n<p>To clarify the error I'm getting, it's at the point that EF tries to execute the above query, I get an <strong>EntityCommandExecutionException</strong> thrown.  The exception message is \"An error occurred while executing the command definition.  See the inner exception for details.\"  The inner exception is \"Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\"</p>\n\n<p>The stack trace is below:</p>\n\n<p>at System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior)\n   at System.Data.Objects.Internal.ObjectQueryExecutionPlan.Execute[TResultType](ObjectContext context, ObjectParameterCollection parameterValues)\n   at System.Data.Objects.ObjectQuery<code>1.GetResults(Nullable</code>1 forMergeOption)\n   at System.Data.Objects.ObjectQuery<code>1.System.Collections.Generic.IEnumerable&lt;T&gt;.GetEnumerator()\n   at System.Data.Entity.Internal.Linq.InternalQuery</code>1.GetEnumerator()\n   at System.Data.Entity.Infrastructure.DbQuery<code>1.System.Collections.Generic.IEnumerable&lt;TResult&gt;.GetEnumerator()\n   at RepeatBillingService.Repositories.BillingRepository.GetMembersForGame(String game, List</code>1&amp; billingQ) in p:\\Projects\\BigFatLottos\\RepeatBillingService\\RepeatBillingService\\Repositories\\BillingRepository.cs:line 441\n   at RepeatBillingService.Repositories.BillingRepository.GetMemberGamesForBilling() in p:\\Projects\\BigFatLottos\\RepeatBillingService\\RepeatBillingService\\Repositories\\BillingRepository.cs:line 24\n   at RepeatBillingService.RepeatBillingService.RunRepeatBilling() in p:\\Projects\\BigFatLottos\\RepeatBillingService\\RepeatBillingService\\RepeatBillingService.svc.cs:line 51\n   at SyncInvokeRunRepeatBilling(Object , Object[] , Object[] )\n   at System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object instance, Object[] inputs, Object[]&amp; outputs)\n   at System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp; rpc)</p>\n"},{"tags":["c#","entity-framework","repository-pattern","unit-of-work"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":12899165,"title":"How to structure unit of work pattern with that many repositories","body":"<p>I have a database with ~600 tables and I am creating a unit-testable data access layer using POCO, EF 4.1, Repository and unit of work patterns. This mean that I have ~600 POCOs classes for entities, then for each entity class I have a repository class. I am using idea of aggregation from domain driven design which lead to creating bounded contexts that are specific to related sections in domain model. so far we have identified ~40 bounded context. What I am confused about is how to model unit of work. Should there be one unit of work per respoistory or should it depend upon number of context that I have. I can always have one huge unit of work but then this may take away all advantages that I get by using smaller and targetted bounded contexts.</p>\n"},{"tags":[".net","oracle","entity-framework","odp.net","sys-refcursor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12806485,"title":"What's wrong with my app.config configuration for ODP.Net and REF_CURSORS?","body":"<p>I've been struggling for a while with this, im following <a href=\"http://download.oracle.com/oll/obe/EntityFrameworkOBE/EntityFrameworkOBE.htm#t3\" rel=\"nofollow\">this guide</a>:</p>\n\n<p>This are the steps I have taken so far:</p>\n\n<ol>\n<li>Create new console project</li>\n<li>Add new EntityModel</li>\n<li><p>Import \"Test\" Stored Procedure into Entity Model, sp looks like this:</p>\n\n<pre><code>CREATE OR REPLACE PROCEDURE CTACTE_WEB.TEST(P_SALIDA OUT NUMBER,\n                            P_CURSOR1 OUT sys_refcursor,\n                            P_CURSOR2 OUT sys_refcursor) IS\nBEGIN\n   P_SALIDA := 15;\n   OPEN P_CURSOR1 FOR\n   SELECT 125.72 \"DECIMAL\", 150 \"INTEGER\", 'JUST PASSING BY' \"TEXT\" FROM DUAL;\n\n   OPEN P_CURSOR2 FOR\n   SELECT 'JUST SOME TEXT' \"TEXT\" FROM DUAL;\n\nEND TEST;\n/\n</code></pre></li>\n<li>Add this to app.config:</li>\n</ol>\n\n<pre>\n&lt;add name=\"CTACTE_WEB.TEST.RefCursor.P_CURSOR1\" value=\"implicitRefCursor bindinfo='mode=Output'\" /&gt;  \n&lt;add name=\"CTACTE_WEB.TEST.RefCursorMetaData.P_CURSOR1.Column.0\" value=\"implicitRefCursor metadata='ColumnName=DECIMAL;NATIVEDATATYPE=Number;ProviderType=Decimal'\" /&gt;  \n&lt;add name=\"CTACTE_WEB.TEST.RefCursorMetaData.P_CURSOR1.Column.1\" value=\"implicitRefCursor metadata='ColumnName=INTEGER;NATIVEDATATYPE=Number;ProviderType=Int32'\" /&gt;  \n&lt;add name=\"CTACTE_WEB.TEST.RefCursorMetaData.P_CURSOR1.Column.2\" value=\"implicitRefCursor metadata='ColumnName=TEXT;NATIVEDATATYPE=Varchar2;ProviderType=Varchar2'\" /&gt;  \n</pre>\n\n<pre>\n&lt;add name=\"CTACTE_WEB.TEST.RefCursor.P_CURSOR2\" value=\"implicitRefCursor bindinfo='mode=Output'\" /&gt;\n&lt;add name=\"CTACTE_WEB.TEST.RefCursorMetaData.P_CURSOR2.Column.0\" value=\"implicitRefCursor metadata='ColumnName=TEXT;NATIVEDATATYPE=Varchar2;ProviderType=Varchar2'\" /&gt;\n</pre>\n\n<p>Then I try to import function from the Entity Model I created before but when I click obtain column information after selecting complex type nothing happens, it doesn't show the cursor like the <strong>obe</strong> tutorial.</p>\n\n<p>Any help would be appreciated.</p>\n\n<p>Thanks</p>\n\n<p>EDIT:</p>\n\n<p>So I tried again today, and it's behaving differently this time. Now when I click the Obtain Column Information button in the import function dialog, the dialog just closes and nothing else happens.</p>\n"},{"tags":["entity-framework","nuget","mvcscaffolding"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12898441,"title":"revert Scaffold command","body":"<p>Scaffolding is a powerful feature and we can generate models, controllers \nand views very fast from the package manager under visual studio.\nBut if you submit the wrong command,\nHow to revert it ?\nFor example : </p>\n\n<pre><code>Scaffold Controller Person -Repository\n</code></pre>\n"},{"tags":[".net","entity-framework","generics"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12898309,"title":"Generalizing the DbContext","body":"<h2>Introduction</h2>\n\n<p>I have a Client-Server architecture where the server stores its data in different databases using Entity Framework 5.0. Therefore, it has different <code>DbContext</code> classes. However, there are some entity types shared amongst them. So we can have:</p>\n\n<pre><code>public class MyFirstDataAccess : DbContext\n{\n    //constructor omitted\n    public DbSet&lt;SharedType&gt; MyEntities { get; set; }\n    public DbSet&lt;OtherType&gt; MyOtherEntities { get; set; }\n}\npublic class MySecondDataAccess : DbContext\n{\n    public DbSet&lt;SharedType&gt; MyEntitiesWithSharedType { get; set; }\n}\n</code></pre>\n\n<p>Of course, the actual entities are not shared.</p>\n\n<h2>The problem</h2>\n\n<p>Different parts of the program need only parts of the data. E.g. one part could use the entities of Type <code>SharedType</code>. So I created a generic interface that provides the data:</p>\n\n<pre><code>public interface IEntityProvider&lt;TEntity&gt; where TEntity : class\n{\n    DbSet&lt;TEntity&gt; Elements { get; set; }\n\n    void Dispose();\n    int SaveChanges();\n}\n</code></pre>\n\n<p>Implementing the interface in the <code>DbContext</code> I added the <code>Elements</code> property, which would replace e.g. the <code>MyEntitiesWithSharedType</code> property:</p>\n\n<pre><code>DbSet&lt;SharedType&gt; IEntityProvider&lt;SharedType&gt;.Elements { get; set; }\n</code></pre>\n\n<p>This actually works. Different parts of the program can now work with any <code>DbContext</code> as long as it provides the needed data.</p>\n\n<p>I want to reuse some parts of the server in the client. Of course, the client does not have a <code>DbContext</code>, but retrieves its data via a WCF service from the server. Therefore, the <code>DbSet</code>cannot be used in the <code>IEntityProvider</code> interface, because this interface must be shared with the client. So I created another interface, which contains the <code>DbSet's</code> members I need:</p>\n\n<pre><code>public interface IEntityCache&lt;TEntity&gt; : IEnumerable&lt;TEntity&gt;, IQueryable&lt;TEntity&gt;\n{\n    ObservableCollection&lt;TEntity&gt; Local { get; }\n\n    TEntity Add(TEntity entity);\n    TEntity Remove(TEntity entity);\n}\n</code></pre>\n\n<p>The problem is to get the <code>DbSet</code> as an <code>IEntityCache</code>. It cannot be cast directly, because the <code>DbSet</code> does not implement the interface, although it contains all its members. I tried some different approaches, but neither really worked:</p>\n\n<h2>Attempt 1</h2>\n\n<p>Create a subclass of <code>DbSet</code>, which implements the needed interface (--> class adapter).</p>\n\n<p>This does not work, because <code>DbSet</code> does not have any public or protected constructors. Therefore, the adapter class is not valid.</p>\n\n<h2>Attempt 2</h2>\n\n<p>Instead of using an adapter class, I tried to use an adapter interface, which derives from <code>IDbSet</code> and the necessary interfaces:</p>\n\n<pre><code>public ICustomDbSet&lt;SharedType&gt; MyEntities{ get; set; }\nIEntityCache&lt;SharedType&gt; IEntityProvider&lt;SharedType&gt;.Elements { get { return MyEntities; } }\n</code></pre>\n\n<p>This does not work, because EntityFramework does not set the <code>ICustomDbSet</code>. Probably because the value it would set, is no <code>IEntityCache</code>.</p>\n\n<h2>Solution</h2>\n\n<p>While writing this question, I found a pretty good solution (which I will post as an answer). So why do I post this question, though? Firstly, I would like to know, if there are any other approaches that seem more reasonable and if my solution has some drawbacks. Secondly, the solution might help someone else. And thirdly, writing this question took a while and it would be a pity to throw it away :)</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12551377,"title":"Enabling EF code first migrations V 4.3.1.0","body":"<p>I have worked with other migration projects and had no problem.  in my current project i seperated the migration and model projects.  I get the following error when adding migration or even when enabling migration (the configuration class is created):</p>\n\n<blockquote>\n  <p>PM> enable-migrations -Force No classes deriving from DbContext found\n  in the current project. Edit the generated Configuration class to\n  specify the context to enable migrations for.\n  System.Reflection.ReflectionTypeLoadException: Unable to load one or\n  more of the requested types. Retrieve the LoaderExceptions property\n  for more information.    at\n  System.Reflection.RuntimeModule.GetTypes(RuntimeModule module)    at\n  System.Reflection.RuntimeModule.GetTypes()    at\n  System.Reflection.Assembly.GetTypes()    at\n  System.Data.Entity.ModelConfiguration.Mappers.TypeMapper.&lt;.ctor>b_<em>1(Assembly\n  a)    at System.Linq.Enumerable.d</em>_14<code>2.MoveNext()\n  at System.Collections.Generic.List</code>1.InsertRange(Int32 index,\n  IEnumerable<code>1 collection)    at\n  System.Data.Entity.ModelConfiguration.Mappers.TypeMapper..ctor(MappingContext\n  mappingContext)    at\n  System.Data.Entity.DbModelBuilder.MapTypes(EdmModel model)    at\n  System.Data.Entity.DbModelBuilder.Build(DbProviderManifest\n  providerManifest, DbProviderInfo providerInfo)    at\n  System.Data.Entity.DbModelBuilder.Build(DbConnection\n  providerConnection)    at\n  System.Data.Entity.Internal.LazyInternalContext.CreateModel(LazyInternalContext\n  internalContext)    at\n  System.Data.Entity.Internal.RetryLazy</code>2.GetValue(TInput input)    at\n  System.Data.Entity.Internal.LazyInternalContext.InitializeContext()<br>\n  at\n  System.Data.Entity.Internal.LazyInternalContext.get_CodeFirstModel()<br>\n  at System.Data.Entity.Infrastructure.EdmxWriter.WriteEdmx(DbContext\n  context, XmlWriter writer)    at\n  System.Data.Entity.Migrations.Extensions.DbContextExtensions.&lt;>c_<em>DisplayClass1.b</em>_0(XmlWriter\n  w)    at\n  System.Data.Entity.Migrations.Extensions.DbContextExtensions.GetModel(Action`1\n  writeXml)    at\n  System.Data.Entity.Migrations.Extensions.DbContextExtensions.GetModel(DbContext\n  context)    at\n  System.Data.Entity.Migrations.DbMigrator..ctor(DbMigrationsConfiguration\n  configuration, DbContext usersContext)    at\n  System.Data.Entity.Migrations.DbMigrator..ctor(DbMigrationsConfiguration\n  configuration)    at\n  System.Data.Entity.Migrations.Design.MigrationScaffolder..ctor(DbMigrationsConfiguration\n  migrationsConfiguration)    at\n  System.Data.Entity.Migrations.Design.ToolingFacade.ScaffoldRunner.RunCore()\n  at System.Data.Entity.Migrations.Design.ToolingFacade.BaseRunner.Run()\n  Unable to load one or more of the requested types. Retrieve the\n  LoaderExceptions property for more information.</p>\n</blockquote>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12892192,"title":"Entity Framework - Automatically Adding Unattached Items","body":"<p>I use EF 5 and Code First.</p>\n\n<p>Ive got a main ViewModel that exposes a Translation Property. A Translation consists out of 1 to n Translation Items. The Translation Property is bound to a Usercontrol. When the Translation is created and Added via _context.Translations.Add(t) in the Viewmodel also all TranslationItems inside the Translation are saved and stored correctly in the DB.</p>\n\n<p>But when i try to Add a new TranslationItem (t.TranslationItems.Add) to a existing Translation it isn't saved in the DB. context.ObjectStateManager.GetObjectStateEntries(EntityState.Added) also returns no elements so i guess the new Translation Items is still unattached. Since the TranslationItem is added inside the Child Usercontrol, i can't access the current Datacontext To set the Entity State to Added. </p>\n\n<p>What can i do?</p>\n\n<p>Edit:</p>\n\n<pre><code>public class Translation : BaseEntity, IValidatableObject\n{\n\n    private List&lt;TranslationItem&gt; _translations;\n         public virtual List&lt;TranslationItem&gt; Translations\n    { \n        get{\n            return _translations;\n        }\n        set\n        {\n            _translations = value;\n\n        }\n    }s\n</code></pre>\n\n<p>In ViewModel:</p>\n\n<pre><code>Translation = new Translation(); or\n\nTranslation = repo.GetTranslation(1);\n</code></pre>\n\n<p>Binding to custom Usercontrol:</p>\n\n<pre><code>&lt;Views:TranslationTextInput   Translations=\"{Binding Translation}\"/&gt;\n</code></pre>\n\n<p>In code behind of UserControl:</p>\n\n<pre><code>             Trans.Translations.Add(new TranslationItem() { Text = \"\", Lcid = new CultureInfo(\"en\").LCID });\n</code></pre>\n\n<p>Save function:</p>\n\n<pre><code>    public void Update(Translation t)\n    {\n        if (t.Id == 0)\n            _context.Units.Add(t);\n        _context.SaveChanges();\n    }\n</code></pre>\n\n<p>I create the Context in the Viewmodel Constructor and pass it to the repository class.</p>\n"},{"tags":["c#","entity-framework","datagridview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12110943,"title":"Sort and Filter supported list in sync with EF entity","body":"<p>I need to write a wrapper that would allow me to sort and filter a QueryObject without loosing the sync capabilities of the object (it's for DataGridView data binding).</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/gg696575%28VS.103%29.aspx\" rel=\"nofollow\">This</a> seems like what I need, but it's in the upcomming (beta I think?) EF 5, while I'm still only on EF 3.5. I need to mimic that feature in a older version.</p>\n\n<p>I found a <a href=\"http://www.timvw.be/2007/02/22/presenting-the-sortablebindinglistt/\" rel=\"nofollow\">wrapper</a> that enabled me to sort, but not filter and I fail to figure out which path to take to add Filter support in this wrapper. This wrapper also looses the sync with the QueryObject, but I don't think that would be hard to fix.</p>\n"},{"tags":["c#","entity-framework","entity-framework-4","linq-to-entities","dbcontext"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12896862,"title":"How to use a named method","body":"<p>I am using following code and trying to use a named method within Linq-To-Entities</p>\n\n<pre><code>Customer FindCustomerByLastName(string lastname)  \n{  \n    DataContext MyContext = new DataContext();  \n    return MyContext.Customers.Where(c =&gt; GetByCustomerByLastName(c,lastname) == true).FirstOrDefault();  \n}  \n\nbool GetByCustomerByLastName(Customer Cust, string LastName)  \n{  \n    if (Cust.LastName == LastName)  \n        return true;  \n    else  \n        return false;  \n}  \n</code></pre>\n\n<p>But this give me following error at run time.</p>\n\n<blockquote>\n  <p>LINQ to Entities does not recognize the method 'Boolean\n  GetByCustomerByLastName(Customer, System.String)' method, and this\n  method cannot be translated into a store expression.</p>\n</blockquote>\n\n<p>If I change my method to use a lambda as follows, everything works fine.</p>\n\n<pre><code>Customer FindCustomerByLastName(string lastname)  \n{  \n    DataContext MyContext = new DataContext();  \n    return MyContext.Customers.Where(c =&gt; c.LastName == lastname).FirstOrDefault();  \n}  \n</code></pre>\n\n<p>Is it possible to use named method in Linq-To-Entities in the context I am trying to do?</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12896107,"title":"eager loading collection relationship in EF code first","body":"<p>Im using entity framework code first 4.3 in c#</p>\n\n<p>I got the following classes:</p>\n\n<pre><code>Class A\n{\npublic string Name { get; set; }\npublic List&lt;B&gt; Bs { get; set; }\n}\n\nClass B\n{\npublic string Name { get; set; }\n}\n</code></pre>\n\n<p>There is one to many realationship from A to B.\nWhen i try to load B list from A. I only get the first element from the list.</p>\n\n<p>When i execute the following code, i expect a2 to contain both b's, but actually it contains only one. does anyone can help spot the problem?</p>\n\n<pre><code>B b = new B() {Name = \"b\"};\nA a = new A() {Name = \"a\", \nBs = new List&lt;B&gt;() { new B() {Name = \"b1\"}, new B() {Name = \"b2\"} };\n\nusing (var context = new MyContext())\n{\ncontext.As.Add(a);\ncontext.SaveChanges();\n}\nusing (var context = new MyContext())\n{\nvar a2 = (from a in context.As.Include(a =&gt; a.Bs)\n        where a.Name == \"a\"\n        select a).Single();\n}\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql-server","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12896112,"title":"Exception On Foreign Constraint","body":"<p>I have a table StaffLevelMapping that has a foreign key column, which is a primary key another table AcademicLevel. It raises an exception that the Insert statement conflicted with a foreign key and it has its reference on the foreign key and the table in which it's a primary key. I know this usually happens if the value you are inserting does not exist in it's original table. But this does exist actually. I tried inserting it directly in SQL Server and it worked perfectly. But through my code it doesn't work. What surprises me the most is I used the same insert logic for the rest of my tables and I don't have problems save this one with this very table. Please I need a very quick help on this I have not slept in 2 days because of this error.</p>\n\n<p>Here's my insert code below:</p>\n\n<pre><code>public static StaffLevelMapping AddStafflevel(int staffId, int levelId, bool isEnabled)\n    {\n        var context = ObjectContextHelper.CurrentObjectContext;\n        var staffLevel = context.StaffLevelMappings.CreateObject();\n\n        staffLevel.StaffID = staffId;\n        staffLevel.ID = levelId;\n        staffLevel.IsEnabled = isEnabled;\n        context.StaffLevelMappings.AddObject(staffLevel);\n        context.SaveChanges();\n\n        return staffLevel;\n    }\n</code></pre>\n\n<p>Many thanks in advance to that special person that can put me out of this misery.</p>\n"},{"tags":["c#","sql","asp.net-mvc","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12893324,"title":"Relationships in entity framework","body":"<p>Hi I'm using Entity framework 5 and mvc4 and struggling with the entity framework relationships</p>\n\n<p>I have a User, Role and UserRole table \n<img src=\"http://i.stack.imgur.com/tD7j5.png\" alt=\"SQL Table\">\nThe model is created in Entity framework</p>\n\n<p><img src=\"http://i.stack.imgur.com/usiMF.png\" alt=\"enter image description here\"></p>\n\n<p>Here is the code I use to save the User and the Role but this doesnt work\nThe User and Role object properties is set before being passed to this method</p>\n\n<pre><code>public void saveNewUser(User u, Role r)\n{\n    using (FormValueEntities db = new FormValueEntities())\n    {\n        u.Roles.Add(r);\n        r.Users.Add(u);\n        db.SaveChanges();\n    }\n}\n</code></pre>\n\n<p>How do I create a new user and set the Role at the same time?</p>\n"},{"tags":["c#","multithreading","entity-framework","iis","objectcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":183,"score":2,"question_id":11117397,"title":"Will Entity Framework fail when running on a high volumn IIS web site","body":"<p>We have been trying to analyse this exception:</p>\n\n<blockquote>\n  <p>Message: Error: Object reference not set to an instance of an object..\n  Stacktrace:    at System.RuntimeTypeHandle.CreateInstance(RuntimeType\n  type, Boolean publicOnly, Boolean noCheck, Boolean&amp; canBeCached,\n  RuntimeMethodHandleInternal&amp; ctor, Boolean&amp; bNeedSecurityCheck)    at\n  System.RuntimeType.CreateInstanceSlow(Boolean publicOnly, Boolean\n  skipCheckThis, Boolean fillCache)    at\n  System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly,\n  Boolean skipVisibilityChecks, Boolean skipCheckThis, Boolean\n  fillCache)    at System.Activator.CreateInstanceT    at\n  Z.Services.ObjectContextManagement.ScopedObjectContextManager<code>1.get_ObjectContext()\n  at Z.Services.DatabaseAccess.DatabaseAccess</code>2.Manage()    at\n  Z.Services.DatabaseAccess.DatabaseAccess`2.get_ObjectContext()</p>\n</blockquote>\n\n<p>Basically we get an error when getting the ObjectContext.</p>\n\n<p>From this question: <a href=\"http://stackoverflow.com/questions/2575990/entity-framework-lazy-loading-doesnt-work-from-other-thread\">Entity Framework lazy loading doesn&#39;t work from other thread</a> we see that EF is dependent upon staying on the same thread.</p>\n\n<p>From this Jon Skeet's answer to this question: <a href=\"http://stackoverflow.com/questions/1643987/will-a-request-in-iis-run-on-a-single-thread\">Will a request in IIS run on a single thread?</a> we see that IIS has thread agility.</p>\n\n<p>When there is a lower traffic volumn we do not see this error, but when the load increases we see the error.</p>\n\n<p>So the question: If EF is dependent upon staying on a single thread, and IIS does not keep the request on a single thread, can EF be used on an application that is deployed on IIS?</p>\n\n<p><strong>Edit</strong></p>\n\n<pre><code>var frameworkAssembly = Assembly.GetAssembly(typeof(ObjectContextManager&lt;&gt;));\nvar managerType = frameworkAssembly.GetType(managerTypeName + \"`1\", true, true);\nmanagerType = managerType.MakeGenericType(typeof(TObjectContext));\nObjectContextManager = Activator.CreateInstance(managerType) as ObjectContextManager&lt;TObjectContext&gt;;\n</code></pre>\n\n<p>It appears that the error occurs on the last line of the above code. The error only occurs in production under heavy load.</p>\n\n<p><strong>Edit 2</strong></p>\n\n<p>The ObjectContextManager inherits from ObjectContext which is an EF class.</p>\n\n<pre><code> public abstract class ObjectContextManager&lt;T&gt; where T : ObjectContext\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":104,"score":2,"question_id":12894452,"title":"Updating an Entity with EF5","body":"<p>I have just started a new project and having had previous happy times with Entity Framework, I Nuget'ed in the latest version. All was going well until I tried to update an entity. I have the following code;</p>\n\n<pre><code>using (var c = new EFContext())\n{\n      Data.User u = new Data.User() { UserId = UserId };\n      c.Users.Attach(u);\n      u.FailedPasswordAttemptCount = newFailedPasswordAttemptCount;\n      c.SaveChanges();\n}\n</code></pre>\n\n<p>This worked fine in EF4. However in EF5 this craps out with a DbEntityValidationException as I have a non-nullable field in the user table (UserName).</p>\n\n<p>I could solve this by creating my Data.User object with an empty UserName and telling EF which properties have been modified,</p>\n\n<pre><code>using (var c = new EFContext())\n{\n      Data.User u = new Data.User() { UserId = UserId, UserName = \"\" };\n      ...\n      c.Entry(u).Property(\"FailedPasswordAttemptCount \").IsModified = true;\n      ...\n}\n</code></pre>\n\n<p>but this doesn't seem particularly manageable as more non-nullable fields are added to this and numerous other tables. </p>\n\n<p><a href=\"http://stackoverflow.com/questions/12855502/attach-and-update-boolean-or-int-doesnt-always-work/12864001\">This question</a> states that <code>Attach</code> will only work for entities derived from <code>EntityObject</code>. So I assume EF5 objects do not derive from this. </p>\n\n<p>Anyone know how I can update my entity without having to specify the all non-nullable string fields each time.</p>\n\n<p>Feels like I am missing something really obvious....</p>\n"},{"tags":["asp.net-mvc","visual-studio","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12893867,"title":"VS2010 Entity Designer vs other 3rd party alternatives?","body":"<p>I have been enjoying the VS2010 Entity Designer for Model-First DB modelling and generation. However I am finding it restrictive especially in terms of labelling associations and adding notes. My models will be large, and I plan to use multiple EDMX files for different parts of the model. The generated Classes will be used by an ASP.NET MVC project.</p>\n\n<p>Model-First DB Migration is very important to me, which VS2012 does not support where the EF designer is much improved. The VS 2010 EF designer does not enable labelling etc so loss is information happens when you continue to normalise the model ie \"Where are those columns now?\" \"Well they are records in that intersection table now.\"</p>\n\n<p>I have been looking at alternative 3rd Party solutions that address this area more comprehensively. The first product I have come across is DevArt's Entity Developer. </p>\n\n<p>I would appreciate any experience and advice on 3rd party solutions. It is a shame that I need to pull away from MS's VS EF offering.</p>\n\n<p>Many thanks,</p>\n\n<p>Ed </p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","asp.net-mvc-4","entity-framework-5"],"answer_count":5,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":190,"score":6,"question_id":12838666,"title":"Is it good practice to use EntityObjects as a Model (MVC)?","body":"<p>I'm building my first MVC 4/Razor web app using Entity Framework 5, and doing a bit of homework before making any design decisions.</p>\n\n<p>I see that the EF objects descend from <a href=\"http://msdn.microsoft.com/query/dev11.query?appId=Dev11IDEF1&amp;l=EN-US&amp;k=k%28System.Data.Objects.DataClasses.EntityObject%29;k%28TargetFrameworkMoniker-.NETFramework,Version=v4.5%29;k%28DevLang-csharp%29&amp;rd=true\" rel=\"nofollow\"><code>EntityObject</code></a>, which appears to have a lot of useful best-practices stuff built it, not least of which is optimistic concurrency handling.  In other words if 2 people load the record of Jane Doe of 123 Maple Street simultaneously, the first one changes her name to Jane Smith and the second one changes her address to 321 Maple Street, then it's very easy to allow both changes to be merged into the record without conflicts, while an attempt by a second user to modify the same field as the first user will result in an error.  </p>\n\n<p>On the other hand, it seems pretty standard practice to create lightweight <a href=\"http://en.wikipedia.org/wiki/Data_transfer_object\" rel=\"nofollow\">Data Transfer Objects</a> to pass data between the server and the client, and which serve as or in models for the MVC framework.  This is great for ensuring minimal traffic to the client, but it screws up concurrency checking.</p>\n\n<p>So I'm questioning the rationale for using DTOs.  What are the reasons for using DTOs?  How bad is it to use an <code>EntityObject</code> as or within a MVC model?  What other solution would you propose to enable optimistic concurrency handling as I've described above?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12893487,"title":"Or Condition in Entity Framework","body":"<p>I am working on entity framework project, i have to apply Or condition in dbContext.Where\nI have tried this but its giving me error \"Operator || cannot be applied to operand of types lambda expressions\"</p>\n\n<pre><code>return dataContext.Friends\n              .Where((r =&gt; r.ToUserId == touserid &amp;&amp; r.FromUserId == fromuserid) \n                  || (r =&gt; r.ToUserId == fromuserid&amp;&amp; r.FromUserId == touserid ))\n              .ToList();\n</code></pre>\n\n<p>I also tried using &amp;&amp; instead of || but its giving me same error for &amp;&amp;,how can i apply Or condition for this senario?\nI have tried without brackets as well</p>\n"},{"tags":[".net","entity-framework","c#-4.0","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12892377,"title":"How can I localize the Entity Framework build-in validation messages/exceptions?","body":"<p>Beside the annotation-based validation mechanism EF provides the so-called \"Facets\". Meaning on a string property you could have a \"Max Length\" Facet (through the EF model configuration) where you specify a max-length of 80 chars. Most often this is done automatically by EF when you use a database first approach.</p>\n\n<p>If now the property contains more than the specified number of chars, EF will throw a DbEntityValidationResult with the message</p>\n\n<blockquote>\n  <p>[PropName]: The field [PropName] must be a string or array type with a maximum length of '80'.</p>\n</blockquote>\n\n<p>My question: How can I localize such message??? I'd need it in german and italian as well...</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12890743,"title":"Reading related data in Entity framework","body":"<p>I have two tables named StaticPages and StaticPagesContents that these two tables ralated together with StaticSn from StaticPages and StaticID from StaticPagesContents .\nI need to read a field from StaticPagesContents named PageContent and display this data on one of my controls so i use this code :</p>\n\n<pre><code>if (DropDownList1.SelectedIndex &gt; -1)\n        {\n            using (shahedWSEntities myEntity = new shahedWSEntities())\n            {\n                var content = (from s in myEntity.StaticPages\n                               where s.StaticSn == Convert.ToInt32(DropDownList1.SelectedValue)\n                               select s);\n                if (!object.ReferenceEquals(content, null))\n                { \n                    CKEditorControl1.Text=...\n                }\n            }\n        }\n</code></pre>\n\n<p>but i can't access to StaticPageContents's PageContent field . could you please help me?</p>\n"},{"tags":["asp.net","asp.net-mvc-3","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12889291,"title":"Dropdownlist in MVC using entity framework","body":"<p>I am using entity framework in mvc3. I have a table in which two entries are coming from an another table in the shape of drop down list. Like emp_no and emp_name.\nNow i want that when i select Emp_no from the first drop down list,the corresponding emp_name \nwill be selected automatically.</p>\n\n<p>Is this possible ?\nThanks in advance.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","asp.net-mvc-4","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12891723,"title":"Is there an easy way to copy a collection of foreign keys from one entity to another?","body":"<p>Like the title suggests is there an easy way to copy a collection of foreign keys from one entity to another?</p>\n\n<p>A bit of background.</p>\n\n<p>The project I am working on contains Products that can contain collectoins of filecollections, Press Releases and a few other things that are all linked together with foreign key collections. So for example the file collection may contain 10 screenshots that are all linked to the filecollection by a foreign key. This filecollection is then linked to the product via a foreign key.</p>\n\n<p>If someone was to come along and accidently enter two products almost identical but with a slightly different name and we decided that we could merge them together. What is the best way of moving these collections to the other object?</p>\n\n<p>The way I have been doing it at the moment is using a for each loop and looping through the collections and manually changing the productId. This may well be the best way of doing it. I just wondered if there is an easier or more efficient way or if the way that I am doing it is fine?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","oracle","entity-framework","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":113,"score":2,"question_id":12888418,"title":"Generate IN statement for decimal values with Oracle","body":"<p>I'm having trouble getting LINQ to generate an IN statement.  I have a function that looks like the one below, taking as input a list of long representing the primary keys to find.  Using the contains methods ends up generating a query of composite OR statements.  We're running against an Oracle database. We're using the newest version of LINQ/EF.  QueryableDbSet is a DbSet.  The PrimaryKey property is a decimal value and is the primary integer identifier for the object in Oracle.</p>\n\n<pre><code>List&lt;long&gt; GetList(List&lt;long&gt; ids)\n{\n    List&lt;decimal&gt; dIds = ids.Select(x =&gt; (decimal)x);\n    var query = from c in QueryableDbSet\n                where dIds.Contains(c.PrimaryKey)\n                select (long)c;\n    return query.ToList();\n}\n</code></pre>\n\n<p>The above code will generate composite OR statements.  Does any one know how to get LINQ to generate the faster IN statements?  Thanks.</p>\n\n<p>EDIT:  Doing some more research it appears that Oracle actually converts IN statements to OR chains, so maybe this is an exercise in futility. Can anyone confirm or deny this?</p>\n\n<p>Also, I'm aware that the above function is completely pointless/redundant.  My real use case is more complicated and involves other conditionals in the where clause.</p>\n"},{"tags":["c#","entity-framework","entity-framework-ctp5"],"answer_count":6,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":2174,"score":5,"question_id":11471347,"title":"Entity Framework 5 - Could not load file or assembly EntityFramework, Version=5.0.0.0","body":"<p>I am trying to use Entity Framework 5 for my project but I seem to be having some issue getting the assembly installed to comply. And since I installed this initially using nuget, I am not certain what I need to do to cause this to work as I expect .  Any help on what I need to do to fix this problem please? </p>\n\n<p>*<em>System.IO.FileNotFoundException : Could not load file or assembly EntityFramework, Version=5.0.0.0, Culture=Neutral, PublicKeyToken=b77a5c561934e089' or one of it's dependencies The System cannot find the file specified.WRN: Assembly binding logging is turned OFF.  To enable assembly bind failure logging, set the registy value . . . *</em> </p>\n\n<p><strong>by using fusion log, i got this</strong></p>\n\n<pre><code>*** Assembly Binder Log Entry  (7/17/2012 @ 9:29:09 PM) ***\n\nThe operation failed.\nBind result: hr = 0x80070002. The system cannot find the file specified.\n\nAssembly manager loaded from:  C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\clr.dll\nRunning under executable  C:\\PROGRAM FILES (X86)\\MICROSOFT VISUAL STUDIO 11.0\\COMMON7\\IDE\\COMMONEXTENSIONS\\MICROSOFT\\TESTWINDOW\\vstest.executionengine.x86.exe\n--- A detailed error log follows. \n\n=== Pre-bind state information ===\nLOG: User = WORKALOT\\Tokorie\nLOG: DisplayName = Budget.Data, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null\n (Fully-specified)\nLOG: Appbase = file:///C:/Development/Summer2012BudgetApp/Budget.Service.Test/bin/Release\nLOG: Initial PrivatePath = NULL\nLOG: Dynamic Base = NULL\nLOG: Cache Base = NULL\nLOG: AppName = vstest.executionengine.x86.exe\nCalling assembly : Budget.Lib, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null.\n===\nLOG: This bind starts in default load context.\nLOG: Using application configuration file: C:\\PROGRAM FILES (X86)\\MICROSOFT VISUAL STUDIO 11.0\\COMMON7\\IDE\\COMMONEXTENSIONS\\MICROSOFT\\TESTWINDOW\\vstest.executionengine.x86.exe.Config\nLOG: Using host configuration file: \nLOG: Using machine configuration file from C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\config\\machine.config.\nLOG: Policy not being applied to reference at this time (private, custom, partial, or location-based assembly bind).\nLOG: Attempting download of new URL file:///C:/Development/Summer2012BudgetApp/Budget.Service.Test/bin/Release/Budget.Data.DLL.\nLOG: Attempting download of new URL file:///C:/Development/Summer2012BudgetApp/Budget.Service.Test/bin/Release/Budget.Data/Budget.Data.DLL.\nLOG: Attempting download of new URL file:///C:/Development/Summer2012BudgetApp/Budget.Service.Test/bin/Release/Budget.Data.EXE.\nLOG: Attempting download of new URL file:///C:/Development/Summer2012BudgetApp/Budget.Service.Test/bin/Release/Budget.Data/Budget.Data.EXE.\nLOG: All probing URLs attempted and failed.\n</code></pre>\n"},{"tags":["entity-framework","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12887981,"title":"I need to create sql query with linq to entities","body":"<p>I have model</p>\n\n<pre><code>public class GrandPrix\n{\n    public int Id { get; set; }\n\n    [Required]\n    [Display(Name = \"Имя\")]\n    [DataType(DataType.Text)]\n    public string Name { get; set; }\n\n    public int LocationId { get; set; }\n\n    public int? ChampionchipId { get; set; }\n\n    public virtual Location Location { get; set; }\n    public virtual Championchip Championchip { get; set; }\n}\n    public class Location\n{\n    public int Id { get; set; }\n\n    [Required]\n    [Display(Name = \"Location\")]\n    [DataType(DataType.Text)]\n    public string Name { get; set; }\n\n//    public virtual ICollection&lt;GrandPrix&gt; GrandPrix { get; set; } \n}\n</code></pre>\n\n<p>I need modify in</p>\n\n<pre><code>ViewBag.LocationId = new SelectList(db.Locations, \"Id\", \"Name\");\n</code></pre>\n\n<p>db.Locations\n.Where(l=>l.id is not contained in db.Grandprix.Where(g=>g.ChampionchipId == 1))</p>\n\n<p>this query it work</p>\n\n<pre><code>SELECT Locations.Id as Id, Locations.Name as Name FROM dbo.Locations WHERE Locations.Id Not In (SELECT GrandPrixes.LocationId FROM GrandPrixes WHERE ChampionchipId = 1)\n</code></pre>\n\n<p>sorry my English and thanks for help.</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":106,"score":2,"question_id":12884382,"title":"EF 5.0 Code First adding new children to existing parent","body":"<p><strong>Overview:</strong>\nI am working on an MVC ASP.Net app using Code First and EF 5.0. I have two tables: Scripts and ScriptItems. A Script can have multiple ScriptItems. ScriptItems are hierarchical as well. ScriptItems can optionally belong to each other, however this relationship is only 1 level deep thankfully. This relationship is indicated by ScriptItem.ParentId.</p>\n\n<p><strong>The problem:</strong>\nCreating a new Script entry with ScriptItems works just fine. The problem arises when I try to add ScriptItems to an existing Script. If I try to add ScriptItems that do NOT have a ParentId, everything works fine. As soon as I try to add ScriptItems that do have a ParentId, I receive a FK violation exception.</p>\n\n<p><strong>Details:</strong></p>\n\n<p>Script class:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class Script\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string Description { get; set; }\n    public string Type { get; set; }\n    [ForeignKey(\"ProcessorId\")]\n    public Processor Processor { get; set; }\n    public int ProcessorId { get; set; }\n    public string Owner { get; set; }\n    public DateTime Created { get; set; }\n    public bool Public { get; set; }\n\n    public List&lt;ScriptItem&gt; Items { get; set; }\n    public List&lt;ScriptRun&gt; Runs { get; set; }\n\n    public Script()\n    {\n        Items = new List&lt;ScriptItem&gt;();\n        Created = DateTime.Now;\n    }\n}\n</code></pre>\n\n<p>ScriptItem class: (Truncated for brevity)</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code> public class ScriptItem\n{\n    [Key]\n    public int Id { get; set; }\n\n    [ForeignKey(\"ParentId\")]\n    public ScriptItem Parent { get; set; }\n    public int? ParentId { get; set; }\n\n    public Script Script { get; set; }\n    [ForeignKey(\"Script\")]\n    public int ScriptId { get; set; }\n</code></pre>\n\n<p>The function that adds script items:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>private void addToScript(ScriptModel model, List&lt;int&gt; ids)\n    {\n        Script script = scriptRepository.GetScriptWithItems(model.ScriptId);\n        List&lt;History&gt; historyItems = historyRespository.History.Where(h =&gt; ids.Contains(h.Id)).ToList();\n\n        ScriptItem lastScriptItem = script.Items.OrderByDescending(item =&gt; item.SortIndex).FirstOrDefault();\n        int topSortIndex = lastScriptItem == null ? 0 : lastScriptItem.SortIndex;\n\n        if (script != null)\n        {\n            List&lt;ScriptItem&gt; newItems = new List&lt;ScriptItem&gt;();\n            Mapper.CreateMap&lt;History, ScriptItem&gt;();\n            foreach (History h in historyItems)\n            {\n                ScriptItem scriptItem = new ScriptItem();\n                Mapper.Map(h, scriptItem); //Populate new ScriptItem from History entry\n                scriptItem.SortIndex = ++topSortIndex;\n                scriptItem.ScriptId = model.ScriptId;\n                scriptItem.Script = script;\n\n                //Only add an entry if it is NOT the parent of another entry. Otherwise, EF will duplicate the Parent entries\n                if (!historyItems.Any(his =&gt; his.ParentId == h.Id))\n                    newItems.Add(scriptItem);    \n            }\n            scriptRepository.AddScriptItems(newItems);\n        }\n    }\n</code></pre>\n\n<p>And finally the scriptRepository.AddScripItems():</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public void AddScriptItems(List&lt;ScriptItem&gt; items)\n    {\n        items.ForEach(item =&gt; context.Entry(item).State = System.Data.EntityState.Added);\n        context.SaveChanges();\n    }\n</code></pre>\n\n<p>Consider the scenario where I add two ScriptItems A and B to an existing script. A is the parent of B. When I run a SQL Server trace, I see that an attempt is made to insert the parent record A, but with a ScriptId of 0 hence the FK violation exception. No clue why ScriptId is 0. ScriptId is set properly on the ScriptItems, I verified this with the debugger.</p>\n\n<p>I did not include the function that inserts new Scripts and Items, because it is very similar to the addToScript function above. And it works fine. But if someone wants to see it, I can add that too.</p>\n\n<p>Someone smarter than me have any ideas? Thanks!</p>\n"},{"tags":["c#","winforms","entity-framework","c#-4.0","data-binding"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12866661,"title":"Databinding a child combobox with a many-to-many relationship","body":"<p>Good Afternoon, </p>\n\n<p>I'm attempting to implement the Entity Framework but seem to be having an issue when I'm trying to utilize a master-detail relationship.  Ideally, I'd like to be able to select a company from a combobox and then populate a subsequent combobox with a list of employee names for the selected company.  I seem to be running into issues trying to achieve this with a many-to-many relationship that has a bridge table containing some additional data.  The following is a simplified version of the three database tables I'm using:</p>\n\n<pre><code>create table Organization.Company\n(\n   CompanyID int not null,\n   CompanyName varchar(40) not null,\n   ServiceRepresentative varchar(20) not null,\n   primary key (CompanyID)\n)\n\ncreate table Person.Employment\n(\n   CompanyID int not null,\n   PersonID uniqueidentifier not null,\n   EmployeeID int not null,\n   FullTime bit not null,\n   HoursPerWeek float null,\n   primary key (CompanyID, PersonID),\n   constraint fk_Company_Employment foreign key (CompanyID) references Organization.Company(CompanyID),\n   constraint fk_Person_Employment foreign key (PersonID) references Person.ContactInfo(PersonID)\n)\n\ncreate table Person.ContactInfo\n(\n   PersonID uniqueidentifier not null,\n   FirstName varchar(40) not null,\n   LastName varchar(40) not null,\n   primary key (PersonID)\n)\n</code></pre>\n\n<p>Im my code-behind I have the following (WinForms):</p>\n\n<pre><code>    private orgEntities db;\n    private BindingSource companyBinding;\n    private BindingSource employeeBinding;\n\n    public MainForm()\n    {\n        InitializeComponent();\n\n        this.db = new orgEntities();\n        this.companyBinding = new BindingSource();\n        this.employeeBinding = new BindingSource();\n\n        this.companyBinding.DataSource = db.Companies.OrderBy(x =&gt; x.CompanyName);\n\n        this.employeeBinding.DataSource = companyBinding;\n        this.employeeBinding.DataMember = \"Employment\";\n\n        this.currentCompanyComboBox.DataSource = companyBinding;\n        this.currentCompanyComboBox.DisplayMember = \"CompanyName\";\n        this.currentCompanyComboBox.ValueMember = \"CompanyID\";\n\n        this.currentEmployeeComboBox.DataSource = employeeBinding;\n        this.currentEmployeeComboBox.DisplayMember = \"ContactInfo.FullName\";  // Generated by extension class\n        this.currentEmployeeComboBox.ValueMember = \"PersonID\";           \n    }\n</code></pre>\n\n<p>The issue I seem to be running into is that only one employee is displayed inside the combobox when a company is selected.  When I change the \"ContactInfo.FullName\" to \"EmployeeID\" I get the full list of EmployeeIDs.  I'm assuming that the entity framework is grabbing the first person and navigating to their FullName property which causes their information to be the only thing displayed.  </p>\n\n<p>Is there any way I can get the full list of names to display in this drop-down with the bridge table (Person.Employment) present or would I be better off just creating a view of combining the Employment and ContactInfo tables together and using that in the edmx file rather than the two separate tables?  </p>\n\n<p>I understand that I may be going about this the wrong way and I would be grateful if someone could point me in the right direction on this one.  Thank you and have a great day!</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":55,"score":4,"question_id":12887663,"title":"Is it dangerous for views to directly use domain models?","body":"<p>I've used an EF code-first approach to define my DB structure.  Currently, I am passing the EF entity classes directly into some of my views in an MVC application.  This makes it easy to populate and save the views because I can just directly have a repository give me my populated EF class, and if my controller receives an EF entity class in a postback, I can (if validation is OK) pass that straight through to the repository to save it.  However, is this potentially a security risk?  If there are properties on an entity class that I don't want modified, could the client submit those properties back as part of the postback and modify them anyway?  For example, say I have a view to edit a user to which I pass this EF model:</p>\n\n<pre><code>public class User {\n    [Required]\n    public string Firstname { get; set; }\n    [Required]\n    public string Surname { get; set; }\n    public DateTime DOB { get; set; }\n    public bool IsDisabled { get; set; }\n}\n</code></pre>\n\n<p>I might expose <code>Firstname</code>, <code>Surname</code>, and <code>DOB</code> as editable form fields, but I don't want the user to be able to set <code>IsDisabled</code> and disable their account.  What's the best way to guard against this?  Perhaps one should only use domain models in views directly when one thinks it's alright for <em>every</em> property persisted by that domain model to be settable by the user, or when one is just using that domain model to display things, rather than save things back to a data store?</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.3"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":569,"score":2,"question_id":9888789,"title":"Pre-Generate Views for EF Code First","body":"<p>Having finally deployed to live a new site built with Entity Framework Code First and MySql, one nagging annoyance is the pause often experienced while view metadata is cached. This seems to happen far more frequently than the application pool is recycled. (?)</p>\n\n<p>I guess that for a site which has a constant stream of traffic this might not be noticed often. For a new site with infrequent traffic it feels like every time I go to the site there's a 4-5 second delay in rendering the first page.</p>\n\n<p>So I tracked down the following links:</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/bb896240.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb896240.aspx</a></p>\n\n<p><a href=\"http://visualstudiogallery.msdn.microsoft.com/72a60b14-1581-4b9b-89f2-846072eff19d\" rel=\"nofollow\">http://visualstudiogallery.msdn.microsoft.com/72a60b14-1581-4b9b-89f2-846072eff19d</a></p>\n\n<p>The EF Power Tools CTP1 looked promising, apart from the fact that it seems to be broken for EF 4.3 and hasn't been updated for months. Also I'm not sure how that tool would fit in to our automated build process.</p>\n\n<p>The OptimizeContext() or WriteEdmx() methods that EF Power Tools is using throw this error</p>\n\n<pre><code>System.Reflection.TargetInvocationException: \nException has been thrown by the target of an invocation. ---&gt;    System.Data.ProviderIncompatibleException: The provider did not return a ProviderManifestToken string. ---&gt; System.Data.SqlClient.SqlException: \nA network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)\n</code></pre>\n\n<p>I initially assumed this might be MySql related but several others on the EF Power Tools Q&amp;A section are reporting it.</p>\n\n<p>So, in short, how do I pre-generate views for EF 4.3 code first, preferable in a way that can slot into an automated build process?</p>\n"},{"tags":[".net","asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":12887369,"title":"EF CodeFirst and UserProfile in SimpleMembership","body":"<p>I have a table Tale with definition</p>\n\n<pre><code>public class Tale\n{\n    public int Id { get; set; }\n    public string Title { get; set; }\n    public string Text { get; set; }\n    public DateTime ReleaseDate { get; set; }\n\n    public int enum_TaleAuthorTypeId { get; set; }\n    public virtual enum_TaleAuthorType enum_TaleAuthorType { get; set; }\n\n    public int CommentableId { get; set; }\n    public virtual Commentable Commentable { get; set; }\n}\n</code></pre>\n\n<p>and when i type 'update-database' in console, i have nice relationships with one column for CommentableId and one for enum_TaleAuthorTypeId.</p>\n\n<p>Now, i'd like to add UserProfile and try to type something like:</p>\n\n<pre><code>    public int UserProfile_UserId { get; set; }\n    public virtual UserProfile UserProfile { get; set; }\n</code></pre>\n\n<p>but after add-migration, i have this:</p>\n\n<pre><code>    public override void Up()\n    {\n        CreateTable(\n            \"dbo.UserProfile\",\n            c =&gt; new\n                {\n                    UserId = c.Int(nullable: false, identity: true),\n                    UserName = c.String(),\n                })\n            .PrimaryKey(t =&gt; t.UserId);\n\n        AddColumn(\"dbo.Tales\", \"UserProfile_UserId\", c =&gt; c.Int(nullable: false));\n        AddColumn(\"dbo.Tales\", \"UserProfile_UserId1\", c =&gt; c.Int());\n        AddForeignKey(\"dbo.Tales\", \"UserProfile_UserId1\", \"dbo.UserProfile\", \"UserId\");\n        CreateIndex(\"dbo.Tales\", \"UserProfile_UserId1\");\n    }\n\n    public override void Down()\n    {\n        DropIndex(\"dbo.Tales\", new[] { \"UserProfile_UserId1\" });\n        DropForeignKey(\"dbo.Tales\", \"UserProfile_UserId1\", \"dbo.UserProfile\");\n        DropColumn(\"dbo.Tales\", \"UserProfile_UserId1\");\n        DropColumn(\"dbo.Tales\", \"UserProfile_UserId\");\n        DropTable(\"dbo.UserProfile\");\n    }\n</code></pre>\n\n<p>At first, looks like EF think to create table UserProfile (but it's already created and i dont need it). Then, EF want to add two columns 'UserProfile_UserId1' and 'UserProfile_UserId', but i really need one for value.</p>\n\n<p>What's my problem?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1080,"score":4,"question_id":10415576,"title":"MVC EDMX Codebehind is using ObjectContext vs DBContext","body":"<p>I am new to EF.  I have a separate Project for my Models.  I have EF 4.3.1.0 installed.  I see that the base class of the Context is ObjectContext and not DbContext.  This becomes an issue when i scaffold my Controller in my front end project where in the Edit action it makes a call to </p>\n\n<pre><code>context.Entry(status).State = EntityState.Modified; \n</code></pre>\n\n<p>but Entry is not known.  I found that Entry is new with DbContext.  </p>\n\n<p>How do I have the generated code generate the right stuff?</p>\n\n<p>This is a DB First project</p>\n"},{"tags":[".net","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":287,"score":0,"question_id":12886334,"title":"ASP .NET MVC 4: WebSecurity.CreateUserAndAccount how to set UserId","body":"<p>I'd like to move my initialization of database tables and data (user, user in role e.t.c.) in Configuration.cs like in this article: <a href=\"http://blog.longle.net/2012/09/25/seeding-users-and-roles-with-mvc4-simplemembershipprovider-simpleroleprovider-ef5-codefirst-and-custom-user-properties/\" rel=\"nofollow\">http://blog.longle.net/2012/09/25/seeding-users-and-roles-with-mvc4-simplemembershipprovider-simpleroleprovider-ef5-codefirst-and-custom-user-properties/</a></p>\n\n<p>But i have a question: is it possible to set up UserId of adding users? I mean, i could add 5 users, and, as i think, they should get 1-2-3-4-5 Ids, but could i controll it and set up their Ids manual?</p>\n\n<p>Now initialization looks like:</p>\n\n<pre><code>        if (!WebSecurity.UserExists(\"elena\"))\n            WebSecurity.CreateUserAndAccount(\"elena\", \"password\");\n</code></pre>\n"},{"tags":["c#","entity-framework","fluent-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12885322,"title":"Entity Framework - Foreign key in sub-object","body":"<p>I am working with Entity Framework to retrive blog data from a database. I have a class \"BlogPost\" and a class \"Author\". One Author may have many blog posts, but the Author object itself does not contain a list of them. As far as the Author object is concerned, it is independent of all blog posts.</p>\n\n<p>An instance of the Author class is included as a property in the BlogPost. Every author has an AuthorId. I would like to pull from my database a given blog and have the Author object filled with the pertinent data. I have managed to do this by including an AuthorId property in my BlogPost class, using the following code to map the object:</p>\n\n<pre><code>this.HasRequired(t =&gt; t.Author).WithMany().HasForeignKey(x =&gt; x.AuthorId);\n</code></pre>\n\n<p>What I would like to do, however, is to be able to do the same thing but without having to include the AuthorId property directly in the model. The reason being, is because as the Author object contains the coresponding ID already, I am repeating the same piece of information twice. I would like to do something along these lines:</p>\n\n<pre><code>this.Property(t =&gt; t.Author.Id).HasColumnName(\"id_user\");\nthis.HasRequired&lt;TwitterUser&gt;(t =&gt; t.Author).WithMany().HasForeignKey(t =&gt; t.Author.Id);\n</code></pre>\n\n<p>So, is there any way do retrieve the Author sub-object without having to store the AuthorID redundantly in the BlogPost object alongside the Author object itself?</p>\n"},{"tags":["android","wcf","entity-framework","wcf-client","wcf-rest"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":162,"score":1,"question_id":12744440,"title":"How to Consume WCF Rest Service with Android","body":"<p>Here is code snippet, where I connect to my WCF Service.</p>\n\n<pre><code>DefaultHttpClient client = new DefaultHttpClient();         \n                            HttpGet request = new HttpGet(EMPLOYEE_LOG_IN);\n                            request.setHeader(\"Accept\", \"application/json\");\n                            request.setHeader(\"Content-type\", \"application/json\");          \n                            HttpResponse response = client.execute(request);\n                            HttpEntity entity = response.getEntity();\n                            if(entity.getContentLength() != 0) {\n                                Reader employeeReader = new InputStreamReader(response.getEntity().getContent());       \n                                                //create a buffer to fill if from reader            \n                                                char[] buffer = new char[(int) response.getEntity().getContentLength()];        \n                                                //fill the buffer by the help of reader         \n                                                employeeReader.read(buffer);                \n                                                //close the reader streams              \n                                                employeeReader.close(); \n                                                //for the employee json object              \n                                                JSONObject employee =  new JSONObject(new String(buffer));\n                                                Log.d(\"Response\",employee.getString(\"FirstName\"));    \n</code></pre>\n\n<p>It behaves different ways in different situation.\nHere is code from my WCF Service</p>\n\n<pre><code> public Controller GetEmployees(int personalNUmber)\n        {                \n\n                return new Controller\n                            {\n                                EmployeeId = 1,\n                                FirstName = \"FirstName\",\n                                LastName = \"LastName\"\n                            };    \n            }\n        }\n</code></pre>\n\n<p>SO when I call  this method   everything works fine, I get json format well, but when I \nedited my method and connected into Entity DB like this</p>\n\n<pre><code>FineReceiptsTestEntities _entity = new FineReceiptsTestEntities();\n\n        var t = _entity.Employees.FirstOrDefault(x =&gt; x.EmployeeID == personalNUmber);\n        return new Controller\n                   {\n\n                       EmployeeId = 1,\n                       FirstName = t != null ? t.Name : \" \",\n                       LastName = \"LastName\"\n                   }; \n</code></pre>\n\n<p>Json object didn't returned. Returned only html content with <strong>error</strong> like this</p>\n\n<blockquote>\n  <p>server encountered an error processing the request.Please see the\n   service help page  for constructing valid requests to the service.</p>\n</blockquote>\n\n<p>But both type of method in browser works fine and returns relevant data.</p>\n\n<p>and here is my <strong>web.config</strong></p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;system.web&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.0\"&gt;\n      &lt;assemblies&gt;\n        &lt;add assembly=\"System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n      &lt;/assemblies&gt;\n    &lt;/compilation&gt;\n  &lt;/system.web&gt;\n  &lt;system.serviceModel&gt;\n    &lt;standardEndpoints&gt;\n      &lt;webHttpEndpoint&gt;\n        &lt;standardEndpoint helpEnabled=\"true\" automaticFormatSelectionEnabled=\"true\" /&gt;\n      &lt;/webHttpEndpoint&gt;\n    &lt;/standardEndpoints&gt;\n    &lt;services&gt;\n      &lt;service name=\"dev_FineReceiptsService.ControllersInfo\"&gt;\n        &lt;endpoint kind=\"webHttpEndpoint\" contract=\"dev_FineReceiptsService.IControllersInfo\" /&gt;\n        &lt;endpoint address=\"mex\" binding=\"mexHttpBinding\" contract=\"IMetadataExchange\" /&gt;\n      &lt;/service&gt;\n    &lt;/services&gt;\n  &lt;/system.serviceModel&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"FineReceiptsTestEntities\" connectionString=\"metadata=res://*/FineTest.csdl|res://*/FineTest.ssdl|res://*/FineTest.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=msdev01;Initial Catalog=FineReceiptsTest;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>So can anyone tell me what is the problem when using Entity to retrieve data ?</p>\n"},{"tags":["sql-server-2008","entity-framework","code-first","sql-server-ce-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12751318,"title":"SQL Server CE identifies a cyclical reference with Entity Framework Code First but SQL Server 2008 does not","body":"<p>I am working on an Entity Framework Code First project that has a fairly complex Data Model which deploys absolutely fine on SQL Server 2008.</p>\n\n<p>However when creating an SQL Server CE database for some local End-To-End testing I get the following error message when EF creates the database:</p>\n\n<p><code>System.Data.SqlServerCe.SqlCeException: The referential relationship will result in a cyclical reference that is not allowed. [ Constraint name = FK_Sites_Persons_PersonId ].</code></p>\n\n<p>I have disabled the <code>ManyToManyCascadeDeleteConvention</code> in my DataContext model creation method, so that isn't the cause of the problem. The trouble I have is that the relationship in question looks fine in the SQL Server 2008 database- it appears to be a normal foreign key from what I can tell and I can't see anything flowing back in the other direction, although it is not impossible that there is a longer-path circular reference. I don't know why CE would fail and 2008 would succeed.</p>\n"},{"tags":["c#","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12883603,"title":"How to change multiple queries to a single query?","body":"<p>I have three tables namely \"Projects\", \"Platforms\", \"Details\". </p>\n\n<p>I have collected detail from the Projects table, then Platforms table and Details table. From the details table we may get the multiple values or single value. </p>\n\n<p>I have written the Linq query like below:</p>\n\n<pre><code>using (PEntities CSProject = new PEntities())\n{\n    projectId =    (from _project in CSProject.Projects\n                    where _project.ProjectName == project\n                    select _project.ProjectId).SingleOrDefault();\n\n    platformId =   (from platformID in CSProject.Projects\n                    where platformID.ProjectName == project\n                    select platformID.PlatformId).SingleOrDefault();\n\n    platformName = (from platfrmName in CSProject.Platforms\n                    where platfrmName.PlatformId == platformId\n                    select platfrmName.PlatformName).SingleOrDefault();\n\n    cSProjectId =  (from _csproject in CSProject.Details\n                    where _csproject.ProjectId == projectId\n                    select _csproject.CsprojectId).ToList&lt;long?&gt;();\n}\n</code></pre>\n\n<p>Can you please help me out to write the above all query in a single single line?</p>\n"},{"tags":["entity-framework","cascading-deletes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12859481,"title":"Entity Framework doesn't delete children, instead sets references to null","body":"<p>I have the following situation:</p>\n\n<p>First the only relevant table/class (all auto generated from DB (MySQL)):</p>\n\n<p><img src=\"http://i.stack.imgur.com/2or78.png\" alt=\"Table\"></p>\n\n<p>The relevant part of the edmx file:</p>\n\n<pre><code>     &lt;Association Name=\"navigationitem_ibfk_1\"&gt;\n      &lt;End Role=\"navigationitem\" Type=\"Model.Store.navigationitem\" Multiplicity=\"0..1\"&gt;\n        &lt;OnDelete Action=\"Cascade\" /&gt;\n      &lt;/End&gt;\n      &lt;End Role=\"navigationitem1\" Type=\"Model.Store.navigationitem\" Multiplicity=\"*\" /&gt;\n      &lt;ReferentialConstraint&gt;\n        &lt;Principal Role=\"navigationitem\"&gt;\n          &lt;PropertyRef Name=\"id\" /&gt;\n        &lt;/Principal&gt;\n        &lt;Dependent Role=\"navigationitem1\"&gt;\n          &lt;PropertyRef Name=\"navigationitemid\" /&gt;\n        &lt;/Dependent&gt;\n      &lt;/ReferentialConstraint&gt;\n    &lt;/Association&gt;\n</code></pre>\n\n<p>I think there aren't many more words needed: It's a navigation table, each navigationitem can have children (but it's not a must).</p>\n\n<p>Now when I try to remove a top level item which has a child:</p>\n\n<pre><code>context.Remove(topLevelNode);\ncontext.SaveChanges();\n</code></pre>\n\n<p>It deletes the top level node in the DB, but at the child nodes it just sets the <code>navigationitemid</code> to <code>null</code> (and yes - I have defined on delete cascade in the DB, when I delete it directly there it works).</p>\n\n<p>So what I think it's going on is, that when I delete the parent node, the framework sets all <code>navigationitemid</code> of all children to <code>NULL</code>, then when the navigation should be saved to the DB it won't cascade the delete because the <code>navigationitemid</code> of the children are <code>NULL</code>.</p>\n\n<p>What can I do? Thank you.</p>\n"},{"tags":["wpf","entity-framework","c#-4.0","backup","restore"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12883044,"title":"backup/restore from database with using entity framework","body":"<p>how to backup/restore from database with using entity framework ?</p>\n\n<p>Is it possible with entity framework 4.0 ?</p>\n\n<p>I am using the c#4.0 and wpf and EF4.0</p>\n"},{"tags":["entity-framework","audit-logging"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12882618,"title":"Audit Logging with EF","body":"<p>I need to set up audit logging for my web application. I need to store a screen name, field name, user name, before value and after value. I'm using entity framework 4.3.1. I've seen that it's possible to use the ObjectStateManager to get access to this information in the SaveChanges event. Are there any issues with using this approach? Why would I <strong>not</strong> want to use it? I've seen that I can get the modified properties using the state mgr and the current values and new values collections, what happens if I add a child to a parent, does that mark the parent as modified and the child as added? Just trying to figure out if EF object state manager handles parent child relationships well?</p>\n\n<p>The other approach is to build up a string with all the auditable properties with the current value and store that in the database, when this info is required, I work backwards and try to build up a history of what changed and how. Seems like overkill. Any guidance will be appreciated. Thanks</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-4.3","ef-migrations"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":676,"score":4,"question_id":10822618,"title":"Confusion over EF Auto Migrations and seeding - seeding every program start","body":"<p>I recently changed an application from using the following for dev:</p>\n\n<pre><code>DropCreateDatabaseIfModelChanges&lt;Context&gt;\n</code></pre>\n\n<p><br>\nTo using:</p>\n\n<pre><code> public class MyDbMigrationsConfiguration: DbMigrationsConfiguration&lt;GrsEntities&gt;\n{\n    public MyDbMigrationsConfiguration()\n    {\n        AutomaticMigrationsEnabled = true;\n        AutomaticMigrationDataLossAllowed = true;\n    }\n}\n</code></pre>\n\n<p><br>\n In my db context I have:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        // Tell Code First to ignore PluralizingTableName convention\n        // If you keep this convention then the generated tables will have pluralized names.\n        modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n\n        //set the initializer to migration\n        Database.SetInitializer(new MigrateDatabaseToLatestVersion&lt;GrsEntities, MigrationConfig&gt;());\n    }\n</code></pre>\n\n<p>I have overridden Seed(context) in DbMigrationsConfiguration using the AddOrUpdate extension where I was just using Add before with seeding on the drop db (DropCreateDatabaseIfModelChanges).</p>\n\n<p>My confusion is that the Migration runs with each start of the application regardless of there being any changes to the DbContext. Each and every time I start the application (library run through a service) the initializer runs as does the Seed. My expected behaviour is a check whether a migration is necessary (behind the scenes check to see if model matches physical db) then update any new/removed tables/columns and only run seed if something has changed.</p>\n\n<p>In my testing seed runs every time, which is workable but seemingly inefficient and was not what I expected. Unfortunately the MSDN documentation is quite limited.</p>\n\n<p>Am I completely misusing MigrateDatabaseToLatestVersion? Is there any way to get the behaviour I expect (i.e. only seed if there is a model change) or should I just change my seed method to expect to be run every application launch?</p>\n"},{"tags":["entity-framework","asp.net-mvc-3"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1359,"score":0,"question_id":6306415,"title":"MVC3 Customizing DropdownList items in strongly typed view","body":"<p>I have an auto generated DropDownList from Entity Framework in a strongly typed view: </p>\n\n<pre><code> &lt;div class=\"editor-field\"&gt;\n    @Html.DropDownList(\"User_FK\", String.Empty)\n    @Html.ValidationMessageFor(model =&gt; model.User_FK)\n&lt;/div&gt;\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/7eGLm.jpg\" alt=\"Auto Generated drop down list\"></p>\n\n<p>Here is the action code: </p>\n\n<pre><code>public ActionResult Create()\n{\n    ViewBag.SystemMaster_FK = new SelectList(db.SystemMasters, \"System_PK\", \"Name\");\n    ViewBag.User_FK = new SelectList(db.Users, \"User_PK\", \"NetworkLogin\");\n    return View();\n} \n</code></pre>\n\n<p>I need this list to display the names of people loaded from Active Directory. How do I customize the select list options seperately?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1442,"score":0,"question_id":8313825,"title":"Using sample data to seed database for Entity Framework doesn't create database","body":"<p>I'm pretty new to using Entity Framework, as well as to using ASP.NET MVC. I've been able to complete a couple of tutorials on the ASP.NET MVC website and thought I would start my own project based on the MVC Music Store application.</p>\n\n<p>I can't tell where I went wrong (it all looks the same to me), but for some reason my seed data isn't creating the database.</p>\n\n<p>Item class:</p>\n\n<pre><code>namespace MySite.Models\n{\n    public class Item\n    {\n        public int Id { get; set; }\n        public string Name { get; set; }\n    }\n}\n</code></pre>\n\n<p>Tag class:</p>\n\n<pre><code>namespace MySite.Models\n{\n    public class Tag\n    {\n        public int Id { get; set; }\n        public string Name { get; set; }\n    }\n}\n</code></pre>\n\n<p>ItemTag class:</p>\n\n<pre><code>namespace MySite.Models\n{\n    public class ItemTag\n    {\n        public int Id { get; set; }\n        public int ItemId { get; set; }\n        public int TagId { get; set; }\n    }\n}\n</code></pre>\n\n<p>MySiteEntities class:</p>\n\n<pre><code>namespace MySite.Models\n{\n    public class MySiteEntities : DbContext\n    {\n        public DbSet&lt;Item&gt; Items { get; set; }\n        public DbSet&lt;Tag&gt; Tags { get; set; }\n        public DbSet&lt;ItemTag&gt; ItemTags { get; set; }\n    }\n}\n</code></pre>\n\n<p>Global.asax class:</p>\n\n<pre><code>namespace MySite\n{\n    public class MvcApplication : System.Web.HttpApplication\n    {\n        ...\n\n        protected void Application_Start()\n        {\n            System.Data.Entity.Database.SetInitializer(new MySite.Models.SampleData());\n\n            AreaRegistration.RegisterAllAreas();\n\n            RegisterGlobalFilters(GlobalFilters.Filters);\n            RegisterRoutes(RouteTable.Routes);\n        }\n    }\n}\n</code></pre>\n\n<p>Web.config file:</p>\n\n<pre><code>&lt;configuration&gt;\n  ...\n\n  &lt;connectionStrings&gt;\n    &lt;add name=\"MySiteEntities\"\n      connectionString=\"Data Source=|DataDirectory|MySite.sdf\"\n      providerName=\"System.Data.SqlServerCe.4.0\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>SampleData class:</p>\n\n<pre><code>namespace MySite.Models\n{\n    public class SampleData : DropCreateDatabaseIfModelChanges&lt;MySiteEntities&gt;\n    {\n        protected override void Seed(MySiteEntities context)\n        {\n            new List&lt;Item&gt;\n            {\n                new Item { Id = 1, Name = \"Bob Jones\" },\n                new Item { Id = 2, Name = \"George Smith\" },\n                new Item { Id = 3, Name = \"Boys and Girls\" },\n                new Item { Id = 4, Name = \"The President's Hair\" },\n                new Item { Id = 5, Name = \"Invaders From Mars\" },\n                new Item { Id = 6, Name = \"Tank Shooter\" },\n                new Item { Id = 7, Name = \"Stew's Blog\" },\n                new Item { Id = 8, Name = \"Social Mania\" }\n            }.ForEach(i =&gt; context.Items.Add(i));\n\n            new List&lt;Tag&gt;\n            {\n                new Tag { Id = 1, Name = \"Author\" },\n                new Tag { Id = 2, Name = \"Movie\" },\n                new Tag { Id = 3, Name = \"Video Game\" },\n                new Tag { Id = 4, Name = \"Website\" }\n            }.ForEach(t =&gt; context.Tags.Add(t));\n\n            new List&lt;ItemTag&gt;\n            {\n                new ItemTag { Id = 1, ItemId = 1, TagId = 1 },\n                new ItemTag { Id = 2, ItemId = 2, TagId = 1 },\n                new ItemTag { Id = 3, ItemId = 3, TagId = 2 },\n                new ItemTag { Id = 4, ItemId = 4, TagId = 2 },\n                new ItemTag { Id = 5, ItemId = 5, TagId = 3 },\n                new ItemTag { Id = 6, ItemId = 6, TagId = 3 },\n                new ItemTag { Id = 7, ItemId = 7, TagId = 4 },\n                new ItemTag { Id = 8, ItemId = 8, TagId = 4 }\n            }.ForEach(x =&gt; context.ItemTags.Add(x));\n        }\n    }\n}\n</code></pre>\n\n<p>That's pretty much everything. I did delete the database file at one point. Shouldn't it get created again when I build the solution?</p>\n"},{"tags":["c#","linq","entity-framework","c#-4.0","reflection"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12881866,"title":"Set Properties that not null using linq and reflection","body":"<p>I have a <code>Update</code> method like this:</p>\n\n<pre><code>public void Update(MyClass item, System.Linq.Expressions.Expression&lt;Func&lt;MyClass, bool&gt;&gt; exp)\n</code></pre>\n\n<p>and I update status field like this:</p>\n\n<pre><code>MyClass  u = ent.MyClass.Where(exp).FirstOrDefault();\nif (u == null)\n{\n    throw new Exception(\"No Record Found\");\n}\nelse\n{\n    u.Status=item.Status;              &lt;-------\n    ent.SaveChanges();\n}\n</code></pre>\n\n<p>ok ,the problem is I want to use this update method for various updates for example user may want to update <code>status,Name</code> or <code>Tel,fax,Address,name</code> and ...</p>\n\n<p>I want to check I property isn't null it assign to similar property of selected object(in line that show with arrow). How I can to this automatically ? I don't want wtite like this:</p>\n\n<pre><code>if(item.Status != null)\n{\n     u.Status = item.Status;\n}\nif(item.Name != null)\n{\n     u.Name = item.Name;\n}\n,....\n</code></pre>\n\n<p>thanks</p>\n"},{"tags":["entity-framework","azure","asp.net-mvc-4","sql-server-ce-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12859176,"title":"Using SQL Server CE 4.0 with Entity Framework on Windows Azure","body":"<p>I am using SQL Server CE 4.0 with WebApi on Windows Azure Websites. I have been successfully able to deploy SQL Server CE. The weird problem I am facing is that my site is able to log me in using the same DB but I am not able to use any of the controllers to fetch the data. </p>\n\n<p>I am using same connection string for both. The only difference is that for logging in I am using WebSecurity as I have enabled OAuth on the site.</p>\n\n<p>Can someone throw some light on how to debug and fix this issue? The error I am getting for the calls is </p>\n\n<blockquote>\n  <p><em>Format of the initialization string does not conform to specification\n  starting at index 0.</em></p>\n</blockquote>\n\n<p>However the same string works for authentication, change password, adding OAuth connections etc.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["entity-framework","validation","updates"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12871892,"title":"Entity Framework validation with partial updates","body":"<p>I'm using Entity Framework 5.0 with DbContext and POCO entities. There's a simple entity containing 3 properties:</p>\n\n<pre><code>public class Record\n{\n    public int Id { get; set; }\n    public string Title { get; set; }\n    public bool IsActive { get; set; }\n}\n</code></pre>\n\n<p>The Title field is always unmodified, and the UI simply displays it without providing any input box to modify it. That's why the <code>Title</code> field is set to <code>null</code> when the form is sent to the server.</p>\n\n<p>Here's how I tell EF to perform partial update of the entity (<code>IsActive</code> field only):</p>\n\n<pre><code>public class EFRepository&lt;TEntity&gt;\n{\n   ...\n   public void PartialUpdate(TEntity entity, params Expression&lt;Func&lt;TEntity, object&gt;&gt;[] propsToUpdate)\n   {\n       dbSet.Attach(entity);\n       var entry = _dbContext.Entry(entity);\n       foreach(var prop in propsToUpdate)\n           contextEntry.Property(prop).IsModified = true;\n   }\n}\n</code></pre>\n\n<p>and the call:</p>\n\n<pre><code>repository.PartialUpdate(updatedRecord, r =&gt; r.IsActive);\n</code></pre>\n\n<p>Calling <code>SaveChanges</code> method, I get the <code>DbEntityValidationException</code>, that tells me, <code>Title</code> is required. When I set <code>dbContext.Configuration.ValidateOnSaveEnabled = false</code>, everything is OK.\nIs there any way to avoid disabling validation on the whole context and to tell EF not to validate properties that are not being updated?\nThanks in advance.</p>\n"},{"tags":["entity-framework","entity-framework-5","telerik-open-access"],"answer_count":0,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":702,"score":4,"question_id":11255583,"title":"Entity Framework 5 vs Telerik OpenAccess ORM (specifically)","body":"<p>I am starting a new project and want advice on choosing an ORM. I know this topic has been brought up before, but this topic is specific to either Entity Framework 5 (not 4) or Telerik OpenAccess ORM.</p>\n\n<p>The project will reside on Windows Azure and use Windows Azure SQL Database. I will migrate it to .NET 4.5 once 4.5 is live on Azure.</p>\n\n<p>I am currently a Telerik Ultimate Collection subscriber.</p>\n\n<p>Does anyone in the know have any pros/cons for this scenario? I am slightly leaning towards Telerik OpenAccess at the moment.</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12840333,"title":"Reattaching an object when PK is datetime based","body":"<p>My system is database first, EF 4.3.1.</p>\n\n<p>I have a table in which the PK is composed of two int columns and a datetime.\nThe table is a 'comment' table, to keep comments..</p>\n\n<pre>\nCREATE TABLE [dbo].[ArticleComments](\n    [ArticleId] [int] NOT NULL,\n    [UserId] [int] NOT NULL,\n    [MessageText] [nvarchar](max) NOT NULL,\n    [CreatedAt] [datetime] NOT NULL,\n    [ExternalData] [bigint] NULL,\n    CONSTRAINT [PK_ArticleComments] PRIMARY KEY CLUSTERED \n    (\n       [ArticleId] ASC,\n       [UserId] ASC,\n       [CreatedAt] ASC\n    )\n)\n</pre>\n\n<p>In my logic, when a comment is created, I send the ArticleComment object to another thread, where another context is opened to do additional actions on the object, in which eventually the object may be saved.</p>\n\n<p>The problem is, when the object is later saved, it sometimes throws an exception that nothing was saved.</p>\n\n<p>I opened the profiler to see what SQL is executed on <code>SaveChanges()</code></p>\n\n<pre>\nexec sp_executesql N'update [dbo].[ArticleComments]\nset [ExternalData] = @0\nwhere ((([ArticleId] = @1) and ([UserId] = @2)) and ([CreatedAt] = @3))\n',N'@0 bigint,@1 int,@2 int,@3 datetime2(7)',@0=3243423,@1=6931,@2=2,@3='2012-10-11 11:23:25.4734801'\n</pre>\n\n<p>And found out that the problem is that EF was mapping it to a datetime2(7) in stand of regular datetime, which is why this update will not change anything and the exception is thrown.</p>\n\n<p>I checked the EDMX file, over there it says the type is datetime with precision 3.</p>\n\n<p>FYI: <a href=\"http://msdn.microsoft.com/en-US/library/ms187819%28v=SQL.90%29.aspx\" rel=\"nofollow\">in addition, datetime is rounded in SQL Server</a></p>\n\n<p>SO, i found this article: <a href=\"http://stackoverflow.com/questions/2872444/round-net-datetime-milliseconds-so-it-can-fit-sql-server-milliseconds\">Round .NET DateTime milliseconds, so it can fit SQL Server milliseconds</a>\nWhich shows a nice way to round .net time to SQL time. And I think there is a class for this in <strike>the framework</strike> <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=29065\" rel=\"nofollow\">Microsoft® System CLR Types for Microsoft® SQL Server® 2012</a> at <code>System.Data.SqlTypes</code> called <code>SqlDateTime</code> that will do the same.</p>\n\n<p>So my code looks like this (using the extension from the SO answer just linked):</p>\n\n<pre>\n hack the time -->  message.CreatedAt = message.CreatedAt.RoundToSqlServerDateTime();\n                    db.ArticleComments.Attach(message);\n                    message.ExternalData = someNumber;\n                    db.SaveChanges();\n</pre>\n\n<p>And it works.</p>\n\n<p><strong>But all of these are hacks, not solutions. Why is EF failing here, what am I doing incorrectly?</strong></p>\n"},{"tags":["entity-framework","ef-code-first","updating"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12879198,"title":"How can I update a detached entity in EF CF multi-tier application?","body":"<p>I'm developing a multi-tier app using EF CF . I managed to delete a detached entity this way:</p>\n\n<pre><code>       public void Delete(DbSet MySet, object Obj)\n        {\n            MySet.Attach(Obj);\n            var Entry = this.Entry(Obj);\n            Entry.State = EntityState.Deleted;\n            this.SaveChanges();\n        }\n</code></pre>\n\n<p>This method is defined in a class I called Adapter:DbContext.\nThe thing is, when updating, similar code doesn't work:</p>\n\n<pre><code> public void Update(DbSet MySet, object Obj)             \n    {\n        MySet.Attach(Obj);\n        var Entry = this.Entry(Obj);\n        Entry.State = EntityState.Modified;\n        this.SaveChanges();\n    }\n</code></pre>\n\n<p>This does not update the database nor throw any exceptions\nHow should I update a detached entity?</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12874556,"title":"EF (code-first): How should I change the value of a 1:1 association?","body":"<p>I have a <code>File</code> entity and a <code>User</code> entity. The <code>File</code> entity has a 1:1 relationship with the <code>User</code> entity through a property called <code>LastChangeUser</code> (this records the user who last changed the file). There's also a field within the <code>File</code> entity named <code>LastChangeUserId</code>, which is the actual FK relationship. The relationship is one-way: the <code>User</code> entity has no navigation property leading back to the <code>File</code> entity.</p>\n\n<pre><code>class File\n{\n    public int Id { get; set; }\n\n    public int? LastChangeUserId { get; set; }\n    public virtual User LastChangeUser { get; set; }\n}\n\nclass User\n{\n    public int Id { get; set; }\n}\n</code></pre>\n\n<p>When a <code>File</code> is changed, I need to set the <code>LastChangeUser</code> for the <code>File</code>. I only have the ID of the user to hand, not the complete User object. So, I'm doing this:</p>\n\n<pre><code>file.LastChangeUser = null;\nfile.LastChangeUserId = userId;\n</code></pre>\n\n<p>This seems to work on creating the file, when the <code>File</code> object is newly-created (a POCO which is then added to the entity collection).</p>\n\n<p>However, it does not work when updating the file, when the <code>File</code> object is an existing object retrieved (as a proxy) from the DB. </p>\n\n<p>In the latter case, I end up with a NULL in the DB for the <code>LastChangeUserId</code> field. (After a call to SaveChanges, the object has <code>null</code> in both the <code>LastChangeUser</code> and <code>LastChangeUserId</code> fields).</p>\n\n<p>Maybe I'm just doing the wrong thing here? What's the right way? Do I really need to go get the <code>User</code> object in order to set the <code>LastChangeUser</code> property?</p>\n"},{"tags":[".net","entity-framework","exception-handling"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":228,"score":0,"question_id":3578321,"title":"Determine source of a ConstraintException in an EF entity","body":"<p>I have an entity class with a bunch of non-nullable string properties.  If I try and set one of these to null, I get a <strong>ConstraintException</strong> and the message \"<em>This property cannot be set to a null value.</em>\"</p>\n\n<p>Without setting tracker variable to the name of each property before assignment, is there a way I can determine which property assignment caused the exception to be thrown?</p>\n"},{"tags":["entity-framework","char","contains"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12872651,"title":"Slow linq query when looking for char(1) datatype using contains","body":"<p>I've got an old database with a char(1) Status column. I'm using code first and entity framework 4.3.1 to interact with my database. My Status column in my code first class is defined as follows:</p>\n\n<pre><code>[Column(TypeName = \"char\")]\npublic string Status { get; set; }\n</code></pre>\n\n<p>I'm writing a linq query to fetch all items with a Status of one of several values. The code looks something like this (although it's been simplified):</p>\n\n<pre><code>List&lt;string&gt; statusList = new List&lt;string&gt;() {\"N\",\"H\",\"P\"};\n...\nvar entries = (from t in context.MyTable where statusList.Conains(t.Status)).ToList();\n...\n</code></pre>\n\n<p>The SQL thats generated prefixes all the Status values with N making the query quite slow.</p>\n\n<pre><code>WHERE ([Extent1].[Status] IN (N'N', N'P', N'P'))\n</code></pre>\n\n<p>It seems to be because it's comparing unicode with non unicode so it can't use the index on the Status column.</p>\n\n<p>I've had similar problems before in other linq queries, but I thought they were solved by putting [Column(TypeName = \"char\")] on the property.</p>\n\n<p>Does anyone know how I prevent SQL from putting those N's in front of all my Status values? I tried making statusList a List of char, but then I needed to change the definition of the Status column to char in code first, but that threw errors.</p>\n\n<p>Thanks\nDavid</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12874012,"title":"Typed Ids in entity framework","body":"<p>On the client side (WPF or Silverlight for example), I usually model entity ids by creating a id class for each entity:</p>\n\n<pre><code>class CarId { public readonly int Id; ... } // or string or Guid etc\n</code></pre>\n\n<p>so that I can have strongly typed ids and I won't have to pass around ints (or string or guid) without type information:</p>\n\n<pre><code>class Car { public CarId Id { get; private set; } ... }\n</code></pre>\n\n<p>(A similar reusable way is to create a generic class Id and have Id).</p>\n\n<p>Being new to entity framework and not having done a lot of back-end work, I wonder, is it possible to have entity framework map typed ids like those to primary key (integer/string/guid) table columns in the db? Initially I'd like to be able to use code-first.</p>\n"},{"tags":["c#","entity-framework","ado.net","entity"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12876677,"title":"visual studio 2010 cannot populate ado net entity framework data model","body":"<p>i'm trying to use ado net entity framework 4 with visual studio 2010, but i'm having some issues.\ni've created a data connection to a remote sql server, and now i'm trying to create a data model, the wizard goes ok, up until the ending part when i'm presented with the following error:</p>\n\n<blockquote>\n  <p>Unable to generate the model because of the following exception: 'An\n  error occurred while executing the command definition. See the inner\n  exception for details.    A transport-level error has occurred when\n  sending the request to the server. (provider: TCP Provider, error: 0 -\n  An established connection was aborted by the software in your host\n  machine.) '.</p>\n</blockquote>\n\n<p>i've checked and remoting is working. i can browse the database using visual studio, but the model isn't configured. i've tried refreshing the model from database and the same problem occurs. </p>\n\n<p>can anyone give some pointers on how to create the model without any issues?</p>\n\n<p>thanks in advance</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12876625,"title":"EF Create ViewModel from two sources","body":"<p>I have a need to get information from one source i.e. a list of Clients and add an array against each one from another source.  I essentially need a viewmodel like:</p>\n\n<pre><code>public class myVM\n{\n    public Client Client { get;set; }\n    public IEnumerable&lt;Target&gt; Targets { get;set; }\n}\n</code></pre>\n\n<p>Usually I would create a virtual and relationship between these and would perform nicely, but in this case the 'Targets' are not simply linked by a key/id, there will be some code in between that picks certain targets from the source so I need to add the Client and run the code that picks relevant targets and adds them in to the array above.</p>\n\n<p>This will work but obviously can perform slowly as requires MultipleDataSets running as well.  Does anyone know of a way to include an unmapped/unlinked object on a class setup for EF that you can simply add items to manually OR propose a better solution than this?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12874501,"title":"Having troubles with a particular Linq-To-Entity expression","body":"<p>I'm still learning the ropes for Entity expressions, and I have this SQL query that I would like to implement into a Entity expression, the query is:</p>\n\n<pre><code>SELECT classname,abbreviation, cid\n            FROM [db].[dbo].[classes] AS c\n            WHERE c.cid IN (\n                SELECT DISTINCT(CID)\n                FROM [db].[dbo].[CDS]\n                WHERE \n                        sid = '1'\n                        AND\n                        did = '24'\n                    )\n            ORDER BY abbreviation, classname \n</code></pre>\n\n<p>How would I go about implementing that query into an Entity expression?</p>\n"},{"tags":["asp.net-mvc","entity-framework","viewmodel","automapper","dto"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":117,"score":2,"question_id":12874328,"title":"Domain vs DTO vs ViewModel - How and When to use them?","body":"<p>In a Multi-layer project with Domain layer (DL)/Business (Service) Layer (BL)/Presentation Layer (PL), what is the best approach to deliver Entities to the Presentation Layer?</p>\n\n<pre><code>D =&gt; Domain Object;\nDTO = Domain Transfer Object;\nVM =&gt; View Model;\nV =&gt; View;\n</code></pre>\n\n<p>Option 1:</p>\n\n<pre><code>DL =&gt; DO =&gt; BL =&gt; DTO =&gt; PL =&gt; VM =&gt; V\n</code></pre>\n\n<p>This option seems to be the Best Practice but also seems heavy to mantain.</p>\n\n<p>Option 2:</p>\n\n<pre><code>DL =&gt; DO =&gt; BL =&gt; DTO =&gt; PL =&gt; V\n</code></pre>\n\n<p>This option seems not very good practice but as DTO are almost identical to the VM, we can pass it directly to the View and it's less painfull to implement and mantain.</p>\n\n<p>Is this option also reliable for multiple layouts, for example, for Mobile Devices I may need less information from the BL, so I will need a diferent VM for this particular Layout?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","foreign-keys","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":12868912,"title":"Specify ON DELETE NO ACTION in ASP.NET MVC 4 C# Code First","body":"<p>How do I specify ON DELETE NO ACTION Foreign Key Constraint in my model designs?</p>\n\n<p>At present, I have:</p>\n\n<pre><code>public class Status\n{\n    [Required]\n    public int StatusId { get; set; }\n\n    [Required]\n    [DisplayName(\"Status\")]\n    public string Name { get; set; }\n}\n\npublic class Restuarant\n{\n    public int RestaurantId { get; set; }\n    [Required]\n    public string Name { get; set; }\n    [Required]\n    [EmailAddress]\n    public string Email { get; set; }\n    [Required]\n    public string Telephone { get; set; }\n    [Required]\n    public int StatusId { get; set; }\n    public List&lt;Menu&gt; Menus { get; set; }\n\n    // NAVIGATION PROPERTIES\n    public virtual Status Status { get; set; }\n}\n\npublic class Menu\n{\n    public int MenuId { get; set; }\n\n    [Required]\n    public int RestaurantId { get; set; }\n\n    [Required]\n    public string Name { get; set; }\n\n    [Required]\n    public int StatusId { get; set; }\n\n    // NAVIGATION PROPERTIES\n    public virtual Status Status { get; set; }\n    public virtual Restaurant Restaurant { get; set; }\n}\n</code></pre>\n\n<p>And my DbContext:</p>\n\n<pre><code>public class MenuEntities : DbContext\n{\n    public DbSet&lt;Status&gt; Statuses { get; set; }\n    public DbSet&lt;Restaurant&gt; Restaurants { get; set; }\n    public DbSet&lt;Menu&gt; Menus { get; set; }\n}\n</code></pre>\n\n<p>As you can see: </p>\n\n<ul>\n<li>a Restaurant has many menus</li>\n<li>a Restaurant has one status</li>\n<li>a Menu belongs to 1 restaurant</li>\n<li><strong>Both Restaurants and Menus have 1 status. (Live, Invisible, Draft)</strong></li>\n</ul>\n\n<p>Naturally, if a status is deleted, I certainly don't want to cascade as this will muck everything up.</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>Mark Oreta mentions using the following in his example below:      </p>\n\n<pre><code>modelBuilder.Entity&lt;FirstEntity&gt;() \n    .HasMany(f =&gt; f.SecondEntities) \n    .WithOptional() \n    .WillCascadeOnDelete(false); \n</code></pre>\n\n<p>Where do I put this code? Within my MenuEntities / DbContext class? \nCan anybody provide an example of this being used?</p>\n\n<p><strong>UPDATE:</strong> \nGot this bit working now, however this has created a multiplicity constraint error when trying to seed the DB...</p>\n\n<pre><code>Multiplicity constraint violated. The role 'Menu_Status_Source' of the relationship 'LaCascadaWebApi.Models.Menu_Status' has multiplicity 1 or 0..1.\n</code></pre>\n\n<p>My Database Initialiser:</p>\n\n<p><a href=\"http://pastebin.com/T2XWsAqk\" rel=\"nofollow\">http://pastebin.com/T2XWsAqk</a></p>\n"},{"tags":["wcf","entity-framework","iis","entity-framework-4","autofac"],"answer_count":1,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":149,"score":3,"question_id":12865268,"title":"Entity Framework consuming a lot of memory (possible memory leak?)","body":"<p>We are using EF4.3.1 in a WCF service ( our business \\ application layer). We are using EF Code First with existing database and Fluent Mapping (EntityTypeConfiguraiton). \nAn instance of DbContext is created for each request and then disposed off. </p>\n\n<p>We have a generic repository which uses the DbContext. </p>\n\n<p>When running on test servers we found that the Business layer app pool is going out of memory in 30 mins or so with 10 concurrent users. We took dump of the IIS worker process and found that EF is consuming a lot of memory, there were many object in on large object heap created by EF. We could see objects for data retrieved from th DB on the heap. Not sure if the DbContext dispose is taking care of this. The % time in GC was very high (> 16%).\nOne strange thing we noticed in the dump file was, there was a huge string object  (around 87MB) storing string representation of all my mapping files. I found this to be very strange,</p>\n\n<p>Has anybody encountered any such memory leak issue with EF? Also please also let us know if there is something wrong in our usage of EF. Please let me know if more details are required.</p>\n\n<p>Thanks\nPrasad</p>\n\n<p><strong>EDIT</strong>\nWe inject an instance of DbContext using AutiFac DI (WCF integration). The life time for Dbcontext is InstancePerLifeTime ( one request per http request). We have implemented this way to share the instance of DbContext in all repositories instances in one HTTPrequest.</p>\n\n<p>The way we access database is \n// declaration\nIGenericRepository UserRepository {get;set;} // Property injection using AutoFac</p>\n\n<p>// Usage\nvar user = UserRepository.FindBy(u => u.userid == \"test@test.com\");</p>\n\n<p>We are not using explicit transactions in repositories. </p>\n"},{"tags":["c#","wpf","entity-framework","repository"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":12802157,"title":"Unit of work / what am I doing wrong / right?","body":"<p>I am using C#, WPF and EF 5</p>\n\n<p>I am creating my first EF application. The application has lots of master data to handle, so I implemented a generic repository:</p>\n\n<pre><code>public class PqsRepository&lt;E&gt; : IDisposable where E : BaseEntity\n{\n    private PqsDbContext _context;\n\n    public PqsRepository(PqsDbContext context)\n    {\n       _context = context;\n    }\n\n    public void Insert(E entity)\n    {\n        _context.Set&lt;E&gt;().Add(entity);\n    }\n\n    public void Update(E entity)\n    {\n        _context.Set&lt;E&gt;().Attach(entity);\n        _context.Entry&lt;E&gt;(entity).State = EntityState.Modified;\n    }\n\n    public void Delete(E entity)\n    {\n        _context.Set&lt;E&gt;().Attach(entity);\n        _context.Entry&lt;E&gt;(entity).State = EntityState.Deleted;\n    }\n\n    public int SaveChanges()\n    {\n        return _context.SaveChanges();\n    }\n\n    public IQueryable&lt;E&gt; Select()\n    {\n       return _context.Set&lt;E&gt;();\n    }\n\n    public E Select(object key)\n    {\n       return _context.Set&lt;E&gt;().Find(key);\n    }\n\n    public  void Dispose()\n    {\n        if (_context != null)\n            _context.Dispose();\n    }\n\n    public void InsertOrUpdate(E entity)\n    {\n        _context.Set&lt;E&gt;().Attach(entity);\n        _context.Entry&lt;E&gt;(entity).State = entity.Id == 0?\n                                  EntityState.Added :\n                                  EntityState.Modified;\n    }\n</code></pre>\n\n<p>I have my unit of work class:</p>\n\n<pre><code>class UnitOfWork\n{\n    private PqsDbContext _context;\n    private PqsRepository&lt;Unit&gt; _unitrepo;\n    private PqsRepository&lt;Translation&gt; _translationrepo;\n    private PqsRepository&lt;TranslationItem&gt; _translationitemrepo;\n\n    public UnitOfWork(PqsDbContext context)\n    {\n        _context = context;\n        _unitrepo = new PqsRepository&lt;Unit&gt;(_context);\n        _translationrepo = new PqsRepository&lt;Translation&gt;(_context);\n        _translationitemrepo = new PqsRepository&lt;TranslationItem&gt;(_context);\n    }\n</code></pre>\n\n<p>Nearly every master data class has a property of type <code>Translation</code>. And a translation has 1 to n translation items (different languages). To save a <code>MasterData</code> entity I have implemented a <code>Save</code> function on the unit of work:</p>\n\n<pre><code>    public void SaveUnit(Unit u)\n    {\n            _unitrepo.Update(u);\n            _translationrepo.InsertOrUpdate(u.Name);\n            foreach (TranslationItem ti in u.Name.Translations)\n                _translationitemrepo.InsertOrUpdate(ti);\n\n            _context.SaveChanges();\n    }\n</code></pre>\n\n<p>Question 1: How can I save the unit + translations without looping and saving all translation items?</p>\n\n<p>Question 2: Do I need a separate unit of code class for every master data I have?</p>\n\n<p>Question 3: what else am I missing?</p>\n"},{"tags":["entity-framework","caching","azure"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":92,"score":2,"question_id":12871770,"title":"Entity Framework second level cache and Windows Azure cache","body":"<p>We are running our application in Windows Azure. We are experiencing performance problems with SQL Azure so we are looking into implementing a second level cache. With the ORM that we are currently using this is quite difficult to accomplish.</p>\n\n<p>What about Entity Framework second level cache? Specifically when using Windows Azure cache(*). I know that it is currently not supported out-of-the-box and that are are some wrappers available. But are there any future plans on supporting this out-of-the-box?</p>\n\n<p>(*)\nThe idea is to use a certain percentage of the Web roles memory for caching.\nFor example using 5 medium Web roles and 20% memory for cache will mean a consistent cache of 3.5 GB.</p>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":138,"score":5,"question_id":12693961,"title":"Overriding entity deletion with associations","body":"<p>I am trying to implement a soft delete feature in my project by overriding the <code>DbContext.SaveChanges()</code> method and undoing the deletion of any entities which implement my <code>ISoftDelete</code> interface.</p>\n\n<pre><code>interface ISoftDelete\n{\n  bool IsDeleted { get; set; }\n}\n</code></pre>\n\n<p>In the <code>SaveChanges()</code> method I am calling my SoftDelete() method for every entry that is in the 'deleted' state and implements <code>ISoftDelete</code>.:</p>\n\n<pre><code>var entries = this.ChangeTracker.Entries().Where(x =&gt; (x.State == EntityState.Deleted) &amp;&amp; x.Entity is ISoftDelete)\n                    .ToList();\n                entries.ForEach(SoftDelete);\n</code></pre>\n\n<p>My <code>SoftDelete()</code> method is as follows:</p>\n\n<pre><code>private void SoftDelete(DbEntityEntry entry)\n{\n    if (entry.State == EntityState.Deleted &amp;&amp; entry.Entity is ISoftDelete)\n    {\n        entry.Reload();\n        var entity = (ISoftDelete)entry.Entity;\n        entity.IsDeleted = true;\n        entry.State = EntityState.Modified;\n    }\n}\n</code></pre>\n\n<p>This will work perfectly until I run into an entity which has a one to one association to something else. At which point, an exception is thrown with this error:</p>\n\n<blockquote>\n  <p>{\"A relationship from the 'ChildParent' AssociationSet is in\n  the 'Deleted' state. Given multiplicity constraints, a corresponding\n  'Parent' must also in the 'Deleted' state.\"}</p>\n</blockquote>\n\n<p>Is there a way to get all the associations for that entity and change the deleted state for them as well?</p>\n\n<p>I've already tried getting the reference to the actual associated entity but the entity's <code>EntityState</code> is set to <code>Unchanged</code> instead of <code>Deleted</code>.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12869711,"title":"Can I see what's in the ObjectStateManager when debugging?","body":"<p><strong>BACKGROUND</strong></p>\n\n<p>I'm having some trouble with updating an entity in EF. I keep getting this error:</p>\n\n<p><strong>\"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key\"</strong></p>\n\n<p>I am fully aware that there is obviously another entity somewhere that is attached. However, I currently cannot track it down. There is a lot of code and I've spent quite some time on it already. As far as I can see, I am using the <code>AsNoTracking()</code> extension method on all my queries.</p>\n\n<p><strong>WHAT I NEED</strong></p>\n\n<p>My question is this: Is there any way I can see what is actually in the <strong>ObjectStateManager</strong> at any given time? If I can see the items in there during debugging, I can more quickly track down where this is coming from.</p>\n\n<p>If the above is not possible, I would appreciate any advice on how best to tackle this problem.. it's like a needle in a haystack right now.</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":727,"score":8,"question_id":6038541,"title":"EF: Validation failing on update when using lazy-loaded, required properties","body":"<p>Given this extremely simple model:</p>\n\n<pre><code>public class MyContext : BaseContext\n{\n    public DbSet&lt;Foo&gt; Foos { get; set; }\n    public DbSet&lt;Bar&gt; Bars { get; set; }\n}\n\npublic class Foo\n{\n    public int Id { get; set; }\n    public int Data { get; set; }\n    [Required]\n    public virtual Bar Bar { get; set; }\n}\n\npublic class Bar\n{\n    public int Id { get; set; }\n}\n</code></pre>\n\n<p>The following program fails:</p>\n\n<pre><code>object id;\nusing (var context = new MyContext())\n{\n    var foo = new Foo { Bar = new Bar() };\n    context.Foos.Add(foo);\n    context.SaveChanges();\n    id = foo.Id;\n}\nusing (var context = new MyContext())\n{\n    var foo = context.Foos.Find(id);\n    foo.Data = 2;\n    context.SaveChanges(); //Crash here\n}\n</code></pre>\n\n<p>With a <code>DbEntityValidationException</code>. The message found in <code>EntityValidationErrors</code> is <em>The Bar field is required.</em>.</p>\n\n<p>However, if I force loading of the <code>Bar</code> property by adding the following line before <code>SaveChanges</code>:</p>\n\n<pre><code>var bar = foo.Bar;\n</code></pre>\n\n<p>Everything works fine. This also works if I remove the <code>[Required]</code> attribute.</p>\n\n<p>Is this really the expected behavior? Are there any workarounds (besides loading every single required reference every time I want to update an entity)</p>\n"},{"tags":["sql-server","database","visual-studio-2010","entity-framework","ef-model-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12868636,"title":"Create database and add to Visual Studio solution","body":"<p>I am creating a database with Entity Framework 4 and Visual Studio 2010.</p>\n\n<p>I am fine with the first steps - I am going model first, so I successfully created the model and now there is a valid .edmx file in my solution.</p>\n\n<p>My goal is the following: I want to generate the database and add it to the solution so I can give the solution to another person and they will be able to build it and run it - I do not want the database connection be dependent on any of my local settings, and I do not want them to have the need to recreate the database, it will have some 'seed data' in it. That should be possible, I saw similar solutions.</p>\n\n<p>I would appreciate advice on how to do that.</p>\n"},{"tags":[".net","entity-framework","collections","ienumerable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2925,"score":0,"question_id":2273958,"title":"Convert IEnumerable to EntityCollection Entity Framework 4","body":"<p>I have generated the following code with Entity Framework 4 for a navigation property:</p>\n\n<pre><code>&lt;XmlIgnoreAttribute()&gt;\n&lt;SoapIgnoreAttribute()&gt;\n&lt;DataMemberAttribute()&gt;\n&lt;EdmRelationshipNavigationPropertyAttribute(\"Diagnose\", \"Request_Comments\", \"Comment\")&gt;\nPublic Property Comments() As EntityCollection(Of Comment)\n    Get\n        Return CType(Me,IEntityWithRelationships).RelationshipManager.GetRelatedCollection(Of Comment)(\"Diagnose.Request_Comments\", \"Comment\")\n    End Get\n    Set\n        If (Not value Is Nothing)\n            CType(Me, IEntityWithRelationships).RelationshipManager.InitializeRelatedCollection(Of Comment)(\"Diagnose.Request_Comments\", \"Comment\", value)\n        End If\n    End Set\nEnd Property\n</code></pre>\n\n<p>When I want to reduce the results from the GET by adding a WHERE-Clause to it like this</p>\n\n<pre><code>Return CType(Me,IEntityWithRelationships).RelationshipManager.GetRelatedCollection(Of Comment)(\"Diagnose.Request_Comments\", \"Comment\") _\n.Where(Function(p) p.IsDeleted = False)\n</code></pre>\n\n<p>or by using Linq</p>\n\n<pre><code>Return From x In CType(Me,IEntityWithRelationships).RelationshipManager.GetRelatedCollection(Of Comment)(\"Diagnose.Request_Comments\", \"Comment\") _\nWhere x.IsDeleted = False Select x\n</code></pre>\n\n<p>the following Exception is thrown when I run the application :</p>\n\n<pre><code>Unable to cast object of type 'WhereEnumerableIterator`1[DAL.Comment]' to type 'System.Data.Objects.DataClasses.EntityCollection`1[DAL.Comment]'.\n</code></pre>\n\n<p>I don't know how to convert the result (which is an IEnumerable i think) from the query to an EntityCollection. I tried to add a \".ToList\" but that didn't help.<br>\nDoes anybody know a solution to that problem or a better way to kick out the deleted items from the collection?</p>\n"},{"tags":["c#","sql-server","entity-framework","entitykey"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12867924,"title":"Entity Framework Insert Error When 2 EntityKeys Being Used","body":"<p>Following is a sample of the error I'm getting.  The code names and such have been changed to make it more readible and it has been 'dumbed down' to just show the parts I'm having trouble with.</p>\n\n<p><strong>TABLE STRUCTURE:</strong>\n<img src=\"http://i.stack.imgur.com/KToGx.jpg\" alt=\"Basic table layout that I'm using\"></p>\n\n<p><strong>SUMMARY</strong></p>\n\n<p>I'm trying to add a new CHILD item along with an ADDRESS using Entity Framework 3.5 and I'm getting duplicate entry errors when I use 2 entitykey references in the process.  </p>\n\n<p><strong>CODE EFFORTS</strong></p>\n\n<p>First I tried to use parent references while creating my entity's:</p>\n\n<pre><code>        public bool AddChild(Guid parentId, string firstName, string lastName, string address, string city, int provinceCode)\n    {\n        bool success = false;\n\n        using (Entities e = new Entities(\"connection string\")\n        {\n            // prep address record\n            ADDRESS a = new ADDRESS\n            {\n                City = city,\n                Address = address,\n                PROVINCEReference = new System.Data.Objects.DataClasses.EntityReference&lt;PROVINCE&gt; { EntityKey = new System.Data.EntityKey(\"Entities.PROVINCEs\", \"ID\", provinceCode) },\n            };\n\n            // prep owner record\n            CHILD c = new CHILD\n            {\n                PARENTReference = new System.Data.Objects.DataClasses.EntityReference&lt;PARENT&gt; { EntityKey = new EntityKey(\"Entities.PARENTs\", \"ID\", new Guid(parentId)) },\n                ADDRESS = a,\n                FirstName = firstName,\n                LastName = lastName,\n            };\n\n            using (System.Transactions.TransactionScope transaction = new System.Transactions.TransactionScope())\n            {\n                try\n                {\n                    e.AddToCHILDs(c);\n                    e.AddToADDRESSes(a);\n\n                    // Save changes pessimistically. This means that changes must be accepted manually once the transaction succeeds.\n                    e.SaveChanges(false);\n                }\n                catch { }\n            }\n        }\n    return success;\n}\n</code></pre>\n\n<p>This doesn't work if I try to reference both foreign keys; however, if I just try to reference one or the other it works fine.  The first one will always work.  The second one will give the error.  It doesn't matter what order they are in.  If I use them by themselves or in other methods just like this, they work fine.</p>\n\n<p>I also tried to get actual items rather than just references such as:</p>\n\n<pre><code>PARENT o = e.PARENTs.First(x =&gt; x.ID.Equals(id));\nPROVINCE p = e.PROVINCEs.First(x =&gt; x.ID.Equals(1));\n\na.PROVINCE = p;\nc.ADDRESS = a\nc.PARENT = o;\n</code></pre>\n\n<p>And, I tried playing with the .Attach() method after finding similar errors:</p>\n\n<pre><code>e.Attach(p);\ne.Attach(o);\n</code></pre>\n\n<p>When I do it the first way (my preferred manner), whichever item is added first will work with no issues.  When I try the second one I'm getting an error (An item with the same key has already been added).  If I try to do it by pulling the actual records rather than just using a reference I'm getting the same type of error directly from the SQL Server 2005 database.  </p>\n\n<p>It makes sense after reading about this that it has to do with the Context and the fact that the code may be referencing 2 different versions of the parent records; however, I can't find a good way around it. </p>\n\n<p>All I want to do in the end, is to insert a child record with a new address.  The child record must reference the parent record and the address record must reference the province record.  Preferrably, I'd like to do this via references to cut down on the sql transactions.</p>\n\n<p>Thanks!</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Tried to create 2 of my own seperate entityKey objects and 2 seperate EntityReference&lt;> objects and now I'm getting the following error when I try to use the second EntityReference&lt;> object to assign the relationship/reference:</p>\n\n<blockquote>\n  <p>The EntityReference could not be initialized, because the relationship\n  manager for object to which the entity reference belongs is already\n  attached to an ObjectContext.</p>\n</blockquote>\n\n<p><strong>EDIT</strong></p>\n\n<p>Using a workaround that doesn't need any relationship/reference information from Alex's answer at: <a href=\"http://stackoverflow.com/questions/1011519/entity-framework-entitykey-foreign-key-problem\">Entity Framework EntityKey / Foreign Key problem</a></p>\n\n<p>I would still prefer not to use this because it forces you to have to do checks to see what info is already in the context and then it creates \"fake\" records to get through it as a work-around.  If anyone has any more info I'd love to hear!</p>\n"},{"tags":["entity-framework","ef-code-first","wcf-data-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12868466,"title":"Entity Framework Code First (with TPC) and Wcf Data Services Mapping","body":"<p>So, I have a TPC (Type per Concrete type) hierarchy as such:</p>\n\n<p><strong>Order</strong> and <strong>OrderDetail</strong> are both concrete types derived from abstract class <strong>AuditableEntity</strong></p>\n\n<p>The configuration for AuditableEntity is:</p>\n\n<pre><code> public class AuditableEntityConfig : EntityTypeConfiguration&lt;AuditableEntity&gt;\n{\n    public AuditableEntityConfig ()\n    {\n        //this.Property(m =&gt; m.IDN).HasDatabaseGeneratedOption(DatabaseGeneratedOption.None);\n        this.HasKey(m =&gt; m.IDN);\n\n        this.Property(m =&gt; m.Timestamp).HasDatabaseGeneratedOption(DatabaseGeneratedOption.Computed).IsRowVersion().IsRequired();\n        this.Property(m =&gt; m.AddedDate).HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n        this.Property(m =&gt; m.ModifiedDate).IsOptional();\n        this.Property(m =&gt; m.ModifiedByUser).IsOptional();\n        this.Property(m =&gt; m.RowGuid).IsRequired().HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n    }\n}\n</code></pre>\n\n<p>So the idea is to have this configuration for audit-related fields in the abstract class, and this would be applied to all derived classes. The following code is used while initializing the model:</p>\n\n<pre><code>var builder = new DbModelBuilder();\nbuilder.Configurations.Add(new AuditableEntityConfig());\nbuilder.Configurations.Add(new OrderConfig());\nbuilder.Configurations.Add(new OrderDetailsConfig());\n</code></pre>\n\n<p>And the TPC settings are in the respective concrete type configurations:</p>\n\n<pre><code>Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"Order\");\n        });\n\nMap(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"OrderDetail\");\n        });\n</code></pre>\n\n<p>However, when this is accessed via a Wcf Data Service with a URL as <em>http:localhost:4040/MyService</em>, only the AuditableEntities type is exposed, and <em>http:localhost:4040/MyService/AuditableEntities</em> returns data for both concrete types, BUT <em>http:localhost:4040/MyService/Orders</em> or <em>http:localhost:4040/MyService/OrderDetails</em> does not work.</p>\n\n<p>However, if I remove the \"builder.Configurations.Add(new AuditableEntityConfig())\", then the URIs for concrete types work and return data, but that defeats the purpose of applying the abstract configurations for audit-related properties.</p>\n\n<p>The MyDbContext only exposes the Orders and OrderDetails DbSets:</p>\n\n<pre><code>public DbSet&lt;Order&gt; Orders { get; set; }\npublic DbSet&lt;OrderDetail&gt; OrderDetails { get; set; }\n</code></pre>\n\n<p>The Wcf Data Service is self-hosted in a WPF window. All permissions are given.</p>\n\n<p>What settings am I missing?</p>\n\n<p>SUPPLEMENTAL QUESTION: when i add this Service Reference to a client project, the context is named as 'CodeFirstContainer' instead of MyDbContext. Why is this?</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework","debugging","configuration","proxy","entity"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12868996,"title":"Permanently disable Configuration.ProxyCreationEnabled in EF?","body":"<p>Instead of having to do the following on every query, is there a way to just set that value globally? There is a lazyloading setting in the model view, but there does not seem to be a setting for the ProxyCreation.</p>\n\n<pre><code>        using (var context = new LabEntities())\n        {\n            **context.Configuration.ProxyCreationEnabled = false;**\n\n            var Query = from s in context.EAssets\n                        .Include(\"Server\").Include(\"Type\").Include(\"Type.Definition\")\n                        where (s.Type.Definition.b_IsScannable == true) &amp;&amp;\n                        (s.Server.s_Domain == Environment.UserDomainName || s.Server.s_Domain == null)\n                        select s;\n           var Entities = Query.ToList();\n        }\n</code></pre>\n\n<p>I don’t fully understand the benefits of this option, but i know that in visual studio is tags all my objects with gibberish serial suffixes and makes using the debugger unreasonable. </p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":348,"score":1,"question_id":10626592,"title":"How to retrieve specific columns in Entity Framework","body":"<p>Can I make my EF objects retrieve only specific columns in the sql executed?</p>\n\n<p>If I have a column that contains a large amount of data that really slows down the query, how can I have my objects exclude that column from the sql generated?</p>\n\n<p>If my table has Id(int), Name(int), Data(blob), how can I make my query be</p>\n\n<pre><code>select Id, Name from TableName\n</code></pre>\n\n<p>instead of </p>\n\n<pre><code>select Id, Name, Data from TableName\n</code></pre>\n\n<p>From the suggestion below, my method is</p>\n\n<pre><code> public List&lt;T&gt; GetBy&lt;T&gt;(DbContext context,Expression&lt;Func&lt;T, bool&gt;&gt; exp, Expression&lt;Func&lt;T,T&gt;&gt; columns) where T : class\n    {\n\n        return dbContext.Set&lt;T&gt;().Where(exp).Select&lt;T,T&gt;(columns).ToList();\n    }\n</code></pre>\n\n<p>And I'm calling it like so</p>\n\n<pre><code>List&lt;CampaignWorkType&gt; list = GetBy&lt;CampaignWorkType&gt;(dbContext, c =&gt; c.Active == true, n =&gt; new { n.Id, n.Name });\n</code></pre>\n\n<p>i got an error like below.</p>\n\n<p>Cannot implicitly convert type 'AnonymousType#1' to 'Domain.Campaign.CampaignWorkType'</p>\n\n<p>how i can solve this?</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12861305,"title":"Grabbing current DateTime using EF MVC","body":"<p>I want to apply a timestamp to my Entity Framework project. I have a class listed below. I hoped that this class would grab the current DateTime. But instead it provides me a field to enter my datetime. I want this to grab the current datetime.</p>\n\n<pre><code> public class Answer\n    {\n        public int ID { get; set; }\n        public string Answers {get; set;}\n        public System.DateTime DateCreated { get; set; }\n        public string Division { get; set; }\n        public string Phone { get; set; }\n        public string Description { get; set; }\n\n\n\n    }\n</code></pre>\n\n<p>Below is the line of code that i know is wrong. </p>\n\n<pre><code>public System.DateTime DateCreated { get; set; }\n</code></pre>\n\n<p>i am a little unsure of how to go about this. I am new to entity and new to MVC.  Any help would be greatly appreciated. </p>\n"},{"tags":["c#","entity-framework","attributes","entity"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12868017,"title":"EF 5 Is Ignoring [Required] Attribute On Int Type","body":"<p>Entity Framework 5.0.0 seems to ignore the [Required] attribute when included on an int field and automatically includes a 0 value instead of throwing an exception. The required attribute does seem to work if the field is a string though. The simple model and create function below throws no exceptions. DbContext class with DbSet Degrees not shown for brevity.</p>\n\n<pre><code>public class Degree\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    [Required]\n    public int Field { get; set; }\n}\n\n\nprivate static void CreateDegree()\n{\n    var degree = new Degree { Name = \"Mechanical Engineering\" };\n    var db = new Context();\n    db.Degrees.Add(degree);\n\n    // try statement\n}\n</code></pre>\n\n<p>This maybe a simple misunderstanding on my part, but any thoughts / help would be greatly appreciated.</p>\n"},{"tags":["entity-framework",".net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":183,"score":0,"question_id":12863041,"title":"ReleaseHandleFail after upgrading to .net 4.0, possibly related to EntityFramework","body":"<p>I recently upgraded an application from .net 3.5 to 4.0.  Since I did that, with debug settings to break on all exceptions enabled, I've been getting a few of these exceptions each time I start a section of the application that connects to a database using the EF.  The exact number is variable; sometimes I only get one, others several in rapid succession.</p>\n\n<blockquote>\n  <p>ReleaseHandleFailed was detected Message: A SafeHandle or\n  CriticalHandle of type\n  'Microsoft.Win32.SafeHandles.SafeCapiHashHandle' failed to properly\n  release the handle with value 0x06AD3D08. This usually indicates that\n  the handle was released incorrectly via another means (such as\n  extracting the handle using DangerousGetHandle and closing it directly\n  or building another SafeHandle around it.)</p>\n</blockquote>\n\n<p>I never got exceptions like this when targeting 3.5.  These exceptions don't have any meaningful call stack attached, all I get is <code>[External Code]</code>, denying any easy way to localize where they're coming from.  The reason I suspect EntityFramework is somehow involved is that one section of the app uses nHiberate instead doesn't generate any of these messages.</p>\n\n<p>To run down other dependencies that might be involved:  In all cases, the ORM is talking to an Sql Compact database MS Sync Framework 2.1 is being used to update the local DB from SqlServer.  The Entity framework models have been regenerated with the 4.0 framework, and I upgraded the cache DB to v4.0 as well.</p>\n\n<p>Since there's no call stack I'm not sure if these messages fall into the category of \"harmless\" errors automatically cleaned up internal to the framework; or if there's an exception eater catching them elsewhere in the application.</p>\n"},{"tags":["asp.net-mvc","entity-framework","azure","sql-azure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12866560,"title":"How expensive is .Include in Entity Framework?","body":"<p>I have following simple query in ASP.NET MVC action method.</p>\n\n<pre><code>IEnumerable&lt;Company&gt; query = unitOfWork.CompanyRepository.dbSet\n    .Include(\"Adresses.PhoneNumbers\")\n    .Include(\"Adresses.FaxNumber\")\n    .Include(\"Emails\").Where(q =&gt; q.CustomerCompany == true);\n</code></pre>\n\n<p>This action method is called via ajax get request and sometimes it takes up to 25 secs! for just 40 Companies in database.Each of them has single Address and at most couple of PhoneNumbers and FaxNumbers.(Interestingly it sometimes takes 200-500 msecs, but very rare)</p>\n\n<p>If I change this query to following</p>\n\n<pre><code>IEnumerable&lt;Company&gt; query = unitOfWork.CompanyRepository.dbSet\n    .Where(q =&gt; q.CustomerCompany == true);\n</code></pre>\n\n<p>It only takes around 200 msecs. </p>\n\n<p>So I am wondering why <code>.Include</code> is so expensive. My application is in production and I am using SQL Azure with Azure Web Sites.</p>\n\n<p>Thanks.</p>\n"},{"tags":["entity-framework","sql-server-2008","connection-string"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1224,"score":2,"question_id":5920765,"title":"Does the Entity Framework use a default intital catalog and what assumptions does it make?","body":"<p>I did (pretty much) everything correct in a new EF project, but I forgot to use the named connection string in the EF context class, so, it used the default.</p>\n\n<p>It created a new database inside the SQL Express default data directory, and it worked perfectly.</p>\n\n<p>When I realised my mistake (After wondering for ages why no files were showing up in the app_data folder), I renamed the class to use the named connection string and then I kept getting the following error:</p>\n\n<blockquote>\n  <p>Unable to complete operation. The\n  supplied SqlConnection does not\n  specify an initial catalog.</p>\n</blockquote>\n\n<p>I know how to fix this, but, EF is like magic to me! I can't believe it works as well as it does and I am just curious as to what it uses by default / is there a list anywhere of \"assumptions\" that EF uses on your behalf if you specify nothing?</p>\n"},{"tags":["entity-framework","connection-string","sql-server-express","code-first"],"answer_count":2,"favorite_count":12,"up_vote_count":26,"down_vote_count":0,"view_count":22430,"score":26,"question_id":4116994,"title":"SQL Express connection string for Entity Framework Code First","body":"<p>I am working in Visual Web Developer 2010 Express, and using the Entity Framework Code First CTP.  I am able to do this with the new SQL CE but I am unable to find a connection string to work with SQL Express.</p>\n\n<p>This one, using the SQL CE beta, works fine (database is created and recreated on model changes).</p>\n\n<pre><code>&lt;add name=\"TrempimModel\"\n     connectionString=\"data source=|DataDirectory|TrempimModel.sdf\"\n     providerName=\"System.Data.SqlServerCe.4.0\" /&gt;\n</code></pre>\n\n<p>this one , which I copied from the aspnetdb conections string,</p>\n\n<pre><code>&lt;add name=\"TrempimModel\"\n     connectionString=\"data source=.\\SQLEXPRESS;Integrated Security=SSPI;\n     AttachDBFilename=|DataDirectory|TrempimModel.mdf;User Instance=true\"\n     providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>Gives the following message on startup: <strong><em>Unable to complete operation. The supplied SqlConnection does not specify an initial catalog.</em></strong></p>\n\n<p>So how to make it work with SQL Express?</p>\n"},{"tags":["entity-framework","c#-4.0","entity-framework-4","self-tracking-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":188,"score":0,"question_id":7903426,"title":"Entity Framework STEs and many-To-many associations","body":"<p>I'm fairly new to EF and STE's, but I've stumbled on a painful point recently, and I'm wondering how others are dealing with it...</p>\n\n<p>For example, suppose I have two STE's: Employee and Project. It's a many-to-many relationship. Each entity has a navigation property to the other (i.e. Employee.Projects and Project.Employees).</p>\n\n<p>In my UI, a user can create/edit an Employee and associate it with multiple Projects. When the user is ready to commit, a list of Employees is passed to the server to save. However, if an Employee is not added to the \"save list\" (i.e. it was discarded), but an association was made to one or more Projects, the ApplyChanges extension method is able to \"resurrect\" the Employee object because it was \"connected\" to the object graph via the association to a Project.</p>\n\n<p>My \"save\" code looks something like this:</p>\n\n<pre><code> public void UpdateEmployees(IEnumerable&lt;Entities.Employee&gt; employees)\n {\n     using (var context = new EmployeeModelContainer(_connectionString))\n     {\n        foreach (var employee in employees)\n        {\n           context.Employees.ApplyChanges(employee);\n        }\n\n        context.SaveChanges();\n     }\n }\n</code></pre>\n\n<p>I've been able to avoid this issue to now on other object graphs by using FKs to manipulate associations as described here: <a href=\"http://blogs.msdn.com/b/diego/archive/2010/10/06/self-tracking-entities-applychanges-and-duplicate-entities.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/diego/archive/2010/10/06/self-tracking-entities-applychanges-and-duplicate-entities.aspx</a></p>\n\n<p>How does one handle this when a many-to-many association and navigation properties are involved?</p>\n\n<p>Thanks.</p>\n"},{"tags":["entity-framework","lazy-loading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12866556,"title":"EF lazy loading: EntityType does not declare a navigation property with the name","body":"<p>I have a classes structure something like that:</p>\n\n<pre><code>public class Customer{\n         public AgreementDetails Agreement { get; set; }\n}\n\n[ComplexType]\npublic class AgreementDetails{\n    public int SalesPersonId { get; set; }\n    [ForeignKey(\"SalesPersonId\")]\n    [NotMapped]\n    public virtual SalesPerson Sales { get; set; }\n}\npublic class SalesPerson\n{\n...\n}\n</code></pre>\n\n<p>When I'm displaying the list of customers, i'm calling Sales property to disaply sales person details but property is null, usually for navigating properties this can be avoid using .Include method but it doesn't work in my case, so the query is</p>\n\n<pre><code>List&lt;Customer&gt; res = db.Customers.Include(c=&gt;c.Agreement.Sales).ToList();\n</code></pre>\n\n<p>The exception is: </p>\n\n<blockquote>\n  <p>A specified Include path is not valid. The EntityType\n  'CodeFirstNamespace.Customer' does not declare a navigation property\n  with the name 'Agreement'.</p>\n</blockquote>\n"},{"tags":["entity-framework","validation","annotations","database-first"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":12866576,"title":"Adding validation to model with Database First model (EF 5)","body":"<p>I know how to add validation errors to the model state. I know how to add the validation annotations to my model classes.  The problem is that with Database first, I don't want to touch the generated code, because when I regenerate, I will lose my customization. I always try to customize in partials, but you can't add annotation to an existing property in a partial.</p>\n\n<p>What is best practice here?</p>\n"},{"tags":["asp.net-mvc","entity-framework","knockout.js","asp.net-mvc-4","t4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":235,"score":0,"question_id":12866049,"title":"Entity Framework + MVC 4 + Knockout.js AddView templates?","body":"<p>I've been messing around with knockout.js a little bit lately and it seems like it has a lot of promise. However, I can't seem to find any good Code Templates (aka t4 templates or .tt files) for it.</p>\n\n<p>My GUESS is that the only changes that we would need would be on the view side, not the controller side, but I'd be up for looking at new controller templates too.</p>\n\n<p>Where I am right now:</p>\n\n<ul>\n<li>Create a new MVC 4 project</li>\n<li>Using NuGet, install entity framework 5, jquery, jquery ui, and knockout</li>\n<li>Create a .edmx model by reverse engineering your existing database with Entity Framework</li>\n<li>Drag C:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\Common7\\IDE\\ItemTemplates\\CSharp\\Web\\MVC 4\\CodeTemplates from Explorer into the root of your project</li>\n<li>Delete CodeTemplates\\AddController</li>\n<li>Highlight all of the items in CodeTemplates\\AddView\\CSHTML and blank out the text in \"Custom Tool\" in properties to keep them from\nbuilding</li>\n<li>Start screwing around with Create.tt and Edit.tt to add in knockout code.</li>\n</ul>\n\n<p>Goal Expected Input: Right Click > Add Controller ... > MVC Controller using EF</p>\n\n<p>Goal Expected Result: Controller &amp; View created using EF with knockout code already in place.</p>\n\n<p>If you use something similar to knockout that you like more, I'd love to hear about it!</p>\n\n<p>Also, is it necessary to use addons like MVCScaffolding?  It seems like you could just customize the existing templates and get the same results.</p>\n\n<p>Thanks for your time!</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","slickgrid"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12863893,"title":"usage of slickgrid in MVC3 entity framework","body":"<p>I would like to use slickgrid in my project to make editing a schedule easy. I downloaded it and found that the documentation in the folder and on the sites i have visited to be very vague. they do not show code as to how you would pull from a database. Does anyone have or know of any examples that show a view, model, and controller for slickgrid implementation? There is an example on code project but it uses data that is not in a database and is very simple in concept.</p>\n"},{"tags":["database","asp.net-mvc-3","entity-framework","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12864299,"title":"How do I ReSeed a database table with my data every time I run my app?","body":"<p>I have a web-app that uses EF5. I have two tables that are my main concern. I have a members table and a claims table. I have false members that I need for testing purposes and this saves their claims to the claims table. </p>\n\n<p>There is real data in these tables as well that I do not want to change. Some of the false members are missing different data or need specific things to process said claim. How do repopulate my false members exactly as I want them without dropping the database.</p>\n\n<p>I have looked into Code First Migrations on www.pluralsight.com but I am not sure how to tell it to always seed the 10 false members and remove the new claims from the claims table. Some of the members have past claims so I only wanna remove the ones that get added during testing.</p>\n\n<p>Anyone have any suggestions?</p>\n"},{"tags":["c#","entity-framework","ef-code-first","migration","ef-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12863794,"title":"Entity Framework: How to disable model compatibility check in Code First Migrations","body":"<p>I would like to create a database initializer that runs all the pending migrations regardless of whether the model is in the correct state or not. I.e. I want the initializer to run all the migrations even if it thinks the model state has changed since generating the migration so that it doesn't through the following error:</p>\n\n<pre><code>Unable to update database to match the current model because there are pending changes and automatic migration is disabled.\n</code></pre>\n\n<p>Does anyone know how I might get this to work?</p>\n\n<p>Thanks</p>\n"},{"tags":[".net","entity-framework","ef-code-first","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12863506,"title":"How can I have a 1:many table but a 1:1 navigation property?","body":"<p>I have two entities; let's call them Person and Address. A Person has only one current address [<em>insert joke about political candidate here</em>], but also has previous addresses, which are also stored in the Address table. Thus I want my database tables to have a 1:many relationship.</p>\n\n<p><em>However</em>, in my entity classes, I don't want a 1:many relationship between Person and Address, because I'm only really interested in their <em>current</em> address. (If I want to find out about their previous addresses, then I can look directly at the Address table). So, I do <em>not</em> want a 1:many \"Addresses\" property on the Person object. Instead, I want a 1:1 Address property, which I'll set to the current address.</p>\n\n<p>Can this be done?</p>\n"},{"tags":[".net","linq","entity-framework","aggregate-functions","expression-trees"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12862843,"title":"Query that uses the Aggregate extension method against DbContext","body":"<p>I had a <code>MockDataStore</code> that returns a <code>List&lt;Task&gt;</code>. Then I would use the <code>Aggregate</code> extension method to query that list. So I was doing a LINQ-to-Objects query which does the job quiet nicely. Now that I've replaced my mock data store with a class that inherits the <code>DbContext</code> class, the same query does not work anymore because I cannot use a lambda expression that has a body since it cannot be converted to an expression tree. So is there a way to get around it and still have the aggregation done in SQL and avoid having to do it in-memory? Below is my code:</p>\n\n<pre><code>        //List&lt;Task&gt; tasks = MockDataStore.GetData()\n        //    .Aggregate(new List&lt;Task&gt;(), (accumulator, treaty) =&gt; { accumulator.AddRange(treaty.Tasks); return accumulator; })\n        //    .Where(x =&gt; x.AssignedTo.Equals(companyId) &amp;&amp; x.StatusId == statusId).ToList();\n\n        using (SCGREDbContext context = new SCGREDbContext())\n        {\n            List&lt;Task&gt; tasks = context.Treaties.Aggregate(new List&lt;Task&gt;(), (accumulator, treaty) =&gt; { accumulator.AddRange(treaty.Tasks); return accumulator; })\n                                .Where(x =&gt; x.AssignedTo.Equals(companyId) &amp;&amp; x.StatusId == statusId).ToList();\n            return tasks;\n        }\n</code></pre>\n"},{"tags":["c#","entity-framework","transactions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":54,"score":-1,"question_id":12863950,"title":"What does DbConnection.EnlistTransaction do?","body":"<p>What does DbConnection.EnlistTransaction do?\nThank you for your time.</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12855502,"title":"Attach and update boolean or int doesn't always work","body":"<p>Using Entity Framework 5, Given an object <code>messenger</code> that exists in the database, with bit property <code>published</code>, in previous versions of EF I would update it like this:</p>\n\n<pre><code>using (var c = new EFContext())\n{\n    Data.Messenger cm = new Messenger { MessageId = messageId };\n    c.Messengers.Attach(cm);\n    cm.Published = newPublishedValue;\n    c.SaveChanges();\n}\n</code></pre>\n\n<p>However, using EF5, this works if <code>newPublishedValue</code> is <code>true</code>, but if <code>newPublishedValue</code> is <code>false</code>, no changes are made to the database. Likewise, this pattern will not set integer values to 0. </p>\n\n<p>What's going on here?</p>\n\n<p>Replacing </p>\n\n<pre><code>c.Messengers.Attach(cm);\n</code></pre>\n\n<p>with</p>\n\n<pre><code>c.Entry(cm).State = System.Data.EntityState.Modified;\n</code></pre>\n\n<p>Fixes the issue, but if EF5 won't update properties of my <code>new Data.Messenger</code> that are of a default struct value, doesn't that render the <code>Attach</code> method a bit useless?</p>\n\n<p>What am I missing here?</p>\n"},{"tags":["entity-framework","silverlight-5.0","out-of-browser"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12862306,"title":"Accessing data from Silverlight Out of Browser","body":"<p>When Silverlight runs in Out of Browser mode and off line, can it get the Sql Server Data from a DataBase located in the local disk by means of an ADO Entity Data Model?</p>\n"},{"tags":["c#","entity-framework","architecture"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":4,"view_count":59,"score":-3,"question_id":12863694,"title":"Entity framework architecture","body":"<p>I want to make a entity framework application in winforms c#.\nIm new to entity framework, and dont know how to make the architecture. I want to have the model in a class library, and a GUI layer, and maybe a controller layer.\nIm use to that architecture, but dont know have to handle the objects in other layers than the model. Have do I manage objects in the gui layer, when I cant have a reference to the model?\nIm use to have some kind of dto, but whats the best way?</p>\n\n<p>Thanks\nJakob</p>\n"},{"tags":[".net","entity-framework","dbcontext","esql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12840251,"title":"How to build dynamic WHERE clauses using dbContext","body":"<p>We need to create dynamic WHERE Clauses depending on user input.\nUsing the old <code>ObjectContext</code> we found a way by using <code>.Where(&lt;ESql&gt;)</code>. </p>\n\n<pre>\nDim qry As ObjectQuery(Of MESSGROESSE) = _objContext.MESSGROESSE\nIf Not String.IsNullOrWhiteSpace(fltFormelzeichen.Text) Then\n    qry = qry.Where(\"it.Formelzeichen LIKE @Formelzeichen\", New ObjectParameter(\"Formelzeichen\", BuildESqlWildCard(fltFormelzeichen.Text)))\nEnd If\nIf Not String.IsNullOrWhiteSpace(fltBezeichnung.Text) Then\n    qry = qry.Where(\"it.Bezeichnung LIKE @Bezeichnung\", New ObjectParameter(\"Bezeichnung\", BuildESqlWildCard(fltBezeichnung.Text)))\nEnd If\n\n</pre>\n\n<p>Because this is a new project we would like to generally use the new DbContext. I know how to get at the ObjectContext from a DbContext:</p>\n\n<pre><code>Private _objContext As ObjectContext = CType(_dbContext, IObjectContextAdapter).ObjectContext\n</code></pre>\n\n<p>But then what?</p>\n\n<p>Using <code>DbContext.Database.SqlQuery</code> or <code>ObjectContext.CreateQuery</code> seems not to be an option, option because the EDMX generator destroys column names if they are the same as the table name and we do not have control over the DB schema. See <a href=\"http://stackoverflow.com/questions/12732114/how-to-stop-the-edmx-generator-from-changing-columns-names\">How to stop the EDMX generator from changing columns names</a>.</p>\n\n<p>We do not want dependencies on open source solutions.</p>\n\n<p>ADDED</p>\n\n<p>Meanwhile I talked the customer out of needing wildcards, so we can use Contains() with dbConctext:</p>\n\n<pre>\n_dbc = New TPTEntities\nDim qry As DbQuery(Of MESSGROESSE) = _dbc.MESSGROESSE\nqry = From e In _dbc.MESSGROESSE Take maxRows\n\nIf Not String.IsNullOrWhiteSpace(fltFormelzeichen.Text) Then\n    qry = From e In qry Where e.FORMELZEICHEN.Contains(fltFormelzeichen.Text)\nEnd If\nIf Not String.IsNullOrWhiteSpace(fltBezeichnung.Text) Then\n    qry = From e In qry Where e.BEZEICHNUNG.Contains(fltBezeichnung.Text)\nEnd If\nIf Not String.IsNullOrWhiteSpace(fltReihenfolge.Text) Then\n    qry = From e In qry Where e.REIHENFOLGE = fltReihenfolge.Text\nEnd If\nqry.Load()\n'TODO is _dbc.MESSGROESSE.Local the correct way to get at the data here?\nucoGridEditor.grd.ItemsSource = _dbc.MESSGROESSE.Local\n</pre>\n\n<p>I would still like to know how to use ESql Where() on dbContext though.</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12861871,"title":"Single collection as a result of two Foreign Keys?","body":"<p>Let's say I have the following entity:</p>\n\n<pre><code>public partial class Store\n{\n    public Store()\n    {\n        this.ConglomeratesByField1 = new HashSet&lt;Conglomerate&gt;();\n        this.ConglomeratesByField2 = new HashSet&lt;Conglomerate&gt;();\n    }\n\n    [Key]\n    public int ID_Store { get; set; }\n    public string StoreName { get; set; }\n\n    [ForeignKey(\"ID_Store1\")]\n    public virtual ICollection&lt;Conglomerate&gt; ConglomeratesByField1 { get; set; }\n    [ForeignKey(\"ID_Store2\")]\n    public virtual ICollection&lt;Conglomerate&gt; ConglomeratesByField2 { get; set; }\n} \n</code></pre>\n\n<p>With code first, is it possible to have a single \"Conglomerates\" property that would be the \"union\" of ConglomeratesByField1 and ConglomeratesByField2, or I have to extend the class with a specialized method?</p>\n"},{"tags":["c#",".net","linq","entity-framework","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12863171,"title":"An entity object cannot be referenced by multiple instances of IEntityChangeTracker","body":"<p>I'm having a problem with updating object entities in EF. I'm using VS 2010 and .NET 4</p>\n\n<pre><code>    private void Update(InstallerEntity editObj)\n    {\n        using (var eo = DataManager.CreateNewEntitiesContext())\n        {\n            eo.Attach(editObj);\n            eo.ApplyPropertyChanges(\"InstallerEntity \", editObj);\n            eo.SaveChanges();\n\n\n        }\n    }\n</code></pre>\n"},{"tags":["c#","sql-server","entity-framework","telerik-grid","telerik-mvc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":148,"score":0,"question_id":12839578,"title":"Telerik MVC Grid and Paging/Sorting/Filtering in database","body":"<p>I am using Telerik Grid MVC with AJAX binding.</p>\n\n<p>I thought that if I provide IQueryable to the grid, paging/sorting/filtering would be done at the database server. Like so:</p>\n\n<pre><code>[GridAction]\npublic ActionResult Select()\n{\n    return View(new GridModel(Mapper.Map&lt;IEnumerable&lt;DokumentVM&gt;&gt;(db.Dokumenti)));        \n}\n</code></pre>\n\n<p>I created test data of about 10000 documents in database, and upper command resulted in each of them hauled into the grid. And obviously, it takes forever.</p>\n\n<p>Grid is bound via AJAX, like this:</p>\n\n<pre><code>@(Html.Telerik().Grid&lt;ViewModels.DokumentVM&gt;()\n.DataBinding(b =&gt; b.Ajax().Select(\"Select\", \"Dokument\"))\n.Pageable(p =&gt; p.PageSize(20))\n.Sortable(s =&gt; s.SortMode(GridSortMode.MultipleColumn).OrderBy(m =&gt; { m.Add(\"Date\").Descending(); m.Add(\"Number\").Descending(); })))\n</code></pre>\n\n<p>Inside Select ActionMethod, when inspecting Request (its Form), I see that grid sends all info needed for proper functioning:</p>\n\n<pre><code>page:     1\nsize:     20\norderBy:  Date-desc~Number-desc\n</code></pre>\n\n<p>But when I further inspect SQL command sent to database, I see that there is only SELECT command present, no WHERE, no ORDER by, no nothing, which brings down all my data.</p>\n\n<p>I am wondering if it is possible for Paging/Sorting/Filtering to work automatically, or do I need to translate info sent by the grid into SQL commands myself. I was under impression that all I needed is to provide IQueryable and Grid would do the rest. But that's not working for me. </p>\n\n<p>Maybe I am doing something wrong, or maybe this is not even possible?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12862101,"title":"'Binding' a generic repository to an interface","body":"<p>I am currently following the following tutorial </p>\n\n<p><a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application\" rel=\"nofollow\">http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application</a></p>\n\n<p>This tutorial discusses how to implement a generic repository and unit of work.</p>\n\n<p>However, it does not appear to explain how to 'bind' a generic repository to an interface.</p>\n\n<p>Can anyone explain how to do this?  I need to 'bind' my generic repositories to either a generic interface or a derived/custom interface.</p>\n\n<p>Any help would be appreciated</p>\n"},{"tags":["entity-framework","c#-4.0","rowversion"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":77,"score":3,"question_id":12693934,"title":"Rowversion comparison in Entity Framework","body":"<p>How should I compare <code>rowversion</code> fields using Entity Framework? I have one table which has a <code>rowversion</code> column, I want to get data from tables for which row version is higher than specified value.</p>\n\n<pre><code>//code\nbyte[] rowversion = .....somevalue;\n\n _context.Set&lt;T&gt;().Where(item =&gt; item.RowVersion &gt; rowVersion);\n</code></pre>\n\n<p>This line does not work, it throws error:</p>\n\n<blockquote>\n  <p><em>cannot be applied to operands of type 'byte[]' and 'byte[]'</em></p>\n</blockquote>\n\n<p>Any idea how I can compare <code>rowversion</code> fields in c#/EF ?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12856401,"title":"C# dynamic casts when using Entity Framework for insertion","body":"<p>I have a database which contains tables of mapping values for a variety of objects. </p>\n\n<p>For example the <code>Colour</code> table contains <code>BLK &gt; Black, BLU &gt; BLUE, ORA &gt; ORANGE</code> etc.. and the <code>CarType</code> table contains <code>4DH &gt; Four-door hatchback, 4WD &gt; Four wheel drive</code> etc...</p>\n\n<p>I'm using Entity Framework code-first so I have a context set up something like this.</p>\n\n<pre><code>public class MappingContext : DbContext\n{\n    public MappingContext ()\n        : base(\"Mappings\")\n    {\n    }\n\n    public DbSet&lt;Colour&gt; ColourMappings { get; set; }\n    public DbSet&lt;CarType&gt; CarTypeMappings { get; set; }\n}\n</code></pre>\n\n<p>Every object that relates to each table in my <code>Mapping</code> database inherits from a base class like so:</p>\n\n<pre><code>public class Mapping\n{\n    public int Id { get; set; }\n\n    public string OrignalValue { get; set; }\n\n    public string MappedValue { get; set; }\n}\n\npublic class CarType : Mapping{}\npublic class Colour : Mapping{}\n</code></pre>\n\n<p>Now what I want to do is read these mappings in from an XML file filled with \"Templates\" which contain the mappings and insert them in the DB.</p>\n\n<p>I have the following method to do this:</p>\n\n<pre><code>public void InsertMappings(XDocument xml, string templateName, Type typeToInsert)\n{\n    // Here I find the relevent mappings \n\n    using (var repo = new Repository())\n    {\n        var mapppings = mappings.Select(mapping =&gt; new Mapping\n        {\n            MappedValue = mapping.Value,\n            OrignalValue = GetCode(mapping)\n        });\n\n        foreach (var mapping in mapppings.ToList())\n        {\n            var map = (typeToInsert)mapping  // &lt;&lt; This line will not compile\n\n            repo.Insert(map);\n        }\n\n    repo.Save();\n   }\n}\n</code></pre>\n\n<p>This will not complie as it doesnt recognise the attempted cast \"(typeToInsert)mapping\".</p>\n\n<p>So basically what I need to know is how to I cast this Mapping object to a Specific Mapping object when it comes to inserting it into the db? Or any suggestions for a better way of doing this!</p>\n"},{"tags":["entity-framework","mvvm","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12861937,"title":"EF+MVVM Async data fetching on shared context","body":"<p>In my current setup I am fetching data using Task.Run, which runs on another thread. During this time I display some message to user that data is loading, so no frozen screen appears to user.</p>\n\n<p>In some scenarios I need to run several queries using EF to fetch all data that is required. This I achieved using coroutines and Task library. The result is that each query is executed in sequence on different thread. Coroutines and Taks are used on ViewModel level, and a separate context is used for each ViewModel. So far I didn't experience any problems during testing in mentioned scenarios.</p>\n\n<p>In addition to data loading, the idea is also to save data in async manner, whenever user switches screens, so the user doesn't need to wait for saving to complete. In 99% of the cases data is 100% valid, if 1% occurs, then appropriate message is displayed to user on what screen there are validtione rrors. So far I didnt experience any problems during testing with this approach.</p>\n\n<p>The problem that I am having is how to implement this when sharing context between viewmodels. This means that each viewmodel can execute a method ON EF, which can result in two parallel queries on the same DbContext, and DbContext is not safe for multithreading.</p>\n\n<p>So, what are my options here? It seems that I need to implement some query queuing on context level, so I am wondering if this is the right approach at all, and if there is some example on EF query queuing? If you don't like the approach I am using, what would you recommend?</p>\n"},{"tags":["wcf","entity-framework","wcf-data-service"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":543,"score":4,"question_id":5300283,"title":"Data Service using EF - is it possible to use WebGet method which returns a custom type?","body":"<p>In my project I use Data Service which use EF. Now I have a custom class which I also want to expose through my Data Service, but I can't make it work, it's seems like it is impossible to mix custom types and EF in single Data Service. Any suggestions?</p>\n\n<p>Looks like it doesn't find some info in meta-data\nError:</p>\n\n<blockquote>\n  <p>The server encountered an error\n  processing the request. The exception\n  message is 'Unable to load metadata\n  for return type\n  'System.Linq.IQueryable<code>1[ITS.NetProject.Model.CustomEnty]'\n  of method\n  'System.Linq.IQueryable</code>1[ITS.NetProject.Model.CustomEnty]\n  GetCustomEnties()'.'. See server logs\n  for more details. The exception stack\n  trace is:....</p>\n</blockquote>\n\n<p>Code:</p>\n\n<pre><code>   [ServiceBehavior(IncludeExceptionDetailInFaults=true)]\n        public class ITSServiceOData : DataService&lt;ITSEntities&gt;\n        {\n            public static void InitializeService(DataServiceConfiguration config)\n            {\n\n                config.SetEntitySetAccessRule(\"*\", EntitySetRights.All);\n\n                config.SetServiceOperationAccessRule(\"GetCustomEnties\",                \n    ServiceOperationRights.AllRead);\n\n                config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;\n            }\n\n\n            [WebGet]\n            public IQueryable&lt;CustomEnty&gt; GetCustomEnties()\n            {\n                return from e in this.CurrentDataSource.CustomEnties select e;\n\n            }\n\n        }\n\n///Here it is my model definition\n\nnamespace ITS.NetProject.Model\n{\n    partial class ITSEntities\n    {\n        public IQueryable&lt;CustomEnty&gt; CustomEnties \n        {\n            get\n            {\n                return ...\n            }\n        }\n    }\n\n//Company, Equipment, Owner are EF entity classes\n    [DataServiceKey(\"Id\")]\n    public class CustomEnty\n    {\n        public int Id {get;set;}\n\n        public Subject Company { get; set; }\n\n        public Subject Equipment { get; set; }\n\n        public Subject Owner { get; set; }\n    }\n}\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12861458,"title":"Entity Framework connecting to SQLEXPRESS not SQL Compact","body":"<p>I have been trying out a code first EF project with SQl Compact 4.0.\nWhen I try running the project I get an error that \"CREATE DATABASE permission denied in database 'master'.\".</p>\n\n<p>I searched for help and in response to a few blogs tried to identify the connection string being used. To my surprise it was</p>\n\n<pre><code>context.Database.Connection.ConnectionString    \"Data Source=.\\\\SQLEXPRESS;Initial Catalog=Ancestors.Models.AncestorsContext;Integrated Security=True;MultipleActiveResultSets=True;Application Name=EntityFrameworkMUE\"    string\n</code></pre>\n\n<p>even though my web.config file includes the following sections...</p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"DefaultConnection\" providerName=\"System.Data.SqlServerCe.4.0\"    connectionString=\"Data Source=|DataDirectory|\\aspnet-Ancestors-20121012114712.sdf\" /&gt; \n&lt;/connectionStrings&gt;\n\n&lt;system.data&gt;\n&lt;DbProviderFactories&gt;\n  &lt;remove invariant=\"System.Data.SqlServerCe.4.0\" /&gt;\n  &lt;add name=\"Microsoft SQL Server Compact Data Provider 4.0\" invariant=\"System.Data.SqlServerCe.4.0\" description=\".NET Framework Data Provider for Microsoft SQL Server Compact\" type=\"System.Data.SqlServerCe.SqlCeProviderFactory, System.Data.SqlServerCe, Version=4.0.0.1, Culture=neutral, PublicKeyToken=89845dcd8080cc91\" /&gt;\n&lt;/DbProviderFactories&gt;\n&lt;/system.data&gt;\n</code></pre>\n\n<p>Has anyone any idea why EF is insisting on creating a connection to SQLEXPRESS instead of SQL Compact?\nI can find no reference at all to SQLEXPRESS anywhere in the solution.</p>\n"},{"tags":["c#","entity-framework","associations","edmx","database-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12861406,"title":"add association relations","body":"<p>I am using sql server db and Ef for code mapping. For some reason when I map my db to the demx file it's missing some of my relation and Associations between a few of my tables. So I need to use the Association in my code specifically in two tables. the Association in the db is 1 to 0 or 1. Can any one help me on the steps to do so. I have tried creating an Association but got this error: Error 3027: No mapping specified for the following EntitySet/AssociationSet\". </p>\n"},{"tags":["c#","database","asp.net-mvc-3","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":12860229,"title":"How do I seed specific values in a database every time the app runs?","body":"<p>I have an app that uses SSN's to look up people in a database. I am trying to force the 10 \"ssn's\" that I use for testing purposes to seed every time I run the app. I am currently dropping the table and reseeding the data with my false data but we are importing data from a real database to ours and I no longer want to do this. </p>\n\n<p>Can someone lead me to a site or give me a hint on how I could go about this?</p>\n"},{"tags":["entity-framework","delete","oracle10g"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":258,"score":4,"question_id":8036037,"title":"Entity Framework - Delete entity in Oracle 10g { Operation is not valid due to the current state of the object}","body":"<p>Hi I try use Repository pattern in Entity Framework on Oracle 10g.  I simplified my code:</p>\n\n<p>Here is SQL code:</p>\n\n<pre><code>-- Create table\ncreate table TESTTABLE\n(\n  MODULE_UNIQUE_ID VARCHAR2(32) not null,\n  PANEL_STATUS     VARCHAR2(8) not null\n)\ntablespace SYSTEM\n  pctfree 10\n  pctused 40\n  initrans 1\n  maxtrans 255\n  storage\n  (\n    initial 64K\n    minextents 1\n    maxextents unlimited\n  );\n-- Create/Recreate primary, unique and foreign key constraints \nalter table TESTTABLE\n  add constraint TESTTABLE_PK_01 unique (MODULE_UNIQUE_ID)\n  using index \n  tablespace SYSTEM\n  pctfree 10\n  initrans 2\n  maxtrans 255\n  storage\n  (\n    initial 64K\n    minextents 1\n    maxextents unlimited\n  );\n</code></pre>\n\n<p>I create simple repository class:</p>\n\n<pre><code>public interface IRepository&lt;TEntity, TCtx&gt;\n{\n    TCtx Session { get;}\n    void Add(TEntity entity);\n    void AddOrAttach(TEntity entity);\n    void Delete(TEntity entity);\n    int Save();\n    TEntity SelectByKey(string colName, string key);\n}\n\npublic class Repository&lt;TEntity, TCtx&gt; : IRepository&lt;TEntity, TCtx&gt;,\n    IDisposable\n    where TEntity : EntityObject\n    where TCtx : ObjectContext\n{\n    #region Private fields\n\n    private TCtx _ctx;\n    private string _keyProperty = \"ID\";\n\n    public int Save()\n    {\n        return _ctx.SaveChanges();\n    }\n\n   public TEntity SelectByKey(string colName, string key)\n    {\n        KeyProperty = colName;\n\n        // First we define the parameter that we are going to use the clause.\n        var xParam = Expression.Parameter(typeof(TEntity), typeof(TEntity).Name);\n        MemberExpression leftExpr = Expression.Property(xParam, KeyProperty);\n        Expression rightExpr = Expression.Constant(key);\n        BinaryExpression binaryExpr = Expression.Equal(leftExpr, rightExpr);\n\n        //Create Lambda Expression for the selection\n        Expression&lt;Func&lt;TEntity, bool&gt;&gt; lambdaExpr = Expression.Lambda&lt;Func&lt;TEntity, bool&gt;&gt;\n            (binaryExpr, new ParameterExpression[] { xParam });\n\n        //Searching ....\n        //IList&lt;TEntity&gt; resultCollection = ((IRepository&lt;TEntity, TCtx&gt;)this).SelectAll(new Specification&lt;TEntity&gt;(lambdaExpr));\n\n        //if (null != resultCollection &amp;&amp; resultCollection.Count() &gt; 0)\n        //{\n        //    //return valid single result\n        //    return resultCollection.First();\n        //}\n        //return null;\n\n        return ((IRepository&lt;TEntity, TCtx&gt;) this)\n            .SelectAll(new Specification&lt;TEntity&gt;(lambdaExpr)).FirstOrDefault();\n    }\n\n    public void Delete(TEntity entity)\n    {\n        _ctx.DeleteObject(entity);\n\n    }\n\n }\n</code></pre>\n\n<p>Problem is first I select some entity and then I want delete. \nSelect works against Oracle DB good. Problem is update or delete command.</p>\n\n<pre><code>   var _repo = new Repository&lt;TESTTABLE, Entities&gt;(\n            new Entities(ConfigurationManager.ConnectionStrings[\"Entities\"]\n                          .ConnectionString));\n\n    var obj = _repo.SelectByKey(\"MODULE_UNIQUE_ID\", \"11111\");\n    _repo.Delete(obj);\n    _repo.Save();\n</code></pre>\n\n<p>I get this exception:</p>\n\n<blockquote>\n  <p>{\"An error occurred while updating the entries. See the inner\n  exception for details.\"}</p>\n</blockquote>\n\n<p>Inner exception:</p>\n\n<blockquote>\n  <p>{\"Operation is not valid due to the current state of the object.\"}</p>\n</blockquote>\n\n<p>StackTrace:</p>\n\n<blockquote>\n  <p>at\n  System.Data.Mapping.Update.Internal.UpdateTranslator.CreateCommand(DbModificationCommandTree\n  commandTree)    at\n  System.Data.Mapping.Update.Internal.DynamicUpdateCommand.CreateCommand(UpdateTranslator\n  translator, Dictionary<code>2 identifierValues)    at\n  System.Data.Mapping.Update.Internal.DynamicUpdateCommand.Execute(UpdateTranslator\n  translator, EntityConnection connection, Dictionary</code>2\n  identifierValues, List`1 generatedValues)    at\n  System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager\n  stateManager, IEntityAdapter adapter)</p>\n</blockquote>\n\n<p>I tested my repository class again MS SQL database it works good.</p>\n\n<p>What can cause this problem?</p>\n"},{"tags":["c#","entity-framework","connection-string","sql-server-ce-4"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":192,"score":5,"question_id":12660683,"title":"How to use dynamic connection string for SQL Server CE?","body":"<p>I used SQL Server CE 4.0 in my windows app and use Entity Framework to create a model of it.</p>\n\n<p>It works fine but my problems is that it doesn't have a constructor to change the connection string, and by default it reads the connection string from the <code>app.config</code> file.</p>\n\n<pre><code> using (var Context = new MyEntitiesModel(//has no constructor))\n {\n        ...\n }\n</code></pre>\n\n<p>I create a dynamic connection string and</p>\n\n<pre><code>  using (var Context = new MyEntitiesModel())\n   {\n         Context.Database.Connection.ConnectionString = entityConnection.ConnectionString;\n   }\n</code></pre>\n\n<p>It works fine by this way but if I remove another connection string in <code>app.config</code> file it gave me this.</p>\n\n<blockquote>\n  <p><em>error = invalid metasource ....</em></p>\n</blockquote>\n\n<p>because the default constructor uses it</p>\n\n<p>How can I handle it?</p>\n"},{"tags":["entity-framework","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12859440,"title":"Update only scalar properties in Code First, EF 5","body":"<p>God day!</p>\n\n<p>I have a tree of entities and at specific point of time i need to update only scalar properties of one entity. Classic update rise entire graph lookup, but relations not need to update.</p>\n\n<p>The trouble in Category entity what one category have another categories in children. My method generate exceptions when saving changes about duplicate key. I think EF try to add children to database.</p>\n\n<p>Static method of my data context listed below:</p>\n\n<pre><code>    public static void Update&lt;T&gt;(T item) where T : KeyedObject\n    {\n        if (item == null)\n            throw new ArgumentNullException(\"Item to update is null\");\n        item.ValidateIsNotNew();\n        using (DataContext db = new DataContext())\n        {\n            T original = GetOriginalWithException&lt;T&gt;(db, item);\n            DbEntityEntry entry = db.Entry(original);\n            entry.CurrentValues.SetValues(item);\n            entry.State = EntityState.Modified;\n\n            try\n            {\n                db.SaveChanges();\n            }\n            catch (Exception ex)\n            {\n                throw new DatabaseException(\n                    \"Cant update list item. See inner exception for details.\", \n                    ex);\n            }\n        }\n    }\n</code></pre>\n\n<p>I tries another method: attaching object. This method does not throw exception, but it rise entire graph update and take many resources. Code listed below:</p>\n\n<pre><code>    public static void Update&lt;T&gt;(T item) where T : KeyedObject\n    {\n        if (item == null)\n            throw new ArgumentNullException(\"Item to update is null\");\n        item.ValidateIsNotNew();\n        using (DataContext db = new DataContext())\n        {\n            db.Set&lt;T&gt;().Attach(item);\n            db.Entry(item).State = EntityState.Modified;\n            try\n            {\n                db.SaveChanges();\n            }\n            catch (Exception ex)\n            {\n                throw new DatabaseException(\n                    \"Cant update list item. See inner exception for details.\", \n                    ex);\n            }\n        }\n    }\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":54,"score":3,"question_id":12859304,"title":"AcceptAllChanges Entity Framework","body":"<p>What's the difference between, <code>_context.SaveChanges</code> and <code>_context.AcceptAllChanges()</code>, is the <code>AcceptAllChanges()</code> is sort of reloading data from Database or rolling back (discarding) changes made by the user when he didn't use <code>SaveChanges()</code></p>\n"},{"tags":["c#",".net","entity-framework","inheritance"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":11612110,"title":"Can EntityObject be sub-classed?","body":"<p>I'm basically re-asking <a href=\"http://stackoverflow.com/questions/2240038/add-custom-abstract-base-class-between-entityobject-and-generated-classes-in-ent\">this question</a> as the only and accepted answer is not an answer to the question.</p>\n\n<p>Is it possible to tell EF to use a class that subclasses EntityObject, like the one below, as the base class of generated entity classes?</p>\n\n<pre><code>public abstract class CustomEntityObject : EntityObject\n{\n    &lt;additional functionality&gt;\n}\n</code></pre>\n\n<p>The reason I'm asking is I want to stop adding interfaces and implementing them on all entity types in separate partial class files. By sub-classing EntityObject I could implement the additional functionality once only.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>EF implicitly uses a .tt file to generate entity classes. By implicitly I mean you don't see  the .tt file in your project. The solution is to add the template explictly (right-click on the .edmx designer and click \"Add Code Generation Item...\", then add \"ADO.NET EntityObject Generator\"). You then change a single value in the .tt:</p>\n\n<pre><code>string BaseTypeName(EntityType entity, CodeGenerationTools code)\n{\n    return entity.BaseType == null ? \"EntityObject\" : MultiSchemaEscape((StructuralType)entity.BaseType, code);\n}\n</code></pre>\n\n<p>changes to:</p>\n\n<pre><code>string BaseTypeName(EntityType entity, CodeGenerationTools code)\n{\n    return entity.BaseType == null ? \"CustomEntityObject\" : MultiSchemaEscape((StructuralType)entity.BaseType, code);\n}\n</code></pre>\n"},{"tags":["c#","sql","database","entity-framework","treeview"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12858775,"title":"Treeview population from Database in C#","body":"<pre><code>ParentID   1 1 2 2 2 3 5 5 1\nChildID    2 3 4 5 6 7 8 3 11\n</code></pre>\n\n<p>code:</p>\n\n<pre><code>treeView1.Nodes.Add(\"1\", \"1\");\ntreeOlustur(\"1\");\n\n\nprivate void treeOlustur(string kod)\n{\n  List&lt;Agac&gt; altAgac = tm.Agac.Where(x =&gt; x.USTKOD == kod).ToList&lt;Agac&gt;();\n  foreach (Agac item in altAgac)\n  {\n    TreeNode[] tn = treeView1.Nodes.Find(item.USTKOD, true);\n    for (int i = 0; i &lt; tn.Count(); i++)\n    {\n      tn[i].Nodes.Add(item.ALTKOD, item.ALTKOD);\n    }\n    treeOlustur(item.ALTKOD);\n  }\n}\n</code></pre>\n\n<p>i want to populate treeview by using this table , i got a little error when program add node under 5 to 3 to double 7</p>\n\n<p>how can i fix it ?</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12857937,"title":"Can I create an Initial migration for an existing model","body":"<p>I am using Code-First migrations. Now I want my application when published to a new server to create a database and all tables for the model.</p>\n\n<p>I don't want to use auto-migrations because I want to keep track of database versioning.\nBut when I deploy my application to a new server I don't want it to perform all steps to come to the current model (e.g adding tables/columns which in later revisions are deleted).</p>\n\n<p>I would like to know if there is a way to create one migration that contains the whole (POCO) data model.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12856202,"title":"Required Properties on optional Entity Framework Complex Types","body":"<p>I want to define <code>[Required]</code> attributes on a Complex Type in Entity Framework.  For example, I have a <code>Customer</code> entity with an optional <code>Address</code>.  The Address entity has a required <code>PostCode</code> property.</p>\n\n<pre><code>[ComplexType]\npublic class Address {\n    public string Address1 { get; set; }\n    [Required]\n    public string PostCode { get; set; }\n}\n\npublic class Customer {\n    public int CustomerId {get;set;}\n    public Address Address {get;set;}\n}\n</code></pre>\n\n<p>I do NOT want to store my Complex type as a separate entity (I'm not actually using Address, this just an easy illustration of the problem).  I cannot leave Customer.Address null, because this gives the error:</p>\n\n<blockquote>\n  <p>Null value for non-nullable member. Member: 'Address'.</p>\n</blockquote>\n\n<p>If I supply an empty Address entity, the validation fails on the PostCode field because of the Required attribute.</p>\n\n<p>Is there any way to achieve this?  I'm using EF5/NET4.5.</p>\n"},{"tags":["performance","oracle","entity-framework","repository-pattern"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":345,"score":4,"question_id":12177322,"title":"Entity Framework 5 and Oracle: Expression with closure affecting performance when querying against a non-unique indexed field","body":"<p>I have a performance issue with Entity Framework 5 and Oracle DB.</p>\n\n<p>I have a simple SQL select: <code>SELECT * FROM NOTE WHERE NOTENUMBER = '1A23456'</code></p>\n\n<p><code>NOTENUMBER</code> is included in an index on a table called NOTE, but the field is NOT primary key / unique.</p>\n\n<ul>\n<li><p>When I execute the statement with Oracle SQL Developer, results return\nquickly and query plan shows that RANGE SCAN is being used like it\nshould.</p></li>\n<li><p>When I use Entity Framework, the generated SQL takes a lot\nlonger (5 seconds vs. 30ms).</p></li>\n<li><p>When I use Entity Framework and query\nwith a <strong>primary key field</strong> (NOTE_KEY), results return as quickly as with SQL \nDeveloper.</p></li>\n</ul>\n\n<p>I suspect 2 things:</p>\n\n<ul>\n<li><p>There's some problem with EF and Oracle.DataAccess-provider not using the non-unique-index that is available. It would help if I had debug symbols for Entity Framework 5, but I can't find them anywhere.</p></li>\n<li><p>The performance problem is somewhere in EF, regarding closures and/or the way I use generic repository pattern with EF:</p>\n\n<p>If I call my repository like this:<br/>\n<code>var notenumber = \"1A23456\";</code><br />\n<code>var notes = repository.All(n =&gt; n.NOTENUMBER == notenumber).ToList();</code><br>\nThe predicate comes in at the method <code>All</code> as:<br />\n<code>{n =&gt; (n.NOTE == value(Tester.Program+&lt;&gt;c__DisplayClass0).notenumber)}</code><br/>\nAnd EfProf-profiler traces the resulting SQL as:</p>\n\n<p><code>SELECT \"Extent1\".\"NOTE_KEY\"      AS \"NOTE_KEY\",</code><br/>\n<code>\"Extent1\".\"NOTENUMBER\"    AS \"NOTENUMBER\",</code><br/>\n<code>\"Extent1\".\"NOTETEXT\"      AS \"NOTETEXT\",</code><br/>\n<code>FROM   \"NOTE_DBA\".\"NOTE\" \"Extent1\"</code><br/>\n<code>WHERE  (\"Extent1\".\"NOTENUMBER\" = '1PSA0500237500' /* @p__linq__0 */)</code><br/></p>\n\n<p>And the query takes takes <strong>~5500ms</strong>.</p>\n\n<p><br/>\nOn the other hand, if I call my repository like this:<br/>\n<code>var notes = repository.All(n =&gt; n.NOTENUMBER == \"1A23456\").ToList();</code><br/>\nThen the predicate comes in as:<br/>\n<code>{n =&gt; (n.NOTENUMBER == \"1A23456\")}</code><br />\nAnd EfProf-profiler traces the resulting SQL as:</p>\n\n<p><code>SELECT \"Extent1\".\"NOTE_KEY\"      AS \"NOTE_KEY\",</code><br/>\n<code>\"Extent1\".\"NOTENUMBER\"    AS \"NOTENUMBER\",</code><br/>\n<code>\"Extent1\".\"NOTETEXT\"      AS \"NOTETEXT\",</code><br/>\n<code>FROM   \"NOTE_DBA\".\"NOTE\" \"Extent1\"</code><br/>\n<code>WHERE  ('1PSA0500237500' = \"Extent1\".\"NOTENUMBER\")</code><br/></p>\n\n<p>And the query takes <strong>~30ms</strong>.</p>\n\n<p>So the only difference is the order of the condition in the WHERE-clause, and the fact that in the latter there seems to be no parameter replaced by EF</p></li>\n</ul>\n\n<p><br/>\nI use VS2010 and .NET4, and reference EF5 (v4.4.0.0).\nThe repository's All-method is:<br/></p>\n\n<pre><code>public IQueryable&lt;NOTE&gt; All(Expression&lt;Func&lt;NOTE, bool&gt;&gt; predicate = null)\n{\n    var setOfNotes = GetDbSet&lt;NOTE&gt;();\n    var notesQuery = from note in setOfNotes select note;\n    if (predicate != null)\n    {\n        notesQuery = notesQuery.Where(predicate);\n    }\n    return notesQuery;\n}\n</code></pre>\n\n<p>I tried to create a CompiledQuery, I tried using <code>setOfNotes.AsNoTracking()</code> and I tried to target .NET 4.5 - with no difference in performance.<br/></p>\n\n<p>One way I was able to get this particular query fast, was to use Oracle's basic Data Provider for .NET (ODB.NET) and construct the query manually, but I'd rather not stick with that solution. Again, if I use a primary field in the where clause, the query is fast even with EF and the same All-method.</p>\n\n<p>So the problem seems to be somewhere in EF. I feel could find out a lot more if I only had the symbols for EntityFramework.dll.</p>\n\n<p>Could there be a problem with the way EF invokes predicates? How does the '@p_<em>linq</em>_0'-parameter get replaced inside EF?</p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":6,"up_vote_count":14,"down_vote_count":0,"view_count":18274,"score":14,"question_id":1074337,"title":"MetadataException when using Entity Framework Entity Connection","body":"<p>This code:</p>\n\n<pre><code>using (EntityConnection conn = new EntityConnection(\"name=ELSCommonEntities\"))\n\n{\n  conn.Open();\n}\n</code></pre>\n\n<p>Gives me the following error:</p>\n\n<p>Test method ELS.Service.Business.IntegrationTest.Base.ServiceBaseIntegrationTest.StartLoggingTestMethod threw exception:  System.Data.MetadataException: Unable to load the specified metadata resource..</p>\n\n<p>With the following stack trace:</p>\n\n<pre><code>System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.LoadResources(String assemblyName, String resourceName, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver)\nSystem.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.CreateResourceLoader(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver)\nSystem.Data.Metadata.Edm.MetadataArtifactLoader.Create(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver)\nSystem.Data.EntityClient.EntityConnection.SplitPaths(String paths)\nSystem.Data.EntityClient.EntityConnection.GetMetadataWorkspace(Boolean initializeAllCollections)\nSystem.Data.EntityClient.EntityConnection.InitializeMetadata(DbConnection newConnection, DbConnection originalConnection, Boolean closeOriginalConnectionOnFailure)\nSystem.Data.EntityClient.EntityConnection.Open()\nELS.Service.Business.Base.ServiceBase.StartLogging(String userWindowsLogon) in C:\\C-TOM\\ELS-RELEASE1\\ELS.Service.Business\\Base\\ServiceBase.cs: line 98\nELS.Service.Business.IntegrationTest.Base.ServiceBaseIntegrationTest.StartLoggingTestMethod() in C:\\C-TOM\\ELS-RELEASE1\\ELS.Service.Business.IntegrationTest\\Base\\ServiceBaseIntegrationTest.cs: line 65\n</code></pre>\n\n<p>However, this code which uses the same connection string:</p>\n\n<pre><code>        using (ELSCommonEntities db = new ELSCommonEntities())\n        {\n            var res = from c in db.Logging\n                      select c;\n\n            int i = res.Count();\n        }\n</code></pre>\n\n<p>Does not give an error. </p>\n\n<p>The connection string is:</p>\n\n<pre><code>  &lt;add name=\"ELSCommonEntities\" connectionString=\"metadata=res://*/Common.CommonModel.csdl|res://*/Common.CommonModel.ssdl|res://*/Common.CommonModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=localhost;Initial Catalog=els5_demo;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>I have also opened up the dll in reflector and the metadata looks ok.</p>\n\n<p>Thanks</p>\n\n<p>Shiraz</p>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":123,"score":0,"question_id":12855360,"title":"MVC4 and Entity Framework 5 stored procedures","body":"<p>Hi Im trying to access a database table in my mvc4 application using a stored procedure and Entity Framework 5. \nI created a FormValueModel.edmx file and imported the User Table and the GetUser Stored Procedure</p>\n\n<p>Here is the code for the GetUser Stored Procedure</p>\n\n<pre><code>SELECT \n    *\nFROM\n    [User].[User]\nWhere\n    @UserName = UserName \n    AND @UserPassword = UserPassword\n    AND Active = 1\n</code></pre>\n\n<p>Here is the code in my Controller to access the stored procedure</p>\n\n<pre><code>using (var db = new FormValueEntities())\n{\n    string userName =\"TestUser\"\n    string password = \"Password\"\n\n    var query = db.GetUser(userName, password);\n\n}   \n</code></pre>\n\n<p>Why cant I access the table by using query.UserName or query.UserPassword ect.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c#","entity-framework","entity-framework-4.1","scaffolding"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12854688,"title":"Scaffold to dropdown list with C# EF4 - code first","body":"<p>I'm using C#.NET, Entity Framework 4.1 and the code first approach. From that i have a bunch of <code>entities</code> and one <code>entity</code> is related to another <code>entity</code>. They have a primary key/foreign key relation.</p>\n\n<p>I'm also using <code>ViewModels</code> to specify which attributes may be scaffolded and i was hoping that the two related entities would create a dropdown list. But that's not happening.</p>\n\n<p>This is just an example of how my entity relation looks, to illustrate my problem.</p>\n\n<p><strong>UserType entity:</strong></p>\n\n<pre><code>public class UserType\n{\n    public int UserTypeID { get; set; }\n    public string Type { get; set; }\n\n    public virtual ICollection&lt;User&gt; Users { get; set; }\n}\n</code></pre>\n\n<p><strong>User entity:</strong></p>\n\n<pre><code>public class User\n{\n    public int UserID { get; set; }\n    public int UserTypeID\n    public string Username { get; set; }\n\n    public bool IsAdmin { get; set; }\n\n    public virtual UserType UserType { get; set; }\n}\n</code></pre>\n\n<p><strong>My ViewModel:</strong></p>\n\n<pre><code>[JsonObject(MemberSerialization = MemberSerialization.OptOut, IsReference = false)]\n[DataContract]\npublic class UserViewModel : BaseViewModel\n{\n    [Key]\n    public int UserID { get; set; }\n\n    public int UserTypeID { get; set; }\n\n    [required]\n    public string Username { get; set; }\n}\n</code></pre>\n\n<p>So the <code>UserViewModel</code> is scaffolded. And i want it to create a dropdown list for the <code>UserType</code>. But right now it only creates an <code>input</code> field for <code>UserTypeID</code>. How can i make it show a dropdown list with the values of <code>UserTypes</code>?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","simplemembership"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":129,"score":0,"question_id":12847291,"title":"GetAllUsers infos (from UserProfile and Membership Tables given by SimpleMembership) with Entity Framework?","body":"<p>First I am really new to .NET framework and all stuff around. What I want to do is to build my admin part for my n-tiers MVC4 App where security is dealt with SimpleMembership. (the default)</p>\n\n<p>Regarding the standard MVC4 template and in order to create my GetAllUsers method, I have decided to create my membership entities (UserProfile, Membership, OAuthMembership and Roles)  in my domain project with EF reverse engineer code first tool and generating my context and my repositories with T4 template for my DAL project.</p>\n\n<p>I am surprised that the Membership Table is not linked with the UserProfile (as you can see in the schema) and I would be really pleased to know why (? first question)</p>\n\n<p><img src=\"http://i.stack.imgur.com/TlVHl.png\" alt=\"membership_schema\"></p>\n\n<p>In a console \"test\" app, (the final goal is to create a gridview where I can have Membership Table and UserProfile Table Infos linked together) there is the method I create in order to get shared Membership and UserProfile info for my users (my service project is not set yet). </p>\n\n<p>Is this the correct way to do it? (second question)</p>\n\n<pre><code>    private static void GetAllUsers()\n    {\n        using (var MembershipRepository = new MembershipRepository())\n        {\n            var i = 1;\n            foreach (var member in MembershipRepository.All)\n            {\n                Console.Write(\"{0}: {1} \", i, member.UserId);\n                using (var UserProfileRepository = new UserProfileRepository())\n                {\n                    Console.WriteLine(\"{0}\", UserProfileRepository.Find(member.UserId).UserName);\n                }\n                i += 1;\n            }\n        }\n        WaitConsole();\n    }\n</code></pre>\n\n<p>(note: I didn't use UnitOfWork and IoC yet but I plan to do it)</p>\n\n<p>Thanks a lot to know if I am on the right track.</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":616,"score":2,"question_id":4438574,"title":"adding List of objects to Context in ef","body":"<p>Is it possible to add list of object to Context in entity framework without using foreach addObject ?</p>\n\n<p>thanks for help</p>\n"},{"tags":["c#","entity-framework","lambda","lambda-functions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12852580,"title":"Dynamic lambda expression","body":"<p>I have created an expression like:  </p>\n\n<pre><code>expression = x =&gt; x.CustomerName.StartsWith(comboParams.ParamValueText, true, null);  \n</code></pre>\n\n<p>I would like access customer name as generic something like this:  </p>\n\n<pre><code>expression = x =&gt; x[\"CustomerName\"] and access the StartsWith function\n</code></pre>\n\n<p>I have already tried code such as </p>\n\n<pre><code>expression x =&gt; x.GetType().GetProperty(\"CustomerName\").Name.StartsWith(comboParams.ParamValueText, true, null); --&gt; it doesn't seem to work :(\n</code></pre>\n\n<p>Is there a way to accomplish this task. I'm making this to have a common implementation for the expression, maybe I'll create a function for this and just accept the string. Thanks!</p>\n"},{"tags":["entity-framework","entity-framework-4","deep-copy"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1785,"score":0,"question_id":4182429,"title":"How make deep copy (clone) in Entity framework 4?","body":"<p>How make deep copy (clone) in Entity framework 4?\nI need get copy of the EntityObject with copies of all related objects.</p>\n"},{"tags":["c#","silverlight","entity-framework","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12704687,"title":"Silvelight&RIA Services&Entity Framework problems with partial classes and complex types there","body":"<p>I'm using RIA Services with Entity Framework and Silverlight as the client Application. I've got some custom properties for EF Entity through partial class. There is a field in Database with XML type and it's mapped to Entity Framework as string. And I use partial class to deserialize this xml string to real object.</p>\n\n<p>This is the partial class for EF Configuration Entity:</p>\n\n<pre><code>public partial class Configuration\n{\n    private ServiceCredentials _serviceCredentialsObject;\n\n    [DataMember]\n    public ServiceCredentials ServiceCredentialsObject\n    {\n        get\n        {\n            return this._serviceCredentialsObject\n                   ?? (this._serviceCredentialsObject = this.DeserializeServiceCredentialsToObject());\n        }\n\n        set\n        {\n            this._serviceCredentialsObject = value;\n            this.SerializeServiceCredentialsObject();\n        }\n    }\n\n    public ServiceCredentials DeserializeServiceCredentialsToObject()\n    {\n        if (string.IsNullOrEmpty(this.ServiceCredentials))\n        {\n            return null;\n        }\n\n        var result = XmlSerializerHelper.Deserialize&lt;ServiceCredentials&gt;(this.ServiceCredentials);\n        result.FileEncoding = result.FileEncoding ?? Encoding.UTF8;\n\n        return result;\n    }\n\n    public void SerializeServiceCredentialsObject()\n    {\n        if (this.ServiceCredentialsObject == null)\n        {\n            this.ServiceCredentials = null;\n            return;\n        }\n\n        this.ServiceCredentials = XmlSerializerHelper.Serialize(this.ServiceCredentialsObject);\n    }\n\n}\n</code></pre>\n\n<p>And this is the object i'm trying to Deserialize:</p>\n\n<pre><code>[Serializable]\npublic class ServiceCredentials\n{\n\n    public NetworkCredential Credential { get; set; }\n\n    public Encoding FileEncoding { get; set; }\n\n    [XmlIgnore]\n    public long HistoryID { get; set; }\n\n    public string LoadFileStoragePath { get; set; }\n\n    public string ManualLoadFilePath { get; set; }\n\n    public bool NeedAuthorization { get; set; }\n\n    [XmlIgnore]\n    public string ProviderID { get; set; }\n\n    public string SourceUrl { get; set; }\n\n    public bool AutomaticTransferToProductive { get; set; }\n}\n</code></pre>\n\n<p>When I'm trying to use Configuration Entity on silverlight client-side with generated code find an issue that there is no ServiceCredentialsObject in Configuration class. And it's not added to DomainService.metadata.cs if i create new one. If i add ServiceCredentialsObject to DomainService.metadata.cs manually i can access it on clien-side after rebuild but i can find only properties with simple types there. For example a can acess HistoryID,SourceUrl,AutomaticTransferToProductive but there are no generated properties for </p>\n\n<p>public NetworkCredential Credential { get; set; }\n  public Encoding FileEncoding { get; set; }</p>\n\n<p>How can i fix this?</p>\n"},{"tags":["entity-framework","orm","entity-framework-4.1","ef-code-first","dynamic-proxy"],"answer_count":2,"favorite_count":4,"up_vote_count":11,"down_vote_count":0,"view_count":2911,"score":11,"question_id":7111109,"title":"Should I enable or disable dynamic proxies with entity framework 4.1 and MVC3?","body":"<p>Could someone offer up some advice or point out some blogs/articles that could help with making this decision? The proxies seem very foreign to me and I'm hesitant to use them. I like the ability to control Lazy Loading by using virtual properties in my model, but that's pretty much all the benefits that I can see. My application is a simple MVC web application and I don't need to wire up any hooks into the context for when the entities experience a changed state. </p>\n\n<p>Anyway, here's my very limited list of pros and cons right now, let me know if I'm off base with any of this. </p>\n\n<p><em><strong>Pros</em></strong></p>\n\n<ul>\n<li>On 'Save' or 'Update',  I get seamless with 'Apply'Changes'</li>\n<li>Lazy-Loading configuration is very easy.</li>\n</ul>\n\n<p><em><strong>Cons</em></strong></p>\n\n<ul>\n<li>Never used proxies before for my entities, this is a change in\napproach that just seems uncomfortable for myself and fellow team\nmembers. </li>\n<li>Awkward to debug. </li>\n<li>Requires extra code if I want serialize/de-serialize</li>\n<li>On 'Save' or 'Update', the proxy must be the same object that was retrieved from the context.</li>\n</ul>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":5,"view_count":88,"score":-2,"question_id":12849325,"title":"EntityFramework - Which one is better for Unit-testing CodeFirst or Database First","body":"<p>I am kind of lost finding the best way to start developing application using Entity Framework.\nRead so many article and looks like both has its pros and cons. I am pretty much open to adopt either one of them but needs some advice specifically on Unit testing. </p>\n\n<p>Which approach will be more friendly towards Unit Testing?</p>\n\n<p>I would appreciate if you guys can give link to resources that uses latest version of Entity Framework.</p>\n\n<p>Thanks</p>\n"},{"tags":[".net","entity-framework","orm","entity-framework-4","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":12849843,"title":"Extending or inheriting from an EF 5 DbContext","body":"<p>Is there a way to extend a EF 5 DbContext to include additional columns or tables?</p>\n\n<p>We have an application that has it's own schema, but when a customer asks for some custom feature, we can add fields or tables to his application.</p>\n\n<p>Example:</p>\n\n<pre><code>Table 'Customers'\n\nCustId\nName\nAddress\n</code></pre>\n\n<p>The customer asks for a 'Phone' field that is exclusive to his application so we add a column to the 'Customers' table.</p>\n\n<p>Our base model contains a definition for CustId, Name and Address, but what about the 'Phone' field that is restricted to this particular client?</p>\n\n<p>I was thinking about merging the 2 DbContext or making our customer's DbContext inherit from the base DbContext, but none of those 2 options seems to be possible.</p>\n\n<p>Duplicating the base DbContext would be a huge pain since the application has more than 600 tables and we do not want to go through all the models to add a field when we modify our base application.</p>\n\n<p>Any ideas?</p>\n\n<p>Are there other ORMs that makes this possible?</p>\n"},{"tags":["c#","entity-framework","edmx","database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12815028,"title":"Edmx missing foreign keys","body":"<p>I am mapping my database using Entity Framework, using the database-first approach. </p>\n\n<p>The problem is that the <code>edmx</code> file that should be mapping my exact database is missing some FK relations between the tables, which causes me to change my queries, because I can't approach the related tables directly. </p>\n\n<p>Of course changing it directly in the classes code, it's erased every time I change something in the database (the <code>edmx</code> is recreated). </p>\n\n<p>I need help please!!!</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12847609,"title":"\"Cannot convert lambda expression to type 'string' because it is not a delegate type\" in .NET 4.5","body":"<p>I am trying out an existing .NET 4.0 solution in VS2012 on a test machine (that only has VS2012 and SQL Server 2008 installed), and am getting the above error when I try to use the lambda syntax with the Include extension method.</p>\n\n<p>The existing version of the solution has a reference to EntityFramework.dll, which is the one I had to add to use the Include method, but the upgraded version I'm looking at in VS2012 does not have such a reference, nor can I find a DLL of that name in the location it was on the other machine. The using statement for System.Data.Entity is greyed out, as ReSharper thinks it isn't needed. Don't know why.</p>\n\n<p>Sample code: This is what is in the existing solution...</p>\n\n<pre><code>using (var context = new RSSFeedsEntities()) {  \n  WebSite someSite = context.WebSites.Include(w =&gt; w.Feeds).FirstOrDefault(w =&gt; w.WebSiteID == 1);  \n}\n</code></pre>\n\n<p>Any idea how to solve this? Thanks</p>\n"},{"tags":["c#","entity-framework",".net-3.5","lambda"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12833777,"title":"Query with triple selector","body":"<p>I'm currently have  Lambda Expresion: <a href=\"http://pastebin.com/ZGCiQdHe\" rel=\"nofollow\">http://pastebin.com/ZGCiQdHe</a></p>\n\n<p>And i get ArgumentException in 53 line \n<a href=\"http://msdn.microsoft.com/en-us/library/bb340145%28v=vs.90%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb340145(v=vs.90).aspx</a></p>\n\n<pre><code>var lExpresion = Expression.Lambda&lt;Func&lt;TEntity, bool&gt;&gt;(body, parametrsNumber, parametrsTyp, parametrsLp);\n</code></pre>\n\n<p>But i not understand what i do wrong.</p>\n\n<p>I want to get:</p>\n\n<pre><code>    WHERE ((twr_gidnumer =1 and twr_gidtyp = 1 and twr_gidlp = 1) OR \n    (twr_gidnumer =1 and twr_gidtyp = 1 and twr_gidlp = 2))\n</code></pre>\n\n<p>--ANSWERR FULL</p>\n\n<p>Based on article:</p>\n\n<p><a href=\"http://blogs.msdn.com/b/mattwar/archive/2007/07/31/linq-building-an-iqueryable-provider-part-ii.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/mattwar/archive/2007/07/31/linq-building-an-iqueryable-provider-part-ii.aspx</a>\n<a href=\"http://stackoverflow.com/a/3530666/266202\">http://stackoverflow.com/Converting 2 argument Lambda expression to 1 argument Lambda expression</a></p>\n\n<pre><code>public static Expression&lt;Func&lt;CDNXL_TwrKarty, bool&gt;&gt; Bind2nd(Expression&lt;Func&lt;CDNXL_TwrKarty, CDNXL_TwrKarty,CDNXL_TwrKarty, bool&gt;&gt; source)\n{\n    Expression newBody = new Rewriter(source.Parameters[0]).Visit(source.Body);\n    return Expression.Lambda&lt;Func&lt;CDNXL_TwrKarty, bool&gt;&gt;(newBody, source.Parameters[0]);\n}\n\ninternal class Rewriter : ExpressionVisitor\n{\n    private readonly ParameterExpression candidate_;\n\n    public Rewriter(ParameterExpression candidate)\n    {\n        candidate_ = candidate;\n    }\n\n    protected override Expression VisitParameter(ParameterExpression p)\n    {\n        return candidate_;\n    }\n}\n</code></pre>\n\n\n\n<pre><code>//REPLACE EXECUTING PLACE\nvar retMultiLamnda = Expression.Lambda&lt;Func&lt;CDNXL_TwrKarty, CDNXL_TwrKarty, CDNXL_TwrKarty, bool&gt;&gt;(body, parametrsNumber, parametrsTyp, parametrsLp);\nvar retOneLambda = Bind2nd(retMultiLamnda);\nvar retQuery = query.Where(retOneLambda);\nreturn retQuery;\n</code></pre>\n\n<p><strong>Thanx <a href=\"http://stackoverflow.com/users/1495595/rafal\">Rafal</a> for Help.</strong></p>\n"},{"tags":["entity-framework","dataannotations","fluent"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":12848005,"title":"Data annotations or Fluent API in EF 4.4 vs. EF 5.0?","body":"<p>I have an ASP.NET MVC project created with EF 4.4 and SQL Express. In my model there are a two objects, User and Department. A department has a public User DepartmentManager navigation property with a public Guid DepartmentManagerId foreign key with this data annotation:\n[ForeignKey(\"DepartmentManager\")]. Using code first, the Department table is created properly with ONE Guid column for DepartmentManagerId. </p>\n\n<p>However, with that same setup in EF 5.0 if I user code first and create the DB, my Department table gets created with a DepartmentManagerId column AND a DepartmentManager_UserId column.</p>\n\n<p>To make things more interesting, if in EF 5.0 I remove the foreign key annotation and use Fluent API like so:</p>\n\n<pre><code>modelBuilder.Entity&lt;Department&gt;()\n    .HasRequired(u =&gt; u.DepartmentManager)\n    .WithMany()\n    .HasForeignKey(u =&gt; u.DepartmentManagerId);\n</code></pre>\n\n<p>..the DB gets generated correctly. Thus two questions. Are data annotations handled differently from EF 4.4 to EF 5.0? Secondly, what is the difference between the ForeignKey data annotation and the fluent mapping above? There should be no difference but when the DB is created the is the extra column from the data annotation. Any ideas? Thanks in advance.</p>\n"},{"tags":["entity-framework","c#-4.0","lambda"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12423995,"title":"can i use custom lambda method in entity framework?","body":"<p>i have some methods like:</p>\n\n<pre><code>public static string ToOtherFormat (this string inp)\n{\n  // some code to change inp\n  return inp;\n}\n</code></pre>\n\n<p>and in my select i want to have code like this:</p>\n\n<pre><code>var DetailMembers = db.TB_Members\n                      .Where(x=&gt; x.FName == obj.ToOtherFormat())\n                      .Select( x=&gt; new { name = (x.FName.ToOtherFormat() + \" \" + x.LName) , x.ActCode });\n</code></pre>\n\n<p>i try and just have error. is it possible?<br/> \nthanks!<br>\ni receive this error in simple convert to integer<br></p>\n\n<blockquote>\n  <p>LINQ to Entities does not recognize the method 'Int32 ToInt32(System.String)' method, and this method cannot be translated into a store expression.</p>\n</blockquote>\n\n<p>with this code<br></p>\n\n<pre><code> .Where(x =&gt; x.MemberID == Convert.ToInt32(Hmemid.Hash_two_Decrypt())\n</code></pre>\n"},{"tags":["c#","sql-server-2008","entity-framework","associations"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12844758,"title":"Entity Framework Odd Behaviour","body":"<p>I've not been working with EF until this week (v5) and now I'm making a few database changes it's doing some really weird things.</p>\n\n<p>I deleted an NVARCHAR Country field and replaced that with an CountryId int field that is a Foreign Key to the Id column of the Country table</p>\n\n<pre><code>ALTER TABLE [dbo].[UserProfile]  WITH CHECK ADD  CONSTRAINT [FK_UserProfile_Countries]   FOREIGN KEY([CountryId])\nREFERENCES [dbo].[Countries] ([Id])\n</code></pre>\n\n<p>Updating the model in VS2012 is doing some really unexpecting things.  Its reporting an error on the field I removed:</p>\n\n<blockquote>\n  <p>Error 11010: Association End 'Country' is not mapped.</p>\n</blockquote>\n\n<p>And I have two virtual fields added to the model which doesn't seem correct:</p>\n\n<pre><code>public partial class UserProfile\n{\n    public int UserId { get; set; }\n    ...\n    public int CountryId { get; set; }\n\n    public virtual Country Country { get; set; }\n    public virtual Country Country1 { get; set; }\n}\n</code></pre>\n\n<p>I've read there is a bug with the designer and manually running \"Run Custom Tool\" on the .tt files fixes this but it doesn't appear to have worked.</p>\n\n<p>Has anyone seen this or solved it?</p>\n"},{"tags":["c#",".net","entity-framework","transactions"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":12839187,"title":"Should a transaction be used in my case?","body":"<p>Here is a quote \" So, if you are working with only one object context then you have already built-in support for database transactions when using the ObjectContext.SaveChanges method.\" I found here <a href=\"http://www.luisrocha.net/2011/08/managing-transactions-with-entity.html\" rel=\"nofollow\">http://www.luisrocha.net/2011/08/managing-transactions-with-entity.html</a></p>\n\n<p>So according to that, I don't have to use <code>TransactionScope</code> in a code below, right?</p>\n\n<pre><code>if (isLastCallSuccess)\n {\n   if (condition1) //it's clear, no transaction needed\n    {\n      product.Property1 = true;\n      context.SaveChanges();\n    }\n\n    else if (condition2)\n     {\n      using (TransactionScope scope = new TransactionScope()) //do I need it?\n      {\n        context.DeleteObject(item);             //deleting\n        context.AddObject(\"product\", new product      //adding\n                                {\n                                    Id = oldObject.Id,\n                                    Property1 = true\n                                });\n        context.SaveChanges(System.Data.Objects.SaveOptions.DetectChangesBeforeSave);\n                                scope.Complete();\n        context.AcceptAllChanges();\n\n        }\n      }\n</code></pre>\n"},{"tags":["entity-framework","ado.net"],"answer_count":5,"favorite_count":19,"up_vote_count":37,"down_vote_count":0,"view_count":13287,"score":37,"question_id":1412863,"title":"How do I view the SQL generated by the entity framework?","body":"<p>How do I view the SQL generated by entity framework ?</p>\n\n<p>(In my particular case I'm using the mysql provider - if it matters)</p>\n\n<p><strong>Duplicate</strong>: <a href=\"http://stackoverflow.com/questions/137712/sql-tracing-linq-to-entities#138109\">http://stackoverflow.com/questions/137712/sql-tracing-linq-to-entities#138109</a></p>\n"},{"tags":[".net","entity-framework","syntax"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12844907,"title":"Is there a way to chain together Where() statements with OR conditions, as in OrWhere(), in Entity Framework?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5428806/linq-simulate-an-orwhere-expression-when-building-linq-queries-dynamically\">Linq - Simulate an OrWhere expression when building LINQ queries dynamically?</a>  </p>\n</blockquote>\n\n\n\n<p>I was wondering if anyone can help me.</p>\n\n<p>I know that in entity framework we can chain wheres together so for instance</p>\n\n<pre><code>data.Where(x=&gt;x.Id == id ).Where(x=&gt;x.Name == name).Where(x=&gt;x.State == state);\n</code></pre>\n\n<p>so basically the where translates into AND</p>\n\n<pre><code>data.Where(x=&gt;x.Id==id &amp;&amp; x.Name == name &amp;&amp; x.State == state);\n</code></pre>\n\n<p>Is there a way to do the same for OR</p>\n\n<pre><code>data.Where(x=&gt;x.Id==id || x.Name == name || x.State == state);\n</code></pre>\n\n<p>could be represented as ...</p>\n"},{"tags":["entity-framework","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":12843510,"title":"VS 2012RC Entity Framework Model First still generates ObjectContext based code","body":"<p>I used EF (Model First) today for the first time since installing VS2012RC. I was surprised to see that the generated code inherited from ObjectContext (EF 4.x style) rather than DbContext (EF 5.x). To make sure that I hadn't missed something obvious I found and followed the following tutorial - <a href=\"http://msdn.microsoft.com/en-gb/data/jj205424\" rel=\"nofollow\">MSDN Model First Sample</a></p>\n\n<p>with the same result. At ~4:10 in the video it clearly shows that BloggingContext inherits DbContext. My generated code:</p>\n\n<pre><code>/// &lt;summary&gt;\n/// No Metadata Documentation available.\n/// &lt;/summary&gt;\npublic partial class BloggingContext : ObjectContext\n{\n</code></pre>\n\n<p>My .edmx file is in the root project folder and no template files (*.tt) get added automatically as the video shows they should. If I manually 'Add Code Generation Item' (DbContext Fluent...) the code does get generated properly.</p>\n\n<p>Is this a known problem with the RC version of VS or any other ideas?</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","table-per-type"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12843678,"title":"Converting a EF CodeFirst Base class to a Inherited class (using table-per-type)","body":"<p>I am using EF Code First and have two classes defined as follows:</p>\n\n<pre><code>public class User\n{\n    public int Id { get; set; }\n    public string Username { get; set; }\n    public string Email { get; set; }\n}\n\n[Table(\"Visitors\")]\npublic class Visitor : User\n{\n    public Visitor()\n    {\n        Favourites = new List&lt;Building&gt;();\n    }\n    public virtual IList&lt;Building&gt; Favourites { get; set; }\n}\n</code></pre>\n\n<p>This uses Table-Per-Type inheritance and defines the DB schema as follows:</p>\n\n<pre><code>Users Table\n    Id int PK\n    Username nvarchar(max)\n    Email nvarchar(max)\nVisitors Table\n    Id int PK (FK to Users table)\n</code></pre>\n\n<p>This is exactly how I wanted it to structure it. <strong>Now my question is</strong>, if I create a User object and save it to the DB, how will I later on be able to extend that into a Visitor (if I need to?) Will I need to delete the user and create a new Visitor or can I some how cast the user into a visitor object and the entry in the user table will remain intact and a new entry will be added to the visitor table referencing the user? Something like the below code?</p>\n\n<pre><code>Context.Set&lt;User&gt;().Add(new User(){Id=1, Username=\"Bob\", Email=\"bob@mail.bob\"});\nContext.SaveChanges();\n\n//and elsewhere in the project I want to do this sort of thing:\nContext.Set&lt;Visitor&gt;().Where(v=&gt;v.Id == 1).FirstOrDefault().Favourites.Add(someFavouriteBuilding); //This obviously doesn't work, because the FirstOrDefault call returns null, so it will throw an exception\nContext.SaveChanges();\n\n//or maybe this can be modified slightly to work?:\nvar visitor = Context.Set&lt;Visitor&gt;().Where(v=&gt;v.Id == 1).FirstOrDefault();\nif (visitor==null)\n{\n    visitor = new Visitor(Context.Set&lt;User&gt;().Where(u=&gt;u.Id == 1).FirstOrDefault()); // this contructor copies all the property values accross and returns a new object\n}\nvisitor.Favourites.Add(someFavouriteBuilding); //This obviously doesn't work either\nvar entry = Context.Entry(visitor);\nentry.State = EntityState.Modified;//here it throws this error: An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key.\nContext.SaveChanges();\n</code></pre>\n\n<p>I think the second approach in the above code may work if I can only attach it to the context correctly. Anyway, the code above is only to show you what I am trying to achieve. I know it will not work. Can anyone suggest a more elegent approach?</p>\n\n<p>Thank you</p>\n"},{"tags":[".net","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12841045,"title":"ASP.net -Trying to associate one primary key to multiple foreign keys","body":"<p>I have a list of Ingredients that exist that contain a primary key: ingredientID and a foreign key: recipeID. I have been trying to map a single ingredient to many Recipes, which each contain a recipeID and an ingredientID.</p>\n\n<p>Previously, I assigned the Ingreients recipeID to the same as the target Recipes recipeID. this restrained the Ingredient to being associated with a single Recipe however.</p>\n\n<p>By associating the Recipes ingredientID with an ingredient, it seems that Recipe can then only have one Ingredient associated with it, but that Ingredient can be associated with other recipes.</p>\n\n<p>I have tried to create a recipeIngredient that contains a recipeID and an ingredientID to associate Recipes and Ingredients, but I had no success.</p>\n\n<p>Here is a description of the current models.</p>\n\n<p>Recipe Model:</p>\n\n<pre><code>    [Key]\n    public int recipeID { get; set; }\n    public int ingredientID { get; set; }\n    public string Name { get; set; }\n    public string Description { get; set; }\n    public decimal Cost { get; set; }\n\n    public virtual NutritionalValue NutritionalDetails { get; set; }\n    public virtual ICollection&lt;Ingredient&gt; Ingredients { get; set; }\n    public virtual ICollection&lt;RecipeStep&gt; RecipieSteps { get; set; }\n</code></pre>\n\n<p>Ingredient Model:</p>\n\n<pre><code>    [Key]\n    public int ingredientID { get; set; }\n    //public int recipeID { get; set; }\n    public string Name { get; set; }\n    public string Descritpion { get; set; }\n    public decimal Cost { get; set; }\n    public decimal Amount { get; set; }\n    public string Type { get; set; }\n\n    public virtual Recipe Recipe { get; set; }\n</code></pre>\n\n<p>The final concept from this that I am trying to achieve is that the user selects an ingredient within the Recipes edit view, selects the ingredient that was already previously added and clicks save to associate it with that particular Recipe, but can also go on to associate it with further Recipes simultaneously. </p>\n\n<p>Many thanks.</p>\n"},{"tags":["entity-framework","connection-string","datadirectory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":12709644,"title":"\"URI formats are not supported\" exception when using |DataDirectory| in Entity Framework connection string","body":"<p>I have a unit test project in Visual Studio 2012 where I am storing the AdventureWorks MDF file for SQL Server 2012 (the file is named AdventureWorks2012_Data.mdf).  In the Visual Studio Server Explorer, I am able to add the MDF in the Data Connections and browse the database.  Right clicking on $/Data Connections/AsventureWorks2012_Data.mdf and selecting properties gives me access to the connection string as follows:  </p>\n\n<p>Data Source=(LocalDB)\\v11.0;AttachDbFilename=C:\\Projects\\Common\\Source\\Framework\\Framework.Data.Tests\\AdventureWorks2012_Data.mdf;Integrated Security=True;Connect Timeout=30</p>\n\n<p>I copied this into my Entity Framework connection string in the app.config file as follows:</p>\n\n<pre><code>&lt;!-- Works :-) --&gt;\n&lt;connectionStrings&gt;\n  &lt;add name=\"AdventureWorksEntities\" \n       connectionString=\"metadata=res://*/Repository2Tests.AdventureWorks.csdl|res://*/Repository2Tests.AdventureWorks.ssdl|res://*/Repository2Tests.AdventureWorks.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=(LocalDB)\\v11.0;AttachDbFilename=C:\\Projects\\Common\\Source\\Framework\\Framework.Data.Tests\\AdventureWorks2012_Data.mdf;Integrated Security=True;Connect Timeout=30App=EntityFramework&amp;quot;\" \n       providerName=\"System.Data.EntityClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>Note that the AttachDbFilename contains the full path of the MDF file as: \nC:\\Projects\\Common\\Source\\Framework\\Framework.Data.Tests\\AdventureWorks2012_Data.mdf</p>\n\n<p>When I run the unit tests, everything is fine as expected.  </p>\n\n<p>I changed AttachDbFilename to |DataDirectory|\\AdventureWorks2012_Data.mdf as described in \"<a href=\"http://msdn.microsoft.com/en-us/library/cc716756%28v=vs.100%29.aspx\" rel=\"nofollow\">ADO.NET Entity Framework Connection Strings</a>\" and I set the DataDirectory as described in \"<a href=\"http://stackoverflow.com/questions/1409358/ado-net-datadirectory-where-is-this-documented\">ADO.NET |DataDirectory| where is this documented?</a>\" so that my connection string now is as follows:</p>\n\n<pre><code>&lt;!-- Doesn't work :-( --&gt;\n&lt;connectionStrings&gt;\n  &lt;add name=\"AdventureWorksEntities\" \n       connectionString=\"metadata=res://*/Repository2Tests.AdventureWorks.csdl|res://*/Repository2Tests.AdventureWorks.ssdl|res://*/Repository2Tests.AdventureWorks.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=(LocalDB)\\v11.0;AttachDbFilename=|DataDirectory|\\AdventureWorks2012_Data.mdf;Integrated Security=True;Connect Timeout=30;App=EntityFramework&amp;quot;\" \n       providerName=\"System.Data.EntityClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>The change to using |DataDirectory| resulted in the following runtime error:</p>\n\n<pre><code>System.Data.EntityException: The underlying provider failed on ConnectionString. ---&gt; System.ArgumentException: URI formats are not supported.\nHResult: -2147024809\nat System.IO.Path.NormalizePath(String path, Boolean fullCheck, Int32 maxPathLength)\nat System.IO.Path.GetFullPath(String path)\nat System.Data.Common.ADP.GetFullPath(String filename)\nat System.Data.Common.DbConnectionOptions.ExpandDataDirectory(String keyword, String value, String&amp; datadir)\nat System.Data.SqlClient.SqlConnectionString..ctor(String connectionString)\nat System.Data.SqlClient.SqlConnectionFactory.CreateConnectionOptions(String connectionString, DbConnectionOptions previous)\nat System.Data.ProviderBase.DbConnectionFactory.GetConnectionPoolGroup(DbConnectionPoolKey key, DbConnectionPoolGroupOptions poolOptions, DbConnectionOptions&amp; userConnectionOptions)\nat System.Data.SqlClient.SqlConnection.ConnectionString_Set(DbConnectionPoolKey key)\nat System.Data.SqlClient.SqlConnection.set_ConnectionString(String value)\nat System.Data.EntityClient.EntityConnection.ChangeConnectionString(String newConnectionString)\n--- End of inner exception stack trace ---\nHResult: -2146233087\nat System.Data.EntityClient.EntityConnection.ChangeConnectionString(String newConnectionString)\nat System.Data.Entity.Internal.LazyInternalConnection.TryInitializeFromAppConfig(String name, ConnectionStringSettingsCollection connectionStrings)\nat System.Data.Entity.Internal.LazyInternalConnection.Initialize()\nat System.Data.Entity.Internal.LazyInternalConnection.get_ConnectionHasModel()\nat System.Data.Entity.Internal.LazyInternalContext.InitializeContext()\nat System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType)\nat System.Data.Entity.Internal.Linq.InternalSet`1.Initialize()\nat System.Data.Entity.Internal.Linq.InternalSet`1.get_InternalContext()\nat System.Data.Entity.Internal.Linq.InternalSet`1.Create()\n</code></pre>\n\n<p>I have researched this for a couple days now and tried countless variations without success.  I even debugged into Microsoft code but with compiler optimizations I am unable to see any debugging information on the stack.</p>\n\n<p>Has anyone run across this specific problem? </p>\n"},{"tags":["c#",".net","database","entity-framework","azure"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":527,"score":0,"question_id":9850368,"title":"My webrole.cs can't seem to find a connection string","body":"<p>I've got a Azure/Cloud based project (single project only). It has a WCF/WebRole added to the project. My WCF services are using the entity framework to talk to a SQLAzure database. This is working very well.</p>\n\n<p>In the web.config of the project I have the following:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"CommuteEntities\" connectionString=\"metadata=res://*/Db.CommuteDataModel.csdl|res://*/Db.CommuteDataModel.ssdl|res://*/Db.CommuteDataModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=&lt;db-here&gt;.database.windows.net;initial catalog=dandr;persist security info=True;user id=&lt;user-id-here&gt;;password=&lt;password-here&gt;;multipleactiveresultsets=True;App=EntityFramework&amp;quot; \" providerName=\"System.Data.EntityClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>All's well so far. So I want to do a small amount of scheduled background processing (based on a timer and not an incoming request). Its too small a task to justify starting a WorkerRole for the job.</p>\n\n<p>So instead, I created something like the following in the WebRole projects <code>WebRole.cs</code></p>\n\n<pre><code>public override void Run()\n{\n    while (true)\n    {\n      //This is for debug purposes:\n      string str = ConfigurationManager.ConnectionStrings[\"CommuteEntities\"].ToString();\n\n      BackgroundProcessing.BackgroundProcessing.BackgroundProcess();\n      Thread.Sleep(150000); //2.5mins\n    }\n}\n</code></pre>\n\n<p>For some reason the line to get the connection string just does not seem to work. However, putting the same code into a WCF service works just great. </p>\n\n<p>Just to emphasis, there is only one project in this solution and the <code>WebRole.cs</code> is located in the same project as the working WCF services.</p>\n\n<p><strong>Note</strong>: The getting of the connection string is just for debug purposes. The underlying issue that I have is that when my WebRole.cs tries to access a Entity it gets the following exception message:</p>\n\n<p><code>The specified named connection is either not found in the configuration, not intended to be used with the EntityClient provider, or not valid.</code></p>\n\n<p><strong>Note 2:</strong>: I've just noticed that it would appear that anything in my <code>WebRole.cs</code> can't see anything that has been configured in the <code>Web.config</code> file. Is there something that I'm not doing correctly or misunderstanding?</p>\n\n<p>Anybody come across this before or have any ideas?</p>\n"},{"tags":["asp.net","entity-framework","website"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12840364,"title":"Build order issue in an ASP.net Web Site","body":"<p>I had a Web Application that used to work just fine but I needed to use VB and C# and that's why I started the project as a Web Site.</p>\n\n<p>I created two subfolders into the <code>App_Code</code> folder and I wrote this in the <code>web.config</code> file:</p>\n\n<pre><code>&lt;codeSubDirectories&gt;\n  &lt;add directoryName=\"VB_Code\" /&gt;\n  &lt;add directoryName=\"CS_Code\" /&gt;\n&lt;/codeSubDirectories&gt;\n</code></pre>\n\n<p>Then, I placed my Entity Data Model in the root of the App_Code folder. This way, I received the follow warning when I tried to compile:</p>\n\n<p><code>Namespace or type specified in the Imports 'ProductizationModel' doesn't contain any public member or cannot be found. Make sure the namespace or the type is defined and contains at least one public member. Make sure the imported element name doesn't use any aliases.</code></p>\n\n<p>and a lot of errors related with this fact: the EDM was not builded and its namespace didn't exist yet. This errors come from classes that access to the database through my EDM and that are declared inside the VB_Code folder.</p>\n\n<p>Then, after research, I find that VS follows a build order and that the subfolders inside the <code>App_Code</code> are builded before the files in the root.</p>\n\n<p>I've created one more subfolder called <code>EF_Code</code> and declared it in the <code>web.config</code> file:</p>\n\n<pre><code>&lt;codeSubDirectories&gt;\n  &lt;add directoryName=\"EF_Code\"/&gt;\n  &lt;add directoryName=\"VB_Code\" /&gt;\n  &lt;add directoryName=\"CS_Code\" /&gt;\n&lt;/codeSubDirectories&gt;\n</code></pre>\n\n<p>but I'm still receiving the same warnings and errors.</p>\n\n<p>Anybody can light me?</p>\n\n<p>Thanks a lot,</p>\n"},{"tags":["asp.net","entity-framework","entity-framework-4","repository-pattern"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":133,"score":0,"question_id":12814254,"title":"How to de-attach an entity from a Context in Entity Framework?","body":"<p>I use EF 4.1 with Repository and DbContext.. POCO with T4 template.\nFor every Repository I use a separate DbContext.</p>\n\n<p>I need to update an object with has a related property, at the moment I receive this error</p>\n\n<pre><code>An entity object cannot be referenced by multiple instances of IEntityChangeTracker.\n</code></pre>\n\n<p>I suppose my problem is beacuse <code>eventObj</code> and <code>candidate</code> are created from different Repositories.</p>\n\n<p>So i'm trying to solve the problem with this code, with no success.</p>\n\n<p>My question?</p>\n\n<ul>\n<li>How do I get rid of this error?</li>\n<li><p>Is is possible remove the candidate from its context?</p>\n\n<pre><code>public void UpdateAddingCandidate(Event eventObj, Candidate candidate){\n    Event updatedEvent = new Event();\n    Candidate updatedCandidate = new Candidate();\n    updatedEvent = eventObj;\n    updatedCandidate = candidate;\n    updatedEvent.Candidate = updatedCandidate;\n    db.Entry(updatedEvent).State = EntityState.Modified;     \n}\n</code></pre></li>\n</ul>\n\n<p>EDIT</p>\n\n<pre><code>    public void UpdateAddingCandidate(Event eventObj, Candidate candidate)\n    {\n        /*\n        db.Events.AsNoTracking();\n        db.Candidates.AsNoTracking();\n        */\n        db.Entry(eventObj).State = EntityState.Detached;\n        db.Entry(candidate).State = EntityState.Detached;\n\n        Event updatedEvent = new Event();\n        Candidate updatedCandidate = new Candidate();\n        updatedEvent = eventObj;\n        updatedCandidate = candidate;\n        updatedEvent.Candidate = updatedCandidate;\n        db.Entry(updatedEvent).State = EntityState.Detached;\n        db.Entry(updatedEvent).State = EntityState.Modified;\n\n    }\n</code></pre>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12841467,"title":"Many lookups in one table, foreign key or non enforced code","body":"<p>I am modelling a customer entity in EF Designer, and use Model Based DB generation. A good number of the fields(about 10) will be sourced from the APS.NET MVC interface via dropdowns. I want to keep it simple. I also did not want to normalise the DB in the Nth degree as this could complicate the queries. Typically 2 or 3  values ie \"Male\",\"Female\"  I have a number of options:</p>\n\n<p>1) Use a code table with name, and store just code in customer table without enforcing FK constraint, ie 10 for \"Female\", 20 for \"Male\".</p>\n\n<p>2) Use enforcing FK constraint against code table</p>\n\n<p>3) Use Lookup from Code Table, and put Code Name into Customer field.</p>\n\n<p>4) Use some form of ASP.NET enumeration and populate Customer field with value.</p>\n\n<p>1) may be an issue with \"LINQ include\" commands since the child record will be unknown.\nI am sure there is a standard MVC/EF solution for this scenario.</p>\n\n<p>Many thanks in advance,</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":12808102,"title":"Entity Framework 5 Code Migration doesn't create database","body":"<p>I'm trying to use Entity Framework 5 Code First.\nI've created model classes and context.</p>\n\n<p>After that following Microsoft instructions I've enabled code migrations.</p>\n\n<p>Than I skipped running my application (during which DB should be created first time) and use Add-Migration command. Migration was generated successfully. </p>\n\n<p>Update-Database call was also successfull. <strong>But I'm not seeing my DB at all.</strong> It is absent! </p>\n\n<p>SQL Management Studio and Visual Studio Server Explorer show only 4 default system databases and that's all!\nI also tried to launch my application - it doesn't change anything.\nI'm using </p>\n\n<pre><code>public MyContext() : base(\"name=MyContext\") { }\n</code></pre>\n\n<p>such type of constructor (so I need specify connection string with <strong>MyContext</strong> name.\nHere is my <strong>app.config</strong> example:</p>\n\n<pre><code>&lt;configuration&gt;\n    &lt;configSections&gt;\n      &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n      &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n    &lt;/configSections&gt;\n    &lt;entityFramework&gt;\n      &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework\"&gt;\n        &lt;parameters&gt;\n          &lt;parameter value=\"v11.0\" /&gt;\n        &lt;/parameters&gt;\n      &lt;/defaultConnectionFactory&gt;\n    &lt;/entityFramework&gt;\n    &lt;startup&gt; \n        &lt;supportedRuntime version=\"v4.0\" sku=\".NETFramework,Version=v4.5\" /&gt;\n    &lt;/startup&gt;\n    &lt;connectionStrings&gt;\n      &lt;add name=\"BettyContext\" providerName=\"System.Data.SqlServerCe.4.0\" connectionString=\"Data Source=MyDB.sdf\"/&gt;\n    &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>I have no idea what's going on. Seems that no one has such problem. May be I've missed some evident thing, but howbeit I'm waiting for some help.</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":62,"score":-1,"question_id":12838229,"title":"foreach and changing a variable in EF 4.0","body":"<p>I'm working with Entity Framework 4.0. Here is a code I'm using</p>\n\n<pre><code>foreach (var item in context.Items.Where(x =&gt; !x.New))\n {\n   // .......\n   item.New = true;\n   context.SaveChanges();\n   Console.WriteLine(\"done\");\n }\n</code></pre>\n\n<p>Athough there is no exception appeares, <code>Console.WriteLine(\"done\");</code> <strong>never</strong> executes. every time the program finishes  for some reason.</p>\n\n<p>What did I do wrong?</p>\n"},{"tags":["c#","entity-framework","thread-safety","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12828140,"title":"Are EF objects thread-safe?","body":"<p>Following <a href=\"http://stackoverflow.com/questions/6126616/is-dbcontext-thread-safe\">this question</a> about the thread-safety of DbContext (it isn't), I need to know if it's safe to handle mapped POCOs in multiple threads.</p>\n\n<p>Suppose I have two objects mapped to the database using CodeFirst:</p>\n\n<pre><code>class Poco1\n{\n    public int Id { get; set; }\n    public string SomeProp {get; set;}\n    public virtual List&lt;Poco2&gt; children { get; set; }\n}\n\nclass Poco2\n{\n    public int id { get; set;}\n    public Poco1 parent { get; set; }\n}\n</code></pre>\n\n<p>In the main thread I'm loading Poco1:</p>\n\n<pre><code>var parentPoco = _context.Poco1s.Where(...).Single();\n</code></pre>\n\n<p>I then pass it to a task, where I create another object and change the parent a bit</p>\n\n<pre><code>var childPoco = new Poco2 { parent=parentPoco }; \nparentPoco.SomeProp = \"Tasked!\";\n</code></pre>\n\n<p>Then back in the main thread I add childPoco to the context:</p>\n\n<pre><code>_context.Poco2s.Add(childPoco);\n_context.SaveChanges();\n</code></pre>\n\n<p>I am not doing anything with the context in the secondary thread, but I am manipulating objects that are mapped to it.</p>\n\n<p>Can I do that?</p>\n"},{"tags":["entity-framework","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12732114,"title":"How to stop the EDMX generator from changing columns names","body":"<p>If a table has column names that are the same as the table name the EDMX Generator suffixes the column name with a \"1\". Ex: Changing Test to Test1 in the sample below.</p>\n\n<p>SQL Server Table definition:</p>\n\n<p>CREATE TABLE [dbo].[Test](\n    [Test] nchar NOT NULL,\n    [ColumnsTwo] nchar NULL,</p>\n\n<p>EF Model created:</p>\n\n<pre><code>     &lt;EntitySetMapping Name=\"Test\"&gt;\n        &lt;EntityTypeMapping TypeName=\"AdventureWorksModel.Test\"&gt;\n          &lt;MappingFragment StoreEntitySet=\"Test\"&gt;\n            &lt;ScalarProperty Name=\"ColumnsTwo\" ColumnName=\"ColumnsTwo\" /&gt;\n            &lt;ScalarProperty Name=\"Test1\" ColumnName=\"Test\" /&gt;\n          &lt;/MappingFragment&gt;\n        &lt;/EntityTypeMapping&gt;\n      &lt;/EntitySetMapping&gt;\n    &lt;/EntityContainerMapping&gt;\n</code></pre>\n\n<p>This causes  SqlQueries to throw the error \"The data reader is incompatible with the specified 'AdventureWorksModel.Test'. A member of the type, 'Test1', does not have a corresponding column in the data reader with the same name.\"</p>\n\n<p>Why does the DbContext generator modify the column name? The ObjectContext generator left them alone.</p>\n\n<p>How can we fix this? We have no control over the DB schema.</p>\n"},{"tags":["c#","asp.net","linq","entity-framework","lambda"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12838209,"title":"Get newest Post of each forum","body":"<p>So I am working on a self made forum (ASP.net MVC4) and I am currently displaying all the forums, in the controller I do this easy query:</p>\n\n<pre><code>return View(db.Forums.ToList());\n</code></pre>\n\n<p>But now I want to be able to also include the top post. (a Forum entity has a collection of Post, Post has a Date, I want to order by that and then do a take(1)).</p>\n\n<p>I try something like:</p>\n\n<pre><code>return View(db.Forums.Include(z=&gt;z.Posts.OrderBy(x=&gt;x.Date).Take(1)).ToList());\n</code></pre>\n\n<p>Then I get  the error:</p>\n\n<blockquote>\n  <p>The Include path expression must refer to a navigation property\n  defined on the type. Use dotted paths for reference navigation\n  properties and the Select operator for collection navigation\n  properties. Parameter name: path</p>\n</blockquote>\n\n<p>PS: here is the current view</p>\n\n<pre><code>@model IEnumerable&lt;MyProject.Data.Forum&gt;\n\n@{\n    ViewBag.Title = \"Forum Index\";\n}\n\n&lt;h2&gt;Forums&lt;/h2&gt;\n\n&lt;table class=\"Forum\"&gt;\n    &lt;tbody&gt;\n    &lt;tr&gt;Main forums&lt;/tr&gt;\n    @foreach (var item in Model)\n    {\n        &lt;tr class=\"ForumItem\"&gt;\n            &lt;td&gt;&lt;a href=\"Index?id=@item.Id\"&gt;X&lt;/a&gt;&lt;/td&gt;\n            &lt;td&gt;&lt;p&gt;&lt;a href=\"Index?id=@item.Id\"&gt;@item.Name&lt;/a&gt;&lt;/p&gt;&lt;span&gt;@item.Description&lt;/span&gt;&lt;/td&gt;\n            &lt;td&gt;@item.PostCount&lt;/td&gt;\n            @foreach(var post in item.Posts)\n            {\n                &lt;td&gt;@post.Title&lt;/td&gt;\n            }\n        &lt;/tr&gt;\n    }\n    &lt;/tbody&gt;\n&lt;/table&gt;\n</code></pre>\n\n<p>Anyone knows a solution for this? </p>\n"},{"tags":["linq","linq-to-sql","entity-framework","linq-to-entities"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":7175,"score":8,"question_id":5352545,"title":"What is difference between .edmx and .dbml file in linq?","body":"<p>What is difference between .edmx and .dbml file in linq?In VS 2008 which datasource is best choice where edmx or dbml?Any problem will arise using edmx file in VS 2008?Can i use edmx in VS-2008? </p>\n"},{"tags":["wpf","wcf","entity-framework","nhibernate","orm"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":171,"score":2,"question_id":12366299,"title":"WPF and WCF RIA Service+EF or alternatives","body":"<p>Is there any way to get full support for RIA Services+EF for WPF application. I've read previous threads but looks like solution's offered there lacks's essential functionalty like transparent CRUD and Validation API support.</p>\n\n<p>Or is there alternative solutions with other popular communication frameworks/ORM that supports that functionality (to summarize - transparent work with POCO classes in 3-tier enviromnent).</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":12838893,"title":"How to Call Oracle stored procedure by EF4.3 CodeFirst","body":"<p>MY Procedure IS That\nCREATE OR REPLACE PROCEDURE GETPersons\n(\nIN_ID NUMBER,\nOUT_CURSOR OUT SYS_REFCURSOR\n)\nIS\nBEGIN\nOPEN OUT_CURSOR FOR \nSELECT T.ID,T.NAME FROM Persons T WHERE T.ID = IN_ID;\nEND;</p>\n\n<p>I WANt TO CALL THIS PROCEDURE BY EF4.3 Code First!Must is Code First. Not Data Model or other\nSO I KNOW HOT TO  PROCEDURE  BY SQLSERVER , But MY DataBase IS Oracle</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12838699,"title":"Entity Framework: M:M with simple type in the right side","body":"<p><strong>Two tables:</strong></p>\n\n<pre><code>Agencies (AgencyId, name, ...)     PK: AgencyId \nFavoredAgencies (AgencyId, UserId) PK: AgencyId, UserId\n</code></pre>\n\n<p><strong>Class:</strong></p>\n\n<pre><code>public class Agency\n{\n   [Key]\n   public int AgencyId {get;set;}\n   public string Name {get;set;}\n   public virtual ISet&lt;string&gt; FavoredByUserIds {get;set;}\n}\n</code></pre>\n\n<p>I consider <code>FavoredAgencies</code> a <em>M:M</em> table even though the value on the right <code>(UserId)</code> does not point to another table/entity. <code>UserId</code> is the value I want.</p>\n\n<p>How to map this scenario using Code First and without creating a class <code>User</code> ?</p>\n"},{"tags":["sql-server","entity-framework","c#-4.0","model"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":12838383,"title":"EF 4.1 not respecting the SQL Server columns","body":"<p>I have just updated my MVC3 project (with C#) from <code>ObjectContext</code> to <code>DbContext</code>, but I'm getting some weird error...</p>\n\n<p>I'm using the database-first approach, and I have an table with a <code>Name</code> column of type <code>nvarchar</code>, that was not null. I changed it to accept <code>null</code> in SQL Server, then I updated my <code>edmx</code> model, deleted the <code>.tt</code> files and  generated it again (with ADO.NET <code>DbContext</code>).</p>\n\n<p>When I create a new object from that table, setting value to <code>Name</code> property to null I get an <code>DbEntityValidationException</code> with <code>The Name field is required</code> message in <code>db.SaveChanges()</code>. </p>\n\n<p>But the table is accepting NULL on Name column! I already inserted many rows with SQL in SQL Server with NULL in <code>Name</code> column!</p>\n\n<p>Anyone knows how can I solve that?</p>\n\n<p>Some information</p>\n\n<p>Here is my table SQL:</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [dbo].[Pre_Register](\n    [Id] [int] IDENTITY(1,1) NOT NULL,\n    [Name] [nvarchar](64) NULL,\n    [Email] [nvarchar](64) NOT NULL,\n    [Permission] [tinyint] NOT NULL,\n    [Password] [nvarchar](256) NOT NULL\nPRIMARY KEY CLUSTERED \n(\n    [Id] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>This is the automatic generated model class:</p>\n\n<pre><code>public partial class Pre_Register\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string Email { get; set; }\n    public byte Permission { get; set; }\n    public string Password { get; set; }\n}\n</code></pre>\n\n<p>And here is how I get the error:</p>\n\n<pre><code>Pre_Register preReg = new Pre_Register();\n\ndb.Pre_Register.Add(preReg);\n\npreReg.Email = \"dudu@mail.com\";\npreReg.Permission = 1;\npreReg.Password = \"123456\";\npreReg.Name = null;\n\n// here it comes\ndb.SaveChanges();\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12820850,"title":"Group And Count. Simplify Code","body":"<p>I am counting the number of users created per day as follows:</p>\n\n<pre><code>IEnumerable&lt;DateTime&gt; dates = GetAllDatesForPeriod();\n\nvar rows = context.Users\n  .Where(x =&gt; x.Created &gt;= minDate &amp;&amp; x.Created &lt;= max.Date)\n  .GroupBy(x =&gt; new { Year = x.Created.Year, Month = x.Created.Month, Day = x.Created.Day })\n  .Select(x =&gt; new { Year = x.Key.Year, Month = x.Key.Month, Day = x.Key.Day, Count = x.Count() }).ToList()\n  .Select(x =&gt; new DataModel { Date = new DateTime(x.Year, x.Month, x.Day), Users = x.Count }).ToList();\n\n  rows.AddRange(dates.Where(x =&gt; !rows.Any(y =&gt; y.Date == x)).Select(x =&gt; new DataModel { Date = x, Users = 0 }));\n</code></pre>\n\n<p>The second Select is because I am not able to create a DateTime in the Ef query.</p>\n\n<p>The AddRange is to fill the missing dates with a Count = 0.</p>\n\n<p>This code is working. But is there a way to simplify this?</p>\n\n<p>Thank You,\nMiguel</p>\n"},{"tags":["asp.net-mvc","entity-framework","webgrid"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":163,"score":0,"question_id":12815267,"title":"How to use webgrid ASP.net MVC 3.0?","body":"<p>I am new on ASP.net MVC 3.0, I want to display my data to WebGrid and I write this code in the View.</p>\n\n<pre><code>@model IEnumerable&lt;MvcApplication3.Models.MOVIE&gt;\n\n\n@{\n    ViewBag.Title = \"Index\";\n}\n\n&lt;h2&gt;Index&lt;/h2&gt;\n\n&lt;p&gt;\n    @Html.ActionLink(\"Create New\", \"Create\")\n    @ViewBag.abc;\n&lt;/p&gt;\n\n@Html.ActionLink(\"Asc Title\", \"Index\", new { sortOrder = \"asc\" })\n@Html.ActionLink(\"Desc Title\", \"Index\", new { sortOrder = \"desc\" })\n\n&lt;table&gt;\n    &lt;tr&gt;\n        &lt;th&gt;\n            TITLE\n        &lt;/th&gt;\n        &lt;th&gt;\n            PRICE\n        &lt;/th&gt;\n        &lt;th&gt;\n            RELEASEDATE\n        &lt;/th&gt;\n        &lt;th&gt;&lt;/th&gt;\n    &lt;/tr&gt;\n\n@foreach (var item in Model) {\n    &lt;tr&gt;\n        &lt;td&gt;            \n            @Html.DisplayFor(modelItem =&gt; item.TITLE)\n        &lt;/td&gt;\n        &lt;td align=\"right\"&gt;\n            @Html.DisplayFor(modelItem =&gt; item.PRICE)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelItem =&gt; item.RELEASEDATE)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.ActionLink(\"Edit Saya\", \"Edit\", new { id=item.ID }) |\n            @Html.ActionLink(\"Details\", \"Details\", new { id=item.ID }) |\n            @Html.ActionLink(\"Delete\", \"Delete\", new { id=item.ID }) |          \n            @Html.ActionLink(\"Select\", \"MoviedanArtis\", new { id = item.ID }) \n        &lt;/td&gt;\n    &lt;/tr&gt;\n}\n\n&lt;/table&gt;\n\n@{    \n    var grid = new WebGrid(Model.ToList(), rowsPerPage: 6);    \n}\n\n&lt;div id=\"grid\"&gt;\n    @grid.GetHtml(tableStyle: \"grid\", \n    headerStyle: \"head\",\n    alternatingRowStyle: \"alt\",\n    columns: grid.Columns(grid.Column(\"TITLE\"), grid.Column(\"PRICE\"), grid.Column(\"RELEASEDATE\")))\n&lt;/div&gt;\n</code></pre>\n\n<p>Here are the controller</p>\n\n<pre><code>private MovieEntities db = new MovieEntities();\n\n        //\n        // GET: /Coba/        \n        public ViewResult Index()\n        {           \n            return View(db.MOVIEs.ToList());\n        }\n</code></pre>\n\n<p>After that I always get error \"The result of a query cannot be enumerated more than once.\" What can I do to solve it?</p>\n"},{"tags":["entity-framework","ef-code-first","mysql-connector"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12836859,"title":"Mysql .net Connector 6.6.x DbMigration EF 4.3 cascade delete","body":"<p>I have code first models with the latest 6.6.x beta driver working.\nDbmigrations seem to be working fine as wel.</p>\n\n<p>However there seems to be a problem with cascade settings.\nMy models have cascade delete all over them, but the database that gets generated does not reflect these settings.</p>\n\n<p>On the mysql website in the change log there is something mentioned about cascade delete nog generated correctly in the sql create script , but i do not know if this is also for dbmigrations.</p>\n\n<p>Anyway it does not seem to work?\nAnyone that seen the same behaviour?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12834558,"title":"Entity Framework 5 Code Migrations","body":"<ol>\n<li><p>Where is stored information about current database state (what migration is applied)? I suppose it can be \"dbo.__MigrationHistory\" table or this table is just for logging purpose?</p></li>\n<li><p>If I enabled migration, added migration and updated my database. After that I checked-in code to SVN and another developer checked it out. What this another developer has to do to create/update his own database?</p></li>\n</ol>\n\n<p>I see such options:</p>\n\n<p>1) Call Update-Database command right away.</p>\n\n<p>2) Do everything from beginning (Enable-Migration, Add-Migration, Update-Database).</p>\n\n<p>3) Do everything but skip Add-Migration step (it is already present and it seems strange to add it once again for every new developer).</p>\n\n<p>Which of my assumption is right or if no one where is the right way?</p>\n"},{"tags":["c#","entity-framework","transactionscope","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":75,"score":0,"question_id":12836374,"title":"Using transactions with linq to entities","body":"<p>I am a EntityFramework newbie. I am facing a very weird issue. I am not being able to use transaction using a linq to entity query. I have used for DbTransaction as well as TransactionScope. The error occurs as soon as the query is hit. I am using EF 4.3. The context derives from DbContext as usual. I am using the Code First approach. </p>\n\n<pre><code>        using (TransactionScope s = new TransactionScope())\n        {\n         using(var context = new XYZContext())\n         {   \n               context.Database.Connection.Open();\n               Int32 count = (from xyz in context.XYZs\n                           where xyz.Name == \"SameName\"\n                           select xyz.Name).Count();\n               Assert.AreEqual(count, 1);\n          }\n        }\n</code></pre>\n\n<p>I have some doubts. I do not want to use the TrasactionScope because I have heard it has performance issues. So how can I use the DbTransaction instead(also throwing error for me)?\nWhy do I need to open the connection explicitly? When I am 'newing' up a context then should it not open the connection automatically for me?</p>\n"},{"tags":["asp.net","visual-studio-2008","linq","entity-framework","c#-3.0"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":893,"score":0,"question_id":2593262,"title":"Error: FormatException was unhandled by user code in Linq how to solve?","body":"<p><img src=\"http://i43.tinypic.com/5l8op0.jpg\" alt=\"alt text\"></p>\n\n<p>Look please below this codes throw me : FormatException was unhandled by user code</p>\n\n<p>Codes: </p>\n\n<pre><code> satis.KDV = Decimal.Parse((from o in genSatisctx.Urun where o.ID == UrunID select o.Kdv).ToString());</code></pre>\n\n<p>How can i rewrite linq query?</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12835793,"title":"Entity framework 4.3 DBMigrations code first, database dependency","body":"<p>I have a code first model with db migrations working fine on a mysql .net connector 6.6.x driver.</p>\n\n<p>But i was wondering if the migrations i am generating from the models are mysql specific or should i be able to migrate the same dbmigrations (including initial create script) to other databases as long as i have configured a driver and sqlgenerator for it ?</p>\n\n<p>I know it somehow does use the database schema you are developing againt to generate the dbmigration steps.\nAlthough its not clear to me why, cause it should be able to generate these totally based on the code first models.</p>\n"},{"tags":["wcf","entity-framework","entity-framework-4.1","n-tier","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":196,"score":0,"question_id":9721909,"title":"Building application with Entity framework dbContext API issues","body":"<p>I am developing a WCF Service application. It is going to be a part of large system. It provides some business logic and is based on Entity framework 4.1. I want to divide application code into 2 tiers (projects in VS, dll's): Service (which contains business logic) and DAL.</p>\n\n<p>I have such database model in my project</p>\n\n<pre><code>ClassModel\nclassID : int, PK\nclassIdentity : string\nteacherName : string\nstatisticInfo : int\nisRegistered : bool\n\n\nStudentModel\nstudentID : int, PK\nstudentIdentity : string\nclassID : int, FK\n</code></pre>\n\n<p>For this I am generating code using dbContext templates and I get:</p>\n\n<pre><code>public partial class ClassModel\n{\n    public ClassModel()\n    {\n        this.Student = new HashSet&lt;StudentModel&gt;();\n    }\n    public int ClassID { get; set; }\n    public string ClassIdentity { get; set; }\n    public string TeacherName  { get; set; }\n    public int StatisticInfo { get; set; }\n    public bool IsRegistered { get; set; }\n\n    public virtual ICollection&lt;TerminalModel&gt; Terminal { get; set; }\n}\n\npublic partial class StudentModel\n{\n    public int StudentID { get; set; }\n    public string StudentIdentity { get; set; }\n    public bool IsRegistered { get; set; }\n\n    public virtual ClassModel Class { get; set; }\n}\n</code></pre>\n\n<p>I want to expose only some of this information through the service, so I have different model as a data contract:</p>\n\n<pre><code>[DataContract]\npublic class Clas{\n    [DataMember]\n    public string ClassIdentity {get;set;}\n    [DataMember]\n    public string TeacherName {get;set;}\n    [DataMember]\n    public string ClassMark {get;set;} //computed from statisticInfo\n    [DataMember]\n    public int NumberOfStudents {get;set;} //amount of students in this class\n}\n</code></pre>\n\n<p>And my part of my ServiceContract:</p>\n\n<pre><code>[OperationContract]\npublic void RegsterClass(Clas clas); //(if given clas does not exists adds it and) sets its isRegistered column to True\n[OperationContract]\npublic Clas GetClass(string classIdentity);\n</code></pre>\n\n<p>As you can see some fields are not present, others are being computed.\nIn such case I have some concerns about how should I built application properly. Could you write example code which implements the interface methods using everything I mentioned in the way that you think is proper?</p>\n"},{"tags":["c#","wcf","entity-framework","n-tier","self-tracking-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":176,"score":2,"question_id":10509097,"title":"Does there exist a T4 Template for generating a WCF service to provide Get and Save for Self Tracking Entities?","body":"<p>I'm working with self tracking entities on a n-tier application.  So I have a WCF service which provides the client access to the data layer and I find myself implementing a lot of the \"same\" functions corresponding with Getting some entities from my model, for example <code>GetOrders</code>, and after changing them in the client, a <code>Save(Order order)</code> or <code>Save(TrackableCollection&lt;Orders&gt; orders)</code> operation to persist the changes.</p>\n\n<p>I'm wondering if there exists a T4 template that could build the basic interface, with Get/Save for single and collections of each entity and the corresponding service implementation from my model?</p>\n\n<p>I'm aware that I could write my own T4 Template to generate this service, and I will probably do just that if I have to, but first I thought I'd ask the community if this effort exists already somewhere on the internet, is planned, is desired by others and/or is a totally stupid idea.</p>\n\n<p>I did find this <a href=\"http://blogs.msdn.com/b/phaniraj/archive/2010/08/10/t4-templates-for-wcf-data-services-part-i.aspx\" rel=\"nofollow\">WCF Data Services Generator</a> example, which is kind of on the right track.</p>\n\n<p>Maybe something more suited to STEs using WCF in an n-tier solution is out there?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12835469,"title":"DbUpdateConcurrencyException not occuring","body":"<p>I am currently following this tutorial</p>\n\n<p><a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application\" rel=\"nofollow\">http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application</a></p>\n\n<p>However, I cannot seem to get the concurrency exception (DbUpdateConcurrencyException) to occur.</p>\n\n<p>I have created the a Timestamp field in the relevant table (called 'Group' in my project).</p>\n\n<p>My code is as follows</p>\n\n<p>in GroupController.cs</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Edit(Group group)\n{\n    try\n    {\n        if (ModelState.IsValid)\n        {\n\n            medEntitiesDB.Entry(group).State = EntityState.Modified;\n            medEntitiesDB.SaveChanges();\n            return RedirectToAction(\"Index\");\n\n        }\n\n\n    }\n\n    catch (DbUpdateConcurrencyException ex)\n    {\n        var entry = ex.Entries.Single();\n        var databaseValues = (Group)entry.GetDatabaseValues().ToObject();\n        var clientValues = (Group)entry.Entity;\n        if (databaseValues.GroupName != clientValues.GroupName)\n            ModelState.AddModelError(\"Name\", \"Current value: \"\n                + databaseValues.GroupName);\n        ModelState.AddModelError(string.Empty, \"The record you attempted to edit \"\n            + \"was modified by another user after you got the original value. The \"\n            + \"edit operation was canceled and the current values in the database \"\n            + \"have been displayed. If you still want to edit this record, click \"\n            + \"the Save button again. Otherwise click the Back to List hyperlink.\");\n        group.Timestamp = databaseValues.Timestamp;\n    }\n    catch (DataException)\n    {\n        //Log the error (add a variable name after Exception)\n        ModelState.AddModelError(string.Empty, \"Unable to save changes. \n          Try again, and if the problem persists contact your system administrator.\");\n    }\n\n    return View(group);\n}\n</code></pre>\n\n<p>My 'Group' class is as follows</p>\n\n<pre><code>namespace MyClasses\n{\nusing System;\nusing System.Collections.Generic;\n\nusing System.ComponentModel;\nusing System.ComponentModel.DataAnnotations;\nusing System.Web.Mvc;\n\n\n public partial class Group\n {\n\n    public System.Guid GroupID { get; set; }\n    public string GroupName { get; set; }\n    public System.DateTime DateCreated { get; set; }\n\n    [Timestamp]\n    public byte[] Timestamp { get; set; }\n }\n}\n</code></pre>\n\n<p>Does anyone know why this exception is not occuring?</p>\n"},{"tags":["c#",".net","oracle","entity-framework","stored-functions"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":167,"score":2,"question_id":12799124,"title":"Usage of stored functions in entity framework","body":"<p>I have an old <code>Oracle</code> DB which I'm trying to use within <code>EntityFramework 4.1</code> application.<br>\nI've read about the big limitation that oracle has with EF- you can't call Oracle stored <strong>Function</strong> with EF unless you create a wrapping <strong>Procedure</strong>.  </p>\n\n<p>I got thousands of stored functions in my DB, is there any other way to solve it?<br>\nLike using raw <code>Context.SqlQuery()</code>?  </p>\n\n<p>So far I couldn't find a solution for it...</p>\n\n<hr>\n\n<p><a href=\"http://www.oracle.com/technetwork/issue-archive/2011/11-sep/o51odt-453447.html\" rel=\"nofollow\">Oracle docs:</a></p>\n\n<blockquote>\n  <p>Oracle developers can leverage PL/SQL stored <strong>procedures</strong>, with limitations, within the entity framework via Entity Framework Function Imports (used to call the procedures explicitly) and stored procedure mappings (which are automatically called for entity Insert, Update, and Delete operations).  </p>\n  \n  <p><strong>Only Oracle stored procedures can be called by Entity Framework, not stored functions.</strong> (Oracle stored functions can be used if they are wrapped inside of a stored procedure that uses an OUT parameter for the stored function return value.)</p>\n</blockquote>\n"},{"tags":["asp.net-mvc","entity-framework","validation","asp.net-mvc-4","entity-framework-5"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":12832897,"title":"Validation of domain model: how and where","body":"<p>A typical EF+MVC system will have two or three levels of validation:  </p>\n\n<ol>\n<li>For ViewModel: input / physical validation (DataAnnotations, FluentValidation), in other words, length, null, range, regex, etc.  </li>\n<li>For Model: input / physical validation (repeat of 1 in case MVC is not used and data comes from another system, WCF, forms, etc.)  </li>\n<li>For Model: logical / \"business rules\" validation</li>\n</ol>\n\n<p>I can't find best practices for validation of 2+3 for the actual Model / entities / domain / \"business rules\". We either:</p>\n\n<ul>\n<li>put simple validation rules in an entity's property setter (but this is really messy)</li>\n<li>hook into EF's <code>SaveChanges()</code>, and if an entity is in the <code>Added</code> or <code>Modified</code> state then trigger validation (which validates the entire entity at once)</li>\n</ul>\n\n<p>This is hard to maintain. A lot of thought went into ViewModel validation, but for Model validation it is domain-specific and so it is for you to determine a creative solution, and mine is not that great.</p>\n\n<ul>\n<li>Are there better ways to do this, or helpful tools (like maybe DataAnnotations or FluentValidation but for domain entities)?</li>\n<li>Where is the best place to do model validation or to trigger the model's validation?</li>\n</ul>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":206,"score":3,"question_id":7638992,"title":"Entity Framework Code First associations/FK issues and assumptions/defaults","body":"<p>I am very confused by the way Entity Framework is able to pick up on relationships between entities. I have a few questions on this.</p>\n\n<p>In a simple test application, I have a table of people, and a table of notes, and a table of picture assets.</p>\n\n<ol>\n<li>There are many pictures, each is owned by a person (a person can own more than one). </li>\n<li>There are many notes, each is owned by a person (a person can own more than one). </li>\n<li>and finally a person has a logo which is a picture.</li>\n</ol>\n\n<p>.</p>\n\n<pre><code>    public class Person\n    {\n        public int ID { get; set; }\n\n        public string name { get; set; }\n\n        public Picture logo { get; set; }\n    }\n\n    public class Note\n    {\n\n        public int ID { get; set; }\n\n        public string Text { get; set; }\n\n        public Person Owner { get; set; }\n    }\n\n\n public class Picture\n    {\n\n        public int ID { get; set; }\n\n        public string Path { get; set; }\n\n        public Person Owner { get; set; }\n    }\n</code></pre>\n\n<p>When I try to run, I get the error \"Unable to determine the principal end of an association between the types ....\".</p>\n\n<p>(If I drop the Person.logo  field, compile/run, then manually add it in to SQL, along with the FK relationship, it works 100% as expected... I just can't seem to work out how to set this from EF itself).</p>\n\n<p>Can you help with the error? I have read quite a few answers here, but, I just can't seem to adapt it to fix my error.</p>\n\n<p>However, now I have a one to many and a many to one (I don't think this is classed as many to many?), I just don't understand how to create people objects, where a FK is non nullable and the FK doesn't exist yet.</p>\n\n<p>A solution I found, which I really don't like is to make the person.picture column nullable, then create a person, followed by creating a picture, then assign a picture to the person object... but, ideally I don't want it nullable. There should always be a picture.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":99,"score":-1,"question_id":12828739,"title":"Entity Framework set navigation property to null","body":"<p>I have a entity framework database first project. here is a extraction of the model:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public partial class LedProject\n{\n    public LedProject()\n    {\n        this.References = new HashSet&lt;LedProjectReference&gt;();\n        this.Results = new HashSet&lt;LedProjectResult&gt;();\n        this.History = new HashSet&lt;LedProjectHistory&gt;();\n    }\n\n    public string Identifier { get; set; }\n    public string Name { get; set; }\n    public Nullable&lt;System.DateTime&gt; CompletionDate { get; set; }\n    public System.DateTime CreationDate { get; set; }\n    public System.Guid ProjectId { get; set; }\n    public string Comment { get; set; }\n\n    public virtual User ContactUser { get; set; }\n    public virtual User CreationUser { get; set; }\n    public virtual Customer Customer { get; set; }\n    public virtual LedProjectAccounting Accounting { get; set; }\n    public virtual LedProjectState State { get; set; }\n    public virtual ICollection&lt;LedProjectReference&gt; References { get; set; }\n    public virtual ICollection&lt;LedProjectResult&gt; Results { get; set; }\n    public virtual User ResponsibleUser { get; set; }\n    public virtual ICollection&lt;LedProjectHistory&gt; History { get; set; }\n}\n</code></pre>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public partial class User\n{\n    public System.Guid UserId { get; set; }\n    public string LoginName { get; set; }\n    public System.DateTime CreationDate { get; set; }\n    public string Firstname { get; set; }\n    public string Lastname { get; set; }\n    public string Email { get; set; }\n}\n</code></pre>\n\n<p>I have a problem with setting the navigation item <strong>ResponsibleUser</strong> of the class <strong>LedProject</strong>. When I set the <strong>ResponsibleUser</strong> to a another user and afterwards save the changes of the DBContext, the changes are stored in the database.</p>\n\n<p>But, when I want to delete the current <strong>ResponsibleUser</strong> of an <strong>LedProject</strong>, by setting the navigation property to null. The changes are not stored in the database.</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>LedProject project = db.LedProject.Find(projectId);\nproject.Name = string.IsNullOrEmpty(name) ? null : name;\n...\nproject.ResponsibleUser = responsibleUser == null ? null : db.User.Find(responsibleUser.UserId);\n...\ndb.SaveChanges();\n</code></pre>\n\n<p>Is there any trick for deleting navigation properties?</p>\n"},{"tags":["entity-framework","odac"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12834290,"title":"Entity Framework with ODAC","body":"<p>I use EF with ODAC and it's Oracle.DataAccess and Oracle.Web.dll version numbers are 2.112.3.0, but on the server the version number is 2.112.1.0. My web application always is giving this error message:\nUnable to find the requested .Net Framework Data Provider.  It may not be installed. \nI think it is due to the difference of version numbers. I tried to copy these two dlls onto the server but it didn't solve the problem. How can I get through this problem? Must I reinstall some of the clients to fix this issue?\nThank you. </p>\n"},{"tags":["asp.net","entity-framework","combobox"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12834158,"title":"Adding a new item in database through combobox","body":"<p>I am having a database and I use it through Entity Framework, I need to update the data by editing the other items in text boxes and grid, that is working fine and below is the code:\nIn aspx.cs</p>\n\n<pre><code>protected void SaveBtn_Click(object sender, EventArgs e)\n    {\n        obj.Address = AppAddress.Text;\n        obj.City = AppCity.Text;\n        obj.Email = AppEmail.Text;\n        obj.Notes = AppComments.Text;\n        obj.Postal = AppPostal.Text;\n        obj.AppraiserAppraiserCompanyId = ApprCompCmbx.SelectedIndex;\n        obj.ProvinceState = Province.SelectedIndex;\n        apprblobj.GetUpdate(obj);\n        Response.Write(\"&lt;script&gt;alert('You have successfully updated the Data');&lt;/script&gt;\");\n}\n</code></pre>\n\n<p>call in the BL:</p>\n\n<pre><code> public void GetUpdate(Appraiser appObj)\n    {\n        obj.UpdateData(appObj);\n\n    }\n</code></pre>\n\n<p>and in the DAL</p>\n\n<pre><code> public void UpdateData(Appraiser apprObj)\n    {\n\n        try\n        {\n            var Appsave = context.Appraisers.FirstOrDefault(App =&gt; App.AppraiserId == apprObj.AppraiserId);\n            if (Appsave != null)\n            {\n                Appsave.AppraiserName = apprObj.AppraiserName;\n                Appsave.AppraiserAppraiserCompanyId = apprObj.AppraiserAppraiserCompanyId;\n                Appsave.Address = apprObj.Address;\n                Appsave.City = apprObj.City;\n                Appsave.ProvinceState = apprObj.ProvinceState;\n                Appsave.Email = apprObj.Email;\n                Appsave.Postal = apprObj.Postal;\n                Appsave.Notes = apprObj.Notes;\n\n                context.SaveChanges();\n            }\n        }\n        catch (Exception ex)\n        {\n\n             log.Debug(\"Appraiser : UpdateData: \" + ex.Message + \" Trace : \" + ex.StackTrace);\n        }\n    }\n</code></pre>\n\n<p>Now I wanto to add a new item through the same combobox and on the button click functionality as it is doing all the work like add, update and delete.\nKindly provide me the hint: This I know that addobject(<em>_</em>_) will ve used in place of savechanges etc.</p>\n"},{"tags":["entity-framework","resources","metadata","edmx"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":182,"score":2,"question_id":10803930,"title":"Entity framework metadata exception - No csdl, ssdl, msl in dll resources","body":"<p>I have DAL (model first entity framework 4.1) and Service  which is using it in separate projects. Everything was working fine, but after some minor changes (for example I generated model from database) it stoppedd working. I am now getting metadata exception.\nAfter many hours of research I downloaded ILSpy and checked that inside DAL.dll there are no resources.\nMy connection string looks like:</p>\n\n<pre><code>metadata=res://*/DataModel.TerminalRegistryModel.csdl|\n         res://*/DataModel.TerminalRegistryModel.ssdl|\n         res://*/DataModel.TerminalRegistryModel.msl;\n</code></pre>\n\n<p>ANd in EDMX file metadata artifact processing is set to Embed in Output Assembly.\nWhat can cause my problem?</p>\n"},{"tags":[".net","wpf","vb.net","entity-framework","binding"],"answer_count":11,"favorite_count":3,"up_vote_count":55,"down_vote_count":0,"view_count":40389,"score":55,"question_id":683863,"title":"\"Items collection must be empty before using ItemsSource.\"","body":"<p>I'm trying to get images to display in a WPF ListView styled like a WrapPanel as described in this old ATC Avalon Team article: <a href=\"http://blogs.msdn.com/atc%5Favalon%5Fteam/archive/2006/04/28/585844.aspx\">How to Create a Custom View</a>.</p>\n\n<p><img src=\"http://img257.imageshack.us/img257/8770/imageviewd.jpg\" alt=\"WPF ListView WrapPanel Images\" /></p>\n\n<p>When I try to populate the ListView with a LINQ-to-Entities queried collection of ADO.NET Entity Framework objects I get the following exception:</p>\n\n<p><strong>Exception</strong></p>\n\n<blockquote>\n  <p>Items collection must be empty before\n  using ItemsSource.</p>\n</blockquote>\n\n<p>My code&hellip;</p>\n\n<p><strong>Visual Basic</strong></p>\n\n<pre><code>Private Sub Window1_Loaded(...) Handles MyBase.Loaded\n    ListViewImages.ItemsSource = From g In db.Graphic _\n                                 Order By g.DateAdded Ascending _\n                                 Select g\nEnd Sub\n</code></pre>\n\n<p><strong>XAML</strong></p>\n\n<pre><code>&lt;ListView Name=\"ListViewImages\"\n          SelectionMode=\"Single\"\n          ItemsSource=\"{Binding}\"&gt;\n    &lt;local:ImageView /&gt;\n&lt;/ListView&gt;\n</code></pre>\n\n<p>I put a breakpoint on that line.  <code>ListViewImages.ItemsSource</code> is <code>Nothing</code> just before the LINQ assignment.</p>\n"},{"tags":["c#","asp.net-mvc","asp.net-mvc-3","entity-framework","razor"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":12828347,"title":"Ajax.ActionLink post entire model from a view?","body":"<p>I have a view that is strongly typed to a ViewModel.  Is it possible to pass all of the data from a model in the view, back to a controller action?  Something like this?  </p>\n\n<pre><code>@Ajax.ActionLink(\"(Export to Excel)\", \"ExportCsv\", \"SurveyResponse\", new {  \nResultsViewModel = Model }, new AjaxOptions {HttpMethod = \"POST\"})\n</code></pre>\n\n<p>And then collect the data from ResultsViewModel as a parameter in another controller</p>\n\n<pre><code>public ActionResult ExportCsv(ResultsViewModel resultsviewmodel)\n{\n\n}\n</code></pre>\n"},{"tags":["oracle","entity-framework","mapping","numbers","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":182,"score":2,"question_id":11446419,"title":"EntityFramework / WCF RIA Services / Oracle / Custom number mapping","body":"<p>this post is intended as (not optimal) solution for everyone that has to struggle with the same problem and there is only few to no answer in the net atm...\n(of cousrse this post will contain information from other sources)</p>\n\n<p>we had problems with custom data type mapping (number) in our project (VS2010/EntityFramework/WCF RIA Services/Oracle ODP.NET) which we were able to solve the following way:</p>\n\n<p>we had to use the following custom oracle number mapping information (because of legacy DB)</p>\n\n<pre><code>&lt;/connectionStrings&gt;\n  &lt;oracle.dataaccess.client&gt;\n    &lt;settings&gt;\n      &lt;add name=\"int16\" value=\"edmmapping number(4,0)\" /&gt;\n      &lt;add name=\"int32\" value=\"edmmapping number(9,0)\" /&gt;\n      &lt;add name=\"int64\" value=\"edmmapping number(17,0)\" /&gt;\n    &lt;/settings&gt;\n  &lt;/oracle.dataaccess.client&gt;\n</code></pre>\n\n<p>we put this information in App.Config within the project with the EDMX file(s)\nnow we were able to create our EDMX files with the custom mapping</p>\n\n<p>1) there was a problem that when you restart VS2010 it can happen that upon proeject compilation it wont compile because of an Error 2019, this error is of course related to our custom mapping and its a \"VS2010 bug???\" maybe but one solution is to open he VS2010 about window then close it then compile... but the better solution might or might not be to add the same information we added to the App.Config file to the devenv.exe.config file...</p>\n\n<p>now we can compile the EDMX project and \nthe My.Service.Web (.NET) project that uses the our EDM</p>\n\n<p>2) there is still another problem ... the WCF RIA Service My.Service (SL5) project\nhas no idea of the App.Config settings so when we try to compile it we will also get the\nError 2019...\nadding the mapping information to the Web.Config file did not help\nbut when we add it to the machine.config file we can finally compile...</p>\n\n<p>SUMMARY: add the mapping information to\nApp.Config (where your edmx file is)\nMachine.Config (C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Config)\nWeb.Config (in your web project, not sure if required since we added it to Machine.config)</p>\n\n<p>QUESTION: isn't there a better solution than to add it to Machine.Config?\n          I really hope someone has a better one because it will probably restict\n          development of other projects...</p>\n\n<p>hope this helps and hope for a better (re)solution</p>\n\n<p>thx and cheers</p>\n\n<p>versions:\nVS2010 SP1\nEntityFramework 4.1\nWCF RIA Services 1 SP2\nOracle 11g (ODAC/ODP.NET 11.2.0.3.0)</p>\n"},{"tags":["entity-framework","entity-framework-4","asp.net-mvc-4","edmx","edmx-designer"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12832745,"title":"asp.net mvc entity framework with multiple databases","body":"<p>I have an ASP.Net MVC project that uses EF.  I develop this application at work computer and at my home computer.  The following is in my Web.config.  How could I change the EDMX with the proper connection string for each office?  So far, I have to drop the EDMXs and re-add them and comment out other connection strings.  Thanks.</p>\n\n<pre><code>    &lt;connectionStrings&gt;\n    &lt;clear/&gt;\n    &lt;!-- At Home connections --&gt;\n    &lt;add name=\"App1Entities\" connectionString=\"metadata=res://*/Models.App1Model.csdl|res://*/Models.App1Model.ssdl|res://*/Models.App1Model.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=my-pc\\SqlExpress;initial catalog=App1Database;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n    &lt;add name=\"Service1Entities\" connectionString=\"metadata=res://*/Models.Service1Model.csdl|res://*/Models.Service1Model.ssdl|res://*/Models.Service1Model.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=my-pc\\SqlExpress;initial catalog=ServiceDatabase;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n\n    &lt;!-- At Work connections \n    &lt;add name=\"App1Entities\" connectionString=\"metadata=res://*/Models.App1Model.csdl|res://*/Models.App1Model.ssdl|res://*/Models.App1Model.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=sqlServer1;initial catalog=App1Database;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n    &lt;add name=\"Service1Entities\" connectionString=\"metadata=res://*/Models.Service1Model.csdl|res://*/Models.Service1Model.ssdl|res://*/Models.Service1Model.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=sqlServer2;initial catalog=ServiceDatabase;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n    --&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-5","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12831961,"title":"DbContext.Entry attaching Entity","body":"<p>From my research, I read that calling DbContext.Entry(someEntity) would automatically attached the entity to the context.</p>\n\n<p>However, when I do this I find that the entity's state is detached.</p>\n\n<p>Can anyone shed some light on this and how the DbContect.Entry works. I'm using EF 5.0</p>\n\n<p>Thanks.</p>\n"},{"tags":["linq","entity-framework","dbset"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12831122,"title":"Entity Framework dbset most efficient way of deleting","body":"<p>I have the following and looking for a more  efficient way of deleting vs looping through the records and then deleting each one at a time (note using Dbset):</p>\n\n<pre><code>     var wcd = dbContext.ProgramDetails.Where(p =&gt; p.Id == Id);\n\n     foreach (var wc in wcd.ToList())\n     {\n        dbContext.ProgramDetails.Remove(wc);\n     }\n\n     dbContext.SaveChanges();\n</code></pre>\n\n<p>Also say if we have 1 record that is as following:</p>\n\n<pre><code>    var pg = dbContext.Program.Where(p =&gt; p.Id == Id &amp;&amp; Name == FName);\n</code></pre>\n\n<p>What is the best way of deleting this one record? </p>\n\n<p>tried the following but gave an error: </p>\n\n<pre><code>    var pg = dbContext.Program.Where(p =&gt; p.Id == Id &amp;&amp; Name == FName);\n    dbContext.Program.Remove(wc);\n</code></pre>\n\n<p>Then I resorted to doing a foreach for deleting just one record as I have shown above that is not the most efficient for just 1 record.</p>\n"},{"tags":["c#","entity-framework","using"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12830689,"title":"Is there any difference in how or when the connection closes between the following 2 methods?","body":"<p>Below are 2 methods that are almost identical. I would like to know if there's any difference in how or when the context object will be disposed?</p>\n\n<pre><code>public List&lt;Template&gt; MethodVu()\n{\n  List&lt;Template&gt; templates;\n\n  using (var context = new Entities())\n  {\n    templates = context.Templates.ToList();\n  }\n\n  return templates;\n}\n\npublic List&lt;Template&gt; MethodDo()\n{\n  using (var context = new Entities())\n  {\n    return context.Templates.ToList();\n  }\n}\n</code></pre>\n"},{"tags":["asp.net","entity-framework"],"answer_count":2,"favorite_count":12,"up_vote_count":50,"down_vote_count":0,"view_count":8838,"score":50,"question_id":1589166,"title":"It has a DefiningQuery but no InsertFunction element... err","body":"<p>This thing is driving me crazy, and the error is quite meaningless to me:</p>\n\n<p><em>Unable to update the EntitySet 'TableB' because it has a DefiningQuery and no  element exists in the  element to support the current operation.</em></p>\n\n<p>My tables are put like this:</p>\n\n<pre>\nTableA\nint idA (identity, primary key)\n...\n\nTableB\nint idA (FK for TableA.idA)\nint val\n</pre>\n\n<p>TableB has no defined primary key in the SQL server. The Entity Framework has imported the table and the association and set both fields as key. But it will output that error when I try to do an insert into the table!</p>\n\n<p>What's wrong??</p>\n\n<p><hr /></p>\n\n<p><strong>Edit:</strong> \nAs suggested by Alex, the solution was this:</p>\n\n<ol>\n<li>Right click on the edmx file, select Open with, XML editor</li>\n<li>Locate the entity in the edmx:StorageModels element</li>\n<li>Remove the DefiningQuery entirely</li>\n<li>Rename the store:Schema=\"dbo\" to Schema=\"dbo\" (otherwise, the code will generate an error saying the name is invalid)</li>\n<li>Remove the store:Name property</li>\n</ol>\n\n<p>I left the key as it was, since it was OK to me that both the columns are part of the key.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12741109,"title":"Entity Framework code first Fluent mapping","body":"<p>I have two tables </p>\n\n<ul>\n<li>StoreOrderItem</li>\n<li>StoreOrder</li>\n</ul>\n\n<p>Now StoreOrder has many StoreOrderItems and StoreOrderItem has one StoreOrder (simple 1 to many relationship)</p>\n\n<pre><code>public class StoreOrderItemMap : EntityTypeConfiguration&lt;StoreOrderItem&gt;\n{\n        public StoreOrderItemMap()\n        {\n            this.ToTable(\"StoreOrderItem\");\n            this.HasKey(op =&gt; op.Id);\n            this.Property(op =&gt; op.StoreOrderId).HasColumnName(\"order_id\");\n            ...\n\n            this.HasRequired(so =&gt; so.StoreOrder)\n              .WithMany(soi =&gt; soi.StoreOrderItems)\n              .HasForeignKey(so =&gt; so.StoreOrderId);\n        }\n}\n\npublic class StoreOrderMap : EntityTypeConfiguration&lt;StoreOrder&gt;\n{\n    public StoreOrderMap()\n    {\n        this.ToTable(\"StoreOrder\");\n        this.HasKey(op =&gt; op.Id);\n        ....\n    }\n}\n\npublic class StoreOrderItem\n{\n    ....\n    public virtual int StoreOrderId { get; set; }\n    ....\n\n    public virtual StoreOrder StoreOrder { get; set; }\n}\n\npublic class StoreOrder\n{\n    .... \n    private ICollection&lt;StoreOrderItem&gt; _storeOrderItems;\n    ....\n\n    public virtual ICollection&lt;StoreOrderItem&gt; StoreOrderItems\n    {\n        get { return _storeOrderItems ?? (_storeOrderItems = new List&lt;StoreOrderItem&gt;()); }\n        set { _storeOrderItems = value; }\n    }\n\n}\n\n//The code which is used to add the configurations to the modelBuilder.\nprotected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n    System.Type configType = typeof(ContentMap);   //any of your configuration classes here\n    var typesToRegister = Assembly.GetAssembly(configType).GetTypes()\n        .Where(type =&gt; !String.IsNullOrEmpty(type.Namespace))\n        .Where(type =&gt; type.BaseType != null &amp;&amp; type.BaseType.IsGenericType &amp;&amp; type.BaseType.GetGenericTypeDefinition() == typeof(EntityTypeConfiguration&lt;&gt;));\n        foreach (var type in typesToRegister)\n        {\n            dynamic configurationInstance = Activator.CreateInstance(type);\n            modelBuilder.Configurations.Add(configurationInstance);\n        }\n        base.OnModelCreating(modelBuilder);\n}\n</code></pre>\n\n<p>Note I am running this code on an existing DB, how do I tell EF to not select \"StoreOrder_Id\" and to instead use the existing column \"order_id\"? </p>\n\n<p>Here is the error:</p>\n\n<p>Server Error in '/' Application.</p>\n\n<p>Invalid column name 'StoreOrder_Id'.</p>\n\n<blockquote>\n  <p>Description: An unhandled exception occurred during the execution of\n  the current web request. Please review the stack trace for more\n  information about the error and where it originated in the code. </p>\n  \n  <p>Exception Details: System.Data.SqlClient.SqlException: Invalid column\n  name 'StoreOrder_Id'.</p>\n</blockquote>\n"},{"tags":["c#","asp.net-mvc","asp.net-mvc-3","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12829537,"title":"Post Array of values from View back to controller","body":"<p>I am trying to pass all data from an array inside my view back to a controller.  I'm not sure how to do this using my ViewModel.  </p>\n\n<p>Model Class</p>\n\n<pre><code>public class ResultsViewModel\n{\n    public int?[] ProgramIds { get; set; }\n\n}\n</code></pre>\n\n<p>Form inside of the View</p>\n\n<pre><code>@using (Html.BeginForm(\"ExportCsv\", \"SurveyResponse\", FormMethod.Post))\n\n{\n\n   // Should I be looping through all values in the array here?\n    @Html.HiddenFor(x =&gt; x.ProgramIds)\n\n    &lt;input type=\"submit\" value=\"Submit\" /&gt;\n}\n</code></pre>\n\n<p>Controller I am posting to</p>\n\n<pre><code>        [HttpPost]\n        public ActionResult ExportCsv(ResultsViewModel ResultsViewModel)\n        {\n\n        }\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12828869,"title":"Why is my foreign key not being set?","body":"<p>I'm using Entity Framework, code first and I've got this code in my controller</p>\n\n<pre><code>_auctionContext.AddToAuctionEvents(new AuctionEvent\n    {\n        Title = model.Title,\n        Description = model.Description,\n        Starts = model.Starts,\n        Ends = model.Ends,\n        DepositAmount = model.DepositAmount,\n        Currency = _auctionContext.Currency.Where(c =&gt; c.Id == model.Currency).First()\n    });\n_auctionContext.SaveChanges();\n</code></pre>\n\n<p>I have a this in my view</p>\n\n<pre><code>&lt;section&gt;\n    @Html.LabelFor(model =&gt; model.Currencies)\n    &lt;div&gt;\n        @Html.DropDownList(\"Currency\", Model.Currencies, \"Select Currency\", new { required = \"required\" }) \n        @Html.ValidationMessageFor(model =&gt; model.Currencies)\n    &lt;/div&gt;\n&lt;/section&gt;\n</code></pre>\n\n<p>My viewmodel as referred to above looks like this</p>\n\n<pre><code>public class AuctionEventDetailsModel\n{\n    public AuctionEventDetailsModel()\n    {\n        Currencies = new List&lt;SelectListItem&gt;();\n    }\n\n    public string Title { get; set; }\n    public string Description { get; set; }\n    public DateTime Starts { get; set; }\n    public DateTime Ends { get; set; }\n    public decimal DepositAmount { get; set; }\n    public List&lt;SelectListItem&gt; Currencies { get; set; }\n    public int Currency { get; set; }\n}\n</code></pre>\n\n<p>For some reason when the code in the controller executes it always puts a null in the <code>Currency_Id</code> field in the <code>AuctionEvents</code> table in the database. Why is this?</p>\n"},{"tags":["c#",".net","multithreading","entity-framework","parallel-processing"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":12827599,"title":"Parallel doesnt work with Entity Framework","body":"<p>I have a list of IDs, and I need to run several stored procedures on each ID.</p>\n\n<p>When I am using a standard foreach loop, it works OK, but when I have many records, it works pretty slow.</p>\n\n<p>I wanted to convert the code to work with EF, but I am getting an exception: \"The underlying provider failed on Open\".</p>\n\n<p>I am using this code, inside the Parallel.ForEach:</p>\n\n<pre><code>using (XmlEntities osContext = new XmlEntities())\n{\n    //The code\n}\n</code></pre>\n\n<p>But it still throws the exception.</p>\n\n<p>Any idea how can I use Parallel with EF? do I need to create a new context for every procedure I am running? I have around 10 procedures, so I think its very bad to create 10 contexts, one for each.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":408,"score":0,"question_id":11284725,"title":"Missing template for Db context generator for Visual Studio 2010","body":"<p>I have Vs2010  ultimate. I installed asp.net mvc 4 and EF 5 that was part of it. </p>\n\n<p>There is no db context generator template for EF 5 for visual studio 2010. Only for  the RC of the next version. </p>\n\n<p>Short of installing vs 2012. What are my options?</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":132,"score":0,"question_id":12826673,"title":"Entity Framework - Reverse Engineer Code First - Overwriting Changes","body":"<p>Im using the EF Power Tools to <strong>Reverse Engineer</strong> an existing Database. This is fine. Under the EDMX Database-1st Route I would create partial classes for any overrides like Data Annotations, for e.g. here, <strong>LedgerPeriod</strong> being the original EntityObject:</p>\n\n<pre><code>[MetadataType(typeof(LedgerPeriodMetaData))]\npublic partial class LedgerPeriod\n{\n    public class LedgerPeriodMetaData\n    {\n\n        [Required(ErrorMessage = \"Period Start Date Required\")]\n        [DisplayFormat(ApplyFormatInEditMode = true, DataFormatString = \"{0:dd/MM/yyyy}\")]\n        [DataType(DataType.Date)]\n        public object PeriodDateFrom { get; set; }\n\n        [Required(ErrorMessage = \"Period End Date Required\")]\n        [DisplayFormat(ApplyFormatInEditMode = true, DataFormatString = \"{0:dd/MM/yyyy}\")]\n        [DataType(DataType.Date)]\n        public object PeriodDateTo { get; set; }\n\n    }\n}\n</code></pre>\n\n<p>This is fine. Now do I use the same approach for <strong>Code First Reverse Engineer</strong> or are there any custom settings whereby if you have to run the power tools multiple times, because say I added a new Table to the Database, it wouldn't overwrite any changes to the existing Models created previously.</p>\n\n<p>This would ultimately mean I can make changes to the actual model classes themselves, instead of creating partial classes.</p>\n\n<p>Reference to the EF Powertools can be found here:</p>\n\n<p><a href=\"http://blogs.msdn.com/b/adonet/archive/2012/04/09/ef-power-tools-beta-2-available.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/adonet/archive/2012/04/09/ef-power-tools-beta-2-available.aspx</a></p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","ado.net"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12825200,"title":"Validation with ViewModel","body":"<p>I have an asp.net mvc3 w/ ado.net entity framework doing some validation. </p>\n\n<p>I have created a viewmodel as such</p>\n\n<pre><code>public class id\n{\n\n\n    [Required]\n    public decimal l_ID\n    {\n        get;\n        set;\n    }\n\n    [Required]\n    public decimal v_ID\n    {\n        get;\n        set;\n    }\n}\n</code></pre>\n\n<p>Is it possible to add some set of validation rules so that the l_id must be larger than the v_id? validation should be done once the user has submitted the page. How would this be done? Any tutorials? Does this validation need to be done in the controller or using partial classes? Is there any examples out there</p>\n"},{"tags":["c#",".net","linq","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12825195,"title":"EF LINQ many to one filter/where","body":"<p>I'm getting an exception when the <code>GetProducts()</code> method is called below.  I'm essentially trying to filter down my list of Products by what is available in the specified Country.  There is a one to many relationship setup between a Product and a Country.</p>\n\n<pre><code>    public static List&lt;Product&gt; GetProducts(Country country)\n    {\n        Context db = new Context();\n        return db.Products.Where(m =&gt; m.Countries.Contains(country)).ToList&lt;Product&gt;();\n    }\n</code></pre>\n\n<blockquote>\n  <p>Unable to create a constant value of type\n  'DataModels.Country'. Only primitive types or\n  enumeration types are supported in this context.</p>\n</blockquote>\n\n<p>If I'm not going about this the right way, what is the best way to filter Products by the single selected Country?</p>\n"},{"tags":["c#","entity-framework","entity-framework-4","database-migration"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":617,"score":1,"question_id":11910962,"title":"Use the ColumnAttribute or the HasKey method to specify an order for composite primary keys","body":"<p>I'm trying to use composite primary key on 2 objects with parent-child relationship. Whenever I try to create a new migration, I get an error:</p>\n\n<p><strong>Unable to determine composite primary key ordering for type 'Models.UserProjectRole'. Use the ColumnAttribute or the HasKey method to specify an order for composite primary keys.</strong></p>\n\n<p>As per error suggests, I do add annotation <code>Column (Order = X)</code> but the error still there and does not go away, unless I leave only one field with Key annotation. \nHere  is my object that it trips off:</p>\n\n<pre><code>public class UserProjectRole\n{\n    [Key, Column(Order = 0),DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Guid UserProjectRoleID { get; set; }\n\n    [Key, Column (Order = 1)]\n    public Guid ProjectID { get; set; }\n\n    [ForeignKey(\"ProjectID\")]\n    public Project Project { get; set; }\n\n    public Guid AppUserGuid { get; set; }\n\n    // followed by a number of unrelated String fields.\n }\n</code></pre>\n\n<p>Here is Project class:</p>\n\n<pre><code>public class Project: Base\n{\n    [Key, DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Guid ProjectID { get; set; }\n\n    public virtual ICollection&lt;UserProjectRole&gt; UserRoles { get; set; }\n\n    // followed by a number of unrelated String fields.\n\n}\n</code></pre>\n\n<p>Here is part of my DBContext:</p>\n\n<pre><code>public class SiteContext : DbContext\n{\n\n    public DbSet&lt;Project&gt; Projects { get; set; }\n\n    public DbSet&lt;UserProjectRole&gt; UserProjectRoles { get; set; }\n}\n</code></pre>\n\n<p>I'm in VisualStudio 2012 with EF 4.3.1</p>\n\n<p>I have been banging my head against this for a while now and all the forum and SO answers suggest to add Column Order annotation that I already have.\n<strong>Am I missing something obvious???</strong></p>\n\n<p><em>Thank you for reading this far -)</em></p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","entity-framework-4","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":634,"score":4,"question_id":12205165,"title":"Exception when code first tried to create database","body":"<p>I've created a new ASP.NET MVC 4 application, and would like it to use code first. However it doesn't seem to initially create the database file if it doesn't exist already. If I delete the .mdf file from the App_Data folder, then I get the following exception when the app tries to access the database:</p>\n\n<pre><code>System.Data.SqlClient.SqlException: Cannot attach the file '&lt;path-to-db-file&gt;.mdf' as database '&lt;my-db-file-name&gt;'.\n</code></pre>\n\n<p>If I run it in the app in the debugger, then I can see that the exception is occurring in the InitializeSimpleMembershipAttribute::OnActionExecuting method when calling LazyInitializer.EnsureInitialized. The caught exception is:</p>\n\n<pre><code>[System.Reflection.TargetInvocationException]   {\"Exception has been thrown by the target of an invocation.\"}   System.Reflection.TargetInvocationException\n</code></pre>\n\n<p>With an inner exception of:</p>\n\n<pre><code>[System.InvalidOperationException]  {\"The ASP.NET Simple Membership database could not be initialized. For more information, please see http://go.microsoft.com/fwlink/?LinkId=256588\"} System.InvalidOperationException\n</code></pre>\n\n<p>Which then has the first exception I mentioned above as the inner exception of that.</p>\n\n<p>Any ideas what I'm doing wrong?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I've just tried it with a brand new MVC4 app. I can replicate it by doing the following:</p>\n\n<ol>\n<li>Create the MVC app in the VS wizard.</li>\n<li>Run the app for the first time and go to the login page (note the mdf file now gets generated).</li>\n<li>Delete the mdf file, and go back to the login page. The exception is now thrown.</li>\n</ol>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12821265,"title":"Entity Framework Code Generation not running on save","body":"<p>I have an EF5 Database First data context. At some point the designer has stopped generating the data context and entity classes when a change is made and the designer is saved.</p>\n\n<p>I am using the dbcontext T4 templates and haven't changed anything else (Although I'm sure something must have been changed by accident).</p>\n\n<p>Any suggestions about how I get the automatic code generation?</p>\n"},{"tags":["c#","entity-framework","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":999,"score":0,"question_id":1218592,"title":"ADO.NET Entity Association Error","body":"<p>i got Two Table named Personnel and Department..</p>\n\n<pre><code>**Personnel Table ;**\nPERSONNELID int , PK not null\nNAME varchar\nSURNAME varchar\nDepartmentID integer \n\nDepartment Table ;\nDepartmentID  int , PK not null\nDEPARTMENTNAME varchar\n\n(ONE TO MANY Relation)\n</code></pre>\n\n<p><strong>i wanna association between this tables. but i cant do it. with EDMX Model Designer .. gettin errors ;</strong></p>\n\n<p>Association END KEY property PERSONNELID is not mapped.\nAssociation END KEY property NAME is not mapped. blabla ....</p>\n\n<p>too new at this framework ,  Is there any easy way of do this job in the Entity Framework , ?</p>\n\n<p>i am using Firebird 2.1 DB . and Firebird.Client.Data 2.5.0.0. for provider.</p>\n"},{"tags":["entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12824122,"title":"LINQ to Entities does not recognize the method 'System.String ToString()' method, and this method cannot be translated into a store expression","body":"<p>I'm using the following code :</p>\n\n<pre><code>using(var sd=new dataEntities())\n{\nvar listofdata=sd.users.where(d=&gt;d.id.ToString().Contain(\"2\"));// id as int\n// error : LINQ to Entities does not recognize the method 'System.String ToString()' method, and this method cannot be translated into a store expression.\n}\n</code></pre>\n\n<p>I looked at the site but did not find answer</p>\n"},{"tags":["c#","linq","entity-framework","lambda","linq-to-entities"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":109,"score":1,"question_id":12822446,"title":"Breaking LINQ to Entities into multiple parts","body":"<p>I had the following code</p>\n\n<pre><code>query = query.Where(device =&gt; GetDeviceDistanceFromGeocode(geocode, device) &lt;= distanceMetres);\n\nprivate static double GetDeviceDistanceFromGeocode(Geocode geocode, Device device)\n{\n    return Math.Pow(\n        Math.Pow(device.Address.Geocode.Easting - geocode.Easting, 2) +\n        Math.Pow(device.Address.Geocode.Northing - geocode.Northing, 2)\n        , 0.5);\n}\n</code></pre>\n\n<p>However it throws an exception because linq cannot recognise my function forcing me into doing the whole query expression in one go.</p>\n\n<pre><code>Exception[LINQ to Entities does not recognize the method \n'Double DistanceOfDeviceFromGeocode(Geocode, Device)' method, \nand this method cannot be translated into a store expression.] \n</code></pre>\n\n<p>Is it possible to break a query expression out into multiple parts like i'm trying to do here?  It's not very readable when the query is so big.</p>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>Here's the full query as asked for in the comments.</p>\n\n<pre><code>return query.Where(device =&gt; \n            Math.Pow(\n                Math.Pow(device.Address.Geocode.Easting - geocode.Easting, 2) + \n                Math.Pow(device.Address.Geocode.Northing - geocode.Northing, 2)\n                , 0.5) \n                &lt;= distanceMetres);\n</code></pre>\n\n<p>Basically I don't think this is very readable so would like to break it down into multiple parts but from the links supplied it doesn't seem possible.</p>\n\n<p>In c++ I could have broken some of it out into a macro but unfortunately this isn't a feature of c#.</p>\n\n<hr>\n\n<p>Following suggestions I've updated the code to this which works quite nicely and improves the readability of the code a lot!</p>\n\n<pre><code>    return query.Where( DevicesWithinDistanceFromGeocode(distanceMetres, geocode) );\n}\n\npublic Expression&lt;Func&lt;Device, bool&gt;&gt; DevicesWithinDistanceFromGeocode(double distance, Geocode geocode)\n{\n    return device =&gt; (  SqlFunctions.SquareRoot(\n                            SqlFunctions.Square((double)(device.Address.Geocode.Easting - geocode.Easting)) +\n                            SqlFunctions.Square((double)(device.Address.Geocode.Northing - geocode.Northing))\n                        ) &lt;= distance );\n}\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12822775,"title":"Choose other user than current user in windows authentication Entity Framework","body":"<p>When I'm trying to create the entity model in Visual Studio 2010, I want to connect to a database that my current windows user can't access, how can I specify different login/password to access the database ?</p>\n"},{"tags":["entity-framework","entity-framework-4","ef-database-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12798502,"title":"Entity Framework - Entity read-only property mapped to a column of related table","body":"<p>I have interesting problem to solve but, although common, it looks like it's not easily achievable with Entity Framework. There are two tables:</p>\n\n<pre><code>Player(Id,TeamId,FirstName,LastName)\nTeam(Id, Name, IsProfessional)\n</code></pre>\n\n<p>Player can belong only to one team. Using TPT (DB first), we have two classes mapped to those tables:</p>\n\n<pre><code>public class Player\n{\n   public int Id{get;set;}\n   public int TeamId{get;set;}\n   public string FirstName{get; set;}\n   public string LastName{get; set;}\n   public Team Team{get;set;}\n}\n\npublic class Team\n{ \n   public int Id{get; set;}\n   public string Name{get;set;}\n   public bool IsProfessional{get;set;}\n   public IEnumerable&lt;Player&gt; Players{get;}\n}\n</code></pre>\n\n<p>What I would like to achieve is property IsProfessional on Player entity:</p>\n\n<pre><code>public class Player\n    {\n       public int Id{get;set;}\n       public int TeamId{get;set;}\n       public string FirstName{get; set;}\n       public string LastName{get; set;}\n       public Team Team{get;set;}\n       **public bool IsProfessional{get;}** should be read-only\n    }\n</code></pre>\n\n<p>Is it possible to configure mapping that way IsProfessional property can be used in linq queries?</p>\n\n<pre><code>var result= db.Players.Where(p=&gt;p.IsProfessional==true);\n</code></pre>\n\n<p>and to have that field populated every time Player entity is materialized?</p>\n\n<pre><code>Player pl = db.Players.Where(p=&gt;p.FirstName=\"Lionel\").FirstOrDefault();\nif(pl.IsProfessional)\n{\n//do something...\n}\n</code></pre>\n\n<p>Already tried with:</p>\n\n<ul>\n<li><strong>Entity Splitting</strong>. Not possible because I want to keep Team mapping and because relationship is not 1:1)</li>\n<li><strong>Mapping Player entity to a db view</strong>. Didn't like it because there are other relationships Player entity has that I need. I know it is possible to create them manually, but updating edmx from database will reset ssdl.</li>\n</ul>\n\n<p>Thanks</p>\n\n<p><strong>Solution</strong></p>\n\n<p>Based on second option in Gert Arnold answer, solution that fits my needs is as follows:</p>\n\n<ol>\n<li><p>I create function GetIsProfessional (had to do it because computed fields normally can be made only from own table fiels)</p>\n\n<p>CREATE FUNCTION [dbo].[GetIsProfessional](@teamId as INT)\nRETURNS bit</p>\n\n<p>BEGIN</p>\n\n<p>DECLARE @isProfi AS bit</p>\n\n<p>SELECT @isProfi = IsProfessional\nFROM Teams\nWHERE Id = @teamId</p>\n\n<p>RETURN @isProfi</p>\n\n<p>END</p></li>\n<li><p>I created computed field on Player table</p>\n\n<p>ALTER TABLE Players ADD [IsProfessional] AS dbo.GetIsProfessional(TeamId)</p></li>\n<li><p>As I'm using db first approach, I just update model from database and that's it, I can query on that field and it's pre populated when Player object is materialized.</p></li>\n</ol>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12815787,"title":"EF Code First and Saving Multiple Records","body":"<p>Just getting to grips with Entity Framework and I can save, add, delete etc a single entity like so:</p>\n\n<pre><code>db.Entry(client).State = EntityState.Modified;\ndb.SaveChanges();\n</code></pre>\n\n<p>My question is if I wanted to change several records how should I do this, for example I want to select all Jobs with a Type of 'new' and set the Type to 'complete'.  I can select all the jobs easily enough with Linq but do I have to loop through, change them, set the state to modified, save changes, next one etc?  I'm sure there is a straightforward way that I just don't know about or managed to find yet.</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":12632240,"title":"EntityFramework update or insert Chinese or non-English text","body":"<p>Actually before i did not use framework or linq, just type in sql statement with Sqlcommand class, i type in <code>insert into table values(N'sample')</code>\nactually i donot know what is N, but it works for Chinese and other Language, otherwise, it will insert some question mark.</p>\n\n<p>But when i use EntityFramework,this kind of framework always insert some question mark, can i ask how to tackle the issue.</p>\n\n<p>N means Unicode?\nCan you give me one example that EntityFramework use that sort of thing?</p>\n"},{"tags":["c#",".net","performance","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12821377,"title":"Can EF5 works fine in event based processing","body":"<p>I have this code for example for an event handler </p>\n\n<pre><code>public void ONDataArrived ( string data ) \n{\n//do some processing and save it to DB using EF \nctx.Add ( x ) ; \nctx.SaveChanges ()  ; \n\n}\n</code></pre>\n\n<p>Is there any chance that EF may error if this event fired a couple of times in the same time ? </p>\n\n<p>thanks </p>\n"},{"tags":[".net","entity-framework","connection-string"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":2742897,"title":"access EF classes from a Class Library - exactly how do configure/test the connection string in the client? (getting errors)","body":"<p>I'm getting very confused about how to call my EF classes in a Class Library from the Client Project I have?  Things worked fine when they were in the same project.  Now I'm getting errors such as \"Unable to load the specified metadata resource \". </p>\n\n<p>I've see various ideas / suggestions re how to fix the connection string (e.g. create an App.config in your client project &amp; copy the connection string config from your class library,  something about change the connection settings to copy to output, etc)</p>\n\n<p>QUESTION - Can someone provide a solid way on how to get EF class access from a separate project working?  (i.e. how to get the correct connection information to the client somehow)</p>\n\n<p>thanks</p>\n"},{"tags":["c#","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12821083,"title":"Using Entity Framework to access a remote database","body":"<p>I need to be able to use EF to access a database on a remote server.  I have the connection string to remote database in app.config.</p>\n\n<p>When I try this:</p>\n\n<pre><code>using (var ctx = new PinnReportEntities(\"name=remoteConnection\"))\n{\n    .\n    .\n    .\n}\n</code></pre>\n\n<p>I get this:</p>\n\n<pre><code>The specified named connection is either not found in the configuration, not intended to be used with the EntityClient provider, or not valid.\n</code></pre>\n\n<p>The named connection is in the configuration and is valid, so the issue must be with the EntityClient provider.  </p>\n\n<p>Is what I want to do even possible and is this the correct way to do it?</p>\n"},{"tags":["c#","linq","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":85,"score":6,"question_id":12232708,"title":"What's the most efficient way to get only the final row of a SQL table using EF4?","body":"<p>I'm looking to retrieve the last row of a table by the table's ID column. What I am currently using works:</p>\n\n<pre><code>var x = db.MyTable.OrderByDescending(d =&gt; d.ID).FirstOrDefault();\n</code></pre>\n\n<p>Is there any way to get the same result with more efficient speed?</p>\n"},{"tags":["c#","asp.net","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12818194,"title":"Move generated classes after Reverse engineer code first used in Entity Framework Power tools beta 2","body":"<p>I am using <code>Entity Framework 5.0</code> with <code>Entity Framework Powertools beta 2</code>. We have a database that we are not allowed to change and so are using the Reverse Engineer Code First option to create the classes. The generated classes are placed in the Models folder below the mappings.</p>\n\n<p>Is there a safe/best way to move these generated classes into their own project, leaving the <code>DbContext-type</code> class and the Mapping file classes in the Models folder?</p>\n"},{"tags":["c#","entity-framework","entity","ef-code-first","modelmetadata"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2938,"score":2,"question_id":6106842,"title":"Entity Framework - Get Table name from the Entity","body":"<p>I'm using the Entity Framework 4.1 with Code First approach. I'm able to get the storage model types and column names of my entities:</p>\n\n<pre><code>var items = context.ObjectContext.MetadataWorkspace.GetItems&lt;EntityType&gt;(DataSpace.SSpace);\n\nforeach (var i in items)\n{\n    Console.WriteLine(\"Table Name: {0}\", i.Name);\n\n    Console.WriteLine(\"Keys:\");\n    foreach (var key in i.KeyMembers)\n        Console.WriteLine(\"\\t{0} ({1})\", key.Name, key.TypeUsage.EdmType.FullName);\n\n    Console.WriteLine(\"Members:\");\n    foreach (var member in i.Members)\n        Console.WriteLine(\"\\t{0} ({1})\", member.Name, member.TypeUsage.EdmType.FullName);\n}\n</code></pre>\n\n<p>What I need is to get the real table name the entity is mapped to. There are different ways to specify that (by using Fluent-API .ToTable(), DataAnnotation [TableAttribute]).</p>\n\n<p>Is there any common way to achieve this information?</p>\n"},{"tags":["mysql","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":58,"score":0,"question_id":12820692,"title":"Is it possible to use Entity Framework code first with MySQL","body":"<p>I would like to set up a quick console app that will create a database / tables from a code first definition with  EF . Is there any one that could help me with this or any project/doc I can have a look at ?</p>\n\n<p>Thx</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":2723,"score":4,"question_id":1256786,"title":"Entity Framework Generated SQL","body":"<p>Is it possible to output the SQL generated by the Entity Framework on a global level and not on a query by query basis?  I'm looking to just dump it all somewhere so I can review it.</p>\n\n<p>If that is not possible, how do I view the SQL being generated for updates and inserts?</p>\n"},{"tags":["asp.net-mvc","entity-framework","entity-framework-4","entity-framework-4.1","entity-relationship"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12720611,"title":"Cant Add controller which uses Class which is inherited from other class","body":"<p>I'm using Entity Framework and MVC3, and my problem is that I can't scaffold Controllers if the class inherits from another Class.</p>\n\n<p>Example:</p>\n\n<p>This is Base Class</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\n\n    namespace CRMEntities\n    {\n        public partial class Company\n        {\n            public int Id { get; set; }\n        }\n\n    }\n</code></pre>\n\n<p>This is Lead Class (Child)</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\n\nnamespace CRMEntities\n{\n    public partial class Lead : Company\n    {\n        public Lead()\n        {\n            this.Status = 1;\n            this.IsQualified = false;\n\n        }\n\n        public Nullable&lt;short&gt; Status { get; set; }\n        public Nullable&lt;bool&gt; IsQualified { get; set; }\n\n\n    }\n\n\n}\n</code></pre>\n\n<p>When I tried to add controller below error comes...</p>\n\n<p><img src=\"http://i.stack.imgur.com/o1uua.jpg\" alt=\"enter image description here\"></p>\n\n<p>Context Class COde</p>\n\n<pre><code>using System;\nusing System.Data.Entity;\nusing System.Data.Entity.Infrastructure;\n\nnamespace CRMEntities\n{\n    public partial class CRMWebContainer : DbContext\n    {\n        public CRMWebContainer()\n            : base(\"name=CRMWebContainer\")\n        {\n        }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            throw new UnintentionalCodeFirstException();\n        }\n\n        public DbSet&lt;Employee&gt; Employees { get; set; }\n        public DbSet&lt;Contact&gt; Contacts { get; set; }\n        public DbSet&lt;Product&gt; Products { get; set; }\n        public DbSet&lt;Location&gt; Locations { get; set; }\n        public DbSet&lt;Task&gt; Tasks { get; set; }\n        public DbSet&lt;EventInfo&gt; EventInfoes { get; set; }\n        public DbSet&lt;Opportunity&gt; Opportunities { get; set; }\n        public DbSet&lt;Comment&gt; Comments { get; set; }\n        public DbSet&lt;Document&gt; Documents { get; set; }\n        public DbSet&lt;LoginInformation&gt; LoginInformations { get; set; }\n        public DbSet&lt;CRMLog&gt; CRMLogs { get; set; }\n        public DbSet&lt;EntitySharing&gt; EntitySharings { get; set; }\n        public DbSet&lt;EntityFlagging&gt; EntityFlaggings { get; set; }\n        public DbSet&lt;EntityTagging&gt; EntityTaggings { get; set; }\n        public DbSet&lt;EntitySubscribing&gt; EntitySubscribings { get; set; }\n        public DbSet&lt;Compapny&gt; Compapnies { get; set; }\n    }\n}\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12815445,"title":"Optimistic concurrency updates using Entity Framework","body":"<p>I have a repository using EF 4.1 and <code>DbContext</code> when updating an object I receive this error</p>\n\n<blockquote>\n  <p><em>Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or\n  deleted since entities were loaded. Refresh ObjectStateManager\n  entries.</em></p>\n</blockquote>\n\n<p>I suppose is connected with optimistic concurrency updates.. Any idea how to solve it?</p>\n\n<pre><code>  public void UpdateAddingCandidate(Event eventObj, int candidateId)\n    {\n        Candidate newCandidate = db.Candidates.AsNoTracking().FirstOrDefault(x =&gt; x.CandidateId == candidateId);\n        eventObj.Candidate = newCandidate;\n        eventObj.CandidateId = newCandidate.CandidateId;\n        db.Entry(eventObj).State = EntityState.Modified;\n    }\n</code></pre>\n"},{"tags":["entity-framework","dynamicquery"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":594,"score":0,"question_id":2822111,"title":"Dynamic Linq Library Guid exceptions","body":"<p>I am having a problem with the Dynamic Linq Library. I get a the following error \"ParserException was unhandled by user code ')\" or ','\". I have a Dicitionary and I want to create a query based on this dictionary. So I loop through my dictionary and append to a string builder \"PersonId = (GUID FROM DICTIONARY). I think the problem is were I append to PersonId for some reason I can't seem to convert my string guid to a Guid so the dynamic library don't crash. </p>\n\n<p>I have tried this to convert my string guid to a guid, but no luck.</p>\n\n<pre><code>query.Append(\"(PersonId = Guid(\" + person.Key + \")\");\n\nquery.Append(\"(PersonId = \" + person.Key + \")\");\n</code></pre>\n\n<p>I am using VS 2010 RTM and RIA Services as well as the Entity Framework 4. </p>\n\n<pre><code>//This is the loop I use\nforeach (KeyValuePair&lt;Guid, PersonDetails&gt; person in personsDetails)\n{\n    if ((person.Value as PersonDetails).IsExchangeChecked)\n    {\n        query.Append(\"(PersonId = Guid.Parse(\" + person.Key + \")\");\n    }\n}\n\n//Domain service call\n var query = this.ObjectContext.Persons.Where(DynamicExpression.ParseLambda&lt;Person, bool&gt;(persons));\n</code></pre>\n\n<p>Please help, and if you know of a better way of doing this I am open to suggestions.</p>\n"},{"tags":["entity-framework","wcf-ria-services","silverlight-5.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12819518,"title":"Getting \"Unable to find metadata for...\" after VS 2012 upgrade","body":"<p>We are having a ASP .Net project containing two EF datamodel. Domain data services a defined on top of the EF entities.\nThe Web project is bound to a RIAServices library. \nEverything is working fine in VS 2010, but after upgrading to VS2012, I'm getting this error when  building the RIAServices library:\n\"Unable to find metadata for....\"</p>\n\n<p>I checked the web assembly with Reflector and the metadata resources( the csdl, msl and ssdl file) are not included as resources in the assembly.</p>\n\n<p>BUT if I rebuild (cleaning and building) the web project, the metadata resources are included??</p>\n\n<p>Make a simple correction to the web project code and hitting F5 (only building not rebuilding), make the metadata resources disappear again.</p>\n\n<p>I've be reading a lot of blogposts suggesting that this problem is related to the entity connection string, but this is hardly the case here as the error is sporadic depending on whether you build or rebuild. </p>\n\n<p>To me it seems like a Visual Studio 2012 bug...or RIA Services 1.0 SP2 which was installed together with VS2012.</p>\n\n<p>Any clues?</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":1,"favorite_count":13,"up_vote_count":33,"down_vote_count":0,"view_count":14497,"score":33,"question_id":5340990,"title":"ADO.NET DbContext Generator vs. ADO.NET Poco Entity Generator (ObjectContext)","body":"<p>I am about to start implementing the data access infrastructure of a project that was architected with an approach to DDD (<em>it's my first attempt on DDD, so be gentle ;-)</em> ). </p>\n\n<p>I will be using Entity Framework. Until now, I was looking into the method teached by Julie Lerman on her great book, <a href=\"http://rads.stackoverflow.com/amzn/click/0596807260\" rel=\"nofollow\">Programming Entity Framework</a>, where <strong><em>ADO.NET POCO Entity Generator</em></strong> is used, with some changes to the T4 templates and some more custom code.<br>\nToday I started reading articles on EF4.1 and the <strong><em>ADO.NET DbContext Generator</em></strong>, using <strong><em>Database First</em></strong> approach, and I'm trying to decide with which one should I go.</p>\n\n<p>DbContext and EF4.1's approach on DDD seems to be a nice, cleaner way than POCO Entities, but I'm afraid that it could lead to some issues in the near future, since EF4.1 is still in RC.</p>\n\n<p>From <a href=\"http://blogs.msdn.com/b/adonet/archive/2011/03/15/ef-4-1-release-candidate-available.aspx\" rel=\"nofollow\">ADO.NET team blog</a>, I know that EF4.1 <strong>does not</strong> include:</p>\n\n<ul>\n<li>Enum support</li>\n<li>Spatial data type support</li>\n<li>Stored Procedure support in Code First</li>\n<li>Migration support in Code First</li>\n<li>Customizable conventions in Code First</li>\n</ul>\n\n<p>From my understanding, since I will be using <strong><em>Database First</em></strong> there is a smaller number of features that were not included.</p>\n\n<p>In conclusion, my question is:<br>\n<strong>Can I replace <em>POCO Entities Generator</em> with EF4.1 DbContext Generator?</strong></p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":21,"score":0,"question_id":12779322,"title":"How to map dynamically multiple tables to a entity","body":"<p>All,\nI have a requirement to write a component which retrieves the data and saves the data to the model. So i want to use entity framework. I can create the entities from model but In my model there is a table which contains the table names where the configuration for particular object exists.\nfor eg-\nMy table has data like this-\nType       DefitionTableName\nStudent     StudentDefTable\nCustomer     CustomerDefTable</p>\n\n<p>Here both StudentDefTable and CustomerDefTable have same structure.There can be may definition tables for different types. This data varies for differtn customer DBs.</p>\n\n<p>So how to map these different tables having same structure to same entity in EF? and how to link the changes back to proper table?\nIf EF does not support this any suggestion on other availble ORMs?</p>\n\n<p>[Edit:] Entity Framework will not support my requirement mentioned above. Now exploring NHiberant...If anyone can give that info it will be helpful.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12786236,"title":"Returning an object from a subroutine","body":"<p>I have a routine that returns mostly correct data. I pass it a string Id code, it creates a model, gets data from a database, fills in the model, and then passes the model back. The return model looks correct and has correct data except the List's in the model do not contain any data.</p>\n\n<p>The model looks similar to this one</p>\n\n<pre><code>             public class SubjectDB\n             {\n                public string SubjectId  { get; set; }\n                .\n                .\n                List&lt;AddressDB&gt; Address { get; set; }\n                .\n                .\n                [Key]\n                public int Id { get; set; }\n             }\n             public class DBEntities: DbContent\n             {\n                public DbSet&lt;SubjectDB&gt; SubjectDB { get; set; }\n                public DbSet&lt;AddressDB&gt; AddressDB { get; set; }\n                .\n                .\n             }\n</code></pre>\n\n<p>The subroutine is called using this code</p>\n\n<pre><code>             SubjectDB xsubject = new SubjectDB();\n             xsubject = (SubjectDB)GetNewSubject(model.Subject.Id);\n</code></pre>\n\n<p>The subroutine is</p>\n\n<pre><code>             Public object GetNewSubject( string Id )\n             {\n\n                 SubjectDB subjectdb = new SubjectDB();\n                 DBEntites db = new DBEntities();\n\n                 var subjectxx = db.SubjectDB.First(x =&gt; x.SubjectId == Id);\n                 var addressxx = db.AddressDB.First(x =&gt; x.SubjectId == Id);\n                 .\n                 .\n                 subjectdb.SubjectId = subjectxx.Subjectid;\n                 .\n                 .\n                 List&lt;AddressDB&gt; Address = new List&lt;AddressDB&gt;();\n                 Address.Add(addressxx);\n                 .\n                 .\n                 return(subjectdb);\n              }\n</code></pre>\n\n<p>I can mouse over the subjectdb in the subroutine and see all the data including the data in the List's, but when I mouse over the returned object \"xsubject\", I see all the correct returned data but the List's are empty.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12812920,"title":"Error No. 3034 mapping fragments isssue","body":"<p>I am developing MVC Application with EF 4.1.\nI have used TPH approch to genrate the DB. </p>\n\n<p>I have two entities, 1. company and 2. Lead , Lead is inherited from Company. </p>\n\n<p>please check below image :</p>\n\n<p><img src=\"http://i.stack.imgur.com/4VUOe.jpg\" alt=\"enter image description here\"></p>\n\n<p>Now I have below mappaings...</p>\n\n<p><img src=\"http://i.stack.imgur.com/ojY51.jpg\" alt=\"enter image description here\"></p>\n\n<p>here is edmx file with XML </p>\n\n<pre><code>&lt;EntitySetMapping Name=\"Companies\"&gt;\n            &lt;EntityTypeMapping TypeName=\"IsTypeOf(Model1.Company)\"&gt;\n                &lt;MappingFragment StoreEntitySet=\"Companies\"&gt;\n                    &lt;ScalarProperty Name=\"Id\" ColumnName=\"Id\" /&gt;\n                    &lt;ScalarProperty Name=\"Name\" ColumnName=\"Name\" /&gt;\n          &lt;Condition ColumnName=\"__Disc__\" Value=\"Company\" /&gt;\n                &lt;/MappingFragment&gt;\n            &lt;/EntityTypeMapping&gt;\n            &lt;EntityTypeMapping TypeName=\"Model1.Lead\"&gt;\n                &lt;MappingFragment StoreEntitySet=\"Companies\"&gt;\n    // Gives Error -&gt;   &lt;ScalarProperty Name=\"Id\" ColumnName=\"Id\" /&gt;\n    // Gives Error -&gt;   &lt;ScalarProperty Name=\"Name\" ColumnName=\"Name\" /&gt;\n    // Gives Error -&gt;   &lt;ScalarProperty Name=\"Status\" ColumnName=\"Status\" /&gt;\n                    &lt;Condition ColumnName=\"__Disc__\" Value=\"Lead\" /&gt;\n                &lt;/MappingFragment&gt;\n            &lt;/EntityTypeMapping&gt;\n</code></pre>\n\n<p>Error 3034: Problem in mapping fragments starting at lines 47, 54:An entity is mapped to different rows within the same table. Ensure these two mapping fragments do not map two groups of entities with identical keys to two distinct groups of rows.</p>\n"},{"tags":["c#","asp.net-mvc","visual-studio-2010","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":127,"score":1,"question_id":12807282,"title":"EF 5 Database First using custom validation","body":"<p>In order to experience the new features of Entity Framework I created a new MVC 4 internet application.<br/> I connected it to an existing database and generated the Model classes with the dbContext generator.</p>\n\n<p>By running the application I got some validation errors while editing a form. As example for a DateTime field the system was complaining if the date was inserted as \"12/10/2012\" instead of 2012-10-12 (as in the SQ Server notation). <br/>I tried to find the validation code in the project, but I could not find it anywhere in the generated code.</p>\n\n<p>One of my model classes is the following:</p>\n\n<pre><code>public partial class Artist\n{\n    public Artist()\n    {\n    }\n\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public Nullable&lt;System.DateTime&gt; DateOfBirth { get; set; }\n\n    public virtual Countries Countries { get; set; }\n}\n</code></pre>\n\n<p>How can I customize the validation errors if using the Database first approach? <br/>If I decor the models with my validation attributes, then they would be erased once the model classes are generated again.</p>\n\n<p>Moreover in a \"real world\" project where the use of an existing database is mandatory, what would be the best approach with the development of the model classes? <br/>Extending the classes automatically generated by adding partial classes with the same name?</p>\n\n<p>EDIT (Introduced part of the View):</p>\n\n<pre><code>@using (Html.BeginForm()) {\n@Html.ValidationSummary(false)\n\n&lt;fieldset&gt;\n    &lt;legend&gt;Movie&lt;/legend&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Name)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Name)\n        @Html.ValidationMessageFor(model =&gt; model.Name)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.DateOfBirth)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.DateOfBirth)\n        @Html.ValidationMessageFor(model =&gt; model.DateOfBirth)\n    &lt;/div&gt;\n\n    &lt;p&gt;\n        &lt;input type=\"submit\" value=\"Create\" /&gt;\n    &lt;/p&gt;\n&lt;/fieldset&gt;\n}\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first","dbcontext","objectcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12817420,"title":"When casting DBContext to an ObjectContext none of the entities are available","body":"<p>I have changed an existing project to use EF5 and code first. It is using a repository class which relies on the older ObjectContext. To keep the repository implementation the same I created a property on the DBContext which would return an ObjectContext:</p>\n\n<pre><code>public ObjectContext ObjectContext()\n{\n    return (this as IObjectContextAdapter).ObjectContext;\n}\n</code></pre>\n\n<p>The problem is that after this the entities are not available on the ObjectContext so the following code fails:</p>\n\n<pre><code>string GetSetName&lt;T&gt;() {\n    var entitySetProperty =\n    _context.GetType().GetProperties()\n       .Single(p =&gt; p.PropertyType.IsGenericType &amp;&amp; typeof(IQueryable&lt;&gt;)\n       .MakeGenericType(typeof(T)).IsAssignableFrom(p.PropertyType));\n\n    return entitySetProperty.Name;\n}\n</code></pre>\n\n<p>The original DBContext has all of the entities available before it is cast to an ObjectContext but as the ObjectContext class does not have the properties for my entities, how can I access them?</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","dbcontext"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":113,"score":1,"question_id":12816792,"title":"EF code first: inherited dbcontext creates two databases","body":"<p>I'm trying to create a base dbcontext that contains all the common entities that will always be reused in multiple projects, like pages, users, roles, navigation etc.</p>\n\n<p>In doing so I have a ContextBase class that inherits DbContext and defines all the DbSets that I want. Then I have a Context class that inherits ContextBase where I define project specific DbSets. The classes are defined as follows:</p>\n\n<pre><code>public class ContextBase : DbContext\n{\n    public virtual DbSet&lt;User&gt; Users { get; set; }\n    //more sets\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new UsersConfiguration());\n        //add more configurations\n    }\n}\n\n\npublic class Context : ContextBase\n{\n    public DbSet&lt;Building&gt; Buildings { get; set; }\n    //some more project specific sets\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        base.OnModelCreating(modelBuilder);\n        modelBuilder.Configurations.Add(new BuildingsConfiguration());\n        //add more project specific configs\n    }\n}\n</code></pre>\n\n<p>In my global.asax:</p>\n\n<pre><code>Database.SetInitializer(new MigrateDatabaseToLatestVersion&lt;Context, Configuration&gt;());\n</code></pre>\n\n<p>where Configuration referes to a class inheriting DbMigrationsConfiguration and overriding the Seed method.</p>\n\n<p>The two context classes are defined in the same namespace, but cross assembly (in order that I may update the base project in multiple existing projects without touching the project specific code) - not sure if this is relevant.</p>\n\n<p><strong>MY PROBLEM:</strong>\nWhen running this code, it works fine, but when looking in the Database, it actually creates two different databases!! One containing all the base entity tables and one containing BOTH base and custom tables. CRUD operations are only performed on the custom version (which is obviousely what I want), but why does it create the schema of the other one as well?</p>\n\n<p>Any help is appreciated, thanks!</p>\n"},{"tags":["c#",".net","sql","entity-framework","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":85,"score":2,"question_id":12800524,"title":"Why does ToPagedList take half a minute on an empty IQueryable while the underlying SQL runs in just one second?","body":"<p>I have a piece of Entity-to-SQL code that composes an <code>IQueryable</code>, runs <code>ToPagedList()</code> on it and then passes the result into an MVC view.</p>\n\n<p><code>ToPagedList()</code> fails with a timeout running the SQL query. I extracted the generated SQL query (using <code>IQueryable.ToString()</code>) and ran it on the server - it runs in less than one second and the output is empty (which is correct).</p>\n\n<p>So I have <code>ToPagedList()</code> running the query that would produce an empty result that runs half a minute and times out and I have the underlying SQL that runs in less than one second on the same server.</p>\n\n<p>Since the SQL query output is empty I can't blame the delay on filtering, retrieval or whatever else in the EF.</p>\n\n<p>What can cause a fast SQL query producing an empty output to run extremely slow from inside <code>ToPagedList()</code>?</p>\n\n<p><strong>UPD</strong></p>\n\n<p>This problem seems to have resolved on its own, so it looks like it was some temporary problem between the machine running the code and the SQL Server machine.</p>\n"},{"tags":["entity-framework","sql-server-2012","transactionscope","entity-framework-5","msdtc"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12809958,"title":"EF: How do I call SaveChanges twice inside a transaction?","body":"<p>Using Entity Framework (code first in my case), I have an operation that requires me  to call SaveChanges to update one object in the DB, and then SaveChanges again to update another object. (I need the first SaveChanges to resolve an issue where EF can't figure out which object to update first).</p>\n\n<p>I tried doing:</p>\n\n<pre><code>using (var transaction = new TransactionScope())\n{\n    // Do something\n\n    db.SaveChanges();\n\n    // Do something else\n\n    db.SaveChanges();\n\n    tramsaction.Complete();\n}\n</code></pre>\n\n<p>When I run that, I get an exception at the second <code>SaveChanges</code> call, saying \"the underlying provider failed on open\". The inner exception says that MSDTC is not enabled on my machine.</p>\n\n<p>Now, I've seen posts elsewhere that describe how to enable MSDTC, but it seems that I would also need to enable network access, etc. This sounds like complete overkill here, since there are no other databases involved, let alone other servers. I don't want to do something that's going to make my whole application less secure (or slower).</p>\n\n<p>Surely there must be a more lightweight way of doing this (ideally without MSDTC)?!</p>\n"},{"tags":["sql-server-2008","entity-framework","ado.net","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":131,"score":2,"question_id":12724320,"title":"Forcing code-first to always initialize a non-existent database?","body":"<p>Sometimes, I'll delete my development database and run my EF code-first application.  I'll get the error:</p>\n\n<blockquote>\n  <p>Cannot open database \"AssessmentSystem\" requested by the login. The login failed.\n  Login failed for user 'AssessmentAdmin'.</p>\n</blockquote>\n\n<p>I think this is because the <code>DbContext</code> only runs the DB initialization logic \"once per AppDomain when the context is used for the first time\", as <a href=\"http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm\" rel=\"nofollow\">this page</a> says.  This means I need to recycle the IIS application pool to get EF to recreate my database if I drop it.</p>\n\n<p>Is there any way I can get the DB initialization code to run <em>every time</em> I try to access the database?  So, it will always check to see whether the DB exists and if not, create it instead of trying to open it, even if it's using the same AppDomain that previously accessed the database that I have now dropped?</p>\n\n<p>Note that I would like this initializtion check to be done on <em>every query</em>, so even having it done in <code>Application_Start</code> isn't often enough; ideally, I'd like to be able to load some DB data, delete the DB, then load some DB data and it would recreate the DB without my even having to restart the application (basically I would just have to reload the web page that loads some DB data).</p>\n"},{"tags":["asp.net","entity-framework","asp.net-membership","database-connection","msdtc"],"answer_count":4,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":184,"score":2,"question_id":12409020,"title":"How to share a connection between EF DbContext and AspNet Membership to avoid transactions escalating to DTC","body":"<p>I have an ASP.NET MVC3 application that uses an EF 4.1 DbContext, database-first data layer. The EDMX approach works fine as I tend to make changes to my data model before adapting the application to them. The application works fine with the special EF connection string that includes metadata references.</p>\n\n<p>However, there's one fly in the ointment. The application also uses ASP.NET membership and roles which require a standard connection string. I have several use cases that involve both the membership tables and other (EF managed) tables. As the two use separate connection strings, transactions that involve both need DTS to handle them. I don't want to go that route if I can help it, I'd rather all parts of the application simply use the same connection.</p>\n\n<p>Getting EF to run with a plain connection string however is eluding me. Can anyone tell me how it is done, please?</p>\n"},{"tags":["c#","entity-framework","npgsql","edmgen"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12814916,"title":"EdmGen Npgsql no entity generated for view","body":"<p>I'm trying to generate classes from a PostgreSql database with Npgsql as a provider. I use EdmGen from the command line like this:</p>\n\n<pre><code>EdmGen.exe /mode:FullGeneration /provider:Npgsql /connectionstring:\"Server=MyServer;Port=5432;UserId=postgres;Password=******;Database=MyDb;\" /p:MyProject\n</code></pre>\n\n<p>My problem is, that I created a view in the database and I want code, entity to be generated for that vie too. But the generation fails with the following message:</p>\n\n<pre><code>Exception: The table/view '[TableName]' does not have a primary key defined and no valid primary key could be inferred. This table/view has been excluded. To use the entity, you will need to review your schema, add the correct keys, and uncomment it.\n</code></pre>\n\n<p>I found with the help of Google that PostgreSql does not support primary keys on views.</p>\n\n<p>Have you got any idea how to resolve this on the easiest way? </p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12813157,"title":"Problems with Entity Framework Power Tools in generating view","body":"<p>I've created console application. Then I've performed Install-Package EntityFramework, setted target .net 4.0. </p>\n\n<p>My simple model is</p>\n\n<pre><code>public class Abonent\n    {\n        public Abonent() {}\n        [Key]\n        public int AbonentId { get; set; }\n        public string Name { get; set; }\n    }\n</code></pre>\n\n<p>My dbcontext is (ModelContext.cs)</p>\n\n<pre><code>public class ModelContext : DbContext\n    {\n        public ModelContext():base(){}\n        public DbSet&lt;Abonent&gt; Abonents { get; set; }\n    }\n</code></pre>\n\n<p>Program.cs is</p>\n\n<pre><code>class Program\n    {\n        static void Main(string[] args)\n        {\n\n            Database.DefaultConnectionFactory = new System.Data.Entity.Infrastructure.SqlCeConnectionFactory(\"System.Data.SqlServerCe.4.0\");\n            ModelContext _abonentContext = new ModelContext();\n\n            Abonent abonent=new Abonent();\n            _abonentContext.Abonents.Add(abonent);\n            _abonentContext.SaveChanges();\n        }\n    }\n</code></pre>\n\n<p>It works just fine, but when I do right button click on ModelContext.cs and choose <code>Entity Framework -&gt; Generate View</code> and I get a message box saying \"Exception has been thrown by the target of an invocation\".</p>\n\n<p>What I've done wrong? Is exist alternative for ef power tools? (VS 2010 SP1,Entity Framework Power Tools Beta 2) </p>\n"},{"tags":["c#","entity-framework","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":12811975,"title":"Entity Framework Circular Reference","body":"<p>Trying this question again because my first attempt was barely coherent :p</p>\n\n<p>So I am super confused and using Entity Framework Code First</p>\n\n<p>I have a Forest class.</p>\n\n<p>I have a Tree class.</p>\n\n<p>Each Forest can have many Trees</p>\n\n<p>When I was trying to serialize I was getting circular reference </p>\n\n<pre><code>public class Forest\n{\n\n    public Guid ID { get; set; }  \n    public virtual List&lt;Tree&gt; Trees { get; set; }\n}\npublic class Tree\n{\n    public Guid ID { get; set; }\n    public Guid? ForestId {get;set;}\n\n    [ForeignKey(\"ForestId\")]\n    public virtual Forest Forest {get;set;}\n }\n</code></pre>\n\n<p>Every forest has trees but not every tree is in a forest.  I struggle with either errors of Multiplicity when doing</p>\n\n<pre><code>@(Html.Raw(Json.Encode(Model)))\n</code></pre>\n\n<p>Where the model is a Forest</p>\n\n<p>and if I make <code>ForestId</code> a <code>Guid</code> instead of a <code>Guid?</code> I get Circular Reference errors.</p>\n\n<p>I also tried \nprotected override void </p>\n\n<pre><code>OnModelCreating(System.Data.Entity.ModelConfiguration.ModelBuilder modelBuilder) \n{ \n  modelBuilder.Entity&lt;Forest&gt;() \n  .HasMany(x =&gt; x.Tree) \n  .WithOptional() \n   .HasForeignKey(y =&gt; y.ForestId); \n}\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["asp.net","asp.net-mvc-3","entity-framework","entity-framework-4","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12811931,"title":"EF Code first : Cannot insert explicit value for identity column in table 'myTable' when IDENTITY_INSERT is set to OFF","body":"<p>Set the primary key to identity in database (SQL Server)</p>\n\n<p>When using EF to insert data I am getting error </p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table 'myTable'\n  when IDENTITY_INSERT is set to OFF</p>\n</blockquote>\n\n<p>with this particular entity, though I am using the same approach with other entities to insert the data and getting no error with them.</p>\n\n<pre><code>   public class MyTable \n    {\n    [Key/*,DatabaseGenerated(DatabaseGeneratedOption.Identity)*/]\n    public int ID{get;set;}\n    public string name {get;set;}\n    public string type {get;set;}\n    public string status {get;set;}\n    public int country {get;set;}\n    public DateTime start_date {get;set;}\n    public DateTime due_date {get;set;}\n    }`\n</code></pre>\n\n<p>Query</p>\n\n<pre><code>    MyTable check= new MyTable();\n            check.name = checkName;\n            check.type = \"DB\";\n            check.status = \"New\";\n            check.country = country;\n            check.start_date = DateTime.Now;\n            check.due_date = dueDate;\n            db.myTables.Add(check);\n            db.SaveChanges();\n</code></pre>\n\n<p><b>Updated </b>:</p>\n\n<p>After uncommenting the above line </p>\n\n<pre><code>(DatabaseGenerated(DatabaseGeneratedOption.Identity)) \n</code></pre>\n\n<p>it's throwing an exception </p>\n\n<blockquote>\n  <p>A dependent property in a ReferentialConstraint is mapped to a\n  store-generated column. Column: 'ID'</p>\n</blockquote>\n"},{"tags":["entity-framework","asp.net-membership"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12811770,"title":"Membership with EF","body":"<p>I am using entity framework for my mvc application,in which i have added membership tables, so that i can use Membership class methods to create users,</p>\n\n<p>my connection string is like</p>\n\n<pre><code>&lt;add name=\"MentorEntities\" connectionString=\"metadata=res://*/Model1.csdl|res://*/Model1.ssdl|res://*/Model1.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=WASIM-LAP;Initial Catalog=Mentor;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>also added in membership provider</p>\n\n<pre><code>&lt;add name=\"AspNetSqlMembershipProvider\" type=\" PortalRepository.Account.AccountRepository\" connectionStringName=\"MentorEntities\"\n         enablePasswordRetrieval=\"false\" enablePasswordReset=\"true\" requiresQuestionAndAnswer=\"false\" requiresUniqueEmail=\"false\"\n         maxInvalidPasswordAttempts=\"5\" minRequiredPasswordLength=\"6\" minRequiredNonalphanumericCharacters=\"0\" passwordAttemptWindow=\"10\"\n         applicationName=\"/\" /&gt;\n</code></pre>\n\n<p>now when i am calling createUser method of membership class i am getting error</p>\n\n<blockquote>\n  <p>An error occurred while attempting to initialize a System.Data.SqlClient.SqlConnection object. The value that was provided for the connection string may be wrong, or it may contain an invalid syntax.\n  Parameter name: connectionString</p>\n</blockquote>\n\n<p>I added one more connection string which is not refrencing from EF like:</p>\n\n<pre><code>&lt;add name=\"MentorEntitiesMembership\" \n     connectionString=\"Data Source=WASIM-LAP;Initial Catalog=Mentor;Integrated Security=True;MultipleActiveResultSets=True;\" \n     providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>and pass its refrence in provider like:</p>\n\n<pre><code>&lt;add name=\"AspNetSqlMembershipProvider\" type=\" PortalRepository.Account.AccountRepository\" connectionStringName=\"MentorEntitiesMembership\"\n         enablePasswordRetrieval=\"false\" enablePasswordReset=\"true\" requiresQuestionAndAnswer=\"false\" requiresUniqueEmail=\"false\"\n         maxInvalidPasswordAttempts=\"5\" minRequiredPasswordLength=\"6\" minRequiredNonalphanumericCharacters=\"0\" passwordAttemptWindow=\"10\"\n         applicationName=\"/\" /&gt;\n</code></pre>\n\n<p>NOW Its working fine</p>\n\n<p>What i found is create seprate Class inheriting from SqlMembership and override membership methods and property to use EF context object and save from EF layer</p>\n\n<p>So which is good approach or is there any other way to do?</p>\n"},{"tags":["entity-framework","data-binding","razor","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":292,"score":2,"question_id":12811479,"title":"ASP.net MVC4 Multiselect ListBox with Many-to-Many relationship","body":"<p>I'm new to ASP.net, MVC4 and EF and having trouble making the leap from relatively simple samples to something (only slightly) more complex.  I have simplified my model for the question here so consider the following.  Forgive me if I have some of the terminology incorrect.</p>\n\n<p>I have an Employee object and a Division object.  An employee can be in many divisions and a division can have many employees. </p>\n\n<pre><code>public class Employee\n{\n    public int EmployeeId { get; set; }\n    public String FirstName { get; set; }\n    public String LastName { get; set; }\n\n    public virtual ICollection&lt;Division&gt; Divisions { get; set; }\n}\n\npublic class Division\n{\n    public int DivisionId { get; set; }\n    public String DivisionName { get; set; }\n\n    public virtual ICollection&lt;Employee&gt; Employees { get; set; }\n}\n</code></pre>\n\n<p>I have these mapped in the context file via the following:</p>\n\n<pre><code>    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n\n        modelBuilder.Entity&lt;Employee&gt;()\n                .HasMany(e =&gt; e.Divisions)\n                .WithMany(d =&gt; d.Employees)\n                .Map(m =&gt;\n                {\n                    m.ToTable(\"EmployeesDivisionsId\");\n                    m.MapLeftKey(\"EmployeeId\");\n                    m.MapRightKey(\"DivisionId\");\n                });      \n    }\n</code></pre>\n\n<p>For my View Controller I have the following.  I have used a ViewBag (what a name) for many to one relationships and they have worked fine, so I'm trying to modify that to work with the many to many here:</p>\n\n<pre><code>    public ActionResult Index()\n    {\n        return View(db.Employees).ToList());\n    }\n\n    //\n    // GET: /Employees/Details/5\n\n    public ActionResult Details(int id = 0)\n    {\n        Employee employee = db.Employees.Find(id);\n        if (employee == null)\n        {\n            return HttpNotFound();\n        }\n        return View(employee);\n    }\n\n    //\n    // GET: /Employees/Create\n\n    public ActionResult Create()\n    {\n        ViewBag.Divisions = new MultiSelectList(db.Divisions, \"DivisionId\", \"DivisionName\");\n\n        return View();\n    }\n\n    //\n    // POST: /Employees/Create\n\n    [HttpPost]\n    public ActionResult Create(Employee employee)\n    {\n        ViewBag.Divisions = new MultiSelectList(db.Divisions, \"DivisionId\", \"DivisionName\");\n\n        if (ModelState.IsValid)\n        {\n            db.Employees.Add(employee);\n            db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n\n        return View(employee);\n    }\n</code></pre>\n\n<p>Finally in the Edit View I have the following code.  Again for a many to one relationship, a simple DropDownList works fine with the ViewBag in the controller, and with this many to many multiselect/ListBox method the 'Divisions' show up in the view, however when the Save button is hit, the validation of '1, 2' is not valid is displayed.</p>\n\n<pre><code>    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Divisions)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.ListBox(\"Divisions\")\n        @Html.ValidationMessageFor(model =&gt; model.Divisions)\n    &lt;/div&gt;\n</code></pre>\n\n<p>So as I understand it, the list of 'Divisions' are being grabbed properly from the database and selected correctly in the view but when saving to the database the association through the mapped relationship isn't being made.</p>\n\n<p>So my questions are:\nHow do I make this work so when I save, the correct 'Divisions' are saved to the Employee?</p>\n\n<p>Also, I've heard people don't like using ViewBags, is there a (better?) alternate way?</p>\n"},{"tags":["database","wcf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12803258,"title":"Load data, WCF services","body":"<p>Help me please!\nI have project on ASP.NET MVC, EF 4.5 and WCF services.\nProblem is that data from database are not loading to View.\nI traced host WCF project with debugger and saw logs in SvcTraceViewer and\nI saw similar errors for entities(which are not loading), but I cant stand what they mean.:</p>\n\n<p>Image with error description.\n<img src=\"http://i.stack.imgur.com/hmy6c.png\" alt=\"My errors\"></p>\n"},{"tags":["c#",".net","wcf","entity-framework","poco"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":2,"view_count":63,"score":-2,"question_id":12810918,"title":"COLLECTION Fixed Size WCF Entity Framework","body":"<p>I have the following problem, my WCF service is pretty simple, send some entities from an entity framework context, which I have disabled the proxy generation and Lazy loading, but what happens is that when I have an entity which I add a reference entity arises me an exception that tells me that the collection has a fixed size. I guess the problem must be in WCF when serializing / deserealizar entity, but I can not think how to solve the problem.</p>\n\n<p>example:</p>\n\n<p>An Office Product has products and has offices, I get the list of available service offices (from entity framework) and then I create a product, but when assigning an office or:</p>\n\n<pre><code>NewProduct.Oficinas.Add(varOficina);\n</code></pre>\n\n<p>raises the exception that tells me that the collection has a fixed size, but does not arise from the collection \"Office\" product of the entity, the entity arising from member Office and \"Products\", that the problem arises in the body that comes from WCF service, so I guess there goes the problem. Hopefully someone has the answer because it has brought me a lot of headaches</p>\n"},{"tags":["xml","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12810244,"title":"What is the simplest approach to creating an XML document from a series of DB tables accessed via EF","body":"<p>What is the simplest approach to creating an XML document from a multiples tables from a database ie: Orders > OrderItems &lt; Products .... may be :</p>\n\n<pre><code>&lt;Order id=\"1\"&gt;\n  &lt;OrderItem id =\"1\"&gt;\n    &lt;Product&gt;Wheel&lt;/Product&gt;\n    &lt;Qty&gt;1&lt;Qty/&gt;\n    &lt;Price&gt;10.00&lt;/Price&gt;\n  &lt;/OrderItem&gt;\n&lt;Order&gt;\n</code></pre>\n\n<p>I need it in XML to transform to XHTML for loading into Word.</p>\n\n<p>I am also using MVC3, EF5.</p>\n\n<p>Thanks</p>\n"},{"tags":["wpf","entity-framework","data-binding","visual-studio-2010","commit"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1050,"score":5,"question_id":2645803,"title":"Force WPF to Commit Changes on Focused Element","body":"<p>I'm working with VS2010, WPF and EF.  I've placed controls on my window by dragging an entity out of the Data Sources toolwindow.  I used the \"details\" setting so my entity is represented by several labels and textboxes.  I've also added a button with the following code:</p>\n\n<pre><code>_context.SaveChanges();\n</code></pre>\n\n<p>When I'm editing data, the changes in whichever textbox has focus are not committed back to the DB.  Everything else commits just fine.  If I shift focus to another element prior to hitting the save button, it commits as well.  I've experienced the same thing with the DataGrid.  </p>\n\n<p>I know I'm missing something simple, but I can figure it out.  Any ideas on what I'm missing?</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","sql","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12809631,"title":"Tweaking the sequence elements of an IQueryable with a Select clause?","body":"<p>I want to do something that feels like it should be really simple, but has turned out to be a real headache.  I'm <code>Select</code>ing from an <code>IQueryable</code> and instead of creating a new object, I want to \"tweak\" the one that I'm projecting.  Here's what I want to be able to do (<code>context</code> is a <code>DbContext</code>, and I'm using a code-first approach):</p>\n\n<pre><code>var eventsToReturn =\n    ((IQueryable&lt;Event&gt;)\n        context.Events\n        .OrderByDescending(evnt =&gt; evnt.TakesPlaceOn)\n        .Skip(startAt)\n        .Take(numberToReturn)\n    )\n    .Select(evnt =&gt;\n        {\n            evnt.UnmappedUsersCount = evnt.Users.Count();\n            return evnt;\n        }\n    )\n    .ToList();\n</code></pre>\n\n<p>This is nice because Entity Framework doesn't have to actually get all the <code>User</code> entities associated with each event, and can use an aggregate <code>COUNT</code> function to simply get the number of users.  However, it doesn't work, because the <code>IQueryable</code> version of <code>Select</code> wants a lambda statement with no method body that can be converted into an expression tree.  So, while the above doesn't work, this does:</p>\n\n<pre><code>.Select(evnt =&gt; evnt)\n</code></pre>\n\n<p>... and so does this:</p>\n\n<pre><code>.Select(evnt =&gt; evnt.Users.Count())\n</code></pre>\n\n<p>I have solved the problem, but my way seems rather long-winded.  Here's my approach:</p>\n\n<pre><code>var eventsToReturnData =\n    ((IQueryable&lt;Event&gt;)\n        context.Events\n        .OrderByDescending(evnt =&gt; evnt.TakesPlaceOn)\n        .Skip(startAt)\n        .Take(numberToReturn)\n    )\n    .Select(evnt =&gt;\n        new {\n            Event = evnt,\n            UnmappedUsersCount = evnt.Users.Count()\n        }\n    )\n    .ToList();\n\nvar eventsToReturn = eventsToReturnData\n    .Select(evntData =&gt; {\n        evntData.Event.UnmappedUsersCount = evntData.UnmappedUsersCount;\n        return evntData.Event;\n    })\n    .ToList();\n</code></pre>\n\n<p>So I'm projecting the main <code>Event</code> object into an anonymous object, as well as the one tiny <code>int</code> that I want to add to it, and then doing a whole new <code>Select</code> on <code>eventsToReturnData</code>, which works this time because <code>eventsToReturnData</code> is an <code>IEnumerable</code> (so the lambda can have a method body), just to tweak the <code>Event</code> object by setting the <code>UnmappedUsersCount</code> integer that I got from the first query.</p>\n\n<p>Is there a simpler or more elegant way to do this?  I want to avoid EF having to retreive all the users for each event, so it's no good just using <code>Event.Users.Count()</code> on what is returned by the <code>IQueryable</code>'s <code>Select</code> method.</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12724733,"title":"Error comes as a {\"Invalid object name 'dbo.TableName'.\"}","body":"<p>I'm using Entity Framework and MVC3,\nI have used Model First approch...\nI have used <em>Company</em> as a Base class and I have inherited the <em>Lead</em> Class from it. </p>\n\n<p>When I run the application its gives an error...</p>\n\n<p>This is Base Class</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\n\n    namespace CRMEntities\n    {\n        public partial class Company\n        {\n            public int Id { get; set; }\n        }\n\n    }\n</code></pre>\n\n<p>This is Lead Class (Child)</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\n\nnamespace CRMEntities\n{\n    public partial class Lead : Company\n    {\n        public Lead()\n        {\n            this.Status = 1;\n            this.IsQualified = false;\n\n        }\n\n        public Nullable&lt;short&gt; Status { get; set; }\n        public Nullable&lt;bool&gt; IsQualified { get; set; }\n\n\n    }\n\n\n}\n</code></pre>\n\n<p>I have added the controller,and in index view I have added this code...</p>\n\n<pre><code>public class Default1Controller : Controller\n    {\n        private CRMWebContainer db = new CRMWebContainer();\n\n        //\n        // GET: /Default1/\n\n        public ViewResult Index()\n        {\n\n            return View(db.Companies.OfType&lt;Lead&gt;().ToList());\n         } \n    }\n</code></pre>\n\n<p>This is DB and Model ...</p>\n\n<p><img src=\"http://i.stack.imgur.com/ZRQP1.jpg\" alt=\"enter image description here\"></p>\n\n<p>Its giving the inner error -</p>\n\n<blockquote>\n  <p>{\"An error occurred while executing the command definition. See the\n  inner exception for details.\"} {\"Invalid object name\n  'dbo.Companies'.\"}</p>\n</blockquote>\n"},{"tags":["c#","entity-framework","ef-code-first","entity-framework-5"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":2,"question_id":12805572,"title":"In EF Code First, can Foo have a collection of Bars and also a \"FavouriteBar\"?","body":"<p>To illustrate my problem, suppose I have a data model where I have a collection of Books, each of which has one or more Drafts, and also a \"current\" Draft.  I'd like my model to look something like this:</p>\n\n<pre><code>class Book\n{\n    public int Id { get; set; }\n\n    public string Title { get; set; }\n\n    public virtual ICollection&lt;Draft&gt; Drafts { get; set; }\n\n    public virtual Draft CurrentDraft { get; set; }\n}\n\nclass Draft\n{\n    public int Id { get; set; }\n\n    public virtual int BookId { get; set; }\n    public virtual Book Book { get; set; }\n\n    public string Description { get; set; }\n}\n</code></pre>\n\n<p>I have a DbContext that looks like this:</p>\n\n<pre><code>class TestDbContext : DbContext\n{\n    public DbSet&lt;Book&gt; Books { get; set; }\n    public DbSet&lt;Draft&gt; Drafts { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Conventions.Remove&lt;OneToManyCascadeDeleteConvention&gt;();\n        modelBuilder.Conventions.Remove&lt;ManyToManyCascadeDeleteConvention&gt;();\n\n        base.OnModelCreating(modelBuilder);\n    }\n}\n</code></pre>\n\n<p>...and a simple program like this:</p>\n\n<pre><code>static void Main(string[] args)\n{\n    Database.SetInitializer&lt;TestDbContext&gt;(new DropCreateDatabaseAlways&lt;TestDbContext&gt;());\n\n    using (var db = new TestDbContext())\n    {\n        var book = new Book() { Title = \"War and Peace\", Drafts = new List&lt;Draft&gt;() };\n\n\n        var draft1 = new Draft() { Book = book, Description = \"First Draft\" };\n\n        book.Drafts.Add(draft1);\n\n\n        var draft2 = new Draft() { Book = book, Description = \"Second Draft\" };\n\n        book.Drafts.Add(draft2);\n\n\n        book.CurrentDraft = draft2;\n\n\n        db.Books.Add(book);\n\n        db.SaveChanges();\n\n\n        foreach (var b in db.Books)\n        {\n            Console.WriteLine(\"Book {0}: {1}\", b.Id, b.Title);\n\n            foreach (var d in book.Drafts)\n                Console.WriteLine(\"\\tDraft ID {0}: {1} from Book ID {2}\", d.Id, d.Description, d.BookId);\n\n            Console.WriteLine(\"Current draft has ID {0}\", b.CurrentDraft.Id);\n        }\n\n        Console.ReadKey();\n    }\n}\n</code></pre>\n\n<p>When the DB is created by EF, it looks like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/oB7Uy.png\" alt=\"database schema\"></p>\n\n<p>[I'm not wild about the extra Book_Id column, but I could live with it if it worked.]</p>\n\n<p>Sadly, when I run the test program, it fails at the <code>SaveChanges</code> call, with an exception:</p>\n\n<blockquote>\n  <p>An error occurred while saving entities that do not expose foreign key\n  properties for their relationships. The EntityEntries property will\n  return null because a single entity cannot be identified as the source\n  of the exception. Handling of exceptions while saving can be made\n  easier by exposing foreign key properties in your entity types. See\n  the InnerException for details.</p>\n</blockquote>\n\n<p>I've tried messing about with the fluent API in my OnModelCreating, but when I try to configure it that way it gets confused by the fact that there are two FK relationships between Books and Drafts. I'm not familiar enough with the fluent stuff (or EF generally) to know how to do it properly.</p>\n\n<p>Is this even possible in EF code first?</p>\n"},{"tags":["entity-framework","asp.net-3.5"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":936,"score":2,"question_id":2361658,"title":"Unknown server tag 'asp:EntityDataSource'","body":"<p>I uploaded my files to my remote server having support for ASP.Net 3.5. Website is developed using ASP.Net 3.5 and Entity Framework. Also i copied the dlls to bin folder. But i am getting the following error</p>\n\n<p>arser Error Description: An error occurred during the parsing of a resource required to service this request. Please review the following specific parse error details and modify your source file appropriately.</p>\n\n<p>Parser Error Message: Unknown server tag 'asp:EntityDataSource'.</p>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":12805984,"title":"EF defer setting property until insert","body":"<pre><code>public class User {\n    int Id { set; get; } // autogenerated on insert\n    public string Username { set; get; }\n}\n</code></pre>\n\n<p>Then some where in my code I have the follow:</p>\n\n<pre><code>var user = new User();\nuser.Username = string.Format(\"user{0}\", user.Id);\ndbContext.User.Add(user);\ndbContext.SaveChanges();\nDebug.WriteLine(user.Username); // outputs \"User0\" when the Id is ..not 0\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12805287,"title":"Is it possible to use OfType in a linq where?","body":"<p>I have a table called source that has multiple derived tables such as account, etc. I have a second table that has a navigation property to that table called Source.  </p>\n\n<p>What I'd like to do is filter the results of ActionItemState by the type of the Source then filter based on a property of that inherited table. </p>\n\n<p>Here is an example of what I'm trying to do.  I get \". LINQ to Entities only supports casting EDM primitive or enumeration types\" when I try the code below.  Does anyone know of a way to use OfType or something similar?</p>\n\n<pre><code> query = from a in _actionItemRepository.GetTable()\n         where a.ActionItemStates.Any(ais =&gt; ais.Source is AccountSource &amp;&amp; ((AccountSource)ais.Source).AccountId == id)\n         select a;\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/lpnCp.png\" alt=\"enter image description here\"></p>\n"},{"tags":["entity-framework","domain-driven-design","dto","aggregates"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12791795,"title":"Considering the following architectural changes and need some advice (Domain Entities, DTO, Aggregates)","body":"<p>about a year ago I set set up a solution consisting of an ASP.Net MVC 3 (now) presentation layer, application layer, domain layer and infrastructure layer (crosscutting stuff and data).  I decided to keep the domain model in a separate project from the domain logic and use a relaxed approach to the presentation layer by passing the domain entities instead of DTO's since we really only have 1 front end right now.  </p>\n\n<p>We are going to be servicing a distributed layer soon, in addition to our main website and I will use DTO's there, but I am considering using DTO's in the main website also.  I am also wondering if I should bother to break out the framework code in the domain layer (IRepository, IUnitOfWork, Entity/Value object supertypes etc).  Well here, let me list out the questions I need feedback on:</p>\n\n<p>1) I was pretty diligent about not having an anemic domain model and also watched out for behavior that was specific to the presentation concerns.  Most of the business calculations that are needed are on the domain entities, is it ok for the presentation layer to call this behavior directly or should it instead call an application service that then calls the domain entities?  This would suggest to me that there is no reason to have the presentation layer know about the domain entities and instead could use DTO's.  Alternatively, I could have the DTO's expose these behaviors, but then I feel like I am robbing the domain entities.  So I guess that is 3 options (Rich domain objects called directly, service layer or dto with behavior) which is best?</p>\n\n<p>2) Right now I have a domain project, which has domain services, specifications and logic and is orchestrated by the application layer and separate project for the domain model (used by presentation layer and application layer).  I also have framework interfaces for generic repository and unit of work pattern here.  Should I break the framework stuff out into a separate project and combine the rest into one project?</p>\n\n<p>3) I want to reorganize my domain layer into aggregates, right now all of the domain model is organized by modules, basically all the types for each module are in one namespace.  Would it be better to organize the entities, value objects, services and other stuff by the aggregates?</p>\n\n<p>4) Should I use the Separated Interface pattern for infrastructure services that are basically .net framework helper library types?  For example configuration objects or validation runners?  What is the benefit there in doing so?</p>\n\n<p>5) Lastly, not many examples I have seen have used interfaces for domain entities.  Almost every object I have I prefer to pass around interfaces for dependency reasons and it makes testing much easier.  Is it valid to use interfaces instead of concretes?  I should mention that we use EF 4.3.1 (soon to upgrade to latest version) and I seem to remember that EF had a problem with using interfaces or something.  Should I be exposing interfaces instead of the domain entities?</p>\n\n<p>Thank you very much in advance.</p>\n\n<p>Project Structure:</p>\n\n<pre>\nPresentation.Web\n     |       |\n     |    Application\n     |     |      |\nDomain.Model - Domain\n\n(Infrastructure.Data, Infrastructure.Core, Infrastructure.Security)\n</pre>\n\n<p>Explanation:\nPresentation.Web (MVC3 Web Project)</p>\n\n<p>Application \n -- Service Layer that orchestrates the domain layer and responds to requests from the presentation layer (get this update that).  This is organized by module, for example if I had a customer module I would have Application.Customer and in that would be all of the application services</p>\n\n<p>Domain\n -- Contains domain services, specifications, calculations and other domain logic that is not exposed as behavior on domain entities.  For example a calculation that involves several domain entities exposed as a domain service for the application layer to call.\n -- Also contains framework code for a specification framework and the main interfaces for a generic repository and unit of work pattern.</p>\n\n<p>Domain.Model\n -- Contains the domain entities and enumerations.  Organized by module.  For example, if I might have a customer module which has a customer entity, customerorder entity etc. This is broken out away from the domain project so that the objects can be used by the application and presenation layer.</p>\n\n<p>Infrastructure.Security\n -- Security infrastructure for authentication and authorization</p>\n\n<p>Infrastructure.Core\n -- Cross-cutting stuff used by multiple layers (validators, logging, configuration, extensions, IoC, email etc..).  Most of the projects depend on interfaces in this project (except domain.model) for infrastructure services.</p>\n\n<p>Infrastructure.Data\n -- Repository Implementations via LINQ and EF 4.3.1, mapping layer, Unit of Work implementation.  Interfaces are in Domain project (separated interfaces pattern)</p>\n"},{"tags":["entity-framework","entity-framework-4.1","ef-code-first","poco"],"answer_count":7,"favorite_count":57,"up_vote_count":120,"down_vote_count":0,"view_count":28378,"score":120,"question_id":5446316,"title":"EF 4.1 Code-first vs Model/Database-first","body":"<p><strong>What are the pros &amp; cons of using Entity Framework 4.1 Code-first over Model/Database-first with EDMX diagram?</strong></p>\n\n<p>I'm trying to fully understand all the approaches to building data access layer using EF 4.1. I'm using Repository pattern and IoC.</p>\n\n<p>I know I can use code-first approach: define my entities and context by hand and use ModelBuilder to fine-tune the schema.</p>\n\n<p>I can also create an EDMX diagram and choose a code generation step that uses T4 templates to generate the same POCO classes. </p>\n\n<p>In both cases I end up with POCO object which are ORM agnostic and context that derives from <code>DbContext</code>.</p>\n\n<p>Database-first seems to be most appealing since I can design database in Enterprise Manager, quickly synch the model and fine-tune it using the designer. </p>\n\n<p>So what is the difference between those two approaches? Is it just about the preference VS2010 vs Enterprise Manager?</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12804760,"title":"Two tables related in one view","body":"<p>This is in reference to question:\n<a href=\"http://stackoverflow.com/questions/11271249/multiple-checkboxes-to-select-and-save-values-in-database-table-c-sharp-mvc3\">Multiple Checkboxes to select and save values in database table C# MVC3</a></p>\n\n<p>I have taken the answer and used this - it works well! I have also created another viewModel that uses this same script. It works but not the way I need it too. </p>\n\n<p>I need to do everything that the view model does plus show a question that the checkboxes relate to. I have a table of questions and a table of answers. The answers get updated, the questions are just for show. The tables are related by <code>MainQuestionID</code>. I currently use the <code>MainQuestion</code> model to call the list of questions executed by a link click for that subcategory. So the questions return to list where the subcategory is = to. I would like to implement this but instead of using the <code>MainQuestions</code> model to display - use the viewModel and combine the list to the view. \nI have tried using <code>ICollection</code> in the view but it will not make question available for the view. </p>\n\n<p>My <code>MainAnswers</code> table that needs updated by the checkboxes gets populated with the <code>MainQuestionID</code> of all the questions via a stored procedure. </p>\n\n<p>Could someone give an example of how to do this it would be much appreciated. </p>\n\n<p>thanks </p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":3217,"score":10,"question_id":3061313,"title":"Entity framework MappingException: The type 'XXX has been mapped more than once","body":"<p>I'm using Entity framework in web application. ObjectContext is created per request (using HttpContext), hereby code:</p>\n\n<pre><code>string ocKey = \"ocm_\" + HttpContext.Current.GetHashCode().ToString();\nif (!HttpContext.Current.Items.Contains(ocKey))\n{\n    HttpContext.Current.Items.Add(ocKey, new ElevationEntityModel(EFConnectionString));\n}\n_eem = HttpContext.Current.Items[ocKey] as ElevationEntityModel;\n</code></pre>\n\n<p>Not every time, but sometimes I have this exception:</p>\n\n<blockquote>\n  <p>System.Data.MappingException was unhandled by user code   Message=The\n  type 'XXX' has been mapped more than once.   Source=System.Data.Entity</p>\n</blockquote>\n\n<p>I'm absolutely confused and I don't have any idea what can caused this problem.</p>\n\n<p>Can anybody help me?</p>\n"}]}
