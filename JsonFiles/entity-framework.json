{"total":18927,"page":1,"pagesize":100,"questions":[{"tags":["c#","wpf","linq","entity-framework","datagrid"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13295117,"title":"Error while creating an editable DataGrid","body":"<p>I've managed to stump myself with LINQ. I am trying to create an editable datagrid in a WPF app using a subset gathered from a LINQ query:</p>\n\n<pre><code>var LookUpEvents = from d in ThisData.Events.Local\n                   where d.StartDate.Value.Date &lt;= DateTime.Now.Date &amp;&amp;\n                   (d.EndDate.HasValue == false || d.EndDate.Value.Date &gt;= DateTime.Now.Date)\n                   select d;\nRangeEventGrid.ItemsSource = LookUpEvents;\nRangeEventGrid.Items.Refresh();\n</code></pre>\n\n<p>This query works, and the datagrid is populated however I am unable to edit the datagrid, when trying to this exception is thrown:</p>\n\n<pre><code>\"'EditItem' is not allowed for this view.\"\n   at System.Windows.Controls.ItemCollection.System.ComponentModel.IEditableCollectionView.EditItem(Object item)\n   at System.Windows.Controls.DataGrid.EditRowItem(Object rowItem)\n</code></pre>\n\n<p>When loading the full dataset using:</p>\n\n<pre><code>ThisData.Events.Load();\nFullEventGrid.ItemsSource = ThisData.Events.Local;\n</code></pre>\n\n<p>Everything works fine and the data is editable. The XAML used is identical (I have also tried swapping the bound datagrids and the full result remains editable and the query throws the exception still) and the only difference between these is the query. When I try to change the query I end up with a new exception:</p>\n\n<pre><code>The specified type member 'Date' is not supported in LINQ to Entities. Only initializers, entity members, and entity navigation properties are supported.\n</code></pre>\n\n<p>The query used for that:</p>\n\n<pre><code>var LookUpEvents = from d in ThisData.Events\n                   where d.StartDate.Value.Date &lt;= DateTime.Now.Date &amp;&amp;\n                   (d.EndDate.HasValue == false || d.EndDate.Value.Date &gt;= DateTime.Now.Date)\n                   select d;\nLookUpEvents.Load(); //Exception thrown here.\nRangeEventGrid.ItemsSource = LookUpEvents;\nRangeEventGrid.Items.Refresh();\n</code></pre>\n\n<p>The really weird thing about that exception (weird to me at least) is that I use DateTime comparison in other queries that do not throw any exceptions, for example this query in another place works fine:</p>\n\n<pre><code>var LookUpSessions = from d in ThisData.Sessions\n                     where d.EndTime.Hour &gt;= (DateTime.Now.Hour - 1) &amp;&amp; d.StartTime.Hour &lt;= (DateTime.Now.Hour + 2)\n                     &amp;&amp; d.Event.IsActive == true\n                     orderby d.StartTime.Hour, d.StartTime.Minute\n                     select d;\n</code></pre>\n\n<p>Is it not possible to bind a LINQ query result to a DataGrid to be editable? That seems like it'd be a huge oversight if that's the case. I feel like it's much more likely I'm just missing something basic since LINQ, WPF and EF are all brand new to me.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["asp.net","asp.net-mvc","visual-studio","entity-framework","msdeploy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3,"score":0,"question_id":13298598,"title":"Upon one-click publish: Exception in executing publishing: An item with the same key has already been added","body":"<p>I realize that a billion people have asked about this error, but I've looked at all of them. Mine seems different. I'm not getting any sort of source code error, no stack trace, no helpful information whatsoever, because the error occurs immediately upon clicking \"Publish\" on my MVC.NET project. It's just a dialog box, and that's all it says. Nothing else happens.</p>\n\n<p>Things that might be related: </p>\n\n<ul>\n<li>I'm using Team Foundation. I had some trouble with it (user error)\nfor a while, but I just got everything back to the way it should be\n(I think).</li>\n<li>At one point I used an EDMX thing. I deleted in favor of making my table models from scratch.</li>\n<li>I can't find my publishing profile anymore, nor can I figure out how to make a new one. I thought it was supposed to be in a <code>~/PublishProfiles</code> folder. It's not there.</li>\n</ul>\n\n<p>I know I haven't given a lot of information, but I don't even know where to begin. I'll be happy to provide anything else upon request. Thank you.</p>\n"},{"tags":["sql","asp.net-mvc","vb.net","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":27,"score":2,"question_id":13297880,"title":"Sequence contains no elements - LINQ, MVC, Average","body":"<p>I am running into this error. I see that the reason is because the average returned at times is 0.00 which from a data stand point is accurate. This SQL query works fine, but that is because it puts in 0.00 automatically. </p>\n\n<p>LINQ complains and so I tried using DefaultIfEmpty() but it says it is expecting my ViewModel.</p>\n\n<pre><code>Dim ticketCounts = From t In queue _\n   Where _\n    (t.StatusId = 2) And _\n    (t.CloseDate.Year = Convert.ToDateTime(DateTime.Now).Year) And _\n    (t.ResolutionDays &gt; 0)\n   Group t By _\n    Column1 = CType(t.CloseDate.Month, Integer), _\n    Column2 = CType(t.CloseDate.ToString(\"MMMM\"), String) _\n    Into g = Group _\n   Order By Column1 _\n   Select _\n    Id = Column1, _\n    Month = Column2, _\n    Critical = g.Where(Function(t) t.PriorityId = 1).Average(Function(t) t.ResolutionDays), _\n    High = g.Where(Function(t) t.PriorityId = 2).Average(Function(t) t.ResolutionDays), _\n    Normal = g.Where(Function(t) t.PriorityId = 3).Average(Function(t) t.ResolutionDays), _\n    Low = g.Where(Function(t) t.PriorityId = 4).Average(Function(t) t.ResolutionDays), _\n    Total = g.Where(Function(t) t.Id &lt;&gt; Nothing).Average(Function(t) t.ResolutionDays)\n</code></pre>\n\n<p><strong>UPDATED!</strong>\nThis is the SQL query doing the same thing I need VB to do.</p>\n\n<pre><code>SELECT\n    DATENAME(MONTH,t.CloseDate) AS 'Month',\n    AVG(CASE WHEN (t.PriorityId = 1) THEN CAST(t.ResolutionDays AS Decimal(18, 2)) ELSE 0 END) AS 'Critical',\n    AVG(CASE WHEN (t.PriorityId = 2) THEN CAST(t.ResolutionDays AS Decimal(18, 2)) ELSE 0 END) AS 'High',\n    AVG(CASE WHEN (t.PriorityId = 3) THEN CAST(t.ResolutionDays AS Decimal(18, 2)) ELSE 0 END) AS 'Normal',\n    AVG(CASE WHEN (t.PriorityId = 4) THEN CAST(t.ResolutionDays AS Decimal(18, 2)) ELSE 0 END) AS 'Low',\n    AVG(CAST(t.ResolutionDays AS Decimal(18, 2))) AS 'Monthly Average'\nFROM\n    tblMaintenanceTicket t\nWHERE\n    t.StatusId = 2\n    AND YEAR(t.CloseDate) = year(getdate())\nGROUP BY \n    MONTH(t.CloseDate),\n    DATENAME(MONTH,t.CloseDate)\nORDER BY\n    MONTH(t.CloseDate)\n</code></pre>\n"},{"tags":["c#",".net","sql-server","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":19,"score":2,"question_id":13298310,"title":"Insert default value via EntityFramework","body":"<p>I have default constraint on my caption field in database. In web app if caption is empty NULL value passed to database and database returns exception because samo field it cannot be null (Caption varchar(50) NOT NULL).</p>\n\n<p>So, what is easiest way to set some value (\"\" - empty string) or avoid to send NULL to database if value is really not provided. How I can set that in EntityFrameowrk, or maybe in data access layer...?</p>\n"},{"tags":["sql-server","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13298293,"title":"Using a View with Entity Framework 5 Code First","body":"<p>I have created a SQL Server view which performs some reasonably complex logic on other tables/entities in my model and which exposes a series of columns. All but one of these columns are simple types (bigints, nvarchars etc) but one is a complex entity within my model.</p>\n\n<p>I have created an entity which maps to this view as follows:</p>\n\n<pre><code>public class NetworkSuppliersByClient : Entity, IKeyed&lt;long&gt;\n{\n    public long NetworkSuppliersByClientId { get; set; }\n\n    public long NetworkId { get; set; }\n    public String NetworkName { get; set; }\n    public long OwningClientId { get; set; }\n    public long ClientId { get; set; }\n    public virtual Supplier Supplier { get; set; }\n    public bool PublicEntry { get; set; }\n\n    public long GetKey ()\n    {\n        return NetworkSuppliersByClientId;\n    }\n}\n</code></pre>\n\n<p>As you can see, the Supplier entry maps to an existing entity within the model, itself being a complex type with other contained entities (aka tables).</p>\n\n<p>The issue that I have is that when I try to read from the view I get the error \"<strong><em>The entity type NetworkSuppliersByClient is not part of the model for the current context.</em></strong>\".</p>\n\n<p>However, when I try to register the entity with the context as a DbSet I get the error \"<strong><em>There is already an object named 'NetworkSuppliersByClients' in the database.</em></strong>\" as it tries to create a table with the same name as the already existing view.</p>\n\n<p>Is there any way around this, for example to inhibit EF from trying to create the table at startup, or is there a better way to read from a view?</p>\n"},{"tags":["entity-framework","entity-framework-4","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13257388,"title":"Multiple aggregates in linq to entities (code first)","body":"<p>Given the following model, I want to be able to retrieve the number of points gained for a single player and the average number of point gained for all players given a time period. This should be done in a single db query (I also want other stats e.g. avg points per team which will come later but the concept should be the same).</p>\n\n<p>Having a bad day and getting nowhere. Can someone help me out?</p>\n\n<pre><code>public class Player\n{\n    public int Id { get; set; }\n    public ICollection&lt;PlayerGame&gt; PlayerGames { get; set; }\n\n    ...\n}\n\npublic class PlayerGame\n{\n    public int Id { get; set; }\n\n    public int Points { get; set; }\n\n    public int PlayerId { get; set; }\n    public Player Player { get; set; }\n\n    public int GameId { get; set; }\n    public Game Game { get; set; }\n\n    ...\n}\n\npublic class Game\n{\n    public int Id { get; set; }\n\n    ...\n}\n</code></pre>\n\n<p>Edit:</p>\n\n<p>OK. Have taken the game entity out of the equation for now and changed your code to fit in with my repo. This is what I have now:</p>\n\n<pre><code>var query = from p in _playerRepository.Query()\n                        from pg in p.PlayerGames\n                        group new { p, pg } by 1 into ppg\n                        select new\n                        {\n                            SinglePlayerPointsGained = (from x in ppg\n                                                        where x.p.Id == playerId &amp;&amp; x.pg.Date &gt; startDateTime\n                                                        select x.pg.Points).Sum(),\n                            AveragePoints = (from x in ppg \n                                             where x.pg.Date &gt; startDateTime\n                                             select x.pg.Points).Average(),                            \n                        };\n</code></pre>\n\n<p>So Now I just need the AveragePoints calculation to take players that have not played in the period into account as mentioned in the comment.</p>\n"},{"tags":[".net","entity-framework","c#-4.0","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13295161,"title":"Is it possible to extent FluentApiMapper to set the default value ?","body":"<p>I'm using  EF 5 Code Fist and specifying some custom object to table mapping with the fluent API. Smth like this:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n  {\n   //Account Service\n   modelBuilder.Entity&lt;ACCOUNT&gt;().ToTable(\"ACCOUNT\", \"T70_AccountService\");\n    ...\n   modelBuilder.Entity&lt;ACCOUNT&gt;()\n     .Property(p =&gt; p.Created).HasColumnType(\"DateTime\")\n     .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Computed);\n</code></pre>\n\n<p>What I would like to be able to do is add an extetion that would allow to to add </p>\n\n<pre><code> .HasDefaultValue('(getdateutc()');\n</code></pre>\n\n<p>Is that possible ? Any ideas how ? </p>\n"},{"tags":["c#","sql-server","entity-framework","sql-server-ce"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13297827,"title":"Use same EDMX for different Databases (Local & Server)","body":"<p>I'm working on a project where I have a local database (SQL CE) which is used as sort of a buffer while no connection to the server exists. On the server I want to use the same database-layout.</p>\n\n<p>Of course I want to use the same EDMX-File which is in a Common.dll available on the Server and the Client.</p>\n\n<p>In the Client I have a connection string with provider=System.Data.SqlServerCe.3.5 while it is provider=System.Data.SqlClient on the server.</p>\n\n<p>My problem comes when I want to save sth on the Server-side: \"The provider manifest given is not of type 'System.Data.SqlClient.SqlProviderManifest'.\"</p>\n\n<p>Is there even a chance to use the same EDMX-File on both parts?\nOr is there any best practice how to handle such a constellation?</p>\n\n<p>Thank you for your help!</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13297387,"title":"Entity Framework - Fill remaining properties","body":"<p>I have a method that receives a Dto Model and map to a Domain Model:</p>\n\n<p>Method:</p>\n\n<pre><code>public void CreateAd(CreateAdDto adDto) { \n\n    var adDomain = Mapper.Map&lt;CreateAdDto, Ad&gt;(adDto);\n}\n</code></pre>\n\n<p>Dto Object:</p>\n\n<pre><code>public class CreateAdDto\n{\n    public int Model_Id { get; set; }\n}\n</code></pre>\n\n<p>The Dto map the Domain Model:</p>\n\n<pre><code>public class Ad\n{\n    public int Id { get; set; }\n    public Model Model { get; set; }\n}\n</code></pre>\n\n<p>And the Model:</p>\n\n<pre><code>public class Model\n{\n    // Primary properties\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string NameStandard { get; set; }\n}\n</code></pre>\n\n<p>I need to get in the CreateAd method access to the Model.NameStandard value, but when I do the mapping, I only have the Model Id, so how do I get the Model Entity with all the properties including the NameStandard value?</p>\n\n<p>Do I have to make a Call to the <strong>Model GetById(Model_Id)</strong> to get the Model properties or there is another way like a property in the Attach that can bring all the properties?</p>\n\n<p>Or Should I use the Model in the ViewModel and pass to the Dto and to the Domain with all the properties?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","sql-server","entity-framework","entity-framework-5","ef-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13296996,"title":"Entity Framework Migrations renaming tables and columns","body":"<p>I renamed a a couple entities and their navigation properties and generated a new Migration in EF 5. As is usual with renames in EF migrations, by default it was going to drop objects and recreate them. That isn't what I wanted so I pretty much had to build the migration file from scratch.</p>\n\n<pre><code>    public override void Up()\n    {\n        DropForeignKey(\"dbo.ReportSectionGroups\", \"Report_Id\", \"dbo.Reports\");\n        DropForeignKey(\"dbo.ReportSections\", \"Group_Id\", \"dbo.ReportSectionGroups\");\n        DropForeignKey(\"dbo.Editables\", \"Section_Id\", \"dbo.ReportSections\");\n        DropIndex(\"dbo.ReportSectionGroups\", new[] { \"Report_Id\" });\n        DropIndex(\"dbo.ReportSections\", new[] { \"Group_Id\" });\n        DropIndex(\"dbo.Editables\", new[] { \"Section_Id\" });\n\n        RenameTable(\"dbo.ReportSections\", \"dbo.ReportPages\");\n        RenameTable(\"dbo.ReportSectionGroups\", \"dbo.ReportSections\");\n        RenameColumn(\"dbo.ReportPages\", \"Group_Id\", \"Section_Id\");\n\n        AddForeignKey(\"dbo.ReportSections\", \"Report_Id\", \"dbo.Reports\", \"Id\");\n        AddForeignKey(\"dbo.ReportPages\", \"Section_Id\", \"dbo.ReportSections\", \"Id\");\n        AddForeignKey(\"dbo.Editables\", \"Page_Id\", \"dbo.ReportPages\", \"Id\");\n        CreateIndex(\"dbo.ReportSections\", \"Report_Id\");\n        CreateIndex(\"dbo.ReportPages\", \"Section_Id\");\n        CreateIndex(\"dbo.Editables\", \"Page_Id\");\n    }\n\n    public override void Down()\n    {\n        DropIndex(\"dbo.Editables\", \"Page_Id\");\n        DropIndex(\"dbo.ReportPages\", \"Section_Id\");\n        DropIndex(\"dbo.ReportSections\", \"Report_Id\");\n        DropForeignKey(\"dbo.Editables\", \"Page_Id\", \"dbo.ReportPages\");\n        DropForeignKey(\"dbo.ReportPages\", \"Section_Id\", \"dbo.ReportSections\");\n        DropForeignKey(\"dbo.ReportSections\", \"Report_Id\", \"dbo.Reports\");\n\n        RenameColumn(\"dbo.ReportPages\", \"Section_Id\", \"Group_Id\");\n        RenameTable(\"dbo.ReportSections\", \"dbo.ReportSectionGroups\");\n        RenameTable(\"dbo.ReportPages\", \"dbo.ReportSections\");\n\n        CreateIndex(\"dbo.Editables\", \"Section_Id\");\n        CreateIndex(\"dbo.ReportSections\", \"Group_Id\");\n        CreateIndex(\"dbo.ReportSectionGroups\", \"Report_Id\");\n        AddForeignKey(\"dbo.Editables\", \"Section_Id\", \"dbo.ReportSections\", \"Id\");\n        AddForeignKey(\"dbo.ReportSections\", \"Group_Id\", \"dbo.ReportSectionGroups\", \"Id\");\n        AddForeignKey(\"dbo.ReportSectionGroups\", \"Report_Id\", \"dbo.Reports\", \"Id\");\n    }\n</code></pre>\n\n<p>All I'm trying to do is rename <code>dbo.ReportSections</code> to <code>dbo.ReportPages</code> and then <code>dbo.ReportSectionGroups</code> to <code>dbo.ReportSections</code>. Then I need to rename the foreign key column on <code>dbo.ReportPages</code> from <code>Group_Id</code> to <code>Section_Id</code>.</p>\n\n<p>I am dropping the foreign keys and indexes linking the tables together, then I am renaming the tables and the foreign key column, then I'm adding the indexes and foreign keys again. I assumed this was going to work but I am getting a SQL error.</p>\n\n<blockquote>\n  <p>Msg 15248, Level 11, State 1, Procedure sp_rename, Line 215\n  Either the parameter @objname is ambiguous or the claimed @objtype (COLUMN) is wrong.\n  Msg 4902, Level 16, State 1, Line 10\n  Cannot find the object \"dbo.ReportSections\" because it does not exist or you do not have permissions.</p>\n</blockquote>\n\n<p>I'm not having an easy time figuring out what is wrong here. Any insight would be tremendously helpful.</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13176900,"title":"Entity Framework 4.2 code first fluent api mapping intermediate table","body":"<p>How do I setup the mapping for these table relationships using code first and the fluent api?  </p>\n\n<p>I have a poco for all three entities created but most people don't have a poco for the \"intermediate\" table (<em>PlanUser</em>) so I couldn't find a good example to go off of. I need to tell EF to map the <em>PlanUser.PlanCustomerId</em> column to <em>Plan.CustomerId</em> but it either doesn't return the right results OR as in the current setup the mapping for <em>Plan</em> throws the error: </p>\n\n<blockquote>\n  <p>\"The specified association foreign key columns 'CustomerId' are\n  invalid. The number of columns specified must match the number of\n  primary key columns.\"</p>\n</blockquote>\n\n<p><img src=\"http://i.stack.imgur.com/imkTe.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/d3w4L.png\" alt=\"enter image description here\"></p>\n\n<pre><code>public class PlanUserMap : EntityTypeConfiguration&lt;PlanUser&gt;\n{\n    public PlanUserMap()\n    {\n        this.ToTable(\"PlanUser\");\n        this.HasKey(c =&gt; new { c.CustomerId, c.PlanCustomerId });\n\n        this.HasRequired(c =&gt; c.Plan).WithMany().HasForeignKey(x =&gt; x.CustomerId).WillCascadeOnDelete(false);\n        this.HasRequired(c =&gt; c.Customer).WithMany().HasForeignKey(x =&gt; x.CustomerId).WillCascadeOnDelete(false);\n    }\n}\n\npublic class PlanMap : EntityTypeConfiguration&lt;Plan&gt;\n{\n    public PlanMap()\n    {\n        this.ToTable(\"Plan\");\n        this.HasKey(c =&gt; c.CustomerId);\n        // the below line returns only 1 row for any given customer even if there are multiple PlanUser rows for that customer\n        //this.HasMany(c =&gt; c.PlanUsers).WithRequired().HasForeignKey(c =&gt; c.PlanCustomerId); \n        // this throws an error\n        this.HasMany(c =&gt; c.PlanUsers).WithMany().Map(m =&gt; m.MapLeftKey(\"PlanCustomerId\").MapRightKey(\"CustomerId\"));\n    }\n}\n\npublic partial class CustomerMap : EntityTypeConfiguration&lt;Customer&gt;\n{\n    public CustomerMap()\n    {\n        this.ToTable(\"Customer\");\n        this.HasKey(c =&gt; c.Id);\n        this.HasMany(c =&gt; c.PlanUsers).WithRequired().HasForeignKey(c =&gt; c.CustomerId);\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>@Slauma, sql profiler shows these queries being executed. The second one should include customer id 43 in addition to customer id 1 but it does not. I don't know why its not retrieving that second row.</p>\n\n<pre><code>exec sp_executesql N'SELECT \n[Extent1].[CustomerId] AS [CustomerId], \n[Extent1].[PlanCustomerId] AS [PlanCustomerId], \n[Extent1].[CreatedOnUtc] AS [CreatedOnUtc], \n[Extent1].[IsSelected] AS [IsSelected], \n[Extent1].[IsDeleted] AS [IsDeleted], \n[Extent1].[AccessRights] AS [AccessRights]\nFROM [dbo].[PlanUser] AS [Extent1]\nWHERE [Extent1].[CustomerId] = @EntityKeyValue1',N'@EntityKeyValue1 int',@EntityKeyValue1=43\n\nexec sp_executesql N'SELECT \n[Extent1].[CustomerId] AS [CustomerId], \n[Extent1].[Name] AS [Name], \n[Extent1].[PlanTypeId] AS [PlanTypeId], \n[Extent1].[OrderId] AS [OrderId], \n[Extent1].[CreatedOnUtc] AS [CreatedOnUtc], \n[Extent1].[IsActive] AS [IsActive]\nFROM [dbo].[Plan] AS [Extent1]\nWHERE [Extent1].[CustomerId] = @EntityKeyValue1',N'@EntityKeyValue1 int',@EntityKeyValue1=1\n</code></pre>\n\n<p>Here is the C# code that causes the queries to execute:</p>\n\n<pre><code>    public List&lt;Plan&gt; GetPlans()\n    {\n        List&lt;Plan&gt; plans = new List&lt;Plan&gt;();\n\n        // add each plan they have access rights to to the list\n        foreach (var accessiblePlan in Customer.PlanUsers)\n        {\n            plans.Add(accessiblePlan.Plan);\n        }\n\n        return plans;\n    }\n</code></pre>\n"},{"tags":["c#","asp.net-mvc","entity-framework","jqgrid"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13274096,"title":"Good programming principles while using EF/Code First/Repository Pattern/Table Per Type (TPT)?","body":"<p>Just curious.</p>\n\n<p>Say I have a Base entity and I'm deriving about 10 different child entities from it using the Table Per Type method. I also have a generic repository which can fetch me data from each of these child entities. I eventually want to map each of the child entities to a separate view model and link each of the view models to its own grid (JqGrid) on my website, with each grid having its own Create, Read, Update, Delete methods. I can do all of that, but I'm not sure what's the proper way to go about it while keeping code to a minimum.</p>\n\n<p>Right now, I have every field defined (from both the parent and child entity) in each of my view models. Is it better to have a \"parent\" view model and then deriving the child view models from it in order to mimic the inheritance structure of the entities? I wouldn't think so....having inheritance in view models doesn't make much sense to me.</p>\n\n<p>Also, I really don't want to duplicate CRUD operations for each grid. Is that considered good practice? Should each view model have its own set of CRUD operations in this case?</p>\n\n<p>Take 'Read' for instance. I'm basically returning JSON data based on the ID (key) field of the view model for each grid. And since all grids will have this ID column (part of the parent entity), should I only have one function that takes care of this for all grids? Should I be using reflections? Should I be making use of polymorphic properties of the parent/child entities?</p>\n\n<p>Or is it better to keep these operations separate for each grid?</p>\n\n<p>Hmmm..</p>\n"},{"tags":["c#","linq","entity-framework","casting"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":125,"score":4,"question_id":13276806,"title":"Converting from IEnumerable<IEnumerable<string>> to ICollection<T>","body":"<p>I'm trying to convert an <code>IEnumerable&lt;IEnumerable&lt;string&gt;&gt;</code> to <code>ICollection&lt;Character&gt;</code> but struggling to figure out the right way to do it since the structure of one object is different than the structure of the other.</p>\n\n<p>The reason for conversion is to take a json deserialization and insert that into a database via Entity Framework. The json data isn't normalized and doesn't match the exact structure of the database. In the database I have a <code>movie</code> and a <code>person</code> that have a many-to-many relationship. The bridge table between them is <code>characters</code>. But the json just has a movie object with an array of people objects and each person with an array of the characters they play (<code>IEnumerable&lt;IEnumerable&lt;string&gt;&gt;</code>).</p>\n\n<p>Basically, I need to convert each movie's people and their characters to each movie's character and its respective person.</p>\n\n<pre><code>var movie = dataContractMovies.Select(m =&gt; new Movie {\n    Title = m.Title,\n    // not sure how to convert each Person and their characters\n    Characters = // Need to take each Person and their Characters in m.Cast and cast to a new Character and a new Person for which the Character belongs to\n});\n</code></pre>\n\n<p><strong>Convert From</strong></p>\n\n<pre><code>public class MovieDataContract {\n    [DataMember(Name = \"title\")]\n    public string Title { get; set; }\n\n    [DataMember(Name = \"abridged_cast\")]\n    public virtual IEnumerable&lt;Person&gt; Cast { get; set; }\n}\n\n[DataContract]\npublic class Person {\n    [DataMember(Name = \"name\")]\n    public string Name { get; set; }\n\n    [DataMember(Name = \"characters\")]\n    public IEnumerable&lt;string&gt; Characters { get; set; }\n} \n</code></pre>\n\n<p><strong>Convert To</strong></p>\n\n<pre><code>public partial class Movie {\n    public string Title { get; set; }\n    public virtual ICollection&lt;Character&gt; Characters { get; set; }\n\n    public Movie() {\n        this.Characters = new HashSet&lt;Character&gt;();\n    }\n}\n\npublic partial class Character {\n    public string Name { get; set; }\n    public virtual Movie Movie { get; set; }\n    public virtual Person Person { get; set; }\n}\n\npublic partial class Person {\n    public string Name { get; set; }\n    public virtual ICollection&lt;Character&gt; Characters { get; set; }\n\n    public Person() {\n        this.Characters = new HashSet&lt;Character&gt;();\n    }\n}\n</code></pre>\n\n<p><strong>UPDATE AND FURTHER QUESTION</strong></p>\n\n<p>What if I just added a <code>public IEnumerable&lt;Character&gt; Characters</code> to the <code>MovieDataContract</code>? Then I could just do something like this (in theory, haven't tested)...</p>\n\n<pre><code>Characters = m.Characters;\n</code></pre>\n\n<p>So my new <code>MovieDataContract</code> would look like this...</p>\n\n<pre><code>[DataContract]\npublic class MovieDataContract {\n    [DataMember(Name = \"title\")]\n    public string Title { get; set; }\n\n    [DataMember(Name = \"abridged_cast\")]\n    private IEnumerable&lt;Person&gt; _cast { get; set; }\n\n    public IEnumerable&lt;Character&gt; Characters { \n        get{  \n            foreach(var person in _cast) {\n                foreach(string name in person.characters) {\n                    yield return new Character { Name = name, Person = new Person { Name = person.name }}\n                }\n            }\n        } \n    }\n}\n</code></pre>\n"},{"tags":["entity-framework","orm","business-objects","data-access"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":690,"score":1,"question_id":2208249,"title":"Entity Framework on a database without foreign keys","body":"<p>I'm currently working with a large database (approx. 500 tables) all without any foreign keys define. </p>\n\n<p>My question is there an easy way to set up the relationships within entity framework (version 1 or 2) without doing it all manually?</p>\n\n<p>Also some of the tables have a complex relationship type. For example a customer has a parentID but this can either link to another customer in the same table (customerID) or link to an account in an account table (accountID). Is this kind of relationship possible in entity framework?</p>\n\n<p>If this is not possible or if anyone has any opinions on an alternative solution to Enitity Framework I'm more than open to ideas. Will nHibernate or active record be a better solution? Or will it be easier creating my own business object and data access?</p>\n\n<p>Cheers</p>\n\n<p>Simon</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13294780,"title":"EF 5 Code First DbMigration automation","body":"<p>I'm using EF 5 with the Code First Approach.</p>\n\n<p>I'm having trouble setting the default <code>DateTime</code> value of a column to a <code>(getdateutc())</code></p>\n\n<p>What I want to do is have EF set up tables with this value speficied, and the only way I've found that it's possible is to use <code>DbMigrations</code> (Up and Down methods). Are the any other ways ? </p>\n\n<p>I have a base class looking like this</p>\n\n<pre><code> public abstract class BASE_AUDITED : BASE\n {              \n      [IgnoreDataMember, IgnoreMap]\n      public DateTime Created { get; set; }\n\n      [IgnoreDataMember, IgnoreMap]\n      public DateTime Modified { get; set; }\n\n      [MaxLength(50)]\n      [IgnoreDataMember, IgnoreMap]\n      public string CreatedBy { get; set; }\n\n      [MaxLength(50)]\n      [IgnoreDataMember, IgnoreMap]\n      public string ModifiedBy { get; set; }\n }\n\n public abstract class BASE \n {\n      [IgnoreMap]\n      public int id { get; set; }\n }\n</code></pre>\n\n<p>And a bunch of classes inheriting from it.\nWhat I'd like to do is be able to access the model (using <code>fluentAPI</code> for mapping)in the DBMigrations Up method, and write a loop there to take care of all the the objects inheriting from <code>Base_audited</code></p>\n\n<p>In other words I'm trying to avoid writing following code for each and every object I add, </p>\n\n<pre><code>AlterColumn(\"T70_AccountService.CONTACT\", \"TestClmn\", c =&gt; c.DateTime(nullable: false, defaultValueSql: \"(getutcdate())\"));\n</code></pre>\n\n<p>But rather have smth like this </p>\n\n<pre><code> var types = ReflectionHelper.TypesImplementingInterface(typeof (BASE_AUDITED));\n            foreach (var type in types)\n            {\n               var tableName = Context.FindTableNameFor(type);\n               AlterColumn(tableName , \"Created\", c =&gt; c.DateTime(nullable: false, defaultValueSql: \"(getutcdate())\"));\n               AlterColumn(tableName , \"Modified\", c =&gt; c.DateTime(nullable: false, defaultValueSql: \"(getutcdate())\"));\n\n            }\n</code></pre>\n\n<p>In short - I cannot find what table is the object mapped to in the DbMigrations Up method..</p>\n\n<pre><code> var tableName = Context.FindTableNameFor(type);\n</code></pre>\n"},{"tags":["c#","entity-framework","nunit","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12882826,"title":"Why am I getting DbContext Has Changed exception when using NUnit?","body":"<p>I'm using Entity Framework 5 in my project. And I wanted to test some new funcionalities.</p>\n\n<p>What happened is that eventhough my db is UPDATED, (when I add a migration it does not add anything else) and eventhough if I run my project it runs just fine. When I try to test the project with NUNIT I get this exception:</p>\n\n<p><code>System.InvalidOperationException : The model backing the 'DbContext' context has changed since the database was created. Consider using Code First Migrations to update the database</code></p>\n\n<p>Has any of you have this problem? If so how can I solve it?</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":8,"score":1,"question_id":13294183,"title":"Insert and update merge using EF","body":"<p>I am using sql azure as storage. </p>\n\n<p>I have a data set (list of entities) which has both new and old records. I have no way to identify which record is for update or insert. I need a way using EF to send the whole  thing to db, using some statement which will identity what to do with it (meaning update or insert)</p>\n\n<p>I have been able to find merge using object context but it doesn't fit my purpose. </p>\n\n<p>If anything is unclear, please ask. </p>\n"},{"tags":["c#","wcf","silverlight","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13294329,"title":"Error when start silverlight project","body":"<p>Error   1   Failed to get the MetadataWorkspace for the DbContext type 'RIAServicesLibraryTask.Web.Models.CityDbContext'.   RIAServicesLibraryTask (RIAServicesLibraryTask\\RIAServicesLibraryTask)</p>\n\n<p>I have got this error when I try to create project example from article \n<a href=\"http://www.codeproject.com/Articles/354715/Creating-a-WCF-RIA-Services-Class-Library-for-a-Si\" rel=\"nofollow\">http://www.codeproject.com/Articles/354715/Creating-a-WCF-RIA-Services-Class-Library-for-a-Si</a>\nI have own mssql server, config web.config RIAServicesLibraryTask.Web, and asp.net config web file. \nI use vs 2012 and get few libs from article project.\nThe problem is that I cannot understand how to fix or debug this problem. May be eny tell me how to show in browser silverlight error.\nSource files :\n<a href=\"http://depositfiles.com/files/c391j5zm1\" rel=\"nofollow\">http://depositfiles.com/files/c391j5zm1</a></p>\n"},{"tags":["linq","entity-framework","logging","linq-to-entities","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13278294,"title":"EF Tracing Provider determining calling method, or entity being queried","body":"<p>I've gotten the EFTracingProvider to work with my code first application, but when logging, my application tries to log the calling class.  Since my context is always where the EFTracing Provider resides, that is what's getting stored in the calling class, even though the actual attempt to reference the entity happened in another class.</p>\n\n<p>Is there anyway to either track where the actual call happened, or to track which entity or DBSet in the context was trying to be accessed, which then caused the Tracing to fire?</p>\n"},{"tags":["asp.net-mvc","linq","entity-framework","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13292112,"title":"Hierarchical data & LINQ - best practices","body":"<p>Imagine a situation when you have a table with users, in which our users have a hierarchical structure.</p>\n\n<pre><code>[Key]\npublic virtual int UserId { get; set; }\n\npublic virtual UserProfile UserParent { get; set; }\npublic virtual int? UserParentId { get; set; }\npublic virtual String UserName { get; set; }\n</code></pre>\n\n<p>Place the sample data there:</p>\n\n<p><strong>UserId UserParentId UserName</strong></p>\n\n<ul>\n<li>1 | null | Boss</li>\n<li>2 | 1 | Manager Diana</li>\n<li>3 | 2 | Worker Sam</li>\n<li>4 | 2 | Worker Bob</li>\n<li>5 | 1 | Manager Wong</li>\n<li>6 | 5 | Worker Lu</li>\n</ul>\n\n<p>Assign each user a shovel :P</p>\n\n<pre><code>[Key]\npublic virtual int ShovelId { get; set; }\n\npublic virtual string ShovelSerialNumber { get; set; }\npublic virtual int UserId { get; set; }\n</code></pre>\n\n<p>Place the sample data there:</p>\n\n<p><strong>ShovelId ShovelSerialNumbe UserId</strong></p>\n\n<ul>\n<li>1 | 12345BK | 3</li>\n<li>2 | 99999ZK | 4</li>\n<li>3 | 88888KP | 6</li>\n</ul>\n\n<p>The purpose of all this is get the serial number of shovels, with hierarchical query on the users table. Boss will see all the shovels, but only shovels Manages subordinate employees.</p>\n\n<p>Any ideas and tips on how to achieve this in LINQ, taking into account that there may be several thousand employees and several thousand shovels, and do not know the depth of the depression hierarchy.</p>\n\n<p>Thx for help.</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13292825,"title":"Getting Entity Framework to cascade-delete when re-attaching modified entity","body":"<p>I'm developing a website using MVC4 with EF code first approach.</p>\n\n<p>I have some problems with deleting the children in entities with one to many relations.\nThe entity relations are set up so that when removing a child entity from the parent collection, the child entity is also deleted from the child table (cascade delete?), and this works.\nHowever, when a child is removed from the parent collection in the view, EF does not delete the child in the database when re-attaching and saving the parent entity in the controller method.</p>\n\n<p>How can this be solved??</p>\n\n<p>The entities are:</p>\n\n<pre><code>class Parent\n{\n   public virtual ICollection&lt;Child&gt; Children {get;set;}\n}\nclass Child\n{\n   pubic string Text { get;set; }\n}\n</code></pre>\n\n<p><strong>This works and will remove child from database</strong>:</p>\n\n<pre><code>void RemoveChildFromCollection()\n{\n   // get the first parent and remove the forts collection\n   var context = new DatabaseContext();\n   var parent = context.Parents.First();\n   parent.Children.Remove(parent.Children.First());\n   context.SaveChanges();\n}\n</code></pre>\n\n<p>ControllerMethod: <strong>when children have been created/updated in the view, the database is updated, but removed children are not removed from the childrens table</strong></p>\n\n<pre><code>public ActionResult Edit(Parent parent)\n{\n   var context = new DatabaseContext();\n   context.Entry(parent).State = System.Data.EntityState.Modified;\n   context.SaveChanges();\n   return View();\n}\n</code></pre>\n\n<p>The modelbuilder are setup to delete child entity from child table when removing them from parent collection</p>\n\n<pre><code>// Use Identifying relation. Define complex key for ChildObject containing both Id and \n\n    ParentObjectId\n    modelBuilder.Entity&lt;Child&gt;()\n    .HasKey(c =&gt; new {c.ChildID, c.ParentID});\n\n// Because defining such key will remove default convention for auto incremented Id you must redefine it manually\n\n    modelBuilder.Entity&lt;Child&gt;()\n    .Property(c =&gt; c.ChildID)\n    .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n\n// Set cascade delete\n\n    modelBuilder.Entity&lt;Parent&gt;()\n    .HasMany(p =&gt; p.Children)\n    .WithRequired()\n    .HasForeignKey(c =&gt; c.ParentID)\n    .WillCascadeOnDelete();\n</code></pre>\n"},{"tags":["wpf","entity-framework","reportviewer","rdlc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":254,"score":1,"question_id":9878727,"title":"wpf reportviewer EF","body":"<p>Looked all day for a tutorial for a WPF app with a RDLC report using Entity Framework with no luck.\nFound a good tutorial only with SQLCLient <a href=\"http://kishor-naik-dotnet.blogspot.com/2011/06/wpf-rdlc-report-in-wpf.html\" rel=\"nofollow\">link</a>\nThe strange thing is that in my WPF app my ReportViewer doesn't have a smart tag <a href=\"http://weblogs.asp.net/blogs/rajbk/image_thumb_786BD626.png\" rel=\"nofollow\">photo</a></p>\n\n<p><strong>Q:</strong> How can I populate with data a rdlc report using EF ?</p>\n"},{"tags":["asp.net-mvc","entity-framework","windows-8"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13292339,"title":"Asp.net cannot perform runtime binding on null reference on viewBag","body":"<p>I have an enum that belongs to a model which I am trying to assign a new value to from a dropdown list in the parent models ~/Create.</p>\n\n<pre><code>public ActionResult Create(RecipeIngredient recipeingredient)\n    {\n        ingredientType myNewType = new ingredientType();\n        if (ModelState.IsValid)\n        {\n            db.RecipeIngredients.Add(recipeingredient);\n            recipeingredient.ingredientType = myNewType;\n            db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n        ViewBag.recipeID = new SelectList(db.Recipes, \"recipeID\", \"Name\", recipeingredient.recipeID);\n        ViewBag.ingredientID = new SelectList(db.Ingredients, \"ingredientID\", \"Name\", recipeingredient.ingredientID);\n\n        ViewData[\"ingredientList\"] = ingredientEnumList();\n        ViewBag.myNewType.value = new SelectList((System.Collections.IList)ViewData[\"ingredientList\"], \"Value\", \"Text\", recipeingredient.ingredientType.value);\n        return View(recipeingredient);\n    }\n</code></pre>\n\n<p>And some view Code:</p>\n\n<pre><code>    &lt;div class=\"editor-label\"&gt;\n         Select Type\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.DropDownList(\"myDropDown\", new SelectList((System.Collections.IList)ViewData[\"ingredientList\"],\"Value\", \"Text\"))\n    &lt;/div&gt;\n</code></pre>\n\n<p>As you can see, I create a new ingredientType and then try assign the selected value in a similar fashion to recipeID and ingredientID, this fails however.</p>\n"},{"tags":["sql-server","entity-framework","code-first","sql-server-2008-express"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13292002,"title":"SQL Server Express Entity Framework code-first","body":"<p>I Tried to use the code first approach to create my database \nI created every class that I needed and then added a web form to my project and a grid view to it. then I tried to set the grid view's data source to the data base. when I want to Choose a new connection it actually finds my database automatically named \"TimeTrackerDbContext\" but when I hit next I get this error : \n\"Database Schema Could not be retrieved for this connection. A network related or instance-specific error occured while establishing a connection to sql server. the server was not found or was not accessible. verify that the instance name is correct and that sql server is configured to allow remote connections. (provider: Named Pipes Provider, error:40 - Could not open a connection to SQL Server)\nat DataObjectSupport(422,6)\"</p>\n\n<p>my connection strings section in web.config is:\n\"name=\"TimeTrackerDbContext\" connectionString=\"server=./SqlExpress;integrated security=SSPI; database =TimeTracker\" providerName=\"System.Data.SqlClient\"</p>\n\n<p>and I use win 8. \nCan you help?</p>\n"},{"tags":["c#","entity-framework","linq-to-entities","expression-trees"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13292123,"title":"Filter using Expression Trees","body":"<p>I need to query database and filter based on parameters passed into the function.  I am passing two date parameters (used as a date range), a name, and a status parameters.  All the parameters can have 'and' or 'or' conditions.  Basically, I would like to build an linq expression based on which parameters are populated and pass it to Entity Framework to return a result set.</p>\n\n<p>How can I do this with minimum 'if' statements?  If you could be kind enough to provide an explanation with your example code, that would be awesome.  I am trying to learn expression trees so an explanation would help.</p>\n\n<p>At this point I don't have much code.  That is why I have posted here.  I can list the method signature.  What exactly are you looking for?</p>\n\n<pre><code>public enum EmployeeStatus\n{\n    FullTime,\n    PartTime,\n    Contract\n}\n\npublic IEnumerable&lt;Employee&gt; FilterEmployees(DateTime? startDate, \n    DateTime? endDate, string employeeName, EmployeeStatus employeeStatus)\n{   }\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":442,"score":1,"question_id":9367688,"title":"Output parameter with Entity Framework","body":"<p>I'm using EF in my MVC project. In my project I need to use stored procedures. My problem is to use output parameter with stored procedures. I have no idea how to do that</p>\n"},{"tags":["asp.net-mvc","visual-studio","entity-framework","projects-and-solutions"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13290973,"title":"Splitting an Empty Solution into multiple projects","body":"<p>I created a Black Solution (Arhi) with a ASP.NET MVC 4 Internet project (Arhi.Core) and Class library project for data (Arhi.Data) where I'm storing my EDMX Model.</p>\n\n<p>I added a reference for Arhi.Data into Arhi.Core and I tried to add a Controller with a Model class from Arhi.Data (People entity) and I got this error.</p>\n\n<blockquote>\n  <p>'Unable to retrive metadata for 'Arhi.Core.People'. The specified\n  named connection is either not found in the configuration, not\n  inteneded to be used with the EntityClient provider, or not valid.'</p>\n</blockquote>\n\n<p><strong>Q</strong> : Why did I get this error ? Is my approach wrong / any recommendations?\nQ2 : If I want to add RDLC reports to my solution, should I also use a Class Library project ?</p>\n\n<p>Connection string from Arhi.Core</p>\n\n<pre><code>&lt;add name=\"DefaultConnection\" providerName=\"System.Data.SqlClient\" connectionString=\"Data Source=.\\SQLEXPRESS;Initial Catalog=aspnet-SalvamontMVC-20121108140556;Integrated Security=SSPI\" /&gt;\n</code></pre>\n\n<p>and Arhi.Data</p>\n\n<pre><code>&lt;add name=\"SalvamontEntities\" connectionString=\"metadata=res://*/ModelSalva.csdl|res://*/ModelSalva.ssdl|res://*/ModelSalva.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=www.arhimedes.ro,1433;initial catalog=Salvamont;persist security info=True;user id=sa;password=********;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13286351,"title":"EF - Can not delete an object","body":"<p>Why does this code not work? It inserts an object but does not delete it </p>\n\n<pre><code>public int Toggle(RequestArchive RequestArchiveObj)\n{\n   var ra = DataContext.RequestArchives.Where(rec =&gt; rec.UserId == RequestArchiveObj.UserId &amp;&amp; rec.RequestId == RequestArchiveObj.RequestId);\n\n   if(ra.Count() &gt; 0)\n   {\n        foreach (var item in ra)\n        {                    \n            DataContext.DeleteObject(item);\n        }\n   }\n   else\n   {\n        DataContext.AddToRequestArchives(RequestArchiveObj);\n   }\n\n   DataContext.SaveChanges();\n   return RequestArchiveObj.Id;\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","linq","entity-framework","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13278891,"title":"Complex SQL to LINQ to populate Grid (Count items year by month) (MVC, EF Code First)","body":"<p>I have a grid that I want to fill with the following:</p>\n\n<p>It is tracking tickets that have been open each month for the last year. The grid is filtered by priority so I have a something like this:</p>\n\n<pre><code>| Mon | Critical | High | Tot |\n| Jan |    5     |  2   |  7  |\n| Feb |    2     |  3   |  5  |\n</code></pre>\n\n<p>This is my SQL statement:</p>\n\n<pre><code>SELECT\n    MONTH(CreateDate),\n    DATENAME(MONTH,m.CreateDate) AS 'Month',\n    SUM(CASE WHEN (m.PriorityId = 1) THEN 1 ELSE 0 END) AS 'Critical',\n    SUM(CASE WHEN (m.PriorityId = 2) THEN 1 ELSE 0 END) AS 'High',\n    SUM(CASE WHEN (m.PriorityId = 3) THEN 1 ELSE 0 END) AS 'Normal',\n    SUM(CASE WHEN (m.PriorityId = 4) THEN 1 ELSE 0 END) AS 'Low',\n    SUM(CASE WHEN (m.PriorityId = 5) THEN 1 ELSE 0 END) AS 'Not Ready',\n    Count(m.Id) AS Total\nFROM\n    [projects].[dbo].[tblMaintenanceTicket] m\nINNER JOIN\n    [projects].[dbo].[tblPriority] p\nON\n    p.Id = m.PriorityId\nWHERE\n    StatusId = 1\n    AND YEAR(CreateDate) = year(getdate())\nGROUP BY \n    MONTH(CreateDate),\n    DATENAME(MONTH,m.CreateDate)\nORDER BY\n    MONTH(CreateDate)\n</code></pre>\n\n<p>I am looking to convert this in VB LINQ but I am not sure this is the best method. I am also thinking calling a stored procedure, but I want to stay out of the DB really. I am using MVC 3 with the repository pattern, so calling my code is something like this output for JSON:</p>\n\n<pre><code>Dim tickets = ticketRepo.GetAll().Include(Function(p) p.Priority).ToArray()\n</code></pre>\n\n<p>Any assistance?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13289921,"title":"Table attribute displayed","body":"<p>I use Entity Framework in my project.</p>\n\n<pre><code>[Table(\"GetInfo\")]\npublic class InDetails : IEntityWithRelationships\n{\n    [Required]\n    [Key]\n    [Display(Name = \"Primary Key\", Description = \"Primary Key\")]\n    [Editable(false)]\n    [DatabaseGenerated(System.ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)]\n    public long Pkey { get; set; }\n\n    [Required]\n    [Display(Name = \"Facility ID\", Description = \"Facility ID is located at\")]\n    public int FacilityID { get; set; }\n\n    public String Photo { get; set; }\n</code></pre>\n\n<p>You see some have [Required]/[Displayed], but some not.\nWhat is the difference?</p>\n"},{"tags":["asp.net-mvc","entity-framework","entity-framework-4","entity-framework-4.1","entity-relationship"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12720611,"title":"Cant Add controller which uses Class which is inherited from other class","body":"<p>I'm using Entity Framework and MVC3, and my problem is that I can't scaffold Controllers if the class inherits from another Class.</p>\n\n<p>Example:</p>\n\n<p>This is Base Class</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\n\n    namespace CRMEntities\n    {\n        public partial class Company\n        {\n            public int Id { get; set; }\n        }\n\n    }\n</code></pre>\n\n<p>This is Lead Class (Child)</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\n\nnamespace CRMEntities\n{\n    public partial class Lead : Company\n    {\n        public Lead()\n        {\n            this.Status = 1;\n            this.IsQualified = false;\n\n        }\n\n        public Nullable&lt;short&gt; Status { get; set; }\n        public Nullable&lt;bool&gt; IsQualified { get; set; }\n\n\n    }\n\n\n}\n</code></pre>\n\n<p>When I tried to add controller below error comes...</p>\n\n<p><img src=\"http://i.stack.imgur.com/o1uua.jpg\" alt=\"enter image description here\"></p>\n\n<p>Context Class COde</p>\n\n<pre><code>using System;\nusing System.Data.Entity;\nusing System.Data.Entity.Infrastructure;\n\nnamespace CRMEntities\n{\n    public partial class CRMWebContainer : DbContext\n    {\n        public CRMWebContainer()\n            : base(\"name=CRMWebContainer\")\n        {\n        }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            throw new UnintentionalCodeFirstException();\n        }\n\n        public DbSet&lt;Employee&gt; Employees { get; set; }\n        public DbSet&lt;Contact&gt; Contacts { get; set; }\n        public DbSet&lt;Product&gt; Products { get; set; }\n        public DbSet&lt;Location&gt; Locations { get; set; }\n        public DbSet&lt;Task&gt; Tasks { get; set; }\n        public DbSet&lt;EventInfo&gt; EventInfoes { get; set; }\n        public DbSet&lt;Opportunity&gt; Opportunities { get; set; }\n        public DbSet&lt;Comment&gt; Comments { get; set; }\n        public DbSet&lt;Document&gt; Documents { get; set; }\n        public DbSet&lt;LoginInformation&gt; LoginInformations { get; set; }\n        public DbSet&lt;CRMLog&gt; CRMLogs { get; set; }\n        public DbSet&lt;EntitySharing&gt; EntitySharings { get; set; }\n        public DbSet&lt;EntityFlagging&gt; EntityFlaggings { get; set; }\n        public DbSet&lt;EntityTagging&gt; EntityTaggings { get; set; }\n        public DbSet&lt;EntitySubscribing&gt; EntitySubscribings { get; set; }\n        public DbSet&lt;Compapny&gt; Compapnies { get; set; }\n    }\n}\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4.1","connection-string","database-first"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1282,"score":3,"question_id":7944596,"title":"Entity Framework cant use the DbContext, model being created","body":"<p>I am using EF 4.1, and I create a normal EF edmx file. \nI generate it from a DB. </p>\n\n<p>When it's been generated I rightclick and select add code generation item, to generate new classes, and use the DbContext instead. I use the template DbContext generator. </p>\n\n<p>Everything works fine. </p>\n\n<p>Then I trie to query the context:</p>\n\n<pre><code>using (var context = new PasDBEntities())\n{\n    var client=context.ClientCompanies.SingleOrDefault(_=&gt;_.ID==clientCompanyId);\n    if(client!=null)\n</code></pre>\n\n<p>I have no problem creating a new instance of the context but when I try to query it the problem occur. I get stuck on the UnintentionalCodeFirstException.\nAnd gets the error: </p>\n\n<blockquote>\n  <p>{\"Code generated using the T4 templates for Database First and Model First development may not work correctly if used in Code First mode. To continue using Database First or Model First ensure that the Entity Framework connection string is specified in the config file of executing application. To use these classes, that were generated from Database First or Model First, with Code First add any additional configuration using attributes or the DbModelBuilder API and then remove the code that throws this exception.\"}</p>\n</blockquote>\n\n<p>I don't want to use code first, but I don't know if I can \"switch\" it off, or where the problem is. </p>\n\n<p>For reference, here is my constructor ...</p>\n\n<pre><code>public partial class PasDBEntities : DbContext\n{\n    public PasDBEntities()\n        : base(\"PasDBEntities\")\n    {\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        throw new UnintentionalCodeFirstException();\n    }\n</code></pre>\n\n<p>...and connection string:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"PasDBEntities\" \n         connectionString=\"metadata=res://*/PasDB.csdl|\n                                    res://*/PasDB.ssdl|\n                                    res://*/PasDB.msl;\n                           provider=System.Data.SqlClient;\n                           provider connection string=&amp;quot;\n                           data source=localhost;\n                           initial catalog=PasDB;\n                           integrated security=True;\n                           pooling=False;\n                           multipleactiveresultsets=True;\n                           App=EntityFramework&amp;quot;\"\n         providerName=\"System.Data.EntityClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n"},{"tags":["c#","asp.net","visual-studio-2010","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13288673,"title":"Adding new item with EF with identity column","body":"<p>How can I add a new entity with EF where I have <code>Id</code> column which is defined as <code>identity</code> in the database ?</p>\n\n<p>I get the following error:</p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table 'AppsData'\n  when IDENTITY_INSERT is set to OFF.</p>\n</blockquote>\n\n<p>But I cannot set the <code>Id</code> to null, as it's an <code>int</code> in the database (not even nullable)</p>\n\n<p>My function is:</p>\n\n<pre><code>    public Conduit.Mam.MaMDBEntityFramework.AppsData Add(Conduit.Mam.MaMDBEntityFramework.AppsData item)\n    {   \n        maMdbEntities.AddToAppsDatas(item);\n\n        maMdbEntities.SaveChanges();\n\n        return item;\n    } \n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework","skip-take"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":173,"score":2,"question_id":11103115,"title":"Take and Skip in SQL Server and EF","body":"<p>I have a ASP.NET MVC 4 application and I'm using EF. I have a table and a SQL view(the view displays rows from this table plus some unimportant data(~ 1000 records)) with ~ 400.000 records.\nWhen I display the data in EF it takes 25 seconds</p>\n\n<pre><code>    MVCAppEntities db = new MVCAppEntities();\n    public ActionResult Index()\n    {\n        return View(db.vvItem.OrderBy(n =&gt; n.Code).Skip(20).Take(40).ToList());\n    }\n</code></pre>\n\n<p>In SQL Server Management Studio this query takes 0-1 seconds</p>\n\n<pre><code>select  code, quantity, name, price\nfrom (\n    select *,\n           row_number() over(order by code) as rn\n    from vvItem       \n ) as T\nwhere T.rn between 20 and 40\n</code></pre>\n\n<p><strong>Q</strong> : Why is the EF query so slow ? should I make a SP to do the Skip and Take ?</p>\n"},{"tags":["c#","linq","entity-framework","backbone.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13278201,"title":"Linq Query to group Parent and respective child rentities","body":"<p>Here are my classes:</p>\n\n<pre><code>class Country\n{\n    public Country()\n    {\n        States = new List&lt;State&gt;();\n    }\n\n    public int Id { get; set; }\n    public int Name { get; set; }\n\n    public virtual ICollection&lt;State&gt; States  { get; set; }\n}\n\nclass State\n{\n    public State()\n    {\n        Counties = new List&lt;County&gt;();\n    }\n\n    public int Id { get; set; }\n    public int Name { get; set; }\n    public int CountryID { get; set; }\n\n    [ForeignKey(\"CountryID\")]\n    public virtual Country Country { get; set; }\n\n    public virtual ICollection&lt;County&gt; Counties { get; set; }\n}\n\nclass County\n{\n    public County()\n    {\n        Cities = new List&lt;City&gt;();\n    }\n\n    public int Id { get; set; }\n    public int Name { get; set; }\n    public int StateID { get; set; }\n\n    [ForeignKey(\"StateID\")]\n    public virtual State State { get; set; }\n\n    public virtual ICollection&lt;City&gt; Cities { get; set; }\n}\n\nclass City\n{\n    public int Id { get; set; }\n    public int Name { get; set; }\n    public int CountyID { get; set; }\n\n    [ForeignKey(\"CountyID\")]\n    public virtual County County { get; set; }\n}\n</code></pre>\n\n<p>I am having difficulty in creating the query that will give me all the records for each entities above grouped by Country, then State, then County, then City</p>\n\n<p>I am ultimately trying to put this into a backbone.js treeview.</p>\n\n<p><strong>What would be the correct Linq query for collecting the records in their respective groups</strong></p>\n"},{"tags":["asp.net","entity-framework","c#-4.0","code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":3025,"score":2,"question_id":4602954,"title":"How do i define Keys when working with \"EF-Code First\"?","body":"<p>I get a ModelValidationException (at the bottom) when working with \"EF-Code First\". It wants me to define a Key but I'm not sure what exactly it means...</p>\n\n<pre><code>public class Unit\n{\n    Guid id;\n    String public_id;\n    String name;        \n    bool deleted;\n}\n\npublic class MyDataContext : DbContext\n{\n    public DbSet&lt;Unit&gt; Units { get; set; }\n\n    protected override void OnModelCreating(ModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;Unit&gt;().ToTable(\"sometable\");\n    }\n}\n\n[TestFixture]\npublic class DataTests\n{\n    [Test]\n    public void Test()\n    {\n        MyDataContext database = new MyDataContext();\n        var o = database.Units;\n\n\n        Console.WriteLine(o.Count()); // This line throws!\n        Assert.IsTrue(true);\n    }\n}\n</code></pre>\n\n<blockquote>\n  <p>System.Data.Entity.ModelConfiguration.ModelValidationException : One or more validation errors were detected during model generation:</p>\n  \n  <p>System.Data.Edm.EdmEntityType: : EntityType 'Unit' has no key defined. Define the key for this EntityType.</p>\n  \n  <p>System.Data.Edm.EdmEntitySet: EntityType: The EntitySet Units is based on type Unit that has no keys defined.</p>\n</blockquote>\n"},{"tags":["asp.net-mvc","entity-framework","dependency-injection","structuremap","resourceproviderfactory"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13286945,"title":"Inject with different scope when using DbContext with custom resource provider","body":"<p>In an application I have the following components (among others):</p>\n\n<ul>\n<li><code>MyDbContext</code> : Entity framework data access</li>\n<li><code>DBResourceProviderFactory</code> : A custom <code>ResourceProviderFactory</code> providing a custom <code>IResourceProvider</code> (called <code>DBResourceProvider</code>...)</li>\n<li>Other services</li>\n<li>StructureMap</li>\n</ul>\n\n<p>The custom resource provider is looking resources up in the db using <code>MyDbContext</code>, injected similarly as described in <a href=\"http://stackoverflow.com/a/10633095/63733\">this SO answer</a>.</p>\n\n<p>The <code>MyDbContext</code> is also used in various other services, and since it is a web application, I use StructureMaps <code>HttpContextScoped</code> method to limit the lifetime of <code>MyDbContext</code> to the lifetime of the request (see <a href=\"http://stackoverflow.com/q/6390608/63733\">an other SO question and its answer on this subject</a>):</p>\n\n<pre><code>x.For&lt;MyDbContext&gt;().HttpContextScoped();\n</code></pre>\n\n<p>However, it seems that the lifetime of an <code>IResourceProvider</code> is not limited to a single http request. Therefore, <code>DBResourceProvider</code> keeps hanging onto a <code>MyDbContext</code> reference which will be disposed after the first request.</p>\n\n<p><strong>How can I handle this <em>lifetime mismatch</em> - have StructureMap return a transient <code>MyDbContext</code> for <code>IDbResourceProvider</code> while returning HttpContext-scoped instances to all other services?</strong></p>\n\n<p>Do I need two different implementations to do that? A marker interface?\nOr is it a bad idea to use Entity Framework to look up localized resources in the first place (performance etc.)?</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13286714,"title":"Check SQL reference constraint on INSERT but not on DELETE","body":"<p>I have a Logs table in my database where I'm storing records of user actions. There's a column for UserID, which is foreign-keyed to the Users table to check that the UserID exists when a log is added. However, attempting to delete a user causes a constraint failure because it leaves a UserID in the Logs table that no longer exists in the Users table. Deleting the offending rows from Logs isn't an option, because the whole point is to have persistent records (so that we can find out who broke what, basically) so deleting all actions by that user rather defeats the purpose.</p>\n\n<p>Is there a simple way to have it check the constraint when inserting new logs (to make sure the user exists at the time) but not when deleting a user? I'm accessing the DB via LINQ, so my queries are in C#, not SQL, so anything that requires that is out, but I have access to the database through MS SQL Server Management Studio, so I can do what I like with it.</p>\n\n<p>EDIT for slight clarification: the value of knowing who made an action is not just in accountability; it's useful in determining if an issue is user-specific, organisation-specific, or system-wide, which can greatly narrow down the list of possible causes. Once a user is deleted, it's still worth keeping their actions, and it's still useful to know which actions were by that user, for various reasons - for example, when tracking down an issue caused by one user doing a certain combination of things (eg. two actions that are fine separately but cause errors when one immediately follows another).</p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3093,"score":3,"question_id":1277384,"title":"Entity Framework: Deleting multiple objects query","body":"<p>I have a List which hold the PK ID's of a number of objects in a collection that I want to remove. Does anyone know how to write a single query to retrieve these objects?</p>\n\n<p>Eg: </p>\n\n<pre><code>IList&lt;int&gt; objectList; // populated with int Primary key Ids\n\nusing (MyEntities context = new MyEntities()){\n\n    var result = context.MyObjectCollection.Where(obj=&gt; obj.ID IN objectList);\n\n    foreach(var item in result){\n        context.DeletObject(item);\n    }\n    context.SaveChanges();\n}\n</code></pre>\n\n<p>Any help would greatly be appreciated!</p>\n"},{"tags":["asp.net-mvc","entity-framework","security","architecture"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13285799,"title":"ASP.MVC best security practices for control access to Entities","body":"<p>Let we have system with following entities:</p>\n\n<pre><code>public class Doctor\n{\n    public int ID { get; set; }\n    public int DepartmentID { get; set; }\n    public string Name { get; set; }\n    public ICollection&lt;Recipe&gt; Recipes { get; set; }\n}\n\npublic class Patient\n{\n    public int ID { get; set; }\n    public string Name { get; set; }\n    public ICollection&lt;Recipe&gt; Recipes { get; set; }\n}\n\npublic class Recipe\n{\n    public int ID { get; set; }\n    public int DoctorID { get; set; }\n    public int PatientID { get; set; }\n    public Doctor Doctor { get; set; }\n    public Patient Patient { get; set; }\n    public ICollection&lt;RecipeDetails&gt; Details { get; set; }\n}\n\npublic class RecipeDetails\n{\n    public int ID { get; set; }\n    public Guid SomeGuid { get; set; }\n    public double SomeValue { get; set; }\n}\n</code></pre>\n\n<p>Also we have requirements:</p>\n\n<ul>\n<li>Doctor should be able to edit his recipes</li>\n<li>Doctor should be able to see only recipes from doctors within his department</li>\n<li>Doctor should be able to perform search by available recipes</li>\n<li>Doctor should be able to generate reports by available recipes details</li>\n</ul>\n\n<p>For now I've implemented following security check:</p>\n\n<pre><code>public void ValidateAccess(Doctor doctor, Recipe aRecipe, EntityAction action)\n{\n    if (action == EntityAction.Modify &amp;&amp; doctor.ID == aRecipe.Doctor.ID)\n        return;\n    if (action == EntityAction.Read &amp;&amp; doctor.DepartmentID == aRecipe.Doctor.DepartmentID)\n        return\n    throw new SecurityException();\n}\n</code></pre>\n\n<p>That works perfect for simple methods when i have receipe entity, I can easy validate access by caling this method at the begining of my logic method.</p>\n\n<p>But now I have problem, this solution won't work for search and reporting when I don't have exact entity but have some statistics on them.</p>\n\n<p>Lets imagine that I want to generate report for patients with name \"aName\" that have receipes with component \"someGuid\", I will have some query with 2 criterias :</p>\n\n<pre><code>var res = RecipeRepository.Query(r =&gt; aName.Contains(r.Patient.Name)).SelectMany(r =&gt; r.Details).Where(d =&gt; d.SomeGuid == someGuid).Sum(d =&gt; d.SomeValue);\n</code></pre>\n\n<p>This query is not correct, it will display statistics for all recipes, including those which should be hidden.\nTo fix that, we should add our access condition to our query: </p>\n\n<pre><code>currentDoctor.DepartmentID == r.Doctor.DepartmentID\n</code></pre>\n\n<p>So now I have query:</p>\n\n<pre><code>var res = RecipeRepository.Query(r =&gt; aName.Contains(r.Patient.Name) &amp;&amp; currentDoctor.DepartmentID == r.Doctor.DepartmentID).SelectMany(r =&gt; r.Details).Where(d =&gt; d.SomeGuid == someGuid).Sum(d =&gt; d.SomeValue);\n</code></pre>\n\n<p>The problem is that I should add this part to each query in the system that makes any calculations on receipes.</p>\n\n<p>What pattern or practice could be applied to make this solution easier and prevent copy-pasting expression to each query?\nI'll appreciate your answers and advices.</p>\n"},{"tags":["entity-framework","linq-to-entities","duplicates","entity-framework-4.3.1"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13285485,"title":"How to avoid duplicate insert in Entity Framework 4.3.1","body":"<p>I have a small model created using code-first approach - a class <code>City</code> which contains only information about city name.</p>\n\n<pre><code>public class City\n{\n    public City()\n    {\n        Posts = new List&lt;Post&gt;();\n    }\n\n    public City(string cityName)\n    {\n        Name = cityName;\n    }\n\n    public virtual ICollection&lt;Post&gt; Posts { get; private set; }\n    public int Id { get; set; }\n    public string Name { get; private set; }\n}\n</code></pre>\n\n<p>A <code>Post</code> class represents combination of zip code and city reference</p>\n\n<pre><code>public class Post\n{\n    public virtual City City { get; set; }        \n    public int Id { get; set; }\n    public string ZipCode { get; set; }        \n}\n</code></pre>\n\n<p>both entities have their sets defined in context as their configurations</p>\n\n<pre><code>public DbSet&lt;City&gt; Cities { get; set; }\npublic DbSet&lt;Post&gt; Posts { get; set; }\n\nmodelBuilder.Configurations.Add(new CityMap());\nmodelBuilder.Configurations.Add(new PostMap());\n\n\npublic class CityMap : EntityTypeConfiguration&lt;City&gt;\n{\n    public CityMap()\n    {\n        // Primary Key\n        HasKey(t =&gt; t.Id);\n\n        // Properties\n        // Table &amp; Column Mappings\n        ToTable(\"City\");\n        Property(t =&gt; t.Id).HasColumnName(\"Id\");\n        Property(t =&gt; t.Name).HasColumnName(\"Name\");\n    }\n}\n\npublic class PostMap : EntityTypeConfiguration&lt;Post&gt;\n{\n    public PostMap()\n    {\n        // Primary Key\n        HasKey(t =&gt; t.Id);\n\n        // Properties\n        // Table &amp; Column Mappings\n        ToTable(\"Post\");\n        Property(t =&gt; t.Id).HasColumnName(\"Id\");            \n        Property(t =&gt; t.ZipCode).HasColumnName(\"ZipCode\");\n\n        // Relationships\n        HasRequired(t =&gt; t.City)\n        .WithMany(t =&gt; t.Posts)\n        .Map(map=&gt;map.MapKey(\"CityId\"));\n    }\n}\n</code></pre>\n\n<p>I've created class for manipulation with those objects with static methods which get or creates objects and return them to caller.</p>\n\n<pre><code>private static City GetCity(string cityName)\n{\n        City city;\n\n        using (var db = new DbContext())\n        {\n            city = db.Cities.SingleOrDefault(c =&gt; c.Name == cityName);\n\n            if (city == null)\n            {\n                city = new City(cityName);\n                db.Cities.Add(city);\n                db.SaveChanges();                    \n            }\n        }\n\n        return city;\n    }\n\n    private static Post GetPost(string zipCode, string cityName)\n    {\n        Post post;\n\n        City city = GetCity(cityName);\n\n        using (var db = new DbContext())\n        {      \n            post = db.Posts.SingleOrDefault(p =&gt; p.City.Id == city.Id &amp;&amp; p.ZipCode == zipCode);\n            if (post == null)\n            {\n                post = new Post { City = city, ZipCode = zipCode };\n\n                // State of city is unchanged\n                db.Posts.Add(post);\n\n                // State of city is Added\n                db.SaveChanges();\n            }\n        }\n\n        return post;\n    }\n</code></pre>\n\n<p>Imagine, that I call method </p>\n\n<pre><code>GetPost(\"11000\",\"Prague\");\n</code></pre>\n\n<p>method <code>GetCity</code> is started and if not exists, method creates a <code>city</code> and then calls the <code>SaveChanges()</code> method.</p>\n\n<p>If I set returned <code>city</code> entity to new <code>Post</code> instance, Entity Framework generates a second insert for the same <code>city</code>.</p>\n\n<p>How can I avoid this behavior? I want to only insert new <code>post</code> entity with referenced <code>city</code> created or loaded in previous step.</p>\n\n<p>Thank you for advice.</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13267721,"title":"LINQ Query - Only get Order and MAX Date from Child Collection","body":"<p>I'm trying to get a list that displays 2 values in a label from a parent and child (1-*) entity collection model.  </p>\n\n<p>I have 3 entities:</p>\n\n<ol>\n<li>[<strong>Customer</strong>]: CustomerId, Name, Address, ...  </li>\n<li>[<strong>Order</strong>]: OrderId, OrderDate, EmployeeId, Total, ... </li>\n<li>[<strong>OrderStatus</strong>]: OrderStatusId, StatusLevel, StatusDate, ...</li>\n</ol>\n\n<p>A <strong>Customer</strong> can have MANY <strong>Order</strong>, which in turn an Order can have MANY <strong>OrderStatus</strong>, i.e. \n[<strong>Customer</strong>] 1--* [<strong>Order</strong>] 1--* [<strong>OrderStatus</strong>]</p>\n\n<p>Given a CustomerId, I want to get all of the Orders (just OrderId) and the LATEST (MAX?) OrderStatus.StatusDate for that Order.</p>\n\n<p>I've tried a couple of attempts, but can seem to get the results I want.</p>\n\n<pre><code>private IQueryable&lt;Customer&gt; GetOrderData(string customerId)\n{\n     var ordersWithLatestStatusDate = Context.Customers\n\n     // Note: I am not sure if I should add the .Expand() extension methods here for the other two entity collections since I want these queries to be as performant as possible and since I am projecting below (only need to display 2 fields for each record in the IQueryable&lt;T&gt;, but thinking I should now after some contemplation.\n\n     .Where(x =&gt; x.CustomerId == SelectedCustomer.CustomerId)\n     .Select(x =&gt; new Custom \n     {\n         CustomerId = x.CustomerId,\n         ...\n         // I would like to project my Child and GrandChild Collections, i.e. Orders and OrderStatuses here but don't know how to do that. I learned that by projecting, one does not need to \"Include/Expand\" these extension methods.  \n     });\n     return ordersWithLatestStatusDate ;\n}\n</code></pre>\n\n<p>---- UPDATE 1 ----</p>\n\n<p>After the great solution from User: <a href=\"http://stackoverflow.com/users/470005/lazyberezovsky\">lazyberezovsky</a>, I tried the following:</p>\n\n<pre><code>var query = Context.Customers\n            .Where(c =&gt; c.CustomerId == SelectedCustomer.CustomerId)\n            .Select(o =&gt; new Customer \n            { \n                Name = c.Name, \n                LatestOrderDate = o.OrderStatus.Max(s =&gt; s.StatusDate) \n            });\n</code></pre>\n\n<p>In my hastiness from my initial posting, I didn't paste everything in correctly since it was mostly from memory and didn't have the exact code for reference at the time.  My method is a strongly-typed IQueryabled where I need it to return a collection of items of type T due to a constraint within a rigid API that I have to go through that has an IQueryable query as one of its parameters. I am aware I can add other entities/attributes by either using the extension methods .Expand() and/or .Select().  One will notice that my latest UPDATED query above has an added \"new Customer\" within the .Select() where it was once anonymous.  I'm positive that is why the query failed b/c it couldn't be turn into a valid Uri due to LatestOrderDate not being a property of Customer at the Server level.  FYI, upon seeing the first answer below, I had added that property to my client-side Customer class with simple { get; set; }.  So given this, can I somehow still have a Customer collection with the only bringing back those 2 fields from 2 different entities?  The solution below looked so promising and ingenious!</p>\n\n<p>---- END UPDATE 1 ----</p>\n\n<p>FYI, the technologies I'm using are OData (WCF), Silverlight, C#.</p>\n\n<p>Any tips/links will be appreciated.</p>\n"},{"tags":["entity-framework","visual-studio-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13283994,"title":"Data sources toolbox for VS2012 does not display my entity model","body":"<p>After adding an entity model either from the datasources toolbox itself or by adding it => \"add\" => \"new item\" it does not show up in the datasources toolbox and therefor i dont get that easy drop and drag functionality.</p>\n\n<p>If I add a dataset it works but that is an older technology (is it not?) everything in my current project are entity models and to change to datasets (which only works if I add <code>xmlns:yourAlias=\"clr-namespace:WpfApplication3\"</code>) would be .. I don't think best practice and a waste of time. </p>\n\n<p>I have recreated this same process of adding a entity model in VS 2010 and it works 100%, where i have the ability to simply drop and drag from the dataSource toolbox</p>\n\n<p>Maybe ill just wait for VS SP1 before working with it for client projects. :(</p>\n\n<p><strong>//Edit</strong></p>\n\n<p>If I add the ADO.net Entity model in VS2010 and then load the project in 2012 it loads fine in the dataSource toolbox. This is an answer but not an ideal work around.</p>\n"},{"tags":["c#","sql","entity-framework","sync"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13284661,"title":"EF synchronic savings of local and remote database","body":"<p>I have a local and remote database which are accessed with EF. The databases are in sync at initial state.</p>\n\n<p>Now I want to save the changes done locally, also save on the remote database. This should be possible without downloading the whole remote database?.</p>\n\n<p>Can I just change the connection string of the context and then call SaveChanges() on remote?.</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13264676,"title":"Code first Type per hierarchy","body":"<p>I use EF 5 with the code first approach. Now I try to define a \"code\" table in which I want to have several different codes (like address code, medium code, etc.). In this table I just have the following properties: ID (Guid), Name (String), Description (String) and a discriminator (in this case something like the type of the code: address code, medium code, etc.).</p>\n\n<p>So I defined the following base class:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public abstract class Code : EntityBase\n{\n    public string Name { get; set; }\n    public string Beschreibung { get; set; }\n}\n</code></pre>\n\n<p>Then I derived two classes from code</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class AddressCode : Code {}\npublic class MediumCode : Code {}\n</code></pre>\n\n<p>The class EntityBase is abstract and just defines the Id property, we use it for every POCO class...</p>\n\n<p>The goal is that I can use AddressCode as a property on my address POCO class:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class Adresse : EntityBase\n{\n    #region Properties\n    public string Name1 { get; set; }\n\n    public virtual AddressCode AddressCode { get; set; }\n    #endregion\n}\n</code></pre>\n\n<p>The question now is, how can I explain EF how to do that? Anyone can help?</p>\n\n<p>Thanks\nMarco</p>\n\n<hr>\n\n<p>Thanks for your answer!</p>\n\n<p>I tried to do it like you said. Unfortunately I get an error because of my EntityBase class:</p>\n\n\n\n<pre><code>public abstract class EntityBase\n{\n    #region Properties\n\n    public virtual Guid Id { get; set; }\n\n    public virtual bool IsValid\n    {\n        get\n        {\n            {\n                return Validate();\n            }\n        }\n    }\n\n    [NotMappedAttribute]\n    public virtual IList&lt;ValidationFailure&gt; ValidationFailures { get; set; }\n\n    #endregion\n\n    #region Methods\n\n    private bool Validate()\n    {\n        var validatorFactory = new AttributedValidatorFactory();\n        IValidator validator = validatorFactory.GetValidator(GetType());\n\n        if (validator == null)\n        {\n            return true;\n        }\n\n        ValidationResult validationResult = validator.Validate(this);\n\n        ValidationFailures = validationResult.Errors;\n\n        return validationResult.IsValid;\n    }\n\n    #endregion\n}\n</code></pre>\n\n<p>The error message is:\nYou cannot use Ignore method on the property 'ValidationFailures' on type 'Entities.AdresseCode' because this type inherits from the type 'Entities.EntityBase' where this property is mapped. To exclude this property from your model, use NotMappedAttribute or Ignore method on the base type.</p>\n\n<p>As you can see I already defined the property ValidationFailures as NotMapped but still I get this error.. Do you have an idea?</p>\n\n<p>Thanks\nMarco</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities","group-by"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":76,"score":3,"question_id":13283365,"title":"Difference between \"select new\" and \"Select(a => new\"","body":"<p>please consider this 2 queries and their result:</p>\n\n<pre><code>var result = ent.tblCustomGroupBies\n            .GroupBy(a =&gt; groupA.Contains(a.Group.Value) ? \"A\" :\n                          groupB.Contains(a.Group.Value) ? \"B\" :\n                          \"N/a\")\n            .Select(a =&gt; new\n            {\n                KEY = a.Key,\n                VALUE = a.Count()\n            });\n</code></pre>\n\n<p>and it's result in <code>GridView</code>::</p>\n\n<p><img src=\"http://i.stack.imgur.com/WuWDB.png\" alt=\"enter image description here\"></p>\n\n<p>and the second query:</p>\n\n<pre><code> var result3 = from p in ent.tblCustomGroupBies\n               group p by new { Criterion = groupA.Contains(p.Group.Value) ? \"A\" : \n                                            groupB.Contains(p.Group.Value) ? \"B\" : \n                                            \"N/a\" }\n               into g\n               select new { KEY = g.Key, VALUE = g.Count() };\n</code></pre>\n\n<p>and it's result in <code>GridView</code>::</p>\n\n<p><img src=\"http://i.stack.imgur.com/AOtJi.png\" alt=\"enter image description here\"></p>\n\n<p>why <code>Select(a =&gt; new)</code> in first query show key column but <code>select new</code> does not show that?</p>\n"},{"tags":["wpf","entity-framework","async-await"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13249086,"title":"async-await issue in EF 6","body":"<p>I'm trying async-await programming with entity-framework 6 (code first) + WPF and I can't see why the UI still freezes after I made the code asynchronous.\nHere is what I'm doing from the very first line:</p>\n\n<p>first there is an event handler responding to a click button:</p>\n\n<pre><code>private async void LoginButton_Click(object sender, RoutedEventArgs e) {\n  if (await this._service.Authenticate(username.Text, password.Password) != null)\n    this.Close();\n}\n</code></pre>\n\n<p>Then I have the Authenticate method in my service layer:</p>\n\n<pre><code>public async Task&lt;User&gt; Authenticate(string username, string password) {\n  CurrentUser = await this._context.GetUserAsync(username.ToLower().Trim(), password.EncryptPassword());\n  return CurrentUser;\n}\n</code></pre>\n\n<p>and at the end is the EF code in the context:</p>\n\n<pre><code>public async Task&lt;User&gt; GetUserAsync(string username, string password) {\n  return await this.People.AsNoTracking().OfType&lt;User&gt;().FirstOrDefaultAsync(u =&gt; u.Username == username &amp;&amp; u.Password == password);\n}\n</code></pre>\n\n<p><strong>Update:</strong> After some tracing the cause of UI freezing turned out to be the initialization process. UI thread blocks until the EF context is initialized and once that is done the actual querying/saving process is performed asynchronously. </p>\n\n<p><strong>Update</strong> Debug output after the call on Task.Yield() at the beginning of the click handler:</p>\n\n<pre><code>53:36:378 Calling Task.Yield\n53:36:399 Called Task.Yield\n53:36:400 awaiting for AuthenticateAsync\n53:36:403 awaiting for GetUserAsync\n'MyApp.vshost.exe' (Managed (v4.0.30319)): Loaded 'C:\\Windows\\Microsoft.Net\\assembly\\GAC_32\\System.Transactions\\v4.0_4.0.0.0__b77a5c561934e089\\System.Transactions.dll', Skipped loading symbols. Module is optimized and the debugger option 'Just My Code' is enabled.\n'MyApp.vshost.exe' (Managed (v4.0.30319)): Loaded 'C:\\Windows\\Microsoft.Net\\assembly\\GAC_MSIL\\System.Numerics\\v4.0_4.0.0.0__b77a5c561934e089\\System.Numerics.dll', Skipped loading symbols. Module is optimized and the debugger option 'Just My Code' is enabled.\n'MyApp.vshost.exe' (Managed (v4.0.30319)): Loaded 'C:\\Windows\\Microsoft.Net\\assembly\\GAC_32\\System.Data.OracleClient\\v4.0_4.0.0.0__b77a5c561934e089\\System.Data.OracleClient.dll', Skipped loading symbols. Module is optimized and the debugger option 'Just My Code' is enabled.\n'MyApp.vshost.exe' (Managed (v4.0.30319)): Loaded 'D:\\SkyDrive\\Works\\MyApp\\MyApp.UI.WPF.Shell\\bin\\Debug\\EntityFramework.SqlServer.dll'\n'MyApp.vshost.exe' (Managed (v4.0.30319)): Loaded 'C:\\Windows\\Microsoft.Net\\assembly\\GAC_32\\System.EnterpriseServices\\v4.0_4.0.0.0__b03f5f7f11d50a3a\\System.EnterpriseServices.dll', Skipped loading symbols. Module is optimized and the debugger option 'Just My Code' is enabled.\n'MyApp.vshost.exe' (Managed (v4.0.30319)): Loaded 'C:\\Windows\\Microsoft.Net\\assembly\\GAC_32\\System.EnterpriseServices\\v4.0_4.0.0.0__b03f5f7f11d50a3a\\System.EnterpriseServices.Wrapper.dll', Skipped loading symbols. Module is optimized and the debugger option 'Just My Code' is enabled.\n'MyApp.vshost.exe' (Managed (v4.0.30319)): Loaded 'C:\\Windows\\Microsoft.Net\\assembly\\GAC_MSIL\\System.Runtime.Serialization\\v4.0_4.0.0.0__b77a5c561934e089\\System.Runtime.Serialization.dll', Skipped loading symbols. Module is optimized and the debugger option 'Just My Code' is enabled.\n'MyApp.vshost.exe' (Managed (v4.0.30319)): Loaded 'EntityFrameworkDynamicProxies-MyApp.Model.Domain.People'\n'MyApp.vshost.exe' (Managed (v4.0.30319)): Loaded 'EntityFrameworkDynamicProxies-MyApp.Model.Domain.Security'\n53:39:965 Out of GetUserAsync\n53:39:968 out of AuthenticateAsync\nThe thread '&lt;No Name&gt;' (0x1e98) has exited with code 0 (0x0).\nThe thread '&lt;No Name&gt;' (0x17d4) has exited with code 0 (0x0).\nThe thread '&lt;No Name&gt;' (0x175c) has exited with code 0 (0x0).\nThe thread '&lt;No Name&gt;' (0x220) has exited with code 0 (0x0).\nThe thread '&lt;No Name&gt;' (0x1dc8) has exited with code 0 (0x0).\nThe thread '&lt;No Name&gt;' (0x1af8) has exited with code 0 (0x0).\n</code></pre>\n"},{"tags":["database","asp.net-mvc-3","entity-framework","database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":8,"score":1,"question_id":13283666,"title":"DbUpdateConcurrencyException when modifying data","body":"<p>I have been searching around for a bit now. I have tried a couple solutions involving catching the OptimisticConcurrency and adding:</p>\n\n<blockquote>\n  <p>\"@Html.HiddenFor(model => model.OrganizationID)\"</p>\n</blockquote>\n\n<p>to my delete page. My index (list), create, and edit pages work like a charm. However, when I go to delete a row it gives me the error below:</p>\n\n<blockquote>\n  <p>DbUpdateConcurrencyException<br>\n  Store update, insert, or delete statement affected an unexpected\n  number of rows (0). Entities may have been modified or deleted since\n  entities were loaded. Refresh ObjectStateManager entries.</p>\n</blockquote>\n\n<p>I have followed a tutorial to build a Database First application. Currently, I am just bringing in data from my Organizations table until I can get it working smoothly. My organization model looks like this (which was auto-generated from \"Add Code Generation Item\"):</p>\n\n<pre><code>//------------------------------------------------------------------------------\n// &lt;auto-generated&gt;\n//    This code was generated from a template.\n//\n//    Manual changes to this file may cause unexpected behavior in your application.\n//    Manual changes to this file will be overwritten if the code is regenerated.\n// &lt;/auto-generated&gt;\n//------------------------------------------------------------------------------\n\nnamespace VAGTC.Models\n{\n    using System;\n    using System.Collections.Generic;\n\n    public partial class Organization\n    {\n        public Organization()\n        {\n            this.Contact_Title = new HashSet&lt;Contact_Title&gt;();\n            this.Organization_Address = new HashSet&lt;Organization_Address&gt;();\n            this.Organization_Business_Type = new HashSet&lt;Organization_Business_Type&gt;();\n            this.Organization_Country = new HashSet&lt;Organization_Country&gt;();\n            this.Organization_Email = new HashSet&lt;Organization_Email&gt;();\n            this.Organization_Membership = new HashSet&lt;Organization_Membership&gt;();\n            this.Organization_Notes = new HashSet&lt;Organization_Notes&gt;();\n            this.Organization_Phone = new HashSet&lt;Organization_Phone&gt;();\n            this.Organization_Website = new HashSet&lt;Organization_Website&gt;();\n            this.Contacts = new HashSet&lt;Contact&gt;();\n            this.Organization_Industry_Code = new HashSet&lt;Organization_Industry_Code&gt;();\n        }\n\n        public int OrganizationID { get; set; }\n        public string Name { get; set; }\n\n        public virtual ICollection&lt;Contact_Title&gt; Contact_Title { get; set; }\n        public virtual ICollection&lt;Organization_Address&gt; Organization_Address { get; set; }\n        public virtual ICollection&lt;Organization_Business_Type&gt; Organization_Business_Type { get; set; }\n        public virtual ICollection&lt;Organization_Country&gt; Organization_Country { get; set; }\n        public virtual ICollection&lt;Organization_Email&gt; Organization_Email { get; set; }\n        public virtual ICollection&lt;Organization_Membership&gt; Organization_Membership { get; set; }\n        public virtual ICollection&lt;Organization_Notes&gt; Organization_Notes { get; set; }\n        public virtual ICollection&lt;Organization_Phone&gt; Organization_Phone { get; set; }\n        public virtual ICollection&lt;Organization_Website&gt; Organization_Website { get; set; }\n        public virtual ICollection&lt;Contact&gt; Contacts { get; set; }\n        public virtual ICollection&lt;Organization_Industry_Code&gt; Organization_Industry_Code { get; set; }\n    }\n}\n</code></pre>\n\n<p>This is the Delete ActionResult in my Organization controller:</p>\n\n<pre><code>//\n// GET: /Organization/Delete/5\n\npublic ActionResult Delete(int id)\n{\n    using (var db = new VAGTCEntities())\n    {\n        return View(db.Organizations.Find(id));\n    }\n}\n\n//\n// POST: /Organization/Delete/5\n\n[HttpPost]\npublic ActionResult Delete(int id, Organization organization)\n{\n    try\n    {\n        // TODO: Add delete logic here\n        using (var db = new VAGTCEntities())\n        {\n            db.Entry(organization).State = System.Data.EntityState.Deleted;\n                db.SaveChanges();\n\n        }\n            return RedirectToAction(\"Index\");\n    }\n    catch\n    {\n        return View();\n    }\n}\n</code></pre>\n\n<p>and on my Index page it declares the primary key:</p>\n\n<blockquote>\n  <p>@Html.ActionLink(\"Delete\", \"Delete\", new { id=item.OrganizationID })</p>\n</blockquote>\n\n<p>Out of curiosity I decided to try adding  </p>\n\n<blockquote>\n  <p>\"@Html.HiddenFor(model => model.OrganizationID)\"</p>\n</blockquote>\n\n<p>to the bottom, under BeginForm, instead of at the top of the page in fieldset and under legend tags: </p>\n\n<pre><code>@using (Html.BeginForm()) {\n    &lt;p&gt;\n        @Html.HiddenFor(model =&gt; model.OrganizationID)\n        &lt;input type=\"submit\" value=\"Delete\" /&gt; |\n        @Html.ActionLink(\"Back to List\", \"Index\")\n    &lt;/p&gt;\n}\n</code></pre>\n\n<p>Low and behold - it worked.\nI still want to post this! Perhaps someone else will find it and it will help them.\nAlthough I don't know 100% why it is - could someone shed some light on the matter?</p>\n"},{"tags":["c#","entity-framework","parent-child"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13283595,"title":"multiple parent Entities with one child entity in EF code first","body":"<p>there are tow entities <code>Post</code> and <code>Photo</code> . both have a collection of <code>comment</code> entity .</p>\n\n<p>is there anyway to avoid the <code>mapping</code> written below (being have to define <strong>one</strong> property for <strong>each</strong> parent in <code>Comment</code> entity ) ?</p>\n\n<pre><code>public class Post\n{\n    public string Title {get; set;}\n    public ICollection&lt;Comment&gt; Comments{get; set; }\n}\n\npublic class Photo\n{\n    public string Path{get;set;}\n    public ICollection&lt;Comment&gt; Comments{get; set; }\n}\n\npublic class Comment\n{\n    public int? PostId{get;set;}\n    public Virtual Post Post{get;set;}\n\n    public int? PhotoId{get;set;}\n    public Virtual Photo Photo{get;set;}\n}\n</code></pre>\n"},{"tags":["c#","entity-framework","objectcontext"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13282083,"title":"ContextCreating method in EntityDataSource cannot convert Entities to ObjectContext","body":"<p>Using EntityFramework, I have created an EntityDataModel (.edmx file) in App_Code\\DAL. In the wizard, I named the entities 'DLGDBEntities'. I have a number of <code>EntityDataSource</code>s in the .aspx where I've set the <code>OnContextCreating</code> attribute to 'UseSurveyContext' which looks like this:</p>\n\n<pre><code>protected void UseSurveyContext(object sender, EntityDataSourceContextCreatingEventArgs e)\n{\n   e.Context = surveyContext;\n}\n</code></pre>\n\n<p>Setup code for the surveyContext is as follows:</p>\n\n<pre><code>DLGDBEntities surveyContext;\n</code></pre>\n\n<p>and in Page_Load:</p>\n\n<pre><code>surveyContext = new DLGDBEntities();\n</code></pre>\n\n<p>All of the above looks like the same code I've seen in every tutorial (eg: <a href=\"http://msdn.microsoft.com/en-us/library/cc668193.aspx#1\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/cc668193.aspx#1</a>), and I could swear I've had it working.</p>\n\n<p>Now however, I am getting the error: <code>Cannot implicitly convert type 'DAL.DLGDBEntities' to 'System.Data.Objects.ObjectContext'</code></p>\n\n<p>What have I done wrong, and why did it work before?</p>\n"},{"tags":["c#","linq","entity-framework","c#-4.0","linq-to-sql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13269559,"title":"How to Custom Group By multiple records according some criteria","body":"<p>please consider this scenario:</p>\n\n<p>I have data like this :</p>\n\n<pre><code> Id          Group            Value\n -----------------------------------\n 1            1                100\n 2            1                120\n 3            1                100\n 4            2                90\n 5            2                105\n 6            3                300\n 7            4                123\n 8            4                110\n 9            5                100\n 10           5                110\n</code></pre>\n\n<p>I want to do <code>GroupBy</code> on this data as <code>1,2,3</code> place in one group and <code>4,5</code> place in another group. How I can do this with <code>LINQ</code>?</p>\n\n<p>thanks</p>\n\n<hr>\n\n<p><strong>Edit 1)</strong></p>\n\n<p>I want to place <code>1,2,3</code> in one group and <code>4,5</code> in another group and perform <code>Count</code> aggregation on them and I get <strong>6</strong> for first group and <strong>4</strong> for secnd group</p>\n"},{"tags":["c#",".net","entity-framework","oop","generics"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":53,"score":2,"question_id":13279018,"title":"How to avoid the need to reference Entity Framework on my service layer?","body":"<p>While trying to create a data access layer for a new project, I ran into what I can only imagine as an OOP/Design/Generics problem (using EF 4.3 to access the database).</p>\n\n<p>Mainly I wanted to achieve two things with this data layer:</p>\n\n<ul>\n<li>Different Context objects I have on my project should share the same connection string.</li>\n<li>Abstract repository class with common implementation.</li>\n</ul>\n\n<p>For some reason, I cannot compile my solution without referencing EntityFramework on the service layer. What I'm looking for is a way to fix this. Here's what I have:</p>\n\n<pre><code>//Project/Namespace BusinessLogicLayer.DomainClasses\n//POCO classes mapped on Entity Framework.\n\n//Project/Namespace DataAccessLayer.Base\n//Base classes and interfaces for all data access layer, such as:\n\npublic abstract class BaseContext&lt;TContext&gt; : DbContext where TContext : DbContext\n{\n  //To allow multiple contexts sharing the same connection string\n  protected BaseContext(): base(\"name=MyConnectionString\") {}\n}\n\n//Generic interface for a read-only repository\npublic interface IReadOnlyRepository&lt;T&gt; : IDisposable where T : class\n\n//Generic interface for a read/write repository\npublic interface IRepository&lt;T&gt; : IReadOnlyRepository&lt;T&gt; where T : class\n\n//Basic implementation for a read-only repository\npublic abstract class BaseReadOnlyRepository&lt;C, T&gt; : IReadOnlyRepository&lt;T&gt;\n    where T : class\n    where C : BaseContext&lt;C&gt;, new()\n{\n}\n\n//Basic implementation for a read/write repository\npublic abstract class BaseRepository&lt;C, T&gt; : IRepository&lt;T&gt;\n    where T : class\n    where C : BaseContext&lt;C&gt;, new()\n{\n}\n\n//Project DataAccessLayer.AccountContext/ Namespace DataAccessLayer\n//Context class:\n\npublic class AccountContext : BaseContext&lt;AccountContext&gt; {}\n\n//With this, I can have simple repositories:\n\npublic class UserRepository : BaseRepository&lt;AccountContext, User&gt;\n{ //All implementation comes from the base abstract class, unless I need to change it (override methods)\n}\n</code></pre>\n\n<p>I have a service layer between data access and the application (Windows Forms). Because I have a generic repository, it seemed a good and logic idea to have generic services. In the end, very similar to the repository structure:</p>\n\n<pre><code>//Project/Namespace BusinessLogicLayer.Services\n//Service layer supposed to reference only the repository project and not Entity Framework.\n\n//Generic interface for a read-only service working with a read-only repository\npublic interface IReadOnlyService&lt;T&gt; where T : class {}\n\n//Generic interface for a read/write service working with a read/write repository\npublic interface IService&lt;T&gt; : IReadOnlyService&lt;T&gt; where T : class\n\n//Base implementation for a read-only service\npublic abstract class BaseReadOnlyService&lt;T, R&gt; : IReadOnlyService&lt;T&gt;\n    where T : class\n    where R : IReadOnlyRepository&lt;T&gt;, new()\n{\n}\n\n//Base implementation for a read/write service\npublic abstract class BaseService&lt;T, R&gt; : IService&lt;T&gt;\n    where T : class\n    where R : IRepository&lt;T&gt;, new()\n{\n}\n\n//Concrete sample service\npublic class UserService : BaseService&lt;User, UserRepository&gt;\n{ //As with the repository I can change the default behavior of implementation overriding methods\n}\n</code></pre>\n\n<p>With this setup, the only way to compile is to reference Entity Framework on the service layer project.\nHow can I avoid the need to reference Entity Framework there?</p>\n\n<p>At this point, I'm willing to even throw it all out and rebuild everything but this is the only way I found to make it work given my needs (DbContext sharing connection strings, generic repository to avoid replication of code).</p>\n\n<p>Appreciate any help. Thanks.</p>\n\n<p><em>--Edit--Including here some extra steps I did 3 hours after I posted the question--</em></p>\n\n<p>In order to figure this out, I started to create a sample project with the same code above plus some implementation to mimic the results on the original project as much as possible.</p>\n\n<p>I created the domain classes project, the whole base data layer project and then the context project. I noticed I need to reference Entity Framework on the context project even though the context class does not derive directly from DbContext. Instead, it derives from an abstract class that derives from DbContext. This is ok though since my context will have DbSets and any other implementation related to DbContext.</p>\n\n<p>Next is the repository project. Needs to reference all other three (domain, base data layer and context). My repository has no code. All funcionality lies on the ancestor. I try to compile the repository project and VS requires me to referente Entity Framework. I wonder if it's really just a matter of embedding libraries. If this is confirmed, it's going to be a surprise. Entity Framework library is present on the output of the other projects. Why would I need to reference it here too? What's making VS require this?</p>\n\n<p>Anyway, for testing purposes, I added the reference. After all, I'm inside the data layer. I can live with that. Moving on to the service layer. For the sake of simplicity, I put all of the service classes into the same project.</p>\n\n<p>One possible flaw is that one of the constraints for the service abstract classes is the repository interface. That requires me to add a reference to the base data layer on my service layer. Perhaps already here there is something I can do that allows me to use only the repository reference. I have no option but to reference base data layer.</p>\n\n<p>Lastly, my concrete service is created and VS gives me the following error message: The type 'System.Data.Entity.DbContext' is defined in an assembly that is not referenced. You must add a reference to assembly 'EntityFramework, Version=4.3.1.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.</p>\n\n<p>So, in the end, the only way to keep going is to reference Entity Framework on the service layer. And at some point, when building the Windows Forms App, I will also have to reference Entity Framework.</p>\n\n<p>What should I do to avoid having these references? What improvements can I have on this structure?</p>\n\n<p>What I know is that my app certainly doesn't have to know that Entity Framework is involved anywhere on the other layers. Neither does the service layer. Services will only consume repositories. Repositories can even be providing fake data for tests.</p>\n\n<p>In case anyone is interested, I uploaded the project I created while writing this. It's a 1,17Mb zip file with no binaries whatsoever (except the Entity Framework 4.3.1 dll that I got through Nuget). Link: <a href=\"http://www.mediafire.com/?b45zkedy2j7eocc\" rel=\"nofollow\">http://www.mediafire.com/?b45zkedy2j7eocc</a>.</p>\n\n<p>Again, thanks for helping.</p>\n"},{"tags":["entity-framework","join","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13281714,"title":"LINQ-to-Entity Joined Table Return","body":"<p>I have two tables as follows:</p>\n\n<pre><code>Departments:\n   DeptID   (PK)\n   DeptName\n   ...\n\nEmployees: \n   EmpID    (PK)\n   DeptID   (FK)\n   EmpName\n   ...\n</code></pre>\n\n<p>and I have a query using LINQ as follows:</p>\n\n<pre><code>public List&lt;Employee&gt; GetEmployee(int deptID)\n{\n    var query = from e in mdc.Employees\n                join d in mdc.Departments on e.DeptID equals d.DeptID\n                where e.DeptID == deptID\n                select new { e.EmpID, e.EmpName, d.DeptName };\n\n    return query.ToList();\n}\n</code></pre>\n\n<p>Now my question is this. I would like to select the fields EmpID, EmpName, and DeptName.\nBut what will my return type be? This one returns an error because this query returns a <code>GenericList</code> as opposed to my <code>List&lt;Employee&gt;</code>.</p>\n"},{"tags":["asp.net","entity-framework","sencha-touch-2","asp.net-webforms","sencha-architect"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":10,"score":1,"question_id":13281793,"title":"Reusing DAL in ASP.Net Web Forms in Sencha","body":"<p>I have a N-tier web application built in ASP.Net Web Forms.  The application registers users for a youth sports program - and it works great!  The client has asked me to build a mobile version of registration.  I'm going to need to build a new front end and that's ok.  Modifying the current Web Forms for mobile is not an option.  I really like Sencha Architect and know the IDE well enough to consider using Sencha as a front-end.  Plus I love the benefits of Sencha offers with cross-device (Android/iDevice) web applications.  </p>\n\n<p>My question is how best to architect the application.  I don't want to rewrite the DAL (or any stored procs) so I'm considering a few options:</p>\n\n<p><strong>Backend</strong>\n1) Leverage the EF and trying to work with my existing SPs (although this seems cumbersome to say the least)\n2) Use the new ASP.Net Web API to craft service endpoints that call SPs</p>\n\n<p><strong>Front-End</strong>\n1) Use Sencha Architect\n2) Use ASP.Net Web Forms (altough I'm concerned about rewriting what Sencha has already done well)\n3) Use ASP.Net MVC (concerned about rewriting what Sencha has already done well)</p>\n\n<p>Ideally, I would find some sort of way to reuse the DAL I have.  I don't want to manage two Data Access Layers in this application. </p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","entity-framework","grid","devexpress","master-detail"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13281199,"title":"Create master/detail grids using XtraGrid Entity framework","body":"<p>I'm a beginner regarding C#, Entity and working with grids, so although I assume what I'm asking is somewhat general, I am a little lost.\nI have two tables in my SQL database: <code>PeriodicReports</code> and <code>PeriodicReportGroups</code>. Each reports group can have 1 or more periodic reports, so what I envisioned was a grid with rows that would have a + sign at the left and could be expanded, showing the related periodic reports for each group. I know this can be done because I've seen very similar examples in DevExpress support site, but although I've put time trying to understand them and apply them to my case, I still haven't figured how to do it. \nThis is what my code looks like. After using the Entity Framework with my tables, this class got created automatically:</p>\n\n<pre><code>public partial class ReportEntities : DbContext\n{\n    public ReportEntities()\n        : base(\"name=ReportEntities\")\n    {\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        throw new UnintentionalCodeFirstException();\n    }\n\n    public DbSet&lt;PeriodicReportGroup&gt; PeriodicReportGroups { get; set; }\n    public DbSet&lt;PeriodicReport&gt; PeriodicReports { get; set; }\n}\n</code></pre>\n\n<p>I created this interface and class myself in order to only show certain columns in my grid:</p>\n\n<pre><code>    public interface IPeriodicReportGroup\n{\n    string Name { get; }\n    string Description { get; }\n    bool Active { get; set; }\n}\n\npublic partial class PeriodicReportGroup : IPeriodicReportGroup\n{\n}\n</code></pre>\n\n<p>And in the other hand, I have my XtraForm with an XtraGrid:</p>\n\n<pre><code>public partial class Form1 : XtraForm\n{\n    public Form1()\n    {\n        InitializeComponent();\n        InitSkinGallery();\n        InitGrid();\n    }\n\n    BindingList&lt;IPeriodicReportGroup&gt; gridDataList = new BindingList&lt;IPeriodicReportGroup&gt;();\n\n    void InitGrid()\n    {\n        var database = new ReportEntities();\n\n        var reportGroups = database.PeriodicReportGroups.ToList( );\n\n        foreach (var group in reportGroups )\n            gridDataList.Add( group );\n\n        gridControl.DataSource = gridDataList;\n    }\n...\n</code></pre>\n\n<p>So far, I'm successfully putting the periodic report groups that I have in my DB in the grid, which is good. But I still have no clue on how exactly set up the details grid that will expand for each group, although I feel it should be something pretty standard. Can anybody offer some guidance? I'm not asking for somebody else to do my work, just something that can point me out in the right direction, because right now I'm pretty lost. \nI'd also love to be able to add new groups and new details on the run by inputting data into an empty row, is this possible? </p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":3,"up_vote_count":11,"down_vote_count":0,"view_count":175,"score":11,"question_id":12652070,"title":"EF: In search of a design strategy for DatabaseFirst DbContext of a Modular Application","body":"<p>I'm looking for suggestions on how to approach using an ORM (in this case, EF5) in the design of modular Non-Monolithic applications, with a Core part and 3rd party Modules, where the Core has no direct Reference to the 3rd party Modules, and Modules only have a reference to Core/Common tables and classes. </p>\n\n<p>For arguments sake, a close enough analogy would be DNN.</p>\n\n<p>CodeFirst:</p>\n\n<p>With CodeFirst, the approach I used was to build up the model of the Db was via reflection: in the Core's DbContext's DbInitialation phase, I used Reflection to find any class in any dll (eg Core or various Modules) decorated with IDbInitializer (a custom contract containing an Execute() method) to define just the dll's structure. Each dll added to the DbModel what it knew about itself. \nAny subsequent Seeding was also handled in the same wa (searching for a specific IDbSeeder contract, and executing it).</p>\n\n<p>Pro: \n* the approach works for now.\n* The same core DbContext can be used across all respositories, as long as each repo uses dbContext.GetSet(), rather than expecting it to be a property of the dbContext. No biggie.\nCons: \n * it only works at startup (ie, adding new modules would require an AppPool refresh).\n * CodeFirst is great for a POC. But in EF5, it's not mature enough for Enterprise work <em>yet</em> (and I can't wait for EF6 for StoredProcs and other features to be added).\n * My DBA hates CodeFirst, at least for the Core, wanting to optimize that part with Stored Procs as much as as possible...We're a team, so I have to try to find a way to please him, if I can find a way... </p>\n\n<p>Database-first:</p>\n\n<p>The DbModel phase appears to be happening prior to the DbContext's constructor (reading from embedded *.edmx resource file).  DbInitialization is never invoked (as model is deemed complete), so I can't add more tables than what the Core knows about.</p>\n\n<p>If I can't add elements to the Model, dynamically, as one can with CodeFirst, it means that \n* either the Core DbContext's Model has to have knowledge of every table in the Db -- Core AND every 3rd party module. Making the application Monolithic and highly coupled, defeating the very thing I am trying to achieve.\n* Or each 3rd party has to create their own DbContext, importing Core tables, leading to\n   * versioning issues (module not updating their *.edmx's when Core's *.edmx is updated, etc.)\n   * duplication everywhere, in different memory contexts = hard to track down concurrency issues.</p>\n\n<p>At this point, it seems to me that the CodeFirst approach is the only way that Modular software can be achieved with EF. But hopefully someone else know's how to make DatabaseFirst shine -- is there any way of 'appending' DbSet's to the model created from the embedded *.edmx file?</p>\n\n<p>Or any other ideas?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13260073,"title":"EF Code first lookup value without foreign key in model","body":"<p>I am working with a database that has two tables. \nIssues (contains a SubStatusID column that has int values. several of the rows have 0 value for this column)</p>\n\n<p>SubStatus table (contains SubStatusID, SubStatusText but there is no row with 0 value for SubStatusID...so I cannot use SubStatusID from this table as the foreign key association in my entity framework model).</p>\n\n<p>I also cannot change the data in any of the tables.</p>\n\n<p>When I pull the Issue record using EF 5, how can I also retrieve the value of the SubStatus column if Issue's SubStatusID is not 0</p>\n"},{"tags":["entity-framework","c#-4.0","expression-trees","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13274586,"title":"DBContext cache expression tree of a query","body":"<p>I'm actually working on a project who use a very big linq to entity query (around 250 lines) who works with a lot of different entities.</p>\n\n<p>This query depend of few parameters (3 or 4 max) so I think to \"store\" the expression tree of my query and modifying this one with just my few parameters like this.</p>\n\n<pre><code>IQueryable&lt;Foo&gt; myQuery = \n  GetBaseQuery()\n  .Where(a =&gt; a.Param1 == \"foo\")\n  .Where(a =&gt; a.Param2 == \"bar\");\n</code></pre>\n\n<p>Apart using compiled queries, is there a way to do that ? </p>\n\n<p>This problem has some conditions</p>\n\n<ul>\n<li>I use DbContext and changing to ObjectContext is difficialy possible and it seems that this is a pre requities for using compiled queries.</li>\n<li>I use Visual Studio 2010 so... i'm limited to .NET 4 and entity framework 4.3 (no .NET 4.5, EF5 and autocompiled queries unhopefully)</li>\n</ul>\n\n<p>So, Is there a way to</p>\n\n<ul>\n<li>Store an expression tree who will be just used as a \"base\" and will not take too much time to be generated ?</li>\n<li>Or using .NET 4.5 in visual studio 2010 ?</li>\n<li>Or using Compiled queries with a DbContext</li>\n</ul>\n\n<p>REALLY Thank's by advance !!!</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13269433,"title":"Restrict DBSet to a subset of entities","body":"<p>I am building a multi-tenant application using EF 4, I have a shared database an many entities have a CustomerID field. I was wondering if there was a way I could enforce a CustomerID query at my DBSet level from my DBContext. </p>\n\n<p>I was hoping I could specify a CustomerID when I create my DB context, and wrap the DBSets to always include a (x => x.CustomerID == custID) so I don't need to worry about adding this logic all over my application, but I haven't been able to find anything that suggests its possible</p>\n\n<p>Many thanks</p>\n"},{"tags":["c#","wpf","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13275949,"title":"update dataGrid back to ef from anonymous type","body":"<p>The following code shows into dataGrid result from two tables</p>\n\n<p>But I understand that I can not update the data back into the DB (since it shows anonymous type)</p>\n\n<pre><code>public class NameAndDone\n{\n    public string document_Name { get; set; }\n    public bool ? document_Done { get; set; }\n}\n\n\n       vagEntities projectE = new vagEntities();\n       var doc = from c in projectE.Person_Documents\n                  join cw in projectE.Documents on c.Document_Id equals cw.Document_Id\n                  where c.Person_Id == selc   \n                  select new NameAndDone { document_Name = cw.Document_Name,document_Done = c.Document_done};\n\n       carsGrid.ItemsSource = doc;\n</code></pre>\n\n<p>and in the xaml </p>\n\n<pre><code>        &lt;DataGrid Grid.Row=\"1\" RowHeight=\"30\" AutoGenerateColumns=\"False\" Margin=\"15,15,15,96\" x:Name=\"carsGrid\" &gt;\n    &lt;DataGrid.Columns&gt;\n            &lt;DataGridTextColumn  Binding=\"{Binding Path=document_Name}\" MinWidth=\"100\" Header=\"Documents\"  /&gt;\n            &lt;DataGridCheckBoxColumn  Binding=\"{Binding Path=document_Done}\" Header=\"Done\" /&gt;\n        &lt;/DataGrid.Columns&gt;\n    &lt;/DataGrid&gt;\n</code></pre>\n\n<p>My question is: Is it possible to update with the saveChanges () function?\nOr I need to change all the code (hope not)</p>\n\n<p>Thanks in advance to anyone who helps (even if I can not understand)</p>\n\n<p>Please, does anyone have an idea?</p>\n"},{"tags":[".net","sql-server","wpf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":12,"score":3,"question_id":13278889,"title":"How to add data to SQL Server Express database using Entity Framework","body":"<p>I'm writing simple program for my university. I created an Entity Framework model, draw diagrams, created database from model, applied SQL file on my database and now I'm trying to add some items to the DB. </p>\n\n<p>I'm doing it this way:</p>\n\n<pre><code>using (NewsletterEntities context = new NewsletterEntities())\n{\n   Sender newSender = new Sender();\n   newSender.Login = Login.Text;\n   newSender.Password = Password.Text;\n   newSender.Port = 23;\n   newSender.SMTP = SMTP.Text;\n   newSender.Email = Email.Text;\n   newSender.SenderID = 0;\n\n   context.Senders.AddObject(newSender);\n   context.SaveChanges();\n}\n</code></pre>\n\n<p>When I try to execute it it pops up with inner exception: </p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table 'Senders' when IDENTITY_INSERT is set to OFF.</p>\n</blockquote>\n\n<p>I was trying to look for the error, but I don't know much about entity framework and couldn't find anything specific.</p>\n\n<p>Can anyone help?</p>\n"},{"tags":["c#","entity-framework","nhibernate","orm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13277324,"title":"NHibernate, join between tables and return a specific type","body":"<p>I have 2 tables, I'd like place some fields in a result class, but I'm stuck. The code I want look like this with Entity Framework :</p>\n\n<pre><code>var res =   \n(from p in context.EstimationItem\n    join q in ...\n    select new EstimationWithDetail\n    {\n        Estimation = q.Estimation,\n        Id = q.Id,\n        FullName = q.Customer.FirstName + q.Customer.LastName\n\n    }).ToList();\n</code></pre>\n\n<p>In Nibernate, at this time, I have this, but I'm stuck ...</p>\n\n<pre><code>var res =\n    Session.QueryOver&lt;EstimationItem&gt;()\n    .JoinQueryOver(x =&gt; x.Estimation)\n    .Select(\n        x =&gt; x.Estimation.Reference,\n        x =&gt; x.Estimation.CreationDate,\n        x =&gt; x.Price,\n        x =&gt; x.Estimation.Customer.FirstName,\n        x =&gt; x.Estimation.Customer.LastName\n        )\n    .List();\n\npublic class Estimation\n{\n    public virtual string Reference { get; set; }\n    public virtual Customer Customer { get; set; }\n    public virtual DateTime CreationDate { get; set; }\n    public virtual decimal Total { get; set; }\n    public virtual IList&lt;EstimationItem&gt; EstimationItems { get; set; }\n}\n\npublic class EstimationItem\n{\n    public virtual decimal Price { get; set; }\n    public virtual int Quantity { get; set; }\n    public virtual Estimation Estimation { get; set; }\n    public virtual Product Product { get; set; }\n}\n\npublic class EstimationWithDetail\n{\n    public string Reference { get; set; }       //Estimation.Reference\n    public string FullName { get; set; }        //concat FirstName and LastName from Customer\n    public decimal Price { get; set; }          //Estimation.Total\n    public int Id { get; set; }                 //Estimation.Id\n    public DateTime CreationDate { get; set; }  //Estimation.CreationDate\n}\n</code></pre>\n\n<p><strong>Update 1</strong></p>\n\n<p>I tried the code but I get this error : \n<em>InvalidOperarionException, variable 'x' of type 'EstimationItem' referenced from scope '', but it is not defined</em></p>\n\n<pre><code>var res =\n    Session.QueryOver&lt;EstimationItem&gt;()\n    .JoinQueryOver(x =&gt; x.Estimation)\n    .Select(x =&gt; new EstimationWithDetail\n    {\n        Code = x.Estimation.Reference,\n        CreationDate = x.Estimation.CreationDate,\n        Price = x.Estimation.Total,\n        FullName = x.Estimation.Customer.FirstName + x.Estimation.Customer.LastName\n    })\n    .List&lt;EstimationWithDetail&gt;();\n</code></pre>\n\n<p><strong>Update 2 :</strong>\nI tried this too</p>\n\n<pre><code>Estimation a = null;\nCustomer b = null;\nvar res = Session.QueryOver&lt;EstimationItem&gt;()\n    .JoinAlias(c =&gt; c.Estimation, () =&gt; a)\n    .JoinAlias(c =&gt; c.Estimation.Customer, () =&gt; b)\n    .Select(x =&gt; new EstimationWithDetail\n    {\n        Code = a.Reference,\n        Id = a.Id,\n        FullName = b.LastName\n    })\n    .List&lt;EstimationWithDetail&gt;();\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":13,"score":-1,"question_id":13277044,"title":"Entity Framework database not showing","body":"<p>When I select 'add a new item' and then select 'ADO.NET Entity Data Model' and select 'Generate from database' in Visual Studio only some databases show up but other databases I have added don't? </p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13270379,"title":"Entity Framework performance issue while looping with more record","body":"<p>I have employee details of more than 4000 employees. While retrieving those rows, I am faced with performance issues due to the looping. So what can I do to improve performance?</p>\n\n<p>This is the looping I mentioned:</p>\n\n<pre><code>List&lt;EmployeesEntityObject&gt; lstEmployee = new List&lt;EmployeesEntityObject&gt;();\n\nforeach (var item in lst)\n{\n           EmployeesEntityObject obj = new EmployeesEntityObject();\n           obj.EmployeeID = item.EmployeeID;\n           obj.EmployeeName = item.EmployeeName;       \n           lstEmployee.Add(obj);\n}\n</code></pre>\n"},{"tags":["mysql","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":434,"score":1,"question_id":12181428,"title":"ASP.NET MVC 4 EF5 with MySQL","body":"<p>So I've just picked up VS2012 and I want to start an ASP.NET MVC 4 app with EF5.</p>\n\n<p>My host does not have MSSQL so I have to use MySQL.</p>\n\n<p>How do I tell my app that it should use MySQL? (I either want to use the devart MySQL connector or the one from mysql.com)</p>\n"},{"tags":["entity-framework","ef-code-first","code-first","one-to-one"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13155385,"title":"Code First One to One relationship","body":"<p>I am writing a model, using Code First, with two entities: 'Action' and 'Permission'.</p>\n\n<p>Each Permission points to exactly one Action.\nNo two Permissions may point to the same Action.\nAn Action may exist without being pointed to by a Permission.</p>\n\n<p>Actions should not be aware of Permissions.</p>\n\n<p>My code is:</p>\n\n<pre><code>public Action\n{\n  public Guid Id {get; set;}\n  public string Name {get; set;}\n}\n\npublic Permission\n{\n  public Guid Id {get; set;}\n  public string Name {get; set;}\n\n  public Action Action {get; set;}\n}\n</code></pre>\n\n<p>Also, I configured Permission using the Fluent API:</p>\n\n<pre><code>modelBuilder.Entity&lt;Permission&gt;.HasRequired(p =&gt; p.Action).WithOptional()\n            .WillCascadeOnDelete();\n</code></pre>\n\n<hr>\n\n<p>When I try to delete an Action, I get the following error:</p>\n\n<blockquote>\n  <p>\"Adding a relationship with an entity which is in the Deleted state is\n  not allowed\".</p>\n</blockquote>\n\n<p>I tried deleting the Permission first, and then the Action. For that, i needed to fetch the Permission given the Action ID, but i get this error:</p>\n\n<pre><code>var permission = (from p in context.Permissions.Include(p =&gt; p.Action)\n                  where p.Action.Id == actionId\n                  select p).Single();\n</code></pre>\n\n<blockquote>\n  <p>\"Indexed properties are not supported\"</p>\n</blockquote>\n\n<p>What am I doing wrong? Is there a better approch to model this?</p>\n\n<p>Thanks! \nNir</p>\n"},{"tags":["wpf","entity-framework","data-binding","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13277327,"title":"How to bind entities from Entity Framework to DataGrid?","body":"<p>My XAML:</p>\n\n<pre><code>&lt;Window x:Class=\"Newsletter.UI.MessagesWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        Title=\"MessagesWindow\" Name=\"messagesWindow\" Height=\"576\" Width=\"1024\" WindowStartupLocation=\"CenterScreen\" Closed=\"MessagesWindowClosed\"&gt;\n    &lt;Window.Resources&gt;\n        &lt;Style TargetType=\"{x:Type Button}\"&gt;\n            &lt;Setter Property=\"Width\" Value=\"149\"/&gt;\n            &lt;Setter Property=\"Margin\" Value=\"10\"/&gt;\n        &lt;/Style&gt;\n    &lt;/Window.Resources&gt;\n    &lt;Grid&gt;\n        &lt;Grid.RowDefinitions&gt;\n            &lt;RowDefinition Height=\"75\"/&gt;\n            &lt;RowDefinition Height=\"*\"/&gt;\n        &lt;/Grid.RowDefinitions&gt;\n        &lt;StackPanel Grid.Row=\"0\"  Orientation=\"Horizontal\" HorizontalAlignment=\"Center\"&gt;\n            &lt;Grid&gt;\n                &lt;Grid.RowDefinitions&gt;\n                    &lt;RowDefinition Height=\"*\"/&gt;\n                    &lt;RowDefinition Height=\"*\"/&gt;\n                &lt;/Grid.RowDefinitions&gt;\n                &lt;Button Name=\"saveButton\" Grid.Row=\"0\" Content=\"Save\"  Margin=\"10,10,10,5\"/&gt;\n                &lt;TextBox Name=\"searchTextBox\" Grid.Row=\"1\"  Margin=\"10,5,10,10\"/&gt;\n            &lt;/Grid&gt;\n            &lt;Button Name=\"recipientsButton\" Content=\"RECIPIENTS\" Click=\"RecipientsButtonClick\" /&gt;\n            &lt;Button Name=\"createButton\" Content=\"CREATE\" Click=\"CreateButtonClick\" /&gt;\n            &lt;Button Name=\"removeButton\" Content=\"REMOVE\" /&gt;\n            &lt;Button Name=\"editButton\" Content=\"EDIT\" /&gt;\n            &lt;Button Name=\"resendButton\" Content=\"RESEND\"/&gt;\n        &lt;/StackPanel&gt;\n        &lt;DataGrid Name=\"gridMessages\" Grid.Row=\"1\"/&gt;\n    &lt;/Grid&gt;\n&lt;/Window&gt;\n</code></pre>\n\n<p>My .cs code:</p>\n\n<pre><code>private void messagesWindow_Loaded(object sender, RoutedEventArgs e)\n        {\n            using (NewsletterEntities context = new NewsletterEntities())\n            {\n                var query = from m in context.Messages select m;\n                var result = query.ToList();\n                gridMessages.DataContext = result;\n            }\n        }\n</code></pre>\n\n<p><code>Message</code> class generated by EF:</p>\n\n<pre><code>[EdmEntityTypeAttribute(NamespaceName=\"NewsletterModel\", Name=\"Message\")]\n[Serializable()]\n[DataContractAttribute(IsReference=true)]\npublic partial class Message : EntityObject\n{\n    #region Factory Method\n\n/// &lt;summary&gt;\n/// Create a new Message object.\n/// &lt;/summary&gt;\n/// &lt;param name=\"messageID\"&gt;Initial value of the MessageID property.&lt;/param&gt;\n/// &lt;param name=\"subject\"&gt;Initial value of the Subject property.&lt;/param&gt;\n/// &lt;param name=\"content\"&gt;Initial value of the Content property.&lt;/param&gt;\n/// &lt;param name=\"hasAttachments\"&gt;Initial value of the HasAttachments property.&lt;/param&gt;\n/// &lt;param name=\"senderID\"&gt;Initial value of the SenderID property.&lt;/param&gt;\n/// &lt;param name=\"date\"&gt;Initial value of the Date property.&lt;/param&gt;\npublic static Message CreateMessage(global::System.Int32 messageID, global::System.String subject, global::System.String content, global::System.Boolean hasAttachments, global::System.Int32 senderID, global::System.DateTime date)\n{\n    Message message = new Message();\n    message.MessageID = messageID;\n    message.Subject = subject;\n    message.Content = content;\n    message.HasAttachments = hasAttachments;\n    message.SenderID = senderID;\n    message.Date = date;\n    return message;\n}\n\n#endregion\n\n#region Primitive Properties\n\n/// &lt;summary&gt;\n/// No Metadata Documentation available.\n/// &lt;/summary&gt;\n[EdmScalarPropertyAttribute(EntityKeyProperty=true, IsNullable=false)]\n[DataMemberAttribute()]\npublic global::System.Int32 MessageID\n{\n    get\n    {\n        return _MessageID;\n    }\n    set\n    {\n        if (_MessageID != value)\n        {\n            OnMessageIDChanging(value);\n            ReportPropertyChanging(\"MessageID\");\n            _MessageID = StructuralObject.SetValidValue(value);\n            ReportPropertyChanged(\"MessageID\");\n            OnMessageIDChanged();\n        }\n    }\n}\nprivate global::System.Int32 _MessageID;\npartial void OnMessageIDChanging(global::System.Int32 value);\npartial void OnMessageIDChanged()\n</code></pre>\n\n<p>Unfortunately nothing happens, the DataGrid is empty.\nI'm new to data binding in WPF and EF. I hope this problem is simple but I have no idea how to solve it.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13275020,"title":"Entity Framework, SET PK and FK for related table","body":"<p><img src=\"http://i.stack.imgur.com/zgJNC.png\" alt=\"enter image description here\"></p>\n\n<p>I want to make relation Table A and Table B in table A entity class.</p>\n\n<pre><code>[ForeignKey(\"newID\")]\npublic virtual ICollection&lt;TableB&gt; tableBs {get; set;}\n</code></pre>\n\n<p>then it look for newID_ID. </p>\n\n<p>How can I make relation newID and FK?</p>\n\n<p><strong>TableA.newID and TableB.FK</strong></p>\n\n<p><em>Not,\nTableA.newID = TableB.ID</em></p>\n"},{"tags":["c#","asp.net-mvc-3","linq","entity-framework","lambda"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13273012,"title":"How to combine two model list to one model","body":"<p>Please see code below :</p>\n\n<pre><code>public class NewsFilterModel\n{\n    public CtArticleDetail ArticleDetail { get; set; }\n\n    public PcPage Page { get; set; }\n}\n\npublic IEnumerable&lt;NewsFilterModel&gt; GetNewsFilterModelByTagNames(string tagNames, int status)\n{\n     var resultArticle = db.CtArticleDetail.Where(m =&gt; m.tagNames == tagNames);\n     var resultPage  = db.PcPage.Where(m =&gt; m.tagNames == tagNames);\n}\n</code></pre>\n\n<p>Can anyone please advice what the best way to combine two model to one model which is NewsFilterModel ?</p>\n\n<p>What I am trying to achieve is:</p>\n\n<p>NewsFilterModelList</p>\n\n<pre><code>1.Article1\n2.Page1\n3.Article2\n4.Page2\n5.Article3\n6.Page3\n</code></pre>\n\n<p>I've ended this like below: </p>\n\n<pre><code>foreach (var item in pageResult)\n            {\n                resultList.Add(new NewsFilterModel { ArticleDetail = null, Page = item, Date = item.UpdatedOn.ToDateTime() });\n            }\n\n            foreach (var item in tempArticleList)\n            {\n                resultList.Add(new NewsFilterModel { ArticleDetail = item, Page = null, Date = item.LiveDate.ToDateTime() });\n            }\n\n            return resultList.AsEnumerable();\n</code></pre>\n\n<p>Anyone has better idea, please advice.</p>\n"},{"tags":["c#","entity-framework","asp.net-web-api",".net-4.5"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":138,"score":3,"question_id":13077328,"title":"Serialization Issues with Web API and Entity Framework Contract First Many to Many Relationship","body":"<p>I am attempting to use EF with Code First and the Web API.  I don't have any problems until I get into serializing Many-to-Many relationships.  When I attempt to execute the following web api method below I get the following error message:</p>\n\n<pre><code>public class TagsController : ApiController\n{\n\n        private BlogDataContext db = new BlogDataContext();\n\n        // GET api/Tags\n        public IEnumerable&lt;Tag&gt; GetTags()\n        {\n            return db.Tags.AsEnumerable();\n        }\n}\n</code></pre>\n\n<p>I get the following error:</p>\n\n<blockquote>\n  <p>'System.Data.Entity.DynamicProxies.Tag_FF17EDDE6893000F7672649A39962DB0CA591C699DDB73E8C2A56203ED7C7B6D'\n  with data contract name\n  'Tag_FF17EDDE6893000F7672649A39962DB0CA591C699DDB73E8C2A56203ED7C7B6D:http://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies'\n  is not expected. Consider using a DataContractResolver or add any\n  types not known statically to the list of known types - for example,\n  by using the KnownTypeAttribute attribute or by adding them to the\n  list of known types passed to DataContractSerializer.</p>\n</blockquote>\n\n<p>I have read some SO articles (<a href=\"http://stackoverflow.com/questions/11315311/using-navigation-properties-in-entity-framework-code-first\">article 1</a>, <a href=\"http://stackoverflow.com/questions/9071118/efcf-many-to-many-in-a-detached-context\">article 2</a>) that the fix is to add the following attribute:</p>\n\n<blockquote>\n  <p>[DataContract (IsReference=true)]</p>\n</blockquote>\n\n<p>but this has had no effect.  Also using [IgnoreDataMember] does not have an effect.  The only option that does seem to work is to set Configuration.ProxyCreationEnabled to false.  Is this my only option?  Am I missing something?</p>\n\n<p><em><strong>Sample POCO objects:</em></strong></p>\n\n<p><strong>Tag</strong></p>\n\n<pre><code>[DataContract(IsReference = true)]\npublic class Tag\n{\n        public Tag()\n        {\n            this.Blogs = new HashSet&lt;Blog&gt;();\n        }\n\n        [Key]\n        [DataMember]\n        public int Id { get; set; }\n\n        [DataMember]\n        public string Name { get; set; }\n\n        [IgnoreDataMember]\n        public virtual ICollection&lt;Blog&gt; Blogs { get; set; }\n}\n</code></pre>\n\n<p><strong>Blog</strong></p>\n\n<pre><code>[DataContract(IsReference = true)]\npublic class Blog\n{\n    public Blog()\n    {\n        this.Tags = new HashSet&lt;Tag&gt;();\n    }\n\n    [Key]\n    [DataMember]\n    public int Id { get; set; }\n\n    [DataMember]\n    public string Name { get; set; }\n\n    [IgnoreDataMember]\n    public virtual ICollection&lt;Tag&gt; Tags { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework","asp.net-webforms"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13173530,"title":"How to retrieve data from my Entitiy Model in code-behind","body":"<p>I created my tables, then my <code>Entity Model</code> (<code>Model1.edmx</code>).\n<br>I can drag &amp; drop a <code>GridView</code> and <code>EntityDataSource</code> control, they work fine.</p>\n\n<p>but I need to use my data model in code-behind. \n<br>I should be able to query a single record.\n<br>For example, in <code>Page_Load</code> event I want to fill the textboxes with specific record.</p>\n\n<p>I don't know where to begin with, the namespaces, instantiating the object etc. Any help is appreciated.</p>\n\n<p>I'm using <code>WebForms</code>(c#) with <code>EntityFramework</code></p>\n"},{"tags":["linq","entity-framework","sorting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13273325,"title":"linq orderby first item in collection","body":"<p>How do you do OrderBy on a collection within an entity?</p>\n\n<p>For example, this sorts Customers by Name (string)</p>\n\n<pre><code>entities.Customers.OrderBy(c =&gt; c.Name) ...\n</code></pre>\n\n<p>If Customer had an Orders property that was a collection of Order entities and for some reason you wanted to sort Customers on that (lets say by order date), can you do that?</p>\n\n<pre><code>entities.Customers.OrderBy(c =&gt; c.Orders.?)\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13232660,"title":"Concurrency issues with EF5 / Base Repository","body":"<p>I've finished writing a new application which has now been deployed into the live environment however my global error handler is picking up these exceptions several times throughout the day. These errors come in batches and are one of the four in bold. </p>\n\n<p>MVC 4, IIS 6, Windows Server 2003, .Net .4.0, EF 5 (latest from NuGet)</p>\n\n<p><strong>The type 'ARandomModelInMyContext has been mapped more than once.</strong></p>\n\n<p><strong>Index was out of range. Must be non-negative and less than the size of the collection.</strong> </p>\n\n<pre><code>Parameter name: index\nSystem.ThrowHelper.ThrowArgumentOutOfRangeException() at System.Data.Metadata.Edm.MetadataCollection`1.get_Item(Int32 index) at System.Data.Mapping.DefaultObjectMappingItemCollection.ContainsMap(GlobalItem cspaceItem, ObjectTypeMapping&amp; map) at\n</code></pre>\n\n<p><strong>The context cannot be used while the model is being created.</strong></p>\n\n<pre><code>System.Data.Entity.Internal.LazyInternalContext.InitializeContext() at System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType) at System.Data.Entity.Internal.Linq.InternalSet`1.Initialize()\n</code></pre>\n\n<p><strong>The underlying provider failed on Open. The connection was not closed. The connection's current state is connecting.</strong></p>\n\n<p>The structure of the application is a pretty standard MVC4 application with a Service Layer and a repository layer.</p>\n\n<ul>\n<li>A service creates a repo in the constructor </li>\n<li>Repository creates a new Context in the repository constructor like so:</li>\n</ul>\n\n<p><code>public class MyRepository : BaseRepository&lt;MyModel&gt;, IMyRepository</code></p>\n\n<p>With the constructor:</p>\n\n<pre><code>public MyRepository() : base(new MyEntities())\n{\n}\n</code></pre>\n\n<p>Base Repository looks like this:</p>\n\n<pre><code>public class BaseRepository&lt;TEntity&gt; where TEntity : class\n{\n    internal CRMEntities Context;\n    internal DbSet&lt;TEntity&gt; dbSet;\n    public BaseRepository(MyEntities context)\n    {\n        this.Context = context;\n        dbSet = context.Set&lt;TEntity&gt;();\n    }\n}\n</code></pre>\n\n<p>There shouldn't be any concurrency issues as I'm not making directly using any threading or async.</p>\n\n<p>Any ideas? Can my repository structure be improved? I've made all the constructors DI-able however I'm not using an IoC container yet.</p>\n\n<p>Would wrapping the construction of the Context in the repository in lock be worth while? For example:  </p>\n\n<pre><code>public class BaseRepository&lt;TEntity&gt; where TEntity : class\n{\n    internal MyEntities Context;\n    internal DbSet&lt;TEntity&gt; dbSet;\n    private static object _lock = new object();\n\n    public BaseRepository(MyEntities context)\n    {\n        lock (_lock)\n        {\n            this.Context = context;\n            dbSet = context.Set&lt;TEntity&gt;();\n        }\n    }\n }\n</code></pre>\n"},{"tags":["c#","asp.net","visual-studio-2008","entity-framework"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":10601,"score":2,"question_id":1562807,"title":"Entity framework with \"Group By\" and/or \"Order by\"","body":"<p>Say we've got a project that allows user to download things. On the main page, I want to show the Most downloaded files ordered by the number of download! All that using EF.</p>\n\n<p>How can i do this !! I've tried many things with Group By (Its a nightmare when you've got a lot of informations in an object). And i still dunno how to do this...</p>\n\n<pre><code>var query = from details in m_context.TransactionDetails\n                        where details.Chanson != null\n                        group details by details.Items into AnItem\n                        orderby AnItem.Count()\n                        select new Item() {\n                            IdItem = Chansons.Key.IdItem,\n                            ItemState= Chansons.Key.ItemState,\n                            [...This object got something like 20 including links to other objects ... ]\n                        };\n</code></pre>\n\n<p>Anyone have an idea?</p>\n\n<p>Thanks :o)</p>\n\n<p>Oh and sorry for my english, I'm giving my best but im from Quebec (Usualy talk french).</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":10687261,"title":"change t4template to add Long Description","body":"<p>I use a t4template to create the C# classes for the entities. One thing missing in these generated classes is de documentation that I enter in the Entity Framework designer.</p>\n\n<p>Does anyone know which statement I can use to add the Long Description of a property to the generated code?</p>\n"},{"tags":["c#",".net","wpf","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":22,"down_vote_count":1,"view_count":4668,"score":21,"question_id":6089403,"title":"Delete all entities in Entity Framework","body":"<p>I want to delete content of all tables (all entities using Entity Framework 4+).\nHow can this be done?</p>\n\n<p>Thanks, James</p>\n"},{"tags":["entity-framework","join","linq-to-entities","entity-framework-4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13272945,"title":"Join in Linq-To-Entities when no ID properties available","body":"<p>Given an <code>Order</code> entity with many <code>OrderItem</code>s, whereas each has a <code>Discount</code>, we are trying to retrieve all Orders with at least one discount that is more than <code>50%</code> by joining orders and order items.</p>\n\n<p>There are a lot of articles about joining two entities in Linq-To-Entities, but they have all in common that they rely on the Foreign Key being exposed as a navigation property:</p>\n\n<pre><code>db.Orders.Join(\n    db.OrderItems.Where(i =&gt; i.Discount &gt; 50),\n    o =&gt; o.Id,\n    i =&gt; i.OrderId)\n</code></pre>\n\n<p>However, our <code>OrderItem</code>does not have an <code>OrderId</code> property. The <code>Order</code> has a <code>OrderItems</code> property to identify the relationship, the foreign key is managed by EF4.1 CodeFirst.</p>\n\n<p><strong>Question:</strong> Is there a way to perform a join by indicating <code>o =&gt; o.OrderItems</code> for identifying the relationship and have EF figure out which FK to use for the join?</p>\n\n<hr>\n\n<p>On the background: We have tried to use <code>.Any</code> no the <code>OrderItems</code> but <strong>DevArt dotConnect</strong> has a breaking issue with that:</p>\n\n<pre><code>db.Orders.Where(o =&gt; o.OrderItems.Any(i =&gt; i.Discount &gt; 50))\n</code></pre>\n"},{"tags":["c#",".net","entity-framework",".net-assembly"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13271262,"title":"Entity Framework meta data","body":"<p>I have a piece of code</p>\n\n<pre><code> using (InContext inContext = new InContext())\n</code></pre>\n\n<p>When I right click the definition, it points to <code>C:\\Users\\me\\AppData\\Local\\Temp\\....</code></p>\n\n<p>What is that? A defined dll?</p>\n\n<pre><code>    #region Assembly SharedObjects.dll, v4.0.30319\n   // C:\\source\\blah\\blah\\packages\\SharedObjects.1.0.4659.22817\\lib\\net40\\SharedObjects.dll\n    #endregion\n\n   using blahSharedObjects;\n   using System;\n   using System.Data.Entity;\n\n   namespace something\n   {\n       public class InContext : DbContext\n   {\n       public InContext();\n       public InContext(string connectionString);\n\n\n        public DbSet&lt;InDetails&gt; InDetailRecords { get; set; }\n        public string IPAddress { get; set; }\n\n        public string UserName { get; set; }\n\n   }\n</code></pre>\n\n<p>}</p>\n"},{"tags":["entity-framework","dynamic-data"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12724354,"title":"Error in Using Dynamic Data Entities WebSite in VS2012","body":"<p>I decided to use Dynamic Data Entities website in vs2012.\nSo, I created this website,then added App_Code directory and added a new edmx to it and named it myDB.edmx. After that I uncommented the code line in global.asax which registers the entity context :</p>\n\n<pre><code>DefaultModel.RegisterContext(typeof(myDBEntities), new ContextConfiguration() { ScaffoldAllTables = true });\n</code></pre>\n\n<p>But when I run the website this error occurs :</p>\n\n<pre><code>The context type 'myDBEntities' is not supported.\n</code></pre>\n\n<p>how can I fix it?</p>\n\n<p>p.s: You now there are some differences between using L2S by Dynamic Data L2S website AND using entity framework by Dynamic Data Entities website.</p>\n"},{"tags":["performance","entity-framework","generics","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13270418,"title":"Generics around Entityframework DbContext causes performance degradation?","body":"<p>I wrote a simple import/export application that transforms data from source->destination using EntityFramework and AutoMapper. It basically:</p>\n\n<ol>\n<li><strong>selects</strong> <code>batchSize</code> of records from the source table</li>\n<li>'<strong>maps</strong>' data from source->destination entity</li>\n<li><strong>add</strong> new destination entities to destination table and <strong>saves</strong> context</li>\n</ol>\n\n<p>I move around <em>500k records in under 5 minutes</em>. After I <em>refactored</em> the code <em>using generics</em> the performance <em>drops drastically to 250 records in 5 minutes.</em></p>\n\n<p><strong>Are my delegates that return <code>DbSet&lt;T&gt;</code> properties on the <code>DbContext</code> causing these problems? Or is something else going on?</strong></p>\n\n<h1>Fast non-generic code:</h1>\n\n<pre><code>public class Importer\n{        \n    public void ImportAddress()\n    {\n        const int batchSize = 50;\n        int done = 0;\n        var src = new SourceDbContext();\n\n        var count = src.Addresses.Count();\n\n        while (done &lt; count)\n        {\n            using (var dest = new DestinationDbContext())\n            {\n                var list = src.Addresses.OrderBy(x =&gt; x.AddressId).Skip(done).Take(batchSize).ToList();\n                list.ForEach(x =&gt; dest.Address.Add(Mapper.Map&lt;Addresses, Address&gt;(x)));\n\n                done += batchSize;\n\n                dest.SaveChanges();\n            }\n        }\n\n        src.Dispose();\n    }\n}\n</code></pre>\n\n<h1>(Very) slow generic code:</h1>\n\n<pre><code>public class Importer&lt;TSourceContext, TDestinationContext&gt;\n    where TSourceContext : DbContext\n    where TDestinationContext : DbContext\n{\n    public void Import&lt;TSourceEntity, TSourceOrder, TDestinationEntity&gt;(Func&lt;TSourceContext, DbSet&lt;TSourceEntity&gt;&gt; getSourceSet, Func&lt;TDestinationContext, DbSet&lt;TDestinationEntity&gt;&gt; getDestinationSet, Func&lt;TSourceEntity, TSourceOrder&gt; getOrderBy) \n        where TSourceEntity : class\n        where TDestinationEntity : class\n    {\n        const int batchSize = 50;\n        int done = 0;\n        var ctx = Activator.CreateInstance&lt;TSourceContext&gt;();\n        //Does this getSourceSet delegate cause problems perhaps?\n\n        //Added this\n        var set = getSourceSet(ctx);\n\n        var count = set.Count(); \n\n        while (done &lt; count)\n        {\n            using (var dctx = Activator.CreateInstance&lt;TDestinationContext&gt;())\n            {\n                var list = set.OrderBy(getOrderBy).Skip(done).Take(batchSize).ToList(); \n                //Or is the db-side paging mechanism broken by the getSourceSet delegate?\n                //Added this\n                var destSet = getDestinationSet(dctx);\n                list.ForEach(x =&gt; destSet.Add(Mapper.Map&lt;TSourceEntity, TDestinationEntity&gt;(x)));\n\n                done += batchSize;\n                dctx.SaveChanges();\n            }\n        }\n\n        ctx.Dispose();\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","entity-framework","objectcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13260422,"title":"ObjectContext Error in Dev but Not when Published","body":"<p>Given the classes below, firing up the website in Visual Studio gives me the following error when <code>home/index</code> is called (this is actually the inner exception).</p>\n\n<p><code>A transport-level error has occurred when receiving results from the server. (provider: Shared Memory Provider, error: 0 - The handle is invalid.)</code></p>\n\n<pre><code>at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\nat System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\nat System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\nat System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error)\nat System.Data.SqlClient.TdsParserStateObject.ReadSni(DbAsyncResult asyncResult, TdsParserStateObject stateObj)\nat System.Data.SqlClient.TdsParserStateObject.ReadNetworkPacket()\nat System.Data.SqlClient.TdsParserStateObject.ReadBuffer()\nat System.Data.SqlClient.TdsParserStateObject.ReadByte()\nat System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\nat System.Data.SqlClient.SqlDataReader.ConsumeMetaData()\nat System.Data.SqlClient.SqlDataReader.get_MetaData()\nat System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\nat System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\nat System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\nat System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\nat System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\nat System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\nat System.Data.Common.DbCommand.ExecuteReader(CommandBehavior behavior)\nat System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior)\n</code></pre>\n\n<p>However if I publish the exact same code locally and hit the site using WebMatrix, it works fine.</p>\n\n<p>I'm using SQL Server 2008 Express too if that makes a difference. Please advise if any more information is needed.</p>\n\n<p>Controller</p>\n\n<pre><code>public class HomeController : BaseController\n{\n    public ActionResult Index()\n    {\n        var candidates = BusinessObj.AllOf&lt;Candidate&gt;().ToList();\n        return View(candidates);\n    }\n}\n</code></pre>\n\n<p>BaseController</p>\n\n<pre><code>public class BaseController : Controller\n{\n    protected ITestBusinessObject BusinessObj { get; set; }\n\n    public BaseController()\n    {\n        BusinessObj = new Business.TestBusinessObj();\n    }\n}\n</code></pre>\n\n<p>TestBusinessObj (Entities is an EF edmx class)</p>\n\n<pre><code>public class TestBusiness : ITestBusinessObject\n{\n    private Entities DB = new Entities();\n    private string ContainerName = \"Entities\";\n\n    public IEnumerable&lt;T&gt; AllOf&lt;T&gt;() where T : class, new()\n    {\n        return DB.CreateObjectSet&lt;T&gt;(ContainerName.GetEntitySetName&lt;T&gt;());\n    }\n\n    private static string GetEntitySetName&lt;T&gt;(this string containerName) where T : new()\n    {\n        var name = new T().GetType().Name;\n        if (name.EndsWith(\"y\"))\n        {\n            name = name.Substring(0, name.Length - 1) + \"ies\";\n        }\n        else\n        {\n            name = name + \"s\";\n        }\n        return string.Format(\"{0}.{1}\", containerName, name);\n    }\n}\n</code></pre>\n"},{"tags":["entity-framework","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":697,"score":1,"question_id":2630045,"title":"ADO.NET Entity Framework: Can I have multiple entity types for the same row","body":"<p>I have a base class Participants inherited by Artist, Author and TextWriter.\nI have only one table in the data store:\nParticipants {\n    ID,\n    FirstName,\n    LastName,\n    IsArtist,\n    IsAuthor,\n    IsTextWriter,\n}\nThe idea is to have a class for all the roles that a participant can have.</p>\n\n<p>I've managed to create the edmx file but when I try to get an Participant (as Artist) that is also an Author I receive the following error:</p>\n\n<p>All objects in the EntitySet 'Participants' must have unique primary keys. However, an instance of type 'Artist' and an instance of type 'Author' both have the same primary key value, 'EntitySet=Participants;ID=1'.</p>\n\n<p>Thank you</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13253315,"title":"Entity Framework does not generate association property","body":"<p>So.</p>\n\n<p>I'm having trouble fixing this little problem.</p>\n\n<p>I have several classes, and it's all nice and good. Right up until now. I have now added another class (MatchResult), and it works. \n<img src=\"http://i.stack.imgur.com/QYrFi.png\" alt=\"Before\"></p>\n\n<p>But when I try to make the correct association: </p>\n\n<p><img src=\"http://i.stack.imgur.com/ojGaq.png\" alt=\"enter image description here\"></p>\n\n<p>It fails with a runtime exception.</p>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>Schema specified is not valid. Errors: </p>\n  \n  <p>The relationship 'DbModel.FK_ProductPrice' was not loaded\n  because the type 'DbModel.Product' is not available.</p>\n  \n  <p>The following information may be useful in resolving the previous\n  error:</p>\n  \n  <p>The required property 'MatchResults' does not exist on the type\n  'PriceMonitor.Model.Product'.</p>\n  \n  <p>The relationship 'DbModel.FK_WebshopProduct' was not loaded\n  because the type 'DbModel.Product' is not available.</p>\n  \n  <p>The following information may be useful in resolving the previous\n  error:</p>\n  \n  <p>The required property 'MatchResults' does not exist on the type\n  'PriceMonitor.Model.Product'.</p>\n</blockquote>\n\n<p>It seems - for some reason - that EF does not create the MatchResults property on the Product class.</p>\n\n<p>This approach has worked on every single class I've ever made using EF. Up until now.</p>\n"},{"tags":["entity-framework","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13269996,"title":"Stored procedure arguments that doesn't map to object","body":"<p>I have an entity model, that updates with a stored procedure.\nOn of the arguments is the current username, and this is not included in the model.\nThe procedure accepts it as a blank, so in essence, I don't need to use it.\nBUT, in my function mapping, I can't see to just leave it blank. Atleast, my entity model will complain about it later.</p>\n\n<p>How do I handle cases like this?</p>\n"},{"tags":["c#","entity-framework","generics","types"],"answer_count":2,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":54,"score":5,"question_id":13269002,"title":"Getting List of Objects by a type given by a string","body":"<p>I get objects by</p>\n\n<pre><code>IEnumerable&lt;ObjectStateEntry&gt; om = context.ObjectStateManager.GetObjectStateEntries(System.Data.EntityState.Modified);        \n</code></pre>\n\n<p>How can I get a <code>List</code> of the objects with a type given by a string?</p>\n\n<pre><code>Type typ = Type.GetType(\"mytype\");\nvar om2 = om.Select(s =&gt; s.Entity).OfType&lt;typ&gt;(); // does not work\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-4","ef-code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":13268665,"title":"Modify Many-to-Many table Created By EF5 Code First","body":"<p>I have 2 classes and the one is a collection property of the other like below.</p>\n\n<pre><code>public class NotificationMessage\n{\n    public int ID { get; set; }\n    public string Message { get; set; }\n    public virtual ICollection&lt;Device&gt; Devices { get; set; }\n}\n\npublic class Device\n{\n    public int ID  { get; set; }\n    public string Token  { get; set; }\n    public virtual ICollection&lt;NotificationMessage&gt; NotificationMessages { get; set; }\n}\n\npublic class NotificationMessageDevice\n{\n    [Column(Order = 0), Key, ForeignKey(\"NotificationMessage\")]\n    public int NotificationMessageID { get; set; }\n\n    [Column(Order = 1), Key, ForeignKey(\"Device\")]\n    public int DeviceID { get; set; }\n\n\n    public virtual Device Device { get; set; }\n    public virtual NotificationMessage NotificationMessage { get; set; }\n}\n</code></pre>\n\n<p>When you create a relationship like above, the entity flamework is enough clever to create many to many relationship on Database by creating NotificationMessageDevices.</p>\n\n<p>The problem rises in here. Now I want to add CreateDate to the table 'NotificationMessageDevices' . What I have done is that I have created a new class called 'NotificationMessageDevice' in the way entity framework would create the table \"NotificationMessageDevices\" in existing database. I added new properties and called Update-Verbose. The very first exception was about missing ID property it wanted me to add public int ID {get;set;} however when I add this up it realizes the ID property is index property so that I need to remove all the data in that table. </p>\n\n<p>What is the workaround of this case on Entity Framework without data loss :) </p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":161,"score":4,"question_id":12707682,"title":"How to map a stored procedure using DBContext in ASP.NET MVC 3 Entity Framework","body":"<p>I do mapping here for tables.. How to map stored procedures here?</p>\n\n<pre><code>public class AppDBContext : DbContext\n{\n    public DbSet&lt;UserAccount&gt; UserAccount { get; set; }\n    public DbSet&lt;GetUserAccounts&gt; GetGetUserAccounts { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;UserAccount&gt;().ToTable(\"UserAccount\");\n        modelBuilder.Entity&lt;Customer&gt;().ToTable(\"Customer\");\n\n        base.OnModelCreating(modelBuilder);\n    }\n}\n</code></pre>\n"},{"tags":["sql-server","entity-framework","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13265914,"title":"How do I build my EF models so they are based on a stored procedure select","body":"<p>I am completely new to EF and a bit lost, to be honest.\nI have an existing database, and everything is going through stored procedures. Even the selects are stored procedures. \nMy model needs to use this, but I have no idea how to begin.\nI assume I can really use the auto-generate, if the objects are to be based on the stored procedures output, instead of the tables.</p>\n\n<p>I have tried googling, but to be honest, I don't think I know what to look for.</p>\n\n<p>If I create an empty entity framework model, and build all the objects myself, can I somehow get the data by executing a stored procedure instead of mapping directly to a table?</p>\n\n<p>And how do I do this? \nAny articles I need to read? My searching seems to always end up with fancy auto-generation articles, that seems to not apply in my case.</p>\n\n<p>I know this is kind of a broad question, but I am somewhat lost here. Any help is much appreciated.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>So, I have learnt that I can create a complex type, based on the stored select. But, I don't really see a way, to map update/insert/delete procedures onto this. I don't really understand how to link the entity type and the complex type together, if that is even possible or the way to do it.</p>\n"},{"tags":["c#","sql-server","entity-framework","extended-properties"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13268446,"title":"Get Extended Property in edmx modeling Db","body":"<p>I have a database modelling by Entity Framework. I need to read the extended properties of each table through the object context associated to my Db. How can i do?</p>\n\n<p>Thank's in advance</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","automapper"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13266570,"title":"Automapper - Returning right value but not mapping","body":"<p>In my MVC webapplication I got the following automapper code:</p>\n\n<p><strong>The configure:</strong></p>\n\n<pre><code> public static void Configure()\n        {\n            Mapper.CreateMap&lt;string, List&lt;Ruimte&gt;&gt;().ConvertUsing&lt;StringCombinatieRuimtesConverter&gt;();\n        }\n</code></pre>\n\n<p><strong>The custom converter:</strong></p>\n\n<pre><code>public class StringCombinatieRuimtesConverter : ITypeConverter&lt;string, List&lt;Ruimte&gt;&gt;\n    {\n        #region Implementation of ITypeConverter&lt;in string,out List&lt;Ruimte&gt;&gt;\n\n        public List&lt;Ruimte&gt; Convert(ResolutionContext context)\n        {\n            if (context.SourceValue == null)\n            {\n                return new List&lt;Ruimte&gt;();\n            }\n\n            return context.SourceValue.ToString().Split(',').Select(r =&gt; new Ruimte { Id = int.Parse(r) }).ToList();\n        }\n\n        #endregion\n    }\n</code></pre>\n\n<p><strong>And I call it with the following code:</strong></p>\n\n<pre><code>            var ruimteList = new List&lt;Ruimte&gt;();\n\n            // Update the CombinatieVan\n            Mapper.Map(command.CombinatieRuimteVan, ruimteList);\n</code></pre>\n\n<p>If I debug the command.CombinatieRuimteVan is: 2,3,4,6. This is fine.\nNow if I debug the converter it does return 4 objects of the class \"Ruimte\" with as Id the numbers stated before. But after the Mapper.Map method is done the \"ruimteList\" is still an empty list.</p>\n\n<p>Does anyone know what is going wrong here? The automapper works fine on another spot in my application where I automap a whole entity containing the \"CombinatieRuimteVan\" set. But when I sololy convert the string to the list it doesn't seem to work.</p>\n"},{"tags":["asp.net","entity-framework","linq-to-sql","linq-to-entities","entity-relationship"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13261680,"title":"Insert record using entity Framework (database first)","body":"<p>there are 3 database tables (movies, reviews, users)</p>\n\n<p>the reviews table include ( MemeberID, MovieID, Review Text, Rate, ReviewDate)\n(the MemeberID, and MovieID in the Review are the FK of the members table and the movies table)\nThe Movie can have many reviews, and i'm trying to add review to a movie</p>\n\n<p>even I have movie class and the member class,  I have a problem, in order to insert review, i need to reference it to movie and users , link them, and i don't know how to do it</p>\n\n<p><strong>this code make a error:</strong></p>\n\n<pre><code>\" The relationship between the two objects cannot be defined because they are attached to different ObjectContext objects. \"\n</code></pre>\n\n<p>This is my code...</p>\n\n<pre><code>public bool InsertNewReview(Movie _TheMovie, Member _TheMember, string _Text, byte _Rate, DateTime _ReviewDate)\n    {\n\n       Review ReviewToInsert = new Review()\n            {\n                MovieID = _TheMovie.MovieID,\n                MemberID = _TheMember.MemberID,\n                Movie = _TheMovie,\n                Member =  _TheMember,\n                Rate = _Rate,\n                ReviewDate = _ReviewDate,\n                ReviewText = _Text\n            };\n\n        videoLib.Reviews.AddObject(ReviewToInsert);\n        videoLib.SaveChanges();\n\n            return true;\n\n    }\n</code></pre>\n\n<p>..</p>\n\n<p><strong>there are more data to insert to the Review class</strong></p>\n\n<p>Images: <a href=\"http://www.gamesff.com/1.png\" rel=\"nofollow\">here</a></p>\n\n<p>..</p>\n\n<p><strong>and the tables:</strong> (the \"all columns\" isn't a field in database tables)</p>\n\n<p>Images: <a href=\"http://www.gamesff.com/2.png\" rel=\"nofollow\">here</a></p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13266404,"title":"Entity framework: automatic deletion of parent entity","body":"<p>Consider the following model classes:</p>\n\n<pre><code> public class Thing\n{\n    public int Id { get; set; }\n    [Required]\n    public Text Subject { get; set; }\n    [Required]\n    public Text Body { get; set; }\n}\n\npublic class Text\n{\n    public int Id { get; set; }\n    public string Value { get; set; }\n}\n</code></pre>\n\n<p>The model is simple - each Thing must reference to two Text entities. Each Text entry at any point in time should be referenced only by a single entity of any other type (Thing is not the only one).</p>\n\n<p>Is it possible to configure EF5 to automatically delete all referenced Texts when Thing gets deleted (via <code>context.Set&lt;Thing&gt;().Remove</code>), or should it be done with a database trigger?</p>\n"},{"tags":["c#","entity-framework","ado.net"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13263557,"title":"db.savechanges() is not working","body":"<p>I'm following this tutorial <a href=\"http://msdn.microsoft.com/en-us/data/ff706685.aspx\" rel=\"nofollow\">Creating Master-Details Windows Forms with the Entity Framework</a>\nbut the <code>db.Savechanges()</code> isn't working if I modified some column or add a new row. According to this video tutorial it will work but it doesn't.</p>\n\n<p><b>Product_Form.cs</b></p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Drawing;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Windows.Forms;\n\nnamespace RemoteSynchronizer\n{\n    public partial class Product : Form\n    {\n\n        ProductsEntities db = new ProductsEntities();\n        public Product()\n        {\n            InitializeComponent();\n        }\n\n        private void Product_Form_Load(object sender, EventArgs e)\n        {\n            product_DBindingSource.DataSource = db.Product_D.ToList();\n        }\n\n        private void bindingNavigatorAddNewItem_Click(object sender, EventArgs e)\n        {\n\n        }\n\n        private void product_DBindingNavigatorSaveItem_Click(object sender, EventArgs e)\n        {\n            // Product_D obj = new Product_D();\n            // obj.PCode = pCodeTextBox.Text;\n            // obj.Name = nameTextBox.Text;\n            // obj.Batch = batchTextBox.Text;\n            // obj.Expiry = expiryTextBox.Text;\n            // obj.Price = priceTextBox.Text;\n\n            //try\n            // {\n            //     Product_D temp = db.Product_D.Single(t =&gt; t.PCode == pCodeTextBox.Text);\n\n            //     MessageBox.Show(\"Product Exists\");\n            // }\n            // catch \n            // {\n            //     db.Product_D.Add(obj);\n                 db.SaveChanges();\n\n             //}\n\n        }\n\n        private void bindingNavigatorDeleteItem_Click(object sender, EventArgs e)\n        {\n\n        }\n\n    }\n}\n</code></pre>\n\n<p>When I try to use comment method in code it gives an error</p>\n\n<p><b>Error</b></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>************** Exception Text **************\nSystem.Data.Entity.Infrastructure.DbUpdateException: Unable to update the EntitySet 'Product_D' because it has a DefiningQuery and no &lt;InsertFunction&gt; element exists in the &lt;ModificationFunctionMapping&gt; element to support the current operation. ---&gt; System.Data.UpdateException: Unable to update the EntitySet 'Product_D' because it has a DefiningQuery and no &lt;InsertFunction&gt; element exists in the &lt;ModificationFunctionMapping&gt; element to support the current operation.\n   at System.Data.SqlClient.SqlGen.DmlSqlGenerator.ExpressionTranslator.Visit(DbScanExpression expression)\n   at System.Data.Common.CommandTrees.DbScanExpression.Accept(DbExpressionVisitor visitor)\n   at System.Data.SqlClient.SqlGen.DmlSqlGenerator.GenerateInsertSql(DbInsertCommandTree tree, SqlVersion sqlVersion, List`1&amp; parameters)\n   at System.Data.SqlClient.SqlGen.SqlGenerator.GenerateSql(DbCommandTree tree, SqlVersion sqlVersion, List`1&amp; parameters, CommandType&amp; commandType, HashSet`1&amp; paramsToForceNonUnicode)\n   at System.Data.SqlClient.SqlProviderServices.CreateCommand(DbProviderManifest providerManifest, DbCommandTree commandTree)\n   at System.Data.SqlClient.SqlProviderServices.CreateCommand(DbCommandTree commandTree)\n   at System.Data.Mapping.Update.Internal.UpdateTranslator.CreateCommand(DbModificationCommandTree commandTree)\n   at System.Data.Mapping.Update.Internal.DynamicUpdateCommand.CreateCommand(UpdateTranslator translator, Dictionary`2 identifierValues)\n   at System.Data.Mapping.Update.Internal.DynamicUpdateCommand.Execute(UpdateTranslator translator, EntityConnection connection, Dictionary`2 identifierValues, List`1 generatedValues)\n   at System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager stateManager, IEntityAdapter adapter)\n   at System.Data.EntityClient.EntityAdapter.Update(IEntityStateManager entityCache)\n   at System.Data.Objects.ObjectContext.SaveChanges(SaveOptions options)\n   at System.Data.Entity.Internal.InternalContext.SaveChanges()\n   --- End of inner exception stack trace ---\n   at System.Data.Entity.Internal.InternalContext.SaveChanges()\n   at System.Data.Entity.Internal.LazyInternalContext.SaveChanges()\n   at System.Data.Entity.DbContext.SaveChanges()\n   at RemoteSynchronizer.Product.product_DBindingNavigatorSaveItem_Click(Object sender, EventArgs e) in e:\\Study\\Project\\RemoteSynchronizer\\RemoteSynchronizer\\Product_Form.cs:line 50\n   at System.Windows.Forms.ToolStripItem.RaiseEvent(Object key, EventArgs e)\n   at System.Windows.Forms.ToolStripButton.OnClick(EventArgs e)\n   at System.Windows.Forms.ToolStripItem.HandleClick(EventArgs e)\n   at System.Windows.Forms.ToolStripItem.HandleMouseUp(MouseEventArgs e)\n   at System.Windows.Forms.ToolStripItem.FireEventInteractive(EventArgs e, ToolStripItemEventType met)\n   at System.Windows.Forms.ToolStripItem.FireEvent(EventArgs e, ToolStripItemEventType met)\n   at System.Windows.Forms.ToolStrip.OnMouseUp(MouseEventArgs mea)\n   at System.Windows.Forms.Control.WmMouseUp(Message&amp; m, MouseButtons button, Int32 clicks)\n   at System.Windows.Forms.Control.WndProc(Message&amp; m)\n   at System.Windows.Forms.ScrollableControl.WndProc(Message&amp; m)\n   at System.Windows.Forms.ToolStrip.WndProc(Message&amp; m)\n   at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message&amp; m)\n   at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message&amp; m)\n   at System.Windows.Forms.NativeWindow.Callback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)\n\n\n************** Loaded Assemblies **************\nmscorlib\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.18010 built by: FX45RTMGDR\n    CodeBase: file:///C:/Windows/Microsoft.NET/Framework/v4.0.30319/mscorlib.dll\n----------------------------------------\nRemoteSynchronizer\n    Assembly Version: 1.0.0.0\n    Win32 Version: 1.0.0.0\n    CodeBase: file:///E:/Study/Project/RemoteSynchronizer/RemoteSynchronizer/bin/Debug/RemoteSynchronizer.exe\n----------------------------------------\nSystem.Windows.Forms\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Windows.Forms/v4.0_4.0.0.0__b77a5c561934e089/System.Windows.Forms.dll\n----------------------------------------\nSystem.Drawing\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Drawing/v4.0_4.0.0.0__b03f5f7f11d50a3a/System.Drawing.dll\n----------------------------------------\nSystem\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.18016 built by: FX45RTMGDR\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System/v4.0_4.0.0.0__b77a5c561934e089/System.dll\n----------------------------------------\nSystem.Configuration\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Configuration/v4.0_4.0.0.0__b03f5f7f11d50a3a/System.Configuration.dll\n----------------------------------------\nSystem.Xml\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Xml/v4.0_4.0.0.0__b77a5c561934e089/System.Xml.dll\n----------------------------------------\nSystem.Web\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/System.Web/v4.0_4.0.0.0__b03f5f7f11d50a3a/System.Web.dll\n----------------------------------------\nSystem.Core\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Core/v4.0_4.0.0.0__b77a5c561934e089/System.Core.dll\n----------------------------------------\nEntityFramework\n    Assembly Version: 5.0.0.0\n    Win32 Version: 5.0.20627.0\n    CodeBase: file:///E:/Study/Project/RemoteSynchronizer/RemoteSynchronizer/bin/Debug/EntityFramework.DLL\n----------------------------------------\nSystem.Data.Entity\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Data.Entity/v4.0_4.0.0.0__b77a5c561934e089/System.Data.Entity.dll\n----------------------------------------\nAnonymously Hosted DynamicMethods Assembly\n    Assembly Version: 0.0.0.0\n    Win32 Version: 4.0.30319.18010 built by: FX45RTMGDR\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/mscorlib/v4.0_4.0.0.0__b77a5c561934e089/mscorlib.dll\n----------------------------------------\nAccessibility\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/Accessibility/v4.0_4.0.0.0__b03f5f7f11d50a3a/Accessibility.dll\n----------------------------------------\nSystem.Data\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/System.Data/v4.0_4.0.0.0__b77a5c561934e089/System.Data.dll\n----------------------------------------\nSystem.Transactions\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/System.Transactions/v4.0_4.0.0.0__b77a5c561934e089/System.Transactions.dll\n----------------------------------------\nSystem.Numerics\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Numerics/v4.0_4.0.0.0__b77a5c561934e089/System.Numerics.dll\n----------------------------------------\nSystem.Data.OracleClient\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/System.Data.OracleClient/v4.0_4.0.0.0__b77a5c561934e089/System.Data.OracleClient.dll\n----------------------------------------\nSystem.Xml.Linq\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Xml.Linq/v4.0_4.0.0.0__b77a5c561934e089/System.Xml.Linq.dll\n----------------------------------------\nSystem.EnterpriseServices\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_32/System.EnterpriseServices/v4.0_4.0.0.0__b03f5f7f11d50a3a/System.EnterpriseServices.dll\n----------------------------------------\nEntityFrameworkDynamicProxies-RemoteSynchronizer\n    Assembly Version: 1.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Data.Entity/v4.0_4.0.0.0__b77a5c561934e089/System.Data.Entity.dll\n----------------------------------------\nSystem.Runtime.Serialization\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929 built by: FX45RTMREL\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.Runtime.Serialization/v4.0_4.0.0.0__b77a5c561934e089/System.Runtime.Serialization.dll\n----------------------------------------\nSystem.ComponentModel.DataAnnotations\n    Assembly Version: 4.0.0.0\n    Win32 Version: 4.0.30319.17929\n    CodeBase: file:///C:/Windows/Microsoft.Net/assembly/GAC_MSIL/System.ComponentModel.DataAnnotations/v4.0_4.0.0.0__31bf3856ad364e35/System.ComponentModel.DataAnnotations.dll\n----------------------------------------\nMicrosoft.SqlServer.Types\n    Assembly Version: 11.0.0.0\n    Win32 Version: 2011.0110.2100.060 ((SQL11_RTM).120210-1917 )\n    CodeBase: file:///C:/Windows/assembly/GAC_MSIL/Microsoft.SqlServer.Types/11.0.0.0__89845dcd8080cc91/Microsoft.SqlServer.Types.dll\n----------------------------------------\n\n************** JIT Debugging **************\nTo enable just-in-time (JIT) debugging, the .config file for this\napplication or computer (machine.config) must have the\njitDebugging value set in the system.windows.forms section.\nThe application must also be compiled with debugging\nenabled.\n\nFor example:\n\n&lt;configuration&gt;\n    &lt;system.windows.forms jitDebugging=\"true\" /&gt;\n&lt;/configuration&gt;\n\nWhen JIT debugging is enabled, any unhandled exception\nwill be sent to the JIT debugger registered on the computer\nrather than be handled by this dialog box.\n</code></pre>\n\n<p>How to get rid of this problem? I'm trying to solve this by simple method <code>db.savechanges()</code> but it won't work.</p>\n"},{"tags":["c#","sql-server","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13259655,"title":"Data integrity in Entity Framework","body":"<p>Are there any consensus as to what is considered the best method in always maintaining data integrity in Entity Framework. i.e. when adding or deleting entities, how do I make sure the loaded model is the most recent, and that nothing has changed on the db behind my back?</p>\n\n<p>A rough method that seem to work for me in the majority of cases, is to reload the context between sessions, i.e. not to have a persistent model, and reload/refresh in case of an error. This seems to work in cases of low data clashes, however is very costly when lots of changes happen in different services. Is there a flag to query if the data/row on disk have changed or event to make this refresh automatic, i.e. update any subscribers of certain tables/rows?</p>\n"},{"tags":["entity-framework","dataannotations"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":417,"score":0,"question_id":5591586,"title":"Dataannotation with EF","body":"<p>I have tried Dataannotation as described <a href=\"http://www.briankeating.net/blog/post/2011/02/28/Asp-MVC-Entity-Framework-and-Data-annotations.aspx\" rel=\"nofollow\">http://www.briankeating.net/blog/post/2011/02/28/Asp-MVC-Entity-Framework-and-Data-annotations.aspx</a>. But it does not worked for me. </p>\n\n<p>I have a table with the following structure </p>\n\n<pre><code> Table - Category\n            id int (pk not null)\n            CategoryName varchar(100) (null)\n</code></pre>\n\n<p>I already created my edmx file and all.</p>\n\n<p>I have created the Category.cs file also like below.</p>\n\n<pre><code>    [MetadataType(typeof(CategoryMetaData))]\n    public partial class Category\n    {\n    }\n    public class CategoryMetaData\n    {\n        [Required(ErrorMessage = \"Category Name is required.\")]\n        public object CategoryName;\n    }\n</code></pre>\n\n<p>But my validations are not working.</p>\n\n<p>Is there anything missed?</p>\n"},{"tags":["entity-framework","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13210202,"title":"How to save oldest photo if in form not attached newest file?","body":"<p>I have action method in my controller. If photo is attached in form my method work fine. If photo don't upload from form in Edit action my method to removes oldest photo from database. How to save oldest photo if in form not attached newest file?</p>\n\n<p>Model:</p>\n\n<pre><code>[DisplayColumn(\"LastName\")]\npublic class Driver\n{\n    [Key]\n    public int Id { get; set; }\n\n    [Display(Name=\"Full Name\")]\n    [DataType(DataType.Text)]\n    public string FullName\n    {\n        get { return string.Concat(FirstName.Substring(0, 1), \".\", LastName);}\n    }\n\n    [Required]\n    [Display(Name = \"First Name\")]\n    [DataType(DataType.Text)]\n    public string FirstName { get; set; }\n\n    [Display(Name = \"Middle Name\")]\n    [DataType(DataType.Text)]\n    public string MiddleName { get; set; }\n\n    [Required]\n    [Display(Name = \"Last Name\")]\n    [DataType(DataType.Text)]\n    public string LastName { get; set; }\n\n    public byte[] DriverPhoto { get; set; }\n\n}\n</code></pre>\n\n<p>Controller:</p>\n\n<pre><code>    [HttpPost]\n    public ActionResult Edit(Driver driver, HttpPostedFileBase fileUpload)\n    {\n        if(fileUpload != null)\n        {\n            var binaryReader = new BinaryReader(fileUpload.InputStream);\n            driver.DriverPhoto = binaryReader.ReadBytes(fileUpload.ContentLength);\n        }\n\n        if (ModelState.IsValid)\n        {\n\n            db.Entry(driver).State = EntityState.Modified;\n\n            db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n\n        return View(driver);\n    }\n</code></pre>\n"},{"tags":["entity-framework","concurrency","transactions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13247560,"title":"entity framework concurrency: transactions or concurrency fixed?","body":"<p>I need to make stock control, so I need to ensure that when I modified the amount of product, is doing in the right way. I am using Entity framework 4.0</p>\n\n<p>For example, if I use a transaction, when I load the record from the database, the recored is blocked, so I can substract or add to the loaded amount, the number of items that I need. However, this block the record in the database and perhaps for performance reasons is not the best way. This makes me ask when to use transactions with EF.</p>\n\n<p>The other option is to use the concurrency fixed of entity framework, using a timespan column to detect if the record has been changed. In this case, if the record has been modified between my load and my update, I get the exception of concurrency. But it could occur that in my exception handler, if I update my context with the database data, between my refresh and the savechanges could be changed again.</p>\n\n<p>Other problem is I finally can save the changes. For example, I have 10 units, I need to substract 8 but between my load and my update, other person substract 5 units. If I subtract 8, then in stock I have -3 units. This is not possible. If I have a transaction, I load the record, is blocked, so I can check if I have enough units, if yes, I can subtrack, if not, I send an exception.</p>\n\n<p>So my question is, I know that EF is a transaction by itself, but it exists also transactions in EF, so it would be useful in some cases. When to use EF and cocurrency fixed and when to use transactions?</p>\n\n<p>Thanks.\nDaimroc.</p>\n"},{"tags":["entity-framework","poco","navigation-properties"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":27,"score":0,"question_id":13256412,"title":"Entity Framework POCO - Navigation Property does not refresh","body":"<p>I have an issue with poco classes in EF 4.</p>\n\n<p>I have an Order entity wich contains a foreign key to a Customer entity. </p>\n\n<p>So, the Order class has a navigation property of type Customer.</p>\n\n<p>It's look like this :</p>\n\n<pre><code>public class Order\n{\n     public virtual int Id { get; set; }\n     public virtual CustomerId  { get; set; }\n     public virtual Customer customer { get; set;}\n     \n}\n</code></pre>\n\n<p>When I load an order, the navigation property customer is correct, but if the CustomerId property changes, the navigation property is not refresh with the new customer.</p>\n\n<p>If I call the DetectChanges() method on the EF context, the navigation property is then refreshed.</p>\n\n<p>I've read that with all properties marked as virtual, the relationship synchronisation is automatic, but it's not the case here.</p>\n\n<p>Where did I go wrong ?</p>\n\n<p>Thanks for any help</p>\n"},{"tags":["oracle","entity-framework","ef-power-tools"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13261018,"title":"Unable to reverse-engineer code-first with EFPowerTools Beta2 VS2012","body":"<p>I want to reverse-engineer code first using PowerTools. It works when I reverse engineer from a local MS-SQL database, but not from Oracle DB. I get the following errors in the output console:</p>\n\n<pre><code>  System.Data.ProviderIncompatibleException: The provider did not return a ProviderManifestToken string. ---&gt; Oracle.DataAccess.Client.OracleException: ORA-1005: null password given; logon denied\n   at Oracle.DataAccess.Client.OracleException.HandleErrorHelper(Int32 errCode, OracleConnection conn, IntPtr opsErrCtx, OpoSqlValCtx* pOpoSqlValCtx, Object src, String procedure, Boolean bCheck)\n   at Oracle.DataAccess.Client.OracleException.HandleError(Int32 errCode, OracleConnection conn, IntPtr opsErrCtx, Object src)\n   at Oracle.DataAccess.Client.OracleConnection.Open()\n   at Oracle.DataAccess.Client.EFOracleProviderServices.GetDbProviderManifestToken(DbConnection connection)\n   at System.Data.Common.DbProviderServices.GetProviderManifestToken(DbConnection connection)\n   --- End of inner exception stack trace ---\n   at System.Data.Common.DbProviderServices.GetProviderManifestToken(DbConnection connection)\n   at System.Data.Entity.Design.EntityStoreSchemaGenerator.GetProviderSchemaMetadataWorkspace(DbProviderServices providerServices, DbConnection providerConnection, Version targetEntityFrameworkVersion)\n   at System.Data.Entity.Design.EntityStoreSchemaGenerator.CreateStoreSchemaConnection(String providerInvariantName, String connectionString, Version targetEntityFrameworkVersion)\n   at System.Data.Entity.Design.SsdlGenerator.EntityStoreSchemaGeneratorDatabaseSchemaLoader.CreateStoreSchemaConnection(String providerInvariantName, String connectionString, Version&amp; storeSchemaModelVersion)\n   at System.Data.Entity.Design.EntityStoreSchemaGenerator..ctor(String providerInvariantName, String connectionString, String namespaceName)\n   at Microsoft.DbContextPackage.Handlers.ReverseEngineerCodeFirstHandler.ReverseEngineerCodeFirst(Project project)\n</code></pre>\n\n<p>I can do normal generation of EF files by right-click project > add > ADO.NET Entity Data Model > choose \"from Existing DB\" and follow the rest of wizard. I like the powertools better though, for several reasons (mostly the mappings as .cs files). Why can I not reverse engineer when using Oracle? TIA</p>\n"},{"tags":["c#","database","entity-framework","ef-code-first","foreign-keys"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":95,"score":3,"question_id":13260306,"title":"Entity Framework 5: Code-First Cyclical Relationship Issues","body":"<p>I understand why EF does not allow \"cyclical references\" in the PK/FK relationships. I am looking for advice on how to alter my model to make the following scenario work.</p>\n\n<h3>Scenario</h3>\n\n<p>Three entities: <code>Employee</code>, <code>Agency</code>, <code>WorkRecord</code>. Their purpose is to log Employee time spent doing work. <code>Employee</code> then contains reference to the <code>Agency</code> he/she is employed by, and his/her <code>WorkRecord</code> contain reference to the <code>Agency</code> the work was done for.</p>\n\n<pre><code>public class Employee\n{\n    [Key]\n    public int Id { get; set; }\n\n    public string Name { get; set; }\n\n    public int AgencyId { get; set; }\n    public virtual Agency Agency { get; set; }\n\n    public virtual IEnumerable&lt;WorkRecord&gt; WorkRecords { get; set; }\n}\n\npublic class Agency\n{\n    [Key]\n    public int Id { get; set; } \n}\n\npublic class WorkRecord\n{\n    [Key]\n    public int Id { get; set; } \n\n    public int Hours { get; set; } \n\n    public int AgencyId { get; set; } \n    public virtual Agency Agency { get; set; } \n\n    public int EmployeeId { get; set; }\n    public virtual Employee { get; set; }\n}\n</code></pre>\n\n<p>Like this, it bitches: <code>FK_dbo.WorkRecords_dbo.Employees_EmployeeId</code> causes a cyclical reference.</p>\n\n<h3>Experiments</h3>\n\n<p>My first thought was because of the bi-directional virtual properties, so I decided to designate one of the two a top-level entity with a 1-way relationship:</p>\n\n<p>First, I designated <code>WorkRecord</code> as a top-level entity and remove the virtual <code>WorkRecords</code> reference reference from the <code>Employee</code> entity... the same message is produced.</p>\n\n<p>Second, I made <code>Employee</code> the top-level entity, leaving its virtual <code>WorkRecords</code> collection, and removing the virtual <code>Employee</code> reference property from the <code>WorkRecord</code> entity... works fine but does not achieve my goal.</p>\n\n<p>After more investigation, I find it is the Agency virtual reference property on both entities that causes the circular reference. If one entity removes this, the <code>Employee</code>/<code>WorkRecord</code> entity relationships work in all directions. </p>\n\n<h3>Question:</h3>\n\n<p>So, clear as i can ask - how can I express this business model, using <code>WorkRecord</code> as my top-level entity, without making EF5 upset?</p>\n"}]}
{"total":18927,"page":2,"pagesize":100,"questions":[{"tags":["asp.net","mysql","asp.net-mvc","entity-framework"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1667,"score":2,"question_id":1440496,"title":"Problems publishing website","body":"<p>Recently I've began experimenting with ASP.NET MVC and the Entity Framework. Since my hostingprovider only provides me with MySQL I've been trying to set that up.\nLocally everything works fine, but after I publish it I get the following error:</p>\n\n<pre><code>[ProviderIncompatibleException: The store provider factory type 'MySql.Data.MySqlClient.MySqlClientFactory' does not implement the IServiceProvider interface. Use a store provider that implements this interface.]\n</code></pre>\n\n<p>Since I'm rather inexperienced with the configuring this and google is lacking a good answer I thought I'd try here.\nMy best guess is something missing in the web.config file, but can't really make out what it is. </p>\n\n<p>Any help would be greatly appreciated!</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13256611,"title":"Can I call DbContext.SaveChanges in for loop","body":"<p>I am using EF5 and I am getting an error when I am calling context.SaveChanges in a for loop.</p>\n\n<p>If I am updating any entity, do I need to call SaveChanges to get the updated value of the entity with in the same context.</p>\n\n<p>For example,quantity of one line item is n. In my firts iteration I am reducing the quantity of line item by 1. So now the actual quantity is n-1. I have not yet called SaveChanges on context. In the next iteration for the same line item is the quantity would be n or n-1?</p>\n\n<p>Thanks</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","select","repository","columnname"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13258423,"title":"Column name Entity Framework base Repository","body":"<p><strong>IRepositoryBase</strong></p>\n\n<pre><code>IQueryable&lt;T&gt; GetAll(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null, params Expression&lt;Func&lt;T, object&gt;&gt;[] includes);\n</code></pre>\n\n<p><strong>RepositoryBase</strong></p>\n\n<pre><code> public IQueryable&lt;T&gt; GetAll([OptionalAttribute][DefaultParameterValueAttribute(null)]Expression&lt;Func&lt;T, bool&gt;&gt; predicate, params Expression&lt;Func&lt;T, object&gt;&gt;[] includes)     \n {\n   var set = CreateSet().IncludeMultiple(includes);\n   return (predicate == null) ? set : set.Where(predicate);            \n }\n</code></pre>\n\n<p><strong>IAccountService</strong></p>\n\n<pre><code>IEnumerable&lt;int&gt; GetAllReferenceIds();\n</code></pre>\n\n<p><strong>AccountService</strong></p>\n\n<pre><code>public IEnumerable&lt;int&gt; GetAllReferenceIds()       \n{    \n  var accountOwners = _accountOwnerRepository.GetAll();\n  return accountOwners.Select(m =&gt; m.ReferenceId).ToList();\n}\n</code></pre>\n\n<p><strong>AccountController</strong></p>\n\n<pre><code>public ActionResult ReferenceIdPartial()      \n{\n\nViewData[\"AccountOwners\"] = accountOwnerService.GetAllReferenceIds();\n\nreturn PartialView();\n\n}\n</code></pre>\n\n<p><strong>MVC Partial View</strong> - devexpress combobox mvc extension</p>\n\n<pre><code>settings.Properties.Columns.Add(\"ReferenceId\", \"Reference Id\", Unit.Percentage(100));\n</code></pre>\n\n<p>Error - column ReferenceId Not found</p>\n\n<p>I am sending a collection of int through GetReferenceIds()</p>\n\n<p>Is there a way to call the columns from Controller. Something like  AccountOwner(a=>a.ReferenceIds, select ReferenceIds) - I should be able to get the column name as well as the data. </p>\n\n<p>Thanks for your time. </p>\n"},{"tags":["sql-server","asp.net-mvc","linq","entity-framework","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":178,"score":1,"question_id":12928463,"title":"Sometimes get Timeout expired exception with Linq to EF and after a restart of server, it works fine","body":"<p>I have hosted my website at rackspace cloud server.</p>\n\n<p>Sometimes I get the below exception while fetching records from database. The strange thing is that everything works fine for a few days after a restart and also I get this exception in only a few places and not everywhere.</p>\n\n<pre><code>Exception: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.\n\nException Details: System.Data.SqlClient.SqlException: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\n\nStack Trace:\n\n\n[SqlException (0x80131904): Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.]\n   System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection) +404\n   System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning() +412\n   System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj) +1363\n   System.Data.SqlClient.SqlDataReader.ConsumeMetaData() +59\n   System.Data.SqlClient.SqlDataReader.get_MetaData() +118\n   System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString) +6387937\n   System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async) +6389506\n   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result) +538\n   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method) +28\n   System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method) +256\n   System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior) +19\n   System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior) +553\n\n[EntityCommandExecutionException: An error occurred while executing the command definition. See the inner exception for details.]\n   DataAccessLayer.dbCustomer.CompanyCustomerByLocationId(String sortExpression, Boolean asc, String nameSearchString, Int32 startRowIndex, Int32 maximumRows, Int32&amp; TotalRecord, Int64 companyId) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\DataAccessLayer\\dbCustomer.cs:508\n   BusinessLogic.Customer.CompanyCustomerByLocationId(String sortExpression, Boolean asc, String nameSearchString, Int32 startRowIndex, Int32 maximumRows, Int64 CompanyId) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\BusinessLogic\\Customer.cs:431\n   FutureZoom.Areas.Admin.Controllers.CompanyController.CustomerPaging(Int32 StartIndex, Int32 PageSize, String SortExp, Boolean Asc, String SearchExp, String Where) in D:\\Dotnet Projects\\FutureZoom\\FutureZoom\\FutureZoom\\Areas\\Admin\\Controllers\\CompanyController.cs:552\n   lambda_method(Closure , ControllerBase , Object[] ) +362\n   System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters) +248\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +39\n   System.Web.Mvc.&lt;&gt;c__DisplayClass15.&lt;InvokeActionMethodWithFilters&gt;b__12() +125\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter(IActionFilter filter, ActionExecutingContext preContext, Func`1 continuation) +640\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodWithFilters(ControllerContext controllerContext, IList`1 filters, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +312\n   System.Web.Mvc.ControllerActionInvoker.InvokeAction(ControllerContext controllerContext, String actionName) +691\n   System.Web.Mvc.Controller.ExecuteCore() +162\n   System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext) +305\n   System.Web.Mvc.&lt;&gt;c__DisplayClassb.&lt;BeginProcessRequest&gt;b__5() +62\n   System.Web.Mvc.Async.&lt;&gt;c__DisplayClass1.&lt;MakeVoidDelegate&gt;b__0() +20\n   System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +469\n   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously) +375\n</code></pre>\n\n<p>My Linq query is mentioned below</p>\n\n<pre><code>query = context.Customers.Include(\"Company\").Include(\"Company.EmailCampaignerStatus\")\n                                           .OrderBy(m =&gt; m.EmailCampaignerStatus.FirstOrDefault().CreatedOn)                                           \n                                           .Where(m =&gt; m.FirstName.StartsWith(name) || m.LastName.StartsWith(name) || m.Email.StartsWith(name) || (m.FirstName + \" \" + m.LastName).StartsWith(name))\n                                           .Where(m =&gt; m.CompanyId == companyId)\n                                           .Where(m =&gt; m.CompanyLocationId == locationId)\n                                           .Skip(startRowIndex == 0 ? startRowIndex : startRowIndex - 1)\n                                           .Take(maximumRows)\n                                           .ToList();\n</code></pre>\n\n<p>Execution time for this query is not even 1 second on my local machine and also the same at server side after a restart but the execution time increases day by day and it fails to execute after few days (sometime fails and sometimes gives result).</p>\n\n<p>I observed that it took 31.05sec and fails and it take 51.09 sec and fails. Sometimes it takes more than 2 mins and gives result.</p>\n\n<p>I talked with rackspace people but they were unable to trace the actual cause for the same.</p>\n\n<p>Edit 1: I have seen below queries in SQL Profiler against my paging query</p>\n\n<pre><code>SELECT \n[Project3].[Id1] AS [Id], \n[Project3].[C1] AS [C1], \n[Project3].[Id] AS [Id1], \n[Project3].[CompanyId] AS [CompanyId], \n[Project3].[CompanyLocationId] AS [CompanyLocationId], \n[Project3].[FirstName] AS [FirstName], \n[Project3].[LastName] AS [LastName], \n[Project3].[Email] AS [Email], \n[Project3].[Address1] AS [Address1], \n[Project3].[Address2] AS [Address2], \n[Project3].[City] AS [City], \n[Project3].[State] AS [State], \n[Project3].[Country] AS [Country], \n[Project3].[Zip] AS [Zip], \n[Project3].[Phone] AS [Phone], \n[Project3].[SaleDate] AS [SaleDate], \n[Project3].[Notes] AS [Notes], \n[Project3].[Cost] AS [Cost], \n[Project3].[CreatedOn] AS [CreatedOn], \n[Project3].[ModifiedOn] AS [ModifiedOn], \n[Project3].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n[Project3].[Id2] AS [Id2], \n[Project3].[SubscriptionTypeId] AS [SubscriptionTypeId], \n[Project3].[PlanFeeAmount] AS [PlanFeeAmount], \n[Project3].[LoginId] AS [LoginId], \n[Project3].[IndustryTypeId] AS [IndustryTypeId], \n[Project3].[CompanyName] AS [CompanyName], \n[Project3].[NumberOfLocations] AS [NumberOfLocations], \n[Project3].[LogoImageName] AS [LogoImageName], \n[Project3].[WebsiteUrl] AS [WebsiteUrl], \n[Project3].[blsActive] AS [blsActive], \n[Project3].[Pending] AS [Pending], \n[Project3].[ExpiryDate] AS [ExpiryDate], \n[Project3].[C2] AS [C2], \n[Project3].[Id3] AS [Id3], \n[Project3].[UploadTicketId] AS [UploadTicketId], \n[Project3].[UploadStatus] AS [UploadStatus], \n[Project3].[CompanyId1] AS [CompanyId1], \n[Project3].[CompanyLocationId1] AS [CompanyLocationId1], \n[Project3].[CustomerId] AS [CustomerId], \n[Project3].[CreatedOn2] AS [CreatedOn1]\nFROM ( SELECT \n    [Limit2].[Id] AS [Id], \n    [Limit2].[CompanyId] AS [CompanyId], \n    [Limit2].[CompanyLocationId] AS [CompanyLocationId], \n    [Limit2].[FirstName] AS [FirstName], \n    [Limit2].[LastName] AS [LastName], \n    [Limit2].[Email] AS [Email], \n    [Limit2].[Address1] AS [Address1], \n    [Limit2].[Address2] AS [Address2], \n    [Limit2].[City] AS [City], \n    [Limit2].[State] AS [State], \n    [Limit2].[Country] AS [Country], \n    [Limit2].[Zip] AS [Zip], \n    [Limit2].[Phone] AS [Phone], \n    [Limit2].[SaleDate] AS [SaleDate], \n    [Limit2].[Notes] AS [Notes], \n    [Limit2].[Cost] AS [Cost], \n    [Limit2].[CreatedOn] AS [CreatedOn], \n    [Limit2].[ModifiedOn] AS [ModifiedOn], \n    [Limit2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n    [Limit2].[Id1] AS [Id1], \n    [Limit2].[CreatedOn1] AS [CreatedOn1], \n    [Limit2].[Id2] AS [Id2], \n    [Limit2].[SubscriptionTypeId] AS [SubscriptionTypeId], \n    [Limit2].[PlanFeeAmount] AS [PlanFeeAmount], \n    [Limit2].[LoginId] AS [LoginId], \n    [Limit2].[IndustryTypeId] AS [IndustryTypeId], \n    [Limit2].[CompanyName] AS [CompanyName], \n    [Limit2].[NumberOfLocations] AS [NumberOfLocations], \n    [Limit2].[WebsiteUrl] AS [WebsiteUrl], \n    [Limit2].[blsActive] AS [blsActive], \n    [Limit2].[Pending] AS [Pending], \n    [Limit2].[ExpiryDate] AS [ExpiryDate], \n    [Limit2].[LogoImageName] AS [LogoImageName], \n    [Limit2].[C1] AS [C1], \n    [Extent4].[Id] AS [Id3], \n    [Extent4].[UploadTicketId] AS [UploadTicketId], \n    [Extent4].[UploadStatus] AS [UploadStatus], \n    [Extent4].[CompanyId] AS [CompanyId1], \n    [Extent4].[CompanyLocationId] AS [CompanyLocationId1], \n    [Extent4].[CustomerId] AS [CustomerId], \n    [Extent4].[CreatedOn] AS [CreatedOn2], \n    CASE WHEN ([Extent4].[Id] IS NULL) THEN CAST(NULL AS int) ELSE 1 END AS [C2]\n    FROM   (SELECT TOP (20) [Project2].[Id] AS [Id], [Project2].[CompanyId] AS [CompanyId], [Project2].[CompanyLocationId] AS [CompanyLocationId], [Project2].[FirstName] AS [FirstName], [Project2].[LastName] AS [LastName], [Project2].[Email] AS [Email], [Project2].[Address1] AS [Address1], [Project2].[Address2] AS [Address2], [Project2].[City] AS [City], [Project2].[State] AS [State], [Project2].[Country] AS [Country], [Project2].[Zip] AS [Zip], [Project2].[Phone] AS [Phone], [Project2].[SaleDate] AS [SaleDate], [Project2].[Notes] AS [Notes], [Project2].[Cost] AS [Cost], [Project2].[CreatedOn] AS [CreatedOn], [Project2].[ModifiedOn] AS [ModifiedOn], [Project2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], [Project2].[Id1] AS [Id1], [Project2].[CreatedOn1] AS [CreatedOn1], [Project2].[Id2] AS [Id2], [Project2].[SubscriptionTypeId] AS [SubscriptionTypeId], [Project2].[PlanFeeAmount] AS [PlanFeeAmount], [Project2].[LoginId] AS [LoginId], [Project2].[IndustryTypeId] AS [IndustryTypeId], [Project2].[CompanyName] AS [CompanyName], [Project2].[NumberOfLocations] AS [NumberOfLocations], [Project2].[WebsiteUrl] AS [WebsiteUrl], [Project2].[blsActive] AS [blsActive], [Project2].[Pending] AS [Pending], [Project2].[ExpiryDate] AS [ExpiryDate], [Project2].[LogoImageName] AS [LogoImageName], [Project2].[C1] AS [C1]\n        FROM ( SELECT [Project2].[Id] AS [Id], [Project2].[CompanyId] AS [CompanyId], [Project2].[CompanyLocationId] AS [CompanyLocationId], [Project2].[FirstName] AS [FirstName], [Project2].[LastName] AS [LastName], [Project2].[Email] AS [Email], [Project2].[Address1] AS [Address1], [Project2].[Address2] AS [Address2], [Project2].[City] AS [City], [Project2].[State] AS [State], [Project2].[Country] AS [Country], [Project2].[Zip] AS [Zip], [Project2].[Phone] AS [Phone], [Project2].[SaleDate] AS [SaleDate], [Project2].[Notes] AS [Notes], [Project2].[Cost] AS [Cost], [Project2].[CreatedOn] AS [CreatedOn], [Project2].[ModifiedOn] AS [ModifiedOn], [Project2].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], [Project2].[Id1] AS [Id1], [Project2].[CreatedOn1] AS [CreatedOn1], [Project2].[Id2] AS [Id2], [Project2].[SubscriptionTypeId] AS [SubscriptionTypeId], [Project2].[PlanFeeAmount] AS [PlanFeeAmount], [Project2].[LoginId] AS [LoginId], [Project2].[IndustryTypeId] AS [IndustryTypeId], [Project2].[CompanyName] AS [CompanyName], [Project2].[NumberOfLocations] AS [NumberOfLocations], [Project2].[WebsiteUrl] AS [WebsiteUrl], [Project2].[blsActive] AS [blsActive], [Project2].[Pending] AS [Pending], [Project2].[ExpiryDate] AS [ExpiryDate], [Project2].[LogoImageName] AS [LogoImageName], [Project2].[C1] AS [C1], row_number() OVER (ORDER BY [Project2].[CreatedOn1] ASC) AS [row_number]\n            FROM ( SELECT \n                [Filter1].[Id] AS [Id], \n                [Filter1].[CompanyId] AS [CompanyId], \n                [Filter1].[CompanyLocationId] AS [CompanyLocationId], \n                [Filter1].[FirstName] AS [FirstName], \n                [Filter1].[LastName] AS [LastName], \n                [Filter1].[Email] AS [Email], \n                [Filter1].[Address1] AS [Address1], \n                [Filter1].[Address2] AS [Address2], \n                [Filter1].[City] AS [City], \n                [Filter1].[State] AS [State], \n                [Filter1].[Country] AS [Country], \n                [Filter1].[Zip] AS [Zip], \n                [Filter1].[Phone] AS [Phone], \n                [Filter1].[SaleDate] AS [SaleDate], \n                [Filter1].[Notes] AS [Notes], \n                [Filter1].[Cost] AS [Cost], \n                [Filter1].[CreatedOn] AS [CreatedOn], \n                [Filter1].[ModifiedOn] AS [ModifiedOn], \n                [Filter1].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId], \n                [Limit1].[Id] AS [Id1], \n                [Limit1].[CreatedOn] AS [CreatedOn1], \n                [Extent3].[Id] AS [Id2], \n                [Extent3].[SubscriptionTypeId] AS [SubscriptionTypeId], \n                [Extent3].[PlanFeeAmount] AS [PlanFeeAmount], \n                [Extent3].[LoginId] AS [LoginId], \n                [Extent3].[IndustryTypeId] AS [IndustryTypeId], \n                [Extent3].[CompanyName] AS [CompanyName], \n                [Extent3].[NumberOfLocations] AS [NumberOfLocations], \n                [Extent3].[WebsiteUrl] AS [WebsiteUrl], \n                [Extent3].[blsActive] AS [blsActive], \n                [Extent3].[Pending] AS [Pending], \n                [Extent3].[ExpiryDate] AS [ExpiryDate], \n                [Extent3].[LogoImageName] AS [LogoImageName], \n                1 AS [C1]\n                FROM    (SELECT [Extent1].[Id] AS [Id], [Extent1].[CompanyId] AS [CompanyId], [Extent1].[CompanyLocationId] AS [CompanyLocationId], [Extent1].[FirstName] AS [FirstName], [Extent1].[LastName] AS [LastName], [Extent1].[Email] AS [Email], [Extent1].[Address1] AS [Address1], [Extent1].[Address2] AS [Address2], [Extent1].[City] AS [City], [Extent1].[State] AS [State], [Extent1].[Country] AS [Country], [Extent1].[Zip] AS [Zip], [Extent1].[Phone] AS [Phone], [Extent1].[SaleDate] AS [SaleDate], [Extent1].[Notes] AS [Notes], [Extent1].[Cost] AS [Cost], [Extent1].[CreatedOn] AS [CreatedOn], [Extent1].[ModifiedOn] AS [ModifiedOn], [Extent1].[PrimaryReviewSiteId] AS [PrimaryReviewSiteId]\n                    FROM [dbo].[Customer] AS [Extent1]\n                    WHERE (([Extent1].[FirstName] LIKE @p__linq__0 ESCAPE N'~') OR ([Extent1].[LastName] LIKE @p__linq__1 ESCAPE N'~') OR ([Extent1].[Email] LIKE @p__linq__2 ESCAPE N'~') OR ([Extent1].[FirstName] + N' ' + [Extent1].[LastName] LIKE @p__linq__3 ESCAPE N'~')) AND ([Extent1].[CompanyId] = @p__linq__4) AND ([Extent1].[CompanyLocationId] = @p__linq__5) ) AS [Filter1]\n                OUTER APPLY  (SELECT TOP (1) \n                    [Extent2].[Id] AS [Id], \n                    [Extent2].[CreatedOn] AS [CreatedOn]\n                    FROM [dbo].[EmailCampaignerStatus] AS [Extent2]\n                    WHERE [Filter1].[Id] = [Extent2].[CustomerId] ) AS [Limit1]\n                LEFT OUTER JOIN [dbo].[Company] AS [Extent3] ON [Filter1].[CompanyId] = [Extent3].[Id]\n            )  AS [Project2]\n        )  AS [Project2]\n        WHERE [Project2].[row_number] &gt; 0\n        ORDER BY [Project2].[CreatedOn1] ASC ) AS [Limit2]\n    LEFT OUTER JOIN [dbo].[EmailCampaignerStatus] AS [Extent4] ON [Limit2].[CompanyId] = [Extent4].[CompanyId]\n)  AS [Project3]\nORDER BY [Project3].[CreatedOn1] ASC, [Project3].[Id1] ASC, [Project3].[Id] ASC, [Project3].[Id2] ASC, [Project3].[C2] ASC\n\nSELECT \n[GroupBy1].[A1] AS [C1]\nFROM ( SELECT \n    COUNT(1) AS [A1]\n    FROM [dbo].[Customer] AS [Extent1]\n    WHERE (([Extent1].[FirstName] LIKE @p__linq__0 ESCAPE N'~') OR ([Extent1].[LastName] LIKE @p__linq__1 ESCAPE N'~') OR ([Extent1].[Email] LIKE @p__linq__2 ESCAPE N'~') OR ([Extent1].[FirstName] + N' ' + [Extent1].[LastName] LIKE @p__linq__3 ESCAPE N'~')) AND ([Extent1].[CompanyId] = @p__linq__4) AND ([Extent1].[CompanyLocationId] = @p__linq__5)\n)  AS [GroupBy1]\n\n\nSELECT \nCASE WHEN ( EXISTS (SELECT \n    1 AS [C1]\n    FROM [dbo].[CompanyReviewSites] AS [Extent1]\n    WHERE [Extent1].[CompanyLocationId] = @p__linq__0\n)) THEN cast(1 as bit) WHEN ( NOT EXISTS (SELECT \n    1 AS [C1]\n    FROM [dbo].[CompanyReviewSites] AS [Extent2]\n    WHERE [Extent2].[CompanyLocationId] = @p__linq__0\n)) THEN cast(0 as bit) END AS [C1]\nFROM  ( SELECT 1 AS X ) AS [SingleRowTable1]\n\nSELECT \n1 AS [C1], \n[Extent1].[Id] AS [Id], \n[Extent1].[RiviewSiteId] AS [RiviewSiteId], \n[Extent1].[URL] AS [URL], \n[Extent1].[CompanyId] AS [CompanyId], \n[Extent1].[CompanyLocationId] AS [CompanyLocationId], \n[Extent2].[Id] AS [Id1], \n[Extent2].[ReviewSiteName] AS [ReviewSiteName], \n[Extent2].[ImageName] AS [ImageName]\nFROM  [dbo].[CompanyReviewSites] AS [Extent1]\nINNER JOIN [dbo].[ReviewSites] AS [Extent2] ON [Extent1].[RiviewSiteId] = [Extent2].[Id]\nWHERE [Extent1].[CompanyLocationId] = @p__linq__0\n</code></pre>\n"},{"tags":["c#","linq","entity-framework","type-conversion","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13259608,"title":"Cannot convert source type 'void' to target type 'ICollection<Character>'","body":"<p>I have a <code>DataContract</code> class that I'm trying to convert to another class, <code>Movie</code> but for the property <code>Movie.Characters</code> I'm getting the error...</p>\n\n<blockquote>\n  <p>Cannot convert source type '<code>void</code>' to target type '<code>ICollection&lt;Character&gt;</code>'</p>\n</blockquote>\n\n<p>How can I create a new <code>Movie</code> so the <code>Character</code> property is set properly mapped to each <code>Person</code> and <code>Movie</code>?</p>\n\n<pre><code>var movies = dataContract.Movies.Select(m =&gt; new Movie {\n    Id = m.Id,\n    Title = m.Title,\n    Characters = m.AbridgedCast.ToList().ForEach(p =&gt; new Person { Name = p.Name, \n        RottenTomatoesId = p.Id, \n        Characters = p.Characters.ToList().ForEach(c =&gt; new Character { Name = c })})\n});\n</code></pre>\n\n<p><strong>MoviesDataContract.cs</strong></p>\n\n<pre><code>public class MoviesDataContract {\n    [DataMember(Name = \"total\")]\n    public int Total { get; set; }\n\n    [DataMember(Name = \"movies\")]\n    public IEnumerable&lt;Movie&gt; Movies { get; set; }\n\n    #region Internal Classes\n\n    [DataContract]\n    public class Movie {\n        [DataMember(Name = \"id\")]\n        public int Id { get; set; }\n\n        [DataMember(Name = \"title\")]\n        public string Title { get; set; }\n\n        [DataMember(Name = \"abridged_cast\")]\n        public virtual IEnumerable&lt;Person&gt; AbridgedCast { get; set; }\n    }\n\n    [DataContract]\n    public class Person {\n        [DataMember(Name = \"name\")]\n        public string Name { get; set; }\n\n        [DataMember(Name = \"id\")]\n        public int Id { get; set; }\n\n        [DataMember(Name = \"characters\")]\n        public IEnumerable&lt;string&gt; Characters { get; set; }\n    }\n\n    #endregion  \n}\n</code></pre>\n\n<p><strong>Movies.cs</strong></p>\n\n<pre><code>public partial class Movie {\n    public Movie() {\n        this.Characters = new HashSet&lt;Character&gt;();\n    }\n\n    public int Id { get; set; }\n    public string Title { get; set; }\n    public virtual ICollection&lt;Character&gt; Characters { get; set; }\n}\n\npublic partial class Character {\n    public System.Guid Id { get; set; }\n    public int MovieId { get; set; }\n    public System.Guid PersonId { get; set; }\n    public string Name { get; set; }\n\n    public virtual Movie Movie { get; set; }\n    public virtual Person Person { get; set; }\n}\n\npublic partial class Person {\n    public Person() {\n        this.Characters = new HashSet&lt;Character&gt;();\n    }\n\n    public System.Guid Id { get; set; }\n    public string Name { get; set; }\n    public int RottenTomatoesId { get; set; }\n\n    public virtual ICollection&lt;Character&gt; Characters { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework","json.net"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":775,"score":2,"question_id":7983428,"title":"json.net; serialize entity framework object (circular reference error)","body":"<p>I have an entity framework entity that i want to serialize as a json object. I looked around and found out that json.net (http://james.newtonking.com/projects/json-net.aspx) should be able to serialize objects with circular references \"out of the box\". So i tried using</p>\n\n<pre><code>string json = JsonConvert.SerializeObject(/* my ef entity */);\n</code></pre>\n\n<p>But im still getting the same error. The problem might be that i need to use <code>ReferenceLoopHandling.Ignore</code> and a <code>ContractResolver</code>, but im not sure how to use them. Any help is much appreciated! Thanks</p>\n"},{"tags":["c#","entity-framework","entity-framework-4.1","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13259299,"title":"EF DbContext.Set<T> filtered record only ... doesn't work","body":"<p>While developing a data access solution that utilizes generic repository and unit of work pattern over entity framework 4.2. I am seeing some abnormal behavior. To make my repositories generic, I have utilized the Set method of DbContext like:</p>\n\n<pre><code>public class MyGenericRepository&lt;T&gt; \n{\n     protected readonly IDbContext context;\n     public virtual IEnumerable&lt;T&gt; FindBy(Func&lt;T, bool&gt; predicate)\n     {\n        return context.GetDbSet&lt;T&gt;().Where(predicate).First();\n     }\n}\n</code></pre>\n\n<p>where IDbContext is like: </p>\n\n<pre><code>public interface IDbContext\n{\n    void Commit();\n    void Attach&lt;T&gt;(T obj) where T : class;\n    void Add&lt;T&gt;(T obj) where T : class;\n    DbSet&lt;T&gt; GetDbSet&lt;T&gt;() where T : class;\n    bool Remove&lt;T&gt;(T item) where T : class;\n}\n</code></pre>\n\n<p>The DbContext class implements the IDbContext as: </p>\n\n<pre><code>public partial class MyEntities : IDbContext\n{\n\n    public DbSet&lt;T&gt; GetDbSet&lt;T&gt;() where T : class\n    {\n        return this.Set&lt;T&gt;();\n    }\n}  \n</code></pre>\n\n<p>When I do repository.FindBy(c => c.CompanyId == 45), Sql Profiler shows the query to <strong>NOT</strong> contain any filter (company_id = 45). The query does a Select *.</p>\n\n<p>Expecting a filter to be present, i started researching and came across this,</p>\n\n<p><a href=\"http://social.msdn.microsoft.com/Forums/en/adodotnetentityframework/thread/7d6705ac-f875-4c89-960b-842be6f6e5ed\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en/adodotnetentityframework/thread/7d6705ac-f875-4c89-960b-842be6f6e5ed</a>\nand \n<a href=\"http://stackoverflow.com/questions/9362145/ef-dbcontext-sett-filtered-record-only\">EF DbContext.Set&lt;T&gt; filtered record only</a></p>\n\n<p>These threads confirms my thought process but the results are different. Any solutions?</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first","code-first-migrations"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":288,"score":0,"question_id":12573927,"title":"Database Initializer not being called in EF 5 + MVC 3","body":"<p>I know this question might be duplicated, but I haven't found any solution for my problem yet.</p>\n\n<p>I have:</p>\n\n<pre><code>protected void Application_Start()\n        {\n            Database.SetInitializer(new DatabaseSeeder());\n            DatabaseContext c = new DatabaseContext();\n            c.Database.Initialize(true);\n\n            AreaRegistration.RegisterAllAreas();\n\n            RegisterGlobalFilters(GlobalFilters.Filters);\n            RegisterRoutes(RouteTable.Routes);\n\n\n        }\n</code></pre>\n\n<p>my database seeder is:</p>\n\n<pre><code>public class DatabaseSeeder : DropCreateDatabaseAlways&lt;DatabaseContextBase&gt;\n    {\n        protected override void Seed(DatabaseContextBase context)\n        {\n            base.Seed(context);\n\n            var roles = new[] {\"Admin\", \"User\"};\n            foreach (var role in roles)\n            {\n                context.Roles.Add(new UserRole {FullName = role});\n            }\n\n            context.SaveChanges();\n        }\n    }\n</code></pre>\n\n<p>and my context is:</p>\n\n<pre><code>public abstract class DatabaseContextBase : DbContext\n    {\n        public DbSet&lt;UserRole&gt; Roles { get; set; }\n        public DbSet&lt;UserAndPermissionInGroup&gt; UserAndPermissions { get; set; }\n        public DbSet&lt;GeneralUser&gt; Users { get; set; }\n        public DbSet&lt;Group&gt; Groups { get; set; }\n        public DbSet&lt;Forum&gt; Forums { get; set; } \n\n        public DatabaseContextBase() :base(\"ForumDb\")\n        {\n\n        }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            base.OnModelCreating(modelBuilder);\n            modelBuilder.Entity&lt;Comment&gt;()\n                .HasRequired(e =&gt; e.Owner)\n                .WithMany(t =&gt; t.Comments)\n                .HasForeignKey(e =&gt; e.OwnerId)\n                .WillCascadeOnDelete(false);\n        }\n    }\n</code></pre>\n\n<p>And finally:</p>\n\n<pre><code>public class DatabaseContext : DatabaseContextBase\n\n{\n\n}\n</code></pre>\n\n<p>The problem is that, even with this initializer, I get the following error:</p>\n\n<blockquote>\n  <p>The model backing the 'DatabaseContext' context has changed since the\n  database was created. Consider using Code First Migrations to update\n  the database</p>\n</blockquote>\n\n<p>I am using EF 5 code first in an ASP.NET MVC 3 project. Any suggestions?</p>\n"},{"tags":["c#","linq","entity-framework","lambda"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13234447,"title":"Datetime check in Linq where statement","body":"<p>Please see the code below:</p>\n\n<pre><code>var pcPageList = db.PcPages\n        .Where(m =&gt; \n            m.Quarter == exactQuarter &amp;&amp; \n            m.Url == pageUrl &amp;&amp; \n            m.UpdatedOn.ToDateTime().Date.ToString(\"dd/MMM\").ToLower() == \"02/nov\")\n        .OrderBy(m =&gt; m.UpdatedOn)\n        .FirstOrDefault();\n</code></pre>\n\n<p>When I run this above, the application throws error says: \"ToDateTime\" is not implemented yet. Anyone please can advice ?</p>\n"},{"tags":["jquery","entity-framework","asp.net-mvc-3"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":429,"score":0,"question_id":6141216,"title":"mvc3 jquery ajax post error \"An entity object cannot be referenced by multiple instances of IEntityChangeTracker.\"","body":"<p>I've found a lot of posts about this error, but none of them helped, it seems that everybody else got this error in a different situation. But this is my first MVC project, so maybe I'm just not getting it :) So, I have a very simple ajax call:</p>\n\n<pre><code>         $.ajax({\n                type: \"POST\",\n                url: \"/Home/MyMethod\",\n                data: ({ SomeProperty:\"someValue\" }),\n                success: function (data) {\n                    var obj = jQuery.parseJSON(data);\n                    alert(obj.Status);\n                },\n                error: function () {\n                    alert(\"error\");\n                }\n            });\n</code></pre>\n\n<p>and the very simple <code>MyMethod</code> controller method:</p>\n\n<pre><code>        [HttpPost]\n        public JsonResult AddReport(MyModel model)\n        {\n            if (ModelState.IsValid)\n            {\n                db.MyModels.Add(model);\n                db.SaveChanges();\n                return Json(...);\n            }\n            else\n            {\n                //not good...\n            }\n        }\n</code></pre>\n\n<p>the line <code>db.MyModels.Add(model);</code> triggers the error. I have another controller in an admin area that handles the CRUD operations for the same model, and it's working just fine. I know that probably the problem is that the <code>model</code> is already attached to the <code>System.Data.Objects.ObjectContext</code> and I have to detach it, but I don't know how to do that. Any ideas?</p>\n"},{"tags":["c#","mysql","linq","entity-framework","entity-framework-5"],"answer_count":5,"favorite_count":3,"up_vote_count":5,"down_vote_count":1,"view_count":115,"score":4,"question_id":13257760,"title":"Why does Entity Framework SQL generation create a nested query?","body":"<p>Why does Entity Framework SQL generation create a nested query?</p>\n\n<p>I have this code</p>\n\n<pre><code>    var db = new Context();\n    var result = db.Network.Where(x =&gt; x.ServerID == serverId)\n        .OrderBy(x=&gt; x.StartTime)\n        .Take(limit);\n</code></pre>\n\n<p>Which will be transleted into this! (Note the dubble select statement)</p>\n\n<pre><code>SELECT\n`Project1`.`Id`, \n`Project1`.`ServerID`, \n`Project1`.`EventId`, \n`Project1`.`StartTime`\nFROM (SELECT\n`Extent1`.`Id`, \n`Extent1`.`ServerID`, \n`Extent1`.`EventId`, \n`Extent1`.`StartTime`\nFROM `Networkes` AS `Extent1`\n WHERE `Extent1`.`ServerID` = @p__linq__0) AS `Project1`\n ORDER BY \n`Project1`.`StartTime` DESC LIMIT 5\n</code></pre>\n\n<p>How could I change it into one <code>select</code> statement?\nI'm using MySQL and Entity Framework with code first</p>\n\n<h1>Update</h1>\n\n<p>I have the same result whatever type I use as parameter to the <code>OrderBy()</code> method.</p>\n\n<h1>Update 2 with some timeing</h1>\n\n<pre><code>Total Time (hh:mm:ss.ms)    05:34:13.000\nAverage Time (hh:mm:ss.ms)  25:42.000\nMax Time (hh:mm:ss.ms)  51:54.000\nCount   13\nFirst Seen  Nov 6, 12 19:48:19\nLast Seen   Nov 6, 12 20:40:22\n</code></pre>\n\n<p>Raw query:</p>\n\n<pre><code>SELECT `Project?`.`Id`, `Project?`.`ServerID`, `Project?`.`EventId`, `Project?`.`StartTime` FROM (SELECT `Extent?`.`Id`, `Extent?`.`ServerID`, `Extent?`.`EventId`, `Extent?`.`StartTime`, FROM `Network` AS `Extent?` WHERE `Extent?`.`ServerID` = ?) AS `Project?` ORDER BY `Project?`.`Starttime` DESC LIMIT ?\n</code></pre>\n\n<p>I use a program to take snapshots from the current process in MySQL.</p>\n\n<p>It's other querys that could be executed at the same time. But when I change it to just one SELECT statement, it NEVER goes over one second. Maybe I have something else that's going on, I'm asking couse I'm not so into DBs...</p>\n\n<h1>Update 3 The explain statement</h1>\n\n<p>The entity framework generated</p>\n\n<pre><code>'1', 'PRIMARY', '&lt;derived2&gt;', 'ALL', NULL, NULL, NULL, NULL, '46', 'Using filesort'\n'2', 'DERIVED', 'Extent?', 'ref', 'serveridneventid,serverid', 'serveridneventid', '109', '', '45', 'Using where'\n</code></pre>\n\n<p>One liner</p>\n\n<pre><code>'1', 'SIMPLE', 'network', 'ref', 'serveridneventid,serverid', 'serveridneventid', '109', 'const', '45', 'Using where; Using filesort'\n</code></pre>\n\n<p>This is from my QA enviroment, so the timeing I pasted above is not realted to this row count explain statements. I think that there is about 500,000 records that match one server id.</p>\n"},{"tags":["c#",".net","wpf","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13256246,"title":"linq to entity framework with join","body":"<p>I have in my DB 2 tables: </p>\n\n<ol>\n<li><p>Documents (Document_Id ,document_Name) </p></li>\n<li><p>Person_Documents (person_ID ,Documet_Id document_Done)</p></li>\n</ol>\n\n<p>I use entity framework and ,and I want to fill <code>DataGrid</code> with the data <code>document_Name</code> and <code>document_Done</code>,</p>\n\n<p>I have tried the following with no results:</p>\n\n<pre><code>      vagEntities projectE = new vagEntities();\n      var doc = from c in projectE.Person_Documents                   \n          join cw in projectE.Documents on c.Document_Id equals cw.Document_Id\n          where c.Person_Id == 150\n          select c;\n\n      DocGrid.ItemsSource = doc;\n</code></pre>\n\n<p>Please, where am I wrong?\nun the xaml i write this</p>\n\n<pre><code>                &lt;DataGridTextColumn Binding=\"{Binding Path=Document_Name}\" MinWidth=\"100\"   Header=\"document\"  /&gt;\n\n            &lt;DataGridCheckBoxColumn  Binding=\"{Binding Path=Document_done}\" Header=\"Do\" /&gt;\n</code></pre>\n"},{"tags":["asp.net","asp.net-mvc","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1333,"score":1,"question_id":2435362,"title":"Error while updating Database record with Entity Framework on ASP.NET MVC Page","body":"<p>I have an ASP.NET Page that updates registered User Address Details for a selected record.\nBelow is the Update method that i am calling from Controller.</p>\n\n<p>When i am calling <strong>ApplyPropertyChanges</strong> method, I am getting the below error.\nDid anyone run into the same error while updating the record with Entity Framework. </p>\n\n<p>Appreciate your responses.</p>\n\n<p><strong>Error Message:</strong> </p>\n\n<p>The existing object in the ObjectContext is in the Added state. Changes can only be applied when the existing object is in an unchanged or modified state.</p>\n\n<p><strong>My Update Method Code:</strong></p>\n\n<pre><code>[HttpPost]\n    public bool UpdateAddressDetail([Bind(Prefix = \"RegUser\")] AddressDetail regUserAddress, \n                        FormCollection formData)\n    {\n    regUserAddress.AD_Id = 3;\n        regUserAddress.LastUpdated = HttpContext.User.Identity.Name;\n        regUserAddress.UpdatedOn = DateTime.Now;\n        regUserAddress.AddressType = ((AddressDetail)Session[\"CurrentAddress\"]).AddressType ?? \"Primary\";\n        regUserAddress.Phone = ((AddressDetail)Session[\"CurrentAddress\"]).Phone;\n        regUserAddress.Country = ((AddressDetail)Session[\"CurrentAddress\"]).AddressType ?? \"USA\";\n\n        miEntity.ApplyPropertyChanges(regUserAddress.EntityKey.EntitySetName, regUserAddress);\n        miEntity.SaveChanges();\n        return true;\n    }\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework","code-generation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13257097,"title":"What is EF Templated Code Generation used for?","body":"<p>I've seen several <a href=\"http://geekswithblogs.net/iupdateable/archive/2009/11/19/getting-started-with-entity-framework-4---templated-code-generation.aspx\" rel=\"nofollow\">examples</a> / tutorials of using Entity Framework with Templated Code Generation.</p>\n\n<p>What is this tool doing? Is creating a new DataContext and a new set of EntityObjects? or is replacing the old ones? Why you will use a Code Generation instead of working directly with the ones created by the designer?</p>\n"},{"tags":["silverlight","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13238412,"title":"Invalid Column Name on a stored procedure (Silverlight WCF)","body":"<p>I have a Silverlight 4 apps that use the entity framework with WCF RIA.</p>\n\n<p>All of a sudden a few (I think 3) stored procedures stop working.  Every users reprot the same problem All of them has the error message when the Silverlight app tries to execute the related query.</p>\n\n<p>Load operation failed for query 'SomeStoredProcedure'. An error occurred while executing the command definition. See the inner exception for details. InnerException message: Invalid column name 'someColumn'.</p>\n\n<p>at System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior)</p>\n\n<p>at System.Data.Objects.Internal.ObjectQueryExecutionPlan.Execute[TResultType](ObjectContext context, ObjectParameterCollection parameterValues)</p>\n\n<p>at System.Data.Objects.ObjectQuery<code>1.GetResults(Nullable</code>1 forMergeOption)</p>\n\n<p>at System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable.GetEnumerator()</p>\n\n<p>at System.Data.Objects.ObjectQuery`1.GetEnumeratorInternal()</p>\n\n<p>at System.Data.Objects.ObjectQuery.System.Collections.IEnumerable.GetEnumerator()</p>\n\n<p>at System.ServiceModel.DomainServices.Server.DomainService.Enumerate[T](IEnumerable enumerable, Int32 estimatedResultCount)</p>\n\n<p>at System.ServiceModel.DomainServices.Server.DomainService.Query(QueryDescription queryDescription, IEnumerable`1&amp; validationErrors, Int32&amp; totalCount)</p>\n\n<p>at System.ServiceModel.DomainServices.Hosting.QueryProcessor.Process[TEntity](DomainService domainService, DomainOperationEntry queryOperation, Object[] parameters, ServiceQuery serviceQuery, IEnumerable`1&amp; validationErrors, Int32&amp; totalCount)</p>\n\n<p>at System.ServiceModel.DomainServices.Hosting.QueryOperationBehavior`1.QueryOperationInvoker.InvokeCore(Object instance, Object[] inputs, Object[]&amp; outputs)</p>\n\n<p>Now the weird thing is:</p>\n\n<p>a) I have a development deployment of the same app, and that works fine when connecting to the production database.</p>\n\n<p>b) If I connect to the SSMS and execute the stored procedure, it returns the correct data.</p>\n\n<p>c) So what I did was simply recompile the stored procedure.  I basically select the stored procedure, click Modify.  It will generate the ALTER PROCEDURE script, I just hit execute without changing anything inside.  Now suddenly all three stored procedures work fine again, even though I only recompile one of them.</p>\n\n<p>To explain this better, this is what happen in sequential order:</p>\n\n<p>1) The Silverlight app suddenly complain some SP does not contain some column</p>\n\n<p>2) Runs the SP in SSMS, returns normal and expected result.</p>\n\n<p>3) Recompile the SP </p>\n\n<p>4) Runs the SP in SSMS, returns the exact same result as #2.</p>\n\n<p>5) The Silverlight app works again</p>\n\n<p>What is going on??</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","design-patterns","architecture","domain-driven-design"],"answer_count":5,"favorite_count":5,"up_vote_count":6,"down_vote_count":0,"view_count":8378,"score":6,"question_id":7927382,"title":"Sample N-tier ASP.NET MVC3 application with best practices (using EF 4.1)","body":"<p>I am looking for a sample ASP.NET MVC3 N-Tier application that demonstrates best practices (uses Domain Driven Design and Entity Framework 4.1 Code first). I found the following. which one do you recommend out of these (or any other one not in this list)?</p>\n\n<p><a href=\"http://efmvc.codeplex.com/\" rel=\"nofollow\">http://efmvc.codeplex.com/</a></p>\n\n<p><a href=\"http://prodinner.codeplex.com/\" rel=\"nofollow\">http://prodinner.codeplex.com/</a></p>\n\n<p><a href=\"http://www.dofactory.com/Framework/Framework.aspx\" rel=\"nofollow\">http://www.dofactory.com/Framework/Framework.aspx</a> (not free)</p>\n"},{"tags":["entity-framework","c#-4.0","predicatebuilder"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13256843,"title":"Using PredicateBuilder in Entity for Optional Filters","body":"<p>I am using EF4 with the following sample database:</p>\n\n<pre><code>Departments\nDepartmentID (uniqueidentifier, PK)\nName (nvarchar(50))\nManagerID (uniqueidentifier, FK to Employees table)\n\nEmployees\nEmployeeID (uniqueidentifier, PK)\nLastName (nvarchar(50))\nFirstName (nvarchar(50))\nTitle (nvarchar(50))\nOfficeID (uniqueidentifier, FK to Offices table)\n\nOffices\nOfficeID (uniqueidentifier, PK)\nStreet (nvarchar(100))\nCity (nvarchar(50))\nState (nvarchar(2))\nZip (nvarchar(5))\n\nEmployeeAssignments\nDepartmentID (uniqueidentifier, PK, FK to Departments table)\nEmployeeID (uniqueidentifier, PK, FK to Employees table)\n</code></pre>\n\n<p>I am trying to construct a query using the entities to filter the departments by the following criteria along with their intended result sets:</p>\n\n<ul>\n<li>Department name - Departments which have the specified name</li>\n<li>Manager ID - Departments which are managed by the specified employee</li>\n<li>Manager Office ID - Departments whose manager works at the specified office</li>\n<li>Manager State - Departments whose manager works at an office in the specified state</li>\n<li>Employee ID - Departments which are assigned to the specified employee</li>\n<li>Employee Title - Departments which contain at least one employee with the specified title</li>\n<li>Employee State - Departments which contain at least one employee whose office is in the specified state</li>\n</ul>\n\n<p>The final result set is intended to be all of the filters AND'ed together. However, many times only a few filters will be used so I would like to generate the query in such a way that performance is improved for simpler queries. For example, if the filter criteria do not include employee ID, employee title, or employee state, there is no need for the query to do a join on the EmployeeAssignments table.</p>\n\n<p>I am attempting to use the PredicateBuilder found here <a href=\"http://petemontgomery.wordpress.com/2011/02/10/a-universal-predicatebuilder/\" rel=\"nofollow\">http://petemontgomery.wordpress.com/2011/02/10/a-universal-predicatebuilder/</a> , which the author claims functions identically to the one included in LinqKit. My reason for using this PredicateBuilder rather than the one in LinqKit is that I am unable to cast the result of the LinqKit query to an ObjectQuery and call ToTraceString() to see the query which is generated. Although LinqPad would allow me to see the query that gets generated by LinqKit I would have to have our IT department install it on my computer and that has been painful in the past.</p>\n\n<p>My first attempt at this produced code like the following:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>Expression&lt;Func&lt;Department, bool&gt;&gt; departmentFilters = PredicateBuilder.True&lt;Department&gt;();\n\nif (IsValidParameter(managerID))\n    departmentFilters = departmentFilters.And(department =&gt; department.ManagerID == managerID);\n\nif (IsValidParameter(managerOfficeID))\n    departmentFilters = departmentFilters.And(department =&gt; department.Manager.OfficeID == managerOfficeID);\n\nif (IsValidParameter(managerState))\n    departmentFilters = departmentFilters.And(department =&gt; department.Manager.Office.State == managerState);\n\nreturn new DepartmentEntities().Departments.Where(departmentFilters);\n</code></pre>\n\n<p>However, this produces the following SQL:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT \n[Extent1].[DepartmentID] AS [DepartmentID], \n[Extent1].[Name] AS [Name], \n[Extent1].[ManagerID] AS [ManagerID]\nFROM    [dbo].[Departments] AS [Extent1]\nINNER JOIN [dbo].[Employees] AS [Extent2] ON [Extent1].[ManagerID] = [Extent2].[EmployeeID]\nLEFT OUTER JOIN [dbo].[Employees] AS [Extent3] ON [Extent1].[ManagerID] = [Extent3].[EmployeeID]\nINNER JOIN [dbo].[Offices] AS [Extent4] ON [Extent3].[OfficeID] = [Extent4].[OfficeID]\nWHERE ([Extent1].[ManagerID] = @p__linq__0) AND ([Extent2].[OfficeID] = @p__linq__1) AND ([Extent4].[State] = @p__linq__2)\n</code></pre>\n\n<p>This includes a superfluous join to Employees to get the manager information (Extent2 and Extent3). I understand why this is happening - when the query is constructed it has no way of knowing that the Manager I am talking about for both of the filters is the same. This isn't a huge problem here, however in my actual business case there are filters on tables that are 3-4 joins away - if I have 3 filters on that table that would cause a total of 6-8 extra joins.</p>\n\n<p>Here's the notional code of what I am trying to achieve:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>private IQueryable&lt;Department&gt; GetDepartments(string departmentName, Guid managerID, Guid managerOfficeID, string managerState, Guid employeeID, string employeeTitle, string employeeState)\n    {\n        DepartmentEntities context = new DepartmentEntities();\n\n        Expression&lt;Func&lt;Department, bool&gt;&gt; departmentFilters = PredicateBuilder.True&lt;Department&gt;();\n        Expression&lt;Func&lt;Employee, bool&gt;&gt; managerFilters = PredicateBuilder.True&lt;Employee&gt;();\n        Expression&lt;Func&lt;Office, bool&gt;&gt; managerOfficeFilters = PredicateBuilder.True&lt;Office&gt;();\n        Expression&lt;Func&lt;Employee, bool&gt;&gt; employeeFilters = PredicateBuilder.True&lt;Employee&gt;();\n        Expression&lt;Func&lt;Office, bool&gt;&gt; employeeOfficeFilters = PredicateBuilder.True&lt;Office&gt;();\n\n        if (IsValidParameter(departmentName))\n            departmentFilters = departmentFilters.And(department =&gt; department.Name == departmentName);\n\n        if (IsValidParameter(managerID))\n            departmentFilters = departmentFilters.And(department =&gt; department.ManagerID == managerID);\n\n        if (IsValidParameter(managerOfficeID))\n            managerFilters = managerFilters.And(manager =&gt; manager.OfficeID == managerOfficeID);\n\n        if (IsValidParameter(managerState))\n            managerOfficeFilters = managerOfficeFilters.And(office =&gt; office.State == managerState);\n\n        if (IsValidParameter(employeeID))\n            employeeFilters = employeeFilters.And(employee =&gt; employee.EmployeeID == employeeID);\n\n        if (IsValidParameter(employeeTitle))\n            employeeFilters = employeeFilters.And(employee =&gt; employee.Title == employeeTitle);\n\n        if (IsValidParameter(employeeState))\n            employeeOfficeFilters = employeeOfficeFilters.And(office =&gt; office.State == employeeState);\n\n        employeeFilters = employeeFilters.And(employee =&gt; employee.Office.Where(employeeOfficeFilters));\n\n        IQueryable&lt;Department&gt; departments = context.Departments;\n        departments = departments.Where(departmentFilters);\n        departments = departments.Where(department =&gt; department.Manager.Where(managerFilters));\n        departments = departments.Where(department =&gt; department.Manager.Office.Where(managerOfficeFilters));\n        departments = departments.Where(department =&gt; department.Employees.AsQueryable().Any(employeeFilters));\n\n        return departments;\n    }\n</code></pre>\n\n<p>The following 3 lines towards the end are incorrect (Office and Manager are the entities themselves, not an EntityCollection and therefore .Where() does not apply), but (hopefully) convey the functionality I'm trying to achieve:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>employeeFilters = employeeFilters.And(employee =&gt; employee.Office.Where(employeeOfficeFilters));\n...\ndepartments = departments.Where(department =&gt; department.Manager.Where(managerFilters));\ndepartments = departments.Where(department =&gt; department.Manager.Office.Where(managerOfficeFilters));\n</code></pre>\n\n<p>I have been going in circles and adding unnecessary layers of abstraction over what I feel is a simple problem. Am I missing something obvious, or is there a fundamental problem with what I am trying to achieve (avoiding excessive joins when some filters are not specified)?</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net-mvc","entity-framework","jqgrid-asp.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13245746,"title":"Entity sql datetime literal","body":"<p>I am stuck in the ObjectQuery class it always gives me the error as \nSystem.Data.Entity: The argument types 'Edm.DateTime' and 'Edm.String' are incompatible for this operation., near WHERE predicate</p>\n\n<p>Please suggest me the solution, i followed the above approach, but it did not work.</p>\n\n<p>my code is as follows:</p>\n\n<p>C# code:</p>\n\n<pre><code>var _dbModel = new VISAIntBPAEntities();\n        var serializer = new JavaScriptSerializer();\n        Filters f = (!_search || string.IsNullOrEmpty(filters)) ? null : serializer.Deserialize&lt;Filters&gt;(filters);\n        //if (f != null)\n        //{\n        //    if (f.rules[0].field == \"CreatedDate\")\n        //    {\n        //        Convert.ToDateTime(f.rules[0].data).ToString();\n        //    }\n        //}\n        ObjectQuery&lt;Jobs&gt; filteredQuery = (f == null ? _dbModel.Jobs : f.FilterObjectSet(_dbModel.Jobs));\n        //if (f != null)\n        //{\n        //    if (f.rules[0].field == \"CreatedDate\")\n        //    {\n        //        filteredQuery.Parameters.Add(new ObjectParameter(\"CreatedDate\", Convert.ToDateTime(f.rules[0].data)));\n        //    }\n        //}\n        if (f != null)\n        {\n            DateTime dateTimeValue = Convert.ToDateTime(f.rules[0].data);\n            filteredQuery = filteredQuery.Where(string.Format(\"(it.CreatedDate = DATETIME'{0:yyyy-mm-dd hh:mm}')\", dateTimeValue));\n        }\n        filteredQuery.MergeOption = MergeOption.NoTracking; // we don't want to update the data\n        var totalRecords = filteredQuery.Count();\n</code></pre>\n\n<p>Cleint side code:</p>\n\n<p>this code is in built using jqgrid, which has a column called CreatedDate, which fills in the dropdown, i have a sql query which fetches me the distinct date part from the database.\nI am doing filtering based on the string date selection in the dropdown.</p>\n\n<pre><code>{\n        name: 'CreatedDate', index: 'CreatedDate', width: 140, stype: 'select', async: false, sorttype: 'date',\n        edittype: 'select', editoptions: { value: getCreatedJobDate() }, editable: true, formatoptions: { newformat: 'm/d/Y' },\n        //editrules: { required: true },\n        searchoptions: {\n        value: getCreatedJobDate,\n        sopt: ['eq', 'ne', 'lt', 'le', 'gt', 'ge', 'de']\n        }\n        }\n</code></pre>\n\n<p>Please help me as i am stuck with this approach, i need to do this way only.\nThanks in advance.</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13256290,"title":"EF get Keyvalues of added objects","body":"<p>Is it possible to get the entity keyvalues of added objects?</p>\n\n<p>The keyvalues are set after context.SaveChanges(). But unfortunately after context.SaveChanges the EntityState.Added is gone.</p>\n"},{"tags":["linq","entity-framework","linq-to-sql","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13255894,"title":"LINQ getting distinct records based on an item value","body":"<p>I have following LINQ query</p>\n\n<pre><code> var unallocatedOrders = (from orderLine in context.OrderLineItemDboes\n     where (orderLine.Status == unallocated || orderLine.Status == null)\n         &amp;&amp; orderLine.orderline.order.order_status_fk == verified\n     group orderLine\n         by new { orderLine.orderline.ol_id,orderLine.orderline.order.order_id }\n         into g\n     select new { OrderLineId = g.Key.ol_id, Count = g.Count(), OrderId = g.Key.order_id })\n .ToList();\n</code></pre>\n\n<p>Above query giving me results in the following way</p>\n\n<pre><code>Order1 ol1 2\norder1 ol2 3\norder1 ol3 1\norder2 ol1 1\norder2 ol2 2\norder3 ol1 4\norder3 ol2 3\norder3 ol3 2\n</code></pre>\n\n<p>I need to iterate through the above list based on order ids and need to fetch corresponding lines and quantity. \nI need to get this line id and quantity to a Dictionary.\nCan somebody suggest how can I get it done.</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13256168,"title":"Entity Framework Entry Change Tracking Issues","body":"<p>I have the Profile model listed below.  This model is sent to the client via an ajax call and then updated and sent back to the server via another ajax call.  </p>\n\n<p>When the client makes changes they are responsible for setting the ObjectState of the model they are working with.  For example if they were changing the  Name property they would set the Name property to the new value and also set the ObjectState property to 2 (Modified) and to add a new Address to the Addresses they would set the ObjectState of the new Address to 1 (Added).  This all works great and the ApiController receives the new Profile object properly.</p>\n\n<pre><code>public enum ObjectState\n{\n    Unchanged = 0,\n    Added = 1,\n    Modified = 2,\n    Deleted = 3\n}\n\npublic interface IObjectState\n{\n    ObjectState ObjectState { get; set; }\n}\n\nstatic class EntityStateHelper\n{\n    public static EntityState ConvertState(ObjectState objectState)\n    {\n        switch (objectState)\n        {\n            case ObjectState.Added:\n                return EntityState.Added;\n            case ObjectState.Deleted:\n                return EntityState.Deleted;\n            case ObjectState.Modified:\n                return EntityState.Modified;\n            default:\n                return EntityState.Unchanged;\n        }\n    }\n}\n\n// Models\npublic class Profile : IObjectState\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public DateTime? BirthDay { get; set; }\n\n    // Navigation Properties\n    public ICollection&lt;Address&gt; Addresses { get; set; }\n\n    public ObjectState ObjectState { get; set; }\n}\n\npublic class Address : IObjectState\n{\n    public int Id { get; set; }\n    public string Street1 { get; set; }\n    public string Street2 { get; set; }\n    public string City { get; set; }\n    public string State { get; set; }\n    public string Zip { get; set; }\n    public ObjectState ObjectState { get; set; }\n}\n</code></pre>\n\n<p>Inside of my ProfileRepository I have actually have separated out Insert and Update and in the case of the Profile object, the client does not have a service call to delete a profile so really all they can do for a profile is modify it.  In my Update method I choose to go with <code>_context.Entry&lt;T&gt;(entity)</code> as apposed to <code>_context.Entry&lt;T&gt;(entity).State = EntityState.Modified</code> cause this throw the exception stating <em>An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key</em>.</p>\n\n<pre><code>public void Update(T entity)\n{\n    _context.Entry&lt;T&gt;(entity);\n    _context.ApplyStateChanges();\n}\n</code></pre>\n\n<p>First let me say that I don't actually have ApplyStateChanges in the Update method but for this sample it will show what is happening.  Below is the code for the ApplyStateChanges method.</p>\n\n<pre><code>public static class DbContextEntensions\n{\n    public static void ApplyStateChanges(this DbContext context)\n    {\n        foreach (var trackableEntry in context.ChangeTracker.Entries&lt;IObjectState&gt;())\n        {\n            IObjectState state = trackableEntry.Entity;\n            trackableEntry.State = EntityStateHelper.ConvertState(state.ObjectState);\n        }\n    }\n} \n</code></pre>\n\n<p>So here is the issue.  Let's say that the Profile at the client is that the Name property is John and the Addresses property contains 1 address.  If the client changes the Name to Steve and modifies the 1 Address all is good cause when ApplyStateChanges get called the DbEntityEntries for each get marked with the proper EntityState.  The problem comes about when the client adds a new Address to the Addresses collection with a State of 1 (Added).  When ApplyStateChanges gets called the call to <code>context.ChangeTracker.Entries&lt;IObjectState&gt;()</code> it does not return the newly added Address as an Entry that has changed by the ChangeTracker.</p>\n\n<p>I am pretty certain that the code <code>_context.Entry&lt;T&gt;(entity)</code> should be <code>_context.Entry&lt;T&gt;(entity).State = EntityState.Modified</code> but I can't seem to get around this exception no matter what I have tried.</p>\n\n<p>I am using EntityFramework 5.0 with .NET 4.0 meaning an EntityFramework version of 4.4.  What am I missing?  I have read what I feel is every article that I can find on the subject and this looks like it should work.  I got this State change tracking code from Julie Lerman's PluralSight video <a href=\"http://pluralsight.com/training/courses/TableOfContents?courseName=efarchitecture&amp;highlight=julie-lerman_efarchitecture-m2-boundedcontext!julie-lerman_efarchitecture-m3-archrepo!julie-lerman_efarchitecture-m4-testing!julie-lerman_efarchitecture-m1-overview#efarchitecture-m2-boundedcontext\" rel=\"nofollow\">Entity Framework in the Enterprise</a>.  </p>\n\n<p>Any help in pointing me in the right direction would be greatly appreciated.  </p>\n"},{"tags":["entity-framework","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":403,"score":2,"question_id":6427208,"title":"Entity Framework only with stored procedures","body":"<p>i have a question about the reasonableness of using entity framework only with stored procedures in our scenario.</p>\n\n<p>We plan to have an N-tier architecutre, with UI, BusinessLayer (BLL), DataAccessLayer(DAL) and a BusinessObjectDefinitions(BOD) layer. The BOD layer is known by all other layers and the results from executes queries in the DAL should be transformed into Objects (definied in the BOD) before passing into the BLL.</p>\n\n<p>We will only use stored procedures for all CRUD methods.\nSo in case of a select stored procedure, we would add a function import, create a complex type and when we execute the function, we tranform the values of the complex type into a class of BOD and pass that to the BLL.\nSo basicly, we have no Entities in the Model, just Complex types, that are transformed into Business Objects.</p>\n\n<p>I'm not sure if that all makes sense, since in my opinion, we lose a lot of the benefit, EF offers.</p>\n\n<p>Or am i totally wrong?</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":54,"score":4,"question_id":13254224,"title":"SQL Order by a float column not working","body":"<p>I have the following rows in my db:</p>\n\n<pre><code>ID       Weight\n-----------------------------\n897      1.46357497509608E-11\n689      6.67145488899268E-12\n896      6.63573718293682E-12\n615      5.14817058560092E-12\n822      5.14806820534293E-12\n</code></pre>\n\n<p>When I execute the following SQL query: </p>\n\n<pre><code>SELECT * \nFROM mytable \nORDER BY weight DESC\n</code></pre>\n\n<p>the data is being returned in the same order.</p>\n\n<p>P.S. the same thing is happening from a Linq query in an ASP.NET C# application</p>\n"},{"tags":["c#","entity-framework","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13255452,"title":"How to change an Entity source table after the context is created?","body":"<p>I have the same problem I explained at <a href=\"http://stackoverflow.com/questions/11142530/change-entity-map-to-another-unknown-table-at-runtime\">Change entity map to another &quot;unknown&quot; table at runtime</a> but now I need it after the context is created. I'm using Code First with EF version 4.1. Do I have to create again the entire context? </p>\n"},{"tags":["entity-framework","asp.net-mvc-4","dbcontext"],"answer_count":5,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":150,"score":5,"question_id":13067793,"title":"Manage the lifetime of dbContext","body":"<p>I would like to tie the lifetime of a dbContext to the lifetime of a session, to - for example - be able to commit or abandon changes on a group of mutations on the dbcontext over multiple requests.</p>\n\n<p>Are there any other (better?) ways to accomplish this? If no, what would be a suitable mechanism to create and dispose of the contexts? I am thinking about static hashtables with cleanup on session end, but maybe I'm doing it All Wrong. I am also thinking about the idea of only holding on to those contexts that have to do work over multiple requests, and keeping the rest per action. Any advice?</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13250882,"title":"Getting a SQL View via Entity Framework returns incorrect result","body":"<p>I have a very simple View in SQL Server which looks something like this, Where the <strong>Show</strong> is a result of <strong>LEFT JOIN</strong> with <strong>Character</strong> table:</p>\n\n<pre><code>+---------+----------+----------------------+  \n|  Name   | Surname  |         Show         |  \n+---------+----------+----------------------+  \n| Enoch   | Thompson | The Boardwalk Empire |  \n| Anthony | Soprano  | The Sopranos         |  \n| Walter  | White    | Breaking Bad         |  \n+---------+----------+----------------------+  \n</code></pre>\n\n<p>When I get this table via Entity Framework's <code>context.CharacterView.ToList()</code> in my application, the result looks like this: </p>\n\n<pre><code>+---------+----------+----------------------+  \n|  Name   | Surname  |         Show         |  \n+---------+----------+----------------------+  \n| Enoch   | Thompson | The Boardwalk Empire |  \n| Anthony | Soprano  | The Boardwalk Empire |  \n| Walter  | White    | The Boardwalk Empire |  \n+---------+----------+----------------------+  \n</code></pre>\n\n<p>However, in DB the CharacterView is <em>as it should be.</em></p>\n\n<hr>\n\n<h2>Create view query</h2>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE VIEW CharacterView AS\nSELECT c.Name AS [Name], \n       c.Surname AS [Surname], \n       s.Name AS [Show]\n\nFROM   [dbo].[Characters] AS c LEFT OUTER JOIN\n       [dbo].[Shows] AS scen ON c.ShowId = s.Id\n</code></pre>\n\n<hr>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12962448,"title":"Populating a property in an Entity when doing a LINQ to Entities query","body":"<p>I have an entity type, let's call it Transaction, created by entity framework version 1. I have added the following property:</p>\n\n<pre><code>public partial class Transaction\n{\n    public int CurrentMaxRevisionNumber { get; set; }\n}\n</code></pre>\n\n<p>And I have the following query:</p>\n\n<pre><code>public List&lt;Transaction&gt; GetTransactions(DateTime startDate, DateTime endDate)\n{\n   var query = from t in Repository.Transaction  \n       let currentMaxRevisionNumber = \n        Repository.Transaction.Where(t1 =&gt; t1.TransactionId == t.TransactionId)\n                               .Max(t1 =&gt; t.RevisionNumber)\n       where t.StartDate &gt;= startDate\n             &amp;&amp; t.EndDate &lt; endDate)\n    select t;\n\n    return query.ToList();\n}\n</code></pre>\n\n<p>The business rules for what we are trying to accomplish are the following:<br>\n- A new record for the transaction on the original date should be created with a code that indicates it has been soft deleted with an increased revision number.<br>\n- A new record for the transaction is to be created on the new date with an increased revision number.</p>\n\n<p>The problem is that the process that determines when the transaction will be processed is done sequentially one day at a time and transactions are being moved from date to date and sometimes back to their original ones constantly. This may result that the max revision number of a given transaction will be the one from the specific date and not the max for the transaction. That is the reason why I am trying to do the \"let\" in the query.</p>\n\n<p>Now the questions:<br>\n- How can I populate the CurrentMaxRevisionNumber property I created in the partial class with the query?<br>\n- Is there maybe another way I can accomplish this without having to do a query for each transaction since there may be several hundreds at any given date?</p>\n\n<p>Thanks for you help.</p>\n"},{"tags":["asp.net-mvc","linq","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13248860,"title":"Querying an auto-generated EF junction table","body":"<p>I have two models, Benefit and SchemeName</p>\n\n<p>Benefit - </p>\n\n<pre><code>[Key]\npublic int BenefitID { get; set; }\npublic string BenefitName { get; set; }\npublic string BenefitDescription { get; set; }\npublic virtual ICollection&lt;SchemeName&gt; SchemeNames { get; set; }\n</code></pre>\n\n<p>SchemeName</p>\n\n<pre><code>[Key]\npublic int SchemeNameID { get; set; }\npublic string Name { get; set; }\npublic virtual ICollection&lt;Benefit&gt; Benefits { get; set; }\n</code></pre>\n\n<p>This has created three tables in the database Benefits, SchemeNames and a joining table called SchemeNameBenefits.</p>\n\n<p>I am trying to populate a droplownlist that contains only the SchemeNames associated with a certain Benefit but am not sure how I can do this, can I reference the join table in my code?</p>\n\n<p>I started with the following (which returns all SchemeNames)</p>\n\n<pre><code>private void PopulatePensionSchemeName(object selectedPensionSchemeName = null)\n        {\n            var schemeNameQuery = from d in db.SchemeNames\n                                  orderby d.SchemeNameID\n                                  select d;\n\n            ViewBag.PensionSchemeNameID = new SelectList(schemeNameQuery, \"SchemeNameID\", \"Name\", selectedPensionSchemeName);\n        }\n</code></pre>\n\n<p>But I'm not sure how I can add this clause. Any pointers?</p>\n"},{"tags":["c#",".net","entity-framework","linq-to-entities","garbage-collection"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":75,"score":3,"question_id":13207390,"title":"How to update an existing object's properties using LINQ to Entities?","body":"<p>LINQ to Entities allows this:</p>\n\n<pre><code>context.User.Select(u =&gt; new Person\n{\n    Name = u.Name,\n    Parent = u.Parent.Name\n});\n</code></pre>\n\n<p>I need only two properties of a big <code>User</code> table and I get them using the <code>Select</code> method to create a <code>Person</code> object so I can do some processing with it. The thing is that I do this a lot (like twice a second) and it hurts the <code>GC</code>.</p>\n\n<p>So I decided to pool the <code>Person</code> objects but I have no idea how to update an existing object using LINQ to Entities. I can get it as an anonymous method like above and then assign its properties to the depooled object I guess, then I can return the depooled instance, this would at least make the anonymous instance go away in a lower generation of <code>GC</code> but...</p>\n\n<p>I'd really prefer something like this:</p>\n\n<pre><code>context.User.Select(u =&gt; People.Take(u.Name, u.Parent.Name))\n</code></pre>\n\n<p>Which throws a <code>NotSupportedException</code>.</p>\n\n<ul>\n<li>Can I use Entity Framework to update the values of an existing object?</li>\n<li>If so, how?</li>\n<li>If not, what alternatives do I have?</li>\n</ul>\n"},{"tags":["entity-framework","custom-attributes"],"answer_count":5,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":6871,"score":10,"question_id":1050714,"title":"Adding custom property attributes in Entity Framework code","body":"<p>Is there any way to add custom attributes to properties in EF generated code?  The only thing I can see as a plausible solution would be to come up with a custom T4 template.  However, because of the nature of the attribute it would be impossible to determine the correct attribute parameter per EF property.  </p>\n"},{"tags":["c#","sql-server","visual-studio","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13253976,"title":"SQL Server Express looking for database in wrong folder","body":"<p>Here is the general problem I'm having:</p>\n\n<p>At work, we have a Visual Studio project that has a SQL project with Entity Framekwork (in addition to a lot of other projects that are class libraries). We are using the same base code for all our projects and just copying it in to a new folder, and adding a new web project and deleting the old web project. We create the database during development automatically if they don't exist already using a DbContext Initializer (it's the <code>DropCreateDatabaseAlways</code> one). Often, whenever this happens and we try to connect to the database, we get the following error:</p>\n\n<p><code>Database 'C:\\\\www\\\\[old project]\\\\app\\\\Web\\\\App_Data\\\\[new project database name from connection string].mdf' already exists. Choose a different database name.\\r\\nCannot attach the file 'C:\\\\www\\\\[new project]\\\\app\\\\Web\\\\App_Data\\\\[new project database name from connection string].mdf' as database '[new project database name]'.\"}</code></p>\n\n<p>It's basically looking in the old folder for the new database, but not actually creating the database like it's supposed to.</p>\n\n<p>Basically it's looking for the database in a different directory than the current project, even though the connection string specifies to attach from the <code>|DataDirectory|</code>. Cleaning the solution, changing the connection string, changing the app.config file, restarting the machine, etc. doesn't help at all. If I rename the folder on the project, it'll work though. </p>\n\n<p>I'm honestly totally flummoxed as to what's going on. I'm fairly competent in and around VS 2010 and SQL Server, so I feel like I should be able to figure out what's going on. It might be something simple that I'm missing, but any help would be appreciated.</p>\n"},{"tags":["entity-framework","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":33,"score":3,"question_id":13253497,"title":"Code first EntityConfiguration","body":"<p>Is it possible to modify / replace an entity configuration in a context that is being inherited in a different context?</p>\n\n<p>Example:  I have Context in a project called Data.Access in a solution called Framework.  Its OnModelCreating function adds entity configurations thusly:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder) \n{\n   // TestEntityConfiguration is the configuration of an entity named TestEntity in the Framework solution\n   modelBuilder.Configurations.Add(new TestEntityConfiguration());\n\n   // multiple other configurations...\n}\n</code></pre>\n\n<p>In another solution called FrameworkConsumer, I have a Local.Data.Access project that has a Context class which extends Context from Data.Access in the Framework solution.  Its OnModelCreating function looks like this:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n   // Adds all the configurations from the Context in Data.Access in the Framework solution\n   base.OnModelCreating(modelBuilder);\n\n   // Other configurations local to the extended context go here...\n}\n</code></pre>\n\n<p>My question is this.  In the Local.Data.Access project in the FrameworkConsumer solution, if I wanted to add extra configuration settings or a different configuration for TestEntity, how can this be accomplished or can it be done?  I've tried adding another configuration however, I get errors stating that this Entity (TestEntity) has already been configured.  For now, my solution to add extra configuration was to use Database.ExecuteSqlCommand in the Dispose function in Local.Data.Access Context class.  Not elegant, but it works.  Any ideas / advice would be appreciated.</p>\n\n<p>Thanks</p>\n"},{"tags":["asp.net-mvc","sql-server-2008","entity-framework","entity-framework-4","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13252472,"title":"Entity Framework import and use stored procedure which returns different result sets depending on input","body":"<p>I am working on a migration project, where I am migrating an web forms app to a ASP.NET MVC 4 app.</p>\n\n<p>I have come across this one scenario with which I need a little help.</p>\n\n<p>In the old web form project I have stored proc like...</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[TestMultipleResultSet]\n    @input VARCHAR\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    IF NOT EXISTS\n    (\n        SELECT * FROM Electronics\n        WHERE name = @input\n    )\n    BEGIN\n        SELECT 101 AS errorcode\n        RETURN\n    END\n\n    SELECT * FROM Electronics \n    WHERE name = @input\nEND\n</code></pre>\n\n<p>like the above <code>if not exist</code> check, there are many other checks with gives different <code>select * from</code> as resultset.</p>\n\n<p>Now I want to use Entity framework to execute this stored procedure, so I imported the function and created a complex type using the <code>Get Column Information</code> + <code>Create Complex Type</code> option which EF provides.</p>\n\n<p>Now it runs when I enter a valid @input which executes <code>SELECT * FROM Electronics WHERE name = @input</code> but when I enter an input which is not present instead of returning me a 101 error code it gives me an error. An exception is thrown.</p>\n\n<p>Exception details</p>\n\n<blockquote>\n  <p>The data reader is incompatible with the specified 'testEFModel.GetTestResults_Result1'. A member of the type, 'id', does not have a corresponding column in the data reader with the same name.</p>\n</blockquote>\n\n<p>How should I solve this ?</p>\n"},{"tags":[".net","visual-studio-2010","entity-framework","visual-studio-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13251958,"title":"Entity Framework update schema without dropping / loosing data","body":"<p>I'm searching if there is a better way than <a href=\"http://stackoverflow.com/questions/3144117/entity-framework-4-update-database-schema-from-model-without-wiping-the-table\">\"Database Generation Power Pack\"</a> to update automatically the Database Schema from an Entity Framework design (Visual Studio 2010) to an MS-SQL Database without dropping any data. In fact, for example, we can't rename or delete a propriety with \"Database Generation Power Pack\".</p>\n\n<p>But, perhaps, it's integrated in Visual Studio 2012?</p>\n"},{"tags":["entity-framework","linq-to-entities","odata"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":29,"score":4,"question_id":13251313,"title":"What type should my list contain?","body":"<p>I have this query</p>\n\n<pre><code>List&lt;int&gt; AuctionIds = \n   (from a in _auctionContext.Auctions\n    where a.AuctionEventId == auction.AuctionEventId\n    select new { a.Id }).ToList();\n</code></pre>\n\n<p>But I receive a compile error</p>\n\n<pre><code>Cannot implicitly convert type 'System.Collections.Generic.List&lt;AnonymousType#1&gt;' to 'System.Collections.Generic.List&lt;int&gt;'\n</code></pre>\n\n<p>What type should AuctionIds be?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":36,"score":-1,"question_id":13251140,"title":"Entity Framework Code First NullReferenceException","body":"<p>I'm using Entity Framework Code First, I've an entity <code>Articolo</code> and <code>ZefiroContext : DbContext</code> which contains the following declaration:</p>\n\n<pre><code>public DbSet&lt;Articolo&gt; Articoli { get; set; }\n</code></pre>\n\n<p>When I run the following code:</p>\n\n<pre><code>var a = new ZefiroContext().Articoli;\nList&lt;Articolo&gt; r;\nif (a != null) \n    r = a.ToList();\nelse\n    r = new List&lt;Articolo&gt;();\n</code></pre>\n\n<p>I get a <code>NullReferenceException</code> at line <code>r = a.ToList();</code>. I have no <code>Articolo</code> entites in my database so I expect my variable <code>r</code> to point to an empty <code>List&lt;Articolo&gt;</code>.</p>\n"},{"tags":["entity-framework","ef-code-first","wcf-ria-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13251147,"title":"Nested object null on client side in CODE FIRST EF RIA Service","body":"<p>I have nested object in EF Code First using Silverlight RIA service, I am able to get the data at service side but when I see it on client side child objects are null. Could you please guide me what's wrong.</p>\n\n<pre><code>[HasSelfValidation]\npublic class Batch\n{\n\n    public int BatchId { get; set; }\n    public string BatchName { get; set; }\n    [Include]\n    [Composition]\n    [Association(\"FK_Batch_BathSetItemSet\", \"BatchId\", \"BatchSetIdItemSetId\")]\n    public virtual ICollection&lt;BatchSetItemSet&gt; BatchSetItemSets { get; set; }\n }\npublic class BatchSetItemSet\n{\n\n    public int BatchSetIdItemSetId { get; set; }\n    public int BatchId { get; set; }\n    public Nullable&lt;int&gt; ItemSetId { get; set; }\n    public string CreatedBy { get; set; }\n    public  Batch Batch { get; set; }\n     [Include]\n     [Composition]\n     [Association(\"FK_BathSetItemSet_ItemSet\", \"BatchSetIdItemSetId\", \"ItemSetId\")]\n    public  ItemSet ItemSet { get; set; }\n}\npublic class ItemSet\n{\n\n    public int ItemSetId { get; set; }\n    public int CustodianId { get; set; }\n    public string ItemSetName { get; set; }\n    public virtual ICollection&lt;BatchSetItemSet&gt; BatchSetItemSets { get; set; }\n    [Include]\n    [Composition]\n    [Association(\"FK_ItemSet_Custodian\", \"ItemSetId\", \"CustodianId\")]\n    public virtual Custodian Custodian { get; set; }\n}\n</code></pre>\n\n<p>and service call is :    <code>this.DbContext.Batches.Include(\"BatchSetItemSets.ItemSet.Custodian\").Where(x =&gt; x.BatchId == batchId).SingleOrDefault();</code>     </p>\n"},{"tags":["entity-framework","ria","lightspeed"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13251136,"title":"EF with KeyTable Sequence style PK","body":"<p>How to implement in EF5 a KeyTable style identity method</p>\n\n<p>\"Uses a table in the database to store the next Id, and advances this value every time a new block of Ids is required\" from <a href=\"http://www.mindscapehq.com/documentation/lightspeed/Controlling-the-Database-Mapping/Identity-Generation\" rel=\"nofollow\">LightSpeed</a></p>\n\n<p>I believe this is like Oracle sequences.</p>\n\n<p>This feels like it should be easy (as it is in LightSpeed).  This gives the ORM an easy way to do bulk inserts ie it can get 10 identities at a time, then do a bulk insert back to the db.</p>\n\n<p>Am using EF5 / WCF RIA Services (latest) talking to Silverlight.  The rest of the project uses bulk insert SSIS stuff.. and the SL project does some inserting.  So I need to follow this convention.  </p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13236116,"title":"Entity framework, problems updating related objects","body":"<p>I am currently working on a project using the latest version of Entity Framework and I have come across an issue which I can not seem to solve.  </p>\n\n<p>When it comes to updating existing objects, I can fairly easily update the object properties ok, until it comes to a property which is a reference to another class.</p>\n\n<p>In the below example I have a class called Foo, which stores various properties, with 2 of these being instances of other classes</p>\n\n<pre><code>public class Foo\n{\n     public int Id {get; set;}\n     public string Name {get; set;}\n     public SubFoo SubFoo {get; set}\n     public AnotherSubFoo AnotherSubFoo {get; set}\n}\n</code></pre>\n\n<p>When I use the below Edit method, I pass in the object I wish to update and I can manage to get the Name to properly update, however I have not managed to find a way in which to get the properties of the SubFoo to change.  For example, if the SubFoo class has a property of Name, and this has been changed and is different between my DB and the newFoo, it does not get updated.</p>\n\n<pre><code>public Foo Edit(Foo newFoo)\n{\n\n        var dbFoo = context.Foo\n                           .Include(x =&gt; x.SubFoo)\n                           .Include(x =&gt; x.AnotherSubFoo)\n                           .Single(c =&gt; c.Id == newFoo.Id);\n\n\n\n        var entry = context.Entry&lt;Foo&gt;(dbFoo);\n        entry.OriginalValues.SetValues(dbFoo);\n        entry.CurrentValues.SetValues(newFoo);\n\n        context.SaveChanges();\n\n        return newFoo;\n}\n</code></pre>\n\n<p>Any help or pointers would be greatly appreciated.</p>\n\n<p>UPDATE:\nBased on the comment by Slauma I have modified my method to </p>\n\n<pre><code>public Foo Edit(Foo newFoo)\n{\n\n        var dbFoo = context.Foo\n                           .Include(x =&gt; x.SubFoo)\n                           .Include(x =&gt; x.AnotherSubFoo)\n                           .Single(c =&gt; c.Id == newFoo.Id);\n\n\n\n        context.Entry(dbFoo).CurrentValues.SetValues(newFoo);\n        context.Entry(dbFoo.SubFoo).CurrentValues.SetValues(newFoo.SubFoo);\n\n        context.SaveChanges();\n\n        return newFoo;\n}\n</code></pre>\n\n<p>When running this now, I get the error </p>\n\n<pre><code>'The entity type Collection`1 is not part of the model for the current context.'\n</code></pre>\n\n<p>To try and get around this, I added code to try to attach the newFoo subclasses to the context, but this through an error saying that the ObjectManager already had an entity the same</p>\n\n<pre><code>An object with the same key already exists in the ObjectStateManager. The \nObjectStateManager cannot track multiple objects with the same key\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4.3"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":334,"score":5,"question_id":10623260,"title":"How can I disable model compatibility checking in Entity Framework 4.3?","body":"<p>I'm working with EF 4.3 and have a context which needs to talk to a database which was generated by another library using EF Code First 4.3.  The context is throwing an exception stating </p>\n\n<pre><code>The model backing the 'Context' context has changed since the\ndatabase was created. Consider using Code First Migrations to update \nthe database\n</code></pre>\n\n<p>In EF 4.1 this could be diabled by removing the <code>IncludeMetadataConvention</code> from the ModelBuilder.  However, in 4.3 this convention has been deprecated and no longer has an effect.</p>\n\n<p>How can I have an EF 4.3 context talk to an EF 4.3-generated database <em>built by a different context</em>?  The only option I've found (which is far from ideal) is to delete the metadata table, thereby causing <em>both</em> contexts to assume the database was not build by EF.</p>\n\n<p><strong>PS:</strong> I know this scenario is likely to raise questions about <em>why</em> I need to do this; I know it's far from ideal, but rest assured it's a problem I need to solve and have limited options to work with laterally.</p>\n"},{"tags":["c#","asp.net","asp.net-mvc","entity-framework","visual-studio-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13251060,"title":"EF 4: System.Data.Entity.Edm.EdmEntityType: Name: Each type name in a schema must be unique","body":"<p>I want to use EF code first approach.</p>\n\n<p>I have read this post:</p>\n\n<p><a href=\"http://weblogs.asp.net/scottgu/archive/2010/07/16/code-first-development-with-entity-framework-4.aspx\" rel=\"nofollow\">http://weblogs.asp.net/scottgu/archive/2010/07/16/code-first-development-with-entity-framework-4.aspx</a></p>\n\n<p>and created my BL classes</p>\n\n<pre><code>public class AppData\n{\n    public string Id { get; set; }\n\n    public string Url { get; set; }\n\n    public AppData_OptionsDialog OptionsDialog { get; set; }\n\n    public AppData_Compatibility Compatibility { get; set; }\n\n}\n\npublic class AppData_Compatibility\n{\n    public int Id { get; set; }\n\n    public string Platform { get; set; }\n\n    public string MaxVersion { get; set; }\n}\n\n\npublic class AppData_OptionsDialog\n{\n\n    public int Id { get; set; }\n\n    public string DisplayName { get; set; }\n\n    public string AppDesc { get; set; }\n\n    public string PrivacyPolicyUrl { get; set; }\n\n    public string TermsOfUseUrl { get; set; }\n\n}\n\n\npublic class AppsDataContext : System.Data.Entity.DbContext\n{\n    public AppsDataContext() : base(\"MaMDB\") { }\n\n    public DbSet&lt;Conduit.Mam.Common.BlData.AppsData.AppData&gt; AppsData { get; set; }\n\n    public DbSet&lt;Conduit.Mam.Common.BlData.AppsData.AppData_Compatibility&gt; AppData_Compatibilities { get; set; }\n\n    public DbSet&lt;Conduit.Mam.Common.BlData.AppsData.AppData_OptionsDialog&gt; AppData_OptionsDialogs { get; set; }       \n}\n</code></pre>\n\n<p>I have created corrisponding tables in the DB.</p>\n\n<p>I understand EF uses convention over configuration.</p>\n\n<p>So is it magically maps the classes to the DB? no need to generate an em</p>\n\n<p>I try to execute a test on of the methods:</p>\n\n<pre><code>    public IList&lt;Conduit.Mam.Common.BlData.AppsData.AppData&gt; GetAll()\n    {\n        var apps = from app in AppsDataContext.AppsData\n               select app;\n\n        return apps.ToList();\n    }\n</code></pre>\n\n<p>but get the following error:</p>\n\n<blockquote>\n  <p>One or more validation errors were detected during model generation:</p>\n  \n  <p>\\tSystem.Data.Entity.Edm.EdmEntityType: Name: Each type name in a\n  schema must be unique. Type name 'AppData_OptionsDialog' is already\n  defined. \\tSystem.Data.Entity.Edm.EdmEntityType: Name: Each type name\n  in a schema must be unique. Type name 'AppData_Compatibility' is\n  already defined.</p>\n</blockquote>\n\n<p>I have seen this answer, but it didn't help me</p>\n\n<p><a href=\"http://stackoverflow.com/questions/979664/entity-framework-error-the-entitycontainer-name-must-be-unique\">Entity Framework error - &quot;The EntityContainer name must be unique&quot;</a></p>\n"},{"tags":["asp.net-mvc","performance","entity-framework","iis","entity-framework-5"],"answer_count":0,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":78,"score":5,"question_id":13250679,"title":"How to \"warm-up\" Entity Framework? When does it get \"cold\"?","body":"<p>No, the answer to my second question is not the winter.</p>\n\n<p><strong>Preface:</strong></p>\n\n<p>I've been doing a lot of research on Entity Framework recently and something that keeps bothering me is its performance when the queries are not warmed-up, so called cold queries. </p>\n\n<p>I went through the <a href=\"http://msdn.microsoft.com/en-us/data/hh949853.aspx\">performance considerations</a> article for Entity Framework 5.0. The authors introduced the concept of <strong>Warm</strong> and <strong>Cold</strong> queries and how they differ, which I also noticed myself without knowing of their existence. Here it's probably worth to mention I only have six month of experience behind my back.</p>\n\n<p>Now I know what topics I can research into additionally if I want to understand the framework better in terms of performance. Unfortunately most of the information on the Internet is outdated or bloated with subjectivity, hence my inability to find any additional information on the <em>Warm</em> vs <em>Cold</em> queries topic.</p>\n\n<p>Basically what I've noticed so far is that whenever I have to recompile or the recycling hits in, my initial queries are getting very slow. Any subsequent data read is fast (<em>subjective</em>), as expected.</p>\n\n<p>We'll be migrating to Windows Server 2012, IIS8 and SQL Server 2012 and as a Junior I actually won myself the opportunity to test them before the rest. I'm very happy they introduced a warming-up module that will get my application ready for that first request. However, I'm not sure how to proceed with warming up my Entity Framework.</p>\n\n<p>What I already know is worth doing:</p>\n\n<ul>\n<li>Generate my Views in advance as suggested.</li>\n<li>Eventually move my models into a separate assembly.</li>\n</ul>\n\n<p>What I consider doing, by going with common sense, <strong>probably wrong approach</strong>:</p>\n\n<ul>\n<li>Doing dummy data reads at Application Start in order to warm things\nup, generate and validate the models.</li>\n</ul>\n\n<p><strong>Questions:</strong> </p>\n\n<ul>\n<li>What would be the best approach to have high availability on my Entity Framework at anytime?</li>\n<li>In what cases does the Entity Framework gets \"cold\" again? (Recompilation, Recycling, IIS Restart etc.)</li>\n</ul>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":27,"score":3,"question_id":13249888,"title":"How do I save object to database using EF and get primary key created back from database?","body":"<p>I'm developing a WCF JSon Web service with C#, .NET Framework 4.0, using <code>Entity Framework</code> to access database.</p>\n\n<p>I have to create a new <code>EReportDB.EReport</code> object, fill it, save it on database and get its new pk <code>EReportDb.Ereport.eReportId</code>.</p>\n\n<p>This is my code, but I don't know how to do it:</p>\n\n<pre><code>    public bool SaveEReport(EReportContract eContractReport)\n    {\n        if (eContractReport == null)\n            throw new ArgumentNullException(\"eContractReport\", \"SaveEReport: eReport is null\");\n\n        using (EReportDB.EReportEntities context = new EReportDB.EReportEntities())\n        {\n            EReportDB.EReport eReport = new EReportDB.EReport();\n            eReport.orderId = eContractReport.orderId;\n            eReport.timeIn = DateTime.Parse(eContractReport.timeIn, new CultureInfo(\"en-GB\", false));\n            eReport.timeOut = DateTime.Parse(eContractReport.timeOut, new CultureInfo(\"en-GB\", false));\n            eReport.isProducFact = eContractReport.isProducFact;\n            /*\n              ..snip..\n            */\n            eReport.olPkSizeRs_ = eContractReport.olPkSizeRs;\n            eReport.olPkWeightRs = eContractReport.olPkWeightRs;\n        }\n        return false;\n    }\n</code></pre>\n\n<p><strong>How can I do that?</strong></p>\n"},{"tags":[".net","entity-framework","collections","poco","automapper"],"answer_count":3,"favorite_count":8,"up_vote_count":16,"down_vote_count":0,"view_count":3523,"score":16,"question_id":3441916,"title":"Automapper : mapping issue with inheritance and abstract base class on collections with Entity Framework 4 Proxy Pocos","body":"<p>I am having an issue using AutoMapper (which is an excellent technology) to map a business object to a DTO where I have inheritance off of an abstract base class within a collection.</p>\n\n<p>Here are my objects:</p>\n\n<pre><code>abstract class Payment\nclass CashPayment : Payment\nclass CreditCardPayment : Payment\n</code></pre>\n\n<p>I also have an invoice object which contains a collection of payments like so:</p>\n\n<pre><code>    public class Invoice\n    {\n       ... properties...\n\n       public ICollection&lt;Payment&gt; Payments { get; set; }\n    }\n</code></pre>\n\n<p>I also have corresponding DTO versions of each of these objects.</p>\n\n<p>The DtoInvoice object is defined as:</p>\n\n<pre><code>[DataContract]\npublic class DtoInvoice\n{\n   ...properties...\n\n   [DataMember]\n   public List&lt;DtoPayment&gt; Payments { get; set; }\n}\n</code></pre>\n\n<p>This is what my Mapper definitions look like:</p>\n\n<pre><code>Mapper.CreateMap&lt;Invoice, DtoInvoice&gt;();\n\nMapper.CreateMap&lt;Payment, DtoPayment&gt;()\n  .Include&lt;CashPayment, DtoCashPayment&gt;()\n  .Include&lt;CreditCardPayment, DtoCreditCardPayment&gt;();\n\nMapper.CreateMap&lt;CashPayment, DtoCashPayment&gt;();\nMapper.CreateMap&lt;CreditCardPayment, DtoCreditCardPayment&gt;();\n</code></pre>\n\n<p>The code to perform the mapping looks like this:</p>\n\n<pre><code>var invoice = repo.GetInvoice(invoiceId);\n\nvar dtoInvoice = Mapper.Map&lt;Invoice, DtoInvoice&gt;(invoice);\n</code></pre>\n\n<p>So for example if my invoice object contains a collection of specific payments (say 1 cash and 1 credit card) when mapper tries to map them I get an error that the abstract class Payment cannot be created. If I remove the abstract keyword from the Payment object then the code works but I only get a collection of Payment object, I do not get their specific objects (Cash &amp; Credit Card payments).</p>\n\n<p>So the question is: How can I get AutoMapper to map the specific payment types and not the base class?</p>\n\n<hr>\n\n<p><strong>Update</strong></p>\n\n<p>I did some more digging and think I see a problem but am not sure how I can solve this with AutoMapper. I think this is more of an EF thing and not AutoMapper's fault. :-)</p>\n\n<p>In my code I am using Entity Framework 4 Proxy POCOs with lazy loading.</p>\n\n<p>So when I try to map an entity returned from EF that is a proxy POCO it gets that funny looking type like:</p>\n\n<pre><code>System.Data.Entity.DynamicProxies.CashPayment_86783D165755C316A2F58A4343EEC4842907C5539AF24F0E64AEF498B15105C2\n</code></pre>\n\n<p>So my theory is that when AutoMapper tries to map CashPayment to DtoCashPayment and the payment passed in is of the proxy type AutoMapper sees it as a \"non match\" and then maps the generic Payment type. But since Payment is an abstract class AutoMapper bombs with a \"System.InvalidOperationException: Instances of abstract classes cannot be created.\" exception.</p>\n\n<p>So the question is: Is there a way for me to use AutoMapper to map EF POCO proxy objects to Dtos.</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","ef-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13155292,"title":"Ignore pending migrations after database recreation","body":"<p>We am using code first EF 4.3.1 with database migrations. Sometimes we drop the database and let EF recreate it, mainly for local development purposes. </p>\n\n<p>There is a procedure which applies pending migrations and when the database is recreated the pending migrations aren't necessary and error is thrown when EF tries to apply them.</p>\n\n<p>I check the migration date from the string and if this is before the database creation date then I manually add it to the __migrationHistory table and don't apply the migration.</p>\n\n<p>This covers most of the scenarios except when someone recreates the database, updates from source control and retrieves oustanding migrations which are before the database creation date.</p>\n\n<p>I have also tried using a try catch around the dbMigrator.Update(migration) method call but if one migrations fails, further ones won't be applied as it remembers the exceptions.</p>\n\n<p>Has anyone found a way to get around this issue?</p>\n\n<p>This is the method I have written:</p>\n\n<pre><code>private static void ApplyMigration&lt;T, TU&gt;()\nwhere T : DbContext, new()\nwhere TU : DbMigrationsConfiguration, new()\n{\n    var migrationsAlreadyApplied = new List&lt;string&gt;();\n    var dbMigrator = new DbMigrator(new TU());\n\n    var creationMigrationId = dbMigrator.GetDatabaseMigrations().Single(m =&gt; m.Contains(\"InitialCreate\"));\n    var dbDateCreated = DateTime.ParseExact(creationMigrationId.Substring(0, 12), Constants.MigrationDateFormat, CultureInfo.InvariantCulture);\n\n    dbMigrator.GetPendingMigrations().ToList()\n                                    .ForEach(migration =&gt;\n                                    {\n                                        var migrationDate = DateTime.ParseExact(migration.Substring(0, 12), Constants.MigrationDateFormat, CultureInfo.InvariantCulture);\n\n                                        if (migrationDate &gt; dbDateCreated)\n                                            dbMigrator.Update(migration);\n                                        else\n                                            migrationsAlreadyApplied.Add(migration);\n                                    });\n\n    using (var dbContext = new T())\n    {\n        foreach(var migration in migrationsAlreadyApplied)\n            dbContext.Database.ExecuteSqlCommand(\"insert into __MigrationHistory \"\n                      + \"select '\" + migration + \"', Model, ProductVersion \"\n                      + \"from __MigrationHistory \"\n                      + \"where MigrationId = '\" + migration + \"'\");\n    }\n}\n</code></pre>\n"},{"tags":[".net","entity-framework","enterprise-library"],"answer_count":4,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":179,"score":2,"question_id":12282427,"title":"Transient Fault Handling with SQL Azure using Entity Framework","body":"<p>I currently use SQL Azure and Entity SQL in my application.</p>\n\n<p>e.g.</p>\n\n<pre><code>Entities model = new Entities();\ndb_Item item = model.db_Item.First();\n</code></pre>\n\n<p>Now I want to use the Transient Fault Handling out of the Enterprise Library but there are no examples or solutions that I can find that would allow me to do something like override the Entities class, so I don't have to update my code in hundreds of places.</p>\n\n<p>Could someone please provide more information on how this could be done?</p>\n"},{"tags":["c#",".net","linq","entity-framework","linq-to-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13248360,"title":"Retrieving Data from database within the last 7 days using linq","body":"<p>I have a <code>view</code> with data and I need to retrieve data only from the last 7 days. I know there is a function for this if I was using sql query. but I'm using Linq. </p>\n\n<p>here is my code:</p>\n\n<pre><code>                try\n                {\n                var query = (from bwl in mg.BarcodeWithLocation\n                             select new\n                             {\n                                 RequestID = bwl.RequestID,\n                                 Barcode = bwl.Barcode,\n                                 adrid = bwl.AdrID,\n                                 name = bwl.Name,\n                                 street = bwl.Street,\n                                 houseno = bwl.HouseNo,\n                                 postal = bwl.Postal,\n                                 city = bwl.City,\n                                 country = bwl.Country,\n                                 latitudetxt = bwl.Latitude == \"\" ? \"Location Unknown\" : \"View Map Location\",\n                                 latitude = bwl.Latitude,\n                                 longitude = bwl.Longitude,\n                                 date = bwl.ReceivedDate\n                             });\n\n                this.Grid.DataSource = query;\n                this.Grid.DataBind();\n                }\n                catch (Exception exception)\n                {\n                      Console.WriteLine(\"ERROR in GetNoLocationScan() method. Error Message : \" + exception.Message);\n                }\n</code></pre>\n\n<p>can anyone tell me how I do this in Linq ?</p>\n"},{"tags":["c#","entity-framework","ef-code-first","msdtc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":12864594,"title":"EntityFramework CodeFirst and EDMX together in TransactionScope","body":"<p>I need to combine in one application </p>\n\n<ol>\n<li>code generated from DB to EDMX file before compilation and</li>\n<li>code generated and compiled during runtime by application itself, where generated code uses CodeFirst to access DB.</li>\n</ol>\n\n<p>Remark: Codes in 1. and 2. have different DbContexts, access same database, but different tables.</p>\n\n<p>It looks, that when I am using instances of type 1. and 2. in different transaction scopes, everything works fine. But when I try to use them together in one transaction scope, I get error (in case when EDMX is called first)</p>\n\n<pre><code>System.Reflection.TargetInvocationException: Exception has been thrown by the ta\nrget of an invocation. ---&gt; System.Data.ProviderIncompatibleException: An error\noccurred while getting provider information from the database. This can be cause\nd by Entity Framework using an incorrect connection string. Check the inner exce\nptions for details and ensure that the connection string is correct. ---&gt; System\n.Data.ProviderIncompatibleException: **The provider did not return a ProviderManif\nestToken string.** ---&gt; System.Transactions.TransactionException: **The operation is\n not valid for the state of the transaction.**\n</code></pre>\n\n<p>and error (in case when CodeFirst is used first)</p>\n\n<pre><code>System.Data.MetadataException: Schema specified is not valid. Errors:\n(0,0) : error 0175: **The specified store provider cannot be found in the configur\nation, or is not valid.**\n   at System.Data.Metadata.Edm.StoreItemCollection.Loader.ThrowOnNonWarningErrors()\n</code></pre>\n\n<p>To complicate my situation even more I have to add this: described behaviour I have only in case when DB is on remote server. If I am working with local DB, everything looks OK. My suspicion is that Distributed Transaction Coordinator can play its role...</p>\n\n<p>Main question: is it possible to combine EDMX and CodeFirst in one TransactionScope. If yes then how?</p>\n\n<p>Any help would be appreciated. Milos</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":198,"score":0,"question_id":11269822,"title":"The type initializer for threw an exception in entity framework model?","body":"<p>I have 2 projects A and B<br>\neach project has its own database and connect to it using entity framework and each project is working well alone<br>\nMy problem is that when I use the project B as a library inside the project A It gives me \"The type initializer for (MYCLASS) threw an exception\"<br>\nyou should know that (MYCLASS): is an Entity inside the project B</p>\n"},{"tags":["visual-studio","entity-framework","visual-studio-2012","edmx"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":154,"score":0,"question_id":12726586,"title":"Edmx designer and item template missing from VS2012","body":"<p>I am nearly sure this was available and working before, but at this site I have a very recent upgrade from VS2010 to VS2012. I find that if I double click an .edmx file, it by default opens in an XML editor. Also, the Enterprise Data Model item template is missing, so I must open the project in VS2010 just to add a new data model. Are there any known issues that could cause this?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13246731,"title":"Entity Framework without csdl and ssdl?","body":"<p>can we use entity framework without specifying csdl and ssdl, by just specifying mapping in the msl?</p>\n\n<p>can anyone suggest on an approach if i want to avoid csdl and ssdl? \nwhat we want is just to have mapping specified in the msl?</p>\n\n<p>I am new to EF so please bear with me if this question sounds absurd!!</p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":2,"up_vote_count":16,"down_vote_count":0,"view_count":6667,"score":16,"question_id":3377821,"title":"Entity Framework: How can I tell what version I am using?","body":"<p>I believe there are two versions 1 and 2? And version 2 is referred to as Entity Framework 4.0?</p>\n\n<p>How can I tell what version is being used in an application? </p>\n\n<p>This is in my web.config does this mean I am using version 2?</p>\n\n<pre><code>&lt;add assembly=\"System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n</code></pre>\n"},{"tags":["entity-framework","entity"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13244263,"title":"Entity Framework, mapping entity","body":"<p>I have Product table that have category1 and category2 field,</p>\n\n<p>and each field contain a number(ID) that indicate Category Table ID (FK).</p>\n\n<p>and I want to add entity for set category name when I retrieve data, but I don't know how to make category1_name and category2_name can have category name. (very hard to explain =3)</p>\n\n<p>EX)</p>\n\n<pre><code>public class Product\n{\n  [Key]\n  public int no {get; set;}\n  public int category1 {get; set;}  // category table ID number\n  public int category2 { get; set;} // category table ID number\n\n  public virtual Category category1_name {get; set;}\n  public virtual Category category2_name {get; set;}\n}\n\n\npublic class Category\n{\n  [Key]\n  public int no {get; set;}\n  public string category {get; set;}\n}\n</code></pre>\n\n<p>But when I try to retrieve data, I got an error,</p>\n\n<p><strong>Unknown column 'Extent1.category1_name_no' in 'on clause'</strong></p>\n\n<p>How can I mapping the category1_name to category table ID?</p>\n"},{"tags":["c#","entity-framework","exception-handling","assembly-references","csharpcodeprovider"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13235583,"title":"CSharpProvider runtime compilation failing to find a DLL","body":"<p>I am compiling a DLL at runtime using CSharpCodeProvider. My code runs fine on some machines but on otherse it fails with the following error:</p>\n\n<blockquote>\n  <p>error CS0006: Metadata file 'EntityFramework.dll' could not be found</p>\n</blockquote>\n\n<p>Here is a code snippet:</p>\n\n<pre><code>var csFile = ... // the file is in C:\\Program Data\\MyFolder\\InnerFolder\nusing (var provider = new CSharpCodeProvider())\n{\n    var parameters = new CompilerParameters\n    {\n        GenerateInMemory = false, // we want the dll saved to disk\n        GenerateExecutable = false,\n        CompilerOptions = \"/target:library\",\n\n        // the assembly is compiled to the same directory as the .cs file\n        OutputAssembly = GetNewCacheAssemblyPath(),\n    };\n\n    parameters.ReferencedAssemblies.AddRange(new[]\n        {\n            \"System.dll\", \n            \"System.Data.dll\", \n            \"System.Data.Entity.dll\", \n            \"EntityFramework.dll\",\n        });\n\n    var compilerResult = provider.CompileAssemblyFromFile(parameters, csFile);\n}\n</code></pre>\n\n<p>Any thoughts as to why this might be happening?</p>\n"},{"tags":["linq","entity-framework","linq-to-entities"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":147,"score":0,"question_id":9234265,"title":"LINQ to compare item in one list to any item in another","body":"<p>i wonder if someone could help me... Is there a LINQ query that will return a bool if any item from one IList&lt;> is contained int another IList&lt;>. These IList&lt;>'s are object and i need to compare one a single property of the object, the \"Name\" property in this case?</p>\n\n<p>Is there a LINQ query that can do this? If so could someone show me the correct implementation?</p>\n\n<p>Thank you</p>\n"},{"tags":["entity-framework","repository-pattern","unit-of-work"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13241682,"title":"Unit of Work, Generic Repository, EF 5.0 large number of records","body":"<p><strong>As per the profiler below, even with lazy loading being disabled, my query is taking a long time to return results:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/oKuIk.jpg\" alt=\"enter image description here\"></p>\n\n<p><strong>Here s my query:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/PurQu.jpg\" alt=\"enter image description here\"></p>\n\n<p><strong>Here is my repository, where I am doing something ridiculous, taking only ONE record:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/6vsJ6.jpg\" alt=\"enter image description here\"></p>\n\n<hr>\n\n<p>Questions:</p>\n\n<hr>\n\n<ol>\n<li><p>Could someone tell me what would be the correct procedure to take say, 100 records and return them as fast as possible so the user will not have to wait long (while using the Unit of Work / Repository pattern)?</p></li>\n<li><p>How would EF know how to paginate this info to a grid so the next batch of 100 records are available to the user, and the next batch, and so on?</p></li>\n</ol>\n\n<p><strong>I do not understand if I have .Take(1) why is the profiler returning 73,722 rows?</strong></p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13236272,"title":"How to access related objects after using statement has finished in Entity Framework?","body":"<p>I use the EF 3.5 in VS 2010. I have a method which returns a struct. In the struct there is an object armatuur. When the struct is returned i want to access the related objects from the armatuur instance.</p>\n\n<p>However</p>\n\n<p>the method returning the struct:</p>\n\n<pre><code>public LampPostDetail getLamppostInfo(int id)\n{\n    LampPostDetail lpd;\n\n    lpd.xPos = 0;\n    lpd.ypos = 0;\n    lpd.armatuur = new Armatuur();\n\n    //get the info from object\n    using (var db = new OvisionDBEntities())\n    {\n        var objects = from o in db.Objects\n                      where o.ObjectId == id\n                      select o;\n\n        foreach (OVSL.Data.Object o in objects)\n        {\n            lpd.xPos = o.XCoordinatie;\n            lpd.ypos = o.YCoordinatie;\n            lpd.armatuur = o.Armatuur; //which is a table in my db\n        }\n\n        return lpd;\n    }\n}\n</code></pre>\n\n<p>struct:</p>\n\n<pre><code>public struct LampPostDetail\n{\n    #region [ Data Members (14)]\n    //lamppost info\n    public double? xPos;\n    public double? ypos;\n\n    //a lamppost can have several armaturen\n    public OVSL.Data.Armatuur armatuur; //is a table in my db\n\n    #endregion [ Data Members ]\n}\n</code></pre>\n\n<p>when doing this in my client:</p>\n\n<pre><code> LampPostDetail lpd = client.getLamppostInfo(id);\n string brand = lpd.armatuur.producer.name; //producer is related object of armatuur\n</code></pre>\n\n<p>I get a ObjectDisposedException. I understand that this happens because the LampPostDetail object is disposed after the using block is finished. But how do i get this to work? Retrieving all information I need (like brand name e.g.) before I return it to the client is not not an option.</p>\n"},{"tags":["entity-framework","nhibernate","repository","repository-pattern","specification-pattern"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13230509,"title":"EF repository implementation to NHib","body":"<p>Below is an implementation for a generic repository desgned for use with Entity Framework. Ignoring its 'goodness' or 'badness' for this exercise...</p>\n\n<p>What would the code look like for this in NHibernate?</p>\n\n<p>Cheers,<br>\nBerryl</p>\n\n<pre><code>public class Repository&lt;T&gt; : IRepository&lt;T&gt; \nwhere T : class\n{\nprotected ObjectContext Context;\nprotected ObjectSet&lt;T&gt; QueryBase;\n\npublic Repository(ObjectContext context)\n{\n    Context = context;\n    QueryBase = context.CreateObjectSet&lt;T&gt;();\n}\n\npublic IEnumerable&lt;T&gt; Matches(ICriteria&lt;T&gt; criteria)\n{\n    var query = criteria.BuildQueryFrom(QueryBase);\n    return query.ToList();\n}\n\npublic void Save(T entity)\n{\n    QueryBase.AddObject(entity);\n}\n</code></pre>\n\n<h1>NOTE</h1>\n\n<p>This is NOT a question about how to design a repository or whether to use one or not. Just a straight forward translation from EF to NHib...</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":31,"score":1,"question_id":13241934,"title":"linq to entities cannot convert type Icollection to type List","body":"<p>I'm using Entity Framework.\nI have the following entities:</p>\n\n<pre><code>public class Articolo\n{\n    ..\n    public virtual ICollection&lt;Fornitore&gt; Fornitori { get; set; }\n}\n\npublic class Fornitore\n{\n  ...\n   public virtual ICollection&lt;Articoli&gt; Articoli { get; set; }    }\n</code></pre>\n\n<p>the following code:</p>\n\n<pre><code>List&lt;Fornitore&gt; result = new List&lt;Fornitore&gt;();\nvar r = zefiroContext.Articoli.Where(p =&gt; p.Id == IdArticolo).Select(p =&gt; p.Fornitori).ToList();\nresult = r;\n</code></pre>\n\n<p>gives a compiler error:</p>\n\n<blockquote>\n  <p>Cannot implicitly convert type 'System.Collections.Generic.List &lt;\n  System.Collections.Generic.ICollection &lt; prova2.Model.Fornitore>>' to\n  'System.Collections.Generic.List &lt; prova2.Model.Fornitore>'</p>\n</blockquote>\n\n<p>how can I get my <code>List &lt; Fornitore &gt;</code> ?</p>\n"},{"tags":["asp.net","json","asp.net-mvc-3","entity-framework","json.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13241404,"title":"Converting Entity Framework object to JSON (without object graph)","body":"<p>Suppose I have a object structure like this </p>\n\n<pre><code>Library 1 ---- 1+ Book 1 ---- 1+ Page\n</code></pre>\n\n<p>I want to serialize a json object of a book with an array of page objects.</p>\n\n<p>Using JSON.net serializer, I can get this to serialize without getting a circular reference, but the JSON still includes all of the properties of the book in each page, which includes data about the library...which can have data on other books which is a ton of noise.</p>\n\n<p>From the answer from this question - <a href=\"http://stackoverflow.com/questions/657939/serialize-entity-framework-objects-into-json\">Serialize Entity Framework objects into JSON</a>, I know that I can do generics, but is this really the only way? This just seems like a ton of extra work. Especially if for a Json result that is Book with and array of page objects in it.</p>\n\n<p>I am using Entity Framework 4.3.1 and Json.net 4.0.30319...</p>\n"},{"tags":[".net","entity-framework","postgresql","ado.net"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":5732,"score":3,"question_id":1576067,"title":"Entity Framework ObjectContext -> raw SQL calls to native DBMS","body":"<p>I have an app using the ADO.NET entity framework (the VS2008 version, not the newer, cooler one) and I need to be able to make a call down to the underlying DBMS (it's postgres) in order to call some SQL that Entity Framework doesn't support. </p>\n\n<p>Is there a way to go from an Entity Framework ObjectContext to something that will let me execute raw SQL? (I need to run a TRUNCATE TABLE before inserting)  I'm OK with a hacky solution (e.g. pull out the DBMS's connection string info from EF, and use that to create a connection using the postgres ADO.NET provider) but don't want to manage two sets of connection strings (one for entity framework, one for ADO.NET).</p>\n\n<p>I'm aware of the limitatons of Entity Framework's first version, but it's not worth the investment required to switch this app to another ORM, and using EF 4.0 isn't an option either.</p>\n\n<p>Any ideas?</p>\n\n<p>BTW, this is the same question as <a href=\"http://stackoverflow.com/questions/915329/is-it-possible-to-run-native-sql-with-entity-framework\">http://stackoverflow.com/questions/915329/is-it-possible-to-run-native-sql-with-entity-framework</a>, but the workaround described in that answer won't work for me since I really do need to execute raw SQL.</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13238758,"title":"Add a where clause specific to an included Entity","body":"<p>My data model has a number of tables with a common parent. I am using Entity Framework and have a navigation property from the child object back to the parent, and not the other way. The reason for this is there will be 100's of children of this common parent. The where criteria for every report will be the same, as an example:</p>\n\n<pre><code> crudEngine.Read&lt;ChildEntity&gt;()\n   .Include(parameters =&gt; parameters.ParentEntity)\n   .Where(parameter =&gt; parameter.ParentEntity.LastUser.Contains(searchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"year\", parameter.ParentEntity.CreationDate) == intSearchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"month\", parameter.ParentEntity.CreationDate) == intSearchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"day\", parameter.ParentEntity.CreationDate) == intSearchText) ||\n         (isDate &amp;&amp; SqlFunctions.DateAdd(\"dy\", SqlFunctions.DateDiff(\"dy\", \"1900-01-01\", parameter.ParentEntity.CreationDate), \"1900-01-01\") == dateSearchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"year\", parameter.ParentEntity.LastModifiedDate) == intSearchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"month\", parameter.ParentEntity.LastModifiedDate) == intSearchText) ||\n         (isInt &amp;&amp; SqlFunctions.DatePart(\"day\", parameter.ParentEntity.LastModifiedDate) == intSearchText) ||\n         (isDate &amp;&amp; SqlFunctions.DateAdd(\"dy\", SqlFunctions.DateDiff(\"dy\", \"1900-01-01\", parameter.ParentEntity.LastModifiedDate), \"1900-01-01\") == dateSearchText) ||\n          parameter.ParentEntity.CreationUser.Contains(searchText) ||\n          parameter.ParentEntity.Description.Contains(searchText)...\n</code></pre>\n\n<p>This same criteria will be used for every child entity that references <code>ParentEntity</code>. If possible, I would like to somehow separate this where section into its own function like this:</p>\n\n<pre><code>private Predicate&lt;ParentEntity&gt; GetParentWhere(string searchText)\n    {\n        int intSearchText;\n        bool isInt = int.TryParse(searchText, out intSearchText);\n\n        DateTime dateSearchText;\n        bool isDate = DateTime.TryParse(searchText, out dateSearchText);\n\n        SubmissionStatus submissionStatus;\n        bool isStatus = Enum.TryParse(searchText, true, out submissionStatus);\n\n        return parent =&gt;                \n               (isInt &amp;&amp; SqlFunctions.DatePart(\"year\", parent.CreationDate) == intSearchText) ||\n               (isInt &amp;&amp; SqlFunctions.DatePart(\"month\", parent.CreationDate) == intSearchText) ||\n               (isInt &amp;&amp; SqlFunctions.DatePart(\"day\", parent.CreationDate) == intSearchText) ||\n               (isDate &amp;&amp; SqlFunctions.DateAdd(\"dy\", SqlFunctions.DateDiff(\"dy\", \"1900-01-01\", parent.CreationDate), \"1900-01-01\") == dateSearchText) ||\n               (isInt &amp;&amp; SqlFunctions.DatePart(\"year\", parent.LastModifiedDate) == intSearchText) ||\n               (isInt &amp;&amp; SqlFunctions.DatePart(\"month\", parent.LastModifiedDate) == intSearchText) ||\n               (isInt &amp;&amp; SqlFunctions.DatePart(\"day\", parent.LastModifiedDate) == intSearchText) ||\n               (isDate &amp;&amp; SqlFunctions.DateAdd(\"dy\", SqlFunctions.DateDiff(\"dy\", \"1900-01-01\", parent.LastModifiedDate), \"1900-01-01\") == dateSearchText) ||\n               parent.CreationUser.Contains(searchText) ||\n               parent.Description.Contains(searchText) ||\n               parent.LastUser.Contains(searchText) ||\n               (isStatus &amp;&amp; parent.Status == (int) submissionStatus);\n\n    }\n</code></pre>\n\n<p>Then call this from my code, something like this:</p>\n\n<pre><code>        return crudEngine.Read&lt;ChildEntity&gt;().Include(parameters =&gt; parameters.ParentEntity)\n                         .Where(GetParentWhere(searchText));\n</code></pre>\n\n<p>This doesn't work however because the Where expression is typed with the child type, not the parent. Any thoughts on how to accomplish this? </p>\n\n<p>Thanks!</p>\n"},{"tags":["linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13230022,"title":"Linq Index in Include","body":"<p>I write program in Linq To EF4\nI have in DataBase  \"Items\" Table that it FK to \"Company\" Table.<br>\nThere are also \"Address\" Table that it FK to \"Company\" Table &amp; to \"City\" Table.<br>\nI want to return Item include the he address &amp; City.<br>\nBut I canot write so:</p>\n\n<pre><code>var items = context.Items.Include(\"Company.Address[0].City\").ToList();\n</code></pre>\n\n<p>because the Include not get \"[ ]\"</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":50,"score":3,"question_id":13236483,"title":"Make EF use local database in App_Data folder","body":"<p>I am using POCO approach on all my projects using Entity Framework. It's all good but I have one problem: It is creating database on my SQL Express, instead I want it to store my database in *.mdf file in App_Data folder.</p>\n"},{"tags":["c#",".net","linq","entity-framework","dynamic"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13233461,"title":"Dynamic conditions in Linq-to-Entities query","body":"<p>I'm trying to convert some old code that directly builds SQL queries to Entity Framework, and came across a problem that many seem to have (judging from the large number of questions surround that topic): how to express dynamic where conditions in linq.</p>\n\n<p>How could I express the following code with a linq query:</p>\n\n<pre><code>    switch (status) {\n        case \"0\":\n            sqlwhere = \" WHERE status &lt; 0 \";\n            break;\n        case \"-1\":\n            sqlwhere = \" WHERE status = -1 \";\n            break;\n        case \"-100\":\n            sqlwhere = \" WHERE status = -100 \";\n            break;\n        case \"1\":\n        default:\n            sqlwhere = \" WHERE status &gt;= 0 \";\n            break;\n    }\n\n    if (strsearch != \"\")\n        sqlwhere += \" AND desc LIKE '%\" + strsearch + \"%' \";\n\n    string sqlc = \"SELECT top 10 * FROM c \" + sqlwhere + \" order by date desc\";\n</code></pre>\n\n<p>I've read about <code>PredicateBuilder</code> and the dynamic Linq extensions in other posts, but I think that a simple case like could be solvable without external libraries.</p>\n\n<p>Using .net 4.5, EF 5.0, C#, can this be done in a \"dynamic\" way without building the complete linq statement for each single case?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":90,"score":-1,"question_id":9119691,"title":"Database joining in Entity Framework","body":"<p>I am new in ASP.NET MVC 3 and am searching on the Internet, but I found nothing on how I can <strong>use joining in ASP.NET MVC 3</strong>. For example, in my social networking project I want to get all the posts with comments. I am using:</p>\n\n<pre><code>var myobj = DB.Comments.Include(\"Post\").ToList();\n</code></pre>\n\n<p>But this shows only those posts which have comments. I want to show all posts and then their respective comments.</p>\n\n<p>I have asked a similar question and people replied that use</p>\n\n<pre><code>var myobj = DB.Post.Include(\"Comments\").ToList();\n</code></pre>\n\n<p>But that is wrong. My knowledge of databases is saying that a post has comments, not that the comments has posts. Simply COMMENT has a foreign key from POST.</p>\n\n<p>How do I resolve this in a simply database query or method?</p>\n\n<pre><code>    var myobj = from u in DB.Posts\n                    join b in DB.Comments\n                    on u.UserID equals b.UserID\n                    into obj\n                    from ua in obj.DefaultIfEmpty()\n                    select new { userComments = (ua == null) ? \"\" : ua.UserComments, UserPosts = u.UserPosts };\n    return view(myobj.ToList());\n</code></pre>\n\n<p>If I use the above then I can't pass it into the view, because it is an SQL query and the <code>and</code> view requires a model whatever the case. What is the complete solution in both cases, that is, from using the SQL query or is there any other method?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13238934,"title":"Is it possible to implement TPH inheritance using [IsNull]/[Is Not Null] condition?","body":"<pre><code>create table Test_Table\n(\n   ID int primary key identity,\n   C1 nvarchar(100) NULL\n)\n</code></pre>\n\n<p><code>Test_Table</code> is mapped to <code>Test_1</code> entity and is a parent of <code>Test_2</code> entity </p>\n\n<p>Is it possible to implement TPH inheritance where depending on whether or not discriminator column <code>C1</code> has a null value, a DB record would be materialized either as an entity of type <code>Test_1</code> or as an entity of type <code>Test_2</code>?  </p>\n\n<p>For this to work <code>Test_1</code>'s discriminatory column should be set to condition <code>[C1] Is Not Null</code> and <code>Test_2</code>'s discriminatory column should be set to condition <code>[C1] is null</code>. But problem is that condition <code>Is Not Null</code> requires us to also map <code>C1</code> column to a property, while <code>Is Null</code> doesn't allow <code>C1</code> to also be mapped to a property. </p>\n\n<p>So is it possible to implement such a condition using only conditional mappings?</p>\n\n<p>Thank you</p>\n"},{"tags":["entity-framework","mvvm","viewmodel","dry"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13238565,"title":"Need the same sort of data fetched from databse in many ViewModels","body":"<p>I'm working on project in <strong>WPF</strong>, using local database (via <em>SQL Express</em>) and <em>Entity Framework</em> as a <em>ORM</em>.</p>\n\n<p>I want to implement as many <strong>ViewModels</strong> as <strong>View</strong> classes. Kind of <strong>1 to 1</strong> relation, I've heard that's a good way to implement <em>MVVM</em> (if you don't agree, please share <em>why</em>). My vision of this is that every <em>ViewModel</em> serve its <em>View</em> (ie. sharing some data from database provided by <em>Model</em> layer). </p>\n\n<p>So every <em>View</em> has its <em>ViewModel</em> which is kind of servant. ;)</p>\n\n<p>During implementing this conception I came across the problem... Let's assume that at least 2 <em>ViewModels</em> want to get recent list of all the customers stored in database. </p>\n\n<p>What would I do in this case? I would have to add this code to all of these <em>ViewModels</em> (against <a href=\"http://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" rel=\"nofollow\">DRY</a>): </p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public ObservableCollection&lt;Customer&gt; Customers;\n\nprivate ObservableCollection&lt;Customer&gt; GetAllCustomers()\n{\n    var oc = new ObservableCollection&lt;Customer&gt;();\n\n    using (var db = new MyDbContext())\n    {\n        var query = from b in db.Customers\n                    orderby b.Surname\n                    select b;\n\n        foreach (var customer in query)\n        {\n            oc.Add(customer);\n        }\n    }\n\n    return oc;\n}\n</code></pre>\n\n<p>or (alternatively) I would make some static <code>FooClass</code> with the same code I wrote above, but singed as <strong>static</strong>. It's not very clever because such a <code>FooClass</code> would be big pile of mess after some time.</p>\n\n<p>I can't find any smarter solution. I'm sure you know how I should code it in clever way. So please help me. How should I provide the same functionality to many <em>ViewModels</em>?</p>\n"},{"tags":["linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13238361,"title":"Linq Cannot implicitity Convert DateTime,Double","body":"<p>I get the following:</p>\n\n<p>Cannot implicitly convert type <code>System.Collections.Generic.Dictionary&lt;System.DateTime?,double?&gt;</code> to <code>System.Collections.Generic.Dictionary&lt;System.DateTime,double&gt;</code> </p>\n\n<p>When I try to use a stored procedure within Entity Framework </p>\n\n<p>Here is the code that I have:</p>\n\n<pre><code>    private Dictionary&lt;DateTime, double&gt; GetData(string columnName)\n    {\n        return db.SysReading(columnName, Convert.ToString(LocId)).\n            ToDictionary( a =&gt; a.DateCollected, a =&gt; a.ElementReading);\n\n    }\n</code></pre>\n\n<p>I am using a call to a Stored Procedure called SysReading. When I convert it to a dictionary, the return type is nullable which I do not want. </p>\n"},{"tags":["c#","sql-server-2008","entity-framework","entity-framework-4.1","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":394,"score":0,"question_id":10153872,"title":"Tables with mapping not being created at the database","body":"<p>I've been trying to implement the Repository pattern using EntityFramework5. I already got the basics to work. My repositories are being loaded only when necessary and the data is being inserted/updated/retrieved in the database as it should.\nThe problem is: I can't get the tables with mapping to be correctly created, or even created at all.\nI've been reading some articles online, even here, talking about ways to work with mapped tables and create them in the database, but I haven't succeed. Hands my question here.</p>\n\n<p>How do I get it to work in my scenario?</p>\n\n<p>I'll explain what I'm doing so far:</p>\n\n<p>This method below is overriden to, supposedly, create the mappings and tables.</p>\n\n<p>PS: <code>Generics.InvokeGenericMethod</code> is a method I created and it's working. It does what it says :)</p>\n\n<pre><code>    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        foreach (Type entityType in Repositories.Keys)\n        {\n            //Invokes the Entity method from DbModelBuilder injecting the class type.\n            Generics.InvokeGenericMethod(modelBuilder, typeof(DbModelBuilder), entityType, \"Entity\", null);\n        }\n\n        foreach (GaiaEntityConfiguration config in EntityConfigurations)\n        {\n            //Defines each mapping existing in the context\n            config.SetConfiguration(modelBuilder);\n        }\n    }\n</code></pre>\n\n<p>The part that is not working is where I use SetConfiguration. SetConfiguration is a method I created for each class added to the context that has mapping, have that mapping mirrored to the database.</p>\n\n<p>Here's one example (in this case a recipient has many messages and messages have many recipients / many-to-many association):</p>\n\n<p>PS: I left the commented code so you can see one other approach I tried.</p>\n\n<pre><code>    public RecipientEntityConfiguration()\n    {\n        this.LeftKey = \"RecipientId\";\n        this.RightKey = \"MessageId\";\n        this.Schema = \"Hermes\";\n        this.TableName = \"RecipientMessage\";\n    }\n\n    public override void SetConfiguration(DbModelBuilder modelBuilder)\n    {\n        //EntityTypeConfiguration&lt;Recipient&gt; entityTypeConfiguration = new EntityTypeConfiguration&lt;Recipient&gt;();\n\n        //entityTypeConfiguration\n        //    .HasMany&lt;Message&gt;(r =&gt; r.Messages)\n        //    .WithMany(m =&gt; m.Recipients)\n        //    .Map(mr =&gt;\n        //    {\n        //        mr.MapLeftKey(this.LeftKey);\n        //        mr.MapRightKey(this.RightKey);\n        //        mr.ToTable(this.TableName, this.Schema);\n        //    });\n        modelBuilder.Entity&lt;Recipient&gt;()\n            .HasMany&lt;Message&gt;(r =&gt; r.Messages)\n            .WithMany(m =&gt; m.Recipients)\n            .Map(mr =&gt;\n            {\n                mr.MapLeftKey(this.LeftKey);\n                mr.MapRightKey(this.RightKey);\n                mr.ToTable(this.TableName, this.Schema);\n            });\n        //modelBuilder.Configurations.Add&lt;Recipient&gt;(entityTypeConfiguration);\n    }\n</code></pre>\n\n<p>When <code>this.Database.Initialize(false);</code> is called I get this error:</p>\n\n<pre><code>Value cannot be null.\nParameter name: key\n</code></pre>\n\n<p>StackTrace:</p>\n\n<pre><code>   at System.Collections.Generic.Dictionary`2.FindEntry(TKey key)\n   at System.Collections.Generic.Dictionary`2.TryGetValue(TKey key, TValue&amp; value)\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.SortedEntityTypeIndex.Add(EdmEntitySet entitySet, EdmEntityType entityType)\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.EntityMappingService.Analyze()\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.EntityMappingService.Configure()\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.ConfigureEntityTypes(DbDatabaseMapping databaseMapping, DbProviderManifest providerManifest)\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.Configure(DbDatabaseMapping databaseMapping, DbProviderManifest providerManifest)\n   at System.Data.Entity.DbModelBuilder.Build(DbProviderManifest providerManifest, DbProviderInfo providerInfo)\n   at System.Data.Entity.DbModelBuilder.Build(DbConnection providerConnection)\n   at System.Data.Entity.Internal.LazyInternalContext.CreateModel(LazyInternalContext internalContext)\n   at System.Data.Entity.Internal.RetryLazy`2.GetValue(TInput input)\n   at System.Data.Entity.Internal.LazyInternalContext.InitializeContext()\n   at System.Data.Entity.Internal.InternalContext.Initialize()\n   at System.Data.Entity.Database.Initialize(Boolean force)\n   at Gaia.Repository.GaiaContext..ctor(GaiaContextConfiguration config) in E:\\Gaia\\Gaia.Repository\\GaiaContext.cs:line 37\n   at Hermes.HMail.SendMessage(Int64 sender, Int64[] toUsers, String subject, String content, FileStream attachment) in G:\\Gaia\\Hermes\\HMail.cs:line 78\n   at Gaia.Controllers.ApplicationController.Test() in G:\\Gaia\\Gaia\\Controllers\\ApplicationController.cs:line 18\n   at lambda_method(Closure , ControllerBase , Object[] )\n   at System.Web.Mvc.ActionMethodDispatcher.&lt;&gt;c__DisplayClass1.&lt;WrapVoidAction&gt;b__0(ControllerBase controller, Object[] parameters)\n   at System.Web.Mvc.ActionMethodDispatcher.Execute(ControllerBase controller, Object[] parameters)\n   at System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters)\n   at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters)\n   at System.Web.Mvc.ControllerActionInvoker.&lt;&gt;c__DisplayClass15.&lt;InvokeActionMethodWithFilters&gt;b__12()\n   at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter(IActionFilter filter, ActionExecutingContext preContext, Func`1 continuation)\n</code></pre>\n\n<p>Any ideas?</p>\n\n<p>Thanks.</p>\n"},{"tags":["wpf","entity-framework","mvvm","command","viewmodel"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13237688,"title":"Create object from View input and pass it to ViewModel (in MVVM)","body":"<p>Recently I'm developing my first project using <strong><a href=\"http://en.wikipedia.org/wiki/Model_View_ViewModel\" rel=\"nofollow\">MVVM</a></strong> concept (I use <strong><a href=\"http://en.wikipedia.org/wiki/Windows_Presentation_Foundation\" rel=\"nofollow\">WPF</a></strong>). I've read many tutorials (ia. famous <a href=\"http://msdn.microsoft.com/en-us/magazine/dd419663.aspx\" rel=\"nofollow\">J.Smith's</a> one) about <strong>MVVM</strong> before I started writing a code. Everything I've read had been clear until I started to code...</p>\n\n<p>The problem is simple: in <em>View</em> layer I have a form with <code>TextBox</code>es. Let's say a few <code>TextBox</code>es, ie.: <strong>Name</strong>, <strong>Surname</strong>, <strong>Phone number</strong>. When user fills all of them and clicks <strong>OK</strong>-button, I want to add new person (with specified personal details) to my local <strong>Database</strong> (I use <em>Entity Framework</em> as a <a href=\"http://en.wikipedia.org/wiki/Object-relational_mapping\" rel=\"nofollow\">ORM</a>). </p>\n\n<p>To do this I need to write something like this: </p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;Button Name=\"MyButton\" Command=\"MyRelayCommandWhichNeedsAllOfTheTextboxes\" Content=\"OK\" /&gt;\n</code></pre>\n\n<p>Using <code>CommandParameter</code> I can pass one object from <em>View</em> to <em>ViewModel</em>. There are many textboxes so it's probably not a good idea. </p>\n\n<p>From <em>XAML</em> I can assign to <code>CommandParameter</code> whole form which needs to be filled by user. But then, inside <em>ViewModel</em>, I need to know all textboxes' names. The main assumption in MVVM is that all the layers (View, ViewModel and Model) have to be independent. </p>\n\n<p>What's the best solution? How can I pass input data from form to <em>ViewModel</em>?</p>\n"},{"tags":["entity-framework","c#-4.0","orm","code-first","lambda-functions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13211859,"title":"Mapping entities with fluent api on entity framework 5","body":"<p>I have a question. </p>\n\n<p>I have these two tables:\n<img src=\"http://i.stack.imgur.com/rfb8g.png\" alt=\"Tables\"></p>\n\n<p>The principal table is User with Customer dependence.</p>\n\n<p>The reverse engineer code first generated classes as follows:</p>\n\n<pre><code>public class User\n{\n    public User()\n    {\n        this.Customers = new List&lt;Customer&gt;();          \n    }\n\n    ...\n\n    public virtual ICollection&lt;Customer&gt; Customers { get; set; }\n\n}\n\npublic class Customer\n{\n    public Customer()\n    {\n    }\n\n    ...\n\n    public int UserID { get; set; }\n    public virtual User User { get; set; }\n\n}\n</code></pre>\n\n<p>I made the following modification in the user class:</p>\n\n<pre><code>public class User\n{\n    public User()\n    {          \n\n    }\n    public int CustomerID { get; set; }\n    public virtual Customer Customer { get; set; }\n\n}\n</code></pre>\n\n<p>Because the relationship is One-toZero-or-One.</p>\n\n<p>The original mapping is this:</p>\n\n<pre><code>// Relationships\n        this.HasRequired(t =&gt; t.User)\n            .WithMany(t =&gt; t.Customers)\n            .HasForeignKey(d =&gt; d.UserID);\n</code></pre>\n\n<p>And the modified mapping is  this :</p>\n\n<pre><code>this.HasRequired(t =&gt; t.User)\n            .WithOptional(t =&gt; t.Customer)\n            .Map(m =&gt; m.MapKey(\"UserID\"));\n</code></pre>\n\n<p>Is That correct?\nIf not, how would this mapping?</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13016674,"title":"Validations not show up using EF Code First with complex types","body":"<p>This is a continuation of this question <a href=\"http://stackoverflow.com/questions/13000887/model-class-and-mapping\">Model class and Mapping</a></p>\n\n<p>I had my Client class now working fine and it's defined as </p>\n\n<pre><code>using System;\n\nusing System.ComponentModel.DataAnnotations;\nusing System.ComponentModel;\n\nusing DataAnnotationsExtensions;\nusing System.ComponentModel.DataAnnotations.Schema;\nusing System.Collections.Generic;\n\nnamespace CardNumbers.Objects\n{\n    [ComplexType]\n    public class PhoneInfo\n    {\n        [DataType(DataType.PhoneNumber)]\n        [StringLength(10)]\n        [DisplayName(\"Phone\")]\n        public virtual string Phone { get; set; }\n\n        [StringLength(5)]\n        [DisplayName(\"Ext\")]\n        public virtual string Ext { get; set; }\n\n        public bool HasValue\n        {\n            get\n            {\n                return (Phone != null || Ext != null);\n            }\n        }\n\n    }\n\n      [ComplexType]\n      public class ContactDetail\n      {\n          //Constructor\n          public ContactDetail()\n          {\n              phoneInfo = new PhoneInfo();\n          }\n\n          [StringLength(100)]\n          [DisplayName(\"Contact Name\")]\n          [DisplayFormat(NullDisplayText = \"\")]\n          public virtual string Contact { get; set; }\n\n          [Email]\n          [StringLength(100)]\n          [DisplayName(\"Email\")]\n          public virtual string Email { get; set; }\n\n          public virtual PhoneInfo phoneInfo { get; set; }\n          public bool HasValue\n          {\n              get\n              {\n                  return (Contact != null || Email != null || phoneInfo.HasValue);\n              }\n          }\n      }\n\n/// &lt;summary&gt;\n/// Client class (Client No, Client Name, Address, Contact1, Contact2 info, Created By, Modified By (operator and date)\n/// &lt;/summary&gt;\n    public class Client\n    {\n        public Client()\n        {\n            Contact1 = new ContactDetail();\n            Contact2 = new ContactDetail();\n     }\n\n        [Key]\n        [Column(\"ClientId\",TypeName = \"int\")]\n        public virtual int Id { get; set; }\n        [Required]\n        [DisplayName(\"Client No\")]\n        [Column(\"client_no\", TypeName = \"smallint\")]\n        public virtual Int16 Number { get; set; }\n\n        [Required]\n        [Column(\"client_name\", TypeName = \"varchar\")]\n        [DisplayName(\"Client Name\")]\n        [MaxLength(30, ErrorMessage = \"Client Name should not be longer than 30 characters\" )]\n        [MinLength(3, ErrorMessage = \"Client Name is too short\")]\n        public virtual string Name { get; set; }\n\n        [DataType(DataType.MultilineText)]\n        public virtual string Address { get; set; }\n\n        public virtual ContactDetail Contact1 {get; set;}\n        public virtual ContactDetail Contact2 {get; set;}\n\n        [ForeignKey(\"EnteredByOperator\")]\n        public string EnteredBy { get; set; }\n\n        [InverseProperty(\"ClientsEnteredBy\")]\n        public virtual Operator EnteredByOperator { get; set; }\n\n        [ForeignKey(\"ModifiedByOperator\")]\n        public string ModifiedBy { get; set; }\n\n        [InverseProperty(\"ClientsUpdatedBy\")]\n        public virtual Operator ModifiedByOperator { get; set; }\n\n        [DataType(DataType.DateTime)]\n        [DisplayName(\"Created on\")]\n        public DateTime EnteredOn { get; set; }\n\n        [DataType(DataType.DateTime)]\n        [DisplayName(\"Modified on\")]\n        public DateTime? ModifiedOn { get; set; }\n\n        public virtual ICollection&lt;ClientOrder&gt; ClientOrders { get; set; }\n\n        public virtual ICollection&lt;Reorder&gt; Reorders { get; set; }\n    }\n}\n</code></pre>\n\n<p>I mapped column names using Fluent API and I also re-defined my original \"repository\" classes to be very similar to defined in this tutorial <a href=\"http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8\" rel=\"nofollow\">http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8</a></p>\n\n<p>This is my current partial view for the client form called _ClientForm:</p>\n\n<pre><code>@using WebDemo.Helper\n@model CardNumbers.Objects.Client\n&lt;fieldset&gt;\n    &lt;legend&gt;Client Info&lt;/legend&gt;\n\n    @Html.ValidationSummary(true)\n\n    &lt;input type=\"hidden\" id=\"fntype\" name=\"fntype\"&gt;\n    @Html.HiddenFor(model =&gt; model.Id)\n    @Html.EditorFor(model =&gt; model.Number, EditorTemplate.TextBox)\n\n    @Html.EditorFor(model =&gt; model.Name, EditorTemplate.TextBox)\n\n    @Html.EditorFor(model =&gt; model.Address, EditorTemplate.EditBox)\n\n    &lt;div id=\"ContactsInfo\"&gt;\n        @*Contact 1*@\n\n        &lt;div id=\"Contact1\"&gt;\n\n         @*@Html.EditorFor(model=&gt;model.Contact1)*@\n            @Html.EditorFor(model=&gt;model.Contact1.Contact, EditorTemplate.TextBox)\n            @Html.EditorFor(model=&gt;model.Contact1.Email, EditorTemplate.TextBox)\n        &lt;/div&gt;\n\n        @*Contact2*@\n        &lt;div id=\"Contact2\"&gt;\n\n        @*   @Html.EditorFor(model =&gt; model.Contact2)*@\n        &lt;/div&gt;\n    &lt;/div&gt;\n    @*&lt;div class=\"clear\"&gt;&lt;/div&gt;*@\n    &lt;div id=\"SaveCancel\" class=\"float-right\"&gt;\n        &lt;button type=\"Submit\" id=\"btnSave\"&gt;Save&lt;/button&gt;\n        &lt;button type=\"reset\" id=\"btnCancel\"&gt;Cancel&lt;/button&gt;\n    &lt;/div&gt;\n&lt;/fieldset&gt;\n</code></pre>\n\n<p>I already tried to revert to original way of only one level and I also commented the second Contact2 info but still the e-mail validation doesn't work and all other validations also don't seem to work.</p>\n\n<p>The EditorFor textboxes are defined based on this blog post <a href=\"http://fusionovation.com/post/2010/02/15/adding-a-rich-text-editor-to-asp-net-mvc-using-strongly-typed-helpers-dataannotations-amp-jquery.aspx\" rel=\"nofollow\">http://fusionovation.com/post/2010/02/15/adding-a-rich-text-editor-to-asp-net-mvc-using-strongly-typed-helpers-dataannotations-amp-jquery.aspx</a></p>\n\n<p>And these are two of the new EditorFor I added:\nPhoneInfo.cshtml</p>\n\n<pre><code>@using WebDemo.Helper\n@model CardNumbers.Objects.PhoneInfo\n\n&lt;div id=\"PhoneInfo\"&gt;\n    &lt;div class=\"float-left\"&gt;\n        @Html.EditorFor(model =&gt; model.Phone, EditorTemplate.TextBox)\n    &lt;/div&gt;\n    &lt;div class=\"float-right\"&gt;\n        @Html.EditorFor(model =&gt; model.Ext, EditorTemplate.TextBox)\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>And ContactDetail.cshtml</p>\n\n<pre><code>@using WebDemo.Helper\n@model CardNumbers.Objects.ContactDetail\n\n@Html.EditorFor(model =&gt; model.Contact, EditorTemplate.TextBox)\n@Html.EditorFor(model =&gt; model.Email, EditorTemplate.TextBox)\n@Html.EditorFor(model=&gt;model.phoneInfo)\n</code></pre>\n\n<p>So, as you can see, the code of the views is now very compact.</p>\n\n<p>However, with all of these in place the validations don't see to fire anymore. I used to test validation on EMail by typing some garbage. It used to provide a validation message near the textbox. Now I observe that the email textbox takes the red border, but there is no message.</p>\n\n<p>Do you see what I am missing now and if it's possible to use complex type and validations?</p>\n\n<p>To clarify, the _ClientForm is called from this Client view:</p>\n\n<pre><code>@model CardNumbers.Objects.Client\n\n@{\n    ViewBag.Title = \"Client\";\n}\n\n@section scripts {\n    &lt;script src=\"@Url.Content(\"~/Scripts/Clients.js\")\" type=\"text/javascript\" &gt;&lt;/script&gt;\n}\n\n &lt;form id=\"frmClientsSearch\"&gt;\n        &lt;label for=\"clientNo\"&gt;Client No: &lt;/label&gt;\n        &lt;input type=\"number\" name=\"searchClientNo\" class=\"numericOnly\" /&gt;&lt;br /&gt;\n        &lt;label for=\"clientName\"&gt;Client Name: &lt;/label&gt;\n        &lt;input type =  \"text\" size =25 value =\"Please enter the search value\" class=\"SelectOnEntry\"\n            name =\"searchClientName\" /&gt;\n\n       &lt;input type=\"button\" id=\"btnClientsSearch\" value =\"Find / Refresh\" /&gt;      \n&lt;/form&gt;\n&lt;div style=\"padding-left: 150px; padding-top: 50px; padding-bottom: 50px;\" id=\"ClientsResults\"&gt;\n    &lt;table id=\"flexClients\" style=\"display: none\"&gt;\n    &lt;/table&gt;\n&lt;/div&gt;\n&lt;div style=\"display: none\"&gt;\n   &lt;form id=\"sform\" title=\"Client Info\"&gt;\n\n\n        @{Html.RenderPartial(\"_ClientForm\", Model)   ;}\n\n    &lt;/form&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["c#","entity-framework","dbcontext"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13180262,"title":"Async notification when another application changes the database with entity framework 4.1 and DBContext","body":"<p>I have a REST web service that is used for comunication with multiple clients, some sort of chat, but I have to make all the changes into the database as soon as the clients comunicate something and then inform all the others clients when a change is made. </p>\n\n<p>I basically get a POST request and I have to reply as soon as an entry is mofified.  </p>\n\n<p>Now I make my thread sleep 1 second and then keep recreating the context every second for each request and if there are changes to the database I send the response. \nThis looks ugly to me and I wonder if there is some event or async method to be notified when a specific entry in the database is modified? </p>\n\n<p>Thank you Advance.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","ninject","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13212817,"title":"using ninject to inject dependency to The Model classes or non-controller classes","body":"<p>I using Ninject 3 in Repository pattern in mvc 3 (steven sanderson Scaffolder).<br>\nand in ninject i have the class \"NinjectWebCommon\" which in the \"RegisterServices\" method i resolved the dependencies and i think im ready to go.  </p>\n\n<pre><code>  private static void RegisterServices(IKernel kernel)\n  {\n     kernel.Bind&lt;ICityRepository&gt;().To&lt;CityRepository&gt;();\n     kernel.Bind&lt;IVillageRepository &gt;().To&lt;VillageRepository&gt;();\n  }\n</code></pre>\n\n<p>i using my repositories in controllers using constructor injection and everything is fine.  </p>\n\n<pre><code>public class CityController : Controller\n{\n   private readonly ICityRepository cityRepository;\n\n   // If you are using Dependency Injection, you can delete the following constructor\n   //public CityController() : this(new CityRepository())\n   //{\n   //}\n\n   public CityController(ICityRepository cityRepository)\n   {\n      this.cityRepository = cityRepository;\n   }\n\n  // .........\n}\n</code></pre>\n\n<p>but when i use this repositories in other classes like Model(Entity) classes using property injection or field injection the dependency doesn't resolved and i get null reference exception on my Property or field.  </p>\n\n<pre><code>[MetadataType(typeof(CityMetadata))]\npublic partial class City : IValidatableObject\n{\n   [Inject]\n   public IVillageRepository VillageRepo { get; set; }\n\n   public IEnumerable&lt;ValidationResult&gt; Validate(ValidationContext validationContext)\n   {\n      var village = VillageRepo.Find(5); // will throw null reference exception on \"VillageRepo\"\n   }\n}\n\npublic partial class CityMetadata\n{\n   [ScaffoldColumn(false)]\n   public int ID { get; set; }\n\n   [Required(ErrorMessage = MetadataErrorMessages.Required)]\n   [StringLength(50, ErrorMessage = MetadataErrorMessages.ExceedMaxLength)]\n   public string Name { get; set; }\n}\n</code></pre>\n\n<p>i don't know why this happening. so whats the problem and how can i use the repositories in non-controller classes?<br>\nthanks in advance.  </p>\n"},{"tags":["c#","sql-server","entity-framework","database-connection"],"answer_count":9,"favorite_count":14,"up_vote_count":41,"down_vote_count":0,"view_count":47443,"score":41,"question_id":2475008,"title":"The underlying provider failed on Open","body":"<p>I was using .mdf for connect to DB and entityClient. Now I want to change the connection string so that there will be no .mdf</p>\n\n<p>Is this <code>connectionString</code> correct</p>\n\n<pre><code>&lt;connectionStrings&gt;\n&lt;!--&lt;add name=\"conString\" connectionString=\"metadata=res://*/conString.csdl|res://*/conString.ssdl|res://*/conString.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQL2008;AttachDbFilename=|DataDirectory|\\NData.mdf;Integrated Security=True;Connect Timeout=30;User Instance=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;--&gt;\n&lt;add name=\"conString\" connectionString=\"metadata=res://*/conString.csdl|res://*/conString.ssdl|res://*/conString.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQL2008;Initial Catalog=NData;Integrated Security=True;Connect Timeout=30;User Instance=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p></p>\n\n<p>because I always get error <code>The underlying provider failed on Open</code>?</p>\n"},{"tags":["c#","linq","entity-framework","lambda"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":189,"score":4,"question_id":1975556,"title":"Linq - OrderBy the minimum value of two columns using lambda expressions?","body":"<p>I have an entity set that contains two DateTime properties. I want to order the set by the minimum value of the two properties. How can I do this with a lambda expression.</p>\n"},{"tags":["c#","wpf","entity-framework"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13235190,"title":"Entity Framework Pre Generated View on custom queries","body":"<p>I have a following Data Structure EntityObject (Unit, Product, ...) 1 : 1 Translation 1:n Translation Items.</p>\n\n<p>To fill ComboBoxes and listViews i only need to query the Translations this way:</p>\n\n<pre><code>    public CollectionViewSource GetShowColumns()\n    {\n        CollectionViewSource result = new CollectionViewSource();\n        List&lt;UnitDTO&gt; units = new List&lt;UnitDTO&gt;();\n        var qry = from x in _context.Units\n                  select new\n                  {\n                      x.Name,\n                      x.Name.Translations,\n                      x.Id\n                  };\n\n        foreach (var temp in qry)\n        {\n            units.Add(new UnitDTO() { Id = temp.Id, Name = temp.Name });\n        }\n        result.Source = units;\n        return result;\n    }\n</code></pre>\n\n<p>My DTO Object contains an Id and Translation Property.</p>\n\n<p>I already used <a href=\"http://visualstudiogallery.msdn.microsoft.com/72a60b14-1581-4b9b-89f2-846072eff19d\" rel=\"nofollow\">EF Power Tools</a> To Prgenerate views. But i still experience a huge differnece between warm and cold queries.</p>\n\n<p>What shall i do ? </p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":51,"score":3,"question_id":13232256,"title":"Linq GroupBy and Lookup<TKey, TElement>.Item","body":"<p>I'm using LINQ in C@ </p>\n\n<p>This code result in <code>dates</code> of type <code>Lookup&lt;TKey, TElement&gt;</code></p>\n\n<pre><code>   var dates = timetableEvents.GroupBy(x =&gt; x.DateTimeStart);\n</code></pre>\n\n<p>I need instead just a list of DateTimeStart (of type DateTime).</p>\n\n<p>How should I change my LINQ expressions? I do not know where to start!</p>\n"},{"tags":["entity-framework","ef-code-first","poco",".net-4.5"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13205349,"title":"EF table splitting: InvalidOperationException - sequence contains more than one matching element","body":"<p>I have a repro for what I think might be an EF bug.  I would like to split one table across two entities.  Each of those entites contains a reference to a third entity.  The two references <strong>must</strong> be exposed with identical foreign key property names.  Since they map to columns in the same table, configuration (or, in this example, an attribute) is used to make the column names unique.</p>\n\n<p>When I try to load the model, I get the above exception from EF.  If I modify the name of one of the FK properties then the error goes away.</p>\n\n<p>Here is my model.  The code as-is works.  To reproduce the problem, rename <code>Foo2.Foo3Id1</code> to <code>Foo3Id</code>, which is the value that I need it to have.</p>\n\n<h1>Why Would You Want to Do That?</h1>\n\n<p>If you're wondering why I need the two properties to have the same name, here's the explanation.</p>\n\n<p>I have a table that contains several addresses (e.g. a postal address and a billing address).  This is an existing database, so I can't change the table structure.  Each address is represented by a series of standard columns.  The name of each column has a prefix identifying the kind of address and a suffix identifying the part of the address, e.g. <code>BillingAddressLine1</code>, <code>BillingAddressZipCode</code> and <code>PostalAddressLine1</code>.</p>\n\n<p>It would <em>seem</em> that using a complex type would handle this.  However, there is an added complication: each address contains a <code>CityId</code> that references a <code>Cities</code> table.  Complex types <a href=\"http://stackoverflow.com/a/7603303/439024\">don't support relationships and navigation properties</a>.  So my intended solution is to use table splitting instead, and to split each set of address properties into its own entity.  Each entity that represents an address either derives from a base type, say, <code>Address</code> or implements an interface, <code>IAddress</code>.</p>\n\n<p>With table splitting I'm careful to observe the restriction that where several types are mapped to the same table, <a href=\"http://stackoverflow.com/a/11884110/439024\">they must all have navigation properties to each other</a>.</p>\n\n<p>In the code below, <code>Foo1</code> and <code>Foo2</code> are both address types (and would implement some common interface).  <code>Foo3</code> is <code>City</code>.  This is the simplest repro of the problem that I could come up with.</p>\n\n<h1>Code Sample</h1>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        // Use NuGet to import EF 5 into the project.\n        // This code is just enough to cause the metadata to be loaded and therefore demo the error.\n        using (Context cx = new Context())\n        {\n            var qq = from f in cx.Foo3s\n                     where f.Foo1s.Any()\n                     select f;\n        }\n    }\n}\n\n[Table(\"Foo\")]\npublic class Foo1\n{\n    [Key]\n    public virtual int Id { get; set; }\n\n    [Required]\n    public virtual Foo2 Foo2 { get; set; }\n\n    [ForeignKey(\"Foo3\")]\n    [Column(\"Foo1_Foo3Id\")]\n    public virtual int? Foo3Id { get; set; }\n\n    public virtual Foo3 Foo3 { get; set; }\n}\n\n[Table(\"Foo\")]\npublic class Foo2\n{\n    [Key]\n    public virtual int Id { get; set; }\n\n    [Required]\n    public virtual Foo1 Foo1 { get; set; }\n\n    // Re-name the following property to Foo3Id (rather than Foo3Id1) and the model won't load.\n    // You get \"InvalidOperationException: Sequence contains more than one matching element.\"\n    [ForeignKey(\"Foo3\")]\n    [Column(\"Foo2_Foo3Id\")]\n    public virtual int? Foo3Id1 { get; set; }\n\n    public virtual Foo3 Foo3 { get; set; }\n}\n\n[Table(\"Foo3\")]\npublic class Foo3\n{\n    [Key]\n    public virtual int Id { get; set; }\n\n    [InverseProperty(\"Foo3\")]\n    public virtual ICollection&lt;Foo1&gt; Foo1s { get; set; }\n\n    [InverseProperty(\"Foo3\")]\n    public virtual ICollection&lt;Foo2&gt; Foo2s { get; set; }\n}\n\npublic class Context : DbContext\n{\n    public DbSet&lt;Foo3&gt; Foo3s { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        base.OnModelCreating(modelBuilder);\n\n        // Don't think we can configure 1:1 relationship using just attributes.\n        var foo2 = modelBuilder.Entity&lt;Foo2&gt;();\n        foo2.HasRequired(q =&gt; q.Foo1)\n            .WithRequiredPrincipal(q =&gt; q.Foo2);\n    }\n}\n</code></pre>\n\n<p>Is this a bug?  Am I doing something wrong?  Is it a known EF limitation?</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","edmx"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13233805,"title":"How To Handle Multiple Object Insertion In Entity Framework?","body":"<p>I Have List To Save In My Database \"Challan\" Table.\nCurrently I Use The <strong>ForEach Loop To Insert Objects In Database,With Each Iteration I use\nContext.SaveChanges() Method.</strong>\nIn Loop i also Call <strong>ManageStock() Function</strong> For Update Stock Of Product,Which is Reside in Other Class File.</p>\n\n<p>I Want To Save All List with Stock Management at a time,means if power failure or other Errors Occurred between insertion then saved record will be roll back And If Full Transaction Have No Error Then Only It Will Save With All Entries.</p>\n\n<p>How Can I Achieve This In Entity Framework?</p>\n"},{"tags":["c#","sql-server","asp.net-mvc","entity-framework","complex-data-types"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":71,"score":4,"question_id":13212338,"title":"Calling stored procedure in EF with Complex Data Type","body":"<p>I am new to working with <code>Entity Framework</code> in a sample <code>ASP.NET/MVC 3.0 VS2010</code> project. I have imported two stored procedures as Function Imports and, in doing so, created a complex data type for each.</p>\n\n<p>I am trying to run the following c# code:</p>\n\n<pre><code>public ComplexDataType RunStoredProc()\n{\n    var context = new DbEntities();\n    int param1 = 370;\n    int param2 = -1;\n    string param3 = \"Current\";\n\n    ComplexDataType result = new ComplexDataType;\n    result = context.StoredProc(param1, param2, param3);\n    return result;\n}\n</code></pre>\n\n<p>And I'm getting the error:</p>\n\n<pre><code>Cannot implicitly convert data type \n    System.Data.Objects.ObjectResult(ComplexDataType) to 'ComplexDataType'\n</code></pre>\n\n<p>What am I doing wrong? How do I properly store the results of the stored proc in a complex data type?</p>\n"},{"tags":["entity-framework","repository-pattern"],"answer_count":2,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":931,"score":5,"question_id":1641658,"title":"Repository Pattern and Entity Framework","body":"<p>Hi\nI looked at lot of examples online using Repository Pattern with EF. But none of them really talked about working with Related Entities. </p>\n\n<p>Like say User can have multiple addresses.</p>\n\n<pre><code>IUserRepository\nUser CreateUser();\nvoid UpdateUser();\n</code></pre>\n\n<p>Now if I were to add a Address to the User should, should it be on the Repository? OR \non the User instance</p>\n\n<p>I feel repository pattern shud be used for CRUD and Get Operations on the entity. But when it comes to working with related entities, they should really be defined on the entity[for the most part]</p>\n\n<p>Like in this scenario, address is useless without a user, shouldnt it be on the entity?</p>\n\n<p>any thoughts?</p>\n"},{"tags":["entity-framework","entity"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13232777,"title":"check constraint entity framework","body":"<p>IN EF can I add a check constraint so if my CustomerNotes entity has a boolean \"FollowUpRequired\" property I force user to enter a valid future date in the \"FollowUpDate\" property?</p>\n"},{"tags":["entity-framework","exception","oracle11g","insert-update"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13232188,"title":"Entity Framework - can't update record (so Identity or not?)","body":"<p>I try to update a record in Oracle DB using standard method:</p>\n\n<pre><code>- LINQ to get an entity (OK);\n- set new value to some of fields (just one for now) (OK, as well);\n- call SaveChanges() to submit (Exception!).\n</code></pre>\n\n<p>And it does not work!</p>\n\n<p>At first, I've got the next error message:</p>\n\n<p>\"Operation is not valid due to the current state of the object\"</p>\n\n<p>I've found some recommendation how to solve it - just change StoreGeneratedPattern to 'Identity' in my edmx file (both models). And yes, the error has disappeared.</p>\n\n<p>But I've got another error message instead:</p>\n\n<p>\"Modifying a column with the 'identity' pattern is not supported\"</p>\n\n<p>So, how can I update a record correctly?</p>\n"},{"tags":["c#","asp.net","entity-framework","ado.net","unit-of-work"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13232084,"title":"Is Unit of Work pattern about sharing the same DataContext?","body":"<p>I am using Entity Framework and I am trying to learn Unit of Work pattern in combination with Repository pattern.</p>\n\n<p>From what i understood until now, Unit of Work is responsible with keeping track of the changes made to the entity objects. However, isn't the DataContext doing the same thing?</p>\n\n<p>So, implementing unit of work pattern isn't like \"forcing\" you to use the same context across all methods?</p>\n\n<pre><code>public class EFUnitOfWork : IUnitOfWork\n{\n    EFContext context = new EFContext();\n    public void Commit()\n    {\n        context.SaveChanges();\n    }\n}\n\npublic class ProductsRepository(IUnitOfWork unitOfWork)\n{\n    /* CRUD methods here */\n}\n\npublic void InsertProducts()\n{\n    var unitOfWork = new EFUnitOfWork(); // &lt;-- this will normally be injected via constructor\n    var productsRepository = new ProductsRepository(unitOfWork);\n\n    productsRepository.Insert(new Product { Name = \"Product 1\", Description = \"Description\" });\n    productsRepository.Insert(new Product { Name = \"Product 2\", Description = \"Description\" });\n    productsRepository.Insert(new Product { Name = \"Product 3\", Description = \"Description\" });\n\n    unitOfWork.Commit();\n}\n</code></pre>\n\n<p>Is this the right way of using Unit of Work with Entity Framework?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13231032,"title":"Delete multiple rows with Entity Framework 5","body":"<p>I tried this piece of code :</p>\n\n<pre><code>context.Database.ExecuteSqlCommand\n(\"DELETE [MYSCHEMA].TABLE1 Where TABLE2.Id = 5\");\n</code></pre>\n\n<p>But I get this exception : <em>Cannot call methods on nvarchar.</em></p>\n\n<p>Currently I use a loop but I'd like avoid this.</p>\n\n<p>Thanks,</p>\n"},{"tags":[".net","entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":88,"score":6,"question_id":13223353,"title":"Regarding the new EF5 auto-compiled queries feature","body":"<p>I've made few tests regarding the new EF5 auto-compiled queries feature. The problem is that I don't see any difference in the performance. </p>\n\n<p>I've made one project with .NET 4.0 and EF4.0 without using compiled queries. \nI've made another project with .NET 4.0 and EF4.0 with compiled queries - there was 50% improvement in performance. </p>\n\n<p>And then I tried to create a project with EF 5.0, in which there was basically no difference in performance. </p>\n\n<p>All the projects were asp.net mvc (first two were version 3, the last one - version 4). </p>\n\n<p>Am I missing something here ? Is there something special I need to do to enable the auto-compile feature ? I just created MVC 4 project with pre-build EF5 inside. </p>\n\n<p>The query I am testing with is rather verbose, three joins and multiple filters inside. </p>\n\n<p>Thank you</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":18,"score":2,"question_id":13219819,"title":"How to create new base line / reset in EF code first?","body":"<p>So when prototyping an application using Entity Framework code first, I ended up with a lot of migrations. </p>\n\n<p>I'm not interested in keeping all the classes that were generated, I want to say: ok, this is my base line for v1.</p>\n\n<p>How can I reset EF Code first?</p>\n"},{"tags":["sql","json","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13226760,"title":"Execute SQL script in Entity Framework & convert the result to JSON","body":"<p>Hey Guys I want to execute this SQL script in Entity Framework &amp; return the result in <code>JSONResult</code> format to access in jQuery.. Please help!!!</p>\n\n<p>My Entity Framework model contains the tables &amp; databases mentioned in SQL script </p>\n\n<p>THANKS :-)</p>\n\n<pre><code>DECLARE @listCol VARCHAR(2000)\nDECLARE @query VARCHAR(4000)\nSELECT  @listCol = STUFF(( SELECT distinct  '], [' + [PSize]\n                           FROM     Pattern\n                         FOR\n                           XML PATH('')\n                         ), 1, 2, '') + ']'\nSET @query = 'SELECT * FROM\n      (SELECT PColour as Colour_Size_Matrix, PSize, PCode\n            FROM Pattern\n            ) src\nPIVOT (Count(PCode) FOR PSize\nIN (' + @listCol + ')) AS pvt'\nEXECUTE ( @query )\n</code></pre>\n"},{"tags":["c#","entity-framework",".net-4.0","ef-code-first","entity-framework-4.3"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13174247,"title":"EF Code First IDbSet<TEntity>.Attach() Conflicting changes to the role _ of the relationship _ have been detected","body":"<p>I have the following code:</p>\n\n<pre><code>using (var db = new SourceLogContext())\n{\n    db.LogEntries.Attach(this);\n    db.Entry(this).Collection(c =&gt; c.ChangedFiles).Load();\n}\n</code></pre>\n\n<p>And I'm getting the following exception:</p>\n\n<pre><code>System.InvalidOperationException occurred\n  Message=Conflicting changes to the role 'LogEntry_LogSubscription_Target' of the relationship 'SourceLog.Model.LogEntry_LogSubscription' have been detected.\n  Source=System.Data.Entity\n  StackTrace:\n       at System.Data.Objects.DataClasses.RelatedEnd.IncludeEntity(IEntityWrapper wrappedEntity, Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.EntityCollection`1.Include(Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.RelatedEnd.WalkObjectGraphToIncludeAllRelatedEntities(IEntityWrapper wrappedEntity, Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.RelatedEnd.AddGraphToObjectStateManager(IEntityWrapper wrappedEntity, Boolean relationshipAlreadyExists, Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.RelatedEnd.IncludeEntity(IEntityWrapper wrappedEntity, Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.EntityReference`1.Include(Boolean addRelationshipAsUnchanged, Boolean doAttach)\n       at System.Data.Objects.DataClasses.RelationshipManager.AddRelatedEntitiesToObjectStateManager(Boolean doAttach)\n       at System.Data.Objects.ObjectContext.AttachTo(String entitySetName, Object entity)\n       at System.Data.Entity.Internal.Linq.InternalSet`1.&lt;&gt;c__DisplayClass2.&lt;Attach&gt;b__1()\n       at System.Data.Entity.Internal.Linq.InternalSet`1.ActOnSet(Action action, EntityState newState, Object entity, String methodName)\n       at System.Data.Entity.Internal.Linq.InternalSet`1.Attach(Object entity)\n       at System.Data.Entity.DbSet`1.Attach(TEntity entity)\n       at SourceLog.Model.LogEntry.LoadChangedFiles() in C:\\github.com\\tomhunter-gh\\SourceLog\\SourceLog.Model\\LogEntry.cs:line 62\n  InnerException: (empty)\n</code></pre>\n\n<p>The offending line is here: <a href=\"https://github.com/tomhunter-gh/SourceLog/blob/443fb74a37db89522f85b4dfc941c52922785e7a/SourceLog.Model/LogEntry.cs#L62\" rel=\"nofollow\">https://github.com/tomhunter-gh/SourceLog/blob/443fb74a37db89522f85b4dfc941c52922785e7a/SourceLog.Model/LogEntry.cs#L62</a></p>\n\n<p>The LogEntry has it's LogSubscription assigned here: <a href=\"https://github.com/tomhunter-gh/SourceLog/blob/443fb74a37db89522f85b4dfc941c52922785e7a/SourceLog.Model/LogSubscription.cs#L88\" rel=\"nofollow\">https://github.com/tomhunter-gh/SourceLog/blob/443fb74a37db89522f85b4dfc941c52922785e7a/SourceLog.Model/LogSubscription.cs#L88</a></p>\n\n<p>It looks like the assignment creates a new LogSubscription instance and assigns it, and then the Attach references a different instance (but with the same Id).  Why does this cause the error and how would I avoid it?</p>\n\n<p>In LogSubscription L88 I'm basically trying to add the LogEntry to the collection property of the LogSubscription but without loading the entire LogEntry collection.  Is this the correct way to do that?</p>\n"},{"tags":["sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13193770,"title":"EF generated SQL Query returns wrong result","body":"<p>I want to filter on a specific date. Because of the control I use I can also filter on a range of dates, but when I filter on a single date it should also work so I have total flexibility.</p>\n\n<p>When I filter on 2004-11-24 my code generates the following query with Entity Framework. However somehow the query returns me the results of 2004-11-25 instead of 2004-11-24.</p>\n\n<p>What is wrong with this query? </p>\n\n<pre><code>SELECT TOP (26) \n[Filter1].[Id] AS [Id], \n[Filter1].[AliquotId] AS [AliquotId], \n[Filter1].[ScientificStudyId] AS [ScientificStudyId], \n[Filter1].[ExpectedSpecimenId] AS [ExpectedSpecimenId], \n[Filter1].[ExpectedAliquotId] AS [ExpectedAliquotId], \n[Filter1].[VisitId] AS [VisitId], \n[Filter1].[BoxId] AS [BoxId], \n[Filter1].[ParticipantId] AS [ParticipantId], \n[Filter1].[Product] AS [Product], \n[Filter1].[BodyMaterial] AS [BodyMaterial], \n[Filter1].[AliquotNr] AS [AliquotNr], \n[Filter1].[ReservationName] AS [ReservationName], \n[Filter1].[Visit] AS [Visit], \n[Filter1].[Win32Color] AS [Win32Color], \n[Filter1].[Position] AS [Position], \n[Filter1].[Barcode] AS [Barcode], \n[Filter1].[Temperature] AS [Temperature], \n[Filter1].[DivergentStorageTemperature] AS [DivergentStorageTemperature], \n[Filter1].[BoxName] AS [BoxName], \n[Filter1].[CollectionDate] AS [CollectionDate], \n[Filter1].[Positioned] AS [Positioned], \n[Filter1].[CheckedOut] AS [CheckedOut], \n[Filter1].[CheckinDate] AS [CheckinDate], \n[Filter1].[CheckoutDate] AS [CheckoutDate], \n[Filter1].[LabelsPrinted] AS [LabelsPrinted], \n[Filter1].[ParticipantNr] AS [ParticipantNr], \n[Filter1].[Specimen] AS [Specimen], \n[Filter1].[ContainerType] AS [ContainerType], \n[Filter1].[ContainerTypeId] AS [ContainerTypeId], \n[Filter1].[Quantity] AS [Quantity], \n[Filter1].[Unit] AS [Unit], \n[Filter1].[QuantityUnit] AS [QuantityUnit], \n[Filter1].[StudyVersion] AS [StudyVersion], \n[Filter1].[ThawCount] AS [ThawCount], \n[Filter1].[Sop] AS [Sop], \n[Filter1].[NrOfRemarks] AS [NrOfRemarks], \n[Filter1].[RemarkSummary] AS [RemarkSummary]\nFROM ( SELECT [Extent1].[Id] AS [Id], [Extent1].[AliquotId] AS [AliquotId], [Extent1]. [ScientificStudyId] AS [ScientificStudyId], [Extent1].[ExpectedSpecimenId] AS [ExpectedSpecimenId], [Extent1].[ExpectedAliquotId] AS [ExpectedAliquotId], [Extent1].[VisitId] AS [VisitId], [Extent1].[BoxId] AS [BoxId], [Extent1].[ParticipantId] AS [ParticipantId], [Extent1].[Product] AS [Product], [Extent1].[BodyMaterial] AS [BodyMaterial], [Extent1].[AliquotNr] AS [AliquotNr], [Extent1].[ReservationName] AS [ReservationName], [Extent1].[Visit] AS [Visit], [Extent1].[Win32Color] AS [Win32Color], [Extent1].[Position] AS [Position], [Extent1].[Barcode] AS [Barcode], [Extent1].[Temperature] AS [Temperature], [Extent1].[DivergentStorageTemperature] AS [DivergentStorageTemperature], [Extent1].[BoxName] AS [BoxName], [Extent1].[CollectionDate] AS [CollectionDate], [Extent1].[Positioned] AS [Positioned], [Extent1].[CheckedOut] AS [CheckedOut], [Extent1].[CheckinDate] AS [CheckinDate], [Extent1].[CheckoutDate] AS [CheckoutDate], [Extent1].[LabelsPrinted] AS [LabelsPrinted], [Extent1].[ParticipantNr] AS [ParticipantNr], [Extent1].[Specimen] AS [Specimen], [Extent1].[ContainerType] AS [ContainerType], [Extent1].[ContainerTypeId] AS [ContainerTypeId], [Extent1].[Quantity] AS [Quantity], [Extent1].[Unit] AS [Unit], [Extent1].[QuantityUnit] AS [QuantityUnit], [Extent1].[StudyVersion] AS [StudyVersion], [Extent1].[ThawCount] AS [ThawCount], [Extent1].[Sop] AS [Sop], [Extent1].[NrOfRemarks] AS [NrOfRemarks], [Extent1].[RemarkSummary] AS [RemarkSummary], row_number() OVER (ORDER BY [Extent1].[CollectionDate] ASC) AS [row_number]\nFROM [dbo].[ClaimedAliquotPositionsReadModels] AS [Extent1]\nWHERE (cast('0ebebae6-594d-4be0-ac8b-a078013f1370' as uniqueidentifier) = [Extent1].[ScientificStudyId])\nAND ([Extent1].[CheckoutDate] &gt;= convert(datetime2, '2004-11-24 00:00:00.0000000', 121))\nAND ([Extent1].[CheckoutDate] &lt; convert(datetime2, '2004-11-25 00:00:00.0000000', 121))\n)  AS [Filter1]\nWHERE [Filter1].[row_number] &gt; 0\nORDER BY [Filter1].[CollectionDate] ASC\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13225266,"title":"Save new record in Entity Framework","body":"<p>I have a litte problem about save new record to database by using Entity framework.</p>\n\n<p>Here the code: </p>\n\n<pre><code>using (_context)\n                {\n                    _context.AddToStudent(newStudent);\n                    _context.AddToStudentInfo(newStudentInfo);\n                    _context.SaveChanges();                   \n                    return true;\n                }\n</code></pre>\n\n<p>My question is : If 1 of 2 _context.AddTo fail so the SaveChanges will be terminated or it will save the one success ??? I appreciate any answer :)</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":314,"score":3,"question_id":4245219,"title":"EF4; Add foreign keys to model","body":"<p>I've got quite a large Entity Framework 4 model (model first), which at the moment has all the relationships defined as associations, without Foreign Key properties.</p>\n\n<p>Anyone know a way to add FK properties to the whole diagram other than by recreating the diagram from scratch or adding each one manually?</p>\n\n<p>I suppose one way would be to generate the database, then build a new model from the database, and then just go through cleaning up, unless there's any better suggestions?</p>\n\n<p>I'm thinking another way would be to write something to tweak the XML.</p>\n"},{"tags":["entity-framework","visual-studio-2012","dataannotations","ef-database-first"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13224834,"title":"ef5 database first data annotation","body":"<p>I am starting MVC4 with VS2012.  I am also using EF5 with the \"Database First\" method of creating my classes.</p>\n\n<p>However because the generated glasses can be regenerated I cannot put the Data Annotation details to assist with validation.</p>\n\n<p>I have seen some code snippets that use MetaData and partial classes but I was wondering if anyone knows of a small compilable example that I can look at and pull apart to better understand how the vasious classes interlink.</p>\n\n<p>Many many thanks for any help.\nDave</p>\n"},{"tags":["entity-framework","ado.net"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13222421,"title":"Entity Framework, database-first or model-first?","body":"<p>I'm starting a new project and I'm interested in using Entity Framework. However, since this is a new project, there isn't an existing model or database yet, so I could either use database-first or model-first in this situation.</p>\n\n<p>When starting with a blank slate like this, is it recommended to use model-first and let EF determine the database design or design the database yourself? I'm comfortable designing normalized databases so I'm not afraid of that aspect, but I'm not sure if there are maintainability and performance benefits from letting EF handle all the database design.</p>\n\n<p>Thanks in advance guys!</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":19,"score":3,"question_id":13222104,"title":"Entity Framework: EF gets related objects of an entity in different order","body":"<p>I'm working with MVC3 and Entity Framework 4.0. The situation is the following: I have an entity called \"Topics\" and a related entity called \"Questions\". To visualize the questions I have a Topics view and then in a foreach sentence inside the view, show the Questions related to that topic: </p>\n\n<p><code>\n<code>foreach(Questions Question in Topic.Questions)\n{\n//Show question info\n}</code>\n</code></p>\n\n<p>But anytime a question is updated in another view, when I go to the Topic view, the questions appear in a diferent order, most specifically, the question that was updated appears first.</p>\n\n<p>Anyone knows why is this behavior?. And how to stop it?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13219903,"title":"Migrate a given (old) database to current model","body":"<p>I am struggling with entity framework's migration quite a bit. Below is how I plan on using migrations, but I find no information on how to accomplish this:</p>\n\n<p>My users are creating databases (Sql Compact Server) on their premises with different versions of my software. Each version introduces a slightly changed EF model. As soon as a user updates to a newer version of the software and opens a database with a previous version of the model, I would like to have some sort of \"auto migration\" bring the given database up-to-date to the current model.</p>\n\n<p>Is there any way to do this? </p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12885116,"title":"DataBase.Exist() returns true even if the connection string has wrong database name in Entity Framework","body":"<p>I am new to EF 5.0, i have purposely set the wrong database name in connection string in Web.Config. i.e. Initial Catalog = \"Wrong Database Name\";</p>\n\n<p>Now I have created a boolean property, which detects whether the database exists or not. Like below - where context is the EFDbContext.</p>\n\n<pre><code>bool IsDatabaseExist = context.DataBase.Exists();\n</code></pre>\n\n<p>My question is, why this is always showing true, even if the DataBase name which I have provided is wrong ?</p>\n"},{"tags":["entity-framework","code-first-migrations"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":14,"score":-1,"question_id":13219609,"title":"Auto Migration or not?","body":"<p>I am using migration for WPF project. </p>\n\n<p>In development it is easy to use auto migration to update database changes, to make development process fast.</p>\n\n<p>Now when I want to deploy it to customer, should I continue using auto migration, or should I do the manual migration, so every-time I make changes, I need to create add-migration files?</p>\n"}]}
{"total":18927,"page":3,"pagesize":100,"questions":[{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13128623,"title":"When does an Entity show up in the collection of the Model","body":"<p>I use entity framework and have a set of users:</p>\n\n<pre><code> public class DbModel : DbContext\n {\n     public DbSet&lt;User&gt; Users { get; set; }\n</code></pre>\n\n<p>I add a User like so:</p>\n\n<pre><code>  User UserOne = new User();\n  model.Users.Add( UserOne );\n</code></pre>\n\n<p>I request the users count:\n      int userCount = model.Users.Count();</p>\n\n<p>userCount is \"0\" I would expect \"1\". Adding DetectChanges doen't help.\nAfter  \"model.SaveChanges()\" the Count = 1, but that is to late I need to combine the in memory stuff with the DB stuff for validation. Is there a way to do this?</p>\n\n<p>SOLUTION</p>\n\n<p>Using the answer of Erik Philips I wrote the following extension method for the DbSet</p>\n\n<pre><code>public static class DBSetExtentions\n{\n     public static IEnumerable&lt;T&gt; AllMembers&lt;T&gt;(\n         this DbSet&lt;T&gt; target, \n         Func&lt;T, bool&gt; selection\n         )  where T : class\n    {\n        return target.Local.Where(selection).Union(target.Where(selection));\n    }\n }\n</code></pre>\n\n<p>it allows me to do selections an validations accross <strong>all</strong> entities like:</p>\n\n<pre><code>    private void ValidateEmail(ValidationDto validationDto)\n    {\n\n        int usersWithSameEmail =\n            validationDto.Model.Users.AllMembers(\n                x =&gt; x.EmailAddress.Equals( EmailAddress ) ).Count();\n\n        if (usersWithSameEmail &gt; 1)\n        {\n            validationDto.Result.Add(new ValidationResult(\"Email address is in use\"));\n        }\n    }\n</code></pre>\n"},{"tags":["c#",".net","sql","entity-framework","entity-framework-4.1"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":102,"score":3,"question_id":13122940,"title":"String preparation when calling stored procedure in Entity Framework","body":"<p>Actually, I have code that uses Entity Framework 4.1 in Visual Studio 2010. Everything is working fine except for one thing : it doesn't seem to \"prepare\" the parameters like a good old <code>[parameters.Add]</code> habitually did.</p>\n\n<p>Here's my code : </p>\n\n<pre><code>using (MyEnterprisesEntities dataContext = new \n                             MyEnterprisesEntities(entityBuilder.ToString()))\n{\n         dataContext.CompanyInitializer(connection.Catalog,\n                                        args.CompanyId,\n                                        args.CompanyName);\n}\n</code></pre>\n\n<p>So, if my company's name is <code>O'Brian and sons</code> (actually it passed before through a WCF web service so it's more in this form: <code>O\\'Brian and sons</code>), it's seem to break my stored procedure (including the possibility of allowing SQL injection).</p>\n\n<p>Is there a way to avoid this situation with EDMX or the old way is more reliable ? </p>\n"},{"tags":["c#","entity-framework","linq-to-entities"],"answer_count":6,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2489,"score":3,"question_id":2772017,"title":"Linq-to-Entities Left JOIN","body":"<p>This is my query:</p>\n\n<pre><code>from forum in Forums\n    join post in Posts on forum equals post.Forum into postGroup    \n\n    from p in postGroup     \n    where p.ParentPostID==0\n\n    select new \n    {\n        forum.Title,\n        forum.ForumID,  \n        LastPostTitle = p.Title,\n        LastPostAddedDate = p.AddedDate         \n    }).OrderBy(o=&gt;o.ForumID) \n</code></pre>\n\n<p>Currently the Join is not left join, meaning if some forum doesn't have a post that belongs to it, it will not be returned.<br>\nThe forum without posts must be returned with null (or default) values for the post properties. </p>\n\n<p><strong>UPDATE</strong>  </p>\n\n<p>The result set should be some thing like that:</p>\n\n<pre><code>ForumId | ForumTitle | LastPostTitle | LastPostAddedDate  \n--------+------------+---------------+------------------\n4       |   Sport    |    blabla     |       12/4/2010  \n4       |   Sport    |    blabla     |       15/4/2010  \n6       |   Games    |    blabla     |       1/5/2010  \n7       |   Flame    |               |\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13179835,"title":"Create relationship between entity which doesn't exist in the db","body":"<p>All, I have 3 tables below.</p>\n\n<p><strong>1.TaskTableA</strong></p>\n\n<p><em><strong>id</em></strong>    uniqueidentifier (PK)</p>\n\n<p><em><strong>deployName</em></strong>  nvarchar(50)</p>\n\n<p><em><strong>hostip</em></strong>  nvarchar(50)</p>\n\n<p><strong>2.TaskTableB</strong></p>\n\n<p><em><strong>id</em></strong>   uniqueidentifier (PK)</p>\n\n<p><em><strong>filePath</em></strong> nvarchar(50)</p>\n\n<p><strong>3.TaskLogTable</strong></p>\n\n<p><em><strong>id</em></strong>   uniqueidentifier (PK)</p>\n\n<p><em><strong>status</em></strong> nvarchar(50)</p>\n\n<p><em><strong>taskid</em></strong>   uniqueidentifier </p>\n\n<p>TaskTableA and TaskTableB are two types of Tasks in my application.\nand All the Task logs are stored in the table TaskLogTable. I don't want create the TaskTableA  and TaskLogTable one2many relationship in DB. \nBut I want to the entities have relationship so that I can use the navigation property to load child table records. I don't know how to add code to make it . please help me , thanks.</p>\n"},{"tags":["entity-framework","exception-handling"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13189463,"title":"Handles SQL Exception from Entity Framework","body":"<p>In my sql stored procedure, i do some insertion and updating which in some scenarios throws Primary Key or unique key violation.</p>\n\n<p>When I try to execute this procedure from ADO.net, .net application also throws that exception and let me know that something wrong had happen.</p>\n\n<p>But when I try to execute this procedure from EF, it just executes. Neither it show anything nor update anything.</p>\n\n<p>How should I handle or notify user that something wrong had happen?</p>\n\n<p>Ado.Net code is </p>\n\n<pre><code> SqlConnection sqlConnection = new SqlConnection(@\"data source=database01; database=test; user id=test; password=test;\");\n        SqlCommand cmd = new SqlCommand(\"[uspUpdateTest]\", sqlConnection);\n        cmd.CommandType = System.Data.CommandType.StoredProcedure;\n        cmd.Parameters.AddWithValue(\"RunID\", RunID);\n        cmd.Parameters.AddWithValue(\"RunCode\", RunCode);\n        sqlConnection.Open();\n        var str = cmd.ExecuteNonQuery();\n</code></pre>\n\n<p>Entity Framework Code is</p>\n\n<pre><code> TestEntities context = new TestEntities();\n        var str=context.UpdateRun(RunID, RunCode);\n</code></pre>\n"},{"tags":["c#","entity-framework","entity","dispose","objectdisposedexception"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13217954,"title":"Object Instance has been disposed (EF)","body":"<p>I'm having some problems with retrieving my Project entity in the EntityFramework. It keeps giving me the Objest instance has been disposed error.</p>\n\n<p>I've got 2 instances, as seen in the image below.<img src=\"http://i.stack.imgur.com/CFO1i.jpg\" alt=\"enter image description here\"></p>\n\n<p>And the following code gives me the error:</p>\n\n<pre><code>    public Project GetProjectyById(int id)\n    {\n        using (var context = new CoderaDBEntities())\n        {\n            return context.Projects.First(c =&gt; c.Id == id);\n        }\n    }\n</code></pre>\n\n<p>Everything from Project is retrieved fine, but the Category object inside the Project object (the association) delivers me the object has been disposed error. What's going on?</p>\n\n<p>Thanks!</p>\n\n<p><strong>Edit: Does this association look odd to you?</strong></p>\n"},{"tags":["entity-framework","ef-code-first","dbcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13211683,"title":"Code first DbContext usage","body":"<p>I have been trying to work with Entity Framework's Code First. I wrote the below line of code</p>\n\n<pre><code>DbContext _context = new  DbContext(ConfigurationManager.ConnectionStrings[\"con\"].ConnectionString);\n</code></pre>\n\n<p>However on execution, the connection remains closed. Is there something wrong with this code??</p>\n\n<p>I have created a generic repository class using the DBContext shown below</p>\n\n<pre><code>public class GenericRepository&lt;T&gt; where T:class\n  {   \n\npublic DbContext _context = new DbContext(ConfigurationManager.ConnectionStrings[\"con\"].ConnectionString);\n\nprivate DbSet&lt;T&gt; _dbset;\n\npublic DbSet&lt;T&gt; Dbset\n{\n\n    set { _dbset = _context.Set&lt;T&gt;(); }\n    get { return _dbset; }\n\n}\n\npublic IQueryable&lt;T&gt; GetAll()\n{\n\n    return Dbset;\n}  \n}\n</code></pre>\n\n<p>and I then call this class on the page load event, where Teacher is an entity class which maps to a table in the database</p>\n\n<pre><code>protected void Page_Load(object sender, EventArgs e)\n{\n    GenericRepository&lt;Teacher&gt; studentrepository = new GenericRepository&lt;Teacher&gt;();\n    rptSchoolData.DataSource = studentrepository.GetAll().ToList();\n    rptSchoolData.DataBind();\n}\n</code></pre>\n\n<p>but the connection remains closed and there is also an InvalidOperation Exception in the ServerVersion of the context object.</p>\n\n<p>Am I missing something??</p>\n"},{"tags":["asp.net","entity-framework","c#-4.0","design-patterns","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13206361,"title":"When should I use EF code-first or model-first in my projects?","body":"<p>We have several ways to access the database with EF : code-first or model-first or database-first design... and I want to know when I use these ways to access the database ?....</p>\n\n<p>Is any standard for these technology for access to the database in my Asp.net web application or asp.net mvc web application?</p>\n"},{"tags":["silverlight","entity-framework","geospatial","silverlight-5.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13204365,"title":"Silverlight 5 - entity framework 5 and domain service exclude unsupported Geography type","body":"<p>I'm very new to Silverlight (this is my first test app) and I'm working through some walkthroughs on setting up a domain service for a silverlight 5 app that uses the Entity Framework.</p>\n\n<p>I have a \"TestApp1\" project and a \"TestApp1.Web\" project which were generated when I created the Silverlight project.</p>\n\n<p>I added an edmx model to the TestApp1.Web project and randomly picked a couple of tables out of a test db I have and one of them includes a Geography column (GeoLocation) which I see is now supported in EF5 (great!) but I'm getting an \"unsupported type\" error in my Silverlight project (TestApp1), how can exclude the GeoLocation property in my Domain Service so that my Silverlight App doesn't complain?</p>\n"},{"tags":["asp.net-mvc","entity-framework","design","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13204145,"title":"Implicit EF queries in Views cause DataReader-related InvalidOperationException","body":"<p>At some point of developing an ASP.NET MVC solution which uses EF as it's ORM I started to encouter a rare-discovered bug (or Heisenbug, as it totally disappears under step-by-step debugging).</p>\n\n<p>At SO, I found that the source of my bug may be either:</p>\n\n<ul>\n<li><code>DbContext</code> is a static Lazy&lt;>-wrapped field in my domain model, thus subject to <code>using(){}</code> idiom multiple result sets.</li>\n<li>My views themselves call HtmlHelper custom extension methods that have EF queries inside (e.g. DropDown select population, thumbnail link generation etc.).</li>\n</ul>\n\n<p>First problem was solved simply by adding <code>multipleactiveresultsets=True</code> to my <code>connectionString</code> definition.</p>\n\n<p>The latter hypothetically requires a switch to ViewModels, prepopulated inside controller actions. However, there many cases where use of ViewModel will be an overkill, requiring addition of dummy copy-create code that will cause maintenance overhead.</p>\n\n<p>My questions are:</p>\n\n<ul>\n<li>Why EF queries inside Views cause <code>There is already an open DataReader associated with this Command which must be closed first.</code> error? Do <em>they</em>?</li>\n<li>How to stop views executing queries without full codebase rewrite?</li>\n</ul>\n"},{"tags":["entity-framework","api","repository-pattern","unit-of-work"],"answer_count":1,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13211731,"title":"Unit of Work, LazyLoading Disabled, Generic Repository, IncludeMultiple<T>, Http 500 error","body":"<ol>\n<li><p>I have a Vehicle with an association to Model, Model has an association to Make.</p></li>\n<li><p>Here is my Generic Repository as pertaining to associations as LazyLoadingEnabled = false in my project:</p>\n\n<pre><code>public IQueryable&lt;T&gt; IncludeMultiple&lt;T1&gt;(params Expression&lt;Func&lt;T, object&gt;&gt;[] associations) where T1 : class\n{\n    var source = (IQueryable&lt;T&gt;)DbContext.Set&lt;T&gt;();\n    if (associations != null)\n    {\n        foreach (Expression&lt;Func&lt;T, object&gt;&gt; path in associations)\n            source = DbExtensions.Include&lt;T, object&gt;(source, path);\n    }\n    return source;\n}\n</code></pre></li>\n<li><p>In my api controller, I am using Unit of work pattern. Here is my GetAll method:</p>\n\n<pre><code>public IEnumerable&lt;Vehicle&gt; GetAll()\n{\n  var vehicles = Uow.VehicleRepository.IncludeMultiple&lt;Vehicle&gt;(c =&gt; c.VehicleModel).ToList();\n  return vehicles;\n}\n</code></pre></li>\n</ol>\n\n<p>Everything works fine and Json retrieves the Vehicle class data as well as the related VehicleModel class data.</p>\n\n<p>However, Vehicle has no direct association to VehicleMake, only VehicleModel does. Now, if my GetAll method has this:</p>\n\n<pre><code>    public IEnumerable&lt;Vehicle&gt; GetAll()\n    {\n      var vehicles = Uow.VehicleRepository.IncludeMultiple&lt;Vehicle&gt;(c =&gt; c.VehicleModel, c =&gt; c.VehicleModel.VehicleMake).ToList();\n      return vehicles;\n    }\n</code></pre>\n\n<p>while I see in debug that vehicles does indeed have the vehicles and their relevant VehicleModel and VehicleMake data, it returns a Http 500 error in Fiddler. </p>\n\n<hr>\n\n<p>Update:</p>\n\n<hr>\n\n<p>Added another association in Vehicle called \"Test\", with the GetAll method being:</p>\n\n<p>(c => c.VehicleModel, c => c.Test)</p>\n\n<p>No error, all data was returned via fiddler. So, it appears that a \"Non-direct association\" (ie Vehicle -> VehicleMake) is the cause of the error.</p>\n\n<hr>\n\n<p>Question:</p>\n\n<hr>\n\n<p>What would be the correct way to retrieving the relevant Vehicle data and its associated classes' data and return it to Json while not getting a Http 500 error?</p>\n"},{"tags":["entity-framework","entity-framework-5","c#-4.5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13206431,"title":"Entity Framework 5.0 Conventions","body":"<p>I am just beginning to learn Entity Framework (starting with 5.0) and running into some issues. After watching a few videos on Pluralsight, I decided to get creative and created an abstract base class that inherited from DbContext and exposed a single \"DataContext\" property that was a DbSet of a generic type. Something like this:</p>\n\n<pre><code>public abstract class BaseDataContext&lt;E&gt; : DbContext\n     where E : CustomEntity\n{\n      public DbSet&lt;E&gt; DataContext {get;set;}\n\n      public BaseDataContext()\n      {\n           Database.SetInitializer&lt;BaseDataContext&lt;E&gt;&gt;(null);\n      }\n }\n</code></pre>\n\n<p>This seemed to be working great until I started dealing with entities that had relationships with each other (parent/child). What was occurring is when I tried to add a new child entity to the database via a data class that inherited BaseDataContext is instead of just attaching the reference (meaning, taking the child and say \"your parent key is 123\"), it created another record with a new key for the parent and all other fields duplicated and made this new record the parent of the child. I tried just setting the key property of my child (nulling out the property that was exposed with the data), but that didn't change anything. I found a thread on SO (<a href=\"http://stackoverflow.com/questions/5823115/adding-user-to-a-role-inserts-a-duplicate-user-into-users-table\">here</a>) that said it wasn't a good idea to do multiple data contexts like what I was attempting to do and seemed to explain exactly what was happening.</p>\n\n<p>My question for this is, with the popularity EF seems to be gaining for everyone, is this the common approach? To create a single data context that is then passed around with constructors everywhere? Or is there a simpler way that is more common? This would especially apply if things get into background threads since passing a context there might get difficult.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13212578,"title":"Defining foreign key constraints with Entity Framework code-first","body":"<p>I have following entity class called <code>Code</code>. It stores categories of different kinds - the data for which I would have otherwise needed to create many small tables e.g. User Categories, Expense Categories, Address types, User Types, file formats etc.</p>\n\n<pre><code>public class Code\n{\n    public int Id { get; set; }\n    public string CodeType { get; set; }\n    public string CodeDescription { get; set; }\n\n\n    public virtual ICollection&lt;Expense&gt; Expenses { get; set; }\n    public virtual ICollection&lt;Address&gt; Addresses { get; set; }\n                   :\n                   : // many more\n\n}\n</code></pre>\n\n<p>The class <code>Expense</code> looks like this:</p>\n\n<pre><code>public class Expense\n{\n    public int Id { get; set; }\n\n    public int CategoryId { get; set; }\n    public virtual Code Category { get; set; }\n\n    public int SourceId { get; set; }\n\n    public double Amount { get; set; }\n    public DateTime ExpenseDate { get; set; }\n}\n</code></pre>\n\n<p>With the above class definitions, I have established 1:many relation between <code>Code</code> and <code>Expense</code> using the <code>CategoryId</code> mapping. </p>\n\n<p>My problem is, I want to map the <code>SourceId</code> field in <code>Expense</code> to the <code>Code</code> object. Which means, <code>Expense</code> object would contain </p>\n\n<pre><code>public Code Source { get; set; }\n</code></pre>\n\n<p>If I use this, at runtime I get an error about cyclic dependencies.</p>\n\n<p>Can someone please help?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":14,"score":3,"question_id":13212811,"title":"Entity Framework IN clause on navigation property","body":"<p>I have a object IQueryable which I am trying to dynamically add Where clauses, this works great for columns on Listing object, however now conditionally I would like to add a IN clause to a navigation property (ListingAmenities) which has columns ListingID, AmenityID</p>\n\n<p>I have critiera.AmenityIDs which may contain Amenities I like to filter the results on.</p>\n\n<p>I am trying to achieve the following if there is any amenityIDs in my array</p>\n\n<pre><code>select * from Listings l inner join ListingAmenities a on l.ListingID = a.ListingID where a.AmenityID IN(1,2,3)\n</code></pre>\n\n<p>here is my code (I am using EF5)</p>\n\n<pre><code>if (criteria.AmenityIDs.Count &gt; 0)\n        {\n            listings = listings.Where(x =&gt; x.ListingAmenities.Any(y =&gt; y.AmenityID == criteria.AmenityIDs));\n        }\n</code></pre>\n\n<p>which of course does not work.\nImportant note is that I am adding these WHERE clauses dynamically so that is why I am building up a IQueryable object</p>\n"},{"tags":["entity-framework","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13209676,"title":"Is it possible to keep many relations in one table column?","body":"<p>I use Entity Framework code first and I have problem because EF creates the <code>Event</code> table with two reference keys, one for class <code>ObjectOne</code>, and another for class <code>ObjectTwo</code>. </p>\n\n<p>Is it possible to keep values of Id in one column <code>Event.ObjectId</code> and the type of relation in properties <code>Event.Type</code>?</p>\n\n<p>I can do following mapping (in which I have only one column for FK). Is it possible to not create FK in database, because now I must add value that exists in <code>ObjectOne</code> table and <code>ObjectTwo</code> table and it's not a solution for me):</p>\n\n<pre><code> modelBuilder.Entity&lt;ObjectOne&gt;()\n            .HasMany(c =&gt; c.Events).WithOptional().HasForeignKey(x =&gt; x.ObjectId);\n        modelBuilder.Entity&lt;ObjectTwo&gt;()\n            .HasMany(c =&gt; c.Events).WithOptional().HasForeignKey(x =&gt; x.ObjectId);\n</code></pre>\n\n<p>Sample classes:</p>\n\n<pre><code> public class ObjectOne\n{\n    public int ObjectOneId { get; set; }\n    public ICollection&lt;Event&gt; Events { get; set; }\n}\n\npublic class ObjectTwo\n{\n    public int ObjectTwoId { get; set; }\n    public ICollection&lt;Event&gt; Events { get; set; }\n}\n\n\npublic class Event\n{\n    public int EventId { get; set; }\n    public int ObjectId { get; set; }\n    public string Type { get; set; }\n}\n\npublic class AddEvent : Event\n{\n}\n\npublic class Updated : Event\n{\n}\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["php",".net","database","entity-framework","orm"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2607,"score":3,"question_id":5532688,"title":"ORM for PHP like .NET Entity Framework","body":"<p>I'm a .NET developer and new in PHP. I want to know, is there a ORM for PHP like the Entity Framework in the Microsoft .NET Framework? </p>\n\n<p>Are there any utility applications to make working with data faster and easier?</p>\n"},{"tags":[".net","entity-framework","optimistic-concurrency"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13173415,"title":"Update properties of attached entity with databasevalue on query","body":"<p>I have entity classes that have an integer property (named ROW_VERSION) with ConcurrencyMode set to \"Fixed\" for optimistic concurrency checking. I increment the value of this column in my application code before saving an entity of this type (so StoreGeneratedPattern is set to None). This works well when saving changes.</p>\n\n<p>Now I also would like to detect a concurrency error when I have a previously loaded entity (with ROW_VERSION = x) and I create a new DbContext, attach this entity and issue a query involving this entity. The problem there is that if the ROW_VERSION was incremented by another client application (ROW_VERSION = x + 1), this isn't detected during my query, because the value of the attached entity has obviously priority (which totally makes sense for common column values).</p>\n\n<p>For my concurrency checking column on the other hand it would be nice, if the EF updates the value with the current databasevalue, so I can compare it with the expected value. Alternatively an exception thrown from the query execution would be acceptable.</p>\n\n<p>I'm using entity framework 4.3 with .NET 4.0.</p>\n\n<p>Edit (in response to the comment from Gert Arnold):</p>\n\n<p>I try to clarify my problem a little more ...</p>\n\n<p>Notes of how my application works generally:</p>\n\n<ul>\n<li><p>There is a treeview showing my available entity objects and on selecting one, the full entity is loaded from DB to be displayed in a detail view, where it can be edited</p></li>\n<li><p>Modifications to an entity object are not saved immediately but are cached in memory, so modifications of different entity objects can pile up and are saved all together, when the user hits the save button.</p></li>\n<li><p>DbContexts are created separately for queries and saving changes (i.e. I don't have the same DbContext all the time, but they are instantiated as needed).</p></li>\n<li><p>When an entity object is loaded to be display in the detail view, all previously modified entity objects (that are cached) are attached to the DbContext that is used for the query first. Then the actual query is issued. <strong>So if i query an entity object, that was modified before I will get the modified version as result and not the version from database (which could have changed in the meantime).</strong></p></li>\n</ul>\n\n<p>So here is an example that shows my problem:</p>\n\n<ol>\n<li><p>Client App 1 loads an entity object with ROW_VERSION = 1, disposes the DbContext and keeps the reference to this entity object for further editing.</p></li>\n<li><p>Client App 2 loads the same entity object mentioned in step 1, changes a property and saves the changes. This causes the ROW_VERSION in the DB to be incremented (it is 2 now).</p></li>\n<li><p>The user of Client App 1 now changes some properties of entity object (which is still in memory with a ROW_VERSION of 1).</p></li>\n<li><p>Before Client App 1 saves the changes, it loads some other entity objects for display, and eventually selects the entity object in question again (e.g. to review the changes made). This causes a query where the result will contain the already changed entity object (because it is attached to the DbContext before the actual query is sent to the database).</p>\n\n<p><strong>And here is my problem: At this point the entity framework could compare the ROW_VERSION of the attached object with that of the object in the actual query result, detect a mismatch and e.g. throw an exception.</strong></p>\n\n<p><strong>But instead the EF treats the ROW_VERSION property like all other properties which could just have been changed by the client.</strong></p></li>\n</ol>\n\n<p>So I wish the EF to treat the ROW_VERSION property specially and compare its values on every query to detect changes by other clients. This way I would detect concurrency situations earlier than when waiting for the SaveChanges call.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13210738,"title":"EF5 , Widows Forms , Dragging a chield entity from project datasource into a GridView creates only 2 columns","body":"<p>After moved to EF5, created a diagram with 2 tables linked thru a FKey like Order/Order Details , then create a new project datasource with the Order object , dragging a column into a text box creates a binding source successfully , but then dragging the child entity OrderDetails into a gridview creates only 2 columns Count &amp; IsReadOnly .</p>\n\n<p>VS2010 or 2012 , same\n.NET 4.0 or 4.5 , same problem</p>\n\n<p>return to EF4 , problem solved</p>\n"},{"tags":["entity-framework","mono"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":247,"score":0,"question_id":9767223,"title":"Mono + Entity Framework using MS DLL?","body":"<p>I know Mono has no EF implementation, and no plans to create one. </p>\n\n<p>Would it be possible, however, to simply take the relevant DLLs from .NET and add them into my Mono project in MonoDevelop? I may be completely misunderstanding how this is supposed to work; but wondered if this would then allow me to continue using EF + Mono rather than replacing the ORM.</p>\n\n<p>Thanks.</p>\n"},{"tags":["entity-framework","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2832,"score":4,"question_id":1546474,"title":"Is ADO.NET Entity framework database schema update possible?","body":"<p>I'm working on proof of concept application like crm and i need your some advice.\nMy application's data layer completely dynamic and run onto EF 3.5. When the user update the entity, change relation or add new column to the database, first i'm planning make for these with custom classes. After I rebuild my database model layer with new changes during the application runtime. And my model layer tie with tightly coupled to my project for easy reflecting model layer changes (It connected to my project via interfaces and loading onto to application domain in the runtime).</p>\n\n<p>I need to create dynamic entities, create entity relations and modify them during the runtime after that i need to create change database script for updating database schema. I know ADO.NET team says \"we will be able to provide this property in EF 4.0\", but i don't need to wait for them.</p>\n\n<p>How can i update database changes during the runtime via EF 3.5 ? </p>\n\n<p>For example, i need to create new entity or need to change some entity schema, add new properties or change property types after than how can apply these changes on the physical database schema  ?</p>\n\n<p>Any ideas ?   </p>\n"},{"tags":["entity-framework","hang","savechanges"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13207907,"title":"Entity Framework SaveChanges \"hangs\" the program","body":"<p>My code is pretty simple:</p>\n\n<pre><code>Context.AddObject(\"EntitiesSetName\", newObjectName);\nContext.SaveChanges();\n</code></pre>\n\n<p>It worked fine, but just one time  the first one. That time, I interrupted my program by Shift+F5 after the SaveChanges() was traced. It was a debug process, so I manually removed a newly created record from a DB and ran a program again in the debug mode. But it does not work anymore  it hangs when SaveChanges() is being called. </p>\n\n<p>Another strange thing that I see: \nIf I write before addObject() and SaveChanges() are called something like:</p>\n\n<pre><code>var tempResult = (from mydbRecord in Context \n                  where Context.myKey == 123 \n                  select mydbRecord.myKey).Count(); \n// 123 is the key value of the record that should be created before the program hangs.\n</code></pre>\n\n<p>tempResult will have the next value: 1. </p>\n\n<p>So, it seems that the record is created (when the program hung) and now exists, but when I check the DB manually using other tools  it does not!</p>\n\n<p>What do I do wrong? Is it some kind of cache issue or something else?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I've found a source of problem.\nIt was not EF problem at all, but it's a problem of the tool that I use to control the database manually (Benthic).</p>\n\n<p>My program falls into some kind of deadlock (when I call SaveChanges()) with the tool when the tool is connected into the same DB.</p>\n\n<p>So, the problem is in the synchronization area, imho, so my question can be marked as solved.</p>\n"},{"tags":["asp.net","entity-framework","json.net"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13209262,"title":"control [JsonIgnore] in ASP.NET Web API during runtime","body":"<p>As we know, ASP.NET web api (ApiController) gives JSON response automatically through NewtonSoft.JSON.</p>\n\n<p>My three-level <strong>1:MANY:1</strong> EF data model is queried in several ways and it works fine with applying [JsonIgnore] attribute to some virtual properties in order to eliminate reference circulation issue.\n(I use third solution in <a href=\"http://stackoverflow.com/questions/13060609/why-my-super-simple-asp-net-web-api-mvc4entity-framework-5-doesnt-work\">this(link)</a> answer)</p>\n\n<p>but my problem is, I sometimes need to use json-ignored properties to query with model.</p>\n\n<p>Is there any method to control <strong>[JsonIgnore]</strong> attribute during runtime?\nOr, is there any method to switch on-and-off property to be ignored in NewtonSoft.JSON during runtime?</p>\n"},{"tags":["entity-framework","foreign-keys","composite-key"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13205156,"title":"Composite Key Not Loading All Related Entities","body":"<p>I've been trying various solutions to this for a couple of hours now and I just cannot figure it out.  I'm using a custom membership provider in a system so have a roles table defined using code first like this:</p>\n\n<pre><code>public class UsersInRole\n{\n    [Key]\n    public long UserId { get; set; }\n\n    [Required]\n    public UserProfile UserProfile { get; set; }\n\n    [Key]\n    public long RoleId { get; set; }\n\n    [Required]\n    public webpages_Role Role { get; set; }\n}\n</code></pre>\n\n<p>When I script out this table all seems correct:</p>\n\n<pre><code>CREATE TABLE [dbo].[UsersInRoles](\n[UserId] [bigint] NOT NULL,\n[RoleId] [bigint] NOT NULL,\nCONSTRAINT [PK_dbo.UsersInRoles] PRIMARY KEY CLUSTERED \n(\n[UserId] ASC,\n[RoleId] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n\nALTER TABLE [dbo].[UsersInRoles]  WITH CHECK ADD  CONSTRAINT [FK_dbo.UsersInRoles_dbo.UserProfile_UserId] FOREIGN KEY([UserId])\nREFERENCES [dbo].[UserProfile] ([Id])\nON DELETE CASCADE\nGO\n\nALTER TABLE [dbo].[UsersInRoles] CHECK CONSTRAINT [FK_dbo.UsersInRoles_dbo.UserProfile_UserId]\nGO\n\nALTER TABLE [dbo].[UsersInRoles]  WITH CHECK ADD  CONSTRAINT [FK_dbo.UsersInRoles_dbo.Roles_RoleId] FOREIGN KEY([RoleId])\nREFERENCES [dbo].[Roles] ([RoleId])\nON DELETE CASCADE\nGO\n\nALTER TABLE [dbo].[UsersInRoles] CHECK CONSTRAINT [FK_dbo.UsersInRoles_dbo.Roles_RoleId]\nGO\n</code></pre>\n\n<p>The strange behaviour is only the UserProfile property is ever populated.  If I load the UsersInRole objects directly through the context I see the same behaviour.</p>\n\n<pre><code>var userInRoles = context.UsersInRoles.ToList();\n</code></pre>\n\n<p>The UserProfile properties are loaded but the Role property is always null.</p>\n\n<p>The UsersInRole entity has this composite key mapped:</p>\n\n<pre><code>HasKey(compKey =&gt; new { compKey.UserId, compKey.RoleId });\n</code></pre>\n\n<p>I've checked over and over the relationships and as far as I can tell this should be working fine.  The UserProfile id field is Id and the role id field is RoleId as the relationships state.  I can't see the wood for the trees now!!</p>\n\n<p>Any ideas would be appreciated.</p>\n"},{"tags":["asp.net","entity-framework",".net-4.0"],"answer_count":2,"favorite_count":4,"up_vote_count":23,"down_vote_count":0,"view_count":11992,"score":23,"question_id":1761362,"title":"Entity Framework One-To-One Mapping Issues","body":"<p>Using VS 2010 beta 2, ASP.NET MVC.</p>\n\n<p>I tried to create an Entity framework file and got the data from my database.</p>\n\n<p>There were some issues with the relationships, so I started to tweak things around, but I kept getting the following error for simple one-to-one relationships</p>\n\n<pre><code>Error   1\tError 113: Multiplicity is not valid in Role 'UserProfile' in relationship 'FK_UserProfiles_Users'. \nBecause the Dependent Role properties are not the key properties, the upper bound of the multiplicity of the Dependent Role must be *.  myEntities.edmx\t2024\n</code></pre>\n\n<p>My Users table is consists of some other many-to-many relationships to other tables, but when I try to make a one-to-one relationship with other tables, that error pops up.</p>\n\n<p><strong>Users Table</strong></p>\n\n<ul>\n<li>UserID</li>\n<li>Username</li>\n<li>Email</li>\n</ul>\n\n<p>etc..</p>\n\n<p><strong>UserProfiles Table</strong></p>\n\n<ul>\n<li>UserProfileID</li>\n<li>UserID (FK for Users Table)</li>\n<li>Location</li>\n<li>Birthday</li>\n</ul>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13207695,"title":"enum declaration in code first ef does not appear in database table","body":"<p>I create a sample project according to <a href=\"http://msdn.microsoft.com/en-us/data/hh859576\" rel=\"nofollow\">this article</a>, and I am also using EF 5.0, but when I look at the table, I cant see the \"Name\" field. here is my code :</p>\n\n<pre><code>class Program\n    {\n        static void Main(string[] args)\n        {\n            using (var context = new EnumTestContext())\n            {\n                context.Departments.Add(new Department { Name = DepartmentNames.English });\n\n                context.SaveChanges();\n\n                var department = (from d in context.Departments\n                                  where d.Name == DepartmentNames.English\n                                  select d).FirstOrDefault();\n\n                Console.WriteLine(\n                    \"DepartmentID: {0} Name: {1}\",\n                    department.DepartmentID,\n                    department.Name);\n            }\n        }\n    }\n\n    public enum DepartmentNames\n    {\n        English,\n        Math,\n        Economics\n    }\n\n    public partial class EnumTestContext : DbContext\n    {\n        public DbSet&lt;Department&gt; Departments { get; set; }\n\n        public EnumTestContext()\n            : base(\"name=Test_Connection\")\n        {\n\n        }\n    }\n\n    public partial class Department\n    {\n        public int DepartmentID { get; set; }\n        public DepartmentNames Name { get; set; }\n        public decimal Budget { get; set; }\n    }\n</code></pre>\n\n<p>and also my app.config:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;\n\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n  &lt;/configSections&gt;\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework\"&gt;\n      &lt;parameters&gt;\n        &lt;parameter value=\"v11.0\" /&gt;\n      &lt;/parameters&gt;\n    &lt;/defaultConnectionFactory&gt;\n  &lt;/entityFramework&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"Test_Connection\" connectionString=\"Data Source=127.0.0.1;Initial Catalog=TestEnumEF;Integrated Security=true;\" providerName=\"System.Data.SqlClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p><strong>Note</strong>: commenting \"entityFramework\" config section from above code does not have any effect.</p>\n\n<p>Thanks for your help.</p>\n\n<p><strong>Edited</strong>: \nI installed EF 5.0 from Nuget Package Manager, and While I was trying to install this, it said that EF version is 5.0 but in solution explorer, when I right clicked on Entityframework dll, the properties pan shows version is 4.4.0.0</p>\n"},{"tags":["c#","entity-framework","transactions","dapper","savechanges"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13202765,"title":"Custom atomic UPDATE commands inside SaveChanges()","body":"<p>For various reasons I need to be able to do several custom SQL <code>UPDATE</code> commands when I call <code>SaveChanges</code> on a <code>DbContext</code>. I want this to happen atomically so either both the regular <code>SaveChanges</code> and the SQL succeeds, or neither does.</p>\n\n<p>I don't know how to accomplish this though. What I've tried so far is this and various variations:</p>\n\n<p><a href=\"https://gist.github.com/4004127\" rel=\"nofollow\">EF transactions  Gist</a></p>\n\n<p>The error here is (on the <code>ExecuteSqlCommand</code> call):</p>\n\n<blockquote>\n  <p>ExecuteNonQuery requires the command to have a transaction when the connection assigned to the command is in a pending local transaction.</p>\n</blockquote>\n\n<p>Okay, fair enough. The <code>ExecuteSqlCommand</code> doesn't have an overload that accepts a transaction though. So, I installed the Dapper package and replaced the offending line with this Dapper call and I pass in the transaction:</p>\n\n<pre><code>this.Database.Connection\n  .Execute(\"insert into Tests (Foo, Bar) values ('test', 2)\", \n  transaction: tran);\n</code></pre>\n\n<p>but now the error happens on <code>base.SaveChanges()</code> and it gives me the following:</p>\n\n<blockquote>\n  <p>SqlConnection does not support parallel transactions.</p>\n</blockquote>\n\n<p>So apparently <code>SaveChanges</code> always creates a new transaction even though I created one on the connection of the datacontext already?</p>\n\n<p>Is there any way in which I can accomplish what I want?</p>\n\n<p>I'm using Entity Framework 5.0 Code First.</p>\n"},{"tags":["entity-framework",".net-4.5","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13204475,"title":"(EF 5 + .net 4,5) escalating transaction to DTC when querying using EF-Linq and SqlConnection","body":"<p>We recently upgraded our project to use .net 4.5 and EF 5. We use traditional SqlConnection to query legacy part of application and EF-Linq for rest.</p>\n\n<p>After upgrade code that used to work fine started throwing error regarding MSDTC service being not available. Turning MSDTC service on solves the problems.</p>\n\n<p><strong>Question is why my transactions are getting escalated? Has anything changed in .net 4.5 or EF 5?</strong></p>\n\n<p>For example i have piece of code wrapped in TransactionScope making two updates. First using SqlConnection then second using EF+Linq. Both using exactly same connectionstrings part, connecting to same database in sql server 2012. It get's escalated to DTC. And it used to not escalate using .net 4 and EF 4X.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13204187,"title":"Entity Framework Timeout when called from WCF","body":"<p>I have a .NET project that consists of the following:</p>\n\n<ol>\n<li>WCF web service</li>\n<li>Entity Framework data layer</li>\n</ol>\n\n<p>The ultimate issue described below is with the User table. The User table the schema is as follows:</p>\n\n<pre><code>CREATE TABLE [dbo].[User](\n    [Id] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY CLUSTERED,\n    [FirstName] [varchar](50) NOT NULL,\n    [LastName] [varchar](50) NOT NULL,\n    [Email] [varchar](50) NOT NULL,\n    [Username] [varchar](50) NOT NULL,\n    [Password] [varchar](250) NOT NULL,\n    [AuthenticationKey] [uniqueidentifier] NULL,\n    [Active] [bit] NOT NULL DEFAULT (1),\n    [Admin] [bit] NOT NULL DEFAULT (0),\n    [AutoSubmit] [bit] NOT NULL DEFAULT(0))\n\nCREATE UNIQUE NONCLUSTERED INDEX [IX_User] ON [dbo].[User] \n(\n        [Username] ASC\n)\n</code></pre>\n\n<p>If I run a query against the User table with 3 records in it, it executes in less than a second.</p>\n\n<p>I am running the following query against Entity Framework in a method called User.Validate().</p>\n\n<pre><code>database.User.Where(user =&gt; user.Username == userName &amp;&amp; user.Active).SingleOrDefault()\n</code></pre>\n\n<p>The above code executes ok when calling from a unit test. However, when calling from that method from a WCF web service, the following exception occurs:</p>\n\n<p><em>System.ServiceModel.FaultException: System.Web.Services.Protocols.SoapException: Server was unable to process request. ---> System.Data.EntityCommandExecutionException: An error occurred while executing the command definition. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding. ---> System.ComponentModel.Win32Exception: The wait operation timed out</em></p>\n\n<p>Under the covers of Entity Framework, the below query is what is run when the query timed out. If I run the query it executes in less than a second. What might be causing this timeout?</p>\n\n<pre><code>exec sp_executesql N'SELECT TOP (2) \n[Extent1].[Id] AS [Id], \n[Extent1].[FirstName] AS [FirstName], \n[Extent1].[LastName] AS [LastName], \n[Extent1].[Email] AS [Email], \n[Extent1].[Username] AS [Username], \n[Extent1].[Password] AS [Password], \n[Extent1].[AuthenticationKey] AS [AuthenticationKey], \n[Extent1].[Active] AS [Active], \n[Extent1].[Admin] AS [Admin], \n[Extent1].[AutoSubmit] AS [AutoSubmit]\nFROM [dbo].[User] AS [Extent1]\nWHERE [Extent1].[Username] = @p__linq__0',N'@p__linq__0 varchar(8000)',@p__linq__0='test1'\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12933661,"title":"EF 4.3+ How to get current database initialzer","body":"<p>How can I get the current database initializer, so I can test that the right one is set before automatic publish?</p>\n\n<p><strong>Edit</strong>: I want to create a test case that is testing if a team member forgot to remove a line like this:</p>\n\n<pre><code>Database.SetInitializer&lt;SomeModel&gt;(new DropCreateDatabaseAlways&lt;SomeModel&gt;());\n</code></pre>\n\n<p>but there is no method or property like Database.GetInitializer().</p>\n\n<p>is there a way to get current database initializer?</p>\n"},{"tags":["c#",".net","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":11655912,"title":"Entity Framework does not read FK Relationships, LINQ To SQL Does","body":"<p>I am trying to create an Entity Model from a database.  When I add the tables EF does not read my existing FK constraints.  If I make a Linq to SQL file in the same project and add the same tables it reads the constraints without issue.</p>\n\n<p>Whats the deal?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":13184540,"title":"What are the ways to optimize Entity Framework queries with Contains()?","body":"<p>Wee load large object graph from DB.\nThe query has many Includes and Where()uses Contains() to filter the final result.\nContains is called for the collection containing about thousand entries.</p>\n\n<p>The profiler shows monstrous human-unreadable SQL.\nThe query cannot be precompiled because of Contains().</p>\n\n<p>Is there any ways for optimization of such queries?</p>\n\n<p><strong>Update</strong></p>\n\n<pre><code>public List&lt;Vulner&gt; GetVulnersBySecurityObjectIds(int[] softwareIds, int[] productIds)\n        {\n            var sw = new Stopwatch();\n\n            var query = from vulner in _businessModel.DataModel.VulnerSet\n                        join vt in _businessModel.DataModel.ObjectVulnerTieSet.Where(ovt =&gt; softwareIds.Contains(ovt.SecurityObjectId))\n                        on vulner.Id equals vt.VulnerId\n                        select vulner;\n\n            var result = ((ObjectQuery&lt;Vulner&gt;)query.OrderBy(v =&gt; v.Id).Distinct())\n                .Include(\"Descriptions\")\n                .Include(\"Data\")\n                .Include(\"VulnerStatuses\")\n                .Include(\"GlobalIdentifiers\")\n                .Include(\"ObjectVulnerTies\")\n                .Include(\"Object.ProductObjectTies.Product\")\n                .Include(\"VulnerComment\");\n\n            //   ,  \n            if (productIds.HasValues())\n                result = (ObjectQuery&lt;Vulner&gt;)result.Where(v =&gt; v.Object.ProductObjectTies.Any(p =&gt; productIds.Contains(p.ProductId)));\n\n            sw.Start();\n            var str = result.ToTraceString();\n            sw.Stop();\n            Debug.WriteLine(\"   {0} .\", sw.Elapsed.TotalSeconds);\n            sw.Restart();\n            var list = result.ToList();\n            sw.Stop();\n            Debug.WriteLine(\"   {0} .\", sw.Elapsed.TotalSeconds);\n\n            return list;\n        }\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13202383,"title":"Return list of mapped classes - Entity Framework","body":"<p>I have this class that is linked to a View in the SQL Server:</p>\n\n<pre><code>[Table(\"V_Clients\")]\npublic class Client\n{\n    [Key]\n    public int ClientId { get; set; }\n    public short BranchId { get; set; }\n    public string CorporateName { get; set; }\n    public string TIN { get; set; }\n    public string Address { get; set; }\n    public string Phone { get; set; }\n    public string Id { get; set; }//NroCi\n    public short CityId { get; set; }\n    public short ZoneId { get; set; }\n    public short SubZoneId { get; set; }\n    public short VendorId { get; set; }\n    public short PriceListId { get; set; }\n    public short CollectorId { get; set; }\n\n    [ForeignKey(\"BranchId\")]\n    public virtual Branch Branch { get; set; }\n\n    [ForeignKey(\"CityId\")]\n    public virtual City City { get; set; }\n\n    [ForeignKey(\"ZoneId\")]\n    public virtual Zone Zone { get; set; }\n\n    [ForeignKey(\"SubZoneId\")]\n    public virtual SubZone SubZone { get; set; }\n\n    [ForeignKey(\"VendorId\")]\n    public virtual Vendor Vendor { get; set; }\n\n    [ForeignKey(\"PriceListId\")]\n    public virtual PriceList PriceLists {get;set;}\n\n    [ForeignKey(\"CollectorId\")]\n    public virtual Collector Collector { get; set; }\n}\n</code></pre>\n\n<p>but when I try to make a list of it like this:</p>\n\n<pre><code>public ActionResult Index()\n    {\n        var clients = db.Clients.Include(c =&gt; c.Branch).Include(c =&gt; c.City).Include(c =&gt; c.Zone).Include(c =&gt; c.SubZone).Include(c =&gt; c.Vendor).Include(c =&gt; c.PriceLists).Include(c =&gt; c.Collector);\n        return View(clients.ToList());\n    }\n</code></pre>\n\n<p>nothing happens. Could it be because of the relationships?</p>\n\n<p>Note: All classes are linked to views and work fine with the others except my <code>Client</code> class.</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13200242,"title":"Entity framework navigation property is null","body":"<p>I have 2 simple classes:</p>\n\n<pre><code>public class Setting\n{\n    [Key, DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Guid SettingId { get; set; }\n\n    [Required]\n    public String Name { get; set; }\n\n    public String Value { get; set; }\n\n    [Required]\n    public SettingCategory SettingCategory { get; set; }\n}\n\npublic class SettingCategory\n{\n    [Key, DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Guid SettingCategoryId { get; set; }\n\n    [Required]\n    public String Value { get; set; }\n\n    public ICollection&lt;Setting&gt; Settings { get; set; }\n}\n</code></pre>\n\n<p>When I retrieve a <code>SettingCategory</code> from the database the collection Settings is always null.</p>\n\n<p>When I make it a <code>virtual</code> then it will say: <code>The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.</code></p>\n\n<p>How can I access my <code>Settings</code> list?</p>\n\n<p>The other way around works, if I retrieve a <code>Setting</code> from the database the <code>SettingCategory</code> property is filled.</p>\n\n<p>This is my initial code-migrations script:</p>\n\n<pre><code>CreateTable(\n    \"dbo.Settings\",\n    c =&gt; new\n        {\n            SettingId = c.Guid(nullable: false, identity: true),\n            Name = c.String(nullable: false),\n            Value = c.String(),\n            SettingCategory_SettingCategoryId = c.Guid(nullable: false),\n        })\n    .PrimaryKey(t =&gt; t.SettingId)\n    .ForeignKey(\"dbo.SettingCategories\", t =&gt; t.SettingCategory_SettingCategoryId, cascadeDelete: true)\n    .Index(t =&gt; t.SettingCategory_SettingCategoryId);\n\nCreateTable(\n    \"dbo.SettingCategories\",\n    c =&gt; new\n        {\n            SettingCategoryId = c.Guid(nullable: false, identity: true),\n            Value = c.String(nullable: false),\n        })\n    .PrimaryKey(t =&gt; t.SettingCategoryId);\n</code></pre>\n\n<p>And this is the part that gets it from the database:</p>\n\n<pre><code>public SettingCategory Get(Guid settingCategoryId)\n{\n    using (var context = new BackofficeContext())\n    {\n        return context\n            .SettingCategories\n            .FirstOrDefault(s =&gt; s.SettingCategoryId == settingCategoryId);\n    }\n}\n</code></pre>\n\n<p><strong>Answer</strong></p>\n\n<p>I forgot the include in <code>.SettingCategories</code>, but I was trying it with a lambda:</p>\n\n<pre><code>public SettingCategory Get(Guid settingCategoryId)\n{\n    using (var context = new BackofficeContext())\n    {\n        return context\n            .SettingCategories\n            .Include(s =&gt; s.Settings)\n            .FirstOrDefault(s =&gt; s.SettingCategoryId == settingCategoryId);\n    }\n}\n</code></pre>\n\n<p>That doesn't work, but this does:</p>\n\n<pre><code>public SettingCategory Get(Guid settingCategoryId)\n{\n    using (var context = new BackofficeContext())\n    {\n        return context\n            .SettingCategories\n            .Include(\"Settings\")\n            .FirstOrDefault(s =&gt; s.SettingCategoryId == settingCategoryId);\n    }\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13187078,"title":"Unable to use EF EDMX from separate project","body":"<p>I have a simple solution with four projects; a console app for UI, domain objects, data repository, and an EF data model.</p>\n\n<p>The DataModel project contains the EF EDMX. It's separate as it may be consumed by other projects. I'm not sure about keeping it in its own project but, for now, it is.</p>\n\n<p>The DataLayer project contains the data repositories and datacontext classes. The DataLayer project references the DataModel and Domain projects.</p>\n\n<p>The Domain projects contains a T4 template and generated domain objects. This project references the DataModel project.</p>\n\n<p>I modified the app.config of the UI project to point to the DataModel project for the EDMX.</p>\n\n<p>When I run the application, I get an error: \"FileNotFoundException was unhandled. Unable to resolve assembly 'DataModel'.\" I noticed an assembly named DataModel was not in the Bin folder but all other expected files were present.</p>\n\n<p>I checked the Metadata Artifact Processing property on the EDMX. It was set to Embed in Output Assembly.</p>\n\n<p>If I move the EDMX from the DataModel project to the DataLayer project, everything works fine.</p>\n\n<p>How do I troubleshoot this further? Why can't I use the EDMX in the DataModel folder?</p>\n\n<p>Entity Framework 5\nVisual Studio 2010\nC# / .NET 4</p>\n"},{"tags":["c#","mysql","entity-framework","linq-to-entities","database-performance"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":13201049,"title":"MySQL with Entity Framework is slow because of derived tables. How can I fix it?","body":"<p>I am using MySQL Connector/Net 6.5.4 with LINQ to entities, and <strong>I frequently get terrible query performance because the entity framework generates queries that use derived tables.</strong> </p>\n\n<p>Here is a simplified example of what I've encountered several times. In C#, I write a query like this:</p>\n\n<pre><code>var culverCustomers = from cs in db.CustomerSummaries where cs.Street == \"Culver\";\n// later...\nvar sortedCustomers = culverCustomers.OrderBy(cs =&gt; cs.Name).ToList();\n</code></pre>\n\n<p>Instead of generating simple a query like this:</p>\n\n<pre><code>SELECT cust.id FROM customer_summary cust WHERE cust.street = \"Culver\" ORDER BY cust.name\n</code></pre>\n\n<p>The entity framework generates a query with a derived table like this:</p>\n\n<pre><code>SELECT Project1.id FROM (\n    SELECT cust.id, cust.name, cust.street FROM customer_summary cust\n    WHERE Project1.street = \"Culver\"\n) AS Project1 -- here is where the EF generates a pointless derived table\nORDER BY Project1.name\n</code></pre>\n\n<p>If I explain both queries I get this for the first query:</p>\n\n<pre><code>id, select_type, table, type, possible_keys, rows\n1,  PRIMARY,     addr,  ALL,  PRIMARY,       9\n1,  PRIMARY,     cust,  ref,  PRIMARY,       4\n</code></pre>\n\n<p>... and something awful like this for the entity framework query</p>\n\n<pre><code>id, select_type, table,      type, possible_keys, rows\n1,  PRIMARY,     &lt;derived2&gt;, ALL,                 9639 *** WTF!!!\n2,  DERIVED,     addr,       ALL,  PRIMARY,       9\n2,  DERIVED,     cust,       ref,  PRIMARY,       4\n</code></pre>\n\n<p>Note the first row, where MySQL explains that it's scanning <strong>9000+ records</strong>. Because of the derived table, MySQL is creating a temp table and loading every frigging row. (Or so I'm deducing based on articles like this one: <a href=\"http://www.mysqlperformanceblog.com/2006/08/31/derived-tables-and-views-performance/\" rel=\"nofollow\">Derived Tables and Views Performance</a>)</p>\n\n<p><strong>How can I prevent the Entity Framework from using a derived table, or how can I convince MySQL to do the obvious optimization for queries like this?</strong></p>\n\n<p>For completion, here is the view that is the source for this linq query:</p>\n\n<pre><code>create view  customer_summary as\nselect cust.id, cust.name, addr.street\ncustomers cust \njoin addresses addr\non addr.customer_id = cust.id\n</code></pre>\n"},{"tags":["c#","linq","entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":26,"score":2,"question_id":13200430,"title":"Cannot query property named \"group\" on EF object","body":"<p>I have an EF entity object <code>sysSettings</code> class that has a few properties. <code>group</code> and <code>name</code> is among these properties.</p>\n\n<p><code>quer</code> in the code below is an <code>IQueryable&lt;sysSettings&gt;</code> object.</p>\n\n<p>When trying to write the following query, I'm having difficulty with the second where clause.</p>\n\n<pre><code>var query = from setting in quer\n    where (setting.name.Equals(\"Url\") &amp;&amp; setting.group.Equals(\"system\"))\nselect setting;\n</code></pre>\n\n<p>It seems that when I have a property on an Entity object called <code>group</code> I cannot access that property from within the LINQ query.</p>\n\n<p>I think this might be because <code>group</code> may be a reserved/contextual work/action in LINQ.</p>\n\n<p>Changing the property name of the Entity is unfortunately not an option.</p>\n"},{"tags":["database","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13198869,"title":"Is there a command to check to see if a database exists from Entity Framework?","body":"<p>I may have worded the question poorly but in my global.asx file i use </p>\n\n<pre><code> if (System.Diagnostics.Debugger.IsAttached)\n        {\n            var test = new TestDbSeeder(App_Start.NinjectWebCommon.UcxDbContext);\n            test.seed();\n       }\n</code></pre>\n\n<p>This checks to see if the debugger is attached and runs my test seeder so that my acceptance tests always pass.</p>\n\n<p>I need to check to see if the database exists as well and if not run this code first:</p>\n\n<pre><code>  var test2 = new DataSeeder();\n  test2.Seed(App_Start.NinjectWebCommon.UcxDbContext);\n</code></pre>\n\n<p>This dataseeder is the actual data that has to always be in the database. Is there a command to check  if the database exists so that I can run that code block.  Thanks!</p>\n"},{"tags":["c#",".net","entity-framework","lambda"],"answer_count":8,"favorite_count":0,"up_vote_count":26,"down_vote_count":0,"view_count":20799,"score":26,"question_id":2058487,"title":"Entity Framework - Cannot convert lambda expression to type 'string' because it is not a delegate type","body":"<p>I am using Entity Framework in my C# based code.  I am running into an unexpected weirdness and am looking for suggestions.</p>\n\n<p>Case 1, 2, 3, 4...\nProjects:<br>\nRivWorks.dll<br>\nRivWorks.Service.dll<br>\nRivWorks.Alpha.dll  </p>\n\n<p>Samples (all of these work):<br/>\n<strong>RivWorks.Alpha.dll:</strong></p>\n\n<pre><code>public static bool EndNegotitation(long ProductID)\n{\n    var product = (from a in _dbFeed.AutoWithImage \n                   where a.AutoID == ProductID select a).FirstOrDefault();\n...\n}\n</code></pre>\n\n<p><strong>RivWorks.Service.dll</strong></p>\n\n<pre><code>public static RivWorks.Model.NegotiationAutos.AutoWithImage \n    GetProductById(long productId)\n{\n    var myProduct = from a in _dbFeed.AutoWithImage \n                    where a.AutoID == productId select a;\n\n    return myProduct.FirstOrDefault();\n}\npublic static List&lt;RivWorks.Model.NegotiationAutos.AutoWithImage&gt; \n    GetProductByCompany(Guid companyId)\n{\n    var myProduct = from a in _dbFeed.AutoWithImage \n                    where a.CompanyID == companyId select a;\n\n    return myProduct.ToList();\n}\n</code></pre>\n\n<p>etc</p>\n\n<p>Case \"weirdness\":<br>\nRivWorks.Web.Service.dll (WCF project)<br>\nContains the same references as the other projects.</p>\n\n<pre><code>public NegotiateSetup GetSetup(string method, string jsonInput)\n{\n    ...\n    long.TryParse(ProductID, out result);\n    var product = (from a in _dbFeed.AutoWithImage \n                   where a.AutoID == result select a).FirstOrDefault();\n    ...\n}\n</code></pre>\n\n<p>I am getting this compile time error (the word \"where\" is highlighted in my editor):<br/>\n<em>Cannot convert lambda expression to type 'string' because it is not a delegate type</em><br/></p>\n\n<p>Any ideas what would cause this?</p>\n"},{"tags":["entity-framework","design-patterns","domain-driven-design","repository-pattern"],"answer_count":5,"favorite_count":3,"up_vote_count":9,"down_vote_count":0,"view_count":158,"score":9,"question_id":13180501,"title":"What specific issue does the repository pattern solve?","body":"<p><em>(Note: My question has very similar concerns as the person who asked <a href=\"http://stackoverflow.com/questions/11618809/few-things-about-repository-pattern-that-i-simply-dont-understand\">this question</a> three months ago, but it was never answered.)</em></p>\n\n<p>I recently started working with MVC3 + Entity Framework and I keep reading that the best practice is to use the repository pattern to centralize access to the DAL. This is also accompanied with explanations that you want to keep the DAL separate from the domain and especially the view layer. But in the examples I've seen the repository is (or <em>appears to be</em>) simply returning DAL entities, i.e. in my case the repository would return EF entities.</p>\n\n<p>So my question is, what good is the repository if it only returns DAL entities? Doesn't this add a layer of complexity that doesn't eliminate the problem of passing DAL entities around between layers? If the repository pattern creates a \"single point of entry into the DAL\", how is that different from the context object? If the repository provides a mechanism to retrieve and persist DAL objects, how is that different from the context object?</p>\n\n<p>Also, I read in at least one place that the Unit of Work pattern centralizes repository access in order to manage the data context object(s), but I don't grok why this is important either.</p>\n\n<p>I'm 98.8% sure I'm missing something here, but from my readings I didn't see it. Of course I may just not be reading the right sources... :\\</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","asp.net","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13194650,"title":"Filter with EntityDatasource in ASP.NET webforms","body":"<p>I have two Classes (given via Entity Framework) which are in a many to many relationship:</p>\n\n<pre><code>Corporation which has the member Tags\n\nTag which has the member name\n</code></pre>\n\n<p>The EntityDataSource gives me the ObjectQuery which i want to filter in a given tagname but i don't know how.  I want to get all corporations, which have a tag with the name \"myname\". I don't know how to do the linq query</p>\n\n<p>When i query the entities i unfortunately don't get an Objectquery.</p>\n\n<pre><code>protected void EntityDataSource1_QueryCreated(object sender, QueryCreatedEventArgs e)\n{\n    // first try\n    var corps = e.Query.Cast&lt;Corporation&gt;(); \n    // of course doesn't work, because oyu can't access a member (name) of a collection (Tags) \n    // i don't know the right linq expression for this\n    e.Query = from c in corps where c.Tags.Name.Contains(\"myname\") select c; \n\n    // second try\n    var tags = from t in entities.Tags where t.Name.Contains(\"myname\") select t;\n    var filteredcorporations = from c in tags select c.Corporations;\n    // does not work because it is not a ObjectQuery&lt;Corporation&gt;\n    e.query = filteredcorporations; \n}\n</code></pre>\n\n<p>My EntityDataSource:</p>\n\n<pre><code>&lt;asp:EntityDataSource ID=\"EntityDataSource1\" runat=\"server\" ConnectionString=\"name=eodbEntities\" DefaultContainerName=\"eodbEntities\" EnableFlattening=\"False\" EntitySetName=\"Corporations\" OnQueryCreated=\"EntityDataSource1_QueryCreated\"&gt;\n&lt;/asp:EntityDataSource&gt;\n</code></pre>\n"},{"tags":["asp.net-mvc-3","entity-framework","validation","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13184018,"title":"How does validation work in database-first dbContext (EF4.3.1 & MVC3)?","body":"<p>How does validation work in database-first dbContext (EF4.3.1 &amp; MVC3)?</p>\n\n<p>I'm doing this (yes, it's VB):</p>\n\n<pre><code>If ModelState.IsValid Then\n\n                db.SaveChanges()\n</code></pre>\n\n<p>But the SaveChanges throws DbEntityValidationException \"Validation failed for one or more entities. See 'EntityValidationErrors' property for more details.\"</p>\n\n<p>I expect it to return the view again with the appropriate validation messages, but clearly I'm missing something because I don't know why it should work that way!  You would expect Google to help, but most examples seem to be code-first.</p>\n\n<p>This is database first, so the model has been generated. I would expected the validation constraints to be generated too (at least simple ones like NOT NULL in SQL Server) , but that doesn't seem to work.</p>\n\n<p>Oddly, some fields are working as explected and others aren't.  </p>\n\n<p>For example, I have a non-nullable text field in the database. It appears as non-nullable in the EF designer and in the generated code. But when I submit it, I get the exception instead of returning the form with the field highlighted.</p>\n\n<p>On the other hand, I have a date field that is non-nullable. It is checked prior to trying to update the database, and the form is presented again with the field highlighted for correction.</p>\n"},{"tags":["asp.net-mvc","entity-framework","postgresql","devart"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":13187573,"title":"Entity Framework complaining about required fields when saveChanges even if valid data are setted","body":"<p>I'm using Entity Framework (DbContext with database first) with MVC. When user save from a form, I have a condition in the controller that send the entity to the <strong>update</strong> of <strong>insert</strong> method depending of some internal flag of mine.</p>\n\n<p>When sending entity to the update method, I flag it to modified using <code>context.Entry(myEntity).State = EntityState.Modified;</code>,  I call saveChanges() and everything work well.</p>\n\n<p>When sending the entity to the insert method, I flag it to added using <code>context.Entry(myEntity).State = EntityState.Added;</code> but when calling saveChanges() I receive error about 2 fields that are required...</p>\n\n<p>The problem is that thoses 2 fields are not empty and they effectively contain valid data just before saving... I have even try to force new values to thoses 2 fields just before saving but same error.</p>\n\n<p>It may be usefull to mention that I'm using Devart DotConnect For PostgreSQL as db provider.</p>\n\n<p>Any idea how to debug this problem?</p>\n\n<p><strong>EDIT:</strong> </p>\n\n<p>Here is the error:</p>\n\n<blockquote>\n  <p>Validation failed for one or more entities. See 'EntityValidationErrors' property for more details.</p>\n</blockquote>\n\n<p>When looking for this EntityValidationErrors I receive the 2 following specific errors:</p>\n\n<blockquote>\n  <p>The flg_actif field is required</p>\n  \n  <p>The user_creation field is required</p>\n</blockquote>\n\n<p>As mentionned before, those fields are filled with data just before saving so I don't understand what is happening.</p>\n\n<p>I'm using EF v4.0.30319 (system.data.entity=> v4.0 and EntityFramework=> v4.4)</p>\n\n<p><strong>EDIT2:</strong>\nJust to clarify a little bit more: The entity I'm trying to insert already exist in database. The form show the data of this database row. When saving, I decide if I update the row (this work well) but sometime, I need to insert the edited row as a new register instead of updating it to keep an history of the change in database.</p>\n"},{"tags":["jquery","asp.net-mvc","wcf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13196887,"title":"jQuery Autocomplete tied to WCF Service ASP.NET MVC","body":"<p>New to ASP.NET MVC and programming, and I have searched high and low for materials on this subject but haven't found a concrete answer for my particular problem.</p>\n\n<p>The project I am working on requires the use of WCF services.  Initially I started with a jQuery autocomplete function that worked, however moving the code to a WCF service has broken some communication.  The autocomplete functionality no longer works  </p>\n\n<p>WCF Service</p>\n\n<pre><code>public IList&lt;Location&gt; QuickSearchLocation(string term)\n    {\n        using (var db = new InspectionEntities())\n        {\n            //return all locations except the reserved \"Other\"\n            return db.Locations\n                .Where(r =&gt; r.LocationName.Contains(term) &amp;&amp; r.LocationId !=    Constants.OtherId)\n                .ToList();\n        }\n    } \n</code></pre>\n\n<p>The above code is meant to takes user input based on relation to child table.  If user input does not match data in child table, the users entry is saved to an \"other\" column in the main db.</p>\n\n<p>Controller</p>\n\n<pre><code>public ActionResult QuickSearchLocation(string term)\n    {\n        return Json(_service.QuickSearchLocation(term), JsonRequestBehavior.AllowGet);\n    }\n</code></pre>\n\n<p>View</p>\n\n<pre><code>div class=\"editor-field\"&gt;\n        @Html.TextBoxFor(m=&gt;m.LocationId,new {data_autocomplete =     Url.Action(\"QuickSearchLocation\", \"Inspection\")})\n</code></pre>\n\n<p>script</p>\n\n<pre><code>$(document).ready(function () {\n\n$(\":input[data-autocomplete]\").each(function () {\n\n    $(this).autocomplete({ source: $(this).attr(\"data-autocomplete\")});\n});\n</code></pre>\n\n<p>Any insight on my problem would be helpful.</p>\n"},{"tags":["entity-framework","migration","primary-key","constraints"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13196826,"title":"Entity Framework constraint naming in database","body":"<p>I have a problem with the naming of some primary keys in the database. On my development system the primary key constraints are named <code>PK_FullTableName</code>. Now on a production system the constraints are all named <code>PK_PartofTableName_3214EC27164452B1</code> (with different Hex characters for each table).</p>\n\n<p>The problem I have are the migrations. I have a code-based migration, that should change the primary key of a table and therefore has to drop the old constraint/primary key with <code>DropPrimaryKey(\"FullTableName\", new[] { \"Field1\", \"Field2\" });</code> </p>\n\n<p>On my development system everything works fine, on the productive system I get an SQL exception that the constraint <code>PK_FullTableName</code> could not be found and I cannot migrate.</p>\n\n<p>I dont know why Entity Framework names the constraints different on these two systems. Does anyone know what this behavior is depending on? Is this naming from the EF or from the database(MSSQLExpress)? And is there a workaround?</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12935730,"title":"EF 5 DBContext.Set<T>.Remove(entity) fails, but succeeds when I debug and step into","body":"<p>Got a very strange scenario here.</p>\n\n<p>Calling the following Code using DBContext the Remove Fails</p>\n\n<pre><code>int id = 5;\nvar sql = \"SELECT * from dbo.Product WHERE productId = @id\";\nvar data = dbContext.Set&lt;Product&gt;().SqlQuery(sql, new object[] {new SQLParameter(\"id\", id)});\n\nvar entityToDelete = data.AsQueryable().FirstOrDefault();\n\ndbContext.Set&lt;Product&gt;().Remove(entityToDelete); \ndbContext.SaveChanges();\n</code></pre>\n\n<p>I receive the following Error Message:</p>\n\n<blockquote>\n  <p>Entities in 'MyEntities.Products' participate in the\n  'FK_Product_ProductType' relationship. 0 related 'ProductType' were\n  found. 1 'ProductType' is expected.</p>\n</blockquote>\n\n<p>Now Every product has a foreign key reference to a ProductType.  There is actually a value set for this Foreign Key in the Database.</p>\n\n<p>Here is the kicker.  When I debug and step into the code line by line it succeeds?  Very strange?  Why is this happening?  any ideas?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>It succeeds when I watch the variable entityToDelete when Debugging.  But fails if I remove the watch.  Which makes me think it has something to do with Lazy Loading.</p>\n"},{"tags":["sql-server","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13196804,"title":"How to set collate on database when using EF code-first","body":"<p>I am trying to set collate to Latin1_General_100_CI_AS in a database created by EF code-first. I am using EF 5. To do this I am using a DbInitializer of type DropCreateDatabaseAlways and overriding the Seed method. In it I am executing the following code as the first statement.</p>\n\n<pre><code>context.Database.ExecuteSqlCommand(\"ALTER DATABASE EMR_SA COLLATE Latin1_General_100_CI_AS\");\n</code></pre>\n\n<p>This executes fine and does modify the database correctly, but the problem is that after this statement I seed some database values. When I try to commit these inserts I get the following  error </p>\n\n<pre><code>  InnerException: System.Data.SqlClient.SqlException\n   HResult=-2146232060\n   Message=Resetting the connection results in a different state than the initial login. The login fails.\n   Login failed for user \n</code></pre>\n\n<p>While writing this question it appears that this is a duplicate of <a href=\"http://stackoverflow.com/questions/12054930/set-database-collation-in-entity-framework-code-first-initializer\">this QA</a> but there is no answer for it.  I am hoping by resubmitting this question that someone has had experience since then that may allow them to answer this now. What is the best way to set collate on a database when using EF code-first?</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13126872,"title":"EF5 Code First Migrations - DB Init running over and over","body":"<p>Got this weird thing going on with my new EF5 Code First app that's leveraging new new migrations support. One thing that I'm seeing is that the database seeding routine is running on the initial DB load, but what's strange is that it seems to run again after the app hasn't run in a while. Is this to be expected? What's the best way to keep this from happening?</p>\n\n<p>I get the whole .AddOrUpdate(), but still seems odd to have this run more than when the app first ran and created the DB schema. Ideas?</p>\n"},{"tags":["entity-framework",".net-3.5","connections"],"answer_count":2,"favorite_count":3,"up_vote_count":12,"down_vote_count":0,"view_count":4924,"score":12,"question_id":1282675,"title":"When does Entity Framework open and close Database Connections?","body":"<p>When I instance my \"Entities\" object in Entity Framework, and make a couple of queries using that Entities object, what happens to connections?</p>\n\n<ul>\n<li>Does it open a connection when I instance the object, and close it when I dispose of it?</li>\n<li>Or does it open and close a connection for each single query I execute?</li>\n</ul>\n\n<p>In either case, is it possible to change it so that it does the other thing?</p>\n\n<p>Thanks in advance!\nDaniel</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13194215,"title":"The property is not a declared property on type 'class'","body":"<p>I got the error <code>The property 'Rank' is not a declared property on type 'MasterUser'. Verify that the property has not been explicitly excluded from the model by using the Ignore method or NotMappedAttribute data annotation. Make sure that it is a valid primitive property.</code> I checked my model class and it is there.</p>\n\n<pre><code>public class MasterUser\n{\n    //many other properties...\n    public virtual char Rank { get; set; }\n    //more properties below\n}\n</code></pre>\n\n<p>I also checked my db context and it is also there and mapped perfectly.<br/></p>\n\n<pre><code>public class BBDataContext : DbContext\n{\n    public DbSet&lt;MasterUser&gt; Users { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        #region MUSR_USRID mapping\n\n        //Mapped properties above....\n        modelBuilder.Entity&lt;MasterUser&gt;()\n            .Property(usr =&gt; usr.Rank).HasColumnName(\"MUSR_RANK\");\n        //More mapped properties..\n\n        modelBuilder.Entity&lt;MasterUser&gt;().ToTable(\"dbo.MUSR_FIL\");\n        #endregion\n\n        base.OnModelCreating(modelBuilder);\n    }\n}\n</code></pre>\n\n<p>In the table, <code>MUSR_RANK</code> is nullable with a char datatype.</p>\n\n<p>How can I fix this? Does the database have an effect on this? I am currently using SQL Server 2000.</p>\n\n<p>Thanks for the help.</p>\n"},{"tags":["asp.net-mvc","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13181932,"title":"Update Related Entity Of Detached Entity","body":"<p>I'm having an issue <strong>updating</strong> an entity with multiple related entities. I've got a very simple model which consists of an article entity and a list of categories the article can be related to. You can choose from a check box list which of these categories are associated to it...which works fine.</p>\n\n<p>The problem crops up when I actually come to <strong>update</strong> an existing entity using the dbContext. As I am updating this entity, I have already detached it from the context ready to re-attach it later so the update can execute properly. </p>\n\n<p>I can see that after I posting the model, the category(s) are being added to the article entity just fine and it looks like it updates in the repository with no errors occurring. </p>\n\n<p>When I look in the database the article has updated as normal but the category(s) have not.</p>\n\n<p>Here is my (simplified) update code...</p>\n\n<pre><code>    public virtual bool Attach(T entity)\n    {\n        _dbContext.Entry(entity).State = EntityState.Modified;\n        _dbSet.Attach(entity);\n\n        return this.Commit();\n    }\n</code></pre>\n\n<p>Any help will be much appreciated.</p>\n"},{"tags":["c#","sql-server","asp.net-mvc","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13192696,"title":"Mapping stored procedures to entities with additional computed column","body":"<p>I am currently stuck with one of my projects and need some help..</p>\n\n<p>I created a table valued function in MSSQL that returns a table and a computed column (Distance) and have mapped it in Entity Framework 5 using the Entity Designer. </p>\n\n<p>The problem is that I can only map the results either as a complex type or an entity that is in my model class. I need to use one of the Navigation Property in the entity and hence, I am stuck with using my entity class. </p>\n\n<p>However, because the column Distance is not a real column in my table, I have no way of getting that value for every entity for the table valued function. </p>\n\n<p>Is there any way of hacking around this? I've tried using a partial class but the function would not map the Distance column as a property for me. </p>\n\n<p>Here's a little code to explain what I'm trying to do here :</p>\n\n<pre><code>IQueryable&lt;Deal&gt; deals = context.GetDealsByTypeLocationSearch(latitude, longitude);\nforeach (var d in deals)\n{\n  Console.Write(d.Distance); \n}\n</code></pre>\n\n<p>The distance value is null when I tried to create a partial class for my entity Deal.</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":85,"score":3,"question_id":12553073,"title":"Entity Framework Migration cascade delete is always true even WillCascadeOnDelete(false) in configuration","body":"<p>Why relations with  WillCascadeOnDelete(false) defined in configuration,  are always true in generated migration? </p>\n\n<p><strong>Here is the configuration code</strong></p>\n\n<pre><code> public class PartySuppliesConfiguration:EntityTypeConfiguration&lt;PartySupplies&gt;\n{\n    public PartySuppliesConfiguration()\n    {\n        HasKey(x =&gt; x.Id);\n        HasRequired(x=&gt;x.Supplier).WithMany().HasForeignKey(x=&gt;x.SupplierId).WillCascadeOnDelete(false);\n        HasRequired(x =&gt; x.Product).WithMany().HasForeignKey(x =&gt; x.ProductId).WillCascadeOnDelete(false);\n        HasRequired(x =&gt; x.Currency).WithMany().HasForeignKey(x =&gt; x.CurrencyId).WillCascadeOnDelete(false);\n        HasRequired(x =&gt; x.CreatedUser).WithMany().HasForeignKey(x =&gt; x.CreatedUserId).WillCascadeOnDelete(false);\n        Property(x =&gt; x.UnitPrice).HasColumnType(\"Money\");\n    }\n}\n</code></pre>\n\n<p><strong>and here is the generated migration</strong> </p>\n\n<pre><code> public override void Up()\n    {\n        CreateTable(\n            \"PartySupplies\",\n            c =&gt; new\n                {\n                    Id = c.Int(nullable: false, identity: true),\n                    SupplierId = c.Int(nullable: false),\n                    ProductId = c.Int(nullable: false),\n                    UnitPrice = c.Decimal(nullable: false, precision: 18, scale: 2),\n                    CurrencyId = c.Int(nullable: false),\n                    FromDate = c.DateTime(nullable: false),\n                    ThruDate = c.DateTime(),\n                    CreatedUserId = c.Int(nullable: false),\n                })\n            .PrimaryKey(t =&gt; t.Id)\n            .ForeignKey(\"Parties\", t =&gt; t.SupplierId, cascadeDelete: true)\n            .ForeignKey(\"Products\", t =&gt; t.ProductId, cascadeDelete: true)\n            .ForeignKey(\"Curencies\", t =&gt; t.CurrencyId, cascadeDelete: true)\n            .ForeignKey(\"Users\", t =&gt; t.CreatedUserId, cascadeDelete: true)\n            .Index(t =&gt; t.SupplierId)\n            .Index(t =&gt; t.ProductId)\n            .Index(t =&gt; t.CurrencyId)\n            .Index(t =&gt; t.CreatedUserId);\n\n    }\n</code></pre>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","mvc","entity-framework","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":296,"score":0,"question_id":10282061,"title":"HOw can I access two database in single .edmx file?","body":"<p>I have created mvc3 application.</p>\n\n<p>I have one <code>.edmx</code> already created which is based on <code>Db1</code> but now\nI have created a view which is based on <code>Database2</code> and I need to use this view inside my project.</p>\n\n<p>For that I need to update my EF <code>.edmx</code> file.\nbut when I right click and select option <code>Update model from Database</code>\ni'm only getting <code>all tables , view ,sps from</code>Db1<code>` its obvious\nBut as i need to use view which is from</code>Database2<code>how can i add it into my model</code>.edmx` file?\nplease help. </p>\n"},{"tags":["asp.net-mvc","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13191379,"title":"VS 2010 / MVC4 / EF5 Add new controller error","body":"<p>When I attempt to add a new controller, I get the following template error. I've tried setting my template back to normal and reinstalling mvc4 and ef5 to no avail.</p>\n\n<p>Error:</p>\n\n<pre><code>Error   1   Running transformation: System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---&gt; System.IO.FileNotFoundException: Unable to locate file\n   at Microsoft.VisualStudio.TextTemplating.VSHost.TextTemplatingService.ResolvePath(String path)\n   at Microsoft.VisualStudio.TextTemplating.VSHost.TextTemplatingService.ResolvePath(String path)\n   --- End of inner exception stack trace ---\n   at System.RuntimeMethodHandle._InvokeMethodFast(IRuntimeMethodInfo method, Object target, Object[] arguments, SignatureStruct&amp; sig, MethodAttributes methodAttributes, RuntimeType typeOwner)\n   at System.RuntimeMethodHandle.InvokeMethodFast(IRuntimeMethodInfo method, Object target, Object[] arguments, Signature sig, MethodAttributes methodAttributes, RuntimeType typeOwner)\n   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture, Boolean skipVisibilityChecks)\n   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)\n   at Microsoft.VisualStudio.TextTemplatingB214C175D962501244305AB8E4D64CC3.GeneratedTextTransformation.DynamicHost.ResolvePath(String path)\n   at Microsoft.VisualStudio.TextTemplatingB214C175D962501244305AB8E4D64CC3.GeneratedTextTransformation.EdmMetadataLoader.CreateEdmItemCollection(String sourcePath)\n   at Microsoft.VisualStudio.TextTemplatingB214C175D962501244305AB8E4D64CC3.GeneratedTextTransformation.TransformText()\n   at Microsoft.VisualStudio.TextTemplating.TransformationRunner.RunTransformation(TemplateProcessingSession session, String source, ITextTemplatingEngineHost host, String&amp; result)        1   1   \n</code></pre>\n"},{"tags":["c#","sql","entity-framework","sql-server-2012","filetable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13181645,"title":"Entity Framework 5.0 and FileTable","body":"<p>So say I have the following tables in my SQL Server 2012 DB:</p>\n\n<pre><code>Person\n  PersonId\n  FirstName\n  LastName\n\nPhoto\n  PhotoId\n  PersonId (fk)\n  DateTaken\n\nPhotoFileTable\n  (all the FileTable columns)\n</code></pre>\n\n<p>And the photos stored on disk are structured like this:\n\\\\myserver\\filestreamshare\\People\\PersonId\\Photo1.tif</p>\n\n<p>And very important:  There are a TON of photos ALREADY on disk that need to be added to the database- that's why I thought a FileTable would be cool as it automatically picks them up.</p>\n\n<p>So I need to do 2 things- first, relate the Photo table to the PhotoFileTable so that I can get all photos for a person.  And second (and more painful) I want to use Entity Framework 5.0 to do this.</p>\n\n<p>Using the edmx designer, I can't add a table that contains a hierarchyid.  Since that is the primary key it seems it should be used as a 1:1 mapping between PhotoId and path_locator (the FileTable hierarchyid).  But then I can't add the Photo table either.</p>\n\n<p>What's the best approach here?  At the end of the day, I want to have EF objects in C# to use.  It ideally would look something like:</p>\n\n<pre><code>class Person\n  List&lt;Photo&gt;\n\nclass Photo\n  Filestream (to lazy load the image from the filesystem to bitmapimage)\n  Path (?)\n\nor maybe\nclass Photo\n  BitmapImage (lazy load)\n</code></pre>\n\n<p>Am I going about this the wrong way?  Can I get there from here?  Thought or suggestions?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13156258,"title":"EF dbContext IQueryable methods dependencies not working","body":"<p>I've tried to add a few helper methods to my dbContext class like this</p>\n\n<pre><code>public IQueryable&lt;Tool&gt; GetAllToolsInCompanyGroup(string userName)\n{\n    var user = GetUserByName(userName);\n    return Tools.Where(t =&gt; Companies.Any(c =&gt; user.Company.CompanyGroupId == c.CompanyGroupId &amp;&amp; c.Id == t.CompanyId));\n}\n</code></pre>\n\n<p>But if I call that from my controller I get this exception:</p>\n\n<pre><code>Unable to create a constant value of type 'myNamespace.Models.Company'. Only primitive types or enumeration types are supported in this context.\n</code></pre>\n\n<p>If i do the exact same thing in in my controller like this:</p>\n\n<pre><code>db.Tools.Where(t =&gt; db.Companies.Any(c =&gt; user.Company.CompanyGroupId == c.CompanyGroupId &amp;&amp; c.Id == t.CompanyId))\n</code></pre>\n\n<p>it works. What am I doing wrong?</p>\n"},{"tags":["entity-framework","entitydatasource","entity-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":5078,"score":1,"question_id":2768953,"title":"How to implement EntityDataSource Where IN entity sql clause","body":"<p>I want to pass a number of values into a parameter of the <code>EntityDataSource</code>, e.g.:</p>\n\n<p><code>Where=\"it.ORDER_ID IN {@OrderIdList}\"</code> (this is a property on the EntityDataSource)</p>\n\n<pre><code>&lt;WhereParameters&gt;\n    &lt;asp:ControlParameter \n       Name=\"OrderIdList\" Type=\"Int16\" \n       ControlID=\"OrderFilterControl\" PropertyName=\"OrderIdList\" \n    /&gt;\n&lt;/WhereParameters&gt;\n</code></pre>\n\n<p>This doesn't work as <code>ORDER_ID</code> is of type <code>int32</code> and I need to pass in multiple values, e.g. <code>{1,2,3}</code> etc</p>\n\n<p>The next thing I tried was setting the <code>Where</code> clause in code-behind and this all works except I can't get data binding on <code>DropDownLists</code> to work. By this I mean no value is returned from the bound dropdownlists in the <code>EntityDataSource</code> Updating Event.</p>\n\n<p>My ideal solution would be to use a <code>WhereParameter</code> on the <code>EntityDataSource</code> but any help is appreciated. Thanks, Tony.</p>\n\n<hr>\n\n<p>A complete code example follows using the AdventureWorks db:</p>\n\n<pre><code>Public Class EntityDataSourceWhereInClause\nInherits System.Web.UI.Page\n\nProtected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load\n    CustomersEntityDataSource.Where = WhereClause ''# reset after each postback as its lost otherwise\nEnd Sub\n\nPrivate Sub cmdFilterCustomers_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmdFilterCustomers.Click\n    Dim CustomerIdList As New Generic.List(Of Int32)\n    For Each item As ListItem In CustomerIdCheckBoxList.Items\n        If item.Selected Then\n            CustomerIdList.Add(item.Value)\n        End If\n    Next\n\n    Dim CustomerCsvList As String = String.Join(\", \", CustomerIdList.Select(Function(o) o.ToString()).ToArray())\n    WhereClause = \"it.CustomerID IN {\" &amp; CustomerCsvList &amp; \"}\"\n\n    CustomersEntityDataSource.Where = WhereClause\n    FormView1.PageIndex = 0\n\nEnd Sub\n\n''#  save between postbacks the custom Where IN clause\nPublic Property WhereClause() As String\n    Get\n        Return ViewState(\"WhereClause\")\n    End Get\n    Set(ByVal value As String)\n        ViewState.Add(\"WhereClause\", value)\n    End Set\nEnd Property\n\nPrivate Sub CustomersEntityDataSource_Updating(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.EntityDataSourceChangingEventArgs) Handles CustomersEntityDataSource.Updating\n    Dim c = CType(e.Entity, EntityFrameworkTest.Customer)\n    If c.Title.Length = 0 Then\n        Response.Write(\"Title is empty string, so will save like this!\")\n    End If\nEnd Sub\n\nEnd Class\n\n&lt;%@ Page Language=\"vb\" AutoEventWireup=\"false\" CodeBehind=\"EntityDataSourceWhereInClause.aspx.vb\"\nInherits=\"EntityFrameworkTest.EntityDataSourceWhereInClause\" %&gt;\n\n\n&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n&lt;head runat=\"server\"&gt;\n    &lt;title&gt;&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;form id=\"form1\" runat=\"server\"&gt;\n\n&lt;%''# filter control %&gt;\n&lt;div&gt;\n    &lt;asp:EntityDataSource ID=\"CustomerIdListEntityDataSource\" runat=\"server\" ConnectionString=\"name=AdventureWorksLT2008Entities\"\n        DefaultContainerName=\"AdventureWorksLT2008Entities\" EnableFlattening=\"False\"\n        EntitySetName=\"Customers\" Select=\"it.[CustomerID]\" OrderBy=\"it.[CustomerID]\"&gt;\n    &lt;/asp:EntityDataSource&gt;\n    &lt;asp:CheckBoxList ID=\"CustomerIdCheckBoxList\" runat=\"server\" DataSourceID=\"CustomerIdListEntityDataSource\"\n        DataTextField=\"CustomerID\" DataValueField=\"CustomerID\" RepeatDirection=\"Horizontal\"&gt;\n    &lt;/asp:CheckBoxList&gt;\n    &lt;asp:Button ID=\"cmdFilterCustomers\" runat=\"server\" Text=\"Apply Filter\" /&gt;\n&lt;/div&gt;\n\n&lt;%  \n    ''# you get this error passing in CSV in the where clause\n    ''# The element type 'Edm.Int32' and the CollectionType 'Transient.collection[Edm.String(Nullable=True,DefaultValue=,MaxLength=,Unicode=,FixedLength=)]' are not compatible. The IN expression only supports entity, primitive, and reference types.  Near WHERE predicate, line 6, column 15. \n    ''# so have coded it manually in code-behind Where=\"it.CustomerID IN {@OrderIdList}\"\n%&gt;\n&lt;asp:EntityDataSource ID=\"CustomersEntityDataSource\" runat=\"server\" ConnectionString=\"name=AdventureWorksLT2008Entities\"\n    DefaultContainerName=\"AdventureWorksLT2008Entities\" EnableFlattening=\"False\"\n    EnableUpdate=\"True\" EntitySetName=\"Customers\"\n    AutoGenerateOrderByClause=\"false\"&gt;\n&lt;/asp:EntityDataSource&gt;\n&lt;%''# updating works with DropDownLists until the Where clause is set in code %&gt;\n&lt;asp:FormView ID=\"FormView1\" runat=\"server\" AllowPaging=\"True\" CellPadding=\"4\" DataKeyNames=\"CustomerID\"\n    DataSourceID=\"CustomersEntityDataSource\" ForeColor=\"#333333\"&gt;\n    &lt;EditItemTemplate&gt;\n        CustomerID:\n        &lt;asp:Label ID=\"CustomerIDLabel1\" runat=\"server\" Text='&lt;%# Eval(\"CustomerID\") %&gt;' /&gt;\n        &lt;br /&gt;\n        NameStyle:\n        &lt;asp:CheckBox ID=\"NameStyleCheckBox\" runat=\"server\" Checked='&lt;%# Bind(\"NameStyle\") %&gt;' /&gt;\n        &lt;br /&gt;\n        Title:\n        &lt;%''# the SelectedValue is not Bound to the EF object if the Where clause is updated in code-behind %&gt;\n        &lt;asp:DropDownList ID=\"ddlTitleBound\" runat=\"server\" DataSourceID=\"TitleEntityDataSource\"\n            DataTextField=\"Title\" DataValueField=\"Title\" AutoPostBack=\"false\" AppendDataBoundItems=\"true\"\n            SelectedValue='&lt;%# Bind(\"Title\") %&gt;'&gt;\n        &lt;/asp:DropDownList&gt;\n        &lt;asp:EntityDataSource ID=\"TitleEntityDataSource\" runat=\"server\" ConnectionString=\"name=AdventureWorksLT2008Entities\"\n            DefaultContainerName=\"AdventureWorksLT2008Entities\" EnableFlattening=\"False\"\n            EntitySetName=\"Customers\" Select=\"it.[Title]\" GroupBy=\"it.[Title]\" ViewStateMode=\"Enabled\"&gt;\n        &lt;/asp:EntityDataSource&gt;\n        &lt;br /&gt;\n        FirstName:\n        &lt;asp:TextBox ID=\"FirstNameTextBox\" runat=\"server\" Text='&lt;%# Bind(\"FirstName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        MiddleName:\n        &lt;asp:TextBox ID=\"MiddleNameTextBox\" runat=\"server\" Text='&lt;%# Bind(\"MiddleName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        LastName:\n        &lt;asp:TextBox ID=\"LastNameTextBox\" runat=\"server\" Text='&lt;%# Bind(\"LastName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        Suffix:\n        &lt;asp:TextBox ID=\"SuffixTextBox\" runat=\"server\" Text='&lt;%# Bind(\"Suffix\") %&gt;' /&gt;\n        &lt;br /&gt;\n        CompanyName:\n        &lt;asp:TextBox ID=\"CompanyNameTextBox\" runat=\"server\" Text='&lt;%# Bind(\"CompanyName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        SalesPerson:\n        &lt;asp:TextBox ID=\"SalesPersonTextBox\" runat=\"server\" Text='&lt;%# Bind(\"SalesPerson\") %&gt;' /&gt;\n        &lt;br /&gt;\n        EmailAddress:\n        &lt;asp:TextBox ID=\"EmailAddressTextBox\" runat=\"server\" Text='&lt;%# Bind(\"EmailAddress\") %&gt;' /&gt;\n        &lt;br /&gt;\n        Phone:\n        &lt;asp:TextBox ID=\"PhoneTextBox\" runat=\"server\" Text='&lt;%# Bind(\"Phone\") %&gt;' /&gt;\n        &lt;br /&gt;\n        PasswordHash:\n        &lt;asp:TextBox ID=\"PasswordHashTextBox\" runat=\"server\" Text='&lt;%# Bind(\"PasswordHash\") %&gt;' /&gt;\n        &lt;br /&gt;\n        PasswordSalt:\n        &lt;asp:TextBox ID=\"PasswordSaltTextBox\" runat=\"server\" Text='&lt;%# Bind(\"PasswordSalt\") %&gt;' /&gt;\n        &lt;br /&gt;\n        rowguid:\n        &lt;asp:TextBox ID=\"rowguidTextBox\" runat=\"server\" Text='&lt;%# Bind(\"rowguid\") %&gt;' /&gt;\n        &lt;br /&gt;\n        ModifiedDate:\n        &lt;asp:TextBox ID=\"ModifiedDateTextBox\" runat=\"server\" Text='&lt;%# Bind(\"ModifiedDate\") %&gt;' /&gt;\n        &lt;br /&gt;\n        &lt;asp:LinkButton ID=\"UpdateButton\" runat=\"server\" CausesValidation=\"True\" CommandName=\"Update\"\n            Text=\"Update\" /&gt;\n        &amp;nbsp;&lt;asp:LinkButton ID=\"UpdateCancelButton\" runat=\"server\" CausesValidation=\"False\"\n            CommandName=\"Cancel\" Text=\"Cancel\" /&gt;\n    &lt;/EditItemTemplate&gt;\n    &lt;EditRowStyle BackColor=\"#999999\" /&gt;\n    &lt;FooterStyle BackColor=\"#5D7B9D\" Font-Bold=\"True\" ForeColor=\"White\" /&gt;\n    &lt;HeaderStyle BackColor=\"#5D7B9D\" Font-Bold=\"True\" ForeColor=\"White\" /&gt;\n    &lt;ItemTemplate&gt;\n        CustomerID:\n        &lt;asp:Label ID=\"CustomerIDLabel\" runat=\"server\" Text='&lt;%# Eval(\"CustomerID\") %&gt;' /&gt;\n        &lt;br /&gt;\n        NameStyle:\n        &lt;asp:CheckBox ID=\"NameStyleCheckBox\" runat=\"server\" Checked='&lt;%# Bind(\"NameStyle\") %&gt;'\n            Enabled=\"false\" /&gt;\n        &lt;br /&gt;\n        Title:\n        &lt;asp:Label ID=\"TitleLabel\" runat=\"server\" Text='&lt;%# Bind(\"Title\") %&gt;' /&gt;\n        &lt;br /&gt;\n        FirstName:\n        &lt;asp:Label ID=\"FirstNameLabel\" runat=\"server\" Text='&lt;%# Bind(\"FirstName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        MiddleName:\n        &lt;asp:Label ID=\"MiddleNameLabel\" runat=\"server\" Text='&lt;%# Bind(\"MiddleName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        LastName:\n        &lt;asp:Label ID=\"LastNameLabel\" runat=\"server\" Text='&lt;%# Bind(\"LastName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        Suffix:\n        &lt;asp:Label ID=\"SuffixLabel\" runat=\"server\" Text='&lt;%# Bind(\"Suffix\") %&gt;' /&gt;\n        &lt;br /&gt;\n        CompanyName:\n        &lt;asp:Label ID=\"CompanyNameLabel\" runat=\"server\" Text='&lt;%# Bind(\"CompanyName\") %&gt;' /&gt;\n        &lt;br /&gt;\n        SalesPerson:\n        &lt;asp:Label ID=\"SalesPersonLabel\" runat=\"server\" Text='&lt;%# Bind(\"SalesPerson\") %&gt;' /&gt;\n        &lt;br /&gt;\n        EmailAddress:\n        &lt;asp:Label ID=\"EmailAddressLabel\" runat=\"server\" Text='&lt;%# Bind(\"EmailAddress\") %&gt;' /&gt;\n        &lt;br /&gt;\n        Phone:\n        &lt;asp:Label ID=\"PhoneLabel\" runat=\"server\" Text='&lt;%# Bind(\"Phone\") %&gt;' /&gt;\n        &lt;br /&gt;\n        PasswordHash:\n        &lt;asp:Label ID=\"PasswordHashLabel\" runat=\"server\" Text='&lt;%# Bind(\"PasswordHash\") %&gt;' /&gt;\n        &lt;br /&gt;\n        PasswordSalt:\n        &lt;asp:Label ID=\"PasswordSaltLabel\" runat=\"server\" Text='&lt;%# Bind(\"PasswordSalt\") %&gt;' /&gt;\n        &lt;br /&gt;\n        rowguid:\n        &lt;asp:Label ID=\"rowguidLabel\" runat=\"server\" Text='&lt;%# Bind(\"rowguid\") %&gt;' /&gt;\n        &lt;br /&gt;\n        ModifiedDate:\n        &lt;asp:Label ID=\"ModifiedDateLabel\" runat=\"server\" Text='&lt;%# Bind(\"ModifiedDate\") %&gt;' /&gt;\n        &lt;br /&gt;\n        &lt;asp:LinkButton ID=\"EditButton\" runat=\"server\" CausesValidation=\"False\" CommandName=\"Edit\"\n            Text=\"Edit\" /&gt;\n    &lt;/ItemTemplate&gt;\n    &lt;PagerSettings Position=\"Top\" /&gt;\n    &lt;PagerStyle BackColor=\"#284775\" ForeColor=\"White\" HorizontalAlign=\"Center\" /&gt;\n    &lt;RowStyle BackColor=\"#F7F6F3\" ForeColor=\"#333333\" /&gt;\n&lt;/asp:FormView&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>\n</p>\n"},{"tags":["c#","entity-framework","entity-relationship"],"answer_count":0,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":140,"score":5,"question_id":13086922,"title":"Parent object is in EntityState.Unchanged, but it still inserted in the Database","body":"<p>I have a simple snowflake schema out of which I generated my Entity Framework model.<br>\nThe problem is that I am trying to map a child entity to an <strong><em>existing parent and/or grandparent</em></strong> entity, but it still inserts it.  </p>\n\n<p><em>I followed this:</em>  </p>\n\n<blockquote>\n  <p><a href=\"http://stackoverflow.com/questions/5416323/insert-new-object-with-existing-object\"> Insert new object with existing object</a><br>\n  <a href=\"http://stackoverflow.com/questions/7884887/prevent-entity-framework-to-insert-values-for-navigational-properties\">Prevent Entity Framework to Insert Values for Navigational Properties</a></p>\n</blockquote>\n\n<p>The interesting thing is that even though the EntityState of the parent entities is \"Unchanged\" the Entity Framework still tries to insert it.</p>\n\n<hr>\n\n<h2>The Schema</h2>\n\n<p><img src=\"http://i.stack.imgur.com/RZDIs.jpg\" alt=\"enter image description here\"></p>\n\n<hr>\n\n<h2>CarRepository.Save() method</h2>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public void Save(Car car)\n    {\n        using (DBContext context = new DBContext())\n        {\n            // No need to save if it already exists\n            if ( context.Cars.FirstOrDefault(x =&gt; x.RegistrationNumber == car.RegistrationNumber) != null)\n            {\n                return;\n            }\n            else\n            {\n                // Check if the parent POCOs exist in the DB. \n                Model existingModel = context.Models.FirstOrDefault(x =&gt; x.Name == car.Model.Name);\n                Manufacturer existingManufacturer = context.Manufacturers.FirstOrDefault(x=&gt; x.Name == car.Model.Manufacturer.Name)\n                Trader existingTrader = context.Traders.FirstOrDefault(x=&gt; x.Name == car.Trader.Name)\n                TraderCompany existingTraderCompany = context.TraderCompanys.FirstOrDefault(x=&gt; x.Name == car.Trader.TraderCompany.Name)\n\n                context.ContextOptions.LazyLoadingEnabled = false;\n\n                //Attach to the context if existing in the DB, i.e mark the existing POCOs not to be added the DB\n                if (existingModel != null)\n                {\n                    car.Model = existingModel;\n                    Assert.IsTrue(context.ObjectStateManager.GetObjectStateEntry(car.Model).State == EntityState.Unchanged);\n                }\n\n                if (existingManufacturer != null)\n                {\n                    car.Model.Manufacturer = existingManufacturer;\n                    Assert.IsTrue(context.ObjectStateManager.GetObjectStateEntry(car.Model.Manufacturer).State == EntityState.Unchanged);\n                }\n\n                if (existingTrader != null)\n                {\n                    car.Trader = existingTrader;\n                    Assert.IsTrue(context.ObjectStateManager.GetObjectStateEntry(car.Trader).State == EntityState.Unchanged);\n                }\n\n                if (existingTraderCompany != null)\n                {\n                    car.Trader.TraderCompany = existingTraderCompany;\n                    Assert.IsTrue(context.ObjectStateManager.GetObjectStateEntry(car.Trader.TraderCompany).State == EntityState.Unchanged);\n                }\n\n                //Mark the Car for Addition to the DB\n                context.Cars.AddObject(car);\n                context.ObjectStateManager.ChangeObjectState(car, EntityState.Added);\n\n\n                //If the POCOs do not exist in the DB mark them for addition\n                if (existingModel == null)\n                {\n                   context.ObjectStateManager.ChangeObjectState(car.Model,EntityState.Added);\n                }\n\n                if (existingManufacturer == null)\n                {\n                    context.ObjectStateManager.ChangeObjectState(car.Model.Manufacturer,EntityState.Added);\n                }\n\n                if (existingTrader == null)\n                {\n                    context.ObjectStateManager.ChangeObjectState(car.Trader,EntityState.Added);\n                }\n\n                if (existingTraderCompany == null)\n                {\n                    context.ObjectStateManager.ChangeObjectState(car.Trader.TraderCompany,EntityState.Added);\n                }\n\n                context.SaveChanges();\n\n            }\n        }\n    }\n</code></pre>\n\n<hr>\n\n<h2>Edit:</h2>\n\n<p>After a few days of tinkering I managed to come up with a <strong><em>workaround</em></strong> which worked  for me.  </p>\n\n<p>It seems that the Car that is being passed to the CarRepository.Save() has some kind of <strong><em>internal context</em></strong> which is <strong><em>undetectable</em></strong>... That being so, it is <strong><em>impossible to detach it from that context/s</em></strong> and add it to the one in CarRepository.Save(). In order to actually add it to this context <em>I deep/lazy copy the Car object and its navigation properties</em>, if existing. </p>\n\n<hr>\n\n<h2>The workaround</h2>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public void Save(Car car)\n{\n    using (DBContext context = new DBContext())\n    {\n        // No need to save if it already exists\n        if ( context.Cars\n                    .Any(x =&gt; x.RegistrationNumber == car.RegistrationNumber))\n        {\n            return;\n        }\n        else\n        {\n            //Assign scalar properties to the deep copy\n            Car carToBeSaved = new Car \n            {\n                carToBeSaved.RegistrationNumber = car.RegistrationNumber,\n                carToBeSaved.Price = car.Price\n            }\n\n\n            //Car -&gt; Trader -&gt; ...\n            if(car.Trader != null)\n            {   \n                Trader existingTrader = \n                    context.Traders\n                           .FirstOrDefault(x =&gt; x.Name == car.Trader.Name);\n\n                //If exists in DB assign, if not deep copy\n                carToBeSaved.Trader = existingTrader ??\n                    new Trader\n                    {\n                        Name = car.Trader.Name,\n                        JobTitle = car.Trader.JobTitle\n                    }\n\n                //Car -&gt; Trader -&gt; TraderCompany\n                if(car.Trader.TraderCompany != null)\n                {\n                    TraderCompany existingTraderCompany = \n                        context.TradersCompanys\n                               .FirstOrDefault(x =&gt; x.Name == car.Trader\n                                                                 .TraderCompany\n                                                                 .Name);\n\n                    //If exists in DB assign, if not deep copy  \n                    carToBeSaved.Trader.TraderCompany = existingTraderCompany ??\n                        new TraderCompany\n                        {\n                            Name = car.Trader.TraderCompany.Name,\n                            Address = car.Trader.TraderCompany.Address,\n                            PhoneNumber = car.Trader.TraderCompany.PhoneNumber\n                        }\n                }\n            }\n\n            //Car -&gt; Model -&gt; ...\n            if(car.Model != null)\n            {   \n                Model existingModel = \n                    context.Models\n                           .FirstOrDefault(x =&gt; x.Name == car.Model.Name);\n\n                //If exists in DB assign, if not deep copy\n                carToBeSaved.Model = existingModel ??\n                    new Model\n                    {\n                        Name = car.Model.Name\n                    }\n\n                //Car -&gt; Model -&gt; Manufacturer\n                if(car.Model.Manufacturer != null)\n                {\n                    Manufacturer existingManufacturer = \n                        context.Manufacturers\n                               .FirstOrDefault(x =&gt; x.Name == car.Model\n                                                                 .Manufacturer\n                                                                 .Name);\n\n                    //If exists in DB assign, if not deep copy\n                    carToBeSaved.Model.Manufacturer = existingManufacturer ??\n                    new Manufacturer\n                        {\n                            Name = car.Model.Manufacturer.Name\n                        }\n                }\n            }\n\n            //Mark the Car for Addition to the DB\n            context.Cars.AddObject(car);\n            context.SaveChanges();\n\n        }\n    }\n}\n</code></pre>\n\n<p><em>If someone have any thoughts on this, please share.</em></p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","database","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13191517,"title":"Accessing properties of second table via element of first table","body":"<p>I have two tables which are in a relationship. They are called tblX and tblY.</p>\n\n<pre><code>var x = (from v in db.tblX select v).First();\n</code></pre>\n\n<p>Now x has these properties:</p>\n\n<pre><code>x.name\nx.id\nx.tblY\n</code></pre>\n\n<p>tblY has these properties: idY, nameY.</p>\n\n<p>After I use the linq statement above, I can get to idY without making a join. I can access x.tblY.idY and x.tblY.nameY. Is it ok if I access them like this? Is it a good programming practise?</p>\n"},{"tags":["c#","database","linq","entity-framework","types"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13191320,"title":"The property 'x' on 'tblX' could not be set to a 'null' value. You must set this property to a non-null value of type 'Int16'","body":"<pre><code>List&lt;tblX&gt; messages = (from x in db.tblX where x.msg_id == id_id \n                           || x.name == firstName  select x).ToList();\n</code></pre>\n\n<p>I get the error: </p>\n\n<blockquote>\n  <p>The property 'x' on 'tblX' could not be set to a 'null' value. You must set this property to a non-null value of type 'Int16'.</p>\n</blockquote>\n\n<p>I have a property msg_blocked in db, which is nullable and integer. I know that I need to make a conversion, but I don't use it or need it anywhere in my linq.</p>\n"},{"tags":["entity-framework","unit-testing","moq"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13132601,"title":"Unit test Entity Framework using moq","body":"<p>I'm using entity framework and trying to unit test my data services which are using EF.\nI'm not using repository and unit of work patterns.\nI tried the following approach to mock the context and DbSet:</p>\n\n<pre><code>private static Mock&lt;IEFModel&gt; context;\nprivate static Mock&lt;IDbSet&lt;CountryCode&gt;&gt; idbSet;\n\n    [ClassInitialize]\n    public static void Initialize(TestContext testContext)\n    {\n        context = new Mock&lt;IEFModel&gt;();\n\n        idbSet = new Mock&lt;IDbSet&lt;CountryCode&gt;&gt;();\n\n        context.Setup(c =&gt; c.CountryCodes).Returns(idbSet.Object);\n\n    }\n</code></pre>\n\n<p>I get null \"Object reference not set to an instance of an object\" error for idbSet \"Local\".\nIs there any way to mock idbSet like this?\nThanks</p>\n"},{"tags":[".net","entity-framework","enums","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13188857,"title":"EF5 code first enum support - define the enum inside the entity","body":"<p>Funny question..</p>\n\n<p>I have a type that has a Status field. For my convenience and order of things I want to define the enum for this status inside the Entity type:</p>\n\n<pre><code>public class User\n{\n  public enum Statuses\n  {\n     Active,\n     Suspended\n  }\n\n  public int ID { get; set; }\n  public Statuses Status { get; set; }\n}\n</code></pre>\n\n<p>For some reason the Status property isn't mapped to the database.</p>\n\n<p>Now the funny bit - if I take the enum definition out of User then it is mapped to the DB!</p>\n\n<p>I know that the quick answer would be to leave it outside the class, but that would require me to give the enum a longer name UserStatuses or something like that, as now it isn't scoped inside User.</p>\n\n<p>Did anyone encounter that issue? Is there a solution before I start compromising?</p>\n\n<p>Thanks!</p>\n"},{"tags":["database","entity-framework","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":13166823,"title":"The DELETE statement conflicted with the REFERENCE constraint \"FK_EntityAEntityB\"","body":"<p>I saw the answers about this topic but not exactly such as mine.</p>\n\n<p>I created a db schema by using EF1 in designer.\nI added relation <strong>One Or Zero To Many</strong> between 2 tables (<strong>EntityA</strong> and <strong>EntityB</strong>).\nNext I added one record to table EntityA and one record to EntityB which has id to EntityA record.\nAs I see in design mode (in MS SMS) that field EntityA_id (in table EntityB) is set to ALLOW NULL,\nI tried to delete the record in table EntityA.</p>\n\n<p>I expected that the record would be deleted and the field EntityA_id in table EntityB would be automatically set to NULL.\nUnfortunately I got exception: <strong>The DELETE statement conflicted with the REFERENCE constraint \"FK_EntityAEntityB\"</strong></p>\n\n<p>Why does the exception throw if the field with foreign key is set to ALLOW NULL?</p>\n"},{"tags":["c#","asp.net","linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":56,"score":3,"question_id":13189295,"title":"LINQ query to select best sellers","body":"<p>Could a smart guy help me write a LINQ query to get the best selling products, where I have these 2 tables/classes in the <a href=\"http://msdn.microsoft.com/en-us/data/ef.aspx\" rel=\"nofollow\">Entity Framework</a> model:</p>\n\n<pre><code>Orders (OrderedItems)\nOrderedItem (Product, Qty)\n</code></pre>\n\n<p>eg. (this obviously doesn't work)</p>\n\n<pre><code>Orders.OrderByDescending(o =&gt; Sum(o.OrderedItems.Qty))\n      .Select(o =&gt; o.OrderedItems.Product)\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","ado.net"],"answer_count":22,"favorite_count":37,"up_vote_count":166,"down_vote_count":0,"view_count":73065,"score":166,"question_id":689355,"title":"MetadataException: Unable to load the specified metadata resource","body":"<p>All of a sudden I keep getting a MetadataException on instantiating my generated ObjectContext class. The connectionstring in App.Config looks correct - hasn't changed since last it worked - and I've tried regenerating a new model (edmx-file) from the underlying database with no change.</p>\n\n<p>Anyone have any... ideas?</p>\n\n<p>Edit: I haven't changed any properties, I haven't changed the name of any output assemblies, I haven't tried to embed the EDMX in the assembly. I've merely waited 10 hours from leaving work until I got back. And then it wasn't working anymore.</p>\n\n<p>I've tried recreating the EDMX. I've tried recreating the project. I've even tried recreating the database, from scratch. No luck, whatsoever.</p>\n\n<p>I'm truly stumped.</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13186733,"title":"Create an complex helper with Ajax and model","body":"<p>I wish creating a mvc helper that return an Ajax Search, and the parameters that I pass is an string representing the table that i want searching. The helper goes opening an modal with the values and an dropDown with options for filtering the search. I have some questions about this:</p>\n\n<ol>\n<li><p>Is this possible?</p></li>\n<li><p>If possible, how i get the table based in an string? Example, the string \"people\" returning the People table. Fact, am using Entity Framework.</p></li>\n<li><p>I need create an dropDown where the  table columns are options for search. The user can pass an string and the helper needing adapting with these parameters. How i get the table columns? the names...</p></li>\n</ol>\n"},{"tags":["c#","sql","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":62,"score":0,"question_id":13185818,"title":"Using LINQ, How do I return objects from a GroupBy clause?","body":"<p>Thanks for looking!</p>\n\n<h1>Background</h1>\n\n<p>Within my C# code, I am calling a stored procedure from a MSSQL database that returns a history of orders that a user has made.  I use the Entity Framework for this.  Here is the code:</p>\n\n<pre><code>var db = new CustomerEntities();\nreturn db.GetOrderHistoryByUserId(id);\n</code></pre>\n\n<p>The output of this stored procedure is a list of orders with multiple records having the same <code>OrderNumber</code> because there may have been multiple products in a given order.  So I modified my code to look like this:</p>\n\n<pre><code>var db = new CustomerEntities();\nreturn db.GetOrderHistoryByUserId(id).GroupBy(p =&gt; p.OrderNumber);\n</code></pre>\n\n<p>I was hoping to now have a list of <code>Order</code> objects with nested <code>Product</code> objects, but instead this code essentially produced the same response as before.</p>\n\n<p>Ultimately, I just want to convert this query into a JSON response that looks something like this:</p>\n\n<pre><code>Orders : [\n{\nOrderNumber : 1,\nOrderTotal: $500,\nProducts: [\n  {ProductSku : 11111, ProductPrice: $200},\n  {ProductSku : 22222, ProductPrice: $300}\n]\n}\n]\n</code></pre>\n\n<p>I am using MVC 4 to aid in producing the JSON output, so I am already clear on that part, I just need to know how to consume the results of the stored procedure in a manner that produces an array of objects with the desired structure.</p>\n\n<h1>Question</h1>\n\n<p>Is there a way of producing this desired object structure with the original LINQ call to the stored procedure, or am I going to need to iterate the results of the stored procedure and construct a new object?</p>\n\n<p>Thanks for your help!</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":133,"score":3,"question_id":13148263,"title":"Entity Framework DbSet.Find throws exception","body":"<p>I'm following a very basic example of code-first Entity Framework (version 4.1) in ASP.NET MVC 4 (using the EBuy example in O'Reilly's Programming ASP.NET MVC 4). I've searched for solutions to this and so far have drawn blank. The basic problem is this code in my controller:</p>\n\n<pre><code>public ActionResult Details(long id)\n    {\n        using (var db = new EbuyDataContext())\n        {\n            var rep = db.Auctions;\n            var auction = rep.Find(id);\n            return View(auction);\n        }\n    }\n</code></pre>\n\n<p>throws an <strong>ArgumentNullException Value cannot be null. Parameter name: key.</strong> when it hits the rep.Find(id) call. Interestingly, when it breaks into the code, the db.Auctions property has the 'Expanding the Results View will enumerate the IEnumerable' and if clicked, it shows my expected two entities which have just been retrieved from the database. The rep object however, does have 'Children could not be evaluated' when it is inspected.</p>\n\n<p>Quite similar 'Create' code like this works okay:</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Create(Auction auction)\n    {\n        var db = new EbuyDataContext();\n        db.Auctions.Add(auction);\n        db.SaveChanges();\n\n        return View(auction);\n    }\n</code></pre>\n\n<p>This is my db context:</p>\n\n<pre><code>namespace Ebuy.DataAccess\n{\n    public class EbuyDataContext : DbContext\n    {\n        public DbSet&lt;Auction&gt; Auctions { get; set; } \n    }\n}\n</code></pre>\n\n<p>and this is my model class:</p>\n\n<pre><code>namespace Ebuy.DomainModel\n{\n    public class Auction\n    {\n        public long Id { get; set; }\n        public string Title { get; set; }\n        public string Description { get; set; }\n        public decimal StartPrice { get; set; }\n        public decimal CurrentPrice { get; set; }\n        public DateTime StartTime { get; set; }\n        public DateTime EndTime { get; set; }\n    }\n}\n</code></pre>\n\n<p>I did find one reference which talked about the POCO's and the dbcontext being in different namespaces or assemblies.\nDoes anyone know why the Create code works and the Find doesn't?</p>\n\n<p><strong>Edit:</strong> The stacktrace is:</p>\n\n<blockquote>\n  <p>System.ArgumentNullException was unhandled by user code<br>\n  Message=Value cannot be null. Parameter name: key   Source=mscorlib<br>\n  ParamName=key   StackTrace:\n         at System.Collections.Generic.Dictionary<code>2.FindEntry(TKey key)\n         at System.Collections.Generic.Dictionary</code>2.ContainsKey(TKey key)\n         at System.Data.Entity.Internal.InternalContext.TryUpdateEntitySetMappingsForType(Type\n  entityType)\n         at System.Data.Entity.Internal.InternalContext.IsEntityTypeMapped(Type\n  entityType)\n         at System.Data.Entity.Internal.Linq.InternalSet<code>1.Find(Object[] keyValues)\n         at System.Data.Entity.DbSet</code>1.Find(Object[] keyValues)\n         at Ebuy.Website.Controllers.AuctionsController.Details(Int64 id) in C:\\Users\\John\\Documents\\Visual Studio\n  2010\\Projects\\Ebuy.Website\\Ebuy.Website\\Controllers\\AuctionsController.cs:line\n  26\n         at lambda_method(Closure , ControllerBase , Object[] )\n         at System.Web.Mvc.ActionMethodDispatcher.Execute(ControllerBase controller, Object[] parameters)\n         at System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext\n  controllerContext, IDictionary<code>2 parameters)\n         at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext\n  controllerContext, ActionDescriptor actionDescriptor, IDictionary</code>2\n  parameters)\n         at System.Web.Mvc.Async.AsyncControllerActionInvoker.&lt;>c_<em>DisplayClass42.b</em>_41()\n         at System.Web.Mvc.Async.AsyncResultWrapper.&lt;>c_<em>DisplayClass8<code>1.&lt;BeginSynchronous&gt;b__7(IAsyncResult\n  _)\n         at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult</code>1.End()\n         at System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeActionMethod(IAsyncResult\n  asyncResult)\n         at System.Web.Mvc.Async.AsyncControllerActionInvoker.&lt;>c</em>_DisplayClass37.&lt;>c_<em>DisplayClass39.b</em>_33()\n         at System.Web.Mvc.Async.AsyncControllerActionInvoker.&lt;>c_<em>DisplayClass4f.b</em>_49()\n  InnerException:</p>\n</blockquote>\n\n<p><strong>Edit 2:</strong> The table does have the Id column as the primary key.\n<strong>Update:</strong> Based on nemesv's comment, I checked the versions. I'm using .NET Framework v 4.0. The MVC Web app, when created, used Nuget to get EF version 5.0 (although the actual reference is to EF runtime 4.0.30319 v4.4.0.0). I added the DataAccess project and gave it a reference to a <strong>different</strong> EF (runtime 4.0.30319 v4.1.0.0). I've changed the DataAccess project's reference to the same EF as the Web app and now I get a different exception: InvalidOperationException The context cannot be used while the model is being created. This appears to be an issue when using EF across an N-tier application, so I'll follow up this thread and report back.</p>\n\n<p><strong>Fix:</strong> I read some stuff about LazyLoading settings in EF and also how loading takes place when you access a property of an entity. As I'm not really accessing an entities property before I try and find one and thinking that perhaps LazyLoading is the default in EF 5.0, I added a default constructor to my EbuyDataContext class as follows:</p>\n\n<pre><code>public class EbuyDataContext : DbContext\n{\n    public EbuyDataContext()\n    {\n        //Configuration.LazyLoadingEnabled = false;\n    }\n\n    public DbSet&lt;Auction&gt; Auctions { get; set; } \n}\n</code></pre>\n\n<p>I also set the LazyLoadingEnabled parameter to false and then ran it and Voila! Success!\nHowever, I thought I would double-check this, so I commented out the LazyLoadingEnabled parameter, did a clean rebuild and it still worked. I commented out the default constructor and now it still works - did something else change when I ran it with the LazyLoadingEnabled parameter in place?</p>\n"},{"tags":["linq","entity-framework","sql-server-ce"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13169788,"title":"DateTime logic in LINQ for SQL Server CE","body":"<p>My object 'Job' has <code>LastTimeFinishedRunning</code> which is <code>DateTime</code> and <code>RunIntervalMinutes</code> which is an <code>int</code>. I need to add them together and compare against current time.</p>\n\n<p>Something like this:</p>\n\n<pre><code>Job jobToRun = ctx.Jobs.Where\n(job =&gt; DateTime.Now &gt; Job.LastTimeFinishedRunning.Add(TimeSpan.FromMinutes(job.RunIntervalMinutes))).FirstOrDefault();\n</code></pre>\n\n<p>Well, the <code>.Add()</code> doesn't work of course....</p>\n\n<p>neither works this:</p>\n\n<pre><code>DateTime.Now &gt; EntityFunctions.AddMinutes(job.LastTimeFinishedRunning, job.RunIntervalMinutes)\n</code></pre>\n\n<p>or this:</p>\n\n<pre><code>DateTime.Now &gt; System.Data.Objects.SqlClient.SqlFunctions.DateAdd(\"minute\", job.RunIntervalMinutes, job.LastTimeFinishedRunning)\n</code></pre>\n\n<p>...because it's SQL Server CE provider</p>\n\n<p>Any suggestions? Thx.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>I guess my only option here is to store ticks in <code>LastTimeFinishedRunning</code> by switching it from <code>DateTime</code> to <code>long</code> in DB. So the code would look something like this:</p>\n\n<pre><code>long ticks = DateTime.Now.Ticks;\nJob jobToRun = ctx.Jobs.Where\n(job =&gt; ticks &gt; Job.LastTimeFinishedRunning + job.RunIntervalMinutes * 1000 * 10000).FirstOrDefault();\n</code></pre>\n"},{"tags":["asp.net-mvc-3","entity-framework","unit-of-work","dbcontext","objectcontext"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2542,"score":1,"question_id":9176967,"title":"ObjectContext vs DbContext","body":"<p>I've DbContext class from there I have an implementation of Generic Repositories and unit of work in a such way that leads to use ObjectContext, I followed this link in general </p>\n\n<p><a href=\"http://elegantcode.com/2009/12/15/entity-framework-ef4-generic-repository-and-unit-of-work-prototype/\" rel=\"nofollow\">http://elegantcode.com/2009/12/15/entity-framework-ef4-generic-repository-and-unit-of-work-prototype/</a></p>\n\n<p>I've read lot of posts related to the ObjectContext vs DBContext which somewhat makes sense. But I've no idea about my current implementation. just wondering if its an anti-pattern or I'm playing  safe?</p>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13183398,"title":"Entity Framework one-to-many mapping","body":"<p>This is probably just some simple beginner's mistake, but I just can't seem to figure it out.</p>\n\n<p>I'm just trying to get started with entity framework (ef 5.0, .net 4.5), been rolling all my own sql statements until now. I'm trying to work with an existing database and EF code first, with two simple classes that have a one to many relationship: clips and clip_ratings (there can be zero or many ratings for each clip). the relevant parts of the classes are:</p>\n\n<pre><code>public class clip\n{\n    public clip()\n    {\n        this.Ratings = new List&lt;clip_ratings&gt;();\n    }\n\n    public virtual ICollection&lt;clip_ratings&gt; Ratings { get; set; }\n\n    public int clip_id { get; set; }\n    public Nullable&lt;int&gt; clip_type { get; set; }\n    // ...\n }\n\npublic class clip_ratings\n{\n    public int cr_id { get; set; }\n    public int cr_clip_id { get; set; }\n    // ...\n\n    [ForeignKey(\"cr_clip_id\")]\n    public clip Clip { get; set; }\n}\n</code></pre>\n\n<p>Now I'm trying to read some data from the DB:</p>\n\n<pre><code>           var query = from b in db.clips\n                        orderby b.clip_id where b.Ratings.Count &gt; 1\n                        select b;\n\n            foreach (var item in query)\n            {\n                Console.WriteLine(item.Ratings.Count +\" | \"+item.clip_linktext);\n            }\n</code></pre>\n\n<p>The query returns the correct resultset from the DB, however it errors on the item.Ratings.Count. When I just output item.clip_linktext all is fine, but with the item.Ratings.Count I get the following error:</p>\n\n<blockquote>\n  <p>More than one item in the metadata collection match the identity 'clip_ratings'.</p>\n</blockquote>\n\n<p>I've tried following all the MS EF tutorials and reading up on some more posts, but just can't seem to figure it out. Hope somebody here can help me along on this (and that it is easy to fix ;))</p>\n\n<p>update: adding the classMap.cs sources:</p>\n\n<pre><code>public class clipMap : EntityTypeConfiguration&lt;clip&gt;\n{\n    public clipMap()\n    {\n        // Primary Key\n        this.HasKey(t =&gt; t.clip_id);\n        // ...\n\n\n        // Table &amp; Column Mappings\n        this.ToTable(\"clips\");\n        this.Property(t =&gt; t.clip_id).HasColumnName(\"clip_id\");\n        this.Property(t =&gt; t.clip_type).HasColumnName(\"clip_type\");\n        ...\n     }\n }\n\npublic class clip_ratingsMap : EntityTypeConfiguration&lt;clip_ratings&gt;\n{\n    public clip_ratingsMap()\n    {\n        // Primary Key\n        this.HasKey(t =&gt; t.cr_id);\n        // Table &amp; Column Mappings\n        this.ToTable(\"clip_ratings\");\n        this.Property(t =&gt; t.cr_id).HasColumnName(\"cr_id\");\n        this.Property(t =&gt; t.cr_clip_id).HasColumnName(\"cr_clip_id\");\n        // ...\n    }\n}\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":109,"score":4,"question_id":13184760,"title":"must be non-nullable in order to use as parameter 'T'","body":"<p>I am trying to create a Code First class with my own object types and get this error:</p>\n\n<blockquote>\n  <p><code>.MTObject'</code> must be a non-nullable value type in order to use it as\n  parameter 'T' in the generic type or method\n  '<code>System.Data.Entity.ModelConfiguration.Configuration.StructuralTypeConfiguration&lt;TStructuralType&gt;.Property&lt;T&gt;(System.Linq.Expressions.Expression&lt;System.Func&lt;TStructuralType,T&gt;&gt;)</code>'</p>\n</blockquote>\n\n<p>Is there a way to declare my class property to get past this error?</p>\n\n<p>Code is below:</p>\n\n<pre><code>// Simple Example\n\npublic class MTObject\n{\n    public string Object { get; set; }\n\n    public MTObject()\n    {\n\n    }\n}\n\npublic class Person\n{\n    public decimal Id { get; set; }\n\n    //public string Name { get; set; }\n\n    public MTObject Name { get; set; }\n\n    public Int32 Age { get; set; }\n}\n\npublic class PersonConfiguration : EntityTypeConfiguration&lt;Person&gt;\n{\n    public PersonConfiguration() : base()\n    {\n        HasKey(p =&gt; p.Id);\n        Property(p =&gt; p.Id).HasColumnName(\"ID\").HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n        Property(p =&gt; p.Name).HasColumnName(\"NAME\").IsOptional();\n        Property(p =&gt; p.Age).HasColumnName(\"AGE\").IsOptional();\n        ToTable(\"Person\");\n    }\n}\n\npublic class PersonDataBase : DbContext\n{\n    public DbSet&lt;Person&gt; Persons { get; set; }\n\n    public PersonDataBase(string connectionString) : base(connectionString)\n    {\n        Database.CreateIfNotExists();\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new PersonConfiguration());\n        base.OnModelCreating(modelBuilder);\n    }\n}\n\n// End Simple EXample\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","web-config","connection-string"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":13093754,"title":"MVC3 Entity Connection string disappearing","body":"<p>I am having a very frustrating problem with my current project. It is continually losing the connection string binding for Entity models.</p>\n\n<p>I have multiple models for different databases in separate areas and was having no problems. Suddenly now whenever I try to update from the database I get the connection string setup prompt. I select for it to add it to the Web.config with the password but it doesn't ever pick it up there again. They all are still in the web config but it just doesn't see them.</p>\n\n<p>If I remove all the connection strings from the config file it will write the new one there. Then when I try to set up a Stored procedure/Function Import, I still get the statement in the lower box:</p>\n\n<pre><code>No database connection has been configured for this model.\n</code></pre>\n\n<p>I have tried rebuilding the project and creating the models again from scratch and that works for a while. When I try and bring the project in under Perforce source control, it winds up getting re-corrupted &amp; the connection string goes away. It affects all of my models too.</p>\n\n<p>I am also using EF 4.x DbContext Generator to create context files. They work fine. I am also able to run the application and it connects to the database just fine and returns data. No issues there. I am just unable to update Entity Complex types from the DB or import any more stored procedures. </p>\n\n<p>An even weirder occurrence was that I opened a broken project from a different directory then opened an uncorrupted copy it instantly became broken also. Contagious! </p>\n\n<p>Any thoughts on where to look into to see why this is happening? Has anyone else had this issue?</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-5","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13182669,"title":"Explicitly invoking DatabaseInitializer","body":"<p>I have a DbContext in an assembly that is shared between two service projects. I have both projects set to start for debugging in Visual Studio. This creates a race condition where the <code>DatabaseInitializer</code> in each service tries to update the database on startup.</p>\n\n<p>To prevent this, I modified my <code>DbContext</code> as follows so as to prevent the <code>DatabaseIntializer</code> from being automatically registered.</p>\n\n<pre><code>public EntityContext : DbContext\n{\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        Database.SetInitializer&lt;EntityContext&gt;(null);\n    }\n}\n</code></pre>\n\n<p>I wanted to disable the <code>DatabaseInitializer</code> inside the <code>DbContext</code> itself so that I would not have to duplicate that <code>SetInitializer()</code> call in every project that happened to reference my <code>DbContext</code>, and based on what I'd read, overriding <code>OnModelCreating()</code> seemed to be the way to do it.</p>\n\n<p>That prevents the <code>DatabaseInitializer</code> from running automatically, but I wanted to create a separate project that I could run manually in order to update the database. So I did something like the following:</p>\n\n<pre><code>static void Main(string[] args)\n{\n    Database.SetInitializer(new CreateDatabaseIfNotExists&lt;EntityContext&gt;());\n    new EntityContext().Database.Initialize(true);\n}\n</code></pre>\n\n<p>The problem is that this doesn't seem to work - the null initializer set in the <code>OnModelCreating()</code> method apparently overrides anything that I specify in any other call to <code>SetInitializer()</code>. Even if I move the <code>SetIntializer(null)</code> call to a static constructor of the <code>EntityContext</code> class so as to guarantee it is called first it still doesn't work. The only way it works is if I manually call the initializer as follows:</p>\n\n<pre><code>static void Main(string[] args)\n{\n    new CreateDatabaseIfNotExists&lt;EntityContext&gt;()\n        .InitializeDatabase(new EntityContext());\n}\n</code></pre>\n\n<p>But calling the <code>DatabaseInitializer.InitializeDatabase()</code> directly does not seem right, as the Entity Framework infrastructure is supposed to call that.</p>\n\n<p>Is this a bug in EF Code First? What is the \"correct\" way to go about this?</p>\n"},{"tags":["entity-framework","asp.net-mvc-3","frameworks","entity","code-first"],"answer_count":6,"favorite_count":5,"up_vote_count":14,"down_vote_count":0,"view_count":9960,"score":14,"question_id":6312336,"title":"How can I get my database to seed using Entity Framework CodeFirst?","body":"<p>The database is created successfully (as are the tables) but is not seeded. I have spent several hours and read tons of articles but have not been able to get it. Any suggestions?</p>\n\n<p>On a side note, is it possible to call the initializer without having a reference to my DatabaseContext in the client?</p>\n\n<p>I have included all the relevant code I could think of. If anything else would be helpful, please let me know.</p>\n\n<p>Things I've Tried:</p>\n\n<ol>\n<li>I deleted my connection string (since it defaults to sqlexpress anyways, just the name changed)</li>\n<li>I changed DropCreateDatabaseIfModelChanges to DropCreateDatabaseAlways, still the same.</li>\n</ol>\n\n<p>Edit: The really weird thing is it worked once, but I have no idea how or why it broke again. I am assuming connection strings, but who knows.</p>\n\n<p>DatabaseInitializer.cs</p>\n\n<pre><code>public class DatabaseInitializer : DropCreateDatabaseIfModelChanges&lt;DatabaseContext&gt;\n{\n  protected override void Seed(DatabaseContext context)\n  {\n    // Seeding data here\n    context.SaveChanges();\n  }\n}\n</code></pre>\n\n<p>DatabaseContext.cs</p>\n\n<pre><code>public class DatabaseContext : DbContext\n{\n  protected override void OnModelCreating(DbModelBuilder mb)\n  {\n    // Random mapping code\n  }\n\n  public DbSet&lt;Entity1&gt; Entities1 { get; set; }\n  public DbSet&lt;Entity2&gt; Entities2 { get; set; }\n\n}\n</code></pre>\n\n<p>Global.asax.cs - Application_Start()</p>\n\n<pre><code>protected void Application_Start()\n{\n  Database.SetInitializer&lt;DatabaseContext&gt;(new DatabaseInitializer());\n  AreaRegistration.RegisterAllAreas();\n  RegisterGlobalFilters(GlobalFilters.Filters);\n  RegisterRoutes(RouteTable.Routes);\n}\n</code></pre>\n\n<p>Client web.config</p>\n\n<pre><code>&lt;connectionStrings&gt;\n  &lt;add name=\"DatabaseContext\" connectionString=\"data source=.\\SQLEXPRESS;Database=Database;Integrated Security=SSPI;\" providerName=\"System.Data.SqlClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<h1>SOLUTION</h1>\n\n<p>For the sake of documentation, I am sharing my solution here. Navigating all the comments would be a pain anyways. In the end I had DatabaseInitializer and DatabaseContext in separate classes. I don't really understand while these tiny changes fixed it, but here it is.</p>\n\n<p>DatabaseInitializer.cs</p>\n\n<pre><code>public class DatabaseInitializer : CreateDatabaseIfNotExists&lt;DatabaseContext&gt;\n{\n  protected override void Seed(DatabaseContext context)\n  {\n    // Seed code here\n  }\n}\n</code></pre>\n\n<p>DatabaseContext.cs</p>\n\n<pre><code>public class DatabaseContext : DbContext\n{\n  public DatabaseContext() : base(\"MyDatabase\") { }\n\n  protected override void OnModelCreating(DbModelBuilder mb)\n  {\n    // Code here\n  }\n\n  public DbSet&lt;Entity&gt; Entities { get; set; }\n  // Other DbSets\n}\n</code></pre>\n\n<p>Global.asax.cs - Application_Start()</p>\n\n<pre><code>protected void Application_Start()\n{\n  Database.SetInitializer(new DatabaseInitializer());\n  AreaRegistration.RegisterAllAreas();\n  RegisterGlobalFilters(GlobalFilters.Filters);\n  RegisterRoutes(RouteTable.Routes);\n}\n</code></pre>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4.1","sql-server-ce"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12414263,"title":"EF 4.1 / SQL Server CE 4.0 without local SQL Server Express","body":"<p>I have an MVC3 project that uses EF 4.1 database first with a SQL Server CE database. On my dev box, which has SQL Server Express installed, everything works fine. However, when deploying to another server that does not have SQL Server Express installed (or any SQL Server Instance), the connection understandably fails. Is it possible to use EF 4.1 with a SQL Server CE database on a box that does not have a local SQL Server instance?  </p>\n\n<p>Even if I try to reference a remote SQL instance, I receive an error </p>\n\n<blockquote>\n  <p><em>Invalid value for key 'attachdbfilename'</em></p>\n</blockquote>\n\n<p>Here is what the connection string looks like:</p>\n\n<pre><code> &lt;add name=\"AlertsEntities\" connectionString=\"metadata=res://*/Models.AlertsModel.csdl|res://*/Models.AlertsModel.ssdl|res://*/Models.AlertsModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=.\\SQLEXPRESS;attachdbfilename=|DataDirectory|\\Alerts.mdf;integrated security=True;connect timeout=30;user instance=True;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13184099,"title":"Is there a way to Refresh only one Entity with all its child entities in a single call?","body":"<p>I have an entity with a bunch of child entities as properties. Users are presented with a list of entities, can select one to modify it, then Save or Cancel the changes. Saving and Cancelling is not required to switch between entities, so its possible that more than one object is <code>EntityState.Modified</code> at once.</p>\n\n<p>The Save button correctly works to save both the selected entity and all child entities, however the Cancel button is only reverting the changes made to the parent entity, without reverting changes to the child entities.</p>\n\n<p>Is there an easy way to revert all changes within the graph for that object, without looping through every navigation property?</p>\n\n<p>I am using the following code to revert the changes:</p>\n\n<pre><code>context.Connection.Open();\ncontext.Refresh(RefreshMode.StoreWins, MyEntity);\ncontext.Connection.Close();\n</code></pre>\n\n<p>A simplified sample of my entity class structure looks like this:</p>\n\n<pre><code>class MyEntity\n{\n    string Name;\n    IList&lt;Address&gt; Addresses;\n    IList&lt;Contact&gt; Contacts;\n    IList&lt;Note&gt; Notes;\n}\n\nclass Contact\n{\n    string Name;\n    string Title;\n    IList&lt;EmailAddress&gt; EmailAddresses;\n    IList&lt;Phone&gt; PhoneNumbers;\n}\n</code></pre>\n\n<p>I did see <a href=\"http://stackoverflow.com/q/1746941/302677\">this question</a>, however that solution would revert changes to all unsaved entities, and not just the selected entity.</p>\n\n<pre><code>Context.Refresh(RefreshMode.StoreWins, _\n    Context.ObjectStateManager.GetObjectStateEntries());\n</code></pre>\n"},{"tags":["c#","entity-framework","design-patterns","design"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":86,"score":3,"question_id":13183577,"title":"Is it a good practice to allow users to embed raw sql queries in an application?","body":"<p>I tried my best to come up with an appropriate title, excuses if it doesn't make much sense. I hope to explain it better below. We have an application that is based on .Net framework and uses SQL as data storage. As with any application, this application need to support extensibility, for example to support additional data transformations &amp; validations. </p>\n\n<p><strong>Example:</strong> Think of the application as a tool that provides a set of input tables the user can import data into using access or excel (there is UI &amp; grids already) to allow data import. Once the data is imported the tool creates an intermediate model and performs some calculations on the input data and later throws the results in pre-defined format. The input table schema and intermediate model schema is fixed, no changes will happen. The extensibility is needed in the stage where the intermediate model is derived from the input data. Allow users to be able to change the way the data gets derived, eg instead of grouping by one field allow grouping by multiple fields etc.</p>\n\n<p>To support this kind of flexibility, I see there are two basic approaches as I could see</p>\n\n<p>Option 1: Create a business model that maps to the sql data model and expose the business model to the user to allow them to override transformations &amp; create new transformations (e.g., using LINQ or plain C#)</p>\n\n<p>Option 2: Expose the entire sql data model and allow users to embed raw SQL queries to perform the transformations &amp; validations.</p>\n\n<p>My personal preference is to use Option 1, since I am not a big fan of allowing users to play with underlying data tables directly. I prefer more controlled access. However, this approach requires the user to have programming language (C# or VB). On the other hand Option 2, may just need someone who has knowledge of SQL programming to create raw queries and directly plug them into the application. But, I think this is a bad approach.</p>\n\n<p>The product management team is inclined to go with Option 2, as they feel it is more flexible and easy to implement from resource point of view.</p>\n\n<p>So, I am trying to come up with pros and cons of both approach to better support my inclination for Option 1. Basically, inclination to do the work in programming language in C# or VB .net rather than just using plain SQL queries.</p>\n\n<p>Kindly, share your thoughts and opinions.</p>\n"},{"tags":["entity-framework","unicode","indexing","sql-server-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13182748,"title":"How to use Unicode string for primary key in SQL Server","body":"<p>I am having trouble inserting a record with a primary key that only varies by some special Unicode characters. </p>\n\n<p>For example, if I have a record already in the database with a primary key of <code>\"test\"</code> and I try to insert another record that has a primary key of <code>\"test + '\\u13A4' + '\\u13B4' + '\\u13B9'\"</code> I get a duplicate key error. I am using EF 5 with SQL Server 2012. </p>\n\n<p>The primary key is defined as an <code>nvarchar</code> and the collation is set to <code>SQL_Latin1_General_CP1_CI_AS</code>. It can do a look-up on the primary key just fine if there are special Unicode characters in there but if it just varies by the Unicode special characters (as in the example above) I get the duplicate key error on inserts. How do you get around this issue?</p>\n"},{"tags":["entity-framework","parallel-processing","profiling","task-parallel-library","tpl-dataflow"],"answer_count":0,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":65,"score":4,"question_id":13182603,"title":"Entity Framework and Parallelism","body":"<p><strong>Background</strong></p>\n\n<p>I have an application that receives periodic data dumps (XML files) and imports them into an existing database using Entity Framework 5 (Code First).  The import happens via EF5 rather than say BULK INSERT or BCP because business rules that already exist in the entities must be applied.</p>\n\n<p>Processing seems to be CPU bound in the application itself (the extremely fast, write-cache enabled disk IO subsystem shows almost zero disk wait time throughout the process, and SQL Server shows no more than 8%-10% CPU time).</p>\n\n<p>To improve efficiency, I built a <a href=\"http://msdn.microsoft.com/en-us/library/hh228604.aspx\" rel=\"nofollow\">pipeline using TPL Dataflow</a> with components to:</p>\n\n<pre><code>Read &amp; Parse XML file\n        |\n        V\nCreate entities from XML Node\n        |\n        V\nBatch entities (BatchBlock, currently n=200)\n        |\n        V\nCreate new DbContext / insert batched entities / ctx.SaveChanges()\n</code></pre>\n\n<p>I see a substantial increase in performance by doing this, but can not get the CPU above about 60%.  </p>\n\n<p><strong>Analysis</strong></p>\n\n<p>Suspecting some sort of resource contention, I ran the process using the VS2012 Profiler's <em>Resource contention data (concurrency)</em> mode.</p>\n\n<p>The profiler shows me 52% contention for a resource labeled <em>Handle 2</em>.  Drilling in, I see that the method creating the most contention for <em>Handle 2</em> is </p>\n\n<pre><code>System.Data.Entity.Internal.InternalContext.SaveChanges()\n</code></pre>\n\n<p>Second place, at about 40% as many contentions as SaveChanges(), is</p>\n\n<pre><code>System.Data.Entity.DbSet`1.Add(!0)\n</code></pre>\n\n<p><strong>Questions</strong></p>\n\n<ul>\n<li>How can I figure out what <em>Handle 2</em> really is (e.g. part of TPL, part of EF)?</li>\n<li>Does EF throttle calls to separate DbContext instances from separate threads?  It seems there is a shared resource they are contending for.</li>\n<li>Is there anything that I can do to improve parallelism in this case?</li>\n</ul>\n\n<p><strong>UPDATE</strong></p>\n\n<p>For the run in question, the maximum degree of parallelism for the task that calls SaveChanges is set to 12 (I tried various values including Unbounded in previous runs).</p>\n"},{"tags":["c#","entity-framework","generics","linq-to-sql"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":95,"score":3,"question_id":13180227,"title":"Can I make the following IQueryable linq statment generic","body":"<p>Is there a way I can make the following db query builder generic?</p>\n\n<pre><code>private IQueryable&lt;Foo&gt; ByName(IQueryable&lt;Foo&gt; dbQuery, Query query)\n{\n    string[] searchTerms = query.Data.Replace(\" \",\"\").ToLower().Split(',');\n\n    if (query.Exclude)\n    {\n        return dbQuery.Where(x =&gt; searchTerms.All(\n            y =&gt; y != x.Name.Replace(\" \", \"\").ToLower()));\n    }\n\n    return dbQuery.Where(x =&gt; searchTerms.Any(\n        y =&gt; y == x.Name.Replace(\" \", \"\").ToLower()));\n}\n</code></pre>\n\n<p>I've got the same function for lots of different properties of Foo. ByCounty, ByTown, ByStreet etc etc.</p>\n\n<p>I've written some functions that return linq before like the following</p>\n\n<pre><code>public Expression&lt;Func&lt;Foo, bool&gt;&gt; FoosAreWithinDistanceFromGeocode(\n    double distance, Geocode geocode)\n{\n    double distanceSquare = distance * distance;\n    return foo =&gt; ( SqlFunctions.Square((double)(\n        foo.Address.Geocode.Easting - geocode.Easting)) +\n        SqlFunctions.Square((double)(fooAddress.Geocode.Northing - \n        geocode.Northing)) ) &lt;= distanceSquare;\n}\n</code></pre>\n\n<p>But I can't seem to find if the Linq-to-SQL stuff can't use generics or if it's possible to pass properties as generics and that kind of thing.</p>\n\n<hr>\n\n<p>EDIT: I have this working generically for a single search term. </p>\n\n<pre><code>Where [query.Data == \"Foo1\"]\n\nreturn dbQuery.Where(SearchMatch(\"Name\", query.Data));\n\npublic Expression&lt;Func&lt;Foo, bool&gt;&gt; SearchMatch(string propertyName, string searchTerm)\n{\n    var foo = Expression.Parameter(typeof(Foo), \"foo\");\n    var prop = Expression.Property(foo, propertyName);\n    var search = Expression.Constant(searchTerm);\n    var equal = Expression.Equal(prop, search);\n\n    return Expression.Lambda&lt;Func&lt;Foo, bool&gt;&gt;(equal, foo);\n}\n</code></pre>\n\n<p>Anyone have any ideas how to make it work for an array of strings?</p>\n"},{"tags":["linq","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2803,"score":2,"question_id":2356992,"title":"date difference with linq","body":"<p>With this code:</p>\n\n<pre><code> i.SpesaAlloggio = db.TDP_NotaSpeseSezB.Sum(p =&gt; p.Costo / (((DateTime)p.DayEnd)\n                    .Subtract((DateTime)p.DayStart).Days + 1));\n</code></pre>\n\n<p>I receive this error:</p>\n\n<pre><code>LINQ to Entities does not recognize the method \n'System.TimeSpan Subtract(System.DateTime)' method, and this method cannot be \ntranslated into a store expression.\n</code></pre>\n\n<p>How can I do this?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13179860,"title":"Entity Framework Exception when iterating over collection","body":"<p>I have built a simple file manager, that pulls data from two tables, Folders and Files.\nWhen you upload a file it gets written to disk on the server. When I need to delete a folder and all of it's sub-folders, sub-folder files and the parent folders files, I select the folder and then click delete, which executes the controller action below.</p>\n\n<p><strong>UPDATE</strong>\nIf I change any subsequent call to .ToList() it works.</p>\n\n<pre><code>    [HttpPost]\n    public JsonResult DeleteFolder(int folderID)\n    {\n        var repo = new FileManagerRepository();\n\n        var folder     = repo.GetFolder(folderID);\n        var subfolders = repo.GetSubFolders(folderID).ToList();\n        var files      = repo.GetFiles(folderID).ToList();\n\n        // delete sub-folders\n        if (subfolders.Count() != 0)\n        {\n            foreach (var subfolder in subfolders)\n            {\n                // delete sub-folder files\n                var subfiles = repo.GetFiles(subfolder.folder_id).ToList();\n                if (subfiles.Count() != 0)\n                {\n                    foreach (var file in subfiles)\n                    {\n                        repo.DeleteFile(file.file_id);\n                        System.IO.File.Delete(Server.MapPath(\"/content/upload/\" + file.file_name));\n                    }\n                }\n                repo.DeleteFolder(subfolder.folder_id);\n            }\n        }\n        // delete files\n        if (files.Count() != 0)\n        {\n            foreach (var file in files)\n            {\n                repo.DeleteFile(file.file_id);\n                System.IO.File.Delete(Server.MapPath(\"/content/upload\" + file.file_name));\n            }\n        }\n        // delete the folder            \n        if (folder != null)\n        {\n            repo.DeleteFolder(folder.folder_id);                \n        }\n        repo.Save();\n        return new JsonResult();\n    }\n</code></pre>\n\n<p>Now here is the FileManagerRepository</p>\n\n<pre><code> public class FileManagerRepository\n{\n    private readonly iau_idahoEntities db = new iau_idahoEntities();\n\n    public IQueryable&lt;folders&gt; GetParentFolders()\n    {\n        return db.folders.Where(f =&gt; f.parant_folder_id == 0);\n    }\n\n    public IQueryable&lt;folders&gt; GetSubFolders()\n    {\n        return db.folders.Where(f =&gt; f.parant_folder_id != 0);\n    }\n    public IQueryable&lt;folders&gt; GetSubFolders(int folder_id)\n    {\n        return db.folders.Where(f =&gt; f.parant_folder_id != 0 &amp;&amp; f.parant_folder_id == folder_id);\n    } \n\n\n    public IQueryable&lt;Files&gt; GetFiles(int id)\n    {\n        return db.Files.Where(f =&gt; f.folder_id == id);\n    }\n\n    public Files GetFile(int id)\n    {\n        return db.Files.SingleOrDefault(f =&gt; f.file_id == id);\n    }\n\n    public void UpdateDownloadCount(int id)\n    {\n        var file = GetFile(id);\n        file.downloaded += 1;         \n    }\n    public void AddFolder(int parentFolderID, string folderName)\n    {\n        var folder = new folders { create_date = DateTime.Now, parant_folder_id = parentFolderID, folder_name = folderName };\n        db.folders.AddObject(folder);\n    }\n\n    public void DeleteFolder(int folder_id)\n    {\n        var folder = db.folders.SingleOrDefault(f =&gt; f.folder_id == folder_id);\n        db.folders.DeleteObject(folder);\n    }\n    public void Save()\n    {\n        db.SaveChanges();\n    }\n\n    public void AddFile(int folder_id,string filename, string description)\n    {\n        var file = new Files { \n            folder_id = folder_id, \n            file_name = filename, \n            file_extension = filename.Substring(filename.Length - 3, 3), \n            description = description,\n            downloaded = 0, \n            physical_name = filename.Substring(0, filename.Length - 4), \n            upload_date = DateTime.Now \n        };\n        db.Files.AddObject(file);            \n    }\n\n    internal void DeleteFile(int fileID)\n    {\n        var fileToDelete = db.Files.SingleOrDefault(file =&gt; file.file_id == fileID);\n        db.Files.DeleteObject(fileToDelete);\n    }\n\n    internal folders GetFolder(int folderID)\n    {\n        return db.folders.SingleOrDefault(folder =&gt; folder.folder_id == folderID);\n    }\n}\n</code></pre>\n\n<p>The problem is I keep getting the following EF Exception:\n<strong>There is already an open DataReader associated with this Command which must be closed first</strong></p>\n\n<p>I've tried to add MultipleActiveResultSets = true, to my connection string in the web.config, but I still get the exception. I know why this exception is being thrown, but I don't know how to do what I need to and prevent it from throwing an exception.</p>\n\n<p>PLEASE HELP!!! </p>\n"},{"tags":["entity-framework","ado.net","odp.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13167108,"title":"Reset ADO.NET schema","body":"<p>I modified a schema (set a field to be non-nullable), but when I try to recreate the mapping with ADO.NET I only see the old schema.</p>\n\n<p>The .edmx file looks like this:</p>\n\n<pre><code>        &lt;EntityType Name=\"STG_DW_BUF_CODE_D\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"BUF_CODE_KEY\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Name=\"BUF_CODE_KEY\" Type=\"number\" Nullable=\"false\" /&gt;\n\n\n      &lt;EntityType Name=\"STG_DW_REGION_D\"&gt;\n        &lt;Property Name=\"REGION_KEY\" Type=\"number\" /&gt;\n</code></pre>\n\n<p>The STG_DW_REGION_D view should have Nullable=\"false\" like the view above it.</p>\n\n<p>I can confirm the new schema has this field non-nullable through another SQL application, but I can't get ADO.NET to notice.</p>\n\n<p>I tried erasing the model and recreating it. I tried closing visual studio and starting it up again. It still sees the old schema.</p>\n\n<p>Does anyone know how to reset it? Any suggestions?</p>\n"},{"tags":["sql","entity-framework",".net-4.5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13167048,"title":"Why is the Audit Logout event for EF5, taking ~3 seconds for EF5?","body":"<p>I am trying to put together a prof of concept for changing our home grown ORM solution to EntityFramework 5, and the first problem I run into appears to be a serious show stopper.</p>\n\n<p>EF5 appears, our of the box, to take ~9x longer to execute a scalar sql operation than ad hock sql, BUT when I look at the sql code generated, the sql itself appears to be reasonably well written, and runs quickly.</p>\n\n<p>My C# code for both:</p>\n\n<pre><code> int surveyId = (from survey in upsEntities.Surveys where !survey.Deleted select survey.SurveyID).First();\n            Debug.WriteLine(\"Loading surveyId : {0} through Linq took {1}ms using EF5\", surveyId,\n                            sw.Elapsed.TotalMilliseconds);\n\n            sw.Restart();\n\n            string sql = \"Select top 1 surveyId from Survey where deleted = 0\";\n            object val = SMSDataManager.Instance.DataAccessManager.ExecuteScalar(sql);\n\n            Debug.WriteLine(\"Loading surveyId : {0} through AdHock SQL took {1}ms using OrmDataManager\", val,\n                           sw.Elapsed.TotalMilliseconds);\n</code></pre>\n\n<p>SQL Output:\nEF5: </p>\n\n<pre><code>SELECT TOP (1) \n[Extent1].[SurveyID] AS [SurveyID]\nFROM [dbo].[Survey] AS [Extent1]\nWHERE [Extent1].[Deleted] &lt;&gt; cast(1 as bit)\n</code></pre>\n\n<p>Adhock: <code>Select top 1 surveyId from Survey where deleted = 0</code></p>\n\n<blockquote>\n  <p>Loading surveyId : 1 through Linq took <strong>2965.8625ms using EF5</strong></p>\n  \n  <p>Loading surveyId : 1 through <strong>AdHock SQL took 384.8073ms</strong></p>\n</blockquote>\n\n<p>The duration between the two, according to the profiler is 1ms for EF5, vs 0ms for ad hock. Where the problem appears to lie is in the <strong>Audit Logout</strong> event <strong>for EF5, taking ~3 seconds,</strong> where my <strong>ad hock sql is taking ~.6 seconds</strong> for the same logout event.</p>\n\n<p>What is causing this huge overhead for EF5, and what can I do to mitigate, or explain this?</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13167563,"title":"entity framework 5.0 .load method and .local property are missing from entity","body":"<p>I'm using entity framework 5 and have two Visual Studio 2010 solutions. One is a small test solution with one project and one is a much larger solution with multiple projects where I'm doing the actual business application.</p>\n\n<p>The entities in the smaller solution have both the <strong>.Load()</strong> method and the <strong>.Local</strong> property.</p>\n\n<p>The entities in the larger solution have neither.</p>\n\n<p>I've referenced both <strong>system.data.entity</strong> and <strong>EntityFramework</strong> in the projects.</p>\n\n<p>I've compared the two solutions and can't figure out what is missing in the large one. Any pointers in what direction to look next would be appreciated.</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":3,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":4517,"score":12,"question_id":2720551,"title":"Can EF4 support batch updates?","body":"<p>Does Entity Framework v4 support batch updates/inserts so rather than sending >1 command to a db, it can send >1 command to the DB in one go?</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13169946,"title":"Why does EF create a new db instead of using the existing db?","body":"<p>I have an existing SQL Server Express database populated with data.</p>\n\n<p>I created a new VS solution built around EF 5. I generated the EDMX from the existing database and verified the connection string in the <code>app.config</code> points to the database on <code>.\\SQLEXPRESS</code>.</p>\n\n<p>I created a project for my domain objects.</p>\n\n<p>I added a <code>DbContext</code> generator. The domain objects are also generated.</p>\n\n<p>Everything builds and the console application runs.</p>\n\n<p>The problem, however, is a new database is created instead of using the existing database. </p>\n\n<p>Why does EF create a new empty database instead of using the existing database I specified? And how do I fix it?</p>\n\n<p>Here is the <code>DbContext</code> class:</p>\n\n<pre><code>public partial class ContactsEntities : DbContext\n{\n        public ContactsEntities()\n            : base(\"name=ContactsEntities\")\n        {\n        }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            throw new UnintentionalCodeFirstException();\n        }\n\n        public DbSet&lt;Address&gt; Addresses { get; set; }\n        public DbSet&lt;AddressType&gt; AddressTypes { get; set; }\n        public DbSet&lt;Person&gt; People { get; set; }\n        public DbSet&lt;Phone&gt; Phones { get; set; }\n        public DbSet&lt;PhoneType&gt; PhoneTypes { get; set; }\n}\n</code></pre>\n\n<p>And the entire <code>app.config</code>:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n  &lt;/configSections&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"ContactsEntities\" connectionString=\"metadata=res://*/PeopleModel.csdl|res://*/PeopleModel.ssdl|res://*/PeopleModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=(local)\\sqlexpress;initial catalog=Contacts;integrated security=True;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\" /&gt;\n  &lt;/entityFramework&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>And here is the PeopleContext scaffolded using the T4Scaffolding:</p>\n\n<pre><code>   public class PeopleContext : DbContext\n    {\n        // You can add custom code to this file. Changes will not be overwritten.\n        // \n        // If you want Entity Framework to drop and regenerate your database\n        // automatically whenever you change your model schema, add the following\n        // code to the Application_Start method in your Global.asax file.\n        // Note: this will destroy and re-create your database with every model change.\n        // \n        // System.Data.Entity.Database.SetInitializer(new System.Data.Entity.DropCreateDatabaseIfModelChanges&lt;DataLayer.Models.PeopleContext&gt;());\n\n        public DbSet&lt;Domain.Person&gt; People { get; set; }\n    }\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13176626,"title":"Entity Framework: Unable to load one or more of the requested types","body":"<p>I am getting a specific exception that I am confused about.  I recently changed the target framework of my application from .net Framework 4.0 client profile to .net Framework 4.5.  That has apparently caused my entity framework to go a little haywire. I get this exception when I run my application...</p>\n\n<pre><code>System.Reflection.ReflectionTypeLoadException: Unable to load one or more of the requested types. Retrieve the\nLoaderExceptions property for more information.\n   at System.Reflection.RuntimeModule.GetTypes(RuntimeModule module)\n   at System.Reflection.RuntimeModule.GetTypes()\n   at System.Reflection.Assembly.GetTypes()\n   at System.Data.EntityUtil.GetTypesSpecial(Assembly assembly)\n   at System.Data.Metadata.Edm.ObjectItemAttributeAssemblyLoader.LoadTypesFromAssembly()\n   at System.Data.Metadata.Edm.ObjectItemAssemblyLoader.Load()\n   at System.Data.Metadata.Edm.ObjectItemAttributeAssemblyLoader.Load()\n   at System.Data.Metadata.Edm.AssemblyCache.LoadAssembly(Assembly assembly, Boolean loadReferencedAssemblies, ObjectItemLoadingSessionData loadingData)\n</code></pre>\n\n<p>The thing is it used to work before I made this change... What did I manage to mess up?  Do I need to regenerate these entities?  How do I go about trouble shooting and fixing this problem?  Thanks.</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":32,"score":-1,"question_id":13175262,"title":"My application doesn't recognize System.Data.Entity.Infrastructure in a console application with entity framework","body":"<p>I have a console application where i add deom nuget ,Entity framework power tools.I create a new console application and with click right on the project i choose Entity Framework/EF Code First ,i completed the informations regarding the database and the application generated my code.I receive message that \"reverse engeneer complete \" but i have compilation errors .The program doesn't recognize System.Data.Entity.Infrastructure .\nI use Visual Studio 2010.</p>\n\n<p>The error message is :</p>\n\n<p>The type or namespace name 'Infrastructure' does not exist in the namespace 'System.Data.Entity' (are you missing an assembly reference?)   D:\\Lucru\\ASP.Net\\ConsoleApplicationUseEntityFramework\\ConsoleApplicationUseEntityFramework\\Models\\PraccticeContext.cs   </p>\n\n<p>Can somebody tell me what's the problem?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13174593,"title":"Entity Framework 5 Code first adding an image","body":"<p>I am writing a very small application with mvc4 and entity framework 5.</p>\n\n<p>I want to add a product and store and image for the product.</p>\n\n<p>I have a model</p>\n\n<pre><code>  [Table(\"CatalogItem\")]\npublic class CatalogItemModel\n{\n    [Key]\n    public int CatalogItemId { get; set; }\n\n    public string Description { get; set; }\n\n    public double Price { get; set; }\n\n    public int ProductCount { get; set; }\n\n    public string Size { get; set; }\n\n    public string Sku { get; set; }\n\n    [Column(TypeName = \"image\")]\n\n\n    public byte[] Image { get; set; }\n\n    [Display(Name = \"Display Catalog Item\")]\n    public bool DisplayItem { get; set; }\n}\n</code></pre>\n\n<p>My controller. This never gets hit.</p>\n\n<pre><code> [HttpPost]\n    public ActionResult Create(CatalogItemModel catalogitemmodel)\n    {\n        if (ModelState.IsValid)\n        {\n            db.CatalogItemModels.Add(catalogitemmodel);\n            db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n\n        return View(catalogitemmodel);\n    }\n</code></pre>\n\n<p>My views form</p>\n\n<pre><code>    &lt;fieldset&gt;\n    &lt;legend&gt;CatalogItemModel&lt;/legend&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Description)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Description)\n        @Html.ValidationMessageFor(model =&gt; model.Description)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Price)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Price)\n        @Html.ValidationMessageFor(model =&gt; model.Price)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.ProductCount)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.ProductCount)\n        @Html.ValidationMessageFor(model =&gt; model.ProductCount)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Size)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Size)\n        @Html.ValidationMessageFor(model =&gt; model.Size)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Sku)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Sku)\n        @Html.ValidationMessageFor(model =&gt; model.Sku)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.DisplayItem)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.DisplayItem)\n        @Html.ValidationMessageFor(model =&gt; model.DisplayItem)\n    &lt;/div&gt;\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(m=&gt;m.Image)\n    &lt;/div&gt;\n\n    &lt;input name=\"Image\" type=\"file\"/&gt;\n    &lt;p&gt;\n        &lt;input type=\"submit\" value=\"Create\" /&gt;\n    &lt;/p&gt;\n&lt;/fieldset&gt;\n</code></pre>\n\n<p>When I try posting a new catalog with an image within my file input however it throws an error </p>\n\n<blockquote>\n  <p>The input is not a valid Base-64 string as it contains a non-base 64 character, more than two padding characters, or an illegal character among the padding characters.</p>\n</blockquote>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13175927,"title":"Lookup related record during mass insert?","body":"<p>I'm creating 5000 records from a XML feed. These get inserted in a <code>List&lt;Person&gt;</code> and ultimately saved to the database. </p>\n\n<p>However, there is one column in the Person model that has a many-to-many relationship: <strong>CourseId</strong>.</p>\n\n<p>These (12000) courses have been imported previously. In the Person feed I was given a <code>&lt;CourseID&gt;xxx&lt;/CourseID&gt;</code> number which i can use to relate to a course in my table. This CourseId is not the auto-generated Primary Key, but a seperate column.</p>\n\n<p>What I want is to loop through the feed, fill the Person properties and also link it to all the courses that are in the feed.</p>\n\n<p>Is there a fast query command I can issue when I create a new Person?</p>\n\n<p>Something like:</p>\n\n<pre><code>pList.Add(new Person { Name = personName, Course = // fetch all courses for this person } )\n</code></pre>\n"},{"tags":["c#","sql","entity-framework","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13175756,"title":"Set custom model Id (primary key) in MVC 4","body":"<p>I want to know if it's possible to use custom ID Integers as primary key?</p>\n\n<p>So instead of the default Ids 1,2,3,4,5,... I would like to use fixed Ids like 1422,1424,1426, ...</p>\n\n<p>I get these Ids from a feed and I will be using relationships based on those values. In my current setup, I have a general Id (auto generated) and a second FeedId column. Can't I just replace to auto-generated Id so it uses the FeedId?</p>\n"},{"tags":["asp.net-mvc","entity-framework","azure"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":38,"score":3,"question_id":13174197,"title":"'Microsoft.SqlServer.Types' version 10 or higher could not be found on Azure","body":"<p>I'm trying to make a webapi in ASP.NET MVC 4. The webapi used Entity Framework 5 Spatial types and i have wrote a very simple code. </p>\n\n<pre><code>  public List&lt;Area&gt; GetAllAreas()\n    {\n        List&lt;Area&gt; aList = db.Areas.ToList();\n        return aList;\n    }\n</code></pre>\n\n<p>Area contains DbGeometry.</p>\n\n<p>When i run this local it works, but when i publish it to azure it gives me this error:</p>\n\n<blockquote>\n  <p>Spatial types and functions are not available for this provider because the assembly 'Microsoft.SqlServer.Types' version 10 or higher could not be found.</p>\n</blockquote>\n\n<p>Anyone know how to resolve this ? :)</p>\n\n<p>Thanks!</p>\n"},{"tags":["entity-framework","entity-framework-4.1","ef-code-first","entity-framework-ctp5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":10658533,"title":"Many to many relation with the same table with EF4.3 Code First","body":"<p>How to make a configuration with this schema? </p>\n\n<pre><code>CREATE TABLE Entity\n(\n    Id int identity primary key,\n    Name nvarchar(30)\n)\n\nCREATE TABLE Member\n(\n    ParentEntityId references Entity(Id),\n    ChildEntityId references Entity(Id)\n)\n</code></pre>\n"},{"tags":["sql-server-2008","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13174809,"title":"how do I select from stored procedure","body":"<p>I am trying to work with EF, for the first time ever. I'm not sure I fully understand EF yet.</p>\n\n<p>I already have a database with data in it, so I've generated my models from DB.\nOur current setup runs EVERYTHING through stored procedures, even selects.\nHowever, unless I'm mistaking, the models select directly into the tables, when I have generated them.</p>\n\n<p>Can I change this behaviour, so it calls the select procedure instead?</p>\n"},{"tags":["sql-server","entity-framework","entity-framework-4","nopcommerce"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12057458,"title":"Is it possible to limit number of connections used by Entity Framework?","body":"<p>I've noticed that on a NopCommerce site we host (which uses Entity Framework) that if I run a crawler on the site (to check for broken links) it knocks the entire webserver offline for a few minutes and no other hosted sites respond. This seems to be because Entity Framework is opening 30-odd database connections and runs hundreds of queries per second (about 20-40 per page view).</p>\n\n<p>I cannot change how EF is used by NopCommerce (it would take weeks) or change the version of EF being used, so can I mitigate the effects it has on SQL Server by limiting how many concurrent connections it uses, to give other sites hosted on the same server a fairer chance at database access?</p>\n\n<p>What I'm ideally looking to do, is limit the number of concurrent DB connections to about 10, for a particular application.</p>\n"},{"tags":["entity-framework","database-design","relational-database"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13156374,"title":"One to one relation in SQL database","body":"<p>I have two tables: \"Person\" and \"Details\". Person should have one to one relation with Details. I have two options:</p>\n\n<ol>\n<li>Write DetailsId in Details table and make it FK to Details.Id(PK);</li>\n<li>Make Details.PersonId as PK and FK at the same time to Person.Id;</li>\n</ol>\n\n<p>In both cases relationship is one to one. Can you explain which one is better and in what cases?</p>\n\n<p>EDIT:</p>\n\n<p>I'm using entity framework and want to get Detail like this: Person.Detail, not Person.Details.First()</p>\n"},{"tags":["c#","wcf","entity-framework","ninject"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13135532,"title":"Ninject in a N-Tier App using WCF and InRequestScope","body":"<p>I'm using Ninject 3.01.1.10 with WCF extenstion and Web extention (all from nuget)</p>\n\n<p>I am using NInject in a WCF Service (that has several client desktop apps) using Entity Framework and Repository pattern.</p>\n\n<p>Since I am using EF, I wanted to use the InRequestScope so that each repository is created every time there is a service request (as the EF good practices dictate).</p>\n\n<p>I installed everything through nuget and have NinjectWebCommon bootstrapper class registering the services in RegisterServices as the Ninject WCF sample shows. I also have the WCF Service in InstanceContextMode.PerCall as I read somewhere online.</p>\n\n<p>My question is: does all the chain of injected objects needs to be in InRequestScope so the scope works?</p>\n\n<p>My WCF service is being injected with a ServiceHandlerDispatcher in the constructor:</p>\n\n<pre><code>public VanillaService(IServiceHandlerDispatcher serviceHandlerDispatcher) { ... }\n</code></pre>\n\n<p>This ServiceHandlerDispatcher has a dictionary of objects ServiceHandler that, according to the client's handler request, call a Controller object. This controller object has methods that use the repositories.</p>\n\n<pre><code>public ServiceHandlerDispatcher(IMessageHandler[] messageHandlers) { ... }\n\npublic SaveSubmissionHandler(SubmissionController submissionController) { ... }\n\npublic SubmissionController(IRepository&lt;Submission&gt; submissionRepository) { ... }\n</code></pre>\n\n<p>So the chain is something like this: Service -> ServiceHandlerDispatcher -> ServiceHandler -> controller -> repository -> DB</p>\n\n<p>For performance and memory purposes, I wanted the ServiceHandlerDispatcher and all ServiceHandler in singleton scope but the repository objects in InRequestScope (so that in each call the EF's DbContext is disposed), since I can have dozens of ServiceHandler objects.</p>\n\n<p>Again, Service -> ServiceHandlerDispatcher (SingletonScope) -> ServiceHandler (SingletonScope) -> controller (none) -> repository (InRequestScope) -> DB</p>\n\n<p>Is this possible or do I have to have the kernel creating each ServiceHandler in each call?\nIf it's needed that every object in the chain needs to be InRequestScope, how to implement the ServiceHandler dictionary? With the Factory extension?</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13172666,"title":"Invalid attempt to read when no data is present error","body":"<p>This is my code:</p>\n\n<pre><code>var products = (from x in db.tblExample select x).ToList();\n</code></pre>\n\n<p>and I get \"Invalid attempt to read when no data is present\" error.\nThe table exists and has data in it. This query:</p>\n\n<pre><code>SELECT *\nFROM [myDatabase].[dbo].[tblExample]\n</code></pre>\n\n<p>works fine in Microsoft SQL server. How to resolve this?</p>\n"}]}
{"total":18927,"page":4,"pagesize":100,"questions":[{"tags":["c#","mysql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":13171678,"title":"EF, how to increase query performance","body":"<p>i have about <code>1 million</code> data in my database(<code>MySQL</code>)</p>\n\n<p>and there's a advancedSearch function which is <code>very slow</code>(more than 30 sec), because the SQL EntityFramework generated is not very good, SQL:</p>\n\n<pre><code>SELECT\n`Project1`.*\nFROM \n(\nSELECT\n`Extent1`.*\nFROM `tnews` AS `Extent1`\n WHERE `Extent1`.`Region` = 'Americas(2)'\n ) AS `Project1`\n ORDER BY \n`Project1`.`PnetDT` DESC LIMIT 0,20\n</code></pre>\n\n<p>C# function:</p>\n\n<pre><code>    private List&lt;CNNews&gt; AdvancedSearchAndPage(int pagenum, int pagesize,\n        AdvSearchArgs advArgs)\n    {\n        IQueryable&lt;CNNews&gt; result = _dbRawDataContext.CNNews.\n            OrderByDescending(n =&gt; n.PnetDT);\n\n        if (!string.IsNullOrWhiteSpace(advArgs.Feed))\n        {\n            result = result.Where(news =&gt; news.Feed == advArgs.Feed);\n        }\n\n        if (!string.IsNullOrWhiteSpace(advArgs.PNET))\n        {\n            result = result.Where(news=&gt;news.PNET == advArgs.PNET);\n        }\n\n        if (!string.IsNullOrWhiteSpace(advArgs.ProdCode))\n        {\n            result = (from news in result\n                      where news.ProdCode == advArgs.ProdCode\n                      select news);\n        }\n\n        if (!string.IsNullOrWhiteSpace(advArgs.Code))\n        {\n            result = (from news in result\n                      where news.Code == advArgs.Code\n                      select news);\n        }\n\n        if (!string.IsNullOrWhiteSpace(advArgs.BegineDate))\n        {\n            var begin = Convertion.ToDate(advArgs.BegineDate);\n            var end = Convertion.ToDate(advArgs.EndDate);\n\n            result = (from news in result\n                      where news.PnetDT &gt;= begin &amp;&amp; news.PnetDT &lt; end\n                      select news);\n        }\n\n        if (!string.IsNullOrWhiteSpace(advArgs.Region))\n        {\n            result = result.Where(x =&gt; x.Region == advArgs.RegionName);\n        }\n\n        var pagedList = result.\n            Skip(pagenum * pagesize).\n            Take(pagesize);\n        return pagedList.ToList();\n    }\n</code></pre>\n\n<p>if the SQL format like this, it will <code>very fast</code>:</p>\n\n<pre><code> SELECT\n*\nFROM `tnews` AS `Extent1`\n WHERE `Extent1`.`Region` = 'Americas(2)'\n ORDER BY \n `PnetDT` DESC LIMIT 0,20\n</code></pre>\n"},{"tags":["linq","entity-framework","enums"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13153646,"title":"Using Enums inside EF queries","body":"<p>I have following query (EF5, .NET4.5):</p>\n\n<pre><code>from p in repository\nselect new Person() {\n    Name = p.Name, \n    Birthday = p.Birthday,\n    MyEnumValue = MyEnum.Value1\n};\n</code></pre>\n\n<p>where <em>MyEnumValue</em> is <strong>enum</strong> defined like:</p>\n\n<pre><code>public enum MyEnum : byte\n{\n    Value1 = 1,\n    Value2 = 2\n}\n</code></pre>\n\n<p>At runtime this code causing the exception:</p>\n\n<p><em>The specified cast from a materialized 'System.Byte' type to the 'MyApp.Domain.Models.MyEnum' type is not valid.</em></p>\n\n<p>But if I change enum definition to</p>\n\n<pre><code>public enum MyEnum { ... }\n</code></pre>\n\n<p>all works fine.</p>\n\n<p>Is it possible to fix exception don't change MyEnum to int? (and without additional byte property :) )</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","plugins","mef","repository-pattern"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":12172610,"title":"Entity Framework Plugin Architecture Recommendation","body":"<p>I am trying to build a modularized ASP.NET MVC application using Areas and Dependency Injection. The application currently consists of the following projects:</p>\n\n<ul>\n<li><strong>Framework.Contracts</strong> (Interfaces for Authentication Service, Authorization, Logging)</li>\n<li><strong>Framework</strong> (Implementation of Authentication Service, Authorization, ...)</li>\n<li><strong>Framework.Web</strong> (MVC Web Application)</li>\n</ul>\n\n<p>Each plugin consists of an MVC Area project, contracts and service implementation:</p>\n\n<ul>\n<li><strong>EmployeesPlugin.Contracts</strong> (Interfaces for IEmployeesService)</li>\n<li><strong>EmployeesPlugin</strong> (Implentation for IEmployeesService)</li>\n<li><strong>EmployeesPlugin.MVC</strong> </li>\n</ul>\n\n<p>I want to use Entity Framework Database First or Model First (since I have to connect an existing database). My problem is that I do not know how to loosly couple my entities. I do not want to put them into a single shared DatabaseLayer project. Rather I would like to define central entities (User, Settings, LogEntries, ...) for the Framework project and additional entities (like Employee, Company) for each plugin. </p>\n\n<p>After reading <a href=\"http://stackoverflow.com/questions/5260200/orm-architecture-one-or-multiple-models-entity-framework\">ORM Architecture: One or Multiple Models (Entity Framework)</a> I thought about creating multiple Models (i.e. Multiple Data Contexts). Actually I do not like the idea of having redudant code. </p>\n\n<p>I thought about creating interfaces that expose the properties of each entity. These interfaces will be put in a project per Plugin. Like <code>IEmployee</code> exposing <code>FirstName</code> and <code>LastName</code>. Then I started to create an <code>IEmployeeRepository</code> to return and create, edit and delete Employees. However creating employees does not work when only exposing <code>IEmployee</code> and no concrete class. </p>\n\n<p>Another problem is that the entity <code>Employee</code> contains references to entities in other projects/plugins. Lets say a employee hosts a number of projects. Thus I thought to create a generic <code>IEmployee</code> interface without the reference to the project and an <code>IEmployeeProjects</code> interface containing the reference to the projects. That way I could create a class <code>Employee</code> in a central database layer project that implement both <code>IEmployee</code> add `IEmployeeProjects:</p>\n\n<pre><code>public class Employee : IEmployee, IEmployeeProjects\n{   \n    // From IEmployee interface\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n\n    // From IEmployeeProject interface\n    public virtual ICollection&lt;Project&gt; Projects { get; set; }\n}\n</code></pre>\n\n<p>The problem is that I do not know how to plump things together using the Entity framework. </p>\n"},{"tags":[".net","entity-framework","entity-framework-4.1"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":938,"score":0,"question_id":5458925,"title":"type error in EF 4.1","body":"<p>I have created an entity and it has a key of type Int. when I run the project and use this entity I get following error:</p>\n\n<blockquote>\n  <p>The 'Id' property on 'Product' could\n  not be set to a 'Int64' value. You\n  must set this property to a non-null\n  value of type 'Int32'.</p>\n</blockquote>\n\n<p>How can I fix it ?</p>\n\n<p>Edit:</p>\n\n<p>I am using SQL server and entity framework 4.1. I get error in controller action: </p>\n\n<pre><code>public ActionResult Test(long id) \n{ \n    return View(repository.GetObligor(id)); \n}\n</code></pre>\n"},{"tags":["entity-framework","appharbor"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":398,"score":2,"question_id":8199500,"title":"Connection string \"Unable to load the specified metadata resource\" Issue","body":"<p>I am trying to connect my Entity Framework mappings to be integrated with an Sql server on a hosted site.</p>\n\n<p>This issue can be found in the following stack trace:</p>\n\n<pre><code>[MetadataException: Unable to load the specified metadata resource.]\n   System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.LoadResources(String assemblyName, String resourceName, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver) +387\n   System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource..ctor(String originalPath, String assemblyName, String resourceName, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver) +72\n   System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.CreateResourceLoader(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver) +222\n   System.Data.Metadata.Edm.MetadataArtifactLoader.Create(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver) +74\n   System.Data.Metadata.Edm.MetadataArtifactLoader.Create(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry) +68\n</code></pre>\n\n<p>I am assume that my connection string is not being setup correctly, as I need to generate this string dynamically at runtime. The String looks as follows:</p>\n\n<pre><code>&lt;add name=\"Model1Container-providerConnectionString\" \n     connectionString=\"data source=something.sqlserver.sequelizer.com;\n     User ID=**; \n     Password=**;\n     Initial Catalog=dbd5d3955e11834e1088929f9d005af0a8;\n     user instance=True;multipleactiveresultsets=True;App=EntityFramework\" /&gt;\n</code></pre>\n\n<p>Then on run time the string is constructed as follows:</p>\n\n<pre><code>    public static string GetConnectionString()\n    {\n        string baseConnectionString = ConfigurationManager.ConnectionStrings[\"Model1Container-providerConnectionString\"].ConnectionString;\n\n        EntityConnectionStringBuilder entityBuilder = new EntityConnectionStringBuilder();\n        entityBuilder.Provider = \"System.Data.SqlClient\";\n        entityBuilder.ProviderConnectionString = baseConnectionString;\n        entityBuilder.Metadata = @\"res://*/DBModel.csdl|res://*/DBModel.ssdl|res://*/DBModel.msl\";\n\n        return entityBuilder.ToString();\n    }\n}\n</code></pre>\n\n<p>Been working on this issue for a few days now, would very much appreciate the communities expertise in finding a working solution.</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":821,"score":3,"question_id":5500657,"title":"problem with navigation properties in entity framework","body":"<p>When I execute this query I can navigate in <code>TypeP</code> property:</p>\n\n<pre><code>var items = from item in context.ProductosBodegas.Include(\"Product.TypeP\")\n            select item;\n</code></pre>\n\n<p>But when I execute this query the <code>TypeP</code> Property is <code>null</code>:</p>\n\n<pre><code>var items = from item in context.ProductosBodegas.Include(\"Product.TypeP\")\n            select item.Product;\n</code></pre>\n\n<p>Why is this?</p>\n"},{"tags":["entity-framework","dynamics-crm-2011"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":13128563,"title":"Cannot add Currency field to Entity after Importing","body":"<p>A custom entity was created in our DEV environment.  It originally had a Currency field, but we decided to remove it and use a Float field for simplicity.  After exporting the solution and importing it into QA for the first time, I can no longer add a Currency field to the entity in QA (and the \"leftover\" transactioncurrencyid column in DEV did not get migrated to QA).</p>\n\n<p>The main problem is that I cannot remove the transactioncurrencyid column and now my Filtered views are different between DEV and QA which causes our SharePoint BCS process that relies on Entity Framework to fail.</p>\n\n<p>Is there any way to completely remove a currency field without recreating the entity?</p>\n\n<p>Plan B: Is there a way to restore a past copy of the entity (prior to removing the currency) from a backup and merge it into our presently broken version? </p>\n\n<p>Plan C: any other ideas (convert EF to use Stored Procs, etc)?</p>\n\n<p>Thanks!</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13167777,"title":"Entity Framework Update related entity","body":"<p>I get an error message while trying to update related entity.</p>\n\n<p>When create new one is OK.</p>\n\n<p>The error message say : </p>\n\n<p><em>A referential integrity constraint violation occurred: The property values that define the \nreferential constraints are not consistent between principal and dependent objects in the relationship.</em></p>\n\n<p><strong>Please review my codes, and advice me what I am doing wrong.</strong></p>\n\n<p>First of all, DB is Mysql MyISAM.</p>\n\n<p>Entity Class</p>\n\n<pre><code>[Table(\"note\")]\npublic class Note\n{\n    [Key]\n    public int id { get; set; }\n\n    [Required(ErrorMessage=\"Content is required\")]\n    [DisplayName(\"Note\")]\n    public string content { get; set; }\n    public DateTime date { get; set; }\n\n    [Required(ErrorMessage = \"User ID is required\")]\n    [DisplayName(\"User ID\")]\n    public string userId {get; set;}\n    public Boolean isPrivate { get; set; }\n\n    [DisplayName(\"Attach File\")]\n    public virtual ICollection&lt;AttachedFile&gt; AttachedFiles { get; set; }\n\n}\n\n[Table(\"attachedfile\")]\npublic class AttachedFile\n{\n    [Key]\n    public int id { get; set; }\n    public int noteId { get; set; }\n    public string fileName { get; set; }\n}\n</code></pre>\n\n<p>Controller,</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Index(Note note, HttpPostedFileBase attFile)\n{\n    try\n    {\n    if (ModelState.IsValid)\n    {\n        updateAttachFile(note, attFile);\n        if (note.id &gt; 0)\n        {\n        unitOfWork.NoteRepository.UpdateNote(note);\n        }\n        else\n        {\n        unitOfWork.NoteRepository.InsertNote(note);\n        }\n\n        unitOfWork.Save();\n        return RedirectToAction(\"Index\");\n    }\n    }catch(DataException){\n    ModelState.AddModelError(\"\", \"Unable to save changes. Try again please\");\n    }\n\n    var notes = unitOfWork.NoteRepository.GetNotes();\n    return View(new NoteViewModel() { noteList = notes.ToList(), note = new Note() });\n}\n\nprivate void updateAttachFile(Note note,HttpPostedFileBase attFile)\n{\n    if (attFile == null) return;\n\n    List&lt;AttachedFile&gt; list;\n    if (note.id &gt; 0)\n    {\n    list = unitOfWork.AttachedFileRepository.Get(filter: q =&gt; q.noteId.Equals(note.id)).ToList();\n    }\n    else\n    {\n    list = new List&lt;AttachedFile&gt;();\n    }\n\n    var fileName = Path.GetFileName(attFile.FileName);\n    fileName = fileName.Replace(\" \", \"\");\n    fileName = Regex.Replace(fileName, @\"\\s|\\$|\\#\\%\", \"\");\n    var path = Path.Combine(Server.MapPath(\"~/App_data/uploads\"), fileName);\n    attFile.SaveAs(path);\n\n    list.Add(new AttachedFile\n    {\n    fileName = fileName\n    });\n\n    note.AttachedFiles = list;\n}\n}\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/bXLpt.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","visual-studio","entity-framework","msbuild"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13105885,"title":"Entity Framework build exits with warnings and will not run tests after cloning the CodePlex repo","body":"<p>I am trying to build EF after following <a href=\"http://entityframework.codeplex.com/documentation\" rel=\"nofollow\">these instructions</a>. Everything seems to have completed successfully, but when I run build.cmd I get two warnings:</p>\n\n<blockquote>\n  <p>C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Microsoft.Common.targets(1578,5):\n  warning MSB3245: Could not resolve this reference. Could not locate\n  the assembl y \"Microsoft.VisualStudio.QualityTools.UnitTestFramework,\n  Version=10.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a,\n  processorArchitecture=MSIL\". Chec k to make sure the assembly exists\n  on disk. If this reference is required by your code, you may get\n  compilation errors. [C:\\Users\\Chasemedallion\\Documents\\entityframework\\test\\EntityFramework\\VBTests\\VBTests.vbproj]</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Microsoft.Common.targets(1988,5):\n  warning MSB3283: Cannot find wrapper assembly for type library\n  \"EnvDTE\". Verify  that (1) the COM component is registered correctly\n  and (2) your target platform is the same as the bitness of the COM\n  component. For example, if the COM component is 32-bit, your target\n  platform must not be 64-bit.\n  [C:\\Users\\Michael\\Documents\\Interests\\CS\\entityframework\\src\\EntityFramework.PowerShell\\EntityFramework.PowerShell.csproj]</p>\n</blockquote>\n\n<p>After the second warning, the command exits and does not run any tests, even when run with /t:Test. Can anyone give me pointers on what these errors are or how I can resolve them? Strangely, I see neither warning when I build from VS2012 Express (Desktop) with Ctrl+Shift+B.</p>\n\n<p>Also, I've confirmed that Microsoft.VisualStudio.QualityTools.UnitTestFramework.dll is in C:\\Program Files\\Microsoft Visual Studio 11.0\\Common7\\IDE\\PublicAssemblies.</p>\n"},{"tags":["sql-server-2008","entity-framework","sql-server-express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13168166,"title":"\"The underlying provider failed on Open\" Entity Framework error","body":"<p>I've been getting the error \"The underlying provider failed on Open.\" recently and I've been pulling my hair out trying to figure out why.  On closer inspection of the error the inner exception is \"The connection was not closed. The connection's current state is connecting.\" and the stack trace is </p>\n\n<pre><code>\"at System.Data.ProviderBase.DbConnectionClosedConnecting.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)\n   at System.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry)\n   at System.Data.SqlClient.SqlConnection.Open()\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\"\n</code></pre>\n\n<p>As far as I can tell the error seems to happen at random or possibly when making changes to the application.  Any help would be greatly appreciated.</p>\n\n<p>My current setup is</p>\n\n<ul>\n<li>IIS Express</li>\n<li>Microsoft SQL Server Express Edition</li>\n<li>Visual Studio 2012</li>\n<li>MVC Web API \\ Asp.net MVC 4</li>\n<li>Entity Framework 5</li>\n</ul>\n\n<p>My data layer is modeled off the Repository pattern and injected via Structure map.</p>\n\n<p><strong>Repository</strong></p>\n\n<pre><code>public class Repository&lt;T&gt; : IDisposable, IRepository&lt;T&gt; where T : class\n{\n    private readonly DbSet&lt;T&gt; _dbSet;\n    private readonly DbContext _dbContext;\n\n    public Repository(IDbContextFactory&lt;MyContext&gt; dbContextFactory)\n    {\n        _dbContext = dbContextFactory.Create();\n        _dbSet = _dbContext.Set&lt;T&gt;();\n    }\n\n    //removed for brevitity\n\n    public void Dispose()\n    {\n        _dbContext.Dispose();\n    }\n</code></pre>\n\n<p><strong>DbContextFactory</strong></p>\n\n<pre><code>public class MyContextFactor : IDbContextFactory&lt;MyContext&gt;, IDisposable\n{\n    private MyContext _dataContext;\n\n    public MyContextFactor Create()\n    {\n        return _dataContext ?? (_dataContext = new MyContext());\n    }\n\n    public void Dispose()\n    {\n        _dataContext.Dispose();\n    }\n}\n</code></pre>\n\n<p><strong>Structure Map Registry for IOC</strong></p>\n\n<pre><code>For(typeof(IDbContextFactory&lt;MyContext&gt;)).HybridHttpOrThreadLocalScoped().Use(typeof(MyContextFactory));\n</code></pre>\n\n<p><strong>Connection String</strong></p>\n\n<pre><code>&lt;add name=\"MyContextConnectionString\" connectionString=\"metadata=res://*/Model.MyProject.csdl|res://*/Model.MyProject.ssdl|res://*/Model.MyProject.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=(local);initial catalog=MyDB;User Id=SQLUser;Password=****;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\"/&gt;\n</code></pre>\n\n<p>Things I've attempted to fix the problem and so far haven't worked</p>\n\n<ul>\n<li>ensure context is per http context via structure map scope</li>\n<li>added dispose to repository</li>\n<li>added dispose to ContextFactory</li>\n<li>switched from Intergrated Sql auth to Sql authentication</li>\n</ul>\n"},{"tags":["asp.net-mvc","entity-framework","one-to-many"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13166025,"title":"Update EF ICollection property","body":"<p>How do I update a ICollection property in EF?</p>\n\n<p>I get this error message;</p>\n\n<p>\"Cannot implicitly convert type 'int' to '<code>System.Collections.Generic.ICollection&lt;MySolution.Domain.UserProfile&gt;</code>'\"</p>\n\n<p>My entities:</p>\n\n<pre><code>public class Department\n{\n    public virtual int Id { get; set; }\n    public virtual string DepartmentTitle { get; set; }\n    public virtual ICollection&lt;UserProfile&gt; UserProfiles { get; set; }\n\n}\n\npublic class UserProfile\n{\n    public virtual int UserId { get; set; }\n    public virtual string UserName { get; set; }\n    public virtual string FirstName { get; set; }\n    public virtual string LastName { get; set; }\n\n}\n</code></pre>\n\n<p>Code;</p>\n\n<pre><code>    var userProfile = _db.UserProfiles.Single(d =&gt; d.UserName == \"SomeUserName\");\n\n    var department = _db.Departments.Single(d =&gt; d.Id == variableDepartmentID);\n    department.UserProfiles = uProfile.UserId;\n    _db.UpdateDepartment(department);\n    _db.Save();\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13110849,"title":"Entity Framework query - auto-compile is off, but still the second query is much faster","body":"<p>I got .net 4.0 with Entity Framework 4.0 with Visual Studio 2012 and Windows 7, 64bit architecture, 4 cores. </p>\n\n<p>I'm performing some tests on a console application with the AdventureWorks database. The thing that is bothering me is that the first time I take some products it takes much more time than the second time, I want to know why. </p>\n\n<p>I know that there are some tasks that Entity Framework perform during it's first query, so I executed some extra query ahead. </p>\n\n<p>For example, my main function contains the following : </p>\n\n<pre><code>using (var context = new Context())\n{\n   execute context.Clients.ToList();   // &lt;- this takes something like 300 ms\n}\n\nusing (var context = new Context())\n{\n   execute context.Products.ToList();   // &lt;- this takes something like 200 ms\n}\n\nusing (var context = new Context())\n{\n   execute context.Products.ToList();   // &lt;- this takes something like 10 ms\n}\n</code></pre>\n\n<p>So you see that the first query with all the \"first time execution\" things is taking 300 ms. </p>\n\n<p>The second takes 200s, and the third one, which is the same like the second takes only 10ms. </p>\n\n<p>So my question is : why is my third query taking such a small amount of time ? I do not use auto-compile (since there is no such in EF 4.0), or the CompiledQuery class. </p>\n\n<p>Also my first invocation to Products is not the first query on the model, so all the work for view generation should be already done. </p>\n\n<p>But still it takes so much time the first time and is so fast the second time I call Products. Does it cache something somewhere ?</p>\n\n<p>Another thing I noticed is that when I compile it for 64 bit, it takes a ridiculous amount of time, something like one second. And when I compile it for 32 bit, it takes the amount I had given. </p>\n\n<p>Can you give me some hints here ? </p>\n\n<p>Thanks </p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":6,"up_vote_count":13,"down_vote_count":0,"view_count":9226,"score":13,"question_id":2185155,"title":"Cloning data on Entity Framework","body":"<p>I am creating software where user can create new product based on older product.</p>\n\n<p>Now I need to make copying / cloning operations with Entity Framework. First I started writing like this:</p>\n\n<pre>\nforeach(sourcedata1 in table1)\n{\n   ... create new table\n   ... copy data\n   ... create Guid\n   ... add\n   foreach(sourcedata2 in table2)\n   {\n       ... create new table\n       ... copy data\n       ... create Guid\n       ... add       \n\n       ... and so on\n   }\n}\n</pre>\n\n<p>Problem is that this not a nice way to do it. Is there any easy way clone information (except Guid that needs to be generated for new rows) or should I manually copy everything?</p>\n\n<p><strong>Other solution</strong></p>\n\n<p>You could also use EmitMapper or AutoMapper to do copying of the properties.</p>\n"},{"tags":["c#",".net","winforms","entity-framework","version"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13157297,"title":"How can i retrieve the version of Entity Framework in a WinForms application","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/7315127/how-to-get-current-ef-version\">How to get current EF version</a>  </p>\n</blockquote>\n\n\n\n<p>In my windows forms application, I want to display the Entity Framework version being used by the applications .edmx files. Is it possible to get the Entity Framework version from the app.config file or the .edmx file in C#?.</p>\n"},{"tags":["visual-studio-2010","entity-framework",".net-3.5",".net-4.0","compatibility"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":791,"score":1,"question_id":4997890,"title":"Using Entity Framework 3.5 AND 4.0 in the Same Project","body":"<p>I'm wondering if using VS.Net 2010, I can have Entity Framework 3.5 code running along side 4.0 code. I have a project that I'm working on, some of it is currently written using EF 3.5. I'd like to start using EF 4.0 for anything new we add to the project, and convert the EF 3.5 stuff over a little at a time. Is it feasible to run the two side by side in the same project?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","automapper"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13163724,"title":"How can I accomplish the following mapping with Automapper?","body":"<p>I want to map the class (Entity),</p>\n\n<pre><code>public class Source {\n   public int x;\n   public string y;\n   public bool z;\n\n   public int a;\n   public int b;\n   public int c;\n\n   //bunch of other fields\n   //...\n   //..\n   //.\n}\n</code></pre>\n\n<p>to the following class (View Model):</p>\n\n<pre><code>public class Destination {\n   public MyClass1 A;\n   public MyClass2 B;\n}\n</code></pre>\n\n<p>where MyClass1, MyClass2 are defined as follows:</p>\n\n<pre><code>public class MyClass1 {\n   public int x;\n   public string y;\n   public bool z;\n}\n\npublic class MyClass2 {\n   public int a;\n   public int b;\n   public int c;\n}\n</code></pre>\n\n<p>Is this possible with Automapper?</p>\n"},{"tags":["c#","entity-framework","ef-code-first","sql-server-ce","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":1,"question_id":13162857,"title":"SqlCe Code First with Password EF5","body":"<p>I'm using Code First (EF5) with my WPF app, but I want the sdf file to be password protected. I've been googling and found nothing that could help me.</p>\n\n<p>I want to accomplish this inside my code, along with the <code>context.Database.Initialize(true)</code></p>\n"},{"tags":["c#","entity-framework","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13162944,"title":"Entity framework generic repository - Foreign key exception updating entity relationship","body":"<p>I have followed a EF repository pattern that I read about in Julie Lermans book Programming Entity Framework: Dbcontext</p>\n\n<p>I have an entity called Customer which has a many to many relationship with entity Favourite</p>\n\n<p>Here is some example code of an update to Customer</p>\n\n<pre><code>customer.CustomerLocation_ID = 5;     \n\ncustomer.Favourites.clear();\n\ncustomer.State = State.Modified;\ncustomerRepository.InsertOrUpdate(customer);\n</code></pre>\n\n<p>Insert will then do the following:</p>\n\n<pre><code>Entry(entity).State = EntityState.Modified;\n\nforeach (var entity in this.ChangeTracker.Entries&lt;IEntityState&gt;())\n{\n    IEntityState stateInfo = entity.Entity;\n    entity.State = StateHelpers.ConvertState(stateInfo.State);\n}\n</code></pre>\n\n<p>Then finally:</p>\n\n<pre><code>context.SaveChanges();\n</code></pre>\n\n<p>On save I get an unique key exception on Favourites because Favourites name is unique. But I am not adding anything into Favourites. </p>\n\n<p>When I remove the .clear() line, everything saves fine. </p>\n\n<p>Update:</p>\n\n<p>I added in this piece of code just trying out a few things and now it works. </p>\n\n<pre><code>foreach (var fav in customer.Favourites)\n{\n     fav.State = State.Modified;\n}\n</code></pre>\n\n<p>Does it mean that even though I am affecting the Customer I still need to mark the Favourites as modified so they are tracked and updated? I just didn't think I would have to do this.</p>\n"},{"tags":["c#","entity-framework","try-catch","repository-pattern","database-deadlocks"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":64,"score":4,"question_id":13159326,"title":"Implementing retry logic for deadlock exceptions","body":"<p>I've implemented a generic repository and was wondering if there is a smart way to implement a retry logic in case of a deadlock exception?</p>\n\n<p>The approach should be the same for all repository methods. So is there anyway I can avoid writing 'try/catch - call method again with retry-count', in every single method?</p>\n\n<p>Any suggetsion are welcome.</p>\n\n<p>A bit of my Repository code:</p>\n\n<pre><code>public class GenericRepository : IRepository\n{\n    private ObjectContext _context;\n\n    public List&lt;TEntity&gt; ExecuteStoreQuery&lt;TEntity&gt;(string commandText, params object[] parameters) where TEntity : class\n    {\n        List&lt;TEntity&gt; myList = new List&lt;TEntity&gt;();\n\n        var groupData = _context.ExecuteStoreQuery&lt;TEntity&gt;(commandText, parameters);\n\n        return myList;\n    }\n\n\n    public IQueryable&lt;TEntity&gt; GetQuery&lt;TEntity&gt;() where TEntity : class\n    {          \n        var entityName = GetEntityName&lt;TEntity&gt;();\n        return _context.CreateQuery&lt;TEntity&gt;(entityName);\n    }\n\n    public IEnumerable&lt;TEntity&gt; GetAll&lt;TEntity&gt;() where TEntity : class\n    {\n        return GetQuery&lt;TEntity&gt;().AsEnumerable();\n    }\n</code></pre>\n\n<p>EDIT: </p>\n\n<p><strong>1.Solution:</strong> </p>\n\n<p><em>Modified slightly from</em> <strong>chris.house.00</strong>'s <em>solution</em></p>\n\n<pre><code> public static T DeadlockRetryHelper&lt;T&gt;(Func&lt;T&gt; repositoryMethod, int maxRetries)\n    {\n        int retryCount = 0;\n\n        while (retryCount &lt; maxRetries)\n        {\n            try\n            {\n                return repositoryMethod();\n            }\n            catch (System.Data.SqlClient.SqlException e)\n            {\n                if (ex.Number == 1205)// Deadlock                         \n                    retryCount++;\n                else\n                    throw;                   \n            }\n        }\n        return default(T);\n    }\n</code></pre>\n\n<p>And you call it like this:</p>\n\n<pre><code>    public TEntity FirstOrDefault&lt;TEntity&gt;(Expression&lt;Func&lt;TEntity, bool&gt;&gt; predicate) where TEntity : class\n    {\n        return RetryUtility.DeadlockRetryHelper&lt;TEntity&gt;( () =&gt;p_FirstOrDefault&lt;TEntity&gt;(predicate), 3);\n    }\n\n    protected TEntity p_FirstOrDefault&lt;TEntity&gt;(Expression&lt;Func&lt;TEntity, bool&gt;&gt; predicate) where TEntity : class\n    {\n        return GetQuery&lt;TEntity&gt;().FirstOrDefault&lt;TEntity&gt;(predicate);\n    }\n</code></pre>\n"},{"tags":["c#","entity-framework","service","windows-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13161748,"title":"Use Entity Framework inside a ServiceBase class","body":"<p>I'm moving a routine that uses an Entity Framework edmx model to read data from a db and send to a web service.</p>\n\n<p>When the service tries to create the model, reading the connection string from the app.config I obtain the exception</p>\n\n<blockquote>\n  <p><em>Unable to initialize the configuration system</em> (translated into English)<br>\n  in System.Configuration.ConfigurationManager.get_ConnectionStrings()<br>\n  in System.Data.EntityClient.EntityConnection.ChangeConnectionString(String\n  newConnectionString)<br>\n  in System.Data.Objects.ObjectContext..ctor(String connectionString,\n  String defaultContainerName)</p>\n</blockquote>\n\n<p>Seems that I have some problems reading the config file.</p>\n\n<p>Same problem configuring system account or administrator.</p>\n\n<p>How can I solve this problem?</p>\n\n<p>luca</p>\n"},{"tags":["c#","entity-framework","datagridview","databound"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13155140,"title":"Filtering DataGridView rows when DataSource is bound to a EF5 Entity collection","body":"<p>I have a DataGridView which is databound to a BindingList</p>\n\n<pre><code>private void InitGrid()\n{\n    Ctx.MyEntitySet.Load();\n    dataGridView1.DataSource = Ctx.MyEntitySet.Local.ToBindingList();\n    dataGridView1.Columns[\"Id\"].Visible = false;\n    dataGridView1.Columns[\"UnwantedCol1\"].Visible = false;\n    dataGridView1.Columns[\"UnwantedCol2\"].Visible = false;\n    dataGridView1.Columns[\"UnwantedCol3\"].Visible = false;\n}\n</code></pre>\n\n<p>and a filtering TextBox, with a TextChanged event handled like this</p>\n\n<pre><code>private void textBoxFilter_TextChanged(object sender, EventArgs e)\n{\n    try\n    {\n        string filter = textBoxFilter.Text.Trim();\n        ((DataView)dataGridView1.DataSource).RowFilter = filter;\n        textBoxFilter.BackColor = SystemColors.AppWorkspace;\n    }\n    catch (Exception)\n    {\n        textBoxFilter.BackColor = Color.Red;\n        ToolTip tip = new ToolTip();\n        tip.SetToolTip(textBoxFilter, ex.Message);\n    }\n}\n</code></pre>\n\n<p>I run the code, the data is displayed correctly, but when I try to type something like <code>ColumnName like '%sometext%'</code> in my filter textbox, I get an exception saying I can't cast a 'System.Data.Entity.Internal.ObservableBackedBindingList`1[MyEntity]' to 'System.Data.DataView'.</p>\n\n<p>Can anyone give me a pointer?</p>\n\n<p>Thanks,\nF.</p>\n\n<p><strong>RESOLVED:</strong></p>\n\n<p>Added a generic extension method</p>\n\n<pre><code>public static class LocalExtensions\n{\n    public static IEnumerable&lt;T&gt; Filter&lt;T&gt;(this IEnumerable&lt;T&gt; list, Func&lt;T, bool&gt; filterParam)\n    {\n        return list.Where(filterParam);\n    }\n}\n</code></pre>\n\n<p>And modified TextChanged event handler like this:</p>\n\n<pre><code>private void textBoxFilter_TextChanged(object sender, EventArgs e)\n{\n    try\n    {\n        string filter = textBoxFilter.Text.Trim();\n\n        dataGridView1.DataSource =\n            Ctx.MyEntitySet.Local\n            .Filter(x =&gt;\n                x.EntityPropertyToSearchIn1.ToUpper().Contains(filter.ToUpper()) ||\n                x.EntityPropertyToSearchIn2.ToUpper().Contains(filter.ToUpper())\n            ).ToList();\n\n        textBoxFilter.BackColor = SystemColors.AppWorkspace;\n    }\n    catch (Exception)\n    {\n        textBoxFilter.BackColor = Color.Red;\n        ToolTip tip = new ToolTip();\n        tip.SetToolTip(textBoxFilter, ex.Message);\n    }\n}\n</code></pre>\n"},{"tags":["asp.net","entity-framework","dynamic-data","objectcontext","asp.net-dynamic-data"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13161198,"title":"Getting a reference of \"current\" ObjectContext inside an ASP.NET Dynamic Data application","body":"<p>This is the first time I use ASP.NET Dynamic Data, so excuse me if my question sounded stupid. Anyway, I need a way to access the <code>ObjectContext</code> instance the application uses to get and save data to the database. I do not want to create a new instance because that would beat the purpose of what I'm currently doing. So is that even possible?</p>\n"},{"tags":["sql","vb.net","entity-framework","stored-procedures","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13126213,"title":"Entity Framework does not map 2 columns from a SqlQuery calling a stored procedure","body":"<p>I'm using Code First and am trying to call a stored procedure and have it map to one of my classes. I created a stored procedure, BOMComponentChild, that returns details of a Component with information of its hierarchy in PartsPath and MyPath. I have a class for the output of this stored procedure. I'm having an issue where everything except the two columns, PartsPath and MyPath, are being mapped correctly with these two properties ending up as Nothing. I searched around and from my understanding the mapping bypasses any Entity Framework name mapping and uses column name to property name. The names are the same and I'm not sure why it is only these two columns.</p>\n\n<p>The last part of the stored procedure is:</p>\n\n<pre><code>SELECT   t.ParentID\n        ,t.ComponentID\n        ,c.PartNumber\n        ,t.PartsPath\n        ,t.MyPath\n        ,t.Layer\n        ,c.[Description]\n        ,loc.LocationID\n        ,loc.LocationName\n        ,CASE WHEN sup.SupplierID IS NULL THEN 1 ELSE sup.SupplierID END AS SupplierID\n        ,CASE WHEN sup.SupplierName IS NULL THEN 'Default' ELSE sup.SupplierName END AS SupplierName\n        ,c.Active\n        ,c.QA\n        ,c.IsAssembly\n        ,c.IsPurchasable\n        ,c.IsMachined\n        ,t.QtyRequired\n        ,t.TotalQty\n\nFROM    BuildProducts                       t \n        INNER JOIN [dbo].[BOMComponent]     c       ON c.ComponentID    = t.ComponentID         \n        LEFT JOIN [dbo].[BOMSupplier]       bsup    ON bsup.ComponentID = t.ComponentID AND bsup.IsDefault = 1\n        LEFT JOIN [dbo].[LookupSupplier]    sup     ON sup.SupplierID   = bsup.SupplierID\n        LEFT  JOIN [dbo].[LookupLocation]   loc     ON loc.LocationID   = c.LocationID\nWHERE \n        (@IsAssembly IS NULL OR IsAssembly = @IsAssembly)\nORDER BY\n         t.MyPath\n</code></pre>\n\n<p>and the class it maps to is:</p>\n\n<pre><code>Public Class BOMComponentChild\n\n        Public Property ParentID As Nullable(Of Integer)\n        Public Property ComponentID As Integer\n        Public Property PartNumber As String\n        Public Property MyPath As String\n        Public Property PartsPath As String\n        Public Property Layer As Integer\n        Public Property Description As String\n        Public Property LocationID As Integer\n        Public Property LocationName As String\n        Public Property SupplierID As Integer\n        Public Property SupplierName As String\n        Public Property Active As Boolean\n        Public Property QA As Boolean\n        Public Property IsAssembly As Boolean\n        Public Property IsPurchasable As Boolean\n        Public Property IsMachined As Boolean\n        Public Property QtyRequired As Integer\n        Public Property TotalQty As Integer\n\n        Public Property Children As IDictionary(Of String, BOMComponentChild) = New Dictionary(Of String, BOMComponentChild)\n\n    End Class\n</code></pre>\n\n<p>I am trying to call it like this:</p>\n\n<pre><code>Me.Database.SqlQuery(Of BOMComponentChild)(\"EXEC [BOMComponentChild] @ComponentID, @PathPrefix, @IsAssembly\", params).ToList()\n</code></pre>\n\n<p>When I run the stored procedure in management studio, the columns are correct and not null. I just can't figure out why these won't map as they are the important information in the stored procedure. The types for PartsPath and MyPath are varchar(50).</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>So I realized the only difference between those columns and the other ones is that they are made with casts. I replaced them in the end select with a static string and they were mapped correctly. When i replaced the last select with the 'test' i get the values are mapped. What is wrong with my CASTs if they are displayed correctly on in a SQL query.</p>\n\n<pre><code>;WITH BuildProducts ( ParentID, ComponentID, PartNumber\n                    ,PartsPath, MyPath, QtyRequired, TotalQty, Layer)\nAS\n(\n    SELECT   ...\n            ,@PathPrefix                        AS PartsPath\n            ,CAST(@PathPrefix +  \n                    CAST(ComponentID            AS varchar(4))  +\n                    '/'                         AS varchar(50)\n                  )                             AS MyPath\n            ,... \n    FROM    [dbo].[BOMComponent]            \n    WHERE   ...\n\n    UNION ALL\n\n    SELECT   ...\n            ,CAST(b.PartsPath + \n                    CAST(a.ParentID             AS varchar(4))  +\n                    '/'                         AS varchar(50)\n                  )                             AS PartsPath\n            ,CAST(b.PartsPath + \n                    CAST(a.ParentID             AS varchar(4))  +\n                    '/'                                         +\n                    CAST(a.ComponentID          AS varchar(4))  +\n                    '/'                         AS varchar(50)\n                  )                             AS MyPath\n            ,...\n    FROM    [dbo].[BOMAssembly]             a \n            INNER JOIN [dbo].[BOMComponent] c ON a.ComponentID = c.ComponentID\n            ...\n)\n\nSELECT  -- t.PartsPath\n        --,t.MyPath\n        'test' As PartsPath\n        ,'test' As MyPath\n        ,...\n\nFROM    BuildProducts                       t \n        ...\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":6,"up_vote_count":18,"down_vote_count":0,"view_count":5447,"score":18,"question_id":4995642,"title":"Add index with entity framework code first (CTP5)","body":"<p>Is there a way to get EF CTP5 to create an index when it creates a schema?</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13151503,"title":"Entity Framework - Store parent reference on child relationship (one -> many)","body":"<p>I have a setup like this:</p>\n\n<pre><code>[Table(\"tablename...\")]\npublic class Branch\n{\n    public Branch()\n    {\n        Users = new List&lt;User&gt;();\n    }\n    [Key]\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public List&lt;User&gt; Users { get; set; }\n}\n\n[Table(\"tablename...\")]\npublic class User\n{\n    [Key]\n    public int Id {get; set; }\n    public string Username { get; set; }\n    public string Password { get; set; }\n    [ForeignKey(\"ParentBranch\")]\n    public int? ParentBranchId { get; set; } // Is this possible?\n    public Branch ParentBranch { get; set; } // ???\n}\n</code></pre>\n\n<p>Is it possible for the User to know what parent branch it belongs to?  The code above does not populate the ParentBranch.</p>\n\n<p>Entity Framework version 5.0\n.NET 4.0\nc#</p>\n"},{"tags":["entity-framework","nhibernate","orm"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1104,"score":1,"question_id":6812865,"title":"Code First Entity Framework Or NHibernate","body":"<p>I'm pretty new to Code First EF 4.1 and NHibernate.\nI need to develop a ORM that must have following features.</p>\n\n<ol>\n<li>Perform CRUD with composite key</li>\n<li>Use Custom SQL Statement for some case.</li>\n<li>Can change connection at run time.</li>\n<li>Can Log SQL Statement before or after execution.</li>\n<li>Need to support Both MS SQL and Oracle.</li>\n</ol>\n\n<p>I'm a bit confuse which one to choose.\nPlease kindly advice.</p>\n"},{"tags":["performance","entity-framework","entity-framework-4","linq-to-entities"],"answer_count":2,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":1140,"score":6,"question_id":5458762,"title":"Entity Framework queries speed","body":"<p>Recently I started to learning Entity Framework.</p>\n\n<p>First question made in my mind is: </p>\n\n<p>When we want to use LINQ to fetching data in EF, every query like this:</p>\n\n<pre><code>var a = from p in contacts select p.name ;\n</code></pre>\n\n<p>will be converts to SQL commands like this :</p>\n\n<pre><code>select name from contacts\n</code></pre>\n\n<ol>\n<li>does this converting repeat every time that we are querying?</li>\n<li>I heard that stored procedures are cached in database, does this event happens in LINQ queries in Entity Framework ?</li>\n</ol>\n\n<p>And at last is my question clear?</p>\n"},{"tags":["javascript","entity-framework","breeze"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13091476,"title":"Uncaught Error: Unable to recognize DataType for: Edm.Self.Address with breezejs","body":"<p>I get the error when trying to use breezejs, the type is a complex type from entity framework (code first).</p>\n\n<p>Uncaught Error: Unable to recognize DataType for: Edm.Self.Address </p>\n\n<p>Are there any workarounds for using complex types with breezejs?.\nfrom my entity framework model:</p>\n\n<pre><code>public class Address\n{\n    public string Id { get; set; }\n    public string Street { get; set; }\n    public string City { get; set; }\n    public string ZipCode { get; set; }\n    public string Contry { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13129512,"title":"Can I exclude an update on a object in entity framework?","body":"<p>I have an object in my entity model ( it is a view in the db getting data over a linked server). Anyways, when I call contex.savechanges(), it updates everything that is changed in the object model. I don't want to update that certain object. Is there a way to exclude that object from updating? I haven't been able to find any properties or methods that would work.</p>\n\n<p>Thanks for any suggestions.\nBrian </p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13158486,"title":"Save stored procedure results in Dataset using Entity Framework","body":"<p>I use this method to query the database to get all the Valuations of a User. A table is returned with multiple rows and columns</p>\n\n<pre><code> public void UserValuationGet()\n {\n    using (FormValueEntities db = new FormValueEntities())\n    {\n      //Query the database for the Valuation\n      var valuation = db.ValuationOfUserGet(userName);         \n    }\n }\n</code></pre>\n\n<p>How can I save the valaution in a Dataset or is there any good tutorial on how to use the Entity Framework Complex types?</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":100,"score":1,"question_id":11508103,"title":"What are the Navigation Properties in Entity Framework","body":"<p>I am new to Entity Framework. When the Visual Studio creates Model diagram we can see mainly two things in Entities.Propertie and Navigation Properties,So what are these Navigation Properties? How to use them?</p>\n"},{"tags":["entity-framework","nhibernate","devexpress","upgrade","xpo"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":916,"score":1,"question_id":10679466,"title":"DevExpress XPO vs NHibernate vs Entity Framework: database upgrading issue","body":"<p>What is the best practice for upgrading the database using <em>ORM</em> (<a href=\"http://www.devexpress.com/Products/NET/ORM/\" rel=\"nofollow\">DevExpress XPO</a>, <a href=\"http://nhforge.org/Default.aspx\" rel=\"nofollow\">NHibernate</a> or <a href=\"http://msdn.microsoft.com/en-us/library/bb399572.aspx\" rel=\"nofollow\">MS Entity Framework</a>)?</p>\n\n<p>I'm starting a new project and have to pick an <em>ORM</em>. The development process requires of releasing intermediate test builds quite often and likely that each build will have changes in the database structure. Each new version has to upgrade the DB gently to keep current data. </p>\n\n<p>For old solutions I would provide a set of SQL scripts for upgrading the database from <em>v1</em> to <em>v2</em>, from <em>v2</em> to <em>v3</em>, etc. and execute them sequentially. </p>\n\n<p>But how is it going to work for <em>ORM</em>? Should I still write SQL scripts to upgrade the DB?</p>\n\n<p>I understand that simple adding new fields wouldn't cause a problem (e.g. see <a href=\"http://documentation.devexpress.com/#XPO/DevExpressXpoSession_UpdateSchematopic\" rel=\"nofollow\">UpdateSchema() method</a> for XPO), but what if I have to split a table and reallocate current records into 2 new tables?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":55,"score":3,"question_id":13130742,"title":"French accent not shown correctly in asp.net MVC view","body":"<p>I have an ASP.Net MVC View receiving a strongly typed model:</p>\n\n<p><code>@model MyApp.Models.MyModel</code></p>\n\n<p>When displaying properties values of this model, </p>\n\n<p>for example: <code>@Html.DisplayFor(model =&gt; model.myFrenchProperty)</code></p>\n\n<p>french characters are not shown correctly in browser.</p>\n\n<p>For example the french word \"Gnral\" is shown as \"Gnral\" in browser.</p>\n\n<p>I have try using @Html.Raw(Model.myFrenchProperty) but nothing change.</p>\n\n<p>My model is built with Entity Framework and data come from an UTF-8 encoded database.</p>\n\n<p>Any idea how to make this work properly?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13156165,"title":"In query in Entity Framework","body":"<p>I am working on Entity frame work, i have created a method which is returning List of my Table,\nI am retrieving data on base of grpID(which is foreign key, so i can have multiple records)\nI have saved these grpID's in an array so I want to run IN command on Entity framework so that i can get records in single List, How can i apply In command,my code is below</p>\n\n<pre><code> public List&lt;tblResource&gt; GetResources(long[] grpid)\n        {\n            try\n            {               \n                return dataContext.tblResource.Where(c =&gt; c.GroupId == grpid &amp;&amp; c.IsActive == true).ToList();//This code is not working as i am having array of groupIds\n\n            }\n            catch (Exception ex)\n            {                \n                return ex;\n            }\n        }\n</code></pre>\n"},{"tags":["asp.net-mvc","linq","entity-framework",".net-3.5"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":672,"score":2,"question_id":4645166,"title":"LINQ parent child relation","body":"<p>I'm working on the BLOG functionality in MVC. I need to be able to create 'blog comments'. So each comment may have a parent comment etc.</p>\n\n<p>Given table \"Comments\":\nCommentId -> int -> identity autoincrement\nPostId -> int\nParentId -> int\nComment -> string</p>\n\n<p><img src=\"http://i.stack.imgur.com/nxi2T.png\" alt=\"alt text\">       </p>\n\n<p>Is there a way to get a list of comments for a given article ordered by CreateDate and ParentId?</p>\n\n<p>Or maybe there is a better table design you may suggest. What is the best design when inserting Post comments like this?</p>\n\n<p>I'm using Entity framework.</p>\n\n<p>thanks</p>\n"},{"tags":["c#","entity-framework","automapper"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13156437,"title":"Mapping a DTO to an Entity with Automapper","body":"<p>I have an Entity Framework POCO with the following structure.</p>\n\n<pre><code>public class Entity\n{\n    public virtual int Id { get; set; }\n    public virtual string Name { get; set; }\n}\n</code></pre>\n\n<p>I've created a Data Transfer Object for this entity to be used by my views.</p>\n\n<pre><code>public class EntityDto\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n}\n</code></pre>\n\n<p>Now, I have the following mapping code in my Global.asax file.</p>\n\n<pre><code>Mapper.CreateMap&lt;Entity, EntityDto&gt;();\nMapper.CreateMap&lt;EntityDto, Entity&gt;(); // not sure whether I need this as well?\n</code></pre>\n\n<p>Everything is working fine, I pass the DTO to my views OK and I can create a new instance of <code>Entity</code> from my <code>EntityDto</code> model. The problem arises when I try to edit my <code>Entity</code>; I'm aware this is down to AutoMapper losing the Entity Key that EF creates to track changes to the object, but having read through a few sources there doesn't seem to be a definitive solution. Here is the action I'm using to edit my entity.</p>\n\n<pre><code>public ActionResult EditEntity(EntityDto model)\n{\n    var entity = context.Entities.Single(e =&gt; e.Id == model.Id);\n    entity = Mapper.Map&lt;EntityDto, Entity&gt;(model); // this loses the Entity Key stuff\n    context.SaveChanges();\n\n    return View(model);\n}\n</code></pre>\n\n<p>Now, what do I do to solve this?  Can I:</p>\n\n<ol>\n<li>Somehow tell AutoMapper to <code>.Ignore()</code> the Entity Key properties?</li>\n<li>Get AutoMapper to copy out the Entity Key properties?</li>\n<li><code>.Attach()</code> my mapped <code>Entity</code> and set the state to modified?</li>\n</ol>\n\n<p>Any help always appreciated.</p>\n"},{"tags":["c#","javascript","asp.net","entity-framework","typescript"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":13139963,"title":"Cannot successfully delete record from the database","body":"<p>Am I doing something wrong? Everything seems to be OK, but the record doesn't get deleted from the database:</p>\n\n<p>C#</p>\n\n<pre><code>    @{\n    WebSecurity.RequireAuthenticatedUser();\n\n    myModel.OSFEntities database = new myModel.OSFEntities();\n\n    var productInformation = Request[\"Pi\"];\n\n    int productId = Convert.ToInt32(productInformation.Substring(0, productInformation.LastIndexOf(\"-\")));\n    string productType = productInformation.Substring(productInformation.LastIndexOf(\"-\", productInformation.Length)).Replace(\"-\", String.Empty);\n    var userId = WebSecurity.CurrentUserId;\n    DateTime date = DateTime.Now;\n    int quantity = 1;\n    string quoteId = \"\";\n\n    if (Request[\"Action\"] == \"Remove\")\n    {\n        if (Session[\"QuoteId\"] != null)\n        {\n            quoteId = (String)Session[\"QuoteId\"];\n\n            myModel.Quote quotes = database.Quotes.FirstOrDefault(\n                q =&gt; q.UserId == userId &amp;&amp; q.QuoteId == quoteId &amp;&amp; q.ProductId == productId &amp;&amp; q.ProductType == productType);\n\n            database.Quotes.DeleteObject(quotes);\n            database.SaveChanges();\n        }\n    }\n}\n</code></pre>\n\n<p>TypeScript:</p>\n\n<pre><code>function RemoveProductFromCart(e) {\n    // Remove from their Cart.\n    xhr.onreadystatechange = function () {\n        if (xhr.readyState == 4) {\n            if (xhr.status == 200) {\n                // The data is now stored in the responseText.\n                // Change value in textbox to 0 so user knows it's been\n                // removed from their cart.\n                var el = &lt;HTMLInputElement&gt;document.getElementById(e.id + \"-TB\");\n                if (el != null) {\n                    el.value = \"0\";\n                }\n            }\n\n            else {\n                // Server responded with a different response code.\n                alert(xhr.statusText);\n            }\n\n        }\n    }\n\n    var parameters = \"Pi=\" + encodeURIComponent(e.id) + \"&amp;\" + \"Action=Remove\";\n\n    xhr.open(\"POST\", \"../Cart.cshtml\");\n    xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n    xhr.setRequestHeader(\"Content-length\", parameters.length.toString());\n    xhr.setRequestHeader(\"Connection\", \"close\");\n    xhr.send(parameters);\n\n    return e.id;\n}\n</code></pre>\n\n<p>While debugging with <kbd>F12</kbd> Dev Tools, I see:</p>\n\n<p><img src=\"http://i.stack.imgur.com/MUURA.png\" alt=\"enter image description here\"></p>\n\n<p>... which leads me to believe that it's something wrong with my C# code. Why won't it delete from the database?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":186,"score":1,"question_id":11973825,"title":"EntityObject 5.x and Self Tracking Entities 5.x","body":"<p>Does anyone know the if/when/where behind the self-tracking entities template for the latest version of EF? Our team would like to move forward to be able to take advantage of the performance improvements that the EF team has documented, but we haven't been able to find any reference to the new T4 templates for self-tracking entities, which we are dependent upon. </p>\n\n<p>We've tried firing up the old template, but the framework has changed too much.</p>\n\n<p>There's a thread on MSDN about it, but it has not been updated in a while. (http://social.msdn.microsoft.com/Forums/en-US/adodotnetentityframework/thread/4993d0bf-94e8-4d14-aff1-3458b4ad467f/#889cc5f1-e267-448a-ae82-e3d705b7dfa5)</p>\n\n<p>Thanks.</p>\n"},{"tags":["linq","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13156693,"title":"Linq Left outer Join with all columns select and bind to Gridview","body":"<p>I am trying to bind grid view with Linq Left outer join (I want to select all columns from \"prdct in context.Products\")My Query is</p>\n\n<pre><code>     gridProducts.DataSource = (from prdct in context.Products\n                                      join comp in context.ProductCompanies\n                                      on prdct.productCompany equals comp.prdctCompId into firstJoin\n                                      from fj in firstJoin.DefaultIfEmpty()\n\n                                      join cat in context.ProductCategories on prdct.productCategory equals cat.prdctCatId\n                                      into finalresult\n                                      from fr in finalresult.DefaultIfEmpty()\n                                      select new\n                                      {\n                                          prd = prdct,\n                                          fj.prdctCompName,\n                                          fr.prdctCatName\n\n                                      }).ToList();\n\n\n            gridProducts.DataBind();\n</code></pre>\n\n<p>I have checked the SQL generated by query it is showing records in SQL server but it throws error in my application while binding to gridveiw. Error is :</p>\n\n<pre><code>   The data source for GridView with id 'grdD' did not have any properties or attributes from which to generate columns.  Ensure that your data source has content.\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13156281,"title":"Using Entity Framework for runtime defined metadata","body":"<p>We are actually analyzing the impact of migrating our current DataBase management system to the Entity Framework. As of today (before the migration), the product gives the ability for the end users to create their own object types within the ASP .Net application from the admin interface. These object types are then translated to DB table creation/deletion/update both for the fields and the tables. Typically, one user can create a new MyCar object type from the end-user interface, create some attributes, and once validated he can then create new values. This is obviously reflected in the database as a new MyCar table, two fields, and new inserts.</p>\n\n<p>The main question I'm having relates to the way Entity Framework can be integrated so that we could as a first step query these tables through Linq queries. I know that ideally we should either use the code-first or the model-first approach but we want to proceed step by step.</p>\n\n<p>After making a few researches it turns out that:</p>\n\n<ol>\n<li>The Entity Framework doesn't provide the ability to directly update the internal metadata</li>\n<li>We could take advantage of the dynamic Type creation so that the Entity Framework would be based on a code-first model (runtime, but still code-first :-)) and the dynamic queyword would allow us to retrieve the attributes through late binding. See this <a href=\"http://www.codeproject.com/Articles/206416/Use-dynamic-type-in-Entity-Framework-4-1-SqlQuery\" rel=\"nofollow\">linq</a>.</li>\n</ol>\n\n<p>Hope that I provided the big picture. Please tell me if I'm missing anything and if the approach described in the second bullet point seems to be the right answer for my problem. One of the challenge is also that fields or types can be created: if I have to go through runtime-created types using reflection I won't be able to do that. In this case I could use appdomains (and recreate a new one whenever I have to do a reset) but this could introduce new issues (accessibility / performance / entity framework incompatiblility with types defined in other appdomains / ...).</p>\n\n<p>I know quite well IQToolkit and I know how I could redefine the metadata at runtime easily without having to introduce .Net types - in this regard IQToolkit could be the prefered solution...</p>\n\n<p>Any suggestion are welcome!</p>\n"},{"tags":["wpf","entity-framework","validation","data-annotation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13156048,"title":"Database first and Wpf Entity Framework validation","body":"<p>I need to validate some user input in a c-sharp wpf desktop application. I'm using Entity framework with database-first approach. This is the class generated from the database by the Entity framework:</p>\n\n<pre><code>namespace TestValidation\n{\n    using System;\n    using System.Collections.Generic;\n\n    public partial class person\n    {\n        public string Name { get; set; }\n        public string Surname { get; set; }\n    }\n}\n</code></pre>\n\n<p>I'm trying to use a buddy class with DataAnnotations to implement validation:</p>\n\n<pre><code>using System.ComponentModel.DataAnnotations;\n\n    namespace TestValidation\n    {\n        [MetadataType(typeof(person_validation))]\n        public partial class person\n        {\n            public class person_validation\n            {\n                [Required]\n                public string Name { get; set; }\n            }\n        }\n    }\n</code></pre>\n\n<p>This is my xaml form:</p>\n\n<pre><code>&lt;Window\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\" xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" xmlns:local=\"clr-namespace:TestValidation\" mc:Ignorable=\"d\" x:Class=\"TestValidation.MainWindow\"\n        Title=\"MainWindow\" Height=\"350\" Width=\"525\" Loaded=\"Window_Loaded_1\"&gt;\n    &lt;Window.Resources&gt;\n        &lt;CollectionViewSource x:Key=\"personViewSource\" d:DesignSource=\"{d:DesignInstance {x:Type local:person}, CreateList=True}\"/&gt;\n    &lt;/Window.Resources&gt;\n    &lt;Grid&gt;\n        &lt;Grid x:Name=\"grid1\" DataContext=\"{StaticResource personViewSource}\" HorizontalAlignment=\"Left\" Margin=\"129,95,0,0\" VerticalAlignment=\"Top\"&gt;\n            &lt;Grid.ColumnDefinitions&gt;\n                &lt;ColumnDefinition Width=\"Auto\"/&gt;\n                &lt;ColumnDefinition Width=\"Auto\"/&gt;\n            &lt;/Grid.ColumnDefinitions&gt;\n            &lt;Grid.RowDefinitions&gt;\n                &lt;RowDefinition Height=\"Auto\"/&gt;\n            &lt;/Grid.RowDefinitions&gt;\n            &lt;Label Content=\"Name:\" Grid.Column=\"0\" HorizontalAlignment=\"Left\" Margin=\"3\" Grid.Row=\"0\" VerticalAlignment=\"Center\"/&gt;\n            &lt;TextBox x:Name=\"nameTextBox\" Grid.Column=\"1\" HorizontalAlignment=\"Left\" Height=\"23\" Margin=\"3\" Grid.Row=\"0\" Text=\"{Binding Name, Mode=TwoWay, NotifyOnValidationError=true, ValidatesOnExceptions=true}\" VerticalAlignment=\"Center\" Width=\"120\"/&gt;\n        &lt;/Grid&gt;\n        &lt;Button Content=\"Button\" HorizontalAlignment=\"Left\" Margin=\"162,217,0,0\" VerticalAlignment=\"Top\" Width=\"75\" Click=\"Button_Click_1\"/&gt;\n\n    &lt;/Grid&gt;\n&lt;/Window&gt;\n</code></pre>\n\n<p>The validation of the property \"Name\" doesn't work. Where is the problem?\nthx</p>\n"},{"tags":["c#","entity-framework","ado.net","mapping","entity-framework-4.1"],"answer_count":3,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":757,"score":6,"question_id":5960522,"title":"Understanding Entity Framework 4.1 Conventions","body":"<p>Are there any decent articles online that explain in detail how the conventions work in EF 4.1?  There was an article linked from Scott Gu's blog, but it was dated 2010, I think it was then in CTP 4.  Not sure if the conventions have beem modified since then.  But I don't understand how it works.  For example how does it know to use the table SkillType if I have this code (what does it look for?):</p>\n\n<pre><code>public DbSet&lt;SkillType&gt; SkillTypes { get; set; }\n</code></pre>\n\n<p>This is just 1 of my confusions, then there is foreign keys, primary keys, etc.  I need to familiarise myself with these conventions so any goof articles that I can read please let me know.  I did Google and couldn't get anything solid and concrete.</p>\n"},{"tags":["entity-framework","postgresql","devart","dotconnect"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13147330,"title":"How to query an Entity Framework entity for null field value with DotConnect for PostgreSQL","body":"<p>I observe a strange behavior when querying for null field an Entity Framework entity with the Devart DotConnect for PostgreSQL connector.</p>\n\n<p>For example: If I made the 2 following tests:</p>\n\n<pre>\nvar test1 = context.blocs.Where(x => x.id_bloc == null);\n\nvar test2 = context.blocs.Where(x => x.id_bloc == 100);\n</pre>\n\n<p>When checking for EF auto-generated SQL query I obtain the following results:</p>\n\n<p>Result for test1:</p>\n\n<pre>\n{SELECT \n CAST(NULL AS int) AS \"C1\",\n CAST(NULL AS varchar) AS \"C2\",\n CAST(NULL AS varchar) AS \"C3\",\n CAST(NULL AS varchar) AS \"C4\"\nFROM  ( SELECT 1 AS X) AS \"SingleRowTable1\"\nWHERE true = false}\n</pre>\n\n<p>Result for test2:</p>\n\n<pre>\n{SELECT \n\"Extent1\".id_bloc,\n\"Extent1\".numero,\n\"Extent1\".nom,\n\"Extent1\".titre\nFROM \"role\".bloc AS \"Extent1\"\nWHERE \"Extent1\".id_bloc = 100}\n</pre>\n\n<p>The result when querying for null field is very strange... I was expecting a result similar to the test 2 result but with an <code>\"Extent1\".id_bloc IS NULL</code> WHERE clause...</p>\n\n<p>Is it a bug? How can I effectively query for null field?</p>\n"},{"tags":["entity-framework","parent-child"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13148585,"title":"Entity Framework - Add Child Entity","body":"<p>Entity Framework 5.0 Code first with existing database.  Reverse engineered the classes with power tools.  Everything is working great.  Database has two tables.  One parent and one child with foreign key back to parent ID.  ID's are all int with auto increment.  I've added a number of parent records and now want to add child records to specific parents.  The only way I can see to do this is find the appropriate parent ID by searching the Parents table for a name or some other property and return the ID.  Then use that ID in the foreign key property when adding the child.  I don't want to crate a new parent so is this the only way to add a child to an existing parent?  All of the internet examples seem to add a child along with adding a new parent and not add a child to an existing parent.  Any help would be greatly appreciated</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13151773,"title":"EF4.1 eager loading query","body":"<p>I am using EF to implement a search function to search cars on a website. It's working fine, but I would like to optimise performance.\nCars have a make and model, and a number of images.\nIt's easy enough to include the make and model using .Include(), but I am having trouble with the images... at the moment, the main query is being executed, and then EF queries the db for each search result to get the images. I'd like to include this all in the one query.\nI can use .Include(), but that obviously loads all images, and I actually only want one (any) image. Is there a way of doing this?</p>\n\n<p>Thanks heaps!</p>\n"},{"tags":["c#","xml","entity-framework","asp.net-mvc-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13137800,"title":"Import a remote XML file into MVC 4 Webapp","body":"<p>I have a webapp that needs to import 3 different remote XML files every night. These files have student and parent information, study information, etc.</p>\n\n<p>Can someone point me to information how to read the XML (via http) and then loop over every student so I can add information from the other XML files and store the relations into my database?</p>\n\n<p>Need some example code like:</p>\n\n<ul>\n<li>Open &amp; read Parents XML and store in database with fixed Ids from XML file</li>\n<li>Open &amp; read Students XML and store in database AND link to their respective parents using the parent id's from the parent XML</li>\n<li>Also store study information for every student</li>\n</ul>\n\n<p>I need to know what my strategy would be. What would the smartest and most efficient method be to accomplish this using Entity Framework? </p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13134763,"title":"Generic repository constructor","body":"<p>I am trying to work with generic repositories in entity framework and came across this code below:</p>\n\n<pre><code>public class GenericRepository&lt;TContext, TEntity&gt; : IGenericRepository&lt;TEntity&gt;\nwhere TContext : IUnitOfWork\nwhere TEntity : class\n{\nprotected TContext _context;\n/// &lt;summary&gt;\n/// Constructor that takes a context\n/// &lt;/summary&gt;\n/// &lt;param name=\"context\"&gt;An established data context&lt;/param&gt;\npublic GenericRepository(TContext context)\n{\n    _context = context;\n}\n\npublic IQueryable&lt;TEntity&gt; Select()\n{\n    return _context.Set&lt;TEntity&gt;().AsQueryable();\n}\n\npublic IEnumerable&lt;TEntity&gt; GetAll()\n{\n    return _context.Set&lt;TEntity&gt;().AsEnumerable();\n}\n\npublic IEnumerable&lt;TEntity&gt; Where(Func&lt;TEntity, bool&gt; predicate)\n{\n    return _context.Set&lt;TEntity&gt;().Where(predicate);\n}\n\npublic TEntity GetSingle(Func&lt;TEntity, bool&gt; predicate)\n{\n    return _context.Set&lt;TEntity&gt;().Single(predicate);\n}\n\npublic TEntity GetFirst(Func&lt;TEntity, bool&gt; predicate)\n{\n    return _context.Set&lt;TEntity&gt;().First(predicate);\n}\n\npublic void Add(TEntity entity)\n{\n    if (entity == null)\n        throw new ArgumentException(\"Cannot add a null entity\");\n\n    _context.Set&lt;TEntity&gt;().Add(entity);\n}\n\npublic void Delete(TEntity entity)\n{\n    if (entity == null)\n        throw new ArgumentException(\"Cannot delete a null entity\");\n\n    _context.Set&lt;TEntity&gt;().Remove(entity);\n}\n\npublic void Attach(TEntity entity)\n{\n    if (entity == null)\n        throw new ArgumentException(\"Cannot attach a null entity\");\n\n    _context.Set&lt;TEntity&gt;().Attach(entity);\n}\n\n#region IDisposable implementation\nprivate bool disposedValue;\n\npublic void Dispose(bool disposing)\n{\n    if (!this.disposedValue)\n    {\n        if (disposing)\n        {\n            // dispose managed state here if required\n        }\n        // dispose unmanaged objects and set large fields to null\n    }\n    this.disposedValue = true;\n}\n\npublic void Dispose()\n{\n    Dispose(true);\n    GC.SuppressFinalize(this);\n}\n#endregion\n }\n</code></pre>\n\n<p>However I find it a little difficult to understand the need for the constructor created</p>\n\n<pre><code>/// &lt;summary&gt;\n/// Constructor that takes a context\n/// &lt;/summary&gt;\n/// &lt;param name=\"context\"&gt;An established data context&lt;/param&gt;\npublic GenericRepository(TContext context)\n{\n    _context = context;\n}\n</code></pre>\n\n<p>Can someone please explain the use of this? </p>\n\n<p>Thanks</p>\n"},{"tags":[".net","entity-framework","dependency-injection","unit-of-work","ef-database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13151086,"title":"Entity Framework 4.1 Database First Dependency Injection Unit of Work","body":"<p>Ok, there are tons of examples using unit of work with dependency injection for Code First, using generic repositories and all that good stuff.</p>\n\n<p>Does anyone have an example doing this with Database First (edmx with dbContext Generator (T4)), Stored Procedures as Function Imports, Unit of Work with dependency injection. </p>\n"},{"tags":["c#","jquery","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":59,"score":3,"question_id":13148577,"title":"ASP.NET MVC 3 NOT showing appropriate view, action called using jquery","body":"<p>I have a small problem.</p>\n\n<p>My action is :</p>\n\n<pre><code> public ViewResult SearchForRooms(int HotelDDL) \n    {\n\n        List&lt;Room&gt; roomsInHotel = bl.ReturnRoomsPerHotel(HotelDDL);\n\n        return View(roomsInHotel);\n    }\n</code></pre>\n\n<p>Here is the jquery that is calling the action:</p>\n\n<pre><code>&lt;script type=\"text/javascript\" language=\"javascript\"&gt;\n    $(document).ready(function () {\n        $(\"#HotelDDL\").change(function () {\n\n            var text = $(\"#HotelDDL option:selected\").text();\n            var value = $(\"#HotelDDL option:selected\").val();\n            alert(\"Selected text=\" + text + \" Selected value= \" + value);\n\n            $.post(\"/Home/SearchForRooms\",\n            {\n                HotelDDL: $(\"#HotelDDL option:selected\").val() \n            });\n        });\n    });\n&lt;/script&gt;\n</code></pre>\n\n<p>And finally, here is the View that should be called:</p>\n\n<pre><code>@model IEnumerable&lt;RoomReservation.Entities.Entities.Room&gt;\n\n@{\n    ViewBag.Title = \"Search\";\n}\n\n&lt;h2&gt;Result&lt;/h2&gt;\n\n&lt;table&gt;\n    &lt;tr&gt;\n        &lt;th&gt;\n            City\n        &lt;/th&gt;\n        &lt;th&gt;\n            Hotel\n        &lt;/th&gt;\n        &lt;th&gt;\n            Room label\n        &lt;/th&gt;\n        &lt;th&gt;\n            Number of beds\n        &lt;/th&gt;\n        &lt;th&gt;\n            Price per night\n        &lt;/th&gt;\n        &lt;th&gt;&lt;/th&gt;\n    &lt;/tr&gt;\n\n@foreach (var item in Model) {\n    &lt;tr&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelitem=&gt;item.Hotel.City.Name)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelItem =&gt; item.Hotel.Name)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelItem =&gt; item.Name)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelItem =&gt; item.NumberOfBeds)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelItem =&gt; item.PricePerNight)\n        &lt;/td&gt;\n    &lt;/tr&gt;\n}\n&lt;/table&gt;\n</code></pre>\n\n<p>Everthing is working ok (databse return all rooms correctly) except final view rendering.\nI have tried Phil's tool but it doesn't give me any suspicious hints:</p>\n\n<pre><code>RouteDebug.RouteDebugger.RewriteRoutesForTesting(RouteTable.Routes);\n</code></pre>\n\n<p>So, why is it not showing after jscript send it's post method to <code>SearchForRooms()</code>?\nThank you</p>\n\n<p>P.S. If you need any other piece of code please just say so.</p>\n"},{"tags":[".net","linq","entity-framework","many-to-many","expression-trees"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":13102342,"title":"Build a nested lambda Expression Tree for an Entity Framework Many to Many relationship?","body":"<p>I am trying to build an Entity Framework 4 Many to Many relationship filter, this is for a Dynamic Data project.  I know that I need to build an Expression Tree at run time, and I am familiar with doing this for something like a simple where expression like this:</p>\n\n<pre><code>private MethodCallExpression BuiltMethodCall(IQueryable _query, Type _ObjType, string _ColumnToSearch, string _SearchValue)\n{\nConstantExpression value = Expression.Constant(_SearchValue);\nParameterExpression _parameter = Expression.Parameter(_ObjType, \"value\");\nMemberExpression _property = Expression.Property(_parameter, _ColumnToSearch);\nBinaryExpression comparison = Expression.Equal(_property, value);\nLambdaExpression lambda = Expression.Lambda(comparison, _parameter);\n\n//Ex: Customers.Select(c =&gt; c).Where(value =&gt; (value.City == \"Seattle\"))\nMethodCallExpression _where = Expression.Call(typeof(Queryable), \"Where\", new Type[] { _query.ElementType }, new Expression[] {\n    _query.Expression,\n    Expression.Quote(lambda)\n});\nreturn _where;\n\n}\n</code></pre>\n\n<p>Just for simplicity, these examples use the Northwind database where there is a many to many join of (Customers &lt;- CustomerCustomerDemo -> CustomerDemographics). What I am having trouble with is building the expression tree when there is a nested lambda like in the expression below, where I am retrieving all customers who have a specific customer demographic.</p>\n\n<pre><code>string custDemogID = \"3\";\n\n//Get customers who have a particular demog\ndynamic cust = context.Customers.Where(c =&gt; c.CustomerDemographics.Any(cd =&gt; cd.CustomerTypeID == custDemogID));\n</code></pre>\n\n<p>How do I build the Expression tree having a \"where\" call, that includes the nested lambda for the \"Any\"?  Any help is appreciated, even if it is pseudo code on how to do it.  There is not much out the on this, I am desperate, please help!</p>\n"},{"tags":["entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":10445111,"title":"What's the best way to compare a list<int> with the database table id column","body":"<p>I have a <code>List&lt;int&gt;</code> collection which contains ids, I want to query out all the records in one database table which id in the collection.</p>\n\n<p>I know I can write a method to traverse the collection and write linq to entities like <code>from t in context.table where t.id=id select t</code>, but it means I must hit database as many times as how many ids in the collection, it obviously isn't what I want.</p>\n\n<p>Anyone can help?\nThx in advance!</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":594,"score":0,"question_id":10789028,"title":"Could not load file or assembly 'MySite (from [Computername])' or one of its dependencies. (Exception from HRESULT: 0x80131040)","body":"<p><strong>Hi,</strong></p>\n\n<p>When running my ASP.NET MVC application (using VS mini IIS) I get the following exception after updating table in the EnityFrameworkModel:</p>\n\n<pre><code>Server Error in '/' Application.\n\nCould not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.IO.FileLoadException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)\n\nSource Error: \n\nAn unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n\nAssembly Load Trace: The following information can be helpful to determine why the assembly 'myApp (from my-pc)' could not be loaded.\n\n\n=== Pre-bind state information ===\nLOG: User = my-PC\\my\nLOG: DisplayName = myApp (from my-pc)\n (Partial)\nWRN: Partial binding information was supplied for an assembly:\nWRN: Assembly Name: myApp (from my-pc) | Domain ID: 4\nWRN: A partial bind occurs when only part of the assembly display name is provided.\nWRN: This might result in the binder loading an incorrect assembly.\nWRN: It is recommended to provide a fully specified textual identity for the assembly,\nWRN: that consists of the simple name, version, culture, and public key token.\nWRN: See whitepaper http://go.microsoft.com/fwlink/?LinkId=109270 for more information and common solutions to this issue.\nLOG: Appbase = file:///C:/Users/my/Documents/Visual Studio 2010/Projects/myApp/myApp.Website/\nLOG: Initial PrivatePath = C:\\Users\\my\\Documents\\Visual Studio 2010\\Projects\\myApp\\myApp.Website\\bin\nCalling assembly : (Unknown).\n===\nLOG: This bind starts in default load context.\nLOG: Using application configuration file: C:\\Users\\my\\Documents\\Visual Studio 2010\\Projects\\myApp\\myApp.Website\\web.config\nLOG: Using host configuration file: \nLOG: Using machine configuration file from C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\config\\machine.config.\nLOG: Policy not being applied to reference at this time (private, custom, partial, or location-based assembly bind).\nLOG: Attempting download of new URL file:///C:/Windows/Microsoft.NET/Framework/v4.0.30319/Temporary ASP.NET Files/root/9ac245ea/5244fde2/myApp (from my-pc).DLL.\nLOG: Attempting download of new URL file:///C:/Windows/Microsoft.NET/Framework/v4.0.30319/Temporary ASP.NET Files/root/9ac245ea/5244fde2/myApp (from my-pc)/myApp (from my-pc).DLL.\nLOG: Attempting download of new URL file:///C:/Users/my/Documents/Visual Studio 2010/Projects/myApp/myApp.Website/bin/myApp (from my-pc).DLL.\nWRN: Comparing the assembly name resulted in the mismatch: NAME\nERR: Failed to complete setup of assembly (hr = 0x80131040). Probing terminated.\n\nStack Trace: \n\n\n[FileLoadException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) +0\n   System.Reflection.RuntimeAssembly.nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) +39\n   System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection, Boolean suppressSecurityChecks) +132\n   System.Reflection.RuntimeAssembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection) +144\n   System.Reflection.Assembly.Load(String assemblyString) +28\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +46\n\n[ConfigurationErrorsException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +618\n   System.Web.Configuration.CompilationSection.LoadAllAssembliesFromAppDomainBinDirectory() +209\n   System.Web.Configuration.CompilationSection.LoadAssembly(AssemblyInfo ai) +130\n   System.Web.Compilation.BuildManager.GetReferencedAssemblies(CompilationSection compConfig) +178\n   System.Web.Compilation.BuildManager.GetPreStartInitMethodsFromReferencedAssemblies() +94\n   System.Web.Compilation.BuildManager.CallPreStartInitMethods() +332\n   System.Web.Hosting.HostingEnvironment.Initialize(ApplicationManager appManager, IApplicationHost appHost, IConfigMapPathFactory configMapPathFactory, HostingEnvironmentParameters hostingParameters, PolicyLevel policyLevel, Exception appDomainCreationException) +677\n\n[HttpException (0x80004005): Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Web.HttpRuntime.FirstRequestInit(HttpContext context) +9090876\n   System.Web.HttpRuntime.EnsureFirstRequestInit(HttpContext context) +97\n   System.Web.HttpRuntime.ProcessRequestInternal(HttpWorkerRequest wr) +258\n\nVersion Information: Microsoft .NET Framework Version:4.0.30319; ASP.NET Version:4.0.30319.272\n</code></pre>\n\n<p>This is what I have tried : </p>\n\n<ul>\n<li>Clean solution</li>\n<li>Stopd the mini IIS and restart</li>\n<li>Restarted Windows</li>\n</ul>\n\n<p>But I do still gott this problem?</p>\n\n<p>Edit1: </p>\n\n<p>When re-running I now get this : </p>\n\n<pre><code>    Server Error in '/' Application.\n\nCould not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.IO.FileLoadException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)\n\nSource Error: \n\nAn unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n\nAssembly Load Trace: The following information can be helpful to determine why the assembly 'myApp (from my-pc)' could not be loaded.\n\n\nWRN: Assembly binding logging is turned OFF.\nTo enable assembly bind failure logging, set the registry value [HKLM\\Software\\Microsoft\\Fusion!EnableLog] (DWORD) to 1.\nNote: There is some performance penalty associated with assembly bind failure logging.\nTo turn this feature off, remove the registry value [HKLM\\Software\\Microsoft\\Fusion!EnableLog].\n\nStack Trace: \n\n\n[FileLoadException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) +0\n   System.Reflection.RuntimeAssembly.nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) +39\n   System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection, Boolean suppressSecurityChecks) +132\n   System.Reflection.RuntimeAssembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection) +144\n   System.Reflection.Assembly.Load(String assemblyString) +28\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +46\n\n[ConfigurationErrorsException: Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Web.Configuration.CompilationSection.LoadAssemblyHelper(String assemblyName, Boolean starDirective) +618\n   System.Web.Configuration.CompilationSection.LoadAllAssembliesFromAppDomainBinDirectory() +209\n   System.Web.Configuration.CompilationSection.LoadAssembly(AssemblyInfo ai) +130\n   System.Web.Compilation.BuildManager.GetReferencedAssemblies(CompilationSection compConfig) +178\n   System.Web.Compilation.BuildManager.GetPreStartInitMethodsFromReferencedAssemblies() +94\n   System.Web.Compilation.BuildManager.CallPreStartInitMethods() +332\n   System.Web.Hosting.HostingEnvironment.Initialize(ApplicationManager appManager, IApplicationHost appHost, IConfigMapPathFactory configMapPathFactory, HostingEnvironmentParameters hostingParameters, PolicyLevel policyLevel, Exception appDomainCreationException) +677\n\n[HttpException (0x80004005): Could not load file or assembly 'myApp (from my-pc)' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)]\n   System.Web.HttpRuntime.FirstRequestInit(HttpContext context) +9090876\n   System.Web.HttpRuntime.EnsureFirstRequestInit(HttpContext context) +97\n   System.Web.HttpRuntime.ProcessRequestInternal(HttpWorkerRequest wr) +258\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12922962,"title":"Rename table with Code First in Entity Framework","body":"<p>Does anyone knows if it is possible to <em>just</em> rename a database table with <code>Code First</code> in <code>Entity Framework 5</code>?</p>\n\n<p>I just have simple models and a database initializer, but since my database already contains data I've commented that initializer out. So, I <strong>don't</strong> want to <code>drop</code> and <code>create</code> a whole new database.</p>\n\n<p>When I add new columns to such a model I use the <code>Package Manager Console</code> and run <code>update-database</code>. to update my database. Does this also work for renaming tables? Does the <code>update-database</code> command automatically knows what the old name was?</p>\n\n<p>I don't have a lot of experience with CF yet and learning new stuff every day. Without CF it's 'easy' to just run an <code>alter table</code> command and refresh the dbml file... But with CF? I don't have a clue!</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13127781,"title":"SqlQuery against unknown (at compile time) type","body":"<p>I have an application where I have a list of database queries to execute.</p>\n\n<p>I know its possible to do something like:</p>\n\n<pre><code>var results = _db.Contacts.SqlQuery( sQuery );\n</code></pre>\n\n<p>and like: </p>\n\n<pre><code>var results = _db.Database.SqlQuery&lt;Contacts&gt;( sQuery );\n</code></pre>\n\n<p>But in my situation, I'm working only with metadata.  How can I do something like this:</p>\n\n<pre><code>string sBaseType = \"Contacts\";\nvar results = _db.Database.SqlQuery&lt;sBaseType&gt;( sQuery );\n</code></pre>\n\n<p>I had some success with <code>&lt;object&gt;</code>...it returned all the rows I expected it to, but its not in a very usable form.  Whats the best way to handle this variety of dynamic query?</p>\n\n<p>Edit -- \nWhat I'm hoping to find, is some mechanism rather like this:</p>\n\n<pre><code>var results = _db.Database[sBaseType].SqlQuery( sQuery );\n</code></pre>\n\n<p>So that I can avoid a construction that looks like :</p>\n\n<pre><code>if (sBaseType == \"Contacts\") {\n    var results = _db.Contacts.SqlQuery( sQuery );\n} else if  (sBaseType == \"Buildings\") {\n    var results = _db.Buildings.SqlQuery( sQuery );\n} else if  (sBaseType == \"Rooms\") {\n    var results = _db.Rooms.SqlQuery( sQuery );\n} else if  (sBaseType == \"Equipment\") {\n    var results = _db.Equipment.SqlQuery( sQuery );\n}\n</code></pre>\n\n<p>I don't need anything particularly fancy...I just am hoping to save building up a 100+ element if-elseif block...</p>\n"},{"tags":["asp.net","entity-framework","webforms","poco"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":62,"score":5,"question_id":13091075,"title":"Need example of a web form editing a parent entity object with children","body":"<p>I'm working on an \"edit\" page for an object.  On this page, I would like to have something like a DetailsView allowing editing of properties of the object as well as a GridView with children and allowing for simple Add/Edit/Delete of the children.  The updates to the parent or child objects shouldn't save to the database until a Save button is clicked.  I'm asp.net web forms and Entity Framework</p>\n\n<p>As a simple example, imagine a Project object with a collection of Resources.  I am building a page that allows a user to change Project properties such as ProjectName in a DetailsView as well as add/edit/deleting a Resource in a Gridview below.  One Save button at the bottom saves everything.</p>\n\n<p>I've found examples of this in MVC, but am having trouble finding a web forms example.  </p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":4175,"score":10,"question_id":4641251,"title":"Entity Framework Delete All on Submit","body":"<p>In LINQ to SQL, I could do: </p>\n\n<pre><code>context.User_Roles.DeleteAllOnSubmit(context.User_Roles.Where(ur =&gt; ur.UserId == user.UserId));\n</code></pre>\n\n<p>Whats the equivalent to this for entity framework?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13143874,"title":"Code-First MetaData","body":"<p>What should I use as MetaData while I'm using <strong>Code-First</strong> Approach\nvia <strong>EntityConnectionStringBuilder</strong></p>\n\n<pre><code>EntityConnectionStringBuilder entityBuilder;\nentityBuilder.MetaData = ??  // Metadata = @\"res://*/;\";\n</code></pre>\n\n<p>I got this error :</p>\n\n<pre><code>{\"The specified metadata path is not valid. A valid path must be either an existing directory, an existing file with extension '.csdl', '.ssdl', or '.msl', or a URI that identifies an embedded resource.\"}\n</code></pre>\n\n<ul>\n<li><p>I didn't make any model on this approach, As I thought it isn't needed.</p></li>\n<li><p>All I want is to do everything programmatically.</p></li>\n<li><p>Everything was working fine in Database-First Approach.</p></li>\n<li><p>Here I made the Connection String and passed it to the Context.</p></li>\n<li><p>The EF Version is 5.0. </p></li>\n<li><p>The database is existed.</p></li>\n<li><p>Should I use any thing else to avoid <code>MetaData</code> Checking, such as\ninitializers or ??</p></li>\n</ul>\n"},{"tags":["entity-framework","code-first-migrations"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":216,"score":4,"question_id":11105483,"title":"Add-Migration command fails with \"type is not resolved\"(where \"type\" is inner entity framework class) ","body":"<p>I have already used an entity framework with separate migration package(for 3.5 or 4.0, don't remember), and with included migrations api(4.3, 5.0).</p>\n\n<p>But today i have created a new project(empty MVC4.0 project), install latest stable EF(4.3) and recieve error below on the \"pm > Add-Migration initital\" command</p>\n\n<pre><code>System.Runtime.Serialization.SerializationException: Type is not resolved for member 'System.Data.Entity.Migrations.Design.ToolingFacade+GetPendingMigrationsRunner,EntityFramework    , Version=4.3.1.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.\n   at System.AppDomain.DoCallBack(CrossAppDomainDelegate callBackDelegate)\n   at System.Data.Entity.Migrations.Design.ToolingFacade.Run(BaseRunner runner)\n   at System.Data.Entity.Migrations.Design.ToolingFacade.GetPendingMigrations()\n   at System.Data.Entity.Migrations.AddMigrationCommand.&lt;&gt;c__DisplayClass2.&lt;.ctor&gt;b__0()\n   at System.Data.Entity.Migrations.MigrationsDomainCommand.Execute(Action command)\n</code></pre>\n\n<p>Then i am trying to switch to EF5.0 and an error still here, with one difference in a version:</p>\n\n<pre><code>System.Runtime.Serialization.SerializationException: Type is not resolved for member 'System.Data.Entity.Migrations.Design.ToolingFacade+GetPendingMigrationsRunner,EntityFramework      , Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.\n</code></pre>\n\n<p>It is first time when i recieve this error. The<br>\n    \"System.Data.Entity.Migrations.Design.ToolingFacade\" class exists and the \"GetPendingMigrationsRunner \" subclass in it also exists in a referenced EntityFramework assembly.</p>\n\n<p>Anyone knows what may cause an error? Migrations works ok for another project on MVC4.0, on those i have choosen standart(not empty) project template.</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities","entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13144622,"title":"Linq query syntax to method syntax when using multiple joins to introduce dynamic restrictions","body":"<p>I'm trying to translate a linq query using query keywords to the method syntax.\nMy ultimate goal is to be able to apply additonnal restrictions at runtime each time you see a <strong>Where</strong> clause in the query. I have a total of 14 different parameters to be applied. Some are mutually exclusive, other are inclusive.</p>\n\n<p>Here is the starting query :</p>\n\n<pre><code>query = from p in context.Person\nwhere p.Firstname.ToUpper().StartsWith(firstName.ToUpper())\njoin v in context.Visit on p.Id equals v.PersonId\nwhere !v.AccessionNumber.StartsWith(RISConst.PM_PREFIX)\njoin f in context.Finding on v.Id equals f.VisitId\njoin c in context.Consultation on f.Id equals c.FindingId\nwhere c.StudyId.ToUpper().CompareTo(studyId.ToUpper()) == 0\nselect v;\n</code></pre>\n\n<p>Using Jon Skeet's <a href=\"http://msmvps.com/blogs/jon_skeet/archive/2011/01/28/reimplementing-linq-to-objects-part-41-how-query-expressions-work.aspx\" rel=\"nofollow\">excellent blog post</a> I have been able to go that far :</p>\n\n<pre><code>query = context.Person.Where(p =&gt; p.Firstname.ToUpper().StartsWith(firstName.ToUpper()))\n.Join(context.Visit, p =&gt; p.Id, v =&gt; v.Id, (p, v) =&gt; new { p, v })\n.Where(z =&gt; z.v.AccessionNumber.StartsWith(RISConst.PM_PREFIX))\n.Select(z =&gt; z.v)\n.Join(context.Finding, v =&gt; v.Id, f =&gt; f.VisitId, (v, f) =&gt; new { v, f })\n.Select(t =&gt; t.f)\n.Join(context.Consultation, f =&gt; f.Id, c =&gt; c.FindingId, (f, c) =&gt; new { f, c })\n.Where( u =&gt; u.c.StudyId.ToUpper().CompareTo(studyId.ToUpper()) == 0)\n.Select(????);\n</code></pre>\n\n<p>Now I'm stuck because I need to return Visits. How can I do that ?</p>\n\n<p>Any Help appreciated.</p>\n"},{"tags":["c#","linq","entity-framework","repository","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13143268,"title":"How to include complex entity fields in a projected entity framework object?","body":"<p>I often use the <code>System.Data.Entity.DbExtensions</code> <code>Include()</code> method to cause complex entity fields to be included in query results from my repositories.  However, when I project my entities into new classes, I seem to lose this \"concretization\" of included complex entity fields.  For example, say I wanted to return an <code>Event</code> object from my repo, and be able to access the complex entity field <code>Assessment</code>:</p>\n\n<pre><code>public class EventRepository {\n...\n    public IList&lt;Event&gt; GetEvents() {\n        using (var context = new MyDatabaseContext()) {\n            return context.Events\n                .Include(evnt =&gt; evnt.ActualAssessment)\n                .ToList();\n        }\n    }\n...\n}\n</code></pre>\n\n<p>I can then run the following code without a hitch because of the <code>Include</code> I used above:</p>\n\n<pre><code>var repoEvents = new EventRepository();\nvar events = repoEvents.GetEvents();\nConsole.WriteLine(events[0].ActualAssessment.AssessmentDate.ToString());\n</code></pre>\n\n<p>But say I now want to project the <code>Event</code>s into a wrapper object <code>ExtendedEvent</code> with some extra info, like this:</p>\n\n<pre><code>public class EventRepository {\n...\n    public IList&lt;ExtendedEvent&gt; GetExtendedEvents() {\n        using (var context = new MyDatabaseContext()) {\n            return context.Events\n                .Include(evnt =&gt; evnt.ActualAssessment)\n                .Select(evnt =&gt; new {\n                    TheEvent = evnt,\n                    SomeExtraData = 123\n                })\n                .ToList()\n                .Select(evntInfo =&gt; {\n                    return new ExtendedEvent {\n                        TheEvent = evntInfo.TheEvent,\n                        SomeExtraData = evntInfo.SomeExtraData\n                    };\n                })\n                .ToList();\n        }\n    }\n...\n}\n</code></pre>\n\n<p>I now try and run this code:</p>\n\n<pre><code>var repoEvents = new EventRepository();\nvar extendedEvents = repoEvents.GetExtendedEvents();\nConsole.WriteLine(extendedEvents[0].TheEvent.ActualAssessment.AssessmentDate.ToString());\n</code></pre>\n\n<p>This gives me the error \"The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.\" - so <code>ActualAssessment</code> has not been eager-loaded despite my use of <code>Include</code>, apparently because I projected it into a new wrapper object.  How can I cause <code>ActualAssessment</code> to be included?</p>\n"},{"tags":["asp.net","asp.net-mvc","entity-framework","asp.net-mvc-4","simplemembership"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1082,"score":3,"question_id":12254701,"title":"SimpleMembershipProvider not working","body":"<p>I started a new internet project with VS2012 and am trying to just restructure my project a bit and I can't seem to keep the SimpleMemberhsipProvider working.  Basically, all I've done is move the models objects into a core project along with a couple other items.  I've implemented Ninject and am trying to abstract Entity a bit by using a repository pattern to get my data.  I really don't feel as though I've changed much with the current project, but for some reason when I start the application now I get:</p>\n\n<blockquote>\n  <p>{\"The Role Manager feature has not been enabled.\"}</p>\n</blockquote>\n\n<p>The ActionFilter that is supplied by the framework is where the error is thrown when:</p>\n\n<blockquote>\n  <p>WebSecurity.InitializeDatabaseConnection(\"DefaultConnection\", \"UserProfile\", \"Id\", \"UserName\", autoCreateTables: true); </p>\n</blockquote>\n\n<p>is called. </p>\n\n<p>Here is some of the stacktrace:</p>\n\n<blockquote>\n  <p>[ProviderException: The Role Manager feature has not been enabled.]<br>\n  System.Web.Security.Roles.EnsureEnabled() +9561885<br>\n  System.Web.Security.Roles.get_Provider() +8<br>\n  WebMatrix.WebData.WebSecurity.InitializeProviders(DatabaseConnectionInfo\n  connect, String userTableName, String userIdColumn, String\n  userNameColumn, Boolean autoCreateTables) +104<br>\n  WebMatrix.WebData.WebSecurity.InitializeDatabaseConnection(String\n  connectionStringName, String userTableName, String userIdColumn,\n  String userNameColumn, Boolean autoCreateTables) +100<br>\n  InoutBoard.Core.Infrastructure.Filters.SimpleMembershipInitializer..ctor()\n  in c:\\Users\\Kyle\\Documents\\Visual Studio\n  2012\\Projects\\InoutBoard\\InoutBoard.Core\\Infrastructure\\Filters\\InitializeSimpleMembershipAttribute.cs:42</p>\n  \n  <p>[InvalidOperationException: The ASP.NET Simple Membership database\n  could not be initialized. For more information, please see\n  http://go.microsoft.com/fwlink/?LinkId=256588]<br>\n  InoutBoard.Core.Infrastructure.Filters.SimpleMembershipInitializer..ctor()\n  in c:\\Users\\Kyle\\Documents\\Visual Studio\n  2012\\Projects\\InoutBoard\\InoutBoard.Core\\Infrastructure\\Filters\\InitializeSimpleMembershipAttribute.cs:46</p>\n</blockquote>\n\n<p>I'm hosting the code on github at the following link <a href=\"https://github.com/keroger2k/InoutBoard\" rel=\"nofollow\">https://github.com/keroger2k/InoutBoard</a></p>\n"},{"tags":["c#","wpf","entity-framework","serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13142992,"title":"Deep Clone Entity Without Serialization","body":"<p>I need to deep clone an Entity (To use an existing Entity as pattern for a new one). I found several approaches, but all include Serialization. Since our Entities derive from ObservableObject of the MVVM Toolkit that is not Serializeable we can't use those approaches.</p>\n\n<p>What would be the best way to do so?</p>\n\n<p>We are usinng .net 4.5 and EF5 and WPF.</p>\n"},{"tags":["c#","database","linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13138243,"title":"Entity Framework: Linq query finds entries by original data but returns reference to changed entry","body":"<p>I just spent some days now to find a bug caused by some strange behavior of the Entity Framework (version 4.4.0.0). For an explanation I wrote a small test program. At the end you'll find some questions I have about that.</p>\n\n<h2>Declaration</h2>\n\n<p>Here we have a class \"Test\" which represents our test dataset. It only has an ID (primary key) and a \"value\" property. In our TestContext we implement a DbSet Tests, which shall handle our \"Test\" objects as a database table.</p>\n\n<pre><code>public class Test\n{\n    public int ID { get; set; }\n    public int value { get; set; }\n}\n\npublic class TestContext : DbContext\n{\n    public DbSet&lt;Test&gt; Tests { get; set; }\n}\n</code></pre>\n\n<h2>Initialization</h2>\n\n<p>Now, we remove any (if existent) entries from our \"Tests\" table and add our one and only \"Test\" object. It has ID=1 (primary key) and value=10.</p>\n\n<pre><code>// Create a new DBContext...\nTestContext db = new TestContext();\n\n// Remove all entries...\nforeach (Test t in db.Tests) db.Tests.Remove(t);\ndb.SaveChanges();\n\n// Add one test entry...\ndb.Tests.Add(new Test { ID = 1, value = 10 });\ndb.SaveChanges();\n</code></pre>\n\n<h2>Tests</h2>\n\n<p>Finally, we run some tests. We select our entry by it's original value (=10) and we change the \"value\" of our entry to 4711. BUT, we do not call db.SaveChanges(); !!!</p>\n\n<pre><code>// Find our entry by it's value (=10)\nvar result = from r in db.Tests\n             where r.value == 10\n             select r;\nTest t2 = result.FirstOrDefault();\n\n// change its value from 10 to 4711...\nt2.value = 4711;\n</code></pre>\n\n<p>Now, we try to find the (old) entry by the original value (=10) and do some tests on the results of that.</p>\n\n<pre><code>// now we try to select it via its old value (==10)\nvar result2 = from r in db.Tests\n             where r.value == 10\n             select r;\n\n// Did we get it?\nif (result2.FirstOrDefault() != null &amp;&amp; result2.FirstOrDefault().value == 4711)\n{\n    Console.WriteLine(\"We found the changed entry by it's old value...\");\n}\n</code></pre>\n\n<p>When running the program we'll actually see \"We found the changed entry by it's old value...\". That means we have run a query for r.value == 10, found something... This would be acceptable. BUT, get receive the already changed object (not fulfilling value == 10)!!!</p>\n\n<p><strong>Note:</strong> You'll get an empty result set for \"where r.value == 4711\".</p>\n\n<p>In some further testing, we find out, that the Entity Framework always hands out a reference to the same object. If we change the value in one reference, it's changed in the other one too. Well, that's ok... but one should know it happens.</p>\n\n<pre><code>Test t3 = result2.FirstOrDefault();    \nt3.value = 42;\nif (t2.value == 42)\n{\n    Console.WriteLine(\"Seems as if we have a reference to the same object...\");\n}\n</code></pre>\n\n<h2>Summary</h2>\n\n<p>When running a LINQ query on the same Database Context (without calling SaveChanges()) we will receive references to the same object, if it has the same primary key. The strange thing is: Even, if we change an object we will find it (only!) by it's old values. But we will receive a reference to the already changed object. This means that the restrictions in our query (value == 10) is not guaranteed for any entries that we changed since our last call of SaveChanges().</p>\n\n<h2>Questions</h2>\n\n<p>Of course, I'll probably have to live with some effects here. But I, would like to avoid to \"SaveChanges()\" after every little change. Especially, because I would like to use it for transaction handling... to be able to revert some changes, if something goes wrong.</p>\n\n<p>I would be glad, if anyone could answer me one or even both of the following questions:</p>\n\n<ol>\n<li><p>Is there a possibility to change the behavior of entity framework to work as if I would communicate with a normal database during a transaction? If so... how to do it?</p></li>\n<li><p>Where is a good resource for answering \"How to use the context of entity framework?\" which answers questions like \"What can I rely on?\" and \"How to choose the scope of my DBContext object\"?</p></li>\n</ol>\n\n<h2>EDIT #1</h2>\n\n<p>Richard just explained how to access the original (unchanged) database values. While this is valuable and helpful I've got the urge to clarify the goal ... </p>\n\n<p>Let's have a look at what happens when using SQL. We setup a table \"Tests\":</p>\n\n<pre><code>CREATE TABLE Tests (ID INT, value INT, PRIMARY KEY(ID));\nINSERT INTO Tests (ID, value) VALUES (1,10);\n</code></pre>\n\n<p>Then we have a transaction, that first looks for entities whose values are 10. After this, we update the value of these entries and look again for those entries. In SQL we already work on the updated version, so we will not find any results for our second query. After all we do a \"rollback\", so the value of our entry should be 10 again...</p>\n\n<pre><code>START TRANSACTION;\n\nSELECT ID, value FROM Tests WHERE value=10; {1 result}\nUPDATE Tests SET value=4711 WHERE ID=1; {our update}\n\nSELECT ID, value FROM Tests WHERE value=10; {no result, as value is now 4711}\n\nROLLBACK; { just for testing transactions... }\n</code></pre>\n\n<p>I would like to have exactly this behavior for the Entity Framework (EF), where db.SaveChanges(); is equivalent to \"COMMIT\", where all LINQ queries are equivalent to \"SELECT\" statements and every write access to an entity is just like an \"UPDATE\". I don't care about when the EF does actually calls the UPDATE statement, but it should behave the same way as using a SQL Database the direct way... Of course, if \"SaveChanges()\" is called and returning successfully it should be guaranteed that all data was persisted correctly.</p>\n\n<p>Note: Yes, I could call db.SaveChanges() before every query, but then I would loose the possibility for a \"Rollback\".</p>\n\n<p>Regards,</p>\n\n<p>Stefan</p>\n"},{"tags":["entity-framework","asp.net-mvc-4","ef-database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13138429,"title":"Auto generate models in mvc 4 database first?","body":"<p>I created an mvc 4 web project using database first and entity framework but was surprised to see that default models were not generated automatically, is there a way to create them from my .edmx file or are there any other possibilities to save hand coding them?</p>\n\n<p>Any help would be much appreciated</p>\n\n<p>UPDATE: </p>\n\n<p>Sorry, should have mentioned I am looking for a solution to generate simple models with basic methods such as :</p>\n\n<pre><code>public class EditUserModel\n{\n    public int ID { get; set; }\n\n    [Required(ErrorMessage = \"Forename is required\")]\n    public string Forename { get; set; }\n\n    [Required(ErrorMessage = \"Surname is required\")]\n    public string Surname { get; set; }\n\n    [Required(ErrorMessage = \"Username is required\")]\n    public string Username { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13141862,"title":"Joining multiple tables using Entity Framework","body":"<p>i am trying to join 3 tables using EF but it throws an error saying </p>\n\n<pre><code>consider swaping conditions on either side of equals\n</code></pre>\n\n<p>can some one pls help</p>\n\n<pre><code> var billdata = from billtotal in context.billTotals\n                                   join billcard in context.billClubcards\n                                       on billtotal.OrderID equals billcard.OrderID\n\n                                   join billtender in context.billTenders\n                                       on billtender.OrderID equals billtotal.OrderID\n\n\n                                   select billtotal;\n</code></pre>\n"},{"tags":["entity-framework","security","breeze"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13091760,"title":"Data Security using Entity Framework","body":"<p>What options/solutions are there for securing data using Entity Framework?</p>\n\n<p>I do not talk about forms login and such here, just assume that the users are authenticated or not.</p>\n\n<p>To illustrate, i attached one of my web api controllers and i wonder if this is the way to do it. The reason why i ask is that i wonder if there are easier ways to do this than writing all this logic to what data to expose in all my controllers.</p>\n\n<p>Also, when looking into a system like breezejs and odata where i can add $expand=TrafficImages to my queries, i would not want users to be able to get my hole database. </p>\n\n<p>So to summarize, what ways are there to securing the data exposed such the users cant download sensible data.</p>\n\n<pre><code>[AllowAnonymous]\npublic object GetTheoryTests()\n{\n    var identity = ((ClaimsIdentity)((ClaimsPrincipal)HttpContext.Current.User).Identity);\n    //if (HttpContext.Current.User.Identity.IsAuthenticated)\n\n\n   if (!identity.IsAuthenticated)\n     return db.TheoryTests.Include(t=&gt;t.TrafficImages).Where(t=&gt;t.PublicAvalible)\n            .Select(t =&gt; new { Id = t.Id, Title = t.Title, Images = t.TrafficImages }).AsEnumerable();\n\n   if (User.IsInRole(\"WebAdmins\"))\n       return db.TheoryTests.AsEnumerable();\n\n    var key = identity.GetProvider();\n\n    var member = db.Members.Include(m=&gt;m.PayedTheoryTests).SingleOrDefault(m=&gt;m.Identities.Any(\n        i=&gt;i.identityprovider == key.provider &amp;&amp;\n        i.nameidentifier == key.id));\n        if(member!=null)\n            return db.TheoryTests.Include(t =&gt; t.TrafficImages).Where(t =&gt; t.PublicAvalible).Select(t =&gt; new { Id = t.Id, Title = t.Title, Images = t.TrafficImages }).AsEnumerable();\n        else\n            return db.TheoryTests.Include(t =&gt; t.TrafficImages).Where(t =&gt; t.PublicAvalible)\n                .Union(member.PayedTheoryTests).Select(t =&gt; new { Id = t.Id, Title = t.Title, Images = t.TrafficImages }).AsEnumerable();\n\n\n\n}\n</code></pre>\n\n<p>When thinking about it, what i miss is something like a viewmodel untop of my database depending on the state of the user. Would it be a solution to create two entity frameworks ontop of the same database, one for limited data display and one for more advanced operations?</p>\n"},{"tags":["c#","entity-framework","data-binding","datagridview"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13141562,"title":"DatagridViewColumn Showing Object DataMember instead of Object","body":"<p>I use EF5 with Winforms and have a one to many relationship.</p>\n\n<p>Each Product has one Company.</p>\n\n<p>I have a DataGridView showing all Products (via binding). Now i want to have one column which shows not the object Company but a DataMember (Name) of Company. Is this possible (via designer)?</p>\n\n<p>I tried setting PropertyName to \"Company.Name\" but it doesn't work.</p>\n\n<p>Edit: it would be even better if i have a dropdownfield showing all Company-Names and i can so select the Company which belongs to the product. But i think this is even more difficult.</p>\n"},{"tags":["entity-framework","crystal-reports","null","relationship","many-to-one"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13140281,"title":"Crystal Reports + Entity Framework Many-to-One Empty FK","body":"<p>I have a report with 5 tables, and I'm using the Entity Framework as the data management tool.</p>\n\n<p>The problem is:</p>\n\n<ul>\n<li>When I set the datasource of my report (this datasource is a list with one single data row from a table, that does the selecion based on its realtionship rules);</li>\n<li>The table comes with a FK field, but this field is showing empty on the report (the datasource contains the value of the FK Field, but the report does not.</li>\n<li>There's a another table on this relationship that does have an FK Field and its working perfectly. The problem is with the data of the main table (that contains the row i defined as datasource, and contains a value of the FK field....) of the relationship selecion rules (based on inner Joins). The value appears empty on report.</li>\n</ul>\n\n<p>The datasource of my report is an iQueryable&lt; T > casted to iEnumerable&lt; T > (where T is the table object of entity framework) </p>\n"},{"tags":["entity-framework","ado.net","windows-server-2008","windows-server-2003","msdtc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13139275,"title":"Is This MSDTC configuration Issue?","body":"<p>It seems I am running into the Microsoft Distributed Transaction Coordinator (MSDTC) related issue.</p>\n\n<p><strong>SCENARIO</strong></p>\n\n<p>I am using TransactionScope and with in the single scope it hits two different databases on different servers (for instance, <strong>DB_A</strong> running Windows Server 2003 and <strong>DB_B</strong> running Windows Server 2008). One database is accessed using Entity Framework 4.0 and another using normal ADO.NET APIs.</p>\n\n<p>When I run the application from my development machine (running WinXP) it commits and rollbacks both the connections accurately. But when I run the application, deployed on another server (for instance <strong>WAS_A</strong> running Windows Server 2003) it commits correctly but in case of exception is doesn't roll back the database activities on both the servers.</p>\n\n<p>I thought it would be the MSDTC configuration issue on the <strong>WAS_A</strong>. So I went to the MSDTC -> Security Configuration and checked all the available options (as I did previously on other machines). But still I am facing the same issue.</p>\n\n<p>Looking for your expert advices. :)</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13139274,"title":"Copy a large DB schema to create a new DB in EF Code first","body":"<p>I have a code first DB with a context , from which i need to create a new DB which uses that Data but modifies it say 5% of the fields and then adds 20 more tables . This migration will be a regular daily process where many new Dbs are created ( from many source DBs) .</p>\n\n<p>What is the best way to do this .. right now im using a rather horrible method which copies across one table after another ( using value mapper for fields) and then does a few parent patches ?  Its horrible because its slow but worse the order is dependent on relationships and Many to Many are a pain.  ( in addition i have to match up ids if the original table has an id missing) </p>\n\n<p>I thought of using an SQL query but that is a bit difficult as well for such an operation ( especially since the destination uses different classnames for inheritance)  and may be an issue if some Dbs move to Oracle. </p>\n\n<p>A brute copy which ignores foreign keys would be ideal.</p>\n\n<p>Any ideas ? And remember this is a 50 table DB.</p>\n"},{"tags":["entity-framework","tracking","self","entities"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13137966,"title":"Self Tracking Entities - Relationships not generated","body":"<p>I have added a Self-Tracking Entity Generator to my existing Entity Framework setup.</p>\n\n<p>Now when I retrieve a World record from the database, for example</p>\n\n<pre><code>public class World\n{\n    public Guid Id { get; set; }\n    public string Name { get; set; }\n    public string Universe { get; set; }\n    public EntityCollection&lt;Country&gt; Countries { get; set; }\n}\n</code></pre>\n\n<p>which has a 1 to Many relationship to the table Country, the collection Countries is 0 and I know that in the database the records in the Country table exist.</p>\n\n<p>By adding the Self-Tracking Entity Generator I have somehow destroyed the databases relationships.</p>\n\n<p>Does anyone know how I can use a Self-Tracking Entity Generator but preserve the relationships?</p>\n\n<p>Many thanks</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-viewmodel"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":35,"score":-1,"question_id":13132719,"title":"How to use ReadOnly data annotation on condition?","body":"<p>I want to apply ReadOnly data annotation on my ViewModel properties. But this need to be checked and should be applied, based upon some condition. </p>\n\n<p>For example if I have some field mapping saved into my Database table and then I want to check on the ViewModel properties, whether this need to be ReadOnly or Editable. </p>\n\n<p>I appreciate if you can share your thought here.</p>\n"},{"tags":["c#","asp.net",".net","entity-framework","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13136236,"title":"Losing reference to child object on query","body":"<p>I have 3 Entities (MasterDoc, Folder, User) that i link together in another Entity (Folder_User).</p>\n\n<pre><code>public class Folder_User\n{\n    public int Id { get; set; }\n    public MasterDoc MasterDoc { get; set; }\n    public User User { get; set; }\n    public Folder Folder { get; set; }\n}\n</code></pre>\n\n<p>After ive inserted an object of type Folder_User into the database, i can (on the same DbContext) query it and retreive the child objects.</p>\n\n<pre><code>public static List&lt;Folder_User&gt; GetAllFolder_USer(User user, DataModel dbContext)\n    {\n        List&lt;Folder_User&gt; list = null;\n\n        var query = from f in dbContext.Folder_User\n                     where f.User.Id == user.Id\n                     select f;\n\n        list = new List&lt;Folder_User&gt;(query);\n        return list;\n    }\n</code></pre>\n\n<p>But after a page-refresh (new dbcontext) when i run the same query the objects reference to MasterDoc is null.</p>\n\n<p>*I have tried turn of lazy loading but nothing seems to fix it.\n*Have also checked the database and the table is correctly containing a row with a MasterDoc Id.</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13136543,"title":"Serializing object with virtual properties using another lighter object","body":"<p>I have got a class which has many virtual properties lazy loaded</p>\n\n<pre><code>public class TestPlan\n{\n    public virtual ICollection&lt;Test&gt; Test { get; set; }\n    public virtual Commercial Commercial { get; set; }\n    ...\n}\n</code></pre>\n\n<p>and this class has to be serialized later in the program. The thing is, as those properties are virtual I've got an error (circular reference) everytime I try to serialize it. <strong>Now here is my question</strong>:</p>\n\n<p><em>My boss told me to use what he calls View Object which is the same object but without the unused properties.</em> What do you think of this? Should I set those unused properties to null or something?</p>\n\n<p><strong>Background</strong>: </p>\n\n<p>The serialized object is meant to be used in an infragistics grid (a nice array). I've already tried using the <code>[ScriptIgnore]</code> attribute on my virtuals but it didn't worked.</p>\n\n<p>I also tried retrieving my TestPlans as <code>database.TestPlans.AsNoTracking().ToList()</code> but got an error (When an object is returned with a NoTracking merge option, Load can only be called when the EntityCollection or EntityReference does not contain objects.)</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["asp.net-mvc","entity-framework","linq-to-entities","entity"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3026,"score":1,"question_id":1077342,"title":"Entity Framework - Update entity with child properties","body":"<p>I have an entity that has one child and I need to update it, but, in the TryUpdateModel  method, it does not accept an strong typed object (accepts only a FormCollection), and when I try to update it, I get the following error.</p>\n\n<p>{\"A relationship is being added or deleted from an AssociationSet 'FK__SG_Usuari__ID_Si__534D60F1'. With cardinality constraints, a corresponding 'SG_Usuario' must also be added or deleted.\"}</p>\n\n<p>The problem is that I can't load in the formcollection the child property, only an id, but not the entire object.</p>\n"},{"tags":["entity-framework","asp.net-membership","dbcontext"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13135585,"title":"Implementing custom MembershipProvider","body":"<p>First of all, If i am using entity framework's and inherit from <code>DbContext</code>, I need to override all and implement all the functions using my context or simple use <code>base.FunctionName()</code> inside each overriden function?</p>\n\n<p>Secondly, Where should I put the DbContext object? should i Make it a public member in my custom MembershipProvider and initiate it in the c'tor, or create context in each function? or create in each function using <code>using (var context = CustomDbContext())</code> inside each function? please explain why.</p>\n\n<p>Lastly, How can I implement a custom <code>MembershipUser</code> and get its value? I guess I should inherit\nfrom <code>MembershipUser</code>, but how I get the CustomMembershipUser from it in the most elegant way?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":453,"score":-4,"question_id":10256723,"title":"How to inherit from the DbContext Class","body":"<p>I am working on MVC and in the model I created a class that uses Entity\n Framework. I am trying to inherit from DBContext class but it is showing\n an error saying: \"The type or Namespace name DBContext doesn't exist\". I also\n added the \"System.data.Entity \" namespace.</p>\n\n<p>Example like :</p>\n\n<pre><code> public Class SampleEF :DBContext //Showing error\n{\n\n}\n</code></pre>\n\n<p>Can you please tell me how to use the DBContext class to work with EF?</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":507,"score":1,"question_id":2572093,"title":"Save entity with entity framework","body":"<p>I'm saving entities/records with the EF, but i'm curious if there is another way of doing it.</p>\n\n<p>I receive a class from a MVC controller method, so basicly i have all the info: the class's properties, including the primary key.\nWithout EF i would do a Sql update (update table set a=b, c=d where id = 5), but with EF i got no further than this:</p>\n\n<p>Get an object with ID of 5 \nUpdate the (existing) object with the new object\nSubmitchanges.</p>\n\n<p>What bothers me is that i have to get the object from the database first, where i have all the info to do an update statement.</p>\n\n<p>Is there another way of doing this?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","razor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13118982,"title":"EF: many-to-many field always null","body":"<p>when i try to save this model, the <code>menu.Roles</code> field is always <code>null</code>, and save change method doesn't change the <code>Roles</code> field</p>\n\n<p>tables are <code>Menu</code>, <code>RoleMenu</code> and <code>Role</code></p>\n\n<p>so, i have a pair <strong>many-2-many</strong> models:</p>\n\n<p>Menu has a <code>Roles</code> filed<br>\nRole has a <code>Menus</code> fields</p>\n\n<p>action method:</p>\n\n<pre><code>    [HttpPost]\n    public ActionResult Edit(Menu menu, IEnumerable&lt;int&gt; RoleIDs)\n    {\n        if (ModelState.IsValid)\n        {\n            var roles = _db.UserRoles.Where(rl =&gt; RoleIDs.Contains(rl.Id)).ToList();\n\n            menu.Roles = new List&lt;UserRole&gt;();\n            menu.Roles.AddRange(roles);\n\n            _db.Entry(menu).State = EntityState.Modified;\n            _db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n        ViewBag.ParentMenuId = new SelectList(_db.Menus, \"Id\", \"Name\", menu.ParentMenuId);\n        ViewBag.RoleIDs = new SelectList(_db.UserRoles.ToList(), \"Id\", \"Name\");\n        return View(menu);\n    }\n</code></pre>\n\n<p>view:</p>\n\n<pre><code>//...other VS auto generated fields...\n&lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Roles, \"Roles\")\n&lt;/div&gt;\n&lt;div class=\"editor-field\"&gt;\n        @Html.ListBox(\"RoleIDs\")\n        @Html.ValidationMessageFor(model =&gt; model.Roles)\n&lt;/div&gt;\n&lt;p&gt;\n        &lt;input type=\"submit\" value=\"Save\" /&gt;\n&lt;/p&gt;\n</code></pre>\n\n<p>mapping:</p>\n\n<pre><code>            modelBuilder.Entity&lt;Role&gt;()\n             .HasMany(role =&gt; role.Menus)\n             .WithMany(menu =&gt; menu.Roles)\n             .Map(m =&gt;\n              m.MapLeftKey(\"RoleId\").\n                 MapRightKey(\"MenuId\").\n                 ToTable(\"RoleMenu\"));\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4","poco","entity-framework-5","pluralize"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":99,"score":6,"question_id":11614098,"title":"Howto customize pluralisation for Entity Framwork 5","body":"<p>As my database was designed using german table- and column names, the default pluralisation feature of entity framework doesn't work for me.</p>\n\n<p>I have found a couple of resources where this is discussed, but none of them seem to work.</p>\n\n<p>What i have found:\nThere is the PluralisationService where i can add the mappings:</p>\n\n<pre><code>PluralizationService pluralizer =\n      PluralizationService.CreateService(CultureInfo.GetCultureInfo(\"en-us\"));\nICustomPluralizationMapping mapping = ps as ICustomPluralizationMapping;\nmapping.AddWord(\"Tabelle\", \"Tabellen\");\n</code></pre>\n\n<p>But what's next?\nI have tried to:</p>\n\n<pre><code>EntityModelSchemaGenerator generator = new EntityModelSchemaGenerator(container);\ngenerator.PluralizationService = pluralizer;\ngenerator.GenerateMetadata();\n</code></pre>\n\n<p>and put both of them in my POCO T4 Template. But it throwed the following exception:</p>\n\n<blockquote>The EntityContainer 'ContainerName' is not a store EntityContainer. Parameter name: storeEntityContainer<br>\n   at System.Data.Entity.Design.EntityModelSchemaGenerator.Initialize(...)<br>\n   at Microsoft.VisualStudio.TextTemplating...GeneratedTextTransformation.TransformText()<br>\n</blockquote>\n\n<p>ANY Help? Please!!! Thanks!!</p>\n"},{"tags":["c#",".net","entity-framework","inotifypropertychanged"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":522,"score":1,"question_id":11010718,"title":"How to get property change notifications with EF 4.x DbContext generator","body":"<p>I'm playing around with Entity Framework 4.3, and so I am using the DbContext Generator to create the context and entity classes. </p>\n\n<p>With the default EF 4 code generator template, entity classes implement INotifyPropertyChanged, and also add <code>Changing</code> and <code>Changed</code> partial methods in property setters.</p>\n\n<p>When I use the EF 4.x DbContext generator, as pictured below, the entity classes are much lighter, and do not include any means of tracking property changes.</p>\n\n<p><img src=\"http://i.stack.imgur.com/YRlrP.png\" alt=\"enter image description here\"></p>\n\n<p>Here is an example:</p>\n\n<pre><code>//------------------------------------------------------------------------------\n// &lt;auto-generated&gt;\n//    This code was generated from a template.\n//\n//    Manual changes to this file may cause unexpected behavior in your application.\n//    Manual changes to this file will be overwritten if the code is regenerated.\n// &lt;/auto-generated&gt;\n//------------------------------------------------------------------------------\n\nusing System;\nusing System.Collections.Generic;\n\nnamespace SomeNamespace\n{\n    public partial class SomeTable\n    {\n        public SomeTable()\n        {\n            this.Children = new HashSet&lt;Child&gt;();\n        }\n\n        public long parent_id { get; set; }\n        public long id { get; set; }\n        public string filename { get; set; }\n        public byte[] file_blob { get; set; }\n\n        public virtual Parent Parent { get; set; }\n        public virtual ICollection&lt;Child&gt; Children { get; set; }\n    }\n}\n</code></pre>\n\n<p>I must be missing an important piece of the puzzle, but my searches have been fruitless. So my question is: how can I have generated types included property change notifications with EF 4.3?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I fully agree with @derape answer's; but I am curious as to why I would need to change the <code>.tt</code> file when the EF 4 default code generation template <em>already</em> has the hooks. I mean what about when binding to a WPF <code>DependencyProperty</code>'? Without INotifyPropertyChanged, changes done by a command to a bunch of properties in a bunch of objects won't be reflected in the UI. What am I missing?</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13129405,"title":"Entity Framework 5 turn off auto compilation in RTM?","body":"<p>I see many examples over the internet on how to turn off the automatic compilation with:</p>\n\n<pre><code>using (var db = new SampleEntities())\n{\n    db.ContextOptions.DefaultQueryPlanCaching = false;\n}\n</code></pre>\n\n<p>However, I can't see this property anywhere on the db context. It doesn't even have ContextOptions.</p>\n\n<p>There is somewhere on the internet mentioned to cast it to IObjectContextAdapter, there I get ContextOptions, but still not that property</p>\n\n<pre><code>((IObjectContextAdapter)db).ObjectContext.ContextOptions.?\n</code></pre>\n\n<p>Note that I'm using the default generation in EF5 which uses DbContext and DbSets.</p>\n\n<p>How do I turn it off? Note also that this is RTM, not beta, or RC of .NET 4.5</p>\n"},{"tags":["c#","entity-framework"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1264,"score":0,"question_id":9287454,"title":"Check the existence of a record before inserting a new record","body":"<p>I'm using the Ado.net Entity Framework for the first time and I need to check if this record exist before I insert it to the database. Preferably I'd search if AuthodSSID exists  and not the key (AuthorID). I'm using VS2010, Framework 4. System.Data.Entity is 3.5.0.0.</p>\n\n<p>I googled, but found no answer for this question.</p>\n\n<pre><code>PublishingCompanyEntities publishContext;\npublishContext = new PublishingCompanyEntities();\n\nprivate void createNew_Click(object sender, EventArgs e)\n{\n    Author newAuthor = new Author();\n    newAuthor.FirstName = firstName.Text;\n    newAuthor.LastName = lastName.Text;\n    newAuthor.AuthodSSID = 20;\n    newAuthor.AuthorID = 10\n//Check if record exist here\n    publishContext.AddToAuthor(newAuthor);//insert if does not exist\n\n}\n</code></pre>\n"},{"tags":["c#","visual-studio-2010","entity-framework","unit-testing","rhino-mocks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13109192,"title":"shouldn't I mock the entities of EF when unittesting?","body":"<p>I use EF4.</p>\n\n<p>I read this post about mocking EF</p>\n\n<p><a href=\"http://www.codeproject.com/Articles/447988/How-to-Mock-Test-an-Entity-Framework-Model-First-P\" rel=\"nofollow\">http://www.codeproject.com/Articles/447988/How-to-Mock-Test-an-Entity-Framework-Model-First-P</a></p>\n\n<p>Sholdn't we abstract the entities types as well? </p>\n\n<p>In order to keep dicupling between the DAL and the BL?</p>\n\n<p>in the post above I see he used EF concrete generated entities types:</p>\n\n<pre><code>[TestMethod]\npublic void GetCustomer()\n{\n    ContextContainerMock container = new ContextContainerMock();\n    IMyEntities en = container.Current;\n\n\n**Customer c = new Customer { ID = 1, FirstName = \"John\", LastName = \"Doe\" };**\n    en.Customers.AddObject(c);\n\n    CustomerService service = new CustomerService(container);\n    var a = service.GetCustomer(1);\n\n    Assert.AreEqual(c.FirstName, a.FirstName);\n    Assert.AreEqual(c.LastName, a.LastName);\n}\n</code></pre>\n"},{"tags":["c#","silverlight","entity-framework","silverlight-5.0","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13128200,"title":"The underlying provider failed on Open","body":"<p>I'm using <code>EntityFramework</code> with <code>Windows Azure</code> platform. It works so well in <code>LOCAL</code> mode, but when I'm trying to run my <code>Silverlight</code> application on Web. I get an error:</p>\n\n<blockquote>\n  <p>The underlying provider failed on Open.</p>\n</blockquote>\n\n<pre><code>&lt;configuration&gt;\n  &lt;system.webServer&gt;\n    &lt;modules runAllManagedModulesForAllRequests=\"true\"&gt;\n      &lt;add name=\"DomainServiceModule\" preCondition=\"managedHandler\" type=\"System.ServiceModel.DomainServices.Hosting.DomainServiceHttpModule, System.ServiceModel.DomainServices.Hosting, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" /&gt;\n    &lt;/modules&gt;\n    &lt;validation validateIntegratedModeConfiguration=\"false\" /&gt;\n  &lt;/system.webServer&gt;\n  &lt;appSettings&gt;\n    &lt;add key=\"aspnet:UseTaskFriendlySynchronizationContext\" value=\"true\" /&gt;\n    &lt;add key=\"ValidationSettings:UnobtrusiveValidationMode\" value=\"WebForms\" /&gt;\n  &lt;/appSettings&gt;\n  &lt;system.web&gt;\n    &lt;httpModules&gt;\n      &lt;add name=\"DomainServiceModule\" type=\"System.ServiceModel.DomainServices.Hosting.DomainServiceHttpModule, System.ServiceModel.DomainServices.Hosting, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" /&gt;\n    &lt;/httpModules&gt;\n    &lt;customErrors mode=\"Off\" /&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.5\"&gt;\n      &lt;assemblies&gt;\n        &lt;add assembly=\"System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n      &lt;/assemblies&gt;\n    &lt;/compilation&gt;\n    &lt;httpRuntime requestValidationMode=\"4.5\" targetFramework=\"4.5\" encoderType=\"System.Web.Security.AntiXss.AntiXssEncoder, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\" /&gt;\n    &lt;pages controlRenderingCompatibilityVersion=\"4.5\" /&gt;\n    &lt;machineKey compatibilityMode=\"Framework45\" /&gt;\n  &lt;/system.web&gt;\n  &lt;system.serviceModel&gt;\n    &lt;serviceHostingEnvironment aspNetCompatibilityEnabled=\"true\" multipleSiteBindingsEnabled=\"true\" /&gt;\n  &lt;/system.serviceModel&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"DatabaseEntities\" connectionString=\"metadata=res://*/Model.csdl|res://*/Model.ssdl|res://*/Model.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=lnqg2ulkjr.database.windows.net;initial catalog=BuilderDatabase;persist security info=True;user id=XXXXX;password=XXXXX;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>I was checking that this is a problem in the connection string with <code>Integrated Security</code> but in my case I don't have that property. What could be the error?</p>\n"},{"tags":["c#","database","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":106,"score":0,"question_id":13116764,"title":"How to update relational database TABELS?","body":"<p>I am using Entity Framework 4.0. I am facing problem while updating data in the database. I am getting this exception :</p>\n\n<blockquote>\n  <p><em>An object with the same key already exists in the ObjectStateManager.</em><br>\n  <em>The ObjectStateManager cannot track multiple objects with the same key.</em></p>\n</blockquote>\n\n<p>I am working on the relational database. The following are 3 entities and there relation :</p>\n\n<pre><code>         1    to   *        1   to    *\nCeremony -----------&gt; Menu ------------&gt; CourseOption\n</code></pre>\n\n<p>Everything works fine, if I update the ceremony which already contains the <code>Menus</code> and <code>CourseOptions</code>. The problem comes when we insert new <code>Menu</code> and <code>CourseOption</code> entry in the ceremony at the time of update. Than I got the above mention exception.</p>\n\n<p><strong>C# code to update existing ceremony</strong></p>\n\n<pre><code>public HttpResponseMessage PutCeremony(int id, Ceremony ceremony)\n{\n    if (ModelState.IsValid &amp;&amp; id == ceremony.Id)\n    {\n       db.Entry(ceremony).State = EntityState.Modified;\n\n       try\n       {\n           db.SaveChanges();\n       }\n       catch (DbUpdateConcurrencyException)\n       {\n           return Request.CreateResponse(HttpStatusCode.NotFound);\n       }\n\n       return Request.CreateResponse(HttpStatusCode.OK, ceremony);\n    }\n    else\n    {\n       return Request.CreateResponse(HttpStatusCode.BadRequest);\n    }\n}\n</code></pre>\n\n<p>How can I get rid of this problem? Please help  </p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Today i spend a whole day in this, i read a lot of articals and stackoverflow question. I found that <code>once a product is fetched from the Context, the context is keeping track of it</code> so that why instead of using :</p>\n\n<pre><code>db.Entry(ceremony).State = EntityState.Modified;\n</code></pre>\n\n<p>I used </p>\n\n<pre><code>db.Entry(db.Ceremonies.Find(ceremony.Id)).CurrentValues.SetValues(ceremony);\n</code></pre>\n\n<p>Now by doing this change the exception gone and Ceremony entity properties are changing properly. But the ceremony related Menus entry and CourseOptions entry are not updating. Please give me suggestion guys. I am absolutely new in EF.  </p>\n"},{"tags":["c#","entity-framework","sql-server-ce-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13125305,"title":"SQL Server Compact Toolbox with disabled add connections options","body":"<p>The original problem is that I'm trying to use SQL CE 4.0 with Entity Framework 5. I have applied the service pack 1, applied different hot fix (as suggested in different forums and blogs).</p>\n\n<p>Now, I've read that SQL Server Compact Toolbox can manage these connections, but when I follow the steps, I get this menu :</p>\n\n<p><img src=\"http://i.stack.imgur.com/MCOat.png\" alt=\"enter image description here\"></p>\n\n<p>Where the two first items should be enabled. My project is a C# WPF project. I've also read (from some post over a year ago) that only Asp.Net projects are supported with this feature (Why??), is this why I get the disabled menu items?</p>\n"},{"tags":["entity-framework","rest","asp.net-mvc-4","asp.net-web-api"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13126711,"title":".Net MVC 4 REST Cannot send Object","body":"<p>I have build a .Net Mvc 4 application and now I want to extend it with REST.</p>\n\n<p>I am using the Entity Framework and I have the following problem.</p>\n\n<p>My goal is to have a system where categories have a number of products and where products can belong to multiple categories.</p>\n\n<p>As follows:</p>\n\n<pre><code>public class Categorie\n{\n    [Key]\n    public int Id { get; set; }\n    [Required]\n    public string Naam { get; set; }\n    [Required]\n    public string Omschrijving { get; set; }\n    public byte[] Plaatje { get; set; }\n    private List&lt;Product&gt; producten;\n    public virtual List&lt;Product&gt; Producten\n    {\n        get { return producten; }   \n        set { producten = value; }\n    }\n}\n\npublic class Product\n    {\n        [Key]\n        public int Id { get; set; }\n        [Required]\n        public string Naam { get; set; }\n        [Required]\n        public string Omschrijving { get; set; }\n        [Required]\n        public double Prijs { get; set; }\n        private List&lt;Categorie&gt; categorien = new List&lt;Categorie&gt;();\n\n        public virtual List&lt;Categorie&gt; Categorien\n        {\n            get { return categorien; }\n            set { categorien = value; }\n        }\n        [Required]\n        public byte[] Plaatje { get; set; }\n    }\n</code></pre>\n\n<p>NOTE: There are virtual properties in there so that my entity framework creates a merging table. Normally it links all the categorie's to the products and vice versa.</p>\n\n<p>And my rest looks like:</p>\n\n<pre><code>// GET api/Rest/5\n    public Product GetProduct(int id)\n    {\n        Product product = db.Producten.Find(id);\n        Product newProduct = new Product();\n        if (product == null)\n        {\n            throw new HttpResponseException(Request.CreateResponse(HttpStatusCode.NotFound));\n        }\n        else\n        {\n            product.Categorien = null;\n        }\n        newProduct.Id = product.Id;\n        newProduct.Naam = product.Naam;\n        newProduct.Omschrijving = product.Omschrijving;\n        newProduct.Plaatje = product.Plaatje;\n        newProduct.Prijs = product.Prijs;\n        newProduct.Categorien = product.Categorien;\n        return newProduct;\n    }\n</code></pre>\n\n<p>First problem: I cannot send any product aslong as it has a categorie. I have to make it null.\nSecond problem: I cannot send the original product because of the first problem.</p>\n"},{"tags":["entity-framework","connection-string","code-first"],"answer_count":8,"favorite_count":2,"up_vote_count":33,"down_vote_count":0,"view_count":19497,"score":33,"question_id":4741499,"title":"How to configure ProviderManifestToken for EF Code First","body":"<p>I have a asp.net MVC3 project using EF Code First.  For my unit testing I have been using SqlServerCE 4.0 and SqlExpress 2008.  Both have worked perfectly with EF generating my database as expected.</p>\n\n<p>However, when I run my application outside of a Unit Test and point it at my connection strings I get the error \"ProviderIncompatibleException: The provider did not return a ProviderManifestToken string\"</p>\n\n<p>I have read the MS documentation on this and it appears this is a SqlVersion token that the EF model generates.  The problem is that I am using the code first approach so I have no .edmx file nor do I know where to point my metadata info to because the db hasn't been generated yet.</p>\n\n<p>I know my connection strings as far as db name, username, and pass are correct because changing them to wrong values throws the expected error.  Not sure where to begin.</p>\n\n<p>Thanks.</p>\n\n<p>Here is my connection string:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n  &lt;add\n    name=\"SqlConnection\"\n    providerName=\"System.Data.SqlClient\"\n    connectionString=\"Data Source=WORKSTATION\\SQLEXPRESS;Initial Catalog=CodeFirst;Integrated Security=False;\n    Persist Security Info=False;User ID=CodeFirst_user;Password=password1;Connect Timeout=120;MultipleActiveResultSets=True;\"/&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13108202,"title":"Batching ExecuteSqlCommand statements on a code-first DbContext","body":"<p>I'm calling ExecuteSqlCommand several thousands times per minute and each one is a round-trip to the database.  The command itself calls a stored procedure and the parameters vary from INTs to NVARCHARS to \"Structured\" table-value parameters. When I look at the SQL commands generated by Entity Framework via SQL Profiler quite a sizeable chunk of data is being sent to the DB.</p>\n\n<p>Given that there is no return value from the SP, it's very much \"fire and forget\", I'd like to try to batch up the SQL commands and send, say, a batch of 10 at once.  Is this possible using Entity Framework?  Is there a way to get Entity Framework to return me the full SQL command per call and then I could concatenate the SQL myself and call ExecuteSqlCommand myself?</p>\n"},{"tags":["linq","entity-framework","linq-expressions","soft-delete","expressionvisitor"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12760933,"title":"ExpressionVisitor soft delete","body":"<p>We're having some issues implementing soft delete functionality with entity framework. The idea is to use a repository which is aware of the EF context. On the level of the repository we implemented a plugin system, these plugins get executed whenever an action is done on the repository. For example when we call <code>Repository.GetQuery&lt;Relation&gt;()</code> the plugins get executed. One of the plugins is a <code>LogicalDeletePlugin</code>, this plugin should add a <code>Where(x =&gt; x.IsDeleted)</code> statement to each table which is in the select. The idea was to implement this <code>IsDeleted</code> plugin using an <code>ExpressionVisitor</code> which visits the linq expression and finds all the \"table\" select statements and add the <code>IsDeleted</code> condition.</p>\n\n<p>To clarify the question/problem I'll explain the issue using some code examples. </p>\n\n<pre><code>void Main()\n{\nvar options = new ReadonlyRepositoryOptions() { ConnectionStringDelegate = () =&gt; Connection.ConnectionString };\nusing (var context = new ReadonlyObjectContextRepository&lt;PFishEntities&gt;(options))\n{\nvar query = context.GetQuery&lt;Relation&gt;()\n.Select(x =&gt; new {\nTest = x.Bonus,\nTestWorks = x.Bonus.Where(y =&gt; y.bonID == 100)\n});\n\nquery.InterceptWith(new TestVisitor()).ToList();\n}\n}\n\npublic class TestVisitor : ExpressionVisitor {\nprivate ParameterExpression Parameter { get; set; }\n\nprotected override Expression VisitBinary(BinaryExpression node) {\n\"VisitBinary\".Dump();\nExpression left = this.Visit(node.Left);\nExpression right = this.Visit(node.Right);\n\nvar newParams = new[] { Parameter };\nvar condition = (LambdaExpression)new LogicalDeletePlugin().QueryConditionals.First().Conditional;\nvar paramMap = condition.Parameters.Select((original, i) =&gt; new { original, replacement = newParams[i] }).ToDictionary(p =&gt; p.original, p =&gt; p.replacement);\n\nvar fixedBody = ParameterRebinder.ReplaceParameters(paramMap, condition.Body);\nreturn Expression.MakeBinary(ExpressionType.AndAlso, node, fixedBody, node.IsLiftedToNull, node.Method);\n    }\n\nprotected override Expression VisitParameter(ParameterExpression expr)\n{\nParameter = expr;\nreturn base.VisitParameter(expr);\n}\n}\nvoid Main()\n{\n    var options = new ReadonlyRepositoryOptions() { ConnectionStringDelegate = () =&gt; Connection.ConnectionString };\n    using (var context = new ReadonlyObjectContextRepository&lt;PFishEntities&gt;(options))\n    {\n        var query = context.GetQuery&lt;Relation&gt;()\n        .Select(x =&gt; new {\n            Test = x.Bonus,\n            TestWorks = x.Bonus.Where(y =&gt; y.bonID == 100)\n        });\n\n        query.InterceptWith(new TestVisitor()).ToList();\n    }\n}\n\npublic class TestVisitor : ExpressionVisitor {\n    private ParameterExpression Parameter { get; set; }\n\n    protected override Expression VisitBinary(BinaryExpression node) {\n        \"VisitBinary\".Dump();\n        Expression left = this.Visit(node.Left);\n        Expression right = this.Visit(node.Right);\n\n        var newParams = new[] { Parameter };\n        var condition = (LambdaExpression)new LogicalDeletePlugin().QueryConditionals.First().Conditional;\n        var paramMap = condition.Parameters.Select((original, i) =&gt; new { original, replacement = newParams[i] }).ToDictionary(p =&gt; p.original, p =&gt; p.replacement);\n        var fixedBody = ParameterRebinder.ReplaceParameters(paramMap, condition.Body);\n        return Expression.MakeBinary(ExpressionType.AndAlso, node, fixedBody, node.IsLiftedToNull, node.Method);\n    }\n\n    protected override Expression VisitParameter(ParameterExpression expr)\n    {\n        Parameter = expr;\n        return base.VisitParameter(expr);\n    }\n}\n</code></pre>\n\n<p>The above c# code will result in the following SQL code :</p>\n\n<pre><code>SELECT \n[UnionAll1].[relID] AS [C1], \n[UnionAll1].[C2] AS [C2], \n[UnionAll1].[C1] AS [C3], \n[UnionAll1].[bonID] AS [C4], \n[UnionAll1].[bonCUSTOMERID] AS [C5], \n[UnionAll1].[bonRELATIONARTICLEBONUSID] AS [C6], \n[UnionAll1].[bonINVOICEID] AS [C7], \n[UnionAll1].[bonSALEROWID] AS [C8], \n[UnionAll1].[bonVALUE] AS [C9], \n[UnionAll1].[bonPERCENTAGE] AS [C10], \n[UnionAll1].[bonMANUAL] AS [C11], \n[UnionAll1].[bonPAID] AS [C12], \n[UnionAll1].[IsDeleted] AS [C13], \n[UnionAll1].[InternalReference] AS [C14], \n[UnionAll1].[ConcurrencyToken] AS [C15], \n[UnionAll1].[Created] AS [C16], \n[UnionAll1].[CreatedBy] AS [C17], \n[UnionAll1].[Updated] AS [C18], \n[UnionAll1].[UpdatedBy] AS [C19], \n[UnionAll1].[DisplayMember] AS [C20], \n[UnionAll1].[ValueMember] AS [C21], \n[UnionAll1].[SearchField] AS [C22], \n[UnionAll1].[CreateDate] AS [C23], \n[UnionAll1].[C3] AS [C24], \n[UnionAll1].[C4] AS [C25], \n[UnionAll1].[C5] AS [C26], \n[UnionAll1].[C6] AS [C27], \n[UnionAll1].[C7] AS [C28], \n[UnionAll1].[C8] AS [C29], \n[UnionAll1].[C9] AS [C30], \n[UnionAll1].[C10] AS [C31], \n[UnionAll1].[C11] AS [C32], \n[UnionAll1].[C12] AS [C33], \n[UnionAll1].[C13] AS [C34], \n[UnionAll1].[C14] AS [C35], \n[UnionAll1].[C15] AS [C36], \n[UnionAll1].[C16] AS [C37], \n[UnionAll1].[C17] AS [C38], \n[UnionAll1].[C18] AS [C39], \n[UnionAll1].[C19] AS [C40], \n[UnionAll1].[C20] AS [C41], \n[UnionAll1].[C21] AS [C42], \n[UnionAll1].[C22] AS [C43]\nFROM  (SELECT \n    CASE WHEN ([Extent2].[bonID] IS NULL) THEN CAST(NULL AS int) ELSE 1 END AS [C1], \n    [Extent1].[relID] AS [relID], \n    1 AS [C2], \n    [Extent2].[bonID] AS [bonID], \n    [Extent2].[bonCUSTOMERID] AS [bonCUSTOMERID], \n    [Extent2].[bonRELATIONARTICLEBONUSID] AS [bonRELATIONARTICLEBONUSID], \n    [Extent2].[bonINVOICEID] AS [bonINVOICEID], \n    [Extent2].[bonSALEROWID] AS [bonSALEROWID], \n    [Extent2].[bonVALUE] AS [bonVALUE], \n    [Extent2].[bonPERCENTAGE] AS [bonPERCENTAGE], \n    [Extent2].[bonMANUAL] AS [bonMANUAL], \n    [Extent2].[bonPAID] AS [bonPAID], \n    [Extent2].[IsDeleted] AS [IsDeleted], \n    [Extent2].[InternalReference] AS [InternalReference], \n    [Extent2].[ConcurrencyToken] AS [ConcurrencyToken], \n    [Extent2].[Created] AS [Created], \n    [Extent2].[CreatedBy] AS [CreatedBy], \n    [Extent2].[Updated] AS [Updated], \n    [Extent2].[UpdatedBy] AS [UpdatedBy], \n    [Extent2].[DisplayMember] AS [DisplayMember], \n    [Extent2].[ValueMember] AS [ValueMember], \n    [Extent2].[SearchField] AS [SearchField], \n    [Extent2].[CreateDate] AS [CreateDate], \n    CAST(NULL AS bigint) AS [C3], \n    CAST(NULL AS bigint) AS [C4], \n    CAST(NULL AS bigint) AS [C5], \n    CAST(NULL AS bigint) AS [C6], \n    CAST(NULL AS bigint) AS [C7], \n    CAST(NULL AS decimal(20,4)) AS [C8], \n    CAST(NULL AS decimal(20,4)) AS [C9], \n    CAST(NULL AS bit) AS [C10], \n    CAST(NULL AS decimal(20,4)) AS [C11], \n    CAST(NULL AS bit) AS [C12], \n    CAST(NULL AS varchar(1)) AS [C13], \n    CAST(NULL AS varbinary(1)) AS [C14], \n    CAST(NULL AS datetimeoffset) AS [C15], \n    CAST(NULL AS varchar(1)) AS [C16], \n    CAST(NULL AS datetimeoffset) AS [C17], \n    CAST(NULL AS varchar(1)) AS [C18], \n    CAST(NULL AS varchar(1)) AS [C19], \n    CAST(NULL AS varchar(1)) AS [C20], \n    CAST(NULL AS varchar(1)) AS [C21], \n    CAST(NULL AS datetime2) AS [C22]\n    FROM  [dbo].[Relation] AS [Extent1]\n    LEFT OUTER JOIN [dbo].[Bonus] AS [Extent2] ON [Extent1].[relID] = [Extent2].[bonCUSTOMERID]\nUNION ALL\n    SELECT \n    2 AS [C1], \n    [Extent3].[relID] AS [relID], \n    2 AS [C2], \n    CAST(NULL AS bigint) AS [C3], \n    CAST(NULL AS bigint) AS [C4], \n    CAST(NULL AS bigint) AS [C5], \n    CAST(NULL AS bigint) AS [C6], \n    CAST(NULL AS bigint) AS [C7], \n    CAST(NULL AS decimal(20,4)) AS [C8], \n    CAST(NULL AS decimal(20,4)) AS [C9], \n    CAST(NULL AS bit) AS [C10], \n    CAST(NULL AS decimal(20,4)) AS [C11], \n    CAST(NULL AS bit) AS [C12], \n    CAST(NULL AS varchar(1)) AS [C13], \n    CAST(NULL AS varbinary(1)) AS [C14], \n    CAST(NULL AS datetimeoffset) AS [C15], \n    CAST(NULL AS varchar(1)) AS [C16], \n    CAST(NULL AS datetimeoffset) AS [C17], \n    CAST(NULL AS varchar(1)) AS [C18], \n    CAST(NULL AS varchar(1)) AS [C19], \n    CAST(NULL AS varchar(1)) AS [C20], \n    CAST(NULL AS varchar(1)) AS [C21], \n    CAST(NULL AS datetime2) AS [C22], \n    [Extent4].[bonID] AS [bonID], \n    [Extent4].[bonCUSTOMERID] AS [bonCUSTOMERID], \n    [Extent4].[bonRELATIONARTICLEBONUSID] AS [bonRELATIONARTICLEBONUSID], \n    [Extent4].[bonINVOICEID] AS [bonINVOICEID], \n    [Extent4].[bonSALEROWID] AS [bonSALEROWID], \n    [Extent4].[bonVALUE] AS [bonVALUE], \n    [Extent4].[bonPERCENTAGE] AS [bonPERCENTAGE], \n    [Extent4].[bonMANUAL] AS [bonMANUAL], \n    [Extent4].[bonPAID] AS [bonPAID], \n    [Extent4].[IsDeleted] AS [IsDeleted], \n    [Extent4].[InternalReference] AS [InternalReference], \n    [Extent4].[ConcurrencyToken] AS [ConcurrencyToken], \n    [Extent4].[Created] AS [Created], \n    [Extent4].[CreatedBy] AS [CreatedBy], \n    [Extent4].[Updated] AS [Updated], \n    [Extent4].[UpdatedBy] AS [UpdatedBy], \n    [Extent4].[DisplayMember] AS [DisplayMember], \n    [Extent4].[ValueMember] AS [ValueMember], \n    [Extent4].[SearchField] AS [SearchField], \n    [Extent4].[CreateDate] AS [CreateDate]\n    FROM  [dbo].[Relation] AS [Extent3]\n    INNER JOIN [dbo].[Bonus] AS [Extent4] ON ([Extent3].[relID] = [Extent4].[bonCUSTOMERID]) AND (100 = [Extent4].[bonID]) AND ([Extent4].[IsDeleted] &lt;&gt; cast(1 as bit))) AS [UnionAll1]\nORDER BY [UnionAll1].[relID] ASC, [UnionAll1].[C1] ASC\n</code></pre>\n\n<p>As you can see in the resulting SQL query the <code>IsDeleted</code> statements gets added to the <code>TestWorks = x.Bonus.Where(y =&gt; !y.IsDeleted)</code> \"select\" code. That's what the <code>TestVisitor</code> is currently doing. But the question is now how we can also implement this on the other selects, the <code>x =&gt; !x.IsDeleted</code> doesn't get added on the <code>Test = x.Bonus</code> part.</p>\n\n<p>Is the ExpressionVisitor the correct approach to get this done or should I go with another solution? All help is appreciated! If the explanation wasn't clear enough just let me know and I'll try to give some additional info!</p>\n\n<p>Edit:</p>\n\n<pre><code>protected override Expression VisitMember(MemberExpression node)\n    {\n        var test = typeof(bool);\n        if (node.Type != test &amp;&amp; node.Type != typeof(string))\n        {\n            var type = typeof(ArticleVat);\n            var condition = (LambdaExpression)Condition;\n            var newParams = new[] { Expression.Parameter(type, \"x\") };\n            var paramMap = condition.Parameters.Select((original, i) =&gt; new { original, replacement = newParams[i] }).ToDictionary(p =&gt; p.original, p =&gt; p.replacement);\n            var fixedBody = ParameterRebinder.ReplaceParameters(paramMap, condition.Body);\n            condition = Expression.Lambda(fixedBody, newParams);\n            var whereM = whereMethod.MakeGenericMethod(new [] { type });\n            var expr = Expression.Property(node.Expression, \"ArticleVat\");\n            var whereExpr = Expression.Call(whereM, expr, condition);\n//          whereExpr.Dump();\nnode.Dump();\n//          return Expression.MakeMemberAccess(whereExpr, node.Expression.Type.GetMember(node.Member.Name).Single());\n//           return Expression.MakeMemberAccess(\n//                whereExpr,\n//                node.Expression.Type.GetMember(node.Member.Name).Single());\n        }\n\n        return base.VisitMember(node);\n    }\n</code></pre>\n\n<p>The above is what I've added to the ExpressionVisitor. Now when I uncomment the return Expression.MamkeMemberaccess code an exception is thrown because it doesn't expect a MemberExpression or something.</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","razor"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":13123266,"title":"refresh a partial view in a main view after an action occurs inside that partial view","body":"<p>I have a partial view that sits in my main view like this: </p>\n\n<pre><code> &lt;div id=\"complaintlist\"&gt;\n    @Html.Action(\"ShowCaseComplaints\", \"Cases\", new { caseid = Model.CasesID })\n&lt;/div&gt;\n</code></pre>\n\n<p>This is the partial view:</p>\n\n<pre><code>@model IEnumerable&lt;cummins_db.ViewModels.CaseComplaintsViewModel&gt;\n\n&lt;table width=\"100%\"&gt;\n &lt;tr&gt;\n    &lt;th&gt;&lt;/th&gt;\n    &lt;th&gt;&lt;/th&gt;\n    &lt;th&gt;Complaint Code&lt;/th&gt;\n    &lt;th&gt;Complaint Description&lt;/th&gt;\n    &lt;th&gt;Delete&lt;/th&gt;\n&lt;/tr&gt;  \n@foreach (var item in Model)\n    {\n&lt;tr&gt;\n    &lt;td&gt;\n         @Html.HiddenFor(modelItem =&gt; item.CasesID )    \n    &lt;/td&gt;\n    &lt;td&gt;\n        @Html.HiddenFor(modelItem =&gt; item.CaseComplaintID )    \n    &lt;/td&gt;\n    &lt;td&gt;\n        @Html.DisplayFor(modelItem =&gt; item.ComplaintCode )    \n    &lt;/td&gt;\n    &lt;td&gt;\n        @Html.DisplayFor(modelItem =&gt; item.ComplaintType)\n    &lt;/td&gt;\n    &lt;td&gt;\n        @Ajax.ActionLink(\"Delete\", \"RemoveCodeFromCase\", \"Cases\", new { caseid = item.CasesID, id = item.CaseComplaintID }, null)\n    &lt;/td&gt;        \n &lt;/tr&gt;\n    }\n &lt;/table&gt;\n</code></pre>\n\n<p>This partial view has an action that allows the user to remove a record from the model in the partial view. Here is the action called RemoveCodeFromCase:</p>\n\n<pre><code>public ActionResult RemoveCodeFromCase(int caseid, int id)\n        {\n        if (ModelState.IsValid)\n            {\n            CaseComplaint c = db.CaseComplaints.Find(id);\n            db.CaseComplaints.Remove(c);\n            db.SaveChanges();\n\n            var data = (from C in db.CaseComplaints\n                        where C.CasesID == caseid\n                        select new CaseComplaintsViewModel()\n                        {\n                            CasesID = C.CasesID,\n                            CaseComplaintID = C.ComplaintCodeID,\n                            ComplaintCode = C.ComplaintCode.ComplaintCodeName,\n                            ComplaintType = C.ComplaintCode.ComplaintType\n                        }).ToList();\n\n\n            return PartialView(\"_CaseComplaintCodes\", data);\n\n            }\n\n        return PartialView(\"_CaseComplaintCodes\");\n        }\n</code></pre>\n\n<p>I am trying to understand how to refresh my partial view after this action runs.</p>\n\n<p>Thx</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","entity-framework-4.3"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13122166,"title":"Defining foreign key in EF 4.3.1 Code first using TPH","body":"<p>I have created three different classes and one base class which store different types of addresses.\nBase class is postal address which has relation to User (to whom is current address attached) and Post, which contain information about zip code and city.</p>\n\n<pre><code>public class PostalAddress\n{\n    public virtual User User { get; set; }\n    public DateTime LastUsed { get; private set; }\n\n    public string OrientationNumber { get; set; }\n    public int UserId { get; set; }\n\n    public int PostId { get; set; }\n\n    public int Id { get; set; }\n    public virtual Post Post { get; private set; }\n\n    public string Street  { get; set; }\n}\n\npublic class Post\n{\n    public Post()\n    {\n        InvoicingAddresses = new List&lt;InvoicingAddress&gt;();\n        ShippingAddresses = new List&lt;ShippingAddress&gt;();\n        UserAddresses = new List&lt;UserAddress&gt;();\n    }\n\n    public virtual City City { get; set; }\n    public virtual ICollection&lt;InvoicingAddress&gt; InvoicingAddresses { get; private set; }\n    public virtual ICollection&lt;ShippingAddress&gt; ShippingAddresses { get; private set; }\n    public virtual ICollection&lt;UserAddress&gt; UserAddresses { get; private set; }\n    public int CityId { get; set; }\n    public int Id { get; set; }\n    public string ZipCode { get; set; }   \n}\n</code></pre>\n\n<p>Class PostalAddress is mapped using class PostalAddressMap</p>\n\n<pre><code>public class PostalAddressMap : EntityTypeConfiguration&lt;PostalAddress&gt;\n{\n    public PostalAddressMap()\n    {\n        // Primary Key\n        HasKey(t =&gt; t.Id);\n\n        // Properties\n        // Table &amp; Column Mappings\n        ToTable(\"PostalAddress\");\n        Property(t =&gt; t.Id).HasColumnName(\"Id\");\n        Property(t =&gt; t.LastUsed).HasColumnName(\"LastUsed\").HasColumnType(\"datetime2\");\n        Property(t =&gt; t.OrientationNumber).HasColumnName(\"OrientationNumber\");\n        Property(t =&gt; t.UserId).HasColumnName(\"UserId\");\n        Property(t =&gt; t.PostId).HasColumnName(\"PostId\");\n        Property(t =&gt; t.Street).HasColumnName(\"Street\");            \n\n        // Relationships\n        HasRequired(t =&gt; t.Post).WithMany(t =&gt; t.InvoicingAddresses).HasForeignKey(d =&gt; d.PostId);\n        HasRequired(t =&gt; t.User)\n            .WithMany(t =&gt; t.UserAddressess)\n            .HasForeignKey(d =&gt; d.UserId);\n\n\n    }\n}\n</code></pre>\n\n<p>Classes InvoicingAddress, ShippingAddress and UserAddress are inherited from PostalAddress class using <a href=\"http://weblogs.asp.net/manavi/archive/2010/12/24/inheritance-mapping-strategies-with-entity-framework-code-first-ctp5-part-1-table-per-hierarchy-tph.aspx\" rel=\"nofollow\">Table per hierarchy</a> approach. If I want to set relationships using line</p>\n\n<pre><code>        HasRequired(t =&gt; t.Post).WithMany(t =&gt; t.InvoicingAddresses).HasForeignKey(d =&gt; d.PostId);\n</code></pre>\n\n<p>I receive compiler error <strong>Cannot implicitly convert type 'System.Collections.Generic.ICollection&lt;InvoicingAddress&gt;' to 'System.Collections.Generic.ICollection&lt;PostalAddress&gt;'. An explicit conversion exists (are you missing a cast?)</strong></p>\n\n<p>Please, can you help me how can I set foreign key between PostalAddress child classes and other TPT types?</p>\n\n<p>Thank you for any helpful answer.</p>\n"},{"tags":["c#","sql-server-2008","entity-framework","exception-handling","foreign-keys"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":60,"score":0,"question_id":13123397,"title":"Getting INSERT statement conflicted with the FOREIGN KEY on SaveChanges()","body":"<p>I am new to working with the Entity Framework with SQL Server and I am having trouble inserting a record into my database. The problem is with 3 tables that are linked with primary keys and a foreign key and in the past I have not used databases with foreign keys.</p>\n\n<p>I am just trying to get some test data into the database for now but I keep getting the error: </p>\n\n<blockquote>\n  <p><em>INSERT statement conflicted with the FOREIGN KEY</em></p>\n</blockquote>\n\n<p>Can anyone help me get started with inserting into my database please? Here is the code I am using:</p>\n\n<pre><code>private void button3_Click(object sender, EventArgs e)\n{\n    TaxiDBEntities db = new TaxiDBEntities(); //connection to database\n    DriverStatus newDriverStatus = new DriverStatus(); // driver status object\n\n    /*populate the new driver object*/\n    //newDriverStatus.DriverID = Convert.ToInt32(driverComboBox.Text);\n    //newDriverStatus.Status = statusTextBox.Text;\n    //newDriverStatus.Area = areaTextBox.Text;\n\n    Driver driver = new Driver();\n\n    int driverIDInt = Convert.ToInt32(driverComboBox.Text);\n\n    //driver = db.Drivers.SingleOrDefault(p =&gt; p.DriverId == driverIDInt);\n    //if (driver == null)\n    //{\n        driver.DriverId = driverIDInt;\n        driver.Fname = \"test\";\n        driver.Lname = \"test\";\n    //}\n\n    db.DriverStatus.AddObject(newDriverStatus); // add driver object to entity model\n\n    DriverLog driverLog = new DriverLog();\n\n    driverLog.driverLogID = driverIDInt;\n    driverLog.DriverID = driverIDInt;\n    driverLog.date = DateTime.Now;\n\n    db.DriverLog.AddObject(driverLog);\n\n    DriverStatus driverStatus = new DriverStatus();\n\n    driverStatus.DriverID = driverIDInt;\n    driverStatus.Status = \"1\";\n    driverStatus.Area = \"1\";\n\n    db.DriverStatus.AddObject(driverStatus);\n\n    try\n    {\n        db.SaveChanges();\n    }\n    catch (Exception ex)\n    {\n        MessageBox.Show(ex.ToString());\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","context"],"answer_count":2,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":1146,"score":5,"question_id":5205606,"title":"EF Context Management","body":"<p>What is the best way to manage the context of Entity Framework when using MVC application?</p>\n\n<p>I am using a Repository/Service pattern.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>After looking through some of these questions: stackoverflow.com/users/587920/sam-striano, I am more confused then before. Some say use the context per repository, but wht if I want to use multiple repositories in one controller method?</p>\n\n<p>And to follow good separation design, how do you use UnitOfWork in the MVC app with out making it dependent on EF? I want to be able to unit test my controllers, model, services, etc. using a mock context?</p>\n"},{"tags":["c#","entity-framework","domain-driven-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12177875,"title":"DDD Database first . How to handle aggregates","body":"<p>I'm trying to learn the concept of DDD. I have made a project which i use the database first approach.\nIn the infrastructure i have added an edmx file witch i have chosen to auto generate the entites. Now in the \"Domain\" I'm trying to create aggregates.</p>\n\n<p>But here i got some problems. Im trying to create a aggregate named \"User\" but User already exists in the entites that the ef autogenerated. Should i rename the aggregate \"User\" to something else and when getting data from the db map it from db entites to the aggregate.</p>\n\n<p>I'm doing it wrong ? Or shouldn't i autogenerate the entities or is the enties aggregates ?</p>\n\n<p>Plz advise and help.</p>\n\n<p><img src=\"http://i.stack.imgur.com/DXEz0.png\" alt=\"enter image description here\"></p>\n"},{"tags":["entity-framework","entity-framework-4","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13103358,"title":"How to write a dynamic where 'like' query in Entity framework?","body":"<p>Here is my code:</p>\n\n<pre><code>//order my baselist is context.Entity \npublic static GridData Getdata&lt;T&gt;(ObjectSet&lt;T&gt; baseList,\n    int currentPage,\n    int rowsPerPage,\n    string sortcolumn,\n    string sortord,\n    string searchQuery,\n    string searchColumns)where T: class{\nvar query = baseList.OrderBy(\"it.\" + sortcolumn + \" \" + sortord);\n        string strPredicate = string.Empty;\n        if (!string.IsNullOrEmpty(searchColumns))\n        {\n            strPredicate = \"it.\" + searchColumns + \" LIKE   @\" + searchColumns + \"  \";\n\n            query = baseList.Where(strPredicate, new ObjectParameter(searchColumns, searchQuery)).OrderBy(\"it.\" + sortcolumn + \" \" + sortord);\n        }\n}\n</code></pre>\n\n<p>My problem is i am trying to write down or form a like query in entity framework and seems like it does not support it.</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":170,"score":2,"question_id":12093135,"title":"Entity Framework concurrency issue using stored procedures","body":"<p>I am using ASP.NET to build a application for a retail company. I am using the Entity Framework (model-first) as my data access layer. I am using stored procedures to do my CRUD operations and all columns are mapped and seems to be correct as all CRUD functionality are working as expected. </p>\n\n<p>But I am having concurrency issues with the DELETE operation.</p>\n\n<p>I've added a <code>TimeStamp</code> column to the table I am doing the CRUD operation on. The UPDATE operation works fine as it is updating by primary key and the <code>TimeStamp</code> value. Thus if no rows are affected with the UPDATE operation, because of a change in the <code>TimeStamp</code> value, the Entity Framework throws a <code>OptimisticConcurrencyException</code>. </p>\n\n<p>The <code>DELETE</code> operation works on the same principle as it is deleting by primary key and the <code>TimeStamp</code> value. But no exception is thrown when the <code>TimeStamp</code> value does not match between the entity and the database.</p>\n\n<p>In the C# delete method I do retrieve the latest record first and then update the <code>TimeStamp</code> property to another <code>TimeStamp</code> value (It might be different to the retrieved value). After some investigation by using SQL Profiler I can see that the <code>DELETE</code> stored procedure is executed but the <code>TimeStamp</code> parameter that is passed to the stored procedure is the latest <code>TimeStamp</code> value <strong>and not the value that I have set the <code>TimeStamp</code> property to</strong>. Thus the record is deleted and the Entity Framework does not throw an exception.</p>\n\n<p>Why would the Entity Framework still pass the retrieved <code>TimeStamp</code> value to the Stored Procedure and not the value that I have assigned the property? Is this be design or am I missing something?</p>\n\n<p>Any help will be appreciated! (where is Julie Lerman when you need her! :-))</p>\n"},{"tags":["jquery",".net","asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13120862,"title":"ASP.net Dynamically add a table join and hook up existing table from user selection","body":"<p>I have a table that joins two together: table B contains key data that links table C to table A and retains the ability to have table C linked to any future table.</p>\n\n<p>I know how to create and add new entries of C based on user input and create table B from user input. However, to link table B to A and C, it requires input of the key data of A and C, then C 'exists in A'. From the users perspective, they want a clean interface, so they don't want to have to manually enter the key id of A and C when B is created.</p>\n\n<p>Instead, what I want is that the creation of the join table B is hidden and it appears they are just selecting C. So from a drop down list or multi box, they select their item, a new entry in B is added to the list&lt;> and the key data from A and C is assigned. </p>\n\n<p>With the inter-mixing of views and controllers, I am finding it very difficult getting this concept working and assigning to correct information.</p>\n\n<p>I have been following tutorials such as: <a href=\"http://www.asp.net/mvc/tutorials/javascript/working-with-the-dropdownlist-box-and-jquery/adding-a-new-category-to-the-dropdownlist-using-jquery-ui\" rel=\"nofollow\">http://www.asp.net/mvc/tutorials/javascript/working-with-the-dropdownlist-box-and-jquery/adding-a-new-category-to-the-dropdownlist-using-jquery-ui</a></p>\n\n<p>However this is very static.</p>\n\n<p>I will happily post my code, but it is pretty standard, Recipe is A, RecipeIngredient is B and Ingredient is C.</p>\n"},{"tags":["c#","mysql","linq","entity-framework","formatexception"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":73,"score":2,"question_id":13120426,"title":"Why is there an input string exception for a query without where clause?","body":"<p>Using ASP.NET MVC 2, Entity Framework, MySQL, VS2010 Ultimate. I have researched long but running out of clue for general Input Exception hit from my code. Although I have removed all the where clause:</p>\n\n<pre><code>var record = (from staff in pmsEntities.ef_staff                          \n                           select staff\n                           ).FirstOrDefault();\n</code></pre>\n\n<blockquote>\n  <p>[FormatException: Input string was not in a correct format.]    </p>\n\n<pre><code>System.Number.StringToNumber(String str, NumberStyles options, NumberBuffer&amp; number, NumberFormatInfo info, Boolean parseDecimal) +9594283    \nSystem.Number.ParseInt32(String s, NumberStyles style, NumberFormatInfo info) +119    \nSystem.String.System.IConvertible.ToInt32(IFormatProvider provider) +46    \nSystem.Convert.ChangeType(Object value, Type conversionType, IFormatProvider provider) +385   \nMySql.Data.Entity.EFMySqlDataReader.ChangeType(Object sourceValue, Type targetType) +566    \nMySql.Data.Entity.EFMySqlDataReader.GetValue(Int32 ordinal) +231    \nSystem.Data.Common.Internal.Materialization.ErrorHandlingValueReader`1.GetValue(DbDataReader reader, Int32 ordinal) +215    \nSystem.Data.Common.Internal.Materialization.Shaper.GetPropertyValueWithErrorHandling(Int32 ordinal, String propertyName, String typeName) +68    \nlambda_method(Closure , Shaper ) +1088    \nSystem.Data.Common.Internal.Materialization.Shaper.HandleEntityAppendOnly(Func`2 constructEntityDelegate, EntityKey entityKey, EntitySet entitySet) +218    \nlambda_method(Closure , Shaper ) +291    \nSystem.Data.Common.Internal.Materialization.Coordinator`1.ReadNextElement(Shaper shaper) +170    \nSystem.Data.Common.Internal.Materialization.SimpleEnumerator.MoveNext()  +84    \nSystem.Linq.Enumerable.FirstOrDefault(IEnumerable`1 source) +4187840    \nSystem.Data.Objects.ELinq.ObjectQueryProvider.&lt;GetElementFunction&gt;b__1(IEnumerable`1 sequence) +41    \nSystem.Data.Objects.ELinq.ObjectQueryProvider.ExecuteSingle(IEnumerable`1 query, Expression queryRoot) +59    \nSystem.Data.Objects.ELinq.ObjectQueryProvider.System.Linq.IQueryProvider.Execute(Expression expression) +150    \nSystem.Linq.Queryable.FirstOrDefault(IQueryable`1 source) +265    \nIDP.Models.Login.IsValid(String _username, String _pwd, Int32 _type) in C:\\Users\\george\\Desktop\\Um\\idp\\nur\\IDP\\IDP\\Models\\Login.cs:36\n</code></pre>\n</blockquote>\n"}]}
{"total":18927,"page":5,"pagesize":100,"questions":[{"tags":["c#","silverlight","entity-framework","domainservices"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13120252,"title":"DbGeography + entity framework 5 + Silverlight + DomainService","body":"<p>I have create Entity with DbGeography and add it to my Domainservice.\nBut my SL app didn't see this filed.\nHow can I use DbGeography in SL5 app?</p>\n"},{"tags":["entity-framework","entity-framework-4.1","ef-code-first","cascade"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13100690,"title":"Entity framework code first delete entities without parent","body":"<p>I have two entities Users and Phone. Relationship is one to one. Mapping is</p>\n\n<pre><code>public class User \n{\n    public virtual Phone Phone { get; set;}\n\n    public virtual int PhoneId { get; set;}\n}\n\npublic class Phone \n{\n    public virtual string Number { get; set;}\n}\n</code></pre>\n\n<p>My mapping for User is:</p>\n\n<pre><code>HasRequired(x =&gt; x.Phone).WithMany().HasForeignKey(x =&gt; x.PhoneId)\n</code></pre>\n\n<p>I have user with assigned phone.\nf.e.</p>\n\n<pre><code>Phone oldPhone = new Phone();\nPhone newPhone = new Phone();\nUser user = new User();\nuser.Phone = old;\n\n///Save user with phone.\n\nuser.Phone = newPhone;\n///Save user  with phone.\n</code></pre>\n\n<p>Now I have user with assigned phone - newPhone and not assigned oldPhone row in the DB.</p>\n\n<p>How can I setup mapping to delete entity without parent(oldPhone).</p>\n\n<p>EDITED.</p>\n\n<p>I have changed mapping according <a href=\"http://weblogs.asp.net/manavi/archive/2010/12/19/entity-association-mapping-with-code-first-one-to-one-shared-primary-key-associations.aspx\" rel=\"nofollow\">this</a> article to  </p>\n\n<pre><code> HasRequired(x =&gt; x.Phone).WithOptional();\n</code></pre>\n\n<p>For save I use this method:</p>\n\n<pre><code>public override void Save(TEntity entity)\n        {\n            if (entity == null)\n            {\n                throw new ArgumentNullException(\"entity\");\n            }\n\n            if (entity.Id &gt; 0)\n            {\n                DbContext.Set&lt;TEntity&gt;().Attach(entity);\n                DbContext.Entry(entity).State = System.Data.EntityState.Modified;\n            }\n            else\n            {\n                DbContext.Set&lt;TEntity&gt;().Add(entity);   \n            }            \n        } \n</code></pre>\n\n<p>When I attached new entity old ones doesn`t deleted from DB, so in my example I have two entities in DB oldPhone and newPhone. </p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13112219,"title":"Issues with Entity Framework Datetime Field and default values","body":"<p>Its properly because I do not understand completely, but I have had these issues a few days now. </p>\n\n<p>I have a datetime field and using entity framework.</p>\n\n<p>Scenarios:</p>\n\n<ol>\n<li><p>When I set the field to be computed (databasegenerated option) I cant update the field like this:</p>\n\n<pre><code>    db.ComputeUnites.Find(this._ComputeGuid).HeartBeat = DateTime.UtcNow;\n    db.SaveChanges();\n</code></pre></li>\n<li><p>When I don't set it to computed, and set it to required. I get an error when I try to add a new element that do not have the field set. (this makes sense, but I have set the default value on the server to set it to (<code>getutcdate()</code>)- so I hoped it would kick in when not set.</p></li>\n<li><p>I tried to set it to optional and with a default value again, then I can add new objects, but the default value is not used, instead 0:0:0 00:000 (don't remember the syntax correctly) times are inserted.</p></li>\n</ol>\n\n<p>What I would like is: When I do not set the field on a newly added object, the default value should be used. And if I provide or update the field, it should use the value coming from my c# class. </p>\n\n<p>What am I missing?</p>\n"},{"tags":["entity-framework","visual-studio-2012","redmine"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13084415,"title":"EntityFramework tries to select a none existing column?","body":"<p>I have an issue and I just can't figure out what is causing the issue.</p>\n\n<p>I have a redmine database with a 'journals' table <a href=\"http://puu.sh/1iRIt\" rel=\"nofollow\">http://puu.sh/1iRIt</a>. \nUsing the Visual Studio 2012 plugin EntityFramework Power Tools this has been reverse engineered into the following class:</p>\n\n<pre><code>public class Journal\n    {\n        public int id { get; set; }\n        public int journalized_id { get; set; }\n        public string journalized_type { get; set; }\n        public int user_id { get; set; }\n        public string notes { get; set; }\n        public System.DateTime created_on { get; set; }\n    }\n</code></pre>\n\n<p>and the map:</p>\n\n<pre><code>public class JournalMap : EntityTypeConfiguration&lt;Journal&gt;\n    {\n        public JournalMap()\n        {\n            // Primary Key\n            this.HasKey(t =&gt; t.id);\n\n            // Properties\n            this.Property(t =&gt; t.journalized_type)\n                .IsRequired()\n                .HasMaxLength(30);\n\n            this.Property(t =&gt; t.notes)\n                .HasMaxLength(65535);\n\n            // Table &amp; Column Mappings\n            this.ToTable(\"journals\", \"redmine\");\n            this.Property(t =&gt; t.id).HasColumnName(\"id\");\n            this.Property(t =&gt; t.journalized_id).HasColumnName(\"journalized_id\");\n            this.Property(t =&gt; t.journalized_type).HasColumnName(\"journalized_type\");\n            this.Property(t =&gt; t.user_id).HasColumnName(\"user_id\");\n            this.Property(t =&gt; t.notes).HasColumnName(\"notes\");\n            this.Property(t =&gt; t.created_on).HasColumnName(\"created_on\");\n        }\n    }\n</code></pre>\n\n<p>Now when I try to perform a select on the journals database using LINQ:</p>\n\n<pre><code>return context.Journals.Where(c =&gt; c.journalized_id == task.id);\n\nI see that the following query is created:\n\n-       returnValue {SELECT\n`Extent1`.`id`, \n`Extent1`.`journalized_id`, \n`Extent1`.`journalized_type`, \n`Extent1`.`user_id`, \n`Extent1`.`notes`, \n`Extent1`.`created_on`, \n`Extent1`.`Issue_id`\nFROM `journals` AS `Extent1`\n WHERE `Extent1`.`journalized_id` = @p__linq__0}    \n\n\n System.Linq.IQueryable&lt;Synchronisation.Domain.Entities.Redmine.Journal&gt; {System.Data.Entity.Infrastructure.DbQuery&lt;Synchronisation.Domain.Entities.Redmine.Journal&gt;}\n</code></pre>\n\n<p>What I don't understand is where the \"Issue_id\" is coming from, this query is causing a EntityCommandExecutionException (Inner exception: {\"Unknown column 'Extent1.Issue_id' in 'field list'\"} )</p>\n\n<p>When I manually add the Issue_id column this problem is fixed (this fix must be reverted, no changes to the database structure are ment to be made)</p>\n\n<p>I have no clue where this \"Issue_id\" coming from, does anybody have an idea how to find this out?</p>\n\n<p>Cheers,\nRick</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13117331,"title":"Issue while updating the entry in the relational tables","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13116764/issue-with-updating-database-entity\">Issue with updating database entity</a>  </p>\n</blockquote>\n\n\n\n<p>I am working on the relational database with Entity FrameWork - 4.0. I am totally new for Entity FrameWork. I have 3 tables in my database with following relations :</p>\n\n<pre><code>         1   to   many       1   to  many\nCeremony -------------&gt; Menu ------------&gt; CourseOption\n</code></pre>\n\n<p>The problem is while updating the existing ceremony in the database. Suppose the <code>Ceremony</code> which i am going to update contains <code>1 menu</code> and <code>1 courseoption</code>. If i change the existing Menu and CourseOption property value than it works fine. Changes take place to the database correctly to the database. </p>\n\n<p><strong>Main Problem</strong> -> But if i add new Menu and CourseOption Or delete existing Menu and CourseOption than there will be no effect to database for this change.</p>\n\n<p><code>C#</code> code to update entry in the database :</p>\n\n<pre><code>db.Entry(ceremony).State = EntityState.Modified;\n</code></pre>\n\n<p>What i am missing ?</p>\n"},{"tags":["mysql","entity-framework","visual-studio-2012"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1270,"score":1,"question_id":11885645,"title":"Is MySQL Entity supported in Visual Studio Ultimate 2012 RC?","body":"<p>I installed  <a href=\"http://www.mysql.com/downloads/connector/net\" rel=\"nofollow\">MySQL connector for .Net v6.5</a> and it is supported by Entity Framework. When I use Visual Studio 2012 and try to add an ADO.NET Entity Data Model, I can't see MySQL. There are just Microsoft SQL Servers. It worked in VS 2010.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/10914894/entity-framework-5-0-entityobject-generator-not-available-in-visual-studio-2012\">This question</a> said that they are working on it - is there a conclusion?</p>\n"},{"tags":["sql-server-2008","entity-framework","views"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12239833,"title":"entity framework view does not show all rows when selecting","body":"<p>I have a regular view in sql server 2008 and I`m using entity framework generate design from database approach. I already know about the keys issues for views in entity framework but that is not my solution. When I  query select * from view, it brings out 3 rows which is right, but all the rows are the same and are the first row in the database view.</p>\n\n<p>some help would be very appreciated.</p>\n"},{"tags":["entity-framework","transactions"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":303,"score":2,"question_id":5044431,"title":"Entity Framework - Generic Transaction Methods","body":"<p>We're currently using transactions with the Entity Framework, but might be switching to some other ORM in the future.  What's the best way to implement the following...</p>\n\n<pre><code>BeginTransaction();\n\n//Some update/insert/delete operations here\nentity.Name = \"Joe\";\nSaveChanges();\n\nEndTransaction();\n</code></pre>\n\n<ul>\n<li>We don't want to use the \"using\" statement</li>\n<li>We need it to work with nested transactions</li>\n</ul>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12946512,"title":"Entity Framework updating [Timestamp] property on parent entity unexpectedly","body":"<p>I'm using Entity Framework 5.0 (for .NET 4) and making use of the <strong>TimestampAttribute</strong> for optimistic concurrency checking. However I'm seeing strange/unexpected behavior where the version/timestamp of parent entities are updated as a result only of their children being updated.</p>\n\n<p>This is best explained through example code.</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel.DataAnnotations;\nusing System.Data.Entity;\nusing System.Linq;\n\nnamespace ConsoleApplication1\n{\n    public abstract class Entity\n    {\n        public int Id { get; set; }\n        public string Name { get; set; }\n\n        /*[ConcurrencyCheck]\n        [DatabaseGenerated(DatabaseGeneratedOption.Computed)]\n        [Column(TypeName = \"rowversion\")]*/\n        [Timestamp]\n        public byte[] Version { get; set; }\n    }\n\n    public class Parent : Entity\n    {\n        public virtual List&lt;Child&gt; Children { get; set; }\n    }\n\n    public class Child : Entity\n    {\n        public virtual Parent Parent { get; set; }\n        // Uncommenting property below causes the parent version to be unexpectedly updated when its child is updated.\n        // This occurs regardless of whether the Version property is decorated with [Timestamp] or [ConcurrencyCheck].\n        //public int? ParentId { get; set; }\n    }\n\n    public class TestDbContext : DbContext\n    {\n        public DbSet&lt;Parent&gt; Parents { get; set; }\n        public DbSet&lt;Child&gt; Children { get; set; }\n    }\n\n    internal class Program\n    {\n        private static void Main(string[] args)\n        {\n            Database.SetInitializer(new DropCreateDatabaseIfModelChanges&lt;TestDbContext&gt;());\n            var child = new Child {Name = \"Child\"};\n            var parent = new Parent {Name = \"Parent\", Children = new List&lt;Child&gt; {child}};\n            using (var context = new TestDbContext())\n            {\n                context.Parents.Add(parent);\n                context.SaveChanges();\n                var originalParentVersion = parent.Version.ToArray();\n                child.Name = \"New Child Name\";\n                context.SaveChanges();\n                if (!originalParentVersion.SequenceEqual(parent.Version))\n                    throw new Exception(\"Not expected\");\n            }\n            Console.Write(\"Press any key to exit.\");\n            Console.ReadKey();\n        }\n    }\n}\n</code></pre>\n\n<p>If I run this simple console application as is, the 'Not expected' exception is not thrown. However, if I uncomment the ID foreign key property (ParentID) then the exception will be thrown.</p>\n\n<p>Can anyone explain this strange behavior? Is this a bug?</p>\n"},{"tags":["asp.net","asp.net-mvc","asp.net-mvc-3","entity-framework","poco"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13113566,"title":"Asp.net mvc, entity framework, Poco - Architecture","body":"<p>I have a \"small\" enterprise application, aspnet mvc 3 + entity framework with POCO entity and repository pattern. I structured the solution in 4 projects:</p>\n\n<ol>\n<li>POCO entities</li>\n<li>Domain model</li>\n<li>Services</li>\n<li>web application</li>\n</ol>\n\n<p>When the application performs a query on the database, use one of the services provided, the service uses the repository and the small classes, as a result I have some dynamic proxy objects that I would like to convert in my domain entities, before using them in mvc views, but I do not know how. Dovrebber be set as the translator?</p>\n\n<p>This approach is reasonable?</p>\n"},{"tags":["c#","asp.net","database","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1917,"score":0,"question_id":8978367,"title":"A database with the same name exists, or specified file cannot be opened, or it is located on UNC share. what does it means?","body":"<p>I Build an ASP.NET project with PL,BL,DAl, BE of Entity Data Model(=.edmx) which I generated from a service Based DB (= .mdf) which is located in my DAL project.</p>\n\n<p>I did copied the connectionString from the BE app.config to the PL web.config</p>\n\n<p><strong>what's wrong? why I get this error:</strong></p>\n\n<blockquote>\n  <p>System.Data.SqlClient.SqlException: An attempt to attach an auto-named\n  database for file C:\\Documents and Settings\\user\\ \\\n  \\Lev\\Lev\\App_Data\\Midrasha.mdf failed. A database with the same\n  name exists, or specified file cannot be opened, or it is located on\n  UNC share.</p>\n</blockquote>\n\n<p>my code logic is PL->BL->DAL- > try to save the new object to the DB.\nthe code line which generate the problem is :</p>\n\n<pre><code>public void AddFeedback(Feedback feed)\n{\n    MidrashaEntities _context = new MidrashaEntities();\n    _context.Feedback.AddObject(feed);\n    _context.SaveChanges();  &lt;-------throw the exception\n}\n</code></pre>\n\n<p><code>Feedback</code> is a table in my DAL's SQL which I generate as Object entity.</p>\n"},{"tags":[".net","entity-framework","architecture","domain-driven-design"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":128,"score":0,"question_id":13067650,"title":"Bounded (Db)Contexts in Entity Framework Architecture","body":"<p>I have just watched Julie Lermans videos about using bounded contexts in EF (http://www.pluralsight.com/training/Courses/TableOfContents/efarchitecture) and I am now trying to work out the best way of implementing it (using POCOs). The two options I see are to either have one edmx model that defines everything and then handcraft the DbContexts to include the appropriate entities, or to have separate edmx models for each context and use the automatically created DbContexts.</p>\n\n<p>Has anyone any ideas of which is best or any pros/cons of either?</p>\n\n<p>IMHO: \nFor a single model it is a lot less classes and a lot more code re-use (though these classes are created automatically so really it will only be the extra functionality that will manually be duplicated), but I will have a lot of classes in one place and for classes that need to be specialised these will each have to have different names. E.g. Customer, CustomerForFunctionalityX, CustomerForFunctionalityB.</p>\n\n<p>With the separate models I can be much more stringent on what goes into a context as removing a property doesn't need to be a completely new entity, and I can name everything as I wish (i.e. all models can use a Customer object even if it differs between models), but now each context has entirely different entities even if they are all just mapping to the same table - which can also make it more difficult to pass them between contexts (this however shouldn't be needed too often otherwise it means the contexts have been defined wrong).</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-4","authorize"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":1,"view_count":114,"score":1,"question_id":13106487,"title":"Data level Authorization filter in ASP.Net MVC Entity Framework application","body":"<p>I was looking for a data level Authorization filter in my ASP.Net MVC 4 Application.<br>\nWe are using Entity Framework for Data access.</p>\n\n<p>The application need to display all the data but should restrict the access to certain fields in a table based on the user roles.</p>\n\n<p>eg: TASK table\n{\nint Id,\nstring TaskName,\nDateTime StartDate,\nDateTime EndDate\n}</p>\n\n<p>This whole data will be displayed to all the users and users have the options to edit the fields also. But should restrict the edit options like as follows<br>\nRole Admin can edit all the fields<br>\nRole Manager can Edit TaskName but cannot edit StartDate and EndDate<br>\nRole Users cannot Edit any of the fields  </p>\n\n<p>All these edit will be calling the Edit action in the TaskController.</p>\n\n<p>How can I implement the functionality in my application.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13114311,"title":"Entity Framework automatically assigns foreign key ?","body":"<p>I've come accross the following \"issue\" (it might just be a feature but that would be quite a strange one). Using Entity Framework 5, when inserting an entity without specifying the linked entity through foreign key, EF automatically assigns the value to the related entity (if inserted at the same moment. </p>\n\n<p>Alright, that's not very clear, so here's some code that reproduces the behavior :</p>\n\n<pre><code>[TestClass]\npublic class TestEntityFramework\n{\n    [TestMethod]\n    public void Test()\n    {\n        using (var context = new TestDataContext())\n        {\n            context.Foos.Add(new Foo { FooProp = \"FooProp\"});                \n            context.Bars.Add(new Bar {BarProp = \"BarProp\"});                \n            context.SaveChanges();\n        }\n    }       \n}\n\n\npublic class Foo\n{\n    [Key]\n    public int Id { get; set; }\n\n    public string FooProp { get; set; }\n}\n\npublic class Bar\n{\n    [Key]\n    public int Id { get; set; }\n\n    public int FooId { get; set; }\n    [ForeignKey(\"FooId\")]\n    public virtual Foo Foo { get; set; }\n\n    public string BarProp { get; set; }\n}\n\npublic class TestDataContext : DbContext\n{      \n    public virtual IDbSet&lt;Foo&gt; Foos { get; set; }\n    public virtual IDbSet&lt;Bar&gt; Bars { get; set; }        \n}\n</code></pre>\n\n<p>The Test method surprisingly works, no conflict.</p>\n\n<p>The Bar entity inserted gets linked to the Foo entity inserted at the same time even though I didn't specify it. </p>\n\n<p>However following codes both raises foreign key exceptions :</p>\n\n<pre><code>[TestMethod]\npublic void Test()\n{\n    using (var context = new TestDataContext())\n    {\n        context.Foos.Add(new Foo { FooProp = \"FooProp\"});\n        context.SaveChanges();\n        context.Bars.Add(new Bar {BarProp = \"BarProp\"});                \n        context.SaveChanges();\n    }\n}\n\n[TestMethod]\npublic void Test2()\n{\n    using (var context = new TestDataContext())\n    {\n        context.Foos.Add(new Foo { FooProp = \"FooProp\" });\n        context.Foos.Add(new Foo { FooProp = \"FooProp2\" });                \n        context.Bars.Add(new Bar { BarProp = \"BarProp\" });\n        context.SaveChanges();\n    }\n}     \n</code></pre>\n\n<p>Anyone knows if that behavior is expected ? Any thoughts ?</p>\n\n<p>Thanks </p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13114377,"title":"MVC Business logic helper","body":"<p>I have some common functions that apply throughout my application to update particular parts of the database when actions happen (Audit trail, modified dates etc). I'll use AuditTrail as an example.</p>\n\n<p><strong>Where should I be storing these functions?</strong></p>\n\n<p>Currently I am storing them in dbcontext classes</p>\n\n<pre><code>//... my db context class ...\n\npublic bool AddAuditEntry(int ID, string objectName)\n{\n    // Here I create a new AuditTrail object, assign values then insert into db.\n    // This mode doesn't have a controller.\n}\n\n// We also have a table that keeps track of modified state for \n// client side caching (nothing I have control over)\npublic bool ModifyObject(int ID)\n{\n    // Here I mark the object id with modified date then save to db\n    // This particular model doesn't have a controller either.\n}\n</code></pre>\n\n<p>I think they should belong in the model but I'm not quite sure how to implement it. Putting them in the controller isn't the best option as some of these relate only to a particular model class that may have no controller.</p>\n\n<p>My problem with them being in the model is what then is the best way to update entities?</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13113868,"title":"Does Entity Framework return the Entire Dataset?","body":"<p>Using:</p>\n\n<ul>\n<li><p>.Net 4.0</p></li>\n<li><p>EntityFramework 4.3</p></li>\n</ul>\n\n<p>IF I query a DBSet in this manner:</p>\n\n<pre><code>public DbSet&lt;Reciept&gt; Reciepts { get; set; }\nReciepts.Where(rec =&gt;rec.Number == reciept.Number &amp;&amp;\n                        rec.Project.ID == reciept.Project.ID);\n</code></pre>\n\n<p>Will the entire table be returned, and THEN filterd by my query?</p>\n\n<p>Or does it somehow translate this into SQL (Linq2SQL?), and return ONLY those rows?</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13109284,"title":"EF Code First: how to fix relationships using the fluent api","body":"<p>I've got a simple data model described with Enitity Framework but still can't fix a problem with the relationships in my model.\nI've tried some approaches using the Fluent API but always got non descriptive exceptions.</p>\n\n<p>Here's a code:</p>\n\n<pre><code>public abstract class Entity\n{\n    [Key, Column(Order = 1)]\n    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Int32 Id { get; set; }\n}\n\npublic class Language : Entity\n{\n    [Key, Column(Order = 2)]\n    public String Verbal { get; set; }\n\n    public virtual ICollection&lt;PostContent&gt; Contents { get; set; }\n}\n\npublic class Post : Entity\n{\n    public virtual ICollection&lt;PostContent&gt; Contents { get; set; }\n}\n\npublic class PostContent\n{\n    [Key, Column(Order = 1)]\n    public Int32 PostId { get; set; }\n\n    [Key, Column(Order = 2)]\n    public Int32 LanguageId { get; set; }\n\n    [ForeignKey(\"PostId\")]\n    public virtual Post Post { get; set; }\n\n    [ForeignKey(\"LanguageId\")]\n    public virtual Language Language { get; set; }\n\n    public String Content { get; set; }\n}\n\npublic class BlogContext : DbContext\n{\n    public DbSet&lt;Language&gt; Languages { get; set; }\n    public DbSet&lt;Post&gt; Posts { get; set; }\n    public DbSet&lt;PostContent&gt; PostContents { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        base.OnModelCreating(modelBuilder);\n    }\n}\n\npublic class BlogContextInitializer : DropCreateDatabaseIfModelChanges&lt;BlogContext&gt;\n{\n    protected override void Seed(BlogContext context)\n    {\n        //For test\n        context.Languages.Add(new Language { Verbal = \"Italian\" });\n        context.Languages.Add(new Language { Verbal = \"English\" });\n        context.SaveChanges();\n    }\n}\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        Database.SetInitializer&lt;BlogContext&gt;(new BlogContextInitializer());\n\n        using (BlogContext blogContext = new BlogContext())\n        {\n            //init on call.\n            var langs = blogContext.Set&lt;Language&gt;().AsEnumerable();\n            foreach (var lang in langs)\n            {\n                Console.WriteLine(\"Language Id: {0}, Verbal: {1}\", lang.Id, lang.Verbal);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I got:</p>\n\n<blockquote>\n  <p>\"The number of properties in the Dependent and Principal Roles in a\n  relationship constraint must be identical.\"</p>\n</blockquote>\n\n<p>So I'm looking for a solution of this problem.</p>\n"},{"tags":["entity-framework","c#-4.0","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13109589,"title":"How can I return DbSet<Entity> AsQueryable<EntityBase> in MVC4 api controller?","body":"<p>I am using MVC4 and entity framework. I would like to have ApiController called UserController to query users based on their properties.\nMy User entity has properties like name, phone number, address (complex type) and it should be possible to query and retrieve users based on this data. But user has also properties like password, lastsync, etc. which I do not want to be visible. Currently I don't have a solution. The following gives me the users, but with all the entities, also the ones I don't want to show.</p>\n\n<pre><code>public class UserController : BaseApiController\n{\n    public IQueryable&lt;User&gt; Get()\n    {\n        // _db is my entity framework DbContext\n        return _db.Users; \n    }\n}\n</code></pre>\n\n<p>I thought I would move all the \"publicly\" visible properties to ApiUser class and make User derive from ApiUser. Then my idea was to do like this:</p>\n\n<pre><code>public class UserController : BaseApiController\n{\n    public IQueryable&lt;ApiUser&gt; Get()\n    {\n        return _db.Users.AsQueryable&lt;ApiUser&gt;(); \n    }\n}\n</code></pre>\n\n<p>This unfortunately does not work I get the following exception:</p>\n\n<pre><code>[InvalidOperationException: The type Repository.User was not expected. Use the XmlInclude or SoapInclude attribute to specify types that are not known statically.]\n   Microsoft.Xml.Serialization.GeneratedAssembly.XmlSerializationWriterDelegatingEnumerable1.Write2_ApiUser(String n, String ns, ApiUser o, Boolean isNullable, Boolean needType) +171\n   Microsoft.Xml.Serialization.GeneratedAssembly.XmlSerializationWriterDelegatingEnumerable1.Write3_ArrayOfApiUser(Object o) +297\n</code></pre>\n\n<p>Do you know how I can achieve what I need?</p>\n"},{"tags":["entity-framework","ef-code-first","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13111971,"title":"EF 5.0 Code first EF Tracing with DBContext","body":"<p>I've a project using code first approach and EntityFramework 5.0 and im willing to add <a href=\"http://code.msdn.microsoft.com/EFProviderWrappers\" rel=\"nofollow\">tracing</a>  but haven't gone far, i've read <a href=\"http://stackoverflow.com/questions/12535079/how-to-configure-ef-tracing-provider-for-ef-code-first\">this link</a> but im unable to make it work using DbContext approach. Original EF Tracing/Caching was written using ObjectContext and after reading thru lots of pages i still can't figure out how to make it work properly. In the link provided above, i'm getting an error not finding NorthwindContext. </p>\n\n<p>Can someone provide some insight on where and how to compile a working solution using EFTracing with DBContext? A code Sample would be a huge help.</p>\n\n<p>Thanks,\nRicardo</p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":1216,"score":6,"question_id":2097947,"title":"Entity Framework: Setting update timestamp","body":"<p>All of our database tables have UpdateUserID and UpdateTS.  I'd like to have this set if my entity has changes.  Is there a way I can have this update on the spot conditionally?  </p>\n\n<p>If I manually set UpdateTS in code, then it will say that my entity has changed and will always update the object.</p>\n"},{"tags":["entity-framework","unit-testing","moq"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13072860,"title":"How do you mock adding items to a repository or DbContext using moq?","body":"<p>The examples I've seen for using moq for a repository only show how to mock things being returned. I have a somewhat strange requirement: when a query is executed, if a condition exists, a certain item should be added to the repository. I am wondering how to test this without querying the database. I know how to mock the condition existing, but then how do you setup the mock so that you can test that the certain item is added?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","iis","asp.net-mvc-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13112802,"title":"Deploying MVC 4 Application with Entity Framework","body":"<p>I've created an mvc application. I used entity framework to work with database. When I tested my application, I filled my database with some data through web interface of my application. When I deploy app on IIS server and copy .sdf file to deployed app's folder I get the error:</p>\n\n<blockquote>\n  <p>Access to the database file is not allowed. [ 1914,File name = C:\\last_project\\published\\App_Data\\Data.sdf,SeCreateFile ]</p>\n</blockquote>\n\n<p>How I can get working database in my deployed app?</p>\n"},{"tags":["entity-framework","import","loops","performance","savechanges"],"answer_count":3,"favorite_count":15,"up_vote_count":12,"down_vote_count":0,"view_count":5096,"score":12,"question_id":1930982,"title":"When should I call SaveChanges() when creating 1000's of Entity Framework objects? (like during an import)","body":"<p>I am running an import that will have 1000's of records on each run.  Just looking for some confirmation on my assumptions:</p>\n\n<p>Which of these makes the most sense:</p>\n\n<ol>\n<li>Run <code>SaveChanges()</code> every <code>AddToClassName()</code> call.</li>\n<li>Run <code>SaveChanges()</code> every <em>n</em> number of <code>AddToClassName()</code> calls.</li>\n<li>Run <code>SaveChanges()</code> after <em>all</em> of the <code>AddToClassName()</code> calls.</li>\n</ol>\n\n<p>The first option is probably slow right?  Since it will need to analyze the EF objects in memory, generate SQL, etc.</p>\n\n<p>I assume that the second option is the best of both worlds, since we can wrap a try catch around that <code>SaveChanges()</code> call, and only lose <em>n</em> number of records at a time, if one of them fails.  Maybe store each batch in an List&lt;>.  If the <code>SaveChanges()</code> call succeeds, get rid of the list.  If it fails, log the items.</p>\n\n<p>The last option would probably end up being very slow as well, since every single EF object would have to be in memory until <code>SaveChanges()</code> is called.  And if the save failed nothing would be committed, right?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","view","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13112035,"title":"MVC4 Model in View issue: in debug mode Model is missing details","body":"<p>I encountered a very strange (and annoying) issue:\nin MVC 4 web application while loading data from the database and using a foreach on the Model within the view:</p>\n\n<pre><code>@foreach (var meeting in Model)\n</code></pre>\n\n<p>i have a breakpoint in the method's beginning and examining the object meeting i see that it misses some data (reference to other tables). if I open (+) other object within meeting the missing data appears.</p>\n\n<p>Why?</p>\n\n<p>Thanks!</p>\n\n<p>here is my controller method:</p>\n\n<pre><code>        public ActionResult GetMeetingMR(int id = 0)\n    {\n        var meetingPurpose = db.MeetingPurposes.ToList();\n        ViewBag.MeetingPurpose = new SelectList(meetingPurpose, \"MeetingPurposeID\", \"MeetingPurposeName\");\n        ViewBag.MRID = id;\n        List&lt;Meeting&gt; meetings = (db.MortgageRequests.Find(id)).Meetings.ToList();\n        return View(meetings);\n\n    }\n</code></pre>\n"},{"tags":["c#","asp.net",".net","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13109684,"title":"Entity Framework Code First Error - EntityType 'Variable' has no key defined","body":"<p>I'm using Entity Framework 5 Code First in an ASP.NET MVC 4 project and I'm getting the following error:</p>\n\n<blockquote>\n  <p>One or more validation errors were detected during model generation:</p>\n  \n  <p>\\tSystem.Data.Entity.Edm.EdmEntityType: : EntityType 'Variable' has no key defined. Define the key for this EntityType.\n  \\tSystem.Data.Entity.Edm.EdmEntitySet: EntityType: EntitySet 'Variables' is based on type 'Variable' that has no keys defined.</p>\n  \n  <p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n  \n  <p>Exception Details: System.Data.Entity.ModelConfiguration.ModelValidationException: One or more validation errors were detected during model generation:</p>\n  \n  <p>\\tSystem.Data.Entity.Edm.EdmEntityType: : EntityType 'Variable' has no key defined. Define the key for this EntityType.\n  \\tSystem.Data.Entity.Edm.EdmEntitySet: EntityType: EntitySet 'Variables' is based on type 'Variable' that has no keys defined.</p>\n</blockquote>\n\n<p>This has been driving me nuts for the last hour. I have searched my solution and have nothing called 'Variable' at all!</p>\n\n<p>My context looks like this:</p>\n\n<pre><code>public class MyContext : DbContext, IDisposedTracker\n{\n\n    public DbSet&lt;Project&gt; Projects { get; set; }\n\n    public bool IsDisposed { get; set; }\n}\n</code></pre>\n\n<p>My model looks like this:</p>\n\n<pre><code>public class Project\n{\n    [Key]\n    public int Uid { get; set; }\n\n    public string Id { get; set; }\n\n    public string Name { get; set; }\n\n    public string Description { get; set; }\n\n    public List&lt;Task&gt; Tasks { get; internal set; }\n}\n</code></pre>\n\n<p>Task looks like this:</p>\n\n<pre><code>public class Task\n{\n    [Key]\n    public int Uid { get; set; }\n\n    public string Id;\n\n    public string Name;\n}\n</code></pre>\n"},{"tags":[".net","database","entity-framework","mvc","c#-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1565,"score":1,"question_id":6073623,"title":"Entity Framework Enums as POCO only","body":"<p>I am trying to save an Enum that exists in my model down to the database but everytime I do Entity Framwework complains that there is no look up table associated with the Enum. I do not want a look up table, I just want the enum to exist in code and be stored as integers in the database.</p>\n\n<blockquote>\n  <p>An error occurred while saving\n  entities that do not expose foreign\n  key properties for their\n  relationships. The EntityEntries\n  property will return null because a\n  single entity cannot be identified as\n  the source of the exception. Handling\n  of exceptions while saving can be made\n  easier by exposing foreign key\n  properties in your entity types. See\n  the InnerException for details.</p>\n  \n  <p>\"Cannot insert the value NULL into\n  column 'Type', table\n  'Test.dbo.Interests'; column\n  does not allow nulls. INSERT\n  fails.\\r\\nThe statement has been\n  terminated.</p>\n</blockquote>\n\n<p>The value for Type is definitely not null, EF just treats it that way cause it can't find a Foreign key table that I don't want in the first place. </p>\n\n<p><strong>How do I get entity framework to treat my enum as an int and then convert back out when I call down to the database to retrieve my model?</strong></p>\n"},{"tags":[".net","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":443,"score":1,"question_id":11101148,"title":"Entity Framework 5 Enums with Description attribute using Database First","body":"<p>I would like to something like this:</p>\n\n<pre><code>public enum States\n{\n    California,\n    [Description(\"New Mexico\")]\n    NewMexico,\n    [Description(\"New York\")]\n    NewYork,\n    [Description(\"South Carolina\")]\n    SouthCarolina,\n    Tennessee,\n    Washington\n}\n</code></pre>\n\n<p>So that when I'm making a Drop Down List using .NET MVC I can use spaces in my names. If I used Code First then I could do this but I am using Database First and the .edmx designer doesn't allow attributes on the generated states (as far as I know!). Any ideas on how I can do this? I am using .NET 4.5 and EF 5 beta.</p>\n"},{"tags":["c#","wcf","entity-framework","iis","serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":11039450,"title":"StackOverflowException serializing STE EF object graph","body":"<p>We have a .NET 4, WPF, WCF, EF 4, SQL 2008 application. One of our EF models is highly relational and in the case I'm describing could and probably does contain cycles. I've been asked to troubleshoot a case in the field where all of a sudden data from this STE EF model quit showing up in the WPF client. Upon closer examination, I found that the IIS W3WP process crashes when trying to retrieve (serialize) the STE EF object graph. I used Debug Diagnostics to capture the crash.</p>\n\n<p>When I looked at the generated crash report, I discovered it was a stack overflow exception (how appropriate). The stack trace in the crash report is rather large, but the top of the stack looks something like:</p>\n\n<pre><code>System.Xml.XmlBaseWriter.StartElement(System.String ByRef, System.String, System.String, System.Xml.XmlDictionaryString) \nSystem.Xml.XmlBaseWriter.WriteStartElement(System.String, System.Xml.XmlDictionaryString, System.Xml.XmlDictionaryString) \nSystem.Runtime.Serialization.XmlWriterDelegator.WriteStartElement(System.String, System.Xml.XmlDictionaryString, System.Xml.XmlDictionaryString) \nDynamicClass.WriteXXXDataToXml(System.Runtime.Serialization.XmlWriterDelegator, System.Object, System.Runtime.Serialization.XmlObjectSerializerWriteContext, System.Runtime.Serialization.ClassDataContract) \nSystem.Runtime.Serialization.ClassDataContract.WriteXmlValue(System.Runtime.Serialization.XmlWriterDelegator, System.Object, System.Runtime.Serialization.XmlObjectSerializerWriteContext) \nSystem.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(System.Runtime.Serialization.DataContract, System.Runtime.Serialization.XmlWriterDelegator, System.Object, System.RuntimeTypeHandle) \nSystem.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(System.Runtime.Serialization.XmlWriterDelegator, System.Object, Boolean, Boolean, Int32, System.RuntimeTypeHandle) \nSystem.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerializeReference(System.Runtime.Serialization.XmlWriterDelegator, System.Object, Boolean, Boolean, Int32, System.RuntimeTypeHandle) \n</code></pre>\n\n<p>What makes exceptionally odd is that when the WCF service is hosted in Visual Studio and I run from the dev environment, the serialization works perfectly, and I get data on the client.</p>\n\n<p>Could this be resolved by IIS settings? Why would it work with Visual Studio's dev IIS, but not with the production IIS?</p>\n\n<p>I'm not sure what is causing this problem or why the serializer is even barfing? </p>\n\n<p>Should I try another means of WCF serialization w/ STE EF4?</p>\n\n<p>Any input is appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":["silverlight","entity-framework","ef-code-first","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":13098862,"title":"Ria Services : Use Entity Framework Code First Classes From Another Project","body":"<p>I have a solution with this structure : </p>\n\n<blockquote>\n  <p><br> ProjectName.Domain ==> contains POCO classes (EntityFramework\n  code first classes) <br> ProjectName.DataAccess ==> contains DbContext\n  and EntityFramework mapping codes. <br> ProjectName.Task ==> It's my\n  bushiness layer . <br> ProjectName.Presnetation.MvcClient ==> It's\n  ASP.NET MVC web client. <br>\n  ProjectName.Presentation.SilverlightClient ==> It's Silverlight 5\n  client. <br> ProjectName.WCFRiaClassLibrary ==> It's layer between\n  business logic and Silverlight client</p>\n</blockquote>\n\n<p>I've decided to handle logic such as queries and CRUD operations in business logic and use ProjectName.Task in domain service class. <br> </p>\n\n<p>I can't find any sample that use EF code first approach and load entities from another project , can you please help or give me link ? because when I try to create my DomainService class without wizard I can't find generated proxy classes in silverlight client project . \nI'm doing something like this : </p>\n\n<pre><code>    [EnableClientAccess()]\n    public class CrudService : DomainService\n     {\n    private readonly IEntityTask _entityTask;\n\n    public CrudService(IEntityTask entityTask)\n    {\n        _entityTask = entityTask;\n    }\n\n    public IQueryable&lt;Entity&gt;  GetAll ()\n    {\n       return _entityTask.GetAll().AsQueryable();\n    }\n    }\n</code></pre>\n\n<p>Is this possible to use code first classes from another project with WCF Ria Service ? <br>\nWhat is wrong with my approach?</p>\n"},{"tags":["silverlight","entity-framework","ef-code-first","wcf-ria-services","silverlight-5.0"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":233,"score":5,"question_id":13059127,"title":"EF5 Code First and RIA Services Silverlight \"Object reference not set to an instance of an object\" error building client","body":"<p>I am working on setting up a new project using Code First for entity framework 5 in silverlight using RIA services.  I have created a test project due to some issues I have encountered and will post the code below.  </p>\n\n<p>Namely, I get an 'Object reference not set to an instance of an object' error anytime I attempt to build the silverlight client project which should generate the client proxy classes.  </p>\n\n<p>Just to be clear, this error is not while running or debugging the application, but when building it.</p>\n\n<p>I have isolated that this only happens if I have any navigation properties/Foreign Keys defined on my Code First classes.</p>\n\n<p>Any help tonight would be greatly appreciated.</p>\n\n<pre><code>    public class Person\n{\n    public int PersonId { get; set; }\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public DateTime? BirthDate { get; set; }\n\n    public virtual List&lt;Character&gt; Characters { get; set; }\n}\n\npublic class Character\n{\n    public int CharacterId { get; set; }\n    public int PersonId { get; set; }\n    public virtual Person Person { get; set; }\n    public string CharacterName { get; set; }\n}\n\npublic class CharacterDbContext : DbContext\n{\n    public DbSet&lt;Person&gt; Persons { get; set; }\n    public DbSet&lt;Character&gt; Characters { get; set; }\n\n    public CharacterDbContext()\n    {\n        if (HttpContext.Current == null)\n        {\n            Database.SetInitializer&lt;CharacterDbContext&gt;(null);\n        }\n    }\n}\n\n[EnableClientAccess]\npublic class CharacterDbService : DbDomainService&lt;CharacterDbContext&gt;\n{\n    #region Basic Methods for Person with the context property of Persons\n\n    [Query]\n    public IQueryable&lt;Person&gt; GetPersons()\n    {\n        return DbContext.Persons;\n    }\n\n    [Insert]\n    public void InsertPerson(Person entity)\n    {\n        DbEntityEntry&lt;Person&gt; entityEntry = DbContext.Entry(entity);\n        if (entityEntry.State != EntityState.Detached)\n        {\n            entityEntry.State = EntityState.Added;\n        }\n        else\n        {\n            DbContext.Persons.Add(entity);\n        }\n    }\n\n    [Update]\n    public void UpdatePerson(Person entity)\n    {\n        DbContext.Persons.AttachAsModified(entity, ChangeSet.GetOriginal(entity), DbContext);\n    }\n\n    [Delete]\n    public void DeletePerson(Person entity)\n    {\n        DbEntityEntry&lt;Person&gt; entityEntry = DbContext.Entry(entity);\n        if (entityEntry.State != EntityState.Deleted)\n        {\n            entityEntry.State = EntityState.Deleted;\n        }\n        else\n        {\n            DbContext.Persons.Attach(entity);\n            DbContext.Persons.Remove(entity);\n        }\n    }\n\n    #endregion\n\n    #region Basic Methods for Character with the context property of Characters\n\n    [Query]\n    public IQueryable&lt;Character&gt; GetCharacters()\n    {\n        return DbContext.Characters;\n    }\n\n    [Insert]\n    public void InsertCharacter(Character entity)\n    {\n        DbEntityEntry&lt;Character&gt; entityEntry = DbContext.Entry(entity);\n        if (entityEntry.State != EntityState.Detached)\n        {\n            entityEntry.State = EntityState.Added;\n        }\n        else\n        {\n            DbContext.Characters.Add(entity);\n        }\n    }\n\n    [Update]\n    public void UpdateCharacter(Character entity)\n    {\n        DbContext.Characters.AttachAsModified(entity, ChangeSet.GetOriginal(entity), DbContext);\n    }\n\n    [Delete]\n    public void DeleteCharacter(Character entity)\n    {\n        DbEntityEntry&lt;Character&gt; entityEntry = DbContext.Entry(entity);\n        if (entityEntry.State != EntityState.Deleted)\n        {\n            entityEntry.State = EntityState.Deleted;\n        }\n        else\n        {\n            DbContext.Characters.Attach(entity);\n            DbContext.Characters.Remove(entity);\n        }\n    }\n\n    #endregion\n}\n</code></pre>\n"},{"tags":["c#","asp.net-mvc","entity-framework","razor","partial-views"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13109812,"title":"@Html.Partial return: The model item passed into the dictionary is of type __ but this dictionary requires a model item of type __","body":"<p>I am trying to add a partial view to my MVC4 web application and I receive the following exception:</p>\n\n<blockquote>\n  <p>The model item passed into the dictionary is of type '...Meeting', but this dictionary requires a model item of type 'System.Collections.Generic.List`1[...UserProfile]'.</p>\n</blockquote>\n\n<p>what I did so far:</p>\n\n<ol>\n<li>i added to my controller this function:</li>\n</ol>\n\n<blockquote>\n<pre><code>public PartialViewResult GetUsers()\n        {\n            var usersList = (from users in db.Users select users).ToList();\n            return PartialView(usersList);\n        }\n</code></pre>\n</blockquote>\n\n<ol>\n<li>I added the parital view:</li>\n</ol>\n\n<blockquote>\n<pre><code>@model List&lt;UserProfile&gt;\n@{\n &lt;select id=\"Meeting_SetToUser\" name=\"Meeting.SetToUser\"&gt;\n        @foreach (var item in Model)\n        {\n            &lt;option value=\"@item.UserId\"&gt;@item.FirstName @item.LastName&lt;/option&gt;\n        }\n    &lt;/select&gt;\n}\n</code></pre>\n</blockquote>\n\n<ol>\n<li>i called the partialview from my view:</li>\n</ol>\n\n<blockquote>\n<pre><code>@Html.Partial(\"GetUsers\")\n</code></pre>\n</blockquote>\n\n<p>can you please direct me to were I am doing anything wrong?</p>\n\n<p>Thank you!</p>\n"},{"tags":["entity-framework","transactions"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3222,"score":0,"question_id":5855591,"title":"Bulk inserts with EntityFramework 4.0 causes abort of transaction","body":"<p>We are receiving a file from a client (Silverlight) via WCF and on the serverside I parse this file. Each line in the file is transformed into an object and stored into the database. if the file is very large (10000 entries and more), I get the following error (MSSQLEXPRESS):</p>\n\n<p>The transaction associated with the current connection has completed but has not been disposed. The transaction must be disposed before the connection can be used to execute SQL statements. </p>\n\n<p>I tried a lot (TransactionOptions timeout set and so on), but nothings works. The above exception message is either raised after 3000, sometimes after 6000 objects processed, but I can't succeed in processing all objects.</p>\n\n<p>I append my source, hopefully somebody got an idea and can help me:</p>\n\n<pre><code>public xxxResponse SendLogFile (xxxRequest request\n{\n   const int INTERMEDIATE_SAVE = 100;\n\n\n\n   using (var context = new EntityFramework.Models.Cubes_ServicesEntities())\n   {\n            // start a new transactionscope with the timeout of 0 (unlimited time for developing purposes)\n            using (var transactionScope = new TransactionScope(TransactionScopeOption.RequiresNew,\n            new TransactionOptions\n            {\n                IsolationLevel = System.Transactions.IsolationLevel.Serializable,\n                Timeout = TimeSpan.FromSeconds(0)\n            }))\n            {\n                try\n                {\n                    // open the connection manually to prevent undesired close of DB\n                    // (MSDTC)\n                    context.Connection.Open();\n                    int timeout = context.Connection.ConnectionTimeout;\n\n                    int Counter = 0;\n\n                    // read the file submitted from client\n                    using (var reader = new StreamReader(new MemoryStream(request.LogFile)))\n                    {\n                        try\n                        {\n                            while (!reader.EndOfStream)\n                            {\n                                Counter++;\n                                Counter2++;\n                                string line = reader.ReadLine();\n                                if (String.IsNullOrEmpty(line)) continue;\n\n                                // Create a new object\n                                DomainModel.LogEntry le = CreateLogEntryObject(line);\n\n                                // an attach it to the context, set its state to added.\n                                context.AttachTo(\"LogEntry\", le);\n                                context.ObjectStateManager.ChangeObjectState(le, EntityState.Added);\n\n                                // while not 100 objects were attached, go on\n                                if (Counter != INTERMEDIATE_SAVE) continue;\n\n                                // after 100 objects, make a call to SaveChanges.\n                                context.SaveChanges(SaveOptions.None);\n                                Counter = 0;\n                            }\n                        }\n                        catch (Exception exception)\n                        {\n                            // cleanup\n                            reader.Close();\n                            transactionScope.Dispose();\n                            throw exception;\n\n                        }\n\n                    }\n                    // do a final SaveChanges\n                    context.SaveChanges();\n                    transactionScope.Complete();\n                    context.Connection.Close();\n                }\n                catch (Exception e)\n                {\n                    // cleanup\n                    transactionScope.Dispose();\n                    context.Connection.Close();\n                    throw e;\n                }\n            }\n\n            var response = CreateSuccessResponse&lt;ServiceSendLogEntryFileResponse&gt;(\"SendLogEntryFile successful!\");\n            return response;\n        }\n    }\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":13105207,"title":"How do I prevent entity framework from creating extra tables","body":"<p>I have an issue when I upgraded entity framework to 5.0, to illustrate:</p>\n\n<pre><code>public class MyClass\n{\n   public Foo foo;\n\n   public ICollection&lt;Student&gt; Students{ get; set; }\n\n}\n\npublic class Student\n{\n   public int Id {get; set;}\n   public string s {get; set;}\n}\n\npublic class Foo\n{\n  public int data {get; set}\n  ...\n}\n</code></pre>\n\n<p>EF correctly creates a table called Students because I have defined a one-to-many relationship from MyClass to Student. I am using class Foo as encapsulation and have a 1-to-1 relationship. </p>\n\n<p>EF 4.0 did not create a separate table for <code>Foo</code>, instead used the property data as <code>Foo_data</code> within the MyClass table. With EF 5.0 I am getting another table for <code>Foo</code>.</p>\n\n<p>How can I tell EF not to create a table for <code>Foo</code>? </p>\n"},{"tags":["sql-server","entity-framework","ef-code-first","data-migration","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":13103349,"title":"How to add a new code-first migration with a newly-generated database?","body":"<p>I've enabled code-first migrations on my entity framework project, and have added several migrations which do things like rename tables.  However, I have now deleted the database and caused entity framework to generate a brand new database based on my latest data model.  If I try to run:</p>\n\n<pre><code>PM&gt; Add-Migration TestMigration\n</code></pre>\n\n<p>... it tells me that I need to apply the existing migrations first.  So I run:</p>\n\n<pre><code>PM&gt; Update-Database\n</code></pre>\n\n<p>... but the trouble is that it's trying to update a database that doesn't need updating; it's already based on the latest data model.  So I get an error when it tries to rename a table that now doesn't exist.</p>\n\n<p>Is there some way I can indicate to data migrations that my database is up-to-date and doesn't need any migrations running on it?  What should I do?</p>\n"},{"tags":["c#","entity-framework","unit-testing","orm"],"answer_count":0,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13107882,"title":"mocking EF without repository pattern","body":"<p>I'm using Entity Framework 4.</p>\n\n<p>I have read this post:</p>\n\n<p><a href=\"http://www.nogginbox.co.uk/blog/mocking-entity-framework-data-context\" rel=\"nofollow\">http://www.nogginbox.co.uk/blog/mocking-entity-framework-data-context</a></p>\n\n<p>But in my code I don't see anything like  <code>EFContext</code> <code>Attach() Detach()</code> and other stuff that appears there.</p>\n\n<p>Mine is more like this diagram:</p>\n\n<p><a href=\"http://blogofrab.blogspot.co.il/2010/08/maintenance-free-mocking-for-unit.html\" rel=\"nofollow\">http://blogofrab.blogspot.co.il/2010/08/maintenance-free-mocking-for-unit.html</a></p>\n\n<p>and then I don't understand how mocking the Icontext will help mocking?</p>\n\n<p>The ORM to the DB lays inside <code>get property</code> and <code>AddTo methods</code></p>\n"},{"tags":["database","linq","query","entity-framework","linq-to-sql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13108228,"title":"Loading the last related record instantly for multiple parent records using Entity framework","body":"<p>Does anyone know a good approach using Entity Framework for the problem described below?</p>\n\n<p>I am trying for our next release to come up with a performant way to show the placed orders for the logged on customer.\nOf course paging is always a good technique to use when a lot of data is available I would like to see an answer without any paging techniques.</p>\n\n<p>Here's the story: a customer places an order which gets an orderstatus = PENDING. Depending on some strategy we move that order up the chain in order to get it APPROVED.\nEvery change of status is logged so we can see a trace for statusses and maybe even an extra line of comment per status which can provide some extra valuable information to whoever sees this order in an interface.</p>\n\n<p>So an Order is linked to a Customer. One order can have multiple orderstatusses stored in OrderStatusHistory.</p>\n\n<p>In my testscenario I am using a customer which has 100+ Orders each with about 5 records in the OrderStatusHistory-table.\nI would for now like to see all orders in one page not using paging where for each Order I show the last relevant Status and the extra comment (if there is any for this last status; both fields coming from OrderStatusHistory; the record with the highest Id for the given OrderId).</p>\n\n<p>There are multiple scenarios I have tried, but I would like to see any potential other solutions or comments on the things I have already tried.</p>\n\n<ul>\n<li>Trying to do Include() when getting Orders but this still results in multiple queries launched on the database. Each order triggers an extra query to the database to get all orderstatusses in the history table. So all statusses are queried here instead of just returning the last relevant one, plus 100 extra queries are launched for 100 orders. You can imagine the problem when there are 100000+ orders in the database.</li>\n<li>Having 2 computed columns on the database: LastStatus, LastStatusInformation and a regular Linq-Query which gets those columns which are available through the Entity-model.\nThe problem with this approach is the fact that those computed columns are determined using a scalar function which can not be changed without removing the formula from the computed column, etc...</li>\n</ul>\n\n<p>In the end I am very familiar with SQL and Stored procedures, but since the rest of the data-layer uses Entity Framework I would like to stick to it as long as possible, even though I have my doubts about performance.\nUsing the SQL approach I would write something like this:</p>\n\n<pre><code>WITH cte (RN, OrderId, [Status], Information)\nAS\n(\nSELECT ROW_NUMBER() OVER (PARTITION BY OrderId ORDER BY Id DESC), OrderId,    [Status], Information\nFROM OrderStatus\n)\nSELECT o.Id, cte.[Status], cte.Information AS StatusInformation, o.* FROM [Order] o\nINNER JOIN cte ON o.Id = cte.OrderId AND cte.RN = 1\nWHERE CustomerId = @CustomerId\nORDER BY 1 DESC;\n</code></pre>\n\n<p>which returns all orders for the customer with the statusinformation provided by the Common Table Expression.</p>\n\n<p>Does anyone know a good approach using Entity Framework?</p>\n"},{"tags":["c#","asp.net-mvc","performance","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13103852,"title":"I want to improve performance of my Edmx by using AutoDetectChanges","body":"<p>I have a reasonably large edmx generated from a database and I have been working on performance recently to improve my application I have read a number of articles in a variety of places some here some not</p>\n\n<p>this one on disabling auto detect of changes <a href=\"http://msdn.microsoft.com/en-us/data/jj556205.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/data/jj556205.aspx</a> </p>\n\n<p>this one on improving performance on delete <a href=\"http://stackoverflow.com/questions/10103310/dbcontext-is-very-slow-when-adding-and-deleting\">DbContext is very slow when adding and deleting</a></p>\n\n<p>this one (which I think is pretty good) <a href=\"http://www.codeproject.com/Articles/38922/Performance-and-the-Entity-Framework\" rel=\"nofollow\">http://www.codeproject.com/Articles/38922/Performance-and-the-Entity-Framework</a></p>\n\n<p>I am already using myentities.tablename.MergeOption = MergeOption.NoTracking, i am using compiledqueries, I am pregenerated my View using EdmGen, I have reduced the data I am fetching etc..  and, of course,  I have gained performance in leaps and bounds so that a page that was loading in 54 seconds is now taking 16.1 seconds - however I have to get it to 3 seconds So I am still looking for the next improvement </p>\n\n<p>so the research is all well and great and as a result  I have upgraded to the latest EntityFramework, I have regenerated my .edmx from db etc... and tried a variety of things but I simply cannot find a myEntities.Configuration.AutoDetectChangesEnabled in order to set it to false. Now I must be missing a simple easy trick - how do I get my edmx to have this option.</p>\n\n<p>I am in this environment.Net 4.0.3, visual studio 2010, latest version of EntityFramework, MVC 4.0... All I need is somebody to say \"aha\" you need to go and do this....</p>\n\n<p>Currently if I delete 1000 records from one of my larger tables (134million rows) it takes nearly 10 minutes to savechanges. So from what I have read AutoDetectChangesEnabled is what I need to alter but it doesnt exist in my classes? where is it what must I do to get it?</p>\n\n<p>Any help appreciated I am trying to solve this one quickly</p>\n\n<p>Regards Julian</p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2135,"score":2,"question_id":1684245,"title":"Running sql in entity framework?","body":"<p>Is there any way to run a sql statement straight from the entity framework generated calls? Or will I have to create a procedure then call that via the entity framework?</p>\n"},{"tags":["entity-framework","primary-key","case-insensitive","natural-key"],"answer_count":6,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1458,"score":3,"question_id":721873,"title":"Entity Framework and associations between string keys","body":"<p>I am new to Entity Framework, and ORM's for that mather.\nIn the project that I'm involed in we have a legacy database, \nwith all its keys as strings, case-insensitive.</p>\n\n<p>We are converting to MSSQL and want to use EF as ORM, \nbut have run in to a problem.</p>\n\n<p>Here is an example that illustrates our problem:</p>\n\n<p>TableA has a primary string key,\nTableB has a reference to this primary key.</p>\n\n<p>In LINQ we write something like:</p>\n\n<pre><code>\nvar result = from t in context.TableB select t.TableA;\nforeach( var r in result )\n    Console.WriteLine( r.someFieldInTableA );  \n</code></pre> \n\n<p>if TableA contains a primary key that reads \"A\", and TableB contains two rows that references TableA but with different cases in the referenceing field, \"a\" and \"A\".</p>\n\n<p>In our project we want both of the rows to endup in the result, but only the one\nwith the matching case will end up there.</p>\n\n<p>Using the SQL Profiler, I have noticed that both of the rows are selected.</p>\n\n<p>Is there a way to tell Entity Framework that the keys are case insensitive?\n<br><br><b>Edit:</b><br>We have now tested this with NHibernate and come to the conclution that NHibernate works with case-insensitive keys. So NHibernate might be a better choice for us.<br>I am however still interested in finding out if there is any way to change the behaviour of Entity Framework.</p>\n\n<hr>\n\n<p>Thanks for your answer!</p>\n\n<p>Problem is that if we add that constraint to the database now, \nthe legacy application might stop working because of how it is built.\nBest for us would be, if possible, to change the behavior of EF.\nI'm guessing it is not possible, but I'm giving it a shot.</p>\n\n<p><br>\nRegards,<br>\nFredrik</p>\n\n<p><b>edit:</b> The reason why I added an answer to my own question was that I added this question before I was a registerd user, and when I had registred my account I couldn't add comments or edit my post. Now the accounts are merged.</p>\n"},{"tags":["asp.net","asp.net-mvc-3","entity-framework","exception-handling","crud"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":13104018,"title":"Asp.Net MVC 3 prevent duplicate records","body":"<p>I'm new in Asp.net MVC 3 with Entity Framework.</p>\n\n<p>I followed a tutorial to make a simple program that add/edit and delete records from a SQL database.</p>\n\n<p>My question is how and where I must prevent the duplicate records? I have the \"firstName\" field as unique. So, when the user add a record from the form, how I can control that this record don't exist?</p>\n\n<p>Many thanks in advance.</p>\n"},{"tags":["sql","entity-framework","entity-framework-4","lambda"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13103946,"title":"Lambda expression to SQL query","body":"<p>I'm trying to build method that would delete all entries in specified table that match the condition.</p>\n\n<pre><code>    public void DeleteAll(Expression&lt;Func&lt;T, bool&gt;&gt; condition)\n    {\n        var service = PluralizationService.CreateService(new CultureInfo(\"en-US\"));\n        var tableName = service.Pluralize(typeof(T).Name);\n        Context.Database.ExecuteSqlCommand(string.Format(\"DELETE FROM {0} WHERE {1}\", tableName, condition));\n    }\n</code></pre>\n\n<p>Currently this is not working as I'm not able to properly convert condition given as lambda expression to meaningful SQL syntax that would fit after WHERE clause. I can do some things manually but I was wondering if there is a way to do it with means provided with .NET framework.</p>\n"},{"tags":["asp.net","sql-server","database","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":13086006,"title":"How can I force entity framework to insert identity columns?","body":"<p>I want to write some C# code to initialize my database with some seed data.  Clearly, this is going to require the ability to be able to set the values of various Identity columns when inserting.  I'm using a code-first approach.  By default, <code>DbContext</code> handles the database connection and so you can't <code>SET IDENTITY_INSERT [dbo].[MyTable] ON</code>.  So, what I've done so far is use the <code>DbContext</code> constructor that lets me specify a DB connection to be used.  Then, I set <code>IDENTITY_INSERT</code> to <code>ON</code> in that DB connection, and then try to insert my records using entity framework.  Here's an example of what I've got so far:</p>\n\n<pre><code>public class MyUserSeeder : IEntitySeeder {\n    public void InitializeEntities(AssessmentSystemContext context, SqlConnection connection) {\n        context.MyUsers.Add(new MyUser { MyUserId = 106, ConceptPersonId = 520476, Salutation = \"Mrs\", Firstname = \"Novelette\", Surname = \"Aldred\", Email = null, LoginId = \"520476\", Password=\"28c923d21b68fdf129b46de949b9f7e0d03f6ced8e9404066f4f3a75e115147489c9f68195c2128e320ca9018cd711df\", IsEnabled = true, SpecialRequirements = null });\n        try {\n            connection.Open();\n            SqlCommand cmd = new SqlCommand(\"SET IDENTITY_INSERT [dbo].[MyUser] ON\", connection);\n            int retVal = cmd.ExecuteNonQuery();\n            context.SaveChanges();\n        }\n        finally {\n            connection.Close();\n        }\n    }\n}\n</code></pre>\n\n<p>So close and yet so far - because, although <code>cmd.ExecuteNonQuery()</code> works fine, when I then run <code>context.SaveChanges()</code>, I'm informed that \"Explicit value must be specified for identity column in table 'MyUser' either when IDENTITY_INSERT is set to ON or when a replication user is inserting into a NOT FOR REPLICATION identity column.\"</p>\n\n<p>Presumably, because MyUserId (which is the Identity column in the MyUser table) is the primary key, entity framework doesn't try to set it when I call <code>context.SaveChanges()</code>, even though I gave the <code>MyUser</code> entity a value for the <code>MyUserId</code> property.</p>\n\n<p>Is there a way to force entity framework to try and insert even primary key values for an entity, then?  Or maybe a way to temporarily mark <code>MyUserId</code> as not being a primary key value, so EF tries to insert it?</p>\n"},{"tags":["c#","entity-framework","silverlight-4.0","entity-framework-4.1"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13099663,"title":"Not printing duplicate values using view in entity model","body":"<p>I am using entity model.i updated one view called SalesDetialView.</p>\n\n<p>In salesdetialview i have 3 entity keys. There are 1.Type 2.No, 3.Custmor\n<img src=\"http://i.stack.imgur.com/fpanX.png\" alt=\"enter image description here\"></p>\n\n<p>SQL : I am using this query(i am printing just 5 columns )</p>\n\n<p>select Customer,Type,No,Salesperson,amount from SalesDetailView \n<img src=\"http://i.stack.imgur.com/vFaU9.png\" alt=\"enter image description here\"></p>\n\n<p>But through entity model i am not getting duplicate values(No).see this below screen <img src=\"http://i.stack.imgur.com/MBbAw.png\" alt=\"enter image description here\"></p>\n\n<p>Now i have doubt why it is not showing duplicate values. Any thing related for entity keys  or any thing. Please suggest me where i am doing mistake.</p>\n"},{"tags":["asp.net-mvc","entity-framework","web-applications","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":13099929,"title":"MCV4 And Enitiy Framework. Without been able to directly connect to the database","body":"<p>I have a very strange situation which I am currently faced with.  I have been passed a project to uplift a website to use MVC4 &amp; the enitiy framework.  However due to the way that the original implementation was undertaken the database access is not direct from the website it's handed to a separate middle-ware application which we pass the name of a sql transaction we would like to have executed &amp; the required parameters, this then returns us a datatable object.</p>\n\n<p>My Question is this Without having to remove this middle-ware process could I create a MVC4 App with the use of the enitiy framework? </p>\n"},{"tags":["sql-server","silverlight","entity-framework","table","big"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":9748830,"title":"How to load silverlight Entities with a large number of records?","body":"<p>I have a big table in my SQL Server database with 38000 records! When loading this table in my Silverlight application, it shows 0 records loaded. When i load the same table with less records (1000 for example ) the entity is loaded with all records! </p>\n\n<p>Can anyone help me please? </p>\n\n<pre><code>      loadhabitaion = this.friendsContext.Load(this.friendsContext.GetHyd_poliQuery());\n      loadhabitaion.Completed += new EventHandler(loadhabitaion_Completed);\n      void loadhabitaion_Completed(object sender, EventArgs e)\n\n         {\n\n        MessageBox.Show(loadhabitaion.Entities.Count().ToString());\n          //it returns 0\n         }\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13094626,"title":"Entity Framework 5 Reverse Engineering and [Key] attribute","body":"<p>I'm reverse engineering a database with Entity Framework Power Tools beta 2, now, the POCOs created do not have the [Key] in the definition, but the mapping with Fluent has the  this.HasKey(t => t.EntityId);</p>\n\n<p>I have the POCOs in a separate project and and MVC 4 application which has a reference to it. When I try to add a controller it says then entities do not have the Key defined.\nExact message is:</p>\n\n<p><strong>System.Data.Entity.EdmEntityType: EntityType: 'Computer' has no key defined. Define the key for this EntityType.</strong></p>\n\n<p>Why the reverse engineering process do not add the [Key] attribute if it is mandatory? Or it is not mandatory and I'm missing something?</p>\n\n<p>Thanks in advance. Guillermo.</p>\n"},{"tags":["c#","database","entity-framework","table","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12420539,"title":"Code first database migration","body":"<p>We are using the Code-first approach without an Edmx file, its running fine to create database the first time.</p>\n\n<p>But if i am adding new data entities say new class to my database context then it is not able to add that to new table in that database.</p>\n\n<p>Say for example there are two table initially in database.\nex Database : DbTest\n   Table : Tbl1, Tbl2</p>\n\n<p>Now if i a add new table, say class name 'Tbl3', then it should be adding it into the existing database.</p>\n\n<p>Can any one please explain to me with an example how it can be achieved via code first approach?</p>\n\n<p>I have seen mentioned something like  <code>Database.SetInitializer(new ........)</code></p>\n\n<p>What do i need to put in the blank area of the constructor above?</p>\n"},{"tags":["c#","asp.net-mvc","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13098262,"title":"Using Find() with inheritance in entity frameowrk","body":"<p>I am trying to find a User entity in my \"Domain Entity\" DB Set.\nThe User entity is derived from a base type called Domain Entity.</p>\n\n<p>I want to use the following to find a user according to his ID</p>\n\n<pre><code>User userToDelte = db.DomainEntities.OfType&lt;User&gt;().Find(UserID);\n</code></pre>\n\n<p>But I get a compiler error :</p>\n\n<blockquote>\n  <p>'System.Linq.IQueryable' does not\n  contain a definition for 'Find' and no extension method 'Find'\n  accepting a first argument of type...</p>\n</blockquote>\n\n<p>Why can't I use <code>Find()</code> after I have used <code>OfType&lt;User&gt;()</code> ?</p>\n\n<p>P.S\nIt is important for me to get a strongly typed User entity because it has a navigation propertiy that include all of it's details in a separate table called \"UserDetails\" along with the user name and password.</p>\n"},{"tags":["wpf","entity-framework","dependency-injection","unity"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13098427,"title":"wpf architecture advice","body":"<p>I'm working on an app to be created in wpf. I want to structure the app with logical layers so have a solution with following projects:\nModel - entity framework classes representing db structure\nData - contains data context and the repository, unitwork, databasefactory classes and the interfaces for these.\nPresentation - actual wpf application with my views and view models.</p>\n\n<p>I wanted to implement unity based dependency injection to have my repositories injected into the view models but am stuck. Everytime i attempt to navigate to my view i get object not set to instance error, but doesn't indicate where.</p>\n\n<p>Does anyoneknow of a nice starter example that follows the pattern above? </p>\n\n<p>Thanks for any help you can offer.</p>\n"},{"tags":["c#","entity-framework","rest","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":13096930,"title":"How to use Entity Framework 5 (CodeFirst) with DataContract from REST service","body":"<p>I come from the web forms world, and I'm learning MVC4 and Entity Framework 5 with a code-first approach. This is my first time using EF code-first and I'm having some trouble understanding what EF needs from me to be able to create/update a database. </p>\n\n<p>I'm making a request to a RESTful service and deserializing the response into a <code>DataContract</code>. Ideally, I would like to be able to insert this <code>DataContract</code> into a database but I'm unsure how to generate the <code>DbContext</code> classes from the <code>DataContract</code> so EF can do it's thing. </p>\n\n<p>The simplified version of the <code>DataContract</code>...</p>\n\n<pre><code>[DataContract]\npublic class MoviesDataContract {\n    [DataMember(Name = \"total\")]\n    public int Total { get; set; }\n\n    [DataMember(Name = \"movies\")]\n    public IEnumerable&lt;Movie&gt; Movies { get; set; }\n\n    [DataMember(Name = \"link_template\")]\n    public string LinkTemplate { get; set; }\n}\n\n[DataContract]\npublic class Movie {\n    [DataMember(Name = \"id\")]\n    public int Id { get; set; }\n\n    [DataMember(Name = \"title\")]\n    public string Title { get; set; }\n\n    [IgnoreDataMember]\n    public int? Year {\n        get {\n            int i;\n            return int.TryParse(_year, out i) ? i : (int?)null;\n        } \n        set { _year = value.ToString(); }\n    }\n\n    [DataMember(Name = \"year\")]\n    private string _year { get; set; }\n}\n</code></pre>\n\n<p>Here's an example of the <code>DataContract</code> usage...</p>\n\n<pre><code>using(var response = (HttpWebResponse)request.GetResponse()) {\n    var serializer = new DataContractJsonSerializer(typeof (MoviesDataContract));\n    var dataContract = (MoviesDataContract)serializer.ReadObject(response.GetResponseStream());\n\n    var model = new List&lt;MovieViewModel&gt;();\n    dataContract.Movies.ToList().ForEach(movie =&gt; model.Add(new MovieViewModel {\n        Title = movie.Title,\n        Year = movie.Year\n    }));\n\n    // MovieDbContext doesn't exist and it's what I'm unsure of how to generate\n    // I would think it would work something like this though (once created)\n    var db = new MovieDbContext();\n    db.Add(dataContext);\n    db.SaveChanges();\n\n    return View(model);\n}\n</code></pre>\n\n<p>My Questions are...</p>\n\n<ol>\n<li>Is there a way to generate the <code>DbContext</code> classes from my <code>DataContract</code> or do I need to manually create them?</li>\n<li>Is there a better approach to using (or really saving to a db) Deserialized data with Entity Framework (especially EF5)?</li>\n<li>Could someone provide a link that discusses EF (4 or higher) being used in conjunction with a DataContract? I think I may not have a complete grasp on how to effectively use EF5.</li>\n</ol>\n"},{"tags":["c#","entity-framework","deadlock"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13097179,"title":"How to prevent EntityFramework deadlock when concurrently running these two statements","body":"<p>Calls into my web service use the following code to ensure that the caller has a valid session. If a valid session found then it updates the session details and saves the changes. All simple enough and works fine.</p>\n\n<pre><code>// Create the Entity Framework context\nusing(MyContext ctx = CreateMyContext())\n{\n     // Get the user session for the client session         \n     UserSession session = (from us in context.UserSessions.Include(\"UserEntity\")\n                            where us.SessionId = callerSessionId\n                            select us).FirstOrDefault&lt;UserSession&gt;();\n\n     if (session == null)\n         return false;\n     else\n     {\n         // Update session details\n         session.Calls++;\n         session.LastAccessed = DateTime.Now.Ticks;\n         Console.WriteLine(\"Call by User:{0}\", session.UserEntity.Name);\n\n         // Save session changes back to the server\n         ctx.SaveChanges();\n         return true;\n     }    \n}\n</code></pre>\n\n<p>All works fine until the same caller, and hence the same session, makes multiple concurrent calls (which is perfectly valid to happen). In this case I sometimes get a deadlock. Using SQL Server Profiler I can see the following is happening. </p>\n\n<p>Caller A performs the select and acquires a shared lock on the user session. Caller B performs the select and acquires a shared lock on the same user session. Caller A cannot perform its update because of Caller B's shared lock. Caller B cannot perform its update because of caller A's shared lock. Deadlock.</p>\n\n<p>This seems like a simple and classic deadlock scenario and there must be a simple method to resolve it. Surely almost all real world applications have this same problem.But none of the Entity Frameworks books I have mention anything about deadlocks.</p>\n"},{"tags":["asp.net-mvc","visual-studio-2010","entity-framework","nuget","class-library"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13036496,"title":"Install-package Entity framework error","body":"<p>I need help.\nWhen i'm trying to install Entity-framework to my class library in my solution, i'm getting an error:</p>\n\n<p><em>Exception calling \"CreateInstanceFrom\" with \"8\" argument(s): \"Could not load file or assembly 'file:///D:#work#web\\DanceClubCMS\\packages\\EntityFramework.5.0.0\\tools\\EntityFramework.PowerShell.dll' or one of its dependencies.\n     .\" =>  <strong>(translate from russian - file not found)</strong>\nAt D:#work#web\\DanceClubCMS\\packages\\EntityFramework.5.0.0\\tools\\install.ps1:10 char:34\n+     $appDomain.CreateInstanceFrom &lt;&lt;&lt;&lt; (\n    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException\n    + FullyQualifiedErrorId : DotNetMethodException</em></p>\n\n<p>please help me. How can i fix that problem?</p>\n"},{"tags":["sql","asp.net-mvc","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13096058,"title":"Joining two tables in linq method syntax, MVC EntityFramework","body":"<p>I'm working with two tables: CI_CLIENTRISK (SCD type 2)... and QB_INVOICES_HEADER (<a href=\"http://i47.tinypic.com/x42c69.png\" rel=\"nofollow\">edmx screenshot</a>).</p>\n\n<p>They can be joined via ClientID.  I want to essentially replicate this query:</p>\n\n<pre><code>SELECT a.ClientID,\n    MAX(b.InvoiceDt) AS MaxInvoiceDt\n    (omitted for brevity)\nFROM CI_CLIENTRISKADJS a\nINNER JOIN QB_INVOICES_HEADER b\nON a.ClientID = b.ClientID\nWHERE a.IsActive = 1\nGROUP BY a.ClientID\nORDER BY MaxInvoiceDt DESC\n</code></pre>\n\n<p>Here's what I have so far.  It's not returning any records.</p>\n\n<pre><code>using (var db = new PLOGITENS01Entities())\n        {\n        var rvClientRiskAdjs = db.CI_CLIENTRISKADJS\n            .Take(50)\n            .Join(db.QB_INVOICES_HEADER,\n                a =&gt; a.ClientID,\n                b =&gt; b.ClientID,\n                (a, b) =&gt; new { Risk = a, Invoices = b })\n            .Where(a =&gt; a.Risk.IsActive == 1)\n            .OrderByDescending(o =&gt; o.Invoices.InvoiceDt)\n            .Select(c =&gt; new ClientRiskModel()\n            {\n                ClientRiskId = c.Risk.ClientRiskID,\n                ClientName = c.Risk.CI_CLIENTLIST.ClientName,\n                ClientId = c.Risk.ClientID,\n                ClientRiskAdjs = c.Risk.ClientRiskAdjs,\n                RecordValidStartDt = c.Risk.RecordValidStartDt,\n                RecordValidEnddt = c.Risk.RecordValidEnddt,\n                IsActive = c.Risk.IsActive\n            })\n            .ToList();\n\n        return View(new GridModel(rvClientRiskAdjs));\n        }\n</code></pre>\n"},{"tags":["entity-framework","ado.net","navigation-properties"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13095215,"title":"Saving navigation property in ADO.NET Entity framework","body":"<p>I'm working with ADO.NET Entity Framework. I add a 'User' entity in a database with the following code:</p>\n\n<pre><code>user new_user = new user();\nnovus_daedalus_dbEntities dbEntity = new novus_daedalus_dbEntities();\n\nnew_user.CF = \"xyz\";\nnew_user.username = \"peter\";\nnew_user.password = \"pw\";\n\ndbEntity.user.Add(new_user);\ndbEntity.SaveChanges();\n</code></pre>\n\n<p>The CF attribute of the 'user' class is a foreign key to a 'people' class attribute. The database table 'people' has a record with CF='xyz'. When the method 'dbEntity.SaveChanges();' is executed, a new record in the 'user' database table is created without problem. The problem is that the navigation property 'new_user.people' is 'null', even after the execution of 'dbEntity.SaveChanges();'. Is it normal?</p>\n\n<p>Thanks!</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13094265,"title":"Single website multiple databases, database switching","body":"<p>I have created a content management system (CMS) for my companys product databases. The CMS is based on asp.net scaffolding with many custom pages and actions mixed in. We have 7 products currently, all of which share the same database schema (Entity Framework model-first) and all run perfectly in the CMS. The issue is that every time we get a new product we must clone the CMS and change the connection string in the <code>app.config</code> to point to the correct database in order to work with the new database. While this works, its becoming bothersome to maintain and will fail us completely as we acquire more products. </p>\n\n<p>What I would like to do is have a centralized landing page where a user is directed to log in, then given the option to connect to and edit a specific product based on their selection. The idea is that we would have one CMS site which would be able to switch between the databases depending on the user. It is not an option to combine all of the product database in to a single master product database. </p>\n\n<p>I am not sure where to start to achieve this goal, or if this is even the correct plan to achieve my goal of having a single CMS to maintain, and am looking for some guidance in this. </p>\n"},{"tags":["entity-framework","computed-columns","ef-model-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12787102,"title":"SQL Server computed columns and EF model-first","body":"<p>I'm working with EF5 using the model-first approach.  I've designed the model and executed the SQL script which generated the corresponding database (using \"Generate Database from Model\").</p>\n\n<p>I then had to use UDFs to calculate a couple of column values (which requires dropping and re-adding the columns).  I've done that in SSMS and then used \"Update Model from Database...\" to reflect the changes in the model.</p>\n\n<p>Till this point, everything worked great.</p>\n\n<p>But from this point, every time I update the database from the model (as described above), the computed columns are overridden with \"standard\" columns.</p>\n\n<p>For example, following is an excerpt from the SQL script generated by EF:</p>\n\n<pre><code>-- Creating table 'ShipmentSet'\nCREATE TABLE [dbo].[ShipmentSet] (\n[Id] int IDENTITY(1,1) NOT NULL,\n[Details] nvarchar(128)  NOT NULL,\n[BarcodeValue] nvarchar(32)  NOT NULL,\n[ExecutionDate] datetime  NOT NULL,\n[RouteId] int  NOT NULL,\n[IsLocationBarcodeRequired] bit  NOT NULL,\n[IsPending] bit  NULL,\n[LastAction] tinyint  NULL\n);\nGO\n</code></pre>\n\n<p>The two last columns are computed columns, and their <code>StoreGeneratedPattern</code> in the model is defined as <code>Computed</code>.</p>\n\n<p>Is there a way to add the computed column formulas in the model? The SQL script drops the tables then re-creates them, so \"ignoring\" these columns won't do.</p>\n"},{"tags":["c#","asp.net-mvc","linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13092098,"title":"Translate SQL query to LINQ (subqueries)","body":"<p>Hi have a site where users can vote on images.\nThe votes are stored in table Votes where I store the Id of the submission (FK_id)</p>\n\n<p><br />\nThe tables are:</p>\n\n<p><strong>Table Submissions</strong><br />\nId (uniqueidentifier)<br />\nName (varchar(50))<br />\nImage (varchar(50))<br /></p>\n\n<p><strong>Table Votes</strong><br />\nId (int)<br />\nFk_id (foreign key to Submissions.Id)<br /></p>\n\n<p>I'm new to linq so I don't know how to translate this:</p>\n\n<pre><code>SELECT *, \n    isnull((SELECT count(*) \n    FROM Votes\n    WHERE Fk_id = S.Id      \n    GROUP BY Fk_id),0) as Votes \nFROM Submissions S\n</code></pre>\n\n<p>I wanted something like this:</p>\n\n<pre><code>List&lt;Model&gt; = (from p in ????\n               select new Model\n               {\n                   Name = p.Name,\n                   Image = p.Image,\n                   Votes = p.Votes               \n               }).ToList();\n</code></pre>\n\n<p>Thank you.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4","nuget"],"answer_count":3,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":876,"score":7,"question_id":10219864,"title":"EF Code First: How do I see 'EntityValidationErrors' property from the nuget package console?","body":"<p>I'm at a loss for this:</p>\n\n<p>I've defined my classes for a entity framework (4.1.3) code first approach. Everything was fine (I was creating the tables etc.) until I started to Seed.</p>\n\n<p>Now when I do the </p>\n\n<pre><code>Add-Migration \"remigrate\" ; Update-Database;\n</code></pre>\n\n<p>I get an error on the package console \"Validation failed for one or more entities. See 'EntityValidationErrors' property for more details.\"</p>\n\n<p>I have a breakpoint in my Seed() method but because I'm running this on the console when the project is not running, I'm clueless as to how to get to the details (PS - I've seen the thread <a href=\"http://stackoverflow.com/questions/5400530/validation-failed-for-one-or-more-entities-while-saving-changes-to-sql-server-da\">Validation failed for one or more entities while saving changes to SQL Server Database</a> which shows how I can see the property.)</p>\n\n<p>I know that my Seed() method has a problem because if I put a return right after the method call, the error goes away. So how do I set my breakpoint so I can see what the validation error is? Kinda lost. Or is there some other way to trace it in the nuget console??</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13091029,"title":"Update EF from an object","body":"<p>I know to update an object in EF I can do something like...</p>\n\n<pre><code>var hotel = context.Hotels.SingleOrDefault(u =&gt; u.HotelID == editedHotel.HotelID);\n    hotel.Name= editedHotel.Name;\n    hotel.Address = editedHotel.Address;\n    hotel.RoomCount = editedHotel.RoomCount;\ncontext.SaveChanges();\n</code></pre>\n\n<p>but this gets quite long if a lot of fields need updating.</p>\n\n<p>Is there a way I can do something like...</p>\n\n<pre><code>    var hotel = context.Hotels.SingleOrDefault(u =&gt; u.HotelID == editedHotel.HotelID);\nhotel = editedHotel;\ncontext.SaveChanges();\n</code></pre>\n\n<p>...so all of the fields can be changed in one go?</p>\n"},{"tags":["c#","sql-server","entity-framework","foreign-keys"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13090735,"title":"inserting data into tables with foreign keys","body":"<p>I have 2 tables in ms sql server 2008 R2, one of which has foreign key relation to the other</p>\n\n<p>pretty simple:</p>\n\n<pre><code>tableA\nprefix nchar(10)\nvalue  nchar(50)\n\ntableB\nprefix nchar(10)\nvalue  nchar(50)\n\nALTER TABLE [dbo].[tableB]  \nWITH CHECK ADD  CONSTRAINT [FK_TableA_TableB] FOREIGN KEY([prefix])\nREFERENCES [dbo].[TableA] ([prefix])\n</code></pre>\n\n<p>I fill in data in the tables using the management studio edit table. ensuring each prefix in <code>tableB</code> has a matching prefix in <code>tableA</code>.</p>\n\n<p>Then I import the tables into visual studio C# to create an entity framework model.\nEverything seem to work fine until I start to reference data in <code>tableA</code> from <code>tableB</code> using the navigation handle, it comes up empty handed.</p>\n\n<p>i.e. <code>tableB.tableA</code>s come out as null.</p>\n\n<p>Is there a step that needs to be done to update foreign key relations in entity framework and/or ms sql server?</p>\n"},{"tags":["c#","sql-server","database","entity-framework","sql-server-ce"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13085764,"title":"Generating both SQL Server CE database and entity model at runtime","body":"<p>I am developing a desktop application where different users can use the application on the same machine, the application should generate a different SQL Server CE database file for each user where the databases have the same schema (structure), and then generate an entity model from that database, how should I go about doing this ? </p>\n\n<p>I am new to both the Entity Framework and the SQL Server CE engine, so I am willing to consider any solution.</p>\n"},{"tags":["c#","entity-framework","automapper"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13052970,"title":"Auto-generating EF \"where\" clause based on DTO","body":"<p>I'm trying to autogenerate the parameter to IQueryable.Where so I can select entities from my entity framework code first data context without writing and wiring up a lot of tedious mapping code.</p>\n\n<p>My project contains a bunch of DTOs that look like:-</p>\n\n<pre><code>class FooDto\n{\n  public string SomeProperty { get; set; }\n  public string SomeOtherProperty { get; set; }\n}\n</code></pre>\n\n<p>And a bunch of entities that look like:-</p>\n\n<pre><code>class Foo\n{\n  public string SomeProperty { get; set; }\n  public string SomeOtherProperty { get; set; }\n\n  // Some other properties here.\n}\n</code></pre>\n\n<p>The DTO contains the fields necessary to identify some subset of entities in my database. I use the DTOs to query an IQueryable of entities:-</p>\n\n<pre><code>var result = queryable.Where(\n  x =&gt; x.SomeProperty == dto.SomeProperty\n    &amp;&amp; x.SomeOtherProperty == dto.SomeOtherProperty)\n</code></pre>\n\n<p>The actual properties vary, but the queries are always of the shape <strong>\"Where all of the properties on the entity match all of the matching properties on the DTO\"</strong>. There's no more complicated query object functionality going around.</p>\n\n<p>There are many dozens of DTOs and entities. Creating/maintaining and wiring up all of these predicates is a challenging architectural issue. We're currently using the strategy pattern:-</p>\n\n<pre><code>public class FooDtoSelectStrategy : ISelectStrategy&lt;FooDto, FooEntity&gt;\n{\n  public Func&lt;FooEntity, bool&gt; GetPredicate(FooDto dto)\n  {\n    return x =&gt; x.SomeProperty == dto.SomeProperty\n             &amp;&amp; x.SomeOtherProperty == dto.SomeOtherProperty;\n  }\n}\n</code></pre>\n\n<p>Along with a pile of ninject bindings, but we've got some few dozens of these already and we're looking at hundreds more as our domain expands.</p>\n\n<p>We had a similar challenge mapping values from the entity to the DTO which we resolved using AutoMapper.</p>\n\n<p><strong>Can automapper (or a similar tool) create these predicates and allow us to implement a single <code>GenericPredicateProvider&lt;TDto, TEntity&gt;</code>?</strong></p>\n"},{"tags":["entity-framework","asp.net-mvc-4","sql-server-profiler"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13090602,"title":"SQL Server Profiler - Why are some calls RPC:BatchCompleted and Some Calls SQL:BatchCompleted","body":"<p>I will be the first to  admit that I often get confused when I use SQL Server profiler. </p>\n\n<p>Having said that, I decided to fire it up to see the SQL that was being generated by experimenting with the Include method of a Db Set. I was going through the music store example where there are Albums, Artists, and Genres.</p>\n\n<p>One thing I noticed was that some calls had an event class of <strong>SQL:BatchCompleted</strong> while others had an event class of <strong>RPC:Completed</strong>. It seemed like the lazy load calls were being traced under the RPC event class. </p>\n\n<p>What is the difference was between these two event classes and why does lazy loading result in an event class of RPC:Completed?</p>\n"},{"tags":["php","entity-framework","yii"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":40,"score":-1,"question_id":13087646,"title":"error when try to manage all entities of a class","body":"<p>i get this error when i try to do an admin action for list all entity instantiated of a specific class: </p>\n\n<blockquote>\n  <p>include(authenticate.php): failed to open stream: No such file or directory \n  /home/user/NetBeansProjects/yii/framework/YiiBase.php(423)</p>\n</blockquote>\n\n<pre><code>{\n412                             include($classFile);\n413                             if(YII_DEBUG &amp;&amp; basename(realpath($classFile))!==$className.'.php')\n414                                 throw new CException(Yii::t('yii','Class name \"{class}\" does not match class file \"{file}\".', array(\n415                                     '{class}'=&gt;$className,\n416                                     '{file}'=&gt;$classFile,\n417                                 )));\n418                             break;\n419                         }\n420                     }\n421                 }\n422                 else\n423                     include($className.'.php');\n424             }\n425             else  // class name with namespace in PHP 5.3\n426             {\n427                 $namespace=str_replace('\\\\','.',ltrim($className,'\\\\'));\n428                 if(($path=self::getPathOfAlias($namespace))!==false)\n429                     include($path.'.php');\n430                 else\n431                     return false;\n432             }\n433             return class_exists($className,false) || interface_exists($className,false);\n434         }\n435         return true;\n</code></pre>\n\n<p>CGridView in admin file of view folder</p>\n\n<pre><code>&lt;?php $this-&gt;widget('zii.widgets.grid.CGridView', array(\n    'id'=&gt;'utente-crea-evento-grid',\n    'dataProvider'=&gt;$model-&gt;search(),\n    'filter'=&gt;$model,\n    'columns'=&gt;array(\n        'id',\n        'status',\n        'username',\n        'password', other properties\n</code></pre>\n\n<p>admin action</p>\n\n<pre><code>public function actionAdmin()\n    {\n        $model=new UtenteCreaEvento('search');\n        $model-&gt;unsetAttributes();  // clear any default values\n        if(isset($_GET['UtenteCreaEvento']))\n            $model-&gt;attributes=$_GET['UtenteCreaEvento'];\n\n        $this-&gt;render('admin',array(\n            'model'=&gt;$model,\n        ));\n    }\n</code></pre>\n\n<p>more stack trace info</p>\n\n<pre><code>#0  \n+  /home/sigturk/NetBeansProjects/yii/framework/YiiBase.php(423): YiiBase::autoload()\n#1  \n+  /home/sigturk/NetBeansProjects/yii/framework/YiiBase.php(298): YiiBase::autoload(\"authenticate\")\n#2  \n+  /home/sigturk/NetBeansProjects/yii/framework/validators/CValidator.php(187): YiiBase::import(\"authenticate\", true)\n#3  \n+  /home/sigturk/NetBeansProjects/yii/framework/base/CModel.php(285): CValidator::createValidator(\"authenticate\", UtenteCreaEvento, \"password\", array())\n#4  \n+  /home/sigturk/NetBeansProjects/yii/framework/base/CModel.php(259): CModel-&gt;createValidators()\n#5  \n+  /home/sigturk/NetBeansProjects/yii/framework/web/helpers/CHtml.php(1871): CModel-&gt;getValidators(\"numTel\")\n#6  \n+  /home/sigturk/NetBeansProjects/yii/framework/web/helpers/CHtml.php(1217): CHtml::activeInputField(\"text\", UtenteCreaEvento, \"numTel\", array(\"name\" =&gt; \"UtenteCreaEvento[numTel]\", \"id\" =&gt; \"UtenteCreaEvento_numTel\"))\n#7  \n+  /home/sigturk/NetBeansProjects/yii/framework/web/widgets/CActiveForm.php(658): CHtml::activeTextField(UtenteCreaEvento, \"numTel\", array())\n#8  \n  /home/sigturk/NetBeansProjects/sitoEventi/protected/views/utenteCreaEvento/_search.php(42): CActiveForm-&gt;textField(UtenteCreaEvento, \"numTel\")\n37         &lt;?php echo $form-&gt;textField($model,'cognome',array('size'=&gt;60,'maxlength'=&gt;128)); ?&gt;\n38     &lt;/div&gt;\n39 \n40     &lt;div class=\"row\"&gt;\n41         &lt;?php echo $form-&gt;label($model,'numTel'); ?&gt;\n42         &lt;?php echo $form-&gt;textField($model,'numTel'); ?&gt;\n43     &lt;/div&gt;\n44 \n45     &lt;div class=\"row\"&gt;\n46         &lt;?php echo $form-&gt;label($model,'numEventiCreati'); ?&gt;\n47         &lt;?php echo $form-&gt;textField($model,'numEventiCreati'); ?&gt;\n#9  \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CBaseController.php(127): require(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\")\n#10 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CBaseController.php(96): CBaseController-&gt;renderInternal(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\", array(\"model\" =&gt; UtenteCreaEvento), true)\n#11 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(870): CBaseController-&gt;renderFile(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\", array(\"model\" =&gt; UtenteCreaEvento), true)\n#12 \n  /home/sigturk/NetBeansProjects/sitoEventi/protected/views/utenteCreaEvento/admin.php(40): CController-&gt;renderPartial(\"_search\", array(\"model\" =&gt; UtenteCreaEvento))\n35 \n36 &lt;?php echo CHtml::link('Advanced Search','#',array('class'=&gt;'search-button')); ?&gt;\n37 &lt;div class=\"search-form\" style=\"display:none\"&gt;\n38 &lt;?php $this-&gt;renderPartial('_search',array(\n39     'model'=&gt;$model,\n40 )); ?&gt;\n41 &lt;/div&gt;&lt;!-- search-form --&gt;\n42 \n43 &lt;?php $this-&gt;widget('zii.widgets.grid.CGridView', array(\n44     'id'=&gt;'utente-crea-evento-grid',\n45     'dataProvider'=&gt;$model-&gt;search(),\n#13 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CBaseController.php(127): require(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\")\n#14 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CBaseController.php(96): CBaseController-&gt;renderInternal(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\", array(\"model\" =&gt; UtenteCreaEvento), true)\n#15 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(870): CBaseController-&gt;renderFile(\"/home/sigturk/NetBeansProjects/sitoEventi/protected/views/utente...\", array(\"model\" =&gt; UtenteCreaEvento), true)\n#16 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(783): CController-&gt;renderPartial(\"admin\", array(\"model\" =&gt; UtenteCreaEvento), true)\n#17 \n  /home/sigturk/NetBeansProjects/sitoEventi/protected/controllers/UtenteCreaEventoController.php(146): CController-&gt;render(\"admin\", array(\"model\" =&gt; UtenteCreaEvento))\n141         if(isset($_GET['UtenteCreaEvento']))\n142             $model-&gt;attributes=$_GET['UtenteCreaEvento'];\n143 \n144         $this-&gt;render('admin',array(\n145             'model'=&gt;$model,\n146         ));\n147     }\n148 \n149     /**\n150      * Returns the data model based on the primary key given in the GET variable.\n151      * If the data model is not found, an HTTP exception will be raised.\n#18 */\n+  /home/sigturk/NetBeansProjects/yii/framework/web/actions/CInlineAction.php(50): UtenteCreaEventoController-&gt;actionAdmin()\n#19 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(309): CInlineAction-&gt;runWithParams(array())\n#20 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/filters/CFilterChain.php(134): CController-&gt;runAction(CInlineAction)\n#21 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/filters/CFilter.php(41): CFilterChain-&gt;run()\n#22 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(1146): CFilter-&gt;filter(CFilterChain)\n#23 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/filters/CInlineFilter.php(59): CController-&gt;filterAccessControl(CFilterChain)\n#24 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/filters/CFilterChain.php(131): CInlineFilter-&gt;filter(CFilterChain)\n#25 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(292): CFilterChain-&gt;run()\n#26 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CController.php(266): CController-&gt;runActionWithFilters(CInlineAction, array(\"accessControl\", \"postOnly + delete\"))\n#27 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CWebApplication.php(283): CController-&gt;run(\"admin\")\n#28 \n+  /home/sigturk/NetBeansProjects/yii/framework/web/CWebApplication.php(142): CWebApplication-&gt;runController(\"utenteCreaEvento/admin\")\n#29 \n+  /home/sigturk/NetBeansProjects/yii/framework/base/CApplication.php(162): CWebApplication-&gt;processRequest()\n#30 \n+  /home/sigturk/NetBeansProjects/sitoEventi/index.php(13): CApplication-&gt;run()\n</code></pre>\n\n<p>model</p>\n\n<pre><code>class UtenteCreaEvento extends CActiveRecord\n{\n    /**\n     * Returns the static model of the specified AR class.\n     * @param string $className active record class name.\n     * @return UtenteCreaEvento the static model class\n     */\n    public static function model($className=__CLASS__)\n    {\n        return parent::model($className);\n    }\n\n    /**\n     * @return string the associated database table name\n     */\n    public function tableName()\n    {\n        return 'tbl_utenteCreaEvento';\n    }\n\n    /**\n     * @return array validation rules for model attributes.\n     */\n    public function rules()\n    {\n        // NOTE: you should only define rules for those attributes that\n        // will receive user inputs.\n        return array(\n            array('username, password, nome, cognome, email', 'required'),\n            array('status, numTel, numEventiCreati, numFeedPositivi, statoCanone', 'numerical', 'integerOnly'=&gt;true),\n            array('username, password, nome, cognome', 'length', 'max'=&gt;128),\n                        array('password','length','min'=&gt;6),\n            array('password','authenticate'),\n                        array('email', 'length', 'max'=&gt;256),\n            array('email', 'email'),\n                        array('numTel, numEventiCreati, numFeedPositivi, statoCanone','safe'),\n            // The following rule is used by search().\n            // Please remove those attributes that should not be searched.\n            array('id, status, username, nome, cognome, numTel, numEventiCreati, numFeedPositivi, email, statoCanone, dataCreazioneProfilo', 'safe', 'on'=&gt;'search'),\n        );\n    }\n\n    /**\n     * @return array relational rules.\n     */\n    public function relations()\n    {\n        // NOTE: you may need to adjust the relation name and the related\n        // class name for the relations automatically generated below.\n        return array(\n            'eventiCreati' =&gt; array(self::HAS_MANY, 'Evento', 'creatoDa'),\n            'fotoCaricate' =&gt; array(self::HAS_MANY, 'Foto', 'caricataDaUtenteEventi'),\n        );\n    }\n\n    /**\n     * @return array customized attribute labels (name=&gt;label)\n     */\n    public function attributeLabels()\n    {\n        return array(\n            'id' =&gt; 'ID',\n            'status' =&gt; 'Status',\n            'username' =&gt; 'Username',\n            'password' =&gt; 'Password',\n            'nome' =&gt; 'Nome',\n            'cognome' =&gt; 'Cognome',\n            'numTel' =&gt; 'Num Tel',\n            'numEventiCreati' =&gt; 'Num Eventi Creati',\n            'numFeedPositivi' =&gt; 'Num Feed Positivi',\n            'email' =&gt; 'Email',\n            'statoCanone' =&gt; 'Stato Canone',\n            'dataCreazioneProfilo' =&gt; 'Data Creazione Profilo',\n        );\n    }\n\n    /**\n     * Retrieves a list of models based on the current search/filter conditions.\n     * @return CActiveDataProvider the data provider that can return the models based on the search/filter conditions.\n     */\n    public function search()\n    {\n        // Warning: Please modify the following code to remove attributes that\n        // should not be searched.\n\n        $criteria=new CDbCriteria;\n\n        $criteria-&gt;compare('id',$this-&gt;id,true);\n        $criteria-&gt;compare('status',$this-&gt;status);\n        $criteria-&gt;compare('username',$this-&gt;username,true);\n        $criteria-&gt;compare('password',$this-&gt;password,true);\n        $criteria-&gt;compare('nome',$this-&gt;nome,true);\n        $criteria-&gt;compare('cognome',$this-&gt;cognome,true);\n        $criteria-&gt;compare('numTel',$this-&gt;numTel);\n        $criteria-&gt;compare('numEventiCreati',$this-&gt;numEventiCreati);\n        $criteria-&gt;compare('numFeedPositivi',$this-&gt;numFeedPositivi);\n        $criteria-&gt;compare('email',$this-&gt;email,true);\n        $criteria-&gt;compare('statoCanone',$this-&gt;statoCanone);\n        $criteria-&gt;compare('dataCreazioneProfilo',$this-&gt;dataCreazioneProfilo,true);\n\n        return new CActiveDataProvider($this, array(\n            'criteria'=&gt;$criteria,\n        ));\n    }\n\n        /**\n     * This is invoked before the record is saved.\n     * @return boolean whether the record should be saved.\n     */\n    protected function beforeSave()\n    {\n              if ($this-&gt;isNewRecord)\n                $this-&gt;dataCreazioneProfilo = new CDbExpression('NOW()');\n              $this-&gt;status = 0;\n              $this-&gt;statoCanone = 0;\n\n            return parent::beforeSave();\n        }\n</code></pre>\n\n<p>controller</p>\n\n<pre><code>public function actionView($id)\n    {\n        $this-&gt;render('view',array(\n            'model'=&gt;$this-&gt;loadModel($id),\n        ));\n    }\n\n    /**\n     * Creates a new model.\n     * If creation is successful, the browser will be redirected to the 'view' page.\n     */\n    public function actionCreate()\n    {\n        $model=new UtenteCreaEvento;\n\n        // Uncomment the following line if AJAX validation is needed\n        // $this-&gt;performAjaxValidation($model);\n\n        if(isset($_POST['UtenteCreaEvento']))\n        {\n            $model-&gt;attributes=$_POST['UtenteCreaEvento'];\n            if($model-&gt;save())\n                $this-&gt;redirect(array('view','id'=&gt;$model-&gt;id));\n        }\n\n        $this-&gt;render('create',array(\n            'model'=&gt;$model,\n        ));\n    }\n\n    /**\n     * Updates a particular model.\n     * If update is successful, the browser will be redirected to the 'view' page.\n     * @param integer $id the ID of the model to be updated\n     */\n    public function actionUpdate($id)\n    {\n        $model=$this-&gt;loadModel($id);\n\n        // Uncomment the following line if AJAX validation is needed\n        // $this-&gt;performAjaxValidation($model);\n\n        if(isset($_POST['UtenteCreaEvento']))\n        {\n            $model-&gt;attributes=$_POST['UtenteCreaEvento'];\n            if($model-&gt;save())\n                $this-&gt;redirect(array('view','id'=&gt;$model-&gt;id));\n        }\n\n        $this-&gt;render('update',array(\n            'model'=&gt;$model,\n        ));\n    }\n\n    /**\n     * Deletes a particular model.\n     * If deletion is successful, the browser will be redirected to the 'admin' page.\n     * @param integer $id the ID of the model to be deleted\n     */\n    public function actionDelete($id)\n    {\n//      $this-&gt;loadModel($id)-&gt;delete();\n                $utentecreaEvento = new UtenteCreaEvento();\n                $utentecreaEvento = UtenteCreaEvento::model()-&gt;find('id',$id);\n                $utentecreaEvento-&gt;status = 0;\n\n        // if AJAX request (triggered by deletion via admin grid view), we should not redirect the browser\n        if(!isset($_GET['ajax']))\n            $this-&gt;redirect(isset($_POST['returnUrl']) ? $_POST['returnUrl'] : array('admin'));\n    }\n\n    /**\n     * Lists all models.\n     */\n    public function actionIndex()\n    {\n        $dataProvider=new CActiveDataProvider('UtenteCreaEvento');\n        $this-&gt;render('index',array(\n            'dataProvider'=&gt;$dataProvider,\n        ));\n    }\n\n    /**\n     * Manages all models.\n     */\n    public function actionAdmin()\n    {\n        $model=new UtenteCreaEvento('search');\n        $model-&gt;unsetAttributes();  // clear any default values\n        if(isset($_GET['UtenteCreaEvento']))\n            $model-&gt;attributes=$_GET['UtenteCreaEvento'];\n\n        $this-&gt;render('admin',array(\n            'model'=&gt;$model,\n        ));\n    }\n\n    /**\n     * Returns the data model based on the primary key given in the GET variable.\n     * If the data model is not found, an HTTP exception will be raised.\n     * @param integer the ID of the model to be loaded\n     */\n    public function loadModel($id)\n    {\n        $model=UtenteCreaEvento::model()-&gt;findByPk($id);\n        if($model===null)\n            throw new CHttpException(404,'The requested page does not exist.');\n        return $model;\n    }\n\n    /**\n     * Performs the AJAX validation.\n     * @param CModel the model to be validated\n     */\n    protected function performAjaxValidation($model)\n    {\n        if(isset($_POST['ajax']) &amp;&amp; $_POST['ajax']==='utente-crea-evento-form')\n        {\n            echo CActiveForm::validate($model);\n            Yii::app()-&gt;end();\n        }\n    }\n</code></pre>\n\n<p>i get this kind of error only when i try to manege the entities of this class but all other kind of actions don't gives any kind of problem.\nthanks in advance</p>\n"},{"tags":["entity-framework","ef-code-first","database-schema","initializer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13089448,"title":"How to check if database schema matches Entity Framework schema?","body":"<p>For my surprise, using the <strong>CreateDatabaseIfNotExists</strong> context initializer, the line</p>\n\n<pre><code>context.Database.Initialize(true)\n</code></pre>\n\n<p><strong>doesn't</strong> throw an exception if the schema does not match my code first schema.</p>\n\n<p>Is there a way to validate if the current database matches our schema before, for instance, we try to access a entity, whose table doesn't exist on the database anymore, and an exception is thrown by EF?</p>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13089350,"title":"EF 4.1 DB2 Default Value","body":"<p>I am trying to set a default value for a table using the example here:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/6846952/disabling-entity-frameworks-default-value-generation-code-first\">Disabling Entity Framework&#39;s default value generation (Code First)</a> </p>\n\n<p>I have seen variations of this example and I have tried them all, but I can't get any to work.  The problem is the class in <code>Model.tt</code> already has an empty constructor so I am getting a <code>Type [] already defines a member called [] with the same parameter types</code> exception.</p>\n\n<p>here is my class</p>\n\n<pre><code>namespace Project.DataModel\n{\n    public partial class APPLICANT\n    {\n        public APPLICANT()\n        {\n            EMAIL_ADDRESS = string.Empty;\n        }\n    }\n}\n</code></pre>\n\n<p>Here is the auto generated class in ProjectModel.tt.  I noticed the classes that do not have a relation defined do not have the empty constructor.  Could this be different because my data store is DB2?</p>\n\n<pre><code>    namespace Project.DataModel\n{\n    using System;\n    using System.Collections.Generic;\n\n    public partial class APPLICANT\n    {\n        public APPLICANT()\n        {\n            this.APPLICATION = new HashSet&lt;APPLICATION&gt;();\n        }\n\n        public int APPLICANT_ID { get; set; }\n        public string COMPLETE_NAME { get; set; }\n        public string PREVIOUS_NAME { get; set; }\n        public string SSN { get; set; }\n        public string EMAIL_ADDRESS { get; set; }\n\n        public virtual ICollection&lt;APPLICATION&gt; APPLICATION { get; set; }\n    }\n}\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13089496,"title":"Why I can't call DbContext.ObjectContext directly?","body":"<p>Why I can't call <code>DbContext.ObjectContext</code> directly? I can do this <code>((IObjectContextAdapter)context).ObjectContext</code></p>\n\n<p>I think the inside mechanism is the implicitly implementation of interface like this </p>\n\n<pre><code>class Program \n{ \n    static void Main(string[] args) \n    { \n        TestClass t = new TestClass(); \n        ((TestInterface)t).TestMethod(); \n        // I can't call t.TestMethod()\n        Console.ReadKey(); \n    } \n} \n\npublic interface TestInterface \n{ \n    void TestMethod(); \n} \n\npublic class TestClass : TestInterface \n{ \n    void TestInterface.TestMethod() \n    { \n        Console.WriteLine(\"abcdefg\"); \n    } \n}\n</code></pre>\n\n<p>I meet this problem before which is <code>IEnumerable&lt;T&gt;</code> inherits <code>IEnumerable</code>, it has the generic version <code>IEnumerator&lt;T&gt; GetEnumerator()</code> and non-generic version <code>IEnumerator GetEnumerator()</code>, but you can only call the generic one rather than the non-generic one. Its because that the non-generic one is not type-safe and the author wants to hide it.</p>\n\n<p>But what is the reason for the <a href=\"http://msdn.microsoft.com/en-us/library/system.data.entity.dbcontext%28v=vs.103%29.aspx\" rel=\"nofollow\">DbContext</a> class?</p>\n"},{"tags":["entity-framework","stored-procedures","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":44,"score":-1,"question_id":13088233,"title":"Accessing stored procedures in EF code-first (4.4)","body":"<p>Does anyone know a simple way to access a stored procedure using EF code first in the latest version of Entity Framework? I'm using 4.4 which I think is CTP release 5.</p>\n\n<p>I've searched for examples and tried lots but none seem to work.</p>\n\n<p>Any help appreciated.</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13088260,"title":"Entity Framework One-Zer-One different behavior","body":"<p>Suppose you want to create a parent-child relationship in a table of users that will be the type of zero to one, we want to add further in the same way gender.</p>\n\n<pre><code>public class Gender\n{\n    [Key]\n    public virtual int GenderID { get; set; }\n\n    public virtual string GenderName { get; set; }\n\n    public virtual ICollection&lt;UserProfile&gt; UserProfiles { get; set; }\n}\n</code></pre>\n\n<p>and Userprofile </p>\n\n<pre><code>public class UserProfile\n{\n\n    [Key]\n    public virtual int UserId { get; set; }\n\n    public virtual UserProfile UserParent { get; set; }\n\n    public virtual int? ParentUserId { get; set; }\n\n    public virtual String UserName { get; set; }\n\n    public virtual Gender Gender { get; set; }\n\n    public virtual int? GenderID { get; set; }\n\n  }\n</code></pre>\n\n<p>for clarity</p>\n\n<pre><code>       modelBuilder.Entity&lt;UserProfile&gt;()\n            .HasOptional(c =&gt; c.UserParent);\n\n        // User -&gt; Gender\n        modelBuilder.Entity&lt;UserProfile&gt;()\n            .HasOptional(g =&gt; g.Gender);\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/IhvGJ.png\" alt=\"enter image description here\"></p>\n\n<p>Everything looks good, but at the moment I can not retrieve the data obtained from the Parent UserName.</p>\n\n<pre><code>   public IQueryable&lt;UserProfileListViewModel&gt; UserAllVM\n    {\n        get\n        {\n            var uservm = context.UserProfiles\n                .Select(l =&gt; new UserProfileListViewModel\n                { \n                    UserId = l.UserId,\n                    UserName = l.UserName,\n                    ParentUserId = l.ParentUserId ?? 0,\n                    //ParentUserName = this.context.UserProfiles.Where(e =&gt; e.UserId == l.ParentUserId).FirstOrDefault().UserName ?? \"\",\n                    ParentUserName = l.UserParent.UserName, **// this way make always null**\n                    GenderID = l.GenderID ?? 0,\n                    GenderName = l.Gender.GenderName ?? \"\",\n                });\n\n            return uservm;\n        }\n    }\n</code></pre>\n\n<p>Commented out the way now obtains parent UserName. Question is why I can't retrive Parent UserName - I miss sth ?</p>\n\n<p>Tx for help</p>\n"},{"tags":["entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13088163,"title":"Difficulties while querying with LINQ Many to Many (MTM) association","body":"<p>IMHO, I think this is the hardest thing for me to get - the whole MTM side of LINQ and I need help.</p>\n\n<p>In SQL I have 3 tables: <code>Accounts</code>, <code>AccountsInFeatures</code> and <code>Features</code>. <code>AccountsInFeatures</code> simply has two primary key columns that link to <code>Accounts</code> to <code>Features</code>.</p>\n\n<p>In EF, <code>AccountsInFeatures</code> is not visible - I understand why - but I'm having problems creating the LINQ:</p>\n\n<p>Here's what I'm trying to do:</p>\n\n<pre><code>return (from a in _Store.Accounts\n        where a.AccountGUID == _AccountGUID\n        select new AccountDetails\n        {\n            AccountGUID = a.AccountGUID\n            AccountName = a.AccountName,\n            SelectedFeatures = a.Features.Select(f =&gt; f.FeatureGUID).ToList()\n        }).ToList();\n</code></pre>\n\n<p>Here's the definition for <code>AccountDetails</code>:</p>\n\n<pre><code>public class AccountDetails\n{\n    public Guid AccountGUID { get; set; }\n    public string AccountName { get; set; }  \n    public List&lt;Guid&gt; SelectedFeatures { get; set; }    \n}\n</code></pre>\n\n<p>How do I fill <code>\"SelectedFeatures\"</code> with a list of Features - is this possible? I'm close to just splitting this into two queries =)</p>\n"},{"tags":["c#","entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":30,"score":0,"question_id":13088041,"title":"Entity Framework ObjectSet","body":"<p>Quick question. Take the following method I wrote for my EF repository:</p>\n\n<pre><code>public virtual IEnumerable&lt;T&gt; SelectWhere(Expression&lt;Func&lt;T, bool&gt;&gt; predicate)\n{\n    using (CAMHS_DB db = new CAMHS_DB())\n    {\n        return db.CreateObjectSet&lt;T&gt;().Where(predicate).ToList&lt;T&gt;();\n    }\n}\n</code></pre>\n\n<p>Will EF apply my predicate before it goes to the DB and use it to return only the records I asked for, or will it return everything then apply the predicate??</p>\n\n<p>Thanks,\nWilky.</p>\n"},{"tags":["c#","linq","entity-framework","c#-3.0"],"answer_count":12,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":12068,"score":2,"question_id":2066084,"title":"\"IN\" Operator in Linq","body":"<p>I am trying to convert an old raw Sql query in Linq with Entity Framework here.</p>\n\n<p>It was using the IN operator with a collection of items. The query was something like that: </p>\n\n<pre><code>SELECT Members.Name\nFROM Members\nWHERE Members.ID IN ( SELECT DISTINCT ManufacturerID FROM Products WHERE Active = 1)\nORDER BY Members.Name ASC\n</code></pre>\n\n<p>Since the return of the subquery is not a single string but a collection of strings I can't use the <code>String.Contains()</code> method.</p>\n\n<p>I thought about doing something like : </p>\n\n<pre><code>var activeProducts = (\nfrom products in db.ProductSet\nwhere product.Active == true\nselect product.ManufacturerID);\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>var activeMembers = (\nfrom member in db.ContactSet\nwhere member.ID.ToString().Contains(activeProducts));\n</code></pre>\n\n<p>but it stops at the contains saying it has invalid arguments ... I can't select activeProducts.ManufacturerID because obviously the proprety is not there since it returns an IQueryable...</p>\n\n<p>Bottom line what I'm trying to do here is to return a list of members who have at least one active product.</p>\n\n<p>Any hint ?</p>\n\n<p>[edit]</p>\n\n<p>Here's the full query code ... I tried with the contains on the second expression, Linq didn't seem to like it : </p>\n\n<p><code>Server Error in '/' Application.\nLINQ to Entities does not recognize the method 'Boolean Contains[String](System.Linq.IQueryable``1[System.String], System.String)' method, and this method cannot be translated into a store expression.</code></p>\n\n<pre><code>    var activeProduct =(from product in Master.DataContext.ProductSet\n                        where product.Active == true\n                           &amp;&amp; product.ShowOnWebSite == true\n                           &amp;&amp; product.AvailableDate &lt;= DateTime.Today\n                           &amp;&amp; ( product.DiscontinuationDate == null || product.DiscontinuationDate &gt;= DateTime.Today )\n                        select product.ManufacturerID.ToString() );\n\n    var activeArtists = from artist in Master.DataContext.ContactSet\n                        where activeProduct.Contains(artist.ID.ToString())\n                        select artist;\n\n    NumberOfArtists = activeArtists.Count();\n\n    artistsRepeater.DataSource = activeArtists;\n    artistsRepeater.DataBind();\n</code></pre>\n\n<p>[More details]\nManufacturerID is a nullable GUID apparently...</p>\n\n<p>For some reason the ContactSet class do not contain any reference to the products I guess I will have to do a join query, no clues here.</p>\n"},{"tags":["entity-framework","ef-code-first","mapping"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13087667,"title":"Code First Inheritance Mapping","body":"<p>In code first, using Table Per Hierarchy inheritance (TPH), it automatically adds a where clause in the query, putting the value of the <code>Discriminator</code>.\nI have to use the TPH and retrieve all data without distinction? ie using inheritance, but we always come all the data.</p>\n\n<p>If I try to leave the <code>Discriminator</code> null as well as in the reference table inherited happens the following error when doing a search:</p>\n\n<pre><code>(1217.10): error 3032: Problem in mapping fragments starting at lines 1208, 1217: EntityTypes Repositorio.UseMensagens, Repositorio.EcmMensagens\nare being mapped to the same rows in table UseMensagens. Mapping conditions can be used to Distinguish the rows That these types are mapped to.\n</code></pre>\n\n<p>I always bring all data, regardless of Discriminator, is how to disable it?</p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":783,"score":1,"question_id":1514312,"title":"How to make \"1-to-1\" association works correctly in Entity Framework?","body":"<p>I have objects: \ntype A (Id, Name),\ntype B (AId, Description).</p>\n\n<p>I want to make relation 1-to-1 (and create it 1-to-[0..1]). All works great exept deleting objects of type A. When I'm trying to delete some object from type A exception occurs.</p>\n\n<p>A relationship is being added or deleted from an AssociationSet .... With cardinality constraints, a corresponding ... must also be added or deleted.</p>\n\n<p>Im searched for solution (found editing CSDL for many-to-many), but nothing helps. There is also cascade action defined in the table in Database.</p>\n\n<p>Any suggestions?</p>\n\n<p>UPD: Thanks for answers. \nLet's say more clear.</p>\n\n<ol>\n<li><p>I don't want to implement inheretance betwen A and B</p></li>\n<li><p>I try to fix problem by editing edmx file (like this <a href=\"http://codepolice.net/2008/12/16/cascade-delete-in-entity-framework/\" rel=\"nofollow\">http://codepolice.net/2008/12/16/cascade-delete-in-entity-framework/</a>), but no luck. Seems it's only worked for one-to-many.</p></li>\n<li><p>I just want to have 2 objects with one-to-one relation. For example, Order and OrderDetails. I expected automatic creating/deleting OrderDetails for every Order I have.</p></li>\n</ol>\n"},{"tags":["wcf","asp.net-mvc-3","entity-framework","odata"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":441,"score":1,"question_id":8083101,"title":"OData in MVC3 + EF layered architecture","body":"<p>I'm a total newbie to WCF-related stuff, so forgive my naive question, but I am not sure where to start in pinpointing an error while learning OData basics.</p>\n\n<p>I have an existing MVC3 application using a database, using the universal membership provider (added via nuget) and a small SDF database accessed via SQL Server Compact Edition Client Data Provider 4.0. I created it with the following steps:</p>\n\n<p>1) create a <strong>new library project for the data layer</strong>, add EDMX from a database, then add ADO.NET DB context and entities generators templates. </p>\n\n<p>2) create a <strong>new library project for generic data interfaces</strong>: a repository interface, implemented in (1), and the entities t4 template with its output, moved from (1) into this project (changing the TT <em>inputFile</em> parameter so that it refers to the EDMX in the other project).</p>\n\n<p>3) create a new <strong>MVC application</strong> which uses Ninject to instantiate the generic repository declared in (2) with the SDF-based repository implemented in (1).</p>\n\n<p>The web application works fine, and I can view and edit data. Now I should expose some of its functions via a WCF service and I was looking at OData for this. So I added a new WCF Data Service, and changed the generated code just to test it, by adding the name of my entities class (as implemented in (1)) and the name of an entity set, e.g.:</p>\n\n<pre><code>public class ProjectService : DataService&lt;OrganizerEntities&gt;\n{\n    public static void InitializeService(DataServiceConfiguration config)\n    {\n        config.SetEntitySetAccessRule(\"Projects\", EntitySetRights.AllRead);\n        config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;\n    }\n}\n</code></pre>\n\n<p>Anyway when I open the SVC in the browser I get a <em>Request Error</em>: <em>The server encountered an error processing the request. See server logs for more details.</em>. If I look at the log, I see first of all a warning like:</p>\n\n<blockquote>\n  <p>... \n  http://msdn.microsoft.com/it-IT/library/System.ServiceModel.EvaluationContextNotFound.aspx\n  <strong>Configuration evaluation context not found</strong>.\n  ...</p>\n</blockquote>\n\n<p>and then an <strong>ArgumentNullException</strong> exception whose details follow. In all the samples or tutorials I've found I see the typical not-so-real-world example where the data layer is not separated from the consumer application: create a new MVC app, add an EDMX, add a WCF Data Service, change some lines of generated code, and all magically works :). So I suppose this is related to my layered architecture, especially for the missing context warning. Could anyone help in using this service in a layered scenario like this? Thanks!</p>\n\n<blockquote>\n  <p>... Value cannot be null. Parameter name: key\n   at System.Collections.Generic.Dictionary<code>2.FindEntry(TKey\n  key) at System.Collections.Generic.Dictionary</code>2.get_Item(TKey key) at\n  System.Data.Services.Providers.ObjectContextServiceProvider.PopulateMetadata(IDictionary<code>2\n  knownTypes, IDictionary</code>2 childTypes, IDictionary<code>2 entitySets) at\n  System.Data.Services.Providers.BaseServiceProvider.PopulateMetadata()\n  at System.Data.Services.DataService</code>1.CreateProvider() at\n  System.Data.Services.DataService<code>1.HandleRequest() at\n  System.Data.Services.DataService</code>1.ProcessRequestForMessage(Stream\n  messageBody) at SyncInvokeProcessRequestForMessage(Object , Object[] ,\n  Object[] ) at\n  System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object\n  instance, Object[] inputs, Object[]&amp; outputs) at\n  System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage41(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage31(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage11(MessageRpc&amp;\n  rpc) at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc&amp;\n  rpc) at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean\n  isOperationContextSet) \n  System.ArgumentNullException: Value cannot be null.\n  Parameter name: key    at\n  System.Collections.Generic.Dictionary<code>2.FindEntry(TKey key)    at\n  System.Collections.Generic.Dictionary</code>2.get_Item(TKey key)    at\n  System.Data.Services.Providers.ObjectContextServiceProvider.PopulateMetadata(IDictionary<code>2\n  knownTypes, IDictionary</code>2 childTypes, IDictionary<code>2 entitySets)    at\n  System.Data.Services.Providers.BaseServiceProvider.PopulateMetadata() \n  at System.Data.Services.DataService</code>1.CreateProvider()    at\n  System.Data.Services.DataService<code>1.HandleRequest()    at\n  System.Data.Services.DataService</code>1.ProcessRequestForMessage(Stream\n  messageBody)    at SyncInvokeProcessRequestForMessage(Object ,\n  Object[] , Object[] )    at\n  System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object\n  instance, Object[] inputs, Object[]&amp; outputs)    at\n  System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage41(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage31(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage11(MessageRpc&amp;\n  rpc)    at\n  System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc&amp;\n  rpc)    at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean\n  isOperationContextSet) ...</p>\n</blockquote>\n"},{"tags":["entity-framework","ef-migrations"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":249,"score":0,"question_id":9955180,"title":"Entity Framework 4.3 Migrations and Medium Trust","body":"<p>I would like to use the new migration feature of EF, but on my local machine when I simulate a Medium Trust environment adding \"trust level=Medium\" on the web.config file, I get this security exception:</p>\n\n<pre><code>   System.Reflection.RuntimeMethodInfo.GetMethodBody() +24\n   System.Data.Entity.Migrations.DbMigrator..ctor(DbMigrationsConfiguration configuration, DbContext usersContext) +1031\n   System.Data.Entity.Migrations.DbMigrator..ctor(DbMigrationsConfiguration configuration) +66\n   System.Data.Entity.MigrateDatabaseToLatestVersion`2.InitializeDatabase(TContext context) +52\n   System.Data.Entity.&lt;&gt;c__DisplayClass2`1.&lt;SetInitializerInternal&gt;b__0(DbContext c) +75\n   System.Data.Entity.Internal.&lt;&gt;c__DisplayClass8.&lt;PerformDatabaseInitialization&gt;b__6() +19\n   System.Data.Entity.Internal.InternalContext.PerformInitializationAction(Action action) +72\n   System.Data.Entity.Internal.InternalContext.PerformDatabaseInitialization() +185\n   System.Data.Entity.Internal.LazyInternalContext.&lt;InitializeDatabase&gt;b__4(InternalContext c) +7\n   System.Data.Entity.Internal.RetryAction`1.PerformAction(TInput input) +118\n   System.Data.Entity.Internal.LazyInternalContext.InitializeDatabaseAction(Action`1 action) +190\n   System.Data.Entity.Internal.LazyInternalContext.InitializeDatabase() +73\n   System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType) +28\n   System.Data.Entity.Internal.Linq.InternalSet`1.Initialize() +57\n   System.Data.Entity.Internal.Linq.InternalSet`1.get_InternalContext() +15\n   System.Data.Entity.Infrastructure.DbQuery`1.System.Linq.IQueryable.get_Provider() +37\n   System.Linq.Queryable.Where(IQueryable`1 source, Expression`1 predicate) +63\n</code></pre>\n\n<p>EF Migrations work in Full Trust only?</p>\n"},{"tags":["entity-framework","ef-code-first","ef-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":195,"score":2,"question_id":11611322,"title":"EF 4.3 Code First Migrations - Seed per migration","body":"<p>have recently started using Code First Migrations and was wanting to seed data in each <strong>Up</strong> method.</p>\n\n<p>is this possible?</p>\n\n<p>Ie.</p>\n\n<ol>\n<li>Create database table</li>\n<li>Fill with data</li>\n</ol>\n\n<p>for Drop:</p>\n\n<ol>\n<li>Delete data from joining table</li>\n<li>delete table </li>\n</ol>\n"},{"tags":["c#","entity-framework","sql-server-ce","prism","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":145,"score":0,"question_id":12883379,"title":"Connection String in a EF general DAL assembly","body":"<p><strong>The Structure of the project :</strong></p>\n\n<p>There is a modules folder which I need to add the database and make the repository just there,\nOther modules and assemblies could use that.\nNew : Changed it to previous proved state of placing the config file in the root application,\nstill there are errors.\nThis post is edited completely.</p>\n\n<hr>\n\n<p><strong>The Database Location :</strong></p>\n\n<h2>location : ....\\db\\db.sdf (2 levels upper from the sell's app.config)</h2>\n\n<p><strong>The App.Config file</strong></p>\n\n<p>location : modules\\ModuleX\\ (Formerly)</p>\n\n<h2>New Location : Shell\\ (Main Project)</h2>\n\n<p><strong>New Version :</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;startup&gt;\n    &lt;supportedRuntime version=\"v4.0\" sku=\".NETFramework,Version=v4.5\" /&gt;\n  &lt;/startup&gt;\n  &lt;configSections&gt;\n    &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n  &lt;/configSections&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"MyRecordzContext\" connectionString=\"metadata=res://*...\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;  \n</code></pre>\n\n<hr>\n\n<p><strong>2 Cases of suspect :</strong>\nproviderName=\"System.Data.EntityClient\"</p>\n\n<p>LocalDbConnectionFactory</p>\n\n<hr>\n\n<p><strong>Error Info :</strong></p>\n\n<p><em>Error Line :</em>\n            TblMyRecord MyRecord = context.MyRecords.First(w => w.MyRecord == stMyRecord);</p>\n\n<p><em>Error :</em>\n    No connection string named 'MyRecordzContext' could be found in the application config file.</p>\n\n<hr>\n\n<p><strong>Goal</strong> : How to change the connectionstring , my app.config to make the application work as expected</p>\n\n<hr>\n\n<p>Here EF 5.0, SQL CE , Prism, WPF, MVVM, C# were used</p>\n\n<hr>\n\n<p><strong>Error :</strong></p>\n\n<p>Error :\n    The type initializer for 'System.Windows.Application' threw an exception. </p>\n\n<p>Appears as the application runs.</p>\n\n<p>The error seems to be before any build.</p>\n\n<p><strong>Stack Trace :</strong></p>\n\n<pre><code>PresentationFramework.dll!System.Windows.Application.Application()\nXz.Shell.exe!Xz.Shell.App.App()\nXz.Shell.exe!Xz.Shell.App.Main()\n[Native to Managed Transition]\n[Managed to Native Transition]\nmscorlib.dll!System.AppDomain.ExecuteAssembly(string assemblyFile, System.Security.Policy.Evidence assemblySecurity, string[] args)\nMicrosoft.VisualStudio.HostingProcess.Utilities.dll!Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()\nmscorlib.dll!System.Threading.ThreadHelper.ThreadStart_Context(object state)\nmscorlib.dll!System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback callback, object state, bool preserveSyncCtx)\nmscorlib.dll!System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback callback, object state, bool preserveSyncCtx)\nmscorlib.dll!System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback callback, object state)\nmscorlib.dll!System.Threading.ThreadHelper.ThreadStart()\n[Native to Managed Transition]\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13085664,"title":"Schema not supported error in asp.net mvc web api","body":"<p>I am working on asp.net mvc 4 web api. I am using code first with existing database model. I have a single table in my database so i have the entity class like,</p>\n\n<pre><code>public class Tab1\n{\n[Key]\npublic int Field1{get; set;}\npublic string Field2{get; set;}\n}\n</code></pre>\n\n<p>I have DBContext file like,</p>\n\n<pre><code>public class MyDBContext:DbContext\n{\npublic DbSet&lt;Tab1&gt; Table{ get; set; }\n\n protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n           modelBuilder.Entity&lt;Bar&gt;().ToTable(\"bars\");\n        }\n}\n</code></pre>\n\n<p>and my Get Action is like</p>\n\n<pre><code> public List&lt;Bar&gt; GetTables()\n            {\n               MyDBContext context=new MyDBContext();\n                return context.Table.ToList();\n            }\n</code></pre>\n\n<p>But I am getting an error <strong>Schema specified is not valid error 0064: Facet 'MaxLength' must not be specified for type 'mediumtext'.</strong>. so please guide if i did any mistake in the process.</p>\n\n<p>Here i have one more class like</p>\n\n<pre><code>public class Tab2:Tab1\n{\npublic string Filed3{get; set;}\n}\n</code></pre>\n\n<p>I dont want to create table in database with tab2 since i used tab2 class for returning custom records. I got the above error due to Tab2 inheriting from tab1 when i remove class tab2 it works as usual. so please guide me.</p>\n"},{"tags":["asp.net-mvc","oracle","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13077810,"title":"Oracle Sequences, Entity Framework and getting nextval in an MVC3 View","body":"<p>I'm currently using Entity Framework inside an MVC3 application to connect to an Oracle Database. I want to write a new record to a table in the Oracle database which includes a sequence that defines it's primary key. Of course, the primary key is defined to be not null. All my views are written in ASP.Net instead of Razor.</p>\n\n<p>I see that most posts out there recommend setting a StoreGeneratedPattern directly on the edmx model. However, I notice that most edmx model examples like this one: <a href=\"http://stackoverflow.com/questions/7351260/oracle-entity-in-vs-entity-framework-doesnt-update-the-primary-key-in-code\">Oracle entity in VS entity framework doesnt update the primary key in code</a>  include the tables defined using EntityTypes -the table in question I want to do this on is actually encompassed in an EntitySet:</p>\n\n<pre><code>&lt;EntitySet Name=\"REGISTERED_PERSON\" EntityType=\"Model.Store.REGISTERED_PERSON\" store:Type=\"Tables\" Schema=\"MYSCHEMA\" /&gt;\n</code></pre>\n\n<p>and when I try to set StoreGeneratedPattern=Identity on this, I get an error that the StoreGeneratedPattern attribute is not allowed, presumably because it is not an EntityType. I had originally thought about just getting the max. registered_person_id from the database via LINQ statement and then assigning that into the model, but then the problem arises that you'd get a duplicate ID if two inserts were executed at the same time. </p>\n\n<p>I also checked the database and I don't have any triggers written. I know that in Oracle you can opt to select from dual to get the next value which is generated by the sequence, such as illustrated below:\n<br>select MY_SEQ.nextval,'some value' from dual</p>\n\n<p>This post here: <a href=\"http://stackoverflow.com/questions/2189114/postgresql-nextval-question-on-sequences\">postgresql nextval question on sequences</a> has a great title, but the problem with that is that I'm not working with postgresql or PHP, so unfortunately it doesn't help me. I also don't have any triggers written to fire the sequence upon insert of a record. </p>\n\n<p>How do I go about getting the nextvalue from the sequence and assign it to my Registered_Person_Id, preferably in the view before the entire model object gets passed back to the controller to insert in the database? </p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework","stored-procedures","ado.net"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":103,"score":3,"question_id":12710455,"title":"Why is my broken stored procedure being dropped?","body":"<p>I have an ASP.NET MVC 4 project configured to use Entity Framework 5, backed by a SQL Server database.</p>\n\n<p>One of the stored procedures in my DB performs an illegal operation: it tries to insert a <code>NULL</code> value into a <code>NOT NULL</code> column. Understandably, this fails.</p>\n\n<p>Inexplicably, Entity Framework (or some other component of my ASP.NET MVC stack, or perhaps my SQL Server database) then <strong>drops the stored procedure</strong> from the database!</p>\n\n<p>A screenshot of the error message I receive when I attempt to call my stored procedure is below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/3Nt2M.jpg\" alt=\"The error page displayed\"></p>\n\n<p>I can't seem to find any documentation on this behaviour. </p>\n\n<p><strong>Why is this happening, and what can I do to prevent stored procedures from being dropped?</strong></p>\n"},{"tags":[".net","asp.net-mvc-3","entity-framework","controller","httprequest"],"answer_count":4,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":1204,"score":7,"question_id":5425920,"title":"ASP.NET MVC: Controller created for every request?","body":"<p>Very simple question: Are controllers in ASP.NET created for every http request ? Or are they created at application startup and reused throughout requests ?</p>\n\n<p>For some particular http request only the requested controller will created ? Is that right ? </p>\n\n<p>If my previous assumptions are correct can I depend on it ? I want to create database context (Entity framework) that will live only for one request. If I create it as a property initialized in controller's constructor is it granted that new instance of context will be created on for every request ?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13084159,"title":"passing parameters to stored procedure entity framework with sql server 2005","body":"<p>I have a stored proc which takes a int as parameter.  I am using entity framework code first along with MVC and I am making the call in this manner</p>\n\n<pre><code>        SqlParameter sa = new SqlParameter(\"@userId\", userId);\n        var query = from dashboardData in TBSCIDBContext.Database.SqlQuery&lt;MyNomination&gt;(\"sp_GetMyNominationList @userId\", sa)\n                    select dashboardData;\n        return query.ToList();\n</code></pre>\n\n<p>in profiler I get</p>\n\n<pre><code>exec sp_executesql N'sp_GetMyNominationList @userId',N'@userId int',@userId=4  \n</code></pre>\n\n<p>This executes correctly on using sql server 2008 but now my db is changed to 2005\nand the same exec statement gives me</p>\n\n<p>Incorrect syntax near 'sp_GetMyNominationList'. because I am running it in 2005. </p>\n\n<p>I have to use 2005 please tell me a way to make this run in 2005 so that the parameter is taken correctly by the sql profiler</p>\n"},{"tags":["c#","entity-framework","mvvm",".net-4.0","freeze"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13084672,"title":"Lazy Loading in EF4.0 is freezing UI","body":"<p>Hi I am designing an application using WPF, EF and MVVM (.NET4.0).</p>\n\n<p>I face issue with freezing UI when I'm binding data. I think this is because of lazy loading.</p>\n\n<p>MVVM:</p>\n\n<pre><code>        ThreadPool.QueueUserWorkItem(state =&gt;\n        {\n                IsProgressBarVisible(true);\n\n                var service = Context.SomeModel.ToList();\n                BgServiceCompleted(service);\n        });\n</code></pre>\n\n<p>XAML:</p>\n\n<pre><code>\"{Binding OrderItemViews.SOmeModel_A.SomeModel_B.SOmeField}\"\n\"{Binding OrderItemViews.Country.Name}\"\n</code></pre>\n\n<p>Some Model:</p>\n\n<pre><code>public class SomeModel_A\n{\n    public int Id { get; set; }\n    ....        \n    public int SomeB_Id { get; set; }\n    public virtual SomeModel_B SomeModel_B { get; set; }\n}\n</code></pre>\n\n<p>I found a solution for this problem.</p>\n\n<p>1) setting the IsAsync-Property in the ItemsSource-Binding.</p>\n\n<pre><code>\"{Binding OrderItemViews.SOmeModel_A.SomeModel_B.SOmeField, IsAsync=true}\"\n</code></pre>\n\n<p>The interface does not freeze, but the value appears after a while time. This will confuse some users. </p>\n\n<p>2) using Include for loading include data.\nFor instance: </p>\n\n<pre><code>Context.SomeModel.Include(a =&gt; a.SomeModel2).Load();\n</code></pre>\n\n<p>but in my case Context doesn't have <strong>Include</strong>. Why?</p>\n\n<p>Which the best way to solve this problem?</p>\n\n<p>Could you please give me a guidance on how should I do that or any useful resource I can read and learn about it?\nThanks</p>\n"},{"tags":["vb.net","entity-framework","sqlite","datasource"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12975032,"title":"Can't use SQLite Entity Framework as DataGridView DataSource","body":"<p>I've built an Entity Framework Model from a simple SQLite database using the 'Entity Data Model Wizard'</p>\n\n<p>This works fine and I've been programming aginst it for a while.</p>\n\n<p>However, I've just tried to use this SQLite entity framework model as a DataSource for a DataGridView and it cannot see it as a datasource. Everything suggests that this should be possible. Creating a DataSet from the same database works and the DataGridView can use this as a datasource.</p>\n\n<p>I would prefer to use the entity framework but can't understand why it's not seeing it as a valid datasource.</p>\n\n<p>Please help!</p>\n\n<p>As requested here is the app.config file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;&lt;/configSections&gt;\n  &lt;system.data&gt;\n    &lt;DbProviderFactories&gt;\n  &lt;add name=\"SQLite Data Provider\" invariant=\"System.Data.SQLite\" description=\".Net Framework Data Provider for SQLite\" type=\"System.Data.SQLite.SQLiteFactory, System.Data.SQLite\" /&gt;\n&lt;/DbProviderFactories&gt;\n  &lt;/system.data&gt;\n  &lt;system.diagnostics&gt;\n    &lt;sources&gt;\n      &lt;!-- This section defines the logging configuration for My.Application.Log --&gt;\n  &lt;source name=\"DefaultSource\" switchName=\"DefaultSwitch\"&gt;\n    &lt;listeners&gt;\n      &lt;add name=\"FileLog\" /&gt;\n      &lt;!-- Uncomment the below section to write to the Application Event Log --&gt;\n      &lt;!--&lt;add name=\"EventLog\"/&gt;--&gt;\n    &lt;/listeners&gt;\n  &lt;/source&gt;\n&lt;/sources&gt;\n&lt;switches&gt;\n  &lt;add name=\"DefaultSwitch\" value=\"Information\" /&gt;\n&lt;/switches&gt;\n&lt;sharedListeners&gt;\n  &lt;add name=\"FileLog\" type=\"Microsoft.VisualBasic.Logging.FileLogTraceListener, Microsoft.VisualBasic, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a, processorArchitecture=MSIL\" initializeData=\"FileLogWriter\" /&gt;\n  &lt;!-- Uncomment the below section and replace APPLICATION_NAME with the name of your application to write to the Application Event Log --&gt;\n  &lt;!--&lt;add name=\"EventLog\" type=\"System.Diagnostics.EventLogTraceListener\" initializeData=\"APPLICATION_NAME\"/&gt; --&gt;\n&lt;/sharedListeners&gt;\n  &lt;/system.diagnostics&gt;\n  &lt;startup useLegacyV2RuntimeActivationPolicy=\"true\"&gt;\n    &lt;supportedRuntime version=\"v4.0\" sku=\".NETFramework,Version=v4.0\" /&gt;\n  &lt;/startup&gt;\n  &lt;connectionStrings&gt;\n  &lt;add name=\"simpleEntities\" connectionString=\"metadata=res://*/GEM.Classes.test1.csdl|res://*/GEM.Classes.test1.ssdl|res://*/GEM.Classes.test1.msl;provider=System.Data.SQLite;provider connection string=&amp;quot;data source=E:\\simple.db3&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>As a test I've used a very simple database:</p>\n\n<pre><code>CREATE TABLE SETTINGS (\nKEY VARCHAR(50) PRIMARY KEY NOT NULL ,\nVALUE VARCHAR(255)  NULL DEFAULT NULL);\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12732161,"title":"How to automate setting ConcurrencyMode=Fixed on all RowVersion columns?","body":"<p>EF defaults to no concurrency control (last write wins) which allows lost updates.\nEnforcing optimistic concurrency checks can explicitly be configured by setting ConcurrencyMode=Fixed on a RowVersion column.</p>\n\n<p>How can we automate setting ConcurrencyMode=Fixed on RowVersion columns in all tables?\nHaving to do this manually when recreating an EF model from a database we risk forgetting it an running without concurrency control.</p>\n"},{"tags":[".net","entity-framework","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12956021,"title":"How to trace DbQuery parameter values","body":"<p>We are tracing the generated SQL using qry.ToString.\nHow can we trace the parameter values too.</p>\n\n<p>DbQuery (in contrast to ObjectQuery) does not have a Parameters property.</p>\n\n<p>Using SqlProfiler is not an option. We are tracing using log4net in production.</p>\n"},{"tags":["c#","entity-framework","dto"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13084110,"title":"Best practice to manage state of a disconnected entity passing to the UI and back to the business","body":"<p>I've read a couple of posts on how STEs are considered bad in n-tier web applications because they are bloated, and carry a lot of unnecessary weight. </p>\n\n<p>Are there any ways then, if I were to use DTOs, to be able to track which properties were modified by the UI layer before saving them back into the DB?</p>\n\n<p>I like the idea of STEs because they don't require me to update my 50 column table if the client only modified one of the field. (I'm assuming this is the main benefit of STEs?)</p>\n"},{"tags":["c#",".net","entity-framework","architecture"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13065146,"title":"Wrapping EntityFrameWork with IDal<T> interface","body":"<p>I want to wrap my <code>EntityFrameWork</code> class with <code>IDal&lt;T&gt;</code> interface with <code>CRUD operations</code> only.</p>\n\n<p>I thought to create BL Data Model corresponding to each Entity</p>\n\n<p>Meaning if I have <code>TempEntity</code> I'll create <code>TempBlObj</code> and interface <code>IDal&lt;TempBlObj&gt;</code></p>\n\n<p>Are there any guideliness to complete such task?</p>\n\n<p>I had a problem implementing <code>Save(TempBlObj)</code></p>\n\n<p>as saving in entity is done by:</p>\n\n<p><code>mDbEntities.SaveChanges();</code></p>\n\n<p>and this relays on change that had been done on entity reference.</p>\n\n<p>Any solutions?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I'm doing all this in order to mock my <code>IDal&lt;T&gt;</code> interface</p>\n\n<p>For example in order to change TempEntity.status</p>\n\n<p>I'll have to create a concrete method <code>ChangeStatus()</code> instead of generic <code>CRUD</code> : <code>Save(BlObj item)</code></p>\n\n<p>as save with entity is done like</p>\n\n<p><code>..take reference to some entity, do some change..</code> and</p>\n\n<p><code>mMamDbEntities.SaveChanges();</code></p>\n\n<p>I tried to add BlObjects in order to loosen dependency between the Bl and concrete EntityFW</p>\n\n<p><strong>More General:</strong></p>\n\n<p>When using ORM, what is the best practice for loose cupling, working with <code>IDal&lt;T&gt;</code> intreface (<code>CRUD</code> operations) ?</p>\n"},{"tags":["wcf","entity-framework","wcf-data-services","odata","change-tracking"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13082926,"title":"WCF Data Service Change Tracking: How to cancel save changes and revert to original values for an object","body":"<p>I have a WCF Data Service that is wrapping an Entity Framework 4 data model. I am connecting a WPF client to the service using the WCF Data Services Client library.</p>\n\n<p>Is it possible in WCF Data Services to undo / cancel changes to tracked objects ?</p>\n\n<p>scenario : In the UI I allow a user to edit an object. I have save and cancel buttons. If the user chooses to save I call SaveChanges() on my WCF context and changes are sent to the database via the WCF service. If the user clicks cancel I want to undo the changes and revert to the original property values of the current object.</p>\n\n<p>I know that the WCF data services client library has change tracking built in - but I cannot find any way at accessing this information.</p>\n\n<p>In Entity Framework the context supports the Refresh method and you can specify RefreshMode.StoreWins and pass in the object - this will effectively cancel / undo any changes.\ndocumented here  : <a href=\"http://msdn.microsoft.com/en-us/library/bb896255.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb896255.aspx</a></p>\n\n<p>Any suggestions on how I can achieve the same thing in WCF DataServices in my client application ?</p>\n\n<p>cheers\nChris</p>\n"},{"tags":["entity-framework","prism","connection-string"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13038354,"title":"Entity Connection in a Modular Prism Application","body":"<p><strong>Connection String Meta :</strong></p>\n\n<pre><code>                res://Xz.Business.xModule/Model.RecordzModel.csdl|\n                res://Xz.Business.xModule/Model.RecordzModel.ssdl|\n                res://Xz.Business.xModule/Model.RecordzModel.msl;\n</code></pre>\n\n<hr>\n\n<p><strong>Errors :</strong></p>\n\n<p><em>After Adding Business.xModule into the Config File's URI s :</em></p>\n\n<pre><code>+       base    {\"Unable to load the specified metadata resource.\"} System.Data.EntityException {System.Data.MetadataException}\n</code></pre>\n\n<p>--\n<em>After Adding Xz.Business.xModule into the Config File's URI s  :</em></p>\n\n<pre><code>+       base    {\"Unable to resolve assembly 'Xz.Business.xModule'.\":null}  System.IO.IOException {System.IO.FileNotFoundException}\n</code></pre>\n\n<hr>\n\n<p><strong>xModule Info :</strong></p>\n\n<p>The Assembly Name : Business.xModule</p>\n\n<p>Default Namespace : Xz.Business.xModule</p>\n\n<hr>\n\n<p><strong>Folder Locations :</strong></p>\n\n<p>Solution Folder and xModule Module Folder</p>\n\n<p>Solution Location..\\x1\\x2\\xModule Location</p>\n\n<p>Modules Location\nSolution Location..\\Build</p>\n\n<p>\"..\" Means a folder back.</p>\n\n<hr>\n\n<p><strong>Notes :</strong></p>\n\n<ol>\n<li>The modules have Post-Build Action which place the result assemblies into the \"Build Folder\"</li>\n<li>Other pieces of the config are correct.</li>\n<li>Unity, SQL CE, EF 5.0 were used.</li>\n</ol>\n\n<p>How to resolve this Entity Connection Problem ?</p>\n"},{"tags":["entity-framework","many-to-many","dynamic-data"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":8476583,"title":"How do I make a ManyToMany_Insert template for EF Dynamic Data?","body":"<p>I'm extremely new to Dynamic Data, but I'll fire this off anyway.</p>\n\n<p>I have an EF model set up, with a PJT table linking Shows and Genres. The EDMX correctly displays this as a * - * relationship between Shows and Genres, with navigation properties. Using Dynamic Data, I can create a Show item, but then only once it is created, can I edit it to link up the Genres (which are nicely displayed as check boxes).</p>\n\n<p>I've read this <a href=\"http://blogs.msdn.com/b/davidebb/archive/2008/10/25/a-many-to-many-field-template-for-dynamic-data.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/davidebb/archive/2008/10/25/a-many-to-many-field-template-for-dynamic-data.aspx</a> article which everyone refers to, but I can't see how to use the ManyToMany_Edit.ascx Field template on the Show insert page. Interestingly, in the ManyToMany_Edit.ascx.cs file that I have, there is a comment that says </p>\n\n<blockquote>\n  <p>// This field template is used both for Editing and Inserting</p>\n</blockquote>\n\n<p>But I can't see it being used for inserting!</p>\n\n<p>Any pointers would be greatly appreciated!</p>\n"},{"tags":["linq","entity-framework","linq-to-entities","entity"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13080190,"title":"Entity Frameworks: How to decrypt a field prior to OrderBy","body":"<p>I have an IQueryable list of Customer entities (EntityFrameworks).  I need to do an orderby on this IQueryable list but the issue is that the field that I want to use for ordering is encrypted in the database.  Is there any way that I can decrypt this field prior to ordering?  Can I write some kind of Linq extension for OrderBy.  Since there could be thousands of Customers, I don't want to materialize the list just so it can be sorted...</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities","linq-expressions"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":82,"score":4,"question_id":13056943,"title":"EF orderby / thenby combo extension method","body":"<p>I want to be able to apply combo <code>firstby / thenby</code> sorting as follows:</p>\n\n<pre><code>allOrders().sort(s =&gt; s.ProductName, s =&gt; s.OrderDate)\n</code></pre>\n\n<p>So using <a href=\"http://stackoverflow.com/a/5376637/1711500\">this post as inspiration</a>, I wrote this extension method, which compiles fine:</p>\n\n<pre><code>public static IQueryable&lt;T&gt; sort&lt;T&gt;(this IQueryable&lt;T&gt; entities, params \n  Expression&lt;Func&lt;T, object&gt;&gt;[] predicates) where T : class \n{\n  var sorted = entities.OrderBy(predicates[0]);\n  for (int i = 1; i &lt; predicates.Length; i++)\n    sorted = sorted.ThenBy(predicates[i]);\n\n  return sorted;\n}\n</code></pre>\n\n<p>And I also tried this succint version, which also compiles:</p>\n\n<pre><code>public static IQueryable&lt;T&gt; sort&lt;T&gt;(this IQueryable&lt;T&gt; entities, params \n  Expression&lt;Func&lt;T, object&gt;&gt;[] predicates) where T : class\n{\n  return predicates.Skip(1).Aggregate(\n    entities.OrderBy(predicates[0]),\n    (aggregate, currentPredicate) =&gt; aggregate.ThenBy(currentPredicate));\n}\n</code></pre>\n\n<p>However if I try sort by a <code>DateTime</code>, I get this exception:  </p>\n\n<blockquote>\n  <p><em>Unable to cast the type 'System.DateTime' to type 'System.Object'. LINQ to Entities only supports casting EDM primitive or enumeration types.</em></p>\n</blockquote>\n\n<p>What am I doing wrong? I am using EF5.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13077918,"title":"Updates are not factored to the database using Entity Framework","body":"<p>Following code doesn't update my database for the record found and when looking at Azure SQL Profiler I see only this update statement.</p>\n\n<pre><code>update [dbo].[Identities]\nset @p = 0\nwhere ([Id] = @0)\n</code></pre>\n\n<p>and the code:</p>\n\n<pre><code>using (var db = new context())\n{\n    var member = db.Identities.Include(\"Member\").Include(\"Roles\")\n                   .FirstOrDefault(i =&gt; id.Value == i.nameidentifier &amp;&amp; i.identityprovider == provider.Value);\n\n    if (member != null)\n    {\n        member.LastLoggedIn = DateTime.UtcNow;\n        db.SaveChanges();\n    }\n}\n</code></pre>\n"},{"tags":["c#","linq","entity-framework","generic-list"],"answer_count":1,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":102,"score":6,"question_id":13062462,"title":"Proper way to construct linq queries to achieve fastest performance?","body":"<p>Similar question have been asked here but none fits to my need.<br>\nI made test cases to see which is faster. But I feel my linq code is still slow. How do I construct the linq code for faster performance?  </p>\n\n<p>Others said using double <code>.Tolist()</code> can cause slower operation, when I test it, it shows that it is faster than any other tests.</p>\n\n<p>Test:  </p>\n\n<pre><code>Preparation\n---------------------------------------------------------------\nreturn Properties of UserInfo(userinf, true){\n    UserID = userinf.UserID;\n    FirstName = userinf.user.FirstName;\n    MiddleName = userinf.user.MiddleName;\n    LastName = userinf.user.LastName;\n    LoginID = userinf.user.LoginID;\n    Birthday = userinf.Birthday;\n}\n\nskip = 0;\ntake = 100;\n\ntotal table records = 304;\n\nLinq to Entity Framework \n</code></pre>\n\n<p>Fiddler: v2.4.0.0  </p>\n\n<pre><code>https://127.0.0.1/..../RetrieveUserInfo?skip=0&amp;take=100\n{\n    \"client\":{\n        \"SessionID\":\"5433ab64-7e0d-444f-b886-a901ea9a0601\"\n    },\n    \"session\":{\n        \"SessionID\":\"35b75daa-25ad-45a4-9f99-0e69ec3b66a4\"\n    }\n}\n</code></pre>\n\n<hr>\n\n<pre><code>//Test 1\n//1) 00:00:15.3068755 -- Attempt1\n//2) 00:00:13.8207905 -- Attempt2\n//3) 00:00:16.2489294 -- Attempt3\n\nvar list = (from usr in dbase.userinfoes\n            select usr).OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList();\n\nuserlist = (from i in list\n            select new UserInfo(i, true)).ToList();\n\n\n///Test 2\n//1) 00:00:15.3908803\n//2) 00:00:14.8818512\n//3) 00:00:19.4761140\n\nvar list = (from usr in dbase.userinfoes.AsEnumerable().OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList()\n            select new UserInfo(usr, true)).ToList();\n\n\n//Test 3\n//1) 00:00:30.1937270\n//2) 00:00:24.1003784\n//3) 00:00:28.8806519\n\nvar list = dbase.userinfoes.OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList();\nuserlist = (from i in list select new UserInfo(i, true)).ToList();\n\n\n//Test 4\n//1) 00:00:57.2652754\n//2) 00:00:54.4051118\n//3) 00:00:55.3251644\n\nvar list = (from usr in dbase.userinfoes\n            select usr).ToList();\n\nuserlist = (from i in list\n            select new UserInfo(i, true)).OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList();\n\n\n//Test 5\n//1) 00:01:06.8378229\n//2) 00:01:01.2845053\n//3) 00:00:55.0721499\n\nvar list = from usr in dbase.userinfoes\n           select usr;\n\nuserlist = (from i in list.AsEnumerable()\n            select new UserInfo(i, true)).OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList();\n\n\n// Test 6\n// VERY LONG. It tooks all records first and construct UserInfo one by one before doing the skip and take\n\nvar list = (from usr in dbase.userinfoes.AsEnumerable()\n            select new UserInfo(usr, true)).OrderBy(i =&gt; i.UserID).Skip(skip).Take(take).ToList();\n\n\n//Test 7\n// VERY LONG. It tooks all records first and construct UserInfo one by one before doing the skip and take\n\nvar list = from usr in dbase.userinfoes.AsEnumerable()\n           select new UserInfo(usr);\n</code></pre>\n\n<p>Proper code for faster search. Thanks to <code>casperOne</code> for pointing out that <strong>the ordering, skip and take are all performed on the server</strong> is more faster. </p>\n\n<p>Here is the final code:  </p>\n\n<pre><code>var list = (from usr in dbase.userinfoes\n                .OrderBy(i =&gt; i.UserID)\n                .Skip(skip)\n                .Take(take)\n                .AsEnumerable()\n            select new UserInfo(usr, true)).ToList();   \n\n1) 00:00:10.9210513\n2) 00:00:10.8270973\n3) 00:00:10.8250151\n</code></pre>\n\n<p>Thanks to <code>Richard Neil Ilagan</code> for the final code.</p>\n"},{"tags":["c#","entity-framework","find","dbcontext"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":134,"score":2,"question_id":13059548,"title":"DBContext Find with Includes - where lambda with Primary keys","body":"<p>I am writing a generic repository to interface with EF using DBContext. </p>\n\n<p>I have a generic Get() method which receives a primary key value and returns the entity:</p>\n\n<pre><code>public class DALRepository&lt;DALEntity&gt; : IDisposable, IGenericRepository&lt;DALEntity&gt; where DALEntity : class\n{\nprivate IDbSet&lt;DALEntity&gt; dbSet;\nprivate NWEntities context;\n\npublic DALRepository()\n{\n  context = new NWEntities();\n  context.Configuration.LazyLoadingEnabled = false;\n  dbSet = context.Set&lt;DALEntity&gt;();\n}\n</code></pre>\n\n<p>Here's a simple get method - just works on the PK - exactly what I want.</p>\n\n<pre><code>public DALEntity Get(string ID)\n{\n   return dbSet.Find(ID);\n}\n</code></pre>\n\n<p>I now want to change this to allow the consumer to pass in a list of includes - so as well as returning just a customer they can request to return the orders as well. Here's where I'm running into trouble. If I do this:</p>\n\n<pre><code>public DALEntity Get(string ID, IEnumerable&lt;string&gt; IncludeEntities = null)\n{\n      IQueryable&lt;DALEntity&gt; query = dbSet;\n      query = IncludeEntities.Aggregate(query, (current, includePath) =&gt; current.Include(includePath));\n}\n</code></pre>\n\n<p>I can't use find with the IQueryable.  And I can't Find() directly because I can't pass includes to it. If I use a where lambda instead on the IQueryable, how do I tell it to use the PK of the entity? I guess I could have a generic constraint that insists the generic type must implement some IPkey interface with a well-defined primary column name such as \"ID\", but then I can't use the entities generated by DBContext as they woudl have to implement this interface. I can change the T4 to do this if I need - and I've already changed it to emit XML comments so not too averse to that - but does anyone have a simpler way? I suppose what I need is an overloaded find() which accepts a list of includes.</p>\n\n<p>So my question is either how to use Find with includes, or how to write the lambda where it knows the PK? I can't receive such a lambda as a parameter as this will ultimately be consumed by a WCF service.</p>\n"},{"tags":["c#","entity-framework","insert","sql-update","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13078576,"title":"Bulk inserting and updating with Entity Framework (Probably a better alternative?)","body":"<p>I have a data set of devices, addresses, and companies that I need to import into our database, with the catch that our database may already include a specific device/address/company that is included in the new data set. If that is the case, I need to update that entry with the new information in the data set, excluding addresses. We check if an exact copy of that address exists, otherwise we make a new entry.</p>\n\n<p>My issue is that it is very slow to attempt to grab a device/company in EF and if it exist updated it, otherwise insert it. To fix this I tried to get all the companies, devices, and addresses and insert them into respective hashmaps, and check if the identifier of the new data exists in the hashmap. This hasn't led to any performance increases. I've included my code below. Typically I would do a batch insert, I'm not sure what I would do for a batch update though. Can someone advise a different route?</p>\n\n<pre><code>            var context = ObjectContextHelper.CurrentObjectContext;\n            var oldDevices = context.Devices;\n            var companies = context.Companies;\n            var addresses = context.Addresses;\n\n            Dictionary&lt;string, Company&gt; companyMap = new Dictionary&lt;string, Company&gt;(StringComparer.OrdinalIgnoreCase);\n            Dictionary&lt;string, Device&gt; deviceMap = new Dictionary&lt;string, Device&gt;(StringComparer.OrdinalIgnoreCase);\n            Dictionary&lt;string, Address&gt; addressMap = new Dictionary&lt;string, Address&gt;(StringComparer.OrdinalIgnoreCase);\n            foreach (Company c in companies)\n            {\n                if (c.CompanyAccountID != null &amp;&amp; !companyMap.ContainsKey(c.CompanyAccountID))\n                    companyMap.Add(c.CompanyAccountID, c);\n            }\n            foreach (Device d in oldDevices)\n            {\n                if (d.SerialNumber != null &amp;&amp; !deviceMap.ContainsKey(d.SerialNumber))\n                    deviceMap.Add(d.SerialNumber, d);\n            }\n            foreach (Address a in addresses)\n            {\n                string identifier = GetAddressIdentifier(a);\n                if (!addressMap.ContainsKey(identifier))\n                    addressMap.Add(identifier, a);\n            }\n\n            foreach (DeviceData.TabsDevice device in devices)\n            {\n                // update a device\n                Company tempCompany;\n                Address tempAddress;\n                Device currentDevice;\n                if (deviceMap.ContainsKey(device.SerialNumber)) //update a device\n                    deviceMap.TryGetValue(device.SerialNumber, out currentDevice);\n                else // insert a new device\n                    currentDevice = new Device();\n                currentDevice.SerialNumber = device.SerialNumber;\n                currentDevice.SerialNumberTABS = device.SerialNumberTabs;\n                currentDevice.Model = device.Model;\n                if (device.CustomerAccountID != null &amp;&amp; device.CustomerAccountID != \"\")\n                {\n                    companyMap.TryGetValue(device.CustomerAccountID, out tempCompany);\n                    currentDevice.CustomerID = tempCompany.CompanyID;\n                    currentDevice.CustomerName = tempCompany.CompanyName;\n\n                }\n                if (companyMap.TryGetValue(device.ServicingDealerAccountID, out tempCompany))\n                    currentDevice.CompanyID = tempCompany.CompanyID;\n                currentDevice.StatusID = 1;\n                currentDevice.Retries = 0;\n                currentDevice.ControllerFamilyID = 1;\n                if (currentDevice.EWBFrontPanelMsgOption == null) // set the Panel option to the default if it isn't set already\n                    currentDevice.EWBFrontPanelMsgOption = context.EWBFrontPanelMsgOptions.Where( i =&gt; i.OptionDescription.Contains(\"default\")).Single();\n                // link the device to the existing address as long as it is actually an address\n                if (addressMap.TryGetValue(GetAddressIdentifier(device.address), out tempAddress))\n                {\n                    if (GetAddressIdentifier(device.address) != \"\")\n                        currentDevice.Address = tempAddress;\n                    else\n                        currentDevice.Address = null;\n                }\n                else // insert a new Address and link the device to it (if not null)\n                {\n                    if (GetAddressIdentifier(device.address) == \"\")\n                        currentDevice.Address = null;\n                    else\n                    {\n                        tempAddress = new Address();\n                        tempAddress.Address1 = device.address.Address1;\n                        tempAddress.Address2 = device.address.Address2;\n                        tempAddress.Address3 = device.address.Address3;\n                        tempAddress.Address4 = device.address.Address4;\n                        tempAddress.City = device.address.City;\n                        tempAddress.Country = device.address.Country;\n                        tempAddress.PostalCode = device.address.PostalCode;\n                        tempAddress.State = device.address.State;\n                        addresses.AddObject(tempAddress);\n                        addressMap.Add(GetAddressIdentifier(tempAddress), tempAddress);\n                        currentDevice.Address = tempAddress;\n                    }\n                }\n                if (!deviceMap.ContainsKey(device.SerialNumber)) // if inserting, add to context\n                {\n                    oldDevices.AddObject(currentDevice);\n                    deviceMap.Add(device.SerialNumber, currentDevice);\n                }\n            }\n            context.SaveChanges();\n</code></pre>\n"},{"tags":["sql","entity-framework","application-role"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":34,"score":3,"question_id":13048888,"title":"how to enable SQL Application Role via Entity Framework","body":"<p>I'm now developing big government application with entity framework. at first i have one problem about enable SQL application role. with ado.net I'm using below code:</p>\n\n<pre><code>SqlCommand cmd = new SqlCommand(\"sys.sp_setapprole\");\n            cmd.CommandType = CommandType.StoredProcedure;\n            cmd.Connection = _sqlConn;\n            SqlParameter paramAppRoleName = new SqlParameter();\n            paramAppRoleName.Direction = ParameterDirection.Input;\n            paramAppRoleName.ParameterName = \"@rolename\";\n            paramAppRoleName.Value = \"AppRole\";\n            cmd.Parameters.Add(paramAppRoleName);\n\n            SqlParameter paramAppRolePwd = new SqlParameter();\n            paramAppRolePwd.Direction = ParameterDirection.Input;\n            paramAppRolePwd.ParameterName = \"@password\";\n            paramAppRolePwd.Value = \"123456\";\n            cmd.Parameters.Add(paramAppRolePwd);\n\n            SqlParameter paramCreateCookie = new SqlParameter();\n            paramCreateCookie.Direction = ParameterDirection.Input;\n            paramCreateCookie.ParameterName = \"@fCreateCookie\";\n            paramCreateCookie.DbType = DbType.Boolean;\n            paramCreateCookie.Value = 1;\n            cmd.Parameters.Add(paramCreateCookie);\n\n            SqlParameter paramEncrypt = new SqlParameter();\n            paramEncrypt.Direction = ParameterDirection.Input;\n            paramEncrypt.ParameterName = \"@encrypt\";\n            paramEncrypt.Value = \"none\";\n            cmd.Parameters.Add(paramEncrypt);\n\n            SqlParameter paramEnableCookie = new SqlParameter();\n            paramEnableCookie.ParameterName = \"@cookie\";\n            paramEnableCookie.DbType = DbType.Binary;\n            paramEnableCookie.Direction = ParameterDirection.Output;\n            paramEnableCookie.Size = 1000;\n            cmd.Parameters.Add(paramEnableCookie);\n\n            try\n            {\n                cmd.ExecuteNonQuery();\n                SqlParameter outVal = cmd.Parameters[\"@cookie\"];\n                // Store the enabled cookie so that approle  can be disabled with the cookie.\n                _appRoleEnableCookie = (byte[]) outVal.Value;\n\n            }\n            catch (Exception ex)\n            {\n                result = false;\n                msg = \"Could not execute enable approle proc.\" + Environment.NewLine + ex.Message;\n            }\n</code></pre>\n\n<p>But no matter how much I searched I could not find a way to implement on EF.</p>\n\n<p>my another question is: how to Add Application Role to Entity data model designer???</p>\n"},{"tags":["asp.net","entity-framework","connection-string","data-access-layer","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":13031965,"title":"No context type was found in the assembly","body":"<p>I'm using .NET 4.0, MVC3, and EF5 with code first.</p>\n\n<p>My project is split up into three layers, with the dependencies as indicated:</p>\n\n<p>Project.Web -> Project.BLL -> Project.DAL</p>\n\n<p>The Project.DAL layer contains my entity framework data context class and all my entities, but  my startup project is Project.Web, so it contains my Web.config, connection strings, and the actual SQL compact database.</p>\n\n<p>I'm trying to enable migrations so I can add a new table to my EF model without wiping the existing data. However, when I run \"Enable-Migrations\", I get</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>No context type was found in the assembly 'Project.Web'.\n</code></pre>\n\n<p>If I set the startup project as Project.DAL, the error changes to</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Could not load assembly 'Project.Web'. (If you are using Code First Migrations inside Visual Studio this can happen if the startUp project for your solution does not reference the project that contains your migrations. You can either change the startUp project for your solution or use the -StartUpProjectName parameter.)\n</code></pre>\n\n<p>Does anyone know why this error is being caused or what I can do to fix it?</p>\n"}]}
{"total":18927,"page":6,"pagesize":100,"questions":[{"tags":["vb.net","oracle","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13067511,"title":"How to get the Trigger value By method SaveChange In VB MVC?","body":"<p>I used SaveChange Function to save my data and Trigger In Oracle to create a new ID of data when i insert and how can i get this ID from Trigger in MVC3 ? Thx so much</p>\n"},{"tags":["c#","sql-server","linq","entity-framework","date"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13076094,"title":"How to query a date range from a varchar column using LINQ","body":"<p>I have inherited a large SQL Server database that has a certain table that has a certain date column that is a varchar(8) datatype in the <strong>yyyyMMdd</strong> date string format. Why it isn't a datetime datatype or something similar is beyond me. (maybe to save space? Legacy db ported to SQL Server long ago?)</p>\n\n<p>Withouting getting too flustered over the date wanna-be field, grabbing rows using a single date from this column is pretty straight forward using the Entity Framework (DBContext w/LINQ) as shown below:</p>\n\n<pre><code>var rows = cxt.TableOfRandomDateColumn.Where(x =&gt; x.Date == myDateStr).ToList();\n</code></pre>\n\n<p>That's about as easy as it gets. However, what if I wanted to grab a range of dates from this column? What would be the best way to go about doing something like that?</p>\n"},{"tags":["vb.net","entity-framework","ef-code-first","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13075344,"title":"EF 5.0 - Can't make bi-directional relationship work with Code First","body":"<p>I have a class called WidgetCollection.  It has an Items property exposing a List(Of Widget) and a SelectedWidget property.  I would expect EF to build the database as follows:</p>\n\n<ul>\n<li>Add a WidgetCollection_Id property in my Widgets table, specifying\nwhich WidgetCollection each widget is in</li>\n<li>Add a SelectedWidget_Id property in my WidgetCollection table, specifying which of the\nWidgets is selected</li>\n<li>Add a 1-to-many relationship from WidgetCollection.Id to Widget.WidgetCollection_Id</li>\n<li>Add a 1-to-0-or-1 relationship from Widget.Id to WidgetCollection.SelectedWidget_Id</li>\n</ul>\n\n<p>I can confirm that it does appear to build the database schema correctly, however I get the following error if I ever save the context after assigning to SelectedWidget:</p>\n\n<blockquote>\n  <p>System.Data.Entity.Infrastructure.DbUpdateException occurred\n    HResult=-2146233087\n    Message=An error occurred while saving entities that do not expose foreign key > properties for their relationships. The EntityEntries property will return null because a single entity cannot be identified as the source of the exception. Handling of exceptions while saving can be made easier by exposing foreign key properties in your entity types. </p>\n</blockquote>\n\n<p>With an inner exception of</p>\n\n<blockquote>\n  <p>Unable to determine a valid ordering for dependent operations. Dependencies may exist due to foreign key constraints, model requirements, or store-generated values.</p>\n</blockquote>\n\n<p>I can prevent this error by never assigning WidgetCollect.SelectedWidget.</p>\n\n<p>I guess the problem is that EF can't work out what to do with relationships in both directions, but I just can't find a way to point it in the right direction.  Example code follows, all suggestions welcome!</p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>Public Class Widget\n    Private miId As Integer\n    Public Property Id As Integer\n        Get\n            Return miId\n        End Get\n        Set(value As Integer)\n            miId = value\n        End Set\n    End Property\n\n    Private msName As String\n    Public Property Name As String\n        Get\n            Return msName\n        End Get\n        Set(value As String)\n            msName = value\n        End Set\n    End Property\nEnd Class\nPublic Class WidgetCollection\n    Private miId As Integer\n    Public Property Id As Integer\n        Get\n            Return miId\n        End Get\n        Set(value As Integer)\n            miId = value\n        End Set\n    End Property\n\n\n    Private msName As String\n    Public Property Name As String\n        Get\n            Return msName\n        End Get\n        Set(value As String)\n            msName = value\n        End Set\n    End Property\n\n    Private moSelectedWidget\n    Public Property SelectedWidget As Widget\n        Get\n            Return moSelectedWidget\n        End Get\n        Set(value As Widget)\n            moSelectedWidget = value\n        End Set\n    End Property\n\n    Private moWidgets As New List(Of Widget)\n    Public Property Widgets As List(Of Widget)\n        Get\n            Return moWidgets\n        End Get\n        Set(value As List(Of Widget))\n            moWidgets = value\n        End Set\n    End Property\n\nEnd Class\n\nPublic Class MyContext\n    Inherits DbContext\n    Public Property Widgets As DbSet(Of Widget)\n    Public Property WidgetCollections As DbSet(Of WidgetCollection)\nEnd Class\n\nClass Application\n    Public Sub New()\n        Database.DefaultConnectionFactory = New SqlCeConnectionFactory(\"System.Data.SqlServerCe.4.0\", \"\", \"Data Source=\\EFtest.sdf\")\n        Database.SetInitializer(New DropCreateDatabaseIfModelChanges(Of MyContext))\n        Dim oContext = New MyContext\n\n        Dim oWidgetA = New Widget With {.Name = \"Widget A\"}\n        Dim oWidgetB = New Widget With {.Name = \"Widget A\"}\n        Dim oWidgetCollection = New WidgetCollection With {.Name = \"My widget collection\"}\n        oWidgetCollection.Widgets.Add(oWidgetA)\n        oWidgetCollection.Widgets.Add(oWidgetB)\n        oWidgetCollection.SelectedWidget = oWidgetA  'Removing this line prevents error\n\n        oContext.WidgetCollections.Add(oWidgetCollection)\n        oContext.SaveChanges()\n    End Sub\nEnd Class\n</code></pre>\n"},{"tags":[".net","entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13073221,"title":"EF SaveChanges not calling Validate (IValidatableObject)","body":"<p>By default, EF uses EntityObject when generating the objects. I've modified it to use my own AbstractEntityObject class. In doing so, I've added IValidatableObject as I was under the impression when you called context.SaveChanges() it would automatically call Validate and throw the exceptions.</p>\n\n<p>Here is what I have:</p>\n\n<pre><code>public abstract class AbstractEntityObject : EntityObject, IValidatableObject\n{\n    private readonly DBTable table;\n\n    protected AbstractEntityObject(DBTable table)\n    {\n        this.table = table;\n    }\n\n    public IEnumerable&lt;ValidationResult&gt; Validate(ValidationContext validationContext)\n    {\n        List&lt;OITValidationResult&gt; results = new List&lt;OITValidationResult&gt;();\n        List&lt;PropertyInfo&gt; properties = new List&lt;PropertyInfo&gt;(GetType().GetProperties());\n\n        foreach (DBField field in table.GetFields())\n        {\n            foreach (PropertyInfo prop in properties)\n                if (StringUtilities.EqualsIgnoreCase(field.FieldName, prop.Name))\n                {\n                    results.AddRange(field.Validate(prop.GetValue(this, null)));\n                    results.AddRange(AdditionalValidation(field, prop));\n                    properties.Remove(prop);\n                    break;\n                }\n        }\n\n        return results;\n    }\n\n    public abstract List&lt;OITValidationResult&gt; AdditionalValidation(DBField field, PropertyInfo prop);\n}\n\npublic abstract class AbstractTLMSEntityObject : AbstractEntityObject\n{\n    protected AbstractTLMSEntityObject(DBTable table) \n        : base(table)\n    {\n    }\n\n    public override List&lt;OITValidationResult&gt; AdditionalValidation(DBField field, PropertyInfo prop)\n    {\n        List&lt;OITValidationResult&gt; results = new List&lt;OITValidationResult&gt;();\n\n        if (!EntityState.Equals(EntityState.Unchanged))\n        {\n            if (StringUtilities.EqualsIgnoreCase(field.FieldName, \"userid\"))\n                prop.SetValue(this, TLMSDB.User.UserName, null);\n            else if (StringUtilities.EqualsIgnoreCase(prop.Name, \"dtmod\"))\n                prop.SetValue(this, DateTime.Now, null);\n        }\n\n        OITValidationResult additionalResult = AdditionalValidation(field.Field);\n        if (additionalResult != null)\n            results.Add(additionalResult);\n\n        return results;\n    }\n\n    /* By default there is no additional validation, subclasses should override this if they need additional validation */\n    public virtual OITValidationResult AdditionalValidation(Enum field)\n    {\n        return null;\n    }\n}\n</code></pre>\n\n<p>Then, I have the subclass, which is a partial class along with the one that EF creates:</p>\n\n<pre><code>public partial class CSDCrud\n{\n    public enum Fields\n    {\n        RECEIPT_NUMBER,\n        GRANT_ID,\n        GRANT_FUND,\n        TOTAL_ACRES\n    }\n\n    public CSDCrud() : base(CSDCrudDAO.Instance.Table)\n    {\n    }\n\n    public static String GetDataPropertyName(Enum field)\n    {\n        return CSDCrudDAO.Instance.Table.GetField(field).FieldName;\n    }\n}\n</code></pre>\n\n<p>CSDCrud inherits from AbstractTLMSEntityObject thanks to me changing that in the .tt file.</p>\n\n<p>Now here is where it gets weird. I have set it up so the DBField (referenced in the parent class) does self validation of the data. In this case, I have set it up so if receipt_number is required and thus will fail and throw an exception...In fact, the following occurs...</p>\n\n<pre><code>List&lt;OITValidationResult&gt; results = (List&lt;OITValidationResult&gt;)crudObject.Validate(null);\ntry\n{\n    CommonEntityManager.GetContext().CrudSet.AddObject(crudObject);\n    CommonEntityManager.GetContext().SaveChanges();\n    return true;\n}\ncatch (Exception ex)\n{\n    return false;\n}\n</code></pre>\n\n<p>As expected, results contains 1 item which is the proper error...however the SaveChanges saves it out just fine, without throwing an exception...what am I missing?</p>\n\n<p>edit: I should note, obviously I can use the SavingChanges event to add in my own handler, but I'm hoping to use the pre-existing infrastructure.</p>\n\n<pre><code>static void context_SavingChanges(object sender, EventArgs e)\n    {\n        foreach (ObjectStateEntry ose in context.ObjectStateManager.GetObjectStateEntries(EntityState.Modified))\n        {\n            List&lt;ValidationResult&gt; results = new List&lt;ValidationResult&gt;(((IValidatableObject)ose.Entity).Validate(null));\n            if (results.Count &gt; 0)\n                throw new CustomException(results);\n        }\n\n        foreach (ObjectStateEntry ose in context.ObjectStateManager.GetObjectStateEntries(EntityState.Added))\n        {\n            List&lt;ValidationResult&gt; results = new List&lt;ValidationResult&gt;(((IValidatableObject)ose.Entity).Validate(null));\n            if (results.Count &gt; 0)\n                throw new CustomException(results);\n        }\n    }\n</code></pre>\n"},{"tags":["sql-server","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":85,"score":3,"question_id":13035353,"title":"Using SQL Server named parameters with ExecuteStoreQuery and ExecuteStoreCommand","body":"<p>I am trying to use SQL Server named parameters with <code>ObjectContext.ExecuteStoreQuery</code> and <code>ObjectContext.ExecuteStoreCommand</code> when calling a stored procedure or a function directly.</p>\n\n<p>SQL Server named parameters are not the same with the Entity Framework named parameters - they allow me to execute a query similar with this one:</p>\n\n<pre><code>EXEC sp_GetData @firstParameter = 1, @thirdParameter = 2, @secondParameter = 1\n</code></pre>\n\n<p>The order of the parameters in this query does not matter as opposed with Entity Framework named parameters that are evaluated in order.</p>\n\n<p>I want to use SQL Server named parameters with Entity Framework so that if the order of the parameters is changed in the stored procedure the Entity Framework code calling it is not affected.</p>\n"},{"tags":["entity-framework","dbcontext","objectcontext"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13074468,"title":"How do I stop Entity Framework from generating BOTH ObjectContext and dbContext","body":"<h2>Background</h2>\n\n<ul>\n<li>Visual Studio 2012</li>\n<li>NEW Model.EDMX file created in VS2012</li>\n<li>Copied some of the EDMX xml from a previously created EDMX into the new one</li>\n</ul>\n\n<h2>Problem / Question</h2>\n\n<p>Now.  The EDMX (TT transform, custom tool, whatever, etc.) is generating BOTH DbContext classes (under the Model.tt/Model.Context.tt files) <em>and</em> ObjectContext classes (via the Model.designer.cs file).  See image below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/lr7gH.png\" alt=\"Both the Model.tt AND the Designer.cs files are defining my entities\"></p>\n\n<p>Everything builds fine and works with the DbContext (but obviously only if I delete the Designer.cs file just before building) but the Designer.cs - and its ObjectContext-based code - keeps reappearing.  How do I stop this behavior?!</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":49,"score":5,"question_id":13072304,"title":"Is it possible to test whether a given expression can be converted to SQL *without* connecting to a SQL database?","body":"<p>For example:-</p>\n\n<pre><code>// This one will be converted to SQL no problem\nExpression&lt;Func&lt;Foo, bool&gt;&gt; predicate = x =&gt; x.Name = \"Foo\";\n\n// This one will throw a NotSupportedException because the QueryProvider\n// doesn't support reference comparisons\nExpression&lt;Func&lt;Foo, bool&gt;&gt; predicate = x =&gt; x == someOtherFoo;\n\n// This one doesn't work because the query provider can't\n// handle IsAwesome()\nExpression&lt;Func&lt;Foo, bool&gt;&gt; predicate = x =&gt; x.IsAwesome();\n</code></pre>\n\n<p>I'm looking for a way to test this before runtime, ideally in an automated test isolated from the database.</p>\n\n<p>I spent some time trawling through MSDN trying to find how to instantiate my own QueryProvider, but my Google-fu appears to be failing me today.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["entity-framework","sql-server-ce"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2145,"score":1,"question_id":3674302,"title":"Can Entity Framework be used to generate SQL Server Compact database","body":"<p>I created a project as described <a href=\"http://technet.microsoft.com/en-us/library/cc835495%28SQL.100%29.aspx\" rel=\"nofollow\">here</a> using Visual Studio 2010 and .NET 4 (Win7/x64). Once I've change the platform target to 'Any CPU' the sample project works. However, if try to generate a model from entity data model (right-click the model and select 'Generate Database from Model'), I get the following error.</p>\n\n<p><em>Could not find the appropriate DbProviderManifest to generate the SSDL. The supplied provider invariant name 'System.Data.SqlServerCe.3.5' is not valid.</em></p>\n\n<p>I have a reference to System.Data.SqlServerCe on my project.</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":111,"score":3,"question_id":13007540,"title":"How to track changes of collections","body":"<p>I have a class that contains objects of another class:</p>\n\n<pre><code>public class Container\n{\n    public BindingList&lt;Item&gt; Items { get; set; }\n}\npublic class Item\n{\n    ...\n}\n</code></pre>\n\n<p>Objects of the <code>Container</code> are attached to a <code>DbContext</code>. I want to override the <code>DbContext's</code> <code>SaveChanges()</code> to send all changes via a WCF service.</p>\n\n<p>Primitive attributes are no problem. They are reflected in the <code>Entries</code>. But if the relationship between an <code>Item</code> and its <code>Container</code> changes (e.g. a new item is added or an existing item is deleted) there is no entry about that in the ChangeTracker.</p>\n\n<p>I could add a <code>ForeignKey</code> in the Item class to force a <code>Modified</code> entry, but this does not help me much, because I need to know the containing object.</p>\n\n<p>I also tried to convert the <code>DbContext</code> to <code>ObjectContext</code> to get all related items of an entity. But I see no way to get the actual object of a <code>RelatedEnd</code>.</p>\n\n<p>Is there a way to track changes of the contained collection?</p>\n\n<h2>Update</h2>\n\n<p>As requested, some code I already have:</p>\n\n<pre><code>//In a DbContext subclass\npublic override int SaveChanges()\n{\n    //get all modified entities\n    var changes = this.ChangeTracker.Entries();\n    foreach (var c in changes)\n    {\n        //check the state of the entity\n        switch (c.State)\n        {\n            //send according WCF callback to the clients\n            case System.Data.EntityState.Added:\n                App.Current.ServerManager.SendEvent(s =&gt; s.EntityAdded((IIdentifiable)c.Entity), causedBy);\n                break;\n            ...\n        }\n    }\n    return base.SaveChanges();\n}\n</code></pre>\n\n<p>With this code, I cannot detect changes of the <code>Items</code> collection.</p>\n"},{"tags":["sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13070365,"title":"Calling .Remove() is executing an UPDATE statement instead of a DELETE and results in error: \"Cannot insert value NULL into column\"","body":"<p>Here is the snippet of code where I am deleting my object:</p>\n\n<pre><code>var foo = this.repository.GetFoo();\n\nforeach (var item in foo.RelatedItems.ToList()) {\n    if (x == y) {\n        //Update happens here; this isn't executing however.\n    } else {\n        //This code block is executed; this is where I am telling the context to mark this object for deletion.\n        foo.RelatedItems.Remove(item);\n    }\n}\n\nthis.repository.Save();\n</code></pre>\n\n<p>When the <code>.Save()</code> is called, I am getting an error:  \"Cannot insert value NULL into column\".  I used the profiler to see what SQL was actually getting executed and it was:</p>\n\n<pre><code>update dbo.RelatedItems\nset foreignKey = null\nwhere id = X\n</code></pre>\n\n<p>I would expect a delete statement to be executed here, but, for some reason it's trying to update the record by setting the foreign key to null.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I added the following code to my repository class to solve the issue:</p>\n\n<pre><code>public void DeleteItem(Item item) {\n    context.Entry(item).State = System.Data.EntityState.Deleted;\n}\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first","asp.net-mvc-4","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":103,"score":3,"question_id":13070431,"title":"Unique Constraint with Entity Framework using Code First Migrations","body":"<p>I am doing entity framework (v 5) code first migrations, on an MVC 4 application. I would like to add a unique constraint at the database level. </p>\n\n<p>I know this can be done when creating the table, but I already have a table.\n<a href=\"http://msdn.microsoft.com/en-US/data/jj591621\" rel=\"nofollow\">http://msdn.microsoft.com/en-US/data/jj591621</a></p>\n\n<p>I have tried the following, marked as answer answer: <a href=\"http://stackoverflow.com/questions/6727738/unique-constraint-with-efcodefirst-and-sqlce4\">Unique constraint with EFCodeFirst and SqlCe4</a></p>\n\n<p>My database context differes slightly, I supply the connection name is as follows</p>\n\n<pre><code>public AppDatabaseContext() : base(\"MyConnectionDBContext\")\n</code></pre>\n\n<p>When I use the Package Management Console to update the database, the overridden seed method is not called:</p>\n\n<pre><code>protected override void Seed(AppDatabaseContext context)\n</code></pre>\n\n<p>I have also tried the following: <a href=\"http://romiller.com/2010/07/31/ef-ctp4-tips-tricks-running-additional-ddl/\" rel=\"nofollow\">http://romiller.com/2010/07/31/ef-ctp4-tips-tricks-running-additional-ddl/</a></p>\n\n<p>I did not use a nested class, this is because it seemed as if I had to registere the initializer via the app.config. I could not get it working while initializing it in code. The InitializeDatabase is called, but the following condition is never true:</p>\n\n<pre><code>(!context.Database.Exists() || !context.Database.ModelMatchesDatabase())\n</code></pre>\n\n<p>This is because this happens after the migrations have been run...</p>\n\n<p>I also tried this at one stage: <a href=\"http://stackoverflow.com/questions/4413084/unique-constraint-in-entity-framework-code-first\">Unique Constraint in Entity Framework Code First</a>, it was the same problem as before, this condition was never returning true.</p>\n\n<p>Ideally, I would like to include some standard SQL in my migration file. Is there a way to do that? If not, where can I see how to achieve this with using code first migrations?</p>\n\n<p>Thanks!</p>\n\n<p>UPDATE:</p>\n\n<p>Is there any reason why I can't use the SQL function? </p>\n\n<pre><code> public override void Up()\n {\n        AddColumn(\"Posts\", \"Abstract\", c =&gt; c.String());\n\n        Sql(\"UPDATE Posts SET Abstract = LEFT(Content, 100) WHERE Abstract IS NULL\");\n }\n</code></pre>\n\n<p>Obviously using the correct SQL...</p>\n"},{"tags":["c#","silverlight","entity-framework","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":11888372,"title":"Alternative to Interface w/ Ria Services","body":"<p>All of my Entities will have the following properties:</p>\n\n<pre><code>Employee CreatedBy { get; set; }\nEmployee ModifiedBy { get; set; }\nDateTime CreatedDate { get; set; }\nDateTime ModifiedDate { get; set; }\n</code></pre>\n\n<p>This is for a very large application and the entities are all pulled from different databases and, therefore, are in different <code>.edmx</code> files.</p>\n\n<p>Mostly, these will be displayed in a <code>DataGrid</code> and I want to have a tooltip display all of that information.  <code>Employee</code> is a View that is in every database.</p>\n\n<p>What I would normally do, would be to create an interface <code>IEmployee</code> that the <code>Employee</code> entity from each namespace would implement.  Then I would create an <code>IToolTipEnabled</code> interface with the properties listed above, and I would implement that wherever needed.</p>\n\n<p>Then, I would be able to use a single converter on the Silverlight side for the tooltip content.  As it is, I would have to basically create a new converter for each entity type, in order to get the cast right.</p>\n\n<p><strong>Is there a good way to do this?</strong></p>\n\n<p>Thanks for taking the time to read this and for any help/insight you might be able to provide!</p>\n\n<p><strong>EDIT: ken2k's solution is definitely the correct one, simply place the interfaces in a '.shared.cs' file and in that same shared file (or another <em>shared</em> file) put partial class definitions of the class implementing the interface.  That's all it takes.</strong></p>\n"},{"tags":["c#","wpf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13069597,"title":"Entity framework query completed event","body":"<p>So my Question is: Is there a Query completed event???</p>\n\n<p>I am using entity framework in order to query some data from a database and display it in a WPF application. My problem is that rendering finishes before entity framework has received the results from the database server, thus my list of data on the UI remains empty. In contrast if I enter debug mode and just wait a little before moving on to list the data, the query finishes and the data gets \nlisted.</p>\n\n<p>How should I approach this Problem??</p>\n\n<p><strong>EDIT:</strong>\nHere is my code:</p>\n\n<pre><code>public class DatabaseModel : DbContext, INotifyPropertyChanged\n    {\n        public ObservableCollection&lt;Employee&gt; observableCollection;\n        public event PropertyChangedEventHandler PropertyChanged;\n\n        public DbSet&lt;Employee&gt; Employees { get; set; }\n        public ObservableCollection&lt;Employee&gt; ObservableEmployees\n        {\n            get\n            {\n                return observableCollection;\n            }\n            set\n            {\n                observableCollection = value;\n                OnPropertyChanged(\"ObservableEmployees\");\n            }\n        }\n\n        public DatabaseModel()\n        {\n            ObservableEmployees = Employees.Local;\n        }\n\n        // Create the OnPropertyChanged method to raise the event \n        protected void OnPropertyChanged(string name)\n        {\n            PropertyChangedEventHandler handler = PropertyChanged;\n            if (handler != null)\n            {\n                handler(this, new PropertyChangedEventArgs(name));\n            }\n        }\n    }\n</code></pre>\n\n<p>And how I use My DataBinding through WPF:\nin App.Xaml I define an Instance of this Class...</p>\n\n<pre><code>&lt;Application.Resources&gt;\n        &lt;local_database:DatabaseModel x:Key=\"DatabaseInstance\"/&gt;\n&lt;/Application.Resources&gt;\n</code></pre>\n\n<p>And using the data in Mainwindow.XAML</p>\n\n<pre><code>&lt;ListBox ItemsSource=\"{Binding Source={StaticResource DatabaseInstance}, Path=ObservableEmployees, NotifyOnSourceUpdated=True}\" \n                             DisplayMemberPath=\"Name\"\n                             Binding.SourceUpdated=\"ListBox_SourceUpdated\"&gt;\n                    &lt;/ListBox&gt;\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13069612,"title":"Entity Framework Query Execution Results","body":"<p>We are contemplating the use of Entity Framework for a bulk upload job. Because we are interested in tracking the individual results of each recorded, I am trying to find out whether all items inserted are done as part of a transaction and if a single failure would cause a rollback, or if there is a way to track the result of each individual result.</p>\n\n<p>I was contemplating just looping through the items and calling Save() on each and wrapping that in a try/catch block, but just calling save() on the context seems more effective if I can tap into the individual results.</p>\n\n<p>Thanks!</p>\n"},{"tags":["entity-framework","entity-framework-4.1","ef-code-first","key","unique"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":688,"score":1,"question_id":7306356,"title":"How to add unique non primary-key field to entity using Entity Framework 4.1?","body":"<p>We are using Entity Framework 4.1 Code first.</p>\n\n<p>We've got user entity with primary key set to <code>UserId</code> and need <code>UserLogin</code> to be unique. How can it be done?</p>\n"},{"tags":["database","entity-framework","database-design","orm","mapping"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":13020230,"title":"Mapping 3 tables relation to single entity. ORM best practices?","body":"<p>after several attempts and some searching I finally decided to try it here.</p>\n\n<p>Short story: <strong>I have created quite a 'normalized' database design for content management system application and now I am trying to map it to EF entities.</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/SxOek.png\" alt=\"enter image description here\"></p>\n\n<p>I have M:N relationship between Pages and their content (ContentVersion table) - connected by table Content. This is because the application is multilingual and I am going to store recent history of content edits.</p>\n\n<p>Now, I could just create DbContext from my db, scaffold few controllers and have a solid base, but there would be a problem with that. When I would try to create new Page, I would be allowed to basically enter just a Title and Slug, but there would be no content for that page. I can of course connect that somehow with other entities and make some hierarchical business logic that would be updating several entities every time, but I first wanted to try a bit more abstract approach.</p>\n\n<p><strong>I think I basically need entity splitting over 3 related tables.</strong> I want to create an entity (let's call it FinalPage), that could be used to work with page as one piece -> use it to scaffold controllers etc.</p>\n\n<p>FinalPage is something that user fills up when creating a new Page, so it would contain:</p>\n\n<p><strong>Title</strong> (from Page entity)<br>\n<strong>Slug</strong> (from Page entity)<br>\n<strong>TemplateId</strong> (from Page entity)<br>\n<strong>LanguageId</strong> (from Content entity)<br>\n<strong>Title</strong> (from ContentVersion entity)<br>\n<strong>Body</strong> (from ContentVersion entity)<br>\n+ other related fields from ContentVersion entity</p>\n\n<p>When I would generate 'create new' page for it, I would fill everything and everything would get saved into appropriate tables.</p>\n\n<p>I tried creating new entity in my entity model, mapping properties to different tables.. tried several approaches, but never got working solution. Mostly because of typical 'you need to map every key' error. I was checking <a href=\"http://www.robbagby.com/entity-framework/entity-framework-modeling-entity-splitting/\" rel=\"nofollow\">this post from Rob Bagby</a>, but he was connecting just two tables, that shared same key. </p>\n\n<p>I also tried something what felt really silly... creating entity (entA) from Page and Content entities - connected by PageId property. And creating second one (entB) from Content and ContentVersion - connected by ContentId. Then I wanted to create third (entC) that would connect entA and entB. That also didn't work (and I am actually glad, because that would be really weird solution).</p>\n\n<p>I feel like I am:<br>\na.) Missing something obvious.<br>\nb.) Having a bad database design.<br>\nc.) Wanting too much from EF.</p>\n\n<p><strong>Any help is welcomed.<br>\n - If you see something terrible in the database design, please let me\n   know.<br>\n - If you know, how to achieve my goal, please share.<br>\n - If you have experience with this type of apps and have better solution,\n   I would like to hear about it.</strong></p>\n\n<p>I am also basically looking for some best-practices.</p>\n"},{"tags":["entity-framework","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13054088,"title":"Entity Framework Function Import Trims Leading Zeros From String","body":"<p>I have a funny issue with Entity Framework function import. I am importing a stored procedure from MS SQL Server 2008 R2, and it returns just one string. However, it is too complex for EF to infer this return type, so when defining function import I had to manually specify that the function returns a collection of scalars (<code>ObjectResult&lt;global::System.String&gt;</code>, as was generated).</p>\n\n<p>Sometimes, the procedure returns a string containing only digits and starting with zero (e.g., <code>01234</code>). When I access this result in the code, it turns out to be without the starting zero (<code>1234</code>)!</p>\n\n<p>I know several workarounds, so it is not a question. I want to understand what's going on.</p>\n\n<p>My wild guess is that in my case - when SP is too complex to \"predict\" its result - EF first tries to \"guess\" the type of the returned data by the format of that data. I.e., it sees a number (<code>01234</code>), and converts it into integer type (<code>int</code>, <code>short</code> - whatever). Then it sees that I want a <code>string</code>, and converts this number back into <code>string</code>, but of course during these conversions starting zero is lost. Is that true, or is there a better explanation?</p>\n\n<p>UPDATE: This is a screenshot for function import:</p>\n\n<p><img src=\"http://i.stack.imgur.com/ZHdcm.png\" alt=\"Function Import\"></p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13067288,"title":"Entity Framework Required Foreign Key = validation error on db.SaveChanges","body":"<p>I have these classes for my Company Entity </p>\n\n<pre><code>    public class Company\n    {\n        public Company()\n        {\n            this.Users = new HashSet&lt;User&gt;();\n            this.Tools = new HashSet&lt;Tool&gt;();\n        }\n\n        public int Id { get; set; }\n        public string Name { get; set; }\n        public string Address { get; set; }\n\n        public virtual ICollection&lt;User&gt; Users { get; set; }\n        public virtual ICollection&lt;Tool&gt; Tools { get; set; }\n        [Required]\n        public virtual CompanyGroup CompanyGroup { get; set; }\n    }\n\n    public class CompanyDto\n    {\n        public string Name { get; set; }\n        public string Address { get; set; }\n    }\n</code></pre>\n\n<p>in the CompaniesController i've added an additional class with the Id parameter for usage in edit/update methods like this</p>\n\n<pre><code>    public class CompanyViewEditModel : CompanyDto {\n        public int Id { get; set; }\n    }\n</code></pre>\n\n<p>The Edit Method looks like that:</p>\n\n<pre><code>        [HttpPost]\n        public ActionResult Edit(CompanyViewEditModel companyViewModel)\n        {\n            if (ModelState.IsValid)\n            {\n                var company = db.Companies.Find(companyViewModel.Id);\n                company.InjectFrom(companyViewModel);\n                db.Entry(company).State = EntityState.Modified;\n                db.SaveChanges();\n                return RedirectToAction(\"Index\");\n            }\n            return View(companyViewModel);\n        }\n</code></pre>\n\n<p>The InjectFrom Method is from ValueInjecter.</p>\n\n<p>Everything works as expected only the db.SaveChanges call fails, because of an validation exception. With some digging in the exceptionI've found out that he thinks the company is invalid because the field CompanyGroup is required but if i take a debugger look at the company variable even after the InjectFrom call everything seems to be fine. The corresponding company group is there.</p>\n"},{"tags":["entity-framework","c#-4.0","asp.net-mvc-4","objectstatemanager"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13063576,"title":"optimistic concurrency exception was handled by the user code","body":"<p>I'm using MVC4 with Entity Framework 4.1.</p>\n\n<p>Initially we have created an Ado.net entity model from database. In the .edmx file, some of the tables that are in the database are not visible as they dont posses the primary key on particular table.</p>\n\n<p>As our project is moving forward, we need to update to one of the log tables which dont have a primary key field.</p>\n\n<p>So, we modified our .edmx file instead of modifying in the database. our client asked us not to modify the database fields. we have modified the .edmx and created a pk on one of the exisiting field in the table(say <code>tbl_log</code> table).</p>\n\n<p>we are trying to update the tbl_log. But it gives an error message as <code>Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.</code></p>\n\n<p>I've seen much of questions in stack overflow and also googled a bit, but could not find any solution.</p>\n\n<p>Even i've tried refreshing the ObjectStateManager entries but it still points to the same error.</p>\n\n<p>Here is my code</p>\n\n<pre><code>    tbl_log log = new tbl_log();\n\n                    Entity.ObjectStateManager.GetObjectStateEntries(System.Data.EntityState.Modified);\n\n    log.LoginId = strLoginId;\n    log.Password = strPassword;\n    log.IPAddress = strIpAddress;\n    log.Date_Time = DateTime.Parse(DateTime.Now.ToString());\n    log.sessionId = new Guid(strSessionId);\n\n    Entity.AddTotbl_log(log);\n\nEntity.SaveChanges();// optimistic concurrency error\n</code></pre>\n\n<p>Please help</p>\n\n<p>Thanks,</p>\n\n<p>Karthik</p>\n"},{"tags":["entity-framework","visual-studio-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":144,"score":0,"question_id":13054212,"title":"VS 2012 - EF 5.0 - Update Model from Database - Not picking up table changes","body":"<p>In Visual Studio 2010 EF 4, I could add a new column to a database table, then click 'Update Model from Database' on my .edmx and all was good in the world.</p>\n\n<p>In Visual Studio 2012 EF 5, I alter a table, and then click 'Update Model from Database' and it does not pick up the changes to individual tables anymore.</p>\n\n<p>Am I missing something ... or is this a new 'feature' of VS2012?</p>\n\n<p><strong>Update</strong>\nThe only way I can get a table with an added column to reflect in the .EDMX file is to delete the table then 'Update Model from Database' and it will pick up the added column. However, it puts the added table far off to the left and I have to move it back in place. No <strong>biggie</strong> just an annoyance.</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-sql"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":394,"score":4,"question_id":8713879,"title":"LINQ many-to-many intersection","body":"<p>I'm trying to query <code>Posts</code> based on a list of <code>Tags</code>:</p>\n\n<pre><code>public class Post\n{\n  public int? Id {get;set;}\n  public string Name {get;set;}\n  public virtual ICollection&lt;Tag&gt; Tags {get;set;}\n}\npublic class Tag\n{\n  public int? Id {get;set;}\n  public string Name {get;set;}\n  public vritual ICollection&lt;Post&gt; Posts {get;set;}\n}\n</code></pre>\n\n<p>Now I want to return posts based a list of tags:\n<code>IList&lt;Tag&gt; searchTags = ParseTagsFromSearchString(\"tag1,tag2,tag3\"); // this function checks the tags in the database, so all the primary keys are available in the list</code></p>\n\n<p>When a post contains one or more tags that also exists in <code>searchTags</code> it should be included in the result. I have tried the following:</p>\n\n<pre><code>var q = from s in Context.Registrations\n                    where s.Tags.Intersect(tagList)\n                    select s;\n</code></pre>\n\n<p>Error: <code>Cannot implicitly convert type 'System.Collections.Generic.IEnumerable&lt;Models.Tag&gt;' to 'bool'</code></p>\n\n<pre><code>var q = from s in Context.Registrations\n                    where s.Tags.Any(t =&gt; tagList.Any(t2 =&gt; t.Id.Value == t2.Id.Value))\n                    select s;\n</code></pre>\n\n<p>Runtime error: <code>NotSupportedException: Unable to create a constant value of type 'Models.Tag'. Only primitive types ('such as Int32, String, and Guid') are supported in this context.</code>\nAny ideas?</p>\n\n<p>-- update Jan. 4:\nThe answers point to the right solution, but in my code I still have the NotSupportedException. Is it possible the nullable integer causes this since it is not a primitive type?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","mvc","poco","data-access-layer"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13059901,"title":"Passing POCOs or EF objects to the Web project?","body":"<p>Say I have a Visual studio solution with two projects: one web project, and one data project.</p>\n\n<p>Does it really matter whether I pass the EF object from the data project to the web project, or do I need to explicitly define POCOs in the data project to pass to the web project?</p>\n\n<p>It seems to me that needing to create POCOs instead of simply using EF objects adds yet another thing that needs to be done...and I don't particularly see the purpose.</p>\n"},{"tags":["entity-framework","attributes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13063229,"title":"Dynamic Attribute Binding + Unable to determine the principal end of an association between the types","body":"<p>I'm struggeling figuring the proper way of Solving \"Unable to determine the principal end of an association between the types\". The principal end of this association must be explicitly configured using either the relationship fluent API or data\"  Entity Framework</p>\n\n<p>I have an entity like.  </p>\n\n<pre><code>public partial class Document\n{\n     DocumentId {get; set;}\n     DocumentName{get; set;}\n}\n\npublic class SpecialDocument\n{\n     DocumentId {get; set;}  --&gt; this is actually a foreign key from Document  \n                                 at the same time it is also the primary key \n     SpecialDocumentName {get; set;}\n}\n</code></pre>\n\n<p>I found a solution like adding a ForeignKey attribute on the property.  </p>\n\n<pre><code>public partial class SpecialDocument\n{\n      [ForeignKey(\"Document\")]\n      DocumentId {get; set;)\n      SpecialDocumentName {get; set;}\n}\n</code></pre>\n\n<p>however the problem is the class is autogenerated, whenever i update the edmx file the SpecialDocument is overwritten so now i need to re-add the ForeginKey attribute. </p>\n\n<p>Is there something I can do to the separate partial class for the SpecialDocument or Dnyaminc Attribute Attachment to the Property? Thanks!</p>\n"},{"tags":["entity-framework","asp.net-web-api","json.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13064073,"title":"Handling entity framework relations in json.net","body":"<p>I have an ASP MVC Web Api project that outputs json using json.net. I have for example the following models:</p>\n\n<pre><code>public class ModelA\n{\n    public int Id {get;set;}\n    public string Name {get;set;}\n\n    [JsonIgnore]\n    public int TypeModelId {get;set;}\n    public virtual TypeModel TypeModel {get;set;}\n}\n\npublic class TypeModel\n{\n    [JsonIgnore]\n    public int Id {get;set;}\n\n    public string Name {get;set;}\n\n    [JsonIgnore]\n    public virtual IList&lt;ModelA&gt; ModelAs {get;set;}\n}\n</code></pre>\n\n<p>When I serialize a <code>ModelA</code> the output will be something like this:</p>\n\n<pre><code>[\n  {\n    \"Id\": 1,\n    \"Name\": \"test\",\n    \"TypeModel\": {\n      \"Name\": \"testtype1\"\n    }\n  }\n]\n</code></pre>\n\n<p>Is it possible using json.net to have an output like this..</p>\n\n<pre><code>[\n  {\n    \"Id\": 1,\n    \"Name\": \"test\",\n    \"TypeModel\": \"testtype1\"\n  }\n]\n</code></pre>\n\n<p>..or do I have to copy the contents of <code>ModelA</code> to a new class which stores the <code>TypeModel</code> relation as string instead of reference? Maybe there are better solutions?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13060518,"title":"Add entity in Entity Framework Insert Null Record","body":"<p>I'm trying to insert a new Entity in EF:</p>\n\n<pre><code>public class Ad\n{\n    // Primary properties\n    public int Kms { get; set; }\n\n    // Navigation properties\n    public virtual Model Model { get; set; }\n}\n</code></pre>\n\n<p>And I receive from the View the model like this (example values):</p>\n\n<p>kms = 222\nModel.Id = 3</p>\n\n<p>Then when I do the Add and SaveChanges of the Entity Framework, I get a NULL record inserted in the Model Table (that generated a new ID) and a record in the Ad Table with the new inserted Model Id.</p>\n\n<p>Why is this happening?</p>\n\n<p>Service Layer:</p>\n\n<pre><code>    public void CreateAd(CreateAdDto adDto)\n    {\n        var adDomain = Mapper.Map&lt;CreateAdDto, Ad&gt;(adDto);\n\n        _adRepository.Add(adDomain);\n        _adRepository.Save();\n    }\n</code></pre>\n\n<p>Repository:</p>\n\n<pre><code>    public void Add(T entity)\n    {\n        _dbSet.Add(entity);\n    }\n\n   public void Save()\n    {\n        try\n        {\n            _dataContext.SaveChanges();\n        }\n        catch (DbEntityValidationException e)\n        {\n            var s = e.EntityValidationErrors.ToList();\n            throw;\n        }\n    }\n</code></pre>\n\n<p>ViewModel:</p>\n\n<pre><code>public class CreateAdViewModel\n{\n    // Primary properties\n    public string Version { get; set; }\n    public int Kms { get; set; }\n    public int Year { get; set; }\n    public decimal Price { get; set; }\n\n    public int Make_Id { get; set; }\n    public int Model_Id { get; set; }\n\n    // Navigation properties\n    public IEnumerable&lt;SelectListItem&gt; MakeList { get; set; }\n    public IEnumerable&lt;SelectListItem&gt; ModelList { get; set; }\n}\n</code></pre>\n\n<p>Dto:</p>\n\n<pre><code>public class CreateAdDto\n{\n    // Primary properties\n    public int Kms { get; set; }\n    public int Model_Id { get; set; }\n}\n</code></pre>\n\n<p>The Mapping:</p>\n\n<pre><code>        Mapper.CreateMap&lt;CreateAdDto, Ad&gt;().ForMember(dest =&gt; dest.Model, opt =&gt; opt.MapFrom(src =&gt; new Model { Id = src.Model_Id }));\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first","t4","entity-framework-5","ef-power-tools"],"answer_count":1,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":280,"score":7,"question_id":12937193,"title":"Improve navigation property names when reverse engineering a database","body":"<p>I'm using Entity Framework 5 with Visual Studio with Entity Framework Power Tools Beta 2 to reverse engineer moderately sized databases (~100 tables).</p>\n\n<p>Unfortunately, the <strong>navigation properties do not have meaningful names</strong>. For example, if there are two tables:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE Contacts (\n    ContactID INT IDENTITY (1, 1) NOT NULL,\n    ...\n    CONSTRAINT PK_Contacts PRIMARY KEY CLUSTERED (ContactID ASC)\n}\n\nCREATE TABLE Projects (\n    ProjectID INT IDENTITY (1, 1) NOT NULL,\n    TechnicalContactID INT NOT NULL,\n    SalesContactID INT NOT NULL,\n    ...\n    CONSTRAINT PK_Projects PRIMARY KEY CLUSTERED (ProjectID ASC),\n    CONSTRAINT FK_Projects_TechnicalContact FOREIGN KEY (TechnicalContactID)\n        REFERENCES Contacts (ContactID),\n    CONSTRAINT FK_Projects_SalesContact FOREIGN KEY (SalesContactID)\n        REFERENCES Contacts (ContactID),\n    ...\n}\n</code></pre>\n\n<p>This will generate classes like this:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class Contact\n{\n     public Contact()\n     {\n          this.Projects = new List&lt;Project&gt;();\n          this.Projects1 = new List&lt;Project&gt;();\n     }\n     public int ContactID { get; set; }\n     // ...\n     public virtual ICollection&lt;Project&gt; Projects { get; set; }\n     public virtual ICollection&lt;Project&gt; Projects1 { get; set; }\n}\n\npublic class Project\n{\n     public Project()\n     {\n\n     }\n     public int ProjectID { get; set; }\n     public int TechnicalContactID { get; set; }\n     public int SalesContactID { get; set; }\n     // ...\n     public virtual Contact Contact { get; set; }\n     public virtual Contact Contact1 { get; set; }\n}\n</code></pre>\n\n<p>I see several variants which would all be better than this:</p>\n\n<ul>\n<li>Use the <strong>name of the foreign key</strong>: For example, everything after the last underscore (<code>FK_Projects_TechnicalContact</code> --> <code>TechnicalContact</code>). Though this probably would be the solution with the most control, this may be more difficult to integrate with the existing templates.</li>\n<li>Use the <strong>property name</strong> corresponding to the foreign key column: Strip off the suffix <code>ID</code> (<code>TechnicalContactID</code> --> <code>TechnicalContact</code>)</li>\n<li>Use the <strong>concatenation of property name and the existing solution</strong>: Example <code>TechnicalContactIDProjects</code> (collection) and <code>TechnicalContactIDContact</code></li>\n</ul>\n\n<p>Luckily, <a href=\"http://romiller.com/2012/05/09/customizing-reverse-engineer-code-first-in-the-ef-power-tools/\">it is possible to modify the templates by including them in the project</a>. </p>\n\n<p>The modifications would have to be made to <code>Entity.tt</code> and <code>Mapping.tt</code>. I find it difficult due to the lack of intellisense and debug possibilities to make those changes.</p>\n\n<hr>\n\n<p><em>Concatenating property names</em> (third in above list) is probably the easiest solution to implement.</p>\n\n<p><strong>How to change the creation of navigational properties in <code>Entity.tt</code> and <code>Mapping.tt</code> to achieve the following result</strong>:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class Contact\n{\n     public Contact()\n     {\n          this.TechnicalContactIDProjects = new List&lt;Project&gt;();\n          this.SalesContactIDProjects = new List&lt;Project&gt;();\n     }\n     public int ContactID { get; set; }\n     // ...\n     public virtual ICollection&lt;Project&gt; TechnicalContactIDProjects { get; set; }\n     public virtual ICollection&lt;Project&gt; SalesContactIDProjects { get; set; }\n}\n\npublic class Project\n{\n     public Project()\n     {\n\n     }\n     public int ProjectID { get; set; }\n     public int TechnicalContactID { get; set; }\n     public int SalesContactID { get; set; }\n     // ...\n     public virtual Contact TechnicalContactIDContact { get; set; }\n     public virtual Contact SalesContactIDContact { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework","migration"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":19,"score":2,"question_id":13059544,"title":"Restoring tables in entity framework","body":"<p>I am working with EF very first time. For some reason I was having difficulty to run my application and every time I was getting exception that your model is not synced up with the current database. I tried everything and since data wasn't important, I thought to re-create all tables by running all the migrations. So, I removed all tables and tried to run the following command. I am using model based approach here to define my entities.</p>\n\n<p><em>Update-database -targetMigration:<strong>InitialCreate</strong> -verbose</em></p>\n\n<p>I was under the impression that it will re-create all tables starting from the very first migration but it actually reverted all to that very first point. Now, whenever i run update-database command, I always get the following </p>\n\n<p><em>No pending explicit migrations.</em></p>\n\n<p>I am very confused what should I do to take my table generated back and set my app in working condition. Can anybody help?</p>\n\n<p>Thanks\n-Fahad</p>\n"},{"tags":["wcf","entity-framework","subsonic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":160,"score":0,"question_id":9362423,"title":"difference between Entity Framework and SubSonic , wcf data service","body":"<p>I am very confused with the use <strong>subsonic</strong> or <strong>ado.net entity framework</strong> or <strong>WCF Data Services</strong> Which one I should choose? \nI creating a middleware (web site) using asp.net mvc.\nI seek a compromise between power, speed of implementation, heavy at runtime, abstraction ...\nSo Which orm i should use?</p>\n"},{"tags":["c#","entity-framework","code-generation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13060614,"title":"Entity Framework DbContext code generation generates incorrect code","body":"<p>I'm using VS2010 with Entity Framework (file version is 4.4. product version is 5) </p>\n\n<p>I have installed the EF5.x <code>DbContext</code> generator.</p>\n\n<p>After creating my <code>.edmx</code> file, I right clicked on the empty space and added a new <code>DbContext</code> template, which generated the <code>context.tt</code> and <code>.tt</code> files. </p>\n\n<p>However, in the <code>.tt</code> files, this is how the auto generated code looks like:</p>\n\n<pre><code>namespace DataObjects.EntityFramework.Models\n{\n    using System;\n    using System.Collections.Generic;\n\n    public partial class SubSystem\n    {\n        public string SubSystemId { get; set; }\n        public string Description { get; set; }\n        public string Fmode { get; set; }\n        public Nullable&lt;System.DateTime&gt; LastBackup { get; set; }\n    }\n}\n</code></pre>\n\n<p>The problem is that the using statements are inside the namespace, which gives rise to a compilation error. </p>\n"},{"tags":["asp.net-mvc","entity-framework","mono","npgsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":113,"score":1,"question_id":13042289,"title":"Mono 4.5 profile, entity framework Npgsql - NpgsqlSystem.InvalidCastException Cannot cast from source type to destination type","body":"<p>I have getting \"System.InvalidCastException\nCannot cast from source type to destination type.\" when trying to access the database from asp.net mvc3 using mono 4.5 profile and postgres at the backend.</p>\n\n<p>Here is what my code looks like:</p>\n\n<pre><code>public class User\n{\n    public int Id { get; set; }\n    public string Username { get; set; }\n    public string PasswordHash { get; set; }\n    public string PasswordSalt { get; set; }    \n} // class\n</code></pre>\n\n<p>AppContext:</p>\n\n<pre><code>using System;\nusing System.Data.Entity;\nusing Npgsql;\nusing NpgsqlTypes;\n\nnamespace Web\n{\npublic class AppContext : DbContext\n{\n    public DbSet&lt;User&gt; Users { get; set; }\n\n    protected override void OnModelCreating (DbModelBuilder modelBuilder)\n    {\n        base.OnModelCreating (modelBuilder);\n    }   \n} // class\n} // namespace\n</code></pre>\n\n<p>Database schema (dbo)</p>\n\n<pre><code>CREATE TABLE dbo.\"Users\"\n(\n\"Id\" integer NOT NULL DEFAULT nextval('dbo.\"Users_Id_seq\"'::regclass),\n\"Username\" character varying(50) NOT NULL,\n\"PasswordHash\" character varying(255) NOT NULL,\n\"PasswordSalt\" character varying(128) NOT NULL,\nCONSTRAINT pk_users_id PRIMARY KEY (\"Id\")\n)\n\npublic class HomeController : Controller\n{\n    public ActionResult Index ()\n    {\n        var db = new AppContext();\n        var users = db.Users.Find(1);\n        ViewData [\"Message\"] = \"Welcome to ASP.NET MVC on Mono!\";\n        return View ();\n    }\n}\n</code></pre>\n\n<p>error i am getting is:</p>\n\n<pre><code>System.InvalidCastException\n\nCannot cast from source type to destination type.\n\nDescription: HTTP 500.Error processing request.\nDetails: Non-web exception. Exception origin (name of application or object): Npgsql.\nException stack trace:\nat Npgsql.NpgsqlFactory.CreateConnection () [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/Npgsql/Npgsql/NpgsqlFactory.cs:64\nat System.Data.Entity.Internal.LazyInternalConnection.CreateConnectionFromProviderName (string) [0x00007] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalConnection.cs:379\nat System.Data.Entity.Internal.LazyInternalConnection.InitializeFromConnectionStringSetting (System.Configuration.ConnectionStringSettings) [0x00045] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalConnection.cs:368\nat System.Data.Entity.Internal.LazyInternalConnection.TryInitializeFromAppConfig (string,System.Data.Entity.Internal.AppConfig) [0x0000e] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalConnection.cs:310\nat System.Data.Entity.Internal.LazyInternalConnection.Initialize () [0x00047] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalConnection.cs:242\nat System.Data.Entity.Internal.LazyInternalConnection.get_ProviderName () [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalConnection.cs:118\nat System.Data.Entity.Internal.LazyInternalContext.get_ProviderName () [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalContext.cs:290\nat System.Data.Entity.Internal.DefaultModelCacheKeyFactory.Create (System.Data.Entity.DbContext) [0x00022] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/DefaultModelCacheKeyFactory.cs:20\nat System.Data.Entity.Internal.LazyInternalContext.InitializeContext () [0x00091] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/LazyInternalContext.cs:388\nat System.Data.Entity.Internal.InternalContext.Initialize () [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/InternalContext.cs:421\nat System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType (System.Type) [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/external/entityframework/src/EntityFramework/Internal/InternalContext.cs:650\nat System.Data.Entity.Internal.Linq.InternalSet`1&lt;Web.Users&gt;.Initialize () &lt;0x0006f&gt;\nat System.Data.Entity.Internal.Linq.InternalSet`1&lt;Web.Users&gt;.get_InternalContext () &lt;0x00028&gt;\nat System.Data.Entity.Internal.Linq.InternalSet`1&lt;Web.Users&gt;.Find (object[]) &lt;0x0002e&gt;\nat System.Data.Entity.DbSet`1&lt;Web.Users&gt;.Find (object[]) &lt;0x0002f&gt;\nat Web.Controllers.HomeController.Index () [0x0001c] in /Users/nix/Documents/Projects/Dot.NET/Store/Web/Controllers/HomeController.cs:15\nat (wrapper dynamic-method) object.lambda_method (System.Runtime.CompilerServices.Closure,System.Web.Mvc.ControllerBase,object[]) &lt;IL 0x00006, 0x0003f&gt;\nat System.Web.Mvc.ActionMethodDispatcher.Execute (System.Web.Mvc.ControllerBase,object[]) [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/System.Web.Mvc3/Mvc/ActionMethodDispatcher.cs:27\nat System.Web.Mvc.ReflectedActionDescriptor.Execute (System.Web.Mvc.ControllerContext,System.Collections.Generic.IDictionary`2&lt;string, object&gt;) [0x00074] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/System.Web.Mvc3/Mvc/ReflectedActionDescriptor.cs:84\nat System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod (System.Web.Mvc.ControllerContext,System.Web.Mvc.ActionDescriptor,System.Collections.Generic.IDictionary`2&lt;string, object&gt;) [0x00000] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/System.Web.Mvc3/Mvc/ControllerActionInvoker.cs:173\nat System.Web.Mvc.ControllerActionInvoker/&lt;InvokeActionMethodWithFilters&gt;c__AnonStorey3B.&lt;&gt;m__46 () [0x00014] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/System.Web.Mvc3/Mvc/ControllerActionInvoker.cs:216\nat System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter (System.Web.Mvc.IActionFilter,System.Web.Mvc.ActionExecutingContext,System.Func`1&lt;System.Web.Mvc.ActionExecutedContext&gt;) [0x00033] in /private/tmp/source/bockbuild/profiles/mono-mac-release/build-root/mono-2.11/_build/mono-2.11.git/mcs/class/System.Web.Mvc3/Mvc/ControllerActionInvoker.cs:189\n</code></pre>\n\n<p>any suggestions or clue about whats going on?</p>\n"},{"tags":["vb.net","entity-framework","ef-code-first","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":140,"score":0,"question_id":11937169,"title":"Creating DBContext Initializer Getting 'Type argument <context> does not inherit from or implement the constraint type 'System.Data.Entity.DBContext'","body":"<p>I am trying to initialize a database using Database.SetInitializer but I am getting a  'Type argument  does not inherit from or implement the constraint type 'System.Data.Entity.DBContext' Error when my initializer class DOES inherit from DBContext. Any ideas? I'm new to Code First EF by the way!</p>\n\n<p>Context Class:</p>\n\n<pre><code>Imports System.Data.Entity\nImports System.Collections.Generic\nImports System.Data.Entity.Infrastructure\nImports System.Configuration\n\nPublic Class PropertyManagementContext\n    Inherits DbContext\n\n#Region \"Constructor\"\n    Public Sub New()\n        MyBase.New(\"Data Source=WSBS2K3SQL;Initial Catalog=AQUARIUS_TEST;Persist    Security Info=True;User ID=SomeUser;Password=SomePassword;\")\n\n    End Sub\n\n#End Region\n\n#Region \"Tables\"\n    Public Complexes As DbSet(Of Complex)\n    Public Buildings As DbSet(Of Building)\n    Public Units As DbSet(Of Unit)\n    Public Tenants As DbSet(Of Tenant)\n#End Region\n\nProtected Overrides Sub OnModelCreating(modelBuilder As DbModelBuilder)\n    MyBase.OnModelCreating(modelBuilder)\n\n    'Set the Primary Keys\n    modelBuilder.Entity(Of Complex).HasKey(Function(c) c.ComplexId)\n    modelBuilder.Entity(Of Building).HasKey(Function(b) b.BuildingId).HasKey(Function(b) b.ComplexId)\n    modelBuilder.Entity(Of Unit).HasKey(Function(u) u.UnitId).HasKey(Function(u) u.BuildingId)\n    modelBuilder.Entity(Of Tenant).HasKey(Function(t) t.TenantId)\n\n    'Set Complex Primary Key to Identity(MS SQL Auto-Increment)\n    modelBuilder.Entity(Of Complex).Property(Function(c) c.ComplexId) _\n    .HasDatabaseGeneratedOption(ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)\n\nEnd Sub\n\nEnd Class\n</code></pre>\n\n<p>Initializer Class:</p>\n\n<pre><code>Imports System.Collections.Generic\nImports System.Linq\nImports System.Text\nImports System.Data.Entity\n\nPublic Class PropertyManagementInitializer\n    Inherits DropCreateDatabaseAlways(Of PropertyManagementContext)\n\nProtected Overrides Sub Seed(context As PropertyManagementContext)\n    MyBase.Seed(context)\n\n    Dim complex As New Complex With {\n        .Name = \"SomeComplex\",\n        .City = \"SomeCity\",\n        .Address = \"SomeStreet\",\n        .PostalCode = \"R2R2R2\",\n        .Type = \"1\"\n    }\n    context.Complexes.Add(complex)\n\n    context.SaveChanges()\n\nEnd Sub\n\nEnd Class\n</code></pre>\n\n<p>Main Form where Database.SetInitializer() is called and giving the error:</p>\n\n<pre><code>Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load\n    Try    \n        Database.SetInitializer(Of PropertyManagementContext)(New PropertyManagementInitializer)\n\n    Catch ex As Exception\n        MessageBox.Show(ex.Message)\n    End Try\n\nEnd Sub\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":13007850,"title":"EF5: prevent automatic column discovery","body":"<p>I use EF's code-first and \"fluent\" APIs. It automatically maps my entities' properties and navigation properties.</p>\n\n<p>I have lots of behavior and other properties in those classes, and so need to call <code>Ignore()</code> in such cases.</p>\n\n<p>Can I change it so it only maps what I <em>explicitly</em> specify using the fluent API? I want to work on a whitelist approach, rather than its current blacklist approach.</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13058928,"title":"Code First Parent/Child relationships when both parent and child use TPH inheritance","body":"<p>I am trying to map a parent/child collection scenario where both parent and child use TPH inheritance.  I have tried many scenarios--none of which has worked.  The key for me is that each parent can only have one type of child in the collection.  Below is a contrived example of what I'm trying to achieve:</p>\n\n<pre><code>public abstract class Order\n{\n    public int ID { get; set; }\n    public decimal Total { get; set; }\n}\n\npublic class SalesOrder : Order\n{\n    public bool Rush { get; set; }\n    public virtual ICollection&lt;SalesOrderLine&gt; OrderLines { get; set; }\n}\n\npublic class PurchaseOrder : Order\n{\n    public string Contact{ get; set; }\n    public virtual ICollection&lt;PurchaseOrderLine&gt; OrderLines { get; set; }\n}\n\npublic abstract class OrderLine\n{\n    public int ID { get; set; }\n    public int OrderID { get; set; }\n    public string Sku { get; set; }\n    public int Quantity { get; set; }\n    public decimal Amount { get; set; }\n}\n\npublic class SalesOrderLine : OrderLine\n{\n    public decimal Discount { get; set; }\n    public virtual SalesOrder Order { get; set; }\n}\n\npublic class PurchaseOrderLine : OrderLine\n{\npublic int VendorID { get; set; }\n    public virtual PurchaseOrder Order { get; set; }\n}\n</code></pre>\n\n<p>The SalesOrder and PurchaseOrder class use are mapped to an Order table using TPH.  And the SalesOrderLine and PurchaseOrderLine are mapped to an OrderLine table using TPH.</p>\n\n<p>Does EF support this and, if so, how can I acheive it?</p>\n"},{"tags":["c#","wcf","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":103,"score":1,"question_id":13036009,"title":"Update many entities in one WCF call versus hitting the WCF service for each entity to update","body":"<p>I work on a multi-tier application and I need to optimize a long-running process in three ways :</p>\n\n<ol>\n<li>Avoiding EF update concurrency problems.</li>\n<li>Improving speed.</li>\n<li>Informing the user of the progress.</li>\n</ol>\n\n<p>Actually, the client code calls a WCF service using a method <strong>that does all the work</strong> (<em>evaluating the number of entities to update</em>, <em>querying the entities to update</em>, <em>updating them</em> and finally, <em>saving them back to the database</em>).</p>\n\n<p>The process is very long and <strong>nothing is sent back to the user except the final result</strong> once the process is done. The user can stay in front of the wait form for up to 10 minutes, not knowing what is happening.</p>\n\n<p>The number, and depth of the queried entities can become really big and I sometimes hit OutOfMemoryExceptions. I had to change the service method to process entity updates 100 entities at a time, so my DbContext will be refreshed often and won't become too big.</p>\n\n<p>My actual problem is that I cannot inform the user each time an entity is updated because <strong>my service method does the whole process before returning it's result to the user.</strong></p>\n\n<p>I read about implementing a duplex service but since I have to return <strong>two different callbacks</strong> to the user (one callback to <em>return the number of entities to update</em> and another callback <em>for the result of each entity update</em>) I have to use multiple interface inheritance on a generic callback interface and it's becoming a little messy (well, to my taste).</p>\n\n<p>Wouldn't it be better to have one WCF service method to return the number of entities to evaluate, and another WCF method that will return a simple entity update result, which will be hit for every entity to update ? My DBContext will be living only for the time of a single entity update, so it would not grow very much, which I think is good. <strong>However, I am concerned about hitting the WCF service really often during that process</strong>.</p>\n\n<p>What are you thoughts ? What can you suggest ?</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13056735,"title":"Count and Group By an Entity (Not an Entity's Property)","body":"<p>I have the following entity model. I omitted a lot of properties on each entity for brevity's sake.</p>\n\n<pre><code>public sealed class Platform {\n    /// &lt;summary&gt;\n    /// Get and Set Platform's Unique Identifier.\n    /// &lt;/summary&gt;\n    public int Id { get; set; }\n\n    /// &lt;summary&gt;\n    /// Determine if an Object is Equal to This Platform.\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"obj\"&gt;\n    /// An object to compare.\n    /// &lt;/param&gt;\n    /// &lt;returns&gt;\n    /// A boolean true if the object is equal to this platform. A boolean false otherwise.\n    /// &lt;/returns&gt;\n    public override bool Equals(object obj) {\n        bool isObjectPlatform = obj is Platform;\n        bool isObjectIdEqual = isObjectPlatform &amp;&amp; (obj as Platform).Id == this.Id;\n\n        return isObjectIdEqual;\n    }\n\n    /// &lt;summary&gt;\n    /// Get Platform's Hash Code.\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;\n    /// The platform's hash code, equalling the platform's unique identifier.\n    /// &lt;/returns&gt;\n    public override int GetHashCode() {\n        return this.Id;\n    }\n}\n\npublic sealed class Capture {\n    /// &lt;summary&gt;\n    /// Get and Set Capture's Unique Identifier.\n    /// &lt;/summary&gt;\n    public int Id { get; set; }\n\n    /// &lt;summary&gt;\n    /// Get and Set Capture's Platform.\n    /// &lt;/summary&gt;\n    public Platform Platform { get; set; }\n\n    /// &lt;summary&gt;\n    /// Determine if an Object is Equal to This Capture.\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"obj\"&gt;\n    /// An object to compare.\n    /// &lt;/param&gt;\n    /// &lt;returns&gt;\n    /// A boolean true if the object is equal to this capture. A boolean false otherwise.\n    /// &lt;/returns&gt;\n    public override bool Equals(object obj) {\n        bool isObjectCapture = obj is Capture;\n        bool isObjectIdEqual = isObjectCapture &amp;&amp; (obj as Capture).Id == this.Id;\n\n        return isObjectIdEqual;\n    }\n\n    /// &lt;summary&gt;\n    /// Get Capture's Hash Code.\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;\n    /// The capture's hash code, equalling the capture's unique identifier.\n    /// &lt;/returns&gt;\n    public override int GetHashCode() {\n        return this.Id;\n    }\n}\n</code></pre>\n\n<p>What I basically want is a LINQ query, backed up by an EF of course, that will get me the count of <strong>Captures</strong> grouped by an entire <strong>Platform</strong> entity. I want to be able to return a reference to each <strong>Platform</strong>, instead of one of its properties, and the count of each <strong>Capture</strong> associated with it.</p>\n\n<p>I did this query and it works great:</p>\n\n<pre><code>var query = this._defaultContext.Captures\n                .Include(m =&gt; m.Platform)\n                .GroupBy(m =&gt; m.Platform.Id)\n                .Select(m =&gt; new {\n                    PlatformId = m.Key,\n                    Count = m.Count()\n                });\n</code></pre>\n\n<p>But as you can see, I am grouping by the <strong>Platform's</strong> <em>Id</em> property. What I would rather have is this:</p>\n\n<pre><code>var query = this._defaultContext.Captures\n                .Include(m =&gt; m.Platform)\n                .GroupBy(m =&gt; m.Platform)\n                .Select(m =&gt; new {\n                    Platform = m.Key,\n                    Count = m.Count()\n                });\n</code></pre>\n\n<p>This does not work. It just gets a count of 1 for each record in the database. It looks it does not know to group by an entire entity. I was hoping it could by differentiating between each <strong>Platform</strong> by way of the <strong>GetHashCode</strong> and <strong>Equals</strong> method implementations but no luck.</p>\n\n<p>Anyone ever run into a scenario like this? Any way around it? Or do I have to manually do it. I would hate that since it would probably result in some kind of N + 1 query.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":60,"score":0,"question_id":13057389,"title":"passing different objects of same base class to method","body":"<p>Basically, I would like to create a Method, that takes a base-class as a parameter, and can be used \"generic\" for derived classes</p>\n\n<p>ef-code-first classes:</p>\n\n<p>the base class</p>\n\n<pre><code>public abstract class BaseClass\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n}\n</code></pre>\n\n<p>derived classes:</p>\n\n<pre><code>public class DerivedA:BaseClass\n{\n    public string AValue {get;set;}\n    ...more specific fields\n}\n\n\npublic class DerivedB:BaseClass\n{\n    public string BValue {get;set;}\n    ..... more specific fields\n}\n</code></pre>\n\n<p>I call a \"generic Method\" with these slightly different objects:</p>\n\n<pre><code>System.Data.Entity.DbSet&lt;DerivedA&gt; _dA....\nSystem.Data.Entity.DbSet&lt;DerivedB&gt; _dB....\n\ngenericMethod(_dA.Where(a =&gt; a.Name.StartsWith(\"a name\")))); //&lt;-contains records\ngenericMethod(_dB.Where(a =&gt; a.Id==5)); //&lt;---- contains records\n</code></pre>\n\n<p>Both \"Where...\" contain records in debug (after clicking on Enumerate)</p>\n\n<p>now the method:</p>\n\n<pre><code>public string genericMethod(&lt;IQueryable&gt;BaseClass _myClass)\n{\n    foreach (BaseClass c in _myClass)  // &lt;-------class is empty - no records\n        {\n          // do something usefull...\n        }\n    return someResult \n}\n</code></pre>\n\n<p>But no records are contained, when inside the method.</p>\n\n<p>Is it possible, what I am trying to do...?\nDoes it make sense?</p>\n\n<p>There are no design-time or compile-time or runtime errors, but the passed object contains no records when passed to the method, but it contained records in the calling statement.</p>\n\n<p>What did I do wrong?</p>\n\n<p>Is there a better approach? - </p>\n\n<p>I need this Method, for manipulation of more than two (maybe ten) derived classes, and therefor I want it \"generic\".</p>\n\n<p>Thank you!</p>\n"},{"tags":["entity-framework","visual-studio-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":563,"score":0,"question_id":12375090,"title":"Entity Framework 5 and Visual Studio 2012 POCO Classes in Different Project","body":"<p>In VS 2010 and EF 4.4, you were able to move and edit .tt files when using the DBContext generator in Entity Framework such that your POCO objects where in a different project than your DBContext files. </p>\n\n<p>See <a href=\"http://stackoverflow.com/questions/5565633/separating-entity-framework-poco-and-objectcontext\">Here</a> and <a href=\"http://stackoverflow.com/questions/2464909/generate-poco-classes-in-different-project-to-the-project-with-entity-framework\">Here</a> for examples of what I am talking about.</p>\n\n<p>In VS2012 / EF5 this seems not to be possible. the POCO classes are generated as a subitem under the EDMX file. The files cannot be copied from within Visual Studio. Moving the files from Explorer does not help because the files you moved get recreated at compilation time.</p>\n\n<p>Am I missing something basic here?</p>\n\n<p>I am not using any code generation items with EF5 (whereas I was with EF4.x.) Could that be the difference?</p>\n"},{"tags":["c#","database","entity-framework","design","fluent-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13010263,"title":"Map entities to many-to-many junction table in EF 4.5","body":"<p>At the moment Im mapping my existing DB tables to new EF 4.5 model via Fluent Api. Ive got a questing on how to map following db structure to classes. </p>\n\n<pre><code>Students(pk Id...)\nCourses (pk Id...)\nStudents_Courses (pk Id, fk StudentId, fk CourseId)\nComments (pk Id, fk Students_Courses Id, comment, dateposted...)\n</code></pre>\n\n<p>The idea is that I may have many reviews per student_course pair. What is the best way to represent my classes in this scenario? \nThe problem here is that Ill probably need to map Comment entity to Students_Courses table and somehow determine to which Student and Course (in terms of classes) this comment belongs.\nAny suggestions on the design?\nThanks!</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13055121,"title":"How can I include a collection's foreign key property in the controller query?","body":"<p>This may be a case of \"going too deep\", but I thought I would ask anyway.  I've got the following models:</p>\n\n<pre><code>public class Exam\n{\n    public int ID {get; set;}\n    //...other Exam properties\n    public virtual ICollection&lt;ExamResults&gt; Results {get; set;}\n}\n\npublic class ExamResults\n{\n    public int ExamId {get; set;}\n    //...other Exam Result properties\n    public int ExamDomainId {get; set;}\n    public virtual ExamDomain ExamDomain {get; set;}\n}\n\npublic class ExamDomain\n{\n    public int ID {get; set;}\n    public String DomainName {get; set;}\n    //...more stuff\n}\n</code></pre>\n\n<p>So in plain English, an Exam has a collection of ExamResults.  Each ExamResult has an ExamDomain, and each ExamDomain has a name.  </p>\n\n<p>The problem is this: My view creates a new database query every time I use</p>\n\n<pre><code>@Html.DisplayFor(e =&gt; e.exampleResult.ExamDomain.DomainName)\n</code></pre>\n\n<p>I cannot include ExamDomain in the initial controller query, as Exam does not have a navigation property with Exam.  Example:</p>\n\n<pre><code>//The below does not work because ExamResults is a collection, not a record\nvar exam = db.Exams.Include(e =&gt; e.ExamResults.ExamDomain)...\n\n//The code below also does not work, but it does run\nvar exam = db.Exams.Include(e =\n</code></pre>\n\n<p>With that said, how can I grab all the necessary DomainNames from the ExamDomain table without running an additional query for every ExamResult?</p>\n\n<p>PS: I do have a view model, but it shouldn't matter for the purpose of this question.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","design-patterns"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":50,"score":3,"question_id":13053544,"title":"Structure for switchable Data Access Layer","body":"<p>I need to write a Data Access Layer using Entity Framework. One of the requirements is to allow a configuration file to control where the data comes from. With one config setting it should come from a database; with another, from a web service.</p>\n\n<p>Now, my initial thought is to have 3 DataAccess classes:</p>\n\n<ul>\n<li>WidgetDataAccess</li>\n<li>WidgetDatabaseDataAccess</li>\n<li>WidgetWebServiceDataAccess</li>\n</ul>\n\n<p>They would all implement the same interface. WidgetDataAccess would read the config and delegate to the correct child class. That seems sensible, right?</p>\n\n<p>Is there any pattern that I should follow, or anyone with a better way to structure this?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13053883,"title":"MVC Entity Framework Partial Class access DB for property value","body":"<p>I am using Entity Framework mapped to my database. I have a Basket model which can have many BasketItem models, and I have Promotions and Coupons models.\nThis is for eCommerce checkout functionality and I just don't understand how this will work, here goes:</p>\n\n<p>Because my BasketItems have a foreign key relationship to the Basket if I want to sum up the Subtotal for my basket items in a partial class, I can do this:</p>\n\n<pre><code>        public decimal Subtotal {\n        get {\n            return this.BasketItems.Sum(pb =&gt; pb.Subtotal);\n            }\n        }\n</code></pre>\n\n<p>This is helpful because I can use this inside a view, there's no mucking around with passing a DB context through and it's DRY, etc. etc.</p>\n\n<p>Now I want to apply promotions or coupons to my Subtotal ideally I want it to look like this:</p>\n\n<pre><code>        public decimal DiscountedSubtotal {\n        get { \n            decimal promotions_discount = 0;\n            decimal coupons_discount = 0;\n            return Subtotal - promotions_discount - coupons_discount;\n            }\n        }\n</code></pre>\n\n<p>But there is no access to Promotions or Coupons without either creating some crazy and unnecessary relationships in my database or some light hacking to get this functionality to work. I don't know what I should do to overcome this problem.</p>\n\n<p><strong>Solution 1:</strong></p>\n\n<pre><code>        public decimal DiscountedSubtotal(DatabaseEntities db) {\n        decimal promotions_discount = from p in db.Promotions\n                                  select p.Amount;\n        decimal coupons_discount = from c in db.Coupons\n                               select c.Amount;\n        return Subtotal - promotions_discount - coupons_discount;\n        }\n</code></pre>\n\n<p>I don't want to use this in my View pages, plus I have to send through my context every time I want to use it.</p>\n\n<p><strong>Solution 2: (untested)</strong></p>\n\n<pre><code>    public List&lt;Promotion&gt; Promotions { get; set; }\n    public List&lt;Coupon&gt; Coupons { get; set; }\n\n    public Basket()\n        : base() {\n            DatabaseEntities db = new DatabaseEntities();\n            Promotions = db.Promotions.ToList();\n            Coupons = db.Coupons.ToList();\n    }\n</code></pre>\n\n<p>A bit of light hacking could provide me with references to promotions and coupons but i've had problems with creating new contexts before and I don't know if there is a better way to get me to the DiscountedSubtotal property I would ideally like.</p>\n\n<p>So to sum up my question, I would like to know the best way to get a DiscountedSubtotal property.</p>\n\n<p>Many thanks and apologies for such a long read :)</p>\n"},{"tags":["entity-framework","postgresql","devart","dotconnect"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12865017,"title":"Can't generate EF model correctly with Devart dotConnect for PostgreSQL product","body":"<p>I have problem when creating Entity Framework model from an existing PostgreSQL database with the Devart dotConnect for PostgreSQL product.\nThis product offer 2 ways of generating EF model from a database and neither seems to work.\n When using an ADO.Net Entity data Model with this Devart provider, the tables list appear empty in the wizard when generating model from database. \nWhen using the Devart Entity Model, the table list appear correctly in the wizard and model is generated but all navigations properties are missing and all not nullable fields are generated as entity keys.\nAnyone has experience with this product and can confirm me if I'm facing bugs or if I'm not using it correctly?\nThanks </p>\n\n<p>Etienne</p>\n"},{"tags":["c#","linq","entity-framework","linq-expressions"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13048608,"title":"Using a params array of linq Expressions","body":"<p>In EF, when you want to include a navigation property in the result of a query, you use <code>Include()</code>. Since some queries require calling this more than once, I tried to create a generic wrapper around this concept:</p>\n\n<pre><code>public IQueryable&lt;T&gt; FindAll&lt;P&gt;(params Expression&lt;Func&lt;T, P&gt;&gt;[] predicates) where P : class {\n  var entities = AllEntities();\n  foreach (var p in predicates) entities = entities.Include(p);\n  return entities;\n}\n</code></pre>\n\n<p>And call it as such:</p>\n\n<pre><code>var customers = FindAll(q =&gt; q.Orders, q =&gt; q.Invoices, q =&gt; q.Contacts);\n</code></pre>\n\n<p>Questions:  </p>\n\n<ol>\n<li>The function compiles, but when I call it: \"The type arguments for method cannot be inferred from the usage. Try specifying the type arguments explicitly.\" What am I doing wrong?  </li>\n<li>If I get it to work, can I call <code>Include()</code> the first time: <code>var customers = FindAll(q =&gt; q.Orders, q =&gt; q.Invoices);</code> and then again later in a separate step: <code>customers = customers.Include(p =&gt; p.Invoices);</code> or will that result in poor performance such that I should do the includes in one go?</li>\n</ol>\n\n<p><strong>EDIT:</strong><br>\nJonSkeet's answer is correct, of course, and yet <a href=\"http://stackoverflow.com/a/5376637/1711500\">there is this solution</a> which seems to do what I want. Not sure why it works however. Is it because of the <code>Aggregate()</code> function?</p>\n"},{"tags":["c#","entity-framework","entity-framework-4","servicestack"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13045247,"title":"How do I make the ServiceStack MiniProfiler work with EF?","body":"<p>ServiceStack includes the awesome <a href=\"http://miniprofiler.com/\" rel=\"nofollow\">MiniProfiler</a> built in. However, it is a different version, compiled into ServiceStack, in it's own namespace.</p>\n\n<p>I have got the profiler working with normal ADO.NET connections, but I am struggling to make it work with my Entity Framework 4.2 data contexts. </p>\n\n<p>Normally, one would use the MiniProfiler.EF NuGet package, but since it is built against the official MiniProfiler version it does not work.</p>\n\n<p>What is the easiest way of either:</p>\n\n<ul>\n<li>Swapping out the MiniProfiler in ServiceStack for the official version (I researched this and it does not seem easy, since SS generates the JavaScript for the profiler deep in some handlers) ?</li>\n<li>Or, making the built in profiler work with ServiceStack AND Entity Framework ? </li>\n</ul>\n"},{"tags":["silverlight","entity-framework","data-binding","ef-code-first","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13050820,"title":"Bind data from WCF Ria Services to data grid Entity Framework Code First","body":"<p>I've created simple POCO class like this : </p>\n\n<pre><code> public   class Entity\n{\n public int   Id { get; set; }\n public bool IsActive { get; set; }\n}\n</code></pre>\n\n<p>And this is my EF DbContext : </p>\n\n<pre><code>   public class SampleContext:DbContext \n    {\n             public DbSet&lt;Entity&gt; Entities { get; set; }\n\n    }\n</code></pre>\n\n<p>I defined sample logic layer like this : </p>\n\n<pre><code>       public class EntityTask : IEntityTask \n    {\n       #region Implementation of IEntityTask\n\n       public IEnumerable&lt;Entity&gt; GetAll()\n       {\n           var contex = new SampleContext();\n\n           return contex.Entities.ToList();\n       }\n\n       #endregion\n    }\n\n     public   interface IEntityTask\n {\n     IEnumerable&lt;Entity&gt; GetAll();\n\n }\n</code></pre>\n\n<p>This is DomainService class that defined in server project : </p>\n\n<pre><code>    [EnableClientAccess()]\npublic class CrudService : DomainService\n{\n    private readonly IEntityTask _entityTask;\n\n    public CrudService(IEntityTask entityTask)\n    {\n        _entityTask = entityTask;\n    }\n\n    public IQueryable&lt;Entity&gt;  GetAll ()\n    {\n       return _entityTask.GetAll().AsQueryable();\n    }\n}\n</code></pre>\n\n<p>After these steps I don't know how to bind data to DataGrid in silverlight project. \nI've checked many links on the web but many of them use wizard to bind data to datagrid. \nHow do I bind entities to DataGrid ? </p>\n"},{"tags":["c#","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13053507,"title":"Track Entity Framework Progress","body":"<p>I am using entity framework to insert a large amount of data.\nI would like to get a Progress for the inserts (display it to the user).</p>\n\n<p>Is there anything within EF to achive this?</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":165,"score":2,"question_id":12914247,"title":"MigrateDatabaseToLatestVersion and dbo.__MigrationHistory","body":"<p>I am trying to deploy an MVC4 application that is built using EF5 codefist and migrations.</p>\n\n<p>I want the app to update the database when I in the future deploy new versions of the app with new migrations, so in Global.asax I do this:</p>\n\n<pre><code>Database.SetInitializer(new MigrateDatabaseToLatestVersion&lt;GoDealMvc4Context, Configuration&gt;());\nusing (var ctx = new GoDealMvc4Context()) {\n    ctx.Database.Initialize(false);\n}\n</code></pre>\n\n<p>The initial database on the server is deployed by attaching an MDF file copied from my dev machine. This database contains the __MigrationsHistory system table. So this database should not need to execute any migrations, because it is up to date with latest migration.</p>\n\n<p>When I try to start the app on the server, it I get this error:</p>\n\n<pre><code>There is already an object named 'UserProfile' in the database.\n\n[SqlException (0x80131904): There is already an object named 'UserProfile' in the database.]\nSystem.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction) +388\nSystem.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose) +688\nSystem.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean&amp; dataReady) +4403\nSystem.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout) +2755286\nSystem.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite) +527\nSystem.Data.SqlClient.SqlCommand.ExecuteNonQuery() +290\nSystem.Data.Entity.Migrations.DbMigrator.ExecuteSql(DbTransaction transaction, MigrationStatement migrationStatement) +247\nSystem.Data.Entity.Migrations.DbMigrator.ExecuteStatements(IEnumerable`1 migrationStatements) +202\nSystem.Data.Entity.Migrations.DbMigrator.ApplyMigration(DbMigration migration, DbMigration lastMigration) +472\nSystem.Data.Entity.Migrations.DbMigrator.Upgrade(IEnumerable`1 pendingMigrations, String targetMigrationId, String lastMigrationId) +175\nSystem.Data.Entity.MigrateDatabaseToLatestVersion`2.InitializeDatabase(TContext context) +150\nSystem.Data.Entity.Internal.InternalContext.PerformInitializationAction(Action action) +66\nSystem.Data.Entity.Internal.InternalContext.PerformDatabaseInitialization() +225\nSystem.Data.Entity.Internal.RetryAction`1.PerformAction(TInput input) +208\nSystem.Data.Entity.Internal.LazyInternalContext.InitializeDatabaseAction(Action`1 action) +235\nGoDeal.Mvc4.MvcApplication.Application_Start() +342\n</code></pre>\n\n<p>So apparently the app thinks it needs to apply a migration even though the __MigrationHistory table is present in the database with this content:</p>\n\n<pre><code>MigrationId                 Model         ProductVersion\n201210161046508_initial     0x1F8...      5.0.0.net45\n</code></pre>\n\n<p>and the app contains a single migration class:</p>\n\n<pre><code>201210161046508_initial.cs:\n\npublic partial class initial : DbMigration\n{\n    public override void Up()\n    {\n        CreateTable(\n            \"dbo.UserProfile\",\n            ....\n</code></pre>\n\n<p>So my questions are:\n1) why do my application think it needs to apply this migration when the contents of the __MigrationsHistory table is as described.</p>\n\n<p>2) is this the recommended way of making an application that automatically applies new migrations wehn restarted on a new version.</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":13033059,"title":"Entity Framework: Using ExecuteSqlCommand to clear a table causes an exception because of the ObjectStateManager","body":"<p>I an using EF5 Code First and needed a way to clear a table quickly. I therefore produced a very simple method to use ExecuteSqlCommand to provide a fast table clear. The code is below:</p>\n\n<pre><code>    public void FastClearTable(Type tableType)\n    {\n        Context.Database.ExecuteSqlCommand(\n            string.Format(\"delete from {0}\", PluraliseTableName(tableType.Name)));\n    }\n</code></pre>\n\n<p>I use this to clear a table before recalculating it. Below I have listed a simplified version of my method below. Note that the key of the table is a string (i.e. not an identity key) so I am putting in new entries with the same keys as the entries deleted by the ExecuteSqlCommand.</p>\n\n<pre><code>public int ComputeNewTableContent( IRepository&lt;MyClass&gt; rep, IUnitOfWork uow)\n{\n     if ( rep.GetUntracked().Count() &gt; 0)\n           uow.FastClearTable( typeof(MyClass));\n\n     --- compute new entries and call rep.Insert( newEntry) for each one ---\n     uow.Commit();    //This calls DbContext.SaveChanges()\n}\n</code></pre>\n\n<p>This works fine the first time but if I run it again I get an exception on the SaveChanges() command, which is called by uow.Commit(). The exception is:</p>\n\n<p>Message=\"Exception has been thrown by the target of an invocation.\"</p>\n\n<p>InnerException Message=\"The changes to the database were committed successfully, but an error occurred while updating the object context. The ObjectContext might be in an inconsistent state. Inner exception message: <strong>AcceptChanges cannot continue because the object's key values conflict with another object in the ObjectStateManager. Make sure that the key values are unique before calling AcceptChanges</strong>.\"</p>\n\n<p>If found this archived MSDN <a href=\"http://social.msdn.microsoft.com/Forums/en/adonetefx/thread/8374c10b-5e45-4c17-a9e2-5ced6ad06c7d\" rel=\"nofollow\">post</a> and at the bottom the person had the same problem, but there wasn't an answer. My view is that the memory version of the data is still present and does not know about the ExecuteSqlCommand. However I don't don't know enough about EF yet to know how to fix it.</p>\n\n<p>I can of course get round it by using a 'normal' delete but I would appreciate someone explaining what is going on and how I could handle it. That would improve my knowledge of Entity Framework.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server-2008","entity-framework","datetime","compare","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":113,"score":4,"question_id":13034266,"title":"Entity Framework and DateTime comparison with millisecond precision","body":"<p>I've got a problem with Entity Framework (Code First) under C# regarding comparison of DateTime values. I use the below defined class Validity (simplified for this example) as a superclass of of other Entities that shall have a defined validity in time.</p>\n\n<pre><code>public abstract partial class Validity {\n    [Key]\n    public int ID { get; set; }\n\n    public DateTime? ValidFrom { get; set; }\n    public DateTime? ValidTo { get; set; }\n\n    /**\n     * @brief This method builds an IQueryable from another IQueryable,\n     * with added restriction on ValidityFrom/To\n     *\n     * An object's validitiy is defined to\n     *   1. start at timestamp ValidFrom (=inclusive) and\n     *   2. to end before ValidTo (=exclusive).\n     *   3. If ValidFrom or ValidTo is NULL, it means to be \"unbounded\"\n     *      in start or end time (respectively)\n     * \n     **/\n    public static IQueryable&lt;T&gt; isValidAt&lt;T&gt;(IQueryable&lt;T&gt; query, DateTime time) where T : Validity\n    {\n        return query.Where&lt;T&gt;(c =&gt; \n               (!c.ValidFrom.HasValue || time &gt;= c.ValidFrom)  // If ValidFrom != NULL, the given timestamp must be equal or \"after\" ValidFrom\n            &amp;&amp; (!c.ValidTo.HasValue || time &lt; c.ValidTo));     // If ValidTo != NULL, the given timestamp must be \"before\" ValidTo\n    }\n\n    /**\n     * @brief Shall invalidate the object at timestamp time (implicitly sets validTo attribute).\n     **/\n    public void inValidate(DateTime time)\n    {\n        ValidTo = time;\n    }\n}\n\npublic class Item : Validity {\n    public string property { get; set; }\n}\n</code></pre>\n\n<p>At the last three lines, you'll find the class \"Item\" which we'll take as an example. Let's have a look at this query:</p>\n\n<pre><code>DateTime requestTime = DateTime.Now;\nvar items = from n in Validity.isValidAt(db.Items, requestTime)\n            select n;\n</code></pre>\n\n<p>This query should return only return Objects of class Item which are \"valid\" at \"requestTime\". Note that for ValidTo == requestTime the Item is to be regarded as \"invalid\" (the timespan ValidFrom to ValidTo is -exclusive- ValidTo; see comments in source code above). </p>\n\n<h2>The Problem</h2>\n\n<p>I actually -have- results in my result set \"items\" having <code>ValidTo == requestTime</code>. \nI just checked this via</p>\n\n<pre><code>Item i= items.FirstOrDefault();\nif ((i.ValidFrom.HasValue &amp;&amp; i.ValidFrom &gt; requestTime)\n || (i.ValidTo.HasValue &amp;&amp; requestTime &gt;= i.ValidTo)) {\n\n   // ... SOME ERROR OUTPUT ...\n\n}\n</code></pre>\n\n<p>** NOTE: This error isn't happening seldom, but nearly all the time in the software as .inValidate(requestTime); is often called to invalidate an object. ** </p>\n\n<p>I manually checked via Microsoft SQL Server Management Studio (Microsoft SQL Server 2008 is used as backend) using the produced SQL query by LinQ. I had to declare/set @p_<em>linq</em>_0, @p_<em>linq</em>_1 myself (which both mean requestTime)...</p>\n\n<pre><code>DECLARE @p__linq__0 DATETIME\nDECLARE @p__linq__1 DATETIME\nSET @p__linq__0 = '2012-10-23 15:15:11.473'\nSET @p__linq__1 = '2012-10-23 15:15:11.473'\n</code></pre>\n\n<p>This actually works as expected. But if I use '2012-10-23 15:15:11' as a value instead, I'll receive wrong results (as expected). They are similiar to those in my program. So I guess that's the problem...</p>\n\n<p>In Database the \"DateTime\" has Milliseconds defined and ValidFrom/ValidTo are stored including Milliseconds. But I assume that the query doesn't include the milliseconds part of the timestamp for any reason... The variable requestTime how ever has the milliseconds value set.</p>\n\n<p>Unfortunately I don't know how to check the actual values sent in a query to verify this. I only know how to use the items.toString()-Method to output the generated SQL, which contains placeholders.</p>\n\n<p>I tried:\n1. <code>db.Log = Console.Out;</code> which didn't compile due to an error that \"db.Log\" would not be defined (also the auto completion didn't suggest \"Log\"). Whereas db is derived from DbContext.\n2. Also casting \"items\" to ObjectQuery and then using .ToTraceString() doesn't work, program crashes at runtime with error message that cast is invalid.</p>\n\n<p>If this is important: I use .NET 4.0 and EntityFramework.5.0.0.</p>\n\n<h2>Questions</h2>\n\n<ol>\n<li>How to Log/Output the complete SQL (including values of placeholders)?</li>\n<li>How to fix that problem in an elegant way? ...I don't mean a hack that just substracts a second from the 'time' which is assigned to \"ValidTo\" in inValidate()!</li>\n</ol>\n\n<p>Best regards,</p>\n\n<p>Stefan</p>\n\n<h2>EDIT (more details found)</h2>\n\n<p>I checked what happens via the SQL profiler, which seems fine. Timestamps with high (7 digits) precisions are supplied correctly when querying. BUT: I don't get the SELECT causing the incorrect result. So I guessed: it must be some caching. So I put a <code>db.SaveChanges();</code> directly before my LINQ query. Now I got all queries in the profiler.</p>\n\n<p>I tried the following code to change the datatype in database. As it was suggested by Slauma (see <a href=\"http://stackoverflow.com/a/8044310/270591\">http://stackoverflow.com/a/8044310/270591</a>).</p>\n\n<pre><code>modelBuilder.Entity&lt;Item&gt;().Property(f =&gt; f.ValidFrom)\n  .HasColumnType(\"datetime2\").HasPrecision(3);\nmodelBuilder.Entity&lt;Item&gt;().Property(f =&gt; f.ValidTo)\n  .HasColumnType(\"datetime2\").HasPrecision(3);\n</code></pre>\n\n<p>I dropped the whole database before restart... </p>\n\n<p><strong>Result:</strong> No success using HasPrecision(x); where x is one of 0, 3; (with or without db.SaveChanges() directly before); BUT: x = 7 fairly works with db.SaveChanges(); directly before the query... </p>\n\n<p>So, unfortunately this problem is still existent... </p>\n\n<h2>Current Workaround</h2>\n\n<p>I apply the following method to any DateTime value before assigning it to a database objects property. It just rounds the DateTime to full seconds precision (which I configured at the DB). Also this is applied to any DateTime used for comparison.</p>\n\n<p>Result: This is more a hack than a solution! I will need to write access functions for all setter methods, so that a direct assignment cannot happen by accident.</p>\n\n<pre><code>    public static DateTime DateTimeDBRound(DateTime time) {\n        DateTime t = time;\n        long fraction = (t.Ticks % TimeSpan.TicksPerSecond);\n        if (fraction &gt;= TimeSpan.TicksPerSecond / 2)\n        {\n            t = t.AddTicks(TimeSpan.TicksPerSecond - fraction);\n        }\n        else\n        {\n            t = t.AddTicks(-fraction);\n        }\n        return t;\n    }\n</code></pre>\n"},{"tags":["c#","sql","entity-framework","master-detail"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13046614,"title":"Select error on EF using existing master detail database","body":"<p>Entity Framework v5 looks cool and I try to switch from Linq-to-SQL with <strong>existing</strong> MSSQL (Azure) database.\nbut tutorials about EF are too complex to follow.</p>\n\n<p>The database schema is pretty simple as follows (generated by exist db).</p>\n\n<p><em>Sheets</em> and <em>SheetDetails</em> tables are connected with 1-to-many relationship.</p>\n\n<pre><code>CREATE TABLE [dbo].[Sheets] (\n    [Id]          INT            IDENTITY (1, 1) NOT NULL,\n    [Grade]       FLOAT (53)     CONSTRAINT [DF_Sheets_Grade] DEFAULT ((0)) NOT NULL,\n    [Title]       NVARCHAR (255) CONSTRAINT [DF_Sheets_Title] DEFAULT ('') NOT NULL,\n    [Description] NVARCHAR (255) NULL,\n    [Difficulty]  SMALLINT       CONSTRAINT [DF_Sheets_Difficulty] DEFAULT ((0)) NOT NULL,\n    [Writer]      NVARCHAR (255) CONSTRAINT [DF_Sheets_Writer] DEFAULT ('') NOT NULL,\n    [Tag]         NVARCHAR (255) NULL,\n    [Duration]    FLOAT (53)     CONSTRAINT [DF_Sheets_Duration] DEFAULT ((0)) NOT NULL,\n    [Timestamp]   DATETIME       CONSTRAINT [DF_Sheets_Timestamp] DEFAULT ((0)) NOT NULL,\n    [RowVersion]  ROWVERSION     NOT NULL,\n    CONSTRAINT [PK_Sheets] PRIMARY KEY CLUSTERED ([Id] ASC)\n);\n\nCREATE TABLE [dbo].[SheetDetails] (\n    [Id]                   INT        IDENTITY (1, 1) NOT NULL,\n    [Score]                FLOAT (53) CONSTRAINT [DF_SheetDetails_Score] DEFAULT ((0)) NOT NULL,\n    [Number]               SMALLINT   CONSTRAINT [DF_SheetDetails_Number] DEFAULT ((0)) NOT NULL,\n    [SubNumer]             SMALLINT   NULL,\n    [IsRandom]             BIT        CONSTRAINT [DF_SheetDetails_IsRandom] DEFAULT ((0)) NOT NULL,\n    [AnswerType]           SMALLINT   CONSTRAINT [DF_SheetDetails_AnswerType] DEFAULT ((0)) NOT NULL,\n    [RowVersion]           ROWVERSION NOT NULL,\n    [SheetDetail_Sheet]    INT        CONSTRAINT [DF_SheetDetails_SheetDetail_Sheet] DEFAULT ((0)) NOT NULL,\n    [SheetDetail_Question] INT        CONSTRAINT [DF_SheetDetails_SheetDetail_Question] DEFAULT ((0)) NOT NULL,\n    CONSTRAINT [SheetDetail_Sheet] FOREIGN KEY ([SheetDetail_Sheet]) REFERENCES [dbo].[Sheets] ([Id]) ON DELETE CASCADE\n);\n</code></pre>\n\n<p>Note that the FK name is SheetDetail_Sheet in SheetDetails table.</p>\n\n<p>Result diagram is as below.\n<img src=\"http://i.stack.imgur.com/T17kQ.png\" alt=\"enter image description here\"></p>\n\n<p>Next, maybe I need to write EntityTypeConfiguration.\nI tried it as question 1.</p>\n\n<p><strong>Question 1.</strong>\nI wrote model creating configuration as follows but no luck. is it wrong? hard to know how to write right configuration with this simple database model.</p>\n\n<pre><code>    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new SheetsConfiguration());\n        base.OnModelCreating(modelBuilder);\n    }\n\n    public class SheetsConfiguration : EntityTypeConfiguration&lt;Sheets&gt;\n    {\n        public SheetsConfiguration()\n            : base()\n        {\n            HasKey(p =&gt; p.Id);\n            Property(p =&gt; p.Id).HasColumnName(\"Id\").HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity).IsRequired();\n            Property(p =&gt; p.RowVersion).IsConcurrencyToken().IsRowVersion();\n            HasOptional(p =&gt; p.SheetDetails).WithMany().Map(x =&gt; x.MapKey(\"SheetDetail_Sheet\"));\n            ToTable(\"Sheets\");\n        }\n    }\n</code></pre>\n\n<p>I execute simple query using</p>\n\n<pre><code>var result = _db.Sheets.Where(sheet =&gt; sheet.Id == id).ToList();\n</code></pre>\n\n<p>And then, I got an error \"Invalid column name SheetDetail_Sheet\" with executed query as follows.</p>\n\n<pre><code>SELECT \n[Extent1].[Id] AS [Id], \n[Extent1].[Grade] AS [Grade], \n[Extent1].[Title] AS [Title], \n[Extent1].[Description] AS [Description], \n[Extent1].[Difficulty] AS [Difficulty], \n[Extent1].[Writer] AS [Writer], \n[Extent1].[Tag] AS [Tag], \n[Extent1].[Duration] AS [Duration], \n[Extent1].[Timestamp] AS [Timestamp], \n[Extent1].[RowVersion] AS [RowVersion], \n[Extent1].[SheetDetail_Sheet] AS [SheetDetail_Sheet]\nFROM [dbo].[Sheets] AS [Extent1]\nWHERE [Extent1].[Id] = @p__linq__0\n</code></pre>\n\n<p>I can understand because <strong>SheetDetail_Sheet is just an FK</strong> and not exist in the edmx properties and database column.\nHow can I fix it? </p>\n\n<p>I don't want to edit auto-generated model file because it can be overwritten. maybe it seems to be achieved with EntityTypeConfiguration.</p>\n\n<p><strong>Question 2.</strong>\nIs there any useful and lightweight reference with the commonly used master-detail database model? </p>\n\n<p>I'm in trouble to start with existing database.\nstackoverflow, asp.net, blogs, etc...to many tutorials but hard to find an example like my case.</p>\n\n<p>Thank you.</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-4.3"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13047868,"title":"Entity Framework Code First: Querying many to many navigation properties without loading into memory","body":"<p>I would like to know the best way to query a many to many relationship without first loading all of the relationship objects into memory.</p>\n\n<p>For example, Category and Article have a many to many relationship. This means my Category class has a (lazy-loaded) navigation property as so:</p>\n\n<pre><code>class Category\n{\n     public long Id {get; set;}\n     public ICollection&lt;Articles&gt; Articles {get; set;}\n}\n</code></pre>\n\n<p>If I want to select only the articles that are visible, I can query the navigation property like so:</p>\n\n<pre><code>category.Articles.Where(a =&gt; a.IsVisible)\n</code></pre>\n\n<p>However as far as I am aware, this will load all the related articles into memory before doing the IsVisible check.</p>\n\n<p>Is it possible to query the related articles without loading them into memory, i.e. act on an IQueryable rather than an ICollection? If this were a one to many relationship then I could query the Article DbSet directly to achieve what I am after but the many to many relationship is stored in a link table in sql, meaning I am unable to query this using a DbSet. Is my only option to write the raw sql manually that will query the link table?</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13046149,"title":"Why disposed the ObjectContext instance?","body":"<p>can someone help me here, why I get the exception \"The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.\" in the following section?</p>\n\n<pre><code>    public virtual IEnumerable&lt;TEntity&gt; Get(Expression&lt;Func&lt;TEntity, bool&gt;&gt; filter, Func&lt;IQueryable&lt;TEntity&gt;, IOrderedQueryable&lt;TEntity&gt;&gt; orderBy)\n    {\n        if (this.CheckAccess(this.OnCanRead))\n        {\n            try\n            {\n                Expression&lt;Func&lt;TEntity, bool&gt;&gt; baseFilter = this.GetFilter(this.OnFilter);\n\n                IQueryable&lt;TEntity&gt; result = this.Set.AsQueryable();\n\n                if (baseFilter != null)\n                {\n                    result = result.Where(baseFilter);\n                }\n\n                if (filter != null)\n                {\n                    result = result.Where(filter);\n                }\n\n                if (orderBy == null)\n                {\n                    return result.ToList();\n                }\n                else\n                {\n                    return orderBy(result).ToList();\n                }\n            }\n            catch (Exception)\n            {\n                throw;\n            }\n        }\n        else\n        {\n            throw new AccessException(\"CanRead\");\n        }\n    }\n</code></pre>\n\n<p>Before calling the following point still exists the ObjectContext:</p>\n\n<pre><code>                if (baseFilter != null)\n                {\n                    result = result.Where(baseFilter);\n                }\n\n                if (filter != null)\n                {\n                    result = result.Where(filter);\n                }\n</code></pre>\n\n<p>Why no longer?</p>\n\n<p><strong>- EDIT -</strong></p>\n\n<p>More Informations:</p>\n\n<p>Here the class using the function where the problem occurs:\n<a href=\"http://entityframeworkext.codeplex.com/SourceControl/changeset/view/16211#382544\" rel=\"nofollow\">DbContextRepository</a> </p>\n\n<p>In my program, there is a class called ShopRepository, which is derived from:</p>\n\n<pre><code>public class ShopRepository : DbContextRepository&lt;Shop&gt;\n</code></pre>\n\n<p>Furthermore, there is a DataManager in my program what the problematic function is called: </p>\n\n<pre><code>public static class DataManager\n{\n    public static void Initialize()\n    {\n        Initializer.Initializer.SetInitializer();\n\n        ObjectFactory.Configure(\n           x =&gt;\n           {\n               x.For&lt;DbContext&gt;().Use&lt;DataContext&gt;();\n               x.For&lt;IUnitOfWorkFactory&gt;().Use&lt;DbContextUnitOfWorkFactory&gt;();\n           }\n        );\n\n        DbContextUnitOfWorkFactory.SetDbContext(CreateContext);\n    }\n\n    private static DbContext CreateContext()\n    {\n        return new DataContext();\n    }\n\n    private static ShopRepository _shops;\n\n    public static ShopRepository Shops\n    {\n        get\n        {\n            if (DataManager._shops == null)\n            {\n                DataManager._shops = ObjectFactory.GetInstance&lt;ShopRepository&gt;();\n            }\n\n            return DataManager._shops;\n        }\n    }\n</code></pre>\n\n<p><strong>- EDIT -</strong></p>\n\n<p>I have found the problem, but I do not know how to fix it. \nIf in the ShopRepository the event OnFilter a dynamic value is returned, such as</p>\n\n<pre><code>x =&gt; x.InstallationId == InstallationRepository.CurrentInstallationId\n</code></pre>\n\n<p>then error occurs, if there a fixed value such as</p>\n\n<pre><code>x =&gt; x.InstallationId == 1\n</code></pre>\n\n<p>is returned, no error occurs. </p>\n"},{"tags":["asp.net-mvc","entity-framework","production-environment"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":111,"score":2,"question_id":13048898,"title":"Entity Framework 5 - Code First Production Preparation","body":"<p>As part of our intended migration from Linq2Sql to Entity Framework, we have created a small EF model consisting of ten entities.  Because we are working with a legacy application we are using the 'code first' option and manually mapping our POCO objects to tables within the database.  <strong>We do not want the Entity Framework code to update the database.</strong>  I believe that the following is all I need to do to achieve this - I would appreciate confirmation as I was not sure whether the SetInitializer code should go here or perhaps in the Global.asax code.</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n    Database.SetInitializer&lt;InboxDataContext&gt;(null);\n\n    modelBuilder.Configurations.Add(new Subscribers.Mapping.DataSourceMap());\n    modelBuilder.Configurations.Add(new Subscribers.Mapping.SubscriberMap());\n    ...\n}\n</code></pre>\n\n<p>As part of this update, we have created a small test page (MVC controller and views) and added it to our main application project.  During development and testing this has worked well.  The only thing we did notice is that if we updated the underlying EF model, the initial page load seemed to take several minutes to render.  I assumed this was because EF had to rebuild its views and mappings to reflect the changes - to my disgrace, I didn't worry too much about this as a) I don't have a full understanding of how this works and b) it only seemed happened on model changes.</p>\n\n<p>This morning we loaded this update to the production server for initial testing and this time the initial load problem became much worse - so much so in fact that the test page never loaded.</p>\n\n<p>So, to get to my questions:</p>\n\n<ol>\n<li>Is there anything else I should/should not be doing to prepare my\napplication for production? </li>\n<li>How can I improve the initial load performance?</li>\n<li>How can I find out why the initial load on the production server\nnever completes - I am not seeing any error messages?</li>\n</ol>\n\n<p>I did try downloading the Entity Framework Power Tools and running the 'Generate Views' option on the derived DbContext class, but since I could only run this in the development environment I was not sure whether this would work when copied to the production server - it didn't appear to.</p>\n\n<p>I should mention that the development environment contains just one hundred records in the main table and the production environment contains almost one million records (same schemas), again I wasn't sure if this would make any difference.</p>\n\n<p>Any help advice would be appreciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net-mvc","entity-framework","entity-framework-4","entity-framework-4.1","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":13047845,"title":"How to include a child object's child object in Entity Framework 5","body":"<p>I am using <code>Entity Framework 5 code first</code> and <code>ASP.NET MVC 3</code>.</p>\n\n<p>I am struggling to get a child object's child object to populate.  Below are my classes..</p>\n\n<p>Application class;</p>\n\n<pre><code>public class Application\n{\n     // Partial list of properties\n\n     public virtual ICollection&lt;Child&gt; Children { get; set; }\n}\n</code></pre>\n\n<p>Child class:</p>\n\n<pre><code>public class Child\n{\n     // Partial list of properties\n\n     public int ChildRelationshipTypeId { get; set; }\n\n     public virtual ChildRelationshipType ChildRelationshipType { get; set; }\n}\n</code></pre>\n\n<p>ChildRelationshipType class:</p>\n\n<pre><code>public class ChildRelationshipType\n{\n     public int Id { get; set; }\n\n     public string Name { get; set; }\n}\n</code></pre>\n\n<p>Part of GetAll method in the repository to return all the applications:</p>\n\n<pre><code>return DatabaseContext.Applications\n     .Include(\"Children\");\n</code></pre>\n\n<p>The Child class contains a reference to the ChildRelationshipType class.  To work with an application's children I would have something like this:</p>\n\n<pre><code>foreach (Child child in application.Children)\n{\n     string childName = child.ChildRelationshipType.Name;\n}\n</code></pre>\n\n<p>I get an error here that the object context is already closed.</p>\n\n<p>How do I specify that each child object must include the ChildRelationshipType object like what I did above?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13048742,"title":"EF Code First Not creating database","body":"<p>I have copied my code across into a new project and I am failing to see any .mdf or .log files generated after running. Under Data Connections I can see and interact with the tables in the database, yet no files are created within the App_Data folder.</p>\n\n<p>Here is my DB context class:</p>\n\n<pre><code>public class BareCupboardDB : DbContext\n{\n    public DbSet&lt;Recipe&gt; Recipes { get; set; }\n    public DbSet&lt;NutritionalValue&gt; NutritionalValues { get; set; }\n    public DbSet&lt;RecipeStep&gt; RecipeSteps { get; set; }\n    public DbSet&lt;Ingredient&gt; Ingredients { get; set; }\n    public DbSet&lt;RecipeIngredient&gt; RecipeIngredients { get; set; }\n}\n</code></pre>\n\n<p>My Application_Start() code:</p>\n\n<pre><code>protected void Application_Start()\n    {\n        AreaRegistration.RegisterAllAreas();\n\n        WebApiConfig.Register(GlobalConfiguration.Configuration);\n        FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);\n        RouteConfig.RegisterRoutes(RouteTable.Routes);\n        BundleConfig.RegisterBundles(BundleTable.Bundles);\n        AuthConfig.RegisterAuth();\n\n        //System.Data.Entity.Database.SetInitializer(new BareCupboard.Models.RecipeContextInitializer());\n        Database.SetInitializer(new CreateDatabaseIfNotExists&lt;BareCupboardDB&gt;());\n\n        var context = new BareCupboardDB();\n        context.Database.Initialize(true);\n    }\n</code></pre>\n\n<p>And my connection string:</p>\n\n<pre><code>&lt;add name =\"testConnection\"\n     connectionString=\"data source= .\\SQLExpress;Integrated Security=SSPI;Initial Catalog=BareCupboardDB\"\n     providerName=\"System.Data.SqlClient\"/&gt;\n</code></pre>\n\n<p>As far as I can see, this should absolutely generate my database files.</p>\n\n<p>I appreciate any help.</p>\n\n<p>Many thanks.</p>\n"},{"tags":["sql","asp.net-mvc-3","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":226,"score":1,"question_id":11596699,"title":"Convert SQL to LINQ in MVC3 with Ninject","body":"<p>I'm using MVC3 and still learning LINQ.  I'm having some trouble trying to convert a query to LINQ to Entities.  I want to return an employee object.</p>\n\n<pre><code>SELECT E.EmployeeID, E.FirstName, E.LastName, MAX(EO.EmployeeOperationDate) AS \"Last Operation\"\nFROM Employees E \nINNER JOIN EmployeeStatus ES ON E.EmployeeID = ES.EmployeeID\nINNER JOIN EmployeeOperations EO ON ES.EmployeeStatusID = EO.EmployeeStatusID\nINNER JOIN Teams T ON T.TeamID = ES.TeamID\nWHERE T.TeamName = 'MyTeam'\nGROUP BY E.EmployeeID, E.FirstName, E.LastName\nORDER BY E.FirstName, E.LastName\n</code></pre>\n\n<p>What I have is a few tables, but I need to get only the newest status based on the EmployeeOpertionDate.  This seems to work fine in SQL.  I'm also using Ninject and set my query to return Ienumerable.  I played around with the group by option but it then returns IGroupable.  Any guidance on converting and returning the property object type would be appreciated. </p>\n\n<p>Edit:  I started writing this out in LINQ but I'm not sure how to properly return the correct type or cast this.</p>\n\n<pre><code>public IQueryable&lt;Employee&gt; GetEmployeesByTeam(int teamID)\n    {\n\n        var q = from E in context.Employees\n                join ES in context.EmployeeStatuses on E.EmployeeID equals ES.EmployeeID\n                join EO in context.EmployeeOperations on ES.EmployeeStatusID equals EO.EmployeeStatusID\n                join T in context.Teams on ES.TeamID equals T.TeamID\n                where T.TeamName == \"MyTeam\"\n                group E by E.EmployeeID into G\n                select G;\n        return q;\n    }\n</code></pre>\n\n<p>Edit2:</p>\n\n<p>This seems to work for me</p>\n\n<pre><code>public IQueryable&lt;Employee&gt; GetEmployeesByTeam(int teamID)\n    {\n\n        var q = from E in context.Employees\n                join ES in context.EmployeeStatuses on E.EmployeeID equals ES.EmployeeID\n                join EO in context.EmployeeOperations.OrderByDescending(eo =&gt; eo.EmployeeOperationDate) on ES.EmployeeStatusID equals EO.EmployeeStatusID\n                join T in context.Teams on ES.TeamID equals T.TeamID\n                where T.TeamID == teamID\n                group E by E.EmployeeID into G\n                select G.FirstOrDefault();\n        return q;\n    }\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":2,"favorite_count":7,"up_vote_count":11,"down_vote_count":0,"view_count":8257,"score":11,"question_id":7795300,"title":"Validation failed for one or more entities. See 'EntityValidationErrors' property for more details","body":"<p>I am having this error when seeding my database with code first approach.</p>\n\n<p>Validation failed for one or more entities. See 'EntityValidationErrors' property for more details.</p>\n\n<p>To be honest I dont know how to check the content of the validation errors, Visual Studio shows me that its an array with 8 objects. so 8 validation Errors.</p>\n\n<p>This was working with my previous model, but I made a few changes that I explain below:\n- I had an enum called Status, I changed it to a class called Status\n- I changed the class ApplicantsPositionHistory to have 2 foreign key to the same table</p>\n\n<p>Excuse me for the long code, but I have to paste it all.  The exception is thrown in the last line of the following code.</p>\n\n<pre><code>namespace Data.Model\n{  \n\n    public class Position\n    {\n        [DatabaseGenerated(System.ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)]   \n        public int PositionID { get; set; }\n\n        [Required(ErrorMessage = \"Position name is required.\")]\n        [StringLength(20, MinimumLength = 3, ErrorMessage = \"Name should not be longer than 20 characters.\")]\n        [Display(Name = \"Position name\")]              \n        public string name { get; set; }\n\n        [Required(ErrorMessage = \"Number of years is required\")] \n        [Display(Name = \"Number of years\")]        \n        public int yearsExperienceRequired { get; set; }\n\n        public virtual ICollection&lt;ApplicantPosition&gt; applicantPosition { get; set; }\n    }\n\n    public class Applicant\n    {\n        [DatabaseGenerated(System.ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)]      \n        public int ApplicantID { get; set; }\n\n        [Required(ErrorMessage = \"Name is required\")] \n        [StringLength(20, MinimumLength = 3, ErrorMessage=\"Name should not be longer than 20 characters.\")]\n        [Display(Name = \"First and LastName\")]\n        public string name { get; set; }\n\n        [Required(ErrorMessage = \"Telephone number is required\")] \n        [StringLength(10, MinimumLength = 3, ErrorMessage = \"Telephone should not be longer than 20 characters.\")]\n        [Display(Name = \"Telephone Number\")]\n        public string telephone { get; set; }\n\n        [Required(ErrorMessage = \"Skype username is required\")] \n        [StringLength(10, MinimumLength = 3, ErrorMessage = \"Skype user should not be longer than 20 characters.\")]\n        [Display(Name = \"Skype Username\")]\n        public string skypeuser { get; set; }\n\n        public byte[] photo { get; set; }\n\n        public virtual ICollection&lt;ApplicantPosition&gt; applicantPosition { get; set; }\n\n\n    }\n\n    public class ApplicantPosition\n    {\n        [Key]\n        [Column(\"ApplicantID\", Order = 0)]\n        public int ApplicantID { get; set; }\n\n        [Key]\n        [Column(\"PositionID\", Order = 1)]\n        public int PositionID { get; set; }\n\n        public virtual Position Position { get; set; }\n\n        public virtual Applicant Applicant { get; set; }\n\n        [Required(ErrorMessage = \"Applied date is required\")] \n        [DisplayFormat(DataFormatString = \"{0:d}\", ApplyFormatInEditMode = true)]\n        [Display(Name = \"Date applied\")]     \n        public DateTime appliedDate { get; set; }\n\n        [Column(\"StatusID\", Order = 0)]\n        public int StatusID { get; set; }\n\n        public Status CurrentStatus { get; set; }\n\n\n        //[NotMapped]\n        //public int numberOfApplicantsApplied\n        //{\n        //    get\n        //    {\n        //        int query =\n        //             (from ap in Position\n        //              where ap.Status == (int)Status.Applied\n        //              select ap\n        //                  ).Count();\n        //        return query;\n        //    }\n        //}\n    }\n\n\n    public class Address\n    {\n        [StringLength(20, MinimumLength = 3, ErrorMessage = \"Country should not be longer than 20 characters.\")]\n        public string Country { get; set; }\n\n        [StringLength(20, MinimumLength = 3, ErrorMessage = \"City  should not be longer than 20 characters.\")]\n        public string City { get; set; }\n\n        [StringLength(50, MinimumLength = 3, ErrorMessage = \"Address  should not be longer than 50 characters.\")]\n        [Display(Name = \"Address Line 1\")]     \n        public string AddressLine1 { get; set; }\n\n        [Display(Name = \"Address Line 2\")]\n        public string AddressLine2 { get; set; }   \n\n    }\n\n\n\n    public class ApplicationPositionHistory\n    {\n        [DatabaseGenerated(System.ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)]\n        public int ApplicationPositionHistoryID { get; set; }\n\n        public ApplicantPosition applicantPosition { get; set; }\n\n        [Column(\"oldStatusID\")]\n        public int oldStatusID { get; set; }\n\n        [Column(\"newStatusID\")]\n        public int newStatusID { get; set; }\n\n        public Status oldStatus { get; set; }\n\n        public Status newStatus { get; set; }\n\n        [StringLength(500, MinimumLength = 3, ErrorMessage = \"Comments  should not be longer than 500 characters.\")]\n        [Display(Name = \"Comments\")]\n        public string comments { get; set; }\n\n        [DisplayFormat(DataFormatString = \"{0:d}\", ApplyFormatInEditMode = true)]\n        [Display(Name = \"Date\")]     \n        public DateTime dateModified { get; set; }\n    }\n\n    public class Status\n    {\n        [DatabaseGenerated(System.ComponentModel.DataAnnotations.DatabaseGeneratedOption.Identity)]\n        public int StatusID { get; set; }\n\n        [StringLength(20, MinimumLength = 3, ErrorMessage = \"Status  should not be longer than 20 characters.\")]\n        [Display(Name = \"Status\")]\n        public string status { get; set; }\n\n    }\n\n\n\n}\n\n\n\n\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Data.Entity;\nusing System.IO;\n\nnamespace Data.Model\n{\n    public class HRContextInitializer : DropCreateDatabaseAlways&lt;HRContext&gt;\n    {\n        protected override void Seed(HRContext context)\n        {\n            #region Status\n            Status applied = new Status() { status = \"Applied\" };\n            Status reviewedByHR = new Status() { status = \"Reviewed By HR\" };\n            Status approvedByHR = new Status() { status = \"Approved by HR\" };\n            Status rejectedByHR = new Status() { status = \"Rejected by HR\" };\n            Status assignedToTechnicalDepartment = new Status() { status = \"Assigned to Technical Department\" };\n            Status approvedByTechnicalDepartment = new Status() { status = \"Approved by Technical Department\" };\n            Status rejectedByTechnicalDepartment = new Status() { status = \"Rejected by Technical Department\" };\n\n            Status assignedToGeneralManager = new Status() { status = \"Assigned to General Manager\" };\n            Status approvedByGeneralManager = new Status() { status = \"Approved by General Manager\" };\n            Status rejectedByGeneralManager = new Status() { status = \"Rejected by General Manager\" };\n\n            context.Status.Add(applied);\n            context.Status.Add(reviewedByHR);\n            context.Status.Add(approvedByHR);\n            context.Status.Add(rejectedByHR);\n            context.Status.Add(assignedToTechnicalDepartment);\n            context.Status.Add(approvedByTechnicalDepartment);\n            context.Status.Add(rejectedByTechnicalDepartment);\n            context.Status.Add(assignedToGeneralManager);\n            context.Status.Add(approvedByGeneralManager);\n            context.Status.Add(rejectedByGeneralManager); \n            #endregion    \n\n            #region Position\n            Position netdeveloper = new Position() { name = \".net developer\", yearsExperienceRequired = 5 };\n            Position javadeveloper = new Position() { name = \"java developer\", yearsExperienceRequired = 5 };\n            context.Positions.Add(netdeveloper);\n            context.Positions.Add(javadeveloper); \n            #endregion\n\n            #region Applicants\n            Applicant luis = new Applicant()\n            {\n                name = \"Luis\",\n                skypeuser = \"le.valencia\",\n                telephone = \"0491732825\",\n                photo = File.ReadAllBytes(@\"C:\\Users\\LUIS.SIMBIOS\\Documents\\Visual Studio 2010\\Projects\\SlnHR\\HRRazorForms\\Content\\pictures\\1.jpg\")\n            };\n\n            Applicant john = new Applicant()\n            {\n                name = \"John\",\n                skypeuser = \"jo.valencia\",\n                telephone = \"3435343543\",\n                photo = File.ReadAllBytes(@\"C:\\Users\\LUIS.SIMBIOS\\Documents\\Visual Studio 2010\\Projects\\SlnHR\\HRRazorForms\\Content\\pictures\\2.jpg\")\n            };\n\n            context.Applicants.Add(luis);\n            context.Applicants.Add(john); \n            #endregion\n\n            #region ApplicantsPositions\n            ApplicantPosition appicantposition = new ApplicantPosition()\n            {\n                Applicant = luis,\n                Position = netdeveloper,\n                appliedDate = DateTime.Today,\n                StatusID = 1\n            };\n\n            ApplicantPosition appicantposition2 = new ApplicantPosition()\n            {\n                Applicant = john,\n                Position = javadeveloper,\n                appliedDate = DateTime.Today,\n                StatusID = 1\n            };        \n\n            context.ApplicantsPositions.Add(appicantposition);            \n            context.ApplicantsPositions.Add(appicantposition2); \n            #endregion\n\n            context.SaveChanges(); ---&gt;&gt; Error here\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":448,"score":0,"question_id":9472508,"title":"getdate() not working with Entity Framework","body":"<p>So I have a column named <code>Timestamp</code> in my database with a default value of <code>GetDate()</code>.  </p>\n\n<p>Whenever I use Entity Framework to insert a record, <code>Timestamp</code> is <code>null</code>.</p>\n\n<p>Why is this the case?</p>\n"},{"tags":["c#","database","sql-server-2008","entity-framework","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13046375,"title":"Removing Parent with one-to-many EntityFramework","body":"<p>I have this class ( Simplified )</p>\n\n<pre><code>public class User {\n    public string Username { get; set; }\n    public virtual Section Section { get; set; }\n}\n\npublic class Section {\n    public int DepartmentNumber { get; set; }\n    public virtual ICollection&lt;User&gt; DepartmentMembers { get; set; }\n}\n</code></pre>\n\n<p>What i try to achive is to delete a section. All users related to this section shoulde get a null value. This dosent work now because REFERENCE constraint \"FK_Users_Sections_Section\".</p>\n\n<p>What woulde be the correct way to do this? woulde i have to remove all users from this section before deleteing it? Is there a more elegant way to do this? Im using EntityFramework.</p>\n\n<p>My fluent API for this field:</p>\n\n<pre><code>modelBuilder.Entity&lt;User&gt;()\n            .HasOptional(u =&gt; u.Section)\n            .WithMany(s =&gt; s.DepartmentMembers)\n            .Map(m =&gt;\n                m.MapKey(\"Section\")\n            )\n            .WillCascadeOnDelete(false);\n</code></pre>\n\n<p>The WillCascadeOnDelete i have tried it by setting to false, removing the line and also adding the line with no arguments. </p>\n\n<p>I guess the solution is quit simple but i cant find any good explaination ( or mabye i dont understand the explainations i have been looking at. )</p>\n"},{"tags":[".net","entity-framework","dependency-injection","ef-code-first","ninject"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":1,"question_id":13033731,"title":"injecting username as constructor parameter to repository using Ninject","body":"<p>I found serveral questions using parameter passing to a constructor but i can't translate it to my specific problem. </p>\n\n<p>I'm studying EF codefirst in combination with MVC.</p>\n\n<p>I've created an abstract class and an interface as a base:</p>\n\n<pre><code>public abstract class RepositoryBase&lt;C, T&gt; : IRepositoryBase&lt;T&gt; \n    where T: class where C : DbContext,  new()\n\npublic interface IRepositoryBase&lt;T&gt; where T : class\n</code></pre>\n\n<p>for my model repositories iv'e created in concrete class with an interface </p>\n\n<pre><code>public interface ICustomerRepository : IRepositoryBase&lt;Customer&gt;\n\npublic class CustomerRepository: RepositoryBase&lt;PNMP, Customer&gt;,\n    ICustomerRepository\n</code></pre>\n\n<p>the PNMP (my code first context) only has a constructor that accepts the user identity for tracking changes setting the internal parameter _username</p>\n\n<pre><code>public override int SaveChanges()\n{\n    var changeSet = ChangeTracker.Entries&lt;IDatabaseBaseType&gt;();\n\n    if (changeSet != null)\n    {\n        var modifiedEntries =\n            changeSet.Where(c =&gt; c.State== EntityState.Modified);\n\n        foreach (var entry in modifiedEntries)\n        {\n            entry.Entity.ModifiedDate = DateTime.Now;\n            entry.Entity.ModifiedBy = _username;\n        }\n\n        var addedEntries =\n            changeSet.Where(c =&gt; c.State == EntityState.Added);\n\n        foreach (var entry in addedEntries)\n        {\n            entry.Entity.CreatedDate = DateTime.Now;\n            entry.Entity.CreatedBy = _username;\n        }\n    }\n    return base.SaveChanges();\n}\n</code></pre>\n\n<p>how can i pass my identity variable to my constructor of the PNMP (context)</p>\n\n<p>I'm using Ninject.MVC3 for binding the concrete class to the interface using :</p>\n\n<pre><code>kernel.Bind&lt;ICustomerRepository&gt;().To&lt;CustomerRepository&gt;();\n</code></pre>\n"},{"tags":["c#","entity-framework",".net-4.0","exception-handling","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":13046526,"title":"Notsupportedexception was unhandled by user code","body":"<p>My code:</p>\n\n<pre><code>i f(!string.IsNullOrWhiteSpace(gender))\n    if (gender == \"NULL\")\n        predicate = predicate.And(x =&gt; string.IsNullOrWhiteSpace(gender));\n    else\n        predicate = predicate.And(x =&gt; x.Gender == gender);\n</code></pre>\n\n<p>When gender is NULL and when I am executing the flowing line:</p>\n\n<pre><code>var filteredUsers = _personExtendedRepository.GetMany(predicate).ToList();\n</code></pre>\n\n<p>an error occurs:</p>\n\n<blockquote>\n  <p>\"LINQ to Entities does not recognize the method 'Boolean IsNullOrWhiteSpace(System.String)' method, and this method cannot be translated into a store expression.\"</p>\n</blockquote>\n\n<p><strong>Note</strong>:\nWhen I am executing the following line in SQL Server Management Studio:</p>\n\n<pre><code>SELECT * FROM UVW_Sample WHERE Gender IS NULL\n</code></pre>\n\n<p>Records are displaying. Please help how to solve this issue.</p>\n"},{"tags":["c#",".net","entity-framework","3-tier"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13045880,"title":"Layers and Entities?","body":"<p><em>(I'm gonna ask 2 question please).</em></p>\n\n<p>We use 3 layers: Bl , Dal , UI.</p>\n\n<p><img src=\"http://i.stack.imgur.com/vMlew.jpg\" alt=\"enter image description here\"></p>\n\n<p>We didn't want to build one big <code>BL</code> , <code>DAL</code> for All Objects.</p>\n\n<p>So we created this structure both for <code>Agents</code> and <code>Leads</code>.</p>\n\n<p>Now lets say I should write a method : </p>\n\n<pre><code>public Agent GetAgentByLead(Lead leadObj)\n {\n }\n</code></pre>\n\n<p><kbd>Question #1</kbd></p>\n\n<p>Where does this function should reside on : <code>AgentsBL</code> or <code>LeadsBL</code> ? </p>\n\n<p><kbd>Question #2</kbd></p>\n\n<p>Lets say I want to use Entity Framework.</p>\n\n<p>A query can be  : </p>\n\n<pre><code>var activeAgents= context.Agents.Where(c =&gt; c.ACTIVE).ToList();\n</code></pre>\n\n<p>This line can be executed in <code>myPage.aspx.cs</code> file.</p>\n\n<p>so <em>where</em> are the layers here ? Where will context resides ?</p>\n\n<p>I just dont see how EF deals with layers ( like my first question ) </p>\n\n<p>Any help please?</p>\n"},{"tags":["wpf","entity-framework","optimistic"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":38,"score":-3,"question_id":13045364,"title":"Entity Framework Timestamp Optimistic concurrency Client using WPF","body":"<blockquote>\n  <p>Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.</p>\n</blockquote>\n\n<p>This is because timestamp has changed after I save last time,how could I make the changed Timestamp return to the Client Entity. I try to reload the entity after the saveaction but its not changed;Why??</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13045303,"title":"linq function to handle : both fields equal or both null or empty","body":"<p>Hi I have a linq query where I compare an object with all other entity stored in my database. Firstname and lastname are mandatory fields so I don't have to check for null. But in the case of street I have to do these checks. </p>\n\n<p>I want to match if both fields are null or empty strings or that they are the same. The below linq query is working fine. </p>\n\n<p>But I was wandering isn't there any way to make it more readable. For example with a custom function like <strong>Bool FieldsAreEqualOrBothNullOrEmpty(r.street, request.street)</strong> </p>\n\n<p>Can't figure how to do that and if it's possible. </p>\n\n<pre><code>var same = \n   from r in db.Requests\n   where r.firstName.ToLower() == request.firstName.ToLower()\n      &amp;&amp; r.lastName.ToLower() == request.lastName.ToLower()\n\n      //Seems long to just compare two fields\n      &amp;&amp; ( string.IsNullOrEmpty(r.street) &amp;&amp; string.IsNullOrEmpty(request.street) ) \n         || r.street.ToLower() == request.street.ToLower()\n\n      select r;\nreturn same;\n</code></pre>\n"},{"tags":["entity-framework","unit-testing","mocking","tdd"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13045499,"title":"Testing repository with DbContext - mocking issue concerning IDbSet","body":"<p>I am trying to test a repository that uses DbContext</p>\n\n<p>The issue I am running into is that DbCOntext wants to return DbSet for certain types</p>\n\n<p>I can't even mock IDbSet as it has a PRIVATE CTOR?!?!?!</p>\n\n<p>How is everyone getting over this?</p>\n"},{"tags":["entity-framework","architecture","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13044265,"title":"repositories, interfaces, aggregate roots etc with regard to table joins","body":"<p>I am slowly trying to improve my knowledge of Enterprise Application Development. With regard to best practices I have learned about creating concrete repository implementations of iRepository interfaces and so far it makes sense.</p>\n\n<p>Where I am challenged is when (as it often happens) I want to return data that is coming from two or more tables in one result set, and how to best approach this.</p>\n\n<p>I understand that identifying aggregate roots is probably the best way to go but am wondering how to approach this with regard to interfaces and repositories when it comes to using specific/custom repositories vs generic repositories.</p>\n\n<p>Generic Repositories seem like a great way to cut down on the need to create individual iRepositories for each required implementation, but the problem is that not all of my concrete classes have a need for all of the methods in the Generic Repository Interface, ie sometimes I will need more and other times I will need less.</p>\n\n<p>I am wondering what is the best practice to approach this situation? Do developers normally have one generic repository interface and then create more specific ones for more specific Data Access needs?</p>\n\n<p>I have used this project as a guideline for best practice:\n<a href=\"http://efmvc.codeplex.com/\" rel=\"nofollow\">http://efmvc.codeplex.com/</a></p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13042481,"title":"How to keep an edmx file up to date","body":"<p>I was given a project that has a DB-first generated edmx file. I'm  not really sure how to tell if it is in sync with my DB or not... I don't quite understand the Update Model screen in relation to what is going to actually get updated (I can't just look at the changes afterwards to see what changed because I am not familiar with the model).</p>\n\n<p>Also, is it better practice to use Update Model wizard or delete and regenerate the edmx each time. I inherently do not trust the output of these GUI DB creators (not sure if this is well grounded or not with this particular technology)</p>\n\n<p>I am on .Net 4</p>\n"},{"tags":["linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12976414,"title":"Entity Framework/ Linq - groupby and having clause","body":"<p>Given the query below</p>\n\n<pre><code>       public TrainingListViewModel(List&lt;int&gt; employeeIdList)\n        {\n            this.EmployeeOtherLeaveItemList =\n                CacheObjects.AllEmployeeOtherLeaves\n                .Where(x =&gt; x.OtherLeaveDate &gt;= Utility.GetToday() &amp;&amp;\n                    x.CancelDate.HasValue == false &amp;&amp;\n                    x.OtherLeaveId == Constants.TrainingId)\n                .OrderBy(x =&gt; x.OtherLeaveDate)\n                .Select(x =&gt; new EmployeeOtherLeaveItem\n                {\n                    EmployeeOtherLeave = x,\n                    SelectedFlag = false\n                }).ToList();\n        }\n</code></pre>\n\n<p>I want to put in the employeeIdList into the query.\nI want to retrieve all of the x.OtherLeaveDate values where the same x.OtherLeaveDate exists for each join where x.EmployeeId = (int employeeId in employeeIdList)</p>\n\n<p>For example if there are EmployeeIds 1, 2, 3 in employeeIdList and in the CacheObjects.AllEmployeeOtherLeaves collection there is a date 1/1/2001 for all 3 employees, then retreive that date.</p>\n"},{"tags":["entity-framework","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13040665,"title":"Get data from stored procedure","body":"<p>I made a stored procedure to get data like: <code>select * from customer</code> and then I made a model in Entity Framework through 1 function <code>getcustomer</code>. What code should I write to get the list from the stored procedure?</p>\n\n<pre><code>public List&lt;Customer&gt; getCustomerWithsp()\n    {\n        Database1Entities1 context = new Database1Entities1();\n        List&lt;Customer&gt; cust = new List&lt;Customer&gt;();\n        cust = context.getcustomer().tolist(); //What should I write here?\n        return cust;\n    }\n</code></pre>\n"},{"tags":["wcf","entity-framework",".net-4.0","self-tracking-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":2,"question_id":13041984,"title":"WCF, Data-Updates & EntityReference object could not be serialized","body":"<p>I did a lot of stuff with WCF where I first thought: \"Hmm, this problem is weird\" - but after I figured each one out, it always made somehow sense (sometimes more, sometimes less).<br />\nBut now I'm at a point where I'm stuck and with all my imagination, I cannot think of a reason why this error appreas:</p>\n\n<blockquote>\n  <p>The EntityReference object could not be serialized. This type of object cannot be serialized when the RelationshipManager belongs to an entity object that does not implement IEntityWithRelationships.</p>\n</blockquote>\n\n<p>To put it in a context, let me tell you about my program in a nutshell:<br />\nI have a client which send's an ID to my WCF.\nIf this ID is in use, I'll grab it's related object from the EF (otherwiese I'll create a new one) and send it back.</p>\n\n<p>This all is done by Selftracking Entities - and getting the objects works fine, as well as the first update:</p>\n\n<pre><code>public static void UpdatePaperOnServer(ref PAPER p)\n{\n    var newP = ServiceClient.UpdatePaper(p);\n    p = newP;\n}\n</code></pre>\n\n<p>The reference \"p\" is a field in &lt; Program > and any changes will happen on this variable.<br /></p>\n\n<p>Here is the server-side implementation of UpdatePaper.<br />\nAs you can see, no magic will happen here neither:</p>\n\n<pre><code>public PAPER UpdatePaper(PAPER p)\n{\n    p.ChangePaperOnDb(); //Simple static DAL-Accessor, works fine\n\n    return p; //The Client should get any changes made by other users so far, that's why I'll give the obj back... or if it's a new obj and it has an ID now\n}\n</code></pre>\n\n<p>As I said, my first Update works fine, but as soon as I trigger the update-routine again, I'll get this error which I mentioned above.</p>\n\n<p>After spending some time with my good mate google, I found only an approach where they changed the .NET-Version from 4.0 to 3.5.\nBut I don't know if that would for me as I can't change the runtime from 4.0 to 3.5.</p>\n\n<p>If anyone has any clue what's going on - please let me know.\nThank you very much!</p>\n"},{"tags":[".net","database","oracle","entity-framework","ado.net"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13041163,"title":"Many-to-Many relationship in Entity Framework with relationship informantion","body":"<p>First said, this is my first experience using the Entity Framework so I apologize if this ends up being a newbie question.  Everything has gone well so far; but, I run into a situation that I am not sure what the best way to handle is.  </p>\n\n<p>I need to create a many-to-many relationship; but, the many-to-many table contains more than just the composite key.  In this case the Entity Framework does not see to recognize it as a many-to-many structure and so I don't seem to get the easy ability to get the collections without using the intervening table.  Is there a better way to do this?</p>\n\n<p>Simplified Example:</p>\n\n<ul>\n<li>A Unit can have many boards and a board could have been in many units</li>\n<li>When it is in a unit we need to record what slot it was in.</li>\n</ul>\n\n<p>Tables:</p>\n\n<pre><code>Unit\n UnitID(PK)\n UnitName\n\nBoard\n BoardID(PK)\n BoardName\n\nUnitBoard\n UnitID(PK,FK1)\n BoardID(PK,FK2)\n Slot\n</code></pre>\n\n<p>When I pull this into my code using an ADO.NET Entity Data Model, I don't see an easy way to get the collection of Boards associated to a Unit from the Unit Entity or visa-versa.</p>\n\n<p>Is there a better way to do this or do I just need to use the associated collection of UnitBoards then use that to build the collection of Units/Boards?</p>\n\n<p>This seems I am probably not the first person to went to do something like this.  Ex: I was thinking of Books and Owners wanting to also keep the related BookOwner information (like the purchase date).</p>\n"},{"tags":["entity-framework","sql-server-2005","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13039207,"title":"Entity Framework and date+time arithmetic","body":"<p>We have the situation where we have a SQL Server 2005 table with a Date column and a separate Time column.  When I try to query this table, I'd like to do the equivalent of the following SQL:</p>\n\n<p><code>where Date + Time &gt; @Something</code></p>\n\n<p><em>Some background info - the Date is stored as a date with a 00:00 time component, and the Time is stored as a Time with a 1900-01-01 date component - this means in SQL adding the two together get you a full DateTime.</em></p>\n\n<p>I know there are indexing implications above, but that is not what the question is about.</p>\n\n<p><strong>How do you do this in linq to entities?</strong></p>\n\n<p>Some other things to note:</p>\n\n<ul>\n<li>Changing the database schema is out of the question.</li>\n<li>This is SQL 2005 so no Time datatype, and no TimeSpan returned from EF (I have tried changing the EF model to try and cast it to a TimeSpan, but no dice)</li>\n<li>I want to try and stick to pure Linq-to-Entities and not go down the E-SQL / stored procedure / ExecuteQuery route.</li>\n</ul>\n"},{"tags":["c#","linq","entity-framework","data-structures","expression"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":3,"question_id":13036583,"title":"Why is it better to use data structure in Entity Framework","body":"<p><a href=\"http://geekswithblogs.net/Martinez/archive/2009/06/29/understanding-expression-trees.aspx\" rel=\"nofollow\">http://geekswithblogs.net/Martinez/archive/2009/06/29/understanding-expression-trees.aspx</a></p>\n\n<p>By reading this article that expline what are Expression trees and what they are used for I have some question thats the article those not answer me clearly.</p>\n\n<p><strong>A.</strong> What is the difference between Data Structure and 'compiled piece of code'. \n * I know that data structure is Array,List,.. But this is not the answer I am looking for.</p>\n\n<p><strong>B.</strong> Why is it better to use data structure in Entity Framework than 'compiled piece of code' in terms of efficiency.</p>\n"},{"tags":["entity-framework","frameworks","ado.net","model","entity"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":48,"score":-1,"question_id":13037673,"title":"ADO.Net Entity Model (edmx) vs Entity Framework(v4.0 etc)","body":"<p>What are the benefits of using ADO.Net Entity Model and EF?</p>\n\n<p>Can we use both of them together in a project. I came across an example where, the user had used both edmx and ef for his application. I am not sure what is the purpose of that.</p>\n\n<p>Thanks </p>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4"],"answer_count":3,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":961,"score":9,"question_id":12502004,"title":"Entity Framework Code-First Issues (SimpleMembership UserProfile table)","body":"<p>If you've used ASP.NET MVC 4 you'll notice that the default for an Internet Application is to use the SimpleMembership provider, this is all well and good and works fine.</p>\n\n<p>The issue comes with the default database generation, they have a POCO for <code>UserProfile</code> defined like so:</p>\n\n<pre><code>[Table(\"UserProfile\")]\npublic class UserProfile\n{\n    [Key]\n    [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n    public int UserId { get; set; }\n    public string UserName { get; set; }\n}\n</code></pre>\n\n<p>.. which is then generated like this:</p>\n\n<pre><code>using (var context = new UsersContext())\n{\n    if (!context.Database.Exists())\n    {\n         // Create the SimpleMembership database without Entity Framework migration schema\n         ((IObjectContextAdapter)context).ObjectContext.CreateDatabase();\n    }\n}\n</code></pre>\n\n<p>This works fine, the database is generated just fine and works without issue. However, if I am to change the POCO like this and delete the database:</p>\n\n<pre><code>[Table(\"UserProfile\")]\npublic class UserProfile\n{\n    [Key]\n    [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n    public int UserId { get; set; }\n    public string EmailAddress { get; set; }\n\n    public string FirstName { get; set; }\n    public string Surname { get; set; }\n\n    public string Country { get; set; }\n\n    public string CompanyName { get; set; }\n}\n</code></pre>\n\n<p>Only the first 2 columns are generated, <code>UserId</code> and <code>EmailAddress</code>. It works just fine code-wise (talking login/registration), but obviously none of my other user data is stored.</p>\n\n<p>Am I missing something here? Surely it should generate the database based off the whole <code>UserProfile</code> object.</p>\n"},{"tags":["entity-framework","simplemembership"],"answer_count":4,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":686,"score":5,"question_id":12575311,"title":"Using SimpleMembership with EF model-first","body":"<p>Can <strong>SimpleMembership</strong> be used with <strong>EF model-first</strong>?  When I try it, I get \"Unable to find the requested .NET Framework Data Provider\" when I call <code>WebSecurity.InitializeDatabaseConnection.</code></p>\n\n<p>To put it another way: I can't get the call to <code>WebSecurity.InitializeDatabaseConnection</code> to work when the connection string employs the <code>System.Data.EntityClient</code> provider (as it does when using the <strong>model-first</strong> paradigm).</p>\n\n<p>To repro the issue, create an MVC 4 app, and replace the <strong>code-first</strong> UserProfile entity class (which you get for free with the MVC 4 template) with a <strong>model-first</strong> User class that you have created in the Entity Designer:</p>\n\n<ol>\n<li>Create an MVC 4 app in <strong>VS 2012</strong> and add a new, blank Entity Data\nModel.</li>\n<li>Add a new Entity named <code>User</code> to the model, with fields for <code>Id,</code>\n<code>UserName, and FullName</code>.  So, at this point, the <code>User</code> data entity is\nmapped to a <code>Users</code> table and is accessed via a funky connection\nstring that employs the <code>System.Data.EntityClient</code> provider.</li>\n<li>Verify that the <strong>EF</strong> can access the <code>User</code> entity.  One easy way to do\nthat is to scaffold out a Users controller based on the User table\nand its associated DbContext.</li>\n<li>Edit the <code>AccountModels.cs</code> file to remove the <code>UserProfile</code> class and\nits associated <code>UsersContext</code> class. Replace the references to the\n(now missing) <code>UserProfile</code> and <code>UsersContext</code> classes with references\nto your new User class and its associated <code>DbContext</code> class.</li>\n<li>Move the call to InitializeDatabaseConnection from the\nInitializeSimpleMembershipAttribute filter class to the\nApplication_Start method in Global.asax.cs.  While you're at it,\nmodify the arguments to use your new User entity's connection\nstring, table name, and UserId column name.</li>\n<li>Delete the (no longer used) <code>InitializeSimpleMembershipAttribute</code>\nclass and the references to it.</li>\n</ol>\n\n<p>When you run the repro, it will get an <strong>Exception</strong> at the call to <code>InitializeDatabaseConnection.</code></p>\n\n<p>Bob</p>\n"},{"tags":["c#","sql-server","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":13036635,"title":"Mapping 1 to 0-1 In Entity Framework","body":"<p>Doing Entity Framework (5) code first, although we are not generating our data model from the code--we just keep them in sync manually (less of a pain than it sounds).</p>\n\n<p>Trying to create a 1 to 0-1 relationship.  Here is the setup using a made-up example of a customer that could have 0 or 1 address:</p>\n\n<p><strong>Edit: original example was not right.  Customer can have 0-1 Addresses, Address has exactly 1 customer.  Table design and code both updated.</strong></p>\n\n<pre>\nAddress\n--------------\nAddressId (identity)\nAddressText\nCustomerId (Edit: this employs a unique constraint)\n</pre>\n\n<pre>\nCustomer\n--------------\nCustomerId (identity)\nCustomerName\n</pre>\n\n<p>Relevant part of Address mapping:</p>\n\n<pre><code>   this.HasKey(t =&gt; t.AddressId);\n   //SEE NOTE ON THIS BELOW\n   //this.Property(t =&gt;t.AddressId).\n                   HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n   this.HasRequired(t =&gt; t.Customer)\n       .WithOptional();\n</code></pre>\n\n<p>Relevant part of Customer mapping:</p>\n\n<pre><code>  this.HasKey(t =&gt; t.CustomerId);\n   this.HasOptional(b =&gt; b.Address)\n            .WithRequired(); \n</code></pre>\n\n<p>Note the line commented out in Customer.  If I include this, I get the following error:</p>\n\n<blockquote>\n  <p>A dependent property in a ReferentialConstraint is mapped to a\n  store-generated column. Column: 'CustomerId'.</p>\n</blockquote>\n\n<p>If I don't include it, I get:</p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table 'Customer'\n  when IDENTITY_INSERT is set to OFF.</p>\n</blockquote>\n\n<p>I have searched high and low, and the code above seems to be the recommended approach.  I have also seen some vague mention that 1:1 relationships can't be modeled unless the two tables share a key of the same name?</p>\n\n<p>Can this sort of relationship be modeled in code, and if so, what is the correct syntax?</p>\n"},{"tags":["sql-server","entity-framework","temporary-tables"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":427,"score":1,"question_id":9760323,"title":"Entity Framework and stored procedure returning temp table Issues","body":"<p>(Disclaimer - I'm not the database designer. I'm just the poor developer what has to make this work.)</p>\n\n<p>There are 17 (at the moment) tables with identical structure - name, address, phone number.</p>\n\n<p>Given a phone number, I have to check to see if there's a matching entry in any of the tables, then return that address.</p>\n\n<p>So, I created a view to get the list of tables (there's a ref table that holds that info), then I created a stored procedure to </p>\n\n<ol>\n<li>create a temp table, </li>\n<li>using cursors, check each table in the view for the phone number, using sql concatenation. If a record is found, insert it into the temp table. </li>\n<li>return the rows from the temp table. </li>\n</ol>\n\n<p>This all works in straight T-SQL. </p>\n\n<p>Now, I'm trying to use Entity Framework 4+ to call the stored procedure. But the function import interface won't generate columns. It says return type = none, and the LINQ code expects an int and won't compile. </p>\n\n<p>Any ideas on how to make this work? </p>\n\n<p>I know I can move the check tables part to code, if I absolutely have to, but I'd rather have the above method work. </p>\n"},{"tags":["sql-server","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":13035872,"title":"SQL Query to Entity Framework (ExecuteStoreQuery)","body":"<p>I have a SQL query that works fine and returns proper results</p>\n\n<pre><code> declare @memberId decimal\nset @memberId=100\n\nselect s.Id, s.StatusDate, s.StatusText, p.FirstName, p.LastName, p.Photo\n from MemberStatus s join Profile p on s.SenderId = p.MemberID\n where s.SenderId IN\n (\nselect f.MemberID as id from Member_FriendRequest f where (f.FriendID = @memberId ) and f.Status=2\nunion\nselect f.FriendID as id from Member_FriendRequest f where (f.MemberID=@memberId) and f.Status=2\nunion \nselect @memberId\n)\n</code></pre>\n\n<p>But when I try to use it in ASP.NET it never returns any result</p>\n\n<pre><code>     using (var db = new ExerciseProgramManagerEntities())\n            {\n                var pMmemberId = new SqlParameter(\"@memberId\", senderId);                                    \n\n                var result  = db.ExecuteStoreQuery&lt;DynamicObject&gt;(\"select s.Id, s.StatusDate, s.StatusText, p.FirstName, p.LastName, p.Photo \"+\n \"from MemberStatus s join Profile p on s.SenderId = p.MemberID \" +\n \"where s.SenderId IN \"+\n \"(\"+\n\"select f.MemberID as id from Member_FriendRequest f where (f.FriendID = @memberId ) and f.Status=2 \"+\n\"union \"+\n\"select f.FriendID as id from Member_FriendRequest f where (f.MemberID=@memberId) and f.Status=2 \" +\n\"union \"+\n\"select @memberId)\", pMmemberId);\n</code></pre>\n\n<p>What's wrong in my query?</p>\n"},{"tags":["c#",".net","wpf","database","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13035850,"title":"Creating multiple copies of same database from a single Entity Framework","body":"<p>I am creating a shopping application, which has many branches with different names.</p>\n\n<p>I am using Entity Framework in my WPF project, I am able to create a single database from my entity model.</p>\n\n<p>If my entity name is <code>JIMS</code>, a database with name <code>JIMS</code> is created. But I also want to create a new database in SQL Server using the same Entity Framework model with a different name for a different branch.</p>\n\n<p>So that the user can select the branch and there will be a separate database for it?</p>\n"},{"tags":["database","entity-framework","entity-framework-4",".net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13033880,"title":"One-way updates of columns using EntityFramework","body":"<p>EntityFramework 4.3.1.</p>\n\n<p>What is the best way to have calculated properties which should be stored in db, but are not intended to be retrieved from db?\nE.g.</p>\n\n<pre><code>    [Column(\"SOME_COLUMN\")]\n    public ulong SomeColumn\n    {\n        get { return /*calculate here*/; }\n    }\n</code></pre>\n\n<p>I want the value to be persisted when I'm saving to db. But of course - not getting updated when I load from db. I can have an empty setter alongside... But it doesn't seem to work when the column is Key.</p>\n\n<p>Can I have such a Key-column?</p>\n\n<p>Now I'm getting this error:</p>\n\n<p><strong>EntityFramework error: The value of a property that is part of an object's key does not match the corresponding property value stored in the ObjectContext. This can occur if properties that are part of the key return inconsistent or incorrect values or if DetectChanges is not called after changes are made to a property that is part of the key.</strong></p>\n"},{"tags":["c#","entity-framework","generics","reflection"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":770,"score":3,"question_id":6323765,"title":"Build an object from another object in C# using generic code","body":"<p>Let's say I have an object of Type User that looks like this:  </p>\n\n<pre><code>User {\n   Name = \"Bob\",\n   Email = \"Bob@gmail.com\",\n   Class = NULL\n}\n</code></pre>\n\n<p>Can anyone think of a way to take that object and create an object like this:</p>\n\n<pre><code>User {\n   Name = \"Bob\",\n   Email = \"Bob@gmail.com\"\n}\n</code></pre>\n\n<p>Using entirely generic code?  Meaning, I don't want to hard code anything to do with the Type, or the Properties because this code would need to be applied to every Entity on my site.  (the \"User\" type is an Entity by the way, so use that if it helps you code this better).  </p>\n\n<p>I'm just trying to come up with a solution to a problem I have and I BELIEVE that <a href=\"http://blogs.msdn.com/b/alexj/archive/2009/06/19/tip-26-how-to-avoid-database-queries-using-stub-entities.aspx\" rel=\"nofollow\">Stub Entities</a> may fix the problem, but I need to do it without hard coding any Types or Properties.</p>\n"},{"tags":["entity-framework","entity-framework-4","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13014150,"title":"Entity Framework - TPC - Override Primary Key Column Name","body":"<p>Here's my model:</p>\n\n<pre><code>public abstract class Entity\n{\n    public long Id { get; set; }\n}\n\npublic abstract class Audit : Entity\n{}\n\npublic class UserAudit : Audit\n{\n    public virtual User User { get; set; }\n}\n\npublic class User : Entity\n{}\n</code></pre>\n\n<p>Here's my DbContext:</p>\n\n<pre><code>public class TestDbContext : DbContext\n{\n    static TestDbContext()\n    {\n        Database.DefaultConnectionFactory = new SqlCeConnectionFactory(\"System.Data.SqlServerCe.4.0\");\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new AuditConfiguration());\n        modelBuilder.Configurations.Add(new UserAuditConfiguration());\n        modelBuilder.Configurations.Add(new UserConfiguration());\n    }\n}\n</code></pre>\n\n<p>And here's my mappings:</p>\n\n<pre><code>public abstract class EntityConfiguration&lt;T&gt; : EntityTypeConfiguration&lt;T&gt;\n    where T : Entity\n{\n    protected EntityConfiguration()\n    {\n        HasKey(t =&gt; t.Id);\n        Property(t =&gt; t.Id)\n            .HasColumnName(\"Key\");\n    }\n}\n\npublic class AuditConfiguration : EntityConfiguration&lt;Audit&gt;\n{}\n\npublic class UserAuditConfiguration : EntityTypeConfiguration&lt;UserAudit&gt;\n{\n    public UserAuditConfiguration()\n    {\n        Map(m =&gt;\n            {\n                m.MapInheritedProperties();\n                m.ToTable(\"UserAudits\");\n            });\n        HasRequired(u =&gt; u.User)\n            .WithMany()\n            .Map(m =&gt; m.MapKey(\"UserKey\"));\n    }\n}\n\npublic class UserConfiguration : EntityConfiguration&lt;User&gt;\n{}\n</code></pre>\n\n<p>When I try to generate a migration for this model, I get the following error:</p>\n\n<p>error 2010: The Column 'Id' specified as part of this MSL does not exist in MetadataWorkspace.</p>\n\n<p>If I comment out the \".HasColumnName\" call in the constructor of EntityConfiguration, the migration generates correctly (except of course that the column name is Id and not Key).</p>\n\n<p>Is TPC mappings supposed to support primary key columns that don't use the default column name?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12863470,"title":"Multi-target development of a Entity Framework based tool with legacy support","body":"<p>I am developing a (free, open-source) Entity Framework tool, it is basicaly an ADO.NET provider, but it uses some higher abstractions too (e.g. ObjectContext, EntityConnection). I want it to support almost all the legacy version of EF (EF4=&lt;). Until EF5 came out it was quite easy, because I had been able to develop it by targeting only .NET40. </p>\n\n<p>EF5 made the things more complicated, because some of the new features requires the .NET45 framework. On the other hand, EF5 supports .NET40 too. An on the top of that, EF is now developed independently from the .NET framework.</p>\n\n<p>For now, It is obvious that targeting both .NET40 and .NET45 is inevitable. But currently I have no idea what is the best way to setup a multi-target environment that can comply with the independently developed EF. I also haven't found any good document about this problem. </p>\n\n<p>Should I use multiple solution files? Multiple project files? Multiple solution configurations? Reference all version of EF somehow? Create an universal build script? If yes, how? How to run my unit test against different configurations? How to indicate that a test can/should fail in a specific configuration? What about the changed namespaces (e.g. ObjectContext)? Should I use #if directive to solve this conflict? What if a new EF release requires to implement a feature that will break the compatibilty with previous versions? I am really uncertain at this point.</p>\n"},{"tags":["c#","sql-server-2008","entity-framework","permissions"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13033458,"title":"Manage entity access and permissions with Entity Framework","body":"<p>In a web application using Entity Framework 4.1 we use SQL Server Membership to manage user access. However we need to implement a more granular set of roles a permission management.</p>\n\n<p>In the database we have already created the relative tables:</p>\n\n<pre><code>- Roles \n- Permissions \n- UserInRole (roles per user)\n- RolesPermissions (permissions associated to a role) \n</code></pre>\n\n<p>Using attributes on some of the core entities we restrict the access semantically with EF, as example, given a specific user, s/he can see only the relative shipped orders or inherent data.</p>\n\n<p>Now we would like to inject the permissions in it, meaning as example that a <em>customer</em> can see and create orders, while a <em>company</em> (these are two different roles) could only see orders for their products and also print reports.</p>\n\n<p>The idea would be to use attributes also for permissions at entity level and check if the current user owns proper rights when a method is invoked. For instance:</p>\n\n<pre><code>public void BeforeAdd()\n{\n   // Get required permissions for the specific entity (Order as example)\n\n   //Check that current user has permission of creating a new Order \n}\n</code></pre>\n\n<p>Such a method would be called by each entity, allowing to centralize the control over permissions at entity level.</p>\n\n<p>We use MVC as frontend and in there we have already implemented roles and permissions access. We need to make the same with the backend part (containing data layer). These are two separate servers communicating via web services. By implementing permission management on the back end part would strengthen the control over data access.</p>\n\n<p>Is there any pattern or best practice that we could follow (eventually using some built in features of EF) to achieve permissions management?</p>\n"},{"tags":["c#","entity-framework","mapping"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13031162,"title":"loading mapping table as an entity in entity framework","body":"<p>This is the latest entity framework with a code-first approach. \nOne customer can have multiple properties:</p>\n\n<pre><code>public class Customer\n{\n    [Key]\n    public int Id { get; set; }\n    public virtual List&lt;CustomerToPropertyMapping&gt; PropertyIds { get; set; }\n}   \n\n[Table(\"CustomerToProperty\")]\npublic class CustomerToPropertyMapping\n{\n    [Key, Column(Order = 1)]\n    public int PropertyId { get; set; }\n}\n</code></pre>\n\n<p>When I load the data, everything works fine. When I try to save a customer, I get</p>\n\n<blockquote>\n  <p>An error occurred while saving entities that do not expose foreign key\n  properties for their relationships. The EntityEntries property will\n  return null because a single entity cannot be identified as the source\n  of the exception. Handling of exceptions while saving can be made\n  easier by exposing foreign key properties in your entity types. See\n  the InnerException for details.</p>\n</blockquote>\n\n<p>The same happends even if I have </p>\n\n<pre><code>[Key, Column(Order = 0)]\nCustomerId \n</code></pre>\n\n<p>in the CustomerToPropertyMapping class.</p>\n\n<p>What is the correct way to retrieve the mappings and NOT the object it maps to?</p>\n"},{"tags":["entity-framework","wcf-data-services"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13032228,"title":"Keeping DB in sync with EF across projects","body":"<p>I am using model-first entity framework (edmx) to connect to my database across about 4 separate projects. </p>\n\n<p>Now, whenever I make a DB change I have to update the edmx for each project. I have considered creating a WCF Data Service, but I would still have to update the service reference in each project. </p>\n\n<p>Is there a better way to do this?</p>\n"},{"tags":["entity-framework","foreign-keys","entity-framework-4","associations","foreign-key-relationship"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":864,"score":5,"question_id":3714334,"title":"Having serious problems with Entity Framework & Foreign Keys :(","body":"<p>I've got the following entities on my EDMX :-\n<img src=\"http://i.stack.imgur.com/VtZ68.png\" alt=\"alt text\"></p>\n\n<p>These two entites were generated by <em>Update Model From Database</em>.</p>\n\n<p>Now, notice how my country has the following primary key :-</p>\n\n<p><strong>Name</strong> &amp; <strong>IsoCode</strong></p>\n\n<p>this is because each country is UNIQUE in the system by Name and IsoCode. </p>\n\n<p>Now, with my States ... it's similar. Primary Key is :-</p>\n\n<p><strong>Name</strong> &amp; <strong>CountryId</strong></p>\n\n<p>Each state is unique by name and per country.</p>\n\n<p>Now, the Foreign Key for States is a CountryId. This is the sql :-</p>\n\n<pre><code>ALTER TABLE [dbo].[States]  WITH CHECK ADD \n        CONSTRAINT [FK_States_Countries] FOREIGN KEY([CountryId])\nREFERENCES [dbo].[Countries] ([CountryId])\nON UPDATE CASCADE\nGO\n\nALTER TABLE [dbo].[States] CHECK CONSTRAINT [FK_States_Countries]\nGO\n</code></pre>\n\n<p>Pretty simple stuff.</p>\n\n<p>BUT EntityFramework doesn't like it :( It's assuming that i need to connect some properties from <code>State</code> entity to both primary key properties in the <code>Country</code> entity. </p>\n\n<p><strong>Is it possible to add an ASSOCIATION between Country and State on Country.CountryId &lt;-> State.CountryId ... like i have mapped in my DB ?</strong></p>\n\n<p>Cheers ;)</p>\n"},{"tags":["wpf","entity-framework","data-binding","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13027984,"title":"Refresh information gotten from navigation property EF","body":"<p>I have an Enity Model contains a UsersList entity associated to UserTasks with UserID. UserTasks is loaded in a DataGrid, I'm getting the UserName from UsersList using <code>NavigationProperty</code>. I've made a simple ChildWindow linked to the DataGrid's <code>SelectedItem</code> to edit selected task including the user (which is my problem).</p>\n\n<p>when selecting another user from a ComboBox and other information, All are updating normally in the DataGrid except the user Name.</p>\n\n<p>I did debug to see if the UserTasks object got the new UserID, I found that it did.</p>\n\n<p>What's missing to get DataGrid refresh the task's user name ?</p>\n"},{"tags":["c#","entity-framework","wpfdatagrid"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13008472,"title":"Unable Save change to Context from DataGrid","body":"<p>Recently i install VS2012 and Try remake my old WPF project. In VS2010 that code work and all updated or new rows in Datagrid saved in DB via Entity Model. In VS2012 new rows not being added in Database.</p>\n\n<pre><code>    MyEntities context = new MyEntities();\n\n    public MainWindow()\n    {\n        InitializeComponent();\n\n    }\n\n    private void Button_Click_1(object sender, RoutedEventArgs e)\n    {\n        var selected = from row in context.Sources\n                       select row;\n        Datagrid.ItemsSource = selected.ToList();\n    }\n\n    private void Button_Click_2(object sender, RoutedEventArgs e)\n    {\n        context.SaveChanges();\n    }\n</code></pre>\n\n<p>Why is new rows not being added?</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":7261,"score":2,"question_id":6012638,"title":"Create DataContext from Entity Framework connection string?","body":"<p>I'm trying to make this call in my code:</p>\n\n<pre><code>string conn = ConfigurationManager.ConnectionStrings[\"MyDBEntities\"].ConnectionString;\nDataContext context = new DataContext(conn);\nTable&lt;MyApp.Entities.Employee&gt; myTable = context.GetTable&lt;MyApp.Entities.Employee&gt;();\n</code></pre>\n\n<p>Here's my connection strings:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n  &lt;add name=\"MyDBEntities\" connectionString=\"metadata=res://*/Entities.MyDB.csdl|res://*/Entities.MyDB.ssdl|res://*/Entities.MyDB.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=STEVEN-PC;Initial Catalog=MyDB;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;add name=\"MyDB\" connectionString=\"Server=STEVEN-PC;Database=MyDB;Trusted_Connection=yes;\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>I get an error when creating the DataContext: <strong>Keyword not supported: 'metadata'.</strong></p>\n\n<p>If I use the second connection string, I get an error when trying to get the table: <strong>Server Error in '/' Application.\nThe type 'MyApp.Entities.Employee' is not mapped as a Table.</strong></p>\n\n<p>What am I doing wrong here?</p>\n"},{"tags":["asp.net","entity-framework","asp.net-membership"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13027507,"title":"Add navigation property to Membership schema","body":"<p>I have an Entity Data Model for my Web Site that includes a table with some extra data for the registered users (called UserInfo). Currently, I'm setting the id of the new rows of UserInfo using the <code>Membership.GetUser(...).ProviderKey</code>.</p>\n\n<p>What I want to do is to add a navigation property to my UserInfo table to point to the corresponding Membership row for that user but, due I have not the Membership schema in my Entity Designer, I can't figure out how to stablish this link between the tables.</p>\n\n<p>Any idea?</p>\n\n<p>Thanks very much,</p>\n"},{"tags":[".net","entity-framework","linqpad"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13031103,"title":"When using Entity Framework with LinqPad or EFProviderWrapperToolkit, table valued functions have an incorrect SQL parameter type","body":"<p>My Entity Framework application uses several table-valued-functions to do full-text searches in SQL Server 2008.</p>\n\n<p>My function parameters are always <code>strings</code> that translate to <code>nvarchar(4000)</code> in the store side. Everything works fine.</p>\n\n<p>However, whenever I call the same functions from inside <code>LinqPad</code> or using a custom EF provider, specifically <a href=\"http://code.msdn.microsoft.com/EFProviderWrappers-c0b88f32/sourcecode?fileId=19054&amp;pathId=791898583\" rel=\"nofollow\">EFProviderWrapperToolkit</a>, the string parameters are passed in as <code>nvarchar(1)</code> which stops them from working.</p>\n\n<p>I'm specially concerned about the EFProviderWrapperToolkit because I wan't it to be used as my log layer.</p>\n\n<p>Is there any way I can work around this?</p>\n\n<p>I'm using <code>EF 4.2 2012 June CTP</code>, if you think that upgrading to <code>5.0</code> will help, I can give it a try. I did not yet because I think upgrading to <code>5.0</code> will force me to upgrade to <code>.NET 4.5 and VS 2012</code> which will cause a huge impact now as my product is in production.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I just checked and the string parameters have been automatically imported this way:</p>\n\n<pre><code>&lt;Parameter Name=\"aProcessoSimplesTerm\" Type=\"nvarchar\" Mode=\"In\" /&gt;\n</code></pre>\n\n<p>You see that there's no size specification. I didn't change it, it is the way it has been imported. </p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13031041,"title":"Does Entity Framework(EF5) support XML data type yet?","body":"<p>I am thinking of using the XML data type in SQL Server 2008 R2, but also using EF with MVC. Does EF5 support the XML data type? If not then I will have to opt for a different DB design.</p>\n\n<p>Many thanks.</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13030960,"title":"multiply join in dynamic linq","body":"<p>im trying to join those tables i have to use dynamic linq,\n   it`s working fine if  the <strong>.Join(dbcontext.Providers)</strong> has and returning data \nwhen i dont have data on the  <strong>.Join(dbcontext.Providers)</strong> the all <strong>queryResolts</strong> returnig 0 results</p>\n\n<p>how can i get data even if one of the join returning 0 results</p>\n\n<pre><code>var queryResolts = dbcontext.Tracks\n            // Add Services\n            .Join(dbcontext.Services,\n                track =&gt; track.ServiceId,\n                service =&gt; service.ServiceId,\n                (track, service) =&gt; new { Track = track, Service = service })\n            // Add ServiceInterfaces\n            .Join(dbcontext.ServiceInterfaces,\n                ts =&gt; ts.Track.ServiceInterfaceId,\n                serviceInterface =&gt; serviceInterface.ServiceInterfaceId,\n                (ts, serviceInterface) =&gt; new { Track = ts.Track, Service = ts.Service, ServiceInterfaces = serviceInterface })\n            // Add Providers\n            .Join(dbcontext.Providers,\n                tss =&gt; tss.Track.ProviderId,\n                provider =&gt; provider.ProviderId,\n                (tss, provider) =&gt; new { Track = tss.Track, Service = tss.Service, ServiceInterfaces = tss.ServiceInterfaces, Providers = provider })\n            .Where(\"ServiceInterfaces.ServiceInterfaceName == @0\", \"PublishPolicyInterface2\")\n            .Select(y =&gt; y.Track) \n\n            ;\n</code></pre>\n\n<p>thanks</p>\n\n<p>miki</p>\n"},{"tags":["c#","entity-framework","assemblies","partial","edmx"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13030638,"title":"Partial class and edmx","body":"<p>My <code>edmx</code> file generate some <code>partial</code> classes. I want extend functionality adding one property, but <code>edmx</code> file is in another assembly. In this case they are like two unrelated classes. </p>\n\n<p>How can I solve this?</p>\n"},{"tags":["c#",".net","entity-framework","c#-4.0","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13030073,"title":"How to paginate data from child object in EF?","body":"<p>I have a problem.</p>\n\n<p>I want to paginate <code>ClassA</code>.</p>\n\n<p><code>ClassA</code> has a list of elements of type <code>ClassB</code>, and <code>ClassB</code> has a list of element of type <code>ClassC</code>. </p>\n\n<p><strong>How can I paginate data by the number of elements from <code>ClassC</code>?</strong></p>\n\n<pre><code>public class ClassA\n{\n    public ICollection&lt;ClassB&gt; ClassBCollection { get; set; }\n}\n\npublic class ClassB\n{\n    public ICollection&lt;ClassA&gt; ClassACollection { get; set; }\n\n    public ICollection&lt;ClassC&gt; ClassCCollection { get; set; }\n}\n\npublic class ClassC\n{\n    public ICollection&lt;ClassB&gt; ClassBCollection { get; set; }\n}\n</code></pre>\n\n<p><strong>ClassA</strong> &nbsp;| <strong>ClassB</strong>   &nbsp; | <strong>ClassC</strong> <br/>\nData1  | InnerData | InnerInnerData1 <br/>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| InnerInnerData2 <br/>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| InnerInnerData3 <br/>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| InnerInnerData4 <br/>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| InnerInnerData5 (Paginate here) <br/></p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#",".net","wpf","entity-framework","datagrid"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12266367,"title":"Save Extra Infromation after editing DataGrid","body":"<p>I have a <code>DataGrid</code> with a <code>DataGridCheckBoxColumn</code> and others.  The <code>DataGrid ItemSource</code> is mapped to a <code>ObservableCollection</code> that contains rows of <code>Tasks</code>. The Task class includes properties like <code>\"ID\", \"IsScheduled\", \"IsScheduled_Date\", \"IsScheduled_EditorID\", Etc.</code>  I am trying to figure how to make the one <code>DataGridCheckBoxColumn</code> field (<code>IsScheduled</code>) also save the date (<code>IsScheduled_Date</code>) and who made the change (<code>IsScheduled_EditorID</code>) when checked.</p>\n\n<p>(1) I have tried to make this save the extra data using multibinding, but my efforts have so far failed.  You can see follow my progress with solving a similar issue <a href=\"http://stackoverflow.com/questions/12073597/\">Here</a>.</p>\n\n<p>(2) I have tried having the <code>DataGrid</code> <code>CellEditEnding</code> event save the extra data but it ended up committing the extra data before the IsScheduled data was committed and caused troubles whenever the row and/or cell edit was canceled.</p>\n\n<p>(3) I have tried listening to the property change event in my Task class and assigning the additional changes there.  This seemed to work fine until I realized that when the data was first loaded it cause a change event that overwrote any earlier changes.</p>\n\n<h3>Added Information</h3>\n\n<hr>\n\n<p>The <code>Task</code> class is an <code>Entity Framework Class</code> that was generated from a DB. I was listening to the <code>OnIscheduledChanged</code> event and making the necessary changes because when I did it in the generated class it was always overwritten.</p>\n\n<h3>More Info</h3>\n\n<hr>\n\n<p>There seems to be some confusion about the Task class.  As I stated it is generated by the Entity Framework and a breakpoint shows the setters being called on load... Overwriting the change.  Not to mention any custom code being overwritten everytime the code regenerates.</p>\n\n<blockquote>\n<pre><code>    /// &lt;summary&gt;\n    /// No Metadata Documentation available.\n    /// &lt;/summary&gt;\n    [EdmScalarPropertyAttribute(EntityKeyProperty=false, IsNullable=false)]\n    [DataMemberAttribute()]\n    public global::System.Boolean IsScheduled\n    {\n        get\n        {\n            return _IsScheduled;\n        }\n        set\n        {\n            OnIsScheduledChanging(value);\n            ReportPropertyChanging(\"IsScheduled\");\n            _IsScheduled = StructuralObject.SetValidValue(value);\n            ReportPropertyChanged(\"IsScheduled\");\n            OnIsScheduledChanged();\n        }\n    }\n    private global::System.Boolean _IsScheduled;\n    partial void OnIsScheduledChanging(global::System.Boolean value);\n    partial void OnIsScheduledChanged();\n</code></pre>\n</blockquote>\n\n<p>Any Ideas?</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13028915,"title":"Is it possible to merge two sets of entities in EF 4.0?","body":"<p>at the moment I am writing an application that uses Entity Framework 4.0 as ORM and synchronises with some third party application using an WebService that receives some XML structure.</p>\n\n<p>Now this XML structure contains an object \"order\". Each order can have multiple \"lines\". The WebService get's invoked by the third party application everytime it changes the \"order\", for example when a user added and removed some lines and then \"updated\" the respective entity.</p>\n\n<p>Now I want to merge the \"new\" set of lines with the old one, so that new lines get added to my EF entity, old lines get removed and the other lines get updated.</p>\n\n<p>Is this possible?</p>\n\n<p>Update 1:</p>\n\n<p>My XML structure looks like this:</p>\n\n<pre><code>&lt;Order DocumentNumber=\"200\"&gt;\n  &lt;Description&gt;Test&lt;/Description&gt;\n  &lt;!-- Some more elements --&gt;\n  &lt;Lines Count=\"2\"&gt;\n    &lt;Line ID=\"0\"&gt;\n      &lt;Item&gt;A0000&lt;/Item&gt;\n      &lt;Warehouse&gt;123&lt;/Warehouse&gt;\n      &lt;Order&gt;200&lt;/Order&gt;\n      &lt;!-- ... --&gt;\n    &lt;/Line&gt;\n    &lt;Line ID=\"1\"&gt;\n      &lt;Item&gt;A0001&lt;/Item&gt;\n      &lt;Warehouse&gt;123&lt;/Warehouse&gt;\n      &lt;Order&gt;200&lt;/Order&gt;\n    &lt;/Line&gt;\n  &lt;/Lines&gt;\n&lt;/Order&gt;\n</code></pre>\n\n<p>The structure get's deserialized using the IXmlSerializeable interface:</p>\n\n<pre><code>public partial class Order : IXmlSerializeable\n{\n    // ...\n}\n</code></pre>\n\n<p>The class Order expands the object generated by EF (model first). The object generated by EF looks like this:</p>\n\n<pre><code>public partial class Order\n{\n    public Order()\n    {\n        this.Lines = new HashSet&lt;DocumentLine&gt;();\n    }\n\n    public int DocumentNumber;\n\n    public virtual ICollection&lt;DocumentLine&gt; Lines { get; set; }\n}\n</code></pre>\n\n<p>I think it is not worth mention the design of the DocumentLine object. If it is, than just ask for it :)</p>\n\n<p>The method ReadXml looks like this:</p>\n\n<pre><code>public void ReadXml(System.Xml.XmlReader reader)\n{\n    this.DocumentNumber = Convert.ToInt32(reader.GetAttribute(\"DocumentNumber\"));\n\n    // TODO: Deserialize DocumentLines and merge them with existing one's\n    // ...\n}\n</code></pre>\n\n<p>If the order get's inserted there is no problem. Generating a new Order instance results in an empty set of DocumentLines - each line of the XML structure will get inserted.</p>\n\n<p>But when I want to update an order I need to \"replace\" the old one with the new one. I was thinking about loading the existing entity and call the deserialization routine of it's object's instance. But then I need to merge the order's lines :-)</p>\n\n<p>Thanks in advance!</p>\n\n<p>Update 2:</p>\n\n<p>My current solution looks something like this:</p>\n\n<pre><code>private void DeserializePlannedItems(System.Xml.XmlReader Reader)\n{\n    // Create a Buffer for the lines that get parsed.\n    var linesBuffer = new Dictionary&lt;int, DocumentLine&gt;();\n\n    if (Reader.ReadToDescendant(\"Line\"))\n    {\n        do\n        {\n            // Read the current line\n            var currentLineReader = Reader.ReadSubtree();\n            int lineID = Convert.ToInt32(currentLineReader.GetAttribute(\"ID\"));\n\n            // Request the line from the existing ones.\n            var line = (from lines in this.Lines\n                        where lines.ID == lineID\n                        select lines).FirstOrDefault();\n\n            // In case the line does not exist create a new one and add it to the respective collection.\n            if (line == null)\n            {\n                line = new DocumentLine();\n                this.Lines.Add(line);\n            }\n\n            // Deserialisation.\n            line.ReadXml(currentLineReader);\n\n            // Add the line to the buffer\n            linesBuffer.Add(line.ID, line);\n        } while (Reader.ReadToNextSibling(\"Line\"));\n    }\n\n    // Remove all lines that are not inside the buffer.\n    var linesToDelete = (from lines in this.Lines\n                         where !linesBuffer.ContainsKey(lines.ID)\n                         select lines).ToList();\n\n    foreach (var lineToDelete in linesToDelete)\n        this.Lines.Remove(lineToDelete);\n}\n</code></pre>\n\n<p>The method handles one line and get's called for each line inside the XML structure. But I think it is not very handy and it would be cool if there's a way to merge two sets of entities, like I asked above - this would simplify my method!</p>\n\n<p>Thanks again :)</p>\n"},{"tags":["entity-framework","asp.net-mvc-4","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13020609,"title":"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key in EF5","body":"<p>using in EF5 and asp.Mvc4</p>\n\n<p>what I try to do is  to edit a responsable (current responsable ) activo  if the activo it in another responsable (previous responsable) , the previous responsable having that activo  will change the end date for the inicial date of the current responsable  to release this Activo, and then edit the current responsable (and erase the accesorios of the previos responsable)</p>\n\n<pre><code>//get the current responsable \n\nvar responsable = Mapper.Map&lt;ResponsableViewModel, Responsable&gt;(responsableViewModel);\n\n\n var responsable_anterior = Mis(r =&gt; r.Responsables).FirstOrDefault(r =&gt; r.ResponsableId == responsableViewModel.AnteriorResponsableId);\n\nresponsable_anterior.Fin = responsableViewModel.Inicio;\nvar responsable_anterior_accesorios =responsable_anterior.ResponsableAccesorios.Where(r =&gt; r.MarcaBaja == null).ToList(); \n\nforeach (var item in responsable_anterior_accesorios )\n{\n    item.MarcaBaja = DateTime.Now;\n//save the previous accecorios\n     Vmsb.Entry(item).State = EntityState.Modified;\n}\n//save the previous responsable\n                            Vmsb.Entry(responsable_anterior).State = EntityState.Modified;\n//Detach the previous responsable\n                            Vmsb.Detach(responsable_anterior);\n\n//save the current responsable\n Vmsb.Entry(responsable).State = EntityState.Modified;\n</code></pre>\n\n<p>and I get this error message I can't understand why I try Vmsb.Entry(responsable_anterior).CurrentValues.SetValues(model); but doesnt work for me</p>\n\n<p>An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key.</p>\n"}]}
{"total":18927,"page":7,"pagesize":100,"questions":[{"tags":["c#","entity-framework","entity","relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13029030,"title":"entity framework 4.0: changing relationship entity in the main entity also overwrites ID of the main entity","body":"<p>I got an entity \"LICENSE\" that contains some relationsships, including three 1..* relationships.\nI'm working on a GUI + Manager to allow to edit the entity and save it again, later.\nWhen I call the save event on a button I overwrite the properties and relationships of my pre loaded entity I'm editing by reading the values from my controls.</p>\n\n<p>I'm changing three relationships by loading the new selected entity with the same ObjectContext and overwrite the relationship itself. in 2 of 3 cases it works perfectly. even in the last case, the relationship is changed (another entity is stored) successful and the saving process could be done very well. However, in the third case there is a weird behaviour I don't understand neither know how to fix it:</p>\n\n<p>When I change the entity of the relationship, it overwrites the ID of my LICENSE object, that makes no sense at all.</p>\n\n<p>Here is the code:</p>\n\n<p>GUI:</p>\n\n<pre><code>private LICENSE lizenz { get; set; } // in the load event, this object will be filled correctly\n\nprivate string form2obj() // this method is getting called in my button save event\n{\n    //...\n    // I removed some conditions (they all successed on testing, so believe my controls are set right on testing this\n    this.lizenz.ADRESSE_KONTAKTE_Lieferant = LizenzManager.LoadContact(Convert.ToInt32(this.ddLieferantAnsp.SelectedValue)); // ADRESSE_KONTAKTE_Lieferant is a 1..* relationship, this.ddLieferantAnsp.SelectedValue contains the ID of the object I want to load into the relationship\n    this.lizenz.ADRESSE_KONTAKTE_Betreiber = LizenzManager.LoadContact(Convert.ToInt32(this.ddBetreiberAnsp.SelectedValue)); // ADRESSE_KONTAKTE_Betreiber is a 1..* relationship, this.ddBetreiberAnsp.SelectedValue contains the ID of the object I want to load into the relationship\n    this.lizenz.DB_TYPES = LizenzManager.LoadDatabaseType(Convert.ToInt32(this.ddDatenbanktyp.SelectedValue)); // DB_TYPES is a 1..* relationship, too, this.ddDatenbanktyp.SelectedValue contains the ID of the object I want to load into the relationship\n    // last line overwrites this.lizenz.ID with the value of Convert.ToInt32(this.ddDatenbanktyp.SelectedValue), this is wrong\n    //...\n}\n</code></pre>\n\n<p>BLL (LizenzManager):</p>\n\n<pre><code>// context is the same ObjectContext in all three calls!\n//...\npublic static ADRESSE_KONTAKTE LoadContact(int id)\n{\n    return context.ADRESSE_KONTAKTE.Where(x =&gt; x.ID == id).Single(); // this seems to success\n}\n\npublic static DB_TYPES LoadDatabaseType(int id)\n{\n    return context.DB_TYPES.Where(x =&gt; x.ID == id).Single(); // this works, but it overwrites the ID of my LICENSE object I load this into ...\n}\n//...\n</code></pre>\n\n<p>As you see, the loading ways are pretty much the same, both tables got the ID column, but the last relation overwrites this.lizenz.ID with the ID of the DB_TYPES entity I load.</p>\n\n<p>Could you explain me, how to fix this issue?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":48,"score":3,"question_id":13028142,"title":"EntityFramework Migrations - Seeding per Build Configuration","body":"<p>I am using EntityFramework 5 with Code First Migrations.  What I want to be able to do is specify different Seed data depending on the Build Configuration.  For example:</p>\n\n<pre><code>protected override void Seed(EFDbContext context)\n{\n    // This will be run in every Build configuration\n    context.Table1.AddOrUpdate(new Table1 { Field1 = \"Foo\", Field2 = \"Bar\" });\n\n    #if DEBUG\n    // This will only be executed if we are Debuging\n    context.Table1.AddOrUpdate(new Table1 { Field1 = \"Blah\", Field2 = \"De Blah\" });\n    context.Table2.AddOrUpdate(new Table2 { Field1 = \"Development Only\" });\n}\n</code></pre>\n\n<p>I know the code is probably wrong, I can figure out the correct method call once I know the best route to take for doing this.</p>\n\n<p>Does EF have any built in method I have missed for doing this kind of thing?</p>\n\n<p>Thanks</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>The code I used in the end was:</p>\n\n<pre><code>protected override void Seed(EFDbContext context)\n{\n    // This will be run in every Build configuration\n    context.Table1.AddOrUpdate(t = t.Field1, new Table1 { Field1 = \"Foo\", Field2 = \"Bar\" });\n\n    #if DEBUG\n        // This will only be executed if we are Debuging\n        context.Table1.AddOrUpdate(t = t.Field2, new Table1 { Field1 = \"Blah\", Field2 = \"De Blah\" });\n        context.Table2.AddOrUpdate(t = t.Field1, new Table2 { Field1 = \"Development Only\" });\n    #endif\n}\n</code></pre>\n\n<p>It was as Yannick said, but in the AddOrUpdate method, you need to pass in the field that EF will use to establish if it is a new entry.  Not part of my question, but thought I should provide the correct method for future reference.</p>\n"},{"tags":["c#","entity-framework","ef-code-first","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":92,"score":3,"question_id":13004219,"title":"Can an Entity Be Associated By More Than 1 Entity?","body":"<p>So let's assume I have the following entities and their context configuration set up as follows. I have omitted a lot of properties for brevity's sake:</p>\n\n<pre><code>public class Company {\n    public int Id { get; set; }\n    public Location Location { get; set; }\n}\n\npublic class Customer {\n    public int Id { get; set; }\n    public Location Location { get; set; }\n}\n\npublic class Location {\n    public int Id { get; set; }\n}\n\npublic sealed class EntityDefaultContext : DbContext {\n    protected override void OnModelCreating(DbModelBuilder modelBuilder) {\n        modelBuilder.Entity&lt;Company&gt;().HasKey(m =&gt; m.Id).ToTable(\"Company\");\n        modelBuilder.Entity&lt;Company&gt;().Property(m =&gt; m.Id).HasColumnName(\"Id\");\n        modelBuilder.Entity&lt;Company&gt;().HasRequired(m =&gt; m.Location).WithRequiredDependent().Map(m =&gt; m.MapKey(\"LocationId\"));\n\n        modelBuilder.Entity&lt;Customer&gt;().HasKey(m =&gt; m.Id).ToTable(\"Customer\");\n        modelBuilder.Entity&lt;Customer&gt;().Property(m =&gt; m.Id).HasColumnName(\"Id\");\n        modelBuilder.Entity&lt;Customer&gt;().HasRequired(m =&gt; m.Location).WithRequiredDependent().Map(m =&gt; m.MapKey(\"LocationId\"));\n\n        modelBuilder.Entity&lt;Location&gt;().HasKey(m =&gt; m.Id).ToTable(\"Location\");\n        modelBuilder.Entity&lt;Location&gt;().Property(m =&gt; m.Id).HasColumnName(\"Id\");\n    }\n}\n</code></pre>\n\n<p>So as you can see, both the Company and Customer entities hold a reference to the Location entity. Something that would normally be expected I believe.</p>\n\n<p>I set up my DB context for just that as you can also see. But the SQL that EF generates is terribly inefficient:</p>\n\n<pre><code>SELECT \n    [Extent1].[Id] AS [Id], \n    [Extent1].[LocationId] AS [LocationId], \n    [Extent3].[Id] AS [Id1]\nFROM\n    [dbo].[Customer] AS [Extent1]\nLEFT OUTER JOIN [dbo].[Company] AS [Extent2] ON [Extent1].[LocationId] = [Extent2].[LocationId]\nLEFT OUTER JOIN [dbo].[Company] AS [Extent3] ON [Extent1].[LocationId] = [Extent3].[LocationId]\nLEFT OUTER JOIN [dbo].[Company] AS [Extent4] ON [Extent1].[LocationId] = [Extent4].[LocationId]\n</code></pre>\n\n<p>This is generated when I do something like this:</p>\n\n<pre><code>var q = from c in defaultContext.Set&lt;Customer&gt;().Include(m =&gt; m.Location)\n        select c;\n</code></pre>\n\n<p>I am doing it like this for reasons that are not relevant to the question. The weird thing is that here is the SQL if I only configure the Location entity to be associated by only the Customer entity:</p>\n\n<pre><code>SELECT \n    [Extent1].[Id] AS [Id], \n    [Extent1].[LocationId] AS [LocationId]\nFROM\n    [dbo].[Customer] AS [Extent1]\nINNER JOIN [dbo].[Location] AS [Extent2] ON [Extent1].[LocationId] = [Extent2].[Id]\n</code></pre>\n\n<p>Which is what I would expect. This makes me think. Does EF not support this scenario? How could it not?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13027675,"title":"objectcontext.savechanges() Add two Item","body":"<p>Ok , consider this :</p>\n\n<pre><code>Entities _context = new Entities();\n\nUser user = _context.Users.Last();\n\nuser.Logs.Add(new Log());\n\n//user has one log item\n\n_context.SaveChanges();\n\n//after calling _context.SaveChanges() , user has two log items .\n</code></pre>\n\n<p>As I commented  , after call to _context.SaveChanges() , two item added to user object , So two object would be displayed on my bounded control for example datagrid . What's wrong ?</p>\n\n<p>Thanks for your answers.</p>\n"},{"tags":["entity-framework","visual-studio-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":407,"score":0,"question_id":10926313,"title":"how do you update an ADO.NET entity data model when the database tables structure has been modified in vs11","body":"<p>I am creating ado.net entity frameworks from table from by database. Because i am ina early stage i need to chnage the table structure quite often to add or remove fields.</p>\n\n<p>how do you update an ADO.NET entity data model when the database tables structure has been modified in vs11</p>\n"},{"tags":["sql-server","xml","entity-framework","database-design","entity-attribute-value"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13026351,"title":"Database Design to persist changing wizard/workflow data?","body":"<p>I need to create a wizard type web application to acquire data for a report. There are multiple sections so multiple wizard workflows. In addition a workflow could change ie a step could be added.</p>\n\n<p>I am considering the best database design, and started with a traditional \"ER design\" with explicit column names as is always recommended. I have been researching EAV with interest . However I now realise that I do have a problem with an explicit design when a workflow can change. So my current thinking is</p>\n\n<p>1) EAV with the use of Views (with \"instead of\" trigger for updates)\n2) Simply persist each step dataset as XML.</p>\n\n<p>Both present query issues, but I guess 1) is better although one could do string querying on XML using \"Like\" etc.</p>\n\n<p>I am also using MVC 3 and EF5, and would wish to leverage their facilities as much as possible and not \"fight\" the technology.</p>\n\n<p>I may also need to use some form of XML config file to help setup the razor view with the correct controls/layout.</p>\n\n<p>I would really appreciate some wisdom on the above. </p>\n\n<p>Many thanks.</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13025406,"title":"Inserting record instead of updating","body":"<p>I am developing an MVC app.</p>\n\n<p>When I try to updated record it showing error of DBEntityValidation exception,\n( beacuse its trying to add record in DB. This is my code) </p>\n\n<pre><code>public JsonResult SavePassword(int EmpId, string Password)\n    {\n        try\n        {\n\n\n        Employee e1 = db.Employees.First(i =&gt; i.Id == EmpId);\n        db.Entry(e1).State = EntityState.Modified;\n        e1.Password = Password;\n        db.SaveChanges();\n\n\n        return Json(EmpId);\n\n        }\n\n\n        catch (DbEntityValidationException e)\n        {\n            foreach (var eve in e.EntityValidationErrors)\n            {\n                Console.WriteLine(\"Entity of type \\\"{0}\\\" in state \\\"{1}\\\" has the following validation errors:\",\n                  eve.Entry.Entity.GetType().Name, eve.Entry.State);\n                foreach (var ve in eve.ValidationErrors)\n                {\n                    Console.WriteLine(\"- Property: \\\"{0}\\\", Error: \\\"{1}\\\"\", ve.PropertyName, ve.ErrorMessage);\n                }\n            }\n             throw;\n        }\n\n\n    }\n</code></pre>\n\n<p>In exception, it shows that validation msgs, which I have checked while adding new record.\nSo , I think its trying to add in DB insted of updating.</p>\n"},{"tags":["entity-framework","batch-processing","entity-framework-5"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":170,"score":0,"question_id":12751258,"title":"Batch update/delete EF5","body":"<p>What is the best way to deal with batch updates using (Entity Framework) EF5?\nI have 2 particular cases I'm interested in:</p>\n\n<ol>\n<li><p>Updating a field (e.g. UpdateDate)  for a list (List) of between 100 and 100.000  Id's, which the primary key. Calling each update separately seem to be to much overhead and takes a long time.</p></li>\n<li><p>Inserting many, also between the 100 and 100.000, of the same objects (e.g. Users) in a single go.</p></li>\n</ol>\n\n<p>Any good advice?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13019840,"title":"entity framework no PK's on tables","body":"<p>I'm using VS2012 and creating a sample Entity Framework project that reads and writes to some tables that are used for import purposes.   and do not have PK's or FK's in them - just null/notnull on the columns.</p>\n\n<p>Can/should EF be made to insert records on these tables without that cryptic error:</p>\n\n<blockquote>\n  <p><em>Unable to update the EntitySet because it has a DefiningQuery\n  and no  element exists in the\n   element to support the current\n  operation.</em></p>\n</blockquote>\n\n<p>Or should I be looking elsewhere for database I/O?</p>\n\n<p>Thanks!\nCorey.</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13022918,"title":"How to cancel DbSet.Add in EF5","body":"<p>All, Say you have some code like below. I want to know If It didn't run the <code>db.savechanges()</code>, Is it necessary to write some code to Cancel <code>db.DeployPackages.Add(package)</code> commonly?</p>\n\n<pre><code>HotDeployDbContext db = null;\n\n    using (db = new HotDeployDbContext())\n    {\n        DeployPackage package = new DeployPackage();\n        db.DeployPackages.Add(package);\n\n        //determine if save package to db based on some condition.\n        if (.....)\n        {\n            db.SaveChanges();\n        }\n        else\n        {\n            //how to cancel the db.DeployPackages.Add(package);\n        }\n    }\n</code></pre>\n\n<p><strong>Edited</strong></p>\n\n<p>Sometimes we do lot of things in one <code>Dbcontext</code>, like add data to multiple table. delete some data or update data . but what if we do need to cancel these before run <code>SaveChanges</code> based on some business condition? How can I make this .Thanks.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","iis","publish"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":200,"score":0,"question_id":11010131,"title":"Publish MVC 3.0 Site in IIS 7.0","body":"<p>I program website with MVC 3.0 which uses EntityFrame work 4.0, In controller layer I Have this:<br/></p>\n\n<pre><code>  public ViewResult Index()\n    {\n     return View(_DatabaseSMSEntities.People.ToList());\n    }\n</code></pre>\n\n<p>And in View Layer I used Telerik Grid:</p>\n\n<pre><code>&lt;% Html.Telerik().Grid&lt;ProjectWebsite.Models.People&gt;(Model)\n                    .Name(\"People\")\n                    .Columns(columns =&gt;\n                    {\n                        columns.Bound(o =&gt; o.PersonID).Format(\n                         \"&lt;a href='../WebPage/PersonSMSPage.aspx?personID=\" + \"{0}\" + @\"' &lt;br/&gt;runat=\"\"server\"\"&gt;\" +\n                         \"&lt;img src='../../Content/themes/base/images/RegisterSMS.png' &lt;br/&gt;alt='{0}' /&gt;\"&lt;br/&gt;\n                        );                                           \n\n                    })\n                    .RowAction(row =&gt;\n                    {\n                        if (row.Index == 0)\n                        { row.DetailRow.Expanded = false; }\n                    })                   \n                     .Render();%&gt;\n</code></pre>\n\n<p>I published it in IIS 7.0. But it does not work. </p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"ApplicationServices\" connectionString=\"data source=.\\SQLEXPRESS;Integrated Security=SSPI;AttachDBFilename=|DataDirectory|aspnetdb.mdf;User Instance=true\" providerName=\"System.Data.SqlClient\" /&gt;\n    &lt;add name=\"DatabaseSMSEntities\" connectionString=\"metadata=res://*/Models.ModelDatabaseSMS.csdl|res://*/Models.ModelDatabaseSMS.ssdl|res://*/Models.ModelDatabaseSMS.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQLEXPRESS;AttachDbFilename=|DataDirectory|\\DatabaseSMS.mdf;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n    &lt;add name=\"cn1\" connectionString=\"data source=~/ErrorsLog/Errors.db\" /&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>First, I  published it in D:\\Pardis, But I got error:</p>\n\n<pre><code>   CREATE DATABASE permission denied in database 'master'.\n    An attempt to attach an auto-named database for file D:\\Pardis\\App_Data\\DatabaseSMS.mdf failed. A database with the same name\nexists, or specified file cannot be opened, or it is located on UNC share.\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.Data.SqlClient.SqlException: CREATE DATABASE permission denied in database 'master'.\nAn attempt to attach an auto-named database for file D:\\Pardis\\App_Data\\DatabaseSMS.mdf failed. A database with the same name exists, or specified file cannot be opened, or it is located on UNC share.\n\nSource Error: \n\n\nLine 20:         public ViewResult Index()\nLine 21:         {\nLine 22:             return View(_DatabaseSMSEntities.People.ToList());\nLine 23:         }\nLine 24: \n</code></pre>\n\n<p>Then, I published it in Inetup but I got error.\nI do not have ASPNET user in user list to set security.</p>\n"},{"tags":["entity-framework","linq-to-entities","exists"],"answer_count":5,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":11991,"score":10,"question_id":1802286,"title":"Best way to check if object exists in Entity Framework?","body":"<p>What is the best way to check if an object exists in the database from a performance point of view? I'm using Entity Framework 1.0 (ASP.NET 3.5 SP1).</p>\n"},{"tags":["entity-framework","windows-8"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":13006980,"title":"Entity Framework and windows.winmd","body":"<p>I m developing an Windows 8 application (not Windows store app) using .Net 4 and EF.\nEverything is working fine until i want to add the Windows.winmd reference. I got the following exception :</p>\n\n<pre><code>System.Data.DataException occurred\n  HResult=-2146233087\n  Message=An exception occurred while initializing the database. See the InnerException for details.\n  Source=EntityFramework\n  StackTrace:\n       at System.Data.Entity.Internal.InternalContext.PerformInitializationAction(Action action)\n       at System.Data.Entity.Internal.InternalContext.PerformDatabaseInitialization()\n       at System.Data.Entity.Internal.LazyInternalContext.&lt;InitializeDatabase&gt;b__4(InternalContext c)\n       at System.Data.Entity.Internal.RetryAction`1.PerformAction(TInput input)\n       at System.Data.Entity.Internal.LazyInternalContext.InitializeDatabaseAction(Action`1 action)\n       at System.Data.Entity.Internal.LazyInternalContext.InitializeDatabase()\n       at System.Data.Entity.Internal.InternalContext.Initialize()\n       at System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType)\n       at System.Data.Entity.Internal.Linq.InternalSet`1.Initialize()\n       at System.Data.Entity.Internal.Linq.InternalSet`1.get_InternalContext()\n       at System.Data.Entity.Infrastructure.DbQuery`1.System.Linq.IQueryable.get_Provider()\n       at System.Linq.Queryable.OrderBy[TSource,TKey](IQueryable`1 source, Expression`1 keySelector)\n       at Yawd.Dal.Dal.getIncludeFolders() in c:\\Users\\Jeff\\Documents\\Visual Studio 2010\\Projects\\Yawd.old\\Yawd\\Dal\\Dal.cs:line 170\n  InnerException: System.Data.EntityCommandCompilationException\n       HResult=-2146232005\n       Message=An error occurred while preparing the command definition. See the inner exception for details.\n       Source=System.Data.Entity\n       StackTrace:\n            at System.Data.EntityClient.EntityCommandDefinition..ctor(DbProviderFactory storeProviderFactory, DbCommandTree commandTree)\n            at System.Data.EntityClient.EntityProviderServices.CreateCommandDefinition(DbProviderFactory storeProviderFactory, DbCommandTree commandTree)\n            at System.Data.EntityClient.EntityProviderServices.CreateDbCommandDefinition(DbProviderManifest providerManifest, DbCommandTree commandTree)\n            at System.Data.Common.DbProviderServices.CreateCommandDefinition(DbCommandTree commandTree)\n            at System.Data.Objects.Internal.ObjectQueryExecutionPlan.Prepare(ObjectContext context, DbQueryCommandTree tree, Type elementType, MergeOption mergeOption, Span span, ReadOnlyCollection`1 compiledQueryParameters, AliasGenerator aliasGenerator)\n            at System.Data.Objects.ELinq.ELinqQueryState.GetExecutionPlan(Nullable`1 forMergeOption)\n            at System.Data.Objects.ObjectQuery`1.GetResults(Nullable`1 forMergeOption)\n            at System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable&lt;T&gt;.GetEnumerator()\n            at System.Linq.Enumerable.FirstOrDefault[TSource](IEnumerable`1 source)\n            at System.Data.Objects.ELinq.ObjectQueryProvider.&lt;GetElementFunction&gt;b__1[TResult](IEnumerable`1 sequence)\n            at System.Data.Objects.ELinq.ObjectQueryProvider.ExecuteSingle[TResult](IEnumerable`1 query, Expression queryRoot)\n            at System.Data.Objects.ELinq.ObjectQueryProvider.System.Linq.IQueryProvider.Execute[S](Expression expression)\n            at System.Data.Entity.Internal.Linq.DbQueryProvider.Execute[TResult](Expression expression)\n            at System.Linq.Queryable.FirstOrDefault[TSource](IQueryable`1 source)\n            at System.Data.Entity.Internal.EdmMetadataRepository.QueryForModelHash(Func`2 createContext)\n            at System.Data.Entity.Internal.InternalContext.QueryForModelHash()\n            at System.Data.Entity.Internal.ModelCompatibilityChecker.CompatibleWithModel(InternalContext internalContext, ModelHashCalculator modelHashCalculator, Boolean throwIfNoMetadata)\n            at System.Data.Entity.Internal.InternalContext.CompatibleWithModel(Boolean throwIfNoMetadata)\n            at System.Data.Entity.Database.CompatibleWithModel(Boolean throwIfNoMetadata)\n            at System.Data.Entity.CreateDatabaseIfNotExists`1.InitializeDatabase(TContext context)\n            at System.Data.Entity.Internal.InternalContext.&lt;&gt;c__DisplayClass8.&lt;PerformDatabaseInitialization&gt;b__6()\n            at System.Data.Entity.Internal.InternalContext.PerformInitializationAction(Action action)\n       InnerException: System.IO.FileLoadException\n            HResult=-2146233067\n            Message=Could not load file or assembly 'Windows, Version=255.255.255.255, Culture=neutral, PublicKeyToken=null, ContentType=WindowsRuntime' or one of its dependencies. Operation is not supported. (Exception from HRESULT: 0x80131515)\n            Source=mscorlib\n            FileName=Windows, Version=255.255.255.255, Culture=neutral, PublicKeyToken=null, ContentType=WindowsRuntime\n            FusionLog=\"\"\n            StackTrace:\n                 at System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks)\n                 at System.Reflection.RuntimeAssembly.nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks)\n                 at System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, Evidence assemblySecurity, RuntimeAssembly reqAssembly, StackCrawlMark&amp; stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks)\n                 at System.Reflection.Assembly.Load(AssemblyName assemblyRef)\n                 at System.Data.Metadata.Edm.MetadataAssemblyHelper.SafeLoadReferencedAssembly(AssemblyName assemblyName)\n                 at System.Data.Metadata.Edm.MetadataAssemblyHelper.&lt;GetNonSystemReferencedAssemblies&gt;d__0.MoveNext()\n                 at System.Data.Metadata.Edm.ObjectItemCollection.ImplicitLoadViewsFromAllReferencedAssemblies(Assembly assembly)\n                 at System.Data.Mapping.StorageMappingItemCollection.ViewDictionary.SerializedCollectViewsFromReferencedAssemblies(MetadataWorkspace workspace, Dictionary`2 extentMappingViews)\n                 at System.Data.Mapping.StorageMappingItemCollection.ViewDictionary.SerializedGetGeneratedViews(EntityContainer container)\n                 at System.Data.Common.Utils.Memoizer`2.&lt;&gt;c__DisplayClass2.&lt;Evaluate&gt;b__0()\n                 at System.Data.Common.Utils.Memoizer`2.Result.GetValue()\n                 at System.Data.Common.Utils.Memoizer`2.Evaluate(TArg arg)\n                 at System.Data.Mapping.StorageMappingItemCollection.ViewDictionary.GetGeneratedView(EntitySetBase extent, MetadataWorkspace workspace, StorageMappingItemCollection storageMappingItemCollection)\n                 at System.Data.Metadata.Edm.MetadataWorkspace.GetGeneratedView(EntitySetBase extent)\n                 at System.Data.Query.PlanCompiler.PreProcessor.ExpandView(Node node, ScanTableOp scanTableOp, IsOfOp&amp; typeFilter)\n                 at System.Data.Query.PlanCompiler.PreProcessor.ProcessScanTable(Node scanTableNode, ScanTableOp scanTableOp, IsOfOp&amp; typeFilter)\n                 at System.Data.Query.PlanCompiler.PreProcessor.Visit(ScanTableOp op, Node n)\n                 at System.Data.Query.InternalTrees.ScanTableOp.Accept[TResultType](BasicOpVisitorOfT`1 v, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.VisitNode(Node n)\n                 at System.Data.Query.PlanCompiler.SubqueryTrackingVisitor.VisitChildren(Node n)\n                 at System.Data.Query.PlanCompiler.SubqueryTrackingVisitor.VisitRelOpDefault(RelOp op, Node n)\n                 at System.Data.Query.PlanCompiler.PreProcessor.Visit(ProjectOp op, Node n)\n                 at System.Data.Query.InternalTrees.ProjectOp.Accept[TResultType](BasicOpVisitorOfT`1 v, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.VisitNode(Node n)\n                 at System.Data.Query.PlanCompiler.SubqueryTrackingVisitor.VisitChildren(Node n)\n                 at System.Data.Query.PlanCompiler.SubqueryTrackingVisitor.VisitRelOpDefault(RelOp op, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.VisitSortOp(SortBaseOp op, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.Visit(ConstrainedSortOp op, Node n)\n                 at System.Data.Query.InternalTrees.ConstrainedSortOp.Accept[TResultType](BasicOpVisitorOfT`1 v, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.VisitNode(Node n)\n                 at System.Data.Query.PlanCompiler.SubqueryTrackingVisitor.VisitChildren(Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfNode.VisitDefault(Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfNode.VisitPhysicalOpDefault(PhysicalOp op, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.Visit(PhysicalProjectOp op, Node n)\n                 at System.Data.Query.InternalTrees.PhysicalProjectOp.Accept[TResultType](BasicOpVisitorOfT`1 v, Node n)\n                 at System.Data.Query.InternalTrees.BasicOpVisitorOfT`1.VisitNode(Node n)\n                 at System.Data.Query.PlanCompiler.PreProcessor.Process(Dictionary`2&amp; tvfResultKeys)\n                 at System.Data.Query.PlanCompiler.PreProcessor.Process(PlanCompiler planCompilerState, StructuredTypeInfo&amp; typeInfo, Dictionary`2&amp; tvfResultKeys)\n                 at System.Data.Query.PlanCompiler.PlanCompiler.Compile(List`1&amp; providerCommands, ColumnMap&amp; resultColumnMap, Int32&amp; columnCount, Set`1&amp; entitySets)\n                 at System.Data.EntityClient.EntityCommandDefinition..ctor(DbProviderFactory storeProviderFactory, DbCommandTree commandTree)\n            InnerException: \n</code></pre>\n\n<p>If i remove the reference eveything is working fine.\nIf i don't use EF but only Windows.winmd everything is working fine too, but i can't use both in same app. </p>\n\n<p>Any clue on this ?</p>\n\n<p>Thanks for your time.</p>\n\n<p>Jeff</p>\n"},{"tags":["linq","entity-framework","design-patterns"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12999789,"title":"Entity Framework, LINQ and patterns","body":"<p>I've started using EF and LINQ in a project and I'm trying to decide on the best approach/pattern to use. Until now I've been using a custom persistence framework that was based on DataSets and XML configuration. Basically it was a VS Custom Tool that would read the XML configuration file and the DataSets and would generate Object Oriented classes with all the necessary properties/associations/methods. This auto-generated classes then were used from the UI and I had the flexibility to expose only what the UI would need.</p>\n\n<p>Now with EF and LINQ, I'm not comfortable with the idea that the UI can use directly the auto-generated classes and all the LINQ stuff. It seems that this approach would have a very tight integration between UI and the database.</p>\n\n<p>So I'm looking for some pattern that would \"hide\" all the EF and LINQ goodies and basically limit what the UI can do. Is there any standard way to do this?</p>\n"},{"tags":["entity-framework","views","ef-model-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13020114,"title":"entity framework model update performed -autogenerated code not updated","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12734333/entity-framework-5-update-model-from-database-does-not-generate-table-class\">Entity Framework 5 update model from database does not generate table class</a>  </p>\n</blockquote>\n\n\n\n<p>Answer: Thanks Pawel for the link:\nThere is a bug in VS2012 - edmx in nested folder doesnt update generated code: <a href=\"http://entityframework.codeplex.com/workitem/453\" rel=\"nofollow\">entityframework.codeplex.com/workitem/453</a> </p>\n\n<p>Workarounds:\n- Right click on .tt file and select \"Run Custom Tool\"\n- Drag .edmx out of the nested folder</p>\n\n<hr>\n\n<p>Using EF 5.0 and VS2012 - I am trying to update my model with some new views I added.  The intention is that these views only need to be read-only - so they don't need to be updateable.  I attempted to update my model from the db, selected the views I wanted to add, and continued.</p>\n\n<p>I've verified that the entity shows up in the edmx file, and that the defining query is not commented.  I can see the views in the designer, however, the auto-generated partial class definitions for the views I am adding are never created (none added under the *.tt) - so I can't query these view entities from the context object.</p>\n\n<p>I created a new entity model from scratch, and the view models are created as expected.  Am I missing a step somewhere?  I could drop\\recreate my model, but this isn't really a feasible solution long term as new views are added.</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4.1"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13020769,"title":"In EF 4, can a subset of columns be represented by a class in .NET","body":"<p>Let's say I have the following tables setup in SQL Server (2008)</p>\n\n<p><img src=\"http://i.stack.imgur.com/R4VFE.png\" alt=\"\"></p>\n\n<p>Is there a way to generate the EDMX such that in my project Height, Weight and Age are properties of a public non entity class called <code>Characteristics</code> and that in code, I can address them as</p>\n\n<pre><code>ABoy.Characteristics.Height\nABoy.Characteristics.Weight\nABoy.Characteristics.Age\n\nAGirl.Characteristics.Height\nAGirl.Characteristics.Weight\nAGirl.Characteristics.Age\n</code></pre>\n\n<p>I want to do this, because in my actual case, there other methods on my Characteristic class.\nI do not want a common table, because Characteristic need not necessarily be tracked by EF unless they are added to a BOY or GIRL class.</p>\n\n<p><strong>EDIT:</strong> Writing this down made me realize that I could just have a partial class with a Characteristic type exposed for BOY and GIRL and it would just return an object of type Characteristic. I would also have a tracker to always return the same object per instance of BOY or GIRL and to update it if a modification came in.\nI'll leave this open for other suggestions.</p>\n"},{"tags":["c#","sql","linq","entity-framework","linq-to-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":130,"score":0,"question_id":13012545,"title":"How to execute nested query in Linq","body":"<p>I have a LINQ class of this format in C#:</p>\n\n<pre><code>class Vehicle\n{\n  int _VehicleID\n  int _ModelID\n\n  EntetySet&lt;Cars&gt; _AllCars\n  EntetySet&lt;Bus&gt; _AllBus\n  EntetyRef&lt;Driver&gt; _Person\n}\n</code></pre>\n\n<p><strong>Cars table</strong></p>\n\n<pre><code>CarsID | Manufacturer | Type\n1000   | Honda        | Diesel\n1001   | Mitsubishi   | Petrol\n1002   | Maruti       | Diesel\n</code></pre>\n\n<p><strong>Bus table</strong></p>\n\n<pre><code>BusID | Manufacturer | Type\n2000  | Volvo        | Diesel\n2001  | TATA         | Petrol\n2002  | layland      | Petrol\n</code></pre>\n\n<p>From the UI, I will get a Vehicle ID as a parameter. Based on that, all the cars, Bus and its associated tables will get copied to a variable. That is:</p>\n\n<pre><code>Vehicle v1 = new Vehicle();\nv1 = dc.vehicle.where(v =&gt; v.vehicleID == param.vehicleID).findfirst();\n</code></pre>\n\n<p>My <code>v1</code> has all the table and its contents which satisfies the above condition. </p>\n\n<p>Now, I want to filter some more based on the table content present in table cars and bus; i.e based on type of vehicle petrol or diesel.</p>\n\n<p>If I want to copy all the petrol cars and Buses using a query statement in a single line, please tell me the way.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","entity-framework","webmethod"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13017964,"title":"Trying to .Include a navigation property when using a return value on a webmethod","body":"<p>So I am trying to have a web method return an object which has a 1 to many relationship in EF. I am expecting the XML to build child nodes for each item in the many relationship, but it appears that the only relationships being populated are the ones going back up, not the ones going down. Here's my code.</p>\n\n<pre><code>[WebMethod]\npublic Question GetCurrentQuestion(int TeamID)\n{\n    var db = new DSG_pepsicenter_stagingEntities();\n    return db.Questions.Include(\"QuestionAnswers\").First(n =&gt; n.TeamID == TeamID);\n}\n</code></pre>\n\n<p>Basically my Questions table belongs to a team, and has many Question Answers. However, the Question Answers  are not present in the serialization that happens in the web method. Is there a way to force this? I know if I force it I risk an error with circular references but this is preferred to building a DTO. Thanks!</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","localization","string-similarity"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":86,"score":5,"question_id":13019140,"title":"Recognizing similarity in strings","body":"<p>I'm working on a system which allows imported files to be localized into other languages. </p>\n\n<p>This is mostly a private project to get the hang of MVC3, EntityFramework, LINQ, etcetera. Therefore I like doing some crazy things to spice up the end result, one of those things would be the recognition of similar strings.</p>\n\n<p>Imagine you have the following list of strings - borrowed from a game I've worked with in the past:</p>\n\n<ul>\n<li>Megabeth: Holy Roller Uniform - Includes Head, Torso, and Legs</li>\n<li>Megabeth: Holy Roller Uniform Head</li>\n<li>Megabeth: Holy Roller Uniform Legs</li>\n<li>Megabeth: Holy Roller Uniform Torso</li>\n<li>Megabeth: PAX East 2012 Uniform - Includes Head, Torso, and Legs</li>\n<li>Megabeth: PAX East 2012 Uniform Head</li>\n<li>Megabeth: PAX East 2012 Uniform Legs</li>\n<li>Megabeth: PAX East 2012 Uniform Torso</li>\n</ul>\n\n<p>As you can see, once users have translated the first 4 strings, the following 4 share a lot of similarities, in this case:</p>\n\n<ul>\n<li>Megabeth</li>\n<li>Uniform</li>\n<li>Includes Head, Torso, and Legs</li>\n<li>Head</li>\n<li>Legs</li>\n<li>Torso</li>\n</ul>\n\n<p>Consider the first 4 strings are indeed already translated, when a user selects the 5th string from the list, what kind of algorithm or technique can I use to show the user the 1st string (and potentially others) under a sub-header of \"Similar strings\"?</p>\n\n<p>Edit - A little comment on the Levenshtein Distance:\nI'm currently targeting 10k strings in the database. Levenshtein Distance compares string per string, so in this case 10k x (10k -1) possible combinations. How would I approach this in a feasible way? Is there a better solution that this particular algorithm?</p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":13014802,"title":"EF stored procedure with dynamic number of columns in result set","body":"<p>At first I should note that I'm new in ASP.NET (however, I have some experience with C#) and Entity Framework. I work on a school project and there is quite complicated database containing energy consumption data. Those I need (<code>I</code> import, <code>E</code> export, reactive power <code>C</code> and <code>L</code>) are stored in one column as binary compressed so to get them out I have to use a stored procedure which calls some methods in custom assembly to decompress the column and restore the data.</p>\n\n<p>The stored procedure has 4 arguments:</p>\n\n<pre><code>@identify int,\n@startTime datetime,\n@endTime datetime,\n@args nvarchar(60) -- \"Selector\"\n</code></pre>\n\n<p>The <code>selector</code> is rather special, it's an argument where you specify what you want in the result set, e.g. <code>'i'</code> for Import column only, <code>'i,e'</code> for Import and Export. They designed it like this because it's faster if you need just one column rather then all columns (because of the way the compressed data are stored).</p>\n\n<p>So, I've created an ADO.NET Entity Model called <code>EnergyConsumptionDBModel</code>, imported the stored procedure and created complex type <code>EnergyConsumptionResult</code> for the stored procedure return type as follows:</p>\n\n<pre><code>public partial class EnergyConsumptionResult\n{\n    public System.DateTime Time { get; set; }\n    public double I { get; set; }\n    public double E { get; set; }\n    public double L { get; set; }\n    public double C { get; set; }\n}\n</code></pre>\n\n<p>The column <code>Time</code> is always present in the result set, but the rest depends on the <code>@args</code> argument of the stored procedure. For example if I pick <code>'i,e,c,l'</code> as an argument, it will return columns <code>Time, I, E, C, L</code> and everything is just fine but if I pick for example <code>'i'</code> it returns <code>Time, I</code> which gives me an exception:</p>\n\n<blockquote>\n  <p><em>The data reader is incompatible with the specified 'EnergyConsumptionDBModel.EnergyConsumptionResult'.</em><br>\n  <em>A member of the type, 'E', does not have a corresponding column in the data reader with the same name.</em></p>\n</blockquote>\n\n<p>So the question is, is there some simple way to solve this? Some kind of dynamic result mapping on complex type or is it much more simple to tell my colleague who designed the stored procedure to make it return all columns whatever is in <code>@args</code> but leave the un-used columns empty which is a solution my project leader may not like. Thanks for any help.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13017777,"title":"Design considerations for using EF objects in ASP.net MVC","body":"<p>I am using EF code first in one of my mvc 3 projects. I have a question about what patterns to use when passing a complex EF POCO object to and from the views.</p>\n\n<p>For example, a customer object has a list of orders and each order has a list of items.  The customer object will be sent to the view. The view updates the customer object and its inside objects (orders, items), then send it back the controller. The controller have EF to persist the customer object. </p>\n\n<p>My questions are following:</p>\n\n<ol>\n<li><p>Should I serialize the EF poco object to a JSON object so I can use it inside the view?</p></li>\n<li><p>How can I re-construct the customer object when I recieve updates from view?</p></li>\n<li><p>After the customer object is reconstructed, Is it possible to save the entire object graph (customer, orders, items) in one shot?</p></li>\n</ol>\n\n<p>Thanks</p>\n"},{"tags":["c#","json","entity-framework","entity-framework-4","json.net"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":40,"score":4,"question_id":13017360,"title":"Setting individual entity properties based on list of entity properties","body":"<p>I have an intermediary object between my Entity Framework entities and a JSON object that I serialize/deserialize in order to import and export to a text file.</p>\n\n<p>When I am exporting from the entity framework I use the following code to iterate through the entity types properties...If the property in the entity matches the property from an enum that I have, the property gets saved to the JSON object.  This stops entity specific properties from cluttering up my JSON.</p>\n\n<pre><code>var blockProperties = typeof(FixedLengthBlock).GetProperties(BindingFlags.Public | BindingFlags.Instance);\nforeach (var property in blockProperties)\n{\n\n    if (Enum.GetNames(typeof(ModuleSettingEnum)).Contains(property.Name.ToLower()) &amp;&amp; property.GetValue((FixedLengthBlock)element, null) != null)\n        blockJsonEntity.Properties.Add(property.Name, property.GetValue((FixedLengthBlock)element, null).ToString());\n}\n</code></pre>\n\n<p>While the above code works, I cannot think of a similar way to do the opposite.  When reading back from JSON I have the properties/values in a dictionary.  I know that I can run through the properties of the EF Entity and search the dictionary if it contains a key like this:</p>\n\n<pre><code>var blockProperties = typeof(FixedLengthBlock).GetProperties(BindingFlags.Public | BindingFlags.Instance);\nforeach (var property in blockProperties)\n{\n        if (block.Properties.ContainsKey(property.Name))\n   {\n     ???????What goes here??????\n   }\n}\n</code></pre>\n\n<p>How do I get the matched property into the newly created entity I've made to receive the information.  I'd really like to avoid a large switch statement.</p>\n\n<p>My Json object looks like this:</p>\n\n<pre><code>public class JsonEntity\n{\n    public string Name { get; set; }\n    public string Type { get; set; }\n    public Dictionary&lt;string, string&gt; Properties { get; set; }\n    public List&lt;JsonEntity&gt; SubEntities { get; set; } \n\n    public JsonEntity()\n    {\n        Properties = new Dictionary&lt;string, string&gt;();\n\n    }\n}\n</code></pre>\n"},{"tags":["mysql","entity-framework","entity"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1892,"score":4,"question_id":1902523,"title":"Entity Framework - MySQL - Datetime format issue","body":"<p>I have a simple table with few date fields.</p>\n\n<p>Whenever I run following query:</p>\n\n<pre><code>var docs = ( from d in base.EntityDataContext.document_reviews\nselect d ).ToList();\n</code></pre>\n\n<p>I get following exception:</p>\n\n<pre><code>Unable to convert MySQL date/time value to System.DateTime. \nMySql.Data.Types.MySqlConversionException: Unable to convert MySQL date/time value to System.DateTime\n</code></pre>\n\n<p>The document reviews table has two date/time fields. One of them is nullable.</p>\n\n<p>I have tried placing following in connection string:</p>\n\n<pre><code>Allow Zero Datetime=true;\n</code></pre>\n\n<p>But I am still getting exception.</p>\n\n<p>Anyone with a solution?</p>\n"},{"tags":["linq","entity-framework","linq-to-entities","iqueryable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13016811,"title":"IQueryable Where integer property expression usage?","body":"<p>So I have a query I'm constructing using Entity Framework, LINQ. Depending on the search parameter, and the type of the parameter being searched. </p>\n\n<p>I have created a function like this:</p>\n\n<pre><code>public static IQueryable&lt;T&gt; WhereInt&lt;T&gt;(this IQueryable&lt;T&gt; query, string propertyName, string contains)\n        {\n            var parameter = Expression.Parameter(typeof(T), \"type\");\n            var propertyExpression = Expression.Property(parameter, propertyName);\n\n            MethodInfo method = typeof(string).GetMethod(\"First\");\n            var someValue = Expression.Constant(contains, typeof(string));\n            var containsExpression = Expression.Call(propertyExpression, method, someValue);\n\n            return query.Where(Expression.Lambda&lt;Func&lt;T, bool&gt;&gt;(containsExpression, parameter));\n\n        }\n</code></pre>\n\n<p>Used as such:</p>\n\n<pre><code>WhereInt(DCs, searchfield, search);\n</code></pre>\n\n<p><code>searchfield</code> could be userid, username, integer or string, and ideally I want to do:</p>\n\n<pre><code>searchfield.value == search.toInt32()\n</code></pre>\n\n<p>sort of feature.</p>\n\n<p>I want to also make <code>DateTime</code> types searchable too. Maybe I'll make a <code>WhereDateTime</code> for that.</p>\n\n<p>I get an error on <code>var containsExpression = Expression.Call(propertyExpression, method, someValue);</code></p>\n\n<p>This works fine with strings, but fails with the error:</p>\n\n<pre><code>Value cannot be null.\nParameter name: method\n</code></pre>\n"},{"tags":["c#","sql-server","wcf","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":100,"score":4,"question_id":12999591,"title":"Better way to call a stored procedure using Entity Framework and return restfully from WCF?","body":"<p>I want to create a WCF service that calls a stored procedure in SQL Server using the Entity Framework and returns the result set to a browser.</p>\n\n<p>I imported the stored procedure using the function import in EF and I built a complex type. </p>\n\n<p>It seems that a complex type from the EF cannot be serialized and returned restfully. The only way I have made this work is to create a concrete class and build it from the complex type returned from EF. This works but it means if I have 30 stored procedures I would need to create 30 concrete classes which is somewhat of a pain.  </p>\n\n<p>Is there a better way to do this?</p>\n\n<p>WCF contract:</p>\n\n<pre><code>[ServiceContract]\npublic interface IService1\n{\n    [OperationContract,WebGet,XmlSerializerFormat]\n    List&lt;People&gt; usp_GetPeople();    \n}\n</code></pre>\n\n<p>Concrete class would need to be created for every procedure:</p>\n\n<pre><code>public class People\n{\n    public int person_id;\n    public string last_name;\n    public string first_name;\n    public string street_addr;\n    public string state_code;\n    public string postal_code;\n\n    public People(int person_id, string last_name, string first_name, string street_addr, string state_code, string postal_code)\n    {\n        this.person_id = person_id;\n        this.last_name = last_name;\n        this.street_addr = street_addr;\n        this.state_code = state_code;\n        this.postal_code = postal_code;\n    }\n\n    public People() { }\n}\n</code></pre>\n\n<p>WCF service:</p>\n\n<pre><code>public class Service1 : IService1\n{\n/// &lt;summary&gt;\n/// Call stored proc and return resultset.\n/// &lt;/summary&gt;\n/// &lt;returns&gt;List of resultset as concrete class People.&lt;/returns&gt;\npublic List&lt;People&gt; usp_GetPeople()\n{\n    try\n    {\n        using (var db = new demoEntities())\n        {\n            var res = db.usp_GetPeople();\n\n            List&lt;People&gt; lst = new List&lt;People&gt;();\n\n            foreach (usp_GetPeople_Result r in res)\n            {\n                People p = new People(r.person_id, r.last_name, r.first_name, r.street_addr, r.state_code, r.postal_code);\n                lst.Add(p);\n            }\n\n            return lst;\n        }\n    }\n    catch (Exception e)\n    {\n        Utility.Log(\"Error in usp_GetPeople. \" + e.ToString());\n        return null;\n    }\n}\n</code></pre>\n"},{"tags":["linq","entity-framework","include"],"answer_count":3,"favorite_count":5,"up_vote_count":14,"down_vote_count":0,"view_count":16662,"score":14,"question_id":3356541,"title":"Entity framework linq query Include() multiple children entities","body":"<p>This may be a really elementry question but whats a nice way to include multiple children entities when writing a query that spans THREE levels (or more)?</p>\n\n<p>i.e. I have 4 tables: <code>Company</code>, <code>Employee</code>, <code>Employee_Car</code> and <code>Employee_Country</code></p>\n\n<p>Company has a 1:m relationship with Employee.</p>\n\n<p>Employee has a 1:m relationship with both Employee_Car and Employee_Country.</p>\n\n<p>If i want to write a query that returns the data from all 4 the tables, I am currently writing:</p>\n\n<pre><code>Company company = context.Companies\n                         .Include(\"Employee.Employee_Car\")\n                         .Include(\"Employee.Employee_Country\")\n                         .FirstOrDefault(c =&gt; c.Id == companyID);\n</code></pre>\n\n<p>There has to be a more elegant way! This is long winded and generates horrendous SQL</p>\n\n<p>I am using EF4 with VS 2010</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#","entity-framework","wcf-data-services","odata","dataservice"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":76,"score":0,"question_id":13015816,"title":"WCF Data Client does not send entity properties values","body":"<p>When i try to send an instance of MULTIMEDIA type, with</p>\n\n<pre><code>hasStream=\"true\"\n</code></pre>\n\n<p>property set to true, the WCF Data Server seems not to receive entity data.</p>\n\n<p>On the client side i iterate over a collection of objects and i try to send them to another wcf data service. The reference to the \"other wcf data service\" is:</p>\n\n<pre><code>this.centralCtx\n</code></pre>\n\n<p>Also i set the saved stream for the each new entity and initialize all properties copying them from the source entity:</p>\n\n<pre><code>foreach (LOCAL_TYPE localObject in localObjects)\n{\n  if (entityName == \"MULTIMEDIA\")\n       {\n           CentralService.ARTICOLI article = null;\n           CentralService.MULTIMEDIA multimedia = new CentralService.MULTIMEDIA();\n           LocalService.MULTIMEDIA lMultimedia = localObject as LocalService.MULTIMEDIA;\n           multimedia.ID_MULTIMEDIA = lMultimedia.ID_MULTIMEDIA;\n           multimedia.DATA_CREAZIONE = lMultimedia.DATA_CREAZIONE;\n           multimedia.DATA_ULTIMA_MODIFICA = lMultimedia.DATA_ULTIMA_MODIFICA;\n           multimedia.ARTICOLO_ID = lMultimedia.ARTICOLO_ID;\n\n           this.centralCtx.TryGetEntity(\n           new Uri(this.centralCtx.BaseUri + \"ARTICOLI('\" + multimedia.ARTICOLO_ID \n           + \"')\", UriKind.Absolute), out article);\n\n           article.MULTIMEDIA.Add(multimedia);\n           this.centralCtx.AddRelatedObject(article, \"MULTIMEDIA\", multimedia);\n           DataServiceStreamResponse streamResponse = this.localCtx.GetReadStream(localObject);\n           this.centralCtx.SetSaveStream(multimedia, streamResponse.Stream, \n                      true, \"image/jpeg\", \"\");\n           //this.centralCtx.UpdateObject(article);\n        }\n        else {\n          CENTRAL_TYPE cloned = DbHelper.FlatCloneFromType&lt;LOCAL_TYPE, CENTRAL_TYPE&gt;\n                                     (localObject, centralCtx);\n          this.centralCtx.AddObject(entityName, cloned);\n        }\n      }\n\n      try\n      {\n         this.centralCtx.SaveChanges();\n         Notify(progressAction, \"Exported table \" + entityName, null);\n         successAction(this.Log);\n      }\n      catch (Exception ex)\n      {\n         Notify(progressAction, \"Error exporting table \" + entityName, ex);\n         this.synchResult = SynchResultType.Error;\n         exceptionAction(ex);\n      }\n</code></pre>\n\n<p>This is change interceptor code:</p>\n\n<pre><code>[ChangeInterceptor(\"MULTIMEDIA\")]\n    public void OnChangeMultimedia(MULTIMEDIA changedObject, UpdateOperations op)\n    {\n        switch (op)\n        {\n            case UpdateOperations.Add:\n                if(changedObject.ID_MULTIMEDIA == null)\n                    changedObject.ID_MULTIMEDIA = Guid.NewGuid().ToString();\n                changedObject.STATO_INTERNO = \"TRASFERITO\";\n                changedObject.DATA_ULTIMA_MODIFICA = changedObject.DATA_ULTIMA_MODIFICA == null\n                    ? DateTime.Now.ToLocalTime() : changedObject.DATA_ULTIMA_MODIFICA;\n                this.CurrentDataSource.SaveChanges();\n                break;\n            default: break;\n        }\n    }\n</code></pre>\n\n<p>All the properties of changedObject on the server inside MULTIMEDIA change interceptor are always null. Why???????????</p>\n"},{"tags":["asp.net","vb.net","entity-framework",".net-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":119,"score":4,"question_id":12991587,"title":"Setting values when a user updates a record using Entity Framework 4 and VB.NET in ASP.NET application","body":"<p>this is my first post, hopefully I'm following the rules!</p>\n\n<p>After a few weeks of banging my head against brick walls and endless hours of internet searches, I have decided I need to make my own post and hopefully find the answers and guidance from all you experts.</p>\n\n<p>I am building an ASP.NET application (in Visual Studio 2010) which uses an SQL 2008 database and Entity Framework 4 to join the two parts together.  I designed the database as a database project first, then built the Entity Model as a class project which is then referenced in the main ASP.NET project.  I believe this is called Database First in Entity Framwork terms?</p>\n\n<p>I'm fairly new to Web Apps (I mainly develop WinForms apps) and this is my first attempt at using Entity Framwork.</p>\n\n<p>I can just about understand C# so any code samples or snippets you might supply would be preferred in VB if possible.</p>\n\n<p>To give some background on where I am so far.  I built a regsitration page called register.aspx and created a wizard style form using ASP:Wizard with ASP:TextBox, ASP:DropdownList and ASP:CheckBoxList it's all laid out inside a HTML table and uses CSS for some of the formatting.  Once the user gets the the last page in the wizard and presses \"Finish\" I execute some code in the VB code behind file as follows:</p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>Protected Sub wizardRegister_FinishButtonClick(sender As Object, e As System.Web.UI.WebControls.WizardNavigationEventArgs) Handles wizardRegister.FinishButtonClick\n    Dim context As New CPMModel.CPMEntities\n    Dim person As New CPMModel.Person\n    Dim employee As New CPMModel.Employee\n\n    Dim newID As Guid = Guid.NewGuid\n\n    With person\n        .ID = newID\n        .UserID = txbx_UserName.Text\n        .Title = ddl_Title.SelectedValue\n        .FirstName = txbx_FirstName.Text\n        .MiddleInitial = txbx_MiddleInitial.Text\n        .FamilyName = txbx_FamilyName.Text\n        .Gender = ddl_Gender.SelectedValue\n        .DOB = txbx_DOB.Text\n        .RegistrationDate = Date.Now\n        .RegistrationMethod = \"W\"\n        .ContactMethodID = New Guid(ddl_ContactMethodList.SelectedValue)\n        .UserName = txbx_UserName.Text\n        If Not (My.Settings.AuthenticationUsingAD) Then\n            .Password = txbx_Password.Text ' [todo] write call to salted password hash function\n        End If\n        .IsRedundant = False\n        .IsLocked = False\n    End With\n\n    context.AddToPeople(person)\n\n    With employee\n        .ID = newID\n        .PayrollNumber = txbx_PayrollNumber.Text\n        .JobTitle = txbx_JobTitle.Text\n        .DepartmentID = ddl_DepartmentList.SelectedValue\n        .OfficeNumber = txbx_OfficeNumber.Text\n        .HomeNumber = txbx_HomeNumber.Text\n        .MobileNumber = txbx_MobileNumber.Text\n        .BleepNumber = txbx_BleepNumber.Text\n        .OfficeEmail = txbx_OfficeEmail.Text\n        .HomeEmail = txbx_HomeEmail.Text\n        .IsRedundant = False\n        .RedundantDate = Nothing\n\n         '--------------------------\n        .FiledBy = Threading.Thread.CurrentPrincipal.Identity.Name\n        .FiledLocation = My.Computer.Name\n        .FiledDateTimeStamp = Date.Now\n        '----------------------------\n    End With\n\n    context.AddToEmployees(employee)\n    context.SaveChanges()\nEnd Sub\n</code></pre>\n\n<p>The above works fine, seemed to be a sensible way of doing it (remember I'm new to Entity Framework) and gave me the results I extpected.</p>\n\n<p>I have another page called manage.aspx on this page is a tab control, each tab page contains a asp:DetailsView which is bound to an asp:EntityDataSource, I have enabled Update on all the Entity Data Sources and on some I have also enabled Insert, none of the have delete enabled.</p>\n\n<p>If I build and run the app at this stage everything works fine, you can press the \"edit\" link make changes and then press \"update\" and sure enough those updates are displayed on the screen instantly and the database does have the correct values in.</p>\n\n<p>Here's the problem, I need to intercept the update in the above code (the bold bit) notice there is a column in my database called FiledBy, FiledLocation, and FiledDateTimeStamp.  I don't want to show these columns to the user viewing the ASP.NET page but I want to update them when the user presses update (if there were any changes made).  I have tried converting the ASP:DetailsView into a template and then coding the HTML side with things like;</p>\n\n<pre><code>&lt;@# Eval(User.Name) #&gt;\n</code></pre>\n\n<p>I did manage to get it to put the correct values in the textboxes when in edit mode but I had the following problems;</p>\n\n<ol>\n<li>It didn't save to the database</li>\n<li>I have to show the textboxes which I don't want to do</li>\n</ol>\n\n<p>I have read on several other posts on here and other websites that you can override the SaveChanges part of the Entity Framwork model one example of this is in the code below;</p>\n\n<pre><code>public override int SaveChanges() \n{\nvar entities = ChangeTracker.Entries&lt;YourEntityType&gt;() \n                            .Where(e =&gt; e.State == EntityState.Added) \n                            .Select(e =&gt; e.Entity); \nvar currentDate = DateTime.Now; \nforeach(var entity in entities) \n{ \n    entity.Date = currentDate; \n} \n\nreturn base.SaveChanges(); \n} \n</code></pre>\n\n<p>The problem is, that whilst I understand the idea, and can just about transalate it to VB I have no idea how to implement this.  Where do I put the code?  How do I call the code? etc.</p>\n\n<p>I would ideally like to find a solution that meets the following requirements:</p>\n\n<ul>\n<li>Doesn't get overwritten if I was to regenerate / update the Entity Model</li>\n<li>Doesn't need to be copy and pasted for every table in my model (most but not all have the audit columns in)</li>\n<li>Can be used for other columns, for example, if a user make a selection in a check list I may want to write some value into another (not exposed to the user) column.</li>\n</ul>\n\n<p>Am I taking the right approach to displaying data in may webpages I certainly find the DataView and GridView limiting, I did think about creating a form like the registration form in table tags but have no Idea how to populate the textboxes etc with values from the database nor how to implement paging as many of the tables have one to many relationships, although saving changes would be easy if I did populate textboxes on a table.</p>\n\n<p>Thank you all in advance to anyone who offers there support.</p>\n\n<p>Kevin.</p>\n\n<p>Ok so I have now got closer, but still not got it working correctly.  I've used the following code to edit the value in the DetailsView on the Databound event.  If writes the correct timestamp into the read only textbox but does not right this value back to the database when you press the Update button on the DetailsView control.</p>\n\n<pre><code>Protected Sub dv_Employee_DataBound(sender As Object, e As EventArgs) Handles dv_Employee.DataBound\n    If dv_Employee.CurrentMode = DetailsViewMode.Edit Then\n        For Each row In dv_Employee.Rows\n            If row.Cells(0).Text = \"FiledDateTimeStamp\" Then\n                row.Cells(1).Text = Date.Now()\n            End If\n        Next\n    End If\nEnd Sub\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":13001441,"title":"Delete .mdf file from app_data causes exception cannot attach the file as database","body":"<p>I am building a web application using VS 2012 MVC4 code first. In order to recreate the <code>.mdf</code> file after I changed the model, I manually deleted the file from the app_data directory in VS. I have done this a few times before without any problem.</p>\n\n<p>Now I receive an exception: </p>\n\n<blockquote>\n  <p><em>The underlying provider failed on Open. ==> Cannot attach the file\n  <code>MYDB.mdf</code> as database <code>'MYDB'</code>.</em></p>\n</blockquote>\n\n<p>I will appreciate your help on how to recreate the <code>.mdf</code> file.</p>\n\n<p>Thank you!</p>\n"},{"tags":["wpf","entity-framework","visual-studio-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":236,"score":0,"question_id":12015311,"title":"Entity Framework With Visual Studio 2012 and WPF","body":"<p>I bought visual studio 2012, but I noticed that when I use WPF, connect a database with EF, it does not automatically create multiple classes in the data source to bind to Datagrid.  This is not the same behaviour as in Visual Studio 2010.</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","edmx"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13014819,"title":"edmx not taking defaults from DB","body":"<p>Here is my scenario. I have a SQL Server database that I am using as the backend. And my application is in ASP.net. I have defined defaults for 2 of the columns in the DB table, table name is <code>Car</code>.</p>\n\n<ol>\n<li>One of the columns in the <code>Car</code> table is called <code>Qty</code> and it's type is <code>Int</code>. I have set a default for this column in the database as 0 (zero)</li>\n<li>Another column in the <code>Car</code> table is called <code>Model</code> and it's type is <code>nvarchar(50)</code>. I have set a default for this column in the database as <code>*</code></li>\n</ol>\n\n<p>I want these defaults to show up in the edmx as well. My intention is that when I declare a new instance of class <code>Car</code> in code, I want the default value of <code>Qty</code> to show up as 0 (instead of null) and I want the default value of <code>Model</code> to show up as <code>*</code> (instead of null). </p>\n\n<p>So after doing quite a bit of reading I realized that I need to set <code>StoageGeneratedPattern = Computer</code> for both <code>Qty</code> and <code>Model</code> in the edmx file.</p>\n\n<p>It works perfectly for <code>Qty</code>. When I define a new instance of class <code>Car</code> and look at the properties, I see that <code>Qty</code> is 0. <strong>BUT</strong> for <code>Model</code>, the default is still <code>null</code> (instead of <code>*</code>). </p>\n\n<p>Here is what I have done. I have set <code>nullable = false</code> and <code>StorageGeneratedPattern = Computed</code>, in the CSDL content and in the SSDL content of the edmx file. I still can't seem to get <code>*</code> as the default value for <code>Model</code>. What am I missing here?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":13014872,"title":"Subtle difference in using object initialiser inline opposed to passing variable of one to EF Select","body":"<p>What's the difference between saving a Func as a variable and then passing it to a entity framework select opposed to typing the conversion inline inside of the select.</p>\n\n<pre><code>Func&lt;Models.Contact,ViewModels.Contact&gt; ToViewModel = \n    c =&gt; new ViewModels.Contact()\n    {\n        ID = c.ID,\n        ...\n        UserName = c.User.UserName\n    };\n\n...\n\nreturn dc.Contacts.Select(ToViewModel);\n</code></pre>\n\n<p>as opposed to</p>\n\n<pre><code>return dc.Contacts.Select(c =&gt; new ViewModels.Contact()\n{\n    ID = c.ID,\n    ...\n    UserName = c.User.UserName\n});\n</code></pre>\n\n<p>I ask this because although both methods work, they have subtly different reaction to nulls and a few other things and I can't understand why.</p>\n\n<p>For example in this case, a Contact may or may not have a User, so User may or may not be null. When typing the initialiser inline it will fail the property gracefully to null. However when passing the same initializer via the variable it will throw a NullReferenceException.</p>\n\n<p>Why is this?</p>\n\n<p>Note that the reason I want to save the initialiser is so that it can be reused in each of the CRUD operations for returning an object from a WebApi. It would be annoying to have to copy and paste the select around the class, especially if over time properties need to be added or removed from the response.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13012099,"title":"Entity Framework 5 code first newsequentialid() as PK","body":"<p>How can I use <code>newsequentialid()</code> as default value in the PK column?</p>\n\n<p>I have this annotation:</p>\n\n<pre><code>[Key, DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n</code></pre>\n\n<p>But this will generate random guid's I would like to have sequential guid's.</p>\n\n<p>I can set by hand the database to <code>newsequentialid()</code> as default value, but is there no better option? Or did the EF team forget about this option?</p>\n"},{"tags":["c#","entity-framework","linq-to-entities","count"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13012472,"title":"Group and Count in Entity Framework","body":"<p>I have a table with Logs and I am counting the Logs per day as follows:</p>\n\n<pre><code>// Count logs by day\nIList&lt;DataModel&gt; models = _context.Logs\n  .Where(x =&gt; x.Created &gt;= dateMinimum &amp;&amp; x.Created &lt;= dateMaximum)\n  .GroupBy(x =&gt; new { Year = x.Created.Year, Month = x.Created.Month, Day = x.Created.Day })\n  .Select(x =&gt; new { Year = x.Key.Year, Month = x.Key.Month, Day = x.Key.Day, Count = x.Count() })\n  .AsEnumerable()\n  .Select(x =&gt; new DataModel { Date = new DateTime(x.Year, x.Month, x.Day), LogsCount = x.Count })\n  .ToList();\n\n// Fill empty days with dates which contains all days in range\nmodels.AddRange(dates.Where(x =&gt; !models.Any(y =&gt; y.Date == x.Date)).Select(x =&gt; new DataModel { Date = x, LogsCount = 0 }));\n</code></pre>\n\n<p>This is working if I want to count all logs by day independently of the type.</p>\n\n<p>But I would like to count logs by day and type (Error, Warn, Info, ...).</p>\n\n<p>I tried to add x.Type to group but at the end I get only 3 items.</p>\n\n<p>At the moment my DataModel is the following:</p>\n\n<pre><code>public class DataModel\n{\n    public DateTime Date { get; set; }\n    public Int32 LogsCount { get; set; }\n}\n</code></pre>\n\n<p>But maybe it should be something like:</p>\n\n<pre><code>public class DataModel\n{\n    public DateTime Date { get; set; }\n    public KeyValuePair&lt;String, Int32&gt; LogsCount { get; set; }\n}\n</code></pre>\n\n<p>Where LogsCount has a string which holds the Type and Int32 which contains the count.</p>\n\n<p>How can I do this?</p>\n"},{"tags":["c#","wcf","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":13006216,"title":"WCF -An error occurred while receiving the HTTP response","body":"<p>I try to get list from service like this:</p>\n\n<pre><code>   static void Main(string[] args)\n    {\n      MyClient proxy = new MyClient();\n      List&lt;X&gt; l = proxy.Func(1).ToList();\n    }\n</code></pre>\n\n<p>X is class from DLL of entity framework project.</p>\n\n<p>My function in service look like this:</p>\n\n<pre><code>    public List&lt;X&gt; Func(int NUM)\n    {                      \n        ProjectContext MyContext = new ProjectContext();\n        s = MyContext.X.ToList();\n        return s;\n\n    }\n</code></pre>\n\n<p>My context define like this:</p>\n\n<pre><code>public class ProjectContext : DbContext\n{\n\n    public ProjectContext ()\n        : base(\"name=ApplicationServices\")\n    {\n        this.Configuration.ProxyCreationEnabled=false;\n        this.Configuration.LazyLoadingEnabled = false;\n    }\n\n    public DbSet&lt;XX&gt; X{ get; set; }\n\n}\n</code></pre>\n\n<p>I get error: </p>\n\n<p>An error occurred while receiving the HTTP response to XXX. This could be due to the service endpoint binding not using the HTTP protocol. This could also be due to an HTTP request context being aborted by the server (possibly due to the service shutting down). See server logs for more details.</p>\n"},{"tags":["asp.net-mvc","entity-framework","domain-driven-design","poco"],"answer_count":5,"favorite_count":3,"up_vote_count":9,"down_vote_count":0,"view_count":230,"score":9,"question_id":12982680,"title":"Gave up DDD, but need some of its benefits","body":"<p>I'm giving up traditional DDD, which is often a massive timewaster, and forces me to do endless mapping: <code>data layer &lt;--&gt; domain layer &lt;--&gt; presentation layer</code>.</p>\n\n<p>For even a small change I must change data models, domain models, presentation models / viewmodels, then the repositories, manager/service classes, and of course the AutoMapper maps, and then test the whole thing! Each call requires calling a layer which calls a layer which calls the underlying code. <em>And I don't get anything in return other than \"you might need it in the future\"</em>. Meh.</p>\n\n<p><strong>My current approach</strong> is more pragmatic:  </p>\n\n<ul>\n<li>I don't worry about the difference between the \"data layer\" and \"domain layer\" any longer, as there's no point - the terms are interchangeable. I let EF do it's thing, and add interfaces and repositories on top when needed.  </li>\n<li>I've merged my \"data\" and \"domain\" projects (into \"core\", boring name, I know), and I could almost swear that Visual Studio is actually running faster.  </li>\n<li>I allow EF entities to go up and down the stack, but, I still map them to presentation models / viewmodels as usual.  </li>\n<li>For simple operations I call repositories directly from controllers, for complex operations I use domain managers/services as usual; the repositories never expose IQueryable.  </li>\n<li>I define entities/POCOs as partial classes, so I can add domain behavior separately in corresponding partial classes.</li>\n</ul>\n\n<p><strong>The problem:</strong> I now use the entities all over the place, so client code can see their <em>navigation properties</em>. And the models are always materialized after they leave a repository, so those navigation properties are often null.</p>\n\n<p><strong>Possible solutions:</strong><br>\n1. Live with it. It's ugly but preferable to the problems explained above.<br>\n2. For each entity, define an interface which hides the navigation properties; and make client code use the interfaces. But ironically, this means another layer (albeit thin and manageable).<br>\n3. What else?</p>\n\n<p>I'm not used to this sort of fast-and-loose programming style, so maybe I'm missing some obvious tricks. Is there anything else I should take into account? I'm sure there are other problems I will encounter soon.</p>\n\n<p><strong>EDIT:</strong>\nThis question is not about DDD. And note that many struggle with a traditional DDD approach -- <a href=\"http://stackoverflow.com/a/1961139/1711500\">Seemann appears to</a> arrive at <a href=\"http://blog.ploeh.dk/2012/02/09/IsLayeringWorthTheMapping.aspx\" rel=\"nofollow\">the same conclusion</a>, <a href=\"http://ayende.com/blog/4788/the-wages-of-sin-proper-and-improper-usage-of-abstracting-an-or-m#feedback\" rel=\"nofollow\">Rahien speaks about the \"Useless Abstraction For The Sake Of Abstraction Anti Pattern\"</a>, and Evans himself said DDD is only truly useful in 5% of cases. Also <a href=\"http://stackoverflow.com/a/796961/1711500\">see this thread</a>. Some of the comments/answers are predictably about how I'm doing DDD wrong, or how I can tweak my system to do it right. However, I'm not asking about DDD or bashing it for the cases where it is suitable, rather I'd like to know what others are doing in line with the thinking I've described above. It's not as if DDD is a panacea to all design ills, every decade a new process comes out (RUP anyone? XP, Agile, Booch, blah...). DDD is just the shiniest new one, and the most well known and used. But pragmatism should come first as I'm trying to build salable products that ship on time and are easy to maintain. The most useful programming axiom I've learned, <em>by far</em>, is YAGNI. <em>What I want is to change my system to a sort of \"DDD-lite\", where I get it's strong design/OOP/pattern philosophy, but without the fat.</em></p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","membership"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13008921,"title":"user role based data querying","body":"<p>I have a common problem as follows for a system. I'm developing the system with entity framework &amp; MVC3. I would like to know how to solve the following issue.</p>\n\n<p>I have users in a user table have the access to the system and the users are assigned to specific divisions within different departments. And also they will have the hierarchy where the managers can view the users who are working under their department/division.</p>\n\n<p>For example if the IT manager login into the system, I want to show only the people who are working in the IT division under him (the same department) &amp; I don't want to show all the other users details to him. Currently I'm using a long sql query to check and load the relevant users from that division, but I would like to do it through lINQ, with entity framework in any effective way.</p>\n\n<p>if anybody can suggest any changes in the database structure of the membership table and sample code to achieve this, it would be great. Please do let me know if the question is not clear.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13004081,"title":"Adding a new table to EF","body":"<p>We are upgrading an old VB6 application which sits on a SQL Server 2005 database, to an Entity Framework solution. The database remains the same, except - we're adding a new table. Is it possible with Entity Framework, to maintain the existing structure, when it gets installed on a client PC - and just add one new table?</p>\n\n<p>Is this how Code First will work? Can I be 100% certain that no other tables will be modified?</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13000744,"title":"Why does EF require the id of an entity as well as the reference","body":"<p>I've a question about Entity Framework. In a code first scenario I have a person class that references an address. In my domain I would have this as a reference to the Address class. All the examples of Entity Framework I've seen also require an AddressId field. This is something that I think shouldn't be there and isn't required in my domain driven model.</p>\n\n<p>Why does EF require this? Can I do without it (I don't believe NHibernate requires this).</p>\n\n<p>Thanks</p>\n\n<pre><code>public class Person()\n{\n    public int Id {get;set;}\n    public string Name {get;set;}\n    public Address Address {get;set;}\n    public int AddressId {get;set;} //Entity Framework seems to require this\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13010347,"title":"Entity Framework and Layer objects","body":"<p>I am little bit confuse while comparing my existing 3 Tier Web application with new requirement of 3 Tier Web Application with Entity Framework. </p>\n\n<p>In my previous application i had following layers:-</p>\n\n<ol>\n<li>Data Access layer (CRUD operation with Microsoft.Application.DataBlock)</li>\n<li>Business Logic (From where i am passing object to DAL).</li>\n<li>Presentation Layes (Which takes input and assign object to Business Layer.</li>\n<li>Objects (Employee Class, Department Class etc)</li>\n</ol>\n\n<p>When i use Entity framework i realize that properties or method which i created in previous application (Object) are same as in Data Access layer. I am wondering now why should i create object if i can get object from entities created with [Table] attribute.</p>\n\n<pre><code>Example\n//Entity\n[Table]\npublic class Employee\n{\n[Column]\npublic string EmployeeId{set; get;}\n\n[Column]\npublic string EmployeeName {set;get;}\n}\n\n//Object\n\n\npublic class Employee\n{\n\npublic string EmployeeId{set; get;}\n\n\npublic string EmployeeName {set;get;}\n}\n</code></pre>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":1033,"score":6,"question_id":592504,"title":"How can I see the Entity Framework's pending changes?","body":"<p>I'm creating an application with the ADO.NET Entity Framework.</p>\n\n<p>I can step through my code line-by-line while debugging and watch SQL Server Profiler for every query executed, but I can't figure out where all those SQL commands are coming from!</p>\n\n<p>Sometimes when I execute <code>SaveChanges()</code>, the Entity Framework performs unexpected, weird INSERTS.  They sometimes break the application.  I can't figure out what I'm doing to cause them.</p>\n\n<p>How can I monitor the pending changes that queue up waiting for a <code>SaveChanges()</code> call?</p>\n"},{"tags":["asp.net",".net","asp.net-mvc-3","entity-framework","entity"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":12963820,"title":"ASP.NET retrieving data from nowhere","body":"<p>I am going through <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3\" rel=\"nofollow\">ASP.NET MVC 3 tutorial</a>. Got to the point where <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-aspnet-mvc3/cs/adding-a-model\" rel=\"nofollow\">EnityFramework was used for model classes</a>. I ran the the application without having connection strings in the web.config specified and it worked.</p>\n\n<p>I could add, edit, delete records. And the weirdest thing is that they are sill there even after I stop development server and start debugging application again as if table was created somewhere in memory and stayed alive for some reason. Can anybody explain what was going on?</p>\n\n<p>Here's a link to an image:\noi48.tinypic.com/fnbeba.jpg</p>\n\n<p>Was it supposed to use the the connection string for which name matches the name of the class derived from DbContext?</p>\n\n<p>EDIT1:<br>\nBecause I had no connection string in web.config it was generated by Enity Framework using namespace and the name of the class derived from DBContext. By default EF uses SQL Express, hence database file was created in database server's DATA direcotry C:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.SQLEXPRESS\\MSSQL\\DATA.</p>\n\n<p>The last thing I don't understand why it wouldn't create the database file in App_Data dir if DBContext derived class is</p>\n\n<pre><code>public class MoviesDBContex : DbContext\n{\n    public DbSet&lt;Movie&gt; Movies { get; set; }\n\n    // Passing name of the connections string shouldn't be even necessary\n    public MoviesDBContex()\n        : base(\"MoviesDBContex\")\n    { }\n}\n</code></pre>\n\n<p>and web.config contains</p>\n\n<pre><code>  &lt;connectionStrings&gt;\n    &lt;add name=\"MoviesDBContext\"\n      connectionString=\"Data Source=|DataDirectory|Movies.sdf\"\n      providerName=\"System.Data.SqlClient\"/&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>Thist what the Microsoft guide about ER connections and models (msdn.microsoft.com/en-us/data/jj592674.aspx) says:</p>\n\n<blockquote>\n  <p>If the name of the connection string matches the name of your context (either with or without namespace qualification) then it will be found by DbContext when the parameterless constructor is used. If the connection string name is different from the name of your context then you can tell DbContext to use this connection in Code First mode by passing the connection string name to the DbContext constructor.</p>\n</blockquote>\n\n<p>Any idea why database file isn't created in App_Data?</p>\n\n<p>EDIT2:<br>\nThere was a missing 't' in the class name and hence it didn't match the name of the connection string.</p>\n\n<p>I does work as expected when provider is SQL Server Compact providerName=\"System.Data.SqlServerCe.4.0\", but if I change it to providerName=\"System.Data.SqlClient\" I get an exception added below. Shouldn't regular SQL Server be able to create a database file also?</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</p>\n  \n  <p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n</blockquote>\n"},{"tags":["entity-framework","entity-framework-4","entity"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13007473,"title":"Entity Framework (Add/Create) Object reference not set to an instance of an object... but it is?","body":"<p>I'm using entity framework to access an exsisting database. I can access the data but when I try to add new data I get a NullReferenceException \"Object reference not set to an instance of an object\", but it is?</p>\n\n<p>The DB connection is fine, I can access the data just fine:  <code>List&lt;log&gt; logs = db.log.ToList();</code></p>\n\n<p>The exception is thrown when using Add or Create:</p>\n\n<pre><code>db.log.Add(new log());\ndb.log.Create();\n</code></pre>\n\n<p>StackTrace:</p>\n\n<pre><code>at System.Data.Entity.DbSet`1.Create()\n</code></pre>\n\n<p>UPDATE:</p>\n\n<p>The Error only occurs OUTSIDE the namespace containing the DB Context. I can work around it by wrapping the classes to have their 'Add to DB context'-methods in the DBHandler namespace. But I would like an explanation to why this happens. Is it a bug or am I violating some sacred .net law?</p>\n\n<p>Thanks for your time!</p>\n"},{"tags":["mysql","wpf","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":770,"score":3,"question_id":10638456,"title":"Entity framework 5.0 code-first with MySQL in WPF","body":"<p>This walkthrough works great with SQL Express:\n<a href=\"http://msdn.microsoft.com/en-us/library/gg197522(v=VS.103).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/gg197522(v=VS.103).aspx</a></p>\n\n<p>I would like it to work with MySQL. I've done some research but none of the techniques I've found has been able to do it for me. Ideally I would like to do something like this:</p>\n\n<pre><code>      &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"MySql.Data.MySqlClient.MySqlClientFactory, MySql.Data\" /&gt;\n  &lt;/entityFramework&gt;\n</code></pre>\n\n<p>This doesn't work (I have MySQL Connector Net 6.5.4 installed &amp; MySql.Data referenced). I've tried deriving from IDbConnection factory as shown in this class here:\n<a href=\"http://www.vworker.com/RentACoder/misc/BidRequests/ShowBidRequest.asp?lngBidRequestId=1563829\" rel=\"nofollow\">http://www.vworker.com/RentACoder/misc/BidRequests/ShowBidRequest.asp?lngBidRequestId=1563829</a></p>\n\n<p>and then using:</p>\n\n<pre><code>      &lt;entityFramework&gt;\n&lt;defaultConnectionFactory type=\"SchoolModel.MySqlConnectionFactory, SchoolModel\" /&gt;\n</code></pre>\n\n<p></p>\n\n<p>but that doesn't work either. Can anybody please give me some pointers as to how to get this to work?</p>\n\n<p>Many thanks.</p>\n"},{"tags":["entity-framework","ef-code-first","wcf-ria-services","code-first","domain-service-class"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":12843467,"title":"WCF Ria Services Wizard not working with CodeFirst","body":"<p>When using EF Code First, It appears WCF RIA Services Wizard (that runs when adding a new DomainService) in VS 2012 does not recognize the DbContexts defined in the project (it only recognizes the ObjectContext).    </p>\n\n<p>This means that when Adding a New Item in VS2012 and choosing Add DomainServiceClass, the wizard is not able to detect available context classes * combo list is empty *</p>\n\n<p>Please see the attached image</p>\n\n<p>Any idea what could be happening here?\nThanks,\n-Sumit<img src=\"http://i.stack.imgur.com/9b0HD.jpg\" alt=\"Please see the attached image\"></p>\n"},{"tags":["c#","asp.net","sql","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":110,"score":1,"question_id":13007056,"title":"LINQ Query to retrieve items","body":"<p>So I am using EF, I have the following entities:</p>\n\n<ul>\n<li><code>Website</code></li>\n<li><code>Sector</code></li>\n<li><code>Product</code></li>\n<li><code>Attribute</code></li>\n<li><code>AttributeTag</code></li>\n</ul>\n\n<p>The relationships are as follow:</p>\n\n<p><img src=\"http://i.stack.imgur.com/wvyAs.png\" alt=\"enter image description here\"></p>\n\n<p>I need to retrieve something that is not directly linked to the table. Such as products which needs a <code>Sector</code> object in order to retrieve only the specific <code>Products</code> using something such as <code>sector.Products</code>.</p>\n\n<p>But what if I need to retrieve all <code>Products</code> under a given <code>Website</code> instead of it's parent <code>Sector</code> ?</p>\n\n<p>In my specific situation, my questions are:\n1) How can I retrieve all the products given a specific <code>website_id</code> - (Disregarding the sector)\n2) How can I retrieve all the products that have a specific <code>tag_id</code> + <code>website_id</code>. (Also retrieve it's corresponding <code>Attribute</code>)</p>\n\n<p>Help is appreciated. Thanks!</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13003514,"title":"Entity Framework and Changing Views?","body":"<p>We have a client who had given us some code written in VB6 and is to be converted to .Net 4.0. Theirt database is, what can only be called, a catastrophy. But, we're not allowed to change it. So we're building an application on top of this shakey database.</p>\n\n<p>One thing they did was (Wait for it), create views based on a users selection of which columns should be displayed in a grid.</p>\n\n<p>Example, the Contacts screen lists all the contacts. They have a screen which reads the database, gets the fields from a View, and then presents the user with a list of possible columns. The user then selects a few (Surname, Firstname, DOB).</p>\n\n<p>The code then goes and creates a NEW view (or overwrites an existing one) with</p>\n\n<blockquote>\n  <p>'SELECT Surname, Firstname, DOB' from AnotherView WHERE ID=:ID'</p>\n</blockquote>\n\n<p>(AnotherView is a large view containing joins etc...)</p>\n\n<p>It then uses that view everytime the screen is viewed.</p>\n\n<p>So, the view changes.</p>\n\n<p>We're using Entity Framework. Is it possible to handle dynamic views? We use Linq in the presentation (I know, I know....) to mine the data. So can we somehow use Linq to select * from the view, and then present the grid? If the view is changing, though, we need to regenerate the EF model, no?</p>\n"},{"tags":["c#","asp.net","sql","linq","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":66,"score":-4,"question_id":13006952,"title":"LINQ Query to retrieve items","body":"<p>So I am using EF, I have the following entities:</p>\n\n<ul>\n<li><code>Website</code></li>\n<li><code>Sector</code></li>\n<li><code>Product</code></li>\n<li><code>Attribute</code></li>\n<li><code>AttributeTag</code></li>\n</ul>\n\n<p>The relationships are as follow:</p>\n\n<p><img src=\"http://i.stack.imgur.com/wvyAs.png\" alt=\"enter image description here\"></p>\n\n<p>The questions are:</p>\n\n<ol>\n<li>How can I retrieve all the products given a specific <code>website_id</code> - (Disregarding the sector)</li>\n<li>How can I retrieve all the products that have a specific <code>tag_id</code> + <code>website_id</code>. (Also retrieve it's corresponding <code>Attribute</code>)</li>\n</ol>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13005284,"title":"Using entity framework, how to map a function?","body":"<p>I'm using entity framework, and imagine that I have a function where returns a table with the following columns:</p>\n\n<ul>\n<li>StudentId : smallint</li>\n<li>TestTemplateId : smallint</li>\n<li>Date : date</li>\n</ul>\n\n<p>As you can see, I'm returning a table with only ids. In the application I have a classes like <code>Student</code> and <code>TestTemplate</code>, I don't know if it will be possible that the function can map to complex objects.</p>\n"},{"tags":["asp.net-mvc","entity-framework","azure","ef-code-first","unit-of-work"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13003241,"title":"Data tables not being created when deploying MVC4 to Azurewebsites","body":"<p>So after many many hours of figuring out why my database tables weren't being created when deploying to azure(using mvc4 code first entity framework), I finally came figured out that its the way I have my backend set up. I have my generic repository, unit of work, datacontext, etc..(which is not causing the problem). Whats causing my data tables(500 server error) not to create is my UnitOfWorkFilter. When I apply this it doesn't work, when I take away it works. So my question is does anybody know why this is causing the problem and what I can do to fix this problem because I would like to continue to use my filter. </p>\n\n<p>Here is my unit of work filter:</p>\n\n<pre><code>    public class UnitOfWorkFilter : System.Web.Mvc.ActionFilterAttribute\n    {\n\n    public override void OnActionExecuting(ActionExecutingContext filterContext)\n    {\n\n        var unitOfWork = DependencyResolver.Current.GetService&lt;IUnitOfWork&gt;();\n\n        unitOfWork.Begin();\n    }\n\n    public override void OnActionExecuted(ActionExecutedContext filterContext)\n    {\n        var unitOfWork = DependencyResolver.Current.GetService&lt;IUnitOfWork&gt;();\n        if (filterContext.Exception != null)\n        {\n            unitOfWork.Rollback();\n            return;\n        }\n        try\n        {\n            unitOfWork.Commit();\n        }\n        catch\n        {\n            unitOfWork.Rollback();\n            throw;\n        }\n        finally\n        {\n            unitOfWork.Dispose();\n        }\n    }\n}\n}\n</code></pre>\n"},{"tags":["mvc","entity-framework","sdf"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":210,"score":1,"question_id":10084312,"title":"sdf file not showing in App_Data (using MVC application)","body":"<p>I followed the \"Creating an Entity Framework Data Model for an ASP.NET MVC Application\" in ASP.net and changed it to meet my needs.\nI built the project and run it - everything works fine (I can view details, edit and save).\nI press \"Show all files\" and there is nothing under App_Data.\nI tried to read the related threads here but i couldn't fix it.\nI will appriciate any Idea!</p>\n\n<p>this is my connection string:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n&lt;add name=\"ApplicationServices\"\n     connectionString=\"data source=.\\SQLEXPRESS;Integrated Security=SSPI;AttachDBFilename=|DataDirectory|aspnetdb.mdf;User Instance=true\"\n     providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p></p>\n\n<p>Thank you!</p>\n"},{"tags":["entity-framework","insert","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13003345,"title":"How can I prevent EF from inserting an object that already exists in the db when adding one that contains this first one?","body":"<p>It's quite self-explainatory.\nI have a class that contains another\nLet's call them Subject and Classroom\n<code>public class Subject\n{\n   public Classroom Class {get; set;}\n}</code></p>\n\n<p>I'm using stateless facades, wich means my DbContext is disposed right after recovering the objects and is created to store the new ones.\nShouldn't it know that Classroom isn't a new object since it's ID is already in the DB?\nUsing the debugger I can track to the point right before I call the SaveChanges method and Classroom.id is the one I have on the database.\nWhat's the problem? EF adds a new Classroom with the exact properties as the previous one, but with a new PK.\nWhat am I doing wrong here?</p>\n\n<p>This is the code used for the general CRUD operations (They are in my DbContext) Both update and delete work just fine:</p>\n\n<p>`       public void Update(DbSet MySet, object Obj)\n        {\n            MySet.Attach(Obj);\n            var Entry = this.Entry(Obj);\n            Entry.State = EntityState.Modified;\n            this.SaveChanges();\n        }</p>\n\n<pre><code>    public void Insert(DbSet MySet, object Obj)\n    {\n        MySet.Add(Obj);\n        this.SaveChanges();\n    }\n\n\n    public void Delete(DbSet MySet, object Obj)\n    {\n        MySet.Attach(Obj);\n        var Entry = this.Entry(Obj);\n        Entry.State = EntityState.Deleted;\n        this.SaveChanges();\n    }\n</code></pre>\n\n<p>`</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":13003797,"title":"Get the Entity Framework Connection String","body":"<p>We use Entity Framework 5, but have a requirement to ALSO use a normal database connection from the application for some custom SQL we need to perform.</p>\n\n<p>So, I am creating a DatabaseAccess class which handles this connection. Is there a way that I can populate the connection string, by checking the Entity Framework connection string?</p>\n\n<p>So:</p>\n\n<pre><code>SqlConnection cnn;\nconnetionString = \"Data Source=ServerName;Initial Catalog=DatabaseName;User ID=UserName;Password=Password\"\n</code></pre>\n\n<p>Can I build that from checking Entity Framework?</p>\n"},{"tags":["c#","wcf","entity-framework","list"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12996366,"title":"Pass list to client in WCF","body":"<p>My function in service look like this:</p>\n\n<pre><code>    public List&lt;X&gt; GetAll(string num)\n    {\n       TheContext  Mycontext = new TheContext();\n        IEnumerable&lt;X&gt; MyIEnumerable =\n     ((IObjectContextAdapter)Mycontext)\n     .ObjectContext.ExecuteStoreQuery&lt;X&gt;(\"select * from dbo.XXX where y='\"+num+\"'\");\n\n        List&lt;X&gt; MyList = MyIEnumerable.ToList();\n        return MyList;\n    }\n</code></pre>\n\n<p>Here the list OK.</p>\n\n<p>My client look like this:</p>\n\n<pre><code>static void Main(string[] args)\n    {\n        MyClient proxy = new MyClient ();\n        List&lt;X&gt; MyClientList = proxy.GetAll(\"980\").ToList();\n        proxy.Close();\n        Console.ReadLine();\n    }\n</code></pre>\n\n<p>Here have error:</p>\n\n<p>An error occurred while receiving the HTTP response. This could be due to the service endpoint binding not using the HTTP protocol. This could also be due to an HTTP request context being aborted by the server (possibly due to the service shutting down). See server logs for more details.</p>\n\n<p>If i return from the function like this this work:</p>\n\n<pre><code>public List&lt;X&gt; GetAll(string num)\n {\n   List&lt;x&gt; MyList= new List&lt;x&gt;();\n   MyList.Add(new X(){...});\n   MyList.Add(new X(){...});\n   MyList.Add(new X(){...});   \n    return MyList;\n }\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":1,"view_count":3915,"score":3,"question_id":5517182,"title":"EF 4.1 SaveChanges not updating navigation or reference properties","body":"<p>I'm using code first and can add records without a problem. The database is created properly and is seeded without any problems. But calling SaveChanges() in my Edit action only updates the entity, not any of the navigation or reference properties.</p>\n\n<p>A simplified version of my model:</p>\n\n<pre><code>public class Contact : IMyBaseObject\n{\n    public Contact()\n    {\n       this.Delete = false;\n       this.ContactTypes = new HashSet&lt;ContactType&gt;();\n    }\n\n    public int Id {get; set;}\n\n    public string Name {get;set;}\n\n    public bool Delete {get;set;}\n\n    public virtual ICollection&lt;ContactType&gt; ContactTypes { get; set; }\n\n    public virtual USState USState { get; set; }\n\n}\n\npublic class ContactType : MyBaseObject\n{\n    public ContactType()\n    {\n    }\n\n    public int Id {get; set;}\n\n    public string Name {get;set;}\n\n    public virtual ICollection&lt;Contact&gt; Contacts {get;set;}\n}\n\npublic abstract class Territory : MyBaseObject\n{\n    public int Id {get; set;}\n\n    public string Name {get;set;}\n\n    public string Code {get;set;}\n}\n\npublic class USState : Territory\n{\n    public USState()\n    {\n    }\n\n    // Navigation properties\n    public virtual ICollection&lt;Contact&gt; Contacts { get; set; }\n}\n</code></pre>\n\n<p>I won't include the code, but I do have some custom model binding going on. My Edit action (using MVC 3) was not being populated with the ContactType or USState properties. The binding is properly returning a fully populated Contact object with the correct values from the form.</p>\n\n<p>If I understand EF 4.1 properly, I should only have to do the following to persist changes to the database when saving my Contact object:</p>\n\n<pre><code>if(ModelState.IsValid)\n{\n    context.Entry(contact).State = EntryState.Modified;\n    context.SaveChanges();\n}\n</code></pre>\n\n<p>However, only primitive properties are being updated when I do that. I have left out a few things in the above example: I'm using a transaction, a try catch block, and checking if it's a new record.</p>\n\n<p>I have used SQL Profiler and can confirm that the update queries for the ContactType and Territory tables are <strong>not</strong> being sent to the database server.</p>\n\n<p>The State properties of my navigation and reference properties are Modified, but I have also tried manually setting that:</p>\n\n<pre><code>    context.Entry(contact).Collections(\"ContactTypes\").EntityEntry.State = EntityState.Modified;\n    context.Entry(contact).Reference(\"USState\").EntityEntry.State = EntityState.Modified;\n</code></pre>\n\n<p>I could be mistaken, but I'm pretty sure my code was working under CTP5.</p>\n\n<p>Any ideas? At this point, I'm not sure how I should approach debugging this.</p>\n\n<p>Thanks, Steve</p>\n"},{"tags":["sql-server","performance","entity-framework","multi-tenant","parameter-sniffing"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12979493,"title":"Multi-tenant SQL Server databases and parameter sniffing","body":"<p>I have a multi-tenant database in SQL Server 2012 where each tenant's rows are identified by a <code>tenant_id</code> column (aka the <a href=\"http://msdn.microsoft.com/en-us/library/aa479086.aspx\" rel=\"nofollow\">Shared Database, Shared Schema</a> approach). Some tenants, particularly the newer ones, have very few rows, while others have many.</p>\n\n<p>SQL Server's query optimizer normally builds a query plan based on the parameters provided during its first execution, then re-uses this plan for all future queries even if different parameters are provided. This is known as <a href=\"http://www.sommarskog.se/query-plan-mysteries.html\" rel=\"nofollow\">parameter sniffing</a>.</p>\n\n<p>The problem we have with our database is that SQL Server sometimes builds these plans based on parameters that point to a smaller tenant, which works fine for that tenant, but then when it reapplies the cached plan to a larger tenant it fails catastrophically (usually timing out, in fact). Typically we find out about this situation only when one of our larger tenants contacts us about experiencing time-out errors, then we have to get into the system and manually flush all the query plans to correct it.</p>\n\n<p>There is a query hint you can use to prevent SQL Server from caching query plans (<a href=\"http://www.benjaminnevarez.com/2010/06/how-optimize-for-unknown-works/\" rel=\"nofollow\"><code>OPTIMIZE FOR UNKNOWN</code></a>) but this results in some extra overhead since the query plan is being regenerated every time the query is called. An additional problem is that we're using Entity Framework which offers no ability to specify the <code>OPTIMIZE FOR UNKNOWN</code> hint on queries.</p>\n\n<p>So the question is -- what is the best practice for multi-tenant databases with regard to parameter sniffing? Is there a way to disable parameter sniffing database-wide without having to specify it on every query? If so, is that even the best approach? Should I be partitioning the data in some other way? Is there some other approach I'm not thinking of?</p>\n"},{"tags":["c#","entity-framework","ado.net","ado.net-entity-data-model","savechanges"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13002616,"title":"How to add new object to database?","body":"<p>I want to add a new book to my database, but it doesn't work.</p>\n\n<pre><code>class Program\n    {\n        static void Main(string[] args)\n        {\n            Knigi_DataEntities entities = new Knigi_DataEntities();\n                Books newBook = new Books();\n                newBook.Name = \"C# 4 How-to\";\n                newBook.Published = 2010;\n                newBook.Book_ID = 4;\n                entities.AddToBooks(newBook);\n                entities.SaveChanges();\n\n            Knigi_DataEntities ent = new Knigi_DataEntities(); \n                  foreach (var book in ent.Books)\n                {\n                    Console.WriteLine(\"{0}, {1} {2}  \",\n                    book.Book_ID, book.Name, book.Published);\n                }\n              }\n            }\n</code></pre>\n\n<p>but when I close <code>//entities.SaveChanges();</code>, the console displays objects that are already in my database. Therefore problems are caused by <code>entities.SaveChanges();</code>\n<br>Please tell me, how to add new objects?</p>\n"},{"tags":["entity-framework","asp.net-mvc-4"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":13002166,"title":"Asp.net MVC 4 Code First Return Specific Fields from Navigation Property","body":"<p>Been stuck on this for a while so i thought i would ask.  I am sure there is something simple i am missing here.  Trying to learn Asp.net mvc 4 on my own by building a simple app.  </p>\n\n<p>Here is the model:</p>\n\n<pre><code>public class Category\n{\n    public int Id { get; set; }\n    [Required]\n    [StringLength(32)]\n    public string Name { get; set; }\n    //public virtual ICollection&lt;Note&gt; Notes { get; set; }\n    private ICollection&lt;Note&gt; notes;\n    public ICollection&lt;Note&gt; Notes\n    {\n        get\n        {\n            return this.notes ?? (this.notes = new List&lt;Note&gt;());\n        }\n    }\n}\n\npublic class Note\n{\n    public int Id { get; set; }\n    [Required]\n    public string Content { get; set; }\n    [Required]\n    [StringLength(128)]\n    public string Topic { get; set; }\n    public int CategoryId { get; set; }\n    public virtual Category Category { get; set; }\n    public virtual IEnumerable&lt;Comment&gt; Comments { get; set; }\n    public virtual ICollection&lt;Tag&gt; Tags {get; set;}\n\n    public Note()\n    {\n        Tags = new HashSet&lt;Tag&gt;();\n    }\n}\npublic class Tag\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public virtual ICollection&lt;Note&gt; Notes { get; set; }\n\n    public Tag()\n    {\n        Notes = new HashSet&lt;Note&gt;();\n    }\n}\n</code></pre>\n\n<p>I call this method in a repository from the controller:</p>\n\n<pre><code> public IQueryable&lt;Note&gt; GetAll()\n    {\n        var query = _db.Notes.Include(x =&gt; x.Category).Include(y =&gt; y.Tags);\n        return query;\n    }\n</code></pre>\n\n<p>On the home controller i am trying to return a list of all the notes and wanted to include the category name that it belongs to as well as the tags that go with the note.  At first the did not show up so i read some tutorials about eager loading and figured out how to get them to show. </p>\n\n<p>However, my method is not that efficient.  The mini-profiler is barking at me for duplicate queries because the navigation properties for category and tags are sending queries for the notes again.  IS there any way to just return the properties i need for the category and tag objects?  </p>\n\n<p>I have tried several methods with no luck.  I was hoping i could do something like this:</p>\n\n<pre><code>var query = _db.Notes.Include(x =&gt; x.Category.Name).Include(y =&gt; y.Tags.Name);\n</code></pre>\n\n<p>But i get an error:  Cannot convert lambda expression to type 'string' because it is not a delegate type</p>\n\n<p>I have seen that error before that was caused by some missing using statements so i already double checked that.  </p>\n\n<p>Any suggestions?  Thanks for the help</p>\n"},{"tags":["c#","mysql","entity-framework","isolation-level"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12990743,"title":"Verify that I use ReadUncommitted Entity Framework and MySQL","body":"<p>I'm trying to implement a test project with a different <code>IsolationLevel</code>. I have this code</p>\n\n<pre><code>        var transactionOptions = new TransactionOptions();\n        transactionOptions.IsolationLevel = IsolationLevel.ReadUncommitted;\n\n        using (TransactionScope scope = new TransactionScope( TransactionScopeOption.RequiresNew, transactionOptions))\n        {\n\n            using (var uncommittedDb = new Context())\n            {\n                var query = uncommittedDb.TestTable;\n                var objects = query.ToTable(); // I have a breakpoint here\n            }\n        }\n</code></pre>\n\n<p>But I don't know if I'm doing right or how I can verify it? I can't see that my query has change if I break the application where the breakpoint is and hover the <code>query</code>. How can I verify that I'm doing right (or wrong ;-))? </p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13001613,"title":"Changed the Edmx and got errors","body":"<p>I tried to change the Entities Table Name and encountered an error.\nI just renamed <strong>TblRecord</strong> as the name was from the Table Name </p>\n\n<p>What is the mistake here and how to resolve it ?</p>\n\n<hr>\n\n<p><strong>Error :</strong></p>\n\n<pre><code>+       _innerException {\"The specified table does not exist. [ Records ]\"} System.Exception {System.Data.SqlServerCe.SqlCeException}\n</code></pre>\n\n<hr>\n\n<p><strong>The Edmx File</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;edmx:Edmx Version=\"3.0\" xmlns:edmx=\"http://schemas.microsoft.com/ado/2009/11/edmx\"&gt;\n  &lt;!-- EF Runtime content --&gt;\n  &lt;edmx:Runtime&gt;\n    &lt;!-- SSDL content --&gt;\n    &lt;edmx:StorageModels&gt;\n      &lt;Schema Namespace=\"Xz.Business.Matches.Store\" Alias=\"Self\" Provider=\"System.Data.SqlServerCe.4.0\" ProviderManifestToken=\"4.0\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/edm/ssdl\"&gt;\n        &lt;EntityContainer Name=\"XzBusinessMatchesStoreContainer\"&gt;\n          &lt;EntitySet Name=\"Records\" EntityType=\"Xz.Business.Matches.Store.Records\" store:Type=\"Tables\" /&gt;\n        &lt;/EntityContainer&gt;\n        &lt;EntityType Name=\"Records\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"Record\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Name=\"Record\" Type=\"nvarchar\" Nullable=\"false\" MaxLength=\"100\" /&gt;\n          &lt;Property Name=\"Relations\" Type=\"nvarchar\" MaxLength=\"450\" /&gt;\n        &lt;/EntityType&gt;\n      &lt;/Schema&gt;\n    &lt;/edmx:StorageModels&gt;\n    &lt;!-- CSDL content --&gt;\n    &lt;edmx:ConceptualModels&gt;\n      &lt;Schema Namespace=\"Xz.Business.Matches\" Alias=\"Self\" p1:UseStrongSpatialTypes=\"false\" xmlns:annotation=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\" xmlns:p1=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/edm\"&gt;\n        &lt;EntityContainer Name=\"RecordzEntities\" p1:LazyLoadingEnabled=\"true\"&gt;\n          &lt;EntitySet Name=\"Records\" EntityType=\"Xz.Business.Matches.TblRecord\" /&gt;\n        &lt;/EntityContainer&gt;\n        &lt;EntityType Name=\"TblRecord\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"Record\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Name=\"Record\" Type=\"String\" Nullable=\"false\" MaxLength=\"100\" Unicode=\"true\" FixedLength=\"false\" /&gt;\n          &lt;Property Name=\"Relations\" Type=\"String\" MaxLength=\"450\" Unicode=\"true\" FixedLength=\"false\" /&gt;\n        &lt;/EntityType&gt;\n      &lt;/Schema&gt;\n    &lt;/edmx:ConceptualModels&gt;\n    &lt;!-- C-S mapping content --&gt;\n    &lt;edmx:Mappings&gt;\n      &lt;Mapping Space=\"C-S\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/mapping/cs\"&gt;\n        &lt;EntityContainerMapping StorageEntityContainer=\"XzBusinessMatchesStoreContainer\" CdmEntityContainer=\"RecordzEntities\"&gt;\n          &lt;EntitySetMapping Name=\"Records\"&gt;\n            &lt;EntityTypeMapping TypeName=\"Xz.Business.Matches.TblRecord\"&gt;\n              &lt;MappingFragment StoreEntitySet=\"Records\"&gt;\n                &lt;ScalarProperty Name=\"Record\" ColumnName=\"Record\" /&gt;\n                &lt;ScalarProperty Name=\"Relations\" ColumnName=\"Relations\" /&gt;\n              &lt;/MappingFragment&gt;\n            &lt;/EntityTypeMapping&gt;\n          &lt;/EntitySetMapping&gt;\n        &lt;/EntityContainerMapping&gt;\n      &lt;/Mapping&gt;\n    &lt;/edmx:Mappings&gt;\n  &lt;/edmx:Runtime&gt;\n  &lt;!-- EF Designer content (DO NOT EDIT MANUALLY BELOW HERE) --&gt;\n  &lt;Designer xmlns=\"http://schemas.microsoft.com/ado/2009/11/edmx\"&gt;\n    &lt;Connection&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"MetadataArtifactProcessing\" Value=\"EmbedInOutputAssembly\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/Connection&gt;\n    &lt;Options&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"ValidateOnBuild\" Value=\"true\" /&gt;\n        &lt;DesignerProperty Name=\"EnablePluralization\" Value=\"True\" /&gt;\n        &lt;DesignerProperty Name=\"IncludeForeignKeysInModel\" Value=\"True\" /&gt;\n        &lt;DesignerProperty Name=\"CodeGenerationStrategy\" Value=\"None\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/Options&gt;\n    &lt;!-- Diagram content (shape and connector positions) --&gt;\n    &lt;Diagrams&gt;&lt;/Diagrams&gt;\n  &lt;/Designer&gt;\n&lt;/edmx:Edmx&gt;\n</code></pre>\n\n<p><em>This is EF5 &amp; VS12</em></p>\n"},{"tags":["c#","wpf","entity-framework","mvvm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":370,"score":0,"question_id":5461964,"title":"EF object property changing - MVVM","body":"<p>I have a viewmodel that has an EF object as one of its properties. The view has several text boxes wired up to that property via <code>Text=\"{Binding Path=MyEFTable.Column1}\"</code>.  I'm using the MVVM Light toolkit so my viewmodels inherit ViewModelBase and subsequently each property calls <code>RaisePropertyChanged()</code> when changed.</p>\n\n<p>I have noticed, however that changing <code>MyEFTable.Column1</code> does not set off any changes in the viewmodel.  I thought that EF objects tracked any changes, so I assumed that changing a column value in an EF object would cause the EF object itself to be changed. Is it no longer tracking changes since I am essentially copying the query result into a new <code>MyEFTable</code> object?</p>\n"},{"tags":["c#","entity-framework","c#-4.0","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13000748,"title":"Use string as type of DbSet like DbSet<string> in EF-CodeFirst","body":"<p>I want to have a list of string and save and load them to/from database using EF-CodeFirst. this is my DbContext class:</p>\n\n<pre><code>public class KeysDbContext : DbContext\n{\n    public DbSet&lt;string&gt; Keys { get; set; }\n}\n</code></pre>\n\n<p>but when I try to run the code I get this exception:<code>System.InvalidOperationException</code> : <code>The type 'System.String' was not mapped. Check that the type has not been explicitly excluded by using the Ignore method or NotMappedAttribute data annotation. Verify that the type was defined as a class, is not primitive, nested or generic, and does not inherit from EntityObject.</code></p>\n\n<p>How can I resolve the problem?</p>\n"},{"tags":["entity-framework","fluent"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13000887,"title":"Model class and Mapping","body":"<p>I have the Client class defined. I also have Mapping\\ClientMap.cs file that defines column names using Fluent API. However, I am not sure how to \"invoke\" it as I don't see the ClientMap.cs code being executed.</p>\n\n<p>I also have this:</p>\n\n<pre><code>namespace CardNumbers.Data\n{\n    public class Repository : DbContext, IRepository\n    {\n        public DbSet&lt;Client&gt; Clients { get; set; }\n        public DbSet&lt;ClientOrder&gt; ClientOrders { get; set; }\n        public DbSet&lt;Reorder&gt; Reorders { get; set; }\n        public DbSet&lt;Operator&gt; Operators { get; set; }\n</code></pre>\n\n<p>which I know is not a very good practice, but that's how we were building the application with the instructor.</p>\n\n<p>So, my question is - what do I need to add to make sure the Fluent API code is invoked in run-time?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":12978163,"title":"Entity - Schema Mapping and Namespaces","body":"<p>Added a Database and an Entity Model to my DAL Project.</p>\n\n<h2>got an error :</h2>\n\n<p><strong>Error :</strong></p>\n\n<pre><code> +      base    {\"Schema specified is not valid. Errors: \\r\\nMultiple types with the name 'TblRecord' exist in the EdmItemCollection in different namespaces.  Convention based mapping requires unique names without regard to namespace in the EdmItemCollection.\"}   System.Data.EntityException {System.Data.MetadataException}\n</code></pre>\n\n<hr>\n\n<p><strong>The Edmx File</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;edmx:Edmx Version=\"3.0\" xmlns:edmx=\"http://schemas.microsoft.com/ado/2009/11/edmx\"&gt;\n  &lt;!-- EF Runtime content --&gt;\n  &lt;edmx:Runtime&gt;\n    &lt;!-- SSDL content --&gt;\n    &lt;edmx:StorageModels&gt;\n      &lt;Schema Namespace=\"Xz.Business.Matches.Store\" Alias=\"Self\" Provider=\"System.Data.SqlServerCe.4.0\" ProviderManifestToken=\"4.0\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/edm/ssdl\"&gt;\n        &lt;EntityContainer Name=\"XzBusinessMatchesStoreContainer\"&gt;\n          &lt;EntitySet Name=\"Records\" EntityType=\"Xz.Business.Matches.Store.Records\" store:Type=\"Tables\" /&gt;\n        &lt;/EntityContainer&gt;\n        &lt;EntityType Name=\"Records\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"Record\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Name=\"Record\" Type=\"nvarchar\" Nullable=\"false\" MaxLength=\"100\" /&gt;\n          &lt;Property Name=\"Relations\" Type=\"nvarchar\" MaxLength=\"450\" /&gt;\n        &lt;/EntityType&gt;\n      &lt;/Schema&gt;\n    &lt;/edmx:StorageModels&gt;\n    &lt;!-- CSDL content --&gt;\n    &lt;edmx:ConceptualModels&gt;\n      &lt;Schema Namespace=\"Xz.Business.Matches\" Alias=\"Self\" p1:UseStrongSpatialTypes=\"false\" xmlns:annotation=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\" xmlns:p1=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/edm\"&gt;\n        &lt;EntityContainer Name=\"RecordzEntities\" p1:LazyLoadingEnabled=\"true\"&gt;\n          &lt;EntitySet Name=\"Records\" EntityType=\"Xz.Business.Matches.TblRecord\" /&gt;\n        &lt;/EntityContainer&gt;\n        &lt;EntityType Name=\"TblRecord\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"Record\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Name=\"Record\" Type=\"String\" Nullable=\"false\" MaxLength=\"100\" Unicode=\"true\" FixedLength=\"false\" /&gt;\n          &lt;Property Name=\"Relations\" Type=\"String\" MaxLength=\"450\" Unicode=\"true\" FixedLength=\"false\" /&gt;\n        &lt;/EntityType&gt;\n      &lt;/Schema&gt;\n    &lt;/edmx:ConceptualModels&gt;\n    &lt;!-- C-S mapping content --&gt;\n    &lt;edmx:Mappings&gt;\n      &lt;Mapping Space=\"C-S\" xmlns=\"http://schemas.microsoft.com/ado/2009/11/mapping/cs\"&gt;\n        &lt;EntityContainerMapping StorageEntityContainer=\"XzBusinessMatchesStoreContainer\" CdmEntityContainer=\"RecordzEntities\"&gt;\n          &lt;EntitySetMapping Name=\"Records\"&gt;\n            &lt;EntityTypeMapping TypeName=\"Xz.Business.Matches.TblRecord\"&gt;\n              &lt;MappingFragment StoreEntitySet=\"Records\"&gt;\n                &lt;ScalarProperty Name=\"Record\" ColumnName=\"Record\" /&gt;\n                &lt;ScalarProperty Name=\"Relations\" ColumnName=\"Relations\" /&gt;\n              &lt;/MappingFragment&gt;\n            &lt;/EntityTypeMapping&gt;\n          &lt;/EntitySetMapping&gt;\n        &lt;/EntityContainerMapping&gt;\n      &lt;/Mapping&gt;\n    &lt;/edmx:Mappings&gt;\n  &lt;/edmx:Runtime&gt;\n  &lt;!-- EF Designer content (DO NOT EDIT MANUALLY BELOW HERE) --&gt;\n  &lt;Designer xmlns=\"http://schemas.microsoft.com/ado/2009/11/edmx\"&gt;\n    &lt;Connection&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"MetadataArtifactProcessing\" Value=\"EmbedInOutputAssembly\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/Connection&gt;\n    &lt;Options&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"ValidateOnBuild\" Value=\"true\" /&gt;\n        &lt;DesignerProperty Name=\"EnablePluralization\" Value=\"True\" /&gt;\n        &lt;DesignerProperty Name=\"IncludeForeignKeysInModel\" Value=\"True\" /&gt;\n        &lt;DesignerProperty Name=\"CodeGenerationStrategy\" Value=\"None\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/Options&gt;\n    &lt;!-- Diagram content (shape and connector positions) --&gt;\n    &lt;Diagrams&gt;&lt;/Diagrams&gt;\n  &lt;/Designer&gt;\n&lt;/edmx:Edmx&gt;\n</code></pre>\n\n<hr>\n\n<p><strong>Names &amp; Namespaces :</strong></p>\n\n<p>Project Name : Business.Matches\nDefault Namespace : Xz.Business.Matches</p>\n\n<p>I added an Entity Model with this definitions :</p>\n\n<p>Model : RecordzModel</p>\n\n<p>Context : RecordzContext</p>\n\n<p>Model Namespace : Xz.Business.Matches</p>\n"},{"tags":["oracle","entity-framework","blob","odata","dbcontext"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13000909,"title":"Inserting BLOB using OData and Oracle","body":"<p>When working with OData and Oracle i need to insert blob records in some table.\nI tried to follow example here : <a href=\"http://blogs.msdn.com/b/astoriateam/archive/2010/08/04/data-services-streaming-provider-series-implementing-a-streaming-provider-part-1.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/astoriateam/archive/2010/08/04/data-services-streaming-provider-series-implementing-a-streaming-provider-part-1.aspx</a>\nAs microsoft recomend i exclude my BLOB from data model.\nAt the end, data is sent to my service, in GetWriteStream() i write binary data to temporary file. Then in Dispose() i should insert it in database.\nBut...\nUsing DbContext, i cant do this :\nObjectStateEntry entry = \n            this.context.ObjectStateManager.GetObjectStateEntry(cachedEntity);</p>\n\n<p>converting this.context to dbcontext throw exception - DbContext cant be used because its disposed. \nI still cant understand how to do this?\nI didnt find any example in the internet where is described how to use OData with blobs and dbcontext to work with database directly.</p>\n\n<p>Using : WCF Data Services 5.1.0-rc2, Visual Studio 2012, Oracle 11.x with ODP</p>\n"},{"tags":["linq","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12999457,"title":"How can I retrieve a composite class in EF Code First, having specified a relation on multi tier app?","body":"<p>I have an interesting problem :\nI created a class called, let's say, \"Container\" wich has a member of type \"Contained\"\nIt would look like:</p>\n\n<p><code>public class Container\n    {\n       public Contained cnt{ get; set; }\n    }\n</code></p>\n\n<p>The model contains both tables, and my DB looks like:\nContainers(PK:id FK:Contained_ContainedId)\nContained(PK:ContainedId)</p>\n\n<p>EF Code first correcty maps this atribute as a foreign key in the Contined table.\nThe problem comes when I want to retrieve these objects using LINQ:</p>\n\n<p><code>Container Con=(from Object in PersistentManager.Containers.OfType&lt;Container&gt; select Object).SingleOrDefault();</code></p>\n\n<p>This way (or either casting an anonymous type), I get a Container. The problem is, the reference to the Contained object is allways null. I think this is made on purpose for the sake of performance, but, this time, I need it to recover the full object.\nIntellitrace shows it's not even joining tables, so i guess something else should be specified\nAny ideas?</p>\n\n<p>Allrigth, thanks to Basic, I have solved the issue using the include clause.\nI think there SHOULD be a way to use lazy loading on context closed environment (multi tier patterns allways recomend disposing these objects)</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12962212,"title":"InvalidCastException from Entity.DynamicProxies.MyEntityClass to Entity.DbSet`1[MyEntityClass]","body":"<p>I am having difficulty understanding why I am getting an InvalidCastException\nHere is the error message that I'm getting:</p>\n\n<blockquote>\n  <p>Unable to cast object of type 'System.Data.Entity.DynamicProxies.Man_58184D79075BC811252680D7866D3D69D0C46FD038D3B123A5E3B102E1FC77A2' to type 'System.Data.Entity.DbSet`1[ConsoleApplication1.Man]'.</p>\n</blockquote>\n\n<ul>\n<li><strong>Man</strong> is the name of the entity class being passed to TEntity</li>\n<li>I've marked the location of the error with a comment in the code.</li>\n</ul>\n\n<p>The purpose of this repository class is to hold a given DbContext and DbSet, and call its methods to delete records and/or display all records of the given DbSet.  </p>\n\n<pre><code>public class Repository&lt;TEntity&gt; where TEntity : class\n{\n    private DbContext dbContext;\n    private DbSet&lt;TEntity&gt; dbSet { get; set; }\n    public Repository(DbContext dbContext)\n    {\n       this.dbContext = dbContext;\n       this.dbSet = this.dbContext.Set&lt;TEntity&gt;();\n    }\n\n    public void Delete(int id)\n    {\n         TEntity entity = dbSet.Find(id);\n         dbSet.Remove(entity);\n         dbContext.SaveChanges();\n    }\n\n    public void DisplayAll()\n    {\n        IQueryable Query = from item in dbContext.Set&lt;TEntity&gt;()  \n                           where true\n                           select item;\n\n        foreach (DbSet&lt;TEntity&gt; x in Query) //InvalidCastException\n        {\n            // print entity fields to console here.\n        }\n\n    }\n}\n</code></pre>\n\n<p>These are the lines in my main program that I use to create a Repository Object:</p>\n\n<p><strong>TestDataBaseEntities</strong> is the type of DbContext object I use to refer to my entity model.</p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        int myID;\n        var dbEntities = new TestDatabaseEntities();\n        Repository&lt;Man&gt; ManTracker = new Repository&lt;Man&gt;(dbEntities);\n\n        ManTracker.Display();  // exception thown in this method.\n        Console.WriteLine(\"Choose ID to delete from Men list\");\n        myID = int.Parse(Console.ReadLine());\n        ManTracker.Delete(myID);\n        ManTracker.Display();\n\n        Console.ReadLine();\n    }\n}\n</code></pre>\n"},{"tags":["linq","entity-framework"],"answer_count":1,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":6272,"score":12,"question_id":6919709,"title":"Only initializers, entity members, and entity navigation properties are supported","body":"<p>I'm getting this exception :</p>\n\n<p>The specified type member 'Paid' is not supported in LINQ to Entities. Only initializers, entity members, and entity navigation properties are supported.</p>\n\n<pre><code>    public ActionResult Index()\n    {\n        var debts = storeDB.Orders\n            .Where(o =&gt; o.Paid == false)\n            .OrderByDescending(o =&gt; o.DateCreated);\n\n        return View(debts);\n    }\n</code></pre>\n\n<p>My Model class</p>\n\n<pre><code>public partial class Order\n{\n    public bool Paid {\n        get {\n            return TotalPaid &gt;= Total;\n        }\n    }\n\n    public decimal TotalPaid {\n        get {\n            return Payments.Sum(p =&gt; p.Amount);\n        }\n    }\n</code></pre>\n\n<p>Payments is a Related table containing the field amount, The query works if I remove the Where clause showing correct information about the payments, any clue what's wrong with the code?</p>\n\n<p><strong>Solved like the answer suggested with :</strong></p>\n\n<pre><code>    public ActionResult Index()\n    {\n        var debts = storeDB.Orders\n            .OrderByDescending(o =&gt; o.DateCreated)\n            .ToList()\n            .Where(o =&gt; o.Paid == false);\n\n        return View(debts);\n    }\n</code></pre>\n"},{"tags":["linq","entity-framework","entity-framework-4.1","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12991571,"title":"Linq doubts with DB context","body":"<p>Hi I have a question that is braking my mind for some days.\nI have my SQL server Database and my C# application.\nIn the DB I have differemt tables, let me show you a simple ex\nTables:\nPerson\nRelationship\nCity</p>\n\n<p>Business Rules:\nThe person are from a City, so the person has IdCity\nA person has a relationship with other person, and about that relationship you need to save the starting date.</p>\n\n<p>In other projects I already did something like that, but in this proyect this is not working for me.</p>\n\n<p>When I retrieved with LinQ the information about the person, the city is not coming, and an error appears when I try \"person.city.description\", for ex.\nI try using Include(\"City\") in the linq query, but it didn't work. Besides that, I don't know how to manage the circular reference to the person to person relationship.</p>\n\n<p>One important thing, that I think that can be the problem, is that I rename all the tables from the DataModel, for example, the table in database is called Prd_City, so I change the Name and the Entity Set Name for City in c# project. So in the included I have to use the real table name, in other case the query fail, but if I use the real name nothing happens.</p>\n\n<pre><code>using (var context = new MyContext())\n{\n   List&lt;Person&gt; oPeople = (from p in context.Person.Include(\"Prd_City\")\n                           select p).ToList();\n   return oPeople ;\n}\n</code></pre>\n\n<p>Any help will be welcome.\nThanks!</p>\n"},{"tags":["c#","database","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12634495,"title":"Table missing from database when using CreateDatabase()","body":"<pre><code>MyEntities db = new MyEntities(theParameter);\n</code></pre>\n\n<p>Here is theParameter:</p>\n\n<pre><code> metadata=res://*/Models.My.csdl|res://*/Models.My.ssdl|res://*/Models.My.msl;provider=System.Data.SqlClient;provider connection string='Data Source=[correctIpAddress];Initial Catalog=testDbName;User ID=myUsername;Password=myPassword;MultipleActiveResultSets=True'\n</code></pre>\n\n<p>When I add watch to db, it has many tables, among them the table tblTestTable. After that I do:</p>\n\n<pre><code>db.CreateDatabase();\n</code></pre>\n\n<p>And in the newly created database there is no tblTestTable table. Why is this happening?</p>\n"},{"tags":["entity-framework","mapping","entity-framework-4","metadata"],"answer_count":11,"favorite_count":4,"up_vote_count":19,"down_vote_count":0,"view_count":17502,"score":19,"question_id":2350514,"title":"EF Mapping and metadata information could not be found for EntityType Error","body":"<p>I have encountered an exception when I using Entity Framework 4.0 RC.\nMy Entity Framework model is encapsulated in a private assembly whos name is Procurement.EFDataProvider and my POCO are inside of another assembly Procurement.Core\nThe relation between Core(Business Logic)and EFDataProvider(Data Access) is with a factory named DataProvider</p>\n\n<p>so when I try to create an objectset</p>\n\n<pre><code>objectSet = ObjectContext.CreateObjectSet&lt;TEntity&gt;();\n</code></pre>\n\n<p>I got an error:</p>\n\n<blockquote>\n  <p>Mapping and metadata information could not be found for EntityType 'Procurement.Core.Entities.OrganizationChart'.</p>\n</blockquote>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":12998231,"title":"Entity Framework: how to map multiple tables with different keys to one entity?","body":"<p>I have a DB structure like this:</p>\n\n<pre><code>create table Person (\n  ID bigint identity not null,\n  FirstName varchar(100),\n  LastName varchar(100),\n  -- etc... lot's of generic fields that apply to a person, e.g. phone, address\n)\n\ncreate table Teacher (\n  ID bigint identity not null,\n  PersonID bigint not null,\n  EmploymentDate date,\n  -- plus a bunch of other teacher-specific fields\n)\n\ncreate table Student (\n  ID bigint identity not null,\n  PersonID bigint not null,\n  EnrollmentDate date,\n  -- plus a bunch of student-specific fields\n)\n\ncreate table SystemUser (\n  ID bigint identity not null,\n  PersonID bigint not null,\n  UserName varchar(50) not null,\n  -- plus any user specific fields\n)\n</code></pre>\n\n<p>The relationship between <code>Person</code> and all the other fields is 1 -> 0:1, and each of the \"subclasses\" of <code>Person</code> has a unique key on <code>PersonID</code>.  A <code>SystemUser</code> may be the same person as a <code>Teacher</code> or a <code>Student</code>; in fact you could conceivably have a person who is all three.</p>\n\n<p>Now, I want to make EF entities to represent <code>Teacher</code>, <code>Student</code> and <code>SystemUser</code>, each of which either actually inherits from <code>Person</code> (1st prize), or at least incorporates the <code>Person</code> fields in the class, implicitly mapping to both underlying tables.</p>\n\n<p>I've found plenty of examples online where they share the same primary key, but none where they do not share the same primary key, i.e. <code>PersonID</code> on the derived tables maps to <code>ID</code> on the <code>Person</code> table.</p>\n\n<p>How do you you do it?</p>\n"},{"tags":["c#","entity-framework","linq-to-entities","ef-code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12998156,"title":"Entity framework. Quering parent entity with subclass property loaded","body":"<p>There is a simple domain..</p>\n\n<pre><code>public abstract class UserComment\n{\n    public string Text { get; set; }\n}\n\npublic class BlogComment : UserComment\n{\n    public Blog Blog { get; set; }\n}\n\npublic class PhotoComment : UserComment\n{\n    public Photo Photo { get; set; }\n}\n</code></pre>\n\n<p>Is there way to query all entities of type <em>UserComment</em> with properties Blog and Photo loaded?</p>\n\n<pre><code>var comment = DbContext.Set&lt;UserComment&gt;()\n    .Include(x =&gt; x.Blog) // will not compile\n    .Include(x =&gt; x.Photo) // will not compile\n    .FirstOrDefault();\n\nif (comment is PhotoComment )\n{\n    string url = (comment as PhotoComment).Photo.Url;\n}\nif (comment is BlogComment)\n{\n    var dateCreated = (comment as BlogComment).Blog.DateCreated;\n}\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12998314,"title":"Entity Framework creating foreign record","body":"<p>I have a User table with foreign key pointing to the Address Table.</p>\n\n<pre><code>public User()\n{\n\n}\n\npublic int UserID { get; set; }\npublic string ReferenceNumber { get; set; }\npublic string FirstName { get; set; }\npublic string SecondName { get; set; }\npublic string Email { get; set; }\npublic string Password { get; set; }\npublic bool IsEnabled { get; set; }\npublic string TelephoneNumber { get; set; }\npublic string FaxNumber { get; set; }\npublic bool IsAccountant { get; set; }\npublic int AddressID { get; set; }\npublic virtual Address Address { get; set; }\n}\n</code></pre>\n\n<p>That's working fine in the view i.e. the user is asked to select AddressID when creating new 'User' record... However, what can I do if the Address record does not exist yet (apart from creating it first) is it possible to somehow point them to the Address View, force them to create Address first and pass the primary key back or put both views on the same page? Many thanks.</p>\n"},{"tags":["entity-framework","asp.net-mvc-3","ef-code-first"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":3361,"score":5,"question_id":5686272,"title":"MVC 3 & ASP.Net with Entity Framework scaffolding error : No model classes are available","body":"<p>I am trying to use MVC3 with the Entity framework with Code First, but the code Template generation process in MS Visual Web Developer 2010 - is not detecting my Model in the models folder - giving a message - \"No Model classes are available\" - although I do have model classes for which I want to create controllers.</p>\n\n<p>The templating option I've selected is \"Controller with read/write actions and views using the Entity Framework\".</p>\n\n<p>I've uninstalled and reinstalled Web Developer 2010, but still having the same error.</p>\n\n<p>Anyone know how I can get around this error?</p>\n"},{"tags":["c#","json","entity-framework","serialization","asp.net-mvc-3"],"answer_count":8,"favorite_count":8,"up_vote_count":16,"down_vote_count":0,"view_count":7808,"score":16,"question_id":5588143,"title":"EF 4.1 - Code First - JSON Circular Reference Serialization Error","body":"<p>I am getting an a Circular Reference Serialization Error although, to my knowledge I do not have any circular references. I am retrieving a set of Orders from the database and sending them to the client as JSON. All the code is shown below.</p>\n\n<p>This is the error:</p>\n\n<blockquote>\n  <p><strong>Error</strong></p>\n  \n  <p>A circular reference was detected\n  while serializing an object of type\n  'System.Data.Entity.DynamicProxies.Order_83CECF2AA4DE38232F9077D4B26941AB96BC61230419EA8AC42C9100E6072812'.\n  Description: An unhandled exception\n  occurred during the execution of the\n  current web request. Please review the\n  stack trace for more information about\n  the error and where it originated in\n  the code. </p>\n  \n  <p>Exception Details:\n  System.InvalidOperationException: A\n  circular reference was detected while\n  serializing an object of type\n  'System.Data.Entity.DynamicProxies.Order_83CECF2AA4DE38232F9077D4B26941AB96BC61230419EA8AC42C9100E6072812'.</p>\n  \n  <p>Source Error: </p>\n  \n  <p>An unhandled exception was generated\n  during the execution of the current\n  web request. Information regarding the\n  origin and location of the exception\n  can be identified using the exception\n  stack trace below.</p>\n</blockquote>\n\n<p>My classes are as follows:</p>\n\n<p><strong>Order</strong></p>\n\n<pre><code>public class Order\n{\n    [Key]\n    public int OrderId { get; set; }\n\n    public int PatientId { get; set; }\n    public virtual Patient Patient { get; set; }\n\n    public int CertificationPeriodId { get; set; }\n    public virtual CertificationPeriod CertificationPeriod { get; set; }\n\n    public int AgencyId { get; set; }\n    public virtual Agency Agency { get; set; }\n\n    public int PrimaryDiagnosisId { get; set; }\n    public virtual Diagnosis PrimaryDiagnosis { get; set; }\n\n    public int ApprovalStatusId { get; set; }\n    public virtual OrderApprovalStatus ApprovalStatus { get; set; }\n\n    public int ApproverId { get; set; }\n    public virtual User Approver { get; set; }\n\n    public int SubmitterId { get; set; }\n    public virtual User Submitter { get; set; }\n\n    public DateTime ApprovalDate { get; set; }\n\n    public DateTime SubmittedDate { get; set; }\n    public Boolean IsDeprecated { get; set; }\n}\n</code></pre>\n\n<p><strong>Patient</strong></p>\n\n<pre><code>public class Patient\n{\n    [Key]\n    public int PatientId { get; set; }\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public string MiddleInitial { get; set; }\n    public bool IsMale;\n    public DateTime DateOfBirth { get; set; }\n\n    public int PatientAddressId { get; set; }\n    public Address PatientAddress { get; set; }\n\n    public bool IsDeprecated { get; set; }\n}\n</code></pre>\n\n<p><strong>Certification Period</strong></p>\n\n<pre><code>public class CertificationPeriod\n{\n    [Key]\n    public int CertificationPeriodId { get; set; }\n    public DateTime startDate { get; set; }\n    public DateTime endDate { get; set; }\n    public bool isDeprecated { get; set; }\n}\n</code></pre>\n\n<p><strong>Agency</strong></p>\n\n<pre><code>public class Agency\n{\n    [Key]\n    public int AgencyId { get; set; }\n    public string Name { get; set; }\n\n    public int PatientAddressId { get; set; }\n    public virtual Address Address { get; set; }\n}\n</code></pre>\n\n<p><strong>Diagnosis</strong></p>\n\n<pre><code>public class Diagnosis\n{\n    [Key]\n    public int DiagnosisId { get; set; }\n    public string Icd9Code { get; set; }\n    public string Description { get; set; }\n    public DateTime DateOfDiagnosis { get; set; }\n    public string Onset { get; set; }\n    public string Details { get; set; }\n}\n</code></pre>\n\n<p><strong>OrderApprovalStatus</strong></p>\n\n<pre><code>public class OrderApprovalStatus\n{\n    [Key]\n    public int OrderApprovalStatusId { get; set; }\n    public string Status { get; set; }\n}\n</code></pre>\n\n<p><strong>User</strong></p>\n\n<pre><code>public class User\n{\n    [Key]\n    public int UserId { get; set; }\n    public string Login { get; set; }\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public string NPI { get; set; }\n    public string Email { get; set; }\n\n}\n</code></pre>\n\n<blockquote>\n  <p><strong>NOTE: ADDRESS CLASS IS NEW ADDITION DURING EDIT</strong></p>\n</blockquote>\n\n<p><strong>Address</strong></p>\n\n<pre><code>public class Address\n{\n    [Key]\n    public int AddressId { get; set; }\n    public string StreetAddress { get; set; }\n    public string City { get; set; }\n    public string State { get; set; }\n    public string Zip { get; set; }\n    public string Phone { get; set; }\n    public string Title { get; set; }\n    public string Label { get; set; }\n}\n</code></pre>\n\n<p>The code that executes the serialization is here:</p>\n\n<p><strong>Excerpt from OrderController</strong></p>\n\n<pre><code>    public ActionResult GetAll()\n    {\n        return Json(ppEFContext.Orders, JsonRequestBehavior.AllowGet);\n    }\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":702,"score":0,"question_id":4365552,"title":"Entity Framework 4.0 Update POCO relationship","body":"<p>I have created the POCO class and it's equivalent in edmx file (Category entity with only one way navigation property Parent) </p>\n\n<pre><code>public class Category {\n    public int ID {get;set;}\n    public string Name {get;set;}\n    public Category Parent {get;set;}\n} \n</code></pre>\n\n<p>And I have an issue with CRUD operations affecting Parent property:</p>\n\n<p>Retrieve looks like:</p>\n\n<pre><code>public void CanRetrieve() {\nvar category = context.Categories.Where(x =&gt; x.ID == id).FirstOrDefault();\ncotext.LoadProperty&lt;Category&gt; (category, c =&gt; c.Parent);\n\n}\n</code></pre>\n\n<p>ant is working fine (i get Category object with Parent property filled)</p>\n\n<p>Add looks like:</p>\n\n<pre><code>public void CanAdd() {\n    Category cat = new Category();\n    cat.Name = \"cat 1\";    \n    cat.Parent = new Category() {ID = 12}; //assuming that in the database there is a record with ID 12 \n    context.Categories.Attach(cat);\n    context.SaveChanges();\n}\n</code></pre>\n\n<p>Is also working fine (in the DB new record appears with Parent_ID field set to 12)</p>\n\n<p>And Update:</p>\n\n<pre><code>public void CanUpdate() {\n    Category cat = new Category();\n    cat.Name = \"cat 1\";    \n    cat.Parent = new Category() {ID = 12}; //assuming that in the database there is a record with ID 12 \n    context.Categories.Attach(cat);\n    //XXX    \n    context.SaveChanges()\n}\n</code></pre>\n\n<p>does anything. If I replace the //XXX line with the following line:</p>\n\n<pre><code>Context.ObjectStateManager.ChangeObjectState(cat, EntityState.Modified); \n</code></pre>\n\n<p>the value of Name property is updated form the source object (I guess other scalar properties would also be) but the Parent is ignored and the Parent_ID field in the base is preserved. </p>\n\n<p>My question is: How in this scenario can I tell the context I want the Parent property value also reflected to the database and can it be done without passing all the values of Parent property (only an ID, just like in Adding scenario)?</p>\n\n<p>Best regards, </p>\n\n<p>Andrzej</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12824776,"title":"Automatically delete orphaned childs: Childs will not be deleted for the second Commit","body":"<p>Further to question <a href=\"http://stackoverflow.com/questions/10835439/can-ef-automatically-delete-data-that-is-orphaned-where-the-parent-is-not-delet\">Can EF automatically delete data that is orphaned, where the parent is not deleted?</a></p>\n\n<p>I checked the solution, as @Ladislav suggested here\n<a href=\"http://stackoverflow.com/a/10838228/54801\">http://stackoverflow.com/a/10838228/54801</a>\n<strong>Unfortunately I noticed that the solution works partially.</strong></p>\n\n<p>If we take the following code:</p>\n\n<pre><code> for (int k = 0; k &lt; 2; k++)\n {\n     var parentObject= _context.Parents.Get(1704);\n     parentObject.ChildObjects.Clear();\n\n     var childObject= _context.ChildObjects.Get(1000*k /*diffrent child for each iteration*/ );\n     parentObject.ChildObjects.Add(childObject);\n\n     _context.Commit();\n  }\n</code></pre>\n\n<p>The first iteration (k=0) was carried out deletion. <strong>But the second iteration will not delete!</strong></p>\n\n<p>Does anyone have a solution to the problem?</p>\n\n<p>The problem can be \"solved\" as shown here:</p>\n\n<pre><code>if(k == 1)\n{\n    foreach (var project in tender.TenderProjects)\n      {\n         _context.Projects.Remove(project);\n      }\n   }\n</code></pre>\n\n<p>But it's definitely not ideal\nI want my services out of any ORM logic..</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>The Iteration is just an example of the real scenario. Real scenario, the user can add the parent entity's first child. save the data and go again to remove the first child and add two other childs in his place</p>\n"},{"tags":["entity-framework","mono","monodevelop"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12997772,"title":"monodevelop entity framework integration","body":"<p>I have the last git of mono &amp; monodevelop which support entity framework.\nI can add the reference in my project but it seems that monodevelop do not generate edmx file from database.</p>\n\n<p>Do you know if this feature exist or is there is a solution to generate ORM mapping from database.</p>\n\n<p>I have try the menu item [Tool->Database->Generate Linq class]</p>\n\n<p>I select the connexion database and test it successfully.\nBut when I valide I get an exception:\nMonoDevelop.Database.Sql.SqlMetalExecException: sqlmetal: Could not load databaseConnectionType type 'ByteFX.Data.MySqlClient.MySqlConnection, ByteFX.Data'.  Try using the --with-dbconnection=TYPE option.</p>\n\n<p>I do not understand this advice in exception...</p>\n"},{"tags":["winforms","entity-framework","data-binding"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":177,"score":0,"question_id":8984329,"title":"Adding a New Entity via Data Binding on a Details Form.","body":"<p>How can I use data binding on a details form to add a new entity to my data source? I have created an Object data source, and dragged it onto my form as 'details', which automatically adds a bindingSource and bindingNavigator control to my form, in addition to data bound detail fields. I have the following code which all executes with no exceptions, but no new Branch record gets added when I click 'Add New' and then 'Save'.</p>\n\n<pre><code>private void BranchEditForm_Load(object sender, EventArgs e)\n{\n    branchBindingSource.DataSource = _loansEntities.Branches;\n}\n\nprivate void branchBindingNavigatorSaveItem_Click(object sender, EventArgs e)\n{\n    _loansEntities.SaveChanges(SaveOptions.AcceptAllChangesAfterSave);\n}\n</code></pre>\n\n<p>I can't seem to find any Entity Framework data binding examples that don't just default to grids.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":63,"score":4,"question_id":12996314,"title":"EF multiple relationships","body":"<p>Using Entity Framework 5</p>\n\n<p>So I have a Customer. The Customer could have many Addresses, but at least one. One of the addresses would also be set as the primary address (required). I tried various mappings, but so far I get an error on build or when I seed the database.</p>\n\n<p>Customer:</p>\n\n<pre><code>public class Customer\n{\n    public int CustomerId { get; set;}\n    public String CustomerName { get; set; }\n    public int PrimaryAddressId { get; set; }\n    public virtual CustomerAddress PrimaryAddress { get; set; }\n    public virtual ICollection&lt;CustomerAddress&gt; CustomerAddresses { get; set; }    \n}\n</code></pre>\n\n<p>Address:</p>\n\n<pre><code>public class CustomerAddress : Address\n{\n    public int CustomerAddressId { get; set; }\n    public int CustomerId { get; set; }\n    public virtual Customer Customer { get; set; }\n}\n</code></pre>\n\n<p>This part of my mapping is working correctly. It is on CustomerAddress.</p>\n\n<pre><code>        this.HasRequired(c =&gt; c.Customer)\n            .WithMany(d =&gt; d.CustomerAddresses)\n            .HasForeignKey(c =&gt; c.CustomerId);\n</code></pre>\n\n<p>But how do I specify the correct mapping for setting PrimaryAddress in Customer? Or is it the wrong approach?</p>\n\n<p>Thanks</p>\n\n<p><strong>EDIT - Using both Arnolds and LueTM's answers:</strong></p>\n\n<p>This code is now working.</p>\n\n<p>Customer:</p>\n\n<pre><code>public class Customer\n{\n    public int CustomerId { get; set;}\n    public String CustomerName { get; set; }\n    // public int PrimaryAddressId { get; set; } created in mapping\n    public virtual CustomerAddress PrimaryAddress { get; set; }\n    public virtual ICollection&lt;CustomerAddress&gt; CustomerAddresses { get; set; }    \n}\n</code></pre>\n\n<p>Address:</p>\n\n<pre><code>public class CustomerAddress : Address\n{\n    public int CustomerAddressId { get; set; }\n    public int CustomerId { get; set; }\n    public virtual Customer Customer { get; set; }\n}\n</code></pre>\n\n<p>Customer mapping:</p>\n\n<pre><code>        modelBuilder.Entity&lt;Customer&gt;\n            .HasOptional(c =&gt; c.PrimaryAddress)\n            .WithOptionalDependent().Map(m =&gt; m.MapKey(\"PrimaryAddressId\"));\n\n        modelBuilder.Entity&lt;Customer&gt;\n            .HasMany(c =&gt; c.CustomerAddresses)\n            .WithRequired(c =&gt; c.Customer)\n            .HasForeignKey(c =&gt; c.CustomerId)\n            .WillCascadeOnDelete(false);\n</code></pre>\n\n<p>And I use a repository to make sure that a new address is created first, saved, and then also set as primary and saved again. The repository makes sure the primary is \"required\".</p>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4","visual-studio-2012","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12995349,"title":"What is the data annotation for changing nullable and not null data types?","body":"<p>I reckon this should be simple for experienced programmers but here it goes. I am working on a project using entity framework code first.I have also enabled migrations and set to auto (Lovely feature).</p>\n\n<p>I stupidly declared one of the datatype wrong in my entity class and now i realised that it wouldn't work with what i was trying to do. Must have been the auto complete feature. But anyways, the field was nullable and now that i have changed it to what i want, it has set the field to \"not null\".</p>\n\n<p>Originally: <code>public virtual Byte[] ImageData { get; set; }</code></p>\n\n<p>Changed to: <code>public virtual byte ImageData { get; set; }</code></p>\n\n<p>Now that i have changed and built the solution, <code>update-database -force</code> will not work and throws an error that:</p>\n\n<pre><code>Cannot insert the value NULL into column 'ImageData', column does not allow nulls. UPDATE fails. The statement has been terminated.\n</code></pre>\n\n<p>Is there a Data Annotation i could use to set this field back to nullable?</p>\n\n<p>eg: <code>[DataType(DataType.Upload)]</code></p>\n\n<p>I have looked through here for a considerable amount of time and i can't seem to find what i am looking for.</p>\n"},{"tags":["c#","sql","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12990960,"title":"Restoring virtual member in SqlQuery<>()","body":"<p>In order to enhance the request time of a page with a lot of data, I am trying to use Context.Database.SqlQuery method, instead of using LINQ</p>\n\n<pre><code>Context.Database.SqlQuery&lt;Inschrijving&gt;(\"select * from dbo.inschrijving join dbo.duif on dbo.duif.duifid = dbo.inschrijving.duifid  where vluchtid = {0} and duivenmelker_duivenmelkerid = {1}\",vluchtId, duivenmelker.DuivenmelkerId);\n</code></pre>\n\n<p>This works, but in my class i use virtual members. These are null with the sqlquery method.</p>\n\n<p>I have tried other types of joins, at the moment I am using a method to restore the virtual object with the id.</p>\n\n<p>snippet of the class with virtual object:</p>\n\n<pre><code>[Key,ForeignKey(\"Duif\"), Column(Order = 0)]\npublic int DuifId { get; set; }\npublic virtual Duif Duif { get; set; }\n</code></pre>\n\n<p>How could I restore the virtual members in the object (in a better way)?</p>\n\n<p>Is there a way to do this all at once in the sqlquery?</p>\n"},{"tags":["entity-framework","visual-studio-2008-sp1",".net-3.5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":4124091,"title":"Is Entity Framework included with .NET 3.5 SP1?","body":"<p>I use Visual Studio 2008 Professional with .NET 3.5 SP1 installed. It is not showing Entity Model when I select \"New Project\". The MSDN links show that it was included with .NET 3.5 SP1. </p>\n\n<p>Why it is not appearing on my VS 2008?</p>\n"},{"tags":["entity-framework","ef4-code-only"],"answer_count":1,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":389,"score":4,"question_id":4124092,"title":"Junction table with aditional columns in EF4 CTP4 Code First","body":"<p>Given this sql schema:</p>\n\n<pre><code>create table [dbo].[Courses_Students] (\n    [DummyColumn] [int] null,\n    [CourseId] [int] not null,\n    [StudentId] [int] not null,\n    primary key ([CourseId], [StudentId])\n);\n</code></pre>\n\n<p>How do I define the composite primary key and the additional columns in the <code>EntityConfiguration</code>?</p>\n"},{"tags":["c#","wpf","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12996163,"title":"Creating class files based on entities","body":"<p>I am trying to create class files for entities ( ORM => entity framework ) to create a better structured code-behind file system. The problem is that the entities are not being loaded if they are put in a separate class file. I am using c# / WPF</p>\n\n<p>I reference the entities a heck of a lot are there is a lot of logic created by manipulating the entities that have already been called. I have tried to narrow down my problem and am really struggling. I think the problem lies in the \"findResource\"</p>\n\n<pre><code>System.Windows.Data.CollectionViewSource employeesViewSource = ((System.Windows.Data.CollectionViewSource)(d.FindResource(\"employeesViewSource\")));\n</code></pre>\n\n<p>The \"d\" is an instance back to the main file. So its </p>\n\n<pre><code>Dashboard d = new Dashboard();\n</code></pre>\n\n<p>The entity becomes a collection resource which is referenced in the xaml in Dashbaord.xaml</p>\n\n<pre><code>&lt;CollectionViewSource x:Key=\"employeesViewSource\" d:DesignSource=\"{d:DesignInstance {x:Type my:Employee}, CreateList=True}\" /&gt;\n</code></pre>\n\n<p>which is then referenced in the listbox.</p>\n\n<p>its just not working though. And i am not to sure why. If i go through the debugger in VS and step through the processes it seems as it everything is working fine. It goes to the class file and runs through as it would otherwise but the results just do not show.</p>\n\n<p>//Example of one of the created entity classes which is called in the window_loaded event by Entity.LoadFarmFields();</p>\n\n<pre><code>public static void LoadFarmFields()\n{\n    var context = new LCEntities();\n    // Load data into EmployeeActivities. You can modify this code as needed.\n    System.Windows.Data.CollectionViewSource farmFieldsViewSource = ((System.Windows.Data.CollectionViewSource)(d.FindResource(\"farmFieldsViewSource\")));\n    System.Data.Objects.ObjectQuery&lt;Model.FarmField&gt; farmFieldsQuery = GetFarmFieldsQuery(context, d.txtbxFarmSearch.Text);\n    farmFieldsViewSource.Source = farmFieldsQuery.Execute(System.Data.Objects.MergeOption.AppendOnly);\n}\n\npublic static System.Data.Objects.ObjectQuery&lt;FarmField&gt; GetFarmFieldsQuery(LCEntities LCEntities, string searchCriteria)\n{\n   System.Data.Objects.ObjectQuery&lt;Model.FarmField&gt; farmFieldsQuery =\n       (from _ in LCEntities.FarmFields\n        where _.FarmFieldName.Contains(searchCriteria)\n        orderby _.FarmFieldName ascending\n        select _) as System.Data.Objects.ObjectQuery&lt;FarmField&gt;;\n        // Returns an ObjectQuery.\n   return farmFieldsQuery;\n}\n</code></pre>\n\n<p>Any suggestions? I feel like i am a bit out of my depth here. I normally just work on the ui >&lt;</p>\n"},{"tags":[".net","entity-framework","c#-4.0","sqlbulkcopy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":51,"score":-2,"question_id":12995854,"title":"SqlBulkCopy WriteToServer method","body":"<p>I want to write rows from my <code>List&lt;&gt;</code> collection into a database table. The problem is that using <code>SqlBulkCopy</code> data is not updated in the table after executing the method for writing to server.</p>\n\n<p>Here is a piece of code:</p>\n\n<pre><code>List&lt;TP_Margins&gt; modifiedMargins = new List&lt;TP_Margins&gt;();\n\nvar dataManager = RepositoryContextFactory.GetContext();\n\nusing (var bulkCopy = new SqlBulkCopy(dataManager.ConnectionString))\n{\n    bulkCopy.DestinationTableName = \"TP_Margins\";\n    bulkCopy.ColumnMappings.Add(new SqlBulkCopyColumnMapping(\"Id\", \"TP_Id\"));\n    bulkCopy.ColumnMappings.Add(new SqlBulkCopyColumnMapping(\"TRKey\", \"TP_TRKey\"));\n    bulkCopy.ColumnMappings.Add(new SqlBulkCopyColumnMapping(\"SvKey\", \"TP_SvKey\"));\n\n    bulkCopy.WriteToServer(modifiedMargins.AsDataReader());\n}\n</code></pre>\n\n<p>No exceptions or errors, but also no updates in database. Where I was wrong?</p>\n"},{"tags":["entity-framework","join"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":12995095,"title":"multiple join query in entity framework","body":"<p>I have following tables  </p>\n\n<p>tasks<br>\nid | name   | proj_id<br>\n1  | task1  | 1<br>\n2  | task2  | 1<br>\n3  | task3  | 1  </p>\n\n<p>projects<br>\nid | name<br>\n1  | sample proj1<br>\n2  | demo project  </p>\n\n<p>budget_versions<br>\nid | version_name| proj_id<br>\n1  | 50          | 1  </p>\n\n<p>budgets<br>\nid | cost  | budget_version_id | task_id<br>\n1  | 3000  | 1                 | 2<br>\n2  | 5000  | 1                 | 1  </p>\n\n<p>I need to join these tables to get a result as below using entity framework</p>\n\n<p>task_id | task_name | project_id | budget_version | budget_id | cost<br>\n1       | task1     | 1          | 1              | 2         |5000<br>\n2       | task2     | 1          | 1              | 1         |3000<br>\n3       | task3     | 1          | NULL           | NULL      |NULL   </p>\n\n<p>select tsk.id,tsk.name, tsk.project_id, bgtver.id, bgt.id, bgt.cost \nfrom TASK tsk\nleft outer join BUDGET_VERSIONS bgtver\non tsk.project_id= bgtver.project_id\nleft outer join BUDGETS bgt\non bgtver.id = bgt.budget_version_id  and tsk.id = bgt.task_id\nwhere bgtver.id = 1</p>\n\n<p>This is what I have tried so far  </p>\n\n<p>var budgetlists = _worker.Budgets.Get().GroupJoin(_worker.BudgetVersions.Get(),\n                                                             rb => rb.budget_version_id, rbv => rbv.id,\n                                                             (rb, rbrbv) => new {rb, rbrbv}).SelectMany(\n                                                               @t => @t.rbrbv.DefaultIfEmpty()).GroupJoin(\n                                                                 _worker.Tasks.Get(), rbrbv => rbrbv.id, tsk => tsk.id,\n                                                                 (rbrbv, tskrb) => new {rbrbv, tskrb}).SelectMany(\n                                                                   @p => @p.tskrb.DefaultIfEmpty());</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12349215,"title":"Entity Framework is there a way to see what is in cache?","body":"<p>Is there a way of looking at whats already in cache? I just want to ensure that I'm not making repeated database calls.</p>\n"},{"tags":["entity-framework","code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":275,"score":1,"question_id":7654879,"title":"EF Codefirst, One class, multiple tables with discriminator","body":"<p>I doing a little investigation and I am wondering if the following is possible.</p>\n\n<p>I am looking to create a BaseEntityWithDetails class that I can reuse for any type that I would like to have extendable. For example</p>\n\n<pre><code>public abstract class EntityDetail\n{\n}\n</code></pre>\n\n<p>This class is used to persist a key and value for the entity.</p>\n\n<p>\"Products\" would be extended by doing the following...</p>\n\n<pre><code>public class ProductDetail : EntityDetail\n{\n\n}\n\npublic class Product : BaseEntityWithDetails&lt;ProductDetail&gt;\n{\n\n}\n</code></pre>\n\n<p>The base class \"BaseEntityWithDetails\" will provide some helper methods for setting and getting. What do you think? </p>\n\n<p>What is the most effective way of mapping this with EF CodeFirst while being super easy to allow another type implement an DetailsEntityTypeConfiguration like the following</p>\n\n<pre><code>public class ProductMap : DetailsEntityTypeConfiguration&lt;Product, ProductDetail&gt;\n{\n}\n</code></pre>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12988981,"title":"Is there a baked in way to do Orderby or is this still state of the art for EF4.X","body":"<p><a href=\"http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx\" rel=\"nofollow\">http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx</a></p>\n\n<p>I looking to use EF with jqGrid and minimize plumbing. Therefore it interests me to find a generalized solution similiar to what Scott suggests. I am curious if this has been baked into EF or if this is still this is still the best way.</p>\n\n<p>Specifically:\nentity.Orderby(\"fieldName\");</p>\n"},{"tags":["entity-framework","build","export"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12991967,"title":"Entity Framework - Export Diagram from command line","body":"<p>Is there a way to export the entity framework diagram from the command line? I want to output a .png copy of the diagram as part of my CI builds.</p>\n\n<p>I assume you could re-use one of the libraries that Visual Studio uses, but I haven't been able to figure out which ones with ILSpy/dotpeek.</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12961148,"title":"How to associate one table to many parents using EF Code First","body":"<p>I am building a domain model that requires several tables to be able to be references by more than one possible parent table.  Something like you might have a table to store notes or files and those notes and/or files can be associated with different parent entities.  Not that the same \"file\" or \"note\" can be associate with multiple owners, but that of 10 rows in a \"files\" table, 3 of them might be owned by rows from a \"Customer\" table, 3 of them might be owned by rows from an \"Orders\" table, and 4 of them might be owned by rows from a \"Person\" table.</p>\n\n<p>The owning tables all have virtual ICollections of the child tables.</p>\n\n<p>When I ran my model through the code first migration for the initial migration, and looked at the generated fluent code, the table definition for these tables included multiple id columns that referred back to the source table, so that there would be a column \"customer_id,\" \"person_id,\" etc. (one for each possible \"owning entity.\"  This doesn't seem quite \"right.\"  Is there a better way to model this in EF with CodeFirst?  Like being able to use a discriminator column in the child table that provides a \"hint\" about the owning entity?</p>\n\n<p>Thanks,\n-MrB</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":65,"score":2,"question_id":12987738,"title":"I am getting less data using entity in MVVM","body":"<p>I added view into model. After that i created Domain service.</p>\n\n<p>I tried to add the view data to grid. </p>\n\n<pre><code>VReportViewer.GrdReport.ItemsSource = dcBusinessAccountingContext.SalesDetailViews;    \n</code></pre>\n\n<p>If i run with same view in sql server. I am getting 170 rows data. But using entity i am getting only 94 rows data.Can any body give me the idea any where i am doing mistake.</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":161,"score":1,"question_id":12990577,"title":"Entity Framework 5 Code First Relationships","body":"<p>I'm having trouble understanding how to create relationships between classes on a project that I'm building.</p>\n\n<p>I have a class <code>Photo</code> that has a required one-to-one relationship with <code>PhotoExif</code>, and <code>Photo</code> has an optional one-to-one relationship with <code>FeaturedPhoto</code>.</p>\n\n<p>I'm getting the error:</p>\n\n<blockquote>\n  <p>Unable to determine composite primary key ordering for type <code>Website.Models.PhotoExif</code>. Use the <code>ColumnAttribute</code> or the <code>HasKey</code> method to specify an order for composite primary keys.</p>\n</blockquote>\n\n<p>Help would be much appreciated.</p>\n\n<p><strong>Photo.cs</strong></p>\n\n<pre><code>public class Photo\n{\n    [Key]\n    public int PhotoID { get; set; }\n\n    public string Title { get; set; }\n\n    public string Description { get; set; }\n    public Orientation Orientation { get; set; }\n    public int Rating { get; set; }\n    public string URL { get; set; }\n    public string Filename { get; set; }\n    public DateTime DateAdded { get; set; }\n    public bool Hide { get; set; }\n    public string MetaDescription { get; set; }\n    public string MetaKeywords { get; set; }\n\n    public virtual PhotoExif PhotoExif { get; set; }\n} \n</code></pre>\n\n<p><strong>PhotoExif.cs</strong></p>\n\n<pre><code>public class PhotoExif\n{\n    [Key]\n    public int PhotoExifID { get; set; }\n\n    public int PhotoID { get; set; }\n\n    public string ShutterSpeed { get; set; }\n    public string Aperture { get; set; }\n    public string FocalLength { get; set; }\n    public int ISO { get; set; }\n    public string ExposureBias { get; set; }\n    public bool Flash { get; set; }\n    public string WhiteBalance { get; set; }\n    public string Lens { get; set; }\n    public DateTime DateTaken { get; set; }\n    public float Longitude { get; set; }\n    public float Latitude { get; set; }\n    public int Zoom { get; set; }\n    public string Location { get; set; }\n\n    public virtual Photo Photo { get; set; }\n}\n</code></pre>\n\n<p><strong>FeaturedPhoto.cs</strong></p>\n\n<pre><code>public class FeaturedPhoto\n{\n    [Key]\n    public int FeaturedPhotoID { get; set; }\n\n    public DateTime StartDate { get; set; }\n    public DateTime EndDate { get; set; }\n    public string InformationLocation { get; set; }\n    public string ImagePosition { get; set; }\n\n    public virtual Photo Photo { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","sql-server","entity-framework","tsql","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":69,"score":0,"question_id":12990538,"title":"How to convert this SQL query to LINQ to Entities query?","body":"<p>I need help to convert a SQL query to entity query in my C# code.\nThe query combines 4 different tables together which is as follows:</p>\n\n<pre><code>SELECT a.email,\n       a.status,\n       a.createdat,\n       b.unitprice,\n       c.name,\n       d.name,\n       e.name \nFROM Orders a, \n     Orderdetails b, \n     ServiceOptions c, \n     services d, \n     merchants e \nWHERE a.id=b.orderid AND c.id=b.serviceoptionid\n      AND c.serviceid=d.id AND d.merchantid=e.id\n</code></pre>\n"},{"tags":["performance","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12990662,"title":"EF5 .Local performance","body":"<p>I'm doing this on a table with ~43k rows:</p>\n\n<pre><code>MyDbContext.Stores.Load();\nMyDbContext.Stores.Local.Count.Dump(); //horrible performance!\n</code></pre>\n\n<p>I can see through the profiler that the first instruction fires up the select statement to fetch all rows. Actually the second instruction returns the correct value but after ~12 seconds, and it is not what I was expecting considering that all data should be in memory.\nWhat is wrong (or what is its real purpose) with .Local in Entity Framework?</p>\n"},{"tags":["asp.net","entity-framework","visual-studio-2012","code-first-migrations"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":228,"score":1,"question_id":12318107,"title":"Enabling Code First Entity Framework VS Web Express 2012","body":"<p>I am trying to enable Code First in my Visual Studio Web Express 2012. From what I have read so far I have to use the Package Manager Console and the command Enable-Migrations.  When I do this I get the following error. </p>\n\n<pre><code>Exception calling \"LoadFrom\" with \"1\" argument(s): \"Could not load file or assembly 'file:///E:\\Working\\wingtoysdl\\C#\\packages\\EntityFramework.5\n.0.0\\tools\\EntityFramework.PowerShell.Utility.dll' or one of its dependencies. Operation is not supported. (Exception from HRESULT: 0x80131515)\"\nAt E:\\Working\\wingtoysdl\\C#\\packages\\EntityFramework.5.0.0\\tools\\EntityFramework.psm1:398 char:62\n+     $utilityAssembly = [System.Reflection.Assembly]::LoadFrom &lt;&lt;&lt;&lt; ((Join-Path $toolsPath EntityFramework.PowerShell.Utility.dll))\n    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException\n    + FullyQualifiedErrorId : DotNetMethodException\n\nYou cannot call a method on a null-valued expression.\nAt E:\\Working\\wingtoysdl\\C#\\packages\\EntityFramework.5.0.0\\tools\\EntityFramework.psm1:399 char:50\n+     $dispatcher = $utilityAssembly.CreateInstance &lt;&lt;&lt;&lt; (\n    + CategoryInfo          : InvalidOperation: (CreateInstance:String) [], RuntimeException\n    + FullyQualifiedErrorId : InvokeMethodOnNull\n\nException calling \"CreateInstanceFrom\" with \"8\" argument(s): \"Could not load file or assembly 'file:///E:\\Working\\wingtoysdl\\C#\\packages\\EntityF\nramework.5.0.0\\tools\\EntityFramework.PowerShell.dll' or one of its dependencies. Operation is not supported. (Exception from HRESULT: 0x80131515\n)\"\nAt E:\\Working\\wingtoysdl\\C#\\packages\\EntityFramework.5.0.0\\tools\\EntityFramework.psm1:431 char:31\n+     $domain.CreateInstanceFrom &lt;&lt;&lt;&lt; (\n    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException\n    + FullyQualifiedErrorId : DotNetMethodException\n</code></pre>\n\n<p>As you can see it is a very large error making it very hard to google and troubleshoot. Does anyone have any ideas on how I can fix this?</p>\n"},{"tags":["c#","asp.net","entity-framework","asp.net-webforms",".net-4.5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":42,"score":-2,"question_id":12990585,"title":"Web page is blank at runtime","body":"<p>I just deployed a asp.net 4.5 web application with c#. When I go to the page it is blank on the site no errors are posted. When you view source there is no markup. I ftp'ed into the server to see if the files where there and what they looked like.  They are all there with the correct connections strings and so fourth. I then took the site and ran it locally looking at the production DB. Site works great!.\n So then i am confused and i make a template site and I don't change a thing besides the web config file and publish that. That site works fine so i don't get it not at all. i don't even know where to start to troubleshoot. Have any of you encountered this issue before?</p>\n\n<p>There were no error at any point of the build or publish. I am sorry for not posting code but i don't no what to post. </p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12990489,"title":".net linq entity framework groupby","body":"<p>I have a db table with columns like\nDaysInTrade, PercentGain</p>\n\n<p>i want a sum of PercentGain grouped by DaysInTrade</p>\n\n<p>so:</p>\n\n<pre><code>DaysInTrade,PercentGain\n1, 5\n1,6\n2,4\n</code></pre>\n\n<p>Would give me:</p>\n\n<pre><code>DaysInTrade, Sum\n1, 11\n2,4\n</code></pre>\n\n<p>I was not able to get intellisense working in the \"select new\" part unless I used something like Sum or Select.  the DIT column below shows up blank no matter if I do ts.DaysInTrade, or gts.DaysInTrade</p>\n\n<pre><code>        var partialQuery = (from ts in context.TradeSnapshots\n                            group ts by ts.DaysInTrade\n                            into gts\n                            select\n                            new\n                                {\n                                    profit = gts.Sum(s =&gt; s.PercentGain),\n                                    DIT = gts.Select(ts=&gt;ts.DaysInTrade)\n                                });\n        dataGridViewTradeSnapshots.DataSource = partialQuery.ToList(); \n</code></pre>\n"}]}
{"total":18927,"page":8,"pagesize":100,"questions":[{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12966844,"title":"Dynamic query using OR and Contains in Entity Framework","body":"<p>Given a string like this:</p>\n\n<pre><code>var filterOptions = \"First Bank\";\n</code></pre>\n\n<p>And a table that has a Grantee column and a Grantor column, how do I create a query with EF that will generate the following where clause:</p>\n\n<pre><code>... where (Grantor like '%First%' and Grantor like '%Bank%') or (Grantee like '%First%' and Grantee like '%Bank%')\n</code></pre>\n\n<p>Keep in mind that filterOptions is a parm that is passed in, so it could just as easily contain 3 or 4 words rather than just two ... in which case each column would need additional like clauses.</p>\n\n<p>If it weren't for the OR part of this, I would do the following (which will help give a better idea of what I'm trying to accomplish.</p>\n\n<pre><code>foreach(var word in filterOptions)\n{\n    var text = \"%\" + word + \"%\";\n    query = query.Where(r =&gt; SqlMethods.Like(r.Grantee,text));\n}\n</code></pre>\n\n<p>Like I said, its trying to add the OR portion with the other column that throws me for a loop.</p>\n"},{"tags":["wpf","entity-framework","mvvm","usercontrols","binding"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1208,"score":3,"question_id":5359730,"title":"How to reuse entity framework datasource for multiple views WPF EF MVVM","body":"<p>Hi I am designing an application using WPF4, EF and MVVM. I want to be able to create reusable UserControls that I can use in multiple windows in the application, and have them draw data from the same source. </p>\n\n<p>Lets say I have a GraphView component and a TableView component that can appear on the same page or in different places in the application, and I want them to both reflect the same collection of filtered EF entities. MVVM common practice seems to require that each view has its own viewmodel. But should I be be using a joint viewmodel and bind both to it, so if you change the data or filter, both would update simultaneously? If not how should I handle this?</p>\n\n<p>Thanks for any advice!</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":59,"score":3,"question_id":12989699,"title":"Entity FrameWork many-to-many","body":"<pre><code>public class Project\n{\n\n\n    public virtual int ID { get; set; }\n\n    [Required]\n    public virtual String Title { get; set; }\n\n\n    public String Definition { get; set; }\n    public DateTime StartDate { get; set; }\n\n\n    [Required]\n    public int CreaterID { get; set; }\n\n    public virtual ICollection&lt;Status&gt; Status { get; set; }\n    public virtual ICollection&lt;Task&gt; Tasks { get; set; }\n    public virtual ICollection&lt;User&gt; Users { get; set; }\n\n    public Project()\n    {\n        Users = new HashSet&lt;User&gt;();\n    }\n\n\n}\n\n\npublic class User\n{\n    public int ID { get; set; }\n\n\n    [DisplayName(\"Kullanc Ad\")]\n    [Required]\n    [MinLength(5, ErrorMessage = \"Kullanc Ad En Az 5 Karakter Olmaldr\")]\n    public string username { get; set; }\n\n    [DataType(DataType.Password)]\n    [DisplayName(\"ifre\")]        \n    [Required]\n    [MinLength(3,ErrorMessage=\"ifre En Az  3 Karakter Olmaldr\")]\n    public string password { get; set; }\n\n    [Required]\n    public String Name { get; set; }\n\n    [Required]\n    public String Surname { get; set; }\n\n    public int? CreaterID { get; set; }\n    public int level { get; set; }\n\n    public ICollection&lt;Task&gt; Tasks { get; set; }\n    public ICollection&lt;Project&gt; Projects { get; set; }\n\n    public User()\n    {\n        Projects = new HashSet&lt;Project&gt;();\n    }\n}\n\n\npublic class TaskDB : DbContext\n{\n    public DbSet&lt;Comment&gt; Comments { get; set; }\n    public DbSet&lt;Project&gt; Projects { get; set; }\n    public DbSet&lt;Situation&gt; Situaitons { get; set; }\n    public DbSet&lt;Task&gt; Tasks { get; set; }\n    public DbSet&lt;User&gt; Users { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;Project&gt;().\n          HasMany(c =&gt; c.Users).\n          WithMany(p =&gt; p.Projects).\n          Map(\n           m =&gt;\n           {\n               m.MapLeftKey(\"ProjectId\");\n               m.MapRightKey(\"UserId\");\n               m.ToTable(\"ProjectUser\");\n           });\n    }\n\n}\n</code></pre>\n\n<p>If I add project , current user added to project users list but project not added current user's projects list \nThis is my project add code</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Create(Project proje,Status status)\n    {\n\n        proje.StartDate = DateTime.Now;\n        proje.Status = new HashSet&lt;Status&gt;();\n        var user = _db.Users.Single(r=&gt; r.ID == UserRole.ID);\n        proje.Users.Add(user);\n        proje.Status.Add(status);\n        user.Projects.Add(proje);\n\n\n        if (ModelState.IsValid)\n        {\n            var projeler = _db.Projects;\n            projeler.Add(proje);\n            _db.SaveChanges();\n\n            return RedirectToAction(\"Index\");\n\n        }\n\n\n            return View(proje);\n\n    }\n</code></pre>\n\n<p>I Search this problem's cause I did not find , I want to learn why entity framework add user to project's list but not add project to user's list </p>\n"},{"tags":["c#","entity-framework","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12989566,"title":"Code First - Self-referencing one to many relation","body":"<p>I've found a lot of similar questions here, but none of them seems to help me with my problem. Fluent api &amp; attributes didn't help. The database was created, but when adding an object to it, it crashed.\nI want to have a class that has a collection of itself. Here's the code I have:</p>\n\n<pre><code>[Table(\"UObjects\")]\npublic class UObject\n{\n    [Key]\n    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    [Browsable(false)]\n    public long ID { get; set; }\n    public string Name { get; set; }\n    [Browsable(false)]\n    public long? ParentID { get; set; }\n\n    public virtual UObject UParent { get; set; }\n    [Browsable(false)]\n    public virtual ICollection&lt;UObject&gt; UObjects { get; set; }\n}\n\n\npublic class MyContext : DbContext\n{\n    public DbSet&lt;UObject&gt; UObjects { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        // This fluent API didn't help\n        //modelBuilder.Entity&lt;UObject&gt;()\n        //        .HasOptional(u =&gt; u.UParent)\n        //        .WithMany(u =&gt; u.UObjects)\n        //        .HasForeignKey(u =&gt; u.ParentID);\n\n        //modelBuilder.Entity&lt;UObject&gt;()\n        //        .HasOptional(u =&gt; u.UParent)\n        //        .WithMany(u =&gt; u.UObjects)\n        //        .Map(c =&gt;\n        //        {\n        //            c.MapKey(\"ParentID\");\n        //            c.ToTable(\"UObjects\");\n        //        });\n    }\n}\n</code></pre>\n\n<p>Records in database are like this:</p>\n\n<pre><code>ID | Name       | ParentID\n------------------------------------\n1  | First      | 0\n2  | SubFirst   | 1\n3  | SubSecond  | 1\n4  | SubThird   | 2\n5  | SubFourth  | 2\n</code></pre>\n\n<p>So how my object should look after loading the entities is next:</p>\n\n<pre><code>   - First\n      - SubFirst\n         - SubThird\n         - SubFourth\n      - SubSecond\n</code></pre>\n\n<p>But every object has an empty collection. What should I do to make it work properly?</p>\n"},{"tags":["c#",".net","entity-framework","poco"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12989192,"title":"Custom setter for C# model","body":"<p>I don't know how to make custom setter for C# data model. The scenario is pretty simple, I want my password to be automatically encrypted with SHA256 function. SHA256 function works very well (I've used in in gazillion of projects before).</p>\n\n<p>I've tried couple of things but when I run <code>update-database</code> it seems it's doing something recursively and my Visual Studio hangs (don't send error). Please help me understand how to make passwords be encrypted by default in model.</p>\n\n<h2>Code with what I've already tried</h2>\n\n<pre><code>public class Administrator\n{\n    public int ID { get; set; }\n    [Required]\n    public string Username { get; set; }\n    [Required]\n    public string Password\n    {\n        get\n        {\n            return this.Password;\n        }\n\n        set\n        {\n            // All this code is crashing Visual Studio\n\n            // value = Infrastructure.Encryption.SHA256(value);\n            // Password = Infrastructure.Encryption.SHA256(value);\n            // this.Password = Infrastructure.Encryption.SHA256(value);\n        }\n    }\n}\n</code></pre>\n\n<p>Seed</p>\n\n<pre><code>context.Administrators.AddOrUpdate(x =&gt; x.Username, new Administrator { Username = \"admin\", Password = \"123\" });\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12985774,"title":"Can a property not be both key and ForeignKey in entity framework","body":"<p>UPDATE</p>\n\n<p>I found out that adding a seperate key makes it work. So whats the deal with a property not being both key and ForeignKey to another table?</p>\n\n<pre><code>One or more validation errors were detected during model generation:\n\n\\tSystem.Data.Entity.Edm.EdmAssociationEnd: : Multiplicity is not valid in Role 'TrafficImageQuestionExtraInfo_TrafficImageQuestion_Source' in relationship 'TrafficImageQuestionExtraInfo_TrafficImageQuestion'. Because the Dependent Role refers to the key properties, the upper bound of the multiplicity of the Dependent Role must be '1'.\n\n\npublic class TrafficImageQuestionExtraInfoMap : EntityTypeConfiguration&lt;TrafficImageQuestionExtraInfo&gt;\n{\n    public TrafficImageQuestionExtraInfoMap()\n    {\n        this.HasKey(t =&gt; new { t.QuestionId, t.TrafficImageGuid });\n\n        this.Property(t =&gt; t.TrafficImageGuid).IsRequired();\n\n        this.Property(t =&gt; t.QuestionId).IsRequired();\n        this.Property(t =&gt; t.Key).IsRequired().HasMaxLength(50);\n        this.Property(t =&gt; t.Value).IsRequired().IsUnicode().HasMaxLength(128);\n        HasRequired(t =&gt; t.TrafficImageQuestion).WithMany(k =&gt; k.Properties).HasForeignKey(t =&gt; new { t.QuestionId, t.TrafficImageGuid });//.Map(m =&gt; m.MapKey(\"QuestionId\", \"TrafficImageGuid\")).WillCascadeOnDelete();\n    }\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>public class TrafficImageQuestionMap : EntityTypeConfiguration&lt;TrafficImageQuestion&gt;\n{\n    public TrafficImageQuestionMap()\n    {\n        // Primary Key\n        this.HasKey(t =&gt; new { t.QuestionId, t.TrafficImageGuid });\n\n        // Table &amp; Column Mappings\n        this.ToTable(\"TrafficImageQuestions\");\n        this.Property(t=&gt;t.QuestionId).IsRequired();\n\n        this.HasRequired(t =&gt; t.TrafficImage).\n            WithMany(t=&gt;t.TrafficImageQuestions).\n            HasForeignKey(t=&gt;t.TrafficImageGuid).WillCascadeOnDelete();\n        this.Property(t =&gt; t.\n            Answer).IsRequired();\n\n    }\n}\n</code></pre>\n"},{"tags":["php","jquery","asp.net-mvc","entity-framework","highcharts"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":147,"score":0,"question_id":12986341,"title":"Load data from database into highchart in MVC php using JSON","body":"<p>I am using MVC for Entity Framework &amp; developing aa application &amp; I want to upload data from database to show it into highchart's column-drilldown chart ?</p>\n\n<p>My Code For Binding is as below:</p>\n\n<pre><code>$result = mysql_query(\"select s.id, s.stage_name as stage, coalesce(sum(o.potential) *  (s.stage_weight / 100),0) as w_pot FROM s_stages as s \nleft join opps as o\nWHERE o.buy_stage = s.id\");\n$model[\"chart\"]=array();\nwhile($row = mysql_fetch_array($result)){\n    array_push($model[\"chart\"],\n        array(  \n            \"id\"=&gt;$row[\"s.id\"],\n            \"name\"=&gt;$row[\"stage\"],\n            \"w_pot\"=&gt;$row[\"w_pot\"]\n         ));\n}\n</code></pre>\n\n<p>and in view I have written code as below with its script code:</p>\n\n<pre><code>&lt;script src=\"http://code.highcharts.com/highcharts.js\"&gt;&lt;/script&gt;\n&lt;script src=\"http://code.highcharts.com/modules/exporting.js\"&gt;&lt;/script&gt;\n&lt;div id=\"container\" class=\"span6\" style=\"min-width: 400px; height: 400px; margin: 0 auto\"&gt;&lt;/div&gt;\n&lt;script type=\"text/javascript\"&gt;\n\n$(function () {\n    var chart;\n    $(document).ready(function() {\n\n        var colors = Highcharts.getOptions().colors,\n            categories = ['MSIE', 'Firefox', 'Chrome', 'Safari', 'Opera'],\n            name = 'Browser brands',\n            data = [{\n                    y: 55.11,\n                    color: colors[0],\n                    drilldown: {\n                        name: 'MSIE versions',\n                        categories: ['MSIE 6.0', 'MSIE 7.0', 'MSIE 8.0', 'MSIE 9.0'],\n                        data: [10.85, 7.35, 33.06, 2.81],\n                        color: colors[0]\n                    }\n                }, {\n                    y: 21.63,\n                    color: colors[1],\n                    drilldown: {\n                        name: 'Firefox versions',\n                        categories: ['Firefox 2.0', 'Firefox 3.0', 'Firefox 3.5', 'Firefox 3.6', 'Firefox 4.0'],\n                        data: [0.20, 0.83, 1.58, 13.12, 5.43],\n                        color: colors[1]\n                    }\n                }, {\n                    y: 11.94,\n                    color: colors[2],\n                    drilldown: {\n                        name: 'Chrome versions',\n                        categories: ['Chrome 5.0', 'Chrome 6.0', 'Chrome 7.0', 'Chrome 8.0', 'Chrome 9.0',\n                            'Chrome 10.0', 'Chrome 11.0', 'Chrome 12.0'],\n                        data: [0.12, 0.19, 0.12, 0.36, 0.32, 9.91, 0.50, 0.22],\n                        color: colors[2]\n                    }\n                }, {\n                    y: 7.15,\n                    color: colors[3],\n                    drilldown: {\n                        name: 'Safari versions',\n                        categories: ['Safari 5.0', 'Safari 4.0', 'Safari Win 5.0', 'Safari 4.1', 'Safari/Maxthon',\n                            'Safari 3.1', 'Safari 4.1'],\n                        data: [4.55, 1.42, 0.23, 0.21, 0.20, 0.19, 0.14],\n                        color: colors[3]\n                    }\n                }, {\n                    y: 2.14,\n                    color: colors[4],\n                    drilldown: {\n                        name: 'Opera versions',\n                        categories: ['Opera 9.x', 'Opera 10.x', 'Opera 11.x'],\n                        data: [ 0.12, 0.37, 1.65],\n                        color: colors[4]\n                    }\n                }];\n\n        function setChart(name, categories, data, color) {\nchart.xAxis[0].setCategories(categories, false);\nchart.series[0].remove(false);\nchart.addSeries({\nname: name,\ndata: data,\ncolor: color || 'white'\n}, false);\nchart.redraw();\n        }\n\n        chart = new Highcharts.Chart({\n            chart: {\n                renderTo: 'container',\n                type: 'column'\n            },\n            title: {\n                text: 'Browser market share, April, 2011'\n            },\n            subtitle: {\n                text: 'Click the columns to view versions. Click again to view brands.'\n            },\n            xAxis: {\n                categories: \n            },\n            yAxis: {\n                title: {\n                    text: ''\n                }\n            },\n            plotOptions: {\n                column: {\n                    cursor: 'pointer',\n                    point: {\n                        events: {\n                            click: function() {\n                                var drilldown = this.drilldown;\n                                if (drilldown) { // drill down\n                                    setChart(drilldown.name, drilldown.categories, drilldown.data, drilldown.color);\n                                } else { // restore\n                                    setChart(name, categories, data);\n                                }\n                            }\n                        }\n                    },\n                    dataLabels: {\n                        enabled: true,\n                        color: colors[0],\n                        style: {\n                            fontWeight: 'bold'\n                        },\n                        formatter: function() {\n                            return this.y +'%';\n                        }\n                    }\n                }\n            },\n            tooltip: {\n                formatter: function() {\n                    var point = this.point,\n                        s = this.x +':&lt;b&gt;'+ this.y +'% market share&lt;/b&gt;&lt;br/&gt;';\n                    if (point.drilldown) {\n                        s += 'Click to view '+ point.category +' versions';\n                    } else {\n                        s += 'Click to return to browser brands';\n                    }\n                    return s;\n                }\n            },\n            series: [{\n                name: name,\n                data: data,\n                color: 'white'\n            }],\n            exporting: {\n                enabled: false\n            }\n        });\n    });\n\n});\n&lt;/script&gt;\n</code></pre>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12986984,"title":"Entity Framework - Casting the retrieved Combobox value to string","body":"<p>Using Entity Framework, I have a Combobox showing a list of data retrieved from a database.</p>\n\n<pre><code>using System;  //I removed the other using statements here to preserve space\n\nnamespace ExTea_BackEnd\n{\n    public partial class frmAddBreakdown : Form\n    {\n        ExTeaEntities Breakdowns;\n        Breakdown_Type BreakdownTypes;\n\n        public frmAddBreakdown()\n        {\n            InitializeComponent();\n        }\n\n        private void cmbBreakdownType_SelectedIndexChanged(object sender, EventArgs e)\n        {\n            Breakdown_Type breakdownType = (Breakdown_Type)cmbBreakdownType.SelectedItem;\n            string selectedBreakdownTypeId = breakdownType.BrkdwnId;\n\n            IQueryable&lt;Breakdown_Type&gt; breakdownTypeQuery = from t in Breakdowns.Breakdown_Types\n                                                            where t.BrkdwnId == selectedBreakdownTypeId\n                                                            select t;\n            List&lt;Breakdown_Type&gt; selectedBreakdownId = breakdownTypeQuery.ToList();\n\n            if (selectedBreakdownId != null &amp;&amp; selectedBreakdownId.Count &gt; 0)\n            {\n                BreakdownTypes = selectedBreakdownId.First();\n                txtBreakdownId.Text = BreakdownTypes.BrkdwnId.ToString();\n            }\n            else\n            {\n                BreakdownTypes = null;\n            }\n        }\n\n        private void btnAdd_Click(object sender, EventArgs e)\n        {\n            try\n            {\n                Breakdown newBreakdown = new Breakdown();\n\n                Breakdown_Type breakdownType = (Breakdown_Type)cmbBreakdownType.SelectedItem;\n                newBreakdown.BrkdwnType = breakdownType.ToString();   //this is where the error occurs\n\n                newBreakdown.MachineId = txtMachineId.Text.Trim();\n                newBreakdown.MachineType = txtMachineType.Text.Trim();\n                newBreakdown.ReportedDate = dtpDate.Value;\n                newBreakdown.JobStatus = \"I\";\n\n                Breakdowns.AddToBreakdowns(newBreakdown);\n                int rowsAffected = Breakdowns.SaveChanges();\n                if (rowsAffected &gt; 0)\n                {\n                    MessageBox.Show(rowsAffected + \" records added!\", \"Save\", MessageBoxButtons.OK, MessageBoxIcon.Information);\n                }\n            }\n            catch (Exception ex)\n            {\n                MessageBox.Show(\"Error occured! \" + ex.Message);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I'm trying to save the data in the form back to the database, an error occurs when trying to cast the value selected from the Combobox. Even when I've casted it to the right type, it does not save the selected value! But this,</p>\n\n<p><img src=\"http://i.stack.imgur.com/w2FEU.png\" alt=\"enter image description here\"></p>\n\n<p>I'm clueless on what I'm doing wrong here? Can anyone please tell me how to correct this?</p>\n\n<p>Thank you.</p>\n"},{"tags":["entity-framework","datamodel","edmx"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2009,"score":2,"question_id":4617670,"title":"How to properly delete and re-add Entity Data Model","body":"<p>newbie to Entity Framework here.  Using VS 2010 and SQL Server 2008 express DB.</p>\n\n<p>I was having trouble refreshing an Entity Data Model after adding new tables.  So, I followed a suggestion I found here to just delete and regenerate the model.</p>\n\n<p>I get to the \"Choose Your Data Connection\" section of the Entity Data Model Wizard and \"Save entity connection settings in Web.config as:\" is checked.  However, my existing name has a 1 appended to it.  For example MyDatabaseEntities is now MyDatabaseEntities1.  Of course, I don't want the \"1\" appended.  I killed the existing connection string in Web.config and removed all references to that name in my solution.  Yet when I try to continue I'm presented with the following error:  </p>\n\n<p>\"'MyDatabaseEntites' conflicts with an existing property name in the Application Settings.  Please choose a different name\"     </p>\n\n<p>I can't find a reference to that name anywhere in the solution.  I can uncheck that option and it will continue, but it STILL won't add two of the tables in the database.  Next, I completely shut everything down, rebooted, and tried again.  This time I didn't get the error above, but two of my three new tables still do not get added to the edmx model.</p>\n\n<p>Any ideas are appreciated.  Also this seems like it's still pretty buggy even in VS2010/.NET 4.  Help restore my faith...I feel like abandoning Entity Framework at this point.  Based on my experience so far and some of the other issues posted here, I feel like I'm going to spend more time chasing Entity Framework strangeness than writing useful code.</p>\n\n<p>UPDATE:  I found a resolution.  The designer doesn't display errors.  You have have to look in the native XML (edmx file) to see the errors.  See here:  <a href=\"http://stackoverflow.com/questions/543971/ado-net-entity-framework-update-wizard-will-not-add-tables\">ADO.NET Entity Framework: Update Wizard will not add tables</a></p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12940042,"title":"IQueryable doesn't implement IDbAsyncEnumerable","body":"<p>The question was originally asked at <a href=\"http://entityframework.codeplex.com/discussions/399499#post928179\" rel=\"nofollow\">http://entityframework.codeplex.com/discussions/399499#post928179</a> .</p>\n\n<p>Good day! Please tell me if it is wrong place to post this question.</p>\n\n<p>I have a query as follows:</p>\n\n<pre><code>IQueryable&lt;Card&gt; cardsQuery =\n  dataContext.Cards\n  .Where(predicate)\n  .OrderByDescending(kc =&gt; kc.SendDate)\n  .AsQueryable();\n</code></pre>\n\n<p>Then I try:</p>\n\n<p><code>\nTask&lt;Card[]&gt; result = cardsQuery.ToArrayAsync();\n</code></p>\n\n<p>And then exception rises:</p>\n\n<p><code>The source IQueryable doesn't implement IDbAsyncEnumerable&lt;Models.Card&gt;</code></p>\n\n<p>I use modified version of 'EF 5.x DbCotext generator'.</p>\n\n<p>How to avoid it?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Important remark is that I have method to produce <code>IQuerayble&lt;Card&gt;</code> as follows:</p>\n\n<pre><code>class Repository {\n  public IQueryable&lt;Card&gt; GetKudosCards(Func&lt;Card, bool&gt; predicate) {\n    IEnumerable&lt;KudosCard&gt; kudosCards = kudosCardsQuery.Where(predicate);\n     return kudosCards\n            .OrderByDescending(kc =&gt; kc.SendDate)\n            .AsQueryable();\n  }\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":646,"score":3,"question_id":2947511,"title":"Entity Framework : How do you refresh the model when the db changes?","body":"<p>If you build the edmx file from the database and then the db changes, how do you get the model to pick up the change?</p>\n\n<p>Do you delete the whole model and regenerate or can you detect changes?</p>\n\n<p>I see a post mentioning a \"Update Your Model\" rt. mouse command on the edmx file, but I dont see it.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/690248/updating-your-edmx-to-reflect-changes-made-in-your-db-net-linq-to-entities\">Updating your edmx to reflect changes made in your db (.net linq-to-entities)</a></p>\n\n<p>I'm just starting out.</p>\n"},{"tags":["c#","asp.net","asp.net-mvc","entity-framework","sql-server-ce"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":194,"score":1,"question_id":9509563,"title":"EF will only let me choose SQL Server CE 3.5","body":"<p>I have a Visual Studio solution with two projects: <code>MyApp.MvcUI</code> and <code>MyApp.Domain</code> (class library).</p>\n\n<p><code>MyApp.MvcUI</code> contains my SQL Server CE 4 database.</p>\n\n<p><code>MyApp.Domain</code> is supposed to contain the Entity Framework EDMX file, but if I add it there I don't have the option to use SQL Server CE 4, only 3.5.</p>\n\n<p><img src=\"http://www.codetunnel.com/content/images/sqlce35only.jpg\" alt=\"\"></p>\n\n<p>If I add the EDMX in the <code>MvcUI</code> project then I am able to choose SQL Server CE 4.</p>\n\n<p>Question </p>\n\n<ol>\n<li><p>How can I put my Entity Framework content into the <code>MyApp.Domain</code> project and use a SQL Server CE 4 database that lives in the <code>MyApp.MvcUI</code> project?</p></li>\n<li><p>Once I solved that problem, what will the data source portion of my connection string in <code>App.Config</code> look like? I know the web project's connection string will simply look like this: </p>\n\n<pre><code>Data Source=|DataDirectory|\\CE4DB.sdf\n</code></pre>\n\n<p>but what will that look like in <code>App.Config</code> in the <code>MyApp.Domain</code> project? Will it be an absolute path like </p>\n\n<pre><code>C:\\Code\\MyProject\\MyApp.MvcUI\\App_Data\\CE4DB.sdf\n</code></pre></li>\n</ol>\n\n<p>If so, is there a way to make that a relative path so when people pull the project down from source control it will still work without path corrections?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12972497,"title":"How to seed data to a List<String> model member?","body":"<p>I have an Asp.Net MVC project up and running and I'm able to seed all the data I want to the database when my model changes except for one property which is of <code>List&lt;string&gt;</code> type.</p>\n\n<p>I've isolated that test case to better show the issue.</p>\n\n<p>Lets's say I've a simple <code>Person</code> model:</p>\n\n<pre><code>class Person\n{\n    public string Firstname { get; set; }\n    public string Lastname { get; set; }\n    public List&lt;string&gt; Children { get; set; }\n\n    public string ToString()\n    {\n        string children = \"\";\n\n        if (Children != null)\n        {\n            children = String.Join(\" - \", Children.ToArray());\n        }\n        else\n        {\n            children = \"none\";\n        }\n\n        return Firstname + \" \" + Lastname + \" -&gt; \" + children;\n    }\n}\n</code></pre>\n\n<p>When I use this model in an external Console application, I'm able to initialize all of its member.</p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        List&lt;Person&gt; myList = new List&lt;Person&gt; {\n            new Person { Firstname = \"John\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Bob\", \"Monica\" }},\n            new Person { Firstname = \"Bob\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Jack\", \"John II\" }},\n            new Person { Firstname = \"Monica\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Sue\", \"Mark\" }}\n        };\n\n        // output the list to screen\n        myList.ForEach(p =&gt; Console.WriteLine(p.ToString()));\n    }\n}\n</code></pre>\n\n<p>The output is then as expected:</p>\n\n<pre><code>John Doe -&gt; Bob - Monica\nBob Doe -&gt; Jack - John II\nMonica Doe -&gt; Sue - Mark\n</code></pre>\n\n<p>But now when I try to seed the same data into my database, the <code>Children</code> member is <code>null</code> !</p>\n\n<p>Here is how I'm trying to do it:</p>\n\n<pre><code>public class MySeedData : DropCreateDatabaseIfModelChanges&lt;MyDataBaseContextClass&gt;\n{\n    protected override void Seed(MyDataBaseContextClass context)\n    {\n        List&lt;Person&gt; myList = new List&lt;Person&gt; {\n            new Person { Firstname = \"John\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Bob\", \"Monica\" }},\n            new Person { Firstname = \"Bob\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Jack\", \"John II\" }},\n            new Person { Firstname = \"Monica\", Lastname = \"Doe\", Children = new List&lt;string&gt; { \"Sue\", \"Mark\" }}\n        };\n        myList.ForEach(p =&gt; context.Persons.Add(p));\n    }\n}\n</code></pre>\n\n<p>I've tried a lot of different construction patterns but every time the <code>Children</code> member is <code>null</code> whenever I try to access it in one of my Views.</p>\n\n<p>At the moment, the only way I've found to have this member being not null is to initialize the list in the default constructor of the <code>Person</code> class...</p>\n\n<p>So how can I seed data to this <code>Children</code> member with different values for each person?</p>\n"},{"tags":["c#","asp.net","asp.net-mvc","vb.net","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":466,"score":1,"question_id":5284558,"title":"Entity Framework looking for wrong column","body":"<p>I'm brand new to the Entity Framework and trying to learn all it can offer.  I'm currently working my way through the <a href=\"http://www.asp.net/mvc/tutorials/mvc-music-store-part-4\" rel=\"nofollow\">MVC Music Store tutorial</a> which includes the following code:</p>\n\n<pre><code>public ActionResult Browse(string genre)\n {\n    // Retrieve Genre and its Associated Albums from database\n    var genreModel = storeDB.Genres.Include(\"Albums\")\n        .Single(g =&gt; g.Name == genre);\n\n    return View(genreModel);\n }\n</code></pre>\n\n<p>as I'm working in VB I converted it like so:</p>\n\n<pre><code>Function Browse(ByVal genre As String) As ActionResult\n\n            'Retrieve Genre and its Associated Albums from database\n            Dim genreModel = storeDB.Genres.Include(\"Albums\"). _\n                    Single(Function(g) g.Name = genre)\n\n            Return(View(genreModel))\n        End Function\n</code></pre>\n\n<p>The problem is I'm getting the following exception:</p>\n\n<blockquote>\n  <p>Invalid column name 'GenreGenreId'.</p>\n</blockquote>\n\n<p>Which I know is true, but I can't for the life of my work out where it's getting 'GenreGenreId' from.  Probably a basic question but I'll appreciate any help in the right direction.</p>\n\n<hr />\n\n<p>As per requested here is the source for my classes:</p>\n\n<p>Album.vb</p>\n\n<pre><code>Public Class Album\n\n    Private _title As String\n    Private _genre As Genre\n    Private _AlbumId As Int32\n    Private _GenreId As Int32\n    Private _ArtistId As Int32\n    Private _Price As Decimal\n    Private _AlbumArtUrl As String\n\n    Public Property Title As String\n        Get\n            Return _title\n        End Get\n        Set(ByVal value As String)\n            _title = value\n        End Set\n    End Property\n\n    Public Property AlbumId As Int16\n        Get\n            Return _AlbumId\n        End Get\n        Set(ByVal value As Int16)\n            _AlbumId = value\n        End Set\n    End Property\n\n    Public Property GenreId As Int16\n        Get\n            Return _GenreId\n        End Get\n        Set(ByVal value As Int16)\n            _GenreId = value\n        End Set\n    End Property\n\n    Public Property ArtistId As Int16\n        Get\n            Return _ArtistId\n        End Get\n        Set(ByVal value As Int16)\n            _ArtistId = value\n        End Set\n    End Property\n\n    Public Property AlbumArtUrl As String\n        Get\n            Return _AlbumArtUrl\n        End Get\n        Set(ByVal value As String)\n            _AlbumArtUrl = value\n        End Set\n    End Property\n\n    Public Property Price As Decimal\n        Get\n            Return _Price\n        End Get\n        Set(ByVal value As Decimal)\n            _Price = value\n        End Set\n    End Property\n\n    Public Property Genre As Genre\n        Get\n            Return _genre\n        End Get\n        Set(ByVal value As Genre)\n            _genre = value\n        End Set\n    End Property\n\n\nEnd Class\n</code></pre>\n\n<p>Genre.vb</p>\n\n<pre><code>Public Class Genre\n\n    Dim _genreId As Int32\n    Dim _Name As String\n    Dim _Description As String\n    Dim _Albums As List(Of Album)\n\n    Public Property GenreId As Int32\n        Get\n            Return _genreId\n        End Get\n        Set(ByVal value As Int32)\n            _genreId = value\n        End Set\n    End Property\n\n    Public Property Name As String\n        Get\n            Return _Name\n        End Get\n        Set(ByVal value As String)\n            _Name = value\n        End Set\n    End Property\n\n    Public Property Description As String\n        Get\n            Return _Description\n        End Get\n        Set(ByVal value As String)\n            _Description = value\n        End Set\n    End Property\n\n    Public Property Albums As List(Of Album)\n        Get\n            Return _Albums\n        End Get\n        Set(ByVal value As List(Of Album))\n            _Albums = value\n        End Set\n    End Property\n\nEnd Class\n</code></pre>\n\n<p>MusicStoreEntities.vb</p>\n\n<pre><code>Imports System.Data.Entity\n\nNamespace MvcApplication1\n\n    Public Class MusicStoreEntities\n        Inherits DbContext\n\n        Public Property Albums As DbSet(Of Album)\n        Public Property Genres As DbSet(Of Genre)\n\n    End Class\nEnd Namespace\n</code></pre>\n"},{"tags":[".net","sql-server","entity-framework","ews"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12974061,"title":"Use EWS API and SQL Server database as data sources","body":"<p>I am new to EF an am trying to build (what I think) is a rather simple application for my office. I am writing an application to track the projects we bid on. Each biditem will track (through navigation properties) which clients (bidders) we are bidding to (construction industry, so multiple clients per project), and project notes. </p>\n\n<p>I am planning on using EF (with SQL Server) for the bidtracker, but I want to use the EWS Managed API to get/maintain the contact info so that the office only has to maintain one contact list which is available through Outlook. </p>\n\n<p>So, is it possible to have mixed data sources (SQL Server and Exchange server) with Entity Framework? If so, can you point me to a good resource to help me wire it?</p>\n\n<p>Here is a simplified model (the <code>BidItem</code> and <code>Note</code> will be in SQL Server, the <code>Contact</code> will be from Exchange):</p>\n\n<p><img src=\"http://i.stack.imgur.com/29rCE.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["wpf","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12979344,"title":"Retrieving entity records before savingchanges","body":"<p>I just have not been able to find an answer to this anywhere and I'm hoping someone can help me.  I'm a newbie on WPF and Entity Framework, so probably doing this all wrong.</p>\n\n<p>I've got a situation where I'm creating new records and adding them to an Entity collection.  I do not want to perform a SaveChanges() on it yet to allow the user to finish everything they want to do and then do a final Save before leaving the form.  My problem is that after the records have been added to the Entity collection, I can not retrieve them back out for display 'until' they have had the SaveChanges() ran on the entity.</p>\n\n<p>This is basically a Master-Child display using two DataGrids but the Master grid source is a List&lt;> being built since one of the fields in the table needs to be converted to a more user friendly display.  And this is all coming from one table where I'm just grouping the data based on 3 of the fields (as the Master) and then displaying the child grid as the details of that grouping.</p>\n\n<p>This action is a 'Copy' action where I'm taking an existing DataGrid display of data and letting the user copy the data to a 'new' master group.  I'm using the following to create this new group of records.</p>\n\n<pre><code>            RateGroupRow rgr = new RateGroupRow();\n            rgr.StaffRole = rg.SelectedStaffRole;\n            rgr.Department = rg.SelectedDepartment;\n            rgr.PlanYear = rg.SelectedPlanYear;\n            _rateGroupQuery.Add(rgr);\n\n            foreach (var item in dgRateValues.Items)\n            {\n                if (item.GetType() == typeof(CommissionRate))\n                {\n                    CommissionRate cr = (CommissionRate)item;\n                    CommissionRate newcr = new CommissionRate();\n                    newcr.StaffRole = Common.StaffTextToStaffType(rgr.StaffRole);\n                    newcr.Department = rgr.Department;\n                    newcr.PlanYear = rgr.PlanYear;\n                    newcr.Low = cr.Low;\n                    newcr.High = cr.High;\n                    newcr.Rate = cr.Rate;\n                    Common.CommissionsEntities.CommissionRates.AddObject(newcr);\n                }\n            }\n            //TODO:  Don't want to do this SaveChanges here but for now that's the only way I can get these new records to be displayed in the data selection.\n            //Common.CommissionsEntities.SaveChanges();\n\n            dgRateGroups.ItemsSource = null;\n            dgRateGroups.ItemsSource = _rateGroupQuery;\n            dgRateGroups.SelectedIndex = dgRateGroups.Items.Count - 2;\n</code></pre>\n\n<p>After the Master record has been added to the _rateGroupQuery, the DataGrid (dgRateGroups) selects that row in which the SelectionChanged queries for the data to populate the details DataGrid as:</p>\n\n<pre><code>    dgRateValues.ItemsSource = null;\n    _CurrentSelectedStaffRole = rateGroupRow.StaffRole;\n    _CurrentSelectedDepartment = rateGroupRow.Department;\n    _CurrentSelectedPlanYear = rateGroupRow.PlanYear;\n    string StaffNameType = Common.StaffTextToStaffType(_CurrentSelectedStaffRole);\n\n    var CommissionRatesItems =\n        from cr in Common.CommissionsEntities.CommissionRates\n        where cr.StaffRole == StaffNameType &amp;&amp;\n              cr.Department == _CurrentSelectedDepartment &amp;&amp;\n              cr.PlanYear == _CurrentSelectedPlanYear\n        orderby cr.Low\n        select cr;\n    ObjectQuery&lt;CommissionRate&gt; CommissionRatesQuery = CommissionRatesItems as ObjectQuery&lt;CommissionRate&gt;;\n    dgRateValues.ItemsSource = CommissionRatesQuery.Execute(MergeOption.AppendOnly);\n</code></pre>\n\n<p>I get no records back from this select.  If I do the 'SaveChanges()' call after adding the records, then everything works fine.</p>\n\n<p>So is there a way to retrieve these newly added records prior to them being committed (SaveChanges) back to the database?</p>\n\n<p>Thank you,\nMike</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":105,"score":0,"question_id":12976813,"title":"Entity framework, referential integrity constraint violation occurred error on updating entity from disconnected area","body":"<p>I have below model</p>\n\n<pre><code>public class Order\n{\n    [Key]\n    public virtual string OrderNo {get;set;}\n    public virtual IList&lt;OrderItem&gt; Items {get;set;}\n}\n\npublic class OrderItem\n{\n    [Key]\n    public virtual string ItemNo {get; set;}\n    public virtual string ParentItemNo {get;set;}\n    public virtual string OrderNo {get;set;}\n\n    public virtual OrderItem ParentItem {get;set;}\n    public virtual IList&lt;OrderItem&gt; ChildItems {get;set;}\n    public virtual IList&lt;ItemProperty&gt; ItemProperties {get;set;}\n    public virtual Order Order {get;set;}\n}\n\npublic class ItemProperty\n{\n    [Key]\n    public virtual string PropertyNo {get; set;}\n    public virtual string ParentPropertyNo {get;set;}\n    public virtual string OrderItemNo {get;set;}\n\n    public virtual ItemProperty ParentProperty {get;set;}\n    public virtual IList&lt;ItemProperty&gt; ChildProperties {get;set;}\n    public virtual OrderItem OrderItem {get;set;}\n}\n</code></pre>\n\n<p>I'm running on disconnected area (with service our disconnected from the Entity Framework context)</p>\n\n<ol>\n<li>I create a order and save to database</li>\n</ol>\n\n<p>client:</p>\n\n<pre><code>service.CreateOrder(new Order() { OrderN=\"fksjdf1\" });\n</code></pre>\n\n<p>server:</p>\n\n<pre><code>using(EfDbContext context = new EfDbContext())\n{\n    context.Orders.Add(order);\n    context.SaveChanges();\n}\n</code></pre>\n\n<ol>\n<li>I need to add one or more OrderItems to previously added order</li>\n</ol>\n\n<p>client:</p>\n\n<pre><code>var order = service.GetOrder(\"fksjdf1\");\n\nvar item1 = new OrderItem();\nitem1.ItemNo=\"i1\";\nitem1.Order=order;\nitem1.OrderNo=order.OrderNo;\nitem1.ItemProperties.Add(new ItemProperty()\n    PropertyNo=\"p1\",\n    OrderItem = item1\n})\norder.Items.Add(item1);\n\nvar item2 = new OrderItem();\nitem2.ItemNo=\"i2\";\nitem2.Order=order;\nitem2.OrderNo=order.OrderNo;\nitem2.ItemProperties.Add(new ItemProperty()\n    PropertyNo=\"p2\",\n    OrderItem = item2\n});\nitem2.ItemProperties.Add(new ItemProperty()\n    PropertyNo=\"p3\",\n    OrderItem = item2\n})\norder.Items.Add(item2);\nservice.UpdateOrder(order);\n</code></pre>\n\n<p>server:</p>\n\n<pre><code>using(EfDbContext context = new EfDbContext())\n{\n    DbEntityEntry dbEntityEntry = context.Entry(order);\n    if (dbEntityEntry.State == EntityState.Detached)\n    {\n        // ERROR\n        context.Set&lt;Order&gt;().Attach(order);\n    }\n\n    dbEntityEntry.State = EntityState.Modified;\n    context.SaveChanges();\n}\n</code></pre>\n\n<p>Error: A referential integrity constraint violation occurred: The property values that define the referential constraints are not consistent between principal and dependent objects in the relationship.</p>\n\n<p>Why I see this error? Why I not update this entity?</p>\n\n<p>How can i use entity framework from disconnected area?</p>\n\n<p>EDIT 1:</p>\n\n<pre><code>public Order GetOrder(string orderNo)\n{\nusing (EfDbContext context = new EfDbContext())\n            {\n                context.Configuration.ProxyCreationEnabled = false;\n                var order = context.Orders\n                    .Include(o =&gt; o.OrderItems\n                                      .Select(z =&gt; z.ItemProperties\n                                                       .Select(y =&gt; y.ChildProperties)))\n                                                       .Where(o =&gt; o.OrderNo == orderNo)\n                    .FirstOrDefault();\n            }\n}\n</code></pre>\n"},{"tags":["entity-framework","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12917431,"title":"Entity Framework setting Identity Value with composite key Azure SQL","body":"<p>We've recently switched our existing product to using Entity Framework Code First Migrations. The transition has been rather painful, but we've gotten through almost all of it at this point. Now that we've got things working in our local environments we've pushed it out to our deployment environment. Unfortunately our deployment environment doesn't appear to support <strong>SOMETHING</strong> with the new EF Migrations.</p>\n\n<p>Our environment consists of two servers: a Web (.Net MVC3) server and a socket server, both running in Windows Azure. The problem only seems to occur in our socket server, and in fact Entity Framework is telling us that the database hash doesn't match (using <code>context.Database.CompatibleWithModel()</code>).</p>\n\n<p>If we ignore the fact that EF is telling us that our DB Model doesn't match our code model, the only error we encounter is the insertion of an entity object with a <strong>composite key</strong>. All other entities can be created fine. All of our entity classes derive from a base class:</p>\n\n<pre><code>class BaseEntity {\n    [HiddenInput(DisplayValue = false)]\n    [Key, Column(Order = 0)]\n    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public virtual long Id { get; set; }\n}\n</code></pre>\n\n<p>We had to add the 'Order' piece in order for EF to support the composite keys. The model that is having issues looks like:</p>\n\n<pre><code>class SubEntity {\n    [MaxLength(255)]\n    [Required]\n    [Key, Column(Order = 1)]\n    public string Name { get; set; }\n}\n</code></pre>\n\n<p>When we attempt to add a new <code>SubEntity</code> object to the context and save the changes, we get an error from SQL saying that we cannot set an explicit <code>Id</code>, and to use <code>IDENTITY_INSERT ON</code>.</p>\n\n<p><strong>The code works fine on our local machines, and in our web server. The DB model is compatible, and we can create 'SubEntity' objects without issue.</strong></p>\n\n<p>To me, it seems like EF, in the socket server environment, is ignoring the <code>[DatabaseGenerated]</code> Annotation when using a composite key. That would explain the error, and explain why the DB model is not compatible. Does this make sense? Is there something in the environment that would make EF behave differently?</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12883371,"title":"How to customize DbContext properties names in Entity Framework and stop being overwritted?","body":"<p>EF auto-generate the DbContext class from my edmx file (database first) and use table names as default names for all this DbContext properties (ex: <code>public DbSet&lt;Student&gt; student { get; set; }</code>)</p>\n\n<p>If I make some change in this file (ex: like renaming properties name from student to Students), my changes are lost everytime I save my model because EF regenerate the DbContext class file.</p>\n\n<p>How can I change this default behaviour and be able to make my customization and stop losing it?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":11918401,"title":"enable-migrations error : project failed to build","body":"<p>Using ASP.NET MVC4 with EF4.3</p>\n\n<p>Running Enable-Migrations from PM Console</p>\n\n<p>System.Management.Automation.RuntimeException: The project 'MyProj' failed to build.\nThe project 'MyProj' failed to build.</p>\n\n<p>The project builds (control-shift-B) </p>\n\n<p>Is there any way to get more detail on this error to diagnose?</p>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":299,"score":1,"question_id":10257360,"title":"How to update not every fields of an object using Entity Framework and EntityState.Modified","body":"<p>I need to update all fields except property1 and property2 for the given entity object.<br>\nHaving this code:  </p>\n\n<pre><code>    [HttpPost]\n    public ActionResult Add(object obj)\n    {\n        if (ModelState.IsValid)\n        {\n                context.Entry(obj).State = System.Data.EntityState.Modified;\n\n                context.SaveChanges();               \n         }\n        return View(obj);\n    }\n</code></pre>\n\n<p>How to change it to add an exception to obj.property1 and obj.property2 for not being updated with this code?  </p>\n"},{"tags":["mysql","performance","entity-framework"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":5407,"score":3,"question_id":1233245,"title":"How to optimize Entity Framework Queries","body":"<p>I am using Linq-To-Entities to do a query which is returning only 947 rows but taking 18 seconds to run. I have done a \"ToTraceString\" to get the underlying sql out and ran the same thing directly on the database and get the same timing. </p>\n\n<p>I have used the tuning advisor and created a couple of indexes although with little impact.</p>\n\n<p>Looking at the query execution plan there are a couple of nested loops which are taking up 95% of the time but these are already working on the indexes?</p>\n\n<p>Does anyone have any ideas on how to force some optimisation into the EF query??</p>\n\n<p>EDIT: Supplying additional information</p>\n\n<p>A basic ER diagram with for the three tables is as follows:</p>\n\n<pre><code>People &gt;----People_Event_Link ----&lt; Events\nP_ID        P_ID                    E_ID\n            E_ID\n</code></pre>\n\n<p>The linq that I am running is designed to get all Events back for a particular Person (using the P_ID):</p>\n\n<pre><code>        var query = from ev in genesisContext.Events\n                    join pe in genesisContext.People_Event_Link\n                    on ev equals pe.Event\n                    where pe.P_ID == key\n                    select ev;\n        return query;\n</code></pre>\n\n<p>Here is the generated SQL (deep breath!):</p>\n\n<pre><code>SELECT \n1 AS [C1], \n[Extent1].[E_ID] AS [E_ID], \n[Extent1].[E_START_DATE] AS [E_START_DATE], \n[Extent1].[E_END_DATE] AS [E_END_DATE], \n[Extent1].[E_COMMENTS] AS [E_COMMENTS], \n[Extent1].[E_DATE_ADDED] AS [E_DATE_ADDED], \n[Extent1].[E_RECORDED_BY] AS [E_RECORDED_BY], \n[Extent1].[E_DATE_UPDATED] AS [E_DATE_UPDATED], \n[Extent1].[E_UPDATED_BY] AS [E_UPDATED_BY], \n[Extent1].[ET_ID] AS [ET_ID], \n[Extent1].[L_ID] AS [L_ID]\nFROM  [dbo].[Events] AS [Extent1]\nINNER JOIN [dbo].[People_Event_Link] AS [Extent2] ON  EXISTS (SELECT \n    1 AS [C1]\n    FROM    ( SELECT 1 AS X ) AS [SingleRowTable1]\n    LEFT OUTER JOIN  (SELECT \n    \t[Extent3].[E_ID] AS [E_ID]\n    \tFROM [dbo].[Events] AS [Extent3]\n    \tWHERE [Extent2].[E_ID] = [Extent3].[E_ID] ) AS [Project1] ON 1 = 1\n    LEFT OUTER JOIN  (SELECT \n    \t[Extent4].[E_ID] AS [E_ID]\n    \tFROM [dbo].[Events] AS [Extent4]\n    \tWHERE [Extent2].[E_ID] = [Extent4].[E_ID] ) AS [Project2] ON 1 = 1\n    WHERE ([Extent1].[E_ID] = [Project1].[E_ID]) OR (([Extent1].[E_ID] IS NULL) AND ([Project2].[E_ID] IS NULL))\n)\nWHERE [Extent2].[P_ID] = 291\n</code></pre>\n"},{"tags":["mysql","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":12690775,"title":"Why EF generating a sub-query for a simle query?","body":"<p>There is a simple Linq to EF:</p>\n\n<pre><code>var query = from p in _db.Posts\n            where p.BlogtId == blogId\n            select p;\n</code></pre>\n\n<p>It generates SQL in this form:</p>\n\n<pre><code>SELECT\n`Extent1`.`PostId`, \n`Extent1`.`BlogId`, \n...\nFROM `Posts` AS `Extent1`\n WHERE `Extent1`.`BlogId` = @p__linq__0\n</code></pre>\n\n<p>But when I add a order by to this query </p>\n\n<pre><code>var query = from p in _db.Posts\n            where p.BlogId == blogId\n            orderby p.PublishDate\n            select p;\n</code></pre>\n\n<p>It generates this query </p>\n\n<pre><code>SELECT\n`Project1`.`PostId`, \n`Project1`.`BlogId`, \n...\nFROM (SELECT\n`Extent1`.`PostId`, \n`Extent1`.`BlogId`, \n...\nFROM `Posts` AS `Extent1`\n WHERE `Extent1`.`BlogId` = @p__linq__0) AS `Project1`\n ORDER BY \n`Project1`.`PublishDate` ASC\n</code></pre>\n\n<p>Why this generate a sub-query?There is a performance problem for this query in MySQL. MySQL is trying to execute the inner query which pulls back all the records in the database and then tries to sort theme.</p>\n\n<p>I need a solution to generate below sql by linq</p>\n\n<pre><code>SELECT\n`Extent1`.`PostId`, \n...\nFROM `Posts` AS `Extent1`\n WHERE `Extent1`.`BlogId` = @p__linq__0\n ORDER BY \n`Extent1`.`PublishDate` ASC\n</code></pre>\n"},{"tags":["c#","database","visual-studio-2010","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":12975374,"title":"Code First with the Entity Framework throws a DbUpdateException when saving","body":"<p>I am trying to create my first database in a Visual Studio C# project and add an entity to this database. I have not yet managed to do so. When trying, I will get a <code>DbUpdateException</code> when calling <code>SaveChanges()</code> on the <code>DbContext</code>.</p>\n\n<p>I am trying to save the following entity:</p>\n\n<pre><code>public class TVSeriesReference : Reference\n{\n}\n</code></pre>\n\n<p><code>TVSeriesReference</code> does nothing but inherit <code>Reference</code>:</p>\n\n<pre><code>public class Reference\n{\n    /// &lt;summary&gt;\n    /// ID of the reference.\n    /// &lt;/summary&gt;\n    public int Id { get; set;  }\n\n    /// &lt;summary&gt;\n    /// Reference to the element in theTVDB.\n    /// &lt;/summary&gt;\n    public int TheTVDBId { get; set; }\n\n    /// &lt;summary&gt;\n    /// Whether or not the reference has been marked as watched.\n    /// &lt;/summary&gt;\n    public bool IsWatched { get; set; }\n}\n</code></pre>\n\n<p>I am using the following context:</p>\n\n<pre><code>public class Library : DbContext\n{\n    /// &lt;summary&gt;\n    /// Constructor using the base constructor.\n    /// This constructor names the database \"Library\".\n    /// &lt;/summary&gt;\n    public Library() : base(\"Library\")\n    {\n    }\n\n    /// &lt;summary&gt;\n    /// Set of TVSeriesReferences stored in the database.\n    /// &lt;/summary&gt;\n    public DbSet&lt;TVSeriesReference&gt; TVSeriesReferences { get; set; }\n\n    /// &lt;summary&gt;\n    /// Set of SeasonReferences stored in the database.\n    /// &lt;/summary&gt;\n    public DbSet&lt;SeasonReference&gt; SeasonReferences { get; set; }\n\n    /// &lt;summary&gt;\n    /// Set of EpisodeReferences stored in the database.\n    /// &lt;/summary&gt;\n    public DbSet&lt;EpisodeReference&gt; EpisodeReferences { get; set; }\n}\n</code></pre>\n\n<p>And this is how I try to create and save the entity to the database.</p>\n\n<pre><code>using (var db = new Library())\n{\n    var reference = new TVSeriesReference\n    {\n        Id = 2,\n        TheTVDBId = 1,\n        IsWatched = true\n     };\n\n     db.TVSeriesReferences.Add(reference);\n\n     try\n     {\n         db.SaveChanges();\n     }\n     catch (DbUpdateException e)\n     {\n         Debug.WriteLine(\"\\n\\n*** {0}\\n\\n\", e.InnerException);\n     }\n }\n</code></pre>\n\n<p><code>db.SaveChanges()</code> will throw the following exception:</p>\n\n<pre><code>System.Data.UpdateException: An error occurred while updating the entries. See the inner exception for details. ---&gt; System.Data.SqlClient.SqlException: Invalid object name 'dbo.TVSeriesReferences'.\n   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)\n   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean&amp; dataReady)\n   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()\n   at System.Data.SqlClient.SqlDataReader.get_MetaData()\n   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task&amp; task, Boolean asyncWrite)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, TaskCompletionSource`1 completion, Int32 timeout, Task&amp; task, Boolean asyncWrite)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\n   at System.Data.Common.DbCommand.ExecuteReader(CommandBehavior behavior)\n   at System.Data.Mapping.Update.Internal.DynamicUpdateCommand.Execute(UpdateTranslator translator, EntityConnection connection, Dictionary`2 identifierValues, List`1 generatedValues)\n   at System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager stateManager, IEntityAdapter adapter)\n   --- End of inner exception stack trace ---\n   at System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager stateManager, IEntityAdapter adapter)\n   at System.Data.EntityClient.EntityAdapter.Update(IEntityStateManager entityCache)\n   at System.Data.Objects.ObjectContext.SaveChanges(SaveOptions options)\n   at System.Data.Entity.Internal.InternalContext.SaveChanges()\n</code></pre>\n\n<p>I have been tearing my hair out for hours and hours now and I can't figure out what I am doing wrong. It seems that the tables (or maybe the entire database?) is not being created.\nIs there something I should have set up or have installed before this will work? I have installed NuGet and through that the Entity Framework.</p>\n\n<p>Is there anyone who can help me get this to work?</p>\n\n<p><strong>UPDATE</strong>: ConnectionStrings in <code>app.config</code></p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;connectionStrings&gt;\n    &lt;add name=\"Library\"\n         connectionString=\"Data Source=.\\SQLEXPRESS\"\n         providerName=\"System.Data.SqlServerCe.4.0\"/&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":5,"favorite_count":5,"up_vote_count":16,"down_vote_count":0,"view_count":7647,"score":16,"question_id":1131908,"title":"Calculated properties in Entity Framework","body":"<p>Suppose I have an employee object with the following properties:</p>\n\n<p>Name - string\nHours - single\nWage - single</p>\n\n<p>I want to add a property, Salary, which equals Hours * Wage. In an ordinary business object, I would simply code that up in the property, but this would presumably wiped out if the class needed to be regenerated.</p>\n\n<p>Is there an EF standard way to implement this without going through the trouble of mapping it to a database entity?</p>\n"},{"tags":["entity-framework","design","inheritance","tph"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12953428,"title":"Conditional Mapping in Entity Framework - OR operation with TPH","body":"<p>We have an entity like <code>Vehicle</code> and three derived entities such as <code>Car</code>, <code>Motorbike</code> and <code>Bicycle</code>.\nThis inheritance hierarchy is implemented with <strong>TPH</strong>.</p>\n\n<p>Here are entity mapping conditions:</p>\n\n<ul>\n<li><code>__disc__ = car</code> for Car</li>\n<li><code>__disc__ = motorbike</code> for Motorbike</li>\n<li><p><code>__disc__ = bicycle</code> for Bicycle</p>\n\n<p><em><strong>How can I</em></strong> derive another child from <code>Vehicle</code> like <code>MotorVehicle</code> with following mapping condition:</p></li>\n<li><p><code>__disc__ = car OR motorbike</code> for MotorVehicle</p></li>\n</ul>\n\n<p>I'd view in Database like this when I had this structure with <strong>TPT</strong>:</p>\n\n<pre><code>SELECT    Id\nFROM      Vehicles\nWHERE     (__Disc__ = N'car') OR (__Disc__ = N'motorbike')\n</code></pre>\n\n<p>I think this view is not required with TPH.</p>\n\n<p><em><strong>Please note that</em></strong> I can not change the inheritance like this: Vehicle&lt;-- MotorVehicle&lt;-- Car. Don't think about injecting the motor vehicles as the parent of car and other children because Car and Motorbike and Bicycle are already exists. I just want to assign some business to all motor vehicles.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12977961,"title":"System.ApplicationException","body":"<p>I am trying to rum my application and I am getting the following error as :\nSystem.Web.HttpUnhandledException: Exception of type 'System.Web.HttpUnhandledException' was thrown. </p>\n\n<p>The exception is thrown near the ** line of code:</p>\n\n<pre><code>public void LoadFromEntity(bool editable, string TabKey)\n    {\n        //Getting the FormMaster collection\n        **FormTemplate formTemplate = PolicyClassCollection.CachedPolicyClasses.FindBy((int)EnumPolicyClasses.PNI).FormTemplateCo**llection.Find(ft =&gt; ft.PolicyClassId == Utility.GetCurrentPolicyClassId() &amp;&amp; ft.DocumentType.DocumentTypeId == (int)EnumDocumentTypes.Coverage_Summary &amp;&amp; ft.PolicyTypeId == Utility.GetCurrentAccount().CurrentRisk.PolicyTypeId);\n\n        if (formTemplate != null)\n        {\n            //Set context string with current option number\n            this._Account.CurrentRisk.FormContextData = this.OptionNum.ToString();\n\n            //getting FormMasterID\n            Guid vsDatabaseId = formTemplate.FormFilingHistoryId;\n            string accountXmlString = this._Account.ToXML();\n\n            //Setting the parameters in PDFServiceParms class that are to be used in \"PDFService.aspx\" page.\n            PDFServiceParms pdfParams = new PDFServiceParms(FORM_MODE_EDIT, vsDatabaseId.ToString(), Model.AppConstants.FORM_TYPE_SELECTED_FORM, accountXmlString);\n\n            //Saving the parameters in the session. PDFService.aspx page reads the parameters from the session. Session key is passed in the \n            //query string when calling the PDFService.aspx page.\n            Session[AppConstants.SK_SUMMARY_PDF_PARAMS] = pdfParams;\n\n            //Setting the iFrame's source to PDFService.aspx page. The PDF document generated in this page is displayed in the iFrame.\n            this.iframePdf.Attributes[\"src\"] = ResolveClientUrl(AppConstants.PAGE_NAME_PDFSERVICE) + \"?datakey=\" + AppConstants.SK_SUMMARY_PDF_PARAMS;\n        }\n        else\n            throw new ApplicationException(\"FormMaster not found for PolicyClass = \" + Utility.GetCurrentPolicyClassId().ToString() + \" and DocumentType = \" + ((int)EnumDocumentTypes.Coverage_Summary).ToString());\n    }\n</code></pre>\n\n<p><strong>Exception thrown:</strong></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>System.Web.HttpUnhandledException: Exception of type 'System.Web.HttpUnhandledException' was thrown. ---&gt; System.ApplicationException: FormMaster not found for PolicyClass = 2 and DocumentType = 27\n   at PNI_SqbpeCovInfoPNISummary.LoadFromEntity(Boolean editable, String TabKey) in C:\\TFS\\Navigate Development\\NavigateWebApp\\PNI\\SqbpeCovInfoPNISummary.aspx.cs:line 95\n   at SQBPECoverageInformationMasterPNI.LoadFromEntity() in C:\\TFS\\Navigate Development\\NavigateWebApp\\PNI\\SQBPECoverageInformationMasterPNI.master.cs:line 188\n   at SQBPE.Page_Load(Object sender, EventArgs e) in C:\\TFS\\Navigate Development\\NavigateWebApp\\SQBPE.master.cs:line 55\n   at System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e)\n   at System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e)\n   at System.Web.UI.Control.OnLoad(EventArgs e)\n   at System.Web.UI.Control.LoadRecursive()\n   at System.Web.UI.Control.LoadRecursive()\n   at System.Web.UI.Control.LoadRecursive()\n   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)\n   --- End of inner exception stack trace ---\n   at System.Web.UI.Page.HandleError(Exception e)\n   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)\n   at System.Web.UI.Page.ProcessRequest(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)\n   at System.Web.UI.Page.ProcessRequest()\n   at System.Web.UI.Page.ProcessRequest(HttpContext context)\n   at ASP.pni_sqbpecovinfopnisummary_aspx.ProcessRequest(HttpContext context) in c:\\Windows\\Microsoft.NET\\Framework64\\v2.0.50727\\Temporary ASP.NET Files\\navigatewebapp\\253cae21\\57ec5e1d\\App_Web_sqbpecovinfopnisummary.aspx.41d7eb59.1z9y4p0a.0.cs:line 0\n   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()\n   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously)\n</code></pre>\n\n<p>can some one please let me know what need to be done for this.</p>\n"},{"tags":["entity-framework","ef-code-first","code-first","table-per-hierarchy","table-per-subclass"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12866227,"title":"Code First - Mapping when the Discriminator IS NULL or NOT NULL","body":"<p>I want to use TPH Inheritance in EF5 Code First. I want to base it on whether a column in the database is null or not.</p>\n\n<p>I found this link indicating it was not possible in EF4. <a href=\"http://stackoverflow.com/questions/5019717/entity-framework-4-tph-inheritance-in-features-ctp5-code-first-with-is-null\">Entity Framework 4 - TPH Inheritance in Features CTP5 (code first) with &quot;IS NULL&quot; discriminator</a></p>\n\n<p>Has this been fixed in EF5? If so, what is the syntax?</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","asp.net-mvc-4","asp.net-web-api"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12978053,"title":"Should I detach entity from EF context when exposed it through Web API","body":"<p>I am using EF5 code-first approach and I am just wondering should I detach entity from EF context when exposed it through the Web API?</p>\n\n<p>Let's say I have API action method</p>\n\n<pre><code>[HttpGet]\npublic HttpResponseMessage Get(int id)\n{\n    var user = _userRepository.GetById(id);\n\n    if (user != null)\n    {\n        // detach here???\n        _userRepository.Detach(user);\n\n        return Request.CreateResponse(HttpStatusCode.Found, user);\n    }\n\n    return Request.CreateErrorResponse(HttpStatusCode.NotFound, string.Format(\"No user with id={0} is found\", id));\n}\n</code></pre>\n\n<p>Actually what are the best practices for that? Should I create the projection of the entity and then exposed it?</p>\n"},{"tags":["c#","linq","entity-framework","reflection"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":12958278,"title":"How do I find out if an enum value is used at Runtime?","body":"<p>We are using a quasi dynamic method to create enums from sql lookup tables using t4 templates.  The template generates an enum for every table that conforms to the lookup patter.  Several of these enums are not being used in code, but any could be.</p>\n\n<p>This has been fine and dandy, but now we have been asked to create a lookup management interface so that users can add new values, edit descriptions, etc.</p>\n\n<p>They don't want to modify any items that are currently being used in code as an enum value, so is there a simple (or not so simple) way to query our assemblies to find out if an enum value is used?</p>\n\n<p>We have a lot of code similar to this made-up example:</p>\n\n<pre><code>public Role GetAdminRole\n{\n  using (myContext ctx = new myContext()\n  {\n    return ctx.Roles.Where(i=&gt; i.RoleId == (int)RoleEnum.Admin).SingleOrDefault();;\n  }\n}\n</code></pre>\n\n<p>Is there a way to use the Type.FindMembers() and build a filter that can query the internals of a method?</p>\n\n<p>I've looked at the <code>System.Reflection.Emit</code> namespace, which seemed promising based on the EnumBuilder class, but couldn't figure out how to hook up a builder to an existing assembly.  The <code>System.Diagnostics.CodeAnalysis</code> namespace sounds interesting, but it only contains two attributes (for suppressing warnings and excluding code from coverage).</p>\n\n<p>EDIT:  While poking through ILSpy I discovered that I knew, but didn't put together, that enum values in methods get converted to their integer value when used in the above manner when compiled.</p>\n"},{"tags":["c#","entity-framework","persistence","sql-server-express"],"answer_count":5,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":2202,"score":7,"question_id":875995,"title":"Entity Framework won't persist data in SQL Express (MDF)","body":"<p>I'm going crazy about this issue because I can't see what I'm doing wrong.</p>\n\n<p>I was developing an application using Entity Framework and storing data in a .mdf database. My code can read the data, apparently it can save too, but only apparently. It get no erros, while the program is running it act like the data was saved, I can for example save an object, dispose the context, create a new one, and then when I search my object it's there! But when I query the database to see the stored data there's nothing there. If I close the app and run it again, all data is gone. Here's a example code I wrote just to test:</p>\n\n<pre><code>        using (DatabaseEntities e = new DatabaseEntities())\n        {\n            for (int i = 0; i &lt; 50; i++)\n            {\n                User u = new User();\n                u.Nome = \"User\" + i.ToString();\n                e.AddToUser(u);\n            }\n            int c = e.SaveChanges(true);\n\n            List&lt;User&gt; us = e.User.Where&lt;User&gt;(x =&gt; x.ID &lt; 50).ToList&lt;User&gt;();\n\n            foreach (User u in us)\n                Console.WriteLine(\"ID: \" + u.ID + \" Hello from \" + u.Nome);\n\n            Console.ReadKey();\n        }\n</code></pre>\n\n<p>When I run this I get the 50 outputs, if I look the content of the c variable in the debug, there's 50 changes, everythings seems to be fine, but when I start my query browser and look in the content of my MDF database, there's nothing there.</p>\n\n<p>Probably it's something very simple but I can't see what it is, I need your help.</p>\n"},{"tags":["linq","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12974312,"title":"Entity Framework model.edmx and many to many relationships","body":"<p>In the database I have 3 tables, User, Group and a lookup table UserGroup which contains UserID and GroupId.</p>\n\n<p>I create a model.edmx and this allows me to:\nvar users = context.User\nvar groups = context.Group\nbut does not create an object for context.UserGroup.</p>\n\n<p>what is the syntax for getting all the users in a group, and all the groups that a user belongs to?</p>\n\n<pre><code>var results = from groups in db.Groups.Where(t =&gt; t.Users(u =&gt; u.UserID ==1))\nselect groups;\n</code></pre>\n"},{"tags":["wcf","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":106,"score":1,"question_id":12950145,"title":"WCF DataContractSerializer","body":"<p>I am getting the following error when trying to return a \nQuestionnaire object to the client. I added the KnowType[typeof(...)] in the Data Contract as suggested, but it still doesn't work.  Not knowing which type is unknown to the Serializer, I just threw in all classes that are in the EF model.  Can someone help?  Thanks.</p>\n\n<p>Here is the Service Contract</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Runtime.Serialization;\nusing System.ServiceModel;\nusing System.ServiceModel.Web;\nusing System.Text;\nusing QuestionnaireWcfServiceApp.Models;\n\nnamespace QuestionnaireWcfService\n{\n    [ServiceContract]\n    public interface IQuestionnaireService\n    {\n        [OperationContract]\n        QuestionnaireContract GetQuestionnaire(string questionnaireName);\n\n        [OperationContract]\n        QuestionChain LoadQuestion(int questionnaireID, int? questionID, int? userResponse);\n    }\n\n    [DataContract]\n    [KnownType(typeof(Questionnaire))]\n    [KnownType(typeof(Question))]\n    [KnownType(typeof(Choice))]\n    [KnownType(typeof(Decision))]\n    [KnownType(typeof(QuestionFlow))]\n    public class QuestionChain\n    {\n        [DataMember]\n        public Question Question { get; set; }\n\n        [DataMember]\n        public int? Decision {get;set;}\n    }\n\n    [DataContract]\n    [KnownType(typeof(Questionnaire))]\n    [KnownType(typeof(Question))]\n    [KnownType(typeof(Choice))]\n    [KnownType(typeof(Decision))]\n    [KnownType(typeof(QuestionFlow))]\n    public class QuestionnaireContract\n    {\n        [DataMember]\n        public Questionnaire Questionnaire { get; set; }\n    }\n}\n</code></pre>\n\n<p>Here is the Service.</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Runtime.Serialization;\nusing System.ServiceModel;\nusing System.ServiceModel.Web;\nusing System.Text;\nusing QuestionnaireWcfServiceApp.Models;\n\nnamespace QuestionnaireWcfService\n{\n    public class QuestionnaireService : IQuestionnaireService\n    {\n        QuestionnaireWcfServiceApp.Models.QuestionnaireEntities db = new QuestionnaireEntities();\n\n        public QuestionnaireContract GetQuestionnaire(string questionnaireName)\n        {\n            QuestionnaireContract questionnaireContract = new QuestionnaireContract();\n            if (!string.IsNullOrEmpty(questionnaireName))\n            {\n                Questionnaire thisQuestionnaire = (from q in db.Questionnaires where q.Name.Equals(questionnaireName) select q).FirstOrDefault();\n                if (thisQuestionnaire == null)\n                    throw new ArgumentNullException(\"Questionnaire ID is not found.\");\n                else\n                {\n                    questionnaireContract.Questionnaire = thisQuestionnaire;\n                    return questionnaireContract;\n                }\n            }\n            else\n                throw new ArgumentException(\"Questionnaire name is not specified.\");\n        }\n\n        public QuestionChain LoadQuestion(int questionnaireID, int? currentQuestionID, int? userResponse)\n        {\n            QuestionChain qc = new QuestionChain();\n            QuestionFlow thisFlow = null;\n            Question nextQuestion = null;           \n            Questionnaire thisQuestionnaire = (from q in db.Questionnaires where q.QuestionnaireId == questionnaireID select q).FirstOrDefault();\n\n            if (thisQuestionnaire == null)\n                throw new ArgumentNullException(\"Questionnaire ID is not found\");   //InvalidOperationException;\n\n            if (currentQuestionID.HasValue)\n            {\n                //QuestionID should never be changed after setup.  Change the QuestionText around the QuestionID\n                Question thisQuestion = thisQuestionnaire.Questions.Where(q =&gt; q.PKey.Equals(currentQuestionID)).FirstOrDefault();\n                if (thisQuestion == null)\n                    throw new ArgumentNullException(\"Question ID is not found\");\n                else\n                {\n                    if (userResponse.HasValue)\n                    {\n                        thisFlow = thisQuestion.QuestionFlows.First(f =&gt; f.QuestionId.Equals(currentQuestionID) &amp;&amp; f.ChoiceId.Equals(userResponse));\n                        if (thisFlow.Question1 != null)\n                        {\n                            nextQuestion = thisFlow.Question1;\n                            qc.Question = nextQuestion;\n                        }\n                        else\n                        {\n                            qc.Question = null;\n                            qc.Decision = thisFlow.Decision.Value;\n                        }\n                    }\n                    else\n                    {\n                        //can't happen. when reaches here, a userResponse must not be null\n                    }\n                }\n            }           \n            else\n            {\n                //default to question 1\n                nextQuestion = thisQuestionnaire.Questions.First(q =&gt; q.QuestionId.Equals(1));\n                if (nextQuestion == null)\n                    throw new ArgumentNullException(\"Question ID\");\n                else\n                    qc.Question = nextQuestion;\n            }\n            return qc;\n        }\n    }\n}\n</code></pre>\n\n<p>This is the exception in the Windows Application Log.</p>\n\n<pre><code>Exception: System.ServiceModel.CommunicationException: There was an error while trying to serialize parameter http://tempuri.org/:GetQuestionnaireResult. The InnerException message was 'Type System.Data.Entity.DynamicProxies.Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342' \nwith data contract name 'Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342:\nhttp://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies' \nis not expected. Consider using a DataContractResolver or add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.'.  Please see InnerException for more details. ---&gt; System.Runtime.Serialization.SerializationException: Type 'System.Data.Entity.DynamicProxies.Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342' with data contract name 'Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342:http://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies' is not expected. Consider using a DataContractResolver or add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.\n           at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeAndVerifyType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, Boolean verifyKnownType, RuntimeTypeHandle declaredTypeHandle, Type declaredType)\n           at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithXsiTypeAtTopLevel(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle originalDeclaredTypeHandle, Type graphType)\n           at System.Runtime.Serialization.DataContractSerializer.InternalWriteObjectContent(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.DataContractSerializer.InternalWriteObject(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.XmlObjectSerializer.WriteObjectHandleExceptions(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.XmlObjectSerializer.WriteObject(XmlDictionaryWriter writer, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameterPart(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           --- End of inner exception stack trace ---\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameterPart(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameter(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeBody(XmlDictionaryWriter writer, MessageVersion version, String action, MessageDescription messageDescription, Object returnValue, Object[] parameters, Boolean isRequest)\n           at System.ServiceModel.Dispatcher.OperationFormatter.SerializeBodyContents(XmlDictionaryWriter writer, MessageVersion version, Object[] parameters, Object returnValue, Boolean isRequest)\n           at System.ServiceModel.Dispatcher.OperationFormatter.OperationFormatterMessage.OperationFormatterBodyWriter.OnWriteBodyContents(XmlDictionaryWriter writer)\n           at System.ServiceModel.Channels.BodyWriterMessage.OnBodyToString(XmlDictionaryWriter writer)\n           at System.ServiceModel.Channels.Message.ToString(XmlDictionaryWriter writer)\n           at System.ServiceModel.Diagnostics.MessageLogTraceRecord.WriteTo(XmlWriter writer)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogInternal(MessageLogTraceRecord record)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogMessageImpl(Message&amp; message, XmlReader reader, MessageLoggingSource source)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogMessage(Message&amp; message, XmlReader reader, MessageLoggingSource source)\n         Process Name: WebDev.WebServer40\n         Process ID: 11620\n\n        Event Xml:\n        &lt;Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\"&gt;\n          &lt;System&gt;\n            &lt;Provider Name=\"System.ServiceModel 4.0.0.0\" /&gt;\n            &lt;EventID Qualifiers=\"49154\"&gt;5&lt;/EventID&gt;\n            &lt;Level&gt;2&lt;/Level&gt;\n            &lt;Task&gt;7&lt;/Task&gt;\n            &lt;Keywords&gt;0x80000000000000&lt;/Keywords&gt;\n            &lt;TimeCreated SystemTime=\"2012-10-18T07:32:11.000000000Z\" /&gt;\n            &lt;EventRecordID&gt;36499&lt;/EventRecordID&gt;\n            &lt;Channel&gt;Application&lt;/Channel&gt;\n            &lt;Computer&gt;Jon-PC&lt;/Computer&gt;\n            &lt;Security UserID=\"S-1-5-21-334737869-2079735299-2176000493-1000\" /&gt;\n          &lt;/System&gt;\n          &lt;EventData&gt;\n            &lt;Data&gt;System.ServiceModel.CommunicationException: There was an error while trying to serialize parameter http://tempuri.org/:GetQuestionnaireResult. The InnerException message was 'Type 'System.Data.Entity.DynamicProxies.Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342' with data contract name 'Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342:http://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies' is not expected. Consider using a DataContractResolver or add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.'.  Please see InnerException for more details. ---&amp;gt; System.Runtime.Serialization.SerializationException: Type 'System.Data.Entity.DynamicProxies.Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342' with data contract name 'Questionnaire_EF00247BEFB9F733C947A4C3E57FD12709E91510AC0DA534D137ED75FCCAC342:http://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies' is not expected. Consider using a DataContractResolver or add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.\n           at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeAndVerifyType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, Boolean verifyKnownType, RuntimeTypeHandle declaredTypeHandle, Type declaredType)\n           at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithXsiTypeAtTopLevel(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle originalDeclaredTypeHandle, Type graphType)\n           at System.Runtime.Serialization.DataContractSerializer.InternalWriteObjectContent(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.DataContractSerializer.InternalWriteObject(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.XmlObjectSerializer.WriteObjectHandleExceptions(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n           at System.Runtime.Serialization.XmlObjectSerializer.WriteObject(XmlDictionaryWriter writer, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameterPart(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           --- End of inner exception stack trace ---\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameterPart(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameter(XmlDictionaryWriter writer, PartInfo part, Object graph)\n           at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeBody(XmlDictionaryWriter writer, MessageVersion version, String action, MessageDescription messageDescription, Object returnValue, Object[] parameters, Boolean isRequest)\n           at System.ServiceModel.Dispatcher.OperationFormatter.SerializeBodyContents(XmlDictionaryWriter writer, MessageVersion version, Object[] parameters, Object returnValue, Boolean isRequest)\n           at System.ServiceModel.Dispatcher.OperationFormatter.OperationFormatterMessage.OperationFormatterBodyWriter.OnWriteBodyContents(XmlDictionaryWriter writer)\n           at System.ServiceModel.Channels.BodyWriterMessage.OnBodyToString(XmlDictionaryWriter writer)\n           at System.ServiceModel.Channels.Message.ToString(XmlDictionaryWriter writer)\n           at System.ServiceModel.Diagnostics.MessageLogTraceRecord.WriteTo(XmlWriter writer)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogInternal(MessageLogTraceRecord record)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogMessageImpl(Message&amp;amp; message, XmlReader reader, MessageLoggingSource source)\n           at System.ServiceModel.Diagnostics.MessageLogger.LogMessage(Message&amp;amp; message, XmlReader reader, MessageLoggingSource source)&lt;/Data&gt;\n            &lt;Data&gt;WebDev.WebServer40&lt;/Data&gt;\n            &lt;Data&gt;11620&lt;/Data&gt;\n          &lt;/EventData&gt;\n        &lt;/Event&gt;\n</code></pre>\n"},{"tags":["entity-framework","asp.net-mvc-4","many-to-many","bidirectional","self-referencing"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":12971885,"title":"asp.net mvc bi-directional self-referencing many-to-many","body":"<p>I am having difficulty setting up bi-directional self-referencing many-to-many mapping using EF in ASP.NET MVC4</p>\n\n<p>I have:</p>\n\n<pre><code>modelBuilder.Entity&lt;Item&gt;()\n    .HasMany(i =&gt; i.ChildItems)\n    .WithMany()\n    .Map(m =&gt; m.MapLeftKey(\"ItemID\")\n        .MapRightKey(\"ChildItemId\")\n        .ToTable(\"ItemChildItems\"));\n</code></pre>\n\n<p>So I am able to query Item.ChildItems no problem.</p>\n\n<p>However, I also want Item.Parents</p>\n\n<p>I am sure there must be an obvious solution to this but I am missing it. I have tried creating another entity Parent : Item and a separate mapping. I have also tried operating with two mapping tables. Both these become messy and I haven't managed to make them work anyway.</p>\n\n<p>I don't require any payload in the relationship. </p>\n\n<p>Any help greatly appreciated!</p>\n"},{"tags":["c#","linq","entity-framework","lambda"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12972938,"title":"Update child page's column in Linq","body":"<p>Please see the following code:</p>\n\n<pre><code>public void UpdateChildPagesReWrittenUrl(int parentPageId)\n    {\n        var childPageList = db.PcPages.Where(m =&gt; m.ParentID == parentPageId);\n\n        if (childPageList.Count() &gt; 0)\n        {\n            foreach (var item in childPageList)\n            {\n                db.ExecuteNonQuery(string.Format(\"UPDATE pcPage SET Url = {0}/{1} WHERE PageID = {2}\",\n                    GetRootUrl(item.ParentID),\n                    hnUrlHelper.UrlSafe(item.PageName), item.PageID));\n                db.SaveChanges();\n            }\n        }\n\n    }\n</code></pre>\n\n<p>I trying to update all the child pages url when a parent page updates the page name itself. This code I thought it working. but not.  Anyone can advise better in better way  please ?</p>\n"},{"tags":["vb.net","entity-framework","mef","abstraction","composition"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":149,"score":0,"question_id":8244039,"title":"Sharing Entity Framework models with other projects using MEF","body":"<p>I am currently developing a Windows service and I am am looking to use MEF to compose all of the services components at run time. The data access module (project) is using Entity Framework 4.1 and a Domain Service Class to perform CRUD operations on the entity model.</p>\n\n<p>The problem I have is how to share the models outside the DAL project when composing the DAL into the worker class in the main project.</p>\n\n<p>For exmaple this is one of the methods in the DAL contract interface</p>\n\n<pre><code>Function GetInspectionFaults() As IQueryable(Of InspectionFault)\n</code></pre>\n\n<p>This interface is currently in the DAL project (not the shared/referenced project containing the other contract interfaces) as it needs references to the entity model for the POCO types.</p>\n\n<p>How do I shared these POCO types?</p>\n\n<p>Phil</p>\n"},{"tags":["asp.net-mvc","entity-framework","multi-select","html.listboxfor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12972300,"title":"MVC MultiSelect Control for Day of week","body":"<p>I have a ASP.NET MVC 4 project with EF and I have a table <em>Orders</em> with a field <em>ShipmentDay</em> varchar(7)/string where I want to save in the database in witch days of the week the order can be shipped : 1000100 for Monday and Friday.</p>\n\n<p>Right now I have a ListBox :</p>\n\n<pre><code>@Html.ListBoxFor(model =&gt; model.ShipmentDay, new MultiSelectList(ViewBag.ShipmentDay))\n\nList&lt;string&gt; lbSDay = new List&lt;string&gt;();\nZileLiv.Add(\"Monday\"); ...\n\npublic ActionResult Create()\n{\n    ViewBag.lbSDay = lbSDay ;\n    return View();\n}\n</code></pre>\n\n<p><strong>Q:</strong> How can I make a custom multiselect control to select the days of week ?</p>\n"},{"tags":["c#","entity-framework","design-patterns","ef-code-first","domain-driven-design"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":125,"score":2,"question_id":12940954,"title":"Where to put Created date and Created by in DDD?","body":"<p>I use Entity Framework and want to use DDD principles. However there are some information regarding the entities that is on the borderline between what is logging/persistance information and what is information about the domain objects.</p>\n\n<p>I my situation these are put in an abstract base class that all entities inherit from:</p>\n\n<pre><code> public abstract class BaseEntity: IBaseEntity\n{\n\n    /// &lt;summary&gt;\n    /// The unique identifier\n    /// &lt;/summary&gt;\n    public int Id { get; set; }\n\n    /// &lt;summary&gt;\n    /// The user that created this instance\n    /// &lt;/summary&gt;\n    public User CreatedBy { get; set; }\n\n    /// &lt;summary&gt;\n    /// The date and time the object was created\n    /// &lt;/summary&gt;\n    public DateTime CreatedDate { get; set; }\n\n    /// &lt;summary&gt;\n    /// Which user was the last one to change this object\n    /// &lt;/summary&gt;\n    public User LastChangedBy { get; set; }\n\n    /// &lt;summary&gt;\n    /// When was the object last changed\n    /// &lt;/summary&gt;\n    public DateTime LastChangedDate { get; set; }\n\n    /// &lt;summary&gt;\n    /// This is the status of the entity. See EntityStatus documentation for more information.\n    /// &lt;/summary&gt;\n    public EntityStatus EntityStatus { get; set; }\n\n    /// &lt;summary&gt;\n    /// Sets the default value for a new object\n    /// &lt;/summary&gt;\n    protected BaseEntity()\n    {\n        CreatedDate = DateTime.Now;\n        EntityStatus = EntityStatus.Active;\n        LastChangedDate = DateTime.Now;\n    }\n\n}\n</code></pre>\n\n<p>Now a Domain Object can't be instansiated without providing the date and time. . However I feel it is the wrong place to put it. I can argue both was really. Maybe it should not be mixerd with the domain at all?</p>\n\n<p>Since I'm using EF Code First it makes sense to put it there, or else I would need to create new classes that inherit from the base class in the DAL also, duplicating code and needing to map to both domain objects and MVC models which does seem more messy than the approach above.</p>\n\n<p><strong>The question(s):</strong></p>\n\n<p>Is it Ok to use DateTime.Now in the Domain model at all? Where do you put this kind of information using DDD and EF Code First? Should User to be set in the domain object or require it in the Business Layer?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I think jgauffin har the right answer here - but it is really quite a fundamental change. However, on my search for an alternate solution I almost had it solved with this. I used the ChangeTracker.Entries to find ut if an entity is added or modified and set the fields accordingly. This is done in my UnitOfWork Save() method.</p>\n\n<p>The problem is loading navigation properties, like User (DateTime is set correctly). It might be since the user is a property on the abstract base class the entity inherits from. I also don't like putting strings in there, however it might solve some simple scenarios for someone so I post the solution here:</p>\n\n<pre><code>        public void SaveChanges(User changedBy)\n    {\n        foreach (var entry in _context.ChangeTracker.Entries&lt;BaseEntity&gt;())\n        {\n            if (entry.State == EntityState.Added)\n            {\n                entry.Entity.CreatedDate = DateTime.Now;\n                entry.Entity.LastChangedDate = DateTime.Now;\n                entry.Entity.CreatedBy = changedBy;\n                entry.Entity.LastChangedBy = changedBy;\n            }\n            if (entry.State == EntityState.Modified)\n            {\n                entry.Entity.CreatedDate = entry.OriginalValues.GetValue&lt;DateTime(\"CreatedDate\");\n                entry.Entity.CreatedBy = entry.OriginalValues.GetValue&lt;User&gt;(\"CreatedBy\");\n                entry.Entity.LastChangedDate = DateTime.Now;\n                entry.Entity.LastChangedBy = changedBy;\n            }\n        }\n\n\n        _context.SaveChanges();\n    }\n</code></pre>\n"},{"tags":["c#","mvc","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":1778,"score":5,"question_id":7348663,"title":"C# Entity-Framework: How can I combine a .Find and .Include on a Model Object?","body":"<p>I'm doing the mvcmusicstore practice tutorial. I noticed something when creating the scaffold for the album manager (add delete edit).</p>\n\n<p>I want to write code elegantly, so i'm looking for the clean way to write this.</p>\n\n<p>FYI i'm making the store more generic:</p>\n\n<p>Albums = Items</p>\n\n<p>Genres = Categories</p>\n\n<p>Artist = Brand</p>\n\n<p>Here is how the index is retrieved (generated by MVC):</p>\n\n<pre><code>var items = db.Items.Include(i =&gt; i.Category).Include(i =&gt; i.Brand);\n</code></pre>\n\n<p>Here is how the item for delete is retrieved:</p>\n\n<pre><code>Item item = db.Items.Find(id);\n</code></pre>\n\n<p>The first one brings back all the items and populates the category and brand models inside the item model. The second one, doesn't populate the category and brand.</p>\n\n<p>How can i write the second one to do the find AND populate whats inside (preferably in 1 line)... theoretically - something like:</p>\n\n<pre><code>Item item = db.Items.Find(id).Include(i =&gt; i.Category).Include(i =&gt; i.Brand);\n</code></pre>\n"},{"tags":["c#","asp.net-mvc","entity-framework","entity-framework-4.1","html.listboxfor"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":313,"score":1,"question_id":8157572,"title":"Edit View with child entity selection listbox and HTTPPost difficulties","body":"<p>Good day, all</p>\n\n<p>I have a Search Edit view which is strongly typed to my Search model class seen below (simplified).\n<img src=\"http://i.stack.imgur.com/cifHN.png\" alt=\"Searches and Custodians\"></p>\n\n<p>I want to display the custodians that are attributed to the Search being edited in a listbox showing all Custodians, with the current ones selected.</p>\n\n<p>My controller's Get Edit action is thus:</p>\n\n<pre><code>public ActionResult Edit(int id, int searchListId = 0)\n{\n    if (searchListId != 0)\n    {\n        Session[\"CurrentSearchListID\"] = searchListId;  \n    }\n    ProjectContext mydb = db;\n    Search search = Search.Find(mydb, id);\n\n    IEnumerable&lt;SelectListItem&gt; selectedItems =\n        from c in Custodian.List(mydb)\n        select new SelectListItem\n        {\n            Selected = (search.Custodians.Contains(c)),\n            Text = c.CustodianName,\n            Value = c.ToString()\n        };\n\n    ViewBag.Custodians = selectedItems;\n    return View(search);\n}\n</code></pre>\n\n<p>And my Views listbox is thus:</p>\n\n<pre><code>        @{\n            //List&lt;Kiersted.Keps.BusinessObjects.Custodian&gt; Custodians = ViewBag.Custodians;\n            IEnumerable&lt;SelectListItem&gt; SelectedItems = ViewBag.Custodians;\n        }\n\n        @Html.ListBox(\"Custodians\", SelectedItems);\n</code></pre>\n\n<p>This produces a listbox with the Custodians depicted, but none are selected (I have confirmed that several of the SelectListItems accurately describe the custodian as selected.  I have tried using ListBoxFor and it produces the same thing when populated with a MultiSelectList.</p>\n\n<p>Finally I decided to just force it to do what I want, but this does not return selected Custodians on Submit.</p>\n\n<pre><code>&lt;select id=\"Custodians\" multiple=\"multiple\" name=\"Custodians\"&gt;\n@foreach (Kiersted.Keps.BusinessObjects.Custodian cust in Custodians)\n{\n    if (Model.Custodians.Contains(cust))\n    {\n    &lt;option value=\"@cust.CustodianID\" selected=\"selected\"&gt;@cust.CustodianName&lt;/option&gt;\n    }\n    else\n    {\n    &lt;option value=\"@cust.CustodianID\" &gt;@cust.CustodianName&lt;/option&gt;\n    }\n}\n&lt;/select&gt;\n</code></pre>\n\n<p>Anyone know how you are <strong>supposed</strong> to do this?</p>\n\n<p>Edits:</p>\n\n<h1>ListBoxFor example</h1>\n\n<p>OK so after fiddling around with it for a while longer, I have now gotten Custodians selected in the listbox that correspond to the Search Custodians.  Below is the view code:</p>\n\n<pre><code>&lt;div class=\"editor-field\"&gt;\n    @Html.ListBoxFor(model =&gt; model.Custodians, allCustodians.Select(cust =&gt; new SelectListItem {\n                           Text = cust.CustodianName,\n                           Value = cust.CustodianID.ToString(),\n                           Selected = true}), \n                           new { Multiple = \"multiple\" })\n&lt;/div&gt;\n</code></pre>\n\n<p>If I select several more custodians, how do I get them (or their corresponding values rather) back to the control upon submit?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12562712,"title":"Multiple context for undo/redo","body":"<p>I'm trying to create a procedure for undo/redo with entity framework.</p>\n\n<p>I thought of creating a class like this:</p>\n\n<pre><code>public class multiContext\n{\n    public int _id { get; set; }\n    public undoEntities _context { get; set; }\n}\n</code></pre>\n\n<p>and for each modification create a new multiContext</p>\n\n<pre><code>private void btnSendB_Click(object sender, RoutedEventArgs e)\n{\n     multiContext nContext = new multiContext { _id = multiContextManager.getEntityID(listEntities), _context = new undoEntities};\n     listEntities.Add(nContext);\n     foreach (TB1 item in gridA.SelectedItems)\n     {\n         item.Status = \"B\";\n\n         nContext._context.Entry(item).State = System.Data.EntityState.Modified;\n         nContext._context.SaveChanges();\n     }\n\n     refreshGrids();\n }\n</code></pre>\n\n<p>but the problem is that when i SaveChanges(), it change all the context in the list.</p>\n\n<p>how can I save only the actual.</p>\n\n<p>thanks in advance</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","transactions","dbcontext"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1218,"score":0,"question_id":8655643,"title":".NET MVC 3 Rollback in Dbcontext","body":"<p>in MVC 3 is it possible to rollback the database after calling DbContext.SaveChanges() ?</p>\n\n<p>My entities class:</p>\n\n<pre><code>public class BipEntities : DbContext\n{\n    public DbSet&lt;Page&gt; Pages { get; set; }\n    public DbSet&lt;ImageFile&gt; ImageFiles { get; set; }\n}\n</code></pre>\n\n<p>What I'm trying to do is insert a ImageFile record into the db, then by using the auto-incremented id as the image filename, save the image file into somewhere else. \nWhen System.IO fails, I would like to rollback the database.</p>\n\n<pre><code>BipEntities db = new BipEntities();\ndb.Database.Connection.Open();\nDbTransaction tranx = db.Database.Connection.BeginTransaction();\n\nImageFile img = new ImageFile { CreatedAt = DateTime.Now };\ndb.ImageFiles.Add(img);\ndb.SaveChanges();\n\nstring filename = \"img\" + img.Id.ToString() + \".png\";\ntry {\n    //Works on system IO to process file\n    tranx.Commit();\n\n} Catch ( Exception) {\n    tranx.Rollback();\n}\n\ndb.Database.Connection.Close();\n</code></pre>\n\n<p>However, the above code gives me this error message:</p>\n\n<pre><code>EntityConnection can only be constructed with a closed DbConnection.\n</code></pre>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12958963,"title":"One-to-One mapping issue in EF Code First","body":"<p>Consider this scenario:</p>\n\n<pre><code>public class House\n{\n    public string Name { get; set; }\n    public virtual Person Person1 { get; set; }\n    public virtual Person Person2 { get; set; }\n}\n\npublic class Person\n{\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public House House { get; set; }\n}\n\n// Relationships\nthis.HasOptional(t =&gt; t.Person1)\n    .WithRequired(t =&gt; t.House);\nthis.HasOptional(t =&gt; t.Person2)\n    .WithRequired(t =&gt; t.House);\n</code></pre>\n\n<p>When I try to insert an instance of House a MetaDataException is thrown: </p>\n\n<blockquote>\n  <p>Schema specified is not valid. Errors:  (36,6) : error 0040: Type\n  House_Person1 is not defined in namespace Company.Models (Alias=Self).</p>\n</blockquote>\n\n<p>After a little more hacking, figured that this works:</p>\n\n<pre><code>// Relationships\nthis.HasOptional(t =&gt; t.Person1)\n    .WithRequired();\nthis.HasOptional(t =&gt; t.Person2)\n    .WithRequired();\n</code></pre>\n\n<p>But then I won't have the Person.House property populated by EF. Can I emulate this behavior (shown below)?</p>\n\n<pre><code>    public virtual Person Person1\n    {\n        get\n        {\n            return _person1;\n        }\n        set\n        {\n            _person1 = value;\n            _person1.Haushalt = this;\n        }\n    }\n\n    public virtual Person Person2\n    {\n        get\n        {\n            return _person2;\n        }\n        set\n        {\n            _person2 = value;\n            _person2.Haushalt = this;\n        }\n    }\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":366,"score":1,"question_id":9836966,"title":"MVC 3 EF - Adding new record using existing data","body":"<p>I have a db with two tables Invoices and Customers. Customers PK is FK in the Invoices table. I have a Create view in which user fills in invoice data. On this form I have a @Html.DropDownList with SelectList populated with the names of already existing in the db customers. On the basis of user selection customer data fields are autopopulated with customer data from the database via partial view:</p>\n\n<pre><code>@using (Ajax.BeginForm(\"CustomerSelect\", \"Invoice\", new AjaxOptions{\n            HttpMethod = \"GET\",\n            InsertionMode = InsertionMode.Replace,\n            UpdateTargetId = \"CustomerFields\"}))\n</code></pre>\n\n<p>This works well, but when I create the Submit button, it creates a new instance of the cutomer in the database, even though it should use the id of one retrieved from the db. When the partial view is displayed on the Create view it displayes proper Customer ID:</p>\n\n<pre><code>&lt;div class=\"editor-label\"&gt;\n    @Html.LabelFor(model =&gt; model.Customer)\n\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Customer)\n        @Html.ValidationMessageFor(model =&gt; model.Customer)\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>But when I look inside the invoice object in the httppost of controler Create method it shows shows a different (new) Customer ID:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Create(Invoice invoice)\n{\n    if (ModelState.IsValid)\n    {\n        db.Invoices.Add(invoice); **//invoice.Customer.CustomerID == 1**\n        db.SaveChanges(); **//invoice.Customer.CustomerID changes to next free in the db == 7**\n        return RedirectToAction(\"Index\");\n    }\n\n   return View(invoice);\n}\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":58,"score":4,"question_id":12926412,"title":"How to implement single SQL transaction for multiple ObjectContexts in EF4","body":"<p>I have a fairly big database with tables created for different business modules.</p>\n\n<p>We decided to create different edmx-files for different modules respectively.</p>\n\n<p>However, how can I prevent the usage of MSDTC when trying to implement a TransactionScope for a logical action that will incur writing to multiple tables in different edmx? Again, the underlying database is the same, I wouldn't want to use MSDTC for this scenario.</p>\n\n<p>Is there any way to pass in an opened SQL connection with active transaction?</p>\n\n<p>Thanks for help in advance.</p>\n\n<p>Regards,\nWilliam</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12968163,"title":"Entity Framework foreign keys are not mapped when using stored procedure","body":"<p>I am using Entity Framework (4.1) code-first .. </p>\n\n<p>I have two entity model classes :</p>\n\n<pre><code>public partial class PRODUCTS\n{\n    [Key]\n    public int PRODUCTS_ID { get; set; }\n\n    public string PRODUCTNAME { get; set; }\n\n    [ForeignKey(\"PACKINGTYPEID\")]\n    public virtual PACKINGTYPE PACKINGTYPE { get; set; }\n}\n\npublic partial class PACKINGTYPE \n{\npublic int ID {get;set;}\npublic string Name{get;set;}\n}\n</code></pre>\n\n<p>The product table has a foreign key referencing  the packing type table in the database.\nThe issue is that when I select the entity using linq </p>\n\n<pre><code>datacontext.PRODUCTS.where(p =&gt; p.PRODUCTS_ID == 1) \n</code></pre>\n\n<p>I get the corresponding <code>PACKINGTYPE</code> object .</p>\n\n<p>I have also a stored procedure which returns the product entity and I run code like this:</p>\n\n<pre><code>Context.Database.SqlQuery&lt;PRODUCTS&gt;(\"select * from PRODUCTS\").AsQueryable();\n</code></pre>\n\n<p>I get the correct mapped product object but the foreign field <code>PACKINGTYPE</code> is always null when I select using the second method</p>\n\n<p>Is there any workaround?</p>\n"},{"tags":["asp.net-mvc","entity-framework","ado.net","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12954104,"title":"willcascadeondelete in .netMVC4 is not working","body":"<p>I am creating .net MVC4 application. i have two entitites named group and groupmembers. group has a one to many relations with groupmembers.\nHere are my classes</p>\n\n<pre><code>public class Group\n  { \n    public int GroupId{get;set;}\n    public virtual ICollection&lt;GroupMember&gt; Members { get; set; }\n  }\n\npublic class GroupMember\n{\n  public int GroupMemberId { get; set; }\n\n    public int GroupId { get; set; }\n    public virtual Group Group { get; set; }\n\n    }\n</code></pre>\n\n<p>on the model side i am using the code</p>\n\n<pre><code> modelBuilder.Entity&lt;GroupMember&gt;()\n          .HasRequired(e =&gt; e.Group)\n            .WithMany()\n            .HasForeignKey(e =&gt; e.GroupId)\n           .WillCascadeOnDelete();\n</code></pre>\n\n<p>My problem is while deleting the group the members of the group is not getting deleted.Can any one please give me a solution</p>\n"},{"tags":["c#",".net","json","entity-framework","subsonic"],"answer_count":5,"favorite_count":2,"up_vote_count":20,"down_vote_count":0,"view_count":20098,"score":20,"question_id":1153385,"title":"A circular reference was detected while serializing an object of type 'SubSonic.Schema .DatabaseColumn'","body":"<p>I am trying to do a simple JSON return but I am having issues I have the following below.</p>\n\n<pre><code>public JsonResult GetEventData()\n        {\n            var data = Event.Find(x =&gt; x.ID != 0);\n            return Json(data);\n        }\n</code></pre>\n\n<p>I get a HTTP 500 with the exception as shown in the title of this question. I also tried</p>\n\n<pre><code>var data = Event.All().ToList()\n</code></pre>\n\n<p>That gave the same problem.</p>\n\n<p>Is this a bug or my implementation?</p>\n"},{"tags":["c#","asp.net-mvc","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12966932,"title":"Getting vote counts for a Post using Linq","body":"<p>Here's my database schema:</p>\n\n<pre><code>create table Post\n(\n    PostId int primary key identity,\n    ImageUrl nvarchar(1024) not null,\n    [Description] nvarchar(256) not null,\n    UserId int foreign key references [User](UserId),\n    DateOfPost datetime not null,\n    Score int\n)\n\ncreate table Vote\n(\n    VoteId int primary key identity,\n    UserId int foreign key references [User](UserId),\n    PostId int foreign key references Post(PostId),\n    VoteDirection bit not null,\n    DateOfVote datetime not null\n)\n</code></pre>\n\n<p>Basically, I want to order the Posts by <code>[VoteDirection == true] - [VoteDirection == false]</code>. So it 20 people votes \"true\", and 5 vote \"false\", the temporary score used for ordering would be 15.</p>\n\n<p>Is there also a way to select a range of date using the DateOfVote parameter?</p>\n\n<p>Here's what I've tried:</p>\n\n<pre><code>    // www.foo.com/top/today\n    public ActionResult Today()\n    {\n        var posts = postRepository.FindAllPosts().Where(x =&gt; x.DateOfPost == DateTime.Today)\n                                                 .OrderByDescending(x =&gt; x.Votes.Where(c =&gt; c.VoteDirection == true) - x.Votes.Where(c =&gt; c.VoteDirection == false));\n        return View(posts);\n    }\n</code></pre>\n\n<p>I'm getting the error:</p>\n\n<blockquote>\n  <p>Error 2   Operator '-' cannot be applied to operands of type\n  'System.Collections.Generic.IEnumerable'\n  and\n  'System.Collections.Generic.IEnumerable'</p>\n</blockquote>\n\n<p>Which is understandable, they're both collections not actual integers. But it should illustrate what I'm trying to do. Any suggestions?</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12633015,"title":"How to Add Table Prefix In Entity Framework Code First Globally?","body":"<p>I want to add all tables in the database with a prefix like 'pe_', then the mapping between a class and a table will be like this: Category(pe_Category), Product(pe_Product), etc.</p>\n\n<p>I know that with one single map, i can do like this:</p>\n\n<pre><code>[Table(\"pe_Category\")]\npublic class Category\n{\n    public int CategoryId { get; set; }\n}\n</code></pre>\n\n<p>But I don't like it cause there maybe have hundreds of entities.</p>\n\n<p>So I'm finding a way to add the prefix globally, just like this:</p>\n\n<pre><code>public class Category\n{\n    public int CategoryId { get; set; }\n}\n\npublic class Product\n{\n    public int ProductId { get; set; }\n}\n\n// Global config, will affect all entities\ntable.Name = \"pe_\" + Class.TypeName ;\n</code></pre>\n\n<p>Anybody can help me?</p>\n"},{"tags":["entity-framework","ef-code-first","t4"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":84,"score":2,"question_id":12926365,"title":"EF4 Code First pre-generated view has different hash values in other machines","body":"<p>My pre-generated views for EF4 Code First using this <a href=\"http://visualstudiogallery.msdn.microsoft.com/ae7730ce-ddab-470f-8456-1b313cd2c44d\" rel=\"nofollow\">T4 template</a> does not work in the build server. I am not re-generating the view in the build server, just compile and run the MSTest. Error is thrown when the tests are ran:</p>\n\n<blockquote>\n  <p>System.Data.MappingException: The mapping and metadata information for\n  EntityContainer 'DB' no longer matches the information used to create\n  the pre-generated views</p>\n</blockquote>\n\n<p>I ran the same template in another machine and the hash values are different. I guess this is the reason why its it does not work in the build server. The hash values are different at runtime in other machines, hence the verification fails and throws the exception.</p>\n\n<p>Im using:</p>\n\n<ul>\n<li>VS 2010 Pro</li>\n<li>.Net Framework v4.0.30319</li>\n<li>Entity Framework v4.2 (Code First)</li>\n<li><a href=\"http://visualstudiogallery.msdn.microsoft.com/ae7730ce-ddab-470f-8456-1b313cd2c44d\" rel=\"nofollow\">EF CodeFirst View Generation T4 Template for C#</a> (v1.0.1) - slightly modified GetEdmxSchemaVersion to return the correct EntityFrameworkVersions version for my setup.</li>\n<li>using Class Library project template</li>\n</ul>\n\n<p>The tests that I am running connects to a SQL DB file that is checked in with the code.</p>\n\n<p>I have checked the build server and its using the same EF dll version and .Net Framework version.</p>\n\n<p>Any idea why the hash values are different?  </p>\n\n<p><strong>UPDATE:</strong>\nI've generated and compared two XML file from two dev machines using <em>EdmxWriter.WriteEdmx()</em>. </p>\n\n<p>Here is schema version (the same in both machine):</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;Edmx Version=\"2.0\" xmlns=\"http://schemas.microsoft.com/ado/2008/10/edmx\"&gt;\n</code></pre>\n\n<p>The obvious difference are the order some nodes in the XML files. Here is an example:</p>\n\n<p>Machine 1:</p>\n\n<pre><code>&lt;EntityType Name=\"PersonEntity\" BaseType=\"Self.Entity\" /&gt;\n&lt;EntityType Name=\"CompanyEntity\" BaseType=\"Self.Entity\" /&gt;\n</code></pre>\n\n<p>Machine 2:</p>\n\n<pre><code>&lt;EntityType Name=\"CompanyEntity\" BaseType=\"Self.Entity\" /&gt;\n&lt;EntityType Name=\"PersonEntity\" BaseType=\"Self.Entity\" /&gt;\n</code></pre>\n\n<p>Any idea why they are in different order?</p>\n\n<p><strong>UPDATE 2:</strong>\nThe Edmx (xml) from the build server is also different for the other 2 dev machines. Again, the order of some nodes are different. </p>\n\n<p>Machine 1 and build server both have System.Data.Entity.dll (same File and Product version -- <em>v4.0.30319.1</em>) in %windir%\\Microsoft.NET\\assembly\\GAC_MSIL\\System.Data.Entity\\v4.0_4.0.0.0__b77a5c561934e089.</p>\n\n<p><strong>UPDATE 3:</strong>\nI also looked at the version of System.Data.Entity.Design.dll. The T4 template references this assembly. Machine 1 has two copies of this dll ... in GAC (v4.0.30319.233) and in C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework.NETFramework\\v4.0 (v4.0.30319.1). This is also true in the build server and Machine 2. I wonder if hash validation function during runtime is using this dll as its not referenced in my project. If it does, which version is used. But then again, the hash validation is successful in Machine 1.</p>\n"},{"tags":["entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1792,"score":3,"question_id":5923543,"title":"Unable to create a constant value of type 'System.Object'. Only primitive types ('such as Int32, String, and Guid') are supported in this context","body":"<p>I'm using MVC and Entity Framework.  I've created a class in my model folder with this code below.  I keep getting the error message above with both queries below.  I know there is a known issue on referencing non-scalar variables, but I'm not sure how to implement a workaround:</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/bb896317.aspx#Y1442\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb896317.aspx#Y1442</a></p>\n\n<pre><code>private MovieLibraryDBEntities movieLibraryDBEntitiesContext;\n\npublic int getNumberOfEntriesReserved()\n{\n    return (from m in movieLibraryDBEntitiesContext.Movies\n            where m.CheckedOut.Equals(1)\n            select m).Count();\n\n    //return movieLibraryDBEntitiesContext.Movies\n    //  .Where(e =&gt; e.CheckedOut.Equals(1))\n    //  .Select (e =&gt; e.Title).Count();\n}\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12965571,"title":"Map 1 to1 relationship with Fluent EF","body":"<p>I was hoping this would be fairly straight forward but I haven't had much luck. The database I'm working with has a table for users and a table for tokens, they relate to one another with a 1 to 1 relationship with tokens being as I understand it the <em>principal</em>.</p>\n\n<pre><code>public class Token\n{\n    public int ID { get; set; }\n    public string Location { get; set; }\n\n    public virtual User Contact { get; set; }\n}\n\npublic class User\n{\n    public int ID { get; set; }\n    public int TokenID { get; set; }\n    public string Name { get; set; }\n\n    public virtual Token Token { get; set; }\n}\n</code></pre>\n\n<p>So every User has an associated Token which belongs to that User only, and there also also other Tokens that relate to other objects which I will be mapping as well in a similar fashion.</p>\n\n<p>So far I have tried below as well as some variations and it hasn't worked as expected, I keep getting incorrect locations for users as it seems to be using User.ID to map to Token.ID instead of using User.TokenID.</p>\n\n<pre><code>modelBuilder.Entity&lt;User&gt;()\n    .HasRequired(p =&gt; p.Token)\n    .WithOptional(p =&gt; p.Contact);\n</code></pre>\n\n<p>I'm thinking I'm missing actually specifying the columns to use to map? I'm just unsure where to go from here. </p>\n\n<p><strong>Edit</strong> Previously when mapping relationships that use the WithRequired() extension method I've then been able to specify HasForeignKey() afterwards but WithOptional() doesn't seem to have this functionality.</p>\n"},{"tags":["sql-server","sql-server-2008","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12965181,"title":"How to create generic column in database table?","body":"<p>I have a table with a large number of very specific columns which are mostly \"Strings\". I believe this hardcoding of names will give me grief later on when rules changes. I am investigating the option of using a second table where each row is a column from the master table which could each have a lookup key for its name.</p>\n\n<p>I know this may seem anti ER best practice, but it would be flexible. I could use views with subselects ie Select (SQL1), (SQL2) etc from Table1. Not sure if one can update a multitable view though in SQLServer. </p>\n\n<p>Thoughts on the above greatly appreciated.</p>\n\n<p>Thanks,</p>\n\n<p>Ed</p>\n"},{"tags":["entity-framework","sharepoint","sharepoint2010","impersonation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":206,"score":0,"question_id":8327505,"title":"EF + UnitOfWork + SharePoint RunWithElevatedPrivileges","body":"<p>In our SharePoint application we have used the UnitOfWork + Repository patterns together with Entity Framework. To avoid the usage of the passthrough authentication we have developed a piece of code that impersonate a single user before creating the <code>ObjectContext</code> instance in a similar way that is described in \"<a href=\"http://stackoverflow.com/q/1954944/431537\">Impersonating user with Entity Framework</a>\" on this site.</p>\n\n<p>The only difference between our code and the referred question is that, to do the impersonation, we are using <code>RunWithElevatedPrivileges</code> to impersonate the Application Pool identity as in the following sample.</p>\n\n<pre><code>SPSecurity.RunWithElevatedPrivileges(delegate() { \n    using (SPSite site = new SPSite(url)) {\n        _context = new MyDataContext(ConfigSingleton.GetInstance().ConnectionString);\n    }\n});\n</code></pre>\n\n<p>We have done this way because we expected that creating the <code>ObjectContext</code> after impersonation and, due to the fact that Repositories are receiving the impersonated <code>ObjectContext</code> would solve our requirement.</p>\n\n<p>Unfortunately it's not so easy. In fact we experienced that, even if the <code>ObjectContext</code> is created before and under impersonation circumstances, the real connection is made just before executing the query, and so <strong>does not use impersonation</strong>, which break our requirement.</p>\n\n<p>I have checked the <code>ObjectContext</code> class to see if there was any event through which we can inject the impersonation but unfortunately found nothing.</p>\n\n<p>Any help?</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-3"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1044,"score":0,"question_id":4650136,"title":"Performance reprogramming website in MVC3 with Entity Framework","body":"<p>At the moment I have a fairly big website with about 10k visitors a day.</p>\n\n<p>This is a community website with news/blogs/videos and a big forum. </p>\n\n<p>This all runs on a self made PHP5 application which performance faily well, has good performance. The database is a MySQL5.1 database.</p>\n\n<p>Now I am getting fedup with PHP and the loose typed framework, lack of namespacing and a proper MVC setup, so I am thinking of rewriting the site in MVC3 ASP.NET.</p>\n\n<p>Now I have experience with this, but not in the MVC framework yet, and I have a few questions about the performance, especially the Entity Framework:\nIs it even worth using the entity framework? Will it cost alot of overhead and performance degration? I am not sure yet if I should switch to MSSQL.</p>\n"},{"tags":["vb.net","entity-framework","mvc","web-api"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12964520,"title":"MVC4 Web Api not returning Entity Framework IEnumerable()","body":"<p>I have a simple table as follows mapped with Entity Framework. I am trying to return just a very basic call of IEnumerable(Of MyTableObject) however MVC API is just bombing out with error code 500. When I try to return a IEnumerable(Of String) and select just a single column it does the same.</p>\n\n<p><img src=\"http://i.stack.imgur.com/NXthz.png\" alt=\"Entity Framework Model\"></p>\n\n<p>I try to return this model with the following code.</p>\n\n<pre><code>' GET api/chatlog\nPublic Function GetValues() As IEnumerable(Of ChatLog)\n    Using mcEntity As New McEntities\n\n        Return mcEntity.ChatLogs.ToList()\n    End Using\nEnd Function\n</code></pre>\n\n<p>Unfortunate for me with the return data. I get nothing?</p>\n\n<p>Does MVC Web API not support passing objects from EF down the pipe or do I manually have to Serialize this into XML?</p>\n\n<p>Fiddler throws \"HTTP/1.1 500 Internal Server Error\"</p>\n"},{"tags":["entity-framework","asp.net-mvc-4","visual-studio-2012","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12949409,"title":"How to write an Edit Action","body":"<p>I am trying to come up with an edit action. See below for what i have so far.</p>\n\n<p><strong>ViewModel:</strong></p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel.DataAnnotations;\nusing System.Linq;\nusing System.Web;\nusing System.Web.Mvc;\n\nnamespace GlobalUnitedSC.WebUI.Models\n{\npublic sealed class CreateMensPlayerViewModel\n{\n    //Player profile starts here\n\n    [HiddenInput(DisplayValue=false)]\n    public int MensTeamId { get; set; }\n\n    [HiddenInput(DisplayValue = false)]\n    public int PlayerId { get; set; }\n\n    [Required]\n    public string Name { get; set; }\n\n    [DataType(DataType.Date)]\n    public DateTime? BirthDate { get; set; }\n\n    [Required]\n    public string Position { get; set; }\n\n    public int ShirtNumber { get; set; }\n\n    [DataType(DataType.Date)]\n    public DateTime? Joined { get; set; }\n\n    public string Country { get; set; }\n\n    [DataType(DataType.MultilineText)]\n    public string Description { get; set; }\n\n    public byte[] ImageData { get; set; }\n\n    [HiddenInput(DisplayValue = false)]\n    public string ImageMimeType { get; set; }\n\n    [DataType(DataType.EmailAddress)]\n    public string EmailAddress { get; set; }\n\n    [DataType(DataType.PhoneNumber)]\n    public string PhoneNumber { get; set; }\n\n    //Player Statistics starts here\n    public int Games { get; set; }\n    public int Goals { get; set; }\n    public int Assists { get; set; }\n    public int TotalShots { get; set; }\n    public int ShotsOnGoal { get; set; }\n    public int FoulsDrawn { get; set; }\n    public int FoulsCommitted { get; set; }\n    public int Saves { get; set; }\n    public int BlueCards { get; set; }\n    public int YellowCards { get; set; }\n    public int RedCards { get; set; }\n }\n}\n</code></pre>\n\n<p><strong>Create Actions:</strong></p>\n\n<pre><code>    [HttpGet]\n    public ActionResult Create(int mensTeamId)\n    {\n        new CreateMensPlayerViewModel {MensTeamId = mensTeamId};\n\n        return View();\n    }\n\n    [HttpPost]\n    public ActionResult Create(CreateMensPlayerViewModel viewModel, HttpPostedFileBase  image)\n    {\n        if (ModelState.IsValid)\n        {\n            var mensTeam = _dataSource.MensTeams.Single(t =&gt; t.Id == viewModel.MensTeamId);\n            var mensPlayer = new MensPlayer\n                                 {\n                                     Name = viewModel.Name,\n                                     BirthDate = viewModel.BirthDate,\n                                     Position = viewModel.Position,\n                                     ShirtNumber = viewModel.ShirtNumber,\n                                     Joined = viewModel.Joined,\n                                     Country = viewModel.Country,\n                                     Description = viewModel.Description,\n                                     EmailAddress = viewModel.EmailAddress,\n                                     PhoneNumber = viewModel.PhoneNumber,\n                                     Games = viewModel.Games,\n                                     Goals = viewModel.Goals,\n                                     Assists = viewModel.Assists,\n                                     TotalShots = viewModel.TotalShots,\n                                     ShotsOnGoal = viewModel.ShotsOnGoal,\n                                     FoulsDrawn = viewModel.FoulsDrawn,\n                                     FoulsCommitted = viewModel.FoulsCommitted,\n                                     Saves = viewModel.Saves,\n                                     BlueCards = viewModel.BlueCards,\n                                     YellowCards = viewModel.YellowCards,\n                                     RedCards = viewModel.RedCards\n                                 };\n\n            mensTeam.MensPlayers.Add(mensPlayer);\n\n            _dataSource.Save();\n            TempData[\"message\"] = string.Format(\"{0} has been saved\", mensPlayer.Name);\n\n            return RedirectToAction(\"detail\", \"MensTeam\", new {id =         viewModel.MensTeamId});\n        }\n\n        return View(viewModel); \n    }\n</code></pre>\n\n<p><strong>HttpGet Edit Action</strong></p>\n\n<pre><code>[HttpGet]\n    public ActionResult Edit (int id)\n    {\n        var mensPlayer = _dataSource.MensPlayers.FirstOrDefault(p =&gt; p.Id == id);\n\n        return View(mensPlayer);\n    }\n</code></pre>\n\n<p>Now could anyone please help me with the HttpPost Edit action, preferably one based on the model class mentioned above?</p>\n\n<p>I was hoping it has something to do with the line below, if this creates a new player, what could i write to edit that player?</p>\n\n<pre><code>var mensPlayer = new MensPlayer {}\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first","asp.net-mvc-4","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12962737,"title":"Edit Method in MVC4 and Visual Studio 2012","body":"<p>Could someone please help me with the question i posted late last night. I am still stuck with the edit method. Link below:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/12949409/how-to-write-an-edit-action/12949879#comment17556226_12949879\">Last night question</a></p>\n\n<p>In addition to what was posted, i have also tried:</p>\n\n<p>HttpPost Edit:</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Edit(MensPlayer mensPlayer)\n    {\n        if (ModelState.IsValid)\n        {\n            //Save Player\n            _dataSource.Entry(mensPlayer).State = EntityState.Modified;\n           _dataSource.Save();\n\n           TempData[\"message\"] = string.Format(\"{0} has been saved\", mensPlayer.Name);\n            return RedirectToAction(\"Detail\", \"MensPlayer\", new {id = mensPlayer.Id});\n        }\n        return View(mensPlayer);\n    }\n</code></pre>\n\n<p>The Issue with the above method is around <code>Entry(mensPlayer).State</code>, code will not build at .Entry() and i don't seem to know where this method is being inherited. Mind you, this is the technique used in MVC-Music-Store sample.</p>\n\n<p>I have also tried this technique from Pro ASP.NET MVC3 Framework book.</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Edit(MensPlayer mensPlayer)\n    {\n        if (ModelState.IsValid)\n        {\n            //Save Player\n           _dataSource.Save();\n\n           TempData[\"message\"] = string.Format(\"{0} has been saved\", mensPlayer.Name);\n            return RedirectToAction(\"Detail\", \"MensPlayer\", new {id = mensPlayer.Id});\n        }\n        return View(mensPlayer);\n    }\n</code></pre>\n\n<p>This technique builds but doesn't seem to save changes to the database.</p>\n\n<p>How can i make it work? What am i missing?</p>\n\n<p><strong>The entire source code is on GitHub if anyone needs to look at the entire solution.</strong></p>\n\n<p><a href=\"https://github.com/komengem/GlobalUnitedSC\" rel=\"nofollow\">GitHub</a></p>\n\n<p>With Slauma's help below i have now modified as follows:</p>\n\n<p>Added <code>void Update();</code> to IDataSource and added the following to the Db class</p>\n\n<pre><code> void IDataSource.Update()\n    {\n        Entry(MensPlayers).State = EntityState.Modified;\n    }\n</code></pre>\n\n<p>HttpPost Edit:</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Edit(MensPlayer mensPlayer)\n    {\n        if (ModelState.IsValid)\n        {\n            //Save Player\n            _dataSource.Update();\n           _dataSource.Save();\n\n           TempData[\"message\"] = string.Format(\"{0} has been saved\", mensPlayer.Name);\n            return RedirectToAction(\"Detail\", \"MensPlayer\", new {id = mensPlayer.Id});\n        }\n        return View(mensPlayer);\n    }\n</code></pre>\n\n<p>All builds but then i get this error\n<strong>The entity type DbSet`1 is not part of the model for the current context.</strong></p>\n\n<p>Which is believed to originate from:</p>\n\n<pre><code>void IDataSource.Update()\n    {\n        Entry(MensPlayers).State = EntityState.Modified;\n    }\n</code></pre>\n"},{"tags":["entity-framework","entity-sql","createquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12945259,"title":"Entity SQL vs CreateQuery where one works and the other errors for the same query","body":"<p>I can use following line of code to create a query that only returns objects of 'ActivityEntity' type....</p>\n\n<pre><code>var q = CreateObjectSet&lt;EntityBase&gt;(\"EntityBases\").OfType&lt;ActivityEntity&gt;()\n</code></pre>\n\n<p>.. and running the query works as expected. But I want to actually create a query using the Entity SQL syntax and hence tried to convert the above to the following code...</p>\n\n<pre><code>string query = \"SELECT it FROM OFTYPE(MyContext.EntityBases, MyNamespace.ActivityEntity) AS it\";\nvar q = context.CreateQuery&lt;DbDataRecord&gt;(query.ToString(), new ObjectParameter[] { });\n</code></pre>\n\n<p>...except this gives the following error...</p>\n\n<blockquote>\n  <p>Type 'MyNamespace.ActivityEntity' could not be found. Make sure that the required \n  schemas are loaded and that the namespaces are imported correctly.</p>\n</blockquote>\n\n<p>...both sets of code are inside the same C# file and so there is no way there is an issue with the namespace because the strongly typed version of code works just fine. Any ideas how to go about resolving this issue?</p>\n\n<p><strong>NOTE:</strong></p>\n\n<p>Not sure if this makes a difference but the Entity Framework is setup with Code Generation Strategy of None and then I have build my own classes for use. But I have marked them with the EdmEntityTypeAttribute attribute.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12944820,"title":"Is there a generic way to get EF to return new model data and associated model data after committing changes?","body":"<p>Given the following two models:</p>\n\n<pre><code>public class Card\n{\n    public int CardId { get; set; }\n\n    public Media Media { get; set; }\n}\n\npublic class Media\n{\n    public int MediaId { get; set; }\n\n    [Required]\n    public string FileName { get; set; }\n}\n</code></pre>\n\n<p>And the following controller method:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Create(Card card)\n{\n    db.Media.Attach(card.Media);\n\n    ModelState.Remove(\"Media.FileName\");\n\n    if (ModelState.IsValid)\n    {\n        db.Cards.Add(card);                \n        db.SaveChanges();\n    }\n\n    return JsonNetSerializedResult(card);\n}\n</code></pre>\n\n<p>I want to create a new Card, but associate it with an existing Media object. I POST to \"Controller/Create\" and include a \"Media.MediaId\" parameter that contains the ID of the existing Media record and let EF make the association.</p>\n\n<p>However, after SaveChanges() is called, the only property updated on the Card instance is the CardId. I also need to retrieve the Media.FileName and set that property on the Card instance.</p>\n\n<p>Is there a generic way to tell EF that I want return the updated Card data, and to also return the associated Media data commiting the data?</p>\n"},{"tags":["c#","asp.net","entity-framework","compiled-query"],"answer_count":5,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":1214,"score":9,"question_id":4932594,"title":"When should I use a CompiledQuery?","body":"<p>I have a table:</p>\n\n<pre><code>-- Tag\n\nID  | Name\n-----------\n1   | c#\n2   | linq\n3   | entity-framework\n</code></pre>\n\n<p>I have a class that will have the following methods:</p>\n\n<pre><code>IEnumerable&lt;Tag&gt; GetAll();\nIEnumerable&lt;Tag&gt; GetByName();\n</code></pre>\n\n<p>Should I use a compiled query in this case?</p>\n\n<pre><code>static readonly Func&lt;Entities, IEnumerable&lt;Tag&gt;&gt; AllTags =\n    CompiledQuery.Compile&lt;Entities, IEnumerable&lt;Tag&gt;&gt;\n    (\n        e =&gt; e.Tags\n    );\n</code></pre>\n\n<p>Then my <code>GetByName</code> method would be:</p>\n\n<pre><code>IEnumerable&lt;Tag&gt; GetByName(string name)\n{\n    using (var db = new Entities())\n    {\n        return AllTags(db).Where(t =&gt; t.Name.Contains(name)).ToList();\n    }\n}\n</code></pre>\n\n<p>Which generates a <code>SELECT ID, Name FROM Tag</code> and execute <code>Where</code> on the code. Or should I avoid <code>CompiledQuery</code> in this case?</p>\n\n<p>Basically I want to know when I should use compiled queries. Also, on a website they are compiled only once for the entire application?</p>\n"},{"tags":["entity-framework","asp.net-web-api","audit-logging","objectstatemanager"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12962127,"title":"Dealing with complex properties with Entity Framework's ChangeTracker","body":"<p>I'll try and be as descriptive as I can in this post. I've read a dozen or more SO questions that were peripherally related to my issue, but so far none have matched up with what's going on.</p>\n\n<p>So, for performing audit-logging on our database transactions (create, update, delete), our design uses an IAuditable interface, like so:</p>\n\n<pre><code>public interface IAuditable\n{\n    Guid AuditTargetId { get; set; }\n\n    int? ContextId1 { get; }\n    int? ContextId2 { get; }\n    int? ContextId3 { get; }\n}\n</code></pre>\n\n<p>The three contextual IDs are related to how the domain model is laid out, and as noted, some or all of them may be null, depending on the entity being audited (they're used for filtering purposes for when admins only want to see the audit logs for a specific scope of the application). Any model that needs to be audited upon a CUD action just needs to implement this interface.</p>\n\n<p>The way that the audit tables themselves are being populated is through an AuditableContext that sits between the base DbContext and our domain's context. It contains the audit table DbSets, and it overrides the SaveChanges method using the EF ChangeTracker, like so:</p>\n\n<pre><code>foreach (var entry in ChangeTracker.Entries&lt;IAuditable&gt;())\n{\n    if (entry.State != EntityState.Modified &amp;&amp; \n        entry.State != EntityState.Added &amp;&amp; \n        entry.State != EntityState.Deleted)\n    {\n        continue;\n    }\n\n    // Otherwise, make audit records!\n}\n\nbase.SaveChanges();\n</code></pre>\n\n<p>The \"make audit records\" process is a slightly-complex bit of code using reflection and other fun things to extract out fields that need to be audited (there are ways for auditable models to have some of their fields \"opt out\" of auditing) and all that.</p>\n\n<p>So that logic is all well and good. The issues comes when I have an auditable model like this:</p>\n\n<pre><code>public class Foo: Model, IAuditable\n{\n    public int FooId { get; set; }\n\n    // other fields, blah blah blah...\n\n    public virtual Bar Bar { get; set; }\n\n    #region IAuditable members\n\n    // most of the auditable members are just pulling from the right fields\n\n    public int? ContextId3\n    {\n        get { return Bar.BarId; }\n    }\n\n    #endregion\n}\n</code></pre>\n\n<p>As is pointed out, for the most part, those contextual audit fields are just standard properties from the models. But there are some cases, like here, where the context id needs to be pulled from a virtual complex property.</p>\n\n<p>This ends up resulting in a <code>NullReferenceException</code> when trying to get that property out from within the SaveChanges() method - it says that the virtual Bar property does not exist. I've read some about how ChangeTracker is built to allow lazy-loading of complex properties, but I can't find the syntax to get it right. The fields don't exist in the \"original values\" list, and the object state manager doesn't have those fields, I guess because they come from the interface and not the entities directly being audited.</p>\n\n<p>So does anyone know how to get around this weird issue? Can I just force eager-loading of the entire object, virtual properties included, instead of the lazy loading that is apparently being stubborn?</p>\n\n<p>Sorry for the long-ish post, I feel like this is a really specific problem and the detail is probably needed.</p>\n\n<p>TIA! :)</p>\n"},{"tags":["c#","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12867141,"title":"Editing T4 files to customize entity class names and output file names","body":"<p>I'm using Entity Framework Reverse Engineer Code First on an existing database. The classes are created properly but I need to change the entity names. I want to prefix every entity class with \"EpiFlex\". If a SQL table name is Users, the resulting entity should be EpiFlexUsers and the output file should be EpiFlexUsers.cs.</p>\n\n<p>Is there a tag of some sort that I can add to the beginning of the T4 files to have that prefix added automatically or do I have to painstakingly go through each file and put the prefix ahead of the auto generated code?</p>\n\n<p>Or maybe I'm totally missing the point. Is there another way to specify custom naming of the entities?</p>\n"},{"tags":[".net","entity-framework","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12960571,"title":"Entity Framework Error: Unable to find the requested .Net Framework Data Provider. It may not be installed","body":"<p>I have developed application in EntityFramework. Following is the connectionstring and connector's detail </p>\n\n<pre><code>&lt;add name=\"toadbEntities\" connectionString=\"metadata=res://*/TOAModel.csdl|res://*/TOAModel.ssdl|res://*/TOAModel.msl;provider=MySql.Data.MySqlClient;provider connection string=&amp;quot;server=localhost;User Id=abc;password=xyz;Persist Security Info=True;database=toadb&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>it is giving the following Error\n\"Unable to find the requested .Net Framework Data Provider.  It may not be installed.</p>\n\n<p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n\n<p>Exception Details: System.ArgumentException: Unable to find the requested .Net Framework Data Provider.  It may not be installed.\"</p>\n\n<p>and here is the stacktrace of the exception .... local addresses of my system in it are seems to be the suspected problem. Any suggestion for the solution?</p>\n\n<p>[ArgumentException: Unable to find the requested .Net Framework Data Provider.  It may   not be installed.]\n   System.Data.Common.DbProviderFactories.GetFactory(String providerInvariantName) +1420503\n   System.Data.EntityClient.EntityConnection.GetFactory(String providerString) +35</p>\n\n<p>[ArgumentException: The specified store provider cannot be found in the configuration, or is not valid.]\n   System.Data.EntityClient.EntityConnection.GetFactory(String providerString) +62\n   System.Data.EntityClient.EntityConnection.ChangeConnectionString(String  newConnectionString) +263\n   System.Data.EntityClient.EntityConnection..ctor(String connectionString) +81\n   System.Data.Objects.ObjectContext.CreateEntityConnection(String connectionString) +42\n   System.Data.Objects.ObjectContext..ctor(String connectionString, String defaultContainerName) +16\n   TOAServices.toadbEntities..ctor() in C:\\Users\\farazsh\\Documents\\Visual Studio 2010\\Projects\\TravelOneassist\\TOAServices\\TOAModel.Designer.cs:44\n   TOAServices.Common.LogError(String apiMessage, String category, Exception ex, String pageName) in C:\\Users\\farazsh\\Documents\\Visual Studio 2010\\Projects\\TravelOneassist\\TOAServices\\Common.cs:37\n   _Default.Page_Load(Object sender, EventArgs e) in c:\\inetpub\\vhosts\\traveloneassist.com\\httpdocs\\Def.aspx.cs:85\n   System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) +14\n   System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) +35\n   System.Web.UI.Control.OnLoad(EventArgs e) +91\n   System.Web.UI.Control.LoadRecursive() +74\n   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) </p>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":346,"score":4,"question_id":7313991,"title":"Meaningful Names for Navigation Properties using Entity Framework","body":"<p>I am using the ADO .NET Entity Framework to import my model from a database.  A table in my db has a bunch of foreign keys, all with abstract names e.g. <code>FKDevice132610</code>.</p>\n\n<p>When I import the table into my model, it brings in navigation properties for each foreign key, however they are imported with names based on the table name they link to.  If there is more than one foreign key to a certain table, a number is appended on the end.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Oc1CJ.png\" alt=\"Ef model\"></p>\n\n<p>In this case Devices1 is ParentDevices and Devices2 is ChildDevices.  Is there a way I can enter this information into my foreign key (say using the description or the name) so that the Entity Framework will import meaningful names for my navigation properties?</p>\n"},{"tags":["entity-framework","entity-relationship"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12946051,"title":"Entity Framework unexpected behavior on Save Entity","body":"<p>I Have two Entities Fisioterapeuta and Paciente, one Fisioterapeuta have * Pacientes.\nWhen a Add a new Fisioterapeuta, its ok.</p>\n\n<p>In the Paciente form i have a DropDownList to select the Fisioterapeuta of the Paciente, so, the entity Paciente have a property of type Fisioterapeuta.</p>\n\n<p>When a add one patient, EF duplicates (creates another one) Fisioterapeuta.</p>\n\n<p>I know this occurs becouse the Paciente.Fisioterapeuta is != null, as i using a generic repository when a try to save the Paciente, the Fisioterapeuta goes togheter.</p>\n\n<p>Is there a way to avoid this behavior? how to handle this?</p>\n\n<p>PS: I'am using generic repository, so i cant override SaveChanges or do validations on save.</p>\n\n<h2>Edit1</h2>\n\n<p>folowing @Brad Christie sugestion i do the following:</p>\n\n<pre><code>Paciente p = (Paciente)grdEdicao.DataContext; //here the DataContext brings me the Fisioterapeuta on the property p.Fisioterapeuta\n\np.Fisioterapeuta = Repository&lt;Fisioterapeuta&gt;.GetByID((int)comboFisioterapeutas.SelectedValue); // i try to set the Fisioterapeuta getting it from the repository.\n</code></pre>\n\n<p>This change doesnt solve my problem.</p>\n\n<h2>Edit2</h2>\n\n<p>I created a github project to test it, here is <a href=\"https://github.com/Ewerton/RelatedEntities_EF\" rel=\"nofollow\">https://github.com/Ewerton/RelatedEntities_EF</a></p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12808536,"title":"Compound natural key in DbSet.AddOrUpdate","body":"<p>I'm trying to use the CodeFirst data migrations in EF5 with a table that has a composite natural key.  Is it possible to specify this in the first argument to DbSet.AddOrUpdate, like</p>\n\n<pre><code>context.Table1.AddOrUpdate(\n     t=&gt;t.Column1 &amp;&amp; t.Column2,\n     new Table1 { properties... }\n);\n</code></pre>\n\n<p>How would one specify using more than one property in this case?</p>\n\n<p>Thanks,\nMatthew</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12395253,"title":"EF and character PK/FK","body":"<p>I am a newbie in the EF. I read <a href=\"http://msdn.microsoft.com/en-us/data/gg193958.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/data/gg193958.aspx</a> and still confused.</p>\n\n<p>I have an existing database and I'm writing a Code First model. I have Operators table with op_code Char(6) Primary Key. In the Operator class I named it OperatorCode, e.g.</p>\n\n<pre><code>[Key]\n[Column(\"op_code\",TypeName = \"char\")]\n[DisplayName(\"Operator\")]\npublic virtual string OperatorCode { get; set; }\n</code></pre>\n\n<p>In several of my tables I have EnteredBy and in some ModifiedBy columns that are FK to the op_code.</p>\n\n<p>Say, for the Clients table I have both of these fields.</p>\n\n<p>So, I added to the Operator class at the bottom:</p>\n\n<pre><code>[InverseProperty(\"EnteredBy\")]\npublic virtual ICollection&lt;Client&gt; ClientsEnteredBy { get; set; }\n\n[InverseProperty(\"ModifiedBy\")]\npublic virtual ICollection&lt;Client&gt; ClientsUpdatedBy { get; set; }\n</code></pre>\n\n<p>and I added the following into the Client class:</p>\n\n<pre><code>public virtual Operator EnteredBy { get; set; }\npublic virtual Operator ModifiedBy { get; set; }\n</code></pre>\n\n<p>and I am getting a run-time error about EnteredBy_OperatorCode and ModifiedBy_OperatorCode columns.</p>\n\n<p>What should I fix /add to let EF know my column names?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["linq","entity-framework","lambda","listbox"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12959373,"title":"Error getting items from Entity Framework using Lambda query","body":"<p>I have a listbox that I am trying to populate with the result of a SQL Server query via a Entity Framework linq/lambda query. I am feeding the query with a value from a combobox.  I keep getting lot of errors like the following:  Unable to create a constant value of type 'System.Object'. Only primitive types ('such as Int32, String, and Guid') are supported in this context.</p>\n\n<p>Any suggestions on how to fix this?  I just want two fields to populate in a grid</p>\n\n<pre><code>       var pAt = ent.Patterns.Where(p =&gt; p.Case_Id == (cbCase.SelectedItem as Case).Case_Id).Select(x =&gt; new  Pattern{  PatternID = x.PatternID, Pattern1 = x.Pattern1 });\n\n        listBox1.DataSource = pAt;\n        listBox1.ValueMember = \"PatternID\";\n        listBox1.DisplayMember = \"Pattern1\";\n</code></pre>\n"},{"tags":["c#","sql-server","entity-framework","lambda","projection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12958673,"title":"Calculation in EF Projection","body":"<p>Is there a way I can achieve the following?</p>\n\n<pre><code>// colourInfo.Discount = 75, but can change\n// allPrice type has Part, Desc, Type\n\nvar a = allPricesForPgs.Where(x =&gt; x.PG == c &amp;&amp; x.ColourCode == colourInfo.ColourCode).Select(y=&gt; new AllPrice {Part=y.Part, Desc=y.Desc, Price=y.Price*(colourInfo.Discount/100)}));\n</code></pre>\n\n<p>I get the error : <strong>The entity or complex type 'Portal.AllPrice' cannot be constructed in a LINQ to Entities query.</strong></p>\n\n<p>It seems the EF cannot handle calculations, what are my options since I am getting a dynamic value from one table to do a calculation on another?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":12959021,"title":"Sorting DataGridView Entity Framework","body":"<pre><code>    var type = typeof(T);\n                var property = type.GetProperty(columnSelectName);\n                var parameter = Expression.Parameter(type, \"p\");\n                var propertyAccess = Expression.MakeMemberAccess(parameter, property);\n                var orderByExp = Expression.Lambda(propertyAccess, parameter);\n\n                if (dataGridView.Columns[e.ColumnIndex].HeaderCell.SortGlyphDirection != SortOrder.Ascending)\n                {\n                    MethodCallExpression resultExp = Expression.Call(typeof(Queryable), \"OrderBy\", new Type[] { type, property.PropertyType }, data.Expression, Expression.Quote(orderByExp));\n\n                    bindingSource.DataSource = data.Provider.CreateQuery&lt;T&gt;(resultExp);\n\n                    dataGridView.Columns[e.ColumnIndex].HeaderCell.SortGlyphDirection = SortOrder.Ascending;\n                }\n\n\npublic partial class Logs\n{\n    public string UserName\n    {\n        get\n        {\n            if (this.id_user.HasValue)\n                return this.Users.login;\n            else\n                return string.Empty;\n        }\n    }\n\n    public string TypeName\n    {\n        get\n        {\n            TypeLogs typeLogs = (TypeLogs)this.type;\n\n            switch (typeLogs)\n            {\n                case TypeLogs.LogOn:\n                    return \"Logowanie\";\n                case TypeLogs.LogOff:\n                    return \"Wylogowanie\";\n                case TypeLogs.LogOnFailed:\n                    return \"Nieudane logowanie\";\n                case TypeLogs.LogsDelete:\n                    return \"Usunito logi\";\n                default:\n                    return string.Empty;\n            }\n        }\n    }\n</code></pre>\n\n<p>The specified type member 'Member' is not supported in LINQ to Entities. Only initializers, entity members, and entity navigation properties are supported.</p>\n\n<p>The specified type member 'Member' is not supported in LINQ to Entities. Only initializers, entity members, and entity navigation properties are supported.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12957991,"title":"EF5 : Manual table mapping","body":"<p>How to do manual table mapping in Entity Framework 5 using the Code First approach?</p>\n\n<p>What I mean by table mapping is to associate a table name from the database to an entity class with a different name.</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":64,"score":5,"question_id":12957715,"title":"How entity framework track the loaded entities? what are their life cycle?","body":"<p>I am relatively new to entity framework, all the documents or books I can find are talking about how to use the framework, or which model should be used, but short of explanation how the framework works in depth.</p>\n\n<p>For instance, when I load the entities from the database via either LINQ query or framework methods, are those entities thread safe? In another words can they be shared with other threads? If so how EF controls the consistency?</p>\n\n<p>When control goes out of context, are those entities gone or still in memory? After .SaveChanges are those entities gone? What is the life cycle?</p>\n\n<p>Can an expert in EF explain the above points in details please.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12958402,"title":"Preventing updates to specific entities in Entity Framework 5","body":"<p>Is there any way in code-first EF 5 to prevent updates on a specific entity/table? We are using EF in a WCF web service. We want updates to occur on one of the main objects, but not on some of the children. </p>\n\n<p>The idea being that if we have a main object like this:</p>\n\n<pre><code> class Person\n {\n       public Address { get; set; }\n       public string FirstName { get; set; }\n       public string LastName { get; set; }\n }\n\n class Address\n {\n       public string City { get; set; }\n       public string State { get; set; }\n }\n</code></pre>\n\n<p>We would want changes to <code>Person</code> persisted, but not changes to <code>Address</code>.</p>\n"},{"tags":["entity-framework","dll"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12953974,"title":"DLL of entity framework not work","body":"<p>In my project i use in dll of project in entity framework that I build, I have for example class like this:</p>\n\n<pre><code>public class Games\n{\n    public int GameID { get; set; }\n    public string Description { get; set; }\n    public float Time { get; set; }\n    public int Level { get; set; }\n\n    //Collection of all the players that play in the game\n    public virtual ICollection&lt;PlayerGame&gt; PlayersInGame { get; set; }\n\n}\n</code></pre>\n\n<p>in class player game define property of games like this:</p>\n\n<pre><code>    public virtual  Games Game { get; set; }\n</code></pre>\n\n<p>The constrains define on model building.</p>\n\n<p>Game in player game is foreign key in tables.</p>\n\n<p>when i test it on this project the collection fill details.</p>\n\n<p>but when i used the dll in other project the collection empty.</p>\n\n<p>the code in other project is like this:</p>\n\n<pre><code>GamesContext MyContext = new GamesContext();\nList&lt;Games&gt; GamesList= MyContext.GamesTbl.ToList();\n</code></pre>\n\n<p>in the context class i have the tables and the constrains and it work in the project of the entity frameWork!</p>\n"},{"tags":["wcf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12958312,"title":"FirstOrDefault not supported in EF","body":"<p>I am using EF and when I use FirstOrDefault on a table I get an error saying that it is not supported.  I am making the call over WCF.  Is this the issue?  Why is it not supported?  Why must I do a </p>\n\n<pre><code>Where(...).FirstOrDefault();\n</code></pre>\n\n<p>instead of just </p>\n\n<pre><code>FirstOrDefault();\n</code></pre>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4","visual-studio-2012"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12954600,"title":"Why incompatible types after extracting edmx from template ASP.Net MVC4","body":"<p>I'm new to .net, more of a Java guy, but I thought I was getting the hang of it. Only now after extracting an entity data model in a database first manner I suddenly get a couple of incompatible type errors (see below). I did nothing else.</p>\n\n<p>To reproduce:</p>\n\n<ol>\n<li>I created a template C# ASP.Net MVC4 internet application with account controller. </li>\n<li>Ran it and created a test account. </li>\n<li>Stopped debugging. </li>\n<li>Then extracted the .edmx via Project > Add new item > data > ADO.Net Entity Data Model using the default connection string. </li>\n<li><p>Then try to debug again and get the following errors:</p>\n\n<pre><code>Error   1   Cannot implicitly convert type 'MvcApplication1.Models.UserProfile' to 'MvcApplication1.UserProfile'    &lt;fileLocation&gt;  268 40  MvcApplication1\nError   2   The best overloaded method match for 'System.Data.Entity.DbSet&lt;MvcApplication1.Models.UserProfile&gt;.Add(MvcApplication1.Models.UserProfile)' has some invalid arguments  &lt;fileLocation&gt;  273 25  MvcApplication1\nError   3   Argument 1: cannot convert from 'MvcApplication1.UserProfile' to 'MvcApplication1.Models.UserProfile'   &lt;fileLocation&gt;  273 45  MvcApplication1\n</code></pre></li>\n</ol>\n\n<p>I can supply the code, but it's the default MS template code. </p>\n\n<p>I wanted to do the extraction this way, so I can expand upon the default MS model to further develop in a model first way.</p>\n\n<ul>\n<li>What's going wrong? </li>\n<li>How do I fix this? </li>\n<li>Or am I going about this\ncompletely wrong? (In which case I still want to fix it if possible.)</li>\n</ul>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":219,"score":0,"question_id":11792018,"title":"How to access context.Database.SqlQuery in Entity Framework?","body":"<p>I am trying to follow this tutorial:</p>\n\n<p><a href=\"http://blogs.msdn.com/b/diego/archive/2012/01/10/how-to-execute-stored-procedures-sqlquery-in-the-dbcontext-api.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/diego/archive/2012/01/10/how-to-execute-stored-procedures-sqlquery-in-the-dbcontext-api.aspx</a></p>\n\n<p>but can't seem to to access this method, it will not show up in intelli-sense</p>\n\n<pre><code>context.Database.SqlQuery\n</code></pre>\n\n<p>I am using the following code but can't seem to access the SqlQuery method:</p>\n\n<pre><code>using(Entities db = new Entities())\n{    \n}\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12957297,"title":"How to fasten this query on Entity Framework?","body":"<p>I have an events site. To query the events, i have to make a query with several tables involved. The problem is that this query is time consuming when not cached (3-4 sg in total). If i sum other queries made to the page for another data, it takes a pageload of 5-8 seg when not cached. \nI need to map the tables below to my Event class with the following properties (Im only writing main properties to try to minimize the problem :)</p>\n\n<pre><code>class Event\n\n  public string Name\n  public string Description\n  public DateTime Start\n  public DateTime End\n  public Location Location\n  public List&lt;Pages&gt; Topics\n  ... more simple properties\n\nclass Page\n\n      public string Name\n      public string Image\n\n\nclass Location\n\n      public string Name\n      public string Image\n      public string Address\n      public string PostalCode\n      public List&lt;Pages&gt; Topics\n  ... more simple properties\n</code></pre>\n\n<p>I have the following tables in my bd (SQL Server Express 2012)</p>\n\n<pre><code>Events (about 15000 records)\n----------\nIDEvent int --&gt; to the Pages table\nIDLocationPage int --&gt; to the Pages table\nStart datetime \nEnd datetime\n\nPages (about 15000 records)\n-------\nID int, PK\nName varchar\nDescription varchar\nIDImage int\n....More fields\n\n\nLocations (about 2000 records)\n-------------\nIDPage int --&gt; PK and FK to the Pages table\nAddress varchar\nPhone varchar\nPostal code varchar\n---more fields\n\n\nImages (about 9000 records)\n----------\nID int\nFile varchar -&gt;path to the file\n\n\nTopics (about 22000 records)\n--------\nIDPage int FK to the pages table\nIDTopic int FK to the pages table\n</code></pre>\n\n<p>As you can see, i have a table \"Events\" that for many properties navigates to the Pages table. The topics table relates each page with another pages.\nThe problem is that when i query this through Entity Framework and then i foreach the result and map it to my classes, it ends up with roundtrips to the database when bringing navigation properties (think about retrieving the image property, the topics, etc), then for each topic it retrieves the topic image, etc. it ends little optimous and if i try to do eager loading or proyection to bring only the fields i need, there are so much (note that i have to retrieve event properties, location properties, topics from event, from location, etc) that ends up with a sql timeout exception.\nMy query filters (in the where section) on start and end, may be the location, topics... etc</p>\n\n<p>I would like to know the best and more optimous way of executing the query. May be a view and then mapping it to Entity Framework? may be i cant use Entity Framework for this query and have to use another tech? This is the more complex query in the app, if i solve this query i can use Entity Framework for another querys or crud operations.</p>\n\n<p>Thanx</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12957438,"title":"How do I make an insert to a foreign key","body":"<p>I have 2 classes Bill and BillType. Each Bill should have a BillType and TypeId should be a FK. Using Code First, a column is added to my database table Bills called BillType_TypeId that has a FK relationship with the table BillTypes.</p>\n\n<pre><code>public class Bill\n{\n    [Key]\n    public int BillId { get; set; }\n\n    [Required, MaxLength(100)]\n    public string Name { get; set; }\n\n    [Required]\n    public decimal Amount { get; set; }\n\n    public System.DateTime DueDate { get; set; }\n\n    [Required]\n    public Guid UserId { get; set; }\n}\n\npublic class BillType\n{\n    [Key]\n    public int TypeId { get; set; }\n\n    [Required, MaxLength(100)]\n    public string Name { get; set; }\n\n    public virtual List&lt;Bill&gt; Bills { get; set; }\n}\n</code></pre>\n\n<p>My problem comes when I need to insert a TypeId into the Bills table. I've been using this code to insert:</p>\n\n<pre><code>public class BillActions\n{\n    private BillContext _db = new BillContext();\n\n    public Boolean InsertNewBill(int billType, string name, decimal amount, DateTime dueDate, Guid userId)\n    {\n        var bill = new Bill {                \n            xxx                              &lt;-- problem is here\n            Name = name,\n            Amount = amount,\n            DueDate = dueDate,\n            UserId = userId \n        };\n\n        _db.Bills.Add(bill);\n\n        _db.SaveChanges();\n        return true;\n    }\n}\n</code></pre>\n\n<p>There isn't an exposed object make equal to int billType. I'm not sure how to add it while still maintaining the FK constraints. How do I accomplish this. Also, I'm using Entity Framework 5.</p>\n"},{"tags":["c#","entity-framework","linq-to-entities","group-by"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":65,"score":3,"question_id":12957039,"title":"LINQ to Entities does not recognize the method 'System.String[] ToArray[String]","body":"<p>i have nearly 1 million data, which i definitely don't want to query all of them to memory and then group them, so i tried this, but linq2Entity does not recognize string.join(),  IEnumerable.toList(), or same things</p>\n\n<pre><code>                var capaHrs = (\n                from newsPerHr in _dbRawDataContext.CapacityPerHours\n                where newsPerHr.StreamDT &gt;= this.BeginDateTime\n                                &amp;&amp; newsPerHr.StreamDT &lt; this.EndDateTime\n                                &amp;&amp; newsPerHr.ServerName == this.ServerName\n                group newsPerHr by newsPerHr.StreamDT into grp\n                let MsgSizeTotal = (from i in grp select i.MsgSize).Sum(x =&gt; (int)x)\n                let MNumber = (from i in grp select i.MsgNumber).Sum(x =&gt; (int)x)\n                let Feeds = (from i in grp select i.FeedName).ToArray()\n                select new \n                {\n                    ServerName = ServerName,\n                    FeedName = Feeds,\n                    StreamDT = grp.Key,\n                    MsgSize = MsgSizeTotal,\n                    MsgNumber = MNumber\n                }).ToList();\n\n            _capacityData = capaHrs.Select(x =&gt; new CapacityPerHour {\n                ServerName = x.ServerName,\n                FeedName = string.Join(\", \",x.FeedName),\n                StreamDT = x.StreamDT,\n                MsgSize = x.MsgSize,\n                MsgNumber = x.MsgNumber\n            }).ToList();\n</code></pre>\n\n<p>how to make it work?</p>\n"},{"tags":["entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12932988,"title":"automatic refresh of cached entity framework results","body":"<p>I am performing an e.f query and storing the results as a list&lt;> in the cache.</p>\n\n<pre><code>     public static void ConstructPagesCache()\n    {\n        var db = new SomeUnitOfWork();\n\n        try\n        {\n            HttpContext.Current.Cache[\"Pages\"] = db.Pages.FindAll().ToList();\n        }\n        catch (Exception ex)\n        {\n            LogException(ex, \"some message\");\n            throw;\n        }\n        finally\n        {\n            db.Dispose();\n        }\n    }\n</code></pre>\n\n<p>What I want to be able to do if possible is have that list&lt;> update if something changes in the database.</p>\n\n<p>Is that possible with e.f using .net 4?</p>\n"},{"tags":["linq","entity-framework","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12956890,"title":"Linq Sentece Time out","body":"<p>I have a big one problem on linq, i have one sentence to fill one telerikRadGrid, is this: </p>\n\n<pre><code>    var coleccion = (from tab in tabReclamo\n                     join tabI in tabIntermediario on tab.IdIntermediario equals tabI.Id\n                     join tabR in tabReclamoEstatus on tab.IdReclamosEstatus equals tabR.IdReclamosEstatus\n                     join tabP in tabProveedor on tab.IdProveedor equals tabP.Id\n                     join tabS in tabServicio on tab.CodigoServicio equals tabS.CodigoServicio\n                     join tabA in tabAfiliado on tab.IdAfiliado equals tabA.Id\n                     join tabCert in tabCertificado on tabA.IdCertificado equals tabCert.Id\n                     join tabPo in tabPoliza on tabCert.IdPoliza equals tabPo.Id into x\n                     from y in x.DefaultIfEmpty()\n                     select new ReclamoDTO\n                     {\n                     Id = tab.Id,\n                     ReclamoId = tab.ReclamoId\n\n                     });\n\n                Conteo = coleccionconteo;\n                return UtilidadesDTO&lt;ReclamoDTO&gt;.EncriptarId(coleccion);\n            }\ncoleccion.count(); //count All registers on BD\ncoleccion.Skip((pagina - 1) * registros).Take(registros); // make pagination\n</code></pre>\n\n<p>the problem is that the firs sentence give me timeout becouse the BBDD have around 3KK of register, all joins made are necesary, how i can make pagination and count the total on one sentence??? or i need make one sentence that count, and another whit make the pagination. i try make the sentence linq whit skip and take but i dont know the real total of reg on BBDD.</p>\n\n<p>thanks.</p>\n\n<p>Sorry for my English</p>\n"},{"tags":["asp.net-mvc","entity-framework","design-patterns","domain-driven-design","repository-pattern"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":120,"score":1,"question_id":12918521,"title":"Where should the business logic be in this pattern?","body":"<p>This is my first attempt, after reading a lot about DDD, TDD and Repository / UnitOfWork paterns, to make my own application.</p>\n\n<p>I'm using Entity Framework, MVC 4 on .NET 4.0 (the server that will be running this application is a Windows 2003)</p>\n\n<p>This is the basic simplified pattern logic (The original one uses a IRepository, IUnitOfWork, GenericRepository and extends the EF POCOs with a IEntity interface to give access to the common ID field. But this simplified example will be enough to ask my question)</p>\n\n<pre><code>View -&gt; ViewModel -&gt; Controller &lt;- UnitOfWork &lt;- Repository &lt;- EntityFramework &lt;- Database\n</code></pre>\n\n<p><strong>View</strong></p>\n\n<pre><code>Model.Employee.GetSeniority()\n</code></pre>\n\n<p><strong>EmployeeDetailsViewModel</strong></p>\n\n<pre><code>Employee e { get; set; }\n</code></pre>\n\n<p><strong>Employee</strong></p>\n\n<pre><code>DateTime dateHired { get; set; }\nTimeSpan GetSeniority()\n{\n    return DateTime.Today - dateHired;\n}\n</code></pre>\n\n<p><strong>Controller EmployeeDetails()</strong></p>\n\n<pre><code>using(var unitOfWork = new UnitOfWork) {\n    return View(EmployeeDetailsViewModel model = new EmployeeDetailsViewModel {\n        e = unitOfWork.GetEmployeRepository().Find(o=&gt;o.id == id)\n    });\n}\n</code></pre>\n\n<p><strong>UnitOfWork GetEmployeRepository()</strong></p>\n\n<pre><code>return (_employeeRepository ?? _employeeRepository = new EmployeeRepository(this.dbContext));\n</code></pre>\n\n<p><strong>Repository Find()</strong></p>\n\n<pre><code>dbContext.Configuration.EnableProxyCreation = false;\nEmployee e = dbContext.Employees.Where(expression);\ndbContext.Configuration.EnableProxyCreation = true;\nreturn e;\n</code></pre>\n\n<p>Everything actually works properly. The problem is that I feel like something is terribly wrong here, and I'm not sure at which layer it should be fixed.</p>\n\n<p>After getting suggested, by a lot of people (Hi Darin), to always pass ViewModels to views and no models, I started doing this. However, what I'm doing (I think) isn't much better. I'm simply encapsulating my model in a viewmodel. At first, it didn't sound that bad since my Find() method would turn proxy off before getting an object, which would result in a persistance-ignorant POCO. However, now that I want to add some logic in the POCOs, I feel like there is something wrong.</p>\n\n<p>I think the problem resides in where my Business logic is and the fact that my Employee POCO should be mapped to a DTO object. However, where should I transfer the Employee POCO to a EmployeeDTO? Should that be the task of the Repository, the Controller or something else? I'm also unsure of where I should put my business logic (as simple as GetSeniority() displayed in the example). Should that be added to the EF POCO through partial classes or should that be in the DTOs? Or is there another missing step in the Employee -> EmployeeDTO transfer?</p>\n"},{"tags":["asp.net-mvc","entity-framework","automapper"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12941180,"title":"How can you deal with circular references when mapping?","body":"<p>Take this database for example</p>\n\n<p><strong>Employee</strong></p>\n\n<ul>\n<li>id - int (PK)</li>\n<li>name - varchar</li>\n</ul>\n\n<p><strong>Salary</strong></p>\n\n<ul>\n<li>id - int (PK)</li>\n<li>employee_id - int (FK)</li>\n<li>amount - float</li>\n</ul>\n\n<p>Entity Framework will generate models similar to these:</p>\n\n<pre><code>public partial class Employee\n{\n    public Employee()\n    {\n        this.Salaries = new HashSet&lt;Salary&gt;();\n    }\n    public int id { get; set; }\n    public string name { get; set; }\n}\n\npublic partial class Salary\n{\n    public int id { get; set; }\n    public int employee_id { get; set; }\n    public float amount  { get; set; }\n    public Employee employee { get; set; }\n}\n</code></pre>\n\n<p>The Emplyee references a list of his Salaries while each Salary points to which employee he owns. This results in a circular reference problem.</p>\n\n<p>I follow a repository pattern and use AutoMapper to transfer Employee to EmployeeDTO and Salary to SalaryDTO. I want those DTOs to keep infomation of it's children relationships. However, I dont want to do this recursively. I COULD do something like.</p>\n\n<pre><code>public partial class EmployeeDTO\n{\n    public EmployeeDTO()\n    {\n        this.Salaries = new HashSet&lt;SalaryChildDTO&gt;();\n    }\n    public int id { get; set; }\n    public string name { get; set; }\n}\n\npublic partial class SalaryChildDTO\n{\n    public int id { get; set; }\n    public float amount  { get; set; }\n}\n</code></pre>\n\n<p>But this would become a maintenance nightmare.</p>\n\n<p>How can I tell AutoMapper to only map a single decendant, or acheive a similar goal?</p>\n"},{"tags":["entity-framework","inheritance"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":12955555,"title":"Entity framework - Inheritance for tables","body":"<p>How can I manage the two following tables in Entity Framework :</p>\n\n<hr>\n\n<h2>Order</h2>\n\n<ul>\n<li>OrderId </li>\n<li>ProductId </li>\n<li>Date</li>\n</ul>\n\n<p>and</p>\n\n<hr>\n\n<h2>OrderArchive</h2>\n\n<ul>\n<li>OrderId </li>\n<li>ProductId </li>\n<li>Date</li>\n</ul>\n\n<p>In this schema orders are periodically transfered from the table Order to the table OrderArchive...\nNeither Table Per Type nor Table Per Hierarchy seems to fit my needs... I want to share the same methods for both object types.</p>\n\n<p>Note that I cannot change the database schema.\nThank you for your help.</p>\n"},{"tags":["entity-framework","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":145,"score":0,"question_id":12775543,"title":"Entity Framework Migrations: error on web server only","body":"<p>error 0175: The specified store provider cannot be found in the configuration, or is not valid</p>\n\n<p>I am using Entity Framework Code-First Migrations and everything is great locally.</p>\n\n<p>My DB is SQLServer 2008. (Also using SQL CE for local development)\nI can use the live SQL Server db connection string locally with no problem.</p>\n\n<p>Here is the Migration code in _appStart.cshtml:</p>\n\n<pre><code>@using EF = System.Data.Entity;\n@using TCommon = Told.Web.Common.Logic;\n@{\n    // Manually initialize\n    var initializer = new EF.MigrateDatabaseToLatestVersion&lt;TCommon.CommonContext, TCommon.Migrations.Configuration&gt;();\n    System.Data.Entity.Database.SetInitializer(initializer);\n    initializer.InitializeDatabase(new TCommon.CommonContext());\n\n    // DB Maintenance\n    TCommon.AppUserLogic.CleanDatabase();\n\n    // Asp.Net\n    WebSecurity.InitializeDatabaseConnection(\"ToldDB\", \"UserProfile\", \"UserId\", \"Email\", true);\n\n    // Common\n    TCommon.AppStart.Run();\n}\n</code></pre>\n\n<p>This works great locally. Either against a SQL CE or against my live database. It ran fine locally to migrate my live database to the latest version.</p>\n\n<p>However, when I put it on my web server, it throws this exception:</p>\n\n<h2>Exception</h2>\n\n<pre><code>Server Error in '/' Application.\n\nSchema specified is not valid. Errors: \n(0,0) : error 0175: The specified store provider cannot be found in the configuration, or is not valid.\n\n[MetadataException: Schema specified is not valid. Errors: \n(0,0) : error 0175: The specified store provider cannot be found in the configuration, or is not valid.]\n   System.Data.Metadata.Edm.Loader.ThrowOnNonWarningErrors() +8566285\n   System.Data.Metadata.Edm.Loader.LoadItems(IEnumerable`1 xmlReaders, IEnumerable`1 sourceFilePaths) +181\n   System.Data.Metadata.Edm.StoreItemCollection.Init(IEnumerable`1 xmlReaders, IEnumerable`1 filePaths, Boolean throwOnError, DbProviderManifest&amp; providerManifest, DbProviderFactory&amp; providerFactory, String&amp; providerManifestToken, Memoizer`2&amp; cachedCTypeFunction) +211\n   System.Data.Metadata.Edm.StoreItemCollection..ctor(IEnumerable`1 xmlReaders) +295\n   System.Data.Entity.Migrations.Extensions.XDocumentExtensions.GetStoreItemCollection(XDocument model, DbProviderInfo&amp; providerInfo) +180\n   System.Data.Entity.Migrations.Infrastructure.EdmModelDiffer.Diff(XDocument sourceModel, XDocument targetModel, String connectionString) +48\n   System.Data.Entity.Migrations.DbMigrator.IsModelOutOfDate(XDocument model, DbMigration lastMigration) +55\n   System.Data.Entity.Migrations.DbMigrator.Upgrade(IEnumerable`1 pendingMigrations, String targetMigrationId, String lastMigrationId) +269\n   System.Data.Entity.Migrations.DbMigrator.Update(String targetMigration) +456\n   System.Data.Entity.MigrateDatabaseToLatestVersion`2.InitializeDatabase(TContext context) +64\n</code></pre>\n\n<p>Now, this has something to do with the migration attempt. So when I wrap the migration call in a try-catch block, I can use the database fine (because I migrated the live db locally).</p>\n\n<pre><code>@using EF = System.Data.Entity;\n@using TCommon = Told.Web.Common.Logic;\n@{\n    // Manually initialize\n    var initializer = new EF.MigrateDatabaseToLatestVersion&lt;TCommon.CommonContext, TCommon.Migrations.Configuration&gt;();\n    System.Data.Entity.Database.SetInitializer(initializer);\n    try\n    {\n        initializer.InitializeDatabase(new TCommon.CommonContext());\n    }\n    catch (Exception ex)\n    {\n    }\n\n    var db = new TCommon.CommonContext();\n    var test = db.AppUsers.FirstOrDefault();\n\n    // DB Maintenance\n    TCommon.AppUserLogic.CleanDatabase();\n\n    // Asp.Net\n    WebSecurity.InitializeDatabaseConnection(\"ToldDB\", \"UserProfile\", \"UserId\", \"Email\", true);\n\n    // Common\n    TCommon.AppStart.Run();\n}\n</code></pre>\n\n<p>What would be causing the migration diff-check to fail when I try to run it on my web server?</p>\n\n<hr>\n\n<h3>Edit:</h3>\n\n<p>Here is the web.config for the Entity Framework:</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;configSections&gt;\n    ...\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\"/&gt;\n  &lt;/configSections&gt;\n  ...\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\"/&gt;\n  &lt;/entityFramework&gt;\n  &lt;system.web&gt;\n    &lt;trace enabled=\"true\" requestLimit=\"40\" localOnly=\"false\" pageOutput=\"true\"  /&gt;\n    &lt;customErrors mode=\"Off\"/&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.0\"&gt;\n      &lt;assemblies&gt;\n        &lt;add assembly=\"System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089\"/&gt;\n        &lt;add assembly=\"System.Web.Razor, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n      &lt;/assemblies&gt;\n    &lt;/compilation&gt;\n  &lt;/system.web&gt;\n  ...\n  &lt;connectionStrings&gt;\n    &lt;add name=\"ToldDB\" connectionString=\"...\" providerName=\"System.Data.SqlClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","visual-studio-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12954708,"title":"MVC 3 running on VS 2012 Error webdev.webserver40exe assertation failed","body":"<p>I've got a MVC 3 project which was converted to use MVC 4 using Visual Studio 4, I'm getting the following error</p>\n\n<p>webdev.webserver40exe - assertation failed</p>\n\n<p>I'm using the entity framework code first, I've changed the connection string to use SQL 2012 and can't seem to find a solution to this error.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["asp.net","asp.net-mvc","entity-framework","razor","objectstatemanager"],"answer_count":13,"favorite_count":3,"up_vote_count":28,"down_vote_count":0,"view_count":29247,"score":28,"question_id":1836173,"title":"Entity Framework: \"Store update, insert, or delete statement affected an unexpected number of rows (0).\"","body":"<p>I am using Entity Framework to populate a grid control. It sometimes when I make updates I get the following error:</p>\n\n<pre>\nStore update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.</pre>\n\n<p>I can't figure out how to reproduce this. But it might have something to do with how close together I make the updates. Has anyone seen this or does anyone know what the error message refers to?</p>\n\n<p>Edit: Unfortunately I am no longer at liberty to reproduce the problem I was having here, because I stepped away from this project and don't remember if I eventually found a solution, if another developer fixed it, or if I worked around it. Therefore I cannot accept any answers.</p>\n"},{"tags":[".net","asp.net-mvc","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12940909,"title":"MVC: Create relate entitiy when add one","body":"<p>So, my database now looks like:</p>\n\n<pre><code>Comment -&gt; Commentable \n\nCommentable -&gt; News\nCommentable -&gt; Files\nCommentable -&gt; Photo\n</code></pre>\n\n<p>This mean, when i add new entity (file or photo), i have to add new Commentable and insert this value to entity.</p>\n\n<p>What is the best practise of this? Should i override create function of entities, or put it into repository add function?</p>\n\n<p>Structure of tables looks like so, bcz i don't need to create for each entity own comments table.</p>\n\n<p><strong>Edit:</strong> My tables schema like here: <a href=\"http://stackoverflow.com/questions/10602562/one-table-vs-multiple-tables\">One table vs multiple tables</a> in Branko Dimitrijevic post</p>\n\n<p>When i want to add new file or event- at first, i have to generate new \"Commentable\" row and only after that- add with relate my entity.</p>\n\n<p>So, my question, where i have to put this logic or how to do that in the most correct practise?</p>\n\n<p>Thx.</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12949795,"title":"Use inserted record's identity without commiting","body":"<p>Let's say I have two tables: table Category and table Book</p>\n\n<p>I would like to add a Category, then use its ID for inserting a book (which has a CategoryId field pointing to the table Category). </p>\n\n<p>To get this info, I now commit my changes after inserting the category as it is not provided otherwise. </p>\n\n<p>Is there a way to point to this category when inserting my book without commiting after inserting the category?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["asp.net-mvc-3","sql-server-2008","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2149,"score":1,"question_id":10408182,"title":"A network-related or instance-specific error occurred while establishing a connection to SQL Server - ASP.NET MVC Entity Framework","body":"<p>I am using ASP.Net MVC 3 (Entity Framework) with Sql server 2008. Connection string is fine in web.config. But sometimes i get the following exception from my application:</p>\n\n<pre><code>    System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)\n\nGenerated: Wed, 02 May 2012 05:05:21 GMT\n\nSystem.Data.EntityException: The underlying provider failed on Open. ---&gt; System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\n   at System.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, Boolean encrypt, Boolean trustServerCert, Boolean integratedSecurity)\n   at System.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, SqlConnection owningObject)\n   at System.Data.SqlClient.SqlInternalConnectionTds.LoginWithFailover(Boolean useFailoverHost, ServerInfo primaryServerInfo, String failoverHost, String newPassword, Boolean redirectedUserInstance, SqlConnection owningObject, SqlConnectionString connectionOptions, TimeoutTimer timeout)\n   at System.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(SqlConnection owningObject, TimeoutTimer timeout, SqlConnectionString connectionOptions, String newPassword, Boolean redirectedUserInstance)\n   at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, Object providerInfo, String newPassword, SqlConnection owningObject, Boolean redirectedUserInstance)\n   at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection)\n   at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnection owningConnection, DbConnectionPool pool, DbConnectionOptions options)\n   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection)\n   at System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory)\n   at System.Data.SqlClient.SqlConnection.Open()\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\n   --- End of inner exception stack trace ---\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\n   at System.Data.EntityClient.EntityConnection.Open()\n   at System.Data.Objects.ObjectContext.EnsureConnection()\n   at System.Data.Objects.ObjectQuery`1.GetResults(Nullable`1 forMergeOption)\n   at System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable&lt;T&gt;.GetEnumerator()\n   at System.Linq.Enumerable.SingleOrDefault[TSource](IEnumerable`1 source)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.&lt;GetElementFunction&gt;b__2[TResult](IEnumerable`1 sequence)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.ExecuteSingle[TResult](IEnumerable`1 query, Expression queryRoot)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.System.Linq.IQueryProvider.Execute[S](Expression expression)\n   at System.Linq.Queryable.SingleOrDefault[TSource](IQueryable`1 source)\n   at MyApp.Data.UserRepository.GetUserDetails(String username)\n   at MyApp.Core.Services.SiteService.GetUserDetails(String username, Int64 userId)\n   at MyApp.PublicSite.Web.Controllers.BaseController.Initialize(RequestContext requestContext)\n   at System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext)\n   at MyApp.PublicSite.Web.Controllers.BaseController.Execute(RequestContext requestContext)\n   at System.Web.Mvc.ControllerBase.System.Web.Mvc.IController.Execute(RequestContext requestContext)\n   at System.Web.Mvc.MvcHandler.&lt;&gt;c__DisplayClass6.&lt;&gt;c__DisplayClassb.&lt;BeginProcessRequest&gt;b__5()\n   at System.Web.Mvc.Async.AsyncResultWrapper.&lt;&gt;c__DisplayClass1.&lt;MakeVoidDelegate&gt;b__0()\n   at System.Web.Mvc.Async.AsyncResultWrapper.&lt;&gt;c__DisplayClass8`1.&lt;BeginSynchronous&gt;b__7(IAsyncResult _)\n   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult`1.End()\n   at System.Web.Mvc.MvcHandler.&lt;&gt;c__DisplayClasse.&lt;EndProcessRequest&gt;b__d()\n   at System.Web.Mvc.SecurityUtil.&lt;GetCallInAppTrustThunk&gt;b__0(Action f)\n   at System.Web.Mvc.SecurityUtil.ProcessInApplicationTrust(Action action)\n   at System.Web.Mvc.MvcHandler.EndProcessRequest(IAsyncResult asyncResult)\n   at System.Web.Mvc.MvcHandler.System.Web.IHttpAsyncHandler.EndProcessRequest(IAsyncResult result)\n   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()\n   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously)\n</code></pre>\n\n<p>The Connection string is:</p>\n\n<pre><code>    &lt;connectionStrings&gt;\n    &lt;add name=\"MyAppDBContainer\" connectionString=\"metadata=res://*/MyAppDB.csdl|res://*/MyAppDB.ssdl|res://*/MyAppDB.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=SERVERNAME;initial catalog=MyAppDB;persist security info=True;user id=USERID;Password=PASSWORD;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>This exception occurs randomly and not able to get/reproduce it everytime. Any possible settings i may be missing here? Please suggest.</p>\n"},{"tags":["c#","linq","entity-framework","distinct"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":960,"score":2,"question_id":8536129,"title":"Distinct in Entity framework","body":"<p>I have a List of objects that some of them have the same Ids, so I would like to remove those elements that are duplicated. </p>\n\n<p>I tried with something like this:</p>\n\n<pre><code>List&lt;post&gt; posts = postsFromDatabase.Distinct().ToList();\n</code></pre>\n\n<p>But it doesn't work!</p>\n\n<p>So I wrote this method in order to avoid the duplicates:</p>\n\n<pre><code>public List&lt;Post&gt; PostWithOutDuplicates(List&lt;Post&gt; posts)\n    {\n        List&lt;Post&gt; postWithOutInclude = new List&lt;Post&gt;();\n        var noDupes = posts.Select(x =&gt; x.Id).Distinct();\n        if (noDupes.Count() &lt; posts.Count)\n        {\n            foreach (int idPost in noDupes)\n            {\n                postWithOutInclude.Add(posts.Where(x =&gt; x.Id == idPost).First());\n            }\n            return postWithOutInclude;\n        }\n        else\n        {\n            return posts;\n        }\n    }\n</code></pre>\n\n<p>Any ideas of how to improve the performance??</p>\n\n<p>Thanx in advance.</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":811,"score":1,"question_id":8163538,"title":"InvalidOperationException You must set this property to a non-null value of type string","body":"<p>The XX property on 'Table' could not be set to a 'Byte[]' value. You must set this property to a non-null value of type 'String'.</p>\n\n<p>I didn't create the mapping myself, this was generated from a db first scenario.  I am not inserting anything to a table, I'm just performing a select, this shouldn't happen at all?  Why am I getting this error and how do I fix it?  </p>\n"},{"tags":["json","wcf","entity-framework","c#-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":598,"score":2,"question_id":10930199,"title":"Endpoint not found WCF","body":"<p>I have WCF library that I hosted , the login function work well, but the second function ReturnCounter</p>\n\n<p>the interface is : </p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\n\nusing System.ServiceModel;\nusing System.ServiceModel.Web;\n\nnamespace PMAService\n{\n    [ServiceContract]\n    public interface IPMA\n    {\n        [OperationContract]\n        string Login(string username, string password);\n\n        [OperationContract]\n        List&lt;usp_ReturnEncounter_Result&gt; ReturnEncounter();\n\n\n\n    }\n}\n</code></pre>\n\n<p>and the code is </p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.ServiceModel.Web;\nusing System.Security.Cryptography;\nusing System.Web.Security;\n\nnamespace PMAService\n{\n    public class PMA : IPMA\n    {\n\n        [WebInvoke(Method = \"GET\",\n   ResponseFormat = WebMessageFormat.Json,\n   UriTemplate = \"LogIn/{username}/{password}\")]\n        public string Login(string username, string password)\n        {\n            if (Membership.ValidateUser(username, password))\n                return \"true\";\n            else\n                return \"false\";\n        }\n\n        // Method to retrieve the Counter \n        [WebInvoke(Method = \"GET\",\nResponseFormat = WebMessageFormat.Json,\nUriTemplate = \"ReturnEncounter\")]\n        public List&lt;usp_ReturnEncounter_Result&gt; ReturnEncounter()\n        {\n            using (PMAEntities context = new PMAEntities())\n            {\n              return   context.usp_ReturnEncounter().ToList();\n            }\n        }\n\n    }\n}\n</code></pre>\n\n<p>where I connect to Entity framework </p>\n\n<p>the web.config look like </p>\n\n<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;configuration&gt;\n  &lt;appSettings/&gt;\n  &lt;connectionStrings&gt;\n&lt;/connectionStrings&gt;\n  &lt;system.web&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.0\"/&gt;\n    &lt;roleManager enabled=\"true\" /&gt;\n    &lt;membership&gt;\n      &lt;providers&gt;\n        &lt;remove name=\"AspNetSqlMembershipProvider\"/&gt;\n        &lt;add name=\"AspNetSqlMembershipProvider\"\n             type=\"System.Web.Security.SqlMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\"\n             connectionStringName=\"Login\"\n             enablePasswordRetrieval=\"false\"\n             enablePasswordReset=\"true\"\n             requiresQuestionAndAnswer=\"false\"\n             applicationName=\"/\"\n             requiresUniqueEmail=\"false\"\n             passwordFormat=\"Hashed\"\n             maxInvalidPasswordAttempts=\"5\"\n             minRequiredPasswordLength=\"1\"\n             minRequiredNonalphanumericCharacters=\"0\"\n             passwordAttemptWindow=\"10\"\n             passwordStrengthRegularExpression=\"\" /&gt;\n      &lt;/providers&gt;\n    &lt;/membership&gt;\n\n    &lt;authentication mode=\"Windows\"/&gt;\n    &lt;customErrors mode=\"On\"/&gt;\n  &lt;/system.web&gt;\n  &lt;system.serviceModel&gt;\n    &lt;services&gt;\n      &lt;service name=\"PMAService.PMA\"&gt;\n        &lt;endpoint binding=\"webHttpBinding\" contract=\"PMAService.IPMA\" behaviorConfiguration=\"web\"&gt;\n        &lt;/endpoint&gt;\n      &lt;/service&gt;\n    &lt;/services&gt;\n    &lt;behaviors&gt;\n      &lt;endpointBehaviors&gt;\n        &lt;behavior name=\"web\"&gt;\n          &lt;webHttp /&gt;\n        &lt;/behavior&gt;\n      &lt;/endpointBehaviors&gt;\n    &lt;/behaviors&gt;\n  &lt;/system.serviceModel&gt;\n  &lt;startup&gt;\n    &lt;supportedRuntime version=\"v4.0\" sku=\".NETFramework,Version=v4.0\"/&gt;\n  &lt;/startup&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>the login/x/y work well, while ReturnCounter give the error endpoint not found </p>\n\n<p>any idea to fix that please </p>\n"},{"tags":["entity-framework","reverse-engineering"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12946930,"title":"EF Power Tools: modelEntityContainerName Invalid Characters","body":"<p>I know this has been asked before, but I'm trying to use EF Power Tools Beta 2 against a database with a hyphenated name, and I keep getting \"The modelEntityContainerName parameter 'DBName-ContinuedContext' contains characters that are not valid\". Is there an easy fix in the generation templates to avoid this error? Anybody? Thanks.</p>\n"},{"tags":["asp.net","asp.net-mvc","asp.net-mvc-3","entity-framework","entity-framework-4.3"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12946099,"title":"Keyword not supported: 'metadata'.? with Sql Connection in Entityt Framework with MVC3","body":"<p>I  am  using  Entity Framework 4 with my Asp.Net MVC3  application. My  problem  is  that  I  am  using  Entity Framework  to  perform  action  with  my  database ,  That  is  working  fine.  For  some  other  purpose I am  also  using  Sql Connection  to  Store  and  Retrieve  my  data  from database. I  am  getting  </p>\n\n<pre><code>[Keyword not supported: 'metadata']\n</code></pre>\n\n<p>error   while  connecting  with  my  database.</p>\n\n<p>This  is  my  web  config  </p>\n\n<pre><code>  &lt;add name=\"VibrantEntities\" connectionString=\"metadata=res://*/Vibrant.csdl|res://*/Vibrant.ssdl|res://*/Vibrant.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=KAPS-PC\\KAPSSERVER;initial catalog=vibrant;integrated security=True;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>I  am  using  class  Library,  So  this  is  my   App Config.</p>\n\n<pre><code>   &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.3.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n\n   &lt;add name=\"VibrantEntities\" connectionString=\"metadata=res://*/Vibrant.csdl|res://*/Vibrant.ssdl|res://*/Vibrant.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=KAPS-PC\\KAPSSERVER;initial catalog=vibrant;integrated security=True;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n"},{"tags":["entity-framework","sql-azure"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12942116,"title":"Save to multiple databases in a single transaction in SQL Azure Federation","body":"<p>I need to save to two different SQL Azure federated databases in a <strong>single transaction</strong> so I could rollback all changes if something fails. Right now, I have two separate code blocks that are transacting independently of each other. I tried using TransactionScope, but apparently SQL Azure does not support it.        </p>\n\n<pre><code>    using (EVENTContext dc = new EVENTContext(\nGetConnectionString(1)))\n    {\n        string federationCmdText = @\"USE FEDERATION [fed] ([dist] = '\"+ GetDist(1) +\"') WITH FILTERING = OFF, RESET\";\n        ((IObjectContextAdapter)dc).ObjectContext.Connection.Open();\n        dc.Database.ExecuteSqlCommand(federationCmdText);\n        dc.EVENTS.Add(e);\n        dc.SaveChanges();\n    }\n\n\n    using (EVENTContext dc = new EVENTContext(\nGetConnectionString(2)))\n    {\n        string federationCmdText = @\"USE FEDERATION [fed] ([dist] = '\"+ GetDist(2) +\"') WITH FILTERING = OFF, RESET\";\n        ((IObjectContextAdapter)dc).ObjectContext.Connection.Open();\n        dc.Database.ExecuteSqlCommand(federationCmdText);\n        dc.EVENTS.Add(e2);\n        dc.SaveChanges();\n    }\n</code></pre>\n\n<p>How can I save to multiple databases in a single transaction? I recently started reading about Unit of Work, but I'm not sure if that's what I need.</p>\n"},{"tags":["entity-framework","nested"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":2572,"score":2,"question_id":644743,"title":"Using ObjectQuery Include and using a nested where clause","body":"<p>Using entity framework, I'm trying to get back a customer with order details but I want to filter out those Orders that are active.</p>\n\n<p>Customer is our EntityObject which has a collection of Order EntityObjects.  CustomerDetails is our ObjectContext.</p>\n\n<p>The code below will attach all orders but I want to filter and only attach those that are active.  (Order.active == true).  How can I do this?  </p>\n\n<p>I know Include builds up a nested query statement (I can observe by using .ToTraceString().)  I was hoping to attach a Where clause to this nested select statement or the Include.</p>\n\n<pre><code>            Customer cust;\n        CustomerDetails custTable = new CustomerDetails();\n\n\n        cust = custTable.Customer\n            .Where(\"it.cust_id = \" + id)\n            .Include(\"Order\")  // But we only want Order.active == true!!!\n            .ToList().First();\n</code></pre>\n"}]}
{"total":18927,"page":9,"pagesize":100,"questions":[{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12945429,"title":"Can i overwrite the identity on insert in entity framework, without db writing it over","body":"<p>My column for the key</p>\n\n<pre><code>   this.Property(t =&gt; t.Guid).HasColumnName(\"Guid\")\n            .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n</code></pre>\n\n<p>And the insert.</p>\n\n<pre><code>         context.TrafficImages.Add(new TrafficImage { Guid = guids[i] });\n                context.SaveChanges();\n</code></pre>\n\n<p>When i save, the db writes its own guid. Anyway to let me write my own guid if i define it and if not the db will create one?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":445,"score":0,"question_id":11381744,"title":"The property 'Id' is part of the object's key information and cannot be modified","body":"<p>I am developing an asp.net mvc 3.0 app and using EF 4.1 for my data access layer and unit of work pattern.</p>\n\n<p>Here are my models :</p>\n\n<pre><code> public class UpdateUserViewModel\n    {\n        public User User { get; set; }\n    }\n\npublic partial class Role\n    {\n        public int Id { get; set; }\n\n     }\n\n\n    public partial class User\n    {\n        public Guid Id { get; set; }\n\n        public virtual Role Role { get; set; }\n    }\n</code></pre>\n\n<p>I pass UpdateUserViewModel to a view and then post the form in the view to the following action :</p>\n\n<pre><code>public ActionResult UpdateUser(User user)\n        {\n            var userObj = unitofwork.UserRepository.GetByID(user.Id);\n\n            TryUpdateModel(userObj, \"User\");\n\n            userObj.Role = unitofwork.RoleRepository.GetByID(user.Role.Id);\n\n            unitofwork.UserRepository.Update(userObj);\n\n            unitofwork.Save();\n        }\n</code></pre>\n\n<p>Problem raises when I Update user role in the view (it is a dropdown list) and try to update it. it gives me the following error :</p>\n\n<pre><code>The property 'Id' is part of the object's key information and cannot be modified. \n</code></pre>\n\n<p>But if i dont update the user role, it works fine.</p>\n\n<p>Would you help me please ?</p>\n"},{"tags":["c#","asp.net","entity-framework","entity-framework-4","connection-string"],"answer_count":2,"favorite_count":1,"up_vote_count":11,"down_vote_count":0,"view_count":12465,"score":11,"question_id":6232633,"title":"Entity Framework Timeouts","body":"<p>I am getting timeouts using the Entity Framework (EF) when using a function import that takes over 30 seconds to complete. I tried the following and have not been able to resolve this issue:</p>\n\n<p>I added Default Command Timeout=300000 to the connection string in the App.Config file in the project that has the EDMX file as suggested here: <a href=\"http://stackoverflow.com/questions/1718739/entity-framework-with-mysql-timeout-expired-while-generating-model\">Entity Framework with MySQL - Timeout Expired while Generating Model</a></p>\n\n<p>This is what my connection string looks like:</p>\n\n<pre><code>&lt;add \n    name=\"MyEntityConnectionString\" \n    connectionString=\"metadata=res://*/MyEntities.csdl|res://*/MyEntities.ssdl|res://*/MyEntities.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=trekdevbox;Initial Catalog=StarTrekDatabase;Persist Security Info=True;User ID=JamesTKirk;Password=IsFriendsWithSpock;MultipleActiveResultSets=True;Default Command Timeout=300000;&amp;quot;\" \n    providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>I tried setting the CommandTimeout in my repository directly like so:</p>\n\n<pre><code>private TrekEntities context = new TrekEntities();\n\npublic IEnumerable&lt;TrekMatches&gt; GetKirksFriends()\n{\n  this.context.CommandTimeout = 180;\n  return this.context.GetKirksFriends();\n}\n</code></pre>\n\n<p>What else can I do to get the EF from timing out? This only happens for very large datasets. Everything works fine with small datasets.</p>\n\n<p>Here is one of the errors I'm getting:</p>\n\n<blockquote>\n  <p>System.Data.EntityCommandExecutionException: An error occurred while executing the command definition. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.</p>\n</blockquote>\n\n<p>OK - I got this working and it's silly what happened. I had both the connection string with \"Default Command Timeout=300000\" and the CommandTimeout set to 180; When I removed the Default Command Timeout from the connection string, it worked. So the answer is to manually set the CommandTimeout in your repository on your context object like so:</p>\n\n<p>this.context.CommandTimeout = 180;\nApparently setting the timeout settings in the connection string has no effect on it.</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12927991,"title":"ASP.NET MVC Model Mixins?","body":"<p>I have a set of fields that I intend to share between multiple models. I want all the fields to be included in each entity's table (not just one table for the fields). I'm more familiar with languages such as Python, where this type of pattern is called a \"mixin\", essentially a class that doesn't exist on its own (it doesn't get instantiated/doesn't have a table in the case of a model class). Instead, the derived class simply inherits the fields and its table looks as if the fields were simply included right on the model class.</p>\n\n<p>The concept of a \"Complex Type\" in Entity Framework seems like a close proxy to what I'm looking for, but the inability to include navigation properties is a bit of killer. Is there any other way to do this, or if Complex Types are the answer, then what should I do about the navigation properties?</p>\n"},{"tags":["c#","entity-framework","transactions","transactionscope"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":182,"score":0,"question_id":12055511,"title":"Transaction scope timeout on 10 minutes","body":"<p>I have a long running transactionscope in c#. I told the scope that it should have a long timespan, but still I get a timeout. What could cause this?</p>\n\n<pre><code>TransactionOptions transactionOptions = new TransactionOptions();\ntransactionOptions.IsolationLevel = IsolationLevel.ReadCommitted;\ntransactionOptions.Timeout = TimeSpan.MaxValue;\nusing (var ts = new TransactionScope(TransactionScopeOption.Required, transactionOptions))\n{ \n          DoLongCode();\n}\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12941794,"title":"LINQ Query with Aggregates and Group By","body":"<p>i have the following SQL query...</p>\n\n<pre><code>    select  seaMake AS Make,\n        seaModel AS Model,\n        COUNT(*) AS [Count],\n        MIN(seaPrice) AS [From],\n        MIN(seaCapId) AS [CapId]\nfrom tblSearch \nwhere seaPrice &gt;= 2000\nand seaPrice &lt;= 7000\ngroup by seaMake, seaModel\norder by seaMake, seaModel\n</code></pre>\n\n<p>Im trying to write this as a LINQ to Entities Query, but im having problems. This is what i have so far but i cannot access the make and model values from the var S</p>\n\n<pre><code>var tester = from s in db.tblSearches\n             where s.seaPrice &gt;= 2000\n             &amp;&amp; s.seaPrice &lt;= 7000\n             orderby s.seaMake\n             group s by s.seaMake into g\n             select new\n             {\n                 make = g.seaMake,\n                 model = s.seaModel,\n                 count = g.Max(x =&gt; x.seaMake),\n                 PriceFrom = g.Min(s.seaPrice)\n              };\n</code></pre>\n\n<p>Where am i going wrong ?</p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":8,"up_vote_count":20,"down_vote_count":0,"view_count":7768,"score":20,"question_id":1158422,"title":"Entity Framework - Detach and keep related object graph","body":"<p>I've just started using Entity Framework rather than my normal NHiberante to see how EF works and so far I'm having lots of problems but one in particular is detaching an object and keeping the related child objects.<br />\nI bought the O'Reilly Entity Framework book which tells you \"yes entity framework by default doesn't keep the object graph when you detach\" but it doesn't show how you how to keep the graph!  Thanks O'Reilly thats really useful.  </p>\n\n<p>Anyway if anyone can help that would be great, code below:</p>\n\n<pre><code>        using (var creativeWorkshopEntities = new CreativeWorkshopEntities())\n        {\n            var q = from c in creativeWorkshopEntities.Job.Include(\"Files\")\n                    where c.Id == jobId\n                    select c;\n\n            var job = q.First();\n\n            creativeWorkshopEntities.Detach(job);\n\n            return job;\n        }\n</code></pre>\n\n<p>Thanks!</p>\n\n<p>Dan</p>\n"},{"tags":["c#","mysql","entity-framework","mysql-connector"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":151,"score":0,"question_id":12075506,"title":"ADO.Net Entity framework, Fatal error encountered during data read","body":"<p>I am getting the following error while using MySql with Entity framework. I have set the default connection timeout to 300000 on the connection string of EntityConnectionStringBuilder. How to resolve this in Entity framework?</p>\n\n<pre><code>    Unhandled Exception: System.Data.EntityCommandExecutionException: An    \n    error occurred while reading from the store provider's data reader. See the  \n    inner exception for details. ---&gt; MySql.Data.MySqlClient.MySqlException: Fatal \n    error encountered during data read. ---&gt; MySql.Data.MySqlClient.MySqlException: \n    Reading from the stream has failed. ---&gt; System.IO.EndOfStreamException: Attempted \n    to read past the end of the stream.\n</code></pre>\n\n<p>Update: How can we set net_read_timeout for ado.net entity framework?</p>\n"},{"tags":["c#","linq","entity-framework","tsql","group-by"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":11474469,"title":"How do I get a lambda query that is like this tsql query?","body":"<p>Having a T-SQL query:</p>\n\n<pre><code>select [ProductNumber] ,max([ProductRevNumber])\nfrom Products  \ngroup by [ProductNumber]\n</code></pre>\n\n<p>Attempted LINQ query:</p>\n\n<pre><code>ProductsDBContext.Products.GroupBy(x =&gt; x.ProductRevNumber)\n                          .Select(group =&gt; ProductNumber, \n                                           ProductRevNumber = group.Max(x =&gt; x.ProductRevNumber));\n</code></pre>\n\n<p>The lambda query doesn't work.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12939091,"title":"EF Code First table naming issues","body":"<p>I have a project built using EF code first. It also uses forms authentication. Until recently the membership database and the application database were being developed separately, but I want to combine them into one database for simplicity. </p>\n\n<p>One of the classes in my code first model is called \"Application\" so the EF-generated table is called \"Applications\" which conflicts with a membership table of the same name. This is an example of my current context:</p>\n\n<pre><code>public partial class ExampleContext : DbContext\n{\n    public DbSet&lt;Application&gt; Applications { get; set; }\n    public DbSet&lt;Status&gt; StatusTypes { get; set; } // notice the name of the property vs the name of the class\n}\n</code></pre>\n\n<p>I thought the table names were based on the names of the properties in the context, because it was generating a table named <code>StatusTypes</code> for all of the <code>Status</code> objects. But if I rename the <code>Applications</code> property to something like <code>MyApplications</code> it is still generating a table named <code>Applications</code>. So clearly it's not just the name of the property and I'm missing something.</p>\n\n<p>My question: how do I get EF to name this table differently?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","godaddy"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":535,"score":0,"question_id":10353595,"title":"Deploying EF Code First CREATE DATABASE permission denied","body":"<p>I am trying to deploy my site to a godaddy web host and I am receiving this error</p>\n\n<pre><code>CREATE DATABASE permission denied in database 'master'.\n</code></pre>\n\n<p>From what I have read, my only options are to either use another account that has permission to create a database, or manually create my database one table at a time. being that its a godaddy host I cant grant myself access, so is there any alternatives to manually creating the database.</p>\n\n<p><strong>Are there any tools that will help me auto generate insert.sql scripts from my local server ?</strong></p>\n\n<p>My connection string is</p>\n\n<pre><code>&lt;add name=\"DataContext\" \nconnectionString=\"Server=servername.db.9485321.hostedresource.com; \nDatabase=databasename; User ID=userid; Password=password; Trusted_Connection=False\" \nproviderName=\"System.Data.SqlClient\" /&gt; \n</code></pre>\n\n<p>I have also tried this in my Application_Start(), but it still tries to create a database</p>\n\n<pre><code>Database.SetInitializer&lt;MyContext&gt;(null);\n</code></pre>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":2,"up_vote_count":16,"down_vote_count":0,"view_count":7945,"score":16,"question_id":614809,"title":"Entity Framework .Include() Navigation of another Navigation property","body":"<p>I have an entity <em>Test</em>. It contains a Navaigation Property <em>Question</em> and <em>Question</em> contains a Navigation Property <em>QuestionLocale</em>.</p>\n\n<pre><code>var test = context.Tests\n       .Include(\"Question\")\n       .FirstOrDefault();\n</code></pre>\n\n<p>works as expected. But how is it possible to include the <em>QuestionLocale</em>?</p>\n"},{"tags":["c#","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":11993709,"title":"Why am I getting an error when editing relationships with EntityFramework?","body":"<p>I have three EntityFramework (4.3) objects, a Member, Address and a State. They look like this:</p>\n\n<pre><code>public class Member\n{\n    public int Id { get; set; }\n    public virtual Address Address { get; set; }\n    /*other properties removed for brevity*/\n}\n\npublic class Address\n{\n    public int Id { get; set; }\n    public virtual State State { get; set; }\n    /*other properties removed for brevity*/\n}\n\npublic class State\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string Abbreviation { get; set; }\n    public virtual ICollection&lt;Address&gt; Address { get; set; }\n}\n</code></pre>\n\n<p>When I update the address relationship, everything works fine. See code below:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Update(MemberUpdateModel model)\n{\n    if (!ModelState.IsValid)\n    {\n        model.SetStateSelectList(_db, model.SelectedStateId);\n        return View(model);\n    }\n\n    _db.Entry(model.Member).State = EntityState.Modified;\n    _db.Entry(model.Member.Address).State = EntityState.Modified;\n\n    _db.SaveChanges(); // works\n\n    return RedirectToAction(\"Index\");\n}\n</code></pre>\n\n<p>Then I add in the update for the Address/State relationship like this:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Update(MemberUpdateModel model)\n{\n    if (!ModelState.IsValid)\n    {\n        model.SetStateSelectList(_db, model.SelectedStateId);\n        return View(model);\n    }\n\n    _db.Entry(model.Member).State = EntityState.Modified;\n    _db.Entry(model.Member.Address).State = EntityState.Modified;\n\n    // added for address/state relationship\n    var selectedState = _db.States.FirstOrDefault(q =&gt; q.Id == model.SelectedStateId);\n    model.Member.Address.State = selectedState;\n\n    _db.SaveChanges();\n\n    return RedirectToAction(\"Index\");\n}\n</code></pre>\n\n<p>When we run the above code, we get the following error:</p>\n\n<pre><code>Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.Data.OptimisticConcurrencyException: Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.\n</code></pre>\n\n<p>What am I doing wrong to cause this behavior?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":37,"score":-2,"question_id":12940111,"title":"Can't determine neccessary type for database entity","body":"<p>My goal is to make a deletion function that uses LINQ to delete a record from a database table by finding the id the user inputs that matches the record's primary key.  </p>\n\n<ul>\n<li><p><strong>MyDBEntitiesClass</strong> is the argument that the function needs to be passed which tells it what DataTable to search. </p></li>\n<li><p><strong>IDontKnowWhatType</strong> is the type I'm asking for help in determining.</p></li>\n<li><p><strong>MyPrimaryKey</strong> needs to be replaced with something that references the primary key of MyDBEntitiesClass.</p></li>\n<li><p><strong>TestDatabaseEntities</strong> is the name of the connection string created by generating an entity model from my existing SQL server database.</p></li>\n</ul>\n\n<pre><code>public static void DeleteFrom(IDontKnowWhatType MyDBEntitiesClass)\n{\n\nvar dbEntities = new TestDatabaseEntities(); \n\n    //Prompt the user for an ID\n    Console.WriteLine(\"Select ID for deletion.\");\n\n    // save the ID to IDtoMark\n    int IDtoMark = int.Parse(Console.ReadLine());\n    try\n    {\n        // return a single record that matches IDtoMark \n        MyDbEntitiesClass x = dbEntities.MyDbEntitiesClass.Single(x => x.myPrimaryKey == IDtoMark);\n        //Remove the marked record, and save changes\n        dbEntities.MyDbEntitiesClass.Remove(x);\n        dbEntities.SaveChanges();\n    }\n    catch(Exception ex)\n    {\n        Console.WriteLine(ex.Message);\n    }\n}\n</code></pre>\n"},{"tags":["c#","mysql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":157,"score":0,"question_id":12410666,"title":"Unable to read data from the transport connection exception","body":"<p>I've got a MySQL 5.5 DB server, using Entity Framework 4.3, MySQL Connector 6.5.4.</p>\n\n<p>The problem that I'm seeing is that over a slow connection (~192kbs) seems to be fairly consistent.  </p>\n\n<p>The scenario is that I first call a method that looks like this:</p>\n\n<pre><code>using (var db = new IceCreamEntities(ConnectionString, null, null, null, \"infinite timeout\"))\n{\n   db.desserts.Add(myDessert);\n   db.SaveChanges()\n\n   db.dessertData.Add(new dessertBlob() { DessertId = myDessert.Id, Data = someData });\n}\n</code></pre>\n\n<p>and then I call closely after that (say, within 30 seconds or so) a method to get that back.  It looks like:</p>\n\n<pre><code>using (var db = new IceCreamEntities(ConnectionString, null, null, null, \"infinite timeout\"))\n{\n   var myDessertData = db.dessertData.Where(m =&gt; m.DessertId == myId).FirstOrDefault();\n   return myDessertData;\n}\n</code></pre>\n\n<p>Now, the <code>IceCreamEntities</code> constructor call there that I'm using does the following:</p>\n\n<pre><code>public IceCreamEntities(string connectionString, string unused2, string unused3, string unused4, string forLongRunningStuff)\n: base(connectionString)\n{\n   var objectContext = (this as IObjectContextAdapter).ObjectContext;\n   objectContext.CommandTimeout = 0;\n}\n</code></pre>\n\n<p><em>(there are a couple other constructors that are used with different timeouts, but that is probably not germane to the discussion)</em></p>\n\n<p>The blob I'm putting into that dessertData table is about 3 megabytes in size.  </p>\n\n<p>When I'm not on a slow connection, I don't see this problem.</p>\n\n<p>The exception I get is:</p>\n\n<blockquote>\n  <p>System.Data.EntityCommandExecutionException: An error occurred while\n  executing the command definition. See the inner exception for details.</p>\n  \n  <p>---> MySql.Data.MySqlClient.MySqlException: Fatal error encountered during command execution. </p>\n  \n  <p>---> MySql.Data.MySqlClient.MySqlException: Fatal error encountered attempting to read the resultset. </p>\n  \n  <p>---> MySql.Data.MySqlClient.MySqlException: Reading from the stream has failed.<br>\n  ---> System.IO.IOException: Unable to read data from the transport connection: An existing connection was forcibly closed by the remote\n  host. </p>\n  \n  <p>---> System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host</p>\n  \n  <p>at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32\n  offset, Int32 size)</p>\n  \n  <p>--- End of inner exception stack trace ---</p>\n  \n  <p>at\n  MySql.Data.Common.MyNetworkStream.HandleOrRethrowException(Exception\n  e)</p>\n  \n  <p>at MySql.Data.Common.MyNetworkStream.Read(Byte[] buffer, Int32\n  offset, Int32 count)</p>\n  \n  <p>at MySql.Data.MySqlClient.TimedStream.Read(Byte[] buffer, Int32\n  offset, Int32 count)</p>\n  \n  <p>at System.IO.BufferedStream.Read(Byte[] array, Int32 offset, Int32\n  count)</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlStream.ReadFully(Stream stream,\n  Byte[] buffer, Int32 offset, Int32 count)</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlStream.LoadPacket()</p>\n  \n  <p>--- End of inner exception stack trace ---</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlStream.LoadPacket()</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlStream.ReadPacket()</p>\n  \n  <p>at MySql.Data.MySqlClient.NativeDriver.FetchDataRow(Int32\n  statementId, Int32 columns)</p>\n  \n  <p>at MySql.Data.MySqlClient.Driver.FetchDataRow(Int32 statementId,\n  Int32 columns)</p>\n  \n  <p>at MySql.Data.MySqlClient.ResultSet.GetNextRow()</p>\n  \n  <p>at MySql.Data.MySqlClient.ResultSet..ctor(Driver d, Int32\n  statementId, Int32 numCols)</p>\n  \n  <p>at MySql.Data.MySqlClient.Driver.NextResult(Int32 statementId,\n  Boolean force)</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlDataReader.NextResult()</p>\n  \n  <p>--- End of inner exception stack trace ---</p>\n  \n  <p>at MySql.Data.MySqlClient.MySqlDataReader.NextResult()</p>\n  \n  <p>at\n  MySql.Data.MySqlClient.MySqlCommand.ExecuteReader(CommandBehavior\n  behavior)</p>\n  \n  <p>--- End of inner exception stack trace ---</p>\n  \n  <p>at\n  MySql.Data.MySqlClient.MySqlCommand.ExecuteReader(CommandBehavior\n  behavior)</p>\n  \n  <p>at\n  MySql.Data.Entity.EFMySqlCommand.ExecuteDbDataReader(CommandBehavior\n  behavior)</p>\n  \n  <p>at\n  System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand\n  entityCommand, CommandBehavior behavior)</p>\n  \n  <p>--- End of inner exception stack trace ---</p>\n  \n  <p>at\n  System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand\n  entityCommand, CommandBehavior behavior)</p>\n  \n  <p>at\n  System.Data.Objects.Internal.ObjectQueryExecutionPlan.Execute[TResultType](ObjectContext\n  context, ObjectParameterCollection parameterValues)</p>\n  \n  <p>at System.Data.Objects.ObjectQuery<code>1.GetResults(Nullable</code>1\n  forMergeOption)</p>\n  \n  <p>at\n  System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable.GetEnumerator()</p>\n  \n  <p>at System.Linq.Enumerable.FirstOrDefault[TSource](IEnumerable`1\n  source)</p>\n  \n  <p>at\n  System.Data.Entity.Internal.Linq.DbQueryProvider.Execute[TResult](Expression\n  expression)</p>\n  \n  <p>at System.Linq.Queryable.FirstOrDefault[TSource](IQueryable`1\n  source)</p>\n  \n  <p>at IceCream.Repository.GetDessertData(Int64 dessertId) in ....</p>\n</blockquote>\n\n<p>One other data point - I can call the method that does the add twice in a row with the same sized blob and I don't get this error (or the equivalent).  It only happens when I do an Add and then follow it up with the Retrieve.</p>\n\n<p>Any ideas how to address this?  I had thought that settting the command timeout value to 0 would solve my problems but it doesn't.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>One other point is that I did the math and 3 megabytes at 192mbs should take somewhere in the neighborhood of 128 seconds to transfer.</p>\n"},{"tags":["entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12939211,"title":"why the output always \"System.Object\"","body":"<p>in EF I want tto get the first value of query so I use </p>\n\n<pre><code>ExecuteStoreQuery&lt;object&gt;(Query, null).FirstOrDefault();\n</code></pre>\n\n<p>because I don't know what's the actual returned data type \nif the value comming is numeric is crash , so I used the following</p>\n\n<pre><code>ExecuteStoreQuery&lt;object&gt;(Query, null).Select(x =&gt; x.ToString()).FirstOrDefault() \n</code></pre>\n\n<p>but the resulted string  always <code>System.Object</code> </p>\n\n<p>any idea how to get the actual value </p>\n\n<p>Best regards</p>\n"},{"tags":["c#","visual-studio","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12939082,"title":"no POCO classes in EF 5.0","body":"<p>i used always EF 4.2 and gernerated my edmx model files with visual studio. I never used POCO and tt files (and have no idea about it).</p>\n\n<p>Now i updated to visual studio and EF 5.0.</p>\n\n<p>When i want to add a new model in VS all that POCO stuff is generated and i can't set a connection at runtime to my model. Is this still possible? With my former solution i easily could set the connection string at runtime in the constructor.\nIs it possible to generate my model file the old way without that POCO stuff?</p>\n\n<p>My model is now derived from DBContext and the former models are derived from ObjectContext.</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":118,"score":2,"question_id":12903732,"title":"Slow speed when using nested loops when comparing large data sets","body":"<p>I'm retrieving two lists of datasets using Linq to entities. They're both in the same Database, but I need to get one table converted into my Tasks Table because it's integrated into my Calendar. Not worth going into extreme detail here I'm sure but I would love to speed up the process of matching id's and Creating new Task objects. This is a Once and done snippet so even at a slow speed I can simply leave the program running overnight. However, for future reference I'd like some suggestions on increasing the efficiency.</p>\n\n<pre><code>var accounts = data.Accounts.ToList().OrderBy(a =&gt; a.ID);\nIncidents[] Incidents = data.Incidents.ToArray();\n\n        for (int i=0;i&lt;Incidents.Length;i++)\n        {\n            foreach (var a in accounts)\n            {\n                if (a.Acct_CID == Incidents[i].CustomerID)\n                {\n                    Tasks t = new Tasks();\n                    t.creator_id = a.ID;\n                    t.start_date = Incidents[i].DateOpened;\n                    t.end_date = Incidents[i].DateCLosed;\n                    t.product_code = Incidents[i].ProductCode;\n                    t.install_type = Incidents[i].InstallType;\n                    t.os = Incidents[i].OSType;\n                    t.details = Incidents[i].Description;\n                    t.solution = Incidents[i].Solution;\n                    t.creator_name = Incidents[i].TechID;\n                    t.category = Incidents[i].Title;\n                    t.text = \"Ticket for\" + \" \" + Incidents[i].Name;\n                    if (t.end_date == DateTime.MinValue || t.end_date == null)\n                        t.status_id = 6;\n                    else t.status_id = 7;\n                    data.Tasks.Add(t);\n                    break;\n                }\n            }\n        }\n        data.SaveChanges();\n</code></pre>\n"},{"tags":["c#",".net","sql-server","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12938691,"title":"EF Code First MetadataException","body":"<p>I've installed EF v5 via NuGet into a VS 2010 project. Here's the code:</p>\n\n<pre><code>public class HeliosCpDataContext : DbContext\n{\n    public HeliosCpDataContext() : base(Properties.Settings.Default.cn_HeliosCpNtAuth) {}\n    public IEnumerable&lt;Test&gt; GetTests()\n    {\n            return this.Database.SqlQuery&lt;Test&gt;(\"EXEC App.Test\");\n    }\n}\n\n   public class Test\n    {\n       public string OrderNumber { get; set; }\n       public int OrderId {get;set;}\n    }\n\n   CREATE PROC [dbo].[Test]\n   AS \n    SET NOCOUNT ON\n\n\nSELECT TOP 10 OrderNumber, OrderId\nFROM dbo.Orders o\n</code></pre>\n\n<p>Field [OrderNumber] is Varchar(20), [OrderId] is INT</p>\n\n<p>Here's the app.config:</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n  &lt;/configSections&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"HeliosCp.Data.Properties.Settings.cn_HeliosCpNtAuth\"\n      connectionString=\"Data Source=DCXVRSQ471;Initial Catalog=SCPT_HeliosCp;Integrated Security=True;MultipleActiveResultSets=True\"\n      providerName=\"System.Data.SqlClient\" /&gt;\n  &lt;/connectionStrings&gt;\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework\"&gt;\n      &lt;parameters&gt;\n        &lt;parameter value=\"v11.0\" /&gt;\n      &lt;/parameters&gt;\n    &lt;/defaultConnectionFactory&gt;\n  &lt;/entityFramework&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>When I try to execute:</p>\n\n<pre><code>  var context = new HeliosCp.Data.HeliosCpDataContext();\n  var test = context.GetTests().FirstOrDefault();\n</code></pre>\n\n<p>I get a MetadataException \"Schema specified is not valid. Errors: \n(137,6) : error 0063: Precision facet isn't allowed for properties of type int.\n(137,6) : error 0063: Scale facet isn't allowed for properties of type int.\"</p>\n\n<p>I've tried explicitly casting each field in the sproc as Varchar &amp; int, explicitly executing the query (\"SELECT TOP 10 ...\") via the SqlQuery function instead of the sproc, <em>removing</em> the query entirely from the sproc (i.e., leaving nothing in the body of the sproc), and I get the exact same Exception, every time. Any help will be greatly appreciated, thanks.</p>\n"},{"tags":["entity-framework","foreign-keys","many-to-many","constraints","database-migration"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12919200,"title":"Entity Framework migration could not create foreign key constraint","body":"<p>I had 2 tables:</p>\n\n<pre><code>public class Work\n{\n    public int WorkId { get; set; }\n    (...)\n}\n\npublic class Check\n{\n    public int CheckId { get; set; }\n    (...)\n}\n</code></pre>\n\n<p>Then I wanted to add a many to many relationship with payload between them so:</p>\n\n<pre><code>public class WorkCheck\n{\n    [Key, Column(Order = 0)]\n    [ForeignKey(\"Work\")]\n    public int WorkId { get; set; }\n    public virtual Work Work { get; set; }\n\n    [Key, Column(Order = 1)]\n    [ForeignKey(\"Check\")]\n    public int CheckId { get; set; }\n    public virtual Check Check { get; set; }\n\n    (...)\n}\n\n   public class Work\n    {\n        public int WorkId { get; set; }\n        (...)\n        public virtual IList&lt;WorkCheck&gt; WorkChecks { get; set; }\n    }\n\n    public class Check\n    {\n        public int CheckId { get; set; }\n        (...)\n        public virtual IList&lt;WorkCheck&gt; WorkChecks { get; set; }\n    }\n</code></pre>\n\n<p>In the package manager console I ran the command \"Add-Migration WorkCheckTableAdded\" and no errors were shown.</p>\n\n<p>But right after, when I executed the \"Update-Database -verbose\" command, I got the exception:\n<strong>\"Foreign key 'FK_dbo.WorkCheck_dbo.Work_WorkId' references invalid column 'WorkId' in referenced table 'dbo.Work'.\nCould not create constraint. See previous errors.\"</strong></p>\n"},{"tags":["c#",".net","entity-framework","memory-leaks","parallel-processing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12937855,"title":"Using statements / calling Dispose inside static methods","body":"<p>I am developing a utility class that contains static methods that will be frequently called by multiple threads. I am noticing that memory use is growing over time, so it seems to me that I have some memory leaks.</p>\n\n<p>Here is a simple example of the pattern I am using for these static methods:</p>\n\n<pre><code>public static int CreateNewThing(int IDofSomeDBObjectHoldingInfoToCreateNewThing)\n{\n    using(SomeDBContext context = new SomeDBContext(connectionString))\n    {\n        SomeDBObjectHoldingInfoToCreateNewThing createNewThingyInfo = context.SomeDBObjectsHoldingInfoToCreateNewThing.First(obj =&gt; obj.ID == IDofSomeDBObjectHoldingInfoToCreateNewThing);\n        // Do some stuff to create the new object\n        // Return the ID of the newly created thingy...\n        return theNewThingThatWasCreated.ID;\n     }\n}\n</code></pre>\n\n<p>My question is whether using 'using' statements or directly calling Dispose inside static methods actually clears up any memory. Granted, I haven't stated the overall architecture or purpose of this application, but I am also wondering if I'm using the best pattern here. What are the best practices for creating thread-safe utility classes in .NET?</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12934290,"title":"entity framework linq include and grouping","body":"<p>I'm trying  to  to do include and group in in one sentence </p>\n\n<pre><code>var instanceIdList = context.\n    Tracks.\n    Include(\"Services\").\n    GroupBy(x =&gt; x.ServiceId).\n    Take(top);\n</code></pre>\n\n<p>but when I check the result at debug I cant see any of the include values </p>\n\n<p>I tried to do in another way </p>\n\n<pre><code>var objectContext = ((IObjectContextAdapter)context).ObjectContext;\nvar set = objectContext.CreateObjectSet&lt;Track&gt;();\nvar instanceIdList = set.Include(\"Services\").GroupBy(x =&gt; x.ServiceId);\n</code></pre>\n\n<p>this is the classes :\n <em>Track</em></p>\n\n<pre><code>  public partial class Track\n{\n    public long Id { get; set; }\n    public System.Guid ServiceId { get; set; }\n    public Nullable&lt;System.Guid&gt; ServiceInterfaceId { get; set; }\n    public Nullable&lt;System.Guid&gt; ProviderId { get; set; }\n    public System.Guid ServiceInstanceId { get; set; }\n    public System.Guid ActivityParentId { get; set; }\n    public System.Guid ActivityInstanceId { get; set; }\n    public int ActivityType { get; set; }\n    public int ServiceRole { get; set; }\n    public int TrackOrder { get; set; }\n    public System.DateTime Datetime { get; set; }\n    public Nullable&lt;System.Guid&gt; MessageId { get; set; }\n    public int Status { get; set; }\n    public Nullable&lt;int&gt; ESBErrorCode { get; set; }\n    public Nullable&lt;int&gt; ESBTecnicalErrorCode { get; set; }\n    public string ErrorDescription { get; set; }\n    public string PortName { get; set; }\n    public string MachineName { get; set; }\n    public string ConsumerId { get; set; }\n    public string ExternalId { get; set; }\n    public string ConsumerMachineName { get; set; }\n    public int ServiceBehavior { get; set; }\n\n    public virtual Message Message { get; set; }\n}\n</code></pre>\n\n<p><em>Service</em></p>\n\n<pre><code>      public partial class Service\n      {\n        public Service()\n        {\n        this.Providers = new HashSet&lt;Provider&gt;();\n        this.ServiceInterfaces = new HashSet&lt;ServiceInterface&gt;();\n            }\n\n    public System.Guid ServiceId { get; set; }\n    public string ServiceName { get; set; }\n    public string ServiceNumber { get; set; }\n    public Nullable&lt;System.Guid&gt; ModelSchemaId { get; set; }\n\n    public virtual ICollection&lt;Provider&gt; Providers { get; set; }\n    public virtual ICollection&lt;ServiceInterface&gt; ServiceInterfaces { get; set; }\n}\n</code></pre>\n\n<p>but the result is the same</p>\n\n<p>thanks </p>\n\n<p>miki</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12937816,"title":"Unable to initialize the dbcontext with initial data in code first entity model","body":"<p>I am working on asp.net mvc. I am trying to implement Code-First Entity Model. I have follwed the following steps,</p>\n\n<p>1, I have created a class student.cs</p>\n\n<pre><code>public class Student\n{\n    public int StudentID { get; set; }\n    public string StudentName { get; set; }\n    public string Branch { get; set; }\n    public decimal Marks { get; set; }\n    public string Address { get; set; }\n}\n</code></pre>\n\n<p>2, I have craeted context class like,</p>\n\n<pre><code> public class StudentContext:DbContext\n    {\n        public StudentContext()\n        {\n            Database.SetInitializer(new StudentContextInitializer());\n        }\n\n        public DbSet&lt;Student&gt; Student { get; set; }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n        }\n    }\n</code></pre>\n\n<p>3, I have created studentcontextinitializer class like,</p>\n\n<pre><code>public class StudentContextInitializer : DropCreateDatabaseIfModelChanges&lt;StudentContext&gt;\n    {\n        protected override void Seed(StudentContext context)\n        {\n            context.Student.Add(new Student { StudentName=\"madhav\",Branch=\"CSE\",Marks=888,Address=\"AKP\" });\n            context.Student.Add(new Student { StudentName = \"Tirumalesh\", Branch = \"IT\", Marks = 988, Address = \"MDP\" });\n            context.Student.Add(new Student { StudentName = \"Venkat\", Branch = \"ECE\", Marks = 1000, Address = \"BZA\" });\n            context.SaveChanges();\n        }\n    }\n</code></pre>\n\n<p>I am successfully connected to database but i am unable to initialize the dbcontext with some data that means I have hard coded some records in studentcontextinitializer class but i am unable to bind that records into database table. so please guide me.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":12937165,"title":"EF with only a subset of existing tables","body":"<p>I got an existing database with many tables which are accessed using stored procedures only (no O/RM). I'd like to create new tables in this database using Entity Framework and the Code First approach. </p>\n\n<p>Do all the tables in my existing database need to be modelized in my Entity Framework classes? Will I be able to hand-code only the new classes I need in my <code>DbContext</code>? Other tables really need to stay untouched and away from O/RM for the moment.</p>\n\n<p><em><strong>Note:</strong> I'm going to be using the latest EF5.</em></p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12937132,"title":"EF - access saved objects once savechanges is called","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12933960/access-id-of-added-entity-before-savechanges-is-called\">access id of added entity before SaveChanges() is called</a>  </p>\n</blockquote>\n\n\n\n<p>Using EF 4.3.1, how do I get the list of saved objects once savechanges() has been called? I want to get a list of entities that have been added (EntityState = Added), lets call it A. Then I want to create a new list of entities with some of the properties of these entities in A, lets call it B. Then I want to call SaveChanges() i.e. push A and B to the db. Then I want to update each entity in list B with the id of the corresponding item in A.</p>\n\n<p>I'm having an issue getting the id once SaveChanges is called. How can I do this? All of this is occurring in the SaveChanges() which I've overridden.</p>\n"},{"tags":["c#",".net","oracle","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":360,"score":1,"question_id":7512562,"title":"Return entity key after savechanges doesn't work","body":"<p>I have this piece of code</p>\n\n<pre><code>            IMG_UPLOAD_FILES tObjUploadedFile = new IMG_UPLOAD_FILES();\n\n            tObjUploadedFile.UPLOAD_FILE_NAME = \"testname.png\";\n            tObjUploadedFile.SETTINGS_FOLDER_ID = 2;\n\n            dbHandler.IMG_UPLOAD_FILES.AddObject(tObjUploadedFile);\n            dbHandler.SaveChanges(SaveOptions.AcceptAllChangesAfterSave);\n\n            decimal tmpID= tObjUploadedFile.UPLOAD_FILE_ID;\n</code></pre>\n\n<p>the tmpID is still 0 and never return a key.</p>\n\n<p>I have set StoreGeneratedPattern to Identity on the required field.</p>\n\n<p>I'm using the latest ODB.NET from against the ORACLE database.</p>\n\n<p>\\T</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-3","code-first","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":5414,"score":1,"question_id":5465686,"title":"EF 4.1 Code First: \"non-null value of type 'DateTime'\" Issue","body":"<p>After initial dev and testing I have now pointed my MVC3 application at an existing database which contains live data.</p>\n\n<p>However I am getting this error related to the field called Date1 of type \"datetime\".</p>\n\n<pre><code>The 'Date1' property on 'StaffAttachment' could not be set to a 'null' value. You must set this property to a non-null value of type 'DateTime'. \n</code></pre>\n\n<p>Is this telling me that all rows in the date must have a date and not be null? What do I do if I dont want to set a date on specific row?</p>\n\n<p>Can anyone offer advice on resolving this issue?</p>\n\n<p>Thanks Paul</p>\n\n<p>EDIT 1 (Posting Model)</p>\n\n<pre><code>public class StaffAttachment\n{\n    [Key]\n    public int AttachmentID { get; set; }\n\n    public int? StaffID { get; set; }\n\n    public int? TypeID { get; set; }\n\n    [Required]\n    [DisplayName(\"Proof of ID\")]\n    public int? AttachmentTypeID { get; set; }\n\n    [Required]\n    [DisplayName(\"ID Reference\")]\n    public string Reference1 { get; set; }\n\n    public string Reference2 { get; set; }\n\n    public string DateType { get; set; }\n\n    [DisplayName(\"Expiry Date\")]\n    public DateTime Date1 { get; set; }\n\n    [Required]\n    public DateTime Date2 { get; set; }\n\n    public DateTime Date3 { get; set; }\n\n    public DateTime Date4 { get; set; }\n\n    public string AttachmentPath { get; set; }\n\n    public int? ValidatedUserID { get; set; }\n\n    public DateTime ValidatedDate { get; set; }\n\n    public int? CreatedUserID { get; set; }\n\n    public DateTime CreatedDate { get; set; }\n\n    public int? EditedUserID { get; set; }\n\n    public DateTime EditedDate { get; set; }\n\n    public TimeSpan TimeStamp { get; set; }\n\n    public string FileName { get; set; }\n\n    public byte[] FileImage { get; set; }\n\n    public int AttachmentSection { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework","savechanges","audit-logging"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12933960,"title":"access id of added entity before SaveChanges() is called","body":"<p>i'm using EF 4.3.1, I've overridden the SaveChanges() on the context so that I can get a list of the objects and their states and create entries in my audit log table. I need to store the id of the record in the audit log table so i have a reference to it. This is a problem when records are inserted, as I don't have access to the id before it's saved. Is there any way of getting the id at that point?</p>\n\n<pre><code>public override int SaveChanges()\n{\n        ChangeTracker.DetectChanges();\n\n        var objectStateManager = ((IObjectContextAdapter)this).ObjectContext.ObjectStateManager;\n        var modifiedAuditableEntities = objectStateManager.GetObjectStateEntries(EntityState.Modified | EntityState.Added).Where(e =&gt; (IAuditable)e.Entity != null);\n\n        foreach (var entry in modifiedAuditableEntities)\n        {\n            var entity = (IAuditable)entry.Entity;\n\n            if (entity != null)\n            {\n                switch (entry.State)\n                {\n                    case EntityState.Added:\n                        entity.IsAdded = true;\n                        break;\n                    case EntityState.Deleted:\n                        entity.IsDeleted = true;\n                        break;\n                    case EntityState.Modified:\n                        entity.IsModified = true;\n                        break;\n                }\n\n                this.EntitySet&lt;AuditLogEntry&gt;().Add(this.auditLogService.CreateAuditLogEntryForEntity((IAuditable)entry.Entity));\n            }\n        return base.SaveChanges();\n}\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-4","asp.net-web-api"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12844064,"title":"Easier way of avoiding duplicates in entity framework","body":"<p>Can anyone provide an easier more automatic way of doing this?  </p>\n\n<p>I have the following save method for a FilterComboTemplate model.  The data has been converted from json to a c# model entity by the webapi.</p>\n\n<p>So I don't create duplicate entries in the DeviceProperty table I have to go through each filter in turn and retrieve the assigned DeviceFilterProperty from the context and override the object in the filter.  See the code below.</p>\n\n<p>I have all the object Id's if they already exist so it seems like this should be handled automatically but perhaps that's just wishful thinking.</p>\n\n<pre><code>public void Save(FilterComboTemplate comboTemplate)\n{\n    // Set the Device Properties so we don't create dupes\n    foreach (var filter in comboTemplate.Filters)\n    {\n        filter.DeviceProperty = context.DeviceFilterProperties.Find(filter.DeviceFilterProperty.DeviceFilterPropertyId); \n    }\n\n    context.FilterComboTemplates.Add(comboTemplate);\n    context.SaveChanges();\n}\n</code></pre>\n\n<p>From here I'm going to have to check whether any of the filters exist too and then manually update them if they are different to what's in the database so as not to keep creating a whole new set after an edit of a FilterComboTemplate.</p>\n\n<p>I'm finding myself writing a lot of this type of code.  I've included the other model classes below for a bit of context.</p>\n\n<pre><code>public class FilterComboTemplate\n{\n    public FilterComboTemplate()\n    {\n        Filters = new Collection&lt;Filter&gt;();\n    }\n\n    [Key]\n    public int FilterComboTemplateId { get; set; }\n\n    [Required]\n    public string Name { get; set; }\n\n    [Required]\n    public ICollection&lt;Filter&gt; Filters { get; set; }\n}\n\npublic class Filter\n{\n    [Key]\n    public int FilterId { get; set; }\n\n    [Required]\n    public DeviceFilterProperty DeviceFilterProperty { get; set; }\n\n    [Required]\n    public bool Exclude { get; set; }\n\n    [Required]\n    public string Data1 { get; set; }\n}\n\npublic class DeviceFilterProperty\n{\n    [Key]\n    public int DeviceFilterPropertyId { get; set; }\n\n    [Required]\n    public string Name { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework","code-generation","t4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12934693,"title":"T4 template and EF with Code Generator from database schema Application","body":"<p>I am currently in process of putting a process (using a windows application) in place where EF's POCO objects classes can be generated by pointing this app to the database table(s).</p>\n\n<p>I have seen T4 templates and the VS Addin which helps to achieve this in VS. However it requires T4 template file on the VS solution. We do not want to go through this route. What we want is to just copy the classes generated by this app to the solution so it can be used.</p>\n\n<p>The way T4 template works is that as soon as you make a change in the template it applies to the Class file. What I would like to do is to point the new App to the database and say tables A,B,C. The app will read the columns,types,relationships and create corresponding classes to a folder. Developer then Copy these classes and paste into VS solution. Longer terms plan then to extend this app to write repository classes.</p>\n\n<p>I have rough idea but not a clear picture. Does anyone has any pointers about how about can I go to achieve this? </p>\n\n<p>Thanks</p>\n\n<p>Edit: This is purely in mind using EF Code first.</p>\n"},{"tags":["vb.net","entity-framework","dependency-injection","entity-framework-5","ef-database-first"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":260,"score":1,"question_id":12850340,"title":"Dependency Injection with Entity Framework 5 Database First. Getting Started?","body":"<p>I am looking at creating a VB.NET 11 WPF MVVM application using Entity Framework 5 and Database First (Connecting to SQL Server 2008 R2). </p>\n\n<p>I have chosen Database First, as I am migrating an existing solution to WPF MVVM, where the database already exists of course.</p>\n\n<p>I'd like to begin using Dependency Injection so I can Unit Test as much of my code as possible.</p>\n\n<p>I don't seem to be able to find a clear and concise walk-through of how to go about using Dependency Injection with EF DB-First, and in particular with vb.net. Although even a C# example would be fine I'm sure.</p>\n\n<p>What I'd really like is a simple step by step guide explaining how to setup the solution, how to setup each part ready for Dependency Injection etc, but these seem hard to come by.</p>\n\n<p>So far, I've created the Solution and it's Projects, as follows;</p>\n\n<ul>\n<li><strong>DBAccess</strong> - This houses nothing but my .edmx file, and a small mod to be able to supply the ConnectionString to the constructor.</li>\n<li><strong>DBControl</strong> - This houses the various classes which I use to provide a layer between my EDMX and my ViewModels. Specifically, I'm filling Complex Types (Which I have created using the designer) here for displaying \"Friendlier\" data via the UI, as well as converting these \"Friendly\" Complex Types to the mapped entities for saving / Updating. I have one class per table in my database. Each with two <em>\"FetchFriendlyRecords\"</em> methods (One accepts Filters) and an \"<em>AddUpdateFriendlyRecord</em>\" method. I have created an Interface for each class. Each class accepts a DbContext in it's constructor, and I'm simply passing my DBContext from the DBAccess Project.</li>\n<li><strong>MainUI</strong> - This houses my MVVM layers, and references each class in the DBControl Project in order to provide DataBinding etc.</li>\n</ul>\n\n<p>I've seen suggested that, instead of spending time writing a complex solution to be able to unit test with EF, it's simpler to create a firm mock database with test data populated, and simply point the code at the mock database, rather than the live one. However, I'd prefer to be able to create an in memory solution that would run without any need to hit SQL Server at all.</p>\n\n<p>Any help would be great, including telling me if I'm going about this all wrong!! </p>\n\n<p><strong>Update:</strong></p>\n\n<p>I have taken the solution provided by Paul Kirby below, and created a \"Sort of\" Repository Pattern I believe.</p>\n\n<p>I created an interface;</p>\n\n<pre><code>Public Interface IFriendlyRepository(Of T)\n        ReadOnly Property FriendlyRecords As ObservableCollection(Of T)\n        Function GetFilteredFriendlyRecords(predicates As List(of Func(Of T, Boolean))) As ObservableCollection(Of T)\n        Function AddEditFriendlyRecord(ByVal RecordToSave As T) As EntityException\n        Sub SaveData()\nEnd Interface\n</code></pre>\n\n<p>I then implemented this interface on a class by class basis;</p>\n\n<pre><code>Namespace Repositories\n    Public Class clsCurrenciesRepository\n        Implements Interfaces.IFriendlyRepository(Of CriticalPathDB.FriendlyCurrencies)\n\n        Private _DBContext As CriticalPathEntities                          'The Data Context\n\n        Public Sub New(ByVal Context As DbContext)   \n            _DBContext = Context\n        End Sub\n\n        Public ReadOnly Property FriendlyRecords As ObservableCollection(Of FriendlyCurrencies) Implements Interfaces.IFriendlyRepository(Of CriticalPathDB.FriendlyCurrencies).FriendlyRecords\n            Get\n                ' We need to convert the results of a Linq to SQL stored procedure to a list,\n                ' otherwise we get an error stating that the query cannot be enumerated twice!\n                Dim Query = (From Currencies In _DBContext.Currencies.ToList\n                             Group Join CreationUsers In _DBContext.Users.ToList\n                             On Currencies.CreationUserCode Equals CreationUsers.User_Code Into JoinedCreationUsers = Group\n                             From CreationUsers In JoinedCreationUsers.DefaultIfEmpty\n                             Group Join UpdateUsers In _DBContext.Users.ToList\n                             On Currencies.LastUpdateUserCode Equals UpdateUsers.User_Code Into JoinedUpdateUsers = Group\n                             From UpdateUsers In JoinedUpdateUsers.DefaultIfEmpty\n                             Where (Currencies.Deleted = False Or Currencies.Deleted Is Nothing)\n                             Order By Currencies.NAME\n                             Select New FriendlyCurrencies With {.Currency_Code = Currencies.Currency_Code,\n                                                                .NAME = Currencies.NAME,\n                                                                .Rate = Currencies.Rate,\n                                                                .CreatedBy = If(Currencies.CreationUserCode Is Nothing, \"\", CreationUsers.First_Name &amp; \" \" &amp; CreationUsers.Last_Name),\n                                                                .CreationDate = Currencies.CreationDate,\n                                                                .CreationUserCode = Currencies.CreationUserCode,\n                                                                .Deleted = Currencies.Deleted,\n                                                                .LastUpdateDate = Currencies.LastUpdateDate,\n                                                                .LastUpdatedBy = If(Currencies.LastUpdateUserCode Is Nothing, \"\", UpdateUsers.First_Name &amp; \" \" &amp; UpdateUsers.Last_Name),\n                                                                .LastUpdateUserCode = Currencies.LastUpdateUserCode}).ToList\n\n                Return New ObservableCollection(Of FriendlyCurrencies)(Query)\n            End Get\n        End Property\n\n        Public Function GetFilteredFriendlyRecords(predicates As List(of Func(Of FriendlyCurrencies, Boolean))) As ObservableCollection(Of FriendlyCurrencies) Implements Interfaces.IFriendlyRepository(Of CriticalPathDB.FriendlyCurrencies).GetFilteredFriendlyRecords\n            Dim ReturnQuery = FriendlyRecords.ToList\n\n            For Each Predicate As Func(Of FriendlyCurrencies, Boolean) In predicates\n                If Predicate IsNot Nothing Then\n                    ReturnQuery = ReturnQuery.Where(Predicate).ToList\n                End If\n            Next\n            Return New ObservableCollection(Of FriendlyCurrencies)(ReturnQuery)\n        End Function\n\n        Public Function AddEditFriendlyRecord(ByVal RecordToSave As FriendlyCurrencies) As EntityException Implements Interfaces.IFriendlyRepository(Of CriticalPathDB.FriendlyCurrencies).AddEditFriendlyRecord\n\n            Dim dbCurrency As New Currency\n            ' Check if this Staff Member Exists\n            Dim query = From c In _DBContext.Currencies\n                        Where c.Currency_Code = RecordToSave.Currency_Code\n                        Select c\n\n            ' If Asset exists, then edit.\n            If query.Count &gt; 0 Then\n                dbCurrency = query.FirstOrDefault\n            Else\n                'Do Nothing\n            End If\n\n            dbCurrency.Currency_Code = RecordToSave.Currency_Code\n            dbCurrency.NAME = RecordToSave.NAME\n            dbCurrency.CreationDate = RecordToSave.CreationDate\n            dbCurrency.CreationUserCode = RecordToSave.CreationUserCode\n            dbCurrency.LastUpdateDate = RecordToSave.LastUpdateDate\n            dbCurrency.LastUpdateUserCode = RecordToSave.LastUpdateUserCode\n            dbCurrency.Deleted = RecordToSave.Deleted\n\n            ' Save Asset Object to Database\n            If query.Count &gt; 0 Then\n                ' If Asset exists, then edit.\n                Try\n                    '_dbContext.SaveChanges           'We could save here but it's generally bad practice\n                Catch ex As EntityException\n                    Return ex\n                End Try\n            Else\n                Try\n                    _DBContext.Currencies.Add(dbCurrency)\n                    '_dbContext.SaveChanges           'We could save here but it's generally bad practice\n                Catch ex As EntityException\n                    Return ex\n                End Try\n            End If\n            Return Nothing\n        End Function\n\n        Public Sub SaveData() Implements Interfaces.IFriendlyRepository(Of CriticalPathDB.FriendlyCurrencies).SaveData\n            _DBContext.SaveChanges()\n        End Sub\n    End Class\nEnd Namespace\n</code></pre>\n\n<p>I used constructor injection to insert the dbContext into the class. </p>\n\n<p>I had hoped to be able to mock up a fake dbContext using my existing context and the <a href=\"http://effort.codeplex.com/\" rel=\"nofollow\">\"Effort\" Unit Testing Tool</a>.</p>\n\n<p>However, I don't seem to be able to get this to work.</p>\n\n<p>In the interim, in my Unit Test Project, I am dropping (If it already exists) and creating an empty test database, with the SQLCMD command, using the same schema as my live database.</p>\n\n<p>I then create a dbContext referencing the Test Database, populate it with test data, and test against this.</p>\n\n<p>As a note, I will be refactoring my \"Add/Edit\" method to work with an actual base Entity, rather than my \"Friendly\" complex version, this was the simplest method at the time.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","razor","content-management-system","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12915235,"title":"What content management systems are available for MVC3 or MVC4 with the Razor Syntax?","body":"<p>When mvc3 with razor first came out I was drawn to it and one of the first sites I created was a content management systems (CMS). I did this mostly because it was a simple way to learn mvc3, and because there were no other CMS's available to use.</p>\n\n<p>Lately I have come back to my old application, to make it more efficient and complete. I assume that by now there are a good amount of CMS's (free, open source and purchasable,) that are built with MVC3/MVC4. However, I've only found a couple that are MVC3/MVC4 and use the Razor Syntax. Since mvc3 and razor have been around for a while (not to exclude mvc4,) I want to know what CMS's are available for these frameworks? Especially if they use entity-framework?</p>\n\n<p>Also, which of these do you think is best, and why?</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework",".net-4.0","lazy-loading","eager-loading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12933340,"title":"Lazy Load Fail on Property using expression in relational tree","body":"<p>I have a function which returns a list via an expression.</p>\n\n<pre><code>  Public Function Debits() As List(Of GLCode)\n    Return GeneralLedgers.Select(Function(x) x.DebitCode).Distinct().ToList()\n  End Function\n</code></pre>\n\n<p>When trying to call this function from another expression I get the error \"The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.\" on DebitCode</p>\n\n<p>However I know the context is not being disposed as I can load the property from the Quickwatch window. Lazy loading is not loading the Debitcodes which are obviously needed.</p>\n\n<p>I can't use the context as Im inside an expression and so can't use Include either\nI have tried turning eagar loading on with on at the top level with no effect</p>\n\n<p>Any ideas :)</p>\n"},{"tags":["c#","entity-framework","orm"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12928803,"title":"How to specify left join in EF?","body":"<p>My model:</p>\n\n<pre><code>public partial class history_builds\n{\n    public int ID { get; set; }\n    public int build { get; set; }\n    public int br { get; set; }\n    public int tag { get; set; }\n    public string line { get; set; }\n    public int rev { get; set; }\n    public int user_ID { get; set; }\n    public string distrib_path { get; set; }\n    public string setup_path { get; set; }\n    public System.DateTime build_date { get; set; }\n    public string product { get; set; }\n}\n\npublic partial class history_uploads\n{\n    public int ID { get; set; }\n    public int ID_user { get; set; }\n    public string Line { get; set; }\n    public int Build { get; set; }\n    public string Distrib { get; set; }\n    public System.DateTime Time_upload { get; set; }\n    public int Status { get; set; }\n}\n\npublic partial class user\n{\n    public int ID { get; set; }\n    public string Name { get; set; }\n    public int ID_group { get; set; }\n}\n</code></pre>\n\n<p>Context:</p>\n\n<pre><code>public DbSet&lt;history_builds&gt; history_builds { get; set; }\npublic DbSet&lt;history_uploads&gt; history_uploads { get; set; }\npublic DbSet&lt;user&gt; users { get; set; }\n</code></pre>\n\n<p>I try to do left join like this <a href=\"http://stackoverflow.com/questions/5537995/entity-framework-left-join\">Entity framework left join</a>  </p>\n\n<pre><code>var items = entities.history_builds\n    .Join(\n        entities.users.DefaultIfEmpty(),\n        hb =&gt; hb.user_ID,\n        u =&gt; u.ID,\n        (hb, u) =&gt;\n            new {\n                hb.distrib_path,\n                hb.setup_path,\n                hb.build_date,\n                hb.build,\n                User = (u == null ? String.Empty : u.Name),\n                hb.rev\n            }\n    )\n    .Join(entities.history_uploads.DefaultIfEmpty(),\n        hb =&gt; hb.build,\n        hu =&gt; hu.Build,\n        (hb, hu) =&gt;\n            new HistoryBuidItem {\n                Revision = hb.rev,\n                Build = hb.build,\n                DistribPath = hb.distrib_path,\n                SetupPath = hb.setup_path,\n                BuildDate = hb.build_date,\n                User = hb.User,\n                IsUpload = (hu == null ? true : false)\n            }\n    )\n    .Where(x =&gt; ids.Contains(x.Revision))\n    .ToList();\n</code></pre>\n\n<p><strong>But it doesn't work, EF still emit inner join sql code, what is wrong?</strong></p>\n"},{"tags":["entity-framework","key"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12930785,"title":"key non identity on model creating","body":"<p>I do project in entity framework and i want my key to be <strong>non</strong> identity , i define it in the model building:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n  modelBuilder.Entity&lt;trip&gt;().HasKey(p =&gt;  p.trip_id );\n}\n</code></pre>\n"},{"tags":["entity-framework","many-to-many","fluent"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12918535,"title":"many to many 2 way relationship with EF5","body":"<p>I have the following fluent configuration for a simple many to many relationship between user and roles. I need navigation properties both ways, and therefore have a collection of Users in Role, and vice versa. </p>\n\n<p>When I insert a new entity into User, EF attempts to insert a Role_Id column, when I have mapped it using the following. The column is clearly RoleId, not Role_Id, moreover it's in a many to many table. There cannot be a Role_Id on the User.</p>\n\n<p>I imagine by having a collection on both sides EF is getting confused somehow.</p>\n\n<pre><code>modelBuilder.Entity&lt;User&gt;().HasMany(_ =&gt; _.Roles).WithMany()\n                        .Map(_ =&gt; \n                        {\n                            _.MapLeftKey(\"UserId\");\n                            _.MapRightKey(\"RoleId\");\n                            _.ToTable(\"UserRole\", \"dbo\");\n                        });         \n</code></pre>\n\n<p>When I attempt to create the relationship the other way, by putting the following configuration after the above one, I get an exception stating that the relationship is already defined.</p>\n\n<pre><code>modelBuilder.Entity&lt;Role&gt;().HasMany(_ =&gt; _.Users).WithMany()\n                    .Map(_ =&gt;\n                    {\n                        _.MapLeftKey(\"RoleId\");\n                        _.MapRightKey(\"UserId\");\n                        _.ToTable(\"UserRole\", \"dbo\");\n                    });         \n</code></pre>\n"},{"tags":["c#","entity-framework","linq-to-entities","poco"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":67,"score":2,"question_id":12921559,"title":"Update related property (like a trigger) in a POCO entity, is it possible?","body":"<p>I have the following POCO entity:</p>\n\n<pre><code>public class User \n{\n    [...other properties...]\n\n    public byte Status { get; set; }\n    public DateTime? DataStatus { get; set; }  \n}\n</code></pre>\n\n<p>What I want: inside the <code>set</code> method of the property <code>Status</code>, update <code>DataStatus</code> with the current date when <code>Status</code> is changed, is it possible? </p>\n"},{"tags":["entity-framework","web-config"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":12929598,"title":"Entity Framework 5 built in Database Initializers and Seed method in Code First","body":"<p>I'm using EF 5 and trying to figure out how different built in database initializers are calling the Seed() method. \nThese are my questions:</p>\n\n<p><strong>1. What is a good initializer for seeding the database only when the model changes?<br />\n 2. How to configure each db initializer in web.config?</strong> </p>\n\n<p>Clarifications for my first question:<br />\nSo far I know that these are the built in database initializers of EF 5:</p>\n\n<ul>\n<li>MigrateDatabaseToLatestVersion</li>\n<li>CreateDatabaseIfNotExists</li>\n<li>DropCreateDatabaseIfModelChanges</li>\n<li>DropCreateDatabaseAlways</li>\n</ul>\n\n<p>My problem is in understanding when the Seed method of each of these initializers is called. I've looked inside the EntityFramework dll and checked the code of each of these initializer's InitializeDatabase() method to check when each is called. This is what I found:</p>\n\n<p><strong>MigrateDatabaseToLatestVersion</strong>: I couldn't find out when the seed method is called but from my tests it is called every time the app runs, no matter if there are changes in the model.<br />\n<strong>CreateDatabaseIfNotExists</strong>: I could find that the Seed method is called only when creating the database. If it exists, no seed should be done.<br />\n<strong>DropCreateDatabaseIfModelChanges</strong>: It seems that InitializeDatabase method calls Seed() every time, no matter if the model changed or not. The call is outside the if(context.Dabase.Exists()) check. <br />\n<strong>DropCreateDatabaseAlways</strong>: It is obvious that this will always call Seed method.<br /></p>\n\n<p>Is this correct? If so, it doesn't seem like I could restrict seeding to the case in which the model changes and I should probably write a custom initializer.</p>\n\n<p>Regarding my 2nd question, I know how to configure the MigrateDatabaseToLatestVersion but i find it difficult to write as I don't know the meaning of this declaration (especially the '2 part - is it the value of an enum, in which case how should I figure what is the corresponding number of other initializers?):<br /></p>\n\n<pre><code>&lt;entityFramework&gt;\n&lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\"/&gt;\n&lt;contexts&gt;\n  &lt;context type=\"Digidata.MP.Data.ObjectContext, Digidata.MP.Data\"&gt;\n    &lt;databaseInitializer type=\"System.Data.Entity.MigrateDatabaseToLatestVersion`2[[Digidata.MP.Data.ObjectContext,  Digidata.MP.Data], [Digidata.MP.Data.Migrations.Configuration, Digidata.MP.Data]], EntityFramework\"/&gt;\n  &lt;/context&gt;\n&lt;/contexts&gt;\n</code></pre>\n\n<p></p>\n\n<p>Where can I find an explanation of how to declare the built in initializers in a config file?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12928296,"title":"Entity framework Data sorting","body":"<p>I am working on a project for UserStream(like fb) using entity framework, i have implemented it successfully, I want the functionality that if someone comment on a status/post that status/post should be shown on top,(like in FB)\nFor now the latest post is showing on top but i am unable to sort on the base of comments,below is my DB tables structure</p>\n\n<pre><code>tblPosts:                 tblUsers                     tblUserPosts:          tblPostComments\nPostId bigint PK          UserId bigint PK             UserPostID bigint PK   CommentID bigint PK\nDesc  text                Username  varchar(200)       UserID   bigint FK     PostId bigint FK\nType bingint              Password varchar(100)        PostId   bigint FK     Comment varchar(200)\nURL  varchar(200)                                                             Commentedby bigint FK\nPrivacy varchar(50)                                                           Postedon datetime\nPostedon datetime\n</code></pre>\n\n<p>On my cs code i am retrieving List of tblUserPosts then sorting it on the base of tblPosts Posteddate,but i am not having any information regarding tblPostComments, how can i sort records on the base of Comments as well</p>\n\n<p>This is how i am sorting records</p>\n\n<pre><code>List&lt;tblUserPosts&gt; objlst = new List&lt;tblUserPosts&gt;();\n//Adding items to objlst\n      UserStreamViewModel model = new UserStreamViewModel\n                {\n//I am not having d.tblPostComments or d.tblPosts.tblComments.PostedOn\n                    propResourcesList = objlst.OrderBy(d=&gt;d.tblPosts.PostedOn);\n\n                };\n</code></pre>\n"},{"tags":["linq","entity-framework","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":35,"score":-2,"question_id":12927915,"title":"Using Linq Retrieveing the data to SelectListItem","body":"<p>I have class studentList</p>\n\n<pre><code> public class studentList\n    {\n    public static IEnumerable&lt;SelectListItem&gt; GetStudents(int? ID)\n            {\n//code is required here\n    return ;\n            }\n        }\n</code></pre>\n\n<p>Iam getting ID into this method and now, I require all other IDs from the table, excluding the passed parameter ID using linq.</p>\n\n<p>I have Student table which contains Two fieds StudentID and StudentName,\nNow I require IDs and Names of the students in the above pattern..\nCould any one help me... </p>\n"},{"tags":["entity-framework","entity"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12927615,"title":"Entity Framework 5 Mapping error","body":"<p>I am using EF5. The problem is, if i did any changes ( eg : column name changed) in the Database (SQL) and then \"Update Model from Database...\", then each time i am getting the mapping error. </p>\n\n<p>It was this one before updating the entity\n-Property Type=\"String\" Name=\"Name\" MaxLength=\"50\" FixedLength=\"false\" Unicode=\"true\" />\n.\n.\n.</p>\n\n<p>and after update\n Property Type=\"String\" Name=\"Name\" MaxLength=\"50\" FixedLength=\"false\" Unicode=\"true\" />\n.\n.\n.\n. \nProperty Type=\"String\" Name=\"FullName\" MaxLength=\"50\" FixedLength=\"false\" Unicode=\"true\" /></p>\n\n<p><strong>But in XML view the two property type is existing.</strong>\nI have already updated the Model from database, but it <strong>is not reflected</strong> in the entity. Each time I have to delete the error occurred entity and re-add it again or otherwise i have to delete the property. </p>\n\n<p>How can i solve this problem ...?\nPlease help me...!!</p>\n\n<p>Thanks. :)</p>\n"},{"tags":["entity-framework","domain-driven-design","repository-pattern","aggregate","dbcontext"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":107,"score":2,"question_id":12917484,"title":"How to aggregate repositories?","body":"<p>I am working on a large-scale system for a telecom company. I am new to DDD and having hard time linking different pieces together. Our current system is build using NHibernate. It currently has well over 600 tables and all data access is done using NHibernate but for the new system we will be using EF. Below are few functional areas and examples of database tables in each functional area.</p>\n\n<p>Customers<br>\n    -----> CustomerDemographics<br>\n    -----> CustomerPayments<br>\n    -----> CustomerTransactions  </p>\n\n<p>RoutingEngine<br>\n    -----> InboundRoutes<br>\n    -----> OutboundRoutes  </p>\n\n<p>ProvisioningEngine<br>\n    -----> InboundSwithces<br>\n    -----> OutboundSwitches<br>\n    -----> RouterConfigs<br>\n    -----> GatewayConfigs  </p>\n\n<p>BillingEngine<br>\n    -----> InboundTraffic<br>\n    -----> OutboundTraffic  </p>\n\n<p>Since the system has to be unit-testable, I started abstracting actual entities with a repository pattern. One approach is to create one repository object for each  each database table. Of course all these repository classes could be  derived from a generic repository interface. However this will be adding quite a bit of overhead in terms of code base maintenance. In DDD, I read about this concept of Aggregates but I am not sure how it should be applied specially in context of EF. Should the Aggregate objects are container of these repositories or are these more of a container of related contexts (meaning something along the lines of Bounded DbContexts)?</p>\n"},{"tags":["entity-framework","mapping","entity","code-first","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12924362,"title":"Why is EF code first throwing model backing context exception? Using 4.0.3","body":"<p>Heres the exception:</p>\n\n<pre><code>&gt; The model backing the 'ScannerContext' context has changed since the\n&gt; database was created. Consider using Code First Migrations to update\n&gt; the database (http://go.microsoft.com/fwlink/?LinkId=238269).\n</code></pre>\n\n<p>I get this everytime i run my application. I cant figure out what it means. I think it means something isnt mapped correctly, but i cant figure out what. I am using the code first model, and i have an existing database that I want totally custom mappings for. Right now, I have everything in my classes named the same as my database to eliminate possible cuases.</p>\n\n<p>The Exception is thrown when i try to .Add() the entity to the context.</p>\n\n<p><strong>The Entity as it is in the Database</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/b5dyi.png\" alt=\"DBimage\"></p>\n\n<p><strong>The Entity in my DataLayer</strong></p>\n\n<pre><code>public class EAsset\n{\n    public int i_GID { get; set; }\n    public EAssetType Type { get; set; }\n    public EOrgEnvironment Environment { get; set; }\n    public EUser Contact { get; set; }\n    public string s_Name { get; set; }\n    public string s_Role { get; set; }\n    public DateTime d_Added { get; set; }\n    public DateTime d_LastUpdated { get; set; }\n    public bool b_Retired { get; set; }\n\n    public EAsset()\n    {\n        Type = new EAssetType();\n        Environment = new EOrgEnvironment();\n        Contact = new EUser();\n        d_Added = DateTime.Now;\n        d_LastUpdated = DateTime.Now;\n    }\n}\n</code></pre>\n\n<p><strong>The Context Object</strong> (with attempted table mapping and key assignment)</p>\n\n<pre><code>public class ScannerContext : DbContext\n{\n    public ScannerContext()\n        : base(\"LabDatabase\") { }\n\n    public DbSet&lt;EAsset&gt; EAssets { get; set; }\n    public DbSet&lt;EAssetType&gt; EAssetTypes { get; set; }\n    public DbSet&lt;EOrgEnvironment&gt; EOrgEnvironments { get; set; }\n    public DbSet&lt;EUser&gt; EUsers { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;EAsset&gt;().HasKey(k=&gt;k.i_GID).ToTable(\"t_Assets\");\n        modelBuilder.Entity&lt;EAssetType&gt;().HasKey(k =&gt; k.i_ID).ToTable(\"t_Asset_Types\");\n        modelBuilder.Entity&lt;EOrgEnvironment&gt;().HasKey(k =&gt; k.i_ID).ToTable(\"t_Org_Environments\");\n        modelBuilder.Entity&lt;EUser&gt;().HasKey(k =&gt; k.i_ID).ToTable(\"t_Users\");\n\n        base.OnModelCreating(modelBuilder);\n\n    }\n}\n</code></pre>\n\n<p><strong>The Program</strong></p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        EAsset Entity = new EAsset { s_Name = \"jewri-pc\" };\n        var sContext = new ScannerContext();\n        sContext.EAssets.Add(Entity);\n        sContext.SaveChanges();\n    }\n}\n</code></pre>\n"},{"tags":["c#",".net","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":12926483,"title":"How does Dispose work with Entity Framework","body":"<p>Can someone explain to me how and why do we need to use Dispose()? It's part of the default controller template that comes with ASP.NET MVC 4. Shouldn't the garbage collector in .NET automatically kick in when the object, in this case data from a database is no longer in use?</p>\n\n<p>Is it correct that Dispose() should be used when loading from a database but not regular object assignments?</p>\n"},{"tags":["json","entity-framework","serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":2654,"score":8,"question_id":4754375,"title":"How did I solve the Json serializing circular reference error?","body":"<p>There is post <a href=\"http://stackoverflow.com/questions/4606232/circular-reference-exception-with-json-serialisation-with-mvc3-and-ef4-ctp5w\">here</a> that asks how to solve the circular reference error when returning a serialized object via EF4 CTP5.  I ran into this same problem with a WCF web forms project a while back.</p>\n\n<p>I was able to \"solve\" this problem in my WCF/web forms project and in my MVC3 project.  I don't think it matters what type of project as this appears to be a EF serialization \"thing\".</p>\n\n<p>I solved the problem by disabling ProxyCreation in my ObjectContext constructor like this:</p>\n\n<pre><code>public class MyObjectContext : DbContext, IDbContext\n{\n     public MyObjectContext(string connectionStringName) : base(connectionStringName)\n     {\n        ((IObjectContextAdapter)this).ObjectContext.ContextOptions.ProxyCreationEnabled = false;\n     }\n     public DbSet&lt;Product&gt; Products {get;set;}\n     //etc.\n} \n</code></pre>\n\n<p>My question is: Could someone explain why this would seemingly solve the problem?</p>\n\n<p>I think the problem has to do with navigation properties in my POCO's but after that I am stumped.  Thanks.</p>\n"},{"tags":["entity-framework","table-relationships"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12915980,"title":"Multiple relationships between two tables","body":"<p>I am trying to persist an email object in the database using EF 5 code first</p>\n\n<p>My Classes are as follows:</p>\n\n<pre><code>public class Email\n{\n    public Email()\n    {\n        this.From = new EmailAddress();\n        this.To = new List&lt;EmailAddress&gt;();\n        this.Cc = new List&lt;EmailAddress&gt;();\n    }\n\n    public int Id { get; set; }\n    public EmailAddress From { get; set; }\n    public List&lt;EmailAddress&gt; To { get; set; }\n    public List&lt;EmailAddress&gt; Cc { get; set; }\n    //public List&lt;EmailAddress&gt; Bcc { get; set; }\n    public int EmailPriority { get; set; }\n    [MaxLength(78)]\n    public string Subject { get; set; }\n    public string HtmlBody { get; set; }\n    public string TextBody { get; set; }\n    public DateTime EmailCreated { get; set; }\n    public DateTime EmailSent { get; set; }\n}\npublic class EmailAddress\n{\n    public EmailAddress()\n    {}\n    public EmailAddress(string EmailAddress, string DisplayName)\n    {\n        this.Address = EmailAddress;\n        this.DisplayName = DisplayName;\n    }\n    public int Id { get; set; }\n    public Email Email { get; set; }\n    public int EmailAddressTypeId { get; set; }\n    public string Address { get; set; }\n    public string DisplayName { get; set; }\n}\n</code></pre>\n\n<p>It is creating duplicate email_Id fields in the EmailAddress table.</p>\n\n<p>Is there a way that I can specify the foreign key for the following fields to be EmailAddress.Email_Id:</p>\n\n<ul>\n<li>Email.To </li>\n<li>Email.Cc</li>\n<li>Email.Bcc</li>\n</ul>\n\n<p>I'm assuming that there would be some fluid config to not stick to the convention.</p>\n"},{"tags":["c#","database","entity-framework","sql-server-ce","entity"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12925784,"title":"Fastest Approach to check if Entity already Exists in Database?","body":"<p>At the moment I have something like this, to check if an Entity has already been added (simplified):</p>\n\n<pre><code>WinEveryBetBYeMiContext context = new WinEveryBetBYeMiContext();\nstring firstPlayerName = \"R.Federer\";\nforeach (var player in context.Players)\n{\n       if (player.Name == firstPlayerName)\n       {\n            //Player already exists\n       }\n }\n</code></pre>\n\n<p>But since there can be 100s of Players, this approach looks to me very bad and its also very slow.. </p>\n\n<p>I heard about LINQ TO SQL.. But I don't really know if its better, faster and more effective..\nMaybe someone has a good way to check such things and could help me out.?</p>\n"},{"tags":["sql","entity-framework","sql-injection"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12925649,"title":"When using DbSet<T>.SqlQuery(), how to use named parameters?","body":"<p>I'm a big fan of using named parameters instead of string-based parameter injection. It's type-safe and safe against most forms of SQL injection. In old ADO.NET, I would create a SqlCommand object and a bunch of SqlParameters for my query.</p>\n\n<pre><code>var sSQL = \"select * from Users where Name = @Name\";\nvar cmd = new SqlCommand(conn, sSQL);\ncmd.Parameters.AddWithValue(\"@Name\", \"Bob\");\ncmd.ExecuteReader();\n</code></pre>\n\n<p>Now, in Entity Framework, it appears (on this link) to have regressed to a simple String.Format statement and string injection again: (simplified for discussion)</p>\n\n<pre><code>MyRepository.Users.SqlQuery(\"Select * from Users where Name = {0}\", \"Bob\");\n</code></pre>\n\n<p>Is there a way to use named parameters with the Entity Framework DbSqlQuery class?</p>\n"},{"tags":["entity-framework","gridview"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1345,"score":1,"question_id":2053470,"title":"How to get the entity object from RowDataBound in a EntitydataSource bound gridview","body":"<p>I have a GridView that is bound to an Entity Framework object. I want to access the object in the RowDataBound event of the GridView. When I try to access the DataItem object i get an error stating Unable to cast object of type 'System.Data.Objects.MaterializedDataRecord' to type 'BBM.NailArtGallery.Model.Item'. Apparently the MaterializedDataRecord is some hidden property. Does anyone know how to get around this. My GridView is bound using and EntityDataSource Control. The code is below. </p>\n\n<pre><code>&lt;asp:EntityDataSource ID=\"EntityDataSource1\" runat=\"server\" AutoPage=\"true\" AutoSort=\"true\" OrderBy=\"it.ID\"\n    ConnectionString=\"name=Entities\" DefaultContainerName=\"Entities\" \n    EntitySetName=\"Items\" EntityTypeFilter=\"ItemImage\"  \n    Select=\"it.[ID], it.[Title], it.[IsFeatured], it.[ImageHome], it.[DateEntered]\"&gt;\n&lt;/asp:EntityDataSource&gt;\n\nif (e.Row.RowType == DataControlRowType.DataRow)\n        {          \n            ICustomTypeDescriptor descriptor = (ICustomTypeDescriptor)e.Row.DataItem;\n            if (descriptor != null)\n            {\n                var prop = (PropertyDescriptor)descriptor.GetProperties()[0];\n                Item image = (Item)descriptor.GetPropertyOwner(prop);\n\n            }\n\n        }\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":880,"score":2,"question_id":4545156,"title":"Unable to cast object of type 'System.Data.Objects.MaterializedDataRecord'","body":"<p>I have a GridView connected with the EntityDataSource.</p>\n\n<p>EntityDataSource has a internal parameter for Where Parameters. All is working fine till this point.</p>\n\n<pre><code>    &lt;asp:EntityDataSource ID=\"EntityDataSourceListAuthors\" runat=\"server\" ConnectionString=\"name=CmsConnectionStringEntityDataModel\"\n        DefaultContainerName=\"CmsConnectionStringEntityDataModel\" EnableFlattening=\"False\"\n        EntitySetName=\"CmsAuthors\" EntityTypeFilter=\"\" OrderBy=\"it.FirstName\" Select=\"it.AuthorId, it.UserId, it.FirstName, it.LastName, it.NoteInternal, it.ContentAuthor\"\n        Where=\"it.UserId = @ActiveUser\"&gt;\n    &lt;/asp:EntityDataSource&gt;\n</code></pre>\n\n<hr>\n\n<p>I use an Event RowDataBound an Entity Framework to retrieve a value for every single row and execute some logic.</p>\n\n<p>As soon as I run the code I receive this error:</p>\n\n<pre><code>Unable to cast object of type 'System.Data.Objects.MaterializedDataRecord' to type 'WebProject.DataAccess.DatabaseModels.CmsAuthor'.\n</code></pre>\n\n<p>It seems to me when adding parameters to EntityDataSource smt is changing so I am not able to use EF as before \nAny idea? Thanks Guys!</p>\n\n<hr>\n\n<pre><code>        protected void uxListAuthorsDisplayer_RowDataBound(object sender, GridViewRowEventArgs e)\n    {\n            switch (e.Row.RowType)\n            {\n                // In case type of row is DataRow (a data row of GridView) \n                case DataControlRowType.DataRow:\n                    // Display friendly User's Name instead of his Guid\n                    // Retrive underlying data from a single row rappresented in GridView (use Entity Framwork)                \n                    WebProject.DataAccess.DatabaseModels.CmsAuthor myRow = (WebProject.DataAccess.DatabaseModels.CmsAuthor)e.Row.DataItem;\n                    // Retrive the Guid for a User in a specific row\n                    Guid myUserGuid = (Guid)myRow.UserId;\n                    // Find out used UserName using Guid UserId\n                    MembershipUser mySelectedUser = Membership.GetUser(myUserGuid);\n                    // Write friendly User's Name instead of his Guid value in a specific Grid View Cell\n                    e.Row.Cells[3].Text = mySelectedUser.UserName;\n\n                    // Disable Delete Button if a Content has associated an Author\n                    // Use Entity Framwork for retriving data - Create a \"Context\" for a single Row\n                    using (CmsConnectionStringEntityDataModel context = new CmsConnectionStringEntityDataModel())\n                    {\n                        // Find out Row Id and create an varaible to store it\n                        int myWorkingRowId = myRow.AuthorId;\n                        // Find the Edit Link\n                        HyperLink myEditLink = (HyperLink)e.Row.FindControl(\"uxLinkEditButton\");\n                        // Find the Delete Button\n                        LinkButton myDeleteButton = (LinkButton)e.Row.FindControl(\"uxLinkDeleteButton\");\n                        // Find the System Note Label\n                        Label mySystemNote = (Label)e.Row.FindControl(\"uxSystemNoteDisplayer\");\n                        // Use of Lamba Espression with EF to check if an Author is associated with a Content\n                        CmsContent authorIdInContent = context.CmsContents.FirstOrDefault(x =&gt; x.AuthorId == myWorkingRowId);\n                        // Make visible or invisible the Delete Button if an Author is associated to a Content\n                        if (authorIdInContent != null)\n                        {\n                            myDeleteButton.Visible = false;\n                            mySystemNote.Text = \"Author is being used in Contents\";\n                        }\n                        else\n                        {\n                            myDeleteButton.Visible = true;\n                        }\n\n                        // Programmatically Limiting Functionality depending on User's Roles\n                        myEditLink.Visible = User.IsInRole(\"CMS-ADMINISTRATOR\") || User.IsInRole(\"CMS-AUTHOR\") || User.IsInRole(\"CMS-EDITOR\");\n                        myDeleteButton.Visible = User.IsInRole(\"CMS-ADMINISTRATOR\");\n                    }\n                    break;\n            }\n        }\n</code></pre>\n"},{"tags":["c#","performance","entity-framework","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":1283,"score":8,"question_id":4355474,"title":"How do I speed up DbSet.Add()?","body":"<p>I have to import about 30k rows from a CSV file to my SQL database, this sadly takes 20 minutes.</p>\n\n<p>Troubleshooting with a profiler shows me that <strong>DbSet.Add is taking the most time, but why?</strong></p>\n\n<p>I have these Entity Framework Code-First classes:</p>\n\n<pre><code>public class Article\n{\n    // About 20 properties, each property doesn't store excessive amounts of data\n}\n\npublic class Database : DbContext\n{\n    public DbSet&lt;Article&gt; Articles { get; set; }\n}\n</code></pre>\n\n<p>For each item in my for loop I do:</p>\n\n<pre><code>db.Articles.Add(article);\n</code></pre>\n\n<p>Outside the for loop I do:</p>\n\n<pre><code>db.SaveChanges();\n</code></pre>\n\n<p>It's connected with my local SQLExpress server,   but I guess there isn't anything written till SaveChanges is being called so I guess the server won't be the problem....</p>\n"},{"tags":["c#","asp.net","linq","entity-framework"],"answer_count":6,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":356,"score":2,"question_id":12767721,"title":"LINQ Query matching two lists of items","body":"<p>my issue is that I have an attribute as 'attribute' coming in from entity framework.\nSo I retrieve this object which has a list of attribute tags, they are accessible via <code>attribute.AttributeTags</code>. Now I have a <code>asp:TextBox</code> where users can edit, remove and add new tags (comma separated). (On page load I am adding the attribute tags to this <code>TextBox</code>)</p>\n\n<p>After a postback on the page I am returning the user input and splitting it into an array of strings and storing it in a variable called <code>AttributeTags</code>.</p>\n\n<p>Now, I would like to add new tags that are not contained in the original <code>attributes</code> list coming from EF and would like to <code>remove</code> the ones that are contained in <code>attributes</code> but not found in the user input string array <code>AttributeTags</code>.</p>\n\n<p>I am doing something like this:</p>\n\n<pre><code>        BusinessObjects.Attribute attribute = db.Attributes.FirstOrDefault(a =&gt; a.attribute_id == AttributeID);\n        string[] AttributeTags = txtAttributeTags.Text.Split(new string[] { \",\" }, StringSplitOptions.RemoveEmptyEntries);\n        foreach (var item in AttributeTags)\n        {\n            if (!attribute.AttributeTags.Any(t =&gt; t.value == item))\n            {\n                AttributeTag tag = new AttributeTag { value = item, timestamp = DateTime.Now };\n                attribute.AttributeTags.Add(tag);\n            }\n            else\n            {\n                AttributeTag tag = attribute.AttributeTags.FirstOrDefault(t =&gt; t.value == item);\n            }\n        }\n</code></pre>\n\n<p>But I'm sort of stuck here since i'm fairly new to LINQ and EF.</p>\n"},{"tags":["wpf","visual-studio-2010","entity-framework","datasource"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12916366,"title":"How to add an existing data model as a Data Source in Visual Studio 2010?","body":"<p>I'm experimenting with a simple WPF application with a .edmx file as the Data source in Visual Studio 2010. </p>\n\n<p>I don't know what I did, but suddenly the data source pane/window is now empty, but the .edmx file is still part of my project. </p>\n\n<p>The data source window only has the option to \"Add New Data Source\"; how do I make make it use the existing entity model as the data source? </p>\n"},{"tags":["asp.net","vb.net","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":155,"score":1,"question_id":12632164,"title":"EntityFramework using with database foreign key","body":"<p>Actually I spend whole day on the EntityFramework for foreign key.\nassume we have two table.\nProcess(app_id,process_id)\nLookupProcessId(process_id, process_description)</p>\n\n<p>you can understand two tables with names, first table ,use process_id to indicate every application, and description is in the seoncd table.\nActually i try many times and figure out  how to do inquery: it was like</p>\n\n<pre><code>Dim result = (from x in db.Processes where x.LookupProcess is (from m in db.LookupProcessIds where descr = \"example\" select m).FirstOrDefault() select x).FirstOrDefault()\n</code></pre>\n\n<p>First I want to ask is there easier way to do it.</p>\n\n<p>Second i want to ask question is about insert</p>\n\n<pre><code> p As New AmpApplication.CUEngData.Process\n    p.app_id=100\n    p.LookupProcess = (from m in db.LookupProcessIds where descr = \"example\" select m).FirstOrDefault()\n db.AddToProcesses(p)\n db.SaveChanges()\n</code></pre>\n\n<p>from appearance it looks fine, but it give me error says\nEntities in 'AmpCUEngEntities.Processes' participate in the 'FK_Process_LookupProcess' relationship. 0 related 'LookupProcess' were found. 1 'LookupProcess' is expected.</p>\n\n<p>can i ask is that insert wrong? and is that my query correct?</p>\n"},{"tags":["ruby-on-rails","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12923959,"title":"Equivalent to Rails' polymorphic associations in Entity Framework","body":"<p>I'm working to port part of an existing Ruby on Rails application to .NET MVC 4 and Entity Framework 5 (don't ask), and need some help replicating some ORM functionality, particularly Rails' polymorphic associations.</p>\n\n<p>I would rather not change the existing database structions.  I'll give one example of what I'm doing -- here's what the database looks like:</p>\n\n<pre><code>CREATE TABLE tags (\n    id integer PRIMARY KEY,\n    name nvarchar(128) NOT NULL,\n    UNIQUE (name)\n);\n\nCREATE TABLE taggings (\n    id integer PRIMARY KEY,\n    tag_id integer REFERENCES tags(id) ON DELETE CASCADE,\n    taggable_id integer,\n    taggable_type nvarchar(255),\n);\n\nCREATE TABLE stories (\n    id integer PRIMARY KEY,\n    name nvarchar(128) NOT NULL\n    [more stuff]\n);\n\nCREATE TABLE assets (\n    id integer PRIMARY KEY,\n    name nvarchar(128) NOT NULL\n    [more stuff]\n);\n</code></pre>\n\n<p>The Taggings model is associated with several others, such as Story, Asset, etc.  Records in this table looks like:</p>\n\n<pre><code>INSERT INTO taggings values (1, 1, 1234, 'Story');\nINSERT INTO taggings values (2, 343, 69, 'Asset');\nINSERT INTO taggings values (3, 200, 42, 'Asset');\n</code></pre>\n\n<p>Thus, both the Asset and Story models in the domain have a one-to-many relationship with Taggings.  I'd like to model (Fluent API) this relationship on my C# Story and Asset classes.  </p>\n\n<p>Is there a way to specify this, perhaps with an additional condition (Tagging.taggable_type = 'Story') when defining the relationship?  I don't need to navigate the other direction (from Tagging to Story/Asset).</p>\n"},{"tags":["c#","linq","entity-framework","resharper"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":12923497,"title":"Using Queryable instead of Extension Method","body":"<p>ReSharper has proposed me to make the following changes:</p>\n\n<p>From:</p>\n\n<pre><code>foreach (var item in db.Proposta.GroupBy(x =&gt; x.StatusProposta.Nome))\n{\n    ...\n}\n</code></pre>\n\n<p>To:</p>\n\n<pre><code>foreach (var item in Queryable.GroupBy(db.Proposta, x =&gt; x.StatusProposta.Nome))\n{\n    ...\n}\n</code></pre>\n\n<p>The message is: <strong>Invoke method 'GroupBy' as static method</strong></p>\n\n<p>I'm using <strong>Entity Framework</strong> and <strong>db</strong> is my context.</p>\n\n<p>I wonder what advantages may I get or problems I can avoid with such a change.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12907056,"title":"How to use updatable views in entity framework using code first","body":"<p>We're using entity framework code first for DB tables. Now the data base has been moved to another  dev server and the DBA has created updatable view to work with instead of tables. I changed the connection string and it started giving error \"CREATE TABLE permission denied in database............\"\nLooked like since the table is not there is the DB, EF is trying to create one. I followed the steps at \n<a href=\"http://blog.3d-logic.com/2012/05/28/entity-framework-code-first-and-pre-generated-views/\" rel=\"nofollow\">a link</a></p>\n\n<p><a href=\"http://blogs.msdn.com/b/alexj/archive/2009/09/01/tip-34-how-to-work-with-updatable-views.aspx\" rel=\"nofollow\">a link</a></p>\n\n<p>Basically created the edmx file and manually remove DefininingQuery tags and change store:views to tables and generate view and add to the project. But I am still getting the same error.                                                                                </p>\n\n<p>I am new to EF and not clearly understand what I am doing here. Basically I need to tell EF from here on wards use this database and instead of the tables used earlier, use these updatable views. I am not sure database migration is needed here. I would appreciate any help. thanks</p>\n"},{"tags":["sql-server","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12919896,"title":"Building Many-to-many query with EF","body":"<p>I'm using EF5 with .net 4.0 and I have 3 entities - User, Project and Interest. I connected User <em>Many2Many</em> Interest and Project <em>Many2Many</em> Interest using FluentAPI (it created additional 2 tables for each relation). Everything works great.</p>\n\n<p>What I want to do is to load all projects per user who has same interests. I tried</p>\n\n<pre><code>Project ... \n  .Where(p =&gt; p.Interests\n               .Any(t =&gt; user.Interests.All(i =&gt; i.Url == t.Url))); \n</code></pre>\n\n<p>(Interest has PK Url). When I perform this query, I get error</p>\n\n<blockquote>\n  <p>Unable to create a constant value of type 'DAL.Models.Interest'. Only primitive types or enumeration types are supported in this context.</p>\n</blockquote>\n\n<p>What is the right query?</p>\n"},{"tags":["c#",".net","entity-framework","sqldatareader"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":101,"score":4,"question_id":12853169,"title":"How does the Entity Framework walks through a collection that is too big?","body":"<p>I am new to Entity Framework.</p>\n\n<p>And I have one concern:</p>\n\n<p>I need to walktrhough a quite big amount of data that is gathered via a LINQ to Entities that combines couple of properties from different entities in an anonymous type.</p>\n\n<p>If I need to read the returned items of this query one by one until the end, am I under the risk of OutOfMemory exception as the collection is BIG or EF uses SqlDataReader implicitly?</p>\n\n<p>( Or should I use EntityDateReader to ensure that I am reading the Db in a sequential order (But then I have to generate my query as a string I guess) )</p>\n"},{"tags":[".net","linq","entity-framework",".net-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12921415,"title":"Decompiling Linq queries from .net assembly","body":"<p>I have to decompile an assembly that contains some linq-to-sql code (about 30 methods). I have tried many decompilers like dotpeek, Telerik's just decompile, RedGate's .NET reflactor (evaluation) but all of them decompile linq queries in form of dynamic linq. Is there a free reflactor that can extract original linq queries from .NET assembly?</p>\n\n<p>Regards</p>\n"},{"tags":["c","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12921095,"title":"Finde correct name for EF context","body":"<p>I've added a entity framework model from a database using the wizard called EnterpriseDownloadRepository.edmx</p>\n\n<p>I can't access it when trying to set up the context in the same project.</p>\n\n<p>var context = new FileDownloadEntites()</p>\n\n<p>\"FileDownloadEntites\"  is not recognized by visual studio 2012</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12921194,"title":"visual studio 2010 and entity framework 5.0, can I use it?","body":"<p>Well, really I wanted to update the 4.1 version of entity framework, so in tools-->library package manager-->package manager I use this command:</p>\n\n<p>Install-Package EntityFramework</p>\n\n<p>Then the update started. I saw a message saying that the version 5 is installed. I my project folder I can see two foloders, one with the net4 lib and other with the net5 library.</p>\n\n<p>However, in my references in the project, the 4.1 was replaced with the 4.4, not with the 5.0 version, so I would like to know if I can use the 5.0 version or only the 4.4 version. If I only can use the 4.4 version, why is installed the 5.0 version? I know that the 5.0 version is installed because if I try to install again entity framework through the package manager, I get the following message:</p>\n\n<p>\"'EntityFramework 5.0.0' already installed.\"</p>\n\n<p>Thanks.</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12920322,"title":"Entity Framework 5 Invalid column name","body":"<p>Using EF5 Code First fluent API I receive this error: \"Invalid column name Doctor_ID\" when loading an object.</p>\n\n<pre><code>public class User\n{\n    public int ID { get; set; }\n    ...\n}\n\npublic class Doctor : User\n{\n\n    public int? TitleID { get; set; }\n    public virtual Title Title { get; set; }\n}\n\n\npublic class UserMap : EntityTypeConfiguration&lt;User&gt;\n{\n    public UserMap()\n    {\n        this.ToTable(\"User\", \"Users\");\n\n        // Primary Key\n        this.HasKey(t =&gt; t.ID);\n\n        ...\n\n    }\n}\n\npublic class DoctorMap : EntityTypeConfiguration&lt;Doctor&gt;\n{\n    public DoctorMap()\n    {\n        // Table &amp; Column Mappings            \n        this.ToTable(\"Doctor\", \"Doctors\");\n\n        //this.Property(t =&gt; t.ID).HasColumnName(\"ID\");\n        this.Property(t =&gt; t.TitleID).HasColumnName(\"TitleID\");            \n\n        // Relationships\n        this.HasOptional(t =&gt; t.Title)\n            .WithMany(t =&gt; t.Doctors)\n            .HasForeignKey(d =&gt; d.TitleID);\n\n    }\n}    \n</code></pre>\n\n<p>The code executes the followings successfully:</p>\n\n<pre><code>return (from item in this.DataProvider.Users\n                    where\n                        item.Username == username &amp;&amp; item.Password == password\n                    select new UserBasicInfo() { ID = item.ID, FirstName = item.FirstName, LastName = item.FirstName, Username = item.Username }).FirstOrDefault();\n</code></pre>\n\n<p>After this code executes the followings which cause the \"Invalid column name Doctor_ID\" exception:</p>\n\n<pre><code>User user = this.DataProvider.Users.SingleOrDefault(item =&gt; item.ID == id);\n</code></pre>\n\n<p>the first line of code gets data from the users table only and that is why it executes successfully but why in the second EF5 fails to use ID as key for Doctor table when it accesses it?</p>\n\n<p>Note: I am using type per type TPT.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12920353,"title":"DBContext DBSet query and the no tracking option","body":"<p>Based on other posts such as <a href=\"http://stackoverflow.com/questions/7099134/entity-framework-and-dbcontext-object-tracking\">Entity Framework and DbContext - Object Tracking</a>\nit would appear the simplified DBContext interface doesnt expose the to set No tracking on basic queries.\nA little blog showing how with Object context\n<a href=\"http://blogs.microsoft.co.il/blogs/gilf/archive/2009/02/20/disabling-change-tracking-in-entity-framework.aspx\" rel=\"nofollow\">http://blogs.microsoft.co.il/blogs/gilf/archive/2009/02/20/disabling-change-tracking-in-entity-framework.aspx</a></p>\n\n<p>What is a good approach to loading results via the DbContext as not tracked?\nHow are the performance conscious doing this if using Dbcontext ?\nie have base GetList method I would like to improve for performance reasons.</p>\n\n<pre><code>public DbSet&lt;T&gt; EntityDbSet { get { return _context.Set&lt;T&gt;(); } }\npublic virtual IQueryable&lt;T&gt; GetList(Expression&lt;Func&lt;T, bool&gt;&gt; predicate)\n    {\n         return EntityDbSet.Where(predicate);\n    }\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc-3","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12920402,"title":"EF 4.1 in MVC 3 - Date from form submission overwriting default in DB","body":"<p>So I have a small table and one of the columns is a date, with a a default GETDATE() constraint for use as a timestamp.</p>\n\n<p>Neither the model, nor the ViewModel have a property for this date, but I have an edmx file, so obviously it does.  I don't capture the date at any point in the app.</p>\n\n<p>The issue is that when the changes are submitted to the db, the model contains the date '0001-01-01' and this is overwriting the default in the db.</p>\n\n<p>Is there some way to ignore date from the client side?</p>\n"},{"tags":["asp.net-mvc","entity-framework","design-patterns","repository-pattern"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":12920455,"title":"How should I implement the repository pattern for complex object models?","body":"<p>Our data model has almost 200 classes that can be separated out into about a dozen functional areas. It would have been nice to use domains, but the separation isn't that clean and we can't change it. We're redesigning our DAL to use Entity Framework and <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application\" rel=\"nofollow\">most of the recommendations that I've seen</a> suggest using a Repository pattern. However, none of the samples really deal with complex object models. Some implementations that I've found suggest the use of a repository-per-entity. This seems ridiculous and un-maintainable for large, complex models. Is it really necessary to create a UnitOfWork for each operation, and a Repository for each entity? I could end up with thousands of classes. I know this is unreasonable, but I've found very little guidance implementing Repository, Unit Of Work, and Entity Framework over complex models and realistic business applications.</p>\n"},{"tags":["c#",".net","linq","entity-framework","expression-trees"],"answer_count":5,"favorite_count":16,"up_vote_count":20,"down_vote_count":0,"view_count":20339,"score":20,"question_id":307512,"title":"How do I apply OrderBy on an IQueryable using a string column name within a generic extension method?","body":"<pre><code>public static IQueryable&lt;TResult&gt; ApplySortFilter&lt;T, TResult&gt;(this IQueryable&lt;T&gt; query, string columnName)\n  where T : EntityObject\n{\n  var param = Expression.Parameter(typeof(T), \"o\");\n  var body = Expression.PropertyOrField(param,columnName);\n\n  var sortExpression = Expression.Lambda(body, param);\n  return query.OrderBy(sortExpression);\n}\n</code></pre>\n\n<p>Because the type for OrderBy is not inferred from sortExpression I need to specify it something like this at run time:</p>\n\n<pre><code>var sortExpression = Expression.Lambda&lt;T, TSortColumn&gt;(body, param);\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>return query.OrderBy&lt;T, TSortColumn&gt;(sortExpression);\n</code></pre>\n\n<p>I don't think this is possible however as TSortColumn can only be determined during runtime.</p>\n\n<p>Is there a way around this?</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12918294,"title":"Is there a way to enforce Entity Framework to read one record from Db at a time while I enumerate?","body":"<p>Is there a way to enforce Entity Framework to read one record from Db at a time?</p>\n\n<p>Basicly to make it work like SqlDataReader. (I need to read forward only and I won't change the data at all!)</p>\n\n<p>To simplify what I ask with an example, in the loop below, I want EF to obtain 1 city on each iteration.</p>\n\n<pre><code>var context = new CityEntities();\n\nvar cities = from c in context.Cities\n             select c;\n\nforeach (var c in cities){\n Console.WriteLine(c); //I want to have only 1 city in the memory at this point\n}\n</code></pre>\n\n<p>(<strong>Why</strong> : Because I want to write the query by using the adventage of strongly typing and prevent writing the queris as string in my case)</p>\n"},{"tags":["asp.net","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12919250,"title":"Insert & Delete values in many to many relation table","body":"<p>I want to insert values to many to many relation table \nI'm using entity framework &amp; linq. and I want to build up the Insert query (.net Framework 4)</p>\n\n<p>following are the tables</p>\n\n<p>Menus -\n    menu_id,\n    menu_name,\n    menu_desc</p>\n\n<p>Cater  - cater_id,\n           cater_name, \n           enable_ind</p>\n\n<p>Relation table\nMenu_Cater -    menu_id,\n                    cater_id</p>\n\n<p>I have tried with couple of cases seems not working, \nif there is a SIMPLE way of implementing this insert &amp; delete</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12914611,"title":"How to Customize a \"complex\" mapping between model and database table in Entity Framework Code First","body":"<p>Is it possible to add a custom attribute(Data Annotation), named \"IP\" for example:</p>\n\n<pre><code>public class User\n{\n   public int UserId {get; set;}\n\n   [IP]\n   public string UserIP {get; set;}\n}\n</code></pre>\n\n<p>In this case, [IP] include [MaxLengt(20)] and [Column(\"IP\")], or more other data annotation.</p>\n\n<pre><code>public class User\n{\n   public int UserId {get; set;}\n\n   [MaxLength(20)]\n   [Column(\"IP\")]\n   public string UserIP {get; set;}\n}\n</code></pre>\n\n<p>I also need the [IP] data annotation can work in code first automatic migration.</p>\n\n<p>Any help will be appreciated. Thank you!</p>\n"},{"tags":["sql-server","sql-server-2008","entity-framework","asp.net-membership","connection-string"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12917410,"title":"Move ASPNETDB.mdf from local machine to SQL Server in production","body":"<p>so I have a problem which destroy my brain since a week. I'll try to be the more specific as possible.</p>\n\n<p>I have an Intranet Web Application in ASP.NET Razor MVC3 with <strong>Entity Framework Membership Provider</strong>. So, my ASPNETDB.mdf appears in my App_Data folder, and I also see it in my Server Explorer tab. Until there, everything is normal and alright. </p>\n\n<p>Now that my app is finish, I would like to move my ASPNETDB database on a distant sql server. So I'll do it, I joined my db in MSQL server management studio, and I changed my connection string from :</p>\n\n<pre><code>&lt;add name=\"ApplicationServices\" \nconnectionString=\"data source=.\\SQLEXPRESS;\n                  Integrated Security=SSPI;\n                  AttachDBFilename=|DataDirectory|FactuADH.dbo;\n                  User Instance=true\"    \nproviderName=\"System.Data.SqlServerCe.4.0\" /&gt;\n</code></pre>\n\n<p>to this one : </p>\n\n<pre><code>&lt;add name=\"ApplicationServices\"\n     connectionString=\"Server=SDCCID01;\n                       Initial Catalog=myDbName;\n                       User ID=myid;\n                       Password=mypswd\"\n     providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>So, to test it, I delete my ASPNETDB.mdf from my App_Data, and when I'll try to log on in my app, I can't. Other thing, when I shut down visual studio and re-open it, I have a new ASPNETDB.mdf database which is re-created (empty). It's look like my connection string have no impacte, even when I changed it, without delete my ASPNETDB from my App_Data folder, my application speak with my local aspnetdb, not one on my server. </p>\n\n<p>Any Idea ? </p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","entity-framework-4.3"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":36,"score":-1,"question_id":12916750,"title":"Using non primary unique keys in an association in EF 4.1+","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3992236/entity-framework-alternate-solution-to-using-non-primary-unique-keys-in-an-asso\">Entity Framework: Alternate solution to using non primary unique keys in an association</a>  </p>\n</blockquote>\n\n\n\n<p><a href=\"http://stackoverflow.com/questions/3992236/entity-framework-alternate-solution-to-using-non-primary-unique-keys-in-an-asso\">Entity Framework: Alternate solution to using non primary unique keys in an association</a></p>\n\n<p>Has this been solved yet? I can't seem to find any obvious place for a change log on the net.</p>\n"},{"tags":["entity-framework","wcf-data-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12674237,"title":"Why am i having problems with EF5 with WCF Service Application?","body":"<p>I have created EF Data Services  before but I'm receiving this message everytime I try and create a EF5 - WCF Service Application.</p>\n\n<blockquote>\n  <p>The operation 'ProcessRequestForMessage' could not be loaded because\n  it has a parameter or return type of type\n  System.ServiceModel.Channels.Message or a type that has\n  MessageContractAttribute and other parameters of different types. When\n  using System.ServiceModel.Channels.Message or types with\n  MessageContractAttribute, the method must not use any other types of\n  parameters.</p>\n</blockquote>\n\n<ol>\n<li>I create the WCF Service Application,  </li>\n<li>add references System.Data.Services</li>\n<li>Generate the EF Model</li>\n<li>Changed the Code Generation Strategy to \"Default\" and deleted the \".tt\"</li>\n<li>Inherit the DataService&lt; DBEntities> to my service class (Service1)</li>\n<li>Add the required \"InitilizeService\" routine</li>\n<li>No changes to web.config</li>\n</ol>\n\n<p>When i try and debug I get the message. I am using VS2012</p>\n\n<p>It was a while ago since i've used Data Services but looking at my old VS2010 project that works I have modified web.config to include a service with an endpoint with \"System.Data.Services.IRequestHandler\" as the contract. </p>\n\n<p>I also tried it again aswell as changing the binding to a \"webHttpBinding\" That didn't seem to work either. Any ideas? </p>\n\n<p>If all else fails i guess i can use Open Access ORM with its built in service generation tools because I can atleast get that working.</p>\n\n<p>Best Regards</p>\n\n<p>Chris Leach</p>\n"},{"tags":["c#","winforms","entity-framework","data-binding"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12916567,"title":"Entity Framework - Master-Detail w/Bridge Table","body":"<p>I'm attempting to implement the Entity Framework but seem to be having an issue when I'm trying to utilize a master-detail relationship.  Ideally, I'd like to be able to select a company from a combobox and then populate a subsequent combobox with a list of employee names for the selected company.  I seem to be running into issues trying to achieve this with a many-to-many relationship that has a bridge table containing some additional data.  The following is a simplified version of the three database tables I'm using:</p>\n\n<pre><code>create table Organization.Company\n(\n   CompanyID int not null,\n   CompanyName varchar(40) not null,\n   ServiceRepresentative varchar(20) not null,\n   primary key (CompanyID)\n)\n\ncreate table Person.Employment\n(\n   CompanyID int not null,\n   PersonID uniqueidentifier not null,\n   EmployeeID int not null,\n   FullTime bit not null,\n   HoursPerWeek float null,\n   primary key (CompanyID, PersonID),\n   constraint fk_Company_Employment foreign key (CompanyID) references Organization.Company(CompanyID),\n   constraint fk_Person_Employment foreign key (PersonID) references Person.ContactInfo(PersonID)\n)\n\ncreate table Person.ContactInfo\n(\n   PersonID uniqueidentifier not null,\n   FirstName varchar(40) not null,\n   LastName varchar(40) not null,\n   primary key (PersonID)\n)\n</code></pre>\n\n<p>Im my code-behind I have the following (WinForms):</p>\n\n<pre><code>    private orgEntities db;\n    private BindingSource companyBinding;\n    private BindingSource employeeBinding;\n\n    public MainForm()\n    {\n        InitializeComponent();\n\n        this.db = new orgEntities();\n        this.companyBinding = new BindingSource();\n        this.employeeBinding = new BindingSource();\n\n        this.companyBinding.DataSource = db.Companies.OrderBy(x =&gt; x.CompanyName);\n\n        this.employeeBinding.DataSource = companyBinding;\n        this.employeeBinding.DataMember = \"Employment\";\n\n        this.currentCompanyComboBox.DataSource = companyBinding;\n        this.currentCompanyComboBox.DisplayMember = \"CompanyName\";\n        this.currentCompanyComboBox.ValueMember = \"CompanyID\";\n\n        this.currentEmployeeComboBox.DataSource = employeeBinding;\n        this.currentEmployeeComboBox.DisplayMember = \"ContactInfo.FullName\";  // Generated by extension class\n        this.currentEmployeeComboBox.ValueMember = \"PersonID\";           \n    }\n</code></pre>\n\n<p>The issue I seem to be running into is that only one employee is displayed inside the combobox when a company is selected.  When I change the \"ContactInfo.FullName\" to \"EmployeeID\" I get the full list of EmployeeIDs.  I'm assuming that the entity framework is grabbing the first person and navigating to their FullName property which causes their information to be the only thing displayed.  </p>\n\n<p>Is there any way I can get the full list of names to display in this drop-down with the bridge table (Person.Employment) present or would I be better off just creating a view of combining the Employment and ContactInfo tables together and using that in the edmx file rather than the two separate tables?  </p>\n\n<p>I understand that I may be going about this the wrong way and I would be grateful if someone could point me in the right direction on this one.  Thank you and have a great day!</p>\n"},{"tags":["c#","asp.net",".net","entity-framework","data-binding"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12916270,"title":"Multiplicity constraint violated. The role '' of the relationship '' has multiplicity 1 or 0..1","body":"<p>I have a Tab object. This Tab object has many Questions. Here are my classes:</p>\n\n<pre><code>public abstract class Tab\n{\n    /// &lt;summary&gt; init default values &lt;/summary&gt;\n    public Tab()\n    {\n        // Do some init stuff\n    }\n    public int ID { get;set; }\n\n    //...\n\n    /// &lt;summary&gt; Question for this Tap. Like Quiz-App or Sweepstake &lt;/summary&gt;\n    public virtual ICollection&lt;Tabs.Question&gt; Questions { get; set; }\n\n    //...\n}\n\npublic class Question\n{\n    public int Id { get; set; }\n    public int OrderNumber { get; set; }\n    public string Text { get; set; }\n\n    public virtual Tab Tab { get; set; }\n }\n</code></pre>\n\n<p>And here is the configuration for both classes.</p>\n\n<pre><code>class TabConfig : EntityTypeConfiguration&lt;Tab&gt;\n{\n    public TabConfig()\n    {\n        this.Map(m =&gt; m.Requires(\"AppType\").HasValue&lt;byte&gt;((byte)ApplicationType.Application)).ToTable(\"TmTabs\");\n        this.HasKey(c =&gt; c.ID);\n        this.Property(p =&gt; p.ID).HasColumnName(\"ID\").IsRequired().HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n\n    }\n}\n\npublic class QuestionConfig : EntityTypeConfiguration&lt;Question&gt;\n{\n    public QuestionConfig()\n    {\n        ToTable(\"TmQuestions\");\n        HasKey(q =&gt; q.Id);\n        Property(q =&gt; q.Id).HasColumnName(\"Id\").HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n        Property(q =&gt; q.OrderNumber).HasColumnName(\"OrderNumber\").IsRequired();\n        Property(q =&gt; q.Text).HasColumnName(\"Text\").IsRequired();\n        HasRequired(q =&gt; q.Tab).WithMany(t =&gt; t.Questions).Map(q =&gt; q.MapKey(\"TmTabs_Id\")).WillCascadeOnDelete(false);\n    }\n}\n</code></pre>\n\n<p>And the configuration will be added to the built event like this.</p>\n\n<pre><code>public class ModelContext : DbContext\n{\n\n    public Guid ContractId { get; set; }\n\n    #region construction\n\n    public ModelContext()\n        : base(Tools.DatabaseTools.GetDefaultConnectionString())\n    {\n        ContractId = Guid.Empty;\n    }\n\n    public ModelContext(Guid contractGuid)\n        : base(Tools.DatabaseTools.GetConnectionString(contractGuid))\n    {\n        ContractId = contractGuid;            \n    }\n\n    public ModelContext(string connectionString)\n        : base(connectionString)\n    {\n        ContractId = Guid.Empty;\n    }\n\n    public ModelContext(string connectionString, Guid contractGuid)\n        : base(connectionString)\n    {\n        ContractId = contractGuid;\n    }\n\n\n    public DbSet&lt;Tab&gt; Tabs { get; set; }     \n    public DbSet&lt;Question&gt; Questions { get; set; }\n\n\n    protected override void OnModelCreating(DbModelBuilder builder)\n    {\n        builder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n\n        // tab-table\n        builder.Configurations.Add(new TabConfig());\n\n\n        // Qustions\n        builder.Configurations.Add(new ModelConfig.QuestionConfig());\n\n\n        base.OnModelCreating(builder);\n\n    }\n}\n</code></pre>\n\n<p>On my Edit-Form I bind the whole Tab object to a binding Source and I edit some property of the Tab object and I add Questions.</p>\n\n<p>If I save the Tab object the first time everything works fine. But if I edit the tab object I got this error:</p>\n\n<pre><code>Multiplicity constraint violated. The role 'Question_Tab_Target' of the relationship 'Tabmaker.Common.Question_Tab' has multiplicity 1 or 0..1.\n</code></pre>\n\n<p>The code for the Tab business layer is:</p>\n\n<pre><code>public bool SaveTab&lt;T&gt;(ModelContext context, T tab) where T:Tab\n    {\n        try\n        {\n            // add if detached\n            if (tab.ID == 0)\n            {\n                // new tab code\n            }\n\n\n            // attach/set to be modified if id!=0. if tab is not detached, the property \n            // changes were already tracked and nothing need to be done here\n            var state = context.Entry(tab).State;\n            if (state == EntityState.Detached || state == EntityState.Deleted)\n            {\n                context.Entry(tab).State = EntityState.Modified;\n            }\n            context.SaveChanges();\n            return true;\n        }\n        catch (Exception ex)\n        {\n            // Catch\n    return false\n        }\n    }\n</code></pre>\n\n<p>The error occurs if I ask for the state of the tab-entity:</p>\n\n<pre><code>var state = context.Entry(tab).State;\n</code></pre>\n\n<p>I hope I explained everything as good as possible.</p>\n"},{"tags":["c#",".net","asp.net-mvc","entity-framework"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":12913463,"title":"Throw and catch exception in same method","body":"<p>In my method that writes to a database, I handle errors as shown in the code below. In <code>catch (DbUpdateException ex)</code> I want to re-throw the exception and catch it in the last <code>catch (Exception ex)</code>.</p>\n\n<p>Is that possible and how to do that? Code below doesn't do that.</p>\n\n<pre><code>        using (Entities context = new Entities())\n        {\n            try\n            {\n                context.Office.Add(office);\n                retVal = context.SaveChanges();\n            }\n            catch (DbUpdateException ex)\n            {\n                SqlException innerException = ex.GetBaseException() as SqlException;\n                if (innerException != null &amp;&amp; innerException.Number == (int)SQLErrorCode.DUPLICATE_UNIQUE_CONSTRAINT)\n                {\n                    throw\n                        new Exception(\"Error ocurred\");\n                }\n                //This is momenty where exception is thrown.\n                else\n                {\n                    throw ex;\n                }\n            }\n            catch (Exception ex)\n            {\n                throw\n                    new Exception(\"Error\");\n            }\n        }\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":12840428,"title":"MVC Entity Framework Count","body":"<p>I would like to build a result like: <strong>CategoryID || Count(Searches) || CategoryName</strong> based on two Entity Framework based classes:</p>\n\n<pre><code>public class Category\n{\n    // Primary properties\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string SearchPreviewControllerAction { get; set; }\n}\n\npublic class Search\n{\n    // Primary properties\n    public int Id { get; set; }\n    public string SearchTitle { get; set; }\n    public string SearchStandard { get; set; }\n    public int CategoryId { get; set; }\n\n    // Navigation properties\n    public virtual Category Category { get; set; }\n}\n</code></pre>\n\n<p>I already made a SearchPreview method that returns the Searches based on a search like \"Aston Martin\" that will find in all categories with the words \"Aston Martin\".</p>\n\n<p>The challenge now is to build a method that returns, after the Search of the keywords \"Aston Martin\", in which categories there are those keywords including the count, like \"Auto: 2 | Seeling point: 3 | Shop: 2\"</p>\n\n<p>I am trying to avoid a query for each category to count the number of Searches entry, and I would like to find a <em>GroupBy</em> solution, that takes the SearchPreview method already executed and extract the <em>GroupBy</em> Categories that it contains.</p>\n\n<p>I am using the ViewModel <code>SearchPreviewListCategoriesViewModel</code> to map from the models using Automapper:</p>\n\n<pre><code>public class SearchPreviewListCategoriesViewModel\n{\n    public int CategoryID { get; set; }\n    public string Name { get; set; }\n    public string SearchPreviewControllerAction { get; set; }\n    public int SearchCount { get; set; }\n}\n</code></pre>\n\n<p>Hope somoeone can help me on this.</p>\n\n<p>Thank you.</p>\n\n<p>Regards,</p>\n\n<p>Patrick.</p>\n"},{"tags":["asp.net","asp.net-mvc-3","entity-framework","dbcontext","objectcontext"],"answer_count":1,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":1843,"score":5,"question_id":9020809,"title":"Why does Entity Framework automatically use the ObjectContext instead of the DbContext when mapping database tables using ADO.NET Entity datamodel","body":"<p>I am following the database approach first; I have created the tables in my SQL Server 2008 database, then I map those tables to Entity Framework classes using an ADO.NET Entity Data Model. But when I opened the designer.cs file I found the following code in the class definition which was created automatically:</p>\n\n<pre><code>public partial class PortalEntities : ObjectContext\n</code></pre>\n\n<p>so I have the following three question that get my confused:</p>\n\n<ol>\n<li><p>Why does my <code>PortalEntities</code> class derive from <code>ObjectContext</code> and not <code>DbContext</code> as I was expecting?</p></li>\n<li><p>Is there a major difference between <code>ObjectContext</code> &amp; <code>DbContext</code>, or they are mainly the same and offer that same capabilities</p></li>\n<li><p>When I try to write the something similar to the following code:</p>\n\n<pre><code>Student student = db.Students.Find(id);\n</code></pre></li>\n</ol>\n\n<p>I found that I cannot use <code>.Find()</code> method as I used to do using <code>DbContext</code>, so does this mean that <code>ObjectContext</code> &amp; <code>DbContext</code> have different methods that I can use?</p>\n\n<p>BR</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":141,"score":0,"question_id":12904692,"title":"EF 5 Code First Migration Bulk SQL Data Seeding","body":"<p>I am using EF5 with MVC4. The problem is that I have large data in my DB which I already imported from legacy DB. I want to load seed that data when model changes.\nMy question is how can I seed large amount of data that is already in my DB? </p>\n\n<pre><code>internal sealed class Configuration : MigrationsConfiguration&lt;VoiceLab.Models.EFDataContext&gt;\n{\n    public Configuration()\n    {\n        AutomaticMigrationsEnabled = true;\n    }\n\n    protected override void Seed(VoiceLab.Models.EFDataContext context)\n    {\n     //what to do here to seed thousands or records that are already in db\n    }\n\n}\n</code></pre>\n\n<p>thanks,</p>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":2075,"score":7,"question_id":8435462,"title":"Get Auto Identity Key after Insert via EF","body":"<p>Is there a straight forward way of retrieving a DB auto generated primary key when adding a record via Entity Framework 4.1? </p>\n\n<p>For example:</p>\n\n<pre><code>dbcontext.Entity_Tables.Add(new Entity_Table { item1 = val1, item2 = val2 });\ndbcontext.SaveChanges();\nnewPK = ???;\n</code></pre>\n\n<p>The SQL equivalent would be:</p>\n\n<pre><code>newPK = executeOnDB(\"INSERT INTO Entity_Table (item1, item2) VALUES (val1, val2);SELECT @@Indentity\";);\n</code></pre>\n\n<p>BTW I'm using MySQL but the SQL would be the same as on MSSQL</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12909876,"title":"Entity framework repeating records","body":"<p>I am working on an Entity framework project,In which i have created and entity class of a table</p>\n\n<p>and i am returning its records, below is my method of retrieving records</p>\n\n<pre><code> public UserResource GetData(long Id)\n        {\n            try\n            {\n\n                return dataContext.UserResources.Where(r =&gt; r.UserID == Id &amp;&amp; r.Resource.IsActive == true).FirstOrDefault();\n\n\n            }\n            catch (Exception ex)\n            {\n              throw ex;\n            }\n        }\n</code></pre>\n\n<p>and then on controller i am adding it to List</p>\n\n<pre><code>List&lt;UserResource&gt; objlst = new List&lt;UserResource&gt;();\nfor(int i=0;i&lt;100;i++)\n{\nvar data = objResourceRepository.GetData(userIds[i].UserID);\nif (data != null)\nobjlst.Add(data);\n}\n</code></pre>\n\n<p>userIds are coming from a separate Method\nThe problem  i am having is that the data is adding twice ie one record is adding two times, what is the problem with this code and what alternative should i use GetData() method?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":12911235,"title":"EF partial load","body":"<p>Is there any way to implement a partial load of entity(Entity Framework 5.0) without knowing beforehand which properties are needed?\nFor example, I'd like to have something like:</p>\n\n<pre><code>public class Repository&lt;TEntity&gt;\n{\n   public TEntity Get(int id, params Expression&lt;Func&lt;TEntity, object&gt;&gt;[] propertiesToLoad)\n   {\n       ...\n   }\n}\n\nvar user = repositoty.Get(10, u =&gt; u.Id, u =&gt; u.LastName, u =&gt; u.Email);\n</code></pre>\n\n<p>Or could anyone advice how to implement this manually using Expressions?</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12900758,"title":"Entity Framework Code First mapping situation","body":"<p>I'm trying to port an existing application (using pure ADO.Net) to a new one using EF 4.3 Code First. It is worth mentioning that this is the first time I'm using EF.</p>\n\n<p>Basically I have a suppliers table but with two specialization tables with attributes specific to each of the two types of suppliers.</p>\n\n<p>Here is what the existing database looks like:</p>\n\n<pre><code>create table Supplier(\nid_supplier int not null identity\n--Bunch of other attributes\n);\n\ncreate table Individual(\nid_individual int not null --not identity, gets the same value as the Supplier table\n--Attributes specific to individuals\n);\n\nalter table Individual add constraint fk_individual_supplier\nforeign key(id_individual) references Supplier(id_supplier);\n\ncreate table Corporation(\nid_corporation int not null --not identity, gets the same value as the Supplier table\n--Attributes specific to corporations\n);\n\nalter table Corporation add constraint fk_corporation_supplier\nforeign key(id_corporation) references Supplier(id_supplier);\n</code></pre>\n\n<p>So, as the tables show, a supplier can be either an individual or a corporation.</p>\n\n<p>The existing application is like this:</p>\n\n<ul>\n<li>abstract class Supplier with its attributes</li>\n<li>class Individual deriving from Supplier with its additional attributes</li>\n<li>class Corporation deriving from Supplier with its additional attributes</li>\n</ul>\n\n<p>The Ado.Net code currently works receiving Supplier objects, generating records on Individual table if the object passed is of Individual type or Corporation table if the object passed is of Corporation type.</p>\n\n<p>So, every record on Supplier will have a matching one on either Individual or Corporation. Also, Individual and Corporation tables does not have foreign keys to any other table of the database. Instead, the relations are all with the Supplier table. The table generating the ID is Supplier.</p>\n\n<p>How can I map this with Code First?</p>\n\n<p>At first I thought about keeping my structure, I mean, Supplier abstract class and Individual and Corporation deriving from that. Because I need Entity to insert on Supplier table first (generate identity field), it seems that both Individual and Corporation model classes would be mapped to Supplier table.</p>\n\n<p>But how would it be possible for it to receive the abstract class and insert on either one of the specialization tables depending on the type? I don't think this is possible without custom SQL which makes me think my approach is wrong.</p>\n\n<p>Thanks in advance for helping.</p>\n"},{"tags":["asp.net","sql","entity-framework","filestream"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":12910150,"title":"SQL Server 2008 R2 FILESTREAM using ASP.NET & Entity Framework","body":"<p>I have been searching now for 2 days and still struggling! Any advise would be greatly appreciated!</p>\n\n<p>I am busy creating a web app - an online vehicle trader project.</p>\n\n<p>Tech: VS2010, SQL Server 2008 R2, Entity Data Model 4 (EF), SQL Filestream For Images.</p>\n\n<p>I have my filestream setup correctly and can upload and download images (<code>varbinary(MAX)</code>). </p>\n\n<p>My problems/questions are:</p>\n\n<ol>\n<li><p>I have link in a data grid that will download the image. I don't want to download, I need to display the actual image in the grid.</p></li>\n<li><p>All of the above is done using ADO.NET, how can this be integrated into EF? My understanding is that EF does NOT support filestream? Has this changed in EF4?</p></li>\n</ol>\n\n<p>Maybe I have this whole thing backwards?</p>\n\n<p>Any advise, links to examples would be greatly appreciated!</p>\n"},{"tags":["c#","performance","entity-framework","sql-server-2008"],"answer_count":7,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":4387,"score":3,"question_id":3890974,"title":"Entity Framework 4 : Bad performance with SQL Server 2008","body":"<p>I'am developing a software based on Entity Framework to handle data in a MS SQL Server 2008 database.</p>\n\n<p><strong>[Trouble 1]</strong></p>\n\n<p>I've just tried to insert some small data (<strong>about 2 Mb</strong>) from my progam to the database : the performance are very bad ! It takes <strong>more than 1 minute</strong> to insert these datas !</p>\n\n<p>I've try to generate pre-compiled views, I've got the same results :-(</p>\n\n<p>All my code use a business layer (automatically generated from .edmx file with T4 template) to manage data in a service layer. It is very pratical to navigate in the relations of objects.</p>\n\n<p><strong>How can I improve the performance of these inserts with Entity Framework ?</strong></p>\n\n<p><strong>[Trouble 2]</strong></p>\n\n<p>Also, before inserting data in database with SaveChanges() method, I fill my object context with AddObject() method. I add about 100 000 small objects (about 2 Mb) to my object context with AddObject() : it takes a very long time (more than 10 minutes) !</p>\n\n<p><strong>How can I decrease this time ?</strong></p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>My program must save more than 50 Mb in database in less than 2-3 minutes ? Do you think it will be possible with EF ?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2271,"score":1,"question_id":7172725,"title":"Copy Entity Framework Object","body":"<p>I have a EF4.1 class X and I want to make copy of that plus all its child records.\nX.Y and X.Y.Z</p>\n\n<p>Now if I do the following it returns error.</p>\n\n<p>The property 'X.ID' is part of the object's key information and cannot be modified.</p>\n\n<pre><code>public void CopyX(long ID)\n{\n    var c = db.Xs.Include(\"Y\").Include(\"W\").Include(\"Y.Z\").SingleOrDefault(x =&gt; x.ID == ID);\n    if (c != null)\n    {\n        c.ID = 0;\n        c.Title = \"Copy Of \" + c.Title;\n        for (var m = 0; m &lt; c.Ys.Count; m++)\n        {\n            c.Ys[m].ID = 0;\n            c.Ys[m].XID=0-m;\n            for (var p = 0; p &lt; c.Ys[m].Zs.Count; p++)\n            {\n                c.Ys[m].Zs[p].XID = 0 - m;\n                c.Ys[m].Zs[p].ID = 0 - p;\n            }\n        }\n        for (var i = 0; i &lt; c.Ws.Count; i++)\n        {\n            c.Ws[i].ID = 0 - i;\n            c.Ws[i].XID = 0;\n        }\n        db.Entry&lt;Content&gt;(c).State = System.Data.EntityState.Added;\n        db.SaveChanges();\n    }\n}\n</code></pre>\n\n<p>Or Is there other way of making copy of entity objects. </p>\n\n<p>NOTE: there are multiple properties in each W,X,Y,Z.</p>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":12907703,"title":"How to load a previous build of EntityFramework Version 4.4.0.0 once 5.0.0.0 is installed with NuGet","body":"<p>I have been working on this MVC3 project for months, and was trying to convert some tables that were used for listing values in a Form dropdown list into classes that were not mapped as tables. For some unknown reason I start getting this error using VS2012 Express \"Could not load file or assembly 'EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies\".  </p>\n\n<p>I tried to remove the EntityFramework reference, and than add it back with NewGet but the version offered through NewGet is 5.0.0.0. </p>\n\n<p>My question is how to reference the correct EntityFramework build 4.4.0.0 through NewGet when it only offers version 5.0.0.0?</p>\n"},{"tags":["c#",".net","sql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":115,"score":3,"question_id":12907509,"title":"entity framework not working on table without identity column","body":"<p>I have the following table:</p>\n\n<pre><code>create table tbl\n(\n    id int identity(1,1),\n    val varchar(100)\n)\n</code></pre>\n\n<p>Now when i use Entity Framework to map objects to this table, it works, however when i change the table definition as follows:</p>\n\n<pre><code>create table tbl1\n(\n    id int,\n    val varchar(100)\n)\n</code></pre>\n\n<p>Entity Framework does not maps objects to this table. Any clue as to why is this happening would be appreciated.</p>\n"},{"tags":["c#","sql-server","entity-framework","varbinary"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":109,"score":4,"question_id":12904416,"title":"If I Query a SQL Server VarBinary(MAX) Column, Will the Entire File be Loaded In Memory?","body":"<p>My application is using SQL Server 2008 and we need to add functionality for users to optionally be able to save any file of any size to a database table. I have set up the table similar to this format:</p>\n\n<ul>\n<li>FileStorageID - <code>int (indentity PK)</code> (This is also a foreign key to a different table)</li>\n<li>FileData - <code>varbinary(max)</code></li>\n<li>FileName - <code>varchar(1000)</code></li>\n</ul>\n\n<p>The <code>FileStorage</code> table has a zero-to-one relationship to another table <code>Documentation</code>. The idea is that users can write either write some text, upload a file, or both. </p>\n\n<p>This table looks as follows:</p>\n\n<ul>\n<li>DocumentationID - <code>int (identity PK</code>, FK to an \"IrrelevantInterestingObject\" table)</li>\n<li>Text - <code>varchar(max)</code></li>\n<li>FileStorageID - <code>int (FK</code> to aforementioned FileStorage table)</li>\n</ul>\n\n<p>My question is this: When I query the <code>Documentation</code> table using Entity Framework 5, and a file is present in the database, will the entire file be stored in memory? If yes, what would a reasonable threshold be before there is a noticeable performance issue?</p>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12904378,"title":"Does Entity Framework currently support custom functions in the Where clause?","body":"<p>Entity Framework currently supports table valued functions and custom functions defined in the SSDL, but I can't find any example of it being used as a criteria, in the <code>where</code> clause.</p>\n\n<p>Example:</p>\n\n<pre><code>var query = this.db.People;\nquery = query.Where(p =&gt; FullText.ContainsInName(p.Id, \"George\"));\n</code></pre>\n\n<p>In this example, <code>ContainsInName</code> is my custom function that I want to be executed in the <code>where</code> clause of the query.</p>\n\n<p>Is it supported?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12906601,"title":"Rollback transactions made by two different DBContext saves when an exception occurs","body":"<p>I need to save to two different databases after some user action. Currently, I have the following:</p>\n\n<pre><code>using (EFEntities1 dc = new EFEntities1())\n{\n     dc.USERS.Add(user);\n     dc.SaveChanges();\n}\n\nusing (EFEntities2 dc = new EFEntities2())\n{\n     dc.USERS.Add(user);\n     dc.SaveChanges();\n}\n</code></pre>\n\n<p>These are two separate code blocks within the same method, so I believe if the second one fails, the first one won't rollback. How do I make sure both transactions rollback if something fails?</p>\n"},{"tags":["c#","entity-framework","stored-procedures","entity-framework-4.1","fluent-interface"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1007,"score":3,"question_id":6297657,"title":"EF4.1 - Fluent API - SqlQuery - configuration mappings when calling sproc - Data reader is incompatible with specified entity type","body":"<p>The scenario - legacy application with 10 year history, has always used procedure calls for all data access - needs to be overhauled from a hybrid classic ASP and .NET set of pages.</p>\n\n<p>The goal - migrate to .NET 4.0 using EF 4.1 with Fluent API and continue using existing database sprocs as much as possible.</p>\n\n<p>Key classes:</p>\n\n<pre><code>public class EntityBase\n{\n    public int Id { get; set; }\n}\n\npublic class User : EntityBase\n{\n    public string UserName { get; set; }\n...\n}\n</code></pre>\n\n<p>Configurations:</p>\n\n<pre><code>internal class ConfigurationBase&lt;T&gt; : EntityTypeConfiguration&lt;T&gt; where T : EntityBase\n{\n    protected ConfigurationBase()\n    {\n        HasKey(t =&gt; t.Id);\n    }\n}\n\ninternal class UserConfiguration : ConfigurationBase&lt;User&gt;\n{\n    internal UserConfiguration()\n    {\n        Property(p =&gt; p.Id)\n            .HasColumnName(\"Person_Id\")\n        .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity)\n            .IsRequired();\n        Property(p =&gt; p.UserName)\n            .HasMaxLength(64);\n        ToTable(\"Person\");\n    }\n}\n</code></pre>\n\n<p>The context is all set up in DbContext.OnModelCreating as:</p>\n\n<pre><code>    public DbSet&lt;User&gt; Users { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new UserConfiguration());\n    }\n</code></pre>\n\n<p>And all is fine when I access the data directly via the context eg:</p>\n\n<pre><code>    public override IQueryable&lt;User&gt; GetAll()\n    {\n        return UnitOfWork.Context.Users;\n    }\n</code></pre>\n\n<p>But when I attempt to use an existing sproc which contains the following:</p>\n\n<pre><code>SELECT  p.Person_Id,\n        p.IsUser,\n        p.FirstName,\n        p.LastName,\n        p.UserName,\n        p.Email,\n        p.CreatedBy,\n        p.CreatedDate,\n        p.IsActive,\n        p.ModifiedBy,\n        p.ModifiedDate\nFROM    Person p \nWHERE   p.UserName = @UserName\nAND     p.IsActive = 1\n</code></pre>\n\n<p>I execute the following:</p>\n\n<pre><code>    public User AuthorizeUser(string userName)\n    {\n        SqlParameter p = new SqlParameter { \n            DbType = DbType.String,\n            ParameterName = \"UserName\",\n            Size = 64,\n            Value = userName\n        };\n        object[] parameters = new object[] {p};\n\n        return UnitOfWork.Context.Users.SqlQuery(CPODSStoredProcedures.User_AuthorizeUser, parameters).FirstOrDefault();\n    }\n</code></pre>\n\n<p>And I get:\nThe data reader is incompatible with the specified 'User'. A member of the type, 'Id', does not have a corresponding column in the data reader with the same name.</p>\n\n<p>I have traced the execution and the configurations are being read, so am I doing something wrong, or is the sproc execution by SqlQuery not paying attention to how the base Id is remapped to Person_Id in this case.</p>\n\n<p>Thanks in advance!\nG</p>\n"},{"tags":["c#","entity-framework","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12902766,"title":"Working with generic model Problems with missing references on visual studio 2012 entity framework","body":"<p>EntityFramework\nruntime v4.0.30319\nversion 5.0.0.0</p>\n\n<pre><code>public abstract class AbstractPessoaFisicaDao&lt;T&gt;:IBasePessoaFisicaDao&lt;T&gt; where T: class\n{\n\n    SupremaDesEntities entidades = new SupremaDesEntities();\n    Cadastro_PessoaFisica Pessoa = new Cadastro_PessoaFisica();\n\n    public void Add(T pEntity)\n    {\n        entidades.Cadastro_PessoaFisica.AddObject();\n    }\n</code></pre>\n\n<p>Error   1   'System.Data.Entity.DbSet' does not contain a definition for 'AddObject' and no extension method 'AddObject' accepting a first argument of type 'System.Data.Entity.DbSet' could be found (are you missing a using directive or an assembly reference?) c:\\users\\msbow\\documents\\visual studio 2012\\Projects\\Inside.Net.EF\\Inside.Net.EF.Data\\AbstractPessoaFisicaDao.cs    26  45  Inside.Net.EF.Data</p>\n\n<p>I was studying this in visual studio 2010, I now have the ultimate version 2012 and can not adjust this reference, already downloaded the framework and several dlls nothing.</p>\n"},{"tags":["entity-framework","poco","model-associations"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12905864,"title":"Entities POCO with EF, creating relationship with POCO","body":"<p><p>Hi good day&nbsp;</p><p>I hope you can help me, then I explain my problem:</p><p>These are my entities:</p><p>http://i.stack.imgur.com/OjZmX.jpg</p><p></p><p>I need to create with POCO such relationships for example resultadobusquedaofac with SDN, For this I use the POCO templates</p><p>http://i.stack.imgur.com/qYbzy.jpg<br /></p><p>then I myself believe partnerships within these entities: </p><p>ResultadoBusquedaOfac</p></p>\n\n<pre><code>public partial class ResultadoBusquedaOfac\n{\n    #region Primitive Properties\n\n    public virtual int ent_num\n    {\n        get;\n        set;\n    }\n\n    public virtual string SDN_Name\n    {\n        get;\n        set;\n    }\n\n    public virtual int KeyCliente\n    {\n        get;\n        set;\n    }\n\n    public virtual string HayCoincidencia\n    {\n        get;\n        set;\n    }\n\n    public virtual string HayCoincidenciaAlias\n    {\n        get;\n        set;\n    }\n\n    #endregion\n\n    public virtual ICollection&amp;lt;OFAC_SDN&amp;gt; OFAC_SDN\n    {\n        get\n        {\n            if (_oFAC_SDN == null)\n            {\n                var newCollection = new FixupCollection&amp;lt;OFAC_SDN&amp;gt;();\n                newCollection.CollectionChanged += FixupOFAC_SDN;\n                _oFAC_SDN = newCollection;\n            }\n            return _oFAC_SDN;\n        }\n        set\n        {\n            if (!ReferenceEquals(_oFAC_SDN, value))\n            {\n                var previousValue = _oFAC_SDN as FixupCollection&amp;lt;OFAC_SDN&amp;gt;;\n                if (previousValue != null)\n                {\n                    previousValue.CollectionChanged -= FixupOFAC_SDN;\n                }\n                _oFAC_SDN = value;\n                var newValue = value as FixupCollection&amp;lt;OFAC_SDN&amp;gt;;\n                if (newValue != null)\n                {\n                    newValue.CollectionChanged += FixupOFAC_SDN;\n                }\n            }\n        }\n    }\n    private ICollection&amp;lt;OFAC_SDN&amp;gt; _oFAC_SDN;&lt;/em&gt;&lt;/strong&gt;\n\n\n    private void FixupOFAC_SDN(object sender, NotifyCollectionChangedEventArgs e)\n    {\n        if (e.NewItems != null)\n        {\n            foreach (OFAC_SDN item in e.NewItems)\n            {\n                item.ResultadoBusquedaOfac = this;\n            }\n        }\n\n        if (e.OldItems != null)\n        {\n            foreach (OFAC_SDN item in e.OldItems)\n            {\n                if (ReferenceEquals(item.ResultadoBusquedaOfac, this))\n                {\n                    item.ResultadoBusquedaOfac = null;\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>}OFAC_SDN<br /><p></p></p>\n\n<pre><code>public partial class OFAC_SDN\n{\n    #region Primitive Properties\n\n   &lt;strong&gt;&lt;em&gt; public virtual Nullable&amp;lt;int&amp;gt; id_Ofac\n    {\n        get { return _id_Ofac; }\n        set\n        {\n            try\n            {\n                _settingFK = true;\n                if (_id_Ofac != value)\n                {\n                    if (ResultadoBusquedaOfac != null &amp;amp;&amp;amp; ResultadoBusquedaOfac.ent_num != value)\n                    {\n                        ResultadoBusquedaOfac = null;\n                    }\n                    _id_Ofac = value;\n                }\n            }\n            finally\n            {\n                _settingFK = false;\n            }\n        }\n    }\n    private Nullable&amp;lt;int&amp;gt; _id_Ofac;&lt;/em&gt;&lt;/strong&gt;\n\n    public virtual int ent_num\n    {\n        get;\n        set;\n    }\n\n    public virtual string SDN_Name\n    {\n        get;\n        set;\n    }\n\n    public virtual string SDN_Type\n    {\n        get;\n        set;\n    }\n\n    public virtual string Program\n    {\n        get;\n        set;\n    }\n\n    public virtual string Title\n    {\n        get;\n        set;\n    }\n\n    public virtual string Call_Sign\n    {\n        get;\n        set;\n    }\n\n    public virtual string Vess_type\n    {\n        get;\n        set;\n    }\n\n    public virtual string Tonnage\n    {\n        get;\n        set;\n    }\n\n    public virtual string GRT\n    {\n        get;\n        set;\n    }\n\n    public virtual string Vess_flag\n    {\n        get;\n        set;\n    }\n\n    public virtual string Vess_owner\n    {\n        get;\n        set;\n    }\n\n    public virtual string Remarks\n    {\n        get;\n        set;\n    }\n\n    #endregion\n    #region Navigation Properties\n\n    public virtual ResultadoBusquedaOfac ResultadoBusquedaOfac\n    {\n        get { return _resultadoBusquedaOfac; }\n        set\n        {\n            if (!ReferenceEquals(_resultadoBusquedaOfac, value))\n            {\n                var previousValue = _resultadoBusquedaOfac;\n                _resultadoBusquedaOfac = value;\n                FixupResultadoBusquedaOfac(previousValue);\n            }\n        }\n    }\n    private ResultadoBusquedaOfac _resultadoBusquedaOfac;&lt;/em&gt;&lt;/strong&gt;\n\n    public virtual ICollection&amp;lt;OFAC_ADD&amp;gt; OFAC_ADD\n    {\n        get\n        {\n            if (_oFAC_ADD == null)\n            {\n                var newCollection = new FixupCollection&amp;lt;OFAC_ADD&amp;gt;();\n                newCollection.CollectionChanged += FixupOFAC_ADD;\n                _oFAC_ADD = newCollection;\n            }\n            return _oFAC_ADD;\n        }\n        set\n        {\n            if (!ReferenceEquals(_oFAC_ADD, value))\n            {\n                var previousValue = _oFAC_ADD as FixupCollection&amp;lt;OFAC_ADD&amp;gt;;\n                if (previousValue != null)\n                {\n                    previousValue.CollectionChanged -= FixupOFAC_ADD;\n                }\n                _oFAC_ADD = value;\n                var newValue = value as FixupCollection&amp;lt;OFAC_ADD&amp;gt;;\n                if (newValue != null)\n                {\n                    newValue.CollectionChanged += FixupOFAC_ADD;\n                }\n            }\n        }\n    }\n    private ICollection&amp;lt;OFAC_ADD&amp;gt; _oFAC_ADD;\n\n    public virtual ICollection&amp;lt;OFAC_ALT&amp;gt; OFAC_ALT\n    {\n        get\n        {\n            if (_oFAC_ALT == null)\n            {\n                var newCollection = new FixupCollection&amp;lt;OFAC_ALT&amp;gt;();\n                newCollection.CollectionChanged += FixupOFAC_ALT;\n                _oFAC_ALT = newCollection;\n            }\n            return _oFAC_ALT;\n        }\n        set\n        {\n            if (!ReferenceEquals(_oFAC_ALT, value))\n            {\n                var previousValue = _oFAC_ALT as FixupCollection&amp;lt;OFAC_ALT&amp;gt;;\n                if (previousValue != null)\n                {\n                    previousValue.CollectionChanged -= FixupOFAC_ALT;\n                }\n                _oFAC_ALT = value;\n                var newValue = value as FixupCollection&amp;lt;OFAC_ALT&amp;gt;;\n                if (newValue != null)\n                {\n                    newValue.CollectionChanged += FixupOFAC_ALT;\n                }\n            }\n        }\n    }\n    private ICollection&amp;lt;OFAC_ALT&amp;gt; _oFAC_ALT;\n\n    #endregion\n\n    #region Association Fixup\n\n    private bool _settingFK;\n\n    private void FixupResultadoBusquedaOfac(ResultadoBusquedaOfac previousValue)\n    {\n        if (previousValue != null &amp;amp;&amp;amp; previousValue.OFAC_SDN.Contains(this))\n        {\n            previousValue.OFAC_SDN.Remove(this);\n        }\n\n        if (ResultadoBusquedaOfac != null)\n        {\n            if (!ResultadoBusquedaOfac.OFAC_SDN.Contains(this))\n            {\n                ResultadoBusquedaOfac.OFAC_SDN.Add(this);\n            }\n            if (id_Ofac != ResultadoBusquedaOfac.ent_num)\n            {\n                id_Ofac = ResultadoBusquedaOfac.ent_num;\n            }\n        }\n        else if (!_settingFK)\n        {\n            id_Ofac = null;\n        }\n     }\n\n    private void FixupOFAC_ADD(object sender, NotifyCollectionChangedEventArgs e)\n    {\n        if (e.NewItems != null)\n        {\n            foreach (OFAC_ADD item in e.NewItems)\n            {\n                item.OFAC_SDN = this;\n            }\n        }\n\n        if (e.OldItems != null)\n        {\n            foreach (OFAC_ADD item in e.OldItems)\n            {\n                if (ReferenceEquals(item.OFAC_SDN, this))\n                {\n                    item.OFAC_SDN = null;\n                }\n            }\n        }\n    }\n\n    private void FixupOFAC_ALT(object sender, NotifyCollectionChangedEventArgs e)\n    {\n        if (e.NewItems != null)\n        {\n            foreach (OFAC_ALT item in e.NewItems)\n            {\n                item.OFAC_SDN = this;\n            }\n        }\n\n        if (e.OldItems != null)\n        {\n            foreach (OFAC_ALT item in e.OldItems)\n            {\n                if (ReferenceEquals(item.OFAC_SDN, this))\n                {\n                    item.OFAC_SDN = null;\n                }\n            }\n        }\n    }\n\n    #endregion\n}\n</code></pre>\n\n<p>}<br /><p>Now when I run the test query:</p><p></p>\n    public partial class Form1 : Form\n    {\n        public Form1()\n        {\n            InitializeComponent();</p>\n\n<pre><code>        LegitimacionEntities context = new LegitimacionEntities();\n        var query = context.ResultadoBusquedaOfac.Include(\"OFAC_SDN\").Where(us =&amp;gt; us.ent_num.Equals(10)).First();\n\n        MessageBox.Show(query.SDN_Name);\n    }\n}\n</code></pre>\n\n<p>}<br /><p>throws me the following error:&nbsp;</p><p>A specified Include path is not valid. The EntityType 'LegitimacionModel.ResultadoBusquedaOfac' does not declare a navigation property with the name 'OFAC_SDN'.</p><p>And in addition to this then I have to pass the data by dataservice or WCF, right now I'm doing so to prove first that the relations are well before passing it to the above.</p><p>Many thanks in advance and I welcome your comments...</p><p>happy days</p><br /><br /></p>\n"},{"tags":["c#",".net","asp.net-mvc","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":94,"score":3,"question_id":12851199,"title":"Entity Framework: Check all relationships of an entity for foreign key use","body":"<p>I have an entity, let's call it <code>CommonEntity</code> that has a primary key used as a foreign key in many other entities. As the application is developed these links will continue to grow.</p>\n\n<p>I'd like a way to see if <code>CommonEntity</code> can be safely deleted (i.e. it's not used by any other entities).</p>\n\n<p>I realise I can do</p>\n\n<pre><code>if(!ce.EntityA.Any() &amp;&amp; !ce.EntityB.Any() ... &amp;&amp; !ce.EntityN.Any())\n{\n   //Delete\n}\n</code></pre>\n\n<p>but I'm hoping for a way to just check all of the relationships automatically, as I don't love the idea of having to come back and change this code manually every time we add a new relationship. Perhaps there is something in EF4+ that I'm not aware of?</p>\n\n<p>I thought it might be possible to use a transaction scope to just try and delete the object and roll it back if it fails, but I wasn't sure if there were any adverse side effects with this approach.</p>\n\n<p>Is there a better approach?</p>\n\n<p><strong>EDIT:</strong> Looks like VS2012 has used EF5 even though the project is .Net 4, so it has created the model with POCOs even though it was generated from a DB.</p>\n"},{"tags":[".net","asp.net-mvc-3","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12900829,"title":"Mapping built-in UserProfile to UserProfileId column in table","body":"<p>I have a table Tale with definition</p>\n\n<pre><code>public class Tale\n{\n    public int Id { get; set; }\n    public string Title { get; set; }\n    public string Text { get; set; }\n    public DateTime ReleaseDate { get; set; }\n\n    public int enum_TaleAuthorTypeId { get; set; }\n    public virtual enum_TaleAuthorType enum_TaleAuthorType { get; set; }\n\n    public int CommentableId { get; set; }\n    public virtual Commentable Commentable { get; set; }\n}\n</code></pre>\n\n<p>and when i type 'update-database' in console, i have nice relationships with one column for CommentableId and one for enum_TaleAuthorTypeId.</p>\n\n<p>Now, i'd like to add UserProfile and try to type something like:</p>\n\n<pre><code>public int UserProfileId { get; set; }\npublic virtual UserProfile UserProfile { get; set; }\n</code></pre>\n\n<p>but after add-migration, i have this:</p>\n\n<pre><code>AddColumn(\"dbo.Tales\", \"UserProfileId\", c =&gt; c.Int(nullable: false));\nAddColumn(\"dbo.Tales\", \"UserProfile_UserId\", c =&gt; c.Int());\n</code></pre>\n\n<p>How should i get just one column for value? Why it's create two columns?</p>\n"},{"tags":["c#","sql-server","entity-framework","orm","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":12,"down_vote_count":1,"view_count":138,"score":11,"question_id":12898790,"title":"CodeFirst loading 1 parent linked to 25 000 children is slow","body":"<p>I searched a lot on my performance problem and tried all sorts of different things, but I just can't seem to get it to work fast enough.  Here's my problem to it's simplest form:</p>\n\n<p>I'm using entity framework 5 and I want to be able to lazy load child instances of a parent when the user selects that parent, so I don't have to pull the entire database.  However I have been having performance problems with lazy loading the children.  I think the problem is the wire up of the navigation properties between the Parent and the children.  I'm also thinking it must be something I did wrong because I believe this is a simple case.</p>\n\n<p>So I put up a program to test a single lazy load to isolate the problem.</p>\n\n<p>Here's the Test:</p>\n\n<p>I created a POCO Parent class and a Child POCO Class.  Parent has n Children and Child has 1 Parent.  There's only 1 parent in the SQL Server database and 25 000 children for that single parent.  I tried different methods to load this data.  Whenever I load either the children and the parent in the same DbContext, it takes a really long time.  But if I load them in different DbContexts, it loads really fast.  However, I want those instances to be in the same DbContext.</p>\n\n<p><strong>Here is my test setup and everything you need to replicate it:</strong></p>\n\n<p><strong>POCOs:</strong></p>\n\n<pre><code>public class Parent\n{\n    public int ParentId { get; set; }\n\n    public string Name { get; set; }\n\n    public virtual List&lt;Child&gt; Childs { get; set; }\n}\n\npublic class Child\n{\n    public int ChildId { get; set; }\n\n    public int ParentId { get; set; }\n\n    public string Name { get; set; }\n\n    public virtual Parent Parent { get; set; }\n}\n</code></pre>\n\n<p><strong>DbContext:</strong></p>\n\n<pre><code>public class Entities : DbContext\n{\n    public DbSet&lt;Parent&gt; Parents { get; set; }\n\n    public DbSet&lt;Child&gt; Childs { get; set; }\n}\n</code></pre>\n\n<p><strong>TSQL Script to create the Database and data:</strong></p>\n\n<pre><code>USE [master]\nGO\n\nIF EXISTS(SELECT name FROM sys.databases\n    WHERE name = 'PerformanceParentChild')\n    alter database [PerformanceParentChild] set single_user with rollback immediate\n    DROP DATABASE [PerformanceParentChild]\nGO\n\nCREATE DATABASE [PerformanceParentChild]\nGO\nUSE [PerformanceParentChild]\nGO\nBEGIN TRAN T1;\nSET NOCOUNT ON\n\nCREATE TABLE [dbo].[Parents]\n(\n    [ParentId] [int] CONSTRAINT PK_Parents PRIMARY KEY,\n    [Name] [nvarchar](200) NULL\n)\nGO\n\nCREATE TABLE [dbo].[Children]\n(\n    [ChildId] [int] CONSTRAINT PK_Children PRIMARY KEY,\n    [ParentId] [int] NOT NULL,\n    [Name] [nvarchar](200) NULL\n)\nGO\n\nINSERT INTO Parents (ParentId, Name)\nVALUES (1, 'Parent')\n\nDECLARE @nbChildren int;\nDECLARE @childId int;\n\nSET @nbChildren = 25000;\nSET @childId = 0;\n\nWHILE @childId &lt; @nbChildren\nBEGIN\n   SET @childId = @childId + 1;\n   INSERT INTO [dbo].[Children] (ChildId, ParentId, Name)\n   VALUES (@childId, 1, 'Child #' + convert(nvarchar(5), @childId))\nEND\n\nCREATE NONCLUSTERED INDEX [IX_ParentId] ON [dbo].[Children] \n(\n    [ParentId] ASC\n)\nGO\n\nALTER TABLE [dbo].[Children] ADD CONSTRAINT [FK_Children.Parents_ParentId] FOREIGN KEY([ParentId])\nREFERENCES [dbo].[Parents] ([ParentId])\nGO\n\nCOMMIT TRAN T1;\n</code></pre>\n\n<p><strong>App.config containing the connection string:</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;connectionStrings&gt;\n    &lt;add\n      name=\"Entities\"\n      providerName=\"System.Data.SqlClient\"\n      connectionString=\"Server=localhost;Database=PerformanceParentChild;Trusted_Connection=true;\"/&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p><strong>Test console class:</strong></p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        List&lt;Parent&gt; parents;\n        List&lt;Child&gt; children;\n\n        Entities entities;\n        DateTime before;\n        TimeSpan childrenLoadElapsed;\n        TimeSpan parentLoadElapsed;\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            parents = entities.Parents.ToList();\n            parentLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load only the parent from DbSet:\" + parentLoadElapsed.TotalSeconds + \" seconds\");\n        }\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            children = entities.Childs.ToList();\n            childrenLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load only the children from DbSet:\" + childrenLoadElapsed.TotalSeconds + \" seconds\");\n        }\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            parents = entities.Parents.ToList();\n            parentLoadElapsed = DateTime.Now - before;\n\n            before = DateTime.Now;\n            children = entities.Childs.ToList();\n            childrenLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load the parent from DbSet:\" + parentLoadElapsed.TotalSeconds + \" seconds\" +\n                                               \", then load the children from DbSet:\" + childrenLoadElapsed.TotalSeconds + \" seconds\");\n        }\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            children = entities.Childs.ToList();\n            childrenLoadElapsed = DateTime.Now - before;\n\n            before = DateTime.Now;\n            parents = entities.Parents.ToList();\n            parentLoadElapsed = DateTime.Now - before;\n\n\n            System.Diagnostics.Debug.WriteLine(\"Load the children from DbSet:\" + childrenLoadElapsed.TotalSeconds + \" seconds\" +\n                                               \", then load the parent from DbSet:\" + parentLoadElapsed.TotalSeconds + \" seconds\");\n        }\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            parents = entities.Parents.ToList();\n            parentLoadElapsed = DateTime.Now - before;\n\n            before = DateTime.Now;\n            children = parents[0].Childs;\n            childrenLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load the parent from DbSet:\" + parentLoadElapsed.TotalSeconds + \" seconds\" +\n                                               \", then load the children from Parent's lazy loaded navigation property:\" + childrenLoadElapsed.TotalSeconds + \" seconds\");\n        }\n\n        using (entities = new Entities())\n        {\n            before = DateTime.Now;\n            parents = entities.Parents.Include(p =&gt; p.Childs).ToList();\n            parentLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load the parent from DbSet and children from include:\" + parentLoadElapsed.TotalSeconds + \" seconds\");\n\n        }\n\n        using (entities = new Entities())\n        {\n            entities.Configuration.ProxyCreationEnabled = false;\n            entities.Configuration.AutoDetectChangesEnabled = false;\n            entities.Configuration.LazyLoadingEnabled = false;\n            entities.Configuration.ValidateOnSaveEnabled = false;\n\n            before = DateTime.Now;\n            parents = entities.Parents.Include(p =&gt; p.Childs).ToList();\n            parentLoadElapsed = DateTime.Now - before;\n            System.Diagnostics.Debug.WriteLine(\"Load the parent from DbSet and children from include:\" + parentLoadElapsed.TotalSeconds + \" seconds with everything turned off\");\n\n        }\n\n    }\n}\n</code></pre>\n\n<p><strong>Here are the results of those test:</strong></p>\n\n<p>Load only the parent from DbSet:0,972 seconds</p>\n\n<p>Load only the children from DbSet:0,714 seconds</p>\n\n<p>Load the parent from DbSet:0,001 seconds, then load the children from DbSet:8,6026 seconds</p>\n\n<p>Load the children from DbSet:0,6864 seconds, then load the parent from DbSet:7,5816159 seconds</p>\n\n<p>Load the parent from DbSet:0 seconds, then load the children from Parent's lazy loaded navigation property:8,5644549 seconds</p>\n\n<p>Load the parent from DbSet and children from include:8,6428788 seconds</p>\n\n<p>Load the parent from DbSet and children from include:9,1416586 seconds with everything turned off</p>\n\n<p><strong>Analysis</strong></p>\n\n<p>Whenever the parent and the children are in the same DbContext, it takes a long time (9 seconds) to wire everything up.  I even tried turning off everything from proxy creation to lazy loading, but to no avail.  Can someone please help me ?</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12904056,"title":"Entity Framework - TPH Query Issue","body":"<p>I have  model that looks something like this:</p>\n\n<pre><code>public abstract class Parent {}\n\npublic class Child1 : Parent {}\n\npublic class Child2 : Parent {}\n\npublic class SomeEntity \n{\n    public virtual Parent SomeParent { get; set; }\n}\n</code></pre>\n\n<p>I'd like to query the SomeEntity class and filter by the ones where SomeParent is a Child1.  I tried to write the following Linq query:</p>\n\n<pre><code>dbContext.Set&lt;SomeEntity&gt;().Where(s =&gt; s.SomeParent is Child1)\n</code></pre>\n\n<p>When i run this query, I get the following error:</p>\n\n<p>error 3032: Problem in mapping fragments starting at line 64:Condition member 'Parent.DiscriminatorColumn' with a condition other than 'IsNull=False' is mapped. Either remove the condition on Parent.DiscriminatorColumn or remove it from the mapping.</p>\n\n<p>Am I doing something wrong? Is this supposed to work?</p>\n"},{"tags":["asp.net","linq","entity-framework","entity"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":103,"score":2,"question_id":12901377,"title":"EntityFunction.TruncateTime not working in my query","body":"<p>I am using Linq to entityframework to query some infomration. I am trying to use entityfunction.truncatetime and it doesnt seem to work as expected. here is my sample query</p>\n\n<pre><code>From d In Request\nWhere d.Requestor= \"XXXX\" And d.ProcessedFlag = \"N\"\nSelect d.RequestID, RequestReason = d.RequestReason.ItemValue, RequestType =  d.RequestType.ItemValue, RequestedDate = EntityFunctions.TruncateTime(d.RequestedMoveDate)\n</code></pre>\n\n<p>The requesteddate doesnt seem to truncate the time part and I am still getting the both Date and time.</p>\n\n<p>Am I missing something here?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12903350,"title":"EF Code First different solutions/projects same database","body":"<p>I have 2 different MVC solutions (web apps) that are using Code First. The target for both these apps is the same database. When I started on my second app I initially got some errors about not being able to apply changes to the database (don't remember exactly what they were). I finally managed to just generate the script</p>\n\n<pre><code>update-database -Script\n</code></pre>\n\n<p>and ran it on the database and it worked. But what i did not realize for about a week is that my other app that uses Code first and talks to the same database but different tables stopped working. When i tried to compile it to debug the issue i got and error which pretty much meant the following:\n<strong>The backing context has changed and these changes need to be pushed to the database (update-database)</strong>\nbut when i try to update the database, it fails saying there are no migrations. </p>\n\n<p>Both my apps are MVC3 apps targeting .Net 4.0 in Visual Studio 2012.</p>\n\n<p>Any tips on how to fix this situation?</p>\n"}]}
{"total":18927,"page":10,"pagesize":100,"questions":[{"tags":["oracle","entity-framework","c#-4.0","pagination"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12902943,"title":"Oracle paging in Entity Framework returning different sets of records than intentionally","body":"<p>I thought I understood LINQ or did I, or it could be a nasty Oracle provider bug?</p>\n\n<p>Got a very frustrating situation where I want to implement paging in a knockout app.  Using Troy Goode's PagedList Mvc library, I can see where the code was transformed from a search returning two items into a 15 items result (I had set paging to be 15 items per).  Worked perfectly fine in SQL Server 2005/2008, but not so using Oracle.DataAccess.dll v11.2.3/v4.112.3 (depending how the version number gets read).</p>\n\n<p>I did the search result in Linq like thus:</p>\n\n<pre><code>var entities = _context.Entities;\n\nvar q = !string.IsNullOrEmpty(search)\n                        ? entities\n                            .Where(a =&gt; a.PRODUCT_NUM.ToUpper().Contains(search.ToUpper())\n                                     || a.PRINT_NAME.ToUpper().Contains(search.ToUpper()))\n                        : entities;   \n\nvar result = q.OrderBy(e =&gt; e.UPDATE_DATE == null)\n                             .ThenByDescending(e =&gt; e.UPDATE_DATE)\n                             .Select(r =&gt; new EntityModel\n                             {\n                                 Id = r.ID,\n                                 Num = r.PRODUCT_NUM,\n                                 Name = r.PRINT_NAME,\n                                 City = r.City.PRINT_NAME,\n                                 State = r.City.State.PRINT_NAME,\n                                 EntityType = r.ENTITY_TYPE,\n                                 CompanyType = r.COMPANY_TYPE,\n                                 UpdateDate = r.UPDATE_DATE\n                             })\n                             .ToPagedList(pageNumber, 15);\n</code></pre>\n\n<p>Now at this point, using the Immediate Window, I can have it return 2 items, however when it goes through the paging process, it comes back with 15 items. </p>\n\n<p>First thought, am I having an caching problem or something?  But delved into the PagedList library. <a href=\"https://github.com/TroyGoode/PagedList\" rel=\"nofollow\">https://github.com/TroyGoode/PagedList</a></p>\n\n<p>Let's look at the object passed thru to the PagedList and I'll show you the number of records returned. Inside the PagedList, the IQueryable object is called superset and returns a List eventually, but check out what I'm getting when I query the list via Immediate Window.  I just figured it'd be the best way to show you...</p>\n\n<pre><code>?superset.Take(pageSize).Count()\n2\n?superset.Count()\n51114\n?superset.Skip(0).Take(pageSize).Count()\n2\n?superset.ToList().Count()\n2\n?superset.Skip(0).Take(pageSize).ToList().Count()\n15\n?superset.Take(pageSize).ToList().Count()\n15\n</code></pre>\n\n<p>What's most interesting to me is that when we do a ToList(), it returns 15 records.  Is it an Oracle ODP.NET provider problem?  I fired up Ayende's Entity Framework Provider <a href=\"http://efprof.com/\" rel=\"nofollow\">efprof.com</a> and saw the Oracle query being generated, copy-pasted it to TOAD, and it indeeds returns 2 items and not 15.</p>\n\n<p>I'm definitely missing something.</p>\n\n<p>Thanks,\n-rob</p>\n"},{"tags":["c#","entity-framework",".net-3.5","edmx","database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12902864,"title":"Getting stackoverflow in entity framework with custom get","body":"<p>I'm trying to add business logic to my database first entity framework appplication. I want to limit the length of address1 to 35 and move the rest to address to. In the database the fields are Address1 and Address2, on my edmx it is address1 and address2. I extened the edmx using a partial. but when ever trying to call my custom get function I get an exception saying the current thread is in a stackoverflow.</p>\n\n<pre><code> public partial class EmployeeWithAddress\n    {\n        public string Address1\n        {\n            get\n            {\n                var employee = Common.LimitAddressFieldTo35(this);\n                address1 = employee.Address1;\n                address2 = employee.Address2;\n                return address1;\n            }\n            set { address1 = value; }\n        }\n\n        public string Address2 { get; set; }\n    }\n\nstatic public EmployeeWithAddress LimitAddressFieldTo35(EmployeeWithAddress employee)\n        {\n            var ee = employee;  \n            if (ee.Address1.Length &gt; 35)\n            {\n                var address = ee.Address1;\n                ee.Address1 = address.Substring(0, 35).Trim();\n                ee.Address2 =\n                    string.Concat(address.Substring(35, address.Length - 35) + \" \", employee.Address2).Trim();\n            }\n\n            return ee;\n        }\n</code></pre>\n\n<p>the exception occurs when calling LimitAddressFieldTo35.\nI am using the entity framework version included in .net 3.5</p>\n"},{"tags":["c#","entity-framework","mini-profiler"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":484,"score":2,"question_id":9344777,"title":"MvcMiniProfiler Unable to cast object of type EFProfiledDbConnection","body":"<p>I am trying to integrate MvcMiniProfiler  to my asp.net mvc+entity framewok project. Everything is ok for the first time web request but it is giving exception at the other requests.</p>\n\n<p>My Project is<br/>\nMVC 3<br/>\nEntity Framework 4.1 (DatabaseFirst + POCO Generator DbContext)<br/>\nMvcMiniProfiler.dll 1.9.0.0<br/>\nMvcMiniProfiler.EntityFramework.dll 1.9.1.0<br/>\nI install MvcMiniProfiler from Nu-Get</p>\n\n<p>Added below to global.asax</p>\n\n<pre><code>    protected void Application_BeginRequest()\n    {\n        if (Request.IsLocal)\n        {\n            MvcMiniProfiler.MiniProfiler.Start();\n            MiniProfilerEF.Initialize();       \n        }\n    }\n</code></pre>\n\n<p>Added below to web.config</p>\n\n<pre><code>   &lt;system.data&gt;\n    &lt;DbProviderFactories&gt;\n      &lt;remove invariant=\"MvcMiniProfiler.Data.ProfiledDbProvider\" /&gt;\n      &lt;add name=\"MvcMiniProfiler.Data.ProfiledDbProvider\" invariant=\"MvcMiniProfiler.Data.ProfiledDbProvider\" description=\"MvcMiniProfiler.Data.ProfiledDbProvider\" type=\"MvcMiniProfiler.Data.ProfiledDbProviderFactory, MvcMiniProfiler, Version=1.8.0.0, Culture=neutral, PublicKeyToken=b44f9351044011a3\" /&gt;\n    &lt;/DbProviderFactories&gt;\n  &lt;/system.data&gt;\n</code></pre>\n\n<p>I am getting this exception</p>\n\n<pre><code>    System.InvalidCastException was unhandled by user code\n  Message=Unable to cast object of type 'MvcMiniProfiler.Data.EFProfiledDbConnection' to type 'System.Data.SqlClient.SqlConnection'.\n  Source=System.Data\n  StackTrace:\n       at System.Data.SqlClient.SqlCommand.set_DbConnection(DbConnection value)\n       at System.Data.Common.DbCommand.set_Connection(DbConnection value)\n       at MvcMiniProfiler.Data.ProfiledDbCommand.set_DbConnection(DbConnection value) in C:\\Users\\sam\\Desktop\\mvc-mini-profiler\\MvcMiniProfiler\\Data\\ProfiledDbCommand.cs:line 118\n       at System.Data.Common.DbCommand.set_Connection(DbConnection value)\n       at System.Data.Common.Utils.CommandHelper.SetStoreProviderCommandState(EntityCommand entityCommand, EntityTransaction entityTransaction, DbCommand storeProviderCommand)\n       at System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior)\n       at System.Data.Objects.Internal.ObjectQueryExecutionPlan.Execute[TResultType](ObjectContext context, ObjectParameterCollection parameterValues)\n</code></pre>\n\n<p><br/>\nException is occured in EF calls</p>\n\n<pre><code>ModaEntitiesWrapper.GetInstance().Articles\n               .AsNoTracking()\n               .Where(p =&gt; p.StatusId == 1).ToList();\n</code></pre>\n\n<p>If I change version of MvcMiniProfiler.Data.ProfiledDbProvider in Web.Config from 1.8.0.0 to 1.9.0.0\nA new type of exception occured in MiniProfilerEF.Initialize() call.</p>\n\n<pre><code>System.IndexOutOfRangeException was unhandled by user code\n  Message=The given DataRow is not in the current DataRowCollection.\n  Source=System.Data\n  StackTrace:\n       at System.Data.DataRowCollection.Remove(DataRow row)\n       at MvcMiniProfiler.MiniProfilerEF.Initialize() \n</code></pre>\n"},{"tags":["asp.net","asp.net-mvc","asp.net-mvc-3","entity-framework","entity-framework-4.1"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":572,"score":1,"question_id":8004479,"title":"Entity Framework TryUpdateModel Child Objects?","body":"<p>I know most of you will suggest that I should use ViewModels specific to the form I am using, but I am curious as to why my child object is not binding on TryUpdateModel.</p>\n\n<pre><code>@using (Html.BeginForm()) {\n    @Html.ValidationSummary(true)\n    &lt;fieldset&gt;\n        &lt;legend&gt;User&lt;/legend&gt;\n\n        @Html.HiddenFor(model =&gt; model.UserId)\n    @Html.HiddenFor(model =&gt; model.PrimaryAddress.AddressId)\n    &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.PrimaryAddress.FirstName)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.PrimaryAddress.FirstName)\n            @Html.ValidationMessageFor(model =&gt; model.PrimaryAddress.FirstName)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.PrimaryAddress.LastName)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.PrimaryAddress.LastName)\n            @Html.ValidationMessageFor(model =&gt; model.PrimaryAddress.LastName)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.UserName)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.UserName)\n            @Html.ValidationMessageFor(model =&gt; model.UserName)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.Email)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.Email)\n            @Html.ValidationMessageFor(model =&gt; model.Email)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.IsApproved)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.IsApproved)\n            @Html.ValidationMessageFor(model =&gt; model.IsApproved)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.IsEmployee)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.IsEmployee)\n            @Html.ValidationMessageFor(model =&gt; model.IsEmployee)\n        &lt;/div&gt;\n\n        &lt;p&gt;\n            &lt;input type=\"submit\" value=\"Save\" /&gt;\n        &lt;/p&gt;\n    &lt;/fieldset&gt;\n}\n</code></pre>\n\n<p>And the controller code:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Edit(int id, FormCollection form)\n{\n    var user = Token.DB.Users.Include(\"PrimaryAddress\").Single(x =&gt; x.UserId == id);\n    if (TryUpdateModel(user, new string[] { \"UserName\", \"Email\", \"IsApproved\", \"IsEmployee\", \"PrimaryAddress.FirstName\", \"PrimaryAddress.LastName\" }))\n    {\n        try\n        {\n            Token.DB.SaveChanges();\n            return RedirectToAction(\"index\");\n        }\n        catch (Exception ex)\n        {\n            while (ex.InnerException != null)\n                ex = ex.InnerException;\n            if (ex.Message.ToLowerInvariant().Contains(\"unique\"))\n                ModelState.AddModelError(\"UserName\", \"UserName already exists\");\n        }\n    }\n    return View(User);\n}\n</code></pre>\n\n<p>The code doesn't throw any exceptions, it just doesn't populate the user.PrimaryAddress.FirstName or user.PrimaryAddress.LastName from the form. I'd like to know why?</p>\n\n<p>I already know I can fix the issue with a specific ViewModel and mapping the info in the background. I can also do something like this:</p>\n\n<pre><code>&lt;!-- Edit.cshtml --&gt;\n&lt;div class=\"editor-field\"&gt;\n    @Html.EditorFor(model =&gt; model.PrimaryAddress.FirstName, null, \"FirstName\")\n    @Html.ValidationMessageFor(model =&gt; model.PrimaryAddress.FirstName)\n&lt;/div&gt;\n\n&lt;div class=\"editor-label\"&gt;\n    @Html.LabelFor(model =&gt; model.PrimaryAddress.LastName)\n&lt;/div&gt;\n&lt;div class=\"editor-field\"&gt;\n    @Html.EditorFor(model =&gt; model.PrimaryAddress.LastName, null, \"LastName\")\n    @Html.ValidationMessageFor(model =&gt; model.PrimaryAddress.LastName)\n&lt;/div&gt;\n\n// UsersController.cs\nif (TryUpdateModel(user, new string[] { \"UserName\", \"Email\", \"IsApproved\", \"IsEmployee\"})\n&amp;&amp; TryUpdateModel(user.PrimaryAddress, new string[] {\"FirstName\", \"LastName\" }))\n</code></pre>\n\n<p>So the real question is why isn't it binding in the first example?</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":76,"score":7,"question_id":12900930,"title":"Data grouping in SQL","body":"<p>I am working on a small project using C# and EF5.0 and I need to group some data. Let say I have table of columns in a building like shown below.</p>\n\n<pre><code>+----------+--------Columns Table--+------+------+\n| ColumnID |ColumnName|Width|Length|Height|number| \n+----------+----------+-----+------+------+------+\n|        1 |   C101   |  50 |   70 | 250  | 1    |  \n|        2 |   C102   |  70 |   70 | 250  | 1    |    \n|        3 |   C103   |  70 |   60 | 250  | 1    |    \n|        4 |   C104   |  90 |   70 | 250  | 1    |     \n|        5 |   C105   |  40 |   50 | 250  | 1    |     \n|        6 |   C106   |  50 |   70 | 250  | 1    |    \n|        7 |   C107   |  50 |   60 | 250  | 1    |    \n|        8 |   C108   |  70 |   70 | 250  | 1    |     \n+----------+----------+-----+------+------+------+\n</code></pre>\n\n<p>I need a C# code to see the above data groupped like this:</p>\n\n<pre><code>+----------+---Groupped Columns Table-----+------+\n|G_ColumnID|ColumnName|Width|Length|Height|number| \n+----------+----------+-----+------+------+------+\n|        1 |C(101-106)|  50 |   70 | 250  | 2    |  \n|        2 |C(102-108)|  70 |   70 | 250  | 2    |    \n|        3 |   C103   |  70 |   60 | 250  | 1    |    \n|        4 |   C104   |  90 |   70 | 250  | 1    |     \n|        5 |   C105   |  40 |   50 | 250  | 1    |         \n|        6 |   C107   |  50 |   60 | 250  | 1    |            \n+----------+----------+-----+------+------+------+\n</code></pre>\n\n<p>I prefer clues than the exact solution.</p>\n\n<p><strong>EDIT :</strong> Below code shows my current state. I think I can find the columns with the same Height, Width and Length using this code. But I am not sure how to generate a new name for the group.</p>\n\n<pre><code>using (pehlivanEntities context = new pehlivanEntities())\n{           \n     foreach (var item in context.table1)\n     {               \n          int id = item.ColumnID;\n          foreach (var item2 in context.table1)\n          {\n               int id2 = item2.ColumnID;\n               if (id != id2)\n               {\n                   if (item.Width == item2.Width)\n                   {\n                       if (item.Length == item2.Length)\n                       {\n                            if (item.Height == item2.Height)\n                            {\n                               //Alter item.ColumnName\n                               //increase item.number by one\n                               //Remove item2\n                            }\n                       }\n                   }\n               }\n          }\n     }\n}\n</code></pre>\n"},{"tags":["linq","entity-framework","iqueryable","lambda-functions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12901060,"title":"SelectMany on an IQueryable ignores conditions?","body":"<p>I'm trying to use SelectMany to evaluate a first query with conditions, based on those results execute another query.  I've been told that SelectMany should be able to do this.  The problem I'm having is the SelectMany seems to ignore the conditions in the first lambda expression.  My problem may be with the first expression but I'm not really sure.  Any ideas what I'm doing wrong.  </p>\n\n<p>First</p>\n\n<pre><code>  //get source based on user and active flag\n  var query = _sourceRepository.GetTable().Where(s =&gt; s.ActionItemStates.Any(ais =&gt; ais.UserId == user.Id &amp;&amp; ais.IsActive == active));  \n</code></pre>\n\n<p>Second - ignores conditions in first</p>\n\n<pre><code>var queryActionItems = query.SelectMany(x =&gt; x.ActionItemStates).OrderBy(x =&gt; x.ActionItem.SortOrder);\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/R9ICL.png\" alt=\"enter image description here\"></p>\n"},{"tags":["entity-framework","datetime","comparison","esql","entity-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2513,"score":1,"question_id":1210905,"title":"Comparing Date / DateTime ine Entity SQL Where clause","body":"<p>I have a method which accepts an ObjectQuery and adds Where clauses to it depending on whether it receives values for various filter parameters. The method has to return an ObjectQuery. How can i do a basic Date comparison e.g. where dateX &lt; dateY.</p>\n\n<p>This is my current code:</p>\n\n<pre><code>if (myDateFilter != null)\n{\n    query = query.Where(\n        string.Format(\n            \"it.ExpireDate &lt; cast('{0}' as System.DateTime)\",\n            myDateFilter));\n}\n</code></pre>\n\n<p>With myDateFilter having a value of DateTime.Now, this code says: System.Data.SqlClient.SqlException: The conversion of a varchar data type to a datetime data type resulted in an out-of-range value.</p>\n\n<p>All the other paramaters are string or integer filters so weren't a problem to implement. Any ideas??</p>\n"},{"tags":["wcf","entity-framework","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":131,"score":0,"question_id":12875792,"title":"Entity Framework 5 command timeout error after changing target Framework version and re-installing EF","body":"<p>Here's the background: I built a new WCF service which uses EF5 and was targeting .Net Framework 4.5.  I've used code-first against an existing large legacy database.  All was working nicely until I came to deploy the service to a test server, when I discovered the test server (and therefore the production server since they are the same build) was not capable of supporting Framework 4.5.</p>\n\n<p>So, I downgraded the project to target Framework 4.0.  After re-coding all my entity mappings (to avoid using code in the DataAnnotations.Schema namespace specific to 4.5), I had this working again locally.  However, after deploying to the server I was hitting the error described here: <a href=\"http://stackoverflow.com/questions/9591929/can-anyone-spot-why-i-keep-getting-this-error-testing-the-ef-5-beta\">Can anyone spot why I keep getting this error testing the EF 5 beta</a>.</p>\n\n<p>After doing as suggested - uninstalling and re-installing EF5 via NuGet, I am now getting a timeout error when trying to test the service.</p>\n\n<p>Specifically the timeout occurs when attempting to execute the following Linq:</p>\n\n<pre><code>var games = from m in _db.Members\n        join s in _db.UkSyndicates\n            on m.MemberId equals s.MemberId\n        where m.PaymentMethod == \"Credit/Debit Card\"\n        &amp;&amp; EntityFunctions.TruncateTime(s.NextChargeDate) &lt;=  EntityFunctions.TruncateTime(DateTime.Now)\n        &amp;&amp; !string.IsNullOrEmpty(m.AibCustomerReference)\n        &amp;&amp; (m.StatusId == 105 || m.StatusId == 113)\n        select new BillingItem\n        {\n            Id = s.Id,\n            SyndicateId = s.SyndicateId,\n            MemberId = s.MemberId,\n            LastDrawId = s.LastDrawId,\n            LastPaidGame = s.LastPaidGame,\n            NextChargeDate = s.NextChargeDate,\n            Protected = s.Protected,\n            PaymentFrequency = (int)(s.PaymentFrequency*4),\n            CurrencyCode = m.CurrencyCode,\n            AibCustomerReference = m.AibCustomerReference,\n            WeeklyFee = (from f in _db.GameFees where f.FeeName == \"UK_LOTTO_FEE\" &amp;&amp; f.CurrencyCode == m.CurrencyCode select f.Amount).FirstOrDefault(),\n            GameCode = game,\n            PostCode = m.PostCode,\n            CountryCode = m.CountryCode,\n            EmailAddress = m.Email\n        };\n</code></pre>\n\n<p>There may well be a more efficient way to write this query - I'm fairly inexperienced with Linq and EF, but I would stress this did NOT time-out prior to the uninstall and re-install of EF.  In fact it returned data fairly quickly.</p>\n\n<p>I can't see any reason this would timeout after the re-install of EF, nothing in the code has changed, but need a solution to this fast!</p>\n\n<p>Thanks.</p>\n\n<p>To clarify the error I'm getting, it's at the point that EF tries to execute the above query, I get an <strong>EntityCommandExecutionException</strong> thrown.  The exception message is \"An error occurred while executing the command definition.  See the inner exception for details.\"  The inner exception is \"Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\"</p>\n\n<p>The stack trace is below:</p>\n\n<p>at System.Data.EntityClient.EntityCommandDefinition.ExecuteStoreCommands(EntityCommand entityCommand, CommandBehavior behavior)\n   at System.Data.Objects.Internal.ObjectQueryExecutionPlan.Execute[TResultType](ObjectContext context, ObjectParameterCollection parameterValues)\n   at System.Data.Objects.ObjectQuery<code>1.GetResults(Nullable</code>1 forMergeOption)\n   at System.Data.Objects.ObjectQuery<code>1.System.Collections.Generic.IEnumerable&lt;T&gt;.GetEnumerator()\n   at System.Data.Entity.Internal.Linq.InternalQuery</code>1.GetEnumerator()\n   at System.Data.Entity.Infrastructure.DbQuery<code>1.System.Collections.Generic.IEnumerable&lt;TResult&gt;.GetEnumerator()\n   at RepeatBillingService.Repositories.BillingRepository.GetMembersForGame(String game, List</code>1&amp; billingQ) in p:\\Projects\\BigFatLottos\\RepeatBillingService\\RepeatBillingService\\Repositories\\BillingRepository.cs:line 441\n   at RepeatBillingService.Repositories.BillingRepository.GetMemberGamesForBilling() in p:\\Projects\\BigFatLottos\\RepeatBillingService\\RepeatBillingService\\Repositories\\BillingRepository.cs:line 24\n   at RepeatBillingService.RepeatBillingService.RunRepeatBilling() in p:\\Projects\\BigFatLottos\\RepeatBillingService\\RepeatBillingService\\RepeatBillingService.svc.cs:line 51\n   at SyncInvokeRunRepeatBilling(Object , Object[] , Object[] )\n   at System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object instance, Object[] inputs, Object[]&amp; outputs)\n   at System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp; rpc)</p>\n"},{"tags":["c#","entity-framework","repository-pattern","unit-of-work"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":12899165,"title":"How to structure unit of work pattern with that many repositories","body":"<p>I have a database with ~600 tables and I am creating a unit-testable data access layer using POCO, EF 4.1, Repository and unit of work patterns. This mean that I have ~600 POCOs classes for entities, then for each entity class I have a repository class. I am using idea of aggregation from domain driven design which lead to creating bounded contexts that are specific to related sections in domain model. so far we have identified ~40 bounded context. What I am confused about is how to model unit of work. Should there be one unit of work per respoistory or should it depend upon number of context that I have. I can always have one huge unit of work but then this may take away all advantages that I get by using smaller and targetted bounded contexts.</p>\n"},{"tags":[".net","oracle","entity-framework","odp.net","sys-refcursor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12806485,"title":"What's wrong with my app.config configuration for ODP.Net and REF_CURSORS?","body":"<p>I've been struggling for a while with this, im following <a href=\"http://download.oracle.com/oll/obe/EntityFrameworkOBE/EntityFrameworkOBE.htm#t3\" rel=\"nofollow\">this guide</a>:</p>\n\n<p>This are the steps I have taken so far:</p>\n\n<ol>\n<li>Create new console project</li>\n<li>Add new EntityModel</li>\n<li><p>Import \"Test\" Stored Procedure into Entity Model, sp looks like this:</p>\n\n<pre><code>CREATE OR REPLACE PROCEDURE CTACTE_WEB.TEST(P_SALIDA OUT NUMBER,\n                            P_CURSOR1 OUT sys_refcursor,\n                            P_CURSOR2 OUT sys_refcursor) IS\nBEGIN\n   P_SALIDA := 15;\n   OPEN P_CURSOR1 FOR\n   SELECT 125.72 \"DECIMAL\", 150 \"INTEGER\", 'JUST PASSING BY' \"TEXT\" FROM DUAL;\n\n   OPEN P_CURSOR2 FOR\n   SELECT 'JUST SOME TEXT' \"TEXT\" FROM DUAL;\n\nEND TEST;\n/\n</code></pre></li>\n<li>Add this to app.config:</li>\n</ol>\n\n<pre>\n&lt;add name=\"CTACTE_WEB.TEST.RefCursor.P_CURSOR1\" value=\"implicitRefCursor bindinfo='mode=Output'\" /&gt;  \n&lt;add name=\"CTACTE_WEB.TEST.RefCursorMetaData.P_CURSOR1.Column.0\" value=\"implicitRefCursor metadata='ColumnName=DECIMAL;NATIVEDATATYPE=Number;ProviderType=Decimal'\" /&gt;  \n&lt;add name=\"CTACTE_WEB.TEST.RefCursorMetaData.P_CURSOR1.Column.1\" value=\"implicitRefCursor metadata='ColumnName=INTEGER;NATIVEDATATYPE=Number;ProviderType=Int32'\" /&gt;  \n&lt;add name=\"CTACTE_WEB.TEST.RefCursorMetaData.P_CURSOR1.Column.2\" value=\"implicitRefCursor metadata='ColumnName=TEXT;NATIVEDATATYPE=Varchar2;ProviderType=Varchar2'\" /&gt;  \n</pre>\n\n<pre>\n&lt;add name=\"CTACTE_WEB.TEST.RefCursor.P_CURSOR2\" value=\"implicitRefCursor bindinfo='mode=Output'\" /&gt;\n&lt;add name=\"CTACTE_WEB.TEST.RefCursorMetaData.P_CURSOR2.Column.0\" value=\"implicitRefCursor metadata='ColumnName=TEXT;NATIVEDATATYPE=Varchar2;ProviderType=Varchar2'\" /&gt;\n</pre>\n\n<p>Then I try to import function from the Entity Model I created before but when I click obtain column information after selecting complex type nothing happens, it doesn't show the cursor like the <strong>obe</strong> tutorial.</p>\n\n<p>Any help would be appreciated.</p>\n\n<p>Thanks</p>\n\n<p>EDIT:</p>\n\n<p>So I tried again today, and it's behaving differently this time. Now when I click the Obtain Column Information button in the import function dialog, the dialog just closes and nothing else happens.</p>\n"},{"tags":["entity-framework","nuget","mvcscaffolding"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12898441,"title":"revert Scaffold command","body":"<p>Scaffolding is a powerful feature and we can generate models, controllers \nand views very fast from the package manager under visual studio.\nBut if you submit the wrong command,\nHow to revert it ?\nFor example : </p>\n\n<pre><code>Scaffold Controller Person -Repository\n</code></pre>\n"},{"tags":[".net","entity-framework","generics"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12898309,"title":"Generalizing the DbContext","body":"<h2>Introduction</h2>\n\n<p>I have a Client-Server architecture where the server stores its data in different databases using Entity Framework 5.0. Therefore, it has different <code>DbContext</code> classes. However, there are some entity types shared amongst them. So we can have:</p>\n\n<pre><code>public class MyFirstDataAccess : DbContext\n{\n    //constructor omitted\n    public DbSet&lt;SharedType&gt; MyEntities { get; set; }\n    public DbSet&lt;OtherType&gt; MyOtherEntities { get; set; }\n}\npublic class MySecondDataAccess : DbContext\n{\n    public DbSet&lt;SharedType&gt; MyEntitiesWithSharedType { get; set; }\n}\n</code></pre>\n\n<p>Of course, the actual entities are not shared.</p>\n\n<h2>The problem</h2>\n\n<p>Different parts of the program need only parts of the data. E.g. one part could use the entities of Type <code>SharedType</code>. So I created a generic interface that provides the data:</p>\n\n<pre><code>public interface IEntityProvider&lt;TEntity&gt; where TEntity : class\n{\n    DbSet&lt;TEntity&gt; Elements { get; set; }\n\n    void Dispose();\n    int SaveChanges();\n}\n</code></pre>\n\n<p>Implementing the interface in the <code>DbContext</code> I added the <code>Elements</code> property, which would replace e.g. the <code>MyEntitiesWithSharedType</code> property:</p>\n\n<pre><code>DbSet&lt;SharedType&gt; IEntityProvider&lt;SharedType&gt;.Elements { get; set; }\n</code></pre>\n\n<p>This actually works. Different parts of the program can now work with any <code>DbContext</code> as long as it provides the needed data.</p>\n\n<p>I want to reuse some parts of the server in the client. Of course, the client does not have a <code>DbContext</code>, but retrieves its data via a WCF service from the server. Therefore, the <code>DbSet</code>cannot be used in the <code>IEntityProvider</code> interface, because this interface must be shared with the client. So I created another interface, which contains the <code>DbSet's</code> members I need:</p>\n\n<pre><code>public interface IEntityCache&lt;TEntity&gt; : IEnumerable&lt;TEntity&gt;, IQueryable&lt;TEntity&gt;\n{\n    ObservableCollection&lt;TEntity&gt; Local { get; }\n\n    TEntity Add(TEntity entity);\n    TEntity Remove(TEntity entity);\n}\n</code></pre>\n\n<p>The problem is to get the <code>DbSet</code> as an <code>IEntityCache</code>. It cannot be cast directly, because the <code>DbSet</code> does not implement the interface, although it contains all its members. I tried some different approaches, but neither really worked:</p>\n\n<h2>Attempt 1</h2>\n\n<p>Create a subclass of <code>DbSet</code>, which implements the needed interface (--> class adapter).</p>\n\n<p>This does not work, because <code>DbSet</code> does not have any public or protected constructors. Therefore, the adapter class is not valid.</p>\n\n<h2>Attempt 2</h2>\n\n<p>Instead of using an adapter class, I tried to use an adapter interface, which derives from <code>IDbSet</code> and the necessary interfaces:</p>\n\n<pre><code>public ICustomDbSet&lt;SharedType&gt; MyEntities{ get; set; }\nIEntityCache&lt;SharedType&gt; IEntityProvider&lt;SharedType&gt;.Elements { get { return MyEntities; } }\n</code></pre>\n\n<p>This does not work, because EntityFramework does not set the <code>ICustomDbSet</code>. Probably because the value it would set, is no <code>IEntityCache</code>.</p>\n\n<h2>Solution</h2>\n\n<p>While writing this question, I found a pretty good solution (which I will post as an answer). So why do I post this question, though? Firstly, I would like to know, if there are any other approaches that seem more reasonable and if my solution has some drawbacks. Secondly, the solution might help someone else. And thirdly, writing this question took a while and it would be a pity to throw it away :)</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12551377,"title":"Enabling EF code first migrations V 4.3.1.0","body":"<p>I have worked with other migration projects and had no problem.  in my current project i seperated the migration and model projects.  I get the following error when adding migration or even when enabling migration (the configuration class is created):</p>\n\n<blockquote>\n  <p>PM> enable-migrations -Force No classes deriving from DbContext found\n  in the current project. Edit the generated Configuration class to\n  specify the context to enable migrations for.\n  System.Reflection.ReflectionTypeLoadException: Unable to load one or\n  more of the requested types. Retrieve the LoaderExceptions property\n  for more information.    at\n  System.Reflection.RuntimeModule.GetTypes(RuntimeModule module)    at\n  System.Reflection.RuntimeModule.GetTypes()    at\n  System.Reflection.Assembly.GetTypes()    at\n  System.Data.Entity.ModelConfiguration.Mappers.TypeMapper.&lt;.ctor>b_<em>1(Assembly\n  a)    at System.Linq.Enumerable.d</em>_14<code>2.MoveNext()\n  at System.Collections.Generic.List</code>1.InsertRange(Int32 index,\n  IEnumerable<code>1 collection)    at\n  System.Data.Entity.ModelConfiguration.Mappers.TypeMapper..ctor(MappingContext\n  mappingContext)    at\n  System.Data.Entity.DbModelBuilder.MapTypes(EdmModel model)    at\n  System.Data.Entity.DbModelBuilder.Build(DbProviderManifest\n  providerManifest, DbProviderInfo providerInfo)    at\n  System.Data.Entity.DbModelBuilder.Build(DbConnection\n  providerConnection)    at\n  System.Data.Entity.Internal.LazyInternalContext.CreateModel(LazyInternalContext\n  internalContext)    at\n  System.Data.Entity.Internal.RetryLazy</code>2.GetValue(TInput input)    at\n  System.Data.Entity.Internal.LazyInternalContext.InitializeContext()<br>\n  at\n  System.Data.Entity.Internal.LazyInternalContext.get_CodeFirstModel()<br>\n  at System.Data.Entity.Infrastructure.EdmxWriter.WriteEdmx(DbContext\n  context, XmlWriter writer)    at\n  System.Data.Entity.Migrations.Extensions.DbContextExtensions.&lt;>c_<em>DisplayClass1.b</em>_0(XmlWriter\n  w)    at\n  System.Data.Entity.Migrations.Extensions.DbContextExtensions.GetModel(Action`1\n  writeXml)    at\n  System.Data.Entity.Migrations.Extensions.DbContextExtensions.GetModel(DbContext\n  context)    at\n  System.Data.Entity.Migrations.DbMigrator..ctor(DbMigrationsConfiguration\n  configuration, DbContext usersContext)    at\n  System.Data.Entity.Migrations.DbMigrator..ctor(DbMigrationsConfiguration\n  configuration)    at\n  System.Data.Entity.Migrations.Design.MigrationScaffolder..ctor(DbMigrationsConfiguration\n  migrationsConfiguration)    at\n  System.Data.Entity.Migrations.Design.ToolingFacade.ScaffoldRunner.RunCore()\n  at System.Data.Entity.Migrations.Design.ToolingFacade.BaseRunner.Run()\n  Unable to load one or more of the requested types. Retrieve the\n  LoaderExceptions property for more information.</p>\n</blockquote>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12892192,"title":"Entity Framework - Automatically Adding Unattached Items","body":"<p>I use EF 5 and Code First.</p>\n\n<p>Ive got a main ViewModel that exposes a Translation Property. A Translation consists out of 1 to n Translation Items. The Translation Property is bound to a Usercontrol. When the Translation is created and Added via _context.Translations.Add(t) in the Viewmodel also all TranslationItems inside the Translation are saved and stored correctly in the DB.</p>\n\n<p>But when i try to Add a new TranslationItem (t.TranslationItems.Add) to a existing Translation it isn't saved in the DB. context.ObjectStateManager.GetObjectStateEntries(EntityState.Added) also returns no elements so i guess the new Translation Items is still unattached. Since the TranslationItem is added inside the Child Usercontrol, i can't access the current Datacontext To set the Entity State to Added. </p>\n\n<p>What can i do?</p>\n\n<p>Edit:</p>\n\n<pre><code>public class Translation : BaseEntity, IValidatableObject\n{\n\n    private List&lt;TranslationItem&gt; _translations;\n         public virtual List&lt;TranslationItem&gt; Translations\n    { \n        get{\n            return _translations;\n        }\n        set\n        {\n            _translations = value;\n\n        }\n    }s\n</code></pre>\n\n<p>In ViewModel:</p>\n\n<pre><code>Translation = new Translation(); or\n\nTranslation = repo.GetTranslation(1);\n</code></pre>\n\n<p>Binding to custom Usercontrol:</p>\n\n<pre><code>&lt;Views:TranslationTextInput   Translations=\"{Binding Translation}\"/&gt;\n</code></pre>\n\n<p>In code behind of UserControl:</p>\n\n<pre><code>             Trans.Translations.Add(new TranslationItem() { Text = \"\", Lcid = new CultureInfo(\"en\").LCID });\n</code></pre>\n\n<p>Save function:</p>\n\n<pre><code>    public void Update(Translation t)\n    {\n        if (t.Id == 0)\n            _context.Units.Add(t);\n        _context.SaveChanges();\n    }\n</code></pre>\n\n<p>I create the Context in the Viewmodel Constructor and pass it to the repository class.</p>\n"},{"tags":["c#","entity-framework","datagridview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12110943,"title":"Sort and Filter supported list in sync with EF entity","body":"<p>I need to write a wrapper that would allow me to sort and filter a QueryObject without loosing the sync capabilities of the object (it's for DataGridView data binding).</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/gg696575%28VS.103%29.aspx\" rel=\"nofollow\">This</a> seems like what I need, but it's in the upcomming (beta I think?) EF 5, while I'm still only on EF 3.5. I need to mimic that feature in a older version.</p>\n\n<p>I found a <a href=\"http://www.timvw.be/2007/02/22/presenting-the-sortablebindinglistt/\" rel=\"nofollow\">wrapper</a> that enabled me to sort, but not filter and I fail to figure out which path to take to add Filter support in this wrapper. This wrapper also looses the sync with the QueryObject, but I don't think that would be hard to fix.</p>\n"},{"tags":["c#","entity-framework","entity-framework-4","linq-to-entities","dbcontext"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12896862,"title":"How to use a named method","body":"<p>I am using following code and trying to use a named method within Linq-To-Entities</p>\n\n<pre><code>Customer FindCustomerByLastName(string lastname)  \n{  \n    DataContext MyContext = new DataContext();  \n    return MyContext.Customers.Where(c =&gt; GetByCustomerByLastName(c,lastname) == true).FirstOrDefault();  \n}  \n\nbool GetByCustomerByLastName(Customer Cust, string LastName)  \n{  \n    if (Cust.LastName == LastName)  \n        return true;  \n    else  \n        return false;  \n}  \n</code></pre>\n\n<p>But this give me following error at run time.</p>\n\n<blockquote>\n  <p>LINQ to Entities does not recognize the method 'Boolean\n  GetByCustomerByLastName(Customer, System.String)' method, and this\n  method cannot be translated into a store expression.</p>\n</blockquote>\n\n<p>If I change my method to use a lambda as follows, everything works fine.</p>\n\n<pre><code>Customer FindCustomerByLastName(string lastname)  \n{  \n    DataContext MyContext = new DataContext();  \n    return MyContext.Customers.Where(c =&gt; c.LastName == lastname).FirstOrDefault();  \n}  \n</code></pre>\n\n<p>Is it possible to use named method in Linq-To-Entities in the context I am trying to do?</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12896107,"title":"eager loading collection relationship in EF code first","body":"<p>Im using entity framework code first 4.3 in c#</p>\n\n<p>I got the following classes:</p>\n\n<pre><code>Class A\n{\npublic string Name { get; set; }\npublic List&lt;B&gt; Bs { get; set; }\n}\n\nClass B\n{\npublic string Name { get; set; }\n}\n</code></pre>\n\n<p>There is one to many realationship from A to B.\nWhen i try to load B list from A. I only get the first element from the list.</p>\n\n<p>When i execute the following code, i expect a2 to contain both b's, but actually it contains only one. does anyone can help spot the problem?</p>\n\n<pre><code>B b = new B() {Name = \"b\"};\nA a = new A() {Name = \"a\", \nBs = new List&lt;B&gt;() { new B() {Name = \"b1\"}, new B() {Name = \"b2\"} };\n\nusing (var context = new MyContext())\n{\ncontext.As.Add(a);\ncontext.SaveChanges();\n}\nusing (var context = new MyContext())\n{\nvar a2 = (from a in context.As.Include(a =&gt; a.Bs)\n        where a.Name == \"a\"\n        select a).Single();\n}\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql-server","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12896112,"title":"Exception On Foreign Constraint","body":"<p>I have a table StaffLevelMapping that has a foreign key column, which is a primary key another table AcademicLevel. It raises an exception that the Insert statement conflicted with a foreign key and it has its reference on the foreign key and the table in which it's a primary key. I know this usually happens if the value you are inserting does not exist in it's original table. But this does exist actually. I tried inserting it directly in SQL Server and it worked perfectly. But through my code it doesn't work. What surprises me the most is I used the same insert logic for the rest of my tables and I don't have problems save this one with this very table. Please I need a very quick help on this I have not slept in 2 days because of this error.</p>\n\n<p>Here's my insert code below:</p>\n\n<pre><code>public static StaffLevelMapping AddStafflevel(int staffId, int levelId, bool isEnabled)\n    {\n        var context = ObjectContextHelper.CurrentObjectContext;\n        var staffLevel = context.StaffLevelMappings.CreateObject();\n\n        staffLevel.StaffID = staffId;\n        staffLevel.ID = levelId;\n        staffLevel.IsEnabled = isEnabled;\n        context.StaffLevelMappings.AddObject(staffLevel);\n        context.SaveChanges();\n\n        return staffLevel;\n    }\n</code></pre>\n\n<p>Many thanks in advance to that special person that can put me out of this misery.</p>\n"},{"tags":["c#","sql","asp.net-mvc","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12893324,"title":"Relationships in entity framework","body":"<p>Hi I'm using Entity framework 5 and mvc4 and struggling with the entity framework relationships</p>\n\n<p>I have a User, Role and UserRole table \n<img src=\"http://i.stack.imgur.com/tD7j5.png\" alt=\"SQL Table\">\nThe model is created in Entity framework</p>\n\n<p><img src=\"http://i.stack.imgur.com/usiMF.png\" alt=\"enter image description here\"></p>\n\n<p>Here is the code I use to save the User and the Role but this doesnt work\nThe User and Role object properties is set before being passed to this method</p>\n\n<pre><code>public void saveNewUser(User u, Role r)\n{\n    using (FormValueEntities db = new FormValueEntities())\n    {\n        u.Roles.Add(r);\n        r.Users.Add(u);\n        db.SaveChanges();\n    }\n}\n</code></pre>\n\n<p>How do I create a new user and set the Role at the same time?</p>\n"},{"tags":["c#","multithreading","entity-framework","iis","objectcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":185,"score":2,"question_id":11117397,"title":"Will Entity Framework fail when running on a high volumn IIS web site","body":"<p>We have been trying to analyse this exception:</p>\n\n<blockquote>\n  <p>Message: Error: Object reference not set to an instance of an object..\n  Stacktrace:    at System.RuntimeTypeHandle.CreateInstance(RuntimeType\n  type, Boolean publicOnly, Boolean noCheck, Boolean&amp; canBeCached,\n  RuntimeMethodHandleInternal&amp; ctor, Boolean&amp; bNeedSecurityCheck)    at\n  System.RuntimeType.CreateInstanceSlow(Boolean publicOnly, Boolean\n  skipCheckThis, Boolean fillCache)    at\n  System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly,\n  Boolean skipVisibilityChecks, Boolean skipCheckThis, Boolean\n  fillCache)    at System.Activator.CreateInstanceT    at\n  Z.Services.ObjectContextManagement.ScopedObjectContextManager<code>1.get_ObjectContext()\n  at Z.Services.DatabaseAccess.DatabaseAccess</code>2.Manage()    at\n  Z.Services.DatabaseAccess.DatabaseAccess`2.get_ObjectContext()</p>\n</blockquote>\n\n<p>Basically we get an error when getting the ObjectContext.</p>\n\n<p>From this question: <a href=\"http://stackoverflow.com/questions/2575990/entity-framework-lazy-loading-doesnt-work-from-other-thread\">Entity Framework lazy loading doesn&#39;t work from other thread</a> we see that EF is dependent upon staying on the same thread.</p>\n\n<p>From this Jon Skeet's answer to this question: <a href=\"http://stackoverflow.com/questions/1643987/will-a-request-in-iis-run-on-a-single-thread\">Will a request in IIS run on a single thread?</a> we see that IIS has thread agility.</p>\n\n<p>When there is a lower traffic volumn we do not see this error, but when the load increases we see the error.</p>\n\n<p>So the question: If EF is dependent upon staying on a single thread, and IIS does not keep the request on a single thread, can EF be used on an application that is deployed on IIS?</p>\n\n<p><strong>Edit</strong></p>\n\n<pre><code>var frameworkAssembly = Assembly.GetAssembly(typeof(ObjectContextManager&lt;&gt;));\nvar managerType = frameworkAssembly.GetType(managerTypeName + \"`1\", true, true);\nmanagerType = managerType.MakeGenericType(typeof(TObjectContext));\nObjectContextManager = Activator.CreateInstance(managerType) as ObjectContextManager&lt;TObjectContext&gt;;\n</code></pre>\n\n<p>It appears that the error occurs on the last line of the above code. The error only occurs in production under heavy load.</p>\n\n<p><strong>Edit 2</strong></p>\n\n<p>The ObjectContextManager inherits from ObjectContext which is an EF class.</p>\n\n<pre><code> public abstract class ObjectContextManager&lt;T&gt; where T : ObjectContext\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":107,"score":2,"question_id":12894452,"title":"Updating an Entity with EF5","body":"<p>I have just started a new project and having had previous happy times with Entity Framework, I Nuget'ed in the latest version. All was going well until I tried to update an entity. I have the following code;</p>\n\n<pre><code>using (var c = new EFContext())\n{\n      Data.User u = new Data.User() { UserId = UserId };\n      c.Users.Attach(u);\n      u.FailedPasswordAttemptCount = newFailedPasswordAttemptCount;\n      c.SaveChanges();\n}\n</code></pre>\n\n<p>This worked fine in EF4. However in EF5 this craps out with a DbEntityValidationException as I have a non-nullable field in the user table (UserName).</p>\n\n<p>I could solve this by creating my Data.User object with an empty UserName and telling EF which properties have been modified,</p>\n\n<pre><code>using (var c = new EFContext())\n{\n      Data.User u = new Data.User() { UserId = UserId, UserName = \"\" };\n      ...\n      c.Entry(u).Property(\"FailedPasswordAttemptCount \").IsModified = true;\n      ...\n}\n</code></pre>\n\n<p>but this doesn't seem particularly manageable as more non-nullable fields are added to this and numerous other tables. </p>\n\n<p><a href=\"http://stackoverflow.com/questions/12855502/attach-and-update-boolean-or-int-doesnt-always-work/12864001\">This question</a> states that <code>Attach</code> will only work for entities derived from <code>EntityObject</code>. So I assume EF5 objects do not derive from this. </p>\n\n<p>Anyone know how I can update my entity without having to specify the all non-nullable string fields each time.</p>\n\n<p>Feels like I am missing something really obvious....</p>\n"},{"tags":["asp.net-mvc","visual-studio","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12893867,"title":"VS2010 Entity Designer vs other 3rd party alternatives?","body":"<p>I have been enjoying the VS2010 Entity Designer for Model-First DB modelling and generation. However I am finding it restrictive especially in terms of labelling associations and adding notes. My models will be large, and I plan to use multiple EDMX files for different parts of the model. The generated Classes will be used by an ASP.NET MVC project.</p>\n\n<p>Model-First DB Migration is very important to me, which VS2012 does not support where the EF designer is much improved. The VS 2010 EF designer does not enable labelling etc so loss is information happens when you continue to normalise the model ie \"Where are those columns now?\" \"Well they are records in that intersection table now.\"</p>\n\n<p>I have been looking at alternative 3rd Party solutions that address this area more comprehensively. The first product I have come across is DevArt's Entity Developer. </p>\n\n<p>I would appreciate any experience and advice on 3rd party solutions. It is a shame that I need to pull away from MS's VS EF offering.</p>\n\n<p>Many thanks,</p>\n\n<p>Ed </p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","asp.net-mvc-4","entity-framework-5"],"answer_count":5,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":193,"score":6,"question_id":12838666,"title":"Is it good practice to use EntityObjects as a Model (MVC)?","body":"<p>I'm building my first MVC 4/Razor web app using Entity Framework 5, and doing a bit of homework before making any design decisions.</p>\n\n<p>I see that the EF objects descend from <a href=\"http://msdn.microsoft.com/query/dev11.query?appId=Dev11IDEF1&amp;l=EN-US&amp;k=k%28System.Data.Objects.DataClasses.EntityObject%29;k%28TargetFrameworkMoniker-.NETFramework,Version=v4.5%29;k%28DevLang-csharp%29&amp;rd=true\" rel=\"nofollow\"><code>EntityObject</code></a>, which appears to have a lot of useful best-practices stuff built it, not least of which is optimistic concurrency handling.  In other words if 2 people load the record of Jane Doe of 123 Maple Street simultaneously, the first one changes her name to Jane Smith and the second one changes her address to 321 Maple Street, then it's very easy to allow both changes to be merged into the record without conflicts, while an attempt by a second user to modify the same field as the first user will result in an error.  </p>\n\n<p>On the other hand, it seems pretty standard practice to create lightweight <a href=\"http://en.wikipedia.org/wiki/Data_transfer_object\" rel=\"nofollow\">Data Transfer Objects</a> to pass data between the server and the client, and which serve as or in models for the MVC framework.  This is great for ensuring minimal traffic to the client, but it screws up concurrency checking.</p>\n\n<p>So I'm questioning the rationale for using DTOs.  What are the reasons for using DTOs?  How bad is it to use an <code>EntityObject</code> as or within a MVC model?  What other solution would you propose to enable optimistic concurrency handling as I've described above?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12893487,"title":"Or Condition in Entity Framework","body":"<p>I am working on entity framework project, i have to apply Or condition in dbContext.Where\nI have tried this but its giving me error \"Operator || cannot be applied to operand of types lambda expressions\"</p>\n\n<pre><code>return dataContext.Friends\n              .Where((r =&gt; r.ToUserId == touserid &amp;&amp; r.FromUserId == fromuserid) \n                  || (r =&gt; r.ToUserId == fromuserid&amp;&amp; r.FromUserId == touserid ))\n              .ToList();\n</code></pre>\n\n<p>I also tried using &amp;&amp; instead of || but its giving me same error for &amp;&amp;,how can i apply Or condition for this senario?\nI have tried without brackets as well</p>\n"},{"tags":[".net","entity-framework","c#-4.0","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12892377,"title":"How can I localize the Entity Framework build-in validation messages/exceptions?","body":"<p>Beside the annotation-based validation mechanism EF provides the so-called \"Facets\". Meaning on a string property you could have a \"Max Length\" Facet (through the EF model configuration) where you specify a max-length of 80 chars. Most often this is done automatically by EF when you use a database first approach.</p>\n\n<p>If now the property contains more than the specified number of chars, EF will throw a DbEntityValidationResult with the message</p>\n\n<blockquote>\n  <p>[PropName]: The field [PropName] must be a string or array type with a maximum length of '80'.</p>\n</blockquote>\n\n<p>My question: How can I localize such message??? I'd need it in german and italian as well...</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12890743,"title":"Reading related data in Entity framework","body":"<p>I have two tables named StaticPages and StaticPagesContents that these two tables ralated together with StaticSn from StaticPages and StaticID from StaticPagesContents .\nI need to read a field from StaticPagesContents named PageContent and display this data on one of my controls so i use this code :</p>\n\n<pre><code>if (DropDownList1.SelectedIndex &gt; -1)\n        {\n            using (shahedWSEntities myEntity = new shahedWSEntities())\n            {\n                var content = (from s in myEntity.StaticPages\n                               where s.StaticSn == Convert.ToInt32(DropDownList1.SelectedValue)\n                               select s);\n                if (!object.ReferenceEquals(content, null))\n                { \n                    CKEditorControl1.Text=...\n                }\n            }\n        }\n</code></pre>\n\n<p>but i can't access to StaticPageContents's PageContent field . could you please help me?</p>\n"},{"tags":["asp.net","asp.net-mvc-3","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12889291,"title":"Dropdownlist in MVC using entity framework","body":"<p>I am using entity framework in mvc3. I have a table in which two entries are coming from an another table in the shape of drop down list. Like emp_no and emp_name.\nNow i want that when i select Emp_no from the first drop down list,the corresponding emp_name \nwill be selected automatically.</p>\n\n<p>Is this possible ?\nThanks in advance.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","asp.net-mvc-4","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12891723,"title":"Is there an easy way to copy a collection of foreign keys from one entity to another?","body":"<p>Like the title suggests is there an easy way to copy a collection of foreign keys from one entity to another?</p>\n\n<p>A bit of background.</p>\n\n<p>The project I am working on contains Products that can contain collectoins of filecollections, Press Releases and a few other things that are all linked together with foreign key collections. So for example the file collection may contain 10 screenshots that are all linked to the filecollection by a foreign key. This filecollection is then linked to the product via a foreign key.</p>\n\n<p>If someone was to come along and accidently enter two products almost identical but with a slightly different name and we decided that we could merge them together. What is the best way of moving these collections to the other object?</p>\n\n<p>The way I have been doing it at the moment is using a for each loop and looping through the collections and manually changing the productId. This may well be the best way of doing it. I just wondered if there is an easier or more efficient way or if the way that I am doing it is fine?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","oracle","entity-framework","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":12888418,"title":"Generate IN statement for decimal values with Oracle","body":"<p>I'm having trouble getting LINQ to generate an IN statement.  I have a function that looks like the one below, taking as input a list of long representing the primary keys to find.  Using the contains methods ends up generating a query of composite OR statements.  We're running against an Oracle database. We're using the newest version of LINQ/EF.  QueryableDbSet is a DbSet.  The PrimaryKey property is a decimal value and is the primary integer identifier for the object in Oracle.</p>\n\n<pre><code>List&lt;long&gt; GetList(List&lt;long&gt; ids)\n{\n    List&lt;decimal&gt; dIds = ids.Select(x =&gt; (decimal)x);\n    var query = from c in QueryableDbSet\n                where dIds.Contains(c.PrimaryKey)\n                select (long)c;\n    return query.ToList();\n}\n</code></pre>\n\n<p>The above code will generate composite OR statements.  Does any one know how to get LINQ to generate the faster IN statements?  Thanks.</p>\n\n<p>EDIT:  Doing some more research it appears that Oracle actually converts IN statements to OR chains, so maybe this is an exercise in futility. Can anyone confirm or deny this?</p>\n\n<p>Also, I'm aware that the above function is completely pointless/redundant.  My real use case is more complicated and involves other conditionals in the where clause.</p>\n"},{"tags":["c#","entity-framework","entity-framework-ctp5"],"answer_count":6,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":2215,"score":5,"question_id":11471347,"title":"Entity Framework 5 - Could not load file or assembly EntityFramework, Version=5.0.0.0","body":"<p>I am trying to use Entity Framework 5 for my project but I seem to be having some issue getting the assembly installed to comply. And since I installed this initially using nuget, I am not certain what I need to do to cause this to work as I expect .  Any help on what I need to do to fix this problem please? </p>\n\n<p>*<em>System.IO.FileNotFoundException : Could not load file or assembly EntityFramework, Version=5.0.0.0, Culture=Neutral, PublicKeyToken=b77a5c561934e089' or one of it's dependencies The System cannot find the file specified.WRN: Assembly binding logging is turned OFF.  To enable assembly bind failure logging, set the registy value . . . *</em> </p>\n\n<p><strong>by using fusion log, i got this</strong></p>\n\n<pre><code>*** Assembly Binder Log Entry  (7/17/2012 @ 9:29:09 PM) ***\n\nThe operation failed.\nBind result: hr = 0x80070002. The system cannot find the file specified.\n\nAssembly manager loaded from:  C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\clr.dll\nRunning under executable  C:\\PROGRAM FILES (X86)\\MICROSOFT VISUAL STUDIO 11.0\\COMMON7\\IDE\\COMMONEXTENSIONS\\MICROSOFT\\TESTWINDOW\\vstest.executionengine.x86.exe\n--- A detailed error log follows. \n\n=== Pre-bind state information ===\nLOG: User = WORKALOT\\Tokorie\nLOG: DisplayName = Budget.Data, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null\n (Fully-specified)\nLOG: Appbase = file:///C:/Development/Summer2012BudgetApp/Budget.Service.Test/bin/Release\nLOG: Initial PrivatePath = NULL\nLOG: Dynamic Base = NULL\nLOG: Cache Base = NULL\nLOG: AppName = vstest.executionengine.x86.exe\nCalling assembly : Budget.Lib, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null.\n===\nLOG: This bind starts in default load context.\nLOG: Using application configuration file: C:\\PROGRAM FILES (X86)\\MICROSOFT VISUAL STUDIO 11.0\\COMMON7\\IDE\\COMMONEXTENSIONS\\MICROSOFT\\TESTWINDOW\\vstest.executionengine.x86.exe.Config\nLOG: Using host configuration file: \nLOG: Using machine configuration file from C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\config\\machine.config.\nLOG: Policy not being applied to reference at this time (private, custom, partial, or location-based assembly bind).\nLOG: Attempting download of new URL file:///C:/Development/Summer2012BudgetApp/Budget.Service.Test/bin/Release/Budget.Data.DLL.\nLOG: Attempting download of new URL file:///C:/Development/Summer2012BudgetApp/Budget.Service.Test/bin/Release/Budget.Data/Budget.Data.DLL.\nLOG: Attempting download of new URL file:///C:/Development/Summer2012BudgetApp/Budget.Service.Test/bin/Release/Budget.Data.EXE.\nLOG: Attempting download of new URL file:///C:/Development/Summer2012BudgetApp/Budget.Service.Test/bin/Release/Budget.Data/Budget.Data.EXE.\nLOG: All probing URLs attempted and failed.\n</code></pre>\n"},{"tags":["entity-framework","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12887981,"title":"I need to create sql query with linq to entities","body":"<p>I have model</p>\n\n<pre><code>public class GrandPrix\n{\n    public int Id { get; set; }\n\n    [Required]\n    [Display(Name = \"\")]\n    [DataType(DataType.Text)]\n    public string Name { get; set; }\n\n    public int LocationId { get; set; }\n\n    public int? ChampionchipId { get; set; }\n\n    public virtual Location Location { get; set; }\n    public virtual Championchip Championchip { get; set; }\n}\n    public class Location\n{\n    public int Id { get; set; }\n\n    [Required]\n    [Display(Name = \"Location\")]\n    [DataType(DataType.Text)]\n    public string Name { get; set; }\n\n//    public virtual ICollection&lt;GrandPrix&gt; GrandPrix { get; set; } \n}\n</code></pre>\n\n<p>I need modify in</p>\n\n<pre><code>ViewBag.LocationId = new SelectList(db.Locations, \"Id\", \"Name\");\n</code></pre>\n\n<p>db.Locations\n.Where(l=>l.id is not contained in db.Grandprix.Where(g=>g.ChampionchipId == 1))</p>\n\n<p>this query it work</p>\n\n<pre><code>SELECT Locations.Id as Id, Locations.Name as Name FROM dbo.Locations WHERE Locations.Id Not In (SELECT GrandPrixes.LocationId FROM GrandPrixes WHERE ChampionchipId = 1)\n</code></pre>\n\n<p>sorry my English and thanks for help.</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":107,"score":2,"question_id":12884382,"title":"EF 5.0 Code First adding new children to existing parent","body":"<p><strong>Overview:</strong>\nI am working on an MVC ASP.Net app using Code First and EF 5.0. I have two tables: Scripts and ScriptItems. A Script can have multiple ScriptItems. ScriptItems are hierarchical as well. ScriptItems can optionally belong to each other, however this relationship is only 1 level deep thankfully. This relationship is indicated by ScriptItem.ParentId.</p>\n\n<p><strong>The problem:</strong>\nCreating a new Script entry with ScriptItems works just fine. The problem arises when I try to add ScriptItems to an existing Script. If I try to add ScriptItems that do NOT have a ParentId, everything works fine. As soon as I try to add ScriptItems that do have a ParentId, I receive a FK violation exception.</p>\n\n<p><strong>Details:</strong></p>\n\n<p>Script class:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class Script\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string Description { get; set; }\n    public string Type { get; set; }\n    [ForeignKey(\"ProcessorId\")]\n    public Processor Processor { get; set; }\n    public int ProcessorId { get; set; }\n    public string Owner { get; set; }\n    public DateTime Created { get; set; }\n    public bool Public { get; set; }\n\n    public List&lt;ScriptItem&gt; Items { get; set; }\n    public List&lt;ScriptRun&gt; Runs { get; set; }\n\n    public Script()\n    {\n        Items = new List&lt;ScriptItem&gt;();\n        Created = DateTime.Now;\n    }\n}\n</code></pre>\n\n<p>ScriptItem class: (Truncated for brevity)</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code> public class ScriptItem\n{\n    [Key]\n    public int Id { get; set; }\n\n    [ForeignKey(\"ParentId\")]\n    public ScriptItem Parent { get; set; }\n    public int? ParentId { get; set; }\n\n    public Script Script { get; set; }\n    [ForeignKey(\"Script\")]\n    public int ScriptId { get; set; }\n</code></pre>\n\n<p>The function that adds script items:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>private void addToScript(ScriptModel model, List&lt;int&gt; ids)\n    {\n        Script script = scriptRepository.GetScriptWithItems(model.ScriptId);\n        List&lt;History&gt; historyItems = historyRespository.History.Where(h =&gt; ids.Contains(h.Id)).ToList();\n\n        ScriptItem lastScriptItem = script.Items.OrderByDescending(item =&gt; item.SortIndex).FirstOrDefault();\n        int topSortIndex = lastScriptItem == null ? 0 : lastScriptItem.SortIndex;\n\n        if (script != null)\n        {\n            List&lt;ScriptItem&gt; newItems = new List&lt;ScriptItem&gt;();\n            Mapper.CreateMap&lt;History, ScriptItem&gt;();\n            foreach (History h in historyItems)\n            {\n                ScriptItem scriptItem = new ScriptItem();\n                Mapper.Map(h, scriptItem); //Populate new ScriptItem from History entry\n                scriptItem.SortIndex = ++topSortIndex;\n                scriptItem.ScriptId = model.ScriptId;\n                scriptItem.Script = script;\n\n                //Only add an entry if it is NOT the parent of another entry. Otherwise, EF will duplicate the Parent entries\n                if (!historyItems.Any(his =&gt; his.ParentId == h.Id))\n                    newItems.Add(scriptItem);    \n            }\n            scriptRepository.AddScriptItems(newItems);\n        }\n    }\n</code></pre>\n\n<p>And finally the scriptRepository.AddScripItems():</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public void AddScriptItems(List&lt;ScriptItem&gt; items)\n    {\n        items.ForEach(item =&gt; context.Entry(item).State = System.Data.EntityState.Added);\n        context.SaveChanges();\n    }\n</code></pre>\n\n<p>Consider the scenario where I add two ScriptItems A and B to an existing script. A is the parent of B. When I run a SQL Server trace, I see that an attempt is made to insert the parent record A, but with a ScriptId of 0 hence the FK violation exception. No clue why ScriptId is 0. ScriptId is set properly on the ScriptItems, I verified this with the debugger.</p>\n\n<p>I did not include the function that inserts new Scripts and Items, because it is very similar to the addToScript function above. And it works fine. But if someone wants to see it, I can add that too.</p>\n\n<p>Someone smarter than me have any ideas? Thanks!</p>\n"},{"tags":["c#","winforms","entity-framework","c#-4.0","data-binding"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12866661,"title":"Databinding a child combobox with a many-to-many relationship","body":"<p>Good Afternoon, </p>\n\n<p>I'm attempting to implement the Entity Framework but seem to be having an issue when I'm trying to utilize a master-detail relationship.  Ideally, I'd like to be able to select a company from a combobox and then populate a subsequent combobox with a list of employee names for the selected company.  I seem to be running into issues trying to achieve this with a many-to-many relationship that has a bridge table containing some additional data.  The following is a simplified version of the three database tables I'm using:</p>\n\n<pre><code>create table Organization.Company\n(\n   CompanyID int not null,\n   CompanyName varchar(40) not null,\n   ServiceRepresentative varchar(20) not null,\n   primary key (CompanyID)\n)\n\ncreate table Person.Employment\n(\n   CompanyID int not null,\n   PersonID uniqueidentifier not null,\n   EmployeeID int not null,\n   FullTime bit not null,\n   HoursPerWeek float null,\n   primary key (CompanyID, PersonID),\n   constraint fk_Company_Employment foreign key (CompanyID) references Organization.Company(CompanyID),\n   constraint fk_Person_Employment foreign key (PersonID) references Person.ContactInfo(PersonID)\n)\n\ncreate table Person.ContactInfo\n(\n   PersonID uniqueidentifier not null,\n   FirstName varchar(40) not null,\n   LastName varchar(40) not null,\n   primary key (PersonID)\n)\n</code></pre>\n\n<p>Im my code-behind I have the following (WinForms):</p>\n\n<pre><code>    private orgEntities db;\n    private BindingSource companyBinding;\n    private BindingSource employeeBinding;\n\n    public MainForm()\n    {\n        InitializeComponent();\n\n        this.db = new orgEntities();\n        this.companyBinding = new BindingSource();\n        this.employeeBinding = new BindingSource();\n\n        this.companyBinding.DataSource = db.Companies.OrderBy(x =&gt; x.CompanyName);\n\n        this.employeeBinding.DataSource = companyBinding;\n        this.employeeBinding.DataMember = \"Employment\";\n\n        this.currentCompanyComboBox.DataSource = companyBinding;\n        this.currentCompanyComboBox.DisplayMember = \"CompanyName\";\n        this.currentCompanyComboBox.ValueMember = \"CompanyID\";\n\n        this.currentEmployeeComboBox.DataSource = employeeBinding;\n        this.currentEmployeeComboBox.DisplayMember = \"ContactInfo.FullName\";  // Generated by extension class\n        this.currentEmployeeComboBox.ValueMember = \"PersonID\";           \n    }\n</code></pre>\n\n<p>The issue I seem to be running into is that only one employee is displayed inside the combobox when a company is selected.  When I change the \"ContactInfo.FullName\" to \"EmployeeID\" I get the full list of EmployeeIDs.  I'm assuming that the entity framework is grabbing the first person and navigating to their FullName property which causes their information to be the only thing displayed.  </p>\n\n<p>Is there any way I can get the full list of names to display in this drop-down with the bridge table (Person.Employment) present or would I be better off just creating a view of combining the Employment and ContactInfo tables together and using that in the edmx file rather than the two separate tables?  </p>\n\n<p>I understand that I may be going about this the wrong way and I would be grateful if someone could point me in the right direction on this one.  Thank you and have a great day!</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":55,"score":4,"question_id":12887663,"title":"Is it dangerous for views to directly use domain models?","body":"<p>I've used an EF code-first approach to define my DB structure.  Currently, I am passing the EF entity classes directly into some of my views in an MVC application.  This makes it easy to populate and save the views because I can just directly have a repository give me my populated EF class, and if my controller receives an EF entity class in a postback, I can (if validation is OK) pass that straight through to the repository to save it.  However, is this potentially a security risk?  If there are properties on an entity class that I don't want modified, could the client submit those properties back as part of the postback and modify them anyway?  For example, say I have a view to edit a user to which I pass this EF model:</p>\n\n<pre><code>public class User {\n    [Required]\n    public string Firstname { get; set; }\n    [Required]\n    public string Surname { get; set; }\n    public DateTime DOB { get; set; }\n    public bool IsDisabled { get; set; }\n}\n</code></pre>\n\n<p>I might expose <code>Firstname</code>, <code>Surname</code>, and <code>DOB</code> as editable form fields, but I don't want the user to be able to set <code>IsDisabled</code> and disable their account.  What's the best way to guard against this?  Perhaps one should only use domain models in views directly when one thinks it's alright for <em>every</em> property persisted by that domain model to be settable by the user, or when one is just using that domain model to display things, rather than save things back to a data store?</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.3"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":572,"score":2,"question_id":9888789,"title":"Pre-Generate Views for EF Code First","body":"<p>Having finally deployed to live a new site built with Entity Framework Code First and MySql, one nagging annoyance is the pause often experienced while view metadata is cached. This seems to happen far more frequently than the application pool is recycled. (?)</p>\n\n<p>I guess that for a site which has a constant stream of traffic this might not be noticed often. For a new site with infrequent traffic it feels like every time I go to the site there's a 4-5 second delay in rendering the first page.</p>\n\n<p>So I tracked down the following links:</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/bb896240.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb896240.aspx</a></p>\n\n<p><a href=\"http://visualstudiogallery.msdn.microsoft.com/72a60b14-1581-4b9b-89f2-846072eff19d\" rel=\"nofollow\">http://visualstudiogallery.msdn.microsoft.com/72a60b14-1581-4b9b-89f2-846072eff19d</a></p>\n\n<p>The EF Power Tools CTP1 looked promising, apart from the fact that it seems to be broken for EF 4.3 and hasn't been updated for months. Also I'm not sure how that tool would fit in to our automated build process.</p>\n\n<p>The OptimizeContext() or WriteEdmx() methods that EF Power Tools is using throw this error</p>\n\n<pre><code>System.Reflection.TargetInvocationException: \nException has been thrown by the target of an invocation. ---&gt;    System.Data.ProviderIncompatibleException: The provider did not return a ProviderManifestToken string. ---&gt; System.Data.SqlClient.SqlException: \nA network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)\n</code></pre>\n\n<p>I initially assumed this might be MySql related but several others on the EF Power Tools Q&amp;A section are reporting it.</p>\n\n<p>So, in short, how do I pre-generate views for EF 4.3 code first, preferable in a way that can slot into an automated build process?</p>\n"},{"tags":[".net","asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12887369,"title":"EF CodeFirst and UserProfile in SimpleMembership","body":"<p>I have a table Tale with definition</p>\n\n<pre><code>public class Tale\n{\n    public int Id { get; set; }\n    public string Title { get; set; }\n    public string Text { get; set; }\n    public DateTime ReleaseDate { get; set; }\n\n    public int enum_TaleAuthorTypeId { get; set; }\n    public virtual enum_TaleAuthorType enum_TaleAuthorType { get; set; }\n\n    public int CommentableId { get; set; }\n    public virtual Commentable Commentable { get; set; }\n}\n</code></pre>\n\n<p>and when i type 'update-database' in console, i have nice relationships with one column for CommentableId and one for enum_TaleAuthorTypeId.</p>\n\n<p>Now, i'd like to add UserProfile and try to type something like:</p>\n\n<pre><code>    public int UserProfile_UserId { get; set; }\n    public virtual UserProfile UserProfile { get; set; }\n</code></pre>\n\n<p>but after add-migration, i have this:</p>\n\n<pre><code>    public override void Up()\n    {\n        CreateTable(\n            \"dbo.UserProfile\",\n            c =&gt; new\n                {\n                    UserId = c.Int(nullable: false, identity: true),\n                    UserName = c.String(),\n                })\n            .PrimaryKey(t =&gt; t.UserId);\n\n        AddColumn(\"dbo.Tales\", \"UserProfile_UserId\", c =&gt; c.Int(nullable: false));\n        AddColumn(\"dbo.Tales\", \"UserProfile_UserId1\", c =&gt; c.Int());\n        AddForeignKey(\"dbo.Tales\", \"UserProfile_UserId1\", \"dbo.UserProfile\", \"UserId\");\n        CreateIndex(\"dbo.Tales\", \"UserProfile_UserId1\");\n    }\n\n    public override void Down()\n    {\n        DropIndex(\"dbo.Tales\", new[] { \"UserProfile_UserId1\" });\n        DropForeignKey(\"dbo.Tales\", \"UserProfile_UserId1\", \"dbo.UserProfile\");\n        DropColumn(\"dbo.Tales\", \"UserProfile_UserId1\");\n        DropColumn(\"dbo.Tales\", \"UserProfile_UserId\");\n        DropTable(\"dbo.UserProfile\");\n    }\n</code></pre>\n\n<p>At first, looks like EF think to create table UserProfile (but it's already created and i dont need it). Then, EF want to add two columns 'UserProfile_UserId1' and 'UserProfile_UserId', but i really need one for value.</p>\n\n<p>What's my problem?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1091,"score":4,"question_id":10415576,"title":"MVC EDMX Codebehind is using ObjectContext vs DBContext","body":"<p>I am new to EF.  I have a separate Project for my Models.  I have EF 4.3.1.0 installed.  I see that the base class of the Context is ObjectContext and not DbContext.  This becomes an issue when i scaffold my Controller in my front end project where in the Edit action it makes a call to </p>\n\n<pre><code>context.Entry(status).State = EntityState.Modified; \n</code></pre>\n\n<p>but Entry is not known.  I found that Entry is new with DbContext.  </p>\n\n<p>How do I have the generated code generate the right stuff?</p>\n\n<p>This is a DB First project</p>\n"},{"tags":[".net","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":299,"score":0,"question_id":12886334,"title":"ASP .NET MVC 4: WebSecurity.CreateUserAndAccount how to set UserId","body":"<p>I'd like to move my initialization of database tables and data (user, user in role e.t.c.) in Configuration.cs like in this article: <a href=\"http://blog.longle.net/2012/09/25/seeding-users-and-roles-with-mvc4-simplemembershipprovider-simpleroleprovider-ef5-codefirst-and-custom-user-properties/\" rel=\"nofollow\">http://blog.longle.net/2012/09/25/seeding-users-and-roles-with-mvc4-simplemembershipprovider-simpleroleprovider-ef5-codefirst-and-custom-user-properties/</a></p>\n\n<p>But i have a question: is it possible to set up UserId of adding users? I mean, i could add 5 users, and, as i think, they should get 1-2-3-4-5 Ids, but could i controll it and set up their Ids manual?</p>\n\n<p>Now initialization looks like:</p>\n\n<pre><code>        if (!WebSecurity.UserExists(\"elena\"))\n            WebSecurity.CreateUserAndAccount(\"elena\", \"password\");\n</code></pre>\n"},{"tags":["c#","entity-framework","fluent-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12885322,"title":"Entity Framework - Foreign key in sub-object","body":"<p>I am working with Entity Framework to retrive blog data from a database. I have a class \"BlogPost\" and a class \"Author\". One Author may have many blog posts, but the Author object itself does not contain a list of them. As far as the Author object is concerned, it is independent of all blog posts.</p>\n\n<p>An instance of the Author class is included as a property in the BlogPost. Every author has an AuthorId. I would like to pull from my database a given blog and have the Author object filled with the pertinent data. I have managed to do this by including an AuthorId property in my BlogPost class, using the following code to map the object:</p>\n\n<pre><code>this.HasRequired(t =&gt; t.Author).WithMany().HasForeignKey(x =&gt; x.AuthorId);\n</code></pre>\n\n<p>What I would like to do, however, is to be able to do the same thing but without having to include the AuthorId property directly in the model. The reason being, is because as the Author object contains the coresponding ID already, I am repeating the same piece of information twice. I would like to do something along these lines:</p>\n\n<pre><code>this.Property(t =&gt; t.Author.Id).HasColumnName(\"id_user\");\nthis.HasRequired&lt;TwitterUser&gt;(t =&gt; t.Author).WithMany().HasForeignKey(t =&gt; t.Author.Id);\n</code></pre>\n\n<p>So, is there any way do retrieve the Author sub-object without having to store the AuthorID redundantly in the BlogPost object alongside the Author object itself?</p>\n"},{"tags":["android","wcf","entity-framework","wcf-client","wcf-rest"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":162,"score":1,"question_id":12744440,"title":"How to Consume WCF Rest Service with Android","body":"<p>Here is code snippet, where I connect to my WCF Service.</p>\n\n<pre><code>DefaultHttpClient client = new DefaultHttpClient();         \n                            HttpGet request = new HttpGet(EMPLOYEE_LOG_IN);\n                            request.setHeader(\"Accept\", \"application/json\");\n                            request.setHeader(\"Content-type\", \"application/json\");          \n                            HttpResponse response = client.execute(request);\n                            HttpEntity entity = response.getEntity();\n                            if(entity.getContentLength() != 0) {\n                                Reader employeeReader = new InputStreamReader(response.getEntity().getContent());       \n                                                //create a buffer to fill if from reader            \n                                                char[] buffer = new char[(int) response.getEntity().getContentLength()];        \n                                                //fill the buffer by the help of reader         \n                                                employeeReader.read(buffer);                \n                                                //close the reader streams              \n                                                employeeReader.close(); \n                                                //for the employee json object              \n                                                JSONObject employee =  new JSONObject(new String(buffer));\n                                                Log.d(\"Response\",employee.getString(\"FirstName\"));    \n</code></pre>\n\n<p>It behaves different ways in different situation.\nHere is code from my WCF Service</p>\n\n<pre><code> public Controller GetEmployees(int personalNUmber)\n        {                \n\n                return new Controller\n                            {\n                                EmployeeId = 1,\n                                FirstName = \"FirstName\",\n                                LastName = \"LastName\"\n                            };    \n            }\n        }\n</code></pre>\n\n<p>SO when I call  this method   everything works fine, I get json format well, but when I \nedited my method and connected into Entity DB like this</p>\n\n<pre><code>FineReceiptsTestEntities _entity = new FineReceiptsTestEntities();\n\n        var t = _entity.Employees.FirstOrDefault(x =&gt; x.EmployeeID == personalNUmber);\n        return new Controller\n                   {\n\n                       EmployeeId = 1,\n                       FirstName = t != null ? t.Name : \" \",\n                       LastName = \"LastName\"\n                   }; \n</code></pre>\n\n<p>Json object didn't returned. Returned only html content with <strong>error</strong> like this</p>\n\n<blockquote>\n  <p>server encountered an error processing the request.Please see the\n   service help page  for constructing valid requests to the service.</p>\n</blockquote>\n\n<p>But both type of method in browser works fine and returns relevant data.</p>\n\n<p>and here is my <strong>web.config</strong></p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;system.web&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.0\"&gt;\n      &lt;assemblies&gt;\n        &lt;add assembly=\"System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n      &lt;/assemblies&gt;\n    &lt;/compilation&gt;\n  &lt;/system.web&gt;\n  &lt;system.serviceModel&gt;\n    &lt;standardEndpoints&gt;\n      &lt;webHttpEndpoint&gt;\n        &lt;standardEndpoint helpEnabled=\"true\" automaticFormatSelectionEnabled=\"true\" /&gt;\n      &lt;/webHttpEndpoint&gt;\n    &lt;/standardEndpoints&gt;\n    &lt;services&gt;\n      &lt;service name=\"dev_FineReceiptsService.ControllersInfo\"&gt;\n        &lt;endpoint kind=\"webHttpEndpoint\" contract=\"dev_FineReceiptsService.IControllersInfo\" /&gt;\n        &lt;endpoint address=\"mex\" binding=\"mexHttpBinding\" contract=\"IMetadataExchange\" /&gt;\n      &lt;/service&gt;\n    &lt;/services&gt;\n  &lt;/system.serviceModel&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"FineReceiptsTestEntities\" connectionString=\"metadata=res://*/FineTest.csdl|res://*/FineTest.ssdl|res://*/FineTest.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=msdev01;Initial Catalog=FineReceiptsTest;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>So can anyone tell me what is the problem when using Entity to retrieve data ?</p>\n"},{"tags":["sql-server-2008","entity-framework","code-first","sql-server-ce-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12751318,"title":"SQL Server CE identifies a cyclical reference with Entity Framework Code First but SQL Server 2008 does not","body":"<p>I am working on an Entity Framework Code First project that has a fairly complex Data Model which deploys absolutely fine on SQL Server 2008.</p>\n\n<p>However when creating an SQL Server CE database for some local End-To-End testing I get the following error message when EF creates the database:</p>\n\n<p><code>System.Data.SqlServerCe.SqlCeException: The referential relationship will result in a cyclical reference that is not allowed. [ Constraint name = FK_Sites_Persons_PersonId ].</code></p>\n\n<p>I have disabled the <code>ManyToManyCascadeDeleteConvention</code> in my DataContext model creation method, so that isn't the cause of the problem. The trouble I have is that the relationship in question looks fine in the SQL Server 2008 database- it appears to be a normal foreign key from what I can tell and I can't see anything flowing back in the other direction, although it is not impossible that there is a longer-path circular reference. I don't know why CE would fail and 2008 would succeed.</p>\n"},{"tags":["c#","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12883603,"title":"How to change multiple queries to a single query?","body":"<p>I have three tables namely \"Projects\", \"Platforms\", \"Details\". </p>\n\n<p>I have collected detail from the Projects table, then Platforms table and Details table. From the details table we may get the multiple values or single value. </p>\n\n<p>I have written the Linq query like below:</p>\n\n<pre><code>using (PEntities CSProject = new PEntities())\n{\n    projectId =    (from _project in CSProject.Projects\n                    where _project.ProjectName == project\n                    select _project.ProjectId).SingleOrDefault();\n\n    platformId =   (from platformID in CSProject.Projects\n                    where platformID.ProjectName == project\n                    select platformID.PlatformId).SingleOrDefault();\n\n    platformName = (from platfrmName in CSProject.Platforms\n                    where platfrmName.PlatformId == platformId\n                    select platfrmName.PlatformName).SingleOrDefault();\n\n    cSProjectId =  (from _csproject in CSProject.Details\n                    where _csproject.ProjectId == projectId\n                    select _csproject.CsprojectId).ToList&lt;long?&gt;();\n}\n</code></pre>\n\n<p>Can you please help me out to write the above all query in a single single line?</p>\n"},{"tags":["entity-framework","cascading-deletes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12859481,"title":"Entity Framework doesn't delete children, instead sets references to null","body":"<p>I have the following situation:</p>\n\n<p>First the only relevant table/class (all auto generated from DB (MySQL)):</p>\n\n<p><img src=\"http://i.stack.imgur.com/2or78.png\" alt=\"Table\"></p>\n\n<p>The relevant part of the edmx file:</p>\n\n<pre><code>     &lt;Association Name=\"navigationitem_ibfk_1\"&gt;\n      &lt;End Role=\"navigationitem\" Type=\"Model.Store.navigationitem\" Multiplicity=\"0..1\"&gt;\n        &lt;OnDelete Action=\"Cascade\" /&gt;\n      &lt;/End&gt;\n      &lt;End Role=\"navigationitem1\" Type=\"Model.Store.navigationitem\" Multiplicity=\"*\" /&gt;\n      &lt;ReferentialConstraint&gt;\n        &lt;Principal Role=\"navigationitem\"&gt;\n          &lt;PropertyRef Name=\"id\" /&gt;\n        &lt;/Principal&gt;\n        &lt;Dependent Role=\"navigationitem1\"&gt;\n          &lt;PropertyRef Name=\"navigationitemid\" /&gt;\n        &lt;/Dependent&gt;\n      &lt;/ReferentialConstraint&gt;\n    &lt;/Association&gt;\n</code></pre>\n\n<p>I think there aren't many more words needed: It's a navigation table, each navigationitem can have children (but it's not a must).</p>\n\n<p>Now when I try to remove a top level item which has a child:</p>\n\n<pre><code>context.Remove(topLevelNode);\ncontext.SaveChanges();\n</code></pre>\n\n<p>It deletes the top level node in the DB, but at the child nodes it just sets the <code>navigationitemid</code> to <code>null</code> (and yes - I have defined on delete cascade in the DB, when I delete it directly there it works).</p>\n\n<p>So what I think it's going on is, that when I delete the parent node, the framework sets all <code>navigationitemid</code> of all children to <code>NULL</code>, then when the navigation should be saved to the DB it won't cascade the delete because the <code>navigationitemid</code> of the children are <code>NULL</code>.</p>\n\n<p>What can I do? Thank you.</p>\n"},{"tags":["wpf","entity-framework","c#-4.0","backup","restore"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12883044,"title":"backup/restore from database with using entity framework","body":"<p>how to backup/restore from database with using entity framework ?</p>\n\n<p>Is it possible with entity framework 4.0 ?</p>\n\n<p>I am using the c#4.0 and wpf and EF4.0</p>\n"},{"tags":["entity-framework","audit-logging"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12882618,"title":"Audit Logging with EF","body":"<p>I need to set up audit logging for my web application. I need to store a screen name, field name, user name, before value and after value. I'm using entity framework 4.3.1. I've seen that it's possible to use the ObjectStateManager to get access to this information in the SaveChanges event. Are there any issues with using this approach? Why would I <strong>not</strong> want to use it? I've seen that I can get the modified properties using the state mgr and the current values and new values collections, what happens if I add a child to a parent, does that mark the parent as modified and the child as added? Just trying to figure out if EF object state manager handles parent child relationships well?</p>\n\n<p>The other approach is to build up a string with all the auditable properties with the current value and store that in the database, when this info is required, I work backwards and try to build up a history of what changed and how. Seems like overkill. Any guidance will be appreciated. Thanks</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-4.3","ef-migrations"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":683,"score":4,"question_id":10822618,"title":"Confusion over EF Auto Migrations and seeding - seeding every program start","body":"<p>I recently changed an application from using the following for dev:</p>\n\n<pre><code>DropCreateDatabaseIfModelChanges&lt;Context&gt;\n</code></pre>\n\n<p><br>\nTo using:</p>\n\n<pre><code> public class MyDbMigrationsConfiguration: DbMigrationsConfiguration&lt;GrsEntities&gt;\n{\n    public MyDbMigrationsConfiguration()\n    {\n        AutomaticMigrationsEnabled = true;\n        AutomaticMigrationDataLossAllowed = true;\n    }\n}\n</code></pre>\n\n<p><br>\n In my db context I have:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        // Tell Code First to ignore PluralizingTableName convention\n        // If you keep this convention then the generated tables will have pluralized names.\n        modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n\n        //set the initializer to migration\n        Database.SetInitializer(new MigrateDatabaseToLatestVersion&lt;GrsEntities, MigrationConfig&gt;());\n    }\n</code></pre>\n\n<p>I have overridden Seed(context) in DbMigrationsConfiguration using the AddOrUpdate extension where I was just using Add before with seeding on the drop db (DropCreateDatabaseIfModelChanges).</p>\n\n<p>My confusion is that the Migration runs with each start of the application regardless of there being any changes to the DbContext. Each and every time I start the application (library run through a service) the initializer runs as does the Seed. My expected behaviour is a check whether a migration is necessary (behind the scenes check to see if model matches physical db) then update any new/removed tables/columns and only run seed if something has changed.</p>\n\n<p>In my testing seed runs every time, which is workable but seemingly inefficient and was not what I expected. Unfortunately the MSDN documentation is quite limited.</p>\n\n<p>Am I completely misusing MigrateDatabaseToLatestVersion? Is there any way to get the behaviour I expect (i.e. only seed if there is a model change) or should I just change my seed method to expect to be run every application launch?</p>\n"},{"tags":["entity-framework","asp.net-mvc-3"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1363,"score":0,"question_id":6306415,"title":"MVC3 Customizing DropdownList items in strongly typed view","body":"<p>I have an auto generated DropDownList from Entity Framework in a strongly typed view: </p>\n\n<pre><code> &lt;div class=\"editor-field\"&gt;\n    @Html.DropDownList(\"User_FK\", String.Empty)\n    @Html.ValidationMessageFor(model =&gt; model.User_FK)\n&lt;/div&gt;\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/7eGLm.jpg\" alt=\"Auto Generated drop down list\"></p>\n\n<p>Here is the action code: </p>\n\n<pre><code>public ActionResult Create()\n{\n    ViewBag.SystemMaster_FK = new SelectList(db.SystemMasters, \"System_PK\", \"Name\");\n    ViewBag.User_FK = new SelectList(db.Users, \"User_PK\", \"NetworkLogin\");\n    return View();\n} \n</code></pre>\n\n<p>I need this list to display the names of people loaded from Active Directory. How do I customize the select list options seperately?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1450,"score":0,"question_id":8313825,"title":"Using sample data to seed database for Entity Framework doesn't create database","body":"<p>I'm pretty new to using Entity Framework, as well as to using ASP.NET MVC. I've been able to complete a couple of tutorials on the ASP.NET MVC website and thought I would start my own project based on the MVC Music Store application.</p>\n\n<p>I can't tell where I went wrong (it all looks the same to me), but for some reason my seed data isn't creating the database.</p>\n\n<p>Item class:</p>\n\n<pre><code>namespace MySite.Models\n{\n    public class Item\n    {\n        public int Id { get; set; }\n        public string Name { get; set; }\n    }\n}\n</code></pre>\n\n<p>Tag class:</p>\n\n<pre><code>namespace MySite.Models\n{\n    public class Tag\n    {\n        public int Id { get; set; }\n        public string Name { get; set; }\n    }\n}\n</code></pre>\n\n<p>ItemTag class:</p>\n\n<pre><code>namespace MySite.Models\n{\n    public class ItemTag\n    {\n        public int Id { get; set; }\n        public int ItemId { get; set; }\n        public int TagId { get; set; }\n    }\n}\n</code></pre>\n\n<p>MySiteEntities class:</p>\n\n<pre><code>namespace MySite.Models\n{\n    public class MySiteEntities : DbContext\n    {\n        public DbSet&lt;Item&gt; Items { get; set; }\n        public DbSet&lt;Tag&gt; Tags { get; set; }\n        public DbSet&lt;ItemTag&gt; ItemTags { get; set; }\n    }\n}\n</code></pre>\n\n<p>Global.asax class:</p>\n\n<pre><code>namespace MySite\n{\n    public class MvcApplication : System.Web.HttpApplication\n    {\n        ...\n\n        protected void Application_Start()\n        {\n            System.Data.Entity.Database.SetInitializer(new MySite.Models.SampleData());\n\n            AreaRegistration.RegisterAllAreas();\n\n            RegisterGlobalFilters(GlobalFilters.Filters);\n            RegisterRoutes(RouteTable.Routes);\n        }\n    }\n}\n</code></pre>\n\n<p>Web.config file:</p>\n\n<pre><code>&lt;configuration&gt;\n  ...\n\n  &lt;connectionStrings&gt;\n    &lt;add name=\"MySiteEntities\"\n      connectionString=\"Data Source=|DataDirectory|MySite.sdf\"\n      providerName=\"System.Data.SqlServerCe.4.0\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>SampleData class:</p>\n\n<pre><code>namespace MySite.Models\n{\n    public class SampleData : DropCreateDatabaseIfModelChanges&lt;MySiteEntities&gt;\n    {\n        protected override void Seed(MySiteEntities context)\n        {\n            new List&lt;Item&gt;\n            {\n                new Item { Id = 1, Name = \"Bob Jones\" },\n                new Item { Id = 2, Name = \"George Smith\" },\n                new Item { Id = 3, Name = \"Boys and Girls\" },\n                new Item { Id = 4, Name = \"The President's Hair\" },\n                new Item { Id = 5, Name = \"Invaders From Mars\" },\n                new Item { Id = 6, Name = \"Tank Shooter\" },\n                new Item { Id = 7, Name = \"Stew's Blog\" },\n                new Item { Id = 8, Name = \"Social Mania\" }\n            }.ForEach(i =&gt; context.Items.Add(i));\n\n            new List&lt;Tag&gt;\n            {\n                new Tag { Id = 1, Name = \"Author\" },\n                new Tag { Id = 2, Name = \"Movie\" },\n                new Tag { Id = 3, Name = \"Video Game\" },\n                new Tag { Id = 4, Name = \"Website\" }\n            }.ForEach(t =&gt; context.Tags.Add(t));\n\n            new List&lt;ItemTag&gt;\n            {\n                new ItemTag { Id = 1, ItemId = 1, TagId = 1 },\n                new ItemTag { Id = 2, ItemId = 2, TagId = 1 },\n                new ItemTag { Id = 3, ItemId = 3, TagId = 2 },\n                new ItemTag { Id = 4, ItemId = 4, TagId = 2 },\n                new ItemTag { Id = 5, ItemId = 5, TagId = 3 },\n                new ItemTag { Id = 6, ItemId = 6, TagId = 3 },\n                new ItemTag { Id = 7, ItemId = 7, TagId = 4 },\n                new ItemTag { Id = 8, ItemId = 8, TagId = 4 }\n            }.ForEach(x =&gt; context.ItemTags.Add(x));\n        }\n    }\n}\n</code></pre>\n\n<p>That's pretty much everything. I did delete the database file at one point. Shouldn't it get created again when I build the solution?</p>\n"},{"tags":["c#","linq","entity-framework","c#-4.0","reflection"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12881866,"title":"Set Properties that not null using linq and reflection","body":"<p>I have a <code>Update</code> method like this:</p>\n\n<pre><code>public void Update(MyClass item, System.Linq.Expressions.Expression&lt;Func&lt;MyClass, bool&gt;&gt; exp)\n</code></pre>\n\n<p>and I update status field like this:</p>\n\n<pre><code>MyClass  u = ent.MyClass.Where(exp).FirstOrDefault();\nif (u == null)\n{\n    throw new Exception(\"No Record Found\");\n}\nelse\n{\n    u.Status=item.Status;              &lt;-------\n    ent.SaveChanges();\n}\n</code></pre>\n\n<p>ok ,the problem is I want to use this update method for various updates for example user may want to update <code>status,Name</code> or <code>Tel,fax,Address,name</code> and ...</p>\n\n<p>I want to check I property isn't null it assign to similar property of selected object(in line that show with arrow). How I can to this automatically ? I don't want wtite like this:</p>\n\n<pre><code>if(item.Status != null)\n{\n     u.Status = item.Status;\n}\nif(item.Name != null)\n{\n     u.Name = item.Name;\n}\n,....\n</code></pre>\n\n<p>thanks</p>\n"},{"tags":["entity-framework","azure","asp.net-mvc-4","sql-server-ce-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12859176,"title":"Using SQL Server CE 4.0 with Entity Framework on Windows Azure","body":"<p>I am using SQL Server CE 4.0 with WebApi on Windows Azure Websites. I have been successfully able to deploy SQL Server CE. The weird problem I am facing is that my site is able to log me in using the same DB but I am not able to use any of the controllers to fetch the data. </p>\n\n<p>I am using same connection string for both. The only difference is that for logging in I am using WebSecurity as I have enabled OAuth on the site.</p>\n\n<p>Can someone throw some light on how to debug and fix this issue? The error I am getting for the calls is </p>\n\n<blockquote>\n  <p><em>Format of the initialization string does not conform to specification\n  starting at index 0.</em></p>\n</blockquote>\n\n<p>However the same string works for authentication, change password, adding OAuth connections etc.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["entity-framework","validation","updates"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12871892,"title":"Entity Framework validation with partial updates","body":"<p>I'm using Entity Framework 5.0 with DbContext and POCO entities. There's a simple entity containing 3 properties:</p>\n\n<pre><code>public class Record\n{\n    public int Id { get; set; }\n    public string Title { get; set; }\n    public bool IsActive { get; set; }\n}\n</code></pre>\n\n<p>The Title field is always unmodified, and the UI simply displays it without providing any input box to modify it. That's why the <code>Title</code> field is set to <code>null</code> when the form is sent to the server.</p>\n\n<p>Here's how I tell EF to perform partial update of the entity (<code>IsActive</code> field only):</p>\n\n<pre><code>public class EFRepository&lt;TEntity&gt;\n{\n   ...\n   public void PartialUpdate(TEntity entity, params Expression&lt;Func&lt;TEntity, object&gt;&gt;[] propsToUpdate)\n   {\n       dbSet.Attach(entity);\n       var entry = _dbContext.Entry(entity);\n       foreach(var prop in propsToUpdate)\n           contextEntry.Property(prop).IsModified = true;\n   }\n}\n</code></pre>\n\n<p>and the call:</p>\n\n<pre><code>repository.PartialUpdate(updatedRecord, r =&gt; r.IsActive);\n</code></pre>\n\n<p>Calling <code>SaveChanges</code> method, I get the <code>DbEntityValidationException</code>, that tells me, <code>Title</code> is required. When I set <code>dbContext.Configuration.ValidateOnSaveEnabled = false</code>, everything is OK.\nIs there any way to avoid disabling validation on the whole context and to tell EF not to validate properties that are not being updated?\nThanks in advance.</p>\n"},{"tags":["entity-framework","entity-framework-5","telerik-open-access"],"answer_count":0,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":706,"score":4,"question_id":11255583,"title":"Entity Framework 5 vs Telerik OpenAccess ORM (specifically)","body":"<p>I am starting a new project and want advice on choosing an ORM. I know this topic has been brought up before, but this topic is specific to either Entity Framework 5 (not 4) or Telerik OpenAccess ORM.</p>\n\n<p>The project will reside on Windows Azure and use Windows Azure SQL Database. I will migrate it to .NET 4.5 once 4.5 is live on Azure.</p>\n\n<p>I am currently a Telerik Ultimate Collection subscriber.</p>\n\n<p>Does anyone in the know have any pros/cons for this scenario? I am slightly leaning towards Telerik OpenAccess at the moment.</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12840333,"title":"Reattaching an object when PK is datetime based","body":"<p>My system is database first, EF 4.3.1.</p>\n\n<p>I have a table in which the PK is composed of two int columns and a datetime.\nThe table is a 'comment' table, to keep comments..</p>\n\n<pre>\nCREATE TABLE [dbo].[ArticleComments](\n    [ArticleId] [int] NOT NULL,\n    [UserId] [int] NOT NULL,\n    [MessageText] [nvarchar](max) NOT NULL,\n    [CreatedAt] [datetime] NOT NULL,\n    [ExternalData] [bigint] NULL,\n    CONSTRAINT [PK_ArticleComments] PRIMARY KEY CLUSTERED \n    (\n       [ArticleId] ASC,\n       [UserId] ASC,\n       [CreatedAt] ASC\n    )\n)\n</pre>\n\n<p>In my logic, when a comment is created, I send the ArticleComment object to another thread, where another context is opened to do additional actions on the object, in which eventually the object may be saved.</p>\n\n<p>The problem is, when the object is later saved, it sometimes throws an exception that nothing was saved.</p>\n\n<p>I opened the profiler to see what SQL is executed on <code>SaveChanges()</code></p>\n\n<pre>\nexec sp_executesql N'update [dbo].[ArticleComments]\nset [ExternalData] = @0\nwhere ((([ArticleId] = @1) and ([UserId] = @2)) and ([CreatedAt] = @3))\n',N'@0 bigint,@1 int,@2 int,@3 datetime2(7)',@0=3243423,@1=6931,@2=2,@3='2012-10-11 11:23:25.4734801'\n</pre>\n\n<p>And found out that the problem is that EF was mapping it to a datetime2(7) in stand of regular datetime, which is why this update will not change anything and the exception is thrown.</p>\n\n<p>I checked the EDMX file, over there it says the type is datetime with precision 3.</p>\n\n<p>FYI: <a href=\"http://msdn.microsoft.com/en-US/library/ms187819%28v=SQL.90%29.aspx\" rel=\"nofollow\">in addition, datetime is rounded in SQL Server</a></p>\n\n<p>SO, i found this article: <a href=\"http://stackoverflow.com/questions/2872444/round-net-datetime-milliseconds-so-it-can-fit-sql-server-milliseconds\">Round .NET DateTime milliseconds, so it can fit SQL Server milliseconds</a>\nWhich shows a nice way to round .net time to SQL time. And I think there is a class for this in <strike>the framework</strike> <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=29065\" rel=\"nofollow\">Microsoft System CLR Types for Microsoft SQL Server 2012</a> at <code>System.Data.SqlTypes</code> called <code>SqlDateTime</code> that will do the same.</p>\n\n<p>So my code looks like this (using the extension from the SO answer just linked):</p>\n\n<pre>\n hack the time -->  message.CreatedAt = message.CreatedAt.RoundToSqlServerDateTime();\n                    db.ArticleComments.Attach(message);\n                    message.ExternalData = someNumber;\n                    db.SaveChanges();\n</pre>\n\n<p>And it works.</p>\n\n<p><strong>But all of these are hacks, not solutions. Why is EF failing here, what am I doing incorrectly?</strong></p>\n"},{"tags":["entity-framework","ef-code-first","updating"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12879198,"title":"How can I update a detached entity in EF CF multi-tier application?","body":"<p>I'm developing a multi-tier app using EF CF . I managed to delete a detached entity this way:</p>\n\n<pre><code>       public void Delete(DbSet MySet, object Obj)\n        {\n            MySet.Attach(Obj);\n            var Entry = this.Entry(Obj);\n            Entry.State = EntityState.Deleted;\n            this.SaveChanges();\n        }\n</code></pre>\n\n<p>This method is defined in a class I called Adapter:DbContext.\nThe thing is, when updating, similar code doesn't work:</p>\n\n<pre><code> public void Update(DbSet MySet, object Obj)             \n    {\n        MySet.Attach(Obj);\n        var Entry = this.Entry(Obj);\n        Entry.State = EntityState.Modified;\n        this.SaveChanges();\n    }\n</code></pre>\n\n<p>This does not update the database nor throw any exceptions\nHow should I update a detached entity?</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12874556,"title":"EF (code-first): How should I change the value of a 1:1 association?","body":"<p>I have a <code>File</code> entity and a <code>User</code> entity. The <code>File</code> entity has a 1:1 relationship with the <code>User</code> entity through a property called <code>LastChangeUser</code> (this records the user who last changed the file). There's also a field within the <code>File</code> entity named <code>LastChangeUserId</code>, which is the actual FK relationship. The relationship is one-way: the <code>User</code> entity has no navigation property leading back to the <code>File</code> entity.</p>\n\n<pre><code>class File\n{\n    public int Id { get; set; }\n\n    public int? LastChangeUserId { get; set; }\n    public virtual User LastChangeUser { get; set; }\n}\n\nclass User\n{\n    public int Id { get; set; }\n}\n</code></pre>\n\n<p>When a <code>File</code> is changed, I need to set the <code>LastChangeUser</code> for the <code>File</code>. I only have the ID of the user to hand, not the complete User object. So, I'm doing this:</p>\n\n<pre><code>file.LastChangeUser = null;\nfile.LastChangeUserId = userId;\n</code></pre>\n\n<p>This seems to work on creating the file, when the <code>File</code> object is newly-created (a POCO which is then added to the entity collection).</p>\n\n<p>However, it does not work when updating the file, when the <code>File</code> object is an existing object retrieved (as a proxy) from the DB. </p>\n\n<p>In the latter case, I end up with a NULL in the DB for the <code>LastChangeUserId</code> field. (After a call to SaveChanges, the object has <code>null</code> in both the <code>LastChangeUser</code> and <code>LastChangeUserId</code> fields).</p>\n\n<p>Maybe I'm just doing the wrong thing here? What's the right way? Do I really need to go get the <code>User</code> object in order to set the <code>LastChangeUser</code> property?</p>\n"},{"tags":[".net","entity-framework","exception-handling"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":228,"score":0,"question_id":3578321,"title":"Determine source of a ConstraintException in an EF entity","body":"<p>I have an entity class with a bunch of non-nullable string properties.  If I try and set one of these to null, I get a <strong>ConstraintException</strong> and the message \"<em>This property cannot be set to a null value.</em>\"</p>\n\n<p>Without setting tracker variable to the name of each property before assignment, is there a way I can determine which property assignment caused the exception to be thrown?</p>\n"},{"tags":["entity-framework","char","contains"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12872651,"title":"Slow linq query when looking for char(1) datatype using contains","body":"<p>I've got an old database with a char(1) Status column. I'm using code first and entity framework 4.3.1 to interact with my database. My Status column in my code first class is defined as follows:</p>\n\n<pre><code>[Column(TypeName = \"char\")]\npublic string Status { get; set; }\n</code></pre>\n\n<p>I'm writing a linq query to fetch all items with a Status of one of several values. The code looks something like this (although it's been simplified):</p>\n\n<pre><code>List&lt;string&gt; statusList = new List&lt;string&gt;() {\"N\",\"H\",\"P\"};\n...\nvar entries = (from t in context.MyTable where statusList.Conains(t.Status)).ToList();\n...\n</code></pre>\n\n<p>The SQL thats generated prefixes all the Status values with N making the query quite slow.</p>\n\n<pre><code>WHERE ([Extent1].[Status] IN (N'N', N'P', N'P'))\n</code></pre>\n\n<p>It seems to be because it's comparing unicode with non unicode so it can't use the index on the Status column.</p>\n\n<p>I've had similar problems before in other linq queries, but I thought they were solved by putting [Column(TypeName = \"char\")] on the property.</p>\n\n<p>Does anyone know how I prevent SQL from putting those N's in front of all my Status values? I tried making statusList a List of char, but then I needed to change the definition of the Status column to char in code first, but that threw errors.</p>\n\n<p>Thanks\nDavid</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12874012,"title":"Typed Ids in entity framework","body":"<p>On the client side (WPF or Silverlight for example), I usually model entity ids by creating a id class for each entity:</p>\n\n<pre><code>class CarId { public readonly int Id; ... } // or string or Guid etc\n</code></pre>\n\n<p>so that I can have strongly typed ids and I won't have to pass around ints (or string or guid) without type information:</p>\n\n<pre><code>class Car { public CarId Id { get; private set; } ... }\n</code></pre>\n\n<p>(A similar reusable way is to create a generic class Id and have Id).</p>\n\n<p>Being new to entity framework and not having done a lot of back-end work, I wonder, is it possible to have entity framework map typed ids like those to primary key (integer/string/guid) table columns in the db? Initially I'd like to be able to use code-first.</p>\n"},{"tags":["c#","entity-framework","ado.net","entity"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12876677,"title":"visual studio 2010 cannot populate ado net entity framework data model","body":"<p>i'm trying to use ado net entity framework 4 with visual studio 2010, but i'm having some issues.\ni've created a data connection to a remote sql server, and now i'm trying to create a data model, the wizard goes ok, up until the ending part when i'm presented with the following error:</p>\n\n<blockquote>\n  <p>Unable to generate the model because of the following exception: 'An\n  error occurred while executing the command definition. See the inner\n  exception for details.    A transport-level error has occurred when\n  sending the request to the server. (provider: TCP Provider, error: 0 -\n  An established connection was aborted by the software in your host\n  machine.) '.</p>\n</blockquote>\n\n<p>i've checked and remoting is working. i can browse the database using visual studio, but the model isn't configured. i've tried refreshing the model from database and the same problem occurs. </p>\n\n<p>can anyone give some pointers on how to create the model without any issues?</p>\n\n<p>thanks in advance</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12876625,"title":"EF Create ViewModel from two sources","body":"<p>I have a need to get information from one source i.e. a list of Clients and add an array against each one from another source.  I essentially need a viewmodel like:</p>\n\n<pre><code>public class myVM\n{\n    public Client Client { get;set; }\n    public IEnumerable&lt;Target&gt; Targets { get;set; }\n}\n</code></pre>\n\n<p>Usually I would create a virtual and relationship between these and would perform nicely, but in this case the 'Targets' are not simply linked by a key/id, there will be some code in between that picks certain targets from the source so I need to add the Client and run the code that picks relevant targets and adds them in to the array above.</p>\n\n<p>This will work but obviously can perform slowly as requires MultipleDataSets running as well.  Does anyone know of a way to include an unmapped/unlinked object on a class setup for EF that you can simply add items to manually OR propose a better solution than this?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12874501,"title":"Having troubles with a particular Linq-To-Entity expression","body":"<p>I'm still learning the ropes for Entity expressions, and I have this SQL query that I would like to implement into a Entity expression, the query is:</p>\n\n<pre><code>SELECT classname,abbreviation, cid\n            FROM [db].[dbo].[classes] AS c\n            WHERE c.cid IN (\n                SELECT DISTINCT(CID)\n                FROM [db].[dbo].[CDS]\n                WHERE \n                        sid = '1'\n                        AND\n                        did = '24'\n                    )\n            ORDER BY abbreviation, classname \n</code></pre>\n\n<p>How would I go about implementing that query into an Entity expression?</p>\n"},{"tags":["asp.net-mvc","entity-framework","viewmodel","automapper","dto"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":117,"score":2,"question_id":12874328,"title":"Domain vs DTO vs ViewModel - How and When to use them?","body":"<p>In a Multi-layer project with Domain layer (DL)/Business (Service) Layer (BL)/Presentation Layer (PL), what is the best approach to deliver Entities to the Presentation Layer?</p>\n\n<pre><code>D =&gt; Domain Object;\nDTO = Domain Transfer Object;\nVM =&gt; View Model;\nV =&gt; View;\n</code></pre>\n\n<p>Option 1:</p>\n\n<pre><code>DL =&gt; DO =&gt; BL =&gt; DTO =&gt; PL =&gt; VM =&gt; V\n</code></pre>\n\n<p>This option seems to be the Best Practice but also seems heavy to mantain.</p>\n\n<p>Option 2:</p>\n\n<pre><code>DL =&gt; DO =&gt; BL =&gt; DTO =&gt; PL =&gt; V\n</code></pre>\n\n<p>This option seems not very good practice but as DTO are almost identical to the VM, we can pass it directly to the View and it's less painfull to implement and mantain.</p>\n\n<p>Is this option also reliable for multiple layouts, for example, for Mobile Devices I may need less information from the BL, so I will need a diferent VM for this particular Layout?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","foreign-keys","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":12868912,"title":"Specify ON DELETE NO ACTION in ASP.NET MVC 4 C# Code First","body":"<p>How do I specify ON DELETE NO ACTION Foreign Key Constraint in my model designs?</p>\n\n<p>At present, I have:</p>\n\n<pre><code>public class Status\n{\n    [Required]\n    public int StatusId { get; set; }\n\n    [Required]\n    [DisplayName(\"Status\")]\n    public string Name { get; set; }\n}\n\npublic class Restuarant\n{\n    public int RestaurantId { get; set; }\n    [Required]\n    public string Name { get; set; }\n    [Required]\n    [EmailAddress]\n    public string Email { get; set; }\n    [Required]\n    public string Telephone { get; set; }\n    [Required]\n    public int StatusId { get; set; }\n    public List&lt;Menu&gt; Menus { get; set; }\n\n    // NAVIGATION PROPERTIES\n    public virtual Status Status { get; set; }\n}\n\npublic class Menu\n{\n    public int MenuId { get; set; }\n\n    [Required]\n    public int RestaurantId { get; set; }\n\n    [Required]\n    public string Name { get; set; }\n\n    [Required]\n    public int StatusId { get; set; }\n\n    // NAVIGATION PROPERTIES\n    public virtual Status Status { get; set; }\n    public virtual Restaurant Restaurant { get; set; }\n}\n</code></pre>\n\n<p>And my DbContext:</p>\n\n<pre><code>public class MenuEntities : DbContext\n{\n    public DbSet&lt;Status&gt; Statuses { get; set; }\n    public DbSet&lt;Restaurant&gt; Restaurants { get; set; }\n    public DbSet&lt;Menu&gt; Menus { get; set; }\n}\n</code></pre>\n\n<p>As you can see: </p>\n\n<ul>\n<li>a Restaurant has many menus</li>\n<li>a Restaurant has one status</li>\n<li>a Menu belongs to 1 restaurant</li>\n<li><strong>Both Restaurants and Menus have 1 status. (Live, Invisible, Draft)</strong></li>\n</ul>\n\n<p>Naturally, if a status is deleted, I certainly don't want to cascade as this will muck everything up.</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>Mark Oreta mentions using the following in his example below:      </p>\n\n<pre><code>modelBuilder.Entity&lt;FirstEntity&gt;() \n    .HasMany(f =&gt; f.SecondEntities) \n    .WithOptional() \n    .WillCascadeOnDelete(false); \n</code></pre>\n\n<p>Where do I put this code? Within my MenuEntities / DbContext class? \nCan anybody provide an example of this being used?</p>\n\n<p><strong>UPDATE:</strong> \nGot this bit working now, however this has created a multiplicity constraint error when trying to seed the DB...</p>\n\n<pre><code>Multiplicity constraint violated. The role 'Menu_Status_Source' of the relationship 'LaCascadaWebApi.Models.Menu_Status' has multiplicity 1 or 0..1.\n</code></pre>\n\n<p>My Database Initialiser:</p>\n\n<p><a href=\"http://pastebin.com/T2XWsAqk\" rel=\"nofollow\">http://pastebin.com/T2XWsAqk</a></p>\n"},{"tags":["wcf","entity-framework","iis","entity-framework-4","autofac"],"answer_count":1,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":154,"score":3,"question_id":12865268,"title":"Entity Framework consuming a lot of memory (possible memory leak?)","body":"<p>We are using EF4.3.1 in a WCF service ( our business \\ application layer). We are using EF Code First with existing database and Fluent Mapping (EntityTypeConfiguraiton). \nAn instance of DbContext is created for each request and then disposed off. </p>\n\n<p>We have a generic repository which uses the DbContext. </p>\n\n<p>When running on test servers we found that the Business layer app pool is going out of memory in 30 mins or so with 10 concurrent users. We took dump of the IIS worker process and found that EF is consuming a lot of memory, there were many object in on large object heap created by EF. We could see objects for data retrieved from th DB on the heap. Not sure if the DbContext dispose is taking care of this. The % time in GC was very high (> 16%).\nOne strange thing we noticed in the dump file was, there was a huge string object  (around 87MB) storing string representation of all my mapping files. I found this to be very strange,</p>\n\n<p>Has anybody encountered any such memory leak issue with EF? Also please also let us know if there is something wrong in our usage of EF. Please let me know if more details are required.</p>\n\n<p>Thanks\nPrasad</p>\n\n<p><strong>EDIT</strong>\nWe inject an instance of DbContext using AutiFac DI (WCF integration). The life time for Dbcontext is InstancePerLifeTime ( one request per http request). We have implemented this way to share the instance of DbContext in all repositories instances in one HTTPrequest.</p>\n\n<p>The way we access database is \n// declaration\nIGenericRepository UserRepository {get;set;} // Property injection using AutoFac</p>\n\n<p>// Usage\nvar user = UserRepository.FindBy(u => u.userid == \"test@test.com\");</p>\n\n<p>We are not using explicit transactions in repositories. </p>\n"},{"tags":["c#","wpf","entity-framework","repository"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":114,"score":0,"question_id":12802157,"title":"Unit of work / what am I doing wrong / right?","body":"<p>I am using C#, WPF and EF 5</p>\n\n<p>I am creating my first EF application. The application has lots of master data to handle, so I implemented a generic repository:</p>\n\n<pre><code>public class PqsRepository&lt;E&gt; : IDisposable where E : BaseEntity\n{\n    private PqsDbContext _context;\n\n    public PqsRepository(PqsDbContext context)\n    {\n       _context = context;\n    }\n\n    public void Insert(E entity)\n    {\n        _context.Set&lt;E&gt;().Add(entity);\n    }\n\n    public void Update(E entity)\n    {\n        _context.Set&lt;E&gt;().Attach(entity);\n        _context.Entry&lt;E&gt;(entity).State = EntityState.Modified;\n    }\n\n    public void Delete(E entity)\n    {\n        _context.Set&lt;E&gt;().Attach(entity);\n        _context.Entry&lt;E&gt;(entity).State = EntityState.Deleted;\n    }\n\n    public int SaveChanges()\n    {\n        return _context.SaveChanges();\n    }\n\n    public IQueryable&lt;E&gt; Select()\n    {\n       return _context.Set&lt;E&gt;();\n    }\n\n    public E Select(object key)\n    {\n       return _context.Set&lt;E&gt;().Find(key);\n    }\n\n    public  void Dispose()\n    {\n        if (_context != null)\n            _context.Dispose();\n    }\n\n    public void InsertOrUpdate(E entity)\n    {\n        _context.Set&lt;E&gt;().Attach(entity);\n        _context.Entry&lt;E&gt;(entity).State = entity.Id == 0?\n                                  EntityState.Added :\n                                  EntityState.Modified;\n    }\n</code></pre>\n\n<p>I have my unit of work class:</p>\n\n<pre><code>class UnitOfWork\n{\n    private PqsDbContext _context;\n    private PqsRepository&lt;Unit&gt; _unitrepo;\n    private PqsRepository&lt;Translation&gt; _translationrepo;\n    private PqsRepository&lt;TranslationItem&gt; _translationitemrepo;\n\n    public UnitOfWork(PqsDbContext context)\n    {\n        _context = context;\n        _unitrepo = new PqsRepository&lt;Unit&gt;(_context);\n        _translationrepo = new PqsRepository&lt;Translation&gt;(_context);\n        _translationitemrepo = new PqsRepository&lt;TranslationItem&gt;(_context);\n    }\n</code></pre>\n\n<p>Nearly every master data class has a property of type <code>Translation</code>. And a translation has 1 to n translation items (different languages). To save a <code>MasterData</code> entity I have implemented a <code>Save</code> function on the unit of work:</p>\n\n<pre><code>    public void SaveUnit(Unit u)\n    {\n            _unitrepo.Update(u);\n            _translationrepo.InsertOrUpdate(u.Name);\n            foreach (TranslationItem ti in u.Name.Translations)\n                _translationitemrepo.InsertOrUpdate(ti);\n\n            _context.SaveChanges();\n    }\n</code></pre>\n\n<p>Question 1: How can I save the unit + translations without looping and saving all translation items?</p>\n\n<p>Question 2: Do I need a separate unit of code class for every master data I have?</p>\n\n<p>Question 3: what else am I missing?</p>\n"},{"tags":["entity-framework","caching","azure"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":12871770,"title":"Entity Framework second level cache and Windows Azure cache","body":"<p>We are running our application in Windows Azure. We are experiencing performance problems with SQL Azure so we are looking into implementing a second level cache. With the ORM that we are currently using this is quite difficult to accomplish.</p>\n\n<p>What about Entity Framework second level cache? Specifically when using Windows Azure cache(*). I know that it is currently not supported out-of-the-box and that are are some wrappers available. But are there any future plans on supporting this out-of-the-box?</p>\n\n<p>(*)\nThe idea is to use a certain percentage of the Web roles memory for caching.\nFor example using 5 medium Web roles and 20% memory for cache will mean a consistent cache of 3.5 GB.</p>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":139,"score":5,"question_id":12693961,"title":"Overriding entity deletion with associations","body":"<p>I am trying to implement a soft delete feature in my project by overriding the <code>DbContext.SaveChanges()</code> method and undoing the deletion of any entities which implement my <code>ISoftDelete</code> interface.</p>\n\n<pre><code>interface ISoftDelete\n{\n  bool IsDeleted { get; set; }\n}\n</code></pre>\n\n<p>In the <code>SaveChanges()</code> method I am calling my SoftDelete() method for every entry that is in the 'deleted' state and implements <code>ISoftDelete</code>.:</p>\n\n<pre><code>var entries = this.ChangeTracker.Entries().Where(x =&gt; (x.State == EntityState.Deleted) &amp;&amp; x.Entity is ISoftDelete)\n                    .ToList();\n                entries.ForEach(SoftDelete);\n</code></pre>\n\n<p>My <code>SoftDelete()</code> method is as follows:</p>\n\n<pre><code>private void SoftDelete(DbEntityEntry entry)\n{\n    if (entry.State == EntityState.Deleted &amp;&amp; entry.Entity is ISoftDelete)\n    {\n        entry.Reload();\n        var entity = (ISoftDelete)entry.Entity;\n        entity.IsDeleted = true;\n        entry.State = EntityState.Modified;\n    }\n}\n</code></pre>\n\n<p>This will work perfectly until I run into an entity which has a one to one association to something else. At which point, an exception is thrown with this error:</p>\n\n<blockquote>\n  <p>{\"A relationship from the 'ChildParent' AssociationSet is in\n  the 'Deleted' state. Given multiplicity constraints, a corresponding\n  'Parent' must also in the 'Deleted' state.\"}</p>\n</blockquote>\n\n<p>Is there a way to get all the associations for that entity and change the deleted state for them as well?</p>\n\n<p>I've already tried getting the reference to the actual associated entity but the entity's <code>EntityState</code> is set to <code>Unchanged</code> instead of <code>Deleted</code>.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12869711,"title":"Can I see what's in the ObjectStateManager when debugging?","body":"<p><strong>BACKGROUND</strong></p>\n\n<p>I'm having some trouble with updating an entity in EF. I keep getting this error:</p>\n\n<p><strong>\"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key\"</strong></p>\n\n<p>I am fully aware that there is obviously another entity somewhere that is attached. However, I currently cannot track it down. There is a lot of code and I've spent quite some time on it already. As far as I can see, I am using the <code>AsNoTracking()</code> extension method on all my queries.</p>\n\n<p><strong>WHAT I NEED</strong></p>\n\n<p>My question is this: Is there any way I can see what is actually in the <strong>ObjectStateManager</strong> at any given time? If I can see the items in there during debugging, I can more quickly track down where this is coming from.</p>\n\n<p>If the above is not possible, I would appreciate any advice on how best to tackle this problem.. it's like a needle in a haystack right now.</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":728,"score":8,"question_id":6038541,"title":"EF: Validation failing on update when using lazy-loaded, required properties","body":"<p>Given this extremely simple model:</p>\n\n<pre><code>public class MyContext : BaseContext\n{\n    public DbSet&lt;Foo&gt; Foos { get; set; }\n    public DbSet&lt;Bar&gt; Bars { get; set; }\n}\n\npublic class Foo\n{\n    public int Id { get; set; }\n    public int Data { get; set; }\n    [Required]\n    public virtual Bar Bar { get; set; }\n}\n\npublic class Bar\n{\n    public int Id { get; set; }\n}\n</code></pre>\n\n<p>The following program fails:</p>\n\n<pre><code>object id;\nusing (var context = new MyContext())\n{\n    var foo = new Foo { Bar = new Bar() };\n    context.Foos.Add(foo);\n    context.SaveChanges();\n    id = foo.Id;\n}\nusing (var context = new MyContext())\n{\n    var foo = context.Foos.Find(id);\n    foo.Data = 2;\n    context.SaveChanges(); //Crash here\n}\n</code></pre>\n\n<p>With a <code>DbEntityValidationException</code>. The message found in <code>EntityValidationErrors</code> is <em>The Bar field is required.</em>.</p>\n\n<p>However, if I force loading of the <code>Bar</code> property by adding the following line before <code>SaveChanges</code>:</p>\n\n<pre><code>var bar = foo.Bar;\n</code></pre>\n\n<p>Everything works fine. This also works if I remove the <code>[Required]</code> attribute.</p>\n\n<p>Is this really the expected behavior? Are there any workarounds (besides loading every single required reference every time I want to update an entity)</p>\n"},{"tags":["sql-server","database","visual-studio-2010","entity-framework","ef-model-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12868636,"title":"Create database and add to Visual Studio solution","body":"<p>I am creating a database with Entity Framework 4 and Visual Studio 2010.</p>\n\n<p>I am fine with the first steps - I am going model first, so I successfully created the model and now there is a valid .edmx file in my solution.</p>\n\n<p>My goal is the following: I want to generate the database and add it to the solution so I can give the solution to another person and they will be able to build it and run it - I do not want the database connection be dependent on any of my local settings, and I do not want them to have the need to recreate the database, it will have some 'seed data' in it. That should be possible, I saw similar solutions.</p>\n\n<p>I would appreciate advice on how to do that.</p>\n"},{"tags":[".net","entity-framework","collections","ienumerable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2928,"score":0,"question_id":2273958,"title":"Convert IEnumerable to EntityCollection Entity Framework 4","body":"<p>I have generated the following code with Entity Framework 4 for a navigation property:</p>\n\n<pre><code>&lt;XmlIgnoreAttribute()&gt;\n&lt;SoapIgnoreAttribute()&gt;\n&lt;DataMemberAttribute()&gt;\n&lt;EdmRelationshipNavigationPropertyAttribute(\"Diagnose\", \"Request_Comments\", \"Comment\")&gt;\nPublic Property Comments() As EntityCollection(Of Comment)\n    Get\n        Return CType(Me,IEntityWithRelationships).RelationshipManager.GetRelatedCollection(Of Comment)(\"Diagnose.Request_Comments\", \"Comment\")\n    End Get\n    Set\n        If (Not value Is Nothing)\n            CType(Me, IEntityWithRelationships).RelationshipManager.InitializeRelatedCollection(Of Comment)(\"Diagnose.Request_Comments\", \"Comment\", value)\n        End If\n    End Set\nEnd Property\n</code></pre>\n\n<p>When I want to reduce the results from the GET by adding a WHERE-Clause to it like this</p>\n\n<pre><code>Return CType(Me,IEntityWithRelationships).RelationshipManager.GetRelatedCollection(Of Comment)(\"Diagnose.Request_Comments\", \"Comment\") _\n.Where(Function(p) p.IsDeleted = False)\n</code></pre>\n\n<p>or by using Linq</p>\n\n<pre><code>Return From x In CType(Me,IEntityWithRelationships).RelationshipManager.GetRelatedCollection(Of Comment)(\"Diagnose.Request_Comments\", \"Comment\") _\nWhere x.IsDeleted = False Select x\n</code></pre>\n\n<p>the following Exception is thrown when I run the application :</p>\n\n<pre><code>Unable to cast object of type 'WhereEnumerableIterator`1[DAL.Comment]' to type 'System.Data.Objects.DataClasses.EntityCollection`1[DAL.Comment]'.\n</code></pre>\n\n<p>I don't know how to convert the result (which is an IEnumerable i think) from the query to an EntityCollection. I tried to add a \".ToList\" but that didn't help.<br>\nDoes anybody know a solution to that problem or a better way to kick out the deleted items from the collection?</p>\n"},{"tags":["c#","sql-server","entity-framework","entitykey"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12867924,"title":"Entity Framework Insert Error When 2 EntityKeys Being Used","body":"<p>Following is a sample of the error I'm getting.  The code names and such have been changed to make it more readible and it has been 'dumbed down' to just show the parts I'm having trouble with.</p>\n\n<p><strong>TABLE STRUCTURE:</strong>\n<img src=\"http://i.stack.imgur.com/KToGx.jpg\" alt=\"Basic table layout that I'm using\"></p>\n\n<p><strong>SUMMARY</strong></p>\n\n<p>I'm trying to add a new CHILD item along with an ADDRESS using Entity Framework 3.5 and I'm getting duplicate entry errors when I use 2 entitykey references in the process.  </p>\n\n<p><strong>CODE EFFORTS</strong></p>\n\n<p>First I tried to use parent references while creating my entity's:</p>\n\n<pre><code>        public bool AddChild(Guid parentId, string firstName, string lastName, string address, string city, int provinceCode)\n    {\n        bool success = false;\n\n        using (Entities e = new Entities(\"connection string\")\n        {\n            // prep address record\n            ADDRESS a = new ADDRESS\n            {\n                City = city,\n                Address = address,\n                PROVINCEReference = new System.Data.Objects.DataClasses.EntityReference&lt;PROVINCE&gt; { EntityKey = new System.Data.EntityKey(\"Entities.PROVINCEs\", \"ID\", provinceCode) },\n            };\n\n            // prep owner record\n            CHILD c = new CHILD\n            {\n                PARENTReference = new System.Data.Objects.DataClasses.EntityReference&lt;PARENT&gt; { EntityKey = new EntityKey(\"Entities.PARENTs\", \"ID\", new Guid(parentId)) },\n                ADDRESS = a,\n                FirstName = firstName,\n                LastName = lastName,\n            };\n\n            using (System.Transactions.TransactionScope transaction = new System.Transactions.TransactionScope())\n            {\n                try\n                {\n                    e.AddToCHILDs(c);\n                    e.AddToADDRESSes(a);\n\n                    // Save changes pessimistically. This means that changes must be accepted manually once the transaction succeeds.\n                    e.SaveChanges(false);\n                }\n                catch { }\n            }\n        }\n    return success;\n}\n</code></pre>\n\n<p>This doesn't work if I try to reference both foreign keys; however, if I just try to reference one or the other it works fine.  The first one will always work.  The second one will give the error.  It doesn't matter what order they are in.  If I use them by themselves or in other methods just like this, they work fine.</p>\n\n<p>I also tried to get actual items rather than just references such as:</p>\n\n<pre><code>PARENT o = e.PARENTs.First(x =&gt; x.ID.Equals(id));\nPROVINCE p = e.PROVINCEs.First(x =&gt; x.ID.Equals(1));\n\na.PROVINCE = p;\nc.ADDRESS = a\nc.PARENT = o;\n</code></pre>\n\n<p>And, I tried playing with the .Attach() method after finding similar errors:</p>\n\n<pre><code>e.Attach(p);\ne.Attach(o);\n</code></pre>\n\n<p>When I do it the first way (my preferred manner), whichever item is added first will work with no issues.  When I try the second one I'm getting an error (An item with the same key has already been added).  If I try to do it by pulling the actual records rather than just using a reference I'm getting the same type of error directly from the SQL Server 2005 database.  </p>\n\n<p>It makes sense after reading about this that it has to do with the Context and the fact that the code may be referencing 2 different versions of the parent records; however, I can't find a good way around it. </p>\n\n<p>All I want to do in the end, is to insert a child record with a new address.  The child record must reference the parent record and the address record must reference the province record.  Preferrably, I'd like to do this via references to cut down on the sql transactions.</p>\n\n<p>Thanks!</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Tried to create 2 of my own seperate entityKey objects and 2 seperate EntityReference&lt;> objects and now I'm getting the following error when I try to use the second EntityReference&lt;> object to assign the relationship/reference:</p>\n\n<blockquote>\n  <p>The EntityReference could not be initialized, because the relationship\n  manager for object to which the entity reference belongs is already\n  attached to an ObjectContext.</p>\n</blockquote>\n\n<p><strong>EDIT</strong></p>\n\n<p>Using a workaround that doesn't need any relationship/reference information from Alex's answer at: <a href=\"http://stackoverflow.com/questions/1011519/entity-framework-entitykey-foreign-key-problem\">Entity Framework EntityKey / Foreign Key problem</a></p>\n\n<p>I would still prefer not to use this because it forces you to have to do checks to see what info is already in the context and then it creates \"fake\" records to get through it as a work-around.  If anyone has any more info I'd love to hear!</p>\n"},{"tags":["entity-framework","ef-code-first","wcf-data-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12868466,"title":"Entity Framework Code First (with TPC) and Wcf Data Services Mapping","body":"<p>So, I have a TPC (Type per Concrete type) hierarchy as such:</p>\n\n<p><strong>Order</strong> and <strong>OrderDetail</strong> are both concrete types derived from abstract class <strong>AuditableEntity</strong></p>\n\n<p>The configuration for AuditableEntity is:</p>\n\n<pre><code> public class AuditableEntityConfig : EntityTypeConfiguration&lt;AuditableEntity&gt;\n{\n    public AuditableEntityConfig ()\n    {\n        //this.Property(m =&gt; m.IDN).HasDatabaseGeneratedOption(DatabaseGeneratedOption.None);\n        this.HasKey(m =&gt; m.IDN);\n\n        this.Property(m =&gt; m.Timestamp).HasDatabaseGeneratedOption(DatabaseGeneratedOption.Computed).IsRowVersion().IsRequired();\n        this.Property(m =&gt; m.AddedDate).HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n        this.Property(m =&gt; m.ModifiedDate).IsOptional();\n        this.Property(m =&gt; m.ModifiedByUser).IsOptional();\n        this.Property(m =&gt; m.RowGuid).IsRequired().HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n    }\n}\n</code></pre>\n\n<p>So the idea is to have this configuration for audit-related fields in the abstract class, and this would be applied to all derived classes. The following code is used while initializing the model:</p>\n\n<pre><code>var builder = new DbModelBuilder();\nbuilder.Configurations.Add(new AuditableEntityConfig());\nbuilder.Configurations.Add(new OrderConfig());\nbuilder.Configurations.Add(new OrderDetailsConfig());\n</code></pre>\n\n<p>And the TPC settings are in the respective concrete type configurations:</p>\n\n<pre><code>Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"Order\");\n        });\n\nMap(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"OrderDetail\");\n        });\n</code></pre>\n\n<p>However, when this is accessed via a Wcf Data Service with a URL as <em>http:localhost:4040/MyService</em>, only the AuditableEntities type is exposed, and <em>http:localhost:4040/MyService/AuditableEntities</em> returns data for both concrete types, BUT <em>http:localhost:4040/MyService/Orders</em> or <em>http:localhost:4040/MyService/OrderDetails</em> does not work.</p>\n\n<p>However, if I remove the \"builder.Configurations.Add(new AuditableEntityConfig())\", then the URIs for concrete types work and return data, but that defeats the purpose of applying the abstract configurations for audit-related properties.</p>\n\n<p>The MyDbContext only exposes the Orders and OrderDetails DbSets:</p>\n\n<pre><code>public DbSet&lt;Order&gt; Orders { get; set; }\npublic DbSet&lt;OrderDetail&gt; OrderDetails { get; set; }\n</code></pre>\n\n<p>The Wcf Data Service is self-hosted in a WPF window. All permissions are given.</p>\n\n<p>What settings am I missing?</p>\n\n<p>SUPPLEMENTAL QUESTION: when i add this Service Reference to a client project, the context is named as 'CodeFirstContainer' instead of MyDbContext. Why is this?</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework","debugging","configuration","proxy","entity"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12868996,"title":"Permanently disable Configuration.ProxyCreationEnabled in EF?","body":"<p>Instead of having to do the following on every query, is there a way to just set that value globally? There is a lazyloading setting in the model view, but there does not seem to be a setting for the ProxyCreation.</p>\n\n<pre><code>        using (var context = new LabEntities())\n        {\n            **context.Configuration.ProxyCreationEnabled = false;**\n\n            var Query = from s in context.EAssets\n                        .Include(\"Server\").Include(\"Type\").Include(\"Type.Definition\")\n                        where (s.Type.Definition.b_IsScannable == true) &amp;&amp;\n                        (s.Server.s_Domain == Environment.UserDomainName || s.Server.s_Domain == null)\n                        select s;\n           var Entities = Query.ToList();\n        }\n</code></pre>\n\n<p>I dont fully understand the benefits of this option, but i know that in visual studio is tags all my objects with gibberish serial suffixes and makes using the debugger unreasonable. </p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":349,"score":1,"question_id":10626592,"title":"How to retrieve specific columns in Entity Framework","body":"<p>Can I make my EF objects retrieve only specific columns in the sql executed?</p>\n\n<p>If I have a column that contains a large amount of data that really slows down the query, how can I have my objects exclude that column from the sql generated?</p>\n\n<p>If my table has Id(int), Name(int), Data(blob), how can I make my query be</p>\n\n<pre><code>select Id, Name from TableName\n</code></pre>\n\n<p>instead of </p>\n\n<pre><code>select Id, Name, Data from TableName\n</code></pre>\n\n<p>From the suggestion below, my method is</p>\n\n<pre><code> public List&lt;T&gt; GetBy&lt;T&gt;(DbContext context,Expression&lt;Func&lt;T, bool&gt;&gt; exp, Expression&lt;Func&lt;T,T&gt;&gt; columns) where T : class\n    {\n\n        return dbContext.Set&lt;T&gt;().Where(exp).Select&lt;T,T&gt;(columns).ToList();\n    }\n</code></pre>\n\n<p>And I'm calling it like so</p>\n\n<pre><code>List&lt;CampaignWorkType&gt; list = GetBy&lt;CampaignWorkType&gt;(dbContext, c =&gt; c.Active == true, n =&gt; new { n.Id, n.Name });\n</code></pre>\n\n<p>i got an error like below.</p>\n\n<p>Cannot implicitly convert type 'AnonymousType#1' to 'Domain.Campaign.CampaignWorkType'</p>\n\n<p>how i can solve this?</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12861305,"title":"Grabbing current DateTime using EF MVC","body":"<p>I want to apply a timestamp to my Entity Framework project. I have a class listed below. I hoped that this class would grab the current DateTime. But instead it provides me a field to enter my datetime. I want this to grab the current datetime.</p>\n\n<pre><code> public class Answer\n    {\n        public int ID { get; set; }\n        public string Answers {get; set;}\n        public System.DateTime DateCreated { get; set; }\n        public string Division { get; set; }\n        public string Phone { get; set; }\n        public string Description { get; set; }\n\n\n\n    }\n</code></pre>\n\n<p>Below is the line of code that i know is wrong. </p>\n\n<pre><code>public System.DateTime DateCreated { get; set; }\n</code></pre>\n\n<p>i am a little unsure of how to go about this. I am new to entity and new to MVC.  Any help would be greatly appreciated. </p>\n"},{"tags":["c#","entity-framework","attributes","entity"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":83,"score":2,"question_id":12868017,"title":"EF 5 Is Ignoring [Required] Attribute On Int Type","body":"<p>Entity Framework 5.0.0 seems to ignore the [Required] attribute when included on an int field and automatically includes a 0 value instead of throwing an exception. The required attribute does seem to work if the field is a string though. The simple model and create function below throws no exceptions. DbContext class with DbSet Degrees not shown for brevity.</p>\n\n<pre><code>public class Degree\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    [Required]\n    public int Field { get; set; }\n}\n\n\nprivate static void CreateDegree()\n{\n    var degree = new Degree { Name = \"Mechanical Engineering\" };\n    var db = new Context();\n    db.Degrees.Add(degree);\n\n    // try statement\n}\n</code></pre>\n\n<p>This maybe a simple misunderstanding on my part, but any thoughts / help would be greatly appreciated.</p>\n"},{"tags":["entity-framework",".net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":184,"score":0,"question_id":12863041,"title":"ReleaseHandleFail after upgrading to .net 4.0, possibly related to EntityFramework","body":"<p>I recently upgraded an application from .net 3.5 to 4.0.  Since I did that, with debug settings to break on all exceptions enabled, I've been getting a few of these exceptions each time I start a section of the application that connects to a database using the EF.  The exact number is variable; sometimes I only get one, others several in rapid succession.</p>\n\n<blockquote>\n  <p>ReleaseHandleFailed was detected Message: A SafeHandle or\n  CriticalHandle of type\n  'Microsoft.Win32.SafeHandles.SafeCapiHashHandle' failed to properly\n  release the handle with value 0x06AD3D08. This usually indicates that\n  the handle was released incorrectly via another means (such as\n  extracting the handle using DangerousGetHandle and closing it directly\n  or building another SafeHandle around it.)</p>\n</blockquote>\n\n<p>I never got exceptions like this when targeting 3.5.  These exceptions don't have any meaningful call stack attached, all I get is <code>[External Code]</code>, denying any easy way to localize where they're coming from.  The reason I suspect EntityFramework is somehow involved is that one section of the app uses nHiberate instead doesn't generate any of these messages.</p>\n\n<p>To run down other dependencies that might be involved:  In all cases, the ORM is talking to an Sql Compact database MS Sync Framework 2.1 is being used to update the local DB from SqlServer.  The Entity framework models have been regenerated with the 4.0 framework, and I upgraded the cache DB to v4.0 as well.</p>\n\n<p>Since there's no call stack I'm not sure if these messages fall into the category of \"harmless\" errors automatically cleaned up internal to the framework; or if there's an exception eater catching them elsewhere in the application.</p>\n"},{"tags":["asp.net-mvc","entity-framework","azure","sql-azure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12866560,"title":"How expensive is .Include in Entity Framework?","body":"<p>I have following simple query in ASP.NET MVC action method.</p>\n\n<pre><code>IEnumerable&lt;Company&gt; query = unitOfWork.CompanyRepository.dbSet\n    .Include(\"Adresses.PhoneNumbers\")\n    .Include(\"Adresses.FaxNumber\")\n    .Include(\"Emails\").Where(q =&gt; q.CustomerCompany == true);\n</code></pre>\n\n<p>This action method is called via ajax get request and sometimes it takes up to 25 secs! for just 40 Companies in database.Each of them has single Address and at most couple of PhoneNumbers and FaxNumbers.(Interestingly it sometimes takes 200-500 msecs, but very rare)</p>\n\n<p>If I change this query to following</p>\n\n<pre><code>IEnumerable&lt;Company&gt; query = unitOfWork.CompanyRepository.dbSet\n    .Where(q =&gt; q.CustomerCompany == true);\n</code></pre>\n\n<p>It only takes around 200 msecs. </p>\n\n<p>So I am wondering why <code>.Include</code> is so expensive. My application is in production and I am using SQL Azure with Azure Web Sites.</p>\n\n<p>Thanks.</p>\n"},{"tags":["entity-framework","sql-server-2008","connection-string"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1226,"score":2,"question_id":5920765,"title":"Does the Entity Framework use a default intital catalog and what assumptions does it make?","body":"<p>I did (pretty much) everything correct in a new EF project, but I forgot to use the named connection string in the EF context class, so, it used the default.</p>\n\n<p>It created a new database inside the SQL Express default data directory, and it worked perfectly.</p>\n\n<p>When I realised my mistake (After wondering for ages why no files were showing up in the app_data folder), I renamed the class to use the named connection string and then I kept getting the following error:</p>\n\n<blockquote>\n  <p>Unable to complete operation. The\n  supplied SqlConnection does not\n  specify an initial catalog.</p>\n</blockquote>\n\n<p>I know how to fix this, but, EF is like magic to me! I can't believe it works as well as it does and I am just curious as to what it uses by default / is there a list anywhere of \"assumptions\" that EF uses on your behalf if you specify nothing?</p>\n"},{"tags":["entity-framework","connection-string","sql-server-express","code-first"],"answer_count":2,"favorite_count":12,"up_vote_count":26,"down_vote_count":0,"view_count":22463,"score":26,"question_id":4116994,"title":"SQL Express connection string for Entity Framework Code First","body":"<p>I am working in Visual Web Developer 2010 Express, and using the Entity Framework Code First CTP.  I am able to do this with the new SQL CE but I am unable to find a connection string to work with SQL Express.</p>\n\n<p>This one, using the SQL CE beta, works fine (database is created and recreated on model changes).</p>\n\n<pre><code>&lt;add name=\"TrempimModel\"\n     connectionString=\"data source=|DataDirectory|TrempimModel.sdf\"\n     providerName=\"System.Data.SqlServerCe.4.0\" /&gt;\n</code></pre>\n\n<p>this one , which I copied from the aspnetdb conections string,</p>\n\n<pre><code>&lt;add name=\"TrempimModel\"\n     connectionString=\"data source=.\\SQLEXPRESS;Integrated Security=SSPI;\n     AttachDBFilename=|DataDirectory|TrempimModel.mdf;User Instance=true\"\n     providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>Gives the following message on startup: <strong><em>Unable to complete operation. The supplied SqlConnection does not specify an initial catalog.</em></strong></p>\n\n<p>So how to make it work with SQL Express?</p>\n"},{"tags":["entity-framework","c#-4.0","entity-framework-4","self-tracking-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":188,"score":0,"question_id":7903426,"title":"Entity Framework STEs and many-To-many associations","body":"<p>I'm fairly new to EF and STE's, but I've stumbled on a painful point recently, and I'm wondering how others are dealing with it...</p>\n\n<p>For example, suppose I have two STE's: Employee and Project. It's a many-to-many relationship. Each entity has a navigation property to the other (i.e. Employee.Projects and Project.Employees).</p>\n\n<p>In my UI, a user can create/edit an Employee and associate it with multiple Projects. When the user is ready to commit, a list of Employees is passed to the server to save. However, if an Employee is not added to the \"save list\" (i.e. it was discarded), but an association was made to one or more Projects, the ApplyChanges extension method is able to \"resurrect\" the Employee object because it was \"connected\" to the object graph via the association to a Project.</p>\n\n<p>My \"save\" code looks something like this:</p>\n\n<pre><code> public void UpdateEmployees(IEnumerable&lt;Entities.Employee&gt; employees)\n {\n     using (var context = new EmployeeModelContainer(_connectionString))\n     {\n        foreach (var employee in employees)\n        {\n           context.Employees.ApplyChanges(employee);\n        }\n\n        context.SaveChanges();\n     }\n }\n</code></pre>\n\n<p>I've been able to avoid this issue to now on other object graphs by using FKs to manipulate associations as described here: <a href=\"http://blogs.msdn.com/b/diego/archive/2010/10/06/self-tracking-entities-applychanges-and-duplicate-entities.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/diego/archive/2010/10/06/self-tracking-entities-applychanges-and-duplicate-entities.aspx</a></p>\n\n<p>How does one handle this when a many-to-many association and navigation properties are involved?</p>\n\n<p>Thanks.</p>\n"},{"tags":["entity-framework","lazy-loading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12866556,"title":"EF lazy loading: EntityType does not declare a navigation property with the name","body":"<p>I have a classes structure something like that:</p>\n\n<pre><code>public class Customer{\n         public AgreementDetails Agreement { get; set; }\n}\n\n[ComplexType]\npublic class AgreementDetails{\n    public int SalesPersonId { get; set; }\n    [ForeignKey(\"SalesPersonId\")]\n    [NotMapped]\n    public virtual SalesPerson Sales { get; set; }\n}\npublic class SalesPerson\n{\n...\n}\n</code></pre>\n\n<p>When I'm displaying the list of customers, i'm calling Sales property to disaply sales person details but property is null, usually for navigating properties this can be avoid using .Include method but it doesn't work in my case, so the query is</p>\n\n<pre><code>List&lt;Customer&gt; res = db.Customers.Include(c=&gt;c.Agreement.Sales).ToList();\n</code></pre>\n\n<p>The exception is: </p>\n\n<blockquote>\n  <p>A specified Include path is not valid. The EntityType\n  'CodeFirstNamespace.Customer' does not declare a navigation property\n  with the name 'Agreement'.</p>\n</blockquote>\n"},{"tags":["entity-framework","validation","annotations","database-first"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":12866576,"title":"Adding validation to model with Database First model (EF 5)","body":"<p>I know how to add validation errors to the model state. I know how to add the validation annotations to my model classes.  The problem is that with Database first, I don't want to touch the generated code, because when I regenerate, I will lose my customization. I always try to customize in partials, but you can't add annotation to an existing property in a partial.</p>\n\n<p>What is best practice here?</p>\n"},{"tags":["asp.net-mvc","entity-framework","knockout.js","asp.net-mvc-4","t4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":238,"score":0,"question_id":12866049,"title":"Entity Framework + MVC 4 + Knockout.js AddView templates?","body":"<p>I've been messing around with knockout.js a little bit lately and it seems like it has a lot of promise. However, I can't seem to find any good Code Templates (aka t4 templates or .tt files) for it.</p>\n\n<p>My GUESS is that the only changes that we would need would be on the view side, not the controller side, but I'd be up for looking at new controller templates too.</p>\n\n<p>Where I am right now:</p>\n\n<ul>\n<li>Create a new MVC 4 project</li>\n<li>Using NuGet, install entity framework 5, jquery, jquery ui, and knockout</li>\n<li>Create a .edmx model by reverse engineering your existing database with Entity Framework</li>\n<li>Drag C:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\Common7\\IDE\\ItemTemplates\\CSharp\\Web\\MVC 4\\CodeTemplates from Explorer into the root of your project</li>\n<li>Delete CodeTemplates\\AddController</li>\n<li>Highlight all of the items in CodeTemplates\\AddView\\CSHTML and blank out the text in \"Custom Tool\" in properties to keep them from\nbuilding</li>\n<li>Start screwing around with Create.tt and Edit.tt to add in knockout code.</li>\n</ul>\n\n<p>Goal Expected Input: Right Click > Add Controller ... > MVC Controller using EF</p>\n\n<p>Goal Expected Result: Controller &amp; View created using EF with knockout code already in place.</p>\n\n<p>If you use something similar to knockout that you like more, I'd love to hear about it!</p>\n\n<p>Also, is it necessary to use addons like MVCScaffolding?  It seems like you could just customize the existing templates and get the same results.</p>\n\n<p>Thanks for your time!</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","slickgrid"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12863893,"title":"usage of slickgrid in MVC3 entity framework","body":"<p>I would like to use slickgrid in my project to make editing a schedule easy. I downloaded it and found that the documentation in the folder and on the sites i have visited to be very vague. they do not show code as to how you would pull from a database. Does anyone have or know of any examples that show a view, model, and controller for slickgrid implementation? There is an example on code project but it uses data that is not in a database and is very simple in concept.</p>\n"},{"tags":["database","asp.net-mvc-3","entity-framework","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12864299,"title":"How do I ReSeed a database table with my data every time I run my app?","body":"<p>I have a web-app that uses EF5. I have two tables that are my main concern. I have a members table and a claims table. I have false members that I need for testing purposes and this saves their claims to the claims table. </p>\n\n<p>There is real data in these tables as well that I do not want to change. Some of the false members are missing different data or need specific things to process said claim. How do repopulate my false members exactly as I want them without dropping the database.</p>\n\n<p>I have looked into Code First Migrations on www.pluralsight.com but I am not sure how to tell it to always seed the 10 false members and remove the new claims from the claims table. Some of the members have past claims so I only wanna remove the ones that get added during testing.</p>\n\n<p>Anyone have any suggestions?</p>\n"},{"tags":["c#","entity-framework","ef-code-first","migration","ef-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12863794,"title":"Entity Framework: How to disable model compatibility check in Code First Migrations","body":"<p>I would like to create a database initializer that runs all the pending migrations regardless of whether the model is in the correct state or not. I.e. I want the initializer to run all the migrations even if it thinks the model state has changed since generating the migration so that it doesn't through the following error:</p>\n\n<pre><code>Unable to update database to match the current model because there are pending changes and automatic migration is disabled.\n</code></pre>\n\n<p>Does anyone know how I might get this to work?</p>\n\n<p>Thanks</p>\n"},{"tags":[".net","entity-framework","ef-code-first","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12863506,"title":"How can I have a 1:many table but a 1:1 navigation property?","body":"<p>I have two entities; let's call them Person and Address. A Person has only one current address [<em>insert joke about political candidate here</em>], but also has previous addresses, which are also stored in the Address table. Thus I want my database tables to have a 1:many relationship.</p>\n\n<p><em>However</em>, in my entity classes, I don't want a 1:many relationship between Person and Address, because I'm only really interested in their <em>current</em> address. (If I want to find out about their previous addresses, then I can look directly at the Address table). So, I do <em>not</em> want a 1:many \"Addresses\" property on the Person object. Instead, I want a 1:1 Address property, which I'll set to the current address.</p>\n\n<p>Can this be done?</p>\n"},{"tags":[".net","linq","entity-framework","aggregate-functions","expression-trees"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12862843,"title":"Query that uses the Aggregate extension method against DbContext","body":"<p>I had a <code>MockDataStore</code> that returns a <code>List&lt;Task&gt;</code>. Then I would use the <code>Aggregate</code> extension method to query that list. So I was doing a LINQ-to-Objects query which does the job quiet nicely. Now that I've replaced my mock data store with a class that inherits the <code>DbContext</code> class, the same query does not work anymore because I cannot use a lambda expression that has a body since it cannot be converted to an expression tree. So is there a way to get around it and still have the aggregation done in SQL and avoid having to do it in-memory? Below is my code:</p>\n\n<pre><code>        //List&lt;Task&gt; tasks = MockDataStore.GetData()\n        //    .Aggregate(new List&lt;Task&gt;(), (accumulator, treaty) =&gt; { accumulator.AddRange(treaty.Tasks); return accumulator; })\n        //    .Where(x =&gt; x.AssignedTo.Equals(companyId) &amp;&amp; x.StatusId == statusId).ToList();\n\n        using (SCGREDbContext context = new SCGREDbContext())\n        {\n            List&lt;Task&gt; tasks = context.Treaties.Aggregate(new List&lt;Task&gt;(), (accumulator, treaty) =&gt; { accumulator.AddRange(treaty.Tasks); return accumulator; })\n                                .Where(x =&gt; x.AssignedTo.Equals(companyId) &amp;&amp; x.StatusId == statusId).ToList();\n            return tasks;\n        }\n</code></pre>\n"},{"tags":["c#","entity-framework","transactions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":54,"score":-1,"question_id":12863950,"title":"What does DbConnection.EnlistTransaction do?","body":"<p>What does DbConnection.EnlistTransaction do?\nThank you for your time.</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12855502,"title":"Attach and update boolean or int doesn't always work","body":"<p>Using Entity Framework 5, Given an object <code>messenger</code> that exists in the database, with bit property <code>published</code>, in previous versions of EF I would update it like this:</p>\n\n<pre><code>using (var c = new EFContext())\n{\n    Data.Messenger cm = new Messenger { MessageId = messageId };\n    c.Messengers.Attach(cm);\n    cm.Published = newPublishedValue;\n    c.SaveChanges();\n}\n</code></pre>\n\n<p>However, using EF5, this works if <code>newPublishedValue</code> is <code>true</code>, but if <code>newPublishedValue</code> is <code>false</code>, no changes are made to the database. Likewise, this pattern will not set integer values to 0. </p>\n\n<p>What's going on here?</p>\n\n<p>Replacing </p>\n\n<pre><code>c.Messengers.Attach(cm);\n</code></pre>\n\n<p>with</p>\n\n<pre><code>c.Entry(cm).State = System.Data.EntityState.Modified;\n</code></pre>\n\n<p>Fixes the issue, but if EF5 won't update properties of my <code>new Data.Messenger</code> that are of a default struct value, doesn't that render the <code>Attach</code> method a bit useless?</p>\n\n<p>What am I missing here?</p>\n"},{"tags":["entity-framework","silverlight-5.0","out-of-browser"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12862306,"title":"Accessing data from Silverlight Out of Browser","body":"<p>When Silverlight runs in Out of Browser mode and off line, can it get the Sql Server Data from a DataBase located in the local disk by means of an ADO Entity Data Model?</p>\n"},{"tags":["c#","entity-framework","architecture"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":4,"view_count":59,"score":-3,"question_id":12863694,"title":"Entity framework architecture","body":"<p>I want to make a entity framework application in winforms c#.\nIm new to entity framework, and dont know how to make the architecture. I want to have the model in a class library, and a GUI layer, and maybe a controller layer.\nIm use to that architecture, but dont know have to handle the objects in other layers than the model. Have do I manage objects in the gui layer, when I cant have a reference to the model?\nIm use to have some kind of dto, but whats the best way?</p>\n\n<p>Thanks\nJakob</p>\n"},{"tags":[".net","entity-framework","dbcontext","esql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":12840251,"title":"How to build dynamic WHERE clauses using dbContext","body":"<p>We need to create dynamic WHERE Clauses depending on user input.\nUsing the old <code>ObjectContext</code> we found a way by using <code>.Where(&lt;ESql&gt;)</code>. </p>\n\n<pre>\nDim qry As ObjectQuery(Of MESSGROESSE) = _objContext.MESSGROESSE\nIf Not String.IsNullOrWhiteSpace(fltFormelzeichen.Text) Then\n    qry = qry.Where(\"it.Formelzeichen LIKE @Formelzeichen\", New ObjectParameter(\"Formelzeichen\", BuildESqlWildCard(fltFormelzeichen.Text)))\nEnd If\nIf Not String.IsNullOrWhiteSpace(fltBezeichnung.Text) Then\n    qry = qry.Where(\"it.Bezeichnung LIKE @Bezeichnung\", New ObjectParameter(\"Bezeichnung\", BuildESqlWildCard(fltBezeichnung.Text)))\nEnd If\n\n</pre>\n\n<p>Because this is a new project we would like to generally use the new DbContext. I know how to get at the ObjectContext from a DbContext:</p>\n\n<pre><code>Private _objContext As ObjectContext = CType(_dbContext, IObjectContextAdapter).ObjectContext\n</code></pre>\n\n<p>But then what?</p>\n\n<p>Using <code>DbContext.Database.SqlQuery</code> or <code>ObjectContext.CreateQuery</code> seems not to be an option, option because the EDMX generator destroys column names if they are the same as the table name and we do not have control over the DB schema. See <a href=\"http://stackoverflow.com/questions/12732114/how-to-stop-the-edmx-generator-from-changing-columns-names\">How to stop the EDMX generator from changing columns names</a>.</p>\n\n<p>We do not want dependencies on open source solutions.</p>\n\n<p>ADDED</p>\n\n<p>Meanwhile I talked the customer out of needing wildcards, so we can use Contains() with dbConctext:</p>\n\n<pre>\n_dbc = New TPTEntities\nDim qry As DbQuery(Of MESSGROESSE) = _dbc.MESSGROESSE\nqry = From e In _dbc.MESSGROESSE Take maxRows\n\nIf Not String.IsNullOrWhiteSpace(fltFormelzeichen.Text) Then\n    qry = From e In qry Where e.FORMELZEICHEN.Contains(fltFormelzeichen.Text)\nEnd If\nIf Not String.IsNullOrWhiteSpace(fltBezeichnung.Text) Then\n    qry = From e In qry Where e.BEZEICHNUNG.Contains(fltBezeichnung.Text)\nEnd If\nIf Not String.IsNullOrWhiteSpace(fltReihenfolge.Text) Then\n    qry = From e In qry Where e.REIHENFOLGE = fltReihenfolge.Text\nEnd If\nqry.Load()\n'TODO is _dbc.MESSGROESSE.Local the correct way to get at the data here?\nucoGridEditor.grd.ItemsSource = _dbc.MESSGROESSE.Local\n</pre>\n\n<p>I would still like to know how to use ESql Where() on dbContext though.</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12861871,"title":"Single collection as a result of two Foreign Keys?","body":"<p>Let's say I have the following entity:</p>\n\n<pre><code>public partial class Store\n{\n    public Store()\n    {\n        this.ConglomeratesByField1 = new HashSet&lt;Conglomerate&gt;();\n        this.ConglomeratesByField2 = new HashSet&lt;Conglomerate&gt;();\n    }\n\n    [Key]\n    public int ID_Store { get; set; }\n    public string StoreName { get; set; }\n\n    [ForeignKey(\"ID_Store1\")]\n    public virtual ICollection&lt;Conglomerate&gt; ConglomeratesByField1 { get; set; }\n    [ForeignKey(\"ID_Store2\")]\n    public virtual ICollection&lt;Conglomerate&gt; ConglomeratesByField2 { get; set; }\n} \n</code></pre>\n\n<p>With code first, is it possible to have a single \"Conglomerates\" property that would be the \"union\" of ConglomeratesByField1 and ConglomeratesByField2, or I have to extend the class with a specialized method?</p>\n"},{"tags":["c#",".net","linq","entity-framework","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12863171,"title":"An entity object cannot be referenced by multiple instances of IEntityChangeTracker","body":"<p>I'm having a problem with updating object entities in EF. I'm using VS 2010 and .NET 4</p>\n\n<pre><code>    private void Update(InstallerEntity editObj)\n    {\n        using (var eo = DataManager.CreateNewEntitiesContext())\n        {\n            eo.Attach(editObj);\n            eo.ApplyPropertyChanges(\"InstallerEntity \", editObj);\n            eo.SaveChanges();\n\n\n        }\n    }\n</code></pre>\n"},{"tags":["c#","sql-server","entity-framework","telerik-grid","telerik-mvc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":156,"score":0,"question_id":12839578,"title":"Telerik MVC Grid and Paging/Sorting/Filtering in database","body":"<p>I am using Telerik Grid MVC with AJAX binding.</p>\n\n<p>I thought that if I provide IQueryable to the grid, paging/sorting/filtering would be done at the database server. Like so:</p>\n\n<pre><code>[GridAction]\npublic ActionResult Select()\n{\n    return View(new GridModel(Mapper.Map&lt;IEnumerable&lt;DokumentVM&gt;&gt;(db.Dokumenti)));        \n}\n</code></pre>\n\n<p>I created test data of about 10000 documents in database, and upper command resulted in each of them hauled into the grid. And obviously, it takes forever.</p>\n\n<p>Grid is bound via AJAX, like this:</p>\n\n<pre><code>@(Html.Telerik().Grid&lt;ViewModels.DokumentVM&gt;()\n.DataBinding(b =&gt; b.Ajax().Select(\"Select\", \"Dokument\"))\n.Pageable(p =&gt; p.PageSize(20))\n.Sortable(s =&gt; s.SortMode(GridSortMode.MultipleColumn).OrderBy(m =&gt; { m.Add(\"Date\").Descending(); m.Add(\"Number\").Descending(); })))\n</code></pre>\n\n<p>Inside Select ActionMethod, when inspecting Request (its Form), I see that grid sends all info needed for proper functioning:</p>\n\n<pre><code>page:     1\nsize:     20\norderBy:  Date-desc~Number-desc\n</code></pre>\n\n<p>But when I further inspect SQL command sent to database, I see that there is only SELECT command present, no WHERE, no ORDER by, no nothing, which brings down all my data.</p>\n\n<p>I am wondering if it is possible for Paging/Sorting/Filtering to work automatically, or do I need to translate info sent by the grid into SQL commands myself. I was under impression that all I needed is to provide IQueryable and Grid would do the rest. But that's not working for me. </p>\n\n<p>Maybe I am doing something wrong, or maybe this is not even possible?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12862101,"title":"'Binding' a generic repository to an interface","body":"<p>I am currently following the following tutorial </p>\n\n<p><a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application\" rel=\"nofollow\">http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application</a></p>\n\n<p>This tutorial discusses how to implement a generic repository and unit of work.</p>\n\n<p>However, it does not appear to explain how to 'bind' a generic repository to an interface.</p>\n\n<p>Can anyone explain how to do this?  I need to 'bind' my generic repositories to either a generic interface or a derived/custom interface.</p>\n\n<p>Any help would be appreciated</p>\n"},{"tags":["entity-framework","c#-4.0","rowversion"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":77,"score":3,"question_id":12693934,"title":"Rowversion comparison in Entity Framework","body":"<p>How should I compare <code>rowversion</code> fields using Entity Framework? I have one table which has a <code>rowversion</code> column, I want to get data from tables for which row version is higher than specified value.</p>\n\n<pre><code>//code\nbyte[] rowversion = .....somevalue;\n\n _context.Set&lt;T&gt;().Where(item =&gt; item.RowVersion &gt; rowVersion);\n</code></pre>\n\n<p>This line does not work, it throws error:</p>\n\n<blockquote>\n  <p><em>cannot be applied to operands of type 'byte[]' and 'byte[]'</em></p>\n</blockquote>\n\n<p>Any idea how I can compare <code>rowversion</code> fields in c#/EF ?</p>\n"}]}
{"total":18927,"page":11,"pagesize":100,"questions":[{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12856401,"title":"C# dynamic casts when using Entity Framework for insertion","body":"<p>I have a database which contains tables of mapping values for a variety of objects. </p>\n\n<p>For example the <code>Colour</code> table contains <code>BLK &gt; Black, BLU &gt; BLUE, ORA &gt; ORANGE</code> etc.. and the <code>CarType</code> table contains <code>4DH &gt; Four-door hatchback, 4WD &gt; Four wheel drive</code> etc...</p>\n\n<p>I'm using Entity Framework code-first so I have a context set up something like this.</p>\n\n<pre><code>public class MappingContext : DbContext\n{\n    public MappingContext ()\n        : base(\"Mappings\")\n    {\n    }\n\n    public DbSet&lt;Colour&gt; ColourMappings { get; set; }\n    public DbSet&lt;CarType&gt; CarTypeMappings { get; set; }\n}\n</code></pre>\n\n<p>Every object that relates to each table in my <code>Mapping</code> database inherits from a base class like so:</p>\n\n<pre><code>public class Mapping\n{\n    public int Id { get; set; }\n\n    public string OrignalValue { get; set; }\n\n    public string MappedValue { get; set; }\n}\n\npublic class CarType : Mapping{}\npublic class Colour : Mapping{}\n</code></pre>\n\n<p>Now what I want to do is read these mappings in from an XML file filled with \"Templates\" which contain the mappings and insert them in the DB.</p>\n\n<p>I have the following method to do this:</p>\n\n<pre><code>public void InsertMappings(XDocument xml, string templateName, Type typeToInsert)\n{\n    // Here I find the relevent mappings \n\n    using (var repo = new Repository())\n    {\n        var mapppings = mappings.Select(mapping =&gt; new Mapping\n        {\n            MappedValue = mapping.Value,\n            OrignalValue = GetCode(mapping)\n        });\n\n        foreach (var mapping in mapppings.ToList())\n        {\n            var map = (typeToInsert)mapping  // &lt;&lt; This line will not compile\n\n            repo.Insert(map);\n        }\n\n    repo.Save();\n   }\n}\n</code></pre>\n\n<p>This will not complie as it doesnt recognise the attempted cast \"(typeToInsert)mapping\".</p>\n\n<p>So basically what I need to know is how to I cast this Mapping object to a Specific Mapping object when it comes to inserting it into the db? Or any suggestions for a better way of doing this!</p>\n"},{"tags":["entity-framework","mvvm","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12861937,"title":"EF+MVVM Async data fetching on shared context","body":"<p>In my current setup I am fetching data using Task.Run, which runs on another thread. During this time I display some message to user that data is loading, so no frozen screen appears to user.</p>\n\n<p>In some scenarios I need to run several queries using EF to fetch all data that is required. This I achieved using coroutines and Task library. The result is that each query is executed in sequence on different thread. Coroutines and Taks are used on ViewModel level, and a separate context is used for each ViewModel. So far I didn't experience any problems during testing in mentioned scenarios.</p>\n\n<p>In addition to data loading, the idea is also to save data in async manner, whenever user switches screens, so the user doesn't need to wait for saving to complete. In 99% of the cases data is 100% valid, if 1% occurs, then appropriate message is displayed to user on what screen there are validtione rrors. So far I didnt experience any problems during testing with this approach.</p>\n\n<p>The problem that I am having is how to implement this when sharing context between viewmodels. This means that each viewmodel can execute a method ON EF, which can result in two parallel queries on the same DbContext, and DbContext is not safe for multithreading.</p>\n\n<p>So, what are my options here? It seems that I need to implement some query queuing on context level, so I am wondering if this is the right approach at all, and if there is some example on EF query queuing? If you don't like the approach I am using, what would you recommend?</p>\n"},{"tags":["wcf","entity-framework","wcf-data-service"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":543,"score":4,"question_id":5300283,"title":"Data Service using EF - is it possible to use WebGet method which returns a custom type?","body":"<p>In my project I use Data Service which use EF. Now I have a custom class which I also want to expose through my Data Service, but I can't make it work, it's seems like it is impossible to mix custom types and EF in single Data Service. Any suggestions?</p>\n\n<p>Looks like it doesn't find some info in meta-data\nError:</p>\n\n<blockquote>\n  <p>The server encountered an error\n  processing the request. The exception\n  message is 'Unable to load metadata\n  for return type\n  'System.Linq.IQueryable<code>1[ITS.NetProject.Model.CustomEnty]'\n  of method\n  'System.Linq.IQueryable</code>1[ITS.NetProject.Model.CustomEnty]\n  GetCustomEnties()'.'. See server logs\n  for more details. The exception stack\n  trace is:....</p>\n</blockquote>\n\n<p>Code:</p>\n\n<pre><code>   [ServiceBehavior(IncludeExceptionDetailInFaults=true)]\n        public class ITSServiceOData : DataService&lt;ITSEntities&gt;\n        {\n            public static void InitializeService(DataServiceConfiguration config)\n            {\n\n                config.SetEntitySetAccessRule(\"*\", EntitySetRights.All);\n\n                config.SetServiceOperationAccessRule(\"GetCustomEnties\",                \n    ServiceOperationRights.AllRead);\n\n                config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;\n            }\n\n\n            [WebGet]\n            public IQueryable&lt;CustomEnty&gt; GetCustomEnties()\n            {\n                return from e in this.CurrentDataSource.CustomEnties select e;\n\n            }\n\n        }\n\n///Here it is my model definition\n\nnamespace ITS.NetProject.Model\n{\n    partial class ITSEntities\n    {\n        public IQueryable&lt;CustomEnty&gt; CustomEnties \n        {\n            get\n            {\n                return ...\n            }\n        }\n    }\n\n//Company, Equipment, Owner are EF entity classes\n    [DataServiceKey(\"Id\")]\n    public class CustomEnty\n    {\n        public int Id {get;set;}\n\n        public Subject Company { get; set; }\n\n        public Subject Equipment { get; set; }\n\n        public Subject Owner { get; set; }\n    }\n}\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12861458,"title":"Entity Framework connecting to SQLEXPRESS not SQL Compact","body":"<p>I have been trying out a code first EF project with SQl Compact 4.0.\nWhen I try running the project I get an error that \"CREATE DATABASE permission denied in database 'master'.\".</p>\n\n<p>I searched for help and in response to a few blogs tried to identify the connection string being used. To my surprise it was</p>\n\n<pre><code>context.Database.Connection.ConnectionString    \"Data Source=.\\\\SQLEXPRESS;Initial Catalog=Ancestors.Models.AncestorsContext;Integrated Security=True;MultipleActiveResultSets=True;Application Name=EntityFrameworkMUE\"    string\n</code></pre>\n\n<p>even though my web.config file includes the following sections...</p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"DefaultConnection\" providerName=\"System.Data.SqlServerCe.4.0\"    connectionString=\"Data Source=|DataDirectory|\\aspnet-Ancestors-20121012114712.sdf\" /&gt; \n&lt;/connectionStrings&gt;\n\n&lt;system.data&gt;\n&lt;DbProviderFactories&gt;\n  &lt;remove invariant=\"System.Data.SqlServerCe.4.0\" /&gt;\n  &lt;add name=\"Microsoft SQL Server Compact Data Provider 4.0\" invariant=\"System.Data.SqlServerCe.4.0\" description=\".NET Framework Data Provider for Microsoft SQL Server Compact\" type=\"System.Data.SqlServerCe.SqlCeProviderFactory, System.Data.SqlServerCe, Version=4.0.0.1, Culture=neutral, PublicKeyToken=89845dcd8080cc91\" /&gt;\n&lt;/DbProviderFactories&gt;\n&lt;/system.data&gt;\n</code></pre>\n\n<p>Has anyone any idea why EF is insisting on creating a connection to SQLEXPRESS instead of SQL Compact?\nI can find no reference at all to SQLEXPRESS anywhere in the solution.</p>\n"},{"tags":["c#","entity-framework","associations","edmx","database-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12861406,"title":"add association relations","body":"<p>I am using sql server db and Ef for code mapping. For some reason when I map my db to the demx file it's missing some of my relation and Associations between a few of my tables. So I need to use the Association in my code specifically in two tables. the Association in the db is 1 to 0 or 1. Can any one help me on the steps to do so. I have tried creating an Association but got this error: Error 3027: No mapping specified for the following EntitySet/AssociationSet\". </p>\n"},{"tags":["c#","database","asp.net-mvc-3","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":12860229,"title":"How do I seed specific values in a database every time the app runs?","body":"<p>I have an app that uses SSN's to look up people in a database. I am trying to force the 10 \"ssn's\" that I use for testing purposes to seed every time I run the app. I am currently dropping the table and reseeding the data with my false data but we are importing data from a real database to ours and I no longer want to do this. </p>\n\n<p>Can someone lead me to a site or give me a hint on how I could go about this?</p>\n"},{"tags":["entity-framework","delete","oracle10g"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":260,"score":4,"question_id":8036037,"title":"Entity Framework - Delete entity in Oracle 10g { Operation is not valid due to the current state of the object}","body":"<p>Hi I try use Repository pattern in Entity Framework on Oracle 10g.  I simplified my code:</p>\n\n<p>Here is SQL code:</p>\n\n<pre><code>-- Create table\ncreate table TESTTABLE\n(\n  MODULE_UNIQUE_ID VARCHAR2(32) not null,\n  PANEL_STATUS     VARCHAR2(8) not null\n)\ntablespace SYSTEM\n  pctfree 10\n  pctused 40\n  initrans 1\n  maxtrans 255\n  storage\n  (\n    initial 64K\n    minextents 1\n    maxextents unlimited\n  );\n-- Create/Recreate primary, unique and foreign key constraints \nalter table TESTTABLE\n  add constraint TESTTABLE_PK_01 unique (MODULE_UNIQUE_ID)\n  using index \n  tablespace SYSTEM\n  pctfree 10\n  initrans 2\n  maxtrans 255\n  storage\n  (\n    initial 64K\n    minextents 1\n    maxextents unlimited\n  );\n</code></pre>\n\n<p>I create simple repository class:</p>\n\n<pre><code>public interface IRepository&lt;TEntity, TCtx&gt;\n{\n    TCtx Session { get;}\n    void Add(TEntity entity);\n    void AddOrAttach(TEntity entity);\n    void Delete(TEntity entity);\n    int Save();\n    TEntity SelectByKey(string colName, string key);\n}\n\npublic class Repository&lt;TEntity, TCtx&gt; : IRepository&lt;TEntity, TCtx&gt;,\n    IDisposable\n    where TEntity : EntityObject\n    where TCtx : ObjectContext\n{\n    #region Private fields\n\n    private TCtx _ctx;\n    private string _keyProperty = \"ID\";\n\n    public int Save()\n    {\n        return _ctx.SaveChanges();\n    }\n\n   public TEntity SelectByKey(string colName, string key)\n    {\n        KeyProperty = colName;\n\n        // First we define the parameter that we are going to use the clause.\n        var xParam = Expression.Parameter(typeof(TEntity), typeof(TEntity).Name);\n        MemberExpression leftExpr = Expression.Property(xParam, KeyProperty);\n        Expression rightExpr = Expression.Constant(key);\n        BinaryExpression binaryExpr = Expression.Equal(leftExpr, rightExpr);\n\n        //Create Lambda Expression for the selection\n        Expression&lt;Func&lt;TEntity, bool&gt;&gt; lambdaExpr = Expression.Lambda&lt;Func&lt;TEntity, bool&gt;&gt;\n            (binaryExpr, new ParameterExpression[] { xParam });\n\n        //Searching ....\n        //IList&lt;TEntity&gt; resultCollection = ((IRepository&lt;TEntity, TCtx&gt;)this).SelectAll(new Specification&lt;TEntity&gt;(lambdaExpr));\n\n        //if (null != resultCollection &amp;&amp; resultCollection.Count() &gt; 0)\n        //{\n        //    //return valid single result\n        //    return resultCollection.First();\n        //}\n        //return null;\n\n        return ((IRepository&lt;TEntity, TCtx&gt;) this)\n            .SelectAll(new Specification&lt;TEntity&gt;(lambdaExpr)).FirstOrDefault();\n    }\n\n    public void Delete(TEntity entity)\n    {\n        _ctx.DeleteObject(entity);\n\n    }\n\n }\n</code></pre>\n\n<p>Problem is first I select some entity and then I want delete. \nSelect works against Oracle DB good. Problem is update or delete command.</p>\n\n<pre><code>   var _repo = new Repository&lt;TESTTABLE, Entities&gt;(\n            new Entities(ConfigurationManager.ConnectionStrings[\"Entities\"]\n                          .ConnectionString));\n\n    var obj = _repo.SelectByKey(\"MODULE_UNIQUE_ID\", \"11111\");\n    _repo.Delete(obj);\n    _repo.Save();\n</code></pre>\n\n<p>I get this exception:</p>\n\n<blockquote>\n  <p>{\"An error occurred while updating the entries. See the inner\n  exception for details.\"}</p>\n</blockquote>\n\n<p>Inner exception:</p>\n\n<blockquote>\n  <p>{\"Operation is not valid due to the current state of the object.\"}</p>\n</blockquote>\n\n<p>StackTrace:</p>\n\n<blockquote>\n  <p>at\n  System.Data.Mapping.Update.Internal.UpdateTranslator.CreateCommand(DbModificationCommandTree\n  commandTree)    at\n  System.Data.Mapping.Update.Internal.DynamicUpdateCommand.CreateCommand(UpdateTranslator\n  translator, Dictionary<code>2 identifierValues)    at\n  System.Data.Mapping.Update.Internal.DynamicUpdateCommand.Execute(UpdateTranslator\n  translator, EntityConnection connection, Dictionary</code>2\n  identifierValues, List`1 generatedValues)    at\n  System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager\n  stateManager, IEntityAdapter adapter)</p>\n</blockquote>\n\n<p>I tested my repository class again MS SQL database it works good.</p>\n\n<p>What can cause this problem?</p>\n"},{"tags":["c#","entity-framework","connection-string","sql-server-ce-4"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":197,"score":5,"question_id":12660683,"title":"How to use dynamic connection string for SQL Server CE?","body":"<p>I used SQL Server CE 4.0 in my windows app and use Entity Framework to create a model of it.</p>\n\n<p>It works fine but my problems is that it doesn't have a constructor to change the connection string, and by default it reads the connection string from the <code>app.config</code> file.</p>\n\n<pre><code> using (var Context = new MyEntitiesModel(//has no constructor))\n {\n        ...\n }\n</code></pre>\n\n<p>I create a dynamic connection string and</p>\n\n<pre><code>  using (var Context = new MyEntitiesModel())\n   {\n         Context.Database.Connection.ConnectionString = entityConnection.ConnectionString;\n   }\n</code></pre>\n\n<p>It works fine by this way but if I remove another connection string in <code>app.config</code> file it gave me this.</p>\n\n<blockquote>\n  <p><em>error = invalid metasource ....</em></p>\n</blockquote>\n\n<p>because the default constructor uses it</p>\n\n<p>How can I handle it?</p>\n"},{"tags":["entity-framework","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12859440,"title":"Update only scalar properties in Code First, EF 5","body":"<p>God day!</p>\n\n<p>I have a tree of entities and at specific point of time i need to update only scalar properties of one entity. Classic update rise entire graph lookup, but relations not need to update.</p>\n\n<p>The trouble in Category entity what one category have another categories in children. My method generate exceptions when saving changes about duplicate key. I think EF try to add children to database.</p>\n\n<p>Static method of my data context listed below:</p>\n\n<pre><code>    public static void Update&lt;T&gt;(T item) where T : KeyedObject\n    {\n        if (item == null)\n            throw new ArgumentNullException(\"Item to update is null\");\n        item.ValidateIsNotNew();\n        using (DataContext db = new DataContext())\n        {\n            T original = GetOriginalWithException&lt;T&gt;(db, item);\n            DbEntityEntry entry = db.Entry(original);\n            entry.CurrentValues.SetValues(item);\n            entry.State = EntityState.Modified;\n\n            try\n            {\n                db.SaveChanges();\n            }\n            catch (Exception ex)\n            {\n                throw new DatabaseException(\n                    \"Cant update list item. See inner exception for details.\", \n                    ex);\n            }\n        }\n    }\n</code></pre>\n\n<p>I tries another method: attaching object. This method does not throw exception, but it rise entire graph update and take many resources. Code listed below:</p>\n\n<pre><code>    public static void Update&lt;T&gt;(T item) where T : KeyedObject\n    {\n        if (item == null)\n            throw new ArgumentNullException(\"Item to update is null\");\n        item.ValidateIsNotNew();\n        using (DataContext db = new DataContext())\n        {\n            db.Set&lt;T&gt;().Attach(item);\n            db.Entry(item).State = EntityState.Modified;\n            try\n            {\n                db.SaveChanges();\n            }\n            catch (Exception ex)\n            {\n                throw new DatabaseException(\n                    \"Cant update list item. See inner exception for details.\", \n                    ex);\n            }\n        }\n    }\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":56,"score":3,"question_id":12859304,"title":"AcceptAllChanges Entity Framework","body":"<p>What's the difference between, <code>_context.SaveChanges</code> and <code>_context.AcceptAllChanges()</code>, is the <code>AcceptAllChanges()</code> is sort of reloading data from Database or rolling back (discarding) changes made by the user when he didn't use <code>SaveChanges()</code></p>\n"},{"tags":["c#",".net","entity-framework","inheritance"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":11612110,"title":"Can EntityObject be sub-classed?","body":"<p>I'm basically re-asking <a href=\"http://stackoverflow.com/questions/2240038/add-custom-abstract-base-class-between-entityobject-and-generated-classes-in-ent\">this question</a> as the only and accepted answer is not an answer to the question.</p>\n\n<p>Is it possible to tell EF to use a class that subclasses EntityObject, like the one below, as the base class of generated entity classes?</p>\n\n<pre><code>public abstract class CustomEntityObject : EntityObject\n{\n    &lt;additional functionality&gt;\n}\n</code></pre>\n\n<p>The reason I'm asking is I want to stop adding interfaces and implementing them on all entity types in separate partial class files. By sub-classing EntityObject I could implement the additional functionality once only.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>EF implicitly uses a .tt file to generate entity classes. By implicitly I mean you don't see  the .tt file in your project. The solution is to add the template explictly (right-click on the .edmx designer and click \"Add Code Generation Item...\", then add \"ADO.NET EntityObject Generator\"). You then change a single value in the .tt:</p>\n\n<pre><code>string BaseTypeName(EntityType entity, CodeGenerationTools code)\n{\n    return entity.BaseType == null ? \"EntityObject\" : MultiSchemaEscape((StructuralType)entity.BaseType, code);\n}\n</code></pre>\n\n<p>changes to:</p>\n\n<pre><code>string BaseTypeName(EntityType entity, CodeGenerationTools code)\n{\n    return entity.BaseType == null ? \"CustomEntityObject\" : MultiSchemaEscape((StructuralType)entity.BaseType, code);\n}\n</code></pre>\n"},{"tags":["c#","sql","database","entity-framework","treeview"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12858775,"title":"Treeview population from Database in C#","body":"<pre><code>ParentID   1 1 2 2 2 3 5 5 1\nChildID    2 3 4 5 6 7 8 3 11\n</code></pre>\n\n<p>code:</p>\n\n<pre><code>treeView1.Nodes.Add(\"1\", \"1\");\ntreeOlustur(\"1\");\n\n\nprivate void treeOlustur(string kod)\n{\n  List&lt;Agac&gt; altAgac = tm.Agac.Where(x =&gt; x.USTKOD == kod).ToList&lt;Agac&gt;();\n  foreach (Agac item in altAgac)\n  {\n    TreeNode[] tn = treeView1.Nodes.Find(item.USTKOD, true);\n    for (int i = 0; i &lt; tn.Count(); i++)\n    {\n      tn[i].Nodes.Add(item.ALTKOD, item.ALTKOD);\n    }\n    treeOlustur(item.ALTKOD);\n  }\n}\n</code></pre>\n\n<p>i want to populate treeview by using this table , i got a little error when program add node under 5 to 3 to double 7</p>\n\n<p>how can i fix it ?</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12857937,"title":"Can I create an Initial migration for an existing model","body":"<p>I am using Code-First migrations. Now I want my application when published to a new server to create a database and all tables for the model.</p>\n\n<p>I don't want to use auto-migrations because I want to keep track of database versioning.\nBut when I deploy my application to a new server I don't want it to perform all steps to come to the current model (e.g adding tables/columns which in later revisions are deleted).</p>\n\n<p>I would like to know if there is a way to create one migration that contains the whole (POCO) data model.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12856202,"title":"Required Properties on optional Entity Framework Complex Types","body":"<p>I want to define <code>[Required]</code> attributes on a Complex Type in Entity Framework.  For example, I have a <code>Customer</code> entity with an optional <code>Address</code>.  The Address entity has a required <code>PostCode</code> property.</p>\n\n<pre><code>[ComplexType]\npublic class Address {\n    public string Address1 { get; set; }\n    [Required]\n    public string PostCode { get; set; }\n}\n\npublic class Customer {\n    public int CustomerId {get;set;}\n    public Address Address {get;set;}\n}\n</code></pre>\n\n<p>I do NOT want to store my Complex type as a separate entity (I'm not actually using Address, this just an easy illustration of the problem).  I cannot leave Customer.Address null, because this gives the error:</p>\n\n<blockquote>\n  <p>Null value for non-nullable member. Member: 'Address'.</p>\n</blockquote>\n\n<p>If I supply an empty Address entity, the validation fails on the PostCode field because of the Required attribute.</p>\n\n<p>Is there any way to achieve this?  I'm using EF5/NET4.5.</p>\n"},{"tags":["performance","oracle","entity-framework","repository-pattern"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":352,"score":4,"question_id":12177322,"title":"Entity Framework 5 and Oracle: Expression with closure affecting performance when querying against a non-unique indexed field","body":"<p>I have a performance issue with Entity Framework 5 and Oracle DB.</p>\n\n<p>I have a simple SQL select: <code>SELECT * FROM NOTE WHERE NOTENUMBER = '1A23456'</code></p>\n\n<p><code>NOTENUMBER</code> is included in an index on a table called NOTE, but the field is NOT primary key / unique.</p>\n\n<ul>\n<li><p>When I execute the statement with Oracle SQL Developer, results return\nquickly and query plan shows that RANGE SCAN is being used like it\nshould.</p></li>\n<li><p>When I use Entity Framework, the generated SQL takes a lot\nlonger (5 seconds vs. 30ms).</p></li>\n<li><p>When I use Entity Framework and query\nwith a <strong>primary key field</strong> (NOTE_KEY), results return as quickly as with SQL \nDeveloper.</p></li>\n</ul>\n\n<p>I suspect 2 things:</p>\n\n<ul>\n<li><p>There's some problem with EF and Oracle.DataAccess-provider not using the non-unique-index that is available. It would help if I had debug symbols for Entity Framework 5, but I can't find them anywhere.</p></li>\n<li><p>The performance problem is somewhere in EF, regarding closures and/or the way I use generic repository pattern with EF:</p>\n\n<p>If I call my repository like this:<br/>\n<code>var notenumber = \"1A23456\";</code><br />\n<code>var notes = repository.All(n =&gt; n.NOTENUMBER == notenumber).ToList();</code><br>\nThe predicate comes in at the method <code>All</code> as:<br />\n<code>{n =&gt; (n.NOTE == value(Tester.Program+&lt;&gt;c__DisplayClass0).notenumber)}</code><br/>\nAnd EfProf-profiler traces the resulting SQL as:</p>\n\n<p><code>SELECT \"Extent1\".\"NOTE_KEY\"      AS \"NOTE_KEY\",</code><br/>\n<code>\"Extent1\".\"NOTENUMBER\"    AS \"NOTENUMBER\",</code><br/>\n<code>\"Extent1\".\"NOTETEXT\"      AS \"NOTETEXT\",</code><br/>\n<code>FROM   \"NOTE_DBA\".\"NOTE\" \"Extent1\"</code><br/>\n<code>WHERE  (\"Extent1\".\"NOTENUMBER\" = '1PSA0500237500' /* @p__linq__0 */)</code><br/></p>\n\n<p>And the query takes takes <strong>~5500ms</strong>.</p>\n\n<p><br/>\nOn the other hand, if I call my repository like this:<br/>\n<code>var notes = repository.All(n =&gt; n.NOTENUMBER == \"1A23456\").ToList();</code><br/>\nThen the predicate comes in as:<br/>\n<code>{n =&gt; (n.NOTENUMBER == \"1A23456\")}</code><br />\nAnd EfProf-profiler traces the resulting SQL as:</p>\n\n<p><code>SELECT \"Extent1\".\"NOTE_KEY\"      AS \"NOTE_KEY\",</code><br/>\n<code>\"Extent1\".\"NOTENUMBER\"    AS \"NOTENUMBER\",</code><br/>\n<code>\"Extent1\".\"NOTETEXT\"      AS \"NOTETEXT\",</code><br/>\n<code>FROM   \"NOTE_DBA\".\"NOTE\" \"Extent1\"</code><br/>\n<code>WHERE  ('1PSA0500237500' = \"Extent1\".\"NOTENUMBER\")</code><br/></p>\n\n<p>And the query takes <strong>~30ms</strong>.</p>\n\n<p>So the only difference is the order of the condition in the WHERE-clause, and the fact that in the latter there seems to be no parameter replaced by EF</p></li>\n</ul>\n\n<p><br/>\nI use VS2010 and .NET4, and reference EF5 (v4.4.0.0).\nThe repository's All-method is:<br/></p>\n\n<pre><code>public IQueryable&lt;NOTE&gt; All(Expression&lt;Func&lt;NOTE, bool&gt;&gt; predicate = null)\n{\n    var setOfNotes = GetDbSet&lt;NOTE&gt;();\n    var notesQuery = from note in setOfNotes select note;\n    if (predicate != null)\n    {\n        notesQuery = notesQuery.Where(predicate);\n    }\n    return notesQuery;\n}\n</code></pre>\n\n<p>I tried to create a CompiledQuery, I tried using <code>setOfNotes.AsNoTracking()</code> and I tried to target .NET 4.5 - with no difference in performance.<br/></p>\n\n<p>One way I was able to get this particular query fast, was to use Oracle's basic Data Provider for .NET (ODB.NET) and construct the query manually, but I'd rather not stick with that solution. Again, if I use a primary field in the where clause, the query is fast even with EF and the same All-method.</p>\n\n<p>So the problem seems to be somewhere in EF. I feel could find out a lot more if I only had the symbols for EntityFramework.dll.</p>\n\n<p>Could there be a problem with the way EF invokes predicates? How does the '@p_<em>linq</em>_0'-parameter get replaced inside EF?</p>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":6,"up_vote_count":14,"down_vote_count":0,"view_count":18306,"score":14,"question_id":1074337,"title":"MetadataException when using Entity Framework Entity Connection","body":"<p>This code:</p>\n\n<pre><code>using (EntityConnection conn = new EntityConnection(\"name=ELSCommonEntities\"))\n\n{\n  conn.Open();\n}\n</code></pre>\n\n<p>Gives me the following error:</p>\n\n<p>Test method ELS.Service.Business.IntegrationTest.Base.ServiceBaseIntegrationTest.StartLoggingTestMethod threw exception:  System.Data.MetadataException: Unable to load the specified metadata resource..</p>\n\n<p>With the following stack trace:</p>\n\n<pre><code>System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.LoadResources(String assemblyName, String resourceName, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver)\nSystem.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.CreateResourceLoader(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver)\nSystem.Data.Metadata.Edm.MetadataArtifactLoader.Create(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver)\nSystem.Data.EntityClient.EntityConnection.SplitPaths(String paths)\nSystem.Data.EntityClient.EntityConnection.GetMetadataWorkspace(Boolean initializeAllCollections)\nSystem.Data.EntityClient.EntityConnection.InitializeMetadata(DbConnection newConnection, DbConnection originalConnection, Boolean closeOriginalConnectionOnFailure)\nSystem.Data.EntityClient.EntityConnection.Open()\nELS.Service.Business.Base.ServiceBase.StartLogging(String userWindowsLogon) in C:\\C-TOM\\ELS-RELEASE1\\ELS.Service.Business\\Base\\ServiceBase.cs: line 98\nELS.Service.Business.IntegrationTest.Base.ServiceBaseIntegrationTest.StartLoggingTestMethod() in C:\\C-TOM\\ELS-RELEASE1\\ELS.Service.Business.IntegrationTest\\Base\\ServiceBaseIntegrationTest.cs: line 65\n</code></pre>\n\n<p>However, this code which uses the same connection string:</p>\n\n<pre><code>        using (ELSCommonEntities db = new ELSCommonEntities())\n        {\n            var res = from c in db.Logging\n                      select c;\n\n            int i = res.Count();\n        }\n</code></pre>\n\n<p>Does not give an error. </p>\n\n<p>The connection string is:</p>\n\n<pre><code>  &lt;add name=\"ELSCommonEntities\" connectionString=\"metadata=res://*/Common.CommonModel.csdl|res://*/Common.CommonModel.ssdl|res://*/Common.CommonModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=localhost;Initial Catalog=els5_demo;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>I have also opened up the dll in reflector and the metadata looks ok.</p>\n\n<p>Thanks</p>\n\n<p>Shiraz</p>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":128,"score":0,"question_id":12855360,"title":"MVC4 and Entity Framework 5 stored procedures","body":"<p>Hi Im trying to access a database table in my mvc4 application using a stored procedure and Entity Framework 5. \nI created a FormValueModel.edmx file and imported the User Table and the GetUser Stored Procedure</p>\n\n<p>Here is the code for the GetUser Stored Procedure</p>\n\n<pre><code>SELECT \n    *\nFROM\n    [User].[User]\nWhere\n    @UserName = UserName \n    AND @UserPassword = UserPassword\n    AND Active = 1\n</code></pre>\n\n<p>Here is the code in my Controller to access the stored procedure</p>\n\n<pre><code>using (var db = new FormValueEntities())\n{\n    string userName =\"TestUser\"\n    string password = \"Password\"\n\n    var query = db.GetUser(userName, password);\n\n}   \n</code></pre>\n\n<p>Why cant I access the table by using query.UserName or query.UserPassword ect.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c#","entity-framework","entity-framework-4.1","scaffolding"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12854688,"title":"Scaffold to dropdown list with C# EF4 - code first","body":"<p>I'm using C#.NET, Entity Framework 4.1 and the code first approach. From that i have a bunch of <code>entities</code> and one <code>entity</code> is related to another <code>entity</code>. They have a primary key/foreign key relation.</p>\n\n<p>I'm also using <code>ViewModels</code> to specify which attributes may be scaffolded and i was hoping that the two related entities would create a dropdown list. But that's not happening.</p>\n\n<p>This is just an example of how my entity relation looks, to illustrate my problem.</p>\n\n<p><strong>UserType entity:</strong></p>\n\n<pre><code>public class UserType\n{\n    public int UserTypeID { get; set; }\n    public string Type { get; set; }\n\n    public virtual ICollection&lt;User&gt; Users { get; set; }\n}\n</code></pre>\n\n<p><strong>User entity:</strong></p>\n\n<pre><code>public class User\n{\n    public int UserID { get; set; }\n    public int UserTypeID\n    public string Username { get; set; }\n\n    public bool IsAdmin { get; set; }\n\n    public virtual UserType UserType { get; set; }\n}\n</code></pre>\n\n<p><strong>My ViewModel:</strong></p>\n\n<pre><code>[JsonObject(MemberSerialization = MemberSerialization.OptOut, IsReference = false)]\n[DataContract]\npublic class UserViewModel : BaseViewModel\n{\n    [Key]\n    public int UserID { get; set; }\n\n    public int UserTypeID { get; set; }\n\n    [required]\n    public string Username { get; set; }\n}\n</code></pre>\n\n<p>So the <code>UserViewModel</code> is scaffolded. And i want it to create a dropdown list for the <code>UserType</code>. But right now it only creates an <code>input</code> field for <code>UserTypeID</code>. How can i make it show a dropdown list with the values of <code>UserTypes</code>?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","simplemembership"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":131,"score":0,"question_id":12847291,"title":"GetAllUsers infos (from UserProfile and Membership Tables given by SimpleMembership) with Entity Framework?","body":"<p>First I am really new to .NET framework and all stuff around. What I want to do is to build my admin part for my n-tiers MVC4 App where security is dealt with SimpleMembership. (the default)</p>\n\n<p>Regarding the standard MVC4 template and in order to create my GetAllUsers method, I have decided to create my membership entities (UserProfile, Membership, OAuthMembership and Roles)  in my domain project with EF reverse engineer code first tool and generating my context and my repositories with T4 template for my DAL project.</p>\n\n<p>I am surprised that the Membership Table is not linked with the UserProfile (as you can see in the schema) and I would be really pleased to know why (? first question)</p>\n\n<p><img src=\"http://i.stack.imgur.com/TlVHl.png\" alt=\"membership_schema\"></p>\n\n<p>In a console \"test\" app, (the final goal is to create a gridview where I can have Membership Table and UserProfile Table Infos linked together) there is the method I create in order to get shared Membership and UserProfile info for my users (my service project is not set yet). </p>\n\n<p>Is this the correct way to do it? (second question)</p>\n\n<pre><code>    private static void GetAllUsers()\n    {\n        using (var MembershipRepository = new MembershipRepository())\n        {\n            var i = 1;\n            foreach (var member in MembershipRepository.All)\n            {\n                Console.Write(\"{0}: {1} \", i, member.UserId);\n                using (var UserProfileRepository = new UserProfileRepository())\n                {\n                    Console.WriteLine(\"{0}\", UserProfileRepository.Find(member.UserId).UserName);\n                }\n                i += 1;\n            }\n        }\n        WaitConsole();\n    }\n</code></pre>\n\n<p>(note: I didn't use UnitOfWork and IoC yet but I plan to do it)</p>\n\n<p>Thanks a lot to know if I am on the right track.</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":622,"score":2,"question_id":4438574,"title":"adding List of objects to Context in ef","body":"<p>Is it possible to add list of object to Context in entity framework without using foreach addObject ?</p>\n\n<p>thanks for help</p>\n"},{"tags":["c#","entity-framework","lambda","lambda-functions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12852580,"title":"Dynamic lambda expression","body":"<p>I have created an expression like:  </p>\n\n<pre><code>expression = x =&gt; x.CustomerName.StartsWith(comboParams.ParamValueText, true, null);  \n</code></pre>\n\n<p>I would like access customer name as generic something like this:  </p>\n\n<pre><code>expression = x =&gt; x[\"CustomerName\"] and access the StartsWith function\n</code></pre>\n\n<p>I have already tried code such as </p>\n\n<pre><code>expression x =&gt; x.GetType().GetProperty(\"CustomerName\").Name.StartsWith(comboParams.ParamValueText, true, null); --&gt; it doesn't seem to work :(\n</code></pre>\n\n<p>Is there a way to accomplish this task. I'm making this to have a common implementation for the expression, maybe I'll create a function for this and just accept the string. Thanks!</p>\n"},{"tags":["entity-framework","entity-framework-4","deep-copy"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1786,"score":0,"question_id":4182429,"title":"How make deep copy (clone) in Entity framework 4?","body":"<p>How make deep copy (clone) in Entity framework 4?\nI need get copy of the EntityObject with copies of all related objects.</p>\n"},{"tags":["c#","silverlight","entity-framework","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12704687,"title":"Silvelight&RIA Services&Entity Framework problems with partial classes and complex types there","body":"<p>I'm using RIA Services with Entity Framework and Silverlight as the client Application. I've got some custom properties for EF Entity through partial class. There is a field in Database with XML type and it's mapped to Entity Framework as string. And I use partial class to deserialize this xml string to real object.</p>\n\n<p>This is the partial class for EF Configuration Entity:</p>\n\n<pre><code>public partial class Configuration\n{\n    private ServiceCredentials _serviceCredentialsObject;\n\n    [DataMember]\n    public ServiceCredentials ServiceCredentialsObject\n    {\n        get\n        {\n            return this._serviceCredentialsObject\n                   ?? (this._serviceCredentialsObject = this.DeserializeServiceCredentialsToObject());\n        }\n\n        set\n        {\n            this._serviceCredentialsObject = value;\n            this.SerializeServiceCredentialsObject();\n        }\n    }\n\n    public ServiceCredentials DeserializeServiceCredentialsToObject()\n    {\n        if (string.IsNullOrEmpty(this.ServiceCredentials))\n        {\n            return null;\n        }\n\n        var result = XmlSerializerHelper.Deserialize&lt;ServiceCredentials&gt;(this.ServiceCredentials);\n        result.FileEncoding = result.FileEncoding ?? Encoding.UTF8;\n\n        return result;\n    }\n\n    public void SerializeServiceCredentialsObject()\n    {\n        if (this.ServiceCredentialsObject == null)\n        {\n            this.ServiceCredentials = null;\n            return;\n        }\n\n        this.ServiceCredentials = XmlSerializerHelper.Serialize(this.ServiceCredentialsObject);\n    }\n\n}\n</code></pre>\n\n<p>And this is the object i'm trying to Deserialize:</p>\n\n<pre><code>[Serializable]\npublic class ServiceCredentials\n{\n\n    public NetworkCredential Credential { get; set; }\n\n    public Encoding FileEncoding { get; set; }\n\n    [XmlIgnore]\n    public long HistoryID { get; set; }\n\n    public string LoadFileStoragePath { get; set; }\n\n    public string ManualLoadFilePath { get; set; }\n\n    public bool NeedAuthorization { get; set; }\n\n    [XmlIgnore]\n    public string ProviderID { get; set; }\n\n    public string SourceUrl { get; set; }\n\n    public bool AutomaticTransferToProductive { get; set; }\n}\n</code></pre>\n\n<p>When I'm trying to use Configuration Entity on silverlight client-side with generated code find an issue that there is no ServiceCredentialsObject in Configuration class. And it's not added to DomainService.metadata.cs if i create new one. If i add ServiceCredentialsObject to DomainService.metadata.cs manually i can access it on clien-side after rebuild but i can find only properties with simple types there. For example a can acess HistoryID,SourceUrl,AutomaticTransferToProductive but there are no generated properties for </p>\n\n<p>public NetworkCredential Credential { get; set; }\n  public Encoding FileEncoding { get; set; }</p>\n\n<p>How can i fix this?</p>\n"},{"tags":["entity-framework","orm","entity-framework-4.1","ef-code-first","dynamic-proxy"],"answer_count":2,"favorite_count":4,"up_vote_count":11,"down_vote_count":0,"view_count":2923,"score":11,"question_id":7111109,"title":"Should I enable or disable dynamic proxies with entity framework 4.1 and MVC3?","body":"<p>Could someone offer up some advice or point out some blogs/articles that could help with making this decision? The proxies seem very foreign to me and I'm hesitant to use them. I like the ability to control Lazy Loading by using virtual properties in my model, but that's pretty much all the benefits that I can see. My application is a simple MVC web application and I don't need to wire up any hooks into the context for when the entities experience a changed state. </p>\n\n<p>Anyway, here's my very limited list of pros and cons right now, let me know if I'm off base with any of this. </p>\n\n<p><em><strong>Pros</em></strong></p>\n\n<ul>\n<li>On 'Save' or 'Update',  I get seamless with 'Apply'Changes'</li>\n<li>Lazy-Loading configuration is very easy.</li>\n</ul>\n\n<p><em><strong>Cons</em></strong></p>\n\n<ul>\n<li>Never used proxies before for my entities, this is a change in\napproach that just seems uncomfortable for myself and fellow team\nmembers. </li>\n<li>Awkward to debug. </li>\n<li>Requires extra code if I want serialize/de-serialize</li>\n<li>On 'Save' or 'Update', the proxy must be the same object that was retrieved from the context.</li>\n</ul>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":5,"view_count":89,"score":-2,"question_id":12849325,"title":"EntityFramework - Which one is better for Unit-testing CodeFirst or Database First","body":"<p>I am kind of lost finding the best way to start developing application using Entity Framework.\nRead so many article and looks like both has its pros and cons. I am pretty much open to adopt either one of them but needs some advice specifically on Unit testing. </p>\n\n<p>Which approach will be more friendly towards Unit Testing?</p>\n\n<p>I would appreciate if you guys can give link to resources that uses latest version of Entity Framework.</p>\n\n<p>Thanks</p>\n"},{"tags":[".net","entity-framework","orm","entity-framework-4","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":12849843,"title":"Extending or inheriting from an EF 5 DbContext","body":"<p>Is there a way to extend a EF 5 DbContext to include additional columns or tables?</p>\n\n<p>We have an application that has it's own schema, but when a customer asks for some custom feature, we can add fields or tables to his application.</p>\n\n<p>Example:</p>\n\n<pre><code>Table 'Customers'\n\nCustId\nName\nAddress\n</code></pre>\n\n<p>The customer asks for a 'Phone' field that is exclusive to his application so we add a column to the 'Customers' table.</p>\n\n<p>Our base model contains a definition for CustId, Name and Address, but what about the 'Phone' field that is restricted to this particular client?</p>\n\n<p>I was thinking about merging the 2 DbContext or making our customer's DbContext inherit from the base DbContext, but none of those 2 options seems to be possible.</p>\n\n<p>Duplicating the base DbContext would be a huge pain since the application has more than 600 tables and we do not want to go through all the models to add a field when we modify our base application.</p>\n\n<p>Any ideas?</p>\n\n<p>Are there other ORMs that makes this possible?</p>\n"},{"tags":["c#","entity-framework","edmx","database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12815028,"title":"Edmx missing foreign keys","body":"<p>I am mapping my database using Entity Framework, using the database-first approach. </p>\n\n<p>The problem is that the <code>edmx</code> file that should be mapping my exact database is missing some FK relations between the tables, which causes me to change my queries, because I can't approach the related tables directly. </p>\n\n<p>Of course changing it directly in the classes code, it's erased every time I change something in the database (the <code>edmx</code> is recreated). </p>\n\n<p>I need help please!!!</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12847609,"title":"\"Cannot convert lambda expression to type 'string' because it is not a delegate type\" in .NET 4.5","body":"<p>I am trying out an existing .NET 4.0 solution in VS2012 on a test machine (that only has VS2012 and SQL Server 2008 installed), and am getting the above error when I try to use the lambda syntax with the Include extension method.</p>\n\n<p>The existing version of the solution has a reference to EntityFramework.dll, which is the one I had to add to use the Include method, but the upgraded version I'm looking at in VS2012 does not have such a reference, nor can I find a DLL of that name in the location it was on the other machine. The using statement for System.Data.Entity is greyed out, as ReSharper thinks it isn't needed. Don't know why.</p>\n\n<p>Sample code: This is what is in the existing solution...</p>\n\n<pre><code>using (var context = new RSSFeedsEntities()) {  \n  WebSite someSite = context.WebSites.Include(w =&gt; w.Feeds).FirstOrDefault(w =&gt; w.WebSiteID == 1);  \n}\n</code></pre>\n\n<p>Any idea how to solve this? Thanks</p>\n"},{"tags":["c#","entity-framework",".net-3.5","lambda"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12833777,"title":"Query with triple selector","body":"<p>I'm currently have  Lambda Expresion: <a href=\"http://pastebin.com/ZGCiQdHe\" rel=\"nofollow\">http://pastebin.com/ZGCiQdHe</a></p>\n\n<p>And i get ArgumentException in 53 line \n<a href=\"http://msdn.microsoft.com/en-us/library/bb340145%28v=vs.90%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb340145(v=vs.90).aspx</a></p>\n\n<pre><code>var lExpresion = Expression.Lambda&lt;Func&lt;TEntity, bool&gt;&gt;(body, parametrsNumber, parametrsTyp, parametrsLp);\n</code></pre>\n\n<p>But i not understand what i do wrong.</p>\n\n<p>I want to get:</p>\n\n<pre><code>    WHERE ((twr_gidnumer =1 and twr_gidtyp = 1 and twr_gidlp = 1) OR \n    (twr_gidnumer =1 and twr_gidtyp = 1 and twr_gidlp = 2))\n</code></pre>\n\n<p>--ANSWERR FULL</p>\n\n<p>Based on article:</p>\n\n<p><a href=\"http://blogs.msdn.com/b/mattwar/archive/2007/07/31/linq-building-an-iqueryable-provider-part-ii.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/mattwar/archive/2007/07/31/linq-building-an-iqueryable-provider-part-ii.aspx</a>\n<a href=\"http://stackoverflow.com/a/3530666/266202\">http://stackoverflow.com/Converting 2 argument Lambda expression to 1 argument Lambda expression</a></p>\n\n<pre><code>public static Expression&lt;Func&lt;CDNXL_TwrKarty, bool&gt;&gt; Bind2nd(Expression&lt;Func&lt;CDNXL_TwrKarty, CDNXL_TwrKarty,CDNXL_TwrKarty, bool&gt;&gt; source)\n{\n    Expression newBody = new Rewriter(source.Parameters[0]).Visit(source.Body);\n    return Expression.Lambda&lt;Func&lt;CDNXL_TwrKarty, bool&gt;&gt;(newBody, source.Parameters[0]);\n}\n\ninternal class Rewriter : ExpressionVisitor\n{\n    private readonly ParameterExpression candidate_;\n\n    public Rewriter(ParameterExpression candidate)\n    {\n        candidate_ = candidate;\n    }\n\n    protected override Expression VisitParameter(ParameterExpression p)\n    {\n        return candidate_;\n    }\n}\n</code></pre>\n\n\n\n<pre><code>//REPLACE EXECUTING PLACE\nvar retMultiLamnda = Expression.Lambda&lt;Func&lt;CDNXL_TwrKarty, CDNXL_TwrKarty, CDNXL_TwrKarty, bool&gt;&gt;(body, parametrsNumber, parametrsTyp, parametrsLp);\nvar retOneLambda = Bind2nd(retMultiLamnda);\nvar retQuery = query.Where(retOneLambda);\nreturn retQuery;\n</code></pre>\n\n<p><strong>Thanx <a href=\"http://stackoverflow.com/users/1495595/rafal\">Rafal</a> for Help.</strong></p>\n"},{"tags":["entity-framework","dataannotations","fluent"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12848005,"title":"Data annotations or Fluent API in EF 4.4 vs. EF 5.0?","body":"<p>I have an ASP.NET MVC project created with EF 4.4 and SQL Express. In my model there are a two objects, User and Department. A department has a public User DepartmentManager navigation property with a public Guid DepartmentManagerId foreign key with this data annotation:\n[ForeignKey(\"DepartmentManager\")]. Using code first, the Department table is created properly with ONE Guid column for DepartmentManagerId. </p>\n\n<p>However, with that same setup in EF 5.0 if I user code first and create the DB, my Department table gets created with a DepartmentManagerId column AND a DepartmentManager_UserId column.</p>\n\n<p>To make things more interesting, if in EF 5.0 I remove the foreign key annotation and use Fluent API like so:</p>\n\n<pre><code>modelBuilder.Entity&lt;Department&gt;()\n    .HasRequired(u =&gt; u.DepartmentManager)\n    .WithMany()\n    .HasForeignKey(u =&gt; u.DepartmentManagerId);\n</code></pre>\n\n<p>..the DB gets generated correctly. Thus two questions. Are data annotations handled differently from EF 4.4 to EF 5.0? Secondly, what is the difference between the ForeignKey data annotation and the fluent mapping above? There should be no difference but when the DB is created the is the extra column from the data annotation. Any ideas? Thanks in advance.</p>\n"},{"tags":["entity-framework","c#-4.0","lambda"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12423995,"title":"can i use custom lambda method in entity framework?","body":"<p>i have some methods like:</p>\n\n<pre><code>public static string ToOtherFormat (this string inp)\n{\n  // some code to change inp\n  return inp;\n}\n</code></pre>\n\n<p>and in my select i want to have code like this:</p>\n\n<pre><code>var DetailMembers = db.TB_Members\n                      .Where(x=&gt; x.FName == obj.ToOtherFormat())\n                      .Select( x=&gt; new { name = (x.FName.ToOtherFormat() + \" \" + x.LName) , x.ActCode });\n</code></pre>\n\n<p>i try and just have error. is it possible?<br/> \nthanks!<br>\ni receive this error in simple convert to integer<br></p>\n\n<blockquote>\n  <p>LINQ to Entities does not recognize the method 'Int32 ToInt32(System.String)' method, and this method cannot be translated into a store expression.</p>\n</blockquote>\n\n<p>with this code<br></p>\n\n<pre><code> .Where(x =&gt; x.MemberID == Convert.ToInt32(Hmemid.Hash_two_Decrypt())\n</code></pre>\n"},{"tags":["c#","sql-server-2008","entity-framework","associations"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12844758,"title":"Entity Framework Odd Behaviour","body":"<p>I've not been working with EF until this week (v5) and now I'm making a few database changes it's doing some really weird things.</p>\n\n<p>I deleted an NVARCHAR Country field and replaced that with an CountryId int field that is a Foreign Key to the Id column of the Country table</p>\n\n<pre><code>ALTER TABLE [dbo].[UserProfile]  WITH CHECK ADD  CONSTRAINT [FK_UserProfile_Countries]   FOREIGN KEY([CountryId])\nREFERENCES [dbo].[Countries] ([Id])\n</code></pre>\n\n<p>Updating the model in VS2012 is doing some really unexpecting things.  Its reporting an error on the field I removed:</p>\n\n<blockquote>\n  <p>Error 11010: Association End 'Country' is not mapped.</p>\n</blockquote>\n\n<p>And I have two virtual fields added to the model which doesn't seem correct:</p>\n\n<pre><code>public partial class UserProfile\n{\n    public int UserId { get; set; }\n    ...\n    public int CountryId { get; set; }\n\n    public virtual Country Country { get; set; }\n    public virtual Country Country1 { get; set; }\n}\n</code></pre>\n\n<p>I've read there is a bug with the designer and manually running \"Run Custom Tool\" on the .tt files fixes this but it doesn't appear to have worked.</p>\n\n<p>Has anyone seen this or solved it?</p>\n"},{"tags":["c#",".net","entity-framework","transactions"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":12839187,"title":"Should a transaction be used in my case?","body":"<p>Here is a quote \" So, if you are working with only one object context then you have already built-in support for database transactions when using the ObjectContext.SaveChanges method.\" I found here <a href=\"http://www.luisrocha.net/2011/08/managing-transactions-with-entity.html\" rel=\"nofollow\">http://www.luisrocha.net/2011/08/managing-transactions-with-entity.html</a></p>\n\n<p>So according to that, I don't have to use <code>TransactionScope</code> in a code below, right?</p>\n\n<pre><code>if (isLastCallSuccess)\n {\n   if (condition1) //it's clear, no transaction needed\n    {\n      product.Property1 = true;\n      context.SaveChanges();\n    }\n\n    else if (condition2)\n     {\n      using (TransactionScope scope = new TransactionScope()) //do I need it?\n      {\n        context.DeleteObject(item);             //deleting\n        context.AddObject(\"product\", new product      //adding\n                                {\n                                    Id = oldObject.Id,\n                                    Property1 = true\n                                });\n        context.SaveChanges(System.Data.Objects.SaveOptions.DetectChangesBeforeSave);\n                                scope.Complete();\n        context.AcceptAllChanges();\n\n        }\n      }\n</code></pre>\n"},{"tags":["entity-framework","ado.net"],"answer_count":5,"favorite_count":19,"up_vote_count":37,"down_vote_count":0,"view_count":13321,"score":37,"question_id":1412863,"title":"How do I view the SQL generated by the entity framework?","body":"<p>How do I view the SQL generated by entity framework ?</p>\n\n<p>(In my particular case I'm using the mysql provider - if it matters)</p>\n\n<p><strong>Duplicate</strong>: <a href=\"http://stackoverflow.com/questions/137712/sql-tracing-linq-to-entities#138109\">http://stackoverflow.com/questions/137712/sql-tracing-linq-to-entities#138109</a></p>\n"},{"tags":[".net","entity-framework","syntax"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12844907,"title":"Is there a way to chain together Where() statements with OR conditions, as in OrWhere(), in Entity Framework?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5428806/linq-simulate-an-orwhere-expression-when-building-linq-queries-dynamically\">Linq - Simulate an OrWhere expression when building LINQ queries dynamically?</a>  </p>\n</blockquote>\n\n\n\n<p>I was wondering if anyone can help me.</p>\n\n<p>I know that in entity framework we can chain wheres together so for instance</p>\n\n<pre><code>data.Where(x=&gt;x.Id == id ).Where(x=&gt;x.Name == name).Where(x=&gt;x.State == state);\n</code></pre>\n\n<p>so basically the where translates into AND</p>\n\n<pre><code>data.Where(x=&gt;x.Id==id &amp;&amp; x.Name == name &amp;&amp; x.State == state);\n</code></pre>\n\n<p>Is there a way to do the same for OR</p>\n\n<pre><code>data.Where(x=&gt;x.Id==id || x.Name == name || x.State == state);\n</code></pre>\n\n<p>could be represented as ...</p>\n"},{"tags":["entity-framework","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":12843510,"title":"VS 2012RC Entity Framework Model First still generates ObjectContext based code","body":"<p>I used EF (Model First) today for the first time since installing VS2012RC. I was surprised to see that the generated code inherited from ObjectContext (EF 4.x style) rather than DbContext (EF 5.x). To make sure that I hadn't missed something obvious I found and followed the following tutorial - <a href=\"http://msdn.microsoft.com/en-gb/data/jj205424\" rel=\"nofollow\">MSDN Model First Sample</a></p>\n\n<p>with the same result. At ~4:10 in the video it clearly shows that BloggingContext inherits DbContext. My generated code:</p>\n\n<pre><code>/// &lt;summary&gt;\n/// No Metadata Documentation available.\n/// &lt;/summary&gt;\npublic partial class BloggingContext : ObjectContext\n{\n</code></pre>\n\n<p>My .edmx file is in the root project folder and no template files (*.tt) get added automatically as the video shows they should. If I manually 'Add Code Generation Item' (DbContext Fluent...) the code does get generated properly.</p>\n\n<p>Is this a known problem with the RC version of VS or any other ideas?</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","table-per-type"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12843678,"title":"Converting a EF CodeFirst Base class to a Inherited class (using table-per-type)","body":"<p>I am using EF Code First and have two classes defined as follows:</p>\n\n<pre><code>public class User\n{\n    public int Id { get; set; }\n    public string Username { get; set; }\n    public string Email { get; set; }\n}\n\n[Table(\"Visitors\")]\npublic class Visitor : User\n{\n    public Visitor()\n    {\n        Favourites = new List&lt;Building&gt;();\n    }\n    public virtual IList&lt;Building&gt; Favourites { get; set; }\n}\n</code></pre>\n\n<p>This uses Table-Per-Type inheritance and defines the DB schema as follows:</p>\n\n<pre><code>Users Table\n    Id int PK\n    Username nvarchar(max)\n    Email nvarchar(max)\nVisitors Table\n    Id int PK (FK to Users table)\n</code></pre>\n\n<p>This is exactly how I wanted it to structure it. <strong>Now my question is</strong>, if I create a User object and save it to the DB, how will I later on be able to extend that into a Visitor (if I need to?) Will I need to delete the user and create a new Visitor or can I some how cast the user into a visitor object and the entry in the user table will remain intact and a new entry will be added to the visitor table referencing the user? Something like the below code?</p>\n\n<pre><code>Context.Set&lt;User&gt;().Add(new User(){Id=1, Username=\"Bob\", Email=\"bob@mail.bob\"});\nContext.SaveChanges();\n\n//and elsewhere in the project I want to do this sort of thing:\nContext.Set&lt;Visitor&gt;().Where(v=&gt;v.Id == 1).FirstOrDefault().Favourites.Add(someFavouriteBuilding); //This obviously doesn't work, because the FirstOrDefault call returns null, so it will throw an exception\nContext.SaveChanges();\n\n//or maybe this can be modified slightly to work?:\nvar visitor = Context.Set&lt;Visitor&gt;().Where(v=&gt;v.Id == 1).FirstOrDefault();\nif (visitor==null)\n{\n    visitor = new Visitor(Context.Set&lt;User&gt;().Where(u=&gt;u.Id == 1).FirstOrDefault()); // this contructor copies all the property values accross and returns a new object\n}\nvisitor.Favourites.Add(someFavouriteBuilding); //This obviously doesn't work either\nvar entry = Context.Entry(visitor);\nentry.State = EntityState.Modified;//here it throws this error: An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key.\nContext.SaveChanges();\n</code></pre>\n\n<p>I think the second approach in the above code may work if I can only attach it to the context correctly. Anyway, the code above is only to show you what I am trying to achieve. I know it will not work. Can anyone suggest a more elegent approach?</p>\n\n<p>Thank you</p>\n"},{"tags":[".net","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12841045,"title":"ASP.net -Trying to associate one primary key to multiple foreign keys","body":"<p>I have a list of Ingredients that exist that contain a primary key: ingredientID and a foreign key: recipeID. I have been trying to map a single ingredient to many Recipes, which each contain a recipeID and an ingredientID.</p>\n\n<p>Previously, I assigned the Ingreients recipeID to the same as the target Recipes recipeID. this restrained the Ingredient to being associated with a single Recipe however.</p>\n\n<p>By associating the Recipes ingredientID with an ingredient, it seems that Recipe can then only have one Ingredient associated with it, but that Ingredient can be associated with other recipes.</p>\n\n<p>I have tried to create a recipeIngredient that contains a recipeID and an ingredientID to associate Recipes and Ingredients, but I had no success.</p>\n\n<p>Here is a description of the current models.</p>\n\n<p>Recipe Model:</p>\n\n<pre><code>    [Key]\n    public int recipeID { get; set; }\n    public int ingredientID { get; set; }\n    public string Name { get; set; }\n    public string Description { get; set; }\n    public decimal Cost { get; set; }\n\n    public virtual NutritionalValue NutritionalDetails { get; set; }\n    public virtual ICollection&lt;Ingredient&gt; Ingredients { get; set; }\n    public virtual ICollection&lt;RecipeStep&gt; RecipieSteps { get; set; }\n</code></pre>\n\n<p>Ingredient Model:</p>\n\n<pre><code>    [Key]\n    public int ingredientID { get; set; }\n    //public int recipeID { get; set; }\n    public string Name { get; set; }\n    public string Descritpion { get; set; }\n    public decimal Cost { get; set; }\n    public decimal Amount { get; set; }\n    public string Type { get; set; }\n\n    public virtual Recipe Recipe { get; set; }\n</code></pre>\n\n<p>The final concept from this that I am trying to achieve is that the user selects an ingredient within the Recipes edit view, selects the ingredient that was already previously added and clicks save to associate it with that particular Recipe, but can also go on to associate it with further Recipes simultaneously. </p>\n\n<p>Many thanks.</p>\n"},{"tags":["entity-framework","connection-string","datadirectory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":143,"score":0,"question_id":12709644,"title":"\"URI formats are not supported\" exception when using |DataDirectory| in Entity Framework connection string","body":"<p>I have a unit test project in Visual Studio 2012 where I am storing the AdventureWorks MDF file for SQL Server 2012 (the file is named AdventureWorks2012_Data.mdf).  In the Visual Studio Server Explorer, I am able to add the MDF in the Data Connections and browse the database.  Right clicking on $/Data Connections/AsventureWorks2012_Data.mdf and selecting properties gives me access to the connection string as follows:  </p>\n\n<p>Data Source=(LocalDB)\\v11.0;AttachDbFilename=C:\\Projects\\Common\\Source\\Framework\\Framework.Data.Tests\\AdventureWorks2012_Data.mdf;Integrated Security=True;Connect Timeout=30</p>\n\n<p>I copied this into my Entity Framework connection string in the app.config file as follows:</p>\n\n<pre><code>&lt;!-- Works :-) --&gt;\n&lt;connectionStrings&gt;\n  &lt;add name=\"AdventureWorksEntities\" \n       connectionString=\"metadata=res://*/Repository2Tests.AdventureWorks.csdl|res://*/Repository2Tests.AdventureWorks.ssdl|res://*/Repository2Tests.AdventureWorks.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=(LocalDB)\\v11.0;AttachDbFilename=C:\\Projects\\Common\\Source\\Framework\\Framework.Data.Tests\\AdventureWorks2012_Data.mdf;Integrated Security=True;Connect Timeout=30App=EntityFramework&amp;quot;\" \n       providerName=\"System.Data.EntityClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>Note that the AttachDbFilename contains the full path of the MDF file as: \nC:\\Projects\\Common\\Source\\Framework\\Framework.Data.Tests\\AdventureWorks2012_Data.mdf</p>\n\n<p>When I run the unit tests, everything is fine as expected.  </p>\n\n<p>I changed AttachDbFilename to |DataDirectory|\\AdventureWorks2012_Data.mdf as described in \"<a href=\"http://msdn.microsoft.com/en-us/library/cc716756%28v=vs.100%29.aspx\" rel=\"nofollow\">ADO.NET Entity Framework Connection Strings</a>\" and I set the DataDirectory as described in \"<a href=\"http://stackoverflow.com/questions/1409358/ado-net-datadirectory-where-is-this-documented\">ADO.NET |DataDirectory| where is this documented?</a>\" so that my connection string now is as follows:</p>\n\n<pre><code>&lt;!-- Doesn't work :-( --&gt;\n&lt;connectionStrings&gt;\n  &lt;add name=\"AdventureWorksEntities\" \n       connectionString=\"metadata=res://*/Repository2Tests.AdventureWorks.csdl|res://*/Repository2Tests.AdventureWorks.ssdl|res://*/Repository2Tests.AdventureWorks.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=(LocalDB)\\v11.0;AttachDbFilename=|DataDirectory|\\AdventureWorks2012_Data.mdf;Integrated Security=True;Connect Timeout=30;App=EntityFramework&amp;quot;\" \n       providerName=\"System.Data.EntityClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>The change to using |DataDirectory| resulted in the following runtime error:</p>\n\n<pre><code>System.Data.EntityException: The underlying provider failed on ConnectionString. ---&gt; System.ArgumentException: URI formats are not supported.\nHResult: -2147024809\nat System.IO.Path.NormalizePath(String path, Boolean fullCheck, Int32 maxPathLength)\nat System.IO.Path.GetFullPath(String path)\nat System.Data.Common.ADP.GetFullPath(String filename)\nat System.Data.Common.DbConnectionOptions.ExpandDataDirectory(String keyword, String value, String&amp; datadir)\nat System.Data.SqlClient.SqlConnectionString..ctor(String connectionString)\nat System.Data.SqlClient.SqlConnectionFactory.CreateConnectionOptions(String connectionString, DbConnectionOptions previous)\nat System.Data.ProviderBase.DbConnectionFactory.GetConnectionPoolGroup(DbConnectionPoolKey key, DbConnectionPoolGroupOptions poolOptions, DbConnectionOptions&amp; userConnectionOptions)\nat System.Data.SqlClient.SqlConnection.ConnectionString_Set(DbConnectionPoolKey key)\nat System.Data.SqlClient.SqlConnection.set_ConnectionString(String value)\nat System.Data.EntityClient.EntityConnection.ChangeConnectionString(String newConnectionString)\n--- End of inner exception stack trace ---\nHResult: -2146233087\nat System.Data.EntityClient.EntityConnection.ChangeConnectionString(String newConnectionString)\nat System.Data.Entity.Internal.LazyInternalConnection.TryInitializeFromAppConfig(String name, ConnectionStringSettingsCollection connectionStrings)\nat System.Data.Entity.Internal.LazyInternalConnection.Initialize()\nat System.Data.Entity.Internal.LazyInternalConnection.get_ConnectionHasModel()\nat System.Data.Entity.Internal.LazyInternalContext.InitializeContext()\nat System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType)\nat System.Data.Entity.Internal.Linq.InternalSet`1.Initialize()\nat System.Data.Entity.Internal.Linq.InternalSet`1.get_InternalContext()\nat System.Data.Entity.Internal.Linq.InternalSet`1.Create()\n</code></pre>\n\n<p>I have researched this for a couple days now and tried countless variations without success.  I even debugged into Microsoft code but with compiler optimizations I am unable to see any debugging information on the stack.</p>\n\n<p>Has anyone run across this specific problem? </p>\n"},{"tags":["c#",".net","database","entity-framework","azure"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":528,"score":0,"question_id":9850368,"title":"My webrole.cs can't seem to find a connection string","body":"<p>I've got a Azure/Cloud based project (single project only). It has a WCF/WebRole added to the project. My WCF services are using the entity framework to talk to a SQLAzure database. This is working very well.</p>\n\n<p>In the web.config of the project I have the following:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"CommuteEntities\" connectionString=\"metadata=res://*/Db.CommuteDataModel.csdl|res://*/Db.CommuteDataModel.ssdl|res://*/Db.CommuteDataModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=&lt;db-here&gt;.database.windows.net;initial catalog=dandr;persist security info=True;user id=&lt;user-id-here&gt;;password=&lt;password-here&gt;;multipleactiveresultsets=True;App=EntityFramework&amp;quot; \" providerName=\"System.Data.EntityClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>All's well so far. So I want to do a small amount of scheduled background processing (based on a timer and not an incoming request). Its too small a task to justify starting a WorkerRole for the job.</p>\n\n<p>So instead, I created something like the following in the WebRole projects <code>WebRole.cs</code></p>\n\n<pre><code>public override void Run()\n{\n    while (true)\n    {\n      //This is for debug purposes:\n      string str = ConfigurationManager.ConnectionStrings[\"CommuteEntities\"].ToString();\n\n      BackgroundProcessing.BackgroundProcessing.BackgroundProcess();\n      Thread.Sleep(150000); //2.5mins\n    }\n}\n</code></pre>\n\n<p>For some reason the line to get the connection string just does not seem to work. However, putting the same code into a WCF service works just great. </p>\n\n<p>Just to emphasis, there is only one project in this solution and the <code>WebRole.cs</code> is located in the same project as the working WCF services.</p>\n\n<p><strong>Note</strong>: The getting of the connection string is just for debug purposes. The underlying issue that I have is that when my WebRole.cs tries to access a Entity it gets the following exception message:</p>\n\n<p><code>The specified named connection is either not found in the configuration, not intended to be used with the EntityClient provider, or not valid.</code></p>\n\n<p><strong>Note 2:</strong>: I've just noticed that it would appear that anything in my <code>WebRole.cs</code> can't see anything that has been configured in the <code>Web.config</code> file. Is there something that I'm not doing correctly or misunderstanding?</p>\n\n<p>Anybody come across this before or have any ideas?</p>\n"},{"tags":["asp.net","entity-framework","website"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12840364,"title":"Build order issue in an ASP.net Web Site","body":"<p>I had a Web Application that used to work just fine but I needed to use VB and C# and that's why I started the project as a Web Site.</p>\n\n<p>I created two subfolders into the <code>App_Code</code> folder and I wrote this in the <code>web.config</code> file:</p>\n\n<pre><code>&lt;codeSubDirectories&gt;\n  &lt;add directoryName=\"VB_Code\" /&gt;\n  &lt;add directoryName=\"CS_Code\" /&gt;\n&lt;/codeSubDirectories&gt;\n</code></pre>\n\n<p>Then, I placed my Entity Data Model in the root of the App_Code folder. This way, I received the follow warning when I tried to compile:</p>\n\n<p><code>Namespace or type specified in the Imports 'ProductizationModel' doesn't contain any public member or cannot be found. Make sure the namespace or the type is defined and contains at least one public member. Make sure the imported element name doesn't use any aliases.</code></p>\n\n<p>and a lot of errors related with this fact: the EDM was not builded and its namespace didn't exist yet. This errors come from classes that access to the database through my EDM and that are declared inside the VB_Code folder.</p>\n\n<p>Then, after research, I find that VS follows a build order and that the subfolders inside the <code>App_Code</code> are builded before the files in the root.</p>\n\n<p>I've created one more subfolder called <code>EF_Code</code> and declared it in the <code>web.config</code> file:</p>\n\n<pre><code>&lt;codeSubDirectories&gt;\n  &lt;add directoryName=\"EF_Code\"/&gt;\n  &lt;add directoryName=\"VB_Code\" /&gt;\n  &lt;add directoryName=\"CS_Code\" /&gt;\n&lt;/codeSubDirectories&gt;\n</code></pre>\n\n<p>but I'm still receiving the same warnings and errors.</p>\n\n<p>Anybody can light me?</p>\n\n<p>Thanks a lot,</p>\n"},{"tags":["asp.net","entity-framework","entity-framework-4","repository-pattern"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":138,"score":0,"question_id":12814254,"title":"How to de-attach an entity from a Context in Entity Framework?","body":"<p>I use EF 4.1 with Repository and DbContext.. POCO with T4 template.\nFor every Repository I use a separate DbContext.</p>\n\n<p>I need to update an object with has a related property, at the moment I receive this error</p>\n\n<pre><code>An entity object cannot be referenced by multiple instances of IEntityChangeTracker.\n</code></pre>\n\n<p>I suppose my problem is beacuse <code>eventObj</code> and <code>candidate</code> are created from different Repositories.</p>\n\n<p>So i'm trying to solve the problem with this code, with no success.</p>\n\n<p>My question?</p>\n\n<ul>\n<li>How do I get rid of this error?</li>\n<li><p>Is is possible remove the candidate from its context?</p>\n\n<pre><code>public void UpdateAddingCandidate(Event eventObj, Candidate candidate){\n    Event updatedEvent = new Event();\n    Candidate updatedCandidate = new Candidate();\n    updatedEvent = eventObj;\n    updatedCandidate = candidate;\n    updatedEvent.Candidate = updatedCandidate;\n    db.Entry(updatedEvent).State = EntityState.Modified;     \n}\n</code></pre></li>\n</ul>\n\n<p>EDIT</p>\n\n<pre><code>    public void UpdateAddingCandidate(Event eventObj, Candidate candidate)\n    {\n        /*\n        db.Events.AsNoTracking();\n        db.Candidates.AsNoTracking();\n        */\n        db.Entry(eventObj).State = EntityState.Detached;\n        db.Entry(candidate).State = EntityState.Detached;\n\n        Event updatedEvent = new Event();\n        Candidate updatedCandidate = new Candidate();\n        updatedEvent = eventObj;\n        updatedCandidate = candidate;\n        updatedEvent.Candidate = updatedCandidate;\n        db.Entry(updatedEvent).State = EntityState.Detached;\n        db.Entry(updatedEvent).State = EntityState.Modified;\n\n    }\n</code></pre>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12841467,"title":"Many lookups in one table, foreign key or non enforced code","body":"<p>I am modelling a customer entity in EF Designer, and use Model Based DB generation. A good number of the fields(about 10) will be sourced from the APS.NET MVC interface via dropdowns. I want to keep it simple. I also did not want to normalise the DB in the Nth degree as this could complicate the queries. Typically 2 or 3  values ie \"Male\",\"Female\"  I have a number of options:</p>\n\n<p>1) Use a code table with name, and store just code in customer table without enforcing FK constraint, ie 10 for \"Female\", 20 for \"Male\".</p>\n\n<p>2) Use enforcing FK constraint against code table</p>\n\n<p>3) Use Lookup from Code Table, and put Code Name into Customer field.</p>\n\n<p>4) Use some form of ASP.NET enumeration and populate Customer field with value.</p>\n\n<p>1) may be an issue with \"LINQ include\" commands since the child record will be unknown.\nI am sure there is a standard MVC/EF solution for this scenario.</p>\n\n<p>Many thanks in advance,</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":12808102,"title":"Entity Framework 5 Code Migration doesn't create database","body":"<p>I'm trying to use Entity Framework 5 Code First.\nI've created model classes and context.</p>\n\n<p>After that following Microsoft instructions I've enabled code migrations.</p>\n\n<p>Than I skipped running my application (during which DB should be created first time) and use Add-Migration command. Migration was generated successfully. </p>\n\n<p>Update-Database call was also successfull. <strong>But I'm not seeing my DB at all.</strong> It is absent! </p>\n\n<p>SQL Management Studio and Visual Studio Server Explorer show only 4 default system databases and that's all!\nI also tried to launch my application - it doesn't change anything.\nI'm using </p>\n\n<pre><code>public MyContext() : base(\"name=MyContext\") { }\n</code></pre>\n\n<p>such type of constructor (so I need specify connection string with <strong>MyContext</strong> name.\nHere is my <strong>app.config</strong> example:</p>\n\n<pre><code>&lt;configuration&gt;\n    &lt;configSections&gt;\n      &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n      &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n    &lt;/configSections&gt;\n    &lt;entityFramework&gt;\n      &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework\"&gt;\n        &lt;parameters&gt;\n          &lt;parameter value=\"v11.0\" /&gt;\n        &lt;/parameters&gt;\n      &lt;/defaultConnectionFactory&gt;\n    &lt;/entityFramework&gt;\n    &lt;startup&gt; \n        &lt;supportedRuntime version=\"v4.0\" sku=\".NETFramework,Version=v4.5\" /&gt;\n    &lt;/startup&gt;\n    &lt;connectionStrings&gt;\n      &lt;add name=\"BettyContext\" providerName=\"System.Data.SqlServerCe.4.0\" connectionString=\"Data Source=MyDB.sdf\"/&gt;\n    &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>I have no idea what's going on. Seems that no one has such problem. May be I've missed some evident thing, but howbeit I'm waiting for some help.</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":62,"score":-1,"question_id":12838229,"title":"foreach and changing a variable in EF 4.0","body":"<p>I'm working with Entity Framework 4.0. Here is a code I'm using</p>\n\n<pre><code>foreach (var item in context.Items.Where(x =&gt; !x.New))\n {\n   // .......\n   item.New = true;\n   context.SaveChanges();\n   Console.WriteLine(\"done\");\n }\n</code></pre>\n\n<p>Athough there is no exception appeares, <code>Console.WriteLine(\"done\");</code> <strong>never</strong> executes. every time the program finishes  for some reason.</p>\n\n<p>What did I do wrong?</p>\n"},{"tags":["c#","entity-framework","thread-safety","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12828140,"title":"Are EF objects thread-safe?","body":"<p>Following <a href=\"http://stackoverflow.com/questions/6126616/is-dbcontext-thread-safe\">this question</a> about the thread-safety of DbContext (it isn't), I need to know if it's safe to handle mapped POCOs in multiple threads.</p>\n\n<p>Suppose I have two objects mapped to the database using CodeFirst:</p>\n\n<pre><code>class Poco1\n{\n    public int Id { get; set; }\n    public string SomeProp {get; set;}\n    public virtual List&lt;Poco2&gt; children { get; set; }\n}\n\nclass Poco2\n{\n    public int id { get; set;}\n    public Poco1 parent { get; set; }\n}\n</code></pre>\n\n<p>In the main thread I'm loading Poco1:</p>\n\n<pre><code>var parentPoco = _context.Poco1s.Where(...).Single();\n</code></pre>\n\n<p>I then pass it to a task, where I create another object and change the parent a bit</p>\n\n<pre><code>var childPoco = new Poco2 { parent=parentPoco }; \nparentPoco.SomeProp = \"Tasked!\";\n</code></pre>\n\n<p>Then back in the main thread I add childPoco to the context:</p>\n\n<pre><code>_context.Poco2s.Add(childPoco);\n_context.SaveChanges();\n</code></pre>\n\n<p>I am not doing anything with the context in the secondary thread, but I am manipulating objects that are mapped to it.</p>\n\n<p>Can I do that?</p>\n"},{"tags":["entity-framework","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12732114,"title":"How to stop the EDMX generator from changing columns names","body":"<p>If a table has column names that are the same as the table name the EDMX Generator suffixes the column name with a \"1\". Ex: Changing Test to Test1 in the sample below.</p>\n\n<p>SQL Server Table definition:</p>\n\n<p>CREATE TABLE [dbo].[Test](\n    [Test] nchar NOT NULL,\n    [ColumnsTwo] nchar NULL,</p>\n\n<p>EF Model created:</p>\n\n<pre><code>     &lt;EntitySetMapping Name=\"Test\"&gt;\n        &lt;EntityTypeMapping TypeName=\"AdventureWorksModel.Test\"&gt;\n          &lt;MappingFragment StoreEntitySet=\"Test\"&gt;\n            &lt;ScalarProperty Name=\"ColumnsTwo\" ColumnName=\"ColumnsTwo\" /&gt;\n            &lt;ScalarProperty Name=\"Test1\" ColumnName=\"Test\" /&gt;\n          &lt;/MappingFragment&gt;\n        &lt;/EntityTypeMapping&gt;\n      &lt;/EntitySetMapping&gt;\n    &lt;/EntityContainerMapping&gt;\n</code></pre>\n\n<p>This causes  SqlQueries to throw the error \"The data reader is incompatible with the specified 'AdventureWorksModel.Test'. A member of the type, 'Test1', does not have a corresponding column in the data reader with the same name.\"</p>\n\n<p>Why does the DbContext generator modify the column name? The ObjectContext generator left them alone.</p>\n\n<p>How can we fix this? We have no control over the DB schema.</p>\n"},{"tags":["c#","asp.net","linq","entity-framework","lambda"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12838209,"title":"Get newest Post of each forum","body":"<p>So I am working on a self made forum (ASP.net MVC4) and I am currently displaying all the forums, in the controller I do this easy query:</p>\n\n<pre><code>return View(db.Forums.ToList());\n</code></pre>\n\n<p>But now I want to be able to also include the top post. (a Forum entity has a collection of Post, Post has a Date, I want to order by that and then do a take(1)).</p>\n\n<p>I try something like:</p>\n\n<pre><code>return View(db.Forums.Include(z=&gt;z.Posts.OrderBy(x=&gt;x.Date).Take(1)).ToList());\n</code></pre>\n\n<p>Then I get  the error:</p>\n\n<blockquote>\n  <p>The Include path expression must refer to a navigation property\n  defined on the type. Use dotted paths for reference navigation\n  properties and the Select operator for collection navigation\n  properties. Parameter name: path</p>\n</blockquote>\n\n<p>PS: here is the current view</p>\n\n<pre><code>@model IEnumerable&lt;MyProject.Data.Forum&gt;\n\n@{\n    ViewBag.Title = \"Forum Index\";\n}\n\n&lt;h2&gt;Forums&lt;/h2&gt;\n\n&lt;table class=\"Forum\"&gt;\n    &lt;tbody&gt;\n    &lt;tr&gt;Main forums&lt;/tr&gt;\n    @foreach (var item in Model)\n    {\n        &lt;tr class=\"ForumItem\"&gt;\n            &lt;td&gt;&lt;a href=\"Index?id=@item.Id\"&gt;X&lt;/a&gt;&lt;/td&gt;\n            &lt;td&gt;&lt;p&gt;&lt;a href=\"Index?id=@item.Id\"&gt;@item.Name&lt;/a&gt;&lt;/p&gt;&lt;span&gt;@item.Description&lt;/span&gt;&lt;/td&gt;\n            &lt;td&gt;@item.PostCount&lt;/td&gt;\n            @foreach(var post in item.Posts)\n            {\n                &lt;td&gt;@post.Title&lt;/td&gt;\n            }\n        &lt;/tr&gt;\n    }\n    &lt;/tbody&gt;\n&lt;/table&gt;\n</code></pre>\n\n<p>Anyone knows a solution for this? </p>\n"},{"tags":["linq","linq-to-sql","entity-framework","linq-to-entities"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":7214,"score":8,"question_id":5352545,"title":"What is difference between .edmx and .dbml file in linq?","body":"<p>What is difference between .edmx and .dbml file in linq?In VS 2008 which datasource is best choice where edmx or dbml?Any problem will arise using edmx file in VS 2008?Can i use edmx in VS-2008? </p>\n"},{"tags":["wpf","wcf","entity-framework","nhibernate","orm"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":171,"score":2,"question_id":12366299,"title":"WPF and WCF RIA Service+EF or alternatives","body":"<p>Is there any way to get full support for RIA Services+EF for WPF application. I've read previous threads but looks like solution's offered there lacks's essential functionalty like transparent CRUD and Validation API support.</p>\n\n<p>Or is there alternative solutions with other popular communication frameworks/ORM that supports that functionality (to summarize - transparent work with POCO classes in 3-tier enviromnent).</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":12838893,"title":"How to Call Oracle stored procedure by EF4.3 CodeFirst","body":"<p>MY Procedure IS That\nCREATE OR REPLACE PROCEDURE GETPersons\n(\nIN_ID NUMBER,\nOUT_CURSOR OUT SYS_REFCURSOR\n)\nIS\nBEGIN\nOPEN OUT_CURSOR FOR \nSELECT T.ID,T.NAME FROM Persons T WHERE T.ID = IN_ID;\nEND;</p>\n\n<p>I WANt TO CALL THIS PROCEDURE BY EF4.3 Code First!Must is Code First. Not Data Model or other\nSO I KNOW HOT TO  PROCEDURE  BY SQLSERVER , But MY DataBase IS Oracle</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12838699,"title":"Entity Framework: M:M with simple type in the right side","body":"<p><strong>Two tables:</strong></p>\n\n<pre><code>Agencies (AgencyId, name, ...)     PK: AgencyId \nFavoredAgencies (AgencyId, UserId) PK: AgencyId, UserId\n</code></pre>\n\n<p><strong>Class:</strong></p>\n\n<pre><code>public class Agency\n{\n   [Key]\n   public int AgencyId {get;set;}\n   public string Name {get;set;}\n   public virtual ISet&lt;string&gt; FavoredByUserIds {get;set;}\n}\n</code></pre>\n\n<p>I consider <code>FavoredAgencies</code> a <em>M:M</em> table even though the value on the right <code>(UserId)</code> does not point to another table/entity. <code>UserId</code> is the value I want.</p>\n\n<p>How to map this scenario using Code First and without creating a class <code>User</code> ?</p>\n"},{"tags":["sql-server","entity-framework","c#-4.0","model"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":12838383,"title":"EF 4.1 not respecting the SQL Server columns","body":"<p>I have just updated my MVC3 project (with C#) from <code>ObjectContext</code> to <code>DbContext</code>, but I'm getting some weird error...</p>\n\n<p>I'm using the database-first approach, and I have an table with a <code>Name</code> column of type <code>nvarchar</code>, that was not null. I changed it to accept <code>null</code> in SQL Server, then I updated my <code>edmx</code> model, deleted the <code>.tt</code> files and  generated it again (with ADO.NET <code>DbContext</code>).</p>\n\n<p>When I create a new object from that table, setting value to <code>Name</code> property to null I get an <code>DbEntityValidationException</code> with <code>The Name field is required</code> message in <code>db.SaveChanges()</code>. </p>\n\n<p>But the table is accepting NULL on Name column! I already inserted many rows with SQL in SQL Server with NULL in <code>Name</code> column!</p>\n\n<p>Anyone knows how can I solve that?</p>\n\n<p>Some information</p>\n\n<p>Here is my table SQL:</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [dbo].[Pre_Register](\n    [Id] [int] IDENTITY(1,1) NOT NULL,\n    [Name] [nvarchar](64) NULL,\n    [Email] [nvarchar](64) NOT NULL,\n    [Permission] [tinyint] NOT NULL,\n    [Password] [nvarchar](256) NOT NULL\nPRIMARY KEY CLUSTERED \n(\n    [Id] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>This is the automatic generated model class:</p>\n\n<pre><code>public partial class Pre_Register\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string Email { get; set; }\n    public byte Permission { get; set; }\n    public string Password { get; set; }\n}\n</code></pre>\n\n<p>And here is how I get the error:</p>\n\n<pre><code>Pre_Register preReg = new Pre_Register();\n\ndb.Pre_Register.Add(preReg);\n\npreReg.Email = \"dudu@mail.com\";\npreReg.Permission = 1;\npreReg.Password = \"123456\";\npreReg.Name = null;\n\n// here it comes\ndb.SaveChanges();\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12820850,"title":"Group And Count. Simplify Code","body":"<p>I am counting the number of users created per day as follows:</p>\n\n<pre><code>IEnumerable&lt;DateTime&gt; dates = GetAllDatesForPeriod();\n\nvar rows = context.Users\n  .Where(x =&gt; x.Created &gt;= minDate &amp;&amp; x.Created &lt;= max.Date)\n  .GroupBy(x =&gt; new { Year = x.Created.Year, Month = x.Created.Month, Day = x.Created.Day })\n  .Select(x =&gt; new { Year = x.Key.Year, Month = x.Key.Month, Day = x.Key.Day, Count = x.Count() }).ToList()\n  .Select(x =&gt; new DataModel { Date = new DateTime(x.Year, x.Month, x.Day), Users = x.Count }).ToList();\n\n  rows.AddRange(dates.Where(x =&gt; !rows.Any(y =&gt; y.Date == x)).Select(x =&gt; new DataModel { Date = x, Users = 0 }));\n</code></pre>\n\n<p>The second Select is because I am not able to create a DateTime in the Ef query.</p>\n\n<p>The AddRange is to fill the missing dates with a Count = 0.</p>\n\n<p>This code is working. But is there a way to simplify this?</p>\n\n<p>Thank You,\nMiguel</p>\n"},{"tags":["asp.net-mvc","entity-framework","webgrid"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":166,"score":0,"question_id":12815267,"title":"How to use webgrid ASP.net MVC 3.0?","body":"<p>I am new on ASP.net MVC 3.0, I want to display my data to WebGrid and I write this code in the View.</p>\n\n<pre><code>@model IEnumerable&lt;MvcApplication3.Models.MOVIE&gt;\n\n\n@{\n    ViewBag.Title = \"Index\";\n}\n\n&lt;h2&gt;Index&lt;/h2&gt;\n\n&lt;p&gt;\n    @Html.ActionLink(\"Create New\", \"Create\")\n    @ViewBag.abc;\n&lt;/p&gt;\n\n@Html.ActionLink(\"Asc Title\", \"Index\", new { sortOrder = \"asc\" })\n@Html.ActionLink(\"Desc Title\", \"Index\", new { sortOrder = \"desc\" })\n\n&lt;table&gt;\n    &lt;tr&gt;\n        &lt;th&gt;\n            TITLE\n        &lt;/th&gt;\n        &lt;th&gt;\n            PRICE\n        &lt;/th&gt;\n        &lt;th&gt;\n            RELEASEDATE\n        &lt;/th&gt;\n        &lt;th&gt;&lt;/th&gt;\n    &lt;/tr&gt;\n\n@foreach (var item in Model) {\n    &lt;tr&gt;\n        &lt;td&gt;            \n            @Html.DisplayFor(modelItem =&gt; item.TITLE)\n        &lt;/td&gt;\n        &lt;td align=\"right\"&gt;\n            @Html.DisplayFor(modelItem =&gt; item.PRICE)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.DisplayFor(modelItem =&gt; item.RELEASEDATE)\n        &lt;/td&gt;\n        &lt;td&gt;\n            @Html.ActionLink(\"Edit Saya\", \"Edit\", new { id=item.ID }) |\n            @Html.ActionLink(\"Details\", \"Details\", new { id=item.ID }) |\n            @Html.ActionLink(\"Delete\", \"Delete\", new { id=item.ID }) |          \n            @Html.ActionLink(\"Select\", \"MoviedanArtis\", new { id = item.ID }) \n        &lt;/td&gt;\n    &lt;/tr&gt;\n}\n\n&lt;/table&gt;\n\n@{    \n    var grid = new WebGrid(Model.ToList(), rowsPerPage: 6);    \n}\n\n&lt;div id=\"grid\"&gt;\n    @grid.GetHtml(tableStyle: \"grid\", \n    headerStyle: \"head\",\n    alternatingRowStyle: \"alt\",\n    columns: grid.Columns(grid.Column(\"TITLE\"), grid.Column(\"PRICE\"), grid.Column(\"RELEASEDATE\")))\n&lt;/div&gt;\n</code></pre>\n\n<p>Here are the controller</p>\n\n<pre><code>private MovieEntities db = new MovieEntities();\n\n        //\n        // GET: /Coba/        \n        public ViewResult Index()\n        {           \n            return View(db.MOVIEs.ToList());\n        }\n</code></pre>\n\n<p>After that I always get error \"The result of a query cannot be enumerated more than once.\" What can I do to solve it?</p>\n"},{"tags":["entity-framework","ef-code-first","mysql-connector"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12836859,"title":"Mysql .net Connector 6.6.x DbMigration EF 4.3 cascade delete","body":"<p>I have code first models with the latest 6.6.x beta driver working.\nDbmigrations seem to be working fine as wel.</p>\n\n<p>However there seems to be a problem with cascade settings.\nMy models have cascade delete all over them, but the database that gets generated does not reflect these settings.</p>\n\n<p>On the mysql website in the change log there is something mentioned about cascade delete nog generated correctly in the sql create script , but i do not know if this is also for dbmigrations.</p>\n\n<p>Anyway it does not seem to work?\nAnyone that seen the same behaviour?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12834558,"title":"Entity Framework 5 Code Migrations","body":"<ol>\n<li><p>Where is stored information about current database state (what migration is applied)? I suppose it can be \"dbo.__MigrationHistory\" table or this table is just for logging purpose?</p></li>\n<li><p>If I enabled migration, added migration and updated my database. After that I checked-in code to SVN and another developer checked it out. What this another developer has to do to create/update his own database?</p></li>\n</ol>\n\n<p>I see such options:</p>\n\n<p>1) Call Update-Database command right away.</p>\n\n<p>2) Do everything from beginning (Enable-Migration, Add-Migration, Update-Database).</p>\n\n<p>3) Do everything but skip Add-Migration step (it is already present and it seems strange to add it once again for every new developer).</p>\n\n<p>Which of my assumption is right or if no one where is the right way?</p>\n"},{"tags":["c#","entity-framework","transactionscope","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":77,"score":0,"question_id":12836374,"title":"Using transactions with linq to entities","body":"<p>I am a EntityFramework newbie. I am facing a very weird issue. I am not being able to use transaction using a linq to entity query. I have used for DbTransaction as well as TransactionScope. The error occurs as soon as the query is hit. I am using EF 4.3. The context derives from DbContext as usual. I am using the Code First approach. </p>\n\n<pre><code>        using (TransactionScope s = new TransactionScope())\n        {\n         using(var context = new XYZContext())\n         {   \n               context.Database.Connection.Open();\n               Int32 count = (from xyz in context.XYZs\n                           where xyz.Name == \"SameName\"\n                           select xyz.Name).Count();\n               Assert.AreEqual(count, 1);\n          }\n        }\n</code></pre>\n\n<p>I have some doubts. I do not want to use the TrasactionScope because I have heard it has performance issues. So how can I use the DbTransaction instead(also throwing error for me)?\nWhy do I need to open the connection explicitly? When I am 'newing' up a context then should it not open the connection automatically for me?</p>\n"},{"tags":["asp.net","visual-studio-2008","linq","entity-framework","c#-3.0"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":894,"score":0,"question_id":2593262,"title":"Error: FormatException was unhandled by user code in Linq how to solve?","body":"<p><img src=\"http://i43.tinypic.com/5l8op0.jpg\" alt=\"alt text\"></p>\n\n<p>Look please below this codes throw me : FormatException was unhandled by user code</p>\n\n<p>Codes: </p>\n\n<pre><code> satis.KDV = Decimal.Parse((from o in genSatisctx.Urun where o.ID == UrunID select o.Kdv).ToString());</code></pre>\n\n<p>How can i rewrite linq query?</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12835793,"title":"Entity framework 4.3 DBMigrations code first, database dependency","body":"<p>I have a code first model with db migrations working fine on a mysql .net connector 6.6.x driver.</p>\n\n<p>But i was wondering if the migrations i am generating from the models are mysql specific or should i be able to migrate the same dbmigrations (including initial create script) to other databases as long as i have configured a driver and sqlgenerator for it ?</p>\n\n<p>I know it somehow does use the database schema you are developing againt to generate the dbmigration steps.\nAlthough its not clear to me why, cause it should be able to generate these totally based on the code first models.</p>\n"},{"tags":["wcf","entity-framework","entity-framework-4.1","n-tier","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":197,"score":0,"question_id":9721909,"title":"Building application with Entity framework dbContext API issues","body":"<p>I am developing a WCF Service application. It is going to be a part of large system. It provides some business logic and is based on Entity framework 4.1. I want to divide application code into 2 tiers (projects in VS, dll's): Service (which contains business logic) and DAL.</p>\n\n<p>I have such database model in my project</p>\n\n<pre><code>ClassModel\nclassID : int, PK\nclassIdentity : string\nteacherName : string\nstatisticInfo : int\nisRegistered : bool\n\n\nStudentModel\nstudentID : int, PK\nstudentIdentity : string\nclassID : int, FK\n</code></pre>\n\n<p>For this I am generating code using dbContext templates and I get:</p>\n\n<pre><code>public partial class ClassModel\n{\n    public ClassModel()\n    {\n        this.Student = new HashSet&lt;StudentModel&gt;();\n    }\n    public int ClassID { get; set; }\n    public string ClassIdentity { get; set; }\n    public string TeacherName  { get; set; }\n    public int StatisticInfo { get; set; }\n    public bool IsRegistered { get; set; }\n\n    public virtual ICollection&lt;TerminalModel&gt; Terminal { get; set; }\n}\n\npublic partial class StudentModel\n{\n    public int StudentID { get; set; }\n    public string StudentIdentity { get; set; }\n    public bool IsRegistered { get; set; }\n\n    public virtual ClassModel Class { get; set; }\n}\n</code></pre>\n\n<p>I want to expose only some of this information through the service, so I have different model as a data contract:</p>\n\n<pre><code>[DataContract]\npublic class Clas{\n    [DataMember]\n    public string ClassIdentity {get;set;}\n    [DataMember]\n    public string TeacherName {get;set;}\n    [DataMember]\n    public string ClassMark {get;set;} //computed from statisticInfo\n    [DataMember]\n    public int NumberOfStudents {get;set;} //amount of students in this class\n}\n</code></pre>\n\n<p>And my part of my ServiceContract:</p>\n\n<pre><code>[OperationContract]\npublic void RegsterClass(Clas clas); //(if given clas does not exists adds it and) sets its isRegistered column to True\n[OperationContract]\npublic Clas GetClass(string classIdentity);\n</code></pre>\n\n<p>As you can see some fields are not present, others are being computed.\nIn such case I have some concerns about how should I built application properly. Could you write example code which implements the interface methods using everything I mentioned in the way that you think is proper?</p>\n"},{"tags":["c#","wcf","entity-framework","n-tier","self-tracking-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":176,"score":2,"question_id":10509097,"title":"Does there exist a T4 Template for generating a WCF service to provide Get and Save for Self Tracking Entities?","body":"<p>I'm working with self tracking entities on a n-tier application.  So I have a WCF service which provides the client access to the data layer and I find myself implementing a lot of the \"same\" functions corresponding with Getting some entities from my model, for example <code>GetOrders</code>, and after changing them in the client, a <code>Save(Order order)</code> or <code>Save(TrackableCollection&lt;Orders&gt; orders)</code> operation to persist the changes.</p>\n\n<p>I'm wondering if there exists a T4 template that could build the basic interface, with Get/Save for single and collections of each entity and the corresponding service implementation from my model?</p>\n\n<p>I'm aware that I could write my own T4 Template to generate this service, and I will probably do just that if I have to, but first I thought I'd ask the community if this effort exists already somewhere on the internet, is planned, is desired by others and/or is a totally stupid idea.</p>\n\n<p>I did find this <a href=\"http://blogs.msdn.com/b/phaniraj/archive/2010/08/10/t4-templates-for-wcf-data-services-part-i.aspx\" rel=\"nofollow\">WCF Data Services Generator</a> example, which is kind of on the right track.</p>\n\n<p>Maybe something more suited to STEs using WCF in an n-tier solution is out there?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12835469,"title":"DbUpdateConcurrencyException not occuring","body":"<p>I am currently following this tutorial</p>\n\n<p><a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application\" rel=\"nofollow\">http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application</a></p>\n\n<p>However, I cannot seem to get the concurrency exception (DbUpdateConcurrencyException) to occur.</p>\n\n<p>I have created the a Timestamp field in the relevant table (called 'Group' in my project).</p>\n\n<p>My code is as follows</p>\n\n<p>in GroupController.cs</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Edit(Group group)\n{\n    try\n    {\n        if (ModelState.IsValid)\n        {\n\n            medEntitiesDB.Entry(group).State = EntityState.Modified;\n            medEntitiesDB.SaveChanges();\n            return RedirectToAction(\"Index\");\n\n        }\n\n\n    }\n\n    catch (DbUpdateConcurrencyException ex)\n    {\n        var entry = ex.Entries.Single();\n        var databaseValues = (Group)entry.GetDatabaseValues().ToObject();\n        var clientValues = (Group)entry.Entity;\n        if (databaseValues.GroupName != clientValues.GroupName)\n            ModelState.AddModelError(\"Name\", \"Current value: \"\n                + databaseValues.GroupName);\n        ModelState.AddModelError(string.Empty, \"The record you attempted to edit \"\n            + \"was modified by another user after you got the original value. The \"\n            + \"edit operation was canceled and the current values in the database \"\n            + \"have been displayed. If you still want to edit this record, click \"\n            + \"the Save button again. Otherwise click the Back to List hyperlink.\");\n        group.Timestamp = databaseValues.Timestamp;\n    }\n    catch (DataException)\n    {\n        //Log the error (add a variable name after Exception)\n        ModelState.AddModelError(string.Empty, \"Unable to save changes. \n          Try again, and if the problem persists contact your system administrator.\");\n    }\n\n    return View(group);\n}\n</code></pre>\n\n<p>My 'Group' class is as follows</p>\n\n<pre><code>namespace MyClasses\n{\nusing System;\nusing System.Collections.Generic;\n\nusing System.ComponentModel;\nusing System.ComponentModel.DataAnnotations;\nusing System.Web.Mvc;\n\n\n public partial class Group\n {\n\n    public System.Guid GroupID { get; set; }\n    public string GroupName { get; set; }\n    public System.DateTime DateCreated { get; set; }\n\n    [Timestamp]\n    public byte[] Timestamp { get; set; }\n }\n}\n</code></pre>\n\n<p>Does anyone know why this exception is not occuring?</p>\n"},{"tags":["c#",".net","oracle","entity-framework","stored-functions"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":167,"score":2,"question_id":12799124,"title":"Usage of stored functions in entity framework","body":"<p>I have an old <code>Oracle</code> DB which I'm trying to use within <code>EntityFramework 4.1</code> application.<br>\nI've read about the big limitation that oracle has with EF- you can't call Oracle stored <strong>Function</strong> with EF unless you create a wrapping <strong>Procedure</strong>.  </p>\n\n<p>I got thousands of stored functions in my DB, is there any other way to solve it?<br>\nLike using raw <code>Context.SqlQuery()</code>?  </p>\n\n<p>So far I couldn't find a solution for it...</p>\n\n<hr>\n\n<p><a href=\"http://www.oracle.com/technetwork/issue-archive/2011/11-sep/o51odt-453447.html\" rel=\"nofollow\">Oracle docs:</a></p>\n\n<blockquote>\n  <p>Oracle developers can leverage PL/SQL stored <strong>procedures</strong>, with limitations, within the entity framework via Entity Framework Function Imports (used to call the procedures explicitly) and stored procedure mappings (which are automatically called for entity Insert, Update, and Delete operations).  </p>\n  \n  <p><strong>Only Oracle stored procedures can be called by Entity Framework, not stored functions.</strong> (Oracle stored functions can be used if they are wrapped inside of a stored procedure that uses an OUT parameter for the stored function return value.)</p>\n</blockquote>\n"},{"tags":["asp.net-mvc","entity-framework","validation","asp.net-mvc-4","entity-framework-5"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":12832897,"title":"Validation of domain model: how and where","body":"<p>A typical EF+MVC system will have two or three levels of validation:  </p>\n\n<ol>\n<li>For ViewModel: input / physical validation (DataAnnotations, FluentValidation), in other words, length, null, range, regex, etc.  </li>\n<li>For Model: input / physical validation (repeat of 1 in case MVC is not used and data comes from another system, WCF, forms, etc.)  </li>\n<li>For Model: logical / \"business rules\" validation</li>\n</ol>\n\n<p>I can't find best practices for validation of 2+3 for the actual Model / entities / domain / \"business rules\". We either:</p>\n\n<ul>\n<li>put simple validation rules in an entity's property setter (but this is really messy)</li>\n<li>hook into EF's <code>SaveChanges()</code>, and if an entity is in the <code>Added</code> or <code>Modified</code> state then trigger validation (which validates the entire entity at once)</li>\n</ul>\n\n<p>This is hard to maintain. A lot of thought went into ViewModel validation, but for Model validation it is domain-specific and so it is for you to determine a creative solution, and mine is not that great.</p>\n\n<ul>\n<li>Are there better ways to do this, or helpful tools (like maybe DataAnnotations or FluentValidation but for domain entities)?</li>\n<li>Where is the best place to do model validation or to trigger the model's validation?</li>\n</ul>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":207,"score":3,"question_id":7638992,"title":"Entity Framework Code First associations/FK issues and assumptions/defaults","body":"<p>I am very confused by the way Entity Framework is able to pick up on relationships between entities. I have a few questions on this.</p>\n\n<p>In a simple test application, I have a table of people, and a table of notes, and a table of picture assets.</p>\n\n<ol>\n<li>There are many pictures, each is owned by a person (a person can own more than one). </li>\n<li>There are many notes, each is owned by a person (a person can own more than one). </li>\n<li>and finally a person has a logo which is a picture.</li>\n</ol>\n\n<p>.</p>\n\n<pre><code>    public class Person\n    {\n        public int ID { get; set; }\n\n        public string name { get; set; }\n\n        public Picture logo { get; set; }\n    }\n\n    public class Note\n    {\n\n        public int ID { get; set; }\n\n        public string Text { get; set; }\n\n        public Person Owner { get; set; }\n    }\n\n\n public class Picture\n    {\n\n        public int ID { get; set; }\n\n        public string Path { get; set; }\n\n        public Person Owner { get; set; }\n    }\n</code></pre>\n\n<p>When I try to run, I get the error \"Unable to determine the principal end of an association between the types ....\".</p>\n\n<p>(If I drop the Person.logo  field, compile/run, then manually add it in to SQL, along with the FK relationship, it works 100% as expected... I just can't seem to work out how to set this from EF itself).</p>\n\n<p>Can you help with the error? I have read quite a few answers here, but, I just can't seem to adapt it to fix my error.</p>\n\n<p>However, now I have a one to many and a many to one (I don't think this is classed as many to many?), I just don't understand how to create people objects, where a FK is non nullable and the FK doesn't exist yet.</p>\n\n<p>A solution I found, which I really don't like is to make the person.picture column nullable, then create a person, followed by creating a picture, then assign a picture to the person object... but, ideally I don't want it nullable. There should always be a picture.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":100,"score":-1,"question_id":12828739,"title":"Entity Framework set navigation property to null","body":"<p>I have a entity framework database first project. here is a extraction of the model:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public partial class LedProject\n{\n    public LedProject()\n    {\n        this.References = new HashSet&lt;LedProjectReference&gt;();\n        this.Results = new HashSet&lt;LedProjectResult&gt;();\n        this.History = new HashSet&lt;LedProjectHistory&gt;();\n    }\n\n    public string Identifier { get; set; }\n    public string Name { get; set; }\n    public Nullable&lt;System.DateTime&gt; CompletionDate { get; set; }\n    public System.DateTime CreationDate { get; set; }\n    public System.Guid ProjectId { get; set; }\n    public string Comment { get; set; }\n\n    public virtual User ContactUser { get; set; }\n    public virtual User CreationUser { get; set; }\n    public virtual Customer Customer { get; set; }\n    public virtual LedProjectAccounting Accounting { get; set; }\n    public virtual LedProjectState State { get; set; }\n    public virtual ICollection&lt;LedProjectReference&gt; References { get; set; }\n    public virtual ICollection&lt;LedProjectResult&gt; Results { get; set; }\n    public virtual User ResponsibleUser { get; set; }\n    public virtual ICollection&lt;LedProjectHistory&gt; History { get; set; }\n}\n</code></pre>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public partial class User\n{\n    public System.Guid UserId { get; set; }\n    public string LoginName { get; set; }\n    public System.DateTime CreationDate { get; set; }\n    public string Firstname { get; set; }\n    public string Lastname { get; set; }\n    public string Email { get; set; }\n}\n</code></pre>\n\n<p>I have a problem with setting the navigation item <strong>ResponsibleUser</strong> of the class <strong>LedProject</strong>. When I set the <strong>ResponsibleUser</strong> to a another user and afterwards save the changes of the DBContext, the changes are stored in the database.</p>\n\n<p>But, when I want to delete the current <strong>ResponsibleUser</strong> of an <strong>LedProject</strong>, by setting the navigation property to null. The changes are not stored in the database.</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>LedProject project = db.LedProject.Find(projectId);\nproject.Name = string.IsNullOrEmpty(name) ? null : name;\n...\nproject.ResponsibleUser = responsibleUser == null ? null : db.User.Find(responsibleUser.UserId);\n...\ndb.SaveChanges();\n</code></pre>\n\n<p>Is there any trick for deleting navigation properties?</p>\n"},{"tags":["entity-framework","odac"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12834290,"title":"Entity Framework with ODAC","body":"<p>I use EF with ODAC and it's Oracle.DataAccess and Oracle.Web.dll version numbers are 2.112.3.0, but on the server the version number is 2.112.1.0. My web application always is giving this error message:\nUnable to find the requested .Net Framework Data Provider.  It may not be installed. \nI think it is due to the difference of version numbers. I tried to copy these two dlls onto the server but it didn't solve the problem. How can I get through this problem? Must I reinstall some of the clients to fix this issue?\nThank you. </p>\n"},{"tags":["asp.net","entity-framework","combobox"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12834158,"title":"Adding a new item in database through combobox","body":"<p>I am having a database and I use it through Entity Framework, I need to update the data by editing the other items in text boxes and grid, that is working fine and below is the code:\nIn aspx.cs</p>\n\n<pre><code>protected void SaveBtn_Click(object sender, EventArgs e)\n    {\n        obj.Address = AppAddress.Text;\n        obj.City = AppCity.Text;\n        obj.Email = AppEmail.Text;\n        obj.Notes = AppComments.Text;\n        obj.Postal = AppPostal.Text;\n        obj.AppraiserAppraiserCompanyId = ApprCompCmbx.SelectedIndex;\n        obj.ProvinceState = Province.SelectedIndex;\n        apprblobj.GetUpdate(obj);\n        Response.Write(\"&lt;script&gt;alert('You have successfully updated the Data');&lt;/script&gt;\");\n}\n</code></pre>\n\n<p>call in the BL:</p>\n\n<pre><code> public void GetUpdate(Appraiser appObj)\n    {\n        obj.UpdateData(appObj);\n\n    }\n</code></pre>\n\n<p>and in the DAL</p>\n\n<pre><code> public void UpdateData(Appraiser apprObj)\n    {\n\n        try\n        {\n            var Appsave = context.Appraisers.FirstOrDefault(App =&gt; App.AppraiserId == apprObj.AppraiserId);\n            if (Appsave != null)\n            {\n                Appsave.AppraiserName = apprObj.AppraiserName;\n                Appsave.AppraiserAppraiserCompanyId = apprObj.AppraiserAppraiserCompanyId;\n                Appsave.Address = apprObj.Address;\n                Appsave.City = apprObj.City;\n                Appsave.ProvinceState = apprObj.ProvinceState;\n                Appsave.Email = apprObj.Email;\n                Appsave.Postal = apprObj.Postal;\n                Appsave.Notes = apprObj.Notes;\n\n                context.SaveChanges();\n            }\n        }\n        catch (Exception ex)\n        {\n\n             log.Debug(\"Appraiser : UpdateData: \" + ex.Message + \" Trace : \" + ex.StackTrace);\n        }\n    }\n</code></pre>\n\n<p>Now I wanto to add a new item through the same combobox and on the button click functionality as it is doing all the work like add, update and delete.\nKindly provide me the hint: This I know that addobject(<em>_</em>_) will ve used in place of savechanges etc.</p>\n"},{"tags":["entity-framework","resources","metadata","edmx"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":183,"score":2,"question_id":10803930,"title":"Entity framework metadata exception - No csdl, ssdl, msl in dll resources","body":"<p>I have DAL (model first entity framework 4.1) and Service  which is using it in separate projects. Everything was working fine, but after some minor changes (for example I generated model from database) it stoppedd working. I am now getting metadata exception.\nAfter many hours of research I downloaded ILSpy and checked that inside DAL.dll there are no resources.\nMy connection string looks like:</p>\n\n<pre><code>metadata=res://*/DataModel.TerminalRegistryModel.csdl|\n         res://*/DataModel.TerminalRegistryModel.ssdl|\n         res://*/DataModel.TerminalRegistryModel.msl;\n</code></pre>\n\n<p>ANd in EDMX file metadata artifact processing is set to Embed in Output Assembly.\nWhat can cause my problem?</p>\n"},{"tags":[".net","wpf","vb.net","entity-framework","binding"],"answer_count":11,"favorite_count":3,"up_vote_count":55,"down_vote_count":0,"view_count":40427,"score":55,"question_id":683863,"title":"\"Items collection must be empty before using ItemsSource.\"","body":"<p>I'm trying to get images to display in a WPF ListView styled like a WrapPanel as described in this old ATC Avalon Team article: <a href=\"http://blogs.msdn.com/atc%5Favalon%5Fteam/archive/2006/04/28/585844.aspx\">How to Create a Custom View</a>.</p>\n\n<p><img src=\"http://img257.imageshack.us/img257/8770/imageviewd.jpg\" alt=\"WPF ListView WrapPanel Images\" /></p>\n\n<p>When I try to populate the ListView with a LINQ-to-Entities queried collection of ADO.NET Entity Framework objects I get the following exception:</p>\n\n<p><strong>Exception</strong></p>\n\n<blockquote>\n  <p>Items collection must be empty before\n  using ItemsSource.</p>\n</blockquote>\n\n<p>My code&hellip;</p>\n\n<p><strong>Visual Basic</strong></p>\n\n<pre><code>Private Sub Window1_Loaded(...) Handles MyBase.Loaded\n    ListViewImages.ItemsSource = From g In db.Graphic _\n                                 Order By g.DateAdded Ascending _\n                                 Select g\nEnd Sub\n</code></pre>\n\n<p><strong>XAML</strong></p>\n\n<pre><code>&lt;ListView Name=\"ListViewImages\"\n          SelectionMode=\"Single\"\n          ItemsSource=\"{Binding}\"&gt;\n    &lt;local:ImageView /&gt;\n&lt;/ListView&gt;\n</code></pre>\n\n<p>I put a breakpoint on that line.  <code>ListViewImages.ItemsSource</code> is <code>Nothing</code> just before the LINQ assignment.</p>\n"},{"tags":["c#","asp.net-mvc","asp.net-mvc-3","entity-framework","razor"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":100,"score":1,"question_id":12828347,"title":"Ajax.ActionLink post entire model from a view?","body":"<p>I have a view that is strongly typed to a ViewModel.  Is it possible to pass all of the data from a model in the view, back to a controller action?  Something like this?  </p>\n\n<pre><code>@Ajax.ActionLink(\"(Export to Excel)\", \"ExportCsv\", \"SurveyResponse\", new {  \nResultsViewModel = Model }, new AjaxOptions {HttpMethod = \"POST\"})\n</code></pre>\n\n<p>And then collect the data from ResultsViewModel as a parameter in another controller</p>\n\n<pre><code>public ActionResult ExportCsv(ResultsViewModel resultsviewmodel)\n{\n\n}\n</code></pre>\n"},{"tags":["oracle","entity-framework","mapping","numbers","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":184,"score":2,"question_id":11446419,"title":"EntityFramework / WCF RIA Services / Oracle / Custom number mapping","body":"<p>this post is intended as (not optimal) solution for everyone that has to struggle with the same problem and there is only few to no answer in the net atm...\n(of cousrse this post will contain information from other sources)</p>\n\n<p>we had problems with custom data type mapping (number) in our project (VS2010/EntityFramework/WCF RIA Services/Oracle ODP.NET) which we were able to solve the following way:</p>\n\n<p>we had to use the following custom oracle number mapping information (because of legacy DB)</p>\n\n<pre><code>&lt;/connectionStrings&gt;\n  &lt;oracle.dataaccess.client&gt;\n    &lt;settings&gt;\n      &lt;add name=\"int16\" value=\"edmmapping number(4,0)\" /&gt;\n      &lt;add name=\"int32\" value=\"edmmapping number(9,0)\" /&gt;\n      &lt;add name=\"int64\" value=\"edmmapping number(17,0)\" /&gt;\n    &lt;/settings&gt;\n  &lt;/oracle.dataaccess.client&gt;\n</code></pre>\n\n<p>we put this information in App.Config within the project with the EDMX file(s)\nnow we were able to create our EDMX files with the custom mapping</p>\n\n<p>1) there was a problem that when you restart VS2010 it can happen that upon proeject compilation it wont compile because of an Error 2019, this error is of course related to our custom mapping and its a \"VS2010 bug???\" maybe but one solution is to open he VS2010 about window then close it then compile... but the better solution might or might not be to add the same information we added to the App.Config file to the devenv.exe.config file...</p>\n\n<p>now we can compile the EDMX project and \nthe My.Service.Web (.NET) project that uses the our EDM</p>\n\n<p>2) there is still another problem ... the WCF RIA Service My.Service (SL5) project\nhas no idea of the App.Config settings so when we try to compile it we will also get the\nError 2019...\nadding the mapping information to the Web.Config file did not help\nbut when we add it to the machine.config file we can finally compile...</p>\n\n<p>SUMMARY: add the mapping information to\nApp.Config (where your edmx file is)\nMachine.Config (C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Config)\nWeb.Config (in your web project, not sure if required since we added it to Machine.config)</p>\n\n<p>QUESTION: isn't there a better solution than to add it to Machine.Config?\n          I really hope someone has a better one because it will probably restict\n          development of other projects...</p>\n\n<p>hope this helps and hope for a better (re)solution</p>\n\n<p>thx and cheers</p>\n\n<p>versions:\nVS2010 SP1\nEntityFramework 4.1\nWCF RIA Services 1 SP2\nOracle 11g (ODAC/ODP.NET 11.2.0.3.0)</p>\n"},{"tags":["entity-framework","entity-framework-4","asp.net-mvc-4","edmx","edmx-designer"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12832745,"title":"asp.net mvc entity framework with multiple databases","body":"<p>I have an ASP.Net MVC project that uses EF.  I develop this application at work computer and at my home computer.  The following is in my Web.config.  How could I change the EDMX with the proper connection string for each office?  So far, I have to drop the EDMXs and re-add them and comment out other connection strings.  Thanks.</p>\n\n<pre><code>    &lt;connectionStrings&gt;\n    &lt;clear/&gt;\n    &lt;!-- At Home connections --&gt;\n    &lt;add name=\"App1Entities\" connectionString=\"metadata=res://*/Models.App1Model.csdl|res://*/Models.App1Model.ssdl|res://*/Models.App1Model.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=my-pc\\SqlExpress;initial catalog=App1Database;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n    &lt;add name=\"Service1Entities\" connectionString=\"metadata=res://*/Models.Service1Model.csdl|res://*/Models.Service1Model.ssdl|res://*/Models.Service1Model.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=my-pc\\SqlExpress;initial catalog=ServiceDatabase;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n\n    &lt;!-- At Work connections \n    &lt;add name=\"App1Entities\" connectionString=\"metadata=res://*/Models.App1Model.csdl|res://*/Models.App1Model.ssdl|res://*/Models.App1Model.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=sqlServer1;initial catalog=App1Database;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n    &lt;add name=\"Service1Entities\" connectionString=\"metadata=res://*/Models.Service1Model.csdl|res://*/Models.Service1Model.ssdl|res://*/Models.Service1Model.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=sqlServer2;initial catalog=ServiceDatabase;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n    --&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-5","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12831961,"title":"DbContext.Entry attaching Entity","body":"<p>From my research, I read that calling DbContext.Entry(someEntity) would automatically attached the entity to the context.</p>\n\n<p>However, when I do this I find that the entity's state is detached.</p>\n\n<p>Can anyone shed some light on this and how the DbContect.Entry works. I'm using EF 5.0</p>\n\n<p>Thanks.</p>\n"},{"tags":["linq","entity-framework","dbset"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12831122,"title":"Entity Framework dbset most efficient way of deleting","body":"<p>I have the following and looking for a more  efficient way of deleting vs looping through the records and then deleting each one at a time (note using Dbset):</p>\n\n<pre><code>     var wcd = dbContext.ProgramDetails.Where(p =&gt; p.Id == Id);\n\n     foreach (var wc in wcd.ToList())\n     {\n        dbContext.ProgramDetails.Remove(wc);\n     }\n\n     dbContext.SaveChanges();\n</code></pre>\n\n<p>Also say if we have 1 record that is as following:</p>\n\n<pre><code>    var pg = dbContext.Program.Where(p =&gt; p.Id == Id &amp;&amp; Name == FName);\n</code></pre>\n\n<p>What is the best way of deleting this one record? </p>\n\n<p>tried the following but gave an error: </p>\n\n<pre><code>    var pg = dbContext.Program.Where(p =&gt; p.Id == Id &amp;&amp; Name == FName);\n    dbContext.Program.Remove(wc);\n</code></pre>\n\n<p>Then I resorted to doing a foreach for deleting just one record as I have shown above that is not the most efficient for just 1 record.</p>\n"},{"tags":["c#","entity-framework","using"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12830689,"title":"Is there any difference in how or when the connection closes between the following 2 methods?","body":"<p>Below are 2 methods that are almost identical. I would like to know if there's any difference in how or when the context object will be disposed?</p>\n\n<pre><code>public List&lt;Template&gt; MethodVu()\n{\n  List&lt;Template&gt; templates;\n\n  using (var context = new Entities())\n  {\n    templates = context.Templates.ToList();\n  }\n\n  return templates;\n}\n\npublic List&lt;Template&gt; MethodDo()\n{\n  using (var context = new Entities())\n  {\n    return context.Templates.ToList();\n  }\n}\n</code></pre>\n"},{"tags":["asp.net","entity-framework"],"answer_count":2,"favorite_count":12,"up_vote_count":50,"down_vote_count":0,"view_count":8858,"score":50,"question_id":1589166,"title":"It has a DefiningQuery but no InsertFunction element... err","body":"<p>This thing is driving me crazy, and the error is quite meaningless to me:</p>\n\n<p><em>Unable to update the EntitySet 'TableB' because it has a DefiningQuery and no  element exists in the  element to support the current operation.</em></p>\n\n<p>My tables are put like this:</p>\n\n<pre>\nTableA\nint idA (identity, primary key)\n...\n\nTableB\nint idA (FK for TableA.idA)\nint val\n</pre>\n\n<p>TableB has no defined primary key in the SQL server. The Entity Framework has imported the table and the association and set both fields as key. But it will output that error when I try to do an insert into the table!</p>\n\n<p>What's wrong??</p>\n\n<p><hr /></p>\n\n<p><strong>Edit:</strong> \nAs suggested by Alex, the solution was this:</p>\n\n<ol>\n<li>Right click on the edmx file, select Open with, XML editor</li>\n<li>Locate the entity in the edmx:StorageModels element</li>\n<li>Remove the DefiningQuery entirely</li>\n<li>Rename the store:Schema=\"dbo\" to Schema=\"dbo\" (otherwise, the code will generate an error saying the name is invalid)</li>\n<li>Remove the store:Name property</li>\n</ol>\n\n<p>I left the key as it was, since it was OK to me that both the columns are part of the key.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12741109,"title":"Entity Framework code first Fluent mapping","body":"<p>I have two tables </p>\n\n<ul>\n<li>StoreOrderItem</li>\n<li>StoreOrder</li>\n</ul>\n\n<p>Now StoreOrder has many StoreOrderItems and StoreOrderItem has one StoreOrder (simple 1 to many relationship)</p>\n\n<pre><code>public class StoreOrderItemMap : EntityTypeConfiguration&lt;StoreOrderItem&gt;\n{\n        public StoreOrderItemMap()\n        {\n            this.ToTable(\"StoreOrderItem\");\n            this.HasKey(op =&gt; op.Id);\n            this.Property(op =&gt; op.StoreOrderId).HasColumnName(\"order_id\");\n            ...\n\n            this.HasRequired(so =&gt; so.StoreOrder)\n              .WithMany(soi =&gt; soi.StoreOrderItems)\n              .HasForeignKey(so =&gt; so.StoreOrderId);\n        }\n}\n\npublic class StoreOrderMap : EntityTypeConfiguration&lt;StoreOrder&gt;\n{\n    public StoreOrderMap()\n    {\n        this.ToTable(\"StoreOrder\");\n        this.HasKey(op =&gt; op.Id);\n        ....\n    }\n}\n\npublic class StoreOrderItem\n{\n    ....\n    public virtual int StoreOrderId { get; set; }\n    ....\n\n    public virtual StoreOrder StoreOrder { get; set; }\n}\n\npublic class StoreOrder\n{\n    .... \n    private ICollection&lt;StoreOrderItem&gt; _storeOrderItems;\n    ....\n\n    public virtual ICollection&lt;StoreOrderItem&gt; StoreOrderItems\n    {\n        get { return _storeOrderItems ?? (_storeOrderItems = new List&lt;StoreOrderItem&gt;()); }\n        set { _storeOrderItems = value; }\n    }\n\n}\n\n//The code which is used to add the configurations to the modelBuilder.\nprotected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n    System.Type configType = typeof(ContentMap);   //any of your configuration classes here\n    var typesToRegister = Assembly.GetAssembly(configType).GetTypes()\n        .Where(type =&gt; !String.IsNullOrEmpty(type.Namespace))\n        .Where(type =&gt; type.BaseType != null &amp;&amp; type.BaseType.IsGenericType &amp;&amp; type.BaseType.GetGenericTypeDefinition() == typeof(EntityTypeConfiguration&lt;&gt;));\n        foreach (var type in typesToRegister)\n        {\n            dynamic configurationInstance = Activator.CreateInstance(type);\n            modelBuilder.Configurations.Add(configurationInstance);\n        }\n        base.OnModelCreating(modelBuilder);\n}\n</code></pre>\n\n<p>Note I am running this code on an existing DB, how do I tell EF to not select \"StoreOrder_Id\" and to instead use the existing column \"order_id\"? </p>\n\n<p>Here is the error:</p>\n\n<p>Server Error in '/' Application.</p>\n\n<p>Invalid column name 'StoreOrder_Id'.</p>\n\n<blockquote>\n  <p>Description: An unhandled exception occurred during the execution of\n  the current web request. Please review the stack trace for more\n  information about the error and where it originated in the code. </p>\n  \n  <p>Exception Details: System.Data.SqlClient.SqlException: Invalid column\n  name 'StoreOrder_Id'.</p>\n</blockquote>\n"},{"tags":["c#","asp.net-mvc","asp.net-mvc-3","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12829537,"title":"Post Array of values from View back to controller","body":"<p>I am trying to pass all data from an array inside my view back to a controller.  I'm not sure how to do this using my ViewModel.  </p>\n\n<p>Model Class</p>\n\n<pre><code>public class ResultsViewModel\n{\n    public int?[] ProgramIds { get; set; }\n\n}\n</code></pre>\n\n<p>Form inside of the View</p>\n\n<pre><code>@using (Html.BeginForm(\"ExportCsv\", \"SurveyResponse\", FormMethod.Post))\n\n{\n\n   // Should I be looping through all values in the array here?\n    @Html.HiddenFor(x =&gt; x.ProgramIds)\n\n    &lt;input type=\"submit\" value=\"Submit\" /&gt;\n}\n</code></pre>\n\n<p>Controller I am posting to</p>\n\n<pre><code>        [HttpPost]\n        public ActionResult ExportCsv(ResultsViewModel ResultsViewModel)\n        {\n\n        }\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12828869,"title":"Why is my foreign key not being set?","body":"<p>I'm using Entity Framework, code first and I've got this code in my controller</p>\n\n<pre><code>_auctionContext.AddToAuctionEvents(new AuctionEvent\n    {\n        Title = model.Title,\n        Description = model.Description,\n        Starts = model.Starts,\n        Ends = model.Ends,\n        DepositAmount = model.DepositAmount,\n        Currency = _auctionContext.Currency.Where(c =&gt; c.Id == model.Currency).First()\n    });\n_auctionContext.SaveChanges();\n</code></pre>\n\n<p>I have a this in my view</p>\n\n<pre><code>&lt;section&gt;\n    @Html.LabelFor(model =&gt; model.Currencies)\n    &lt;div&gt;\n        @Html.DropDownList(\"Currency\", Model.Currencies, \"Select Currency\", new { required = \"required\" }) \n        @Html.ValidationMessageFor(model =&gt; model.Currencies)\n    &lt;/div&gt;\n&lt;/section&gt;\n</code></pre>\n\n<p>My viewmodel as referred to above looks like this</p>\n\n<pre><code>public class AuctionEventDetailsModel\n{\n    public AuctionEventDetailsModel()\n    {\n        Currencies = new List&lt;SelectListItem&gt;();\n    }\n\n    public string Title { get; set; }\n    public string Description { get; set; }\n    public DateTime Starts { get; set; }\n    public DateTime Ends { get; set; }\n    public decimal DepositAmount { get; set; }\n    public List&lt;SelectListItem&gt; Currencies { get; set; }\n    public int Currency { get; set; }\n}\n</code></pre>\n\n<p>For some reason when the code in the controller executes it always puts a null in the <code>Currency_Id</code> field in the <code>AuctionEvents</code> table in the database. Why is this?</p>\n"},{"tags":["c#",".net","multithreading","entity-framework","parallel-processing"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":12827599,"title":"Parallel doesnt work with Entity Framework","body":"<p>I have a list of IDs, and I need to run several stored procedures on each ID.</p>\n\n<p>When I am using a standard foreach loop, it works OK, but when I have many records, it works pretty slow.</p>\n\n<p>I wanted to convert the code to work with EF, but I am getting an exception: \"The underlying provider failed on Open\".</p>\n\n<p>I am using this code, inside the Parallel.ForEach:</p>\n\n<pre><code>using (XmlEntities osContext = new XmlEntities())\n{\n    //The code\n}\n</code></pre>\n\n<p>But it still throws the exception.</p>\n\n<p>Any idea how can I use Parallel with EF? do I need to create a new context for every procedure I am running? I have around 10 procedures, so I think its very bad to create 10 contexts, one for each.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":410,"score":0,"question_id":11284725,"title":"Missing template for Db context generator for Visual Studio 2010","body":"<p>I have Vs2010  ultimate. I installed asp.net mvc 4 and EF 5 that was part of it. </p>\n\n<p>There is no db context generator template for EF 5 for visual studio 2010. Only for  the RC of the next version. </p>\n\n<p>Short of installing vs 2012. What are my options?</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":12826673,"title":"Entity Framework - Reverse Engineer Code First - Overwriting Changes","body":"<p>Im using the EF Power Tools to <strong>Reverse Engineer</strong> an existing Database. This is fine. Under the EDMX Database-1st Route I would create partial classes for any overrides like Data Annotations, for e.g. here, <strong>LedgerPeriod</strong> being the original EntityObject:</p>\n\n<pre><code>[MetadataType(typeof(LedgerPeriodMetaData))]\npublic partial class LedgerPeriod\n{\n    public class LedgerPeriodMetaData\n    {\n\n        [Required(ErrorMessage = \"Period Start Date Required\")]\n        [DisplayFormat(ApplyFormatInEditMode = true, DataFormatString = \"{0:dd/MM/yyyy}\")]\n        [DataType(DataType.Date)]\n        public object PeriodDateFrom { get; set; }\n\n        [Required(ErrorMessage = \"Period End Date Required\")]\n        [DisplayFormat(ApplyFormatInEditMode = true, DataFormatString = \"{0:dd/MM/yyyy}\")]\n        [DataType(DataType.Date)]\n        public object PeriodDateTo { get; set; }\n\n    }\n}\n</code></pre>\n\n<p>This is fine. Now do I use the same approach for <strong>Code First Reverse Engineer</strong> or are there any custom settings whereby if you have to run the power tools multiple times, because say I added a new Table to the Database, it wouldn't overwrite any changes to the existing Models created previously.</p>\n\n<p>This would ultimately mean I can make changes to the actual model classes themselves, instead of creating partial classes.</p>\n\n<p>Reference to the EF Powertools can be found here:</p>\n\n<p><a href=\"http://blogs.msdn.com/b/adonet/archive/2012/04/09/ef-power-tools-beta-2-available.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/adonet/archive/2012/04/09/ef-power-tools-beta-2-available.aspx</a></p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","ado.net"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12825200,"title":"Validation with ViewModel","body":"<p>I have an asp.net mvc3 w/ ado.net entity framework doing some validation. </p>\n\n<p>I have created a viewmodel as such</p>\n\n<pre><code>public class id\n{\n\n\n    [Required]\n    public decimal l_ID\n    {\n        get;\n        set;\n    }\n\n    [Required]\n    public decimal v_ID\n    {\n        get;\n        set;\n    }\n}\n</code></pre>\n\n<p>Is it possible to add some set of validation rules so that the l_id must be larger than the v_id? validation should be done once the user has submitted the page. How would this be done? Any tutorials? Does this validation need to be done in the controller or using partial classes? Is there any examples out there</p>\n"},{"tags":["c#",".net","linq","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12825195,"title":"EF LINQ many to one filter/where","body":"<p>I'm getting an exception when the <code>GetProducts()</code> method is called below.  I'm essentially trying to filter down my list of Products by what is available in the specified Country.  There is a one to many relationship setup between a Product and a Country.</p>\n\n<pre><code>    public static List&lt;Product&gt; GetProducts(Country country)\n    {\n        Context db = new Context();\n        return db.Products.Where(m =&gt; m.Countries.Contains(country)).ToList&lt;Product&gt;();\n    }\n</code></pre>\n\n<blockquote>\n  <p>Unable to create a constant value of type\n  'DataModels.Country'. Only primitive types or\n  enumeration types are supported in this context.</p>\n</blockquote>\n\n<p>If I'm not going about this the right way, what is the best way to filter Products by the single selected Country?</p>\n"},{"tags":["c#","entity-framework","entity-framework-4","database-migration"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":644,"score":1,"question_id":11910962,"title":"Use the ColumnAttribute or the HasKey method to specify an order for composite primary keys","body":"<p>I'm trying to use composite primary key on 2 objects with parent-child relationship. Whenever I try to create a new migration, I get an error:</p>\n\n<p><strong>Unable to determine composite primary key ordering for type 'Models.UserProjectRole'. Use the ColumnAttribute or the HasKey method to specify an order for composite primary keys.</strong></p>\n\n<p>As per error suggests, I do add annotation <code>Column (Order = X)</code> but the error still there and does not go away, unless I leave only one field with Key annotation. \nHere  is my object that it trips off:</p>\n\n<pre><code>public class UserProjectRole\n{\n    [Key, Column(Order = 0),DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Guid UserProjectRoleID { get; set; }\n\n    [Key, Column (Order = 1)]\n    public Guid ProjectID { get; set; }\n\n    [ForeignKey(\"ProjectID\")]\n    public Project Project { get; set; }\n\n    public Guid AppUserGuid { get; set; }\n\n    // followed by a number of unrelated String fields.\n }\n</code></pre>\n\n<p>Here is Project class:</p>\n\n<pre><code>public class Project: Base\n{\n    [Key, DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Guid ProjectID { get; set; }\n\n    public virtual ICollection&lt;UserProjectRole&gt; UserRoles { get; set; }\n\n    // followed by a number of unrelated String fields.\n\n}\n</code></pre>\n\n<p>Here is part of my DBContext:</p>\n\n<pre><code>public class SiteContext : DbContext\n{\n\n    public DbSet&lt;Project&gt; Projects { get; set; }\n\n    public DbSet&lt;UserProjectRole&gt; UserProjectRoles { get; set; }\n}\n</code></pre>\n\n<p>I'm in VisualStudio 2012 with EF 4.3.1</p>\n\n<p>I have been banging my head against this for a while now and all the forum and SO answers suggest to add Column Order annotation that I already have.\n<strong>Am I missing something obvious???</strong></p>\n\n<p><em>Thank you for reading this far -)</em></p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","entity-framework-4","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":642,"score":4,"question_id":12205165,"title":"Exception when code first tried to create database","body":"<p>I've created a new ASP.NET MVC 4 application, and would like it to use code first. However it doesn't seem to initially create the database file if it doesn't exist already. If I delete the .mdf file from the App_Data folder, then I get the following exception when the app tries to access the database:</p>\n\n<pre><code>System.Data.SqlClient.SqlException: Cannot attach the file '&lt;path-to-db-file&gt;.mdf' as database '&lt;my-db-file-name&gt;'.\n</code></pre>\n\n<p>If I run it in the app in the debugger, then I can see that the exception is occurring in the InitializeSimpleMembershipAttribute::OnActionExecuting method when calling LazyInitializer.EnsureInitialized. The caught exception is:</p>\n\n<pre><code>[System.Reflection.TargetInvocationException]   {\"Exception has been thrown by the target of an invocation.\"}   System.Reflection.TargetInvocationException\n</code></pre>\n\n<p>With an inner exception of:</p>\n\n<pre><code>[System.InvalidOperationException]  {\"The ASP.NET Simple Membership database could not be initialized. For more information, please see http://go.microsoft.com/fwlink/?LinkId=256588\"} System.InvalidOperationException\n</code></pre>\n\n<p>Which then has the first exception I mentioned above as the inner exception of that.</p>\n\n<p>Any ideas what I'm doing wrong?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I've just tried it with a brand new MVC4 app. I can replicate it by doing the following:</p>\n\n<ol>\n<li>Create the MVC app in the VS wizard.</li>\n<li>Run the app for the first time and go to the login page (note the mdf file now gets generated).</li>\n<li>Delete the mdf file, and go back to the login page. The exception is now thrown.</li>\n</ol>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12821265,"title":"Entity Framework Code Generation not running on save","body":"<p>I have an EF5 Database First data context. At some point the designer has stopped generating the data context and entity classes when a change is made and the designer is saved.</p>\n\n<p>I am using the dbcontext T4 templates and haven't changed anything else (Although I'm sure something must have been changed by accident).</p>\n\n<p>Any suggestions about how I get the automatic code generation?</p>\n"},{"tags":["c#","entity-framework","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":1000,"score":0,"question_id":1218592,"title":"ADO.NET Entity Association Error","body":"<p>i got Two Table named Personnel and Department..</p>\n\n<pre><code>**Personnel Table ;**\nPERSONNELID int , PK not null\nNAME varchar\nSURNAME varchar\nDepartmentID integer \n\nDepartment Table ;\nDepartmentID  int , PK not null\nDEPARTMENTNAME varchar\n\n(ONE TO MANY Relation)\n</code></pre>\n\n<p><strong>i wanna association between this tables. but i cant do it. with EDMX Model Designer .. gettin errors ;</strong></p>\n\n<p>Association END KEY property PERSONNELID is not mapped.\nAssociation END KEY property NAME is not mapped. blabla ....</p>\n\n<p>too new at this framework ,  Is there any easy way of do this job in the Entity Framework , ?</p>\n\n<p>i am using Firebird 2.1 DB . and Firebird.Client.Data 2.5.0.0. for provider.</p>\n"},{"tags":["entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12824122,"title":"LINQ to Entities does not recognize the method 'System.String ToString()' method, and this method cannot be translated into a store expression","body":"<p>I'm using the following code :</p>\n\n<pre><code>using(var sd=new dataEntities())\n{\nvar listofdata=sd.users.where(d=&gt;d.id.ToString().Contain(\"2\"));// id as int\n// error : LINQ to Entities does not recognize the method 'System.String ToString()' method, and this method cannot be translated into a store expression.\n}\n</code></pre>\n\n<p>I looked at the site but did not find answer</p>\n"},{"tags":["c#","linq","entity-framework","lambda","linq-to-entities"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":109,"score":1,"question_id":12822446,"title":"Breaking LINQ to Entities into multiple parts","body":"<p>I had the following code</p>\n\n<pre><code>query = query.Where(device =&gt; GetDeviceDistanceFromGeocode(geocode, device) &lt;= distanceMetres);\n\nprivate static double GetDeviceDistanceFromGeocode(Geocode geocode, Device device)\n{\n    return Math.Pow(\n        Math.Pow(device.Address.Geocode.Easting - geocode.Easting, 2) +\n        Math.Pow(device.Address.Geocode.Northing - geocode.Northing, 2)\n        , 0.5);\n}\n</code></pre>\n\n<p>However it throws an exception because linq cannot recognise my function forcing me into doing the whole query expression in one go.</p>\n\n<pre><code>Exception[LINQ to Entities does not recognize the method \n'Double DistanceOfDeviceFromGeocode(Geocode, Device)' method, \nand this method cannot be translated into a store expression.] \n</code></pre>\n\n<p>Is it possible to break a query expression out into multiple parts like i'm trying to do here?  It's not very readable when the query is so big.</p>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>Here's the full query as asked for in the comments.</p>\n\n<pre><code>return query.Where(device =&gt; \n            Math.Pow(\n                Math.Pow(device.Address.Geocode.Easting - geocode.Easting, 2) + \n                Math.Pow(device.Address.Geocode.Northing - geocode.Northing, 2)\n                , 0.5) \n                &lt;= distanceMetres);\n</code></pre>\n\n<p>Basically I don't think this is very readable so would like to break it down into multiple parts but from the links supplied it doesn't seem possible.</p>\n\n<p>In c++ I could have broken some of it out into a macro but unfortunately this isn't a feature of c#.</p>\n\n<hr>\n\n<p>Following suggestions I've updated the code to this which works quite nicely and improves the readability of the code a lot!</p>\n\n<pre><code>    return query.Where( DevicesWithinDistanceFromGeocode(distanceMetres, geocode) );\n}\n\npublic Expression&lt;Func&lt;Device, bool&gt;&gt; DevicesWithinDistanceFromGeocode(double distance, Geocode geocode)\n{\n    return device =&gt; (  SqlFunctions.SquareRoot(\n                            SqlFunctions.Square((double)(device.Address.Geocode.Easting - geocode.Easting)) +\n                            SqlFunctions.Square((double)(device.Address.Geocode.Northing - geocode.Northing))\n                        ) &lt;= distance );\n}\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12822775,"title":"Choose other user than current user in windows authentication Entity Framework","body":"<p>When I'm trying to create the entity model in Visual Studio 2010, I want to connect to a database that my current windows user can't access, how can I specify different login/password to access the database ?</p>\n"},{"tags":["entity-framework","entity-framework-4","ef-database-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":12798502,"title":"Entity Framework - Entity read-only property mapped to a column of related table","body":"<p>I have interesting problem to solve but, although common, it looks like it's not easily achievable with Entity Framework. There are two tables:</p>\n\n<pre><code>Player(Id,TeamId,FirstName,LastName)\nTeam(Id, Name, IsProfessional)\n</code></pre>\n\n<p>Player can belong only to one team. Using TPT (DB first), we have two classes mapped to those tables:</p>\n\n<pre><code>public class Player\n{\n   public int Id{get;set;}\n   public int TeamId{get;set;}\n   public string FirstName{get; set;}\n   public string LastName{get; set;}\n   public Team Team{get;set;}\n}\n\npublic class Team\n{ \n   public int Id{get; set;}\n   public string Name{get;set;}\n   public bool IsProfessional{get;set;}\n   public IEnumerable&lt;Player&gt; Players{get;}\n}\n</code></pre>\n\n<p>What I would like to achieve is property IsProfessional on Player entity:</p>\n\n<pre><code>public class Player\n    {\n       public int Id{get;set;}\n       public int TeamId{get;set;}\n       public string FirstName{get; set;}\n       public string LastName{get; set;}\n       public Team Team{get;set;}\n       **public bool IsProfessional{get;}** should be read-only\n    }\n</code></pre>\n\n<p>Is it possible to configure mapping that way IsProfessional property can be used in linq queries?</p>\n\n<pre><code>var result= db.Players.Where(p=&gt;p.IsProfessional==true);\n</code></pre>\n\n<p>and to have that field populated every time Player entity is materialized?</p>\n\n<pre><code>Player pl = db.Players.Where(p=&gt;p.FirstName=\"Lionel\").FirstOrDefault();\nif(pl.IsProfessional)\n{\n//do something...\n}\n</code></pre>\n\n<p>Already tried with:</p>\n\n<ul>\n<li><strong>Entity Splitting</strong>. Not possible because I want to keep Team mapping and because relationship is not 1:1)</li>\n<li><strong>Mapping Player entity to a db view</strong>. Didn't like it because there are other relationships Player entity has that I need. I know it is possible to create them manually, but updating edmx from database will reset ssdl.</li>\n</ul>\n\n<p>Thanks</p>\n\n<p><strong>Solution</strong></p>\n\n<p>Based on second option in Gert Arnold answer, solution that fits my needs is as follows:</p>\n\n<ol>\n<li><p>I create function GetIsProfessional (had to do it because computed fields normally can be made only from own table fiels)</p>\n\n<p>CREATE FUNCTION [dbo].[GetIsProfessional](@teamId as INT)\nRETURNS bit</p>\n\n<p>BEGIN</p>\n\n<p>DECLARE @isProfi AS bit</p>\n\n<p>SELECT @isProfi = IsProfessional\nFROM Teams\nWHERE Id = @teamId</p>\n\n<p>RETURN @isProfi</p>\n\n<p>END</p></li>\n<li><p>I created computed field on Player table</p>\n\n<p>ALTER TABLE Players ADD [IsProfessional] AS dbo.GetIsProfessional(TeamId)</p></li>\n<li><p>As I'm using db first approach, I just update model from database and that's it, I can query on that field and it's pre populated when Player object is materialized.</p></li>\n</ol>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12815787,"title":"EF Code First and Saving Multiple Records","body":"<p>Just getting to grips with Entity Framework and I can save, add, delete etc a single entity like so:</p>\n\n<pre><code>db.Entry(client).State = EntityState.Modified;\ndb.SaveChanges();\n</code></pre>\n\n<p>My question is if I wanted to change several records how should I do this, for example I want to select all Jobs with a Type of 'new' and set the Type to 'complete'.  I can select all the jobs easily enough with Linq but do I have to loop through, change them, set the state to modified, save changes, next one etc?  I'm sure there is a straightforward way that I just don't know about or managed to find yet.</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":12632240,"title":"EntityFramework update or insert Chinese or non-English text","body":"<p>Actually before i did not use framework or linq, just type in sql statement with Sqlcommand class, i type in <code>insert into table values(N'sample')</code>\nactually i donot know what is N, but it works for Chinese and other Language, otherwise, it will insert some question mark.</p>\n\n<p>But when i use EntityFramework,this kind of framework always insert some question mark, can i ask how to tackle the issue.</p>\n\n<p>N means Unicode?\nCan you give me one example that EntityFramework use that sort of thing?</p>\n"},{"tags":["c#",".net","performance","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12821377,"title":"Can EF5 works fine in event based processing","body":"<p>I have this code for example for an event handler </p>\n\n<pre><code>public void ONDataArrived ( string data ) \n{\n//do some processing and save it to DB using EF \nctx.Add ( x ) ; \nctx.SaveChanges ()  ; \n\n}\n</code></pre>\n\n<p>Is there any chance that EF may error if this event fired a couple of times in the same time ? </p>\n\n<p>thanks </p>\n"},{"tags":[".net","entity-framework","connection-string"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":2742897,"title":"access EF classes from a Class Library - exactly how do configure/test the connection string in the client? (getting errors)","body":"<p>I'm getting very confused about how to call my EF classes in a Class Library from the Client Project I have?  Things worked fine when they were in the same project.  Now I'm getting errors such as \"Unable to load the specified metadata resource \". </p>\n\n<p>I've see various ideas / suggestions re how to fix the connection string (e.g. create an App.config in your client project &amp; copy the connection string config from your class library,  something about change the connection settings to copy to output, etc)</p>\n\n<p>QUESTION - Can someone provide a solid way on how to get EF class access from a separate project working?  (i.e. how to get the correct connection information to the client somehow)</p>\n\n<p>thanks</p>\n"},{"tags":["c#","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12821083,"title":"Using Entity Framework to access a remote database","body":"<p>I need to be able to use EF to access a database on a remote server.  I have the connection string to remote database in app.config.</p>\n\n<p>When I try this:</p>\n\n<pre><code>using (var ctx = new PinnReportEntities(\"name=remoteConnection\"))\n{\n    .\n    .\n    .\n}\n</code></pre>\n\n<p>I get this:</p>\n\n<pre><code>The specified named connection is either not found in the configuration, not intended to be used with the EntityClient provider, or not valid.\n</code></pre>\n\n<p>The named connection is in the configuration and is valid, so the issue must be with the EntityClient provider.  </p>\n\n<p>Is what I want to do even possible and is this the correct way to do it?</p>\n"},{"tags":["c#","linq","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":86,"score":6,"question_id":12232708,"title":"What's the most efficient way to get only the final row of a SQL table using EF4?","body":"<p>I'm looking to retrieve the last row of a table by the table's ID column. What I am currently using works:</p>\n\n<pre><code>var x = db.MyTable.OrderByDescending(d =&gt; d.ID).FirstOrDefault();\n</code></pre>\n\n<p>Is there any way to get the same result with more efficient speed?</p>\n"}]}
{"total":18927,"page":12,"pagesize":100,"questions":[{"tags":["c#","asp.net","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12818194,"title":"Move generated classes after Reverse engineer code first used in Entity Framework Power tools beta 2","body":"<p>I am using <code>Entity Framework 5.0</code> with <code>Entity Framework Powertools beta 2</code>. We have a database that we are not allowed to change and so are using the Reverse Engineer Code First option to create the classes. The generated classes are placed in the Models folder below the mappings.</p>\n\n<p>Is there a safe/best way to move these generated classes into their own project, leaving the <code>DbContext-type</code> class and the Mapping file classes in the Models folder?</p>\n"},{"tags":["c#","entity-framework","entity","ef-code-first","modelmetadata"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2948,"score":2,"question_id":6106842,"title":"Entity Framework - Get Table name from the Entity","body":"<p>I'm using the Entity Framework 4.1 with Code First approach. I'm able to get the storage model types and column names of my entities:</p>\n\n<pre><code>var items = context.ObjectContext.MetadataWorkspace.GetItems&lt;EntityType&gt;(DataSpace.SSpace);\n\nforeach (var i in items)\n{\n    Console.WriteLine(\"Table Name: {0}\", i.Name);\n\n    Console.WriteLine(\"Keys:\");\n    foreach (var key in i.KeyMembers)\n        Console.WriteLine(\"\\t{0} ({1})\", key.Name, key.TypeUsage.EdmType.FullName);\n\n    Console.WriteLine(\"Members:\");\n    foreach (var member in i.Members)\n        Console.WriteLine(\"\\t{0} ({1})\", member.Name, member.TypeUsage.EdmType.FullName);\n}\n</code></pre>\n\n<p>What I need is to get the real table name the entity is mapped to. There are different ways to specify that (by using Fluent-API .ToTable(), DataAnnotation [TableAttribute]).</p>\n\n<p>Is there any common way to achieve this information?</p>\n"},{"tags":["mysql","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":58,"score":0,"question_id":12820692,"title":"Is it possible to use Entity Framework code first with MySQL","body":"<p>I would like to set up a quick console app that will create a database / tables from a code first definition with  EF . Is there any one that could help me with this or any project/doc I can have a look at ?</p>\n\n<p>Thx</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":2732,"score":4,"question_id":1256786,"title":"Entity Framework Generated SQL","body":"<p>Is it possible to output the SQL generated by the Entity Framework on a global level and not on a query by query basis?  I'm looking to just dump it all somewhere so I can review it.</p>\n\n<p>If that is not possible, how do I view the SQL being generated for updates and inserts?</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12815445,"title":"Optimistic concurrency updates using Entity Framework","body":"<p>I have a repository using EF 4.1 and <code>DbContext</code> when updating an object I receive this error</p>\n\n<blockquote>\n  <p><em>Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or\n  deleted since entities were loaded. Refresh ObjectStateManager\n  entries.</em></p>\n</blockquote>\n\n<p>I suppose is connected with optimistic concurrency updates.. Any idea how to solve it?</p>\n\n<pre><code>  public void UpdateAddingCandidate(Event eventObj, int candidateId)\n    {\n        Candidate newCandidate = db.Candidates.AsNoTracking().FirstOrDefault(x =&gt; x.CandidateId == candidateId);\n        eventObj.Candidate = newCandidate;\n        eventObj.CandidateId = newCandidate.CandidateId;\n        db.Entry(eventObj).State = EntityState.Modified;\n    }\n</code></pre>\n"},{"tags":["entity-framework","dynamicquery"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":596,"score":0,"question_id":2822111,"title":"Dynamic Linq Library Guid exceptions","body":"<p>I am having a problem with the Dynamic Linq Library. I get a the following error \"ParserException was unhandled by user code ')\" or ','\". I have a Dicitionary and I want to create a query based on this dictionary. So I loop through my dictionary and append to a string builder \"PersonId = (GUID FROM DICTIONARY). I think the problem is were I append to PersonId for some reason I can't seem to convert my string guid to a Guid so the dynamic library don't crash. </p>\n\n<p>I have tried this to convert my string guid to a guid, but no luck.</p>\n\n<pre><code>query.Append(\"(PersonId = Guid(\" + person.Key + \")\");\n\nquery.Append(\"(PersonId = \" + person.Key + \")\");\n</code></pre>\n\n<p>I am using VS 2010 RTM and RIA Services as well as the Entity Framework 4. </p>\n\n<pre><code>//This is the loop I use\nforeach (KeyValuePair&lt;Guid, PersonDetails&gt; person in personsDetails)\n{\n    if ((person.Value as PersonDetails).IsExchangeChecked)\n    {\n        query.Append(\"(PersonId = Guid.Parse(\" + person.Key + \")\");\n    }\n}\n\n//Domain service call\n var query = this.ObjectContext.Persons.Where(DynamicExpression.ParseLambda&lt;Person, bool&gt;(persons));\n</code></pre>\n\n<p>Please help, and if you know of a better way of doing this I am open to suggestions.</p>\n"},{"tags":["entity-framework","wcf-ria-services","silverlight-5.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12819518,"title":"Getting \"Unable to find metadata for...\" after VS 2012 upgrade","body":"<p>We are having a ASP .Net project containing two EF datamodel. Domain data services a defined on top of the EF entities.\nThe Web project is bound to a RIAServices library. \nEverything is working fine in VS 2010, but after upgrading to VS2012, I'm getting this error when  building the RIAServices library:\n\"Unable to find metadata for....\"</p>\n\n<p>I checked the web assembly with Reflector and the metadata resources( the csdl, msl and ssdl file) are not included as resources in the assembly.</p>\n\n<p>BUT if I rebuild (cleaning and building) the web project, the metadata resources are included??</p>\n\n<p>Make a simple correction to the web project code and hitting F5 (only building not rebuilding), make the metadata resources disappear again.</p>\n\n<p>I've be reading a lot of blogposts suggesting that this problem is related to the entity connection string, but this is hardly the case here as the error is sporadic depending on whether you build or rebuild. </p>\n\n<p>To me it seems like a Visual Studio 2012 bug...or RIA Services 1.0 SP2 which was installed together with VS2012.</p>\n\n<p>Any clues?</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":1,"favorite_count":13,"up_vote_count":33,"down_vote_count":0,"view_count":14521,"score":33,"question_id":5340990,"title":"ADO.NET DbContext Generator vs. ADO.NET Poco Entity Generator (ObjectContext)","body":"<p>I am about to start implementing the data access infrastructure of a project that was architected with an approach to DDD (<em>it's my first attempt on DDD, so be gentle ;-)</em> ). </p>\n\n<p>I will be using Entity Framework. Until now, I was looking into the method teached by Julie Lerman on her great book, <a href=\"http://rads.stackoverflow.com/amzn/click/0596807260\" rel=\"nofollow\">Programming Entity Framework</a>, where <strong><em>ADO.NET POCO Entity Generator</em></strong> is used, with some changes to the T4 templates and some more custom code.<br>\nToday I started reading articles on EF4.1 and the <strong><em>ADO.NET DbContext Generator</em></strong>, using <strong><em>Database First</em></strong> approach, and I'm trying to decide with which one should I go.</p>\n\n<p>DbContext and EF4.1's approach on DDD seems to be a nice, cleaner way than POCO Entities, but I'm afraid that it could lead to some issues in the near future, since EF4.1 is still in RC.</p>\n\n<p>From <a href=\"http://blogs.msdn.com/b/adonet/archive/2011/03/15/ef-4-1-release-candidate-available.aspx\" rel=\"nofollow\">ADO.NET team blog</a>, I know that EF4.1 <strong>does not</strong> include:</p>\n\n<ul>\n<li>Enum support</li>\n<li>Spatial data type support</li>\n<li>Stored Procedure support in Code First</li>\n<li>Migration support in Code First</li>\n<li>Customizable conventions in Code First</li>\n</ul>\n\n<p>From my understanding, since I will be using <strong><em>Database First</em></strong> there is a smaller number of features that were not included.</p>\n\n<p>In conclusion, my question is:<br>\n<strong>Can I replace <em>POCO Entities Generator</em> with EF4.1 DbContext Generator?</strong></p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":21,"score":0,"question_id":12779322,"title":"How to map dynamically multiple tables to a entity","body":"<p>All,\nI have a requirement to write a component which retrieves the data and saves the data to the model. So i want to use entity framework. I can create the entities from model but In my model there is a table which contains the table names where the configuration for particular object exists.\nfor eg-\nMy table has data like this-\nType       DefitionTableName\nStudent     StudentDefTable\nCustomer     CustomerDefTable</p>\n\n<p>Here both StudentDefTable and CustomerDefTable have same structure.There can be may definition tables for different types. This data varies for differtn customer DBs.</p>\n\n<p>So how to map these different tables having same structure to same entity in EF? and how to link the changes back to proper table?\nIf EF does not support this any suggestion on other availble ORMs?</p>\n\n<p>[Edit:] Entity Framework will not support my requirement mentioned above. Now exploring NHiberant...If anyone can give that info it will be helpful.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12786236,"title":"Returning an object from a subroutine","body":"<p>I have a routine that returns mostly correct data. I pass it a string Id code, it creates a model, gets data from a database, fills in the model, and then passes the model back. The return model looks correct and has correct data except the List's in the model do not contain any data.</p>\n\n<p>The model looks similar to this one</p>\n\n<pre><code>             public class SubjectDB\n             {\n                public string SubjectId  { get; set; }\n                .\n                .\n                List&lt;AddressDB&gt; Address { get; set; }\n                .\n                .\n                [Key]\n                public int Id { get; set; }\n             }\n             public class DBEntities: DbContent\n             {\n                public DbSet&lt;SubjectDB&gt; SubjectDB { get; set; }\n                public DbSet&lt;AddressDB&gt; AddressDB { get; set; }\n                .\n                .\n             }\n</code></pre>\n\n<p>The subroutine is called using this code</p>\n\n<pre><code>             SubjectDB xsubject = new SubjectDB();\n             xsubject = (SubjectDB)GetNewSubject(model.Subject.Id);\n</code></pre>\n\n<p>The subroutine is</p>\n\n<pre><code>             Public object GetNewSubject( string Id )\n             {\n\n                 SubjectDB subjectdb = new SubjectDB();\n                 DBEntites db = new DBEntities();\n\n                 var subjectxx = db.SubjectDB.First(x =&gt; x.SubjectId == Id);\n                 var addressxx = db.AddressDB.First(x =&gt; x.SubjectId == Id);\n                 .\n                 .\n                 subjectdb.SubjectId = subjectxx.Subjectid;\n                 .\n                 .\n                 List&lt;AddressDB&gt; Address = new List&lt;AddressDB&gt;();\n                 Address.Add(addressxx);\n                 .\n                 .\n                 return(subjectdb);\n              }\n</code></pre>\n\n<p>I can mouse over the subjectdb in the subroutine and see all the data including the data in the List's, but when I mouse over the returned object \"xsubject\", I see all the correct returned data but the List's are empty.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12812920,"title":"Error No. 3034 mapping fragments isssue","body":"<p>I am developing MVC Application with EF 4.1.\nI have used TPH approch to genrate the DB. </p>\n\n<p>I have two entities, 1. company and 2. Lead , Lead is inherited from Company. </p>\n\n<p>please check below image :</p>\n\n<p><img src=\"http://i.stack.imgur.com/4VUOe.jpg\" alt=\"enter image description here\"></p>\n\n<p>Now I have below mappaings...</p>\n\n<p><img src=\"http://i.stack.imgur.com/ojY51.jpg\" alt=\"enter image description here\"></p>\n\n<p>here is edmx file with XML </p>\n\n<pre><code>&lt;EntitySetMapping Name=\"Companies\"&gt;\n            &lt;EntityTypeMapping TypeName=\"IsTypeOf(Model1.Company)\"&gt;\n                &lt;MappingFragment StoreEntitySet=\"Companies\"&gt;\n                    &lt;ScalarProperty Name=\"Id\" ColumnName=\"Id\" /&gt;\n                    &lt;ScalarProperty Name=\"Name\" ColumnName=\"Name\" /&gt;\n          &lt;Condition ColumnName=\"__Disc__\" Value=\"Company\" /&gt;\n                &lt;/MappingFragment&gt;\n            &lt;/EntityTypeMapping&gt;\n            &lt;EntityTypeMapping TypeName=\"Model1.Lead\"&gt;\n                &lt;MappingFragment StoreEntitySet=\"Companies\"&gt;\n    // Gives Error -&gt;   &lt;ScalarProperty Name=\"Id\" ColumnName=\"Id\" /&gt;\n    // Gives Error -&gt;   &lt;ScalarProperty Name=\"Name\" ColumnName=\"Name\" /&gt;\n    // Gives Error -&gt;   &lt;ScalarProperty Name=\"Status\" ColumnName=\"Status\" /&gt;\n                    &lt;Condition ColumnName=\"__Disc__\" Value=\"Lead\" /&gt;\n                &lt;/MappingFragment&gt;\n            &lt;/EntityTypeMapping&gt;\n</code></pre>\n\n<p>Error 3034: Problem in mapping fragments starting at lines 47, 54:An entity is mapped to different rows within the same table. Ensure these two mapping fragments do not map two groups of entities with identical keys to two distinct groups of rows.</p>\n"},{"tags":["c#","asp.net-mvc","visual-studio-2010","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":132,"score":1,"question_id":12807282,"title":"EF 5 Database First using custom validation","body":"<p>In order to experience the new features of Entity Framework I created a new MVC 4 internet application.<br/> I connected it to an existing database and generated the Model classes with the dbContext generator.</p>\n\n<p>By running the application I got some validation errors while editing a form. As example for a DateTime field the system was complaining if the date was inserted as \"12/10/2012\" instead of 2012-10-12 (as in the SQ Server notation). <br/>I tried to find the validation code in the project, but I could not find it anywhere in the generated code.</p>\n\n<p>One of my model classes is the following:</p>\n\n<pre><code>public partial class Artist\n{\n    public Artist()\n    {\n    }\n\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public Nullable&lt;System.DateTime&gt; DateOfBirth { get; set; }\n\n    public virtual Countries Countries { get; set; }\n}\n</code></pre>\n\n<p>How can I customize the validation errors if using the Database first approach? <br/>If I decor the models with my validation attributes, then they would be erased once the model classes are generated again.</p>\n\n<p>Moreover in a \"real world\" project where the use of an existing database is mandatory, what would be the best approach with the development of the model classes? <br/>Extending the classes automatically generated by adding partial classes with the same name?</p>\n\n<p>EDIT (Introduced part of the View):</p>\n\n<pre><code>@using (Html.BeginForm()) {\n@Html.ValidationSummary(false)\n\n&lt;fieldset&gt;\n    &lt;legend&gt;Movie&lt;/legend&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Name)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Name)\n        @Html.ValidationMessageFor(model =&gt; model.Name)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.DateOfBirth)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.DateOfBirth)\n        @Html.ValidationMessageFor(model =&gt; model.DateOfBirth)\n    &lt;/div&gt;\n\n    &lt;p&gt;\n        &lt;input type=\"submit\" value=\"Create\" /&gt;\n    &lt;/p&gt;\n&lt;/fieldset&gt;\n}\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first","dbcontext","objectcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12817420,"title":"When casting DBContext to an ObjectContext none of the entities are available","body":"<p>I have changed an existing project to use EF5 and code first. It is using a repository class which relies on the older ObjectContext. To keep the repository implementation the same I created a property on the DBContext which would return an ObjectContext:</p>\n\n<pre><code>public ObjectContext ObjectContext()\n{\n    return (this as IObjectContextAdapter).ObjectContext;\n}\n</code></pre>\n\n<p>The problem is that after this the entities are not available on the ObjectContext so the following code fails:</p>\n\n<pre><code>string GetSetName&lt;T&gt;() {\n    var entitySetProperty =\n    _context.GetType().GetProperties()\n       .Single(p =&gt; p.PropertyType.IsGenericType &amp;&amp; typeof(IQueryable&lt;&gt;)\n       .MakeGenericType(typeof(T)).IsAssignableFrom(p.PropertyType));\n\n    return entitySetProperty.Name;\n}\n</code></pre>\n\n<p>The original DBContext has all of the entities available before it is cast to an ObjectContext but as the ObjectContext class does not have the properties for my entities, how can I access them?</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","dbcontext"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":115,"score":1,"question_id":12816792,"title":"EF code first: inherited dbcontext creates two databases","body":"<p>I'm trying to create a base dbcontext that contains all the common entities that will always be reused in multiple projects, like pages, users, roles, navigation etc.</p>\n\n<p>In doing so I have a ContextBase class that inherits DbContext and defines all the DbSets that I want. Then I have a Context class that inherits ContextBase where I define project specific DbSets. The classes are defined as follows:</p>\n\n<pre><code>public class ContextBase : DbContext\n{\n    public virtual DbSet&lt;User&gt; Users { get; set; }\n    //more sets\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new UsersConfiguration());\n        //add more configurations\n    }\n}\n\n\npublic class Context : ContextBase\n{\n    public DbSet&lt;Building&gt; Buildings { get; set; }\n    //some more project specific sets\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        base.OnModelCreating(modelBuilder);\n        modelBuilder.Configurations.Add(new BuildingsConfiguration());\n        //add more project specific configs\n    }\n}\n</code></pre>\n\n<p>In my global.asax:</p>\n\n<pre><code>Database.SetInitializer(new MigrateDatabaseToLatestVersion&lt;Context, Configuration&gt;());\n</code></pre>\n\n<p>where Configuration referes to a class inheriting DbMigrationsConfiguration and overriding the Seed method.</p>\n\n<p>The two context classes are defined in the same namespace, but cross assembly (in order that I may update the base project in multiple existing projects without touching the project specific code) - not sure if this is relevant.</p>\n\n<p><strong>MY PROBLEM:</strong>\nWhen running this code, it works fine, but when looking in the Database, it actually creates two different databases!! One containing all the base entity tables and one containing BOTH base and custom tables. CRUD operations are only performed on the custom version (which is obviousely what I want), but why does it create the schema of the other one as well?</p>\n\n<p>Any help is appreciated, thanks!</p>\n"},{"tags":["c#",".net","sql","entity-framework","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":85,"score":2,"question_id":12800524,"title":"Why does ToPagedList take half a minute on an empty IQueryable while the underlying SQL runs in just one second?","body":"<p>I have a piece of Entity-to-SQL code that composes an <code>IQueryable</code>, runs <code>ToPagedList()</code> on it and then passes the result into an MVC view.</p>\n\n<p><code>ToPagedList()</code> fails with a timeout running the SQL query. I extracted the generated SQL query (using <code>IQueryable.ToString()</code>) and ran it on the server - it runs in less than one second and the output is empty (which is correct).</p>\n\n<p>So I have <code>ToPagedList()</code> running the query that would produce an empty result that runs half a minute and times out and I have the underlying SQL that runs in less than one second on the same server.</p>\n\n<p>Since the SQL query output is empty I can't blame the delay on filtering, retrieval or whatever else in the EF.</p>\n\n<p>What can cause a fast SQL query producing an empty output to run extremely slow from inside <code>ToPagedList()</code>?</p>\n\n<p><strong>UPD</strong></p>\n\n<p>This problem seems to have resolved on its own, so it looks like it was some temporary problem between the machine running the code and the SQL Server machine.</p>\n"},{"tags":["entity-framework","sql-server-2012","transactionscope","entity-framework-5","msdtc"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12809958,"title":"EF: How do I call SaveChanges twice inside a transaction?","body":"<p>Using Entity Framework (code first in my case), I have an operation that requires me  to call SaveChanges to update one object in the DB, and then SaveChanges again to update another object. (I need the first SaveChanges to resolve an issue where EF can't figure out which object to update first).</p>\n\n<p>I tried doing:</p>\n\n<pre><code>using (var transaction = new TransactionScope())\n{\n    // Do something\n\n    db.SaveChanges();\n\n    // Do something else\n\n    db.SaveChanges();\n\n    tramsaction.Complete();\n}\n</code></pre>\n\n<p>When I run that, I get an exception at the second <code>SaveChanges</code> call, saying \"the underlying provider failed on open\". The inner exception says that MSDTC is not enabled on my machine.</p>\n\n<p>Now, I've seen posts elsewhere that describe how to enable MSDTC, but it seems that I would also need to enable network access, etc. This sounds like complete overkill here, since there are no other databases involved, let alone other servers. I don't want to do something that's going to make my whole application less secure (or slower).</p>\n\n<p>Surely there must be a more lightweight way of doing this (ideally without MSDTC)?!</p>\n"},{"tags":["sql-server-2008","entity-framework","ado.net","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":134,"score":2,"question_id":12724320,"title":"Forcing code-first to always initialize a non-existent database?","body":"<p>Sometimes, I'll delete my development database and run my EF code-first application.  I'll get the error:</p>\n\n<blockquote>\n  <p>Cannot open database \"AssessmentSystem\" requested by the login. The login failed.\n  Login failed for user 'AssessmentAdmin'.</p>\n</blockquote>\n\n<p>I think this is because the <code>DbContext</code> only runs the DB initialization logic \"once per AppDomain when the context is used for the first time\", as <a href=\"http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm\" rel=\"nofollow\">this page</a> says.  This means I need to recycle the IIS application pool to get EF to recreate my database if I drop it.</p>\n\n<p>Is there any way I can get the DB initialization code to run <em>every time</em> I try to access the database?  So, it will always check to see whether the DB exists and if not, create it instead of trying to open it, even if it's using the same AppDomain that previously accessed the database that I have now dropped?</p>\n\n<p>Note that I would like this initializtion check to be done on <em>every query</em>, so even having it done in <code>Application_Start</code> isn't often enough; ideally, I'd like to be able to load some DB data, delete the DB, then load some DB data and it would recreate the DB without my even having to restart the application (basically I would just have to reload the web page that loads some DB data).</p>\n"},{"tags":["asp.net","entity-framework","asp.net-membership","database-connection","msdtc"],"answer_count":4,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":190,"score":2,"question_id":12409020,"title":"How to share a connection between EF DbContext and AspNet Membership to avoid transactions escalating to DTC","body":"<p>I have an ASP.NET MVC3 application that uses an EF 4.1 DbContext, database-first data layer. The EDMX approach works fine as I tend to make changes to my data model before adapting the application to them. The application works fine with the special EF connection string that includes metadata references.</p>\n\n<p>However, there's one fly in the ointment. The application also uses ASP.NET membership and roles which require a standard connection string. I have several use cases that involve both the membership tables and other (EF managed) tables. As the two use separate connection strings, transactions that involve both need DTS to handle them. I don't want to go that route if I can help it, I'd rather all parts of the application simply use the same connection.</p>\n\n<p>Getting EF to run with a plain connection string however is eluding me. Can anyone tell me how it is done, please?</p>\n"},{"tags":["c#","entity-framework","npgsql","edmgen"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12814916,"title":"EdmGen Npgsql no entity generated for view","body":"<p>I'm trying to generate classes from a PostgreSql database with Npgsql as a provider. I use EdmGen from the command line like this:</p>\n\n<pre><code>EdmGen.exe /mode:FullGeneration /provider:Npgsql /connectionstring:\"Server=MyServer;Port=5432;UserId=postgres;Password=******;Database=MyDb;\" /p:MyProject\n</code></pre>\n\n<p>My problem is, that I created a view in the database and I want code, entity to be generated for that vie too. But the generation fails with the following message:</p>\n\n<pre><code>Exception: The table/view '[TableName]' does not have a primary key defined and no valid primary key could be inferred. This table/view has been excluded. To use the entity, you will need to review your schema, add the correct keys, and uncomment it.\n</code></pre>\n\n<p>I found with the help of Google that PostgreSql does not support primary keys on views.</p>\n\n<p>Have you got any idea how to resolve this on the easiest way? </p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12813157,"title":"Problems with Entity Framework Power Tools in generating view","body":"<p>I've created console application. Then I've performed Install-Package EntityFramework, setted target .net 4.0. </p>\n\n<p>My simple model is</p>\n\n<pre><code>public class Abonent\n    {\n        public Abonent() {}\n        [Key]\n        public int AbonentId { get; set; }\n        public string Name { get; set; }\n    }\n</code></pre>\n\n<p>My dbcontext is (ModelContext.cs)</p>\n\n<pre><code>public class ModelContext : DbContext\n    {\n        public ModelContext():base(){}\n        public DbSet&lt;Abonent&gt; Abonents { get; set; }\n    }\n</code></pre>\n\n<p>Program.cs is</p>\n\n<pre><code>class Program\n    {\n        static void Main(string[] args)\n        {\n\n            Database.DefaultConnectionFactory = new System.Data.Entity.Infrastructure.SqlCeConnectionFactory(\"System.Data.SqlServerCe.4.0\");\n            ModelContext _abonentContext = new ModelContext();\n\n            Abonent abonent=new Abonent();\n            _abonentContext.Abonents.Add(abonent);\n            _abonentContext.SaveChanges();\n        }\n    }\n</code></pre>\n\n<p>It works just fine, but when I do right button click on ModelContext.cs and choose <code>Entity Framework -&gt; Generate View</code> and I get a message box saying \"Exception has been thrown by the target of an invocation\".</p>\n\n<p>What I've done wrong? Is exist alternative for ef power tools? (VS 2010 SP1,Entity Framework Power Tools Beta 2) </p>\n"},{"tags":["c#","entity-framework","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":58,"score":3,"question_id":12811975,"title":"Entity Framework Circular Reference","body":"<p>Trying this question again because my first attempt was barely coherent :p</p>\n\n<p>So I am super confused and using Entity Framework Code First</p>\n\n<p>I have a Forest class.</p>\n\n<p>I have a Tree class.</p>\n\n<p>Each Forest can have many Trees</p>\n\n<p>When I was trying to serialize I was getting circular reference </p>\n\n<pre><code>public class Forest\n{\n\n    public Guid ID { get; set; }  \n    public virtual List&lt;Tree&gt; Trees { get; set; }\n}\npublic class Tree\n{\n    public Guid ID { get; set; }\n    public Guid? ForestId {get;set;}\n\n    [ForeignKey(\"ForestId\")]\n    public virtual Forest Forest {get;set;}\n }\n</code></pre>\n\n<p>Every forest has trees but not every tree is in a forest.  I struggle with either errors of Multiplicity when doing</p>\n\n<pre><code>@(Html.Raw(Json.Encode(Model)))\n</code></pre>\n\n<p>Where the model is a Forest</p>\n\n<p>and if I make <code>ForestId</code> a <code>Guid</code> instead of a <code>Guid?</code> I get Circular Reference errors.</p>\n\n<p>I also tried \nprotected override void </p>\n\n<pre><code>OnModelCreating(System.Data.Entity.ModelConfiguration.ModelBuilder modelBuilder) \n{ \n  modelBuilder.Entity&lt;Forest&gt;() \n  .HasMany(x =&gt; x.Tree) \n  .WithOptional() \n   .HasForeignKey(y =&gt; y.ForestId); \n}\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["asp.net","asp.net-mvc-3","entity-framework","entity-framework-4","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":12811931,"title":"EF Code first : Cannot insert explicit value for identity column in table 'myTable' when IDENTITY_INSERT is set to OFF","body":"<p>Set the primary key to identity in database (SQL Server)</p>\n\n<p>When using EF to insert data I am getting error </p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table 'myTable'\n  when IDENTITY_INSERT is set to OFF</p>\n</blockquote>\n\n<p>with this particular entity, though I am using the same approach with other entities to insert the data and getting no error with them.</p>\n\n<pre><code>   public class MyTable \n    {\n    [Key/*,DatabaseGenerated(DatabaseGeneratedOption.Identity)*/]\n    public int ID{get;set;}\n    public string name {get;set;}\n    public string type {get;set;}\n    public string status {get;set;}\n    public int country {get;set;}\n    public DateTime start_date {get;set;}\n    public DateTime due_date {get;set;}\n    }`\n</code></pre>\n\n<p>Query</p>\n\n<pre><code>    MyTable check= new MyTable();\n            check.name = checkName;\n            check.type = \"DB\";\n            check.status = \"New\";\n            check.country = country;\n            check.start_date = DateTime.Now;\n            check.due_date = dueDate;\n            db.myTables.Add(check);\n            db.SaveChanges();\n</code></pre>\n\n<p><b>Updated </b>:</p>\n\n<p>After uncommenting the above line </p>\n\n<pre><code>(DatabaseGenerated(DatabaseGeneratedOption.Identity)) \n</code></pre>\n\n<p>it's throwing an exception </p>\n\n<blockquote>\n  <p>A dependent property in a ReferentialConstraint is mapped to a\n  store-generated column. Column: 'ID'</p>\n</blockquote>\n"},{"tags":["entity-framework","asp.net-membership"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12811770,"title":"Membership with EF","body":"<p>I am using entity framework for my mvc application,in which i have added membership tables, so that i can use Membership class methods to create users,</p>\n\n<p>my connection string is like</p>\n\n<pre><code>&lt;add name=\"MentorEntities\" connectionString=\"metadata=res://*/Model1.csdl|res://*/Model1.ssdl|res://*/Model1.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=WASIM-LAP;Initial Catalog=Mentor;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>also added in membership provider</p>\n\n<pre><code>&lt;add name=\"AspNetSqlMembershipProvider\" type=\" PortalRepository.Account.AccountRepository\" connectionStringName=\"MentorEntities\"\n         enablePasswordRetrieval=\"false\" enablePasswordReset=\"true\" requiresQuestionAndAnswer=\"false\" requiresUniqueEmail=\"false\"\n         maxInvalidPasswordAttempts=\"5\" minRequiredPasswordLength=\"6\" minRequiredNonalphanumericCharacters=\"0\" passwordAttemptWindow=\"10\"\n         applicationName=\"/\" /&gt;\n</code></pre>\n\n<p>now when i am calling createUser method of membership class i am getting error</p>\n\n<blockquote>\n  <p>An error occurred while attempting to initialize a System.Data.SqlClient.SqlConnection object. The value that was provided for the connection string may be wrong, or it may contain an invalid syntax.\n  Parameter name: connectionString</p>\n</blockquote>\n\n<p>I added one more connection string which is not refrencing from EF like:</p>\n\n<pre><code>&lt;add name=\"MentorEntitiesMembership\" \n     connectionString=\"Data Source=WASIM-LAP;Initial Catalog=Mentor;Integrated Security=True;MultipleActiveResultSets=True;\" \n     providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>and pass its refrence in provider like:</p>\n\n<pre><code>&lt;add name=\"AspNetSqlMembershipProvider\" type=\" PortalRepository.Account.AccountRepository\" connectionStringName=\"MentorEntitiesMembership\"\n         enablePasswordRetrieval=\"false\" enablePasswordReset=\"true\" requiresQuestionAndAnswer=\"false\" requiresUniqueEmail=\"false\"\n         maxInvalidPasswordAttempts=\"5\" minRequiredPasswordLength=\"6\" minRequiredNonalphanumericCharacters=\"0\" passwordAttemptWindow=\"10\"\n         applicationName=\"/\" /&gt;\n</code></pre>\n\n<p>NOW Its working fine</p>\n\n<p>What i found is create seprate Class inheriting from SqlMembership and override membership methods and property to use EF context object and save from EF layer</p>\n\n<p>So which is good approach or is there any other way to do?</p>\n"},{"tags":["entity-framework","data-binding","razor","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":299,"score":2,"question_id":12811479,"title":"ASP.net MVC4 Multiselect ListBox with Many-to-Many relationship","body":"<p>I'm new to ASP.net, MVC4 and EF and having trouble making the leap from relatively simple samples to something (only slightly) more complex.  I have simplified my model for the question here so consider the following.  Forgive me if I have some of the terminology incorrect.</p>\n\n<p>I have an Employee object and a Division object.  An employee can be in many divisions and a division can have many employees. </p>\n\n<pre><code>public class Employee\n{\n    public int EmployeeId { get; set; }\n    public String FirstName { get; set; }\n    public String LastName { get; set; }\n\n    public virtual ICollection&lt;Division&gt; Divisions { get; set; }\n}\n\npublic class Division\n{\n    public int DivisionId { get; set; }\n    public String DivisionName { get; set; }\n\n    public virtual ICollection&lt;Employee&gt; Employees { get; set; }\n}\n</code></pre>\n\n<p>I have these mapped in the context file via the following:</p>\n\n<pre><code>    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n\n        modelBuilder.Entity&lt;Employee&gt;()\n                .HasMany(e =&gt; e.Divisions)\n                .WithMany(d =&gt; d.Employees)\n                .Map(m =&gt;\n                {\n                    m.ToTable(\"EmployeesDivisionsId\");\n                    m.MapLeftKey(\"EmployeeId\");\n                    m.MapRightKey(\"DivisionId\");\n                });      \n    }\n</code></pre>\n\n<p>For my View Controller I have the following.  I have used a ViewBag (what a name) for many to one relationships and they have worked fine, so I'm trying to modify that to work with the many to many here:</p>\n\n<pre><code>    public ActionResult Index()\n    {\n        return View(db.Employees).ToList());\n    }\n\n    //\n    // GET: /Employees/Details/5\n\n    public ActionResult Details(int id = 0)\n    {\n        Employee employee = db.Employees.Find(id);\n        if (employee == null)\n        {\n            return HttpNotFound();\n        }\n        return View(employee);\n    }\n\n    //\n    // GET: /Employees/Create\n\n    public ActionResult Create()\n    {\n        ViewBag.Divisions = new MultiSelectList(db.Divisions, \"DivisionId\", \"DivisionName\");\n\n        return View();\n    }\n\n    //\n    // POST: /Employees/Create\n\n    [HttpPost]\n    public ActionResult Create(Employee employee)\n    {\n        ViewBag.Divisions = new MultiSelectList(db.Divisions, \"DivisionId\", \"DivisionName\");\n\n        if (ModelState.IsValid)\n        {\n            db.Employees.Add(employee);\n            db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n\n        return View(employee);\n    }\n</code></pre>\n\n<p>Finally in the Edit View I have the following code.  Again for a many to one relationship, a simple DropDownList works fine with the ViewBag in the controller, and with this many to many multiselect/ListBox method the 'Divisions' show up in the view, however when the Save button is hit, the validation of '1, 2' is not valid is displayed.</p>\n\n<pre><code>    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Divisions)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.ListBox(\"Divisions\")\n        @Html.ValidationMessageFor(model =&gt; model.Divisions)\n    &lt;/div&gt;\n</code></pre>\n\n<p>So as I understand it, the list of 'Divisions' are being grabbed properly from the database and selected correctly in the view but when saving to the database the association through the mapped relationship isn't being made.</p>\n\n<p>So my questions are:\nHow do I make this work so when I save, the correct 'Divisions' are saved to the Employee?</p>\n\n<p>Also, I've heard people don't like using ViewBags, is there a (better?) alternate way?</p>\n"},{"tags":["database","wcf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12803258,"title":"Load data, WCF services","body":"<p>Help me please!\nI have project on ASP.NET MVC, EF 4.5 and WCF services.\nProblem is that data from database are not loading to View.\nI traced host WCF project with debugger and saw logs in SvcTraceViewer and\nI saw similar errors for entities(which are not loading), but I cant stand what they mean.:</p>\n\n<p>Image with error description.\n<img src=\"http://i.stack.imgur.com/hmy6c.png\" alt=\"My errors\"></p>\n"},{"tags":["c#",".net","wcf","entity-framework","poco"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":2,"view_count":64,"score":-2,"question_id":12810918,"title":"COLLECTION Fixed Size WCF Entity Framework","body":"<p>I have the following problem, my WCF service is pretty simple, send some entities from an entity framework context, which I have disabled the proxy generation and Lazy loading, but what happens is that when I have an entity which I add a reference entity arises me an exception that tells me that the collection has a fixed size. I guess the problem must be in WCF when serializing / deserealizar entity, but I can not think how to solve the problem.</p>\n\n<p>example:</p>\n\n<p>An Office Product has products and has offices, I get the list of available service offices (from entity framework) and then I create a product, but when assigning an office or:</p>\n\n<pre><code>NewProduct.Oficinas.Add(varOficina);\n</code></pre>\n\n<p>raises the exception that tells me that the collection has a fixed size, but does not arise from the collection \"Office\" product of the entity, the entity arising from member Office and \"Products\", that the problem arises in the body that comes from WCF service, so I guess there goes the problem. Hopefully someone has the answer because it has brought me a lot of headaches</p>\n"},{"tags":["xml","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12810244,"title":"What is the simplest approach to creating an XML document from a series of DB tables accessed via EF","body":"<p>What is the simplest approach to creating an XML document from a multiples tables from a database ie: Orders > OrderItems &lt; Products .... may be :</p>\n\n<pre><code>&lt;Order id=\"1\"&gt;\n  &lt;OrderItem id =\"1\"&gt;\n    &lt;Product&gt;Wheel&lt;/Product&gt;\n    &lt;Qty&gt;1&lt;Qty/&gt;\n    &lt;Price&gt;10.00&lt;/Price&gt;\n  &lt;/OrderItem&gt;\n&lt;Order&gt;\n</code></pre>\n\n<p>I need it in XML to transform to XHTML for loading into Word.</p>\n\n<p>I am also using MVC3, EF5.</p>\n\n<p>Thanks</p>\n"},{"tags":["wpf","entity-framework","data-binding","visual-studio-2010","commit"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1052,"score":5,"question_id":2645803,"title":"Force WPF to Commit Changes on Focused Element","body":"<p>I'm working with VS2010, WPF and EF.  I've placed controls on my window by dragging an entity out of the Data Sources toolwindow.  I used the \"details\" setting so my entity is represented by several labels and textboxes.  I've also added a button with the following code:</p>\n\n<pre><code>_context.SaveChanges();\n</code></pre>\n\n<p>When I'm editing data, the changes in whichever textbox has focus are not committed back to the DB.  Everything else commits just fine.  If I shift focus to another element prior to hitting the save button, it commits as well.  I've experienced the same thing with the DataGrid.  </p>\n\n<p>I know I'm missing something simple, but I can figure it out.  Any ideas on what I'm missing?</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","sql","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12809631,"title":"Tweaking the sequence elements of an IQueryable with a Select clause?","body":"<p>I want to do something that feels like it should be really simple, but has turned out to be a real headache.  I'm <code>Select</code>ing from an <code>IQueryable</code> and instead of creating a new object, I want to \"tweak\" the one that I'm projecting.  Here's what I want to be able to do (<code>context</code> is a <code>DbContext</code>, and I'm using a code-first approach):</p>\n\n<pre><code>var eventsToReturn =\n    ((IQueryable&lt;Event&gt;)\n        context.Events\n        .OrderByDescending(evnt =&gt; evnt.TakesPlaceOn)\n        .Skip(startAt)\n        .Take(numberToReturn)\n    )\n    .Select(evnt =&gt;\n        {\n            evnt.UnmappedUsersCount = evnt.Users.Count();\n            return evnt;\n        }\n    )\n    .ToList();\n</code></pre>\n\n<p>This is nice because Entity Framework doesn't have to actually get all the <code>User</code> entities associated with each event, and can use an aggregate <code>COUNT</code> function to simply get the number of users.  However, it doesn't work, because the <code>IQueryable</code> version of <code>Select</code> wants a lambda statement with no method body that can be converted into an expression tree.  So, while the above doesn't work, this does:</p>\n\n<pre><code>.Select(evnt =&gt; evnt)\n</code></pre>\n\n<p>... and so does this:</p>\n\n<pre><code>.Select(evnt =&gt; evnt.Users.Count())\n</code></pre>\n\n<p>I have solved the problem, but my way seems rather long-winded.  Here's my approach:</p>\n\n<pre><code>var eventsToReturnData =\n    ((IQueryable&lt;Event&gt;)\n        context.Events\n        .OrderByDescending(evnt =&gt; evnt.TakesPlaceOn)\n        .Skip(startAt)\n        .Take(numberToReturn)\n    )\n    .Select(evnt =&gt;\n        new {\n            Event = evnt,\n            UnmappedUsersCount = evnt.Users.Count()\n        }\n    )\n    .ToList();\n\nvar eventsToReturn = eventsToReturnData\n    .Select(evntData =&gt; {\n        evntData.Event.UnmappedUsersCount = evntData.UnmappedUsersCount;\n        return evntData.Event;\n    })\n    .ToList();\n</code></pre>\n\n<p>So I'm projecting the main <code>Event</code> object into an anonymous object, as well as the one tiny <code>int</code> that I want to add to it, and then doing a whole new <code>Select</code> on <code>eventsToReturnData</code>, which works this time because <code>eventsToReturnData</code> is an <code>IEnumerable</code> (so the lambda can have a method body), just to tweak the <code>Event</code> object by setting the <code>UnmappedUsersCount</code> integer that I got from the first query.</p>\n\n<p>Is there a simpler or more elegant way to do this?  I want to avoid EF having to retreive all the users for each event, so it's no good just using <code>Event.Users.Count()</code> on what is returned by the <code>IQueryable</code>'s <code>Select</code> method.</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12724733,"title":"Error comes as a {\"Invalid object name 'dbo.TableName'.\"}","body":"<p>I'm using Entity Framework and MVC3,\nI have used Model First approch...\nI have used <em>Company</em> as a Base class and I have inherited the <em>Lead</em> Class from it. </p>\n\n<p>When I run the application its gives an error...</p>\n\n<p>This is Base Class</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\n\n    namespace CRMEntities\n    {\n        public partial class Company\n        {\n            public int Id { get; set; }\n        }\n\n    }\n</code></pre>\n\n<p>This is Lead Class (Child)</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\n\nnamespace CRMEntities\n{\n    public partial class Lead : Company\n    {\n        public Lead()\n        {\n            this.Status = 1;\n            this.IsQualified = false;\n\n        }\n\n        public Nullable&lt;short&gt; Status { get; set; }\n        public Nullable&lt;bool&gt; IsQualified { get; set; }\n\n\n    }\n\n\n}\n</code></pre>\n\n<p>I have added the controller,and in index view I have added this code...</p>\n\n<pre><code>public class Default1Controller : Controller\n    {\n        private CRMWebContainer db = new CRMWebContainer();\n\n        //\n        // GET: /Default1/\n\n        public ViewResult Index()\n        {\n\n            return View(db.Companies.OfType&lt;Lead&gt;().ToList());\n         } \n    }\n</code></pre>\n\n<p>This is DB and Model ...</p>\n\n<p><img src=\"http://i.stack.imgur.com/ZRQP1.jpg\" alt=\"enter image description here\"></p>\n\n<p>Its giving the inner error -</p>\n\n<blockquote>\n  <p>{\"An error occurred while executing the command definition. See the\n  inner exception for details.\"} {\"Invalid object name\n  'dbo.Companies'.\"}</p>\n</blockquote>\n"},{"tags":["c#","entity-framework","ef-code-first","entity-framework-5"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":2,"question_id":12805572,"title":"In EF Code First, can Foo have a collection of Bars and also a \"FavouriteBar\"?","body":"<p>To illustrate my problem, suppose I have a data model where I have a collection of Books, each of which has one or more Drafts, and also a \"current\" Draft.  I'd like my model to look something like this:</p>\n\n<pre><code>class Book\n{\n    public int Id { get; set; }\n\n    public string Title { get; set; }\n\n    public virtual ICollection&lt;Draft&gt; Drafts { get; set; }\n\n    public virtual Draft CurrentDraft { get; set; }\n}\n\nclass Draft\n{\n    public int Id { get; set; }\n\n    public virtual int BookId { get; set; }\n    public virtual Book Book { get; set; }\n\n    public string Description { get; set; }\n}\n</code></pre>\n\n<p>I have a DbContext that looks like this:</p>\n\n<pre><code>class TestDbContext : DbContext\n{\n    public DbSet&lt;Book&gt; Books { get; set; }\n    public DbSet&lt;Draft&gt; Drafts { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Conventions.Remove&lt;OneToManyCascadeDeleteConvention&gt;();\n        modelBuilder.Conventions.Remove&lt;ManyToManyCascadeDeleteConvention&gt;();\n\n        base.OnModelCreating(modelBuilder);\n    }\n}\n</code></pre>\n\n<p>...and a simple program like this:</p>\n\n<pre><code>static void Main(string[] args)\n{\n    Database.SetInitializer&lt;TestDbContext&gt;(new DropCreateDatabaseAlways&lt;TestDbContext&gt;());\n\n    using (var db = new TestDbContext())\n    {\n        var book = new Book() { Title = \"War and Peace\", Drafts = new List&lt;Draft&gt;() };\n\n\n        var draft1 = new Draft() { Book = book, Description = \"First Draft\" };\n\n        book.Drafts.Add(draft1);\n\n\n        var draft2 = new Draft() { Book = book, Description = \"Second Draft\" };\n\n        book.Drafts.Add(draft2);\n\n\n        book.CurrentDraft = draft2;\n\n\n        db.Books.Add(book);\n\n        db.SaveChanges();\n\n\n        foreach (var b in db.Books)\n        {\n            Console.WriteLine(\"Book {0}: {1}\", b.Id, b.Title);\n\n            foreach (var d in book.Drafts)\n                Console.WriteLine(\"\\tDraft ID {0}: {1} from Book ID {2}\", d.Id, d.Description, d.BookId);\n\n            Console.WriteLine(\"Current draft has ID {0}\", b.CurrentDraft.Id);\n        }\n\n        Console.ReadKey();\n    }\n}\n</code></pre>\n\n<p>When the DB is created by EF, it looks like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/oB7Uy.png\" alt=\"database schema\"></p>\n\n<p>[I'm not wild about the extra Book_Id column, but I could live with it if it worked.]</p>\n\n<p>Sadly, when I run the test program, it fails at the <code>SaveChanges</code> call, with an exception:</p>\n\n<blockquote>\n  <p>An error occurred while saving entities that do not expose foreign key\n  properties for their relationships. The EntityEntries property will\n  return null because a single entity cannot be identified as the source\n  of the exception. Handling of exceptions while saving can be made\n  easier by exposing foreign key properties in your entity types. See\n  the InnerException for details.</p>\n</blockquote>\n\n<p>I've tried messing about with the fluent API in my OnModelCreating, but when I try to configure it that way it gets confused by the fact that there are two FK relationships between Books and Drafts. I'm not familiar enough with the fluent stuff (or EF generally) to know how to do it properly.</p>\n\n<p>Is this even possible in EF code first?</p>\n"},{"tags":["entity-framework","asp.net-3.5"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":936,"score":2,"question_id":2361658,"title":"Unknown server tag 'asp:EntityDataSource'","body":"<p>I uploaded my files to my remote server having support for ASP.Net 3.5. Website is developed using ASP.Net 3.5 and Entity Framework. Also i copied the dlls to bin folder. But i am getting the following error</p>\n\n<p>arser Error Description: An error occurred during the parsing of a resource required to service this request. Please review the following specific parse error details and modify your source file appropriately.</p>\n\n<p>Parser Error Message: Unknown server tag 'asp:EntityDataSource'.</p>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":12805984,"title":"EF defer setting property until insert","body":"<pre><code>public class User {\n    int Id { set; get; } // autogenerated on insert\n    public string Username { set; get; }\n}\n</code></pre>\n\n<p>Then some where in my code I have the follow:</p>\n\n<pre><code>var user = new User();\nuser.Username = string.Format(\"user{0}\", user.Id);\ndbContext.User.Add(user);\ndbContext.SaveChanges();\nDebug.WriteLine(user.Username); // outputs \"User0\" when the Id is ..not 0\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12805287,"title":"Is it possible to use OfType in a linq where?","body":"<p>I have a table called source that has multiple derived tables such as account, etc. I have a second table that has a navigation property to that table called Source.  </p>\n\n<p>What I'd like to do is filter the results of ActionItemState by the type of the Source then filter based on a property of that inherited table. </p>\n\n<p>Here is an example of what I'm trying to do.  I get \". LINQ to Entities only supports casting EDM primitive or enumeration types\" when I try the code below.  Does anyone know of a way to use OfType or something similar?</p>\n\n<pre><code> query = from a in _actionItemRepository.GetTable()\n         where a.ActionItemStates.Any(ais =&gt; ais.Source is AccountSource &amp;&amp; ((AccountSource)ais.Source).AccountId == id)\n         select a;\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/lpnCp.png\" alt=\"enter image description here\"></p>\n"},{"tags":["entity-framework","domain-driven-design","dto","aggregates"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12791795,"title":"Considering the following architectural changes and need some advice (Domain Entities, DTO, Aggregates)","body":"<p>about a year ago I set set up a solution consisting of an ASP.Net MVC 3 (now) presentation layer, application layer, domain layer and infrastructure layer (crosscutting stuff and data).  I decided to keep the domain model in a separate project from the domain logic and use a relaxed approach to the presentation layer by passing the domain entities instead of DTO's since we really only have 1 front end right now.  </p>\n\n<p>We are going to be servicing a distributed layer soon, in addition to our main website and I will use DTO's there, but I am considering using DTO's in the main website also.  I am also wondering if I should bother to break out the framework code in the domain layer (IRepository, IUnitOfWork, Entity/Value object supertypes etc).  Well here, let me list out the questions I need feedback on:</p>\n\n<p>1) I was pretty diligent about not having an anemic domain model and also watched out for behavior that was specific to the presentation concerns.  Most of the business calculations that are needed are on the domain entities, is it ok for the presentation layer to call this behavior directly or should it instead call an application service that then calls the domain entities?  This would suggest to me that there is no reason to have the presentation layer know about the domain entities and instead could use DTO's.  Alternatively, I could have the DTO's expose these behaviors, but then I feel like I am robbing the domain entities.  So I guess that is 3 options (Rich domain objects called directly, service layer or dto with behavior) which is best?</p>\n\n<p>2) Right now I have a domain project, which has domain services, specifications and logic and is orchestrated by the application layer and separate project for the domain model (used by presentation layer and application layer).  I also have framework interfaces for generic repository and unit of work pattern here.  Should I break the framework stuff out into a separate project and combine the rest into one project?</p>\n\n<p>3) I want to reorganize my domain layer into aggregates, right now all of the domain model is organized by modules, basically all the types for each module are in one namespace.  Would it be better to organize the entities, value objects, services and other stuff by the aggregates?</p>\n\n<p>4) Should I use the Separated Interface pattern for infrastructure services that are basically .net framework helper library types?  For example configuration objects or validation runners?  What is the benefit there in doing so?</p>\n\n<p>5) Lastly, not many examples I have seen have used interfaces for domain entities.  Almost every object I have I prefer to pass around interfaces for dependency reasons and it makes testing much easier.  Is it valid to use interfaces instead of concretes?  I should mention that we use EF 4.3.1 (soon to upgrade to latest version) and I seem to remember that EF had a problem with using interfaces or something.  Should I be exposing interfaces instead of the domain entities?</p>\n\n<p>Thank you very much in advance.</p>\n\n<p>Project Structure:</p>\n\n<pre>\nPresentation.Web\n     |       |\n     |    Application\n     |     |      |\nDomain.Model - Domain\n\n(Infrastructure.Data, Infrastructure.Core, Infrastructure.Security)\n</pre>\n\n<p>Explanation:\nPresentation.Web (MVC3 Web Project)</p>\n\n<p>Application \n -- Service Layer that orchestrates the domain layer and responds to requests from the presentation layer (get this update that).  This is organized by module, for example if I had a customer module I would have Application.Customer and in that would be all of the application services</p>\n\n<p>Domain\n -- Contains domain services, specifications, calculations and other domain logic that is not exposed as behavior on domain entities.  For example a calculation that involves several domain entities exposed as a domain service for the application layer to call.\n -- Also contains framework code for a specification framework and the main interfaces for a generic repository and unit of work pattern.</p>\n\n<p>Domain.Model\n -- Contains the domain entities and enumerations.  Organized by module.  For example, if I might have a customer module which has a customer entity, customerorder entity etc. This is broken out away from the domain project so that the objects can be used by the application and presenation layer.</p>\n\n<p>Infrastructure.Security\n -- Security infrastructure for authentication and authorization</p>\n\n<p>Infrastructure.Core\n -- Cross-cutting stuff used by multiple layers (validators, logging, configuration, extensions, IoC, email etc..).  Most of the projects depend on interfaces in this project (except domain.model) for infrastructure services.</p>\n\n<p>Infrastructure.Data\n -- Repository Implementations via LINQ and EF 4.3.1, mapping layer, Unit of Work implementation.  Interfaces are in Domain project (separated interfaces pattern)</p>\n"},{"tags":["entity-framework","entity-framework-4.1","ef-code-first","poco"],"answer_count":7,"favorite_count":58,"up_vote_count":120,"down_vote_count":0,"view_count":28453,"score":120,"question_id":5446316,"title":"EF 4.1 Code-first vs Model/Database-first","body":"<p><strong>What are the pros &amp; cons of using Entity Framework 4.1 Code-first over Model/Database-first with EDMX diagram?</strong></p>\n\n<p>I'm trying to fully understand all the approaches to building data access layer using EF 4.1. I'm using Repository pattern and IoC.</p>\n\n<p>I know I can use code-first approach: define my entities and context by hand and use ModelBuilder to fine-tune the schema.</p>\n\n<p>I can also create an EDMX diagram and choose a code generation step that uses T4 templates to generate the same POCO classes. </p>\n\n<p>In both cases I end up with POCO object which are ORM agnostic and context that derives from <code>DbContext</code>.</p>\n\n<p>Database-first seems to be most appealing since I can design database in Enterprise Manager, quickly synch the model and fine-tune it using the designer. </p>\n\n<p>So what is the difference between those two approaches? Is it just about the preference VS2010 vs Enterprise Manager?</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12804760,"title":"Two tables related in one view","body":"<p>This is in reference to question:\n<a href=\"http://stackoverflow.com/questions/11271249/multiple-checkboxes-to-select-and-save-values-in-database-table-c-sharp-mvc3\">Multiple Checkboxes to select and save values in database table C# MVC3</a></p>\n\n<p>I have taken the answer and used this - it works well! I have also created another viewModel that uses this same script. It works but not the way I need it too. </p>\n\n<p>I need to do everything that the view model does plus show a question that the checkboxes relate to. I have a table of questions and a table of answers. The answers get updated, the questions are just for show. The tables are related by <code>MainQuestionID</code>. I currently use the <code>MainQuestion</code> model to call the list of questions executed by a link click for that subcategory. So the questions return to list where the subcategory is = to. I would like to implement this but instead of using the <code>MainQuestions</code> model to display - use the viewModel and combine the list to the view. \nI have tried using <code>ICollection</code> in the view but it will not make question available for the view. </p>\n\n<p>My <code>MainAnswers</code> table that needs updated by the checkboxes gets populated with the <code>MainQuestionID</code> of all the questions via a stored procedure. </p>\n\n<p>Could someone give an example of how to do this it would be much appreciated. </p>\n\n<p>thanks </p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":3227,"score":10,"question_id":3061313,"title":"Entity framework MappingException: The type 'XXX has been mapped more than once","body":"<p>I'm using Entity framework in web application. ObjectContext is created per request (using HttpContext), hereby code:</p>\n\n<pre><code>string ocKey = \"ocm_\" + HttpContext.Current.GetHashCode().ToString();\nif (!HttpContext.Current.Items.Contains(ocKey))\n{\n    HttpContext.Current.Items.Add(ocKey, new ElevationEntityModel(EFConnectionString));\n}\n_eem = HttpContext.Current.Items[ocKey] as ElevationEntityModel;\n</code></pre>\n\n<p>Not every time, but sometimes I have this exception:</p>\n\n<blockquote>\n  <p>System.Data.MappingException was unhandled by user code   Message=The\n  type 'XXX' has been mapped more than once.   Source=System.Data.Entity</p>\n</blockquote>\n\n<p>I'm absolutely confused and I don't have any idea what can caused this problem.</p>\n\n<p>Can anybody help me?</p>\n"},{"tags":["entity-framework","ef-code-first","visual-studio-2012","webdeploy","code-first-migrations"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12804371,"title":"How to Debug Entity Framework 5.0 Code-First Data Migrations with Web Deploy","body":"<p>I have a VS2012 MVC3 project that uses Entity Framework 5.0 Code First and deploys to staging and  production servers using Web Deploy. It uses code first data migrations to synchronize the databases with the model.</p>\n\n<p>Until recently, everything was working correctly and changes to the model were correctly reflected in the database schemas.</p>\n\n<p>However, after making some extensive code modifications, updates to the model classes are no longer being propagated to the staging server, with the result that it throws the following exception:</p>\n\n<pre><code>The model backing the 'xxxxx' context has changed since the database was created. Consider using Code First Migrations to update the database\n</code></pre>\n\n<p>Obviously, I haven't tried this against the production server, but I assume the result will be the same. However, everything still works fine locally, when invoked using <code>update-database</code> in Package Manager Console, so I assume the problem is occurring somewhere in the Web Deploy pipeline.</p>\n\n<p>In order to debug this, I am looking for some suggestions about where to look for clues. For example, is there something I can do during or after the VS2012 Publish process, to determine whether it actually sent the schema updates to IIS? And is there anything I can do on the server to determine whether the server itself has a problem processing the updates sent to it?</p>\n\n<p>Thanks, in advance, for your ideas.</p>\n\n<p>Tim.</p>\n"},{"tags":["asp.net-mvc","entity-framework","unit-of-work","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":12803957,"title":"Entity Framework Unit of Work pattern object lifetime","body":"<p>I'm using MVC + Entity Framework 5 and currently looking at the <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application\" rel=\"nofollow\">Unit of Work pattern</a>. In a controller class I see the following code:</p>\n\n<pre><code>private UnitOfWork unitOfWork = new UnitOfWork();\n</code></pre>\n\n<p>Does this mean that for every controller the <code>UnitOfWork</code> class is created, resulting in a database connection per <code>UnitOfWork</code> instance? Or do all <code>DbContext</code> instances (in this article <code>SchoolContext</code> instances which are created in <code>UnitOfWork</code>) share the same connection?</p>\n\n<p>My second question: would it improve the performance of the application when only one <code>UnitOfWork</code> instance is created which is stored in the <code>HttpContext</code>, or is there a better approach?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12790791,"title":"Differences between Entity Framework SSDL versions","body":"<p>According to the following URL, there are three versions of the Entity Framework Storage Schema Definition Language:</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/data/jj652016.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/data/jj652016.aspx</a></p>\n\n<p>I am developing a tool that should support all of them (including the legacy versions), but unfortunately I was not able find a document that describes the differences between them.</p>\n\n<p>Does anyone know such document or able to describe the differences?</p>\n"},{"tags":[".net","entity-framework","object"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12803074,"title":"Using EF purely as an object graph manager-tracker","body":"<p>I'm building a complex client application that should obtain it's data from the application server over the wire (WCF, REST, SOAP, whatever).</p>\n\n<p>What I need is an object graph manager that should be able to track changes to DTOs and their relationships in the client and which should optionally be able to do ad-hoc data queries. Entity Framework already does all this, but unfortunately it needs a DB connection. I'm wondering is there a way to use EF for this without the database (on the client).</p>\n\n<p>As far as I know entity framework typically hits the database in 3 cases:</p>\n\n<ol>\n<li>When SaveChanges is called on the ObjectContext,</li>\n<li>When an entity is lazy loaded,</li>\n<li>When an ad-hoc LINQ or EFQL is called.</li>\n</ol>\n\n<p>For #1, instead of using SaveChanges I could iterate over ObjectStateTracker for changed entities and call appropriate service methods instead (UpdatePerson, DeletePhone, ...)</p>\n\n<p>For #2 I can simply disable lazy loading, which is a feature you typically don't have anyway when you use DTOs, and use for example named fetch plans when retrieving.</p>\n\n<p>For #3 I could make use of .ToTraceString() or other tracing injection, which gives me raw SQL which I can send over the wire. The SQL string would surely be DB provider dependent, but that's a deployment concern. My reasoning is that if I need ad-hoc querying over the wire I also need some language for defining the query, so then why not use SQL directly, after all it is a query language, and a far better one than anything I could possibly write. I could then write my on IQueryProvider which in it's Execute just calls .ToTraceString on the original Linq query, sends the request to some PersonQuery service method and returns the result. I suspect this would be the most challenging part, but even if it doesn't fly it's not that important, it's the graph tracking that I'm after and ad-hoc queries would only be a plus.</p>\n\n<p>If it would work it would enable me to have free, state-of-the-art object graph tracking, the use of tools like EDM designer for designing and visualizing my DTOs, and the service interface would be usable to other apps as well, since it would expose universal operations, like <code>UpdatePerson(Person p)</code>, etc. It would also <em>force</em> me to write entity-centric service operations which should ease overall maintainability of the project (focus on one entity at a time).</p>\n\n<p>Before diving head-first into all this I thought I should ask here, does this even looks feasible? Is there any other object-graph-tracing tool/approach that would get me there without faking it with EF? </p>\n"},{"tags":["c#","entity-framework","linq-to-sql","entity-framework-4","linq-to-entities"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":12802226,"title":"EntityFramework : does IQueryable or IEnumerable get all the results at the first place?","body":"<p>I learned that IQueryable or IEnumerable datatypes do not return the results at the first place and only return them when needed. However when I open that object in the watch inspector I saw all the objects are there.</p>\n\n<p><strong>Is there anything wrong in my code or it just showing because I had call it on the watch ?</strong></p>\n\n<p>[When I view the <strong>pendings</strong> object in the watch dialogbox I saw all the list items but it shouldn't load at the first place. Is there anything wrong in my approaching or is it just showing because I had call it on the watch.]</p>\n\n<pre><code> public IQueryable&lt;PurchasePendingView&gt; PurchasePendings() {\n            var pendings = db.PurchasePendingViews\n                             .Where(m =&gt; m.AccountStatusID != StructAccountStatus.Succeed); // when I view it in the watch dialougebox I saw all the list items but it shouldn't load at the first place. Is there anything wrong in my approaching or is it just showing because I had call it on the watch. \n            if (ApplicationEnvironment.DEBUGGING) {\n                return pendings;\n            } else if (IsMobileAccount()) {\n                var showroom = db.ShowRooms.FirstOrDefault(m=&gt; m.MemberID == employee.MemberID);\n                if (showroom != null) {\n                    return pendings.Where(m =&gt; m.ShowRoomID == showroom.ShowRoomID);\n                } else {\n                    return pendings.Where(m =&gt; m.CountryDivisionID == employee.CountryDivisionID);\n                }\n            } else { \n                //normal salary employee can see every detail\n                return pendings;\n            }\n        }\n</code></pre>\n\n<p><strong>Note: Currently my lazy loading is off.</strong> </p>\n"},{"tags":["mysql","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12750624,"title":"Entity Framwork Linq query returning incorrect value for mysql database","body":"<p>I have a Query:</p>\n\n<pre><code>    var cams = (from c in db.cameras\n                        join s in db.camera_sites on c.camera_site_id equals s.id\n                        join o in db.servers on s.server_id equals o.id\n                        where (c.enabled == \"yes\"\n                        &amp;&amp; s.enabled == \"yes\"\n                        &amp;&amp; o.enabled == \"yes\" \n                        &amp;&amp; o.type == \"hosted\"\n                        &amp;&amp; o.server_method == \"webservices\"\n                        &amp;&amp; c.account_id == accountId)\n                        select new EventCamera_Named { Camera = c, SiteName = s.name, ServerName = o.name }).ToList();\n</code></pre>\n\n<p>The problem is the SiteName that is selected is the same as Camera.name</p>\n\n<p>The sql that is generated is:</p>\n\n<pre><code>    SELECT\n    `Filter1`.`id`, \n    `Filter1`.`account_id`, \n    `Filter1`.`camera_site_id`, \n    `Filter1`.`enabled`, \n    `Filter1`.`name`, \n    ...,\n    `Filter1`.`name` AS `name1`, \n    `Extent3`.`name` AS `name2`\n\n    FROM (SELECT\n    `Extent1`.`id`, \n    `Extent1`.`account_id`, \n    `Extent1`.`camera_site_id`, \n    `Extent1`.`enabled`, \n    `Extent1`.`name`, \n    ..., \n    `Extent2`.`id` AS `id1`, \n    `Extent2`.`account_id` AS `account_id1`, \n    `Extent2`.`server_id`, \n    ...\n    FROM `cameras` AS `Extent1` INNER JOIN `camera_sites` AS `Extent2` ON `Extent1`.`camera_site_id` = `Extent2`.`id`\n    WHERE ('yes' = `Extent1`.`enabled`) AND ('yes' = `Extent2`.`enabled`)) AS `Filter1` INNER JOIN `servers` AS `Extent3` ON `Filter1`.`server_id` = `Extent3`.`id`\n    WHERE ((('yes' = `Extent3`.`enabled`) AND ('hosted' = `Extent3`.`type`)) AND ('webservices' = `Extent3`.`server_method`)) AND (`Filter1`.`account_id` = 39884476)\n</code></pre>\n\n<p>How can I rewrite my query return the correct values and what is causing it to get confused?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12801488,"title":"Populating a DTO class List<> with ENtity Framework query","body":"<p>Is It possible to populate a List from within a EF query? My DTO is as follows:</p>\n\n<pre><code>public DTO()\n{\n  public string ClientName { get; set;}\n  public List&lt;string&gt; RelatedCodes { get; set;}\n}\n</code></pre>\n\n<p>My method to populate DTO = </p>\n\n<pre><code>Public DTO MyResult(string ClientCode)\n{\n   return (from o in repository.RelatedClient \n           where o.LeadCode == ClientCode \n           select new DTO { ClientName = o.ClientName, RelatedCodes = o.RelatedCodes.ToList()});\n}\n</code></pre>\n\n<p>I know I shouldn't be adding the ToList() within the query or if I can I am doing it very wrong. Can anyone advise how this is done. My DTO is cut down for this example but I want to have lots of single properties and a List&lt;> (or several Lists) in a DTO with one Entity query if possible?</p>\n\n<p>So following answer below  I presume there isnt a way to query this direct. My original option would have been:</p>\n\n<pre><code>Public DTO MyResult(string ClientCode)\n{\n         var temp = (from o in repositry.RelatedCode Where o.LeadCode == ClientCode select o).ToList();\n\n          DTO dto = (from o in repository.LeadClient Where o.LeadCode == ClientCode Select o.ClientName).Firstordefault();\n\n         foreach(string rc in temp)\n            {    dto.RelatedCode.Add(rc);}  \n         return dto;\n\n  }\n</code></pre>\n\n<p>I am happy with this but would be grateful if someone could advise if this is the correct way to deal without something like automapper. I am trying to learn Entity Framework and want to check I am not missing some built in fucntionality.</p>\n"},{"tags":[".net","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12796700,"title":"Select required include tables in Entity Framework","body":"<p>I am working with EF on a normalised database.</p>\n\n<p>For my Offers entity I have the following table structure:</p>\n\n<h2>Offers</h2>\n\n<p>plus either:</p>\n\n<h2>PostType</h2>\n\n<p>Offers_SitePost or Offers_CommunityPost</p>\n\n<p>plus either:</p>\n\n<h2>OfferType</h2>\n\n<p>Offers_VoucherCode or Offers_Deal or Offers_Sale</p>\n\n<p>So a complete offer will be made up of a definite entry in Offers plus an entry in one of the PostType tables and an entry in one of the OfferType tables.</p>\n\n<p>I know from the offers table, which of the other tables should contain data. I'm using properties like IsSitePost to do this.</p>\n\n<p>I'm trying to work out the best way of getting just the necessary data, for both a single offer and a list of offers. Obviously I can include all tables but I doubt this will work out to be the most efficient.</p>\n\n<p>Here's the code I'm working on for a single offer:</p>\n\n<pre><code>    public static Offer GetById2(int ID)\n    {\n        ID.ThrowDefault(\"ID\");\n\n        var r = new CrudRepo&lt;Offer&gt;(Local.Items.Uow.Context);\n\n        var offer = r.Find(o =&gt; o.OfferId == ID);\n\n        // if is site post Include(\"SiteOffers\")\n        // else is community post Include(\"CommunityOffers\") etc\n\n        return offer.SingleOrDefault();\n    }\n</code></pre>\n\n<p>Can anyone offer advice as to the best way of achieving this?</p>\n"},{"tags":["entity-framework","task-parallel-library","async-await"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12801008,"title":"entity framework cancel long running query","body":"<p>I am new to the TPL. I am using the TPL to make some async calls to the database. Below the GetDocumentAsync method is called multiple times and do a good job at offloading the task on a different thread to keep the UI thread responsive. </p>\n\n<p>There are two objectives here: 1) Keep the UI Thread Responsive 2) Give the user the ability to abort the request. </p>\n\n<p>I have managed to abort the request however i am unable to abort the request that Entity framework has already put to the database and the query is running at the db level.. or perhaps it has not even started. </p>\n\n<p>Therefore the GetDocuments method still returns the documents on the canceled tasks. </p>\n\n<p>Is there a away i can abort the request from the EF?? Can i do anything better in my implementation ?? </p>\n\n<pre><code>    Entities _context = new Entities();\n\n    CancellationTokenSource _tokenSource = new CancellationTokenSource();\n\n    public async void GetDocumentsAsync(string userName)\n    {\n        IList&lt;Document&gt; results;\n        try\n        {\n            results = await \n            Task&lt;List&lt;Document&gt;&gt;.Factory.StartNew(() =&gt;\n            {\n                _tokenSource.Token.ThrowIfCancellationRequested();\n                return GetDocuments(userName);\n            }, _tokenSource);\n\n        }\n        catch (OperationCanceledException ex)\n        {\n            Debug.WriteLine(string.Format(\"Task canceled for user {0} on thread\", userName ));\n        }\n\n        if(!_tokenSource.IsCancellationRequested)\n        {\n            // results is used to update the UI \n        }\n    }\n\n    public void Abort()\n    {\n        _tokenSource.Cancel();\n    }\n\n    public List&lt;Document&gt; GetDocuments(string userName)\n    {\n        //I am using the connected model and need to use the Context for change tracking and other goodies..\n        var query = from c in _context.Documents\n                    where c.CreatedBy == userName\n                    select c;\n\n        query = query.Take(50); // I want to be able to cancel this query. Can this be done ???\n\n        return query.ToList();\n    }\n</code></pre>\n"},{"tags":["vb.net","entity-framework","fluent-interface"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12765542,"title":"Cannot define composite PK with Fluent API in VB.NET","body":"<p>I am trying to define a composite PK for a class where one of the columns is a FK to another table. The code compiles without any errors but when I try to migrate the changes I get the following error</p>\n\n<pre><code>PM&gt; Update-Database -Force -TargetMigration:0\nSpecify the '-Verbose' flag to view the SQL statements being applied to the target database.\nSystem.InvalidOperationException: The properties expression 'x =&gt; new VB$AnonymousType_0`2(RtepNumber = x.RtepNumber, ContractId = x.Contract.ContractId)' is not valid. The expression should represent a property: C#: 't =&gt; t.MyProperty'  VB.Net: 'Function(t) t.MyProperty'. When specifying multiple properties use an anonymous type: C#: 't =&gt; new { t.MyProperty1, t.MyProperty2 }'  VB.Net: 'Function(t) New With { t.MyProperty1, t.MyProperty2 }'.\n\nThe properties expression 'x =&gt; new VB$AnonymousType_0`2(RtepNumber = x.RtepNumber, ContractId = x.Contract.ContractId)' is not valid. The expression should represent a property: C#: 't =&gt; t.MyProperty'  VB.Net: 'Function(t) t.MyProperty'. When specifying multiple properties use an anonymous type: C#: 't =&gt; new { t.MyProperty1, t.MyProperty2 }'  VB.Net: 'Function(t) New With { t.MyProperty1, t.MyProperty2 }'.\n</code></pre>\n\n<p>However, the that is supposedly causing the exception does seem to be in the syntax that is requested.</p>\n\n<p>Given the following classes</p>\n\n<pre><code>Public Class ParentClass\n   Public Property ParentClassId as String\n\n   Public Property Title As String\n\n   Public Property ChildClasses As ICollection(Of ChildClass)\nEnd Class\n\nPublic Class ChildClass      \n   Public Property ParentClass As ParentClass\n\n   Public Property ChildClassId As String\n\n   Public Property Title As String\nEnd Class\n</code></pre>\n\n<p>And the following Fluent API code</p>\n\n<pre><code>Protected Overrides Sub OnModelCreating(ByVal modelBuilder As System.Data.Entity.DbModelBuilder)\n   MyBase.OnModelCreating(modelBuilder)\n\n   modelBuilder.Entity(Of Models.ChildClass).HasRequired(Function(x) x.ParentClass).WithMany(Function(x) x.ChildClasses).Map(Function(x) x.MapKey(\"ContractId\"))\n\n   modelBuilder.Entity(Of Models.ChildClass).HasKey(Function(x) New With {x.ParentClass.ParentClassId, x.ChildClassId})\nEnd Sub\n</code></pre>\n\n<p>The equivalent SQL code would be</p>\n\n<pre><code>CREATE TABLE [dbo].[ParentClass](\n    [ParentClassId] [nvarchar](10) NOT NULL,\n    [Title] [nvarchar](25) NOT NULL,\n CONSTRAINT [PK_ParentClass] PRIMARY KEY CLUSTERED \n(\n    [ParentClassId] ASC\n)\n)\nGO\n\nCREATE TABLE [dbo].[ChildClass](\n    [ParentClassId] [nvarchar](10) NOT NULL,\n    [ChildClassId] [nvarchar](10) NOT NULL,\n    [Title] [nvarchar](25) NOT NULL,\n CONSTRAINT [PK_ChildClass] PRIMARY KEY CLUSTERED \n(\n    [ParentClassId] ASC,\n    [ChildClassId] ASC\n)\n)\nGO\n\nALTER TABLE [dbo].[ChildClass]  WITH CHECK ADD  CONSTRAINT [FK_ChildClass_ParentClass] FOREIGN     KEY([ParentClassId])\nREFERENCES [dbo].[ParentClass] ([ParentClassId])\nGO\n\nALTER TABLE [dbo].[ChildClass] CHECK CONSTRAINT [FK_ChildClass_ParentClass]\nGO\n</code></pre>\n\n<p>Thank you for any help you can provide.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>After more research (i.e. experimenting) the problem seems to stem from the use of the navigation property in the PK definition. So changing the code to look like</p>\n\n<pre><code>Public Class ChildClass      \n   Public Property ParentClassId As String\n\n   Public Property ChildClassId As String\n\n   Public Property Title As String\nEnd Class\n\nProtected Overrides Sub OnModelCreating(ByVal modelBuilder As System.Data.Entity.DbModelBuilder)\n   MyBase.OnModelCreating(modelBuilder)\n\n   modelBuilder.Entity(Of Models.ChildClass).HasKey(Function(x) New With {x.ParentClassId, x.ChildClassId})\nEnd Sub\n</code></pre>\n\n<p>clears the Exception but, of course, I now lost my ParentClass navigation property in ChildClass.</p>\n\n<p>Still perplexed.</p>\n"},{"tags":["c#",".net","sql","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":144,"score":2,"question_id":12799544,"title":"Why does Entity Framework generate slow overengineered SQL?","body":"<p>I have this code:</p>\n\n<pre><code>DbSet&lt;TableName&gt; table = ...// stored reference\n\nvar items = from n in table where\n            n.Name.ToUpper().Contains(searchString.ToUpper().Trim())\n            select n;\nWriteToLog( items.ToString() );\n</code></pre>\n\n<p>The last line outputs the generated SQL. Here's what I get:</p>\n\n<pre><code>SELECT \n    [Extent1].[Name] AS [Name],\n    // all the other columns follow\nFROM (SELECT \n  [TableName].[Name] AS [Name],\n  // all the other columns follow\nFROM [dbo].[TableName] AS [TableName]) AS [Extent1]\nWHERE ( CAST(CHARINDEX(LTRIM(RTRIM(UPPER(@p__linq__0))), UPPER([Extent1].[Name])) AS int)) &gt; 0\n</code></pre>\n\n<p>You see, there's <code>SELECT</code>-from-<code>SELECT</code> although it's completely redundant - one <code>SELECT</code> would be just enough. The code using EF runs longer than half a minute and time out on that query although the table is rather small.</p>\n\n<p>Why is this overengineered SQL query generated and how do I make EF generate a better query?</p>\n"},{"tags":["linq","entity-framework",".net-3.5","linq-to-entities"],"answer_count":6,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":11896,"score":5,"question_id":690248,"title":"Updating your edmx to reflect changes made in your db (.net linq-to-entities)","body":"<ul>\n<li>So I have my edmx made.  </li>\n<li>Then I change my database a little bit, changing a column to from being a NOT NULL to allowing NULL.</li>\n<li>I go into my edmx, right click and choose \"Update Model from Database\"</li>\n</ul>\n\n<p>Now I go into my program and it hasnt actually updated... I can't put a null in the column.  What do I have to do to update the edmx properly?  Thank you.</p>\n"},{"tags":["sql","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12800359,"title":"Entity Framework Join doubts with generated SQL","body":"<p>I have some doubts regards the SQL query generated by Entity Framework when doing a join between two tables with a 1 to N relation.</p>\n\n<p>Here is an example</p>\n\n<p>Code 1:</p>\n\n<pre><code>Dim result = From p In DbContext.TblParent Join c In DbContext.TblChilds _\n             On c.idparent Equals p.id Where c.field1 = 1 And c.field2 = 2 Select p\n</code></pre>\n\n<p>Code 2:</p>\n\n<pre><code>Dim result = From p In DbContext.TblParent From c In p.TblChilds Where c.field1 = 1 And c.field2 = 2 Select p\n</code></pre>\n\n<p>Both codes produce this sql:</p>\n\n<pre><code>SELECT \n[Extent1].[id] AS [id], \n[Extent1].[field1] AS [field1], \n[Extent1].[field2] AS [field2], \n[Extent2].[field1] AS [field1], \n[Extent2].[field2] AS [field2], \n[Extent2].[idparent] AS [idparent]\nFROM  [dbo].[TblParent] AS [Extent1]\nINNER JOIN (SELECT \n      [TblChilds].[field1] AS [field1], \n      [TblChilds].[field2] AS [field2], \n      [TblChilds].[idparent] AS [idparent]\n      FROM [dbo].[TblChilds] AS [TblChilds]) AS [Extent2] ON [Extent1].[id] = [Extent2].[idparent]\nWHERE ([Extent2].[field1] = 1) AND ([Extent2].[field2] = 2)\n</code></pre>\n\n<p>Why this sql contains a subquery in the join part? Is there a reason?</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12790339,"title":"how to choose precedence of .First() on a specific collection","body":"<p>I have the following code:</p>\n\n<pre><code>    //Pretend there is a few static values in this list\n    List&lt;string&gt; repeatUserIds = new List&lt;string&gt;();\n\n    SomeCollection.Where(x =&gt; repeatUserIds.Contains(x.UserId)).First().MyCol = \"somevalue\";\n\n    MyEntities.SaveChanges(false);\n    scope.Complete();\n    MyEntities.AcceptAllChanges();                            \n</code></pre>\n\n<p>I also have a <code>List&lt;string&gt;</code> object called <code>repeatUserIds</code> that contains a list of static UserId's, maybe 5 or so.  I want to be able to make my <code>SomeCollection.Where(x =&gt; repeatUserIds.Contains(x.UserId))</code> statement return the item that has the userid that is OLDEST in the <code>repeatUserIds</code> IF there is a match, if no match on <code>repeatUserIds</code> (if repeatUserIds.Contains retunrs false), then just return the first item in SomeCollection.</p>\n"},{"tags":["entity-framework","casting","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":12790856,"title":"How can I cast to subclass when using LINQ and TPT EF?","body":"<p>I have the following class hierarchy:</p>\n\n<pre><code>public class RealPeople { }\n\npublic class Users : RealPeople { }\npublic class People : RealPeople { }\n</code></pre>\n\n<p>In my dbContext, I defined a dbSet for <code>RealPeople</code> and on the OnModelCreating procedure, I specified separated tables for People and Users: </p>\n\n<pre><code>modelBuilder.Entity&lt;Users&gt;().ToTable(\"Users\");\nmodelBuilder.Entity&lt;People&gt;().ToTable(\"People\");\n</code></pre>\n\n<p>This creates the corresponding full hierarchy in my DB, with the 3 corresponding tables.\nThe problem comes when I want to retrieve the list of <code>Users</code> in my DB. \nThis:</p>\n\n<pre><code>List = (from Reg in PersistentMgr.RealPeople select (Users)Reg)\n       .ToList();\n</code></pre>\n\n<p>or this:</p>\n\n<pre><code>List = (from Reg in PersistentMgr.RealPeople select (Users)((RealPeople)Reg))\n       .ToList();\n</code></pre>\n\n<p>Throws an exception: </p>\n\n<blockquote>\n  <p>LINQ only being able to cast primitive model types.</p>\n</blockquote>\n\n<p>So the thing is, I can't cast RealPeople to the corresponding subclass Users.\nAny ideas on this one?</p>\n"},{"tags":["c#","entity-framework","many-to-many","code-first"],"answer_count":3,"favorite_count":5,"up_vote_count":6,"down_vote_count":0,"view_count":2611,"score":6,"question_id":5125052,"title":"Self-referencing many-to-many recursive relationship code first Entity Framework","body":"<p>I can't seem to make this work at all</p>\n\n<pre><code>class Member\n{\n    public virtual IList&lt;Member&gt; Friends { get; set; }\n    [Key]\n    public int MemberId { get; set; }\n    public string Name{ get; set; }\n}\n</code></pre>\n\n<p>I tried adding Mappings but in vain. Is there a way to do so with CTP5?</p>\n"},{"tags":["entity-framework","generics","database-migration","internalsvisibleto"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12798352,"title":"Entity Framework: Mapping internal property from generic base type","body":"<p>I've got rather complicated real-life scenario of EF Mapping, which seems to work only if I break incapsulation. Maybe someone would clear it out how to do it correctly, or we'll accept it is a bug. </p>\n\n<p>I have 2 projects, let's call them <code>Domain</code> and <code>Persistance</code>. <code>Domain</code> contains POCO classes, and exposes it's internals to <code>Persistance</code> by the <code>InternalsVisibleTo</code> attribute. </p>\n\n<p>Inside the <code>Domain</code> (the aim is to persist the <code>SomeProduct</code>): </p>\n\n<pre><code>pubic class Company { ... }\npubic class InsuranceCompany : Company { ... }\n\npubic class Product&lt;TCompany&gt; where TCompany : Company\n{\n    ...\n    public CustomValueType SomeProp { ... \n      // get/set from/into SomePropInternal \n    }\n    internal string SomePropInternal { get;set; } \n    // exposed as internal to be accessible from EF mappings\n}\n\npublic class SomeProduct : Product&lt;InsuranceCompany&gt; \n{\n    ...\n    public AnotherCustomValueType AnotherSomeProp { ... \n      // get/set from/into AnotherSomePropInternal \n    }\n    internal string AnotherSomePropInternal { get;set; } \n    // exposed as internal to be accessible from EF mappings\n}\n</code></pre>\n\n<p>I need to end with one table <code>SomeProduct</code> with all the fields. So, in the <code>Persistance</code> we have: </p>\n\n<p>Inside the <code>Persistance</code>:</p>\n\n<p>Base configuration type for all <code>Products</code>:</p>\n\n<pre><code>public class ProductEntityTypeConfiguration&lt;TProduct, TCompany&gt; : EntityTypeConfiguration&lt;TProduct&gt; \n    where TProduct : Product&lt;TCompany&gt; \n    where TCompany : Organization\n{\n    public ProductEntityTypeConfiguration() \n    {\n        ...\n        Property(_ =&gt; _.SomePropInternal)\n            .IsRequired()\n            .IsUnicode()\n            .HasMaxLength(100);\n    }\n}\n</code></pre>\n\n<p>And for SomeProduct: </p>\n\n<pre><code>public class SomeProductMap : ProductEntityTypeConfiguration&lt;SomeProduct, InsuranceCompany&gt;\n{\n    public SomeProductMap()\n    {\n        ToTable(\"Business.SomeProduct\");\n\n        Property(_ =&gt; _.AnotherSomePropInternal)\n            .IsRequired()\n            .IsUnicode()\n            .HasMaxLength(100);\n    }\n}\n</code></pre>\n\n<p>When I try to Add-Migration with these mappings, it says that <code>SomePropInternal is not declared on the type SomeProduct</code>. </p>\n\n<p><strong>If I change the <code>internal string SomePropInternal</code> to <code>public string SomePropInternal</code> migration gets created.</strong> It's the problem. I do not want to expose that must-be-private property.</p>\n\n<p>For <code>AnotherSomePropInternal</code> everything works fine with <code>internal</code>. </p>\n"},{"tags":["c#","asp.net",".net","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":108,"score":4,"question_id":12792435,"title":"What effect does the virtual keyword have on entity properties in Entity Framework 5?","body":"<p>I know that navigation properties in Entity Framework must have the virtual keyword in front of them or else EF can't do it's navigation property magic. But what effect does putting the virtual keyword in front of other properties have? I saw an example recently wherein every single property on the entity was declared with the virtual keyword. Does EF 5 really lazy load every property if I do that or am I missing something about how that works?</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12797891,"title":"Returning details of single user from view model","body":"<p>I have a view model that contains user details and also extended user details from two different models called User and UserDetails.</p>\n\n<p>In my UsersController I have the following for my Details method - </p>\n\n<pre><code>public ViewResult Details(RegisterViewModel viewModel)\n        {\n\n            User currentuser = context.Users\n                .Include(\"UserDetails\")\n                .Where(i =&gt; i.UserName == viewModel.UserName)\n                .First();\n\n            currentuser.UserDetails = new UserDetails();\n\n            return View(currentuser);   \n        }\n</code></pre>\n\n<p>In my Details view I start with -</p>\n\n<pre><code>@model TRS.ViewModels.RegisterViewModel\n</code></pre>\n\n<p>and then try to list the detials from the viewmodel e.g.</p>\n\n<pre><code>&lt;tr&gt;\n    &lt;td&gt;User Name&lt;/td&gt;\n    &lt;td&gt;@Model.UserName&lt;/td&gt;\n\n&lt;/tr&gt;\n</code></pre>\n\n<p>but when I go to the details page for a user I get this error - </p>\n\n<pre><code>Server Error in '/' Application.\n\nSequence contains no elements\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.InvalidOperationException: Sequence contains no elements\n\nSource Error: \n\n\nLine 37:         {\nLine 38:             \nLine 39:             User currentuser = context.Users\nLine 40:                 .Include(\"UserDetails\")\nLine 41:                 .Where(i =&gt; i.UserName == viewModel.UserName)\n</code></pre>\n\n<p>I'm obviously doing something wrong but haven't been able to find what. Any ideas?</p>\n"},{"tags":["c#","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":126,"score":6,"question_id":12689548,"title":"EF/LINQ How to include child entities when there is a bidirectional relation","body":"<p><strong>Environment</strong></p>\n\n<p>I am using Entity Framework 5 on Framework 4.0. (This means I am actually using EF 4.4).\nAs entities I use STE (Self Tracking Entities) because I am working in an N-Tier application.\nWe use a database driven approach because EF was introduced later in the game.</p>\n\n<p><strong>Context</strong></p>\n\n<p>I have 2 Entities that both have a navigation property to each other. (EntityA has a navigation property to EntityB, and EntityB one to EntityA).\nThe relation is 'EntityA > One-TO-Many > EntityB'. When I want to load the child Entities via a LINQ expression, I need to use INCLUDE (STE => Eager Loading) because I will pass all data trough several tiers.</p>\n\n<p><strong>The code</strong></p>\n\n<p>Here is my code to call EntityA with its EntityB children.</p>\n\n<pre><code>using (var ctx = new MyEntities())\n{\n     var result = (from s in ctx.EntityA.Include(\"EntityB\")\n                   where s.Id = 11111\n                   orderby s.TimeUpdated descending \n                   select s)\n               .Take(10)\n               .ToList();\n     return result;\n}\n</code></pre>\n\n<p><strong>The error</strong></p>\n\n<blockquote>\n  <p>System.StackOverflowException {Cannot evaluate expression because the\n  current thread is in a stack overflow state.}</p>\n</blockquote>\n\n<p>There is no error when I remove the 'INCLUDE'.\nI guess the reason is straightforward. I Want to load EntityA with child records EntityB, EntityB records wants to load its parent EntityA everytime, and EntityA ... I guess everyone understands the infinite loop here.</p>\n\n<p><strong>My solutions or alternatives</strong></p>\n\n<ul>\n<li>I go to my EDMX file and remove the navigation property for EntityA in EntityB. If I now want to load data about EntityA while I have an EntityB to my disposal. I need to do a separate DB request and I have 2 different objects that I have to pass on trough my tiers.</li>\n<li>Avoid using include, load separately the EntityA and push it into the Navigation property of my EntityB that refers to my EntityA. </li>\n</ul>\n\n<p><strong>the question</strong></p>\n\n<p>Are there better alternatives or approaches to fix this in my situation ? Should I go on with one of my alternatives I proposed or not? Because I was hoping for a better and cleaner solution.</p>\n\n<p>I Thank you for your time</p>\n\n<p>Ian</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12790349,"title":"EF 4.1 - Model First genereting many left outer join","body":"<p>I'm tuning performances of an application I'm writing.\nI'm using model first approach.</p>\n\n<p>The schema contains a model with many 0..1 -> 0..1,  0..1 -> 1,  1->1 relations.\nWhen I write : <code>context.&lt;model&gt;.FirstOrDefault( m =&gt; m.Id == &lt;someId&gt; );</code> the sql I can see on the SQLprofiler contains one left outer join for each of the relations above. </p>\n\n<p>Why? I'm not asking for related objects.</p>\n\n<p>May anyone help me? Each of this join costs time.</p>\n\n<p>SOLVED:</p>\n\n<p>It's a general concept on using EF. If there is a model with 0.1->1, 1->1 relation with other entities the simplest query: </p>\n\n<pre><code>context.&lt;Entity&gt;.FirstOrDefault( obj -&gt; obj.Id == &lt; someId &gt;)\n</code></pre>\n\n<p>will produce a SQL query with left outer join including all the related entities. To avoid this one solution is to write the query as this:</p>\n\n<pre><code>var query = from obj in Context.Model\n            where obj.Id == &lt;someId&gt;\n            select new MyObj() {&lt;fields I need&gt;}\n</code></pre>\n\n<p>This query will not add any unexptected join</p>\n\n<p>Hope to be clear.</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12795644,"title":"ViewModel error","body":"<p>I was given some help on here recently and set up a view model called RegisterViewModel containing fields from (currently) two different models. This worked and I can use it to register a new user along with related user info. My problem is viewing the details from this same view model. In the Usee controller in my 'Details' method I have the same code -</p>\n\n<pre><code>public ViewResult Details(RegisterViewModel viewModel)\n        {\n            TRSContext context = new TRSContext();\n            User currentuser = context.Users\n                .Include(i =&gt; i.UserDetails)\n                .Where(i =&gt; i.UserName == viewModel.UserName)\n                .Single();\n\n            currentuser.UserDetails = new UserDetails();\n\n            return View(userRepository.Find(viewModel.UserName));\n        } \n</code></pre>\n\n<p>But I am getting the error - </p>\n\n<p><strong>Cannot convert lambda expression to type 'string' because it is not a delegate type</strong></p>\n\n<p>for the line - </p>\n\n<p><strong>(i => i.UserDetails)</strong></p>\n\n<p>Any ideas what's wrong with this?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":127,"score":1,"question_id":11523912,"title":"No mapping exists from object type System.RuntimeType to a known managed provider native type","body":"<p>I have a stored procedure with the signature</p>\n\n<pre><code>PROCEDURE [dbo].[spValidateID]\n    @ScanCode       VARCHAR(50),\n    @Name           VARCHAR(50) = NULL OUTPUT,\n    @ScanTime       DATETIME = NULL OUTPUT,\n    @ValidationCode INT = 0 OUTPUT\n</code></pre>\n\n<p>This is supposed to return a validationCode and also populate the name and scanTime variables.\nI need to give it scanCode value while calling.</p>\n\n<p>in my C#  code I am doing like this.</p>\n\n<pre><code>using (var context = new DBEntities())\n            {\n                var pScanCode = new SqlParameter(\"ScanCode\", scanCode);\n                var opName = new SqlParameter(\"Name\", name);\n                var opScanTime = new SqlParameter(\"ScanTime\", scanTime);\n                var opValidationCode = new SqlParameter(\"ValidationCode\", validationCode);\n\n                var test = context.ExecuteStoreQuery&lt;int&gt;(\"spValidateID @ScanCode, @Name, @ScanTime, @ValidationCode\", pScanCode, opName, opScanTime, opValidationCode);\n\n            }\n</code></pre>\n\n<p>but while running this I m getting error \n No mapping exists from object type System.RuntimeType to a known managed provider native type.</p>\n\n<p>any idea??</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":12793824,"title":"I want to edit metadata workplace, where ","body":"<p>I'm using Entity Framework 4.3 and MVC3,\nI want to edit metadata workplace , how to edit it ? </p>\n"},{"tags":[".net","entity-framework","entity-relationship"],"answer_count":0,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12793293,"title":"What is the difference between Navigation REference and EntityReference?","body":"<p>What is the difference between Navigation REference and EntityReference terms in Entity Framework?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12792790,"title":"How to work with multiple DbSets with common base class in EF 5?","body":"<p>I have 2 POCO classes:</p>\n\n<pre><code>class Email: Base\n{\n   public int SomeProperty { get; set; } \n}\n\nclass Photo: Base\n{\n   public int SomeOtherProperty { get; set; } \n}\n</code></pre>\n\n<p>and a base class</p>\n\n<pre><code>abstract class Base\n{\n     public DateTime DateCreated { get; set; }\n}\n</code></pre>\n\n<p>here is my context definition:</p>\n\n<pre><code>public class EntitiesContext : DbContext\n{\n    public DbSet&lt;Email&gt; Emails { get; set; }\n    public DbSet&lt;Photo&gt; Photos { get; set; }\n}\n</code></pre>\n\n<p>of course these classes here are just for the sake of example, things are quite more complicated.</p>\n\n<p>base class is only intended to have common properties for each table - date modified, state, etc. I believe I use Table-Per-Type approach.</p>\n\n<p><strong>PROBLEM:</strong> I have some common business logic which I need to run against each table (for example, count non-processed items of each type). <strong>I need a way to iterate through a set of tables with common base class.</strong> I was hoping to do something like this:</p>\n\n<pre><code>private void GoThroughAllTables(Action&lt;DbSet&lt;Base&gt;&gt; fnProcess, bool needSave)\n{\n    using (var db = new EntitiesContext())\n    {\n        fnProcess(db.Emails);\n        fnProcess(db.Photos);\n\n        if (needSave == true)\n        {\n            db.SaveChanges();\n        }\n    }\n}\n\npublic IEnumerable&lt;QueueStatus&gt; GetQueueStatus()\n{\n    var res = new List&lt;QueueStatus&gt;();\n\n    GoThroughAllTables((set) =&gt;\n    {\n        res.Add(new QueueStatus\n        {\n            Count = set.Cast&lt;Base&gt;().Count(x =&gt; x.DateCreated &gt; someDate),\n        });\n    }, false);\n\n    return res;\n}\n\npublic void DeleteFailedItems()\n{\n    GoThroughAllTables((set) =&gt;\n    {\n        set.Cast&lt;Base&gt;().Remove(x =&gt; x.DateCreated &gt; someDate);\n    }, true);\n\n    return res;\n}\n</code></pre>\n\n<p>this will not compile:</p>\n\n<pre><code>fnProcess(db.Emails);\n</code></pre>\n\n<blockquote>\n  <p>Argument 1: cannot convert from 'System.Data.Entity.DbSet|Email|' to\n  'System.Data.Entity.DbSet|Base|'</p>\n</blockquote>\n\n<p>passing non-typed DbSet will not work because Cast will fail.</p>\n\n<p>so I'm not sure what else can I try. Any suggestions?</p>\n"},{"tags":["entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":12789669,"title":"using too many foreach loops with my entity framework queries?","body":"<p>I am trying to learn Entity Framework. I am happy that the results I am returning from my queries are giving me the data that I need but I find that I am using allot of for-each loops and separate database requests to get the information I require. </p>\n\n<p>I would be grateful if someone could review my code and advise if there is a way I could make things more concise and also if I am not really getting the functionality that the entity framework offers ( I think I am missing the point here somewhere!!!). Any way here is the problem and the code (which I hope makes sense):</p>\n\n<p>Attempting to query from 4 tables in my database. One is unrelated (due to my laziness - I need to amend this but it is not a deal breaker at present). The other 3 are related with a 1 to many relationship. here is a summary:</p>\n\n<p>UserClients - unrelated table (should be linked to LeadClient but not important)</p>\n\n<p>[LeadClient PK = GroupCode] one to may to [Matters FK = LeadCode]\n[Matters PK = MatterNumber] one to many to [Invoices  FK = Matter]</p>\n\n<p>I am attempting to create a list of DTO objects to populate a GridView. My DTO is as follows:</p>\n\n<pre><code>public class dto\n{\n    public string clientCode { get; set; }\n    public string clientName { get; set; }\n    public decimal totalDebt { get; set; }\n\n\n}\n</code></pre>\n\n<p>I am passing in a statementName variable to a method which I then query against UserClients to get a List of clientcodes.</p>\n\n<p>Here is my method to populate my List objects:</p>\n\n<pre><code>      public static List&lt;dto&gt; StateNameLeadCodes(string stateName)\n    {\n        //DTO objects\n        List&lt;dto&gt; items = new List&lt;dto&gt;();\n\n        //Leadcode list for statement name\n        List&lt;string&gt; leadcodes = (from o in repository.UserClients where o.StatementName == stateName select o.LeadCode).ToList();\n\n        //From leadcodes populate items list\n       foreach(string s in leadcodes)\n       {\n           //Get clientCode and matter list for the client code\n           var code = (from o in repository.LeadClients where o.GroupCode == s select new { o.ClientName, o.Matters}).First();\n\n\n           dto temp = new dto();\n\n           temp.clientCode = s;\n\n           temp.clientName = code.ClientName;\n\n\n           //Get a list if invoices for each matter \n           foreach (Matter m in code.Matters)\n           {\n               List&lt;Invoice&gt; invoices = (from o in repository.Invoices where o.Matter == m.Matternumber select o).ToList();\n               //Calculate total debt for all invoices\n               foreach (Invoice inv in invoices)\n               {\n                   temp.totalDebt += (inv.debt_Fee + inv.debt_Costs + inv.debt_VAT);\n               }\n\n           }\n\n                items.Add(temp);\n            }\n\n\n        return items;\n         }\n</code></pre>\n\n<p>I find myself doing something similar when I want to return a combination of a single item and a list to a DTO. I see that my Entity classes have an EntityCollection for the One to Many relationship. I have tried to select the entity object as part of my select statements but I get the error that the EnitityCollection cannot be converted to a List&lt;>.</p>\n\n<p>Any tips and pointers how to clean this code up would be great - thanks in advance!!</p>\n\n<p>Added image of Entity objects as requested:</p>\n\n<p><img src=\"http://i.stack.imgur.com/OQE7J.png\" alt=\"EntityImage\"></p>\n"},{"tags":["c#","entity-framework","repository-pattern"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12791479,"title":"How to Remove Code Analysis Warning CA1006?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3441563/alternative-to-nested-type-of-type-expressionfunct\">Alternative to nested type of type Expression&lt;Func&lt;T&gt;&gt;</a>  </p>\n</blockquote>\n\n\n\n<p>Playing with a method in a Facade / Repository, gleaned from a MSDN article, I produced:</p>\n\n<pre><code>public virtual IEnumerable&lt;TEntity&gt; Fetch(\n    Expression&lt;Func&lt;TEntity, bool&gt;&gt; filter,\n    Func&lt;IQueryable&lt;TEntity&gt;, IOrderedQueryable&lt;TEntity&gt;&gt; orderBy,\n    string includeProperties)\n{\n    IQueryable&lt;TEntity&gt; query = this.DbContext.Set&lt;TEntity&gt;();\n\n    if (filter != null)\n    {\n        query = query.Where(filter);\n    }\n\n    if (!string.IsNullOrEmpty(includeProperties))\n    {\n        foreach (var includeProperty in includeProperties\n            .Split(new[] { ',' }, StringSplitOptions.RemoveEmptyEntries))\n        {\n            query = query.Include(includeProperty);\n        }\n    }\n\n    return orderBy == null \n        ? query \n        : orderBy(query);\n}\n</code></pre>\n\n<p>Code Analysis generates 2 warnings, as follows:</p>\n\n<blockquote>\n  <p>CA1006 : Microsoft.Design : Consider a design where\n  '<code>MyType&lt;TDbContext, TEntity&gt;.Fetch(Expression&lt;Func&lt;TEntity, bool&gt;&gt;,\n  Func&lt;IQueryable&lt;TEntity&gt;, IOrderedQueryable&lt;TEntity&gt;&gt;, string)</code>'\n  doesn't nest generic type '<code>Expression&lt;Func&lt;TEntity, bool&gt;&gt;</code>'.</p>\n  \n  <p>CA1006 : Microsoft.Design : Consider a design where\n  '<code>MyType&lt;TDbContext, TEntity&gt;.Fetch(Expression&lt;Func&lt;TEntity, bool&gt;&gt;,\n  Func&lt;IQueryable&lt;TEntity&gt;, IOrderedQueryable&lt;TEntity&gt;&gt;, string)</code>'\n  doesn't nest generic type '<code>Func&lt;IQueryable&lt;TEntity&gt;,\n  IOrderedQueryable&lt;TEntity&gt;&gt;</code>'.</p>\n</blockquote>\n\n<p>Now, I know they are only warnings and I am free to suppress them (and probably will as they appear overly pedantic under this scenario). However, out of interest, is there a possible design that accomplishes the same as this method without incurring the Code Analysis warnings?</p>\n\n<p>Richard</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","linq-to-entities","datacontext"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":208,"score":2,"question_id":11407729,"title":"MVC 4 late-bound DataContext entity LINQ reference","body":"<p>Long time listener, first time caller.</p>\n\n<p>I'm probably taking the wrong approach to this, so any help would be fantastic.</p>\n\n<p>I'm using C#, MVC 4, Code First, Entity Framework 4.3, &amp; Razor.</p>\n\n<p>I am trying to split out EF data classes &amp; some methods into a separate class project so that they can generically be references by multiple other projects.  I've created this simplified example to highlight the issue as much as I can.</p>\n\n<p>So in a class project I have:</p>\n\n<pre><code>public MyGeneric(string name)\n{\n    ID = Guid.NewGuid();\n    Name = name;\n}\n\npublic Guid ID { get; set; }\npublic string Name { get; set; }\n\n\npublic void AddThis(MyGeneric obj)\n{\n    using (var db = Activator.CreateInstance&lt;myDbContext&gt;())\n    {\n        var myOthers = from mo in db.MyOther\n                       where mo.OtherID == obj.ID\n                       select mo;\n\n        myOthers.ForEach(mo =&gt; db.MyOther.Add(mo));\n        db.SaveChanges();\n    }\n}\n</code></pre>\n\n<p>And then I can reference this in a main project such as:</p>\n\n<pre><code>public class SampleInherit : MyGeneric\n{\n    public SampleInherit(string newName, string secName)\n        : base(newName)\n    {\n        SecName = secName;\n    }\n\n    public string SecName { get; set; }\n\n\n    public void DoSomething(SampleInherit obj)\n    {\n        base.AddThis(obj);\n        // do other stuff\n    }\n}\n</code></pre>\n\n<p>What I'm trying to do is genericise (is that a word?) a few classes with their methods into a separate side project.  This side project will supply base classes that will (in order of desired):</p>\n\n<ul>\n<li>use EF DbContext to create/access the database,</li>\n<li>allow more properties to be added,</li>\n<li>supply method/procedures that affect the underlying data,</li>\n<li>be renamed more appropriately for the main project.</li>\n</ul>\n\n<p>Now if I just inherit the base classes into classes in the main project, it all works except for the base class reference myDbContext &amp; the entity object references within the LINQ statements.</p>\n\n<p>Can you late-bind the DataContext or have I painted my self into a corner here?</p>\n\n<p>Cheers for all the help you can give.</p>\n"},{"tags":["c#","asp.net-mvc","asp.net-mvc-3","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":70,"score":5,"question_id":12789837,"title":"Concatenated Where clause with array of strings","body":"<p>I am wondering if there is a way to create a concatenated WHERE clause using an array of int.  I need to get the results for the entire array combined.  Can I do something like:</p>\n\n<pre><code>public ViewResult Results(int? programId, int? programYear, int? programTypeId, string toDate, string fromDate, int?[] programTypeIdList, int?[] programIdList)\n{\n    surveyResponseRepository.Get().Any(x =&gt; x.ProgramId == programIdList);\n}\n</code></pre>\n"},{"tags":["asp.net",".net","entity-framework","t4","entity-framework-5"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":117,"score":0,"question_id":12790124,"title":"Entity Framework 5 stopped running T4 templates files on save","body":"<p>At work we just upgraded to Entity Framework 5. Our EDMX file now has a couple other nodes beneath it:</p>\n\n<pre><code>EntityContainer.Context.tt\n</code></pre>\n\n<p>which contains the generated DbContext object and</p>\n\n<pre><code>EntityContainer.tt\n</code></pre>\n\n<p>which contains the entities themselves.</p>\n\n<p>For a short period, adding an entity in EF was automatically regenerating the tt (T4 Templates) when we would save the EDMX file. Now all of a sudden we have to right-click the T4 templates and select \"Run Custom Tool\" to get them to regenerate the .cs files for the context or entities.</p>\n\n<p>Any ideas how this might have happened?</p>\n\n<h2>Update</h2>\n\n<p>In the EDMX the property \"Transform Related Text Templates On Save\" is set to true and the problem is still happening.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":180,"score":1,"question_id":7269652,"title":"Entity Framework - Programmatically generating and updating model for whole database?","body":"<p>It seems like Stored Procedures must be added and updated manually through the GUI.  I'm looking to have this done programmatically.  The longterm goal is to ensure any changes in the Stored Procedure names and signatures (parameters) made directly in the database and then updating the EF model will require any calling code to be updated to match or give a compile time error if not.</p>\n\n<p>A year and a few Entity Framework versions have passed.  Is something like this possible now?</p>\n"},{"tags":["entity-framework","ef-database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":139,"score":3,"question_id":12378670,"title":"EntityFramework 5 - Getting value cannot be null parameter name: font error while using the designer","body":"<p>I'm getting a strange error while using EF 5 using a Database First approach on the designer.  The error is saying 'value cannot be null parameter name: font'.  I also get a big red X over the design area.  I'm not exactly sure how the designer generated this error, and to this point, I've only used the designer to create my edmx.</p>\n\n<p>Thoughts?  This is with VS 2012 RTM version.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","scaffolding"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12707991,"title":"Constraint exception unhandled by user code - help debug please","body":"<p>I have a DB table with some nullable columns. I am developing DB first, and created an EDMX file to model the database. Using MVC4 framework.</p>\n\n<p>I then scaffolded a controller and view as normal, but when I run the web application to test, I am faced with the following Constraint exception...</p>\n\n<pre><code>The 'EURam' property on 'FixHistory' could not be set to a 'null' value. You must set this property to a non-null value of type 'Decimal'.\n</code></pre>\n\n<p>and this points to the following scaffolded code within the controller:</p>\n\n<pre><code>        public ActionResult Index()\n    {\n        var fixhistories = db.FixHistories.Include(f =&gt; f.Metal);\n        return View(fixhistories.ToList());\n    }\n</code></pre>\n\n<p>Now I need the data for that column to be nullable - sometimes the data exists, sometimes it doesn't...</p>\n\n<p>How do I fix this?</p>\n\n<p>I appreciate that this may be a simple question, but I am a complete Microsoft Noob.</p>\n"},{"tags":["c#","entity-framework","visual-studio-2008","mapping"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":145,"score":1,"question_id":12780389,"title":"Entity Framework error - Error 11009: Property ' ' is not mapped","body":"<p>To improve an older project I am forced by the circumstances to use VS 2008 and Framework 3.5 - I have issues with the edmx showing bizarre behavior and not updating the entities as required.</p>\n\n<p>The edmx throws me the above error, but when I go to the respective table and right click it - \"Update Model from Database\" there is no change, the error is still there. </p>\n\n<p>If I delete the table from the diagram by selecting it and pressing del, then in the Model Browser It disappears from the .Database but when clicking \"Update model from Database\" I cant see i in the \"Add\" list, all I can do is \"Refresh\" the table since I still see it in the refresh list (which should not happen because I deleted it! )</p>\n\n<p>Please help me. I cannot afford to lose time on such trivial problems that VS throws at me.</p>\n\n<p>Thank you very much in advance,</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12705844,"title":"Validation in setter using EntityFramework","body":"<p>Using Entity Framework. I have created an object Registration with a property \"AmmountOfChildren\" with max set to 50. I want to validate in the setter to make sure that the max ammount is 50. How do i go about it in the best way? </p>\n\n<pre><code>  public global::System.Int16 AmmountOfChildren\n    {\n        get\n        {\n            return _AmmountOfChildren;\n        }\n        set\n        {\n            OnAmmountOfChildrenChanging(value);\n            ReportPropertyChanging(\"AmmountOfChildren\");\n            _AmmountOfChildren = StructuralObject.SetValidValue(value);\n            ReportPropertyChanged(\"AmmountOfChildren\");\n            OnAmmountOfChildrenChanged();\n        }\n    }\n</code></pre>\n"},{"tags":["entity-framework","decimal"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":88,"score":3,"question_id":12482009,"title":"Entity Framework 5 - Decimal Save Issue - Conversion Overflows","body":"<p>If I have a table in SQL 2008 R2 with a nullable column of type Decimal(35,18) and pull that into the edmx. The largest decimal value I can successfully save to the DB without getting a Conversion Overflows error is</p>\n\n<p>79,228,162,514</p>\n\n<p>This is very odd as this matches the upper bounds of Decimal (if you compare digits not in actual value)</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/system.decimal.maxvalue.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/system.decimal.maxvalue.aspx</a></p>\n\n<p>79,228,162,514,264,337,593,543,950,335</p>\n\n<p>However I am not even close to the max 28 digits. </p>\n\n<p>I filed a bug as I believe it is... but I can't believe it is as this would be a HUGE issue?</p>\n\n<p><a href=\"http://entityframework.codeplex.com/workitem/522\" rel=\"nofollow\">http://entityframework.codeplex.com/workitem/522</a></p>\n"},{"tags":[".net","entity-framework",".net-4.0","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":145,"score":0,"question_id":12573176,"title":"Entity Framework schema errors when deploying to a remote server","body":"<p>I've used EF code first to create a DB. Works great in dev. I copy it to a windows server 2003 box and I get these errors (listed below)</p>\n\n<p>EF 5, .NET 4.0.</p>\n\n<p>I've uninstalled and reinstalled the .net 4 framework. as well as tested on other machines. </p>\n\n<p>On my Windows Server 2008 box it works fine. On another 2003 box it does not. </p>\n\n<p>To take MVC out of the equation, i built a simple console app that lists out some data from the db. - Same error there. </p>\n\n<p>I had written everything in VS 2012 with .net 4.5 installed on the machine. I read that could cause an issue, so I re-wrote everything in VS 2010 targeting .net 4, and manually added the reference to the EF 5/.net4 dll. Same thing, works great on my 2 dev machines, and on the 2008 server, but not 2003. </p>\n\n<p><strong>Error:</strong></p>\n\n<pre><code>Schema specified is not valid. Errors: \n(0,0) : warning 0005: Could not find schema information for the attribute 'Namespace'. \n(0,0) : warning 0005: Could not find schema information for the attribute 'Provider'. \n(0,0) : warning 0005: Could not find schema information for the attribute 'ProviderManifestToken'.\n(0,0) : warning 0005: Could not find schema information for the attribute 'Alias'.\n(0,0) : error 0010: The element Schema in namespace http://schemas.microsoft.com/ado/2009/11/edm/ssdl was unexpected for the root element.  The expected Schema in one of the following namespaces:  http://schemas.microsoft.com/ado/2006/04/edm/ssdl, http://schemas.microsoft.com/ado/2009/02/edm/ssdl.\n</code></pre>\n\n<p>Here's the stack trace (It's a MVC app)</p>\n\n<pre>\n[MetadataException: Schema specified is not valid. Errors: \n(0,0) : warning 0005: Could not find schema information for the attribute 'Namespace'.\n(0,0) : warning 0005: Could not find schema information for the attribute 'Provider'.\n(0,0) : warning 0005: Could not find schema information for the attribute 'ProviderManifestToken'.\n(0,0) : warning 0005: Could not find schema information for the attribute 'Alias'.\n(0,0) : error 0010: The element Schema in namespace http://schemas.microsoft.com/ado/2009/11/edm/ssdl was unexpected for the root element. The expected Schema in one of the following namespaces: http://schemas.microsoft.com/ado/2006/04/edm/ssdl, http://schemas.microsoft.com/ado/2009/02/edm/ssdl.]\n   System.Data.Metadata.Edm.Loader.ThrowOnNonWarningErrors() +8508793\n   System.Data.Metadata.Edm.Loader.LoadItems(IEnumerable`1 xmlReaders, IEnumerable`1 sourceFilePaths) +181\n   System.Data.Metadata.Edm.StoreItemCollection.Init(IEnumerable`1 xmlReaders, IEnumerable`1 filePaths, Boolean throwOnError, DbProviderManifest& providerManifest, DbProviderFactory& providerFactory, String& providerManifestToken, Memoizer`2& cachedCTypeFunction) +211\n   System.Data.Metadata.Edm.StoreItemCollection..ctor(IEnumerable`1 xmlReaders) +295\n   System.Data.Entity.Migrations.Extensions.XDocumentExtensions.GetStoreItemCollection(XDocument model, DbProviderInfo& providerInfo) +180\n   System.Data.Entity.Migrations.Infrastructure.EdmModelDiffer.Diff(XDocument sourceModel, XDocument targetModel, String connectionString) +48\n   System.Data.Entity.Internal.InternalContext.ModelMatches(XDocument model) +45\n   System.Data.Entity.Internal.ModelCompatibilityChecker.CompatibleWithModel(InternalContext internalContext, ModelHashCalculator modelHashCalculator, Boolean throwIfNoMetadata) +65\n   System.Data.Entity.Internal.InternalContext.CompatibleWithModel(Boolean throwIfNoMetadata) +52\n   System.Data.Entity.CreateDatabaseIfNotExists`1.InitializeDatabase(TContext context) +239\n   System.Data.Entity.Internal.c__DisplayClass8.b__6() +19\n   System.Data.Entity.Internal.InternalContext.PerformInitializationAction(Action action) +72\n\n[DataException: An exception occurred while initializing the database. See the InnerException for details.]\n   System.Data.Entity.Internal.InternalContext.PerformInitializationAction(Action action) +117\n   System.Data.Entity.Internal.InternalContext.PerformDatabaseInitialization() +186\n   System.Data.Entity.Internal.LazyInternalContext.b__4(InternalContext c) +7\n   System.Data.Entity.Internal.RetryAction`1.PerformAction(TInput input) +118\n   System.Data.Entity.Internal.LazyInternalContext.InitializeDatabaseAction(Action`1 action) +190\n   System.Data.Entity.Internal.LazyInternalContext.InitializeDatabase() +73\n   System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType) +28\n   System.Data.Entity.Internal.Linq.InternalSet`1.Initialize() +56\n   System.Data.Entity.Internal.Linq.InternalSet`1.GetEnumerator() +15\n   System.Data.Entity.Infrastructure.DbQuery`1.System.Collections.Generic.IEnumerable.GetEnumerator() +40\n   System.Collections.Generic.List`1..ctor(IEnumerable`1 collection) +315\n   System.Linq.Enumerable.ToList(IEnumerable`1 source) +58\n   Kiosk.Controllers.KioskEventController.Index() in c:\\Dev\\hbkiosk\\Kiosk\\Controllers\\KioskEventController.cs:23\n   lambda_method(Closure , ControllerBase , Object[] ) +62\n   System.Web.Mvc.ActionMethodDispatcher.Execute(ControllerBase controller, Object[] parameters) +17\n   System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters) +188\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +27\n   System.Web.Mvc.Async.c__DisplayClass42.b__41() +28\n   System.Web.Mvc.Async.c__DisplayClass8`1.b__7(IAsyncResult _) +12\n   System.Web.Mvc.Async.WrappedAsyncResult`1.End() +50\n   System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeActionMethod(IAsyncResult asyncResult) +29\n   System.Web.Mvc.Async.c__DisplayClass39.b__33() +59\n   System.Web.Mvc.Async.c__DisplayClass4f.b__49() +240\n   System.Web.Mvc.Async.c__DisplayClass37.b__36(IAsyncResult asyncResult) +12\n   System.Web.Mvc.Async.WrappedAsyncResult`1.End() +50\n   System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeActionMethodWithFilters(IAsyncResult asyncResult) +31\n   System.Web.Mvc.Async.c__DisplayClass2a.b__20() +23\n   System.Web.Mvc.Async.c__DisplayClass25.b__22(IAsyncResult asyncResult) +128\n   System.Web.Mvc.Async.WrappedAsyncResult`1.End() +50\n   System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeAction(IAsyncResult asyncResult) +26\n   System.Web.Mvc.c__DisplayClass1d.b__18(IAsyncResult asyncResult) +14\n   System.Web.Mvc.Async.c__DisplayClass4.b__3(IAsyncResult ar) +25\n   System.Web.Mvc.Async.WrappedAsyncResult`1.End() +55\n   System.Web.Mvc.Controller.EndExecuteCore(IAsyncResult asyncResult) +41\n   System.Web.Mvc.Async.c__DisplayClass4.b__3(IAsyncResult ar) +25\n   System.Web.Mvc.Async.WrappedAsyncResult`1.End() +55\n   System.Web.Mvc.Controller.EndExecute(IAsyncResult asyncResult) +28\n   System.Web.Mvc.Controller.System.Web.Mvc.Async.IAsyncController.EndExecute(IAsyncResult asyncResult) +10\n   System.Web.Mvc.c__DisplayClass8.b__3(IAsyncResult asyncResult) +28\n   System.Web.Mvc.Async.c__DisplayClass4.b__3(IAsyncResult ar) +25\n   System.Web.Mvc.Async.WrappedAsyncResult`1.End() +55\n   System.Web.Mvc.MvcHandler.EndProcessRequest(IAsyncResult asyncResult) +30\n   System.Web.Mvc.MvcHandler.System.Web.IHttpAsyncHandler.EndProcessRequest(IAsyncResult result) +9\n   System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +8836913\n   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously) +184\n\n</pre>\n"},{"tags":["c#","asp.net-mvc","entity-framework","dispose","unit-of-work"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":103,"score":1,"question_id":12770267,"title":"Why does need implement Dispose pattern on UnitOfWork EF?","body":"<p>The microsoft tutorial <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application\" rel=\"nofollow\">http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application</a> advises to implement dispose pattern, like this:</p>\n\n<pre><code>private bool disposed = false;\n\n        protected virtual void Dispose(bool disposing)\n        {\n            if (!this.disposed)\n            {\n                if (disposing)\n                {\n                    context.Dispose();\n                }\n            }\n            this.disposed = true;\n        }\n\n        public void Dispose()\n        {\n            Dispose(true);\n            GC.SuppressFinalize(this);\n        }\n</code></pre>\n\n<p>Why i should do it, why i cannot simply dispose context and enough, what happens if i will use only:</p>\n\n<pre><code>context.Dispose()\n</code></pre>\n\n<p>Which goals of implementation of Microsoft's dispose pattern?</p>\n"},{"tags":["entity-framework","dbcontext","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":149,"score":0,"question_id":12560966,"title":"The entity type is not part of the model, EF 5","body":"<p>I am trying to update my repository to EF5 but have encountered a few errors. I've taken a look around stackoverflow for similar errors discovered a few questions/answers but unfortunately the same answers didn't resolve my issue.</p>\n\n<p>This is my error:</p>\n\n<pre><code>The entity type User is not part of the model for the current context.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.\n</code></pre>\n\n<p>This is my DbContext class:</p>\n\n<pre><code>public abstract class WebModelContext : DbContext\n{\n    public WebModelContext()\n        : base(\"WebConnection\")\n    {\n        Configuration.LazyLoadingEnabled = true;\n    }\n}\n</code></pre>\n\n<p>This is my context class that inherits my <code>WebModelContext</code> class:</p>\n\n<pre><code>public class AccountContext : WebModelContext\n{\n    private DbSet&lt;User&gt; _users;\n\n    public AccountContext()\n        : base()\n    {\n        _users = Set&lt;User&gt;();\n    }\n\n    public DbSet&lt;User&gt; Users\n    {\n        get { return _users; }\n    }\n}\n</code></pre>\n\n<p>This is my repository class:</p>\n\n<pre><code>public abstract class IRepository&lt;T&gt; : IDisposable where T : WebModelContext, new()\n{\n    private T _context;\n\n    protected T Context\n    {\n        get { return _context; }\n    }\n\n    public IRepository() {\n        _context = new T();\n    }\n\n    public void Dispose()\n    {\n        Dispose(true);\n        GC.SuppressFinalize(this);\n    }\n\n    ~IRepository() \n    {\n        Dispose(false);\n    }\n\n    protected virtual void Dispose(bool disposing)\n    {\n        if (disposing) \n        {\n            if (_context != null)\n            {\n                _context.Dispose();\n                _context = null;\n            }\n        }\n    }\n\n}\n</code></pre>\n\n<p>This is my AccountRepository class:</p>\n\n<pre><code>public class AccountRepository : IRepository&lt;AccountContext&gt;\n{\n    public List&lt;User&gt; GetUsers()\n    {\n        return Context.Users.ToList();\n    }\n\n    public User GetUser(string username)\n    {\n        return Context.Users.Where(u =&gt; u.Name == username).FirstOrDefault();\n    }\n\n    public User CreateUser(string username, string password, string salt, int age, int residence)\n    {\n        User user = new User\n        {\n            Name = username,\n            Password = password,\n            Salt = salt,\n            RoleId = 1,\n            CreatedOn = DateTime.Now,\n            Locked = false,\n            Muted = false,\n            Banned = false,\n            Guid = Guid.NewGuid().ToString(\"N\")\n        };\n        Context.Users.Add(user);\n        return Context.SaveChanges() &gt; 0 ? user : null;\n    }\n}\n</code></pre>\n\n<p>Any help greatly appreciated :)</p>\n"},{"tags":["c#","xml","linq","entity-framework","import"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":12788207,"title":"Reading in XML/KML files using C#","body":"<p>I'm trying to import the kml xml Google earth file into an application, but i can't seem to get the xDocument syntax right in order to do what i want, i'm wondering if anyone could suggest a way to read in the kml xml file.</p>\n\n<p>I understand the basics of xml import but can't get anything working with xDocument and Linq, ideally i'd like to get each Placemark as an object and add them to my Entity Framework driven db. Any suggestions as to how i should do this would be great, as i'm just starting out with Linq and could do with some pointers. The xml is laid out as below</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;kml xmlns=\"http://earth.google.com/kml/2.2\"&gt;\n  &lt;Document&gt;\n    &lt;Placemark&gt;\n      &lt;name&gt;XXX&lt;/name&gt;\n      &lt;description&gt;XXX&lt;/description&gt;\n      &lt;styleUrl&gt;XXX&lt;/styleUrl&gt;\n      &lt;Point&gt;\n         &lt;coordinates&gt;XXX&lt;/coordinates&gt;\n      &lt;/Point&gt;\n    &lt;/Placemark&gt;\n    &lt;Placemark&gt;\n      &lt;name&gt;XXX&lt;/name&gt;\n      &lt;description&gt;XXX&lt;/description&gt;\n      &lt;styleUrl&gt;XXX&lt;/styleUrl&gt;\n      &lt;Point&gt;\n         &lt;coordinates&gt;XXX&lt;/coordinates&gt;\n      &lt;/Point&gt;\n    &lt;/Placemark&gt;\n  &lt;/Document&gt;\n&lt;/kml&gt;\n</code></pre>\n"},{"tags":["linq","entity-framework","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12773989,"title":"\"An object with the same key already exists in the ObjectStateManager\" on Entity.Attach","body":"<p>I am using Entity Framework Code first my classes are</p>\n\n<pre><code>[Serializable]\n    public class Emp\n    {\n        public int EmpId { get; set; }\n        public byte TitleId { get; set; }\n        [MaxLength(50)]\n        public string FirstName { get; set; }\n        [MaxLength(50)]\n        public string Surname { get; set; }\n        public byte Type { get; set; }\n\n        public List&lt;PracticeEmp&gt; PracticeEmps { get; set; }\n    }\n\n[Serializable]\n    public class PracticeEmp\n    {\n        public int PracticeStaffId { get; set; }\n        public int PracticeId { get; set; }\n        public int EmpId { get; set; }\n        public DateTime? StartDate { get; set; }\n        public DateTime? EndDate { get; set; }\n\n        public Emp Emp { get; set; }\n    }\n</code></pre>\n\n<p>when I am trying to insert data into PracticeEmps table for a staff which already exists I use the following code</p>\n\n<pre><code>Db.Current.Emps.Attach(practiceEmp.Emp);\nDb.Current.PracticeEmps.Add(practiceEmp);\n</code></pre>\n\n<p>This code segment returns an error on attach method \"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key.\"</p>\n\n<p>any Ideas...</p>\n"},{"tags":["asp.net-mvc","entity-framework","ninject"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12783930,"title":"Using Ninject with Entity Framework 5 when I have a BaseController","body":"<p>My current stack is ASP.NET MVC 4 and Entity Framework 5.0. I installed ninject.mvc3 by NuGet and the code showed below works fine:</p>\n\n<pre><code>public class SessionsController : Controller\n{\n    // use \"kernel.Bind&lt;MyContext&gt;().ToSelf().InRequestScope();\" \n    // to inject MyContext\n    private MyContext _context;\n\n    public SessionsController(MyContext context)\n    {\n        _context = context;\n    }\n\n    [HttpGet]\n    public ActionResult Login()\n    {\n        System.Diagnostics.Debug.WriteLine(_context.Users.Count());\n        return View();\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>Now, I want to extract a BaseController for my controllers: </p>\n\n<pre><code>public class BaseController : Controller\n{\n    protected MyContext _context;\n\n    public BaseController(MyContext context)\n    {\n        _context = context;\n    }\n\n    // I don't know what should be write here and \n    // base controller must have a parameterless constructor\n    public BaseController() \n    {\n\n    }\n}\n</code></pre>\n\n<p>Then I make SessionsController inherit from BaseController. When I run the code, an exception throwed that </p>\n\n<blockquote>\n  <p>\"Object reference not set to an instance of an object.(with MyContext)\"</p>\n</blockquote>\n\n<p>Do I use Ninject wrong?</p>\n\n<p><strong>--UPDATED--</strong> the ninject's NinjectWebCommon.cs's code</p>\n\n<pre><code>    /// &lt;summary&gt;\n    /// Load your modules or register your services here!\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"kernel\"&gt;The kernel.&lt;/param&gt;\n    private static void RegisterServices(IKernel kernel)\n    {\n        kernel.Bind&lt;TelesingContext&gt;().ToSelf().InRequestScope();\n    }        \n</code></pre>\n\n<p><strong>--UPDATED--</strong> the edited SessionsController.cs code</p>\n\n<pre><code>public class SessionsController : BaseController\n{\n    [HttpGet]\n    public ActionResult Login()\n    {\n        System.Diagnostics.Debug.WriteLine(_context.Users.Count());\n        return View();\n    }\n}\n</code></pre>\n\n<p>}</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":9949838,"title":"Manually write entities from existing database","body":"<p>We have a very large stablished database (PostgreSQL for the matter) that suffers from standardization and I'd like to use Entity Framework in our future-to-be ASP.NET MVC application.</p>\n\n<p>Is there a way to manually write Entities mappings?</p>\n\n<p>I <strong>really</strong> don't want to autogenerate Entities based on Database First approach. And I don't have the option, for now, to migrate/update our schema.</p>\n\n<p>Thank you.</p>\n\n<p><strong>Edit</strong>: after some more thinking we decided using NHibernate with Fluent NHibernate for the mappings.</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","entity-relationship"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":12684972,"title":"Issue in EF, mapping fragment,no default value and is not nullable","body":"<p>I am developing MVC 3 Applicaiton.</p>\n\n<p>I have Model first approch. </p>\n\n<p>I have Company Entity(Abstract).\nLead and Customer is inherited from the company entity. </p>\n\n<p>When I tried to validate the model, Its gives an errror. </p>\n\n<blockquote>\n  <p>Error 41  Error 3023: Problem in mapping fragments starting at line\n  70:Column Companies.Status in table Companies must be mapped: It has\n  no default value and is not nullable.</p>\n</blockquote>\n\n<p>Here is the mapping of tables.</p>\n\n<p><img src=\"http://i.stack.imgur.com/9NCmL.jpg\" alt=\"enter image description here\"></p>\n\n<p>And Here is the EDMX code in HTML View.</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;edmx:Edmx Version=\"2.0\" xmlns:edmx=\"http://schemas.microsoft.com/ado/2008/10/edmx\"&gt;\n  &lt;!-- EF Runtime content --&gt;\n  &lt;edmx:Runtime&gt;\n    &lt;!-- SSDL content --&gt;\n    &lt;edmx:StorageModels&gt;\n    &lt;Schema Namespace=\"Model1.Store\" Alias=\"Self\" Provider=\"System.Data.SqlClient\" ProviderManifestToken=\"2008\" xmlns=\"http://schemas.microsoft.com/ado/2009/02/edm/ssdl\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\"&gt;\n    &lt;EntityContainer Name=\"Model1StoreContainer\"&gt;\n\n        &lt;EntitySet Name=\"Companies\" EntityType=\"Model1.Store.Companies\" store:Type=\"Tables\" Schema=\"dbo\" /&gt;\n\n    &lt;/EntityContainer&gt;\n\n    &lt;EntityType Name=\"Companies\"&gt;\n        &lt;Key&gt;\n            &lt;PropertyRef Name=\"Id\" /&gt;\n        &lt;/Key&gt;\n        &lt;Property Name=\"Id\" Type=\"int\" StoreGeneratedPattern=\"Identity\" Nullable=\"false\" /&gt;\n        &lt;Property Name=\"Name\" Type=\"nvarchar(max)\" Nullable=\"false\" /&gt;\n        &lt;Property Name=\"Status\" Type=\"nvarchar(max)\" Nullable=\"false\" /&gt;\n        &lt;Property Name=\"__Disc__\" Type=\"nvarchar\" MaxLength=\"Max\" Nullable=\"false\" /&gt;\n    &lt;/EntityType&gt;\n&lt;/Schema&gt;&lt;/edmx:StorageModels&gt;\n    &lt;!-- CSDL content --&gt;\n    &lt;edmx:ConceptualModels&gt;\n      &lt;Schema xmlns=\"http://schemas.microsoft.com/ado/2008/09/edm\" xmlns:cg=\"http://schemas.microsoft.com/ado/2006/04/codegeneration\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" Namespace=\"Model1\" Alias=\"Self\" xmlns:annotation=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\"&gt;\n        &lt;EntityContainer Name=\"Model1Container\" annotation:LazyLoadingEnabled=\"true\"&gt;\n          &lt;EntitySet Name=\"Companies\" EntityType=\"Model1.Company\" /&gt;\n          &lt;/EntityContainer&gt;\n        &lt;EntityType Name=\"Company\" Abstract=\"true\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"Id\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Type=\"Int32\" Name=\"Id\" Nullable=\"false\" annotation:StoreGeneratedPattern=\"Identity\" /&gt;\n          &lt;Property Type=\"String\" Name=\"Name\" Nullable=\"false\" /&gt;\n        &lt;/EntityType&gt;\n        &lt;EntityType Name=\"Lead\" BaseType=\"Model1.Company\" &gt;\n          &lt;Property Type=\"String\" Name=\"Status\" Nullable=\"false\" /&gt;\n        &lt;/EntityType&gt;\n      &lt;/Schema&gt;\n    &lt;/edmx:ConceptualModels&gt;\n    &lt;!-- C-S mapping content --&gt;\n    &lt;edmx:Mappings&gt;\n    &lt;Mapping Space=\"C-S\" xmlns=\"http://schemas.microsoft.com/ado/2008/09/mapping/cs\"&gt;\n    &lt;EntityContainerMapping StorageEntityContainer=\"Model1StoreContainer\" CdmEntityContainer=\"Model1Container\"&gt;\n        &lt;EntitySetMapping Name=\"Companies\"&gt;\n            &lt;EntityTypeMapping TypeName=\"IsTypeOf(Model1.Company)\"&gt;\n                &lt;MappingFragment StoreEntitySet=\"Companies\"&gt;\n                    &lt;ScalarProperty Name=\"Id\" ColumnName=\"Id\" /&gt;\n                    &lt;ScalarProperty Name=\"Name\" ColumnName=\"Name\" /&gt;\n                    &lt;Condition ColumnName=\"__Disc__\" Value=\"Company\" /&gt;\n                &lt;/MappingFragment&gt;\n            &lt;/EntityTypeMapping&gt;\n            &lt;EntityTypeMapping TypeName=\"Model1.Lead\"&gt;\n                &lt;MappingFragment StoreEntitySet=\"Companies\"&gt;\n                    &lt;ScalarProperty Name=\"Id\" ColumnName=\"Id\" /&gt;\n                    &lt;ScalarProperty Name=\"Name\" ColumnName=\"Name\" /&gt;\n                    &lt;ScalarProperty Name=\"Status\" ColumnName=\"Status\" /&gt;\n                    &lt;Condition ColumnName=\"__Disc__\" Value=\"Lead\" /&gt;\n                &lt;/MappingFragment&gt;\n            &lt;/EntityTypeMapping&gt;\n        &lt;/EntitySetMapping&gt;\n    &lt;/EntityContainerMapping&gt;\n&lt;/Mapping&gt;&lt;/edmx:Mappings&gt;\n  &lt;/edmx:Runtime&gt;\n  &lt;!-- EF Designer content (DO NOT EDIT MANUALLY BELOW HERE) --&gt;\n  &lt;edmx:Designer xmlns=\"http://schemas.microsoft.com/ado/2008/10/edmx\"&gt;\n    &lt;edmx:Connection&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"MetadataArtifactProcessing\" Value=\"EmbedInOutputAssembly\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/edmx:Connection&gt;\n    &lt;edmx:Options&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"ValidateOnBuild\" Value=\"true\" /&gt;\n        &lt;DesignerProperty Name=\"EnablePluralization\" Value=\"True\" /&gt;\n        &lt;DesignerProperty Name=\"DatabaseGenerationWorkflow\" Value=\"$(VSEFTools)\\DBGen\\Generate T-SQL Via T4 (TPH).xaml\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/edmx:Options&gt;\n    &lt;!-- Diagram content (shape and connector positions) --&gt;\n    &lt;edmx:Diagrams&gt;\n      &lt;Diagram Name=\"Model1\" &gt;\n        &lt;EntityTypeShape EntityType=\"Model1.Company\" Width=\"1.5\" PointX=\"2.375\" PointY=\"0.875\" Height=\"1.2636116536458335\" /&gt;\n        &lt;EntityTypeShape EntityType=\"Model1.Lead\" Width=\"1.5\" PointX=\"3.375\" PointY=\"2.625\" Height=\"1.0992643229166665\" /&gt;\n        &lt;InheritanceConnector EntityType=\"Model1.Lead\" &gt;\n          &lt;ConnectorPoint PointX=\"3.125\" PointY=\"2.1386116536458335\" /&gt;\n          &lt;ConnectorPoint PointX=\"3.125\" PointY=\"2.325\" /&gt;\n          &lt;ConnectorPoint PointX=\"4.125\" PointY=\"2.325\" /&gt;\n          &lt;ConnectorPoint PointX=\"4.125\" PointY=\"2.625\" /&gt;\n        &lt;/InheritanceConnector&gt;\n        &lt;/Diagram&gt;\n    &lt;/edmx:Diagrams&gt;\n  &lt;/edmx:Designer&gt;\n&lt;/edmx:Edmx&gt;\n</code></pre>\n\n<p>Whats is the issue ? </p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":88,"score":3,"question_id":12263200,"title":"EF Power Tools Beta 2 - exception has been thrown by the target of an invocation","body":"<p>I have EF 5.0 code-first VS 2012 project and all Entity Framework menu commands (View Entity Data Model DDL SQL) produce \"Exception has been thrown by the target of an invocation\" popup. I think what has also changed is that EF Power Tools Beta 1 (or VS 2010, I am not sure) use to display EF Power Tools messages in the output window. Now all I get is the popup... Is this VS or Power Tools issue?</p>\n"},{"tags":["c#","entity-framework","unit-testing","dbcontext"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":100,"score":4,"question_id":12786254,"title":"Should unit test project has reference to EF dll when context is abstracted","body":"<p>I am abstracting my DbContext in an attempt to address Separate of Concerns and make my code unit-testable. In order to do that I have come up with following interface.</p>\n\n<p>This interface below is hosted in Assembly named <strong>AllInterfaces</strong>. This project has a reference to EF dll due to IDbSet in declaration below.</p>\n\n<pre><code>public interface ISalesContext : IDisposable   \n{   \n  IDbSet&lt;Customer&gt; Customers { get; }   \n  IDbSet&lt;Order&gt; Orders { get; }   \n  IDbSet&lt;Product&gt; Products { get; }    \n}    \n</code></pre>\n\n<p>I also created a fake db set as follows.</p>\n\n<pre><code>public class FakeDataSet&lt;T&gt; : IDbSet&lt;T&gt; where T: class, new()\n{\n .......\n}\n</code></pre>\n\n<p>So for my Customer object, this fake dataset look like below.</p>\n\n<pre><code>public class FakeCustomerDbSet : FakeDbSet&lt;Customer&gt;\n    {\n     ..............\n    }\n</code></pre>\n\n<p>Then I created my fake context as follows.</p>\n\n<pre><code>public class FakeSalesContext : ISalesContext \n    {\n        public FakeSalesContext ()\n        {\n            Customers = new FakeCustomerDbSet ();\n\n        }\n\n        public IDbSet&lt;Customer&gt; Customers { get; set; }\n        public IDbSet&lt;Order&gt; Orders{ get; private set; }\n        public IDbSet&lt;Product&gt; Products { get; private set; }\n\n        public void Dispose()\n        {\n\n        }\n    }\n</code></pre>\n\n<p>All the above classes (FakeDataSet,  FakeCustomerDbSet and FakeSalesContext ) related to fake objects live in an assembly <strong>AllFakes</strong>. I had to add a reference to EF dll as IDbSet interface is referred in these fake classes as well.</p>\n\n<p>Then I have my unit test project where I am using fake objects for performing unit testing. </p>\n\n<pre><code>ISalesContext Context = new FakeSalesContext ();\nContext.Customers.Add(new Customer() { Id = 1, LastName = \"Karen\" } );\n</code></pre>\n\n<p>Problem is that this unit test requires me to add reference to Entity framework dll. If I remove EF reference, I get following compilation error.</p>\n\n<blockquote>\n  <p>The type 'System.Data.Entity.IDbSet`1' is defined in an assembly\n  that is not referenced. You must add a reference to assembly\n  'EntityFramework, Version=4.4.0.0, Culture=neutral,\n  PublicKeyToken=b77a5c561934e089'.</p>\n</blockquote>\n\n<p>If I remove EF dll reference from AllFakes assembly, I get following  error. </p>\n\n<blockquote>\n  <p>The type or namespace name 'IDbSet' could not be found (are you \n  missing a using directive or an assembly reference?)</p>\n</blockquote>\n\n<p>Does it make sense to add a reference to EF dll to all these assemblies? To me, since I have abstracted my db context, it should not be needed here. Any suggestions on how to accomplish that?</p>\n"},{"tags":["json","asp.net-mvc-3","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12785598,"title":"string linq to entities error - json","body":"<p>I am trying to map various markers on google map with a info window. It is all working fine till I try to pass a string through the controller.</p>\n\n<p>I get the error below:</p>\n\n<blockquote>\n  <p>\"LINQ to Entities does not recognize the method 'System.String GetMainPhoto(Int32)' method, and this method cannot be translated into a store expression.\"</p>\n</blockquote>\n\n<p>I have read this is mainly caused because ToString method or some other methods are not valid to use. But, I am not really sure how to correct this error in this case.</p>\n\n<p>Basically, I have a db - PropertyPhoto that holds the filename of the pictures. GetMainPhoto basically looks up all the rows and returns the main pic file name.</p>\n\n<pre><code>public string GetMainPhoto(int id)\n        {\n            return db.PropertyPhotos.Single(p =&gt; p.PropertyId == id &amp;&amp; p.MainPic == true).PhotoLocation;\n\n        }\n</code></pre>\n\n<p>Controller is as follows:</p>\n\n<pre><code>public ActionResult Map()\n        {\n            if (Request.IsAjaxRequest())\n            {\n                var properties = websiteRepository.FindAllProperties();\n\n                var jsonProperties = from property in properties\n                                     select new JsonProperty\n                                     {\n                                         PropertyId = property.PropertyId,\n                                         NoOfBedroom = property.NoOfBedrooms,\n                                         Price = property.Price,\n                                         Address1 = property.PropertyAddress.Address1,\n                                         MainPicSrc = websiteRepository.GetMainPhoto(property.PropertyId),\n                                         Latitude = property.PropertyAddress.Latitude,\n                                         Longitude = property.PropertyAddress.Longitude\n                                     };\n\n                return Json(jsonProperties.ToList(), JsonRequestBehavior.AllowGet);\n            }\n            else \n            {\n                return View();\n            }\n        }\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":12784127,"title":"Entity Framework AddObject to only \"INSERT INTO\" certain columns","body":"<p>We have a system that will use the same code to communicate with different client databases. These databases will use the same EF Model, but different connection strings.</p>\n\n<p>Our problem is, not every site will be using the same <strong>version</strong> of our database structure; some might be missing a few columns or contain a few old columns.</p>\n\n<p>If we upgrade the system to the current version, now the database model now has an extra <code>EmergencyContact</code> column. All older databases will now fail, because EF is trying to insert into this column (even though we have not set a value for this property).</p>\n\n<p>Is there a way of telling EF to only use columns for which we have a value for, when it generates the INSERT INTO query?</p>\n"},{"tags":["mysql","entity-framework","context"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12783726,"title":"Why context connection String isn't updated","body":"<p>I'm trying to connect my application to MySql using CodeFirst but I'm getting an error that's making me crazy with Context ConnectionString.</p>\n\n<ul>\n<li>Entity Framework 4.3.1</li>\n<li>MySql Connector 6.6.3</li>\n</ul>\n\n<p>Web.config:</p>\n\n<pre><code>   &lt;connectionStrings&gt;\n     &lt;add name=\"PersonalContext\" connectionString=\"server=localhost;UserId=root;password=1234;database=school;\" providerName=\"MySql.Data.MySqlClient\" /&gt;\n   &lt;/connectionStrings&gt;\n\n\n  &lt;system.data&gt;\n    &lt;DbProviderFactories&gt;\n      &lt;remove invariant=\"MySql.Data.MySqlClient\" /&gt;\n      &lt;add name=\"MySQL Data Provider\" invariant=\"MySql.Data.MySqlClient\" description=\".Net Framework Data Provider for MySQL\"  type=\"MySql.Data.MySqlClient.MySqlClientFactory, MySql.Data, Version=6.6.3.0, Culture=neutral, PublicKeyToken=852c9eb6525c1b53\" /&gt;\n    &lt;/DbProviderFactories&gt;\n  &lt;/system.data&gt;\n</code></pre>\n\n<p>Controller:</p>\n\n<blockquote>\n  <p>var ctx = new SchoolContext();<br>\n   ctx.Database.Initialize(true);</p>\n</blockquote>\n\n<p>I would like to know why ctx.Connection.Connectionstring still with SQLEXPRESS</p>\n\n<blockquote>\n  <p>\"Data Source=.\\SQLEXPRESS;Initial\n  Catalog=MysqlTesting.Controllers.SchoolContext;Integrated\n  Security=True;MultipleActiveResultSets=True;Application\n  Name=EntityFrameworkMUE\"</p>\n</blockquote>\n\n<p>I'm new with entityFramework and I would like to know what I'm doing wrong on my web.config.</p>\n\n<p>Thank's!</p>\n"},{"tags":["c#","entity-framework","clr","x64","invalidprogramexception"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":283,"score":2,"question_id":5480972,"title":"CLR detected an invalid program with Entity Framework","body":"<p>I am retrieving data from a wordpress database which defines the primary key as <code>decimal</code> and I am using a x64 configuration on the project...</p>\n\n<p>The bit I searched I found out that it is the problem, but I couldn't find a solution.</p>\n\n<p>What do I have to do/download to be able to use <code>decimal</code> as a primary key?</p>\n\n<p><a href=\"http://connect.microsoft.com/VisualStudio/feedback/details/620031/invalidprogramexception-using-entityframework-poco-template-table-w-decimal-primary-key\" rel=\"nofollow\">This issue on Microsoft Connect</a></p>\n"},{"tags":["c#","sql-server","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12773206,"title":"Entity Framework: The argument to DbIsNullExpression must refer to a primitive or reference type","body":"<p>I'm trying to use entity to do this:</p>\n\n<pre><code>    SELECT *\n    FROM aspnet_Users u LEFT JOIN (SELECT u.UserId, p.Permission, p.MediaId, p.Valid\n                         FROM aspnet_Users u LEFT JOIN Permission p ON u.UserId = p.UserId\n                         WHERE p.MediaId = 57 AND p.Valid = 1\n                         ) B \n                         ON u.UserId = B.UserId\n</code></pre>\n\n<p>Here is the C# code:</p>\n\n<pre><code>    var up = from u in en.aspnet_Users\n        join p in en.Permissions\n         on u.UserId equals p.UserId into pu\n        from p2 in pu.DefaultIfEmpty()\n        where p2.MediaId == this.MediaId &amp;&amp; p2.Valid == true\n        select new\n        {\n         u.UserId,\n         p2.PermissionId,\n         p2.Permission1,\n         p2.MediaId,\n         p2.Valid\n        };\n\n    var ul = from us in en.aspnet_Users\n       join pm in up\n            on us.UserId equals pm.UserId into pm1\n       from pm2 in pm1.DefaultIfEmpty()\n       orderby us.LoweredUserName\n       select new PermissionInfo { \n           Permission = (pm2 == null ? -1 : pm2.Permission1), \n           UserName = us.UserName, \n           UserId = us.UserId, \n           PermissionId = (pm2 == null ? -1 : pm2.PermissionId) };\n    ret = ul.ToList();\n</code></pre>\n\n<p>However, got his error at the last line</p>\n\n<p>The argument to DbIsNullExpression must refer to a primitive or reference type.</p>\n\n<p>Anyone knows how to fix this? thanks.</p>\n\n<p>Edit to answer 1 suggestion:</p>\n\n<pre><code>    var up = from u in en.aspnet_Users\n                     join p in en.Permissions\n                         on u.UserId equals p.UserId into pu\n                     from p2 in pu.DefaultIfEmpty()\n                     where p2.MediaId == this.MediaId &amp;&amp; p2.Valid == true\n                     select new {u, p2};\n\n            var ul = from us in en.aspnet_Users\n                     join pm in up\n                          on us.UserId equals pm.u.UserId into pm1\n                     from pm2 in pm1.DefaultIfEmpty()\n                     orderby us.LoweredUserName\n                     select new PermissionInfo\n                     {\n                         Permission = (pm2 == null ? -1 : pm2.p2.Permission1),\n                         UserName = us.UserName,\n                         UserId = us.UserId,\n                         PermissionId = (pm2 == null ? -1 : pm2.p2.PermissionId)\n                     };\n\n            ret = ul.ToList();\n</code></pre>\n"},{"tags":["c#",".net","vb.net","visual-studio-2010","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12783258,"title":"Entity Framework Association Error One to Many","body":"<p>Can anyone tell my why I am getting this error? I have tried adding constraints but it causing tons of other errors and I cant figure it out. It all looks ok to me :\\</p>\n\n<p>This is the error i get </p>\n\n<pre><code>Error   1   Error 3003: Problem in mapping fragments starting at line 265:Given the cardinality of Association End Member Contact, it should be mapped to key columns of the table tbl_Contact_Relationship. Either fix the mapping or change the multiplicity of this end.\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/XLz4s.png\" alt=\"enter image description here\"></p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["asp.net-mvc","entity-framework","razor"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12783400,"title":"Passing Data across multiples views using mvc 3 and EF","body":"<p>maybe this question is seen repetedly around here but i was not able to find a answers.</p>\n\n<p>my project is about reservations for hotels. I have a class Reservation witch has a Icollection of ChoosenRooms and a class that represents de User making the reservation, and other stuff like dates and other stuff.</p>\n\n<p>The process is this:</p>\n\n<p>In my first view I get the chosen rooms, dates, etc, then i pass that to my second view where im going to get the user info, and then i have a third view where i want to show all the gathered information so the user can finally click a button to save the data.</p>\n\n<p>My problem is that i need to pass the reservation object class across all these views. In my testing i see that primitive types pass just fine BUT The iColletion of ChoosenRooms is lost when i post back from the view to the next controller action. </p>\n\n<p>can someone post some example how to, Posting back from a view to a controller, complex types like ChoosenRooms inside another class Reservations, are not lost in the process?</p>\n\n<p>Or maybe explain why this info is lost? </p>\n\n<p>the code:</p>\n\n<pre><code> public class Reserva\n{\n    public virtual int ID { get; set; }\n\n\n\n   [NotMapped]\n    public string[] q { get; set; }\n\n\n    [Display(Name = \"Cliente\")]\n    public virtual Utilizador utilizador { get; set; }\n\n    [Display(Name = \"Quarto\")]\n    public virtual ICollection&lt;Quartos&gt; ChoosenRooms{ get; set; }\n\n    [Display(Name = \"Servios Adicionais\")]\n    public virtual ICollection&lt;ReservasItens&gt; itens { get; set; }\n\n\n\n\n\n\n\n @model SolarDeOura.Models.Reserva\n@{\n    ViewBag.Title = \"AddReservaUser\";\n</code></pre>\n\n<p>Dont kill me to use tempdata... It was the way to pass the inner class ChossenRooms into to my first view</p>\n\n<pre><code>    var _reserva = TempData[\"reserva\"] as Reserva;\n\n}\n\n&lt;h2&gt;AddReservaUser&lt;/h2&gt;\n\n&lt;script src=\"@Url.Content(\"~/Scripts/jquery.validate.min.js\")\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;script src=\"@Url.Content(\"~/Scripts/jquery.validate.unobtrusive.min.js\")\" type=\"text/javascript\"&gt;&lt;/script&gt;\n\n@using (Html.BeginForm())\n{\n    @Html.ValidationSummary(true)\n    &lt;fieldset&gt;\n        &lt;legend&gt;Reserva&lt;/legend&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.dtEntrada)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.DisplayFor(model =&gt; model.dtEntrada)\n        &lt;/div&gt;\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.dtSaida)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.DisplayFor(model =&gt; model.dtSaida)\n        &lt;/div&gt;\n        &lt;div class=\"editor-label\"&gt;\n            @Model.q.Count() Choosen Rooms \n        &lt;/div&gt;\n\n        @foreach (var q in Model.ChoosenRooms)\n        { \n            &lt;ul&gt;\n                &lt;li&gt;\n                    @Html.DisplayFor(modelitem =&gt; q.descricao)\n                &lt;/li&gt;\n            &lt;/ul&gt;\n        }\n</code></pre>\n\n<p>posting back from here is the Problem. In this view \"   @foreach (var q in Model.ChoosenRooms)\" has data but posting back the data is lost.</p>\n"},{"tags":["c#",".net","ajax","web-services","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12783063,"title":"Issue with Entity Framework class being returned via Web Service","body":"<p>I've implemented a web service and I am calling it via ajax. \n<br /><em>Note: My entities have been made for an entity framework code first purpose.</em></p>\n\n<p>My ajax looks as follows:</p>\n\n<pre><code>$.ajax({\n   type: \"GET\",\n   url: \"/MyProject/MyService.svc/GetEntity\",\n   data: \"entityID=1\",\n   dataType: \"json\",\n   contentType: \"application/json; charset=utf-8\",\n   success: AjaxSucceeded,\n   error: function (msg, status, extra) {\n      alert(status + \" - \" + extra);\n   }\n });\n</code></pre>\n\n<p>AjaxSucceeded is simply a function with the data variable where I am simply logging the data in the console.</p>\n\n<p>My GetEntity function currently looks like this:</p>\n\n<pre><code>[OperationContract]\n[WebGet(ResponseFormat = WebMessageFormat.Json)]\npublic MyEntity GetEntity(int entityID)\n{\n    AccessObject accessObject = new AccessObject(\"MyConnectionString\");\n\n    MyEntity theEntity = accessObject.GetByID(entityID);\n\n    return theEntity;\n}\n</code></pre>\n\n<p>I have tested this with a class created purposefully for testing and it worked as expected (for example, I created a MyEntity class within the web service that was very simple, a couple of properties and no other methods etc.). </p>\n\n<p>The problems arises when I return an entity that I have made for code first Entity Framework. It doesn't work, the web service function is called multiple times and then an error appears in the console stating \"Failed to load resource\" referring to my service function.</p>\n\n<p>For reference, here is my entity:</p>\n\n<pre><code>[DataContract(IsReference=true)]\npublic class MyEntity\n{\n    #region Properties\n\n    [Key]\n    [DataMember]\n    public int ID { get; set; }\n\n    public bool SomeBoolean { get; set; }\n\n    [StringLength(1000)]\n    public string Description { get; set;}\n\n    #endregion\n\n    #region Relationships\n\n    public virtual SomeOtherEntity OtherEntity { get; set; }\n\n    #endregion\n\n}\n</code></pre>\n\n<p>I have only set the ID to be DataMember for testing but still no success.</p>\n\n<p>Could anyone point me in the correct direction? I know the web service works because other functions work and if I set up a local (within the web service) class it will return that with no issues. So I'm of the assumption that it has something to do with the entity framework attributes? I may be wrong but that's all I can imagine.</p>\n\n<p>Thank you for your time.</p>\n\n<p>Oh also, for reference, my service class has the following attributes:</p>\n\n<pre><code>[ServiceContract(Namespace = \"\")]\n[AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Allowed)]  \n</code></pre>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12761217,"title":"Auto generate business objects from entity framework plus auto mapping","body":"<p>For a large project with hundreds of tables, is there a way to automatically generate the business objects based on the .edmx file rather than to create them manually one by one?</p>\n"},{"tags":["c#","entity-framework","ef-code-first","structuremap"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12782608,"title":"Ef CodeFirst entity is not getting mapped in Structuremap","body":"<p>At the moment I'm implementing a persistence Layer with Entity Framework 5 and Code First. I ran into some difficulties that seem to stem from my lack of understanding of StructureMap.</p>\n\n<p>The model should not pose a problem since I already created the databse before I started to fit StructureMap to the code.</p>\n\n<p>As stated in the headline, I'm getting the StructureMap exception that my entities aren't mapped. The Entities represent my LinearAxis Measurements that I want to persist. </p>\n\n<p>I have the class Measurement which holds three distinctive measurements and a collection of the ongoing Axismeasurtements that are taken in intervals.</p>\n\n<pre><code>public class Measurement : MeasureTimestamp, IMeasurementEntity\n{\n    #region IMeasurementEntity Members\n\n    public long ID { get; set; }\n\n    public long? TkMeasureId { get; set; }\n    public long? CMeasureId { get; set; }\n    public long? CpMeasureId { get; set; }\n    public string User { get; set; }\n    public string Axis { get; set; }\n\n    [ForeignKey(\"CMeasureId\")]\n    public virtual ICMeasureEntity CMeasure { get; set; }\n\n    [ForeignKey(\"CpMeasureId\")]\n    public virtual ICpMeasureEntity CpMeasure { get; set; }\n\n    [ForeignKey(\"TkMeasureId\")]\n    public virtual ITkMeasureEntity TkMeasure { get; set; }\n\n    public virtual ICollection&lt;IAppValuesEntity&gt; AppValues { get; set; }\n\n    #endregion\n}\n</code></pre>\n\n<p>The three measurements have a One to One or Zero Relationship with the Parent. Every Measurement itself incorporates a collection of Measurement Values which are represented through a ValuesEntity and data which is calculated from these values.</p>\n\n<p>On a sidenote, does anyone know how I can map the One to One or Zero Relationship without haveing to resort to Annotations? I configured the behaviour via FluentApi, but couldn't define a foreign Key in the parent.</p>\n\n<p>Configuration for Entity Measurement is as follows.</p>\n\n<pre><code>public class MeasurementModelConfig : EntityTypeConfiguration&lt;IMeasurementEntity&gt;\n{\n    public MeasurementModelConfig()\n    {\n        HasKey(x =&gt; x.ID)\n            .Property(x =&gt; x.ID)\n            .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n\n        HasOptional(x =&gt; x.CMeasure)\n            .WithRequired(x =&gt; x.Measurement)\n            .WillCascadeOnDelete(true);\n\n        HasOptional(x =&gt; x.CpMeasure)\n            .WithRequired(x =&gt; x.Measurement)\n            .WillCascadeOnDelete(true);\n\n        HasOptional(x =&gt; x.TkMeasure)\n            .WithRequired(x =&gt; x.Measurement)\n            .WillCascadeOnDelete(true);\n\n        HasMany(x =&gt; x.AppValues)\n            .WithRequired(x =&gt; x.Measurement)\n            .HasForeignKey(x =&gt; x.MeasurementId)\n            .WillCascadeOnDelete(true);\n\n        Property(x =&gt; x.User)\n            .HasMaxLength(20)\n            .IsRequired();\n\n        Property(x =&gt; x.Axis)\n            .HasMaxLength(20)\n            .IsRequired();\n    }\n}\n</code></pre>\n\n<p>My Interfaces for all the Entities are a bit in shambles since I haven't condsidered a good approach yet, and made it up as I was going. The DataBase Interfaces are as follows.</p>\n\n<pre><code>public interface IChildEntity : IEntity\n{\n    long MeasurementId { get; set; }\n}\n\npublic interface IEntity\n{\n    long ID { get; set; }\n    DateTime Timestamp { get; set; }\n}\n\npublic interface IMeasureEntity : IChildEntity\n{\n    IMeasurementEntity Measurement { get; set; }\n}\n\npublic interface IValueEntity : IChildEntity\n{        \n    IMeasureEntity Measurement { get; set; }\n}\n</code></pre>\n\n<p>The Entity Interfaces are a composition of the Database Interfaces and the Dto Interfaces.\nSince the Entities are rather compact and the first step of the programm is to have everything localy, I didn't implement Dtos but use Interfaces instead to make sure the Applicationlayer cannot mess with the Entities.</p>\n\n<pre><code>public interface IMeasurementEntity : IEntity, IMeasurement\n{\n    ICollection&lt;IAppValuesEntity&gt; AppValues { get; set; }        \n    ICMeasureEntity CMeasure { get; set; }\n    long? CMeasureId { get; set; }\n    ICpMeasureEntity CpMeasure { get; set; }\n    long? CpMeasureId { get; set; }\n    ITkMeasureEntity TkMeasure { get; set; }\n    long? TkMeasureId { get; set; }        \n}\n\npublic interface IAppValuesEntity : IAppValues, IMeasureEntity { }\n\npublic interface ICMeasureEntity : IMeasureEntity, ICMeasure \n{\n    ICollection&lt;ICMeasureValuesEntity&gt; MeasureValues { get; set; }\n}\n\npublic interface ICMeasureValuesEntity : IValueEntity, ICMeasureValues { }\n\npublic interface ICpMeasureEntity : IMeasureEntity, ICpMeasure \n{\n    ICollection&lt;ICpMeasureValuesEntity&gt; MeasureValues { get; set; }\n}\n\npublic interface ICpMeasureValuesEntity : IValueEntity, ICpMeasureValues { }\n\npublic interface ITkMeasureEntity : IMeasureEntity, ITkMeasure\n{\n    ICollection&lt;ITkMeasureValuesEntity&gt; MeasureValues { get; set; }\n}\n\npublic interface ITkMeasureValuesEntity : IValueEntity, ITkMeasureValues { }\n</code></pre>\n\n<p>My DbContext Implementation is as follows.</p>\n\n<pre><code>public class MeasureContext : DbContext\n{\n    public MeasureContext(string conString)\n        : base(conString)\n    {\n        Configuration.AutoDetectChangesEnabled = true;\n        Configuration.LazyLoadingEnabled = true;\n        Configuration.ProxyCreationEnabled = true;\n\n        Database.CreateIfNotExists();\n    }        \n\n    public DbSet&lt;IMeasurementEntity&gt; Measurements { get; set; }\n    public DbSet&lt;IAppValuesEntity&gt; AppValues { get; set; }\n    public DbSet&lt;ICMeasureEntity&gt; CMeasurements { get; set; }\n    public DbSet&lt;ICMeasureValuesEntity&gt; CMeasureValues { get; set; }\n    public DbSet&lt;ICpMeasureValuesEntity&gt; CpMeasureValues { get; set; }\n    public DbSet&lt;ICpMeasureEntity&gt; CpMeasurements { get; set; }\n    public DbSet&lt;ITkMeasureEntity&gt; TkMeasurements { get; set; }\n    public DbSet&lt;ITkMeasureValuesEntity&gt; TkMeasureValues { get; set; }\n\n    public void OpenConnection()\n    {\n        Database.Connection.Open();\n    }\n\n    public void DropDb()\n    {\n        Database.Delete();\n    }\n\n    public void CloseConnection()\n    {\n        Database.Connection.Close();\n        Dispose();\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new MeasurementModelConfig());\n        modelBuilder.Configurations.Add(new CMeasureModelConfig());\n        modelBuilder.Configurations.Add(new CpMeasureModelConfig());\n        modelBuilder.Configurations.Add(new TkMeasureModelConfig());\n        modelBuilder.Configurations.Add(new AppValuesModelConfig());\n        modelBuilder.Configurations.Add(new TkMeasureValuesModelConfig());\n        modelBuilder.Configurations.Add(new CMeasureValuesModelConfig());\n        modelBuilder.Configurations.Add(new CpMeasureValuesModelConfig());\n        base.OnModelCreating(modelBuilder);\n    }\n}\n</code></pre>\n\n<p>And my StructureMap Configuration is as follows.</p>\n\n<pre><code>public class DbRegistry : Registry\n{\n    public DbRegistry()\n    {\n\n        For&lt;IMeasurementEntity&gt;().Use&lt;Measurement&gt;();\n        For&lt;ICMeasureEntity&gt;().Use&lt;CMeasure&gt;();\n        For&lt;ICpMeasureEntity&gt;().Use&lt;CpMeasure&gt;();\n        For&lt;ITkMeasureEntity&gt;().Use&lt;TkMeasure&gt;();\n        For&lt;ICMeasureValuesEntity&gt;().Use&lt;CMeasureValues&gt;();\n        For&lt;ICpMeasureValuesEntity&gt;().Use&lt;CpMeasureValues&gt;();\n        For&lt;ITkMeasureValuesEntity&gt;().Use&lt;TkMeasureValues&gt;();\n        For&lt;IAppValuesEntity&gt;().Use&lt;AppValues&gt;();\n\n        ForSingletonOf&lt;IMeasurementRepository&gt;().Use&lt;MeasurementRepository&gt;();\n        For(typeof(IMeasureRepository&lt;&gt;)).Use(typeof(MeasureRepository&lt;&gt;));\n        For(typeof(IValuesRepository&lt;&gt;)).Use(typeof(ValuesRepository&lt;&gt;));\n\n        //var con = ConfigurationManager.ConnectionStrings[\"MySqlMeasureDb\"];\n\n        For&lt;MeasureContext&gt;().Use(x =&gt; new MeasureContext(\"MySqlMeasureDb\"));\n        ForSingletonOf&lt;IFileManagement&gt;().Use&lt;FileManagement&gt;();\n\n    }\n}\n</code></pre>\n\n<p>I have three types of generic Repositories which all inherit from my abstract class Repository and supply their bass class with a MeasureContext.</p>\n\n<pre><code>public class MeasureRepository&lt;T&gt; : Repository&lt;T&gt;, IMeasureRepository&lt;T&gt; where T : class, IMeasureEntity\n{\n    public MeasureRepository(MeasureContext context)\n        : base(context)\n    {\n    }\n\n    public T GetByMeasurement(long id)\n    {\n        return _dbSet.FirstOrDefault(x =&gt; x.MeasurementId == id);\n    }\n}\n</code></pre>\n\n<p>I would like to AutoWire that reference but I think I kind of don't get it right. As far as I know the problem should lie somewhere around here, but I can't debug in StructureMap so I can't do much but speculate.</p>\n\n<p>In my StructureMap Bootstrap I validate the given configuration.</p>\n\n<pre><code>public class Bootstrapper : IBootstrapper\n{\n    private static bool _hasStarted;\n    private static Bootstrapper _instance;\n\n    public static Bootstrapper GetInstance\n    {\n        get\n        {\n            if (_instance == null)\n                _instance = new Bootstrapper();\n\n            return _instance;\n        }\n    }\n\n    /// &lt;summary&gt;\n    /// Registers Controller and Models\n    /// &lt;/summary&gt;\n    public void BootstrapStructureMap()\n    {            \n        ObjectFactory.Initialize(x =&gt; x.AddRegistry(new DbRegistry()));\n        **ObjectFactory.AssertConfigurationIsValid();**\n    }\n\n    /// &lt;summary&gt;\n    /// Resets values to default if Bootstrapper hasnt been started\n    /// &lt;/summary&gt;\n    public static void Restart()\n    {\n        if (_hasStarted)\n        {\n            ObjectFactory.ResetDefaults();\n        }\n        else\n        {\n            Bootstrap();\n            _hasStarted = true;\n        }\n    }\n\n    /// &lt;summary&gt;\n    /// This static method gets the Bootstrapper and registers Controller and Models\n    /// &lt;/summary&gt;\n    public static void Bootstrap()\n    {\n        GetInstance.BootstrapStructureMap();\n    }\n</code></pre>\n\n<p>and get the following Error:</p>\n\n<hr>\n\n<blockquote>\n  <p>Build Error on Instance '02a4b50c-a236-4185-bacf-6d0cb1396ab0'\n  (Instance is created by Func function: \n  System.Func`2[StructureMap.IContext,Persistence.DataBase.Configuration.MeasureContext])\n      for PluginType Persistence.DataBase.Configuration.MeasureContext, Persistence, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null</p>\n  \n  <p>StructureMap.StructureMapException: StructureMap Exception Code:  207\n  Internal exception while creating Instance\n  '02a4b50c-a236-4185-bacf-6d0cb1396ab0' of PluginType\n  Persistence.DataBase.Configuration.MeasureContext, Persistence,\n  Version=1.0.0.0, Culture=neutral, PublicKeyToken=null.  Check the\n  inner exception for more details. --->\n  System.InvalidOperationException: The type\n  'Persistence.DataBase.Entities.Interface.IMeasurementEntity' was not\n  mapped. Check that the type has not been explicitly excluded by using\n  the Ignore method or NotMappedAttribute data annotation. Verify that\n  the type was defined as a class, is not primitive, nested or generic,\n  and does not inherit from EntityObject.</p>\n</blockquote>\n\n<p>I already tried my luck with StructureMap Scanning instead but since I havent tried it before my experience and understanding of it is even more limited and it still failed with the same Exception. This is what i tried:</p>\n\n<pre><code>public class DbRegistry : Registry\n{\n    public DbRegistry()\n    {\n\n        Scan(x =&gt;\n        {\n            x.WithDefaultConventions();               \n            x.IncludeNamespaceContainingType&lt;IEntity&gt;();\n            x.IncludeNamespaceContainingType&lt;IMeasurementRepository&gt;();\n            x.AddAllTypesOf(typeof(IRepository&lt;&gt;));\n            x.AddAllTypesOf(typeof(IMeasureRepository&lt;&gt;));\n            x.AddAllTypesOf(typeof(IValuesRepository&lt;&gt;));\n            x.ConnectImplementationsToTypesClosing(typeof(IRepository&lt;&gt;));\n            x.ConnectImplementationsToTypesClosing(typeof(IMeasureRepository&lt;&gt;));\n            x.ConnectImplementationsToTypesClosing(typeof(IValuesRepository&lt;&gt;));\n\n            x.SingleImplementationsOfInterface();\n\n        });\n    }\n}\n</code></pre>\n\n<p>Sorry for the long post, I thought it was better to be thorough. Help with the error or any comments what I could do better are very much appreciated.</p>\n"},{"tags":["c#","entity-framework","sql-server-ce"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12754173,"title":"Adding entities to large table using EF takes increasingly more time","body":"<p>I have a very basic data model after trimming down an application to dig up the performance problems i'm facing. The data model exists of two entities, for the example callend Product and Category:</p>\n\n<pre><code>class Product {\n    public virtual int ID {get;set;}\n    public virtual string Name {get;set;}\n    public virtual int CategoryID {get;set;}\n    public virtual Category Category {get;set;}\n}\n\nclass Category {\n    public virtual int ID {get;set;}\n    public virtual string Name {get;set;}\n}\n</code></pre>\n\n<p>When I add 100 new products, all having their reference set to the same category using the CategoryID property, and I call db.SaveChanges() it can take quite some time. I was able to reduce the required time by setting the AutoDetectChangesEnabled to false. But after a couple of more runs I noticed that the amount of time required to insert the 100 new products increases when the amount of products present in the database increase:</p>\n\n<pre><code>23416 --&gt;  +/- 7000 ms\n25516 --&gt;  +/- 7500 ms\n</code></pre>\n\n<p>Because I know the table is going to get a lot bigger in production I would like to know what my options are before I fall back to using raw Sql queries or BulkInsert.</p>\n\n<p>In response to the comments of Stanley and Raphal:</p>\n\n<p>In my test case both the ID properties are primary keys and the CategoryID has an index. There are no triggers etc. </p>\n\n<p>I'm executing a loop 100 times, in which I initialize a new DbContext, insert 100 products and dispose the DbContext.</p>\n\n<p><strong>To be clear: I can create a new project, set up EF with SqlCe, build the data model literally as above using Code-First and get <em>the same results</em>.</strong></p>\n\n<p>After conducting a couple of other tests, it seems that the problem lies around Sql Server Compact Edition. Using regular MSSQL server, the observerd preformance problems are gone, inserting 100 rows now consistently takes around 50ms. Altough I now seem to have found the source of the problem, it still doesn't answer why inserting 100 rows in a compact database using an external query tool doesn't have the same preformance issues as when I insert 100 rows using the EF.</p>\n"},{"tags":["entity-framework","transactions","workflow-foundation-4"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":68,"score":3,"question_id":12777649,"title":"WF4 TransactionScope containing several custom activities with EF4 database updates","body":"<p>I have created several custom activities that update tables in my DB (in this case SQL Server Compact), using Entity Framework 4 with POCOs. </p>\n\n<p>If I put more than one of these inside a WF4 TransactionScope activity, I'm running into problems: EF disposes the DB connection after the first activity has finished, and when the next DB activity tries to do a DB update a new connection is built up. At this moment an exception is thrown.</p>\n\n<pre><code>System.Activities.WorkflowApplicationAbortedException : The workflow has been aborted.\n ----&gt; System.Data.EntityException : The underlying provider failed on Open.\n ----&gt; System.InvalidOperationException : The connection object can not be enlisted in transaction scope.\n</code></pre>\n\n<p>Do I have to keep the EF connection open during the whole transaction scope? How can I do that? Create an explicit custom activity for that, or is there a standard way?</p>\n\n<p><strong>My current workaround</strong> goes like this: I created a new code activity that creates our ObjectContext and explicitely calls dbContext.Connection.Open(). It returns the ObjectContext, which is then saved in a workflow variable. That one is passed to all the DB related activities as an InArgument&lt;>. Inside my DB activities, I use this ObjectContext if it is passed in, otherwise I create a new one.</p>\n\n<p>This does work, but I'm not satisfied with this solution: It needs the new InArgument for every DB related activity. In the workflow designer, I have to insert that special OpenDatabaseConnection activity inside the transaction scope, and then make sure that the correct variable is passed into all DB activities. This seems to be very inelegant and error prone, especially if other team members have to use these DB activities.</p>\n\n<p>What would be a better way to handle this?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity","rename"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12780297,"title":"How to rename an entity in Entity Framework","body":"<p>I am surprised I havent found an easy way to achieve this. I want to rename a table with existing data in it. </p>\n\n<p>For example:</p>\n\n<pre><code>class Person : Entity\n{\n   long PersonId;\n   string name;\n}\n</code></pre>\n\n<p>I would like to rename this to:</p>\n\n<pre><code>class Client : Entity\n{\n   long clientId;\n   string name;\n}\n</code></pre>\n\n<hr>\n\n<p><strong>What I have tried:</strong></p>\n\n<ul>\n<li>Simply renaming the class, and creating a migration. The migration drops the person table, and creates a new client table.</li>\n<li>Create migration first with: <code>RenameTable(\"Person\", \"Client\");</code> This gives me: </li>\n</ul>\n\n<blockquote>\n  <p>Either the parameter @objname is ambiguous or the claimed @objtype (OBJECT) is wrong.</p>\n</blockquote>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":12780346,"title":"Entity Framework: Schema Only","body":"<p>I am using VS2012 and EF (System.Data.Entity v 4.0.0.0).  I created a database-first model via the designer.  How can I create an instance where it does not actually go to the database?  Is there a swtich that tells the current context to not use the connection string and just make an in-memory representation of the graph?</p>\n\n<p>I then tried making a empty constructor to the conext as recommended <a href=\"http://social.msdn.microsoft.com/Forums/en/adodotnetentityframework/thread/488949dc-1c6c-444a-a6cc-d35361203808\" rel=\"nofollow\">here</a>: \nand now I have key violations...</p>\n"},{"tags":["c#","winforms","entity-framework","ef-code-first","sql-server-ce"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":135,"score":5,"question_id":12769113,"title":"EntityFramework CodeFirst Database don't updates","body":"<p>One day ago I started using Entity Framework CodeFirst in simple Windows Forms project (C#). I created two models:</p>\n\n<pre><code>[Table(\"SavesSet\")]\npublic partial class Saves\n{\n    public Saves()\n    {\n        this.SkillsSet = new HashSet&lt;Skills&gt;();\n    }\n\n    [Key]\n    public int SaveID { get; set; }\n\n    public string Player { get; set; }\n    public int Age { get; set; }\n    public int Money { get; set; }\n\n    public virtual ICollection&lt;Skills&gt; SkillsSet { get; set; }\n}\n\n[Table(\"SkillsSet\")]\npublic partial class Skills\n{\n    [Key]\n    public int SkillID { get; set; }\n\n    public string Name { get; set; }\n    public int Value { get; set; }\n    public int SavesSaveID { get; set; }\n\n    public virtual Saves SavesSet { get; set; }\n}\n</code></pre>\n\n<p>Then I added one row into my database using Visual Studio Database Explorer (local database using SqlServerCe 3.5):</p>\n\n<p>SaveID = 1</p>\n\n<p>Player = \"TEST\"</p>\n\n<p>Age = 1</p>\n\n<p>Money = 1</p>\n\n<p>I also created form with ListView and wrote some code:</p>\n\n<pre><code>private SavesContext db = new SavesContext();\nforeach (Saves s in db.SavesSet.ToList())\n{\n    ListViewItem l = new ListViewItem();\n    l.Name = s.SaveID.ToString();\n    l.Text = s.Player;\n    ListViewSaves.Items.Add(l);\n}\n</code></pre>\n\n<p>But when I started program debugging ListView was empty. I set breakpoint, viewed local variables and saw that SavesSet count was 0.</p>\n\n<p>I added one row via code:</p>\n\n<pre><code>Saves s = new Saves();\ns.Player = \"TestName\";\ns.Age = 5110;\ns.Money = 200;\ndb.SavesSet.Add(s);\ndb.SaveChanges();\n</code></pre>\n\n<p>And ListView displayed this one. But in my database there was nothing (and its size didn't change). I restarted Visual Studio - and my trouble was still actual: ListView shows item, but database was empty. I checked ConnectionString in App.Config and in VS Database Explorer - they were equal.</p>\n\n<p>So, my question is: How can I explore my real database and where does it stores?</p>\n\n<p><strong>Update.</strong></p>\n\n<p>My DbContext:</p>\n\n<pre><code>    public SavesContext()\n        : base(\"Saves\")\n    {\n    }\n\n    public DbSet&lt;Saves&gt; SavesSet { get; set; }\n    public DbSet&lt;Skills&gt; SkillsSet { get; set; }\n</code></pre>\n\n<p>And my App.Config:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n    &lt;configuration&gt;\n        &lt;configSections&gt;\n        &lt;/configSections&gt;\n        &lt;connectionStrings&gt;\n            &lt;add name=\"TextSim.Properties.Settings.Saves\" connectionString=\"Data          \n            Source=C:\\Documents and Settings\\My\\My Documents\\visual studio       \n            2010\\Projects\\TextSim\\TextSim\\Saves.sdf\"\n            providerName=\"System.Data.SqlServerCe.3.5\" /&gt;\n        &lt;/connectionStrings&gt;\n     &lt;/configuration&gt;\n</code></pre>\n"}]}
{"total":18927,"page":13,"pagesize":100,"questions":[{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12780045,"title":"When I used TPH, all the tables recreated","body":"<p>I am developing an EF - MVC 3 application. I have used <strong>model first approach</strong>, so I have create model first and from that model, EF generated the DB.</p>\n\n<p>I have used a tool called Nuget - Entity Generator - Database designer for generating the database. When I have designed the model first time, I have used the Generate Migration T-SQL and Deploy option of that tool.</p>\n\n<p>Database generated perfectly and it's working fine...</p>\n\n<p>Now I have come across a situation that I have to make a change to the model and I have to use T-SQL Via T4 (TPH) option to update the database.</p>\n\n<p><img src=\"http://i.stack.imgur.com/UIEqo.jpg\" alt=\"enter image description here\">\nSo previously I used different process to update DB and now I am changing it.</p>\n\n<p>When I use the T-SQL Via T4 (TPH) all the tables get deleted and new tables get created. \nHow to avoid this ? </p>\n\n<p>I want to only update the table which I have made the changes. </p>\n"},{"tags":["c#",".net","entity-framework","exception-handling","entitydatasource"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":6425,"score":0,"question_id":3813750,"title":"Unable to load one or more of the requested types. Retrieve the LoaderExceptions property for more information. with EntityDataSource","body":"<p>Hi i have a problem that only shows if EntityDataSource present on aspx pages ,interesting thing it's just occures when i'm refreshing the page (F5) or viewing it again and it's driving me crazy it's seems to be a bug with entity framework because i tried it with another project and i just get the same error:\nPlease if anyone can help me with this:</p>\n\n<p><em>Unable to load one or more of the requested types. Retrieve the LoaderExceptions property for more information. \nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \nException Details: System.Reflection.ReflectionTypeLoadException: Unable to load one or more of the requested types. Retrieve the LoaderExceptions property for more information.</em></p>\n\n<p>Stack Trace: </p>\n\n<pre><code>[ReflectionTypeLoadException: Unable to load one or more of the requested types. Retrieve the LoaderExceptions property for more information.]\n   System.Reflection.RuntimeModule.GetTypes(RuntimeModule module) +0\n   System.Reflection.RuntimeModule.GetTypes() +4\n   System.Reflection.Assembly.GetTypes() +78\n   System.Data.Metadata.Edm.ObjectItemConventionAssemblyLoader.LoadTypesFromAssembly() +32\n   System.Data.Metadata.Edm.ObjectItemAssemblyLoader.Load() +25\n   System.Data.Metadata.Edm.AssemblyCache.LoadAssembly(Assembly assembly, Boolean loadReferencedAssemblies, ObjectItemLoadingSessionData loadingData) +160\n   System.Data.Metadata.Edm.AssemblyCache.LoadAssembly(Assembly assembly, Boolean loadReferencedAssemblies, KnownAssembliesSet knownAssemblies, EdmItemCollection edmItemCollection, Action`1 logLoadMessage, Object&amp; loaderCookie, Dictionary`2&amp; typesInLoading, List`1&amp; errors) +166\n   System.Data.Metadata.Edm.ObjectItemCollection.LoadAssemblyFromCache(ObjectItemCollection objectItemCollection, Assembly assembly, Boolean loadReferencedAssemblies, EdmItemCollection edmItemCollection, Action`1 logLoadMessage) +316\n   System.Data.Metadata.Edm.ObjectItemCollection.ExplicitLoadFromAssembly(Assembly assembly, EdmItemCollection edmItemCollection, Action`1 logLoadMessage) +53\n   System.Data.Metadata.Edm.MetadataWorkspace.ExplicitLoadFromAssembly(Assembly assembly, ObjectItemCollection collection, Action`1 logLoadMessage) +93\n   System.Data.Metadata.Edm.MetadataWorkspace.LoadFromAssembly(Assembly assembly, Action`1 logLoadMessage) +130\n   System.Web.UI.WebControls.EntityDataSourceView.ConstructContext() +585\n   System.Web.UI.WebControls.EntityDataSourceView.ExecuteSelect(DataSourceSelectArguments arguments) +76\n   System.Web.UI.DataSourceView.Select(DataSourceSelectArguments arguments, DataSourceViewSelectCallback callback) +21\n   System.Web.UI.WebControls.DataBoundControl.PerformSelect() +143\n   System.Web.UI.WebControls.BaseDataBoundControl.DataBind() +74\n   System.Web.UI.WebControls.GridView.DataBind() +4\n   System.Web.UI.WebControls.BaseDataBoundControl.EnsureDataBound() +66\n   System.Web.UI.WebControls.CompositeDataBoundControl.CreateChildControls() +75\n   System.Web.UI.Control.EnsureChildControls() +102\n   System.Web.UI.Control.PreRenderRecursiveInternal() +42\n   System.Web.UI.Control.PreRenderRecursiveInternal() +175\n   System.Web.UI.Control.PreRenderRecursiveInternal() +175\n   System.Web.UI.Control.PreRenderRecursiveInternal() +175\n   System.Web.UI.Control.PreRenderRecursiveInternal() +175\n   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +2496\n</code></pre>\n"},{"tags":[".net","vb.net","entity-framework","optimistic-concurrency"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12779259,"title":"Entity Framework entity update ignoring timestamp","body":"<p>I'm trying to implement optimistic concurrency checking. I make use of the generic repository and unit of work patterns.</p>\n\n<p>I have introduced a Timestamp-attributed property (as byte array) to my entity, which increases the value automatically whenever I update data (seems to be database managed, which is what it should do).</p>\n\n<p>I load the updated values from a view model by mapping the VM to the actual model (using automapper). This results in a new (detached?) instance of an entity of the correct type with all the according fields set (including the timestamp).</p>\n\n<p>The update itself is performed like</p>\n\n<pre><code>i_oOldEntity =  m_oDbSet.Find(i_oEntity.MaterialId)\ncontext.Entry(i_oOldEntity).CurrentValues.SetValues(i_oEntity)\ncontext.SaveChanges()\n</code></pre>\n\n<p>with i_oEntity being the automapped entity.</p>\n\n<p>This updates the values itself fine, however it completely ignores the timestamp-value coming from the viewmodel. The resulting SQL code uses the latest rowversion value in the WHERE clause.</p>\n\n<p>In short: how do I get my viewmodel-timestamp values to be used in the WHERE clause from EF?</p>\n"},{"tags":["c#","entity-framework","localdb"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1545,"score":3,"question_id":9716372,"title":"Is LocalDB supported by Visual Studio 2010 in Entity Framework 5?","body":"<p>Is LocalDB supported by Visual Studio 2010 in Entity Framework 5, on .NET 4.0?</p>\n\n<p>Or am I doing it wrong? I'm getting a \"The network path can't be found\" issue when instantiating my model container with a connection string for LocalDB.</p>\n\n<p>Here's the connection string:</p>\n\n<pre><code>var connectionString = \"metadata=res://*/Model.csdl|res://*/Model.ssdl|res://*/Model.msl;provider=System.Data.SqlClient;provider connection string=\\\"data source=(localdb)\\v11.0;initial catalog=fablelane_com_db;integrated security=SSPI;multipleactiveresultsets=True;App=EntityFramework\\\"\";\n</code></pre>\n\n<p><strong>Edit 1</strong>\nI'm receiving the following error when connecting, more specifically: </p>\n\n<p><em>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server).</em></p>\n\n<p><strong>Edit 2</strong>\nI just figured out that changing to Visual Studio 11 beta doesn't work either. Still receiving the same error-message.</p>\n"},{"tags":["c#","asp.net-mvc","asp.net-mvc-3","entity-framework","razor"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":11810558,"title":"MVC 3 - Exception Details: System.InvalidOperationException","body":"<p>I trying  get all data from my two tables but I have a lot of compile problems. Do you know where is it problem? Also I would like to declaration two tables here return \"View(repository.Towar);\" Now is visible one but I don`t know what should I do also this \"se.Towar_zakupiony\". </p>\n\n<p><strong>I found solution myself:</strong> </p>\n\n<p>code:</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\nusing System.Web.Mvc;\nusing SportsStore.Abstract;\nusing SportsStore.Entities;\n\nnamespace SportsStore.WebUI.Controllers\n{\n    public class ProductController : Controller\n    {\n        //\n        // GET: /Product/\n            public ITowarRepository repository;\n            public IKategorieRepository re;\n\n            public ProductController(ITowarRepository productRepository, IKategorieRepository kategorie) \n            {\n            repository = productRepository;\n            re = kategorie;\n            }\n\n            public ViewResult List()\n            {\n                SomeViewModel viewModel = new SomeViewModel\n                {\n                    Towar = repository.Towar\n                    .OrderBy(p =&gt; p.Id_tow),\n                    Kategorie = re.Kategorie\n                    .OrderBy(p =&gt; p.Id_kat)\n\n                };\n\n                return View(viewModel);\n            }\n\n    }\n}\n</code></pre>\n\n<p>code:</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\n\nnamespace SportsStore.Entities\n{\n    public class SomeViewModel\n    {\n        public IEnumerable&lt;SportsStore.Entities.Towar&gt; Towar { get; set; }\n        public IEnumerable&lt;SportsStore.Entities.Kategorie&gt; Kategorie { get; set; }\n        public IEnumerable&lt;SportsStore.Entities.Zdjecie&gt; Zdjecie { get; set; }\n        public IEnumerable&lt;SportsStore.Entities.Typ_zdjecia&gt; Typ_zdjecia { get; set; }\n        public IEnumerable&lt;SportsStore.Entities.Zakup&gt; Zakup { get; set; }\n        public IEnumerable&lt;SportsStore.Entities.Adres&gt; Adres { get; set; }\n        public IEnumerable&lt;SportsStore.Entities.Status&gt; Status { get; set; }\n        public IEnumerable&lt;SportsStore.Entities.Towar_Zakupiony&gt; Towar_zakupiony { get; set; }\n\n\n    }\n}\n</code></pre>\n\n<p>code:</p>\n\n<pre><code>@model SportsStore.Entities.SomeViewModel\n\n@{\n    ViewBag.Title = \"List\";\n    Layout = \"~/Views/Shared/_Layout.cshtml\";\n}\n\n&lt;h2&gt;List&lt;/h2&gt;\n\n@foreach (var p in Model.Towar)\n{\n&lt;div class=\"item\"&gt;\n&lt;h3&gt;@p.Nazwa&lt;/h3&gt;\n@p.Opis\n&lt;h4&gt;@p.Cena.ToString(\"c\")&lt;/h4&gt;\n&lt;/div&gt;\n}\n\n&lt;h2&gt;List&lt;/h2&gt;\n\n@foreach (var b in Model.Kategorie)\n{\n&lt;div class=\"item\"&gt;\n&lt;h3&gt;@b.Nazwa&lt;/h3&gt;\n&lt;/div&gt;\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","entity-framework","mvc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12777458,"title":"How To Get Value From DB While Editting Entry with Null value","body":"<p><strong>Error Message:</strong>\nAn object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key.</p>\n\n<p>I want to get Image Url from database if fileupload has null value(not change).\nI mean if i change smallImage and not change LargeImage,then it should get largeImage value from DB.</p>\n\n<pre><code>[HttpPost]\n    public ActionResult Edit(Blog blog, HttpPostedFileBase smallImage, HttpPostedFileBase largeImage)\n    {\n        if (ModelState.IsValid)\n        {\n            if (smallImage != null)\n            {\n                blog.SmallImage = smallImage.ContentLength + \"_\" + smallImage.FileName;\n                string filepath = Path.Combine(Server.MapPath(\"~/Content/Blog/\"), smallImage.ContentLength + \"_\" + smallImage.FileName);\n                smallImage.SaveAs(filepath);\n            }\n            else\n            {\n                blog.SmallImage = db.Blogs.Find(blog.ID).SmallImage;\n            }\n            if (largeImage != null)\n            {\n                blog.LargeImage = largeImage.ContentLength + \"_\" + largeImage.FileName;\n                string filepath = Path.Combine(Server.MapPath(\"~/Content/Blog/\"), largeImage.ContentLength + \"_\" + largeImage.FileName);\n                largeImage.SaveAs(filepath);\n            }\n            else\n            {\n                blog.LargeImage = db.Blogs.Find(blog.ID).LargeImage;\n            }\n            blog.PostDate = Convert.ToDateTime(DateTime.Now.ToShortDateString());\n            db.Entry(blog).State = EntityState.Modified;\n            db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n        return View(blog);\n    }\n</code></pre>\n\n<p>Thank you.</p>\n"},{"tags":["c#","asp.net","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":106,"score":1,"question_id":12771433,"title":"LoadProperty in Entity Framework 5","body":"<p>I upgraded my entity framework 4.3 database first project to the new entity framework 5.\n<strike>Apparently I'm now using DbContext instead of ObjectContext.</strike></p>\n\n<p>I've replaced my old .edmx file with a new one. My old business code, that was previously using my 4.3 .edmx file, now has a problem with code using the <code>LoadProperty</code> method:</p>\n\n<pre><code>using (var context = new MyEntities())\n{\n    Models.User user = context.Users.First(x =&gt; x.GUID == guid);\n    context.LoadProperty(user, o =&gt; o.Settings);\n    return user;\n}\n</code></pre>\n\n<p>It seems that LoadProperty is not an available method in DbContext.</p>\n\n<p>How can I can get strong typed loading anyway?</p>\n\n<p>I suppose I could use </p>\n\n<pre><code>context.Users.Include(\"Settings\")\n</code></pre>\n\n<p>but that is not strong typed and prone to typos.</p>\n"},{"tags":["sql-server","entity-framework","default-value"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":159,"score":0,"question_id":11173162,"title":"How do I tell Entity Framework to allow SQL Server to provide a defined default value for a field?","body":"<p>I used the following SQL script to enable setting current time in a field, when a new row is added to a table:</p>\n\n<pre><code>ALTER TABLE [Items] ADD CONSTRAINT DF_Items DEFAULT GETDATE() FOR [CreationDate]\n</code></pre>\n\n<p>Now I am using Entity Framework to work with this table, and add new rows to it. What I want to do is allow that specific column to receive its value from SQL Server itself, and not have to provide the value myself.\nSetting that specific column's value to <code>Nothing</code> in Visual Basic fills the field with <code>DateTime.MinValue</code>, which is not what I want (and SQL Server doesn't support, by the way).</p>\n\n<p>What changes do I have to make to make this work?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12775481,"title":"Entity framework fundamentals","body":"<p>I am using EF5 codefirst in an ASP.NET MVC4 app. I have products and partners, and a number of partners can be assigned to a product.</p>\n\n<p>In the Product entity I have this: \n    public ICollection Partners { get; set; }</p>\n\n<p>And in the Partner entity I have this:\n    public ICollection Product { get; set; }</p>\n\n<p>And thus in my sql server a PartnerProducts many-2-many table is created by code first.</p>\n\n<p>I then have this action method:</p>\n\n<pre><code>    public ActionResult AssignPartner(long productId,  long partnerId) {\n        var product = productRepository.Find(productId);\n        var partner = partnerRepository.Find(partnerId);\n        if (product.Partners == null) {\n            product.Partners = new List&lt;Partner&gt;();\n        }\n        product.Partners.Add(partner);\n        productRepository.Save();\n        return RedirectToAction(\"Edit\", new{ Id = productId });\n    }\n</code></pre>\n\n<p>But the result is that both a new PartnerProducts row is created (ok) and also a new partner is created in the Partners table ? Somehow EF must think that the partner I add is a new record?</p>\n\n<p>What am I missing here?</p>\n"},{"tags":["c#","asp.net","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12574605,"title":"Entity Framework Many-to-many update","body":"<p>An image has many galleries, and a gallery has many images. I am trying to update the images that a gallery has. The code below works, but feels somewhat clumsy.</p>\n\n<pre><code>   var g=db.Galleries.Find(gal.Id);\n\n   var ims = gal.Images.Select(i =&gt; db.Images.Where(im =&gt; im.Id == i.Id &amp;&amp; im.User.Id == user.Id)).SelectMany(im =&gt; im).ToList();\n\n   g.Name = gal.Name;\n\n   g.Images.Clear();\n\n   foreach (var im in ims)\n   {\n        g.Images.Add(im);\n   }\n\n   db.SaveChanges();\n</code></pre>\n\n<p>When I do this:</p>\n\n<pre><code>g.Images=ims;\n</code></pre>\n\n<p>instead of:</p>\n\n<pre><code>   g.Images.Clear();\n\n   foreach (var im in ims)\n   {\n        g.Images.Add(im);\n   }\n</code></pre>\n\n<p>An exception is thrown:</p>\n\n<pre><code>Violation of PRIMARY KEY constraint 'PK_GalleryImages'. Cannot insert duplicate key in object 'dbo.GalleryImages'.\n</code></pre>\n\n<p>Can you explain why? Is there a better way to approach this?</p>\n"},{"tags":["c#","entity-framework","entity-framework-4","dbcontext"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12774979,"title":"A generic Find method to search by Guid type for class implementing IDbSet interface","body":"<p>I am implementing a FakeDataSet class by implementing IDbSet interface. As part of implementing this interface, I have to implement Find method. All my entity classes has an Guid type Id column. I am trying to implement Find method for this FakeDbSet class but having hard time to write it in a generic way. Below is my attempts for writing this method. </p>\n\n<pre><code>public class FakeDataSet&lt;T&gt; : IDbSet&lt;T&gt; where T: class, new()  \n{  \n  //  Other methods for implementing  IDbSet interface\n  public T Find(params object[] keyValues)  \n  {  \n       var keyValue = (Guid)keyValues.FirstOrDefault();\n       return this.SingleOrDefault(m =&gt; m.Id == keyValue);  // How can I write this\n  }\n}\n</code></pre>\n\n<p>Since it does not know about Id being of Guid type, I am getting compilation error on m.Id call. </p>\n\n<blockquote>\n  <p>'T' does not contain a definition for 'Id' and no extension method\n  'Id' accepting a first argument of type 'T' could be found (are you\n  missing a using directive or an assembly reference?)</p>\n</blockquote>\n\n<p>Any ideas on how this could be accomplished?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","session"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12774402,"title":"MVC 4 losing session","body":"<p>I have a base Controller which all the controllers extend, and at base controller I do some session handling. Such as storing user id etc.</p>\n\n<p>Moreover, I have a <code>User</code> class which has other classes such as :</p>\n\n<pre><code>class User\n{\n   public int Id {set;get;}\n   public virtual Location Location {set;get;}\n}\n</code></pre>\n\n<p>When i populate this from Database (i m using code first EF), obviously Location wont load, Should i store this in the session the way it s?</p>\n\n<p>Main question is I am storing <code>Id</code> in base controller and losing the session everytime i restart the application. why is that happening? i extended session timeout and didnt help.</p>\n\n<p>What are the best practices for session handling? is there a wrapper i can use?</p>\n"},{"tags":["c#","linq","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12774316,"title":"Linq to Entity Where built by looping over data","body":"<p>I have a search box and I have broken the data into words. I now need compare each of these words with several fields in the database. Here is the code I have:</p>\n\n<pre><code>List&lt;string&gt; searchValues = searchString.Split(delimiters, StringSplitOptions.RemoveEmptyEntries).ToList();\n\nusing (DatabaseEntities context = new DatabaseEntities())\n{\n    IQueryable&lt;DatabaseType&gt; returnValue =\n    context.DatabaseType.Where(y =&gt;\n        y.Field1.Contains(searchValues[0]) ||\n        y.Field1.Contains(searchValues[0]));\n\n    searchValues.Skip(1).ToList().ForEach(x =&gt;\n    {\n        returnValue = returnValue.Where(y =&gt;\n            y.Field1.Contains(x) ||\n            y.Field2.Contains(x));\n    });\n\n    return returnValue.ToList();\n</code></pre>\n\n<p>My goal is to build the full query before actually loading the items into memory. However, when I try to run this I get the following error:</p>\n\n<pre><code>System.NotSupportedException: LINQ to Entities does not recognize the method &amp;#39;System.String get_Item(Int32)&amp;#39; method, and this method cannot be translated into a store expression.\n</code></pre>\n\n<p>I had thought this type of error meant that the operations I am attempting do not work in the conversion to SQL, but I'm fairly sure I have used Contains as LIKE statements before. Also, all of the information in the database are nvarchars, so those equate to strings in my Entity. Does any one have any idea what the problem is? Is using an IQueryable the best way to do this? I would prefer to lazy load all of these, if possible.</p>\n"},{"tags":[".net","entity-framework","lazy-loading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12772926,"title":"Lazy load nested set","body":"<p>I am using Entity Framework with Code First to persist my data.</p>\n\n<p>There is a class with a nested list:</p>\n\n<pre><code>public class AgeGroup\n{\n    public BindingList&lt;WeightGroup&gt; WeightGroups { get; set; }\n}\n</code></pre>\n\n<p>The database context consists of</p>\n\n<pre><code>public DbSet&lt;AgeGroup&gt; AgeGroups { get; set; }\n</code></pre>\n\n<p>I am creating a window, where the user can modify <code>AgeGroup</code>s and their according <code>WeightGroup</code>s. In order to bind a <code>ListBox</code>'s <code>ItemsSource</code> property to the <code>AgeGroups</code>, I load them and bind to the <code>Local</code> set:</p>\n\n<pre><code>ctx.AgeGroups.Load();\nvm.AgeGroups = ctx.AgeGroups.Local;\n</code></pre>\n\n<p>Up to here, the <code>WeightGroups</code> are not loaded, because they are not needed. So far, so good.</p>\n\n<p>When the user chooses an <code>AgeGroup</code> for modification, its <code>WeightGroups</code> have to be loaded. Up to now I do it like this (in the setter of the <code>SelectedAgeGroup</code> property):</p>\n\n<pre><code>value.WeightGroups = (from age in ctx.AgeGroups\n                      where age.Id == value.Id\n                      select age.WeightGroups).Single();\n</code></pre>\n\n<p>However, this seems a bit clumsy. First of all, because a new list is set instead of filling the existing one. Furthermore, there are some behaviours, which are unwanted. This includes e.g. the following:</p>\n\n<ul>\n<li>If a <code>WeightGroup</code> is modified and <code>SaveChanges()</code> is called, the old group is still there and additionally a new one with the modified values.</li>\n<li>If the user removes an entity with <code>SelectedAgeGroup.WeightGroups.Remove(...)</code> and <code>SaveChanges()</code>, the deleted rows are still there.</li>\n</ul>\n\n<p>I assume, the reload of weight groups as listed above is causing this.</p>\n\n<p>How would correct Lazy Loading look like in this case? Ideally, the necessary <code>WeightGroups</code> are loaded automatically by the framework. I read about using an <code>IQueryable</code> instead of <code>BindingList</code> for the <code>WeightGroups</code> property. But this interface does not have methods for inserting and removing entities. Furthermore, if I just exchange the types, not even the <code>AgeGroups</code> are loaded at all.</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12772603,"title":"context.SaveChanges() gives error upon Adding","body":"<p>Using this code I get no errors</p>\n\n<pre><code>   public static void kirisekle(string kirisadi, int genislik, int derinlik, int uzunluk, int katid)\n    {\n        Beam newbeam = new Beam { Kirisadi = kirisadi, Genilik = genislik, Derinlik = derinlik, Uzunluk = uzunluk, KatID = katid };\n        using (pehkEntities context = new pehkEntities())\n        {\n\n            context.Beams.Add(newbeam);\n            context.SaveChanges();\n        }\n    }\n</code></pre>\n\n<p>However, I get \"dbupdateexception was unhandled\" error while using this code</p>\n\n<pre><code>public static void dosemeekle(string dosemeadi, int en, int boy, int kalinlik, int katid)\n    {\n        Slab newslab = new Slab { DosemeAdi = dosemeadi, En = en, Boy = boy, Kalnlk = kalinlik, KatID = katid };\n        using (pehkEntities context = new pehkEntities())\n        {\n\n            context.Slabs.Add(newslab);\n            context.SaveChanges();\n        }\n    }\n</code></pre>\n\n<p>How should I find the reason for this error and fix it?</p>\n\n<p>I am using this code to see the inner exception:</p>\n\n<pre><code>context.Slabs.Add(newslab);\n        try\n        {\n            context.SaveChanges();\n        }\n        catch( System.Data.Entity.Infrastructure.DbUpdateException ex)\n        {\n            MessageBox.Show(ex.InnerException.Message);\n\n        }\n</code></pre>\n\n<p>However, it shows a messagebox says \"an error occured updating the entries. See the inner exception for details.\" only.</p>\n"},{"tags":["c#","entity-framework","class","table"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12648353,"title":"Have a class/object with a lot of properties, how do I automatically generate a table in edmx of Entity Framework?","body":"<p>Surely this is out there (or maybe you just can't do this?).</p>\n\n<p>I have a class in my project with a bunch of properties. I already have an edmx with two tables in it. How do I automatically make a third table for this new class. I don't want to manually add 40 properties to a new table.</p>\n"},{"tags":["entity-framework","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12770566,"title":"Entity Framework Timeout","body":"<p>I have been trying to figure out how to optimize the following query for the past few days and just not having much luck. Right now my test db is returning about 300 records with very little nested data, but it's taking 4-5 seconds to run and the SQL being generated by LINQ is awfully long (too long to include here). Any suggestions would be very much appreciated.</p>\n\n<p>To sum up this query, I'm trying to return a somewhat flattened \"snapshot\" of a client list with current status.  A Party contains one or more Clients who have Roles (ASPNET Role Provider), Journal is returning the last 1 journal entry of all the clients in a Party, same goes for Task, and LastLoginDate, hence the OrderBy and FirstOrDefault functions.</p>\n\n<pre><code>Guid userID = 'some user ID'\nvar parties = Parties.Where(p =&gt; p.BrokerID == userID).Select(p =&gt; new\n{\nID = p.ID,\nTitle = p.Title,\nGoal = p.Goal,\nGroups = p.Groups,\nIsBuyer = p.Clients.Any(c =&gt; c.RolesInUser.Any(r =&gt; r.Role.LoweredName == \"buyer\")),\nIsSeller = p.Clients.Any(c =&gt; c.RolesInUser.Any(r =&gt; r.Role.LoweredName == \"seller\")),\nJournal = p.Clients.SelectMany(c =&gt; c.Journals).OrderByDescending(j =&gt; j.OccuredOn).Select(j=&gt; new \n    { \n        ID = j.ID,\n        Title = j.Title,\n        OccurredOn = j.OccuredOn,\n        SubCatTitle = j.JournalSubcategory.Title\n    }).FirstOrDefault(),\nLastLoginDate = p.Clients.OrderByDescending(c=&gt;c.LastLoginDate).Select(c=&gt;c.LastLoginDate).FirstOrDefault(),\nMarketingPlanCount = p.Clients.SelectMany(c =&gt; c.MarketingPlans).Count(),\nTask = p.Tasks.Where(t=&gt;t.DueDate != null &amp;&amp; t.DueDate &gt; DateTime.Now).OrderBy(t=&gt;t.DueDate).Select(t=&gt; new \n    {\n        ID = t.TaskID,\n        DueDate = t.DueDate,\n        Title = t.Title\n    }).FirstOrDefault(),\nClients = p.Clients.Select(c =&gt; new\n    {\n        ID = c.ID,\n        FirstName = c.FirstName,\n        MiddleName = c.MiddleName,\n        LastName = c.LastName,\n        Email = c.Email,\n        LastLogin = c.LastLoginDate\n    })\n}).OrderBy(p =&gt; p.Title).ToList()\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12768987,"title":"Null-able foreign key; Entity Framework 5.0 model-first","body":"<p>I'm using Entity Framework 5.0 model-first approach using Visual Studio 2012 Express. I have a scenario to generate a nullable foreign key. For example, there are two entities  <code>Organization</code> and <code>User</code>. Not all users will belong to an organization. However, some users would belong to an organization. The <code>User.Organization_ID</code> column is always <code>not null</code> in spite of changing the multiplicity. Please help me to resolve this issue. Appreciate it.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12768526,"title":"EF Domain Model linq query","body":"<p>My domain model object seems</p>\n\n<pre><code>Section  (many to many)  Gauge,\nGauge (many to many)   Floor,\nFloor  (one to many) Block\n</code></pre>\n\n<p>and my  native sql query as follows : </p>\n\n<pre><code>select Distinct (s.SectionName),g.GaugeNO,f.FloorNO\nfrom Sections s, SectionGauge sg, Gauges g, GaugeFloor gf, Floors f\nwhere s.SectionID = sg.Sections_SectionID\nand g.GaugeID = sg.Gauges_GaugeID\nand g.GaugeID = gf.Gauges_GaugeID\nand f.FloorID = gf.Floors_FloorID\nand s.SectionID = 2 \n</code></pre>\n\n<p>I would like to convert the uppur query into linq and initiate Section Object since Section is top one of the object tree. </p>\n\n<p>I tried with include method. But that worked for 1st level but multiple level doesnt work. </p>\n\n<pre><code>1.  var query = from c in m.Sections.Include(\"Gauges\") where c.SectionID == 2 select c; (Work)\n\n2.  var query = from c in m.Sections.Include(\"Gauges\").Include(\"Floors\").Include(\"Blocks\") where c.SectionID == 2 select c; (Doesnt work)\n</code></pre>\n\n<p>then</p>\n\n<pre><code>List&lt;Section&gt; lstSection = query.ToList&lt;Section&gt;();\nreturn lstSection;\n</code></pre>\n\n<p>THANKS</p>\n"},{"tags":["entity-framework","dataannotations","fluent-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12766104,"title":"Need clarification on Entity Framework Code-First and Navigation Properties and Scalar Keys","body":"<p><strong>As I understand it</strong> (so please correct me if I am mistaken), entity classes that have relationships between them can be defined in several ways -- (1) by using both a property to represent a scalar key plus a navigation property or (2) just using a navigation property.</p>\n\n<p>If you use Data Annotations I <strong>believe</strong> that your only choice is using both the scalar key and navigation properties whereas using Fluent API both approaches are available.</p>\n\n<p>My question is which approach to take? What are the pros and cons of each? (This is in regard to the two choices regarding foreign keys and navigation properties...<strong>not</strong> regarding Data Annotations vs. Fluent.</p>\n\n<p>As I see it it boils down to these factors/concerns</p>\n\n<ol>\n<li>Having both a scalar property and a navigation property could be seen as \"dirtying up\" the class.</li>\n<li>Having just the navigation property would require an Includes() call to get access to the FK value. I have not looked at the SELECT statement being sent but I would suspect that a JOIN is being executed and data that is not needed is being sent back.</li>\n<li>Having the scalar property would preclude the need for Include() calls.</li>\n<li>As hinted in a previous SO question from me (<a href=\"http://stackoverflow.com/q/12765542/240372\">related question</a>), it looks like navigation properties cannot be used as part of a composite key so one would be forced to include the additional scalar key. And if you have to do it for one property it would make sense to be consistent in all your classes.</li>\n</ol>\n\n<p>Am I missing anything? In general, what is the recommended way of defining the foreign keys and navigation properties? Why even offer both approaches as it seems to muddle the waters? I have looked at a lot of tutorials and see a mix of both approaches.</p>\n\n<p>Thank you.</p>\n"},{"tags":["asp.net-mvc","entity-framework","automapper"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12636581,"title":"How to use Automapper with uploaded images in complex types (MVC + entity framework)","body":"<p>I've got the following models:</p>\n\n<pre><code>public abstract class PersonBase : EntityWithTypedId\n    {\n        public PersonBase()\n        {\n            this.ProfileImages = new List&lt;ProfileImage&gt;();\n        }\n\n        public string name;\n\n        [Required]\n        public string Name\n        {\n            get { return name; } \n            set\n            {\n                name = value;\n                this.UrlFriendlyName = value.ToUrlFriendly();\n            }\n        }\n\n        public string UrlFriendlyName { get; protected set; }\n\n        [UIHint(\"UploadImage\")]\n        public List&lt;ProfileImage&gt; ProfileImages { get; set; }\n    }\n\n\n\npublic class ProfileImage\n        {\n            public int PersonId { get; set; }\n\n            public byte[] Image { get; set; }        \n        }\n</code></pre>\n\n<p>And my viewmodel:</p>\n\n<pre><code>public class PersonDetailsViewModel\n    {\n        public string Name { get; set; }\n\n        public IEnumerable&lt;HttpPostedFilebase&gt; ProfileImages { get; set; }\n    }\n</code></pre>\n\n<p>Now my question is, how can I map those with automapper? I mean the ProfileImage also needs the PersonId (which could be inserted by the Entity Framework on insert). Do I need to change the naming in the <strong>ViewModel</strong> or?</p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12756766,"title":"Mapping Nullable type Code First","body":"<p>I have my project run just fine using EF Code First. But now I need to add 1 more field into DB(e.g CreateDate of type DateTime) which can be null.</p>\n\n<p>So, I wrote script to add 1 more field to DB(CreateDate (datetime) <strong>null</strong>), then I modified my model to include new field</p>\n\n<pre><code>public class Account()\n{\n...\npublic DateTime CreateDate { get; set; }\n}\n</code></pre>\n\n<p>And below is the code to make this field option using FluentApi</p>\n\n<pre><code>Property(x =&gt; x.CreateDate).IsOptional();\n</code></pre>\n\n<p>The problem is when I tried to get any instance of Account, I got an error\nWhen I modify the field as follow:</p>\n\n<pre><code>public DateTime? CreateDate { get; set; }\n</code></pre>\n\n<p>then it works.</p>\n\n<p>Can you guys please explain to me about this? Why doesn't my fluent api work or did I do something wrong?</p>\n\n<p>Thank you.</p>\n"},{"tags":["c#",".net","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12763976,"title":"Using collection of objects in LINQ to Entities which are not modeled","body":"<p>I'm writing a query using Linq to Entities and Entity Framework. My app uses two databases. Cross database is not an option due to client demands.</p>\n\n<p>Lets say <code>MyEntity</code> resides in first database (so it is on one EF Model) and it references an entity in the second database <code>SecondDBEntity</code> (so it is on another EF Model), which has a composite key. Now, lets say I want to retrieve all <code>MyEntity</code> which references a set of <code>SecondDBEntity</code> (In our example, entities with key [1, 1], [1, 2] and [1, 3]).</p>\n\n<p>The SQL I want to generate is this:</p>\n\n<pre><code>SELECT *\n  FROM MyEntity\n WHERE (MyEntity.ForeignKeyOne = 1 AND MyEntity.ForeignKeyTwo = 1)\n    OR (MyEntity.ForeignKeyOne = 1 AND MyEntity.ForeignKeyTwo = 2)\n    OR (MyEntity.ForeignKeyOne = 1 AND MyEntity.ForeignKeyTwo = 3)\n</code></pre>\n\n<p>I have then tried the following code:</p>\n\n<pre><code>var setOfEntitiesToSearch = LetsAssumeThisIsAnIEnumerableOfSecondDBEntity;\nreturn (from myEntity in DataContext.MyEntityList\n       where setOfEntitiesToSearch.Any(entityToSearch =&gt; entityToSearch.KeyOne == myEntity.ForeignKeyOne &amp;&amp; entityToSearch.KeyTwo == myEntity.ForeignKeyTwo)\n      select myEntity).ToList();\n</code></pre>\n\n<p>This code compiles fine, but when I execute, it gives me the error:</p>\n\n<pre><code>\"Unable to create a constant value of type 'SecondDBEntity'. Only primitive types or enumeration types are supported in this context.\"\n</code></pre>\n\n<p>My main problem is because entities are in different databases. I'm probably doing something silly, because this is a farely common query I'm trying to build. So, I believe I'm missing some feature in EF which will allow me to create this query. Maybe some CompositeKey structure? Or some way to mix those EF Models?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["wcf","entity-framework","frameworks","entity"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":12764964,"title":"Validation using Entity Framework with WCF","body":"<p>I have started looking into entity framework and WCF from a windows forms background and there are a few things I am trying to get my head around.  For example, taking the typical order/order line example, how do you go about handling business logic such as dependencies. If a customer can only purchase product A if they also purchase product B or C where does the validation go?</p>\n\n<p>I would like to handle the checks client side so that I'm not passing objects between the client and server all the time, I would also like to throw an exception if product A is added to an order that does not already contain one of its dependent parents.</p>\n\n<p>If I create an order using a navigation property for the order lines how do I add a rule to the Order.OrderLines.Add method to check that the line is valid?  Should the validation be done before I add the line to the collection and if so would I need to pass the entire order back to the server for the business rules to be applied?</p>\n"},{"tags":["sql","visual-studio","entity-framework","deployment","continuous-integration"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12746908,"title":"How to automate deployment of changes to database?","body":"<p>Currently I use Visual Studio Database Project, so I can deploy changes to database with one click and keep data in database.</p>\n\n<p>Now I want to be able to create model in Entity Framework and deploy with one click.</p>\n\n<p>So I got sql script to create database from Entity Framework. I can run this script to create database, but I want to keep my data in database. </p>\n\n<p>Is there any way to do that ? Any tool that will do that ? Should I generate it on my own with T4 ? </p>\n\n<p>I use CI so I need to be able to deploy often. I want something similar to Visual Studio Database Project deployment, but with Entity Framework generated database.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","entity-framework-4","domain-driven-design"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":112,"score":2,"question_id":12764143,"title":"Is Entity Framework Dataannotations bad for DDD and seperation of concerns?","body":"<p>I've been working quite som time now to learn how to implement DDD, IoC and ensure there is a seperation of concerns in my application. I'm also trying to get in to the way of Test First Development.</p>\n\n<p>Somehow Entity Framework gives med some trouble. I have a domain project that keeps my domain objects (many of them POCO classes now, but with some behavior). It's legacy code, and I try to refactor it, but MVC realies heavily on Dataannotations for validation. </p>\n\n<p>The datavalidation-attributes is set on the domain objects, which ties them  to the entity framework. Most instructional videos and documentation on EF also uses a lot of attributes on the domain objects. </p>\n\n<p><strong>So I wonder if this is really a good thing?</strong></p>\n\n<p>I like the idea of many of the attributes, but the consequence of putting them on the domian objects makes me feel that entity framework is the core of the application and not the domain objects.</p>\n\n<p>Do you have any tips on solving this, or is this how it should be?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>The suggested answers below led me to this post answered by <a href=\"http://stackoverflow.com/questions/8894367/how-to-make-fluent-api-configuration-work-with-mvc-client-side-validation\">Ladislav Mrnka</a></p>\n\n<p>To me that probably sounds like the best way to go if it solves my problem. He also points out the same problem I have with the attributes in the domain layer.</p>\n"},{"tags":["sql","entity-framework","ado.net","execute","run"],"answer_count":4,"favorite_count":6,"up_vote_count":15,"down_vote_count":1,"view_count":11074,"score":14,"question_id":915329,"title":"Is it possible to run native sql with entity framework?","body":"<p>I am trying to search an XML field within a table, This is not supported with EF.</p>\n\n<p>Without using pure Ado.net is possible to have native SQL support with EF?</p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2258,"score":2,"question_id":1454182,"title":"Entity Framework LoaderExceptions Unable to load one or more of the requested types","body":"<p>I have a Web Service that uses the entity framework.  When releasing to a test environment, I receive the following error:</p>\n\n<p>\"Unable to load one or more of the requested types.\" - Stack trace below...</p>\n\n<p>The test box has .NET 3.5 SP 1 installed, and I have read a previous post here:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/1091853/unable-to-load-one-or-more-of-the-requested-types-retrieve-the-loaderexceptions\">Unable to load one or more of the requested types. Retrieve the LoaderExceptions property for more information</a></p>\n\n<p>However the answer does not solve it in my case.  I have copied and pasted the working copy off my development machine onto the test box to ensure there is not a problem with debug DLLs (as the answer suggests), however no luck.</p>\n\n<p>Is this a known issue?  Ive spent an entire morning trying to debug this!! If anyone knows of a solution, please let me know!</p>\n\n<pre><code>Retrieve the LoaderExceptions property for more information.   at System.Reflection.Module._GetTypesInternal(StackCrawlMark&amp; stackMark)\n   at System.Reflection.Assembly.GetTypes()\n   at System.Data.Metadata.Edm.ObjectItemCollection.AssemblyCacheEntry.LoadTypesFromAssembly(LoadingContext context)\n   at System.Data.Metadata.Edm.ObjectItemCollection.AssemblyCacheEntry.InternalLoadAssemblyFromCache(LoadingContext context)\n   at System.Data.Metadata.Edm.ObjectItemCollection.AssemblyCacheEntry.LoadAssemblyFromCache(Assembly assembly, Boolean loadReferencedAssemblies, Dictionary`2 knownAssemblies, Dictionary`2&amp; typesInLoading, List`1&amp; errors)\n   at System.Data.Metadata.Edm.ObjectItemCollection.LoadAssemblyFromCache(ObjectItemCollection objectItemCollection, Assembly assembly, Boolean loadReferencedAssemblies)\n   at System.Data.Metadata.Edm.ObjectItemCollection.LoadAssemblyForType(Type type)\n   at System.Data.Metadata.Edm.MetadataWorkspace.LoadAssemblyForType(Type type, Assembly callingAssembly)\n   at System.Data.Objects.ObjectContext.CreateQuery[T](String queryString, ObjectParameter[] parameters)\n   at Company.Domain.ICommuicationsEntities.CreateQuery[T](String queryString, ObjectParameter[] parameters)\n   at Comany.EntityFrameworkRepository`1.GetQuery()\n   at Comany.Repositories.EntityFrameworkRepository`1.GetFiltered(Expression`1 filter, IncludeBuilder`1 includeBuilder)\n   at Comany.Repositories.EntityFrameworkRepository`1.GetFiltered(Expression`1 filter)\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12763724,"title":"Method in a Entity Partial Class don't appears on new instances","body":"<p>I have a entity class Usuario and I want to create a partial class to add some methods in Usuario. I did:</p>\n\n<pre><code>public partial class Usuario\n{\n    public static List&lt;string&gt; CarregarPreferencias(){\n        // Do it!\n        return null;\n    }\n}\n</code></pre>\n\n<p>When I call Usuario in Context \"Ctx.Usuario.CarregarPreferencias()\" it appears, but when I create a instance of Usuario it not:</p>\n\n<pre><code>Usuario user = new Usuario();\nuser.CarregarPrefer..... // &lt;&lt;&lt; my method don't appears\n</code></pre>\n\n<p>What I'm missing?</p>\n"},{"tags":["c#","entity-framework","dbcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":89,"score":1,"question_id":12761575,"title":"Mvoing DbContext in a separate class with a different project cause exception","body":"<p>I am using Entity Framework for my DAL (using DBContext). The layered architecture we are following in big on separation of concern and for this purpose, the entity class that get generated has to go in separate class project. Since program has to be unit-testable, I am using Repository pattern and for that reason I need to abstract the DbContext that we get from EF. All this mean that the entity class and context class is not in the same project where my edmx file lives. Problem is when I move the files around, I start getting following exception</p>\n\n<blockquote>\n  <p>Unhandled Exception: System.Data.MetadataException: Unable to load the\n  specified  metadata resource.    at<br>\n  System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.LoadResou\n  rces(String assemblyName, String resourceName, ICollection<code>1\n  uriRegistry, Metada taArtifactAssemblyResolver resolver)    at<br>\n  System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource..ctor(Str\n  ing originalPath, String assemblyName, String resourceName,\n  ICollection</code>1 uriReg istry, MetadataArtifactAssemblyResolver resolver)\n  at<br>\n  System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.CreateRes\n  ourceLoader(String path, ExtensionCheck extensionCheck, String\n  validExtension, I Collection<code>1 uriRegistry,\n  MetadataArtifactAssemblyResolver resolver)    at<br>\n  System.Data.Metadata.Edm.MetadataArtifactLoader.Create(String path,\n  Extens ionCheck extensionCheck, String validExtension, ICollection</code>1\n  uriRegistry, Metad ataArtifactAssemblyResolver resolver)    at<br>\n  System.Data.Metadata.Edm.MetadataCache.SplitPaths(String paths)    at<br>\n  System.Data.Common.Utils.Memoizer<code>2.&lt;&gt;c__DisplayClass2.&lt;Evaluate&gt;b__0()\n  at System.Data.Common.Utils.Memoizer</code>2.Result.GetValue()    at<br>\n  System.Data.Common.Utils.Memoizer<code>2.Evaluate(TArg arg)    at<br>\n  System.Data.EntityClient.EntityConnection.GetMetadataWorkspace(Boolean\n  ini tializeAllCollections)    at<br>\n  System.Data.Objects.ObjectContext.RetrieveMetadataWorkspaceFromConnection(\n  )    at System.Data.Objects.ObjectContext..ctor(EntityConnection\n  connection, Boole an isConnectionConstructor)    at<br>\n  System.Data.Objects.ObjectContext..ctor(EntityConnection connection)<br>\n  at<br>\n  System.Data.Entity.Internal.InternalConnection.CreateObjectContextFromConn\n  ectionModel()    at<br>\n  System.Data.Entity.Internal.LazyInternalConnection.CreateObjectContextFrom\n  ConnectionModel()    at<br>\n  System.Data.Entity.Internal.LazyInternalContext.InitializeContext()<br>\n  at<br>\n  System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType\n  (Type entityType)    at<br>\n  System.Data.Entity.Internal.Linq.InternalSet</code>1.Initialize()    at<br>\n  System.Data.Entity.Internal.Linq.InternalSet<code>1.get_InternalContext()<br>\n  at<br>\n  System.Data.Entity.Infrastructure.DbQuery</code>1.System.Linq.IQueryable.get_Pro\n  vider()    at System.Linq.Queryable.Where[TSource](IQueryable<code>1\n  source, Expression</code>1 pre dicate)    at<br>\n  BusinessLayer.CustomerLocator.LocateCustomerByIdint id) in\n  C:\\Sandbox\\BusinessLayer\\CustomerLocator.cs:line 41    at<br>\n  ClientApp.Program.Main(String[] args) in C:\\Sandbox\\ Program.cs:line\n  34</p>\n</blockquote>\n\n<p>Googling suggest that there could be something wrong regarding paths to csdl, ssdsl etc but I am not sure what is wrong here. Below is how my connection string is been setup</p>\n\n<pre><code>&lt;add name=\"DBConnection\" \n   connectionString=\"metadata=res://*/MyDataModel.csdl|res://*/MyDataModel.ssdl|res://*/MyDataModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=.;initial catalog=Customers;persist security info=True;user id=user;password=password;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" \nproviderName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n"},{"tags":["c#","winforms","entity-framework","path"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12761427,"title":"Get Application Path","body":"<p>Ok, I am moving a few of my Winform projects from Framework 4.0 to Framework 4.5 and I am running into a problem trying to find the Executable path from a Class Library. I have an error logging class that I use to log errors here is a snippet of my code:</p>\n\n<pre><code>using System;\nusing System.IO;\nusing System.Windows.Forms;\n\nnamespace FunctionClassLibrary\n{\n    public static class ErrorLogging\n    {\n        public static string errLogFullPath\n        {\n            get\n            {\n                string errLogFile = \"Application\";\n                m_errLogFullPath = Path.Combine(Path.GetDirectoryName(Application.ExecutablePath), errLogFile + \"_ErrorLog.txt\");\n                return m_errLogFullPath;\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>as you can see I am able to reference the System.Windows.Forms namespace which in turn exposes the Application.ExecutablePath property. Apparently in Framework 4.5 you can no longer reference System.Windows.Forms namespace. I have been googling all morning with no success, these two MSDN links: <a href=\"http://msdn.microsoft.com/en-us/library/system.windows.forms.application.startuppath.aspx\" rel=\"nofollow\">LINK1</a> and <a href=\"http://msdn.microsoft.com/en-us/library/system.windows.forms.application.userappdatapath.aspx\" rel=\"nofollow\">LINK2</a> both show examples using the System.Windows.Forms namespace. So my question is does anyone have a workaround for this issue?</p>\n\n<h1>**Update**</h1>\n\n<p>Ok, I am losing my mind, I just realized that I can simply use the Environment.GetFolderPath method to find the CommonProgramFiles folder, which is where I should be storing this file anyway. Sorry to bother everyone this morning.</p>\n"},{"tags":["c#","asp.net","sql","entity-framework","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":84,"score":0,"question_id":12751274,"title":"Can't find a solution to a somewhat complex and unusual requirements","body":"<p>I am working on a CMS using ASP.NET / C#. It works fine and life is good. However, it was decided to add extra functionality to support a wider variety of websites.\nBasically, the current CMS is still alpha but will be able to host data for multiple websites running for the same group of companies all having somewhat the same requirements.</p>\n\n<p>I have constructed the database as per the diagram attached below:</p>\n\n<p>\"Image removed for security reasons\"</p>\n\n<p>Now, in addition to this diagram, I was asked to add support for products under different 'attributes' than Sectors. Meaning that a product now can have a <code>type</code> and many other attributes. So let's say you're using one of our sites and we make tissue paper. Products should somehow support filtering by 'type' say 'tissue' and by 'application' say 'how you use it' and other unknown 'attributes' that may pop up in the future.</p>\n\n<p>For example a product may fall under the 'Agricultural Packaging' sector and is of type 'Bag' and is applied by some way of applying it.\nThe end result is to be able to sort products by how they are used and or their type and or the sector they fall under. Or even all together.</p>\n\n<p>What is the best approach for this sort of problem to include into the data model and the CMS?</p>\n\n<p>Thanks!</p>\n"},{"tags":["entity-framework","entity-framework-4.1","objectcontext","dbcontext"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2012,"score":1,"question_id":8423736,"title":"Convert Library from ObjectContext to DbContext","body":"<p>I have a library (<a href=\"http://dotnetslackers.com/articles/ado_net/Managing-Entity-Framework-ObjectContext-lifespan-and-scope-in-n-layered-ASP-NET-applications.aspx\" rel=\"nofollow\">based on code found in an old blog post</a>) that allows me to very easily wrap a faade around my data access using Entity Framework. It uses ObjectContext and has performed well enough for my purposes.</p>\n\n<p>But now, we are excitedly investigating code first using DbContext and of course would like to reuse / adapt as much of our existing effort as possible.</p>\n\n<p>Everything went ok naively converting our Facade enabling library with IObjectContextAdapter until we tried to utilise our facade, when the following error was received:</p>\n\n<blockquote>\n  <p>The type 'Employee' cannot be used as type parameter 'TEntity' in the generic type or method 'DbContextManagement.FacadeBase'. There is no implicit reference conversion from 'Employee' to 'System.Data.Objects.DataClasses.EntityObject'</p>\n</blockquote>\n\n<p>MSDN says:</p>\n\n<blockquote>\n  <p>EntityObject derived types are not supported by the DbContext API, to use these entity types you must use the ObjectContext API.</p>\n</blockquote>\n\n<p>That's fine, but how would I then go ahead completing my refactor to bypass this inability?</p>\n\n<p>Here's some code (line breaks introduced):</p>\n\n<p><strong>FacadeBase.cs</strong></p>\n\n<pre><code>namespace DbContextManagement\n{\n    using System;\n    using System.Collections;\n    using System.Configuration;\n    using System.Data.Entity;\n    using System.Data.Entity.Infrastructure;\n    using System.Data.Metadata.Edm;\n    using System.Data.Objects.DataClasses;\n    using System.Linq;\n    using System.Reflection;\n\n    public abstract class FacadeBase&lt;TDbContext, TEntity&gt;\n        where TDbContext : DbContext, new()\n        where TEntity : EntityObject\n    {\n        protected TDbContext DbContext\n        {\n            get\n            {\n                if (DbContextManager == null)\n                {\n                    this.InstantiateDbContextManager();\n                }\n\n                return DbContextManager.GetDbContext&lt;TDbContext&gt;();\n            }\n        }\n\n        private DbContextManager DbContextManager { get; set; }\n\n        public virtual void Add(TEntity newObject)\n        {\n            var context = ((IObjectContextAdapter)this.DbContext).ObjectContext;\n\n            string entitySetName;\n\n            if (newObject.EntityKey != null)\n            {\n                entitySetName = newObject.EntityKey.EntitySetName;\n            }\n            else\n            {\n                string entityTypeName = newObject.GetType().Name;\n\n                var container = context.MetadataWorkspace.GetEntityContainer(\n                                    context.DefaultContainerName, \n                                    DataSpace.CSpace);\n\n                entitySetName = (from meta in container.BaseEntitySets\n                                    where meta.ElementType.Name == \n                                       entityTypeName\n                                    select meta.Name).First();\n            }\n\n            context.AddObject(entitySetName, newObject);\n        }\n\n        public virtual void Delete(TEntity obsoleteObject)\n        {\n            var context = ((IObjectContextAdapter)this.DbContext).ObjectContext;\n\n            context.DeleteObject(obsoleteObject);\n        }\n\n        private void InstantiateDbContextManager()\n        {\n            var objectContextManagerConfiguration = \n               ConfigurationManager.GetSection(\"DbContext\") as Hashtable;\n\n            if (objectContextManagerConfiguration != null &amp;&amp; \n                objectContextManagerConfiguration.ContainsKey(\"managerType\"))\n            {\n                var managerTypeName = \n                   objectContextManagerConfiguration[\"managerType\"] as string;\n\n                if (string.IsNullOrEmpty(managerTypeName))\n                {\n                    throw new ConfigurationErrorsException(\n                        \"The managerType attribute is empty.\");\n                }\n\n                managerTypeName = managerTypeName.Trim().ToLower();\n\n                try\n                {\n                    var frameworkAssembly = \n                         Assembly.GetAssembly(typeof(DbContextManager));\n\n                    var managerType = \n                         frameworkAssembly.GetType(managerTypeName, true, true);\n\n                    this.DbContextManager = \n                        Activator.CreateInstance(managerType) as DbContextManager;\n                }\n                catch (Exception e)\n                {\n                    throw new ConfigurationErrorsException(\n                        \"The managerType specified in the \n                            configuration is not valid.\", e);\n                }\n            }\n            else\n            {\n                throw new ConfigurationErrorsException(\n    \"A Facade.DbContext tag or its managerType attribute\n    is missing in the configuration.\");\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><strong>EmployeeFacade.cs</strong></p>\n\n<pre><code>namespace Facade\n{\n    using System.Collections.Generic;\n    using System.Linq;\n    using DataModel;\n    using DataModel.Entities;\n    using DbContextManagement;\n\n    public sealed class EmployeeFacade : FacadeBase&lt;FleetContext, Employee&gt;\n    {\n        public Employee GetById(int? employeeId)\n        {\n            return employeeId == null\n                ? null\n                : this.DbContext.Employees.FirstOrDefault(m =&gt; m.Id == employeeId);\n        }\n    }\n}\n</code></pre>\n\n<p><strong>Employee.cs</strong></p>\n\n<pre><code>namespace DataModel.Entities\n{\n    public class Employee\n    {\n        public int Id { get; set; }\n        public string Surname { get; set; }\n        public string Forename { get; set; }\n        public string EmployeeNumber { get; set; }\n    }\n}\n</code></pre>\n"},{"tags":[".net","entity-framework","enums"],"answer_count":5,"favorite_count":12,"up_vote_count":42,"down_vote_count":0,"view_count":20349,"score":42,"question_id":1526339,"title":"How to work with Enums in Entity Framework?","body":"<p>What is the best way to work with Enums in Entity Framework?</p>\n\n<p>Remarks: I'm using EF 3 and Firebird.</p>\n"},{"tags":["entity-framework","entity-framework-4","repository-pattern"],"answer_count":1,"favorite_count":13,"up_vote_count":7,"down_vote_count":0,"view_count":1429,"score":7,"question_id":5410622,"title":"Entity Framework 4 Repository?","body":"<p>I am learning Entity Framework 4, and I want to use the Repository pattern to organize and isolate my persistence objects. I have done some research here and elsewhere on the web, and I am having a difficult time finding anything really useful on the subject. Most of the blogs look like simple ports of repositories from other ORM systems, with lots of contradictory advice. Most seem to pass the object context to the business layer, which would seem to defeat the purpose of a repository approach.</p>\n\n<p>Can anyone suggest a good article, book, or blog the explains how to implement the Repository pattern with Entity Framework 4, without polluting the business layer with persistence objects? Thanks for your help.</p>\n"},{"tags":["entity-framework"],"answer_count":8,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4392,"score":0,"question_id":2096399,"title":"Number of members in conceptual type does not match with number of members on object side type","body":"<p>I'm using .net framework 3.5 SP1.</p>\n\n<p>After adding a column to one table in Sql Server (as well as changing an existing column from allowing nulls to not nullable), I can no longer run my project without getting this error:</p>\n\n<blockquote>\n  <p>The number of members in the\n  conceptual type\n  'XBRLDimensionalModel.axis_t' does not\n  match with the number of members on\n  the object side type\n  'EOL.Xbrl.Persistence.Data.axis_t'.\n  Make sure the number of members are\n  the same.</p>\n</blockquote>\n\n<p>I gave up trying to find and fix the generated code.  I now have deleted all my local entity-related files and re-generated them by starting over from scratch and adding a new item (ADO.NET Entity Data Model).  I still get this error.</p>\n\n<p>The only way I can run the project now is to undo all my pending changes and use the last version from source control, and of course change the two modified database columns to nullable.</p>\n\n<p>From all I've read so far it seems like I simply should have been able to \"update\" my model from the database.  That resulted in this exception (above).  But now I'm totally confused that even with a complete regeneration of the entity model and supporting classes I'm still getting that error.</p>\n\n<p>I changed the property on my edmx model: \"Metadata Artifact Processing\" to \"Copy to Output Directory\".  The Designer.cs, csdl, msl, ssdl files all seem to be consistent with the latest DB changes.</p>\n\n<p>The exception is being thrown the first time my entityModel instance is referenced.  So it is prior to any loading or saving of the data from the changed table.</p>\n\n<p>any ideas where I'm going wrong?\nThanks,\nTG</p>\n"},{"tags":["c#",".net","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":12758658,"title":"The type or namespace name 'Column' could not be found","body":"<p>I'm sure that I'm missing something simple here.\nI'm trying to follow a Code First Entity Framework tutorial which tells me to use some Data Annotations. </p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.ComponentModel.DataAnnotations;\n\nnamespace Model\n{\n    public class Destination\n    {\n        public int DestinationId { get; set; }\n\n        [Required]\n        public string Name { get; set; }\n        public string Country { get; set; }\n        [MaxLength(500)]\n        public string Description { get; set; }\n\n        [Column(TypeName=\"image\")]\n        public byte Photo { get; set; }\n\n        public List&lt;Lodging&gt; Lodgings { get; set; }\n    }\n}\n</code></pre>\n\n<p>The compiler doesn't have any issues with the first two annotations but it doesn't seem to like: <code>[Column(TypeName=\"image\")]</code>.</p>\n\n<p>Errors:</p>\n\n<ul>\n<li><p>The type or namespace name 'Column' could not be found.</p></li>\n<li><p>The type or namespace name 'ColumnAttribute' could not be found.</p></li>\n</ul>\n\n<p>I'm using Visual Studio 2012 and Entity Frameworks 5.</p>\n\n<p>Any suggestions?</p>\n"},{"tags":["sql-server","entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12758817,"title":"SUSER_SID() default column with Entity Framework","body":"<p>Can anyone tell me how to use Entity Framework with SQL Server default value ? </p>\n\n<p>Actually I am creating one tenant-based architecture in which I need to enter <code>SUSER_SID()</code> in each table directly.</p>\n\n<p>So, whenever user inserts any row in such table, based on their SQL login, their unique <code>SUSER_SID()</code> will enter with that row in that table...</p>\n\n<p>That was working fine if I use a stored procedure... but if I need to use stored procedure there would not any meaning to use Entity Framework... So, I am thinking that is there any way that I can insert row using Entity Framework? I checked with Identity and other options...</p>\n\n<p>My EDMX File for that property is somewhat like..</p>\n\n<pre><code> &lt;Property Name=\"TenantID\" Type=\"varbinary(max)\" StoreGeneratedPattern=\"Identity\"  /&gt;\n</code></pre>\n\n<p>I Will really appreciate if you can guide me anything...</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","nuget"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12756787,"title":"Can I use different approach to update DB in EF ? (Nuget DB Generator)","body":"<p>I am developing an EF - MVC 3 application. I have used model first approach, so I have create model first and from that model, EF generated the DB.</p>\n\n<p>I have used a tool called <strong><em>Nuget - Entity Generator - Database designer</em></strong> for generating the database. When I have designed the model first time, I have used the <code>Generate Migration T-SQL and Deploy</code> option of that tool.</p>\n\n<p>Database generated perfectly and it's working fine...</p>\n\n<p>Now I have come across a situation that I have to make a change to the model and I have to use <code>T-SQL Via T4 (TPH)</code> option to update the database. </p>\n\n<p>So previously I used different process to update DB and now I am changing it. </p>\n\n<p>Can use this (TPH) process to update the database? Is there is issue if I used this? </p>\n"},{"tags":["c#","entity-framework","entity-framework-4","entity-framework-4.1","identity"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12731163,"title":"Cannot Insert custom value into identity column - Entity Framework","body":"<p>I am trying to switch the identity off to insert my own value, steps I followed</p>\n\n<ol>\n<li>changed the property <code>StoredGeneratedPattern</code> value to <code>None</code> for the identity column   </li>\n<li>changed the property <code>StoredGeneratedPattern</code> value to <code>None</code> in EDMX file by opening in xml format </li>\n</ol>\n\n<p>Tried using the below code</p>\n\n<pre><code>using (TransactionScope scope = new TransactionScope(TransactionScopeOption.RequiresNew))\n{\n   int k = Context.ExecuteStoreCommand(\"SET IDENTITY_INSERT dbo.client ON\");\n   Context.ClientInfoes.Add(testclient);\n   result = Context.SaveChanges();\n   int j = Context.ExecuteStoreCommand(\"SET IDENTITY_INSERT dbo.client OFF\");\n   scope.Complete();\n}\n</code></pre>\n\n<p>but I am still receiving the error </p>\n\n<blockquote>\n  <p>Cannot insert explicit value for identity column in table  when\n  IDENTITY_INSERT is set to OFF</p>\n</blockquote>\n\n<p>Am I missing something? Are there any other options?</p>\n"},{"tags":["asp.net","asp.net-mvc","entity-framework","database-first","metadatatype"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12756721,"title":"Why MetadataType doesn't do my validation in database first approach?","body":"<p>I used Database-First to generate a model class (EDMX file), and I want to validate using \"MetadataType\". I read solutions here but they didn't work for me.  </p>\n\n<p>Here is my code:</p>\n\n<pre><code>[MetadataType(typeof(MovieEntitiesMetaData))]\npublic partial class MovieEntities\n{        \n}\n\npublic class MovieEntitiesMetaData\n{\n    [DisplayFormat(DataFormatString = \"{0:c}\")]\n    public Nullable&lt;global::System.Decimal&gt; PRICE { get; set; }\n}\n</code></pre>\n\n<p>Is there anything missing here, or why did my solution did not work?</p>\n"},{"tags":["entity-framework","asp.net-mvc-3","entity-framework-4.1"],"answer_count":2,"favorite_count":5,"up_vote_count":16,"down_vote_count":0,"view_count":4233,"score":16,"question_id":5414611,"title":"Entity Framework Validation confusion - maximum string length of '128'","body":"<p>I'm faced with a confusing problem where in my Edit or Create action result methods, EF4 will throw a DbEntityValidationException with the inner message stating:</p>\n\n<blockquote>\n  <p>The field Body must be a string or\n  array type with a maximum length of\n  '128'.</p>\n</blockquote>\n\n<p>The model in question looks like this:</p>\n\n<pre><code>[Table(\"tblArticles\")]\npublic class Article\n{\n    [Key]\n    public int ID { get; set; }\n    [Required(ErrorMessage=\"Title must be included\")]\n    public string Title { get; set; }\n    [AllowHtml]\n    public string Body { get; set; }\n    [Required(ErrorMessage=\"Start Date must be specified\")]\n    [Display(Name=\"Start Date\")]\n    [DisplayFormat(DataFormatString=\"dd-mm-yyyy\")]\n    public DateTime? StartDate { get; set; }\n    [Required(ErrorMessage = \"End Date must be specified\")]\n    [Display(Name = \"End Date\")]\n    public DateTime? EndDate { get; set; }\n    public int Priority { get; set; }\n    public bool Archived { get; set; }\n\n    public virtual ICollection&lt;ArticleImage&gt; Images { get; set; }\n}\n</code></pre>\n\n<p>The \"Body\" field in the actual database is of type Text, so there's no obvious limit there.  The data that I'm trying to post is this:</p>\n\n<blockquote>\n<pre><code>&lt;p&gt;\nThis is an example to confirm that new articles are looking right.&lt;/p&gt;\n&lt;p&gt;\n&lt;img alt=\"\" src=\"http://www.google.co.nz/logos/2011/houdini11-sr.jpg\"\nstyle=\"width: 160px; height: 56px; float: left;\" /&gt;&lt;/p&gt;\n</code></pre>\n</blockquote>\n\n<p>An example of the Edit method looks like this:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Edit(Article article)\n{\n    if (ModelState.IsValid)\n    {\n        try\n        {\n            articleRepository.Update(article);\n        }\n        catch (DbEntityValidationException dbevEx)\n        {\n            ErrorSignal.FromCurrentContext().Raise(dbevEx);\n            ModelState.AddModelError(\"FORM\", dbevEx);\n            return View(\"Edit\", article);\n        }\n        // Other exception handling happens...\n    }\n\n    return RedirectToAction(\"Index\");\n}\n</code></pre>\n\n<p>And finally, the method that actually does the grunt work is:</p>\n\n<pre><code>public void Update(T Entity)\n{\n    dbset.Attach(Entity);\n    db.Entry(Entity).State = System.Data.EntityState.Modified;\n    db.Commit();\n}\n</code></pre>\n\n<p>I can't see anything in code or in the database that might be causing the problem, so where else should I look?</p>\n"},{"tags":["sql-server","entity-framework","sql-server-ce","sql-server-express","sql-server-2012"],"answer_count":4,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":2036,"score":5,"question_id":9655374,"title":"SQL LocalDB vs SQL Server CE","body":"<p>I have a small project that will have 1 user on 1 computer. The database will be rather small (probably less than 1 mb of data). I plan to use WPF and Entity Framework for that project.</p>\n\n<p>I came up with 2 potential database solutions for my project : <strong>SQL Server CE</strong> and <strong>SQL Server Express LocalDB</strong> (with SQL Server 2012). I have never worked with any of those, I'm more used to work with the full SQL Server 2008 installation.  </p>\n\n<p>I also want it to be easy to install on the client. Ideally I'd like to just throw a bunch of files on a folder (along with my .exe file).</p>\n\n<p>So anybody here could suggest me the best technology to use?</p>\n\n<p>Thanks!</p>\n"},{"tags":["linq","entity-framework","generics","linq-to-sql","expression-trees"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":124,"score":3,"question_id":12755022,"title":"Generic expression for where clause - \"The LINQ expression node type 'Invoke' is not supported in LINQ to Entities.\"","body":"<p>I am trying to write a really generic way to load EF entities in batches, using the Contains method to generate a SQL IN statement.  I've got it working if I pass the entire expression in, but when I try to build the expression dynamically, I am getting a \"The LINQ expression node type 'Invoke' is not supported in LINQ to Entities.\"  So I know this means that EF thinks I'm calling an arbitrary method and it can't translate it into SQL, but I can't figure out how to get it to understand the underlying expression.</p>\n\n<p>So If I do something like this (just showing the relevant snippets):</p>\n\n<p>Function declaration:</p>\n\n<pre><code>public static List&lt;T&gt; Load&lt;T&gt;(IQueryable&lt;T&gt; entityQuery, int[] entityIds, Func&lt;T, int&gt; entityKey, int batchSize = 500, Func&lt;T, bool&gt; postFilter = null) where T : EntityObject\n{\n    var retList = new List&lt;T&gt;();\n\n    // Append a where clause to the query passed in, that will use a Contains expression, which generates a SQL IN statement.  So our SQL looks something like\n    // WHERE [ItemTypeId] IN (1921,1920,1922)\n    // See http://rogeralsing.com/2009/05/21/entity-framework-4-where-entity-id-in-array/ for details\n    Func&lt;int[], Expression&lt;Func&lt;T, bool&gt;&gt;&gt; containsExpression = (entityArray =&gt; (expr =&gt; entityArray.Contains(entityKey(expr))));\n\n    // Build a new query with the current batch of IDs to retrieve and add it to the list we are returning\n    newQuery = entityQuery.Where&lt;T&gt;(containsExpression(entityIds));\n    retList.AddRange(newQuery.ToList());\n\n    return retList;\n} \n</code></pre>\n\n<p>Call function:</p>\n\n<pre><code>var entities = BatchEntity.Load&lt;ItemType&gt;(from eItemType in dal.Context.InstanceContainer.ItemTypes\nselect eItemType\n, itemTypeData\n, (ek =&gt; ek.ItemTypeId)\n);\n</code></pre>\n\n<p>I get \"The LINQ expression node type 'Invoke' is not supported in LINQ to Entities.\"</p>\n\n<p>But if I change it to be this:</p>\n\n<p>Function declaration:</p>\n\n<pre><code>public static List&lt;T&gt; Load&lt;T&gt;(IQueryable&lt;T&gt; entityQuery, int[] entityIds, Func&lt;int[], Expression&lt;Func&lt;T, bool&gt;&gt;&gt; containsExpression, int batchSize = 500, Func&lt;T, bool&gt; postFilter = null) where T : EntityObject\n{\n    var retList = new List&lt;T&gt;();\n\n    // Build a new query with the current batch of IDs to retrieve and add it to the list we are returning\n    newQuery = entityQuery.Where&lt;T&gt;(containsExpression(entityIds));\n    retList.AddRange(newQuery.ToList());\n\n    return retList;\n} \n</code></pre>\n\n<p>Call function:</p>\n\n<pre><code>var entities = BatchEntity.Load&lt;ItemType&gt;(from eItemType in dal.Context.InstanceContainer.ItemTypes\nselect eItemType\n, itemTypeData\n, (entityArray =&gt; (ek =&gt; entityArray.Contains(ek.ItemTypeId)))\n);\n</code></pre>\n\n<p>It works fine.  Is there any way I can make EF understand the more generic version?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","mvc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":123,"score":0,"question_id":12754576,"title":"Create controller logic for ASP.Net MVC for logged in user","body":"<p>I have the following models:</p>\n\n<pre><code>public class Expense\n{\n    [Key]\n    [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n    public int ID { get; set; }\n    [Required]\n    public string Name { get; set; }\n    [Required]\n    [Column(TypeName = \"Money\")]\n    public decimal Limit { get; set; }\n    [Required]\n    [ForeignKey(\"UserProfile\")]\n    public int UserProfileId { get; set; }\n    [Required]\n    public virtual UserProfile UserProfile { get; set; }\n}\n\n[Table(\"UserProfile\")]\npublic class UserProfile\n{\n    [Key]\n    [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n    public int UserId { get; set; }\n    public string UserName { get; set; }\n    public virtual ICollection&lt;Expense&gt; Expenses { get; set; }\n}\n</code></pre>\n\n<p>I have a logged in user, and I would like that user to be able to add new Expenses. The create controller actions looks as follows:</p>\n\n<pre><code>    //\n    // GET: /Expenses/Create\n\n    public ActionResult Create()\n    {\n\n        return View();\n    }\n\n    //\n    // POST: /Expenses/Create\n\n    [HttpPost]\n    public ActionResult Create(Expense expense)\n    {            \n        if (ModelState.IsValid)\n        {\n            UserProfile user = db.UserProfiles.Single(u =&gt; u.UserName == User.Identity.Name)\n            user.Expenses.Add(expense);                \n            db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n\n        return View(expense);\n    }\n</code></pre>\n\n<p>With the view:</p>\n\n<pre><code>@model MoneyDrainPlug.Models.Expense\n\n@{\n    ViewBag.Title = \"Create\";\n}\n\n&lt;h2&gt;Create&lt;/h2&gt;\n\n@using (Html.BeginForm()) {\n    @Html.ValidationSummary(true)\n\n    &lt;fieldset&gt;\n        &lt;legend&gt;Expense&lt;/legend&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.Name)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.Name)\n            @Html.ValidationMessageFor(model =&gt; model.Name)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.Limit)\n        &lt;/div&gt;\n        &lt;div class=\"editor-field\"&gt;\n            @Html.EditorFor(model =&gt; model.Limit)\n            @Html.ValidationMessageFor(model =&gt; model.Limit)\n        &lt;/div&gt;        \n        &lt;p&gt;\n            &lt;input type=\"submit\" value=\"Create\" /&gt;\n        &lt;/p&gt;\n    &lt;/fieldset&gt;\n}\n\n&lt;div&gt;\n    @Html.ActionLink(\"Back to List\", \"Index\")\n&lt;/div&gt;\n\n@section Scripts {\n    @Scripts.Render(\"~/bundles/jqueryval\")\n}\n</code></pre>\n\n<p>When the post happens, ModelState.IsValid is false in the controller. This is because the there is no UserProfileId set in the expense. It does not help if I set the UserProfile and\\or UserProfileId before calling ModelState.IsValid.</p>\n\n<p>What would be the correct and secure way of handling this? Surely I should not trust a UserProfileId sent from the client? </p>\n\n<p>In case it matters, I am using asp.net MVC 4.</p>\n\n<p>Thanks in advance    </p>\n"},{"tags":["sql-server","oracle","entity-framework","poco"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":12754406,"title":"EF to POCO - Oracle or SQL Server - Numeric Mapping/Conversion","body":"<p>I have a legacy database schema that runs on either SQL Server or Oracle.  I would like to use Entity Framework and a single set of POCOs for the two databases, so I have been working through breaking out the edmx files and using different conceptual and physical definitions for the data.</p>\n\n<p>Where I'm having a problem is with existing numeric data because I can't change the types in the database.  The SQL Server definition is a float and Oracle is a number(19,4), which are reverse engineered to a double and a decimal respectively.  </p>\n\n<p>If I change the conceptual model to decimal (which should accommodate either type) I get an error indicating Edm.decimal is not compatible to SqlServer.float. If I leave the conceptual model at the reverse engineered value, then it gives an error saying that the conceptual type doesnt match with the POCO type (which is decimal since that seemed like it would be compatible with both databases).</p>\n\n<p>Any thoughts on how to approach this?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":96,"score":1,"question_id":12753400,"title":"Exception Handling in Entity Framework for SELECTs","body":"<p>One of the nice features of using Entity Framework and IEnumerables is that you don't have to worry about when the data is actually queried from the DB. You just pass around what will be query results and when it's actually needed, EF will get it for you. However, when it comes to putting a try/catch around your SELECT code, then it becomes an issue, because it's not easy to figure out exactly when the DB will be queried.</p>\n\n<p>I'm getting intermittent DB timeouts right now, and I'd like to log the SQL that EF uses when it happens, but I'm running into the problem I just described above. Is there any convenient way for me to handle this? Or am I looking at the problem wrong?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","automapper"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":3203,"score":2,"question_id":2165268,"title":"Entity Framework, AutoMapper, handling entity updates","body":"<p>I just started using the Entity Framework 1.0 recently and believe I am beginning to feel the pains everyone is talking about. I'm trying to use best practices so I have a set of DTO that get mapped to and from my Entities via AutoMapper.</p>\n\n<p>The real catch is when I'm trying to update an object.  The first gotcha was that I could not find a way to create a new entity, transfer the data from my DTO, and still have the entity ObjectContext realize that it has been changed. I used the following code:</p>\n\n<pre><code>public VideoDTO UpdateVideo(VideoDTO pVideo)\n        {\n            Video video = new Video();\n            Mapper.Map(pVideo, video);\n            context.Attach(video); //Successfully attaches\n            context.ApplyPropertyChanges(\"Videos\", video);  // no changes made as far as entity knows b/c it was attached in it's updated state\n            context.SaveChanges(); //doesn't save the entity                \n            return pVideo;\n        }\n</code></pre>\n\n<p>I then figured, perhaps I need to just grab the entity from the database first, attach to the context, call the Map method on Mapper, then call SaveChanges. Here what I did:</p>\n\n<pre><code>    public VideoDTO UpdateVideo(VideoDTO pVideo)\n    {\n        Video video = context.Videos.Where(v =&gt; v.VideoId == pVideo.VideoId).FirstOrDefault();\n        Mapper.Map(pVideo, video); //Error here: Can't change VideoId value on Video entity\n        //context.Attach(video);\n        //context.ApplyPropertyChanges(\"Videos\", video);\n        context.SaveChanges();\n\n        return pVideo;\n    }\n</code></pre>\n\n<p>Now we get to the lovely EF issue of not being allowed to change the property, VideoId, because it's used by the EntityKey property on the Video entity. Lovely. I had setup the mappings so that when I mapped from my DTO to an EF Entity, the EntityKey property would get a value. Now I need a way to make an exception to that mapping rule, but have no clue where to begin. I suppose I could create a brand new Mapping rule right in this method and set the EntityKey &amp; VideoId properties to be ignored, but that seems pretty sloppy. Furthermore, I'm not sure a mapping created at this point would stick. If it overrode the initial setup that allowed the DTO to map a value to the EntityKey on the entity, that would backfire in a whole different way.</p>\n\n<p>Anyone have a better idea?</p>\n"},{"tags":["entity-framework","odp.net","odac"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12738080,"title":"Multiple EF issues. What am I doing wrong?","body":"<p>All,</p>\n\n<p>I have the following connection string in an app.config file in a class-library project:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"MyConnection\" connectionString=\"metadata=res://*/Namespace.Model1.csdl|res://*/Namespace.Model1.ssdl|res://*/Namespace.Model1.msl;provider=Oracle.DataAccess.Client;provider connection string='data source=&amp;quot;(DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = myhost.mydomain.com)(PORT = 1521)))(CONNECT_DATA =(SERVICE_NAME = myservice.mydomain.com)(SERVICE = DEDICATED)))&amp;quot;;password=MyPasswd;persist security info=True;user id=MyID'\" providerName=\"System.Data.EntityClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>As you can see, I'm using ODAC to connect to an Oracle server.  Everything seems to work fine, and I can update my model (EntityFramework) from my database.</p>\n\n<p>However, when running the following code:</p>\n\n<pre><code>public class MyClass //classy, isn't it\n{\n    public MyClass()\n    {\n        MyCollectionEF = new MyCollection();\n    }\n    private MyCollection _MyCollectionEF;\n\n    public MyCollection MyCollectionEF\n    {\n        get\n        {\n            return _MyCollectionEF;\n        }\n        set\n        {\n            _MyCollectionEF = value;\n            _Region = (ICollection&lt;RegionEnt&gt;)_MyCollectionEF.RegionEnt.OrderBy(a =&gt; a.REGION);\n            _LangSource = (ICollection&lt;LangEnt&gt;)_MyCollectionEF.LangEnt.OrderBy(a =&gt; a.LANGUAGE);\n        }\n    }\n}\n</code></pre>\n\n<p>I end up with an \"UnintentionalCodeFirst\" Exception.  Okay, so clearly I'm probably doing something wrong at this point, but I persist and remove the throw exception from the OnModelCreating initializer (probably a bad idea, but I'm still new to this).</p>\n\n<p>Next, I end up with a ModelValidationException stating that none of my entities have any keys (though when I look at the model, I can clearly see the keys involved).</p>\n\n<p>Finally, after doing some digging, I find that when after initializing my _MyCollectionEF variable, the connection string magically changes to \"Data Source=.\\SQLEXPRESS;Initial Catalog=MyConnection;Integrated Security=True;MultipleActiveResultSets=True;Application Name=EntityFrameworkMUE\"</p>\n\n<p>Okay, so now for questions (and I have a lot of them, unfortunately).</p>\n\n<p>1) Why am I getting the UnintentionalCodeFirst Exception.  Is there a better way to load the data that I need into iCollections objects (or other objects suitable for data binding, adding, and removing data using MVVM pattern).</p>\n\n<p>2) Why does the ModelValidationException get raised when clearly there are keys in my model, and what's the best way to get around this (keeping in mind that I plan to use MVVM).</p>\n\n<p>3) Why is my ConnectionString magically changing?  Is this something that ODAC does behind the scenes, or is there a better reason.  I should point out that when doing _MyCollectionEF.DataBase.Connection.Open(), I get an error stating that the connection is refused for user \"mywindowslogon\", which makes sense because the actual server on the back-end is not setup for integrated security.</p>\n\n<p>Thanks in advance for all your help.</p>\n\n<p>EDIT: I should also point out that due to certain business requirements, parts of this are many:many relationship (i.e. in this simple example one region can have multiple languages and one language can have multiple regions).</p>\n\n<p>EDIT: Also asked on social.msdn.microsoft.com</p>\n"},{"tags":["query","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12737940,"title":"Match Dates and Count in Entity Framework","body":"<p>I have two tables:</p>\n\n<pre><code>create table dbo.Dates (\n  Id int not null\n    constraint Dates_Id_PK primary key clustered (Id),\n  [DateValue] date not null\n}\n\ncreate table dbo.Posts (\n  Id int identity not null \n    constraint Posts_Id_PK primary key clustered (Id),\n  Created datetime not null,\n  Title nvarchar (200) not null\n)\n</code></pre>\n\n<p>For these tables I have Date and Post entities.</p>\n\n<p>How can I get a table that has the column DateValue from Dates and the number of Posts with that date.</p>\n\n<p>I need to match the datetime Created value to the date DateValue.</p>\n\n<p>Thank you,</p>\n\n<p>Miguel</p>\n"},{"tags":["c#","asp.net","asp.net-mvc-3","entity-framework","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":99,"score":1,"question_id":12753476,"title":"Data validation with entity framework","body":"<p>I am using ADO.Net entity framework with asp.net mvc3. I have a model which is database first. The data validation does not work in some cases, as I will explain.</p>\n\n<p>I have a form, when I submit that form, some items are being validated while others are not. I am simply using a form like this,</p>\n\n<pre><code>    @using (Html.BeginForm()) {\n    @Html.ValidationSummary(true)\n\n\n   &lt;fieldset&gt;\n        &lt;legend&gt;&lt;/legend&gt;\n\n\n         &lt;div class=\"editor-label\"&gt;\n            @Html.LabelFor(model =&gt; model.VERSION_ID)\n            @Html.EditorFor(model =&gt; model.VERSION_ID)\n            @Html.ValidationMessageFor(model =&gt; model.VERSION_ID)\n        &lt;/div&gt;\n\n        &lt;div class=\"editor-field\"&gt;\n            @Html.LabelFor(model =&gt; model.ENTITY2.Name)\n            @Html.EditorFor(model =&gt; model.ENTITY2.Name)\n            @Html.ValidationMessageFor(model =&gt; model.ENTITY2.Name)\n        &lt;/div&gt;\n    &lt;p&gt;\n        &lt;input type=\"submit\" value=\"Create\" /&gt;\n    &lt;/p&gt;\n</code></pre>\n\n<p> </p>\n\n<p>Now, the version_id has validation working while the Name does not.  I am getting the name from another entity. Any ideas on why the validation is not working? I can input empty fields which should not be allowed as that field is required, but when i press submit i get an error.</p>\n"},{"tags":[".net","linq","entity-framework","exception","visual-studio-2012"],"answer_count":2,"favorite_count":2,"up_vote_count":9,"down_vote_count":0,"view_count":264,"score":9,"question_id":12489749,"title":"Linq to EF Join throws \"Index was out of range\" after upgrade from VS2010 to VS2012","body":"<p>After upgrading from Visual Studio 2010 to 2012 code started throwing \"ArgumentOutOfRangeException - Index was out of range. Must be non-negative and less than the size of the collection.Parameter name: index\" on Linq queries using Joins.</p>\n\n<p>The following simple example made in LINQPad (using an EF data model) gives me the ArgumentOutOfRangeException:</p>\n\n<pre><code>void Main()\n{\n    var iq1 = Customers.Select(ap =&gt; ap.ID);\n    var iq2 = iq1.Join(Customers.Select(ap =&gt; ap.ID),\n                    a =&gt; a,\n                    b =&gt; b,\n                    (a, b) =&gt; new { a });\n\n    iq2.Dump(); \n}\n</code></pre>\n\n<p>Changing the previous example to return an anonymous object containing both sides of the join doesn't give the ArgumentOutOfRangeException and gives results as expected:</p>\n\n<pre><code>void Main()\n{\n    var iq1 = ActionPlans.Select(ap =&gt; ap.ID);\n    var iq2 = iq1.Join(ActionPlans.Select(ap =&gt; ap.ID),\n                    a =&gt; a,\n                    b =&gt; b,\n                    (a, b) =&gt; new { a, b });\n\n    iq2.Dump(); \n}\n</code></pre>\n\n<p>Ok, so for some reason I had to return both sides of the join, but then I tried the following example using a dummy value instead, that also executed without a problem:</p>\n\n<pre><code>void Main()\n{\n    var iq1 = ActionPlans.Select(ap =&gt; ap.ID);\n    var iq2 = iq1.Join(ActionPlans.Select(ap =&gt; ap.ID),\n                    a =&gt; a,\n                    b =&gt; b,\n                    (a, b) =&gt; new { a, x = 1 });\n\n    iq2.Dump(); \n} \n</code></pre>\n\n<p>Taking the first example and adding a ToList() to the first query also makes it execute without a problem:</p>\n\n<pre><code>void Main()\n{\n    var iq1 = ActionPlans.Select(ap =&gt; ap.ID).ToList();\n    var iq2 = iq1.Join(ActionPlans.Select(ap =&gt; ap.ID),\n                    a =&gt; a,\n                    b =&gt; b,\n                    (a, b) =&gt; new { a });\n\n    iq2.Dump(); \n}\n</code></pre>\n\n<p><strong>Important:</strong> Trying the first query on a workstation without the Visual Studio 2012 upgrade works fine!</p>\n\n<p>Can anyone confirm/explain this new \"feature\"? :-)</p>\n"},{"tags":["linq","entity-framework","c#-4.0","caching","enterprise-library"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":182,"score":1,"question_id":12600710,"title":"Entity Framework - System.IndexOutOfRangeException","body":"<p>I'm using entity framework 4.1 which queries a SQL Server 2008 database. Unfortunately every often we get the exception below:</p>\n\n<pre><code>&lt;ExceptionType&gt;System.IndexOutOfRangeException, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/ExceptionType&gt;\n  &lt;Message&gt;Index was outside the bounds of the array.&lt;/Message&gt;\n\n\n\nat System.Data.SqlClient.SqlDataReader.ReadColumnHeader(Int32 i)\n   at System.Data.SqlClient.SqlDataReader.IsDBNull(Int32 i)\n   at System.Data.Common.Internal.Materialization.Shaper.ErrorHandlingValueReader`1.GetValue(DbDataReader reader, Int32 ordinal)\n   at System.Data.Common.Internal.Materialization.Shaper.GetPropertyValueWithErrorHandling[TProperty](Int32 ordinal, String propertyName, String typeName)\n   at lambda_method(Closure , Shaper )\n   at System.Data.Common.Internal.Materialization.Shaper.HandleEntityAppendOnly[TEntity](Func`2 constructEntityDelegate, EntityKey entityKey, EntitySet entitySet)\n   at lambda_method(Closure , Shaper )\n   at System.Data.Common.Internal.Materialization.Coordinator`1.ReadNextElement(Shaper shaper)\n   at System.Data.Common.Internal.Materialization.Shaper`1.SimpleEnumerator.MoveNext()\n   at System.Linq.Enumerable.First[TSource](IEnumerable`1 source)\n   at System.Linq.Queryable.First[TSource](IQueryable`1 source)\n   at OnlineSelfService.Business.ContentServiceBusiness.GetPageContent(Int32 pageId)&lt;/StackTrace&gt;\n</code></pre>\n\n<p>The actual sample code:</p>\n\n<pre><code>//Caller\n  public EmployeeEntity GetEmployeeDetail(int employeeID)\n    {\n         IQueryable&lt;Employee&gt; result=null;\n         if (myCaching.Contains(\"Employee\"))\n            {\n                result = (IQueryable&lt;Employee&gt;)myCaching[\"Employee\"];\n            }\n            else\n            {\n                result = dataAccess.GetEmployeeDetail();\n                myCaching.AddToCache(\"Employee\", result); //Expire in 2min\n            }\n\n            IQueryable&lt;Employee&gt; entityResult = from entity in result\n                                                         where entity.employeeId == employeeID\n                                                         select entity;\n       if (entityResult.Count&lt;Employee&gt;() &gt; 0)\n                return entityResult.First&lt;Employee&gt;();\n            return new EmployeeEntity();\n   }\n</code></pre>\n\n<p>}</p>\n\n<pre><code>//DAL\npublic IQueryable&lt;Employee&gt; GetEmployeeDetail()\n{\n    DatabaseEntities ent = new DatabaseEntities(this._connectionString);\n    IQueryable&lt;Employee&gt; result = from employee in ent.EmployeeEntity\n                                           select employee;\n\n    return result;\n}\n</code></pre>\n\n<p><strong>UPDATE**</strong>\nUpdated my code with caching.</p>\n\n<p>I googled to find and answer but could not find a definitive answer the root cause. Could some who have faced this issue share a resolution.</p>\n\n<p>Thank you.</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":28,"score":0,"question_id":12751335,"title":"How to organise friends table in db","body":"<p>I use MS ASP.NET MVC4 and EF5.0 (code-first). And here is my problem - how to store friendship of users in db, consider that there is weigth (or value) between two friends?</p>\n\n<p>So I designed model (class) which is refer to table, but I think it is not good enough:</p>\n\n<pre><code>public class Friendship\n{\n    [Key]\n    [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n    public int FriendshipId { get; set; }\n\n    public virtual UserProfile Friend1 { get; set; }\n    public virtual UserProfile Friend2 { get; set; }\n\n    public virtual int Grade { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12752232,"title":"Entity framework code first - work with existing empty database","body":"<p>Working on EF Codefirst 5.0, on deployment we created the empty database in order to create the username and permission level settings, because in the database server this user is specific to only this database.</p>\n\n<p>so we done above steps and tried to run the application, it throws below exception as it was not created by the EF code first, any solutions for handling this scenario?</p>\n\n<p>help on this really appreciated.</p>\n\n<p>Error: \nModel compatibility cannot be checked because the database does not contain model metadata. Model compatibility can only be checked for databases created using Code First or Code First Migrations. </p>\n"},{"tags":["c#","asp.net","linq","entity-framework","c#-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12740135,"title":"Convert Sql Pivot table query to linq in EF4","body":"<p>I have been doing one task from last three days. I try to convert one sql query into linq which is based on \"Convert Columns into Rows\" called Pivot table.</p>\n\n<p><strong>My SQL Query is as under.</strong></p>\n\n<pre><code>SELECT project_name\n,SUNDAY\n,MONDAY\n,TUESDAY\n,WEDNESDAY\n,THRUSDAY\n,FRIDAY\n,SATURDAY\nFROM\n(\n    SELECT project_name\n    ,personnel_name\n    ,DATENAME(dw, report_date) AS day_name\n    ,SUM(hours) AS HOURS\n    FROM [TimeSheet]\n\n    INNER JOIN [ProjectMaster] \n    ON [TimeSheet].[project_id] = [ProjectMaster].[project_id]\n\n    INNER JOIN [Personnel] \n    ON [TimeSheet].[personnel_id] = [Personnel].[personnel_id]\n    WHERE report_date BETWEEN getdate() - 7 AND getdate()\n    GROUP BY project_name, personnel_name, DATENAME(dw, report_date)\n) sourceQuery PIVOT (SUM(hours) \n FOR day_name IN \n (SUNDAY,MONDAY,TUESDAY,WEDNESDAY,THRUSDAY,FRIDAY,SATURDAY)) AS pvt\n</code></pre>\n\n<p><strong>What I do so far convert it into linq is below!!!</strong></p>\n\n<pre><code>var before = DateTime.Now.AddDays(-7);\nDateTime firstSunday = new DateTime(1753, 1, 7); \n\nvar DayWiseTS = from TSList in objWPFEntities.Timesheets.Include(\"ProjectMaster\").Include(\"Personnel\")\nwhere (TSList.report_date &gt;= before &amp;&amp; TSList.report_date &lt;= System.DateTime.Now)\nselect new { TSList.ProjectMaster.project_name, TSList.Personnel.personnel_name, TSList.report_date, TSList.hours } into sourceQuery\ngroup sourceQuery by new { sourceQuery.project_name, sourceQuery.personnel_name, sourceQuery.report_date, sourceQuery.hours } into pvt\nselect new \n{ \nprojectname = pvt.Key.project_name,\nSunday = (EntityFunctions.DiffDays(firstSunday, pvt.Key.report_date.Value) % 7 == 0 ? pvt.Sum(g =&gt; g.hours) : 0),\nMonday = (EntityFunctions.DiffDays(firstSunday, pvt.Key.report_date.Value) % 7 == 1 ? pvt.Sum(g =&gt; g.hours) : 0),\nTuesday = (EntityFunctions.DiffDays(firstSunday, pvt.Key.report_date.Value) % 7 == 2 ? pvt.Sum(g =&gt; g.hours) : 0),\nWednesday = (EntityFunctions.DiffDays(firstSunday, pvt.Key.report_date.Value) % 7 == 3 ? pvt.Sum(g =&gt; g.hours) : 0),\nThrusday = (EntityFunctions.DiffDays(firstSunday, pvt.Key.report_date.Value) % 7 == 4 ? pvt.Sum(g =&gt; g.hours) : 0),\nFriday = (EntityFunctions.DiffDays(firstSunday, pvt.Key.report_date.Value) % 7 == 5 ? pvt.Sum(g =&gt; g.hours) : 0),\nSaturday = (EntityFunctions.DiffDays(firstSunday, pvt.Key.report_date.Value) % 7 == 6 ? pvt.Sum(g =&gt; g.hours) : 0)\n};\n</code></pre>\n\n<p>I got result in both query but in sql, I got perfect result as I required, but in linq, I haven't get required data as sql.</p>\n\n<p><strong>sql result ::</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/diEXD.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Linq result ::</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/iIon7.png\" alt=\"enter image description here\"></p>\n\n<p>I think, in my linq query, I failed to do group by on hours!!</p>\n\n<p>can any one help me on this??</p>\n"},{"tags":["c#","winforms","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":94,"score":4,"question_id":12736958,"title":"How to make two way-databinding using EF in winforms?","body":"<p>I am very new at coding. Now I am going to tell you about my current situation and where I wanna go. Hope you will help.</p>\n\n<p>I am using EF5.0 database first approach and I want to be able to use gridviews for listing and updating the database values.</p>\n\n<p>Currently I am binding my data like this:</p>\n\n<pre><code>  pehlivan_kabametrajEntities ctx = new pehlivan_kabametrajEntities();\n        var result = from k in ctx.Kolons\n                     select k;\n        dataGridView1.DataSource = result.ToList();\n</code></pre>\n\n<p>This code lists my data perfectly. However it is wrong or not enough for my needs. Because I want to be able to edit my data right on the gridview. Please tell me what is wrong and what should I do. At least links of some documents that will reach me to the destination point I desire would be great. \nThx.</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":12749958,"title":"Updating multiple models in ASP.NET MVC","body":"<p>I need to capture three different types of information from a new user who is registering for the first time in an MVC 3 app (using EF code first). Ideally on the one page (which will have three tabs)</p>\n\n<ol>\n<li>User info</li>\n<li>Extended user info</li>\n<li>Benefits chosen by user</li>\n</ol>\n\n<p>The register method of the account controller should populate the user table when it fires. I need some advice on how best to capture the other data. DO I create a UserDetails model for the additional data? If so is it possible to update this from the same page? (which would be the Account/Register page. Do I need to do something in the account controller or will the relationship between the models be enough?</p>\n\n<p>Are there any good examples about that would explain this? I tried the MVC Contoso University one but couldn't see if I could do this.</p>\n\n<p>Any advice very welcome :)</p>\n\n<p>Thanks</p>\n"},{"tags":["wcf","entity-framework","interop","delphi-2010","odata"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":313,"score":2,"question_id":10312731,"title":"Consuming C# WCF service from Delphi 2010 client: Databinding and Entity Framework","body":"<p>I am migrating a win32 Delphi VCL application written in Delphi 2010 to a multi-tiered architecture. <br/>\nThe application makes extensive use of ExpressGrids (TcxGrid) by devexpress for databinding.<br/></p>\n\n<ul>\n<li>I have designed the data tier based on Entity framework, using\ndbContext and Data transfer objects.</li>\n<li>I have expose the CRUD operations via WCF using T4 templates based on the entity data model.</li>\n</ul>\n\n<p>That's all working fine, Delphi client successfully communicates with the WCF service, to exchange data transfer objects.</p>\n\n<p>The problem is, <strong>how do I maintain the Databinding functionality</strong>?\nI am leaning toward writing a service method that returns a generic data table, or a dataset. Can I convert linq statement results to Datasets, tables or views?\nI am not sure I can bind Expressgrids to arrays of objects (WCF returns entity collections, but Delphi sees arrays). Has any one had experience with this type of interoperability?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I have the data service returning DataSets, but guess what? The xml dataset from .net is not compatible with Delphi (2010 at least). I have managed to get that to work using the <a href=\"http://www.gekko-software.nl/DotNet/Art08.htm\" rel=\"nofollow\">Gekko example (modified)</a> , but it's not going to be practical due to the complexity of the queries we'd need to run from the client. Our options now, are to leave the Grids as they are until the BLL is complete and start a new project to re-write the client in C# (as a web or windows application) or, write a generic Grid plugin using RemObjects Hydra, to embed in forms with grids- trying to figure that out now.</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12749693,"title":"RefreshMode.ClientWins or StoreWins","body":"<p>I have a simple windows form application using Entity Framework, and i'm stucked in this situation:</p>\n\n<p>-User opens a windowsform (SearchForm) inside the MDIform, displaying products details and their actual stock qty.</p>\n\n<p>-User opens a second windowsform (POSForm) inside the MDIform (alongside SearchForm), and after selling productos, the stock of that product is updated to the new quantity and saved to the DB, at this moment, the other opened winform (SearchForm) must updates the displayed data with the new data, i'm trying reloading the context, reinstantiating the context, refreshing the form, but the form still shows the same data..\nI have an eventhandler in SearchForm, that fires when i call a method RefreshData() from POSForm, and try to refresh the data, but nothing seems to change.</p>\n\n<p>Just after closing that form (SearchForm) and then open it again, the data is displayed correctly.</p>\n\n<p>I don't know how to do a good refresh (i'm using context.Refresh(RefreshMode.StoreWins,entry))</p>\n"},{"tags":["asp.net-mvc","entity-framework","razor","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12744543,"title":"Custom HtmlHelper for changing labels","body":"<p>i want to provide a method of changing the labels associated with controls which will be rendered on the page via a lookup to a sql table. </p>\n\n<p>Ideally i want to inject the meta data display field which is then rendered on the page using the helper.</p>\n\n<pre><code>@Html.LabelFor(m =&gt; m.city)\n</code></pre>\n\n<p>Since this would need to be a  sql lookup at runtime, i cannot just change the class scaffolding tt template to stamp on a displayname annotation at design time.</p>\n\n<p>I thought of 3 potential methods.</p>\n\n<ol>\n<li><p>rewrite all the html.helpers i want to use. Problem with this is you would need to replicate all the functionality of the existing helper prior to making the changes. </p></li>\n<li><p>write a custom data annotation and stamp it on each property in the class i.e.</p>\n\n<p>[MyCustomNameAttribute] \npublic string city{ get; set; }</p>\n\n<p>then hopefully in the MyCustomNameAttribute class i can find both the linq field i am referring to, a reference to the metadatamodel and a database context using these i can retrieve and replace the DisplayName based on potential name customisations configured by the User. I tried to do this but was unable to find out how the [Display(Name=\"city\")] annotation works in the background. </p></li>\n<li><p>Modify the entity model backing code to inject the name into the metadatamodel.</p></li>\n</ol>\n\n<p>Does anyone have any experience of the above?</p>\n\n<p>Cheers\nTim</p>\n"},{"tags":["json","entity-framework","wcf-data-services","infragistics"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12332150,"title":"The exception message is 'Expression of type 'System.Data.Objects.ObjectContext'","body":"<p>I have a web application which uses WCF data service in asp.net. I am using Code-first approach, I created all my models and a class which extends DbContext class in the project.. All my aim is that Entity Framework does not support JSON serilazition after a googling, I see that you must follow code first approach to serilaze your model to JSON however my code first project gives me error in the browser when WCF Data service is called. </p>\n\n<p>My Context class (PurchaseOrderContext) which extends DbContext is the datasource class like following.</p>\n\n<pre><code>WcfDataService : DataService&lt;PurchaseOrderContext&gt;\n</code></pre>\n\n<p>I could not find anything about this error in the web, could you help me about this?</p>\n\n<p>The server encountered an error processing the request. The exception message is 'Expression of type 'System.Data.Objects.ObjectContext' cannot be used for return type 'System.Data.Objects.ObjectContext''. See server logs for more details. The exception stack trace is:</p>\n\n<pre><code> at System.Linq.Expressions.Expression.ValidateLambdaArgs(Type delegateType, Expression&amp; body, ReadOnlyCollection`1 parameters) \n at System.Linq.Expressions.Expression.Lambda[TDelegate](Expression body, String name, Boolean tailCall, IEnumerable`1 parameters) \n at System.Data.Services.Providers.DbContextHelper.CreateDbContextAccessor(Type type) \n at System.Data.Services.Providers.DbContextHelper.GetDbContextAccessor(Type type) \n at System.Data.Services.DataService`1.CreateProvider() \n at System.Data.Services.DataService`1.HandleRequest() \n at System.Data.Services.DataService`1.ProcessRequestForMessage(Stream messageBody) \n at SyncInvokeProcessRequestForMessage(Object , Object[] , Object[] ) \n at System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object instance, Object[] inputs, Object[]&amp; outputs) \n at System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp; rpc) \n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc&amp; rpc) \n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage41(MessageRpc&amp; rpc) \n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc&amp; rpc) \n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage31(MessageRpc&amp; rpc) \n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc&amp; rpc) \n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc&amp; rpc) \n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage11(MessageRpc&amp; rpc) \n at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc&amp; rpc) \n at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean isOperationContextSet)\n</code></pre>\n\n<p><br></p>\n\n<pre><code>[JSONPSupportBehavior]\n[System.ServiceModel.ServiceBehavior(IncludeExceptionDetailInFaults = true)]\npublic class WcfDataService : DataService&lt;PurchaseOrderContext&gt;\n{\n    // This method is called only once to initialize service-wide policies.\n    public static void InitializeService(DataServiceConfiguration config)\n    {\n        // TODO: set rules to indicate which entity sets and service operations are visible, updatable, etc.\n        // Examples:\n        // config.SetEntitySetAccessRule(\"MyEntityset\", EntitySetRights.AllRead);\n        // config.SetServiceOperationAccessRule(\"MyServiceOperation\", ServiceOperationRights.All);\n        config.SetEntitySetAccessRule(\"*\", EntitySetRights.All);\n\n        //config.DataServiceBehavior.UseMetadataKeyOrderForBuiltInProviders = true;\n        config.MaxBatchCount = 20;\n\n        //config.SetServiceOperationAccessRule(\"GetPlanNoteCategory\", ServiceOperationRights.All);\n        config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V3;\n    }\n}\n\nusing System;\nusing System.Data.Entity;\nusing System.Data.Entity.Infrastructure;\n\n\npublic partial class PurchaseOrderContext : DbContext\n{\n    public PurchaseOrderContext(): base(\"name=PurchaseOrderEntities\")\n    {\n\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        throw new UnintentionalCodeFirstException();\n    }\n\n    public DbSet&lt;customer&gt; customers { get; set; }\n    public DbSet&lt;customer_division&gt; customer_division { get; set; }\n    public DbSet&lt;customer_elec_addr&gt; customer_elec_addr { get; set; }\n    public DbSet&lt;customer_sizes&gt; customer_sizes { get; set; }\n    public DbSet&lt;po_confos&gt; po_confos { get; set; }\n    public DbSet&lt;po_lot&gt; po_lot { get; set; }\n    public DbSet&lt;po_picture&gt; po_picture { get; set; }\n    public DbSet&lt;po_sales_terms&gt; po_sales_terms { get; set; }\n    public DbSet&lt;po_sample_request&gt; po_sample_request { get; set; }\n    public DbSet&lt;po_shipping_document&gt; po_shipping_document { get; set; }\n    public DbSet&lt;po_size&gt; po_size { get; set; }\n    public DbSet&lt;po_size_color&gt; po_size_color { get; set; }\n    public DbSet&lt;po_specification&gt; po_specification { get; set; }\n    public DbSet&lt;purchase_order&gt; purchase_order { get; set; }\n    public DbSet&lt;ref_color&gt; ref_color { get; set; }\n\n\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":12748952,"title":"What's under the hood of the Entity Framework connection string?","body":"<p>This a very basic question.</p>\n\n<p>I am learning EF and see the following connection string:</p>\n\n<pre><code>&lt;add name=\"NorthwindEntities\" connectionString=\"metadata=res://*/myEF_Northwind.csdl|res://*/myEF_Northwind.ssdl|res://*/myEF_Northwind.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=.;initial catalog=Northwind;integrated security=True;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>Questions are:</p>\n\n<p>What does <strong>res://*</strong> mean?</p>\n"},{"tags":["entity-framework","lazy-loading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12748774,"title":"Techniques used with Entity Framework navigation properties","body":"<p>Starting to explore EF4.3.</p>\n\n<p>Using navigation properties makes things very easy, although I have a concern in one area, where I'd appreciate some advice on how other people deal with this scenario.</p>\n\n<p>Take the scenario - Store.Programme.ProgrammeAccountNumber when lazy loading nested properties.</p>\n\n<p>Store is the entity I'm querying.</p>\n\n<p>Programme is an entity, and also a navigation property of Store, and ProgrammeAccountNumber is a property of Programme.</p>\n\n<p>To get the original entity, I write something like this:</p>\n\n<pre><code>  public static IQueryable&lt;Store&gt; FindActive()\n    {\n        var r = new ReadRepo&lt;Store&gt;(Local.Items.Uow.Context);\n\n        return r.Find(s =&gt; s.StoreStatusId == (int)StoreStatus.Active);\n    }\n</code></pre>\n\n<p>But lets suppose that Programme has it's own status fields:</p>\n\n<pre><code>var store = StoreBL.FindActive()\n    .Where(s =&gt; s.Programme != null &amp;&amp; s.Programme.ProgramStatusId = (int)ProgrammeStatus);\n</code></pre>\n\n<p>It's not easy to remember all the conditions for each entity each time the query extends beyond the original entity.</p>\n\n<p>Imagine a chain of properties where I have a product, that has a start/end dates and a status, that belongs to a store, that has a programme with a status and is valid if the category it operates is live.</p>\n\n<p>I got to thinking there must be a technique for dealing with this effectively, or is it a case of using Lazy Loading sparingly?</p>\n\n<p>Any advice appreciated.  </p>\n"},{"tags":["c#","asp.net","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":47,"score":4,"question_id":12748641,"title":"Inserting Related Records into Database via Entity Framework","body":"<p>I'm curious if there is a clean way to do this</p>\n\n<pre><code>Product product = new Product();\nproduct.CreateDateTime = DateTime.Now;\nproduct.Description = productCreateModel.Product.Description;\nproduct.ManufacturerId = productCreateModel.Manufacturer;\nproduct.MetaDescription = productCreateModel.Product.MetaDescription;\nproduct.MetaTitle = productCreateModel.Product.MetaTitle;\nproduct.Name = productCreateModel.Product.Name;\nproduct.Status = ProductStatuses.Active;\nproduct.URL = productCreateModel.Product.URL;\n\nif (productCreateModel.ProductImage1.ContentLength &gt; 0)\n    {\n        BinaryReader binaryReader = new BinaryReader(productCreateModel.ProductImage1.InputStream);\n                product.ProductImages.Add(new ProductImage()\n                {\n                    CreateDateTime = DateTime.Now,\n                    Image = binaryReader.ReadBytes(productCreateModel.ProductImage1.ContentLength),\n                    PrimaryImage = true\n                });\n    }\ndb.Products.Add(product);\ndb.SaveChanges();\n</code></pre>\n\n<p>The problem i'm running into is that the product.ProductImages is null - I'd love to be able to do it this way INSTEAD of doing multiple db.TableName.Add/db.SaveChanges because if I understand it correctly EF creates a transaction so that if anything fails you won't have phantom product records inserted with no product images - if that makes sense?</p>\n"},{"tags":["c#","wcf","entity-framework","self-tracking-entities"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":259,"score":5,"question_id":12456905,"title":"Self-tracking entities not recommended anymore. What is?","body":"<p>Reading the msdn information on EF 5.0 and n-tier solutions <a href=\"http://msdn.microsoft.com/en-US/data/jj613668\">see link</a> , it seems that MS is not recommending STE's and the POCO/DTO way is also not recommended by stating that it is difficult.</p>\n\n<p>Not all (perhaps not many?) applications are suited for using WCF Data Services. So what is the way to go? My scenario is a current, large server (WebServices) application with many clients (only our own), mostly WinForms. Today DataSets are used to ship the data and track changes into the SQL Server database.</p>\n\n<p>We are now starting to replace WebServices with WCF and are also looking into using the Entity Framework. We don't need code first or migrations since we already have the database in place and a lot of stored procedures that will be reused.\nSince we don't have any issues with clients being other than our own, STE's seemed like a good choice, but we don't want to start using something that the EF team is clearly not recommending anymore. POCO/DTO has also been an alternative, not least for the clear separation against the clients. I know there is more work to be done then with the CUD, but is it so difficult that the recommendation is to stay away, then I don't know if we want to go down that road.</p>\n\n<p>Then, according to the recommendation we should use WCF data services or Web API, but that is really not an alternative for a operation-based service that needs to be flexible about protocol/format etc.</p>\n\n<p>So my question is, what is best-practice today?</p>\n"},{"tags":["wcf","json","entity-framework","asp.net-ajax"],"answer_count":7,"favorite_count":12,"up_vote_count":20,"down_vote_count":0,"view_count":13136,"score":20,"question_id":657939,"title":"Serialize Entity Framework objects into JSON","body":"<p>It seems that serializing Entity Framework objects into JSON is not possible using either WCF's native DataContractJsonSerializer or ASP.NET's native JavaScript Jersializer. This is due to the reference counting issues both serializers reject. I have also tried <a href=\"http://james.newtonking.com/projects/json-net.aspx\" rel=\"nofollow\">Json.NET</a>, which also fails specifically on a Reference Counting issue.</p>\n\n<hr>\n\n<p><strong>Edit:</strong> Json.NET can now <a href=\"http://james.newtonking.com/archive/2009/07/10/ado-net-entity-framework-support-accidently-added-to-json-net.aspx\" rel=\"nofollow\">serialize and deserialize Entity Framework entities</a>.</p>\n\n<hr>\n\n<p>My objects are Entity Framework objects, which are overloaded to perform additional business functionality (eg. authentication, etc.) and I do not want to decorate these classes with platform-specific attributes, etc. as I want to present a platform-agnostic API.</p>\n\n<p>I've actually blogged about the individual steps I went though at <a href=\"http://bloggingabout.net/blogs/program.x/archive/2009/03/18/wcf-json-serialization-woes.aspx\" rel=\"nofollow\">http://bloggingabout.net/blogs/program.x/archive/2009/03/18/wcf-json-serialization-woes.aspx</a></p>\n\n<p>Have I missed something obvious?</p>\n"},{"tags":[".net","entity-framework","linq-to-entities","polymorphism"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":70,"score":5,"question_id":12682089,"title":"EF4 Unable to cast concrete type to interface","body":"<p>Using Entity Framework LINQ, I'd like to return a parent class for every parent table and populate a property, whose type is an interface, on the parent class with one of multiple concrete implementations of an interface. Which concrete implementation should be determined at query time based on the value of a field in the parent table.</p>\n\n<p>In a very simplified example, I have 3 tables and 3 corresponding POCOs.</p>\n\n<p><strong>Simple tables for the sake of example</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/gDyw9.jpg\" alt=\"Three Tables: Master and two children\"></p>\n\n<p><strong>Simple classes for the sake of example</strong></p>\n\n<pre><code>internal interface IConfiguration\n{\n}\n\ninternal class ConfigurationContainer\n{\n    public IConfiguration Config { get; set; }\n}\n\ninternal class ConfigurationSouth : IConfiguration\n{\n}\n\ninternal class ConfigurationNorth : IConfiguration\n{\n}\n</code></pre>\n\n<p>Unfortunately, I loop through all the parent results and determine which subquery to use while inside the loop. Something <strong>like</strong> this block.</p>\n\n<pre><code>foreach (var configMaster in db.ConfigMasters.ToList())\n{\n    var configContainer = new ConfigurationContainer();\n    if (configMaster.IsNorth)\n        configContainer.Config = (from x in db.ConfigNorths\n                          select new ConfigurationNorth())\n                                      .FirstOrDefault();\n    else\n        configContainer.Config = (from x in db.ConfigSouths\n                          select new ConfigurationSouth())\n                                      .FirstOrDefault();\n}\n</code></pre>\n\n<p>Looping through each of the parent records to perform a subquery is less than optimal. I'd really like the EF LINQ to perform the query in one trip to the database as well as do the projections into my POCOs.</p>\n\n<p>I came up with this LINQ to query the database in one trip and return the projected objects such that the Config property would be populated by one of the two subqueries at querytime. Though it compiles, it throws an exception at runtime.</p>\n\n<pre><code>using (var db = new Entities())\n{\n    var qry = from cfgMaster in db.ConfigMasters\n                let configNorth = (from x in db.ConfigNorths\n                                    select new ConfigurationNorth())\n                    .FirstOrDefault()\n                let configSouth = (from x in db.ConfigSouths\n                                    select new ConfigurationSouth())\n                    .FirstOrDefault()\n                select new ConfigurationContainer()\n                    {\n                        Config = cfgMaster.IsNorth ? configNorth : (IConfiguration) configSouth\n                    };\n\n    var results = qry.ToList();\n}\n</code></pre>\n\n<p><strong>Exception</strong></p>\n\n<blockquote>\n  <p>Unhandled Exception: System.NotSupportedException: Unable to cast the\n  type 'EFTest.ConfigurationNorth' to type 'EFTest.IConfiguration'. LINQ\n  to Entities only supports casting Entity Data Model primitive types.</p>\n</blockquote>\n"},{"tags":["entity-framework","json.net","asp.net-web-api"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":381,"score":1,"question_id":9674746,"title":"How to ignore navigation properties when serializing","body":"<p>I'm using ASP.NET Web API with Entity Framework.\nI changed my default serializer to JSON.NET (cause the default DataContractSerializer didn't work at all with EF). \nNow it's better (it's working at least), however still not perfect. After sending the GET request I obtain all properties from one table plus lot's of data from navigation properties (so basically all data from other entities which have relation with entity I want to obtain...).\nHow can I make it serializing only fields from this entity and not navigation properties?</p>\n\n<p>Thanks for help</p>\n"},{"tags":["c#","entity-framework","stored-procedures","sql-server-2008-r2","sql-injection"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12744750,"title":"Stored procedure input validation in EF","body":"<p>I have imported a SQL Server stored procedure into the <code>.edmx</code> file. I'm calling the generated method like:</p>\n\n<pre><code>entity.MySP(stringInput)\n</code></pre>\n\n<p>Does the <code>stringInput</code> parameter need to be validated (for SQL injections etc) when using EF, or can I assume EF does that for me? If not, is there a method I can call to escape/validate the input parameter?</p>\n\n<p>I'm using SQL Server 2008 R2, .NET 4.0, C#, ASP.NET MVC 4, VS2010.</p>\n\n<p>EDIT:\nNote that I'd like to use LINQ instead of calling a SP, but I'm using FREETEXT, so I <em>think</em> this is the more elegant solution.</p>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12747087,"title":"Updating the same Entity after calling SaveChanges causes Exception with EF5","body":"<p>I have an entity which I need to save twice.\nThe first time is to set the ID.\nThis ID needs to be filled to calculate a signature and that signature is stored back to the entity.</p>\n\n<p>See the following code:</p>\n\n<pre><code>var newEntity = new MyEntity \n    { \n        \\\\ set values \n    };\n\nusing (var db = MyContainer.CreateContainer())\n{\n    db.MyEntity.Add(newEntity);\n    // Call SaveChanges() to set the ID.\n    db.SaveChanges();\n\n    // I need to do some calculation on the entity\n    myEntity.Signature = CalculateSignature(myEntity);\n    db.SaveChanges(); // &lt;--- This causes the exception\n}\n</code></pre>\n\n<p>This piece of code causes an InvalidOperationException, namely <code>The relationship between the two objects cannot be defined because they are attached to different ObjectContext objects.</code></p>\n\n<p>I don't understand, am I not allowed to save the same entity twice? How would I go about achieving this?</p>\n"},{"tags":[".net","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12745474,"title":"Navigation property in optional:optional where only one table has foreign key","body":"<p>I am trying to define the following model where Appointment table has foreign key for Person, and the entities both have navigation properties to each other. </p>\n\n<pre><code>public class Appointment\n{\n    public int AppointmentId { get; set; }\n\n    // Foreign Key property (this will be created in DB)\n    public int? PersonId { get; set; }\n\n    // Navigation property to Flatmate\n    public virtual Person Person { get; set; }\n}\n\npublic class Person\n{\n    public int PersonId { get; set; }\n\n    // Just navigation property. Don't want Person table to include foreign key (no need)\n    public virtual Appointment Appointment { get; set; }\n}\n</code></pre>\n\n<p>I try to use fluent config:</p>\n\n<pre><code>     modelBuilder.Entity&lt;Appointment&gt;()\n            .HasOptional(a =&gt; a.Person)\n            .WithOptionalDependent(p=&gt; p.Appointment);\n</code></pre>\n\n<p>But I get an exception that its missing a column (either Appointment_AppointmentId or Person_PersonId, depending on whether I use WithOptionalDependent or WithOptionalPrincipal).</p>\n"},{"tags":["asp.net-mvc","visual-studio-2010","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12743672,"title":"unable to migrate data on production server in mvc4 project","body":"<p>I have a application that is running in production environment. Now I need some changes in model class I do this and add-migrations command in local package manager console of vs2012. entity framework code first data migration is done successfully on my local system. But I am unable to get migration data on production server. I follow this link <a href=\"http://www.davidhayden.me/blog/asp.net-mvc-4-and-entity-framework-database-migrations\" rel=\"nofollow\">http://www.davidhayden.me/blog/asp.net-mvc-4-and-entity-framework-database-migrations</a> and also checked Execute Code First migration on (run on application start) while publishing application on server.  my global class having this </p>\n\n<pre><code> protected void Application_Start()\n    {\n        AreaRegistration.RegisterAllAreas();\n\n        FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);\n        RouteConfig.RegisterRoutes(RouteTable.Routes);\n        BundleConfig.RegisterBundles(BundleTable.Bundles);\n        //BundleTable.Bundles.EnableDefaultBundles();\n\n        Database.SetInitializer&lt;OfferAssistantDB&gt;(new ApplicationDBInitializer());\n    }\n\n    public class ApplicationDBInitializer : DropCreateDatabaseIfModelChanges&lt;OfferAssistantDB&gt;\n    {\n        protected override void Seed(OfferAssistantDB context)\n        {\n            SeedService.InitializeSeedData(context);\n        }\n    }\n</code></pre>\n\n<p>When i publish changes application not insert any thing in .config and noting on other files. application just drop production db and create new one with empty tables. how I do successful data migration on production application ? and tell me what i am missing ?</p>\n"},{"tags":["entity-framework","transactions","scope"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":268,"score":0,"question_id":7525325,"title":"Entity Framework 4 Transaction Scope","body":"<p>I am running 2 INSERTS inside a function. The first one is a non-entity framework INSERT (AD0.NET). The second one is an EntityContext.SaveChanges()</p>\n\n<p>Can I not nest both of these inside a Transaction Scope ?</p>\n"},{"tags":["c#","entity-framework","inheritance","entity-framework-4"],"answer_count":1,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":193,"score":4,"question_id":12704033,"title":"EF4 and multiple abstract levels","body":"<p>I need to use inheritance with EF4 and the TPH model created from DB.<br>\nI created a new projet to test simples classes.\nThere is my class model:</p>\n\n<p><img src=\"http://i.stack.imgur.com/D23Sg.png\" alt=\"enter image description here\"></p>\n\n<p>There is my table in SQL SERVER 2008 :</p>\n\n<pre><code>VEHICLE \n  ID : int PK\n  Owner : varchar(50)\n  Consumption : float\n  FirstCirculationDate : date\n  Type : varchar(50)\n  Discriminator : varchar(10)\n</code></pre>\n\n<p>I added a condition in my EDMX on the Discriminator field to differentiate the Scooter, Car, Motorbike and Bike entities.</p>\n\n<p>MotorizedVehicle and Vehicle are Abstract.</p>\n\n<p>But when I compile, this error appears :</p>\n\n<blockquote>\n  <p>Error 3032: Problem in mapping fragments starting at lines 78,\n  85:EntityTypes EF4InheritanceModel.Scooter, EF4InheritanceModel.Motorbike,\n  EF4InheritanceModel.Car, EF4InheritanceModel.Bike are being mapped\n  to the same rows in table Vehicle. Mapping conditions can be used to\n  distinguish the rows that these types are mapped to.</p>\n</blockquote>\n\n<p><strong>Edit :</strong><br>\nTo Ladislav :<br>\nI try it and error change to become it for all of my entities :</p>\n\n<blockquote>\n  <p>Error 3034: Problem in mapping fragments starting at lines 72, 86:An entity is mapped to > different rows within the same table. Ensure these two mapping fragments do not map two > groups of entities with overlapping keys to two distinct groups of rows.</p>\n</blockquote>\n\n<p>To Henk (with Ladislay suggestion) :<br>\nThere are all of mappings details :\n<img src=\"http://i.stack.imgur.com/CMqGp.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/joXis.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/6maA1.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/Yta5c.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/Dphx8.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/rScjb.png\" alt=\"enter image description here\"></p>\n\n<p>What's wrong ?</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework","ef-code-first","dbcontext","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":302,"score":0,"question_id":12742473,"title":"Most efficiently handling Create, Update, Delete with Entity Framework Code First","body":"<blockquote>\n  <p><strong>Note:</strong> I am using Entity Framework version  5</p>\n</blockquote>\n\n<p>Inside my generic repository, I have <code>Add</code>, <code>Edit</code> and <code>Delete</code> methods as below:</p>\n\n<pre><code>public class EntityRepository&lt;T&gt; : IEntityRepository&lt;T&gt;\n    where T : class, IEntity, new() {\n\n    readonly DbContext _entitiesContext;\n\n    public EntityRepository(DbContext entitiesContext) {\n\n        if (entitiesContext == null) {\n\n            throw new ArgumentNullException(\"entitiesContext\");\n        }\n\n        _entitiesContext = entitiesContext;\n    }\n\n    //...\n\n    public virtual void Add(T entity) {\n\n        DbEntityEntry dbEntityEntry = _entitiesContext.Entry&lt;T&gt;(entity);\n        if (dbEntityEntry.State != EntityState.Detached) {\n\n            dbEntityEntry.State = EntityState.Added;\n        }\n        else {\n\n            _entitiesContext.Set&lt;T&gt;().Add(entity);\n        }\n    }\n\n    public virtual void Edit(T entity) {\n\n        DbEntityEntry dbEntityEntry = _entitiesContext.Entry&lt;T&gt;(entity);\n        if (dbEntityEntry.State == EntityState.Detached) {\n\n            _entitiesContext.Set&lt;T&gt;().Attach(entity);\n        }\n\n        dbEntityEntry.State = EntityState.Modified;\n    }\n\n    public virtual void Delete(T entity) {\n\n        DbEntityEntry dbEntityEntry = _entitiesContext.Entry&lt;T&gt;(entity);\n        if (dbEntityEntry.State != EntityState.Detached) {\n\n            dbEntityEntry.State = EntityState.Deleted;\n        }\n        else {\n\n            DbSet dbSet = _entitiesContext.Set&lt;T&gt;();\n            dbSet.Attach(entity);\n            dbSet.Remove(entity);\n        }\n    }\n}\n</code></pre>\n\n<p>Do you think whether these methods are well implemented? Especially the <code>Add</code> method. Would it be better to implement the <code>Add</code> method as below?</p>\n\n<pre><code>public virtual void Add(T entity) {\n\n    DbEntityEntry dbEntityEntry = _entitiesContext.Entry&lt;T&gt;(entity);\n    if (dbEntityEntry.State == EntityState.Detached) {\n\n        _entitiesContext.Set&lt;T&gt;().Attach(entity);\n    }\n\n    dbEntityEntry.State = EntityState.Added;\n}\n</code></pre>\n"},{"tags":["sql-server","entity-framework","ef-code-first","code-first-migrations"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12704519,"title":"How to control primary key values when seeding data with Entity Framework codefirst","body":"<p>I am creating an asp.net mvc4 site using entity framework 5 with codefirst and sql server express 2012.</p>\n\n<p>I have enabled migrations and now do this in my Configuration.Seed method:\n(note that I want to set the primary key to 8 even though this is the first record in the database).</p>\n\n<pre><code>context.ProductCategoryDtoes.AddOrUpdate(x =&gt; x.Id,\n    new ProductCategoryDto() { Id = 8, Name = \"category1\" }\n);\n</code></pre>\n\n<p>My Model object is defined like this:</p>\n\n<pre><code>[Table(\"ProductCategory\")]\npublic class ProductCategoryDto {\n    public long Id { get; set; }\n    public string Name { get; set; }\n}\n</code></pre>\n\n<p>This results in a table in (SQL SERVER EXPRESS 2012) where the Id column has Identity = true,  Identity seed = 1, identity increment = 1. </p>\n\n<p>Now when I run migrations by doing an <code>PM&gt; Update-Database</code> this result in a row with Id = 1.</p>\n\n<p>So my question are:</p>\n\n<p>1) How can I control the values of auto incremented primary keys when seeding data.</p>\n\n<p>2) If the solution is to increment the key columns seed value, then how is this to be done when I am using <code>Database.SetInitializer(new DropCreateDatabaseAlways&lt;MyContext&gt;());</code>. This will nuke and rebuild the database everytime I update the database, so how would the seed value be updated in the fresh database?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12712226,"title":"SSDL Content of the edmx file emptied after update from database","body":"<p>I'm using Visual Studio 2010 (SP1) with EF.\nWhen I tried to update the edmx file of my application, the SSDL Content part of the file gets emptied.\nConsequences are that the mapping details of every entity is emptied, meaning tables that already exist don't refresh.</p>\n\n<p>For example, the SSDL Content section looked like this before :</p>\n\n<pre><code>&lt;!-- SSDL content --&gt;\n&lt;edmx:StorageModels&gt;\n&lt;Schema Namespace=\"DataAccess.Store\" Alias=\"Self\" Provider=\"System.Data.SqlClient\" ProviderManifestToken=\"2005\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" xmlns=\"http://schemas.microsoft.com/ado/2009/02/edm/ssdl\"&gt;\n    &lt;EntityContainer Name=\"DataAccessStoreContainer\"&gt;\n      &lt;EntitySet Name=\"Amdec\" EntityType=\"DataAccess.Store.Amdec\" store:Type=\"Tables\" Schema=\"dbo\" /&gt;\n...\n</code></pre>\n\n<p>After, I got that : </p>\n\n<pre><code>&lt;!-- SSDL content --&gt;\n&lt;edmx:StorageModels&gt;\n&lt;Schema Namespace=\"DataAccess.Store\" Alias=\"Self\" Provider=\"System.Data.SqlClient\" ProviderManifestToken=\"2005\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" xmlns=\"http://schemas.microsoft.com/ado/2009/02/edm/ssdl\"&gt;\n    **&lt;EntityContainer Name=\"DataAccessStoreContainer\"/&gt;**\n</code></pre>\n\n<p>Any clue ?</p>\n"},{"tags":["c#","entity-framework","ef-code-first","poco","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12739272,"title":"EF Code First schema design - User and Contact","body":"<p>I'm trying to come up with a model for managing Person and its Friends.</p>\n\n<ul>\n<li>A Person has 0-to-many Friends</li>\n<li>A Friend is a Person too - not the same one though</li>\n<li>A Friend can belong one or more Groups</li>\n</ul>\n\n<p>Roughly, the schema looks something like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/5h4Dz.png\" alt=\"enter image description here\"></p>\n\n<p>I cannot figure out how to achieve the same with EF Code First. This is what I have so far but this doesn't create the required schema</p>\n\n<pre><code>public class Person \n{\n    public long Id { get; set; }\n    public string Name { get; set; }\n    public string Email { get; set; }\n    public virtual ICollection&lt;Person&gt; Friends { get; set; } // is this right?\n}\n\npublic class Friend {\n    public long Id { get; set; }\n    public long PersonId { get; set; }  // Person whose Friend this guy is\n    public virtual ICollection&lt;Group&gt; Groups { get; set; } \n\n    // other fields \n}\n\npublic class Group{\n    public long Id { get; set; }\n    public string Name { get; set; }\n}\n</code></pre>\n\n<p>Can someone help me figure out this mess?</p>\n"},{"tags":["c#","entity-framework","linq-to-sql"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":186,"score":0,"question_id":12739802,"title":"Cannot implicitly convert type 'System.Collections.Generic.List<AnonymousType#1>' to 'System.Collections.Generic.IList","body":"<p>I'm try to use \"GROUP BY\" im MVC</p>\n\n<p>This is my function</p>\n\n<pre><code>  private readonly ICacheManager _cacheManager;\n\n\npublic virtual IList&lt;ShippingByWeightRecord&gt; GetAll()\n        {\n            string key = SHIPPINGBYWEIGHT_ALL_KEY;\n            return _cacheManager.Get(key, () =&gt;\n            {\n\n\n                var query = from sbw in _sbwRepository.Table\n                            group sbw by new\n                            {\n                                sbw.ShippingMethodId,\n                                sbw.From,\n                                sbw.To,\n                                sbw.ShippingChargeAmount,\n                                sbw.RegionId,\n                                sbw.ItemRangeId\n\n                            }\n                                into grouping\n                                select new { grouping.Key,\n                                             Id = grouping.Max(sbw =&gt; sbw.Id)\n                                 };     \n\n                 var records = query.ToList();\n                return records;\n            });\n        }\n</code></pre>\n\n<p>But there is error. How to do it??\nThis is my sql Command.</p>\n\n<pre><code>SELECT     MIN(Id) AS id, ShippingMethodId, [From], [To], ShippingChargeAmount, RegionId, ItemRangeId\nFROM         ShippingByWeight\nGROUP BY ShippingMethodId, [From], [To], ShippingChargeAmount, RegionId, ItemRangeId\n</code></pre>\n\n<p>I want to write it in MVC?\nDo you have any idea???</p>\n"},{"tags":["entity-framework","visual-studio-2012","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12737745,"title":"Cannot get \"Generate Database from Model\" using \"Migration T-SQL\" approach in VS2012/EF5. Is this a bug??? Works fine in VS2010","body":"<p>I have got a tricky problem with VS2012 and EF5. I have posted the full details on the MSDN forum, see: <a href=\"http://social.msdn.microsoft.com/Forums/en-US/adodotnetentityframework/thread/c63bf034-f205-4b4e-82e0-40b1c3fca71d\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/adodotnetentityframework/thread/c63bf034-f205-4b4e-82e0-40b1c3fca71d</a>. </p>\n\n<p>However it seems that the EF team are now recommending we also post on here as well, so I am.</p>\n\n<p>Many thanks.</p>\n"},{"tags":["entity-framework","code-first"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1162,"score":4,"question_id":5378678,"title":"Entity Framework Code First and Multiple Assemblies","body":"<p>I have a subclass in a different assembly to its base class. The parent is a POCO class used for EF Code First.</p>\n\n<p>When I try to add an instance of inherited class to the database I get <strong><em>InvalidOperationException:</em></strong> <em>\"Object mapping could not be found for Type with identity 'Foo.Bar.MyInheritedClass'\".</em></p>\n\n<p>It works fine if subclass is in same assembly as base class.</p>\n\n<p>In regular EF the <a href=\"http://social.msdn.microsoft.com/Forums/en/adodotnetentityframework/thread/df770006-43c1-4576-951f-1b2e396202a6\" rel=\"nofollow\">solution seems to be</a> a call to <strong>ObjectContext.MetadataWorkspace.LoadFromAssembly(assembly)</strong>. But I can't figure out how this relates to Code First. </p>\n\n<p>Any advice?</p>\n\n<p>I'm using <strong>Entity Framework 4.1 RC.</strong></p>\n"},{"tags":["oracle","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":12738224,"title":"Using Entity Framework and Oracle.Dataaccess.Client - calling stored procedure from a different schema","body":"<p>How do I call a stored procedure, defined in an Oracle package and returns a SYS_REFCURSOR, but only list the bind and metadata information once in the Web.config file?  I have multiple environments that execute the same code, and access their own Oracle database schema - each schema is set up identically with the same tables and packages.</p>\n\n<p>Assume the following setup:\n2 Oracle database schemas - DEV1 and DEV2\nThey are both identical, with the same tables, and packages.\nThey both have a package called PKG1 with a stored procedure defined as SP1.\nSP1 has a SYS_REFCURSOR out parameter that, when returned, contains the set of values retrieved by the SQL statement within SP1.  The idea being that when SP1 is called from the DEV1 schema, that it pulls data out of the DEV1 tables, and when it is called from the DEV2 schema that it pulls data out of the DEV2 tables.</p>\n\n<p>I have used Entity Framework to map and do the Function Import of SP1.  I can call SP1 from my .NET code if I use the DEV1 connection string, but if the DEV2 connection string is used I get the following error message:\n{\"ORA-06550: line 1, column 7:\\nPLS-00306: wrong number or types of arguments in call to 'SP1'\\nORA-06550: line 1, column 7:\\nPL/SQL: Statement ignored\"}   System.Exception {Oracle.DataAccess.Client.OracleException}</p>\n\n<p>Here's the code to call the stored procedure:</p>\n\n<pre><code>string connStr = Common.GetSqlDBConnectionString();\nusing (TestEntities te = new teEntities(connStr))\n{\n    foreach (var result in te.SP1())\n    {\n       // Process each set of returned data\n       ...\n    }\n}\n</code></pre>\n\n<p>Here's the web.config entry:</p>\n\n<pre><code>&lt;oracle.dataaccess.client&gt;\n    &lt;settings&gt;\n        &lt;add name=\"DEV1.PKG1.SP1.RefCursor.ID\" value=\"implicitRefCursor bindinfo='mode=Output'\" /&gt;\n        &lt;add name=\"DEV1.PKG1.SP1.RefCursorMetaData.ID.Column.0\" value=\"implicitRefCursor     metadata='ColumnName=ID;BaseColumnName=ID;BaseSchemaName=DEV1;BaseTableName=TABLE1;NATIVEDATATYPE=number;ProviderType=Int32'\" /&gt;\n    &lt;/settings&gt;\n&lt;/oracle.dataaccess.client&gt;\n</code></pre>\n\n<p>Here's what the SSDL portion of the edmx file lloks like:</p>\n\n<pre><code>&lt;edmx:StorageModels&gt;\n&lt;Schema Namespace=\"Test.Store\" Alias=\"Self\" Provider=\"Oracle.DataAccess.Client\" ProviderManifestToken=\"10.2\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" xmlns=\"http://schemas.microsoft.com/ado/2009/02/edm/ssdl\"&gt;\n    &lt;EntityContainer Name=\"TestStoreContainer\" /&gt;\n    &lt;Function Name=\"PKG1_SP1\" Aggregate=\"false\" BuiltIn=\"false\" NiladicFunction=\"false\" IsComposable=\"false\" ParameterTypeSemantics=\"AllowImplicitConversion\" StoreFunctionName=\"PKG1.SP1\" Schema=\"\"&gt;\n</code></pre>\n\n<p>I am assuming the problem is with the function import mapping the complex type to the metedata defined in the web.config file that specifies the DEV1 schema, but I certainly could be wrong.  </p>\n"},{"tags":["c#","entity-framework","code-first","ef-migrations","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":702,"score":1,"question_id":9769515,"title":"C# Code-First migration, up/down?","body":"<p>Started to use the add-migration command in the package manager console to generate the migrations for my model. My question is, the up and down method. I assume that the purpose of the down method is to remove all dependencies and drop the tables if they are already in the database? Also that the down method will be executed before the up method?\nThe up method is then the reverse, create/update tables/indexes etc?</p>\n\n<p>Sometimes when i use this then the down method gets a lot of create tables that then are dropped? Recently it created and dropped a lot of tables and almost the same thing happened in the up method. Why?</p>\n"},{"tags":["entity-framework","code-first","private-members"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":79,"score":3,"question_id":12720437,"title":"Problems when mapping a private property","body":"<p>I have two entity classes Project and Product with one-to-many association:</p>\n\n<pre><code>public class Product\n{\n   public string Id {get; set;}\n\n   public virtual Project Project {get; set;}\n}\n\npublic class Project\n{\n    public string Id {get; set;}\n    protected virtual List&lt;Product&gt; Products {get; set;}\n\n    public ReadOnlyCollection&lt;Product&gt; GetProducts()\n    {\n        return Products.AsReadOnly();\n    }\n\n    public class PropertyAccessExpressions\n    {\n        public static Expression&lt;Func&lt;Project, ICollection&lt;Product&gt;&gt;&gt; Products = x =&gt; x.Products;\n    }\n}\n\npublic class MyDbContext: DbContext\n{\n    public MyDbContext(string connectionString): base(connectionString){}\n\n    public DbSet&lt;Project&gt; Projects {get; set;}\n    public DbSet&lt;Product&gt; Products {get; set;}\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n         //// project.GetProducts() fails for the following configuratin\n         //modelBuilder.Entity&lt;Product&gt;()\n         //  .HasRequired(p =&gt; p.Project).WithMany(Project.PropertyAccessExpressions.Products);\n\n         // The following is OK             \n         modelBuilder.Entity&lt;Project&gt;()\n          .HasMany(Project.PropertyAccessExpressions.Products).WithRequired(p =&gt; p.Project);\n    }\n} \n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        var context = new MyDbContext(@\"data source=localhost;initial catalog=MyTestDb;integrated security=True;\");\n        context.Database.Delete();\n        context.Database.Create();\n\n        var project1 = new Project { Id = \"ProjectId1\" };\n        context.Projects.Add(project1);\n        context.Products.Add(new Product { Id = \"ProductId1\", Project = project1 });\n        context.Products.Add(new Product { Id = \"ProductId2\", Project = project1 });\n        context.SaveChanges();\n\n        var project = context.Projects.ToList()[0];;\n        var products = project.GetProducts().ToList();\n        Debug.Assert(products.Count == 2);\n    }\n}\n</code></pre>\n\n<p>To map the protected property, I use <a href=\"http://blog.cincura.net/232731-mapping-private-protected-properties-in-entity-framework-4-x-code-first/\" rel=\"nofollow\">this solution</a>.</p>\n\n<p>But I encountered the following problems:</p>\n\n<p>1) if I configure the one-to-many association between Project and Product with </p>\n\n<pre><code>modelBuilder.Entity&lt;Product&gt;.HasRequied(p =&gt; p.Project).WithMany(Project.PropertyAccessExpressions.Products);\n</code></pre>\n\n<p>Then the Project.GetProducts() fails and it seems the lazy loading does not work.\nBut if I change to</p>\n\n<pre><code>modelBuilder.Entity&lt;Project&gt;\n.HasMany(Project.PropertyAccessExpressions.Products).WithRequired(p =&gt; p.Project); \n</code></pre>\n\n<p>Then everything is OK.</p>\n\n<p>2) If I change the property \"Project.Products\" from protected to <strong>public</strong>, then both of the above ways are OK.</p>\n\n<p>What's wrong in this situation?</p>\n"},{"tags":["entity-framework","connection-string"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":128,"score":0,"question_id":12737289,"title":"EF 5 Changing Connection String at Runtime","body":"<p>Ok, I want to recreate a project that I created using EF 4.1 to EF 5.0, simple enough or at least I thought. One of the things in my old project is that I was able to change the database connection string at runtime in EF 4.1:</p>\n\n<pre><code>using (var myContext = new MyEntities(ConnectionString))\n{\n\n}\n</code></pre>\n\n<p>Easy-peasy but in EF 5.0 you have to do this differently:</p>\n\n<pre><code>string connectionString = \"data source=LocalHost;initial catalog=MyDatabase;user id=MyUserName;password=MyPassword;multipleactiveresultsets=True;App=EntityFramework\";\n\nusing (var myContext = new MyEntities())\n{\n         myContect.Database.Connection.ConnectionString = connectionString;\n}\n</code></pre>\n\n<p>Now, this took me a better part of two hours to figure out, so I guess my question is this the proper way of changing the connection string at runtime or not? If it is why did they make this change?</p>\n\n<p>I did find this <a href=\"http://stackoverflow.com/questions/12364617/ef-5-0-dynamic-connection-string\">Link</a> but it didn't work. I received the error as detailed in the first comment of the first answer by Ladislav Mrnka. I later found this <a href=\"http://stackoverflow.com/questions/12660683/how-to-use-dynamic-connection-string-for-sql-server-ce\">Link</a> which seems to work fine.</p>\n"},{"tags":["wcf","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":198,"score":0,"question_id":9909874,"title":"How to make queries to a WCF service with EF model / data first","body":"<p>I have a client project and a MVC3 EF model first project that exposes a WCF service to the client. I am new to EF and some things are not so clear.</p>\n\n<p>Lets assume the Northwind service with Product entity, if i want to make a simple query like return the products with a specific price, where do i write the code for the query ?</p>\n\n<p>On the server side there is only EDM and the service itself and it is pretty straighforward, hardly any code there.</p>\n\n<p>On the client i have <code>Product</code> model class and <code>NorthwindContext</code> and also a <code>ProdcutsPageViewModel</code> class (it's a MVVM project)</p>\n\n<p>So my question is, How and where do i make queries to the DB ? do i make it from the client side by attaching LINQ code to the URI ? do i make it from the server side by adding new methods to the service ? I would appreciate if you could explain it to a newbie,</p>\n\n<p>Thanks !</p>\n\n<p><strong>Here is some of the code :</strong></p>\n\n<p><strong>On the server</strong>, the <code>NorthwindODataService</code> service class:</p>\n\n<pre><code>[ServiceBehavior(IncludeExceptionDetailInFaults = true)]\n[AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Allowed)]\npublic class NorthwindODataService : DataService&lt;NorthwindEntities&gt;\n{\n    private readonly IUserPrivilegesRepository userPrivilegesRepository;\n    private readonly IClaimsIdentity identity;\n\n    public NorthwindODataService()\n        : this(HttpContext.Current.User.Identity as IClaimsIdentity, new InfrastructureEntities())\n    {\n    }\n\n    public NorthwindODataService(IClaimsIdentity identity, IUserPrivilegesRepository userPrivilegesRepository)\n    {\n        this.identity = identity;\n        this.userPrivilegesRepository = userPrivilegesRepository;\n    }\n\n    protected string UserId\n    {\n        get\n        {\n            var nameIdentifierClaim = this.identity.Claims.SingleOrDefault(c =&gt; c.ClaimType == ClaimTypes.NameIdentifier);\n            if (nameIdentifierClaim == null)\n            {\n                throw new DataServiceException(401, \"Unauthorized\", \"The request requires authentication.\", \"en-US\", null);\n            }\n\n            return nameIdentifierClaim.Value;\n        }\n    }\n\n    /// &lt;summary&gt;\n    /// Initializes service-wide policies. This method is called only once.\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"config\"&gt;&lt;/param&gt;\n    public static void InitializeService(DataServiceConfiguration config)\n    {\n        config.SetEntitySetAccessRule(\"Products\", EntitySetRights.All);\n        config.SetEntitySetAccessRule(\"Categories\", EntitySetRights.AllRead);\n        config.SetEntitySetAccessRule(\"Suppliers\", EntitySetRights.AllRead);\n\n        config.SetEntitySetPageSize(\"Products\", 20);\n        config.SetEntitySetPageSize(\"Categories\", 20);\n        config.SetEntitySetPageSize(\"Suppliers\", 20);\n\n        config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;\n        config.UseVerboseErrors = true;\n    }\n\n    /// &lt;summary&gt;\n    /// Define a query interceptor for the Products entity set.\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    [QueryInterceptor(\"Products\")]\n    public Expression&lt;Func&lt;Product, bool&gt;&gt; OnQueryProducts()\n    {\n        this.ValidateAuthorization(\"Products\", PrivilegeConstants.SqlReadPrivilege);\n\n        // The user has Read permission.\n        return p =&gt; true;\n    }\n\n    /// &lt;summary&gt;\n    /// Define a query interceptor for the Categories entity set.\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    [QueryInterceptor(\"Categories\")]\n    public Expression&lt;Func&lt;Category, bool&gt;&gt; OnQueryCategories()\n    {\n        this.ValidateAuthorization(\"Categories\", PrivilegeConstants.SqlReadPrivilege);\n\n        // The user has Read permission.\n        return p =&gt; true;\n    }\n\n    /// &lt;summary&gt;\n    /// Define a query interceptor for the Suppliers entity set.\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    [QueryInterceptor(\"Suppliers\")]\n    public Expression&lt;Func&lt;Supplier, bool&gt;&gt; OnQuerySuppliers()\n    {\n        this.ValidateAuthorization(\"Suppliers\", PrivilegeConstants.SqlReadPrivilege);\n\n        // The user has Read permission.\n        return p =&gt; true;\n    }\n\n    /// &lt;summary&gt;\n    /// Define a change interceptor for the Products entity set.\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"product\"&gt;&lt;/param&gt;\n    /// &lt;param name=\"operations\"&gt;&lt;/param&gt;\n    [ChangeInterceptor(\"Products\")]\n    public void OnChangeProducts(Product product, UpdateOperations operations)\n    {\n        if (operations == UpdateOperations.Change)\n        {\n            this.ValidateAuthorization(\"Products\", PrivilegeConstants.SqlUpdatePrivilege);\n\n            var entry = default(ObjectStateEntry);\n            if (this.CurrentDataSource.ObjectStateManager.TryGetObjectStateEntry(product, out entry))\n            {\n                // Reject changes to a discontinued Product.\n                // Because the update is already made to the entity by the time the \n                // change interceptor in invoked, check the original value of the Discontinued\n                // property in the state entry and reject the change if 'true'.\n                if ((bool)entry.OriginalValues[\"Discontinued\"])\n                {\n                    throw new DataServiceException(400, \"Bad Request\", \"A discontinued product cannot be modified.\", \"en-US\", null);\n                }\n            }\n            else\n            {\n                throw new DataServiceException(404, \"Not Found\", \"The requested product could not be found in the data source.\", \"en-US\", null);\n            }\n        }\n        else if (operations == UpdateOperations.Add)\n        {\n            this.ValidateAuthorization(\"Products\", PrivilegeConstants.SqlCreatePrivilege);\n        }\n        else if (operations == UpdateOperations.Delete)\n        {\n            this.ValidateAuthorization(\"Products\", PrivilegeConstants.SqlDeletePrivilege);\n\n            var entry = default(ObjectStateEntry);\n            if (this.CurrentDataSource.ObjectStateManager.TryGetObjectStateEntry(product, out entry))\n            {\n                // Only a discontinued Product can be deleted.\n                if (!(bool)entry.OriginalValues[\"Discontinued\"])\n                {\n                    throw new DataServiceException(400, \"Bad Request\", \"Products that are not discontinued cannot be deleted.\", \"en-US\", null);\n                }\n            }\n            else\n            {\n                throw new DataServiceException(404, \"Not Found\", \"The requested product could not be found in the data source.\", \"en-US\", null);\n            }\n        }\n    }\n\n    private static string BuildMessage(string entitySetName, string privilege)\n    {\n        var message = string.Empty;\n        switch (privilege)\n        {\n            case PrivilegeConstants.SqlCreatePrivilege:\n                message = string.Format(CultureInfo.InvariantCulture, \"You are not authorized to create new rows in the {0} entity set.\", entitySetName);\n                break;\n            case PrivilegeConstants.SqlReadPrivilege:\n                message = string.Format(CultureInfo.InvariantCulture, \"You are not authorized to query the {0} entity set.\", entitySetName);\n                break;\n            case PrivilegeConstants.SqlUpdatePrivilege:\n                message = string.Format(CultureInfo.InvariantCulture, \"You are not authorized to update rows in the {0} entity set.\", entitySetName);\n                break;\n            case PrivilegeConstants.SqlDeletePrivilege:\n                message = string.Format(CultureInfo.InvariantCulture, \"You are not authorized to delete rows in the {0} entity set.\", entitySetName);\n                break;\n\n            default:\n                message = string.Format(CultureInfo.InvariantCulture, \"You are not authorized to access the {0} entity set.\", entitySetName);\n                break;\n        }\n\n        return message;\n    }\n\n    private void ValidateAuthorization(string entitySetName, string privilege)\n    {\n        if (!this.userPrivilegesRepository.HasUserPrivilege(this.UserId, privilege))\n        {\n            // The user does not have Read permission.\n            throw new DataServiceException(401, \"Unauthorized\", BuildMessage(entitySetName, privilege), \"en-US\", null);\n        }\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p><strong>on the client</strong>, the <code>Product</code> model class:</p>\n\n<pre><code>[EntitySetAttribute(\"Products\")]\n[DataServiceKeyAttribute(\"ProductID\")]\npublic class Product : INotifyPropertyChanged\n{\n    private int id;\n    private string productName;\n    private int? supplierID;\n    private int? categoryID;\n    private string quantityPerUnit;\n    private decimal? unitPrice;\n    private short? unitsInStock;\n    private short? unitsOnOrder;\n    private short? reorderLevel;\n    private bool discontinued;\n\n    public event PropertyChangedEventHandler PropertyChanged;\n\n    public int ProductID\n    {\n        get\n        {\n            return this.id;\n        }\n\n        set\n        {\n            this.id = value;\n            this.OnPropertyChanged(\"ProductID\");\n        }\n    }\n\n    public string ProductName\n    {\n        get\n        {\n            return this.productName;\n        }\n\n        set\n        {\n            this.productName = value;\n            this.OnPropertyChanged(\"ProductName\");\n        }\n    }\n\n    public int? SupplierID\n    {\n        get\n        {\n            return this.supplierID;\n        }\n\n        set\n        {\n            this.supplierID = value;\n            this.OnPropertyChanged(\"SupplierID\");\n        }\n    }\n\n    public int? CategoryID\n    {\n        get\n        {\n            return this.categoryID;\n        }\n\n        set\n        {\n            this.categoryID = value;\n            this.OnPropertyChanged(\"CategoryID\");\n        }\n    }\n\n    public string QuantityPerUnit\n    {\n        get\n        {\n            return this.quantityPerUnit;\n        }\n\n        set\n        {\n            this.quantityPerUnit = value;\n            this.OnPropertyChanged(\"QuantityPerUnit\");\n        }\n    }\n\n    public decimal? UnitPrice\n    {\n        get\n        {\n            return this.unitPrice;\n        }\n\n        set\n        {\n            this.unitPrice = value;\n            this.OnPropertyChanged(\"UnitPrice\");\n        }\n    }\n\n    public short? UnitsInStock\n    {\n        get\n        {\n            return this.unitsInStock;\n        }\n\n        set\n        {\n            this.unitsInStock = value;\n            this.OnPropertyChanged(\"UnitsInStock\");\n        }\n    }\n\n    public short? UnitsOnOrder\n    {\n        get\n        {\n            return this.unitsOnOrder;\n        }\n\n        set\n        {\n            this.unitsOnOrder = value;\n            this.OnPropertyChanged(\"UnitsOnOrder\");\n        }\n    }\n\n    public short? ReorderLevel\n    {\n        get\n        {\n            return this.reorderLevel;\n        }\n\n        set\n        {\n            this.reorderLevel = value;\n            this.OnPropertyChanged(\"ReorderLevel\");\n        }\n    }\n\n    public bool Discontinued\n    {\n        get\n        {\n            return this.discontinued;\n        }\n\n        set\n        {\n            this.discontinued = value;\n            this.OnPropertyChanged(\"Discontinued\");\n        }\n    }\n\n    public static Product CreateProduct(int productID, string productName, bool discontinued)\n    {\n        return new Product\n        {\n            ProductID = productID,\n            ProductName = productName,\n            Discontinued = discontinued,\n        };\n    }\n\n    protected virtual void OnPropertyChanged(string changedProperty)\n    {\n        var propertyChanged = this.PropertyChanged;\n        if (propertyChanged != null)\n        {\n            propertyChanged(this, new PropertyChangedEventArgs(changedProperty));\n        }\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>And the <code>NorthwindContext</code> class:</p>\n\n<pre><code>public class NorthwindContext : DataServiceContext\n{\n    public NorthwindContext(Uri serviceRoot)\n        : base(serviceRoot)\n    {\n        this.MergeOption = MergeOption.OverwriteChanges;\n        this.SaveChangesDefaultOptions = SaveChangesOptions.ContinueOnError;\n    }\n\n    public void AddToCategories(Category category)\n    {\n        this.AddObject(\"Categories\", category);\n    }\n\n    public void AddToProducts(Product product)\n    {\n        this.AddObject(\"Products\", product);\n    }\n\n    public void AddToSuppliers(Supplier supplier)\n    {\n        this.AddObject(\"Suppliers\", supplier);\n    }\n\n    public void AttachToCategories(Category category)\n    {\n        this.AttachTo(\"Categories\", category);\n    }\n\n    public void AttachToProducts(Product product)\n    {\n        this.AttachTo(\"Products\", product);\n    }\n\n    public void AttachToSuppliers(Supplier supplier)\n    {\n        this.AttachTo(\"Suppliers\", supplier);\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>and here is the <code>ProductsPageViewModel</code> class :</p>\n\n<pre><code> public class ProductsPageViewModel : ListViewModel&lt;Product&gt;\n{\n    public ProductsPageViewModel()\n        : this(Deployment.Current.Dispatcher, App.CloudClientFactory.ResolveNorthwindContext())\n    {\n    }\n\n    public ProductsPageViewModel(Dispatcher dispatcher, NorthwindContext northwindContext)\n        : base(dispatcher, northwindContext)\n    {\n    }\n\n    protected override string EntitySetName\n    {\n        get\n        {\n            return \"Products\";\n        }\n    }\n}\n</code></pre>\n\n<p>}</p>\n"},{"tags":["linq","entity-framework","linq-to-entities","expression-trees"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12732532,"title":"Binding DefaultExpression to property in Linq-to-Entities query","body":"<p>I have a class that helps project entities to POCOs by emitting Linq expressions that can be used with an IQueryable.  Here is an expression I'm having some trouble with:</p>\n\n<pre><code>result = Expression.Bind(dProperty,\n                         Expression.Coalesce(Expression.Property(parameterExpression, sProperty),\n                                             Expression.Default(dType)));  \n</code></pre>\n\n<p>In this statement, <code>dProperty</code> is a <code>PropertyInfo</code> representing the destination property in the binding, <code>dType</code> is the <code>Type</code> of that property, <code>parameterExpression</code> is another Linq expression representing the parameter of type <code>TEntity</code>, and <code>sProperty</code> is a <code>PropertyInfo</code> object representing the source property.</p>\n\n<p>This builds, but at runtime when the Entity Framework expression visitor implementation works its way through the tree, it sees this and throws a \"not supported\" exception (below).  What seems to be the meaning is that the DefaultExpression I'm using as the right side of the coalescence operator expression isn't supported in EF.  I tried searching quite a bit for documentation or discussions that addressed this and couldn't find anything (of course, it's hard to do a very good search on a word like 'default').  Anyway, is it true that the C# 'default' operator is not supported in Linq-to-Entities?  If it is true, then how do I do what I'm trying to do, which is to assign a property from a <code>Nullable</code> whose generic argument type is the same as the destination property?</p>\n\n<p>In other words, the linq expression would look like this if you wrote it as a lambda:</p>\n\n<pre><code>(/*long*/dest, /*long?*/src) =&gt; dest = src ?? default(long)\n</code></pre>\n\n<p>Here's the exception.</p>\n\n<pre><code>System.NotSupportedException: Unknown LINQ expression of type 'Default'.\n   at System.Linq.Expressions.EntityExpressionVisitor.Visit(Expression exp)\n   at System.Data.Objects.ELinq.Funcletizer.&lt;&gt;c__DisplayClass5.&lt;Nominate&gt;b__4(Expression exp, Func`2 baseVisit)\n   at System.Linq.Expressions.EntityExpressionVisitor.BasicExpressionVisitor.Visit(Expression exp)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitBinary(BinaryExpression b)\n   at System.Data.Objects.ELinq.Funcletizer.&lt;&gt;c__DisplayClass5.&lt;Nominate&gt;b__4(Expression exp, Func`2 baseVisit)\n   at System.Linq.Expressions.EntityExpressionVisitor.BasicExpressionVisitor.Visit(Expression exp)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitMemberAssignment(MemberAssignment assignment)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitBinding(MemberBinding binding)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitBindingList(ReadOnlyCollection`1 original)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitMemberInit(MemberInitExpression init)\n   at System.Data.Objects.ELinq.Funcletizer.&lt;&gt;c__DisplayClass5.&lt;Nominate&gt;b__4(Expression exp, Func`2 baseVisit)\n   at System.Linq.Expressions.EntityExpressionVisitor.BasicExpressionVisitor.Visit(Expression exp)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitExpressionList(ReadOnlyCollection`1 original)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitInvocation(InvocationExpression iv)\n   at System.Data.Objects.ELinq.Funcletizer.&lt;&gt;c__DisplayClass5.&lt;Nominate&gt;b__4(Expression exp, Func`2 baseVisit)\n   at System.Linq.Expressions.EntityExpressionVisitor.BasicExpressionVisitor.Visit(Expression exp)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitLambda(LambdaExpression lambda)\n   at System.Data.Objects.ELinq.Funcletizer.&lt;&gt;c__DisplayClass5.&lt;Nominate&gt;b__4(Expression exp, Func`2 baseVisit)\n   at System.Linq.Expressions.EntityExpressionVisitor.BasicExpressionVisitor.Visit(Expression exp)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitUnary(UnaryExpression u)\n   at System.Data.Objects.ELinq.Funcletizer.&lt;&gt;c__DisplayClass5.&lt;Nominate&gt;b__4(Expression exp, Func`2 baseVisit)\n   at System.Linq.Expressions.EntityExpressionVisitor.BasicExpressionVisitor.Visit(Expression exp)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitExpressionList(ReadOnlyCollection`1 original)\n   at System.Linq.Expressions.EntityExpressionVisitor.VisitMethodCall(MethodCallExpression m)\n   at System.Data.Objects.ELinq.Funcletizer.&lt;&gt;c__DisplayClass5.&lt;Nominate&gt;b__4(Expression exp, Func`2 baseVisit)\n   at System.Linq.Expressions.EntityExpressionVisitor.BasicExpressionVisitor.Visit(Expression exp)\n   at System.Data.Objects.ELinq.Funcletizer.Nominate(Expression expression, Func`2 localCriterion)\n   at System.Data.Objects.ELinq.Funcletizer.Funcletize(Expression expression, Func`1&amp; recompileRequired)\n   at System.Data.Objects.ELinq.ExpressionConverter..ctor(Funcletizer funcletizer, Expression expression)\n   at System.Data.Objects.ELinq.ELinqQueryState.CreateExpressionConverter()\n   at System.Data.Objects.ELinq.ELinqQueryState.GetExecutionPlan(Nullable`1 forMergeOption)\n   at System.Data.Objects.ObjectQuery`1.GetResults(Nullable`1 forMergeOption)\n   at System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable&lt;T&gt;.GetEnumerator()\n   at System.Linq.Enumerable.&lt;SelectManyIterator&gt;d__14`2.MoveNext()\n   at System.Linq.Enumerable.WhereEnumerableIterator`1.MoveNext()\n   at System.Linq.Enumerable.&lt;TakeIterator&gt;d__3a`1.MoveNext()\n   at System.Linq.Enumerable.WhereSelectEnumerableIterator`2.MoveNext()\n   at System.Collections.Generic.List`1.InsertRange(Int32 index, IEnumerable`1 collection)\n   at MyClass...\n</code></pre>\n"},{"tags":["entity-framework","inheritance","ef-code-first","mapping"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12735953,"title":"Inheritance Mapping in EF Code First?","body":"<p>I have a class inheritting from another class based on 2 discriminators.</p>\n\n<p>I want to do something like:</p>\n\n<pre><code>Map&lt;FineStatusTypePaidFull&gt;(\n  m =&gt; m.Requires(\"LookupKey\")\n        .HasValue(\"FineStatusType\") &amp;&amp; (\"LookupCode\")\n        .HasValue(\"PIF\");\n</code></pre>\n\n<p>But I have not found anything yet.... any suggestions?</p>\n"},{"tags":["c#",".net","entity-framework","database-migration","entity-framework-4.3"],"answer_count":1,"favorite_count":4,"up_vote_count":5,"down_vote_count":0,"view_count":1532,"score":5,"question_id":9499702,"title":"Entity Framework 4.3 - TPH mapping and migration error","body":"<p>I'm using Entity Framework 4.3 with code first and manual migrations. I'm trying to map a TPH (table-per-hierarchy) setup which uses two custom discriminator fields. One for the discriminator itself and the other for soft deletes (much like the \"where\" option in NH class mappings). The exact same setup works just fine in another project which runs on EF 4.2.</p>\n\n<p>I get the error when trying to add a migration using the \"add-migration\" command in the NuGet console. I have tried all combinations of defining the table name - attributes on class, in \"OnModelCreating\" method, in EntityTypeConfiguration classes etc. My previous migrations which didn't involve complex hierarchy mappings have worked just fine.</p>\n\n<p>Is there some breaking change in EF 4.3 that I've stumbled upon?</p>\n\n<p>The code:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>//---- Domain classes ---------------------\n\npublic abstract class ParentClass\n{\n    public string ParentString { get; set; }\n}\n\npublic class Foo : ParentClass\n{\n    public string FooString { get; set; }\n}\n\npublic class Bar : ParentClass\n{\n    public string BarString { get; set; }\n}\n\n//---- Mapping configuration --------------\n\npublic class ParentConfiguration : EntityTypeConfiguration&lt;ParentClass&gt;\n{\n    public ParentConfiguration()\n    {\n        Map&lt;Foo&gt;(m =&gt;\n        {\n            m.Requires(\"IsActive\").HasValue(1);\n            m.Requires(\"Type\").HasValue(\"Foo\");\n        })\n        .ToTable(\"Parent\");\n\n        Map&lt;Bar&gt;(m =&gt;\n        {\n            m.Requires(\"IsActive\").HasValue(1);\n            m.Requires(\"Type\").HasValue(\"Bar\");\n        })\n        .ToTable(\"Parent\");\n    }\n}\n\n//---- Context ----------------------------\n\nprotected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n    modelBuilder.Configurations.Add(new ParentConfiguration());\n}\n</code></pre>\n\n<p>The error:</p>\n\n<pre><code>System.InvalidOperationException: The type 'Foo' has already been mapped to table 'Parent'. Specify all mapping aspects of a table in a single Map call.\n   at System.Data.Entity.ModelConfiguration.Configuration.Types.EntityTypeConfiguration.AddMappingConfiguration(EntityMappingConfiguration mappingConfiguration)\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.ReassignSubtypeMappings()\n   at System.Data.Entity.DbModelBuilder.Build(DbProviderManifest providerManifest, DbProviderInfo providerInfo)\n   at System.Data.Entity.DbModelBuilder.Build(DbConnection providerConnection)\n   at System.Data.Entity.Infrastructure.EdmxWriter.WriteEdmx(DbContext context, XmlWriter writer)\n   at System.Data.Entity.Migrations.Extensions.DbContextExtensions.&lt;&gt;c__DisplayClass1.&lt;GetModel&gt;b__0(XmlWriter w)\n   at System.Data.Entity.Migrations.Extensions.DbContextExtensions.GetModel(Action`1 writeXml)\n   at System.Data.Entity.Migrations.Extensions.DbContextExtensions.GetModel(DbContext context)\n   at System.Data.Entity.Migrations.DbMigrator..ctor(DbMigrationsConfiguration configuration, DbContext usersContext)\n   at System.Data.Entity.Migrations.DbMigrator..ctor(DbMigrationsConfiguration configuration)\n   at System.Data.Entity.Migrations.Design.ToolingFacade.BaseRunner.GetMigrator()\n   at System.Data.Entity.Migrations.Design.ToolingFacade.GetPendingMigrationsRunner.RunCore()\n   at System.Data.Entity.Migrations.Design.ToolingFacade.BaseRunner.Run()\n</code></pre>\n\n<p>Mihkel</p>\n"},{"tags":["vb.net","entity-framework","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12732138,"title":"How to databind DbContext SqlQuery() results in WPF","body":"<p>I am trying to bind results returned from queries with dynamic where clauses to a WPF DataGrid.</p>\n\n<p>Using Database.SqlQuery there seems to be no Load() method and no Local() to return an ObservableCollection.\nThus I am using New ObservableCollection(Of Product)(q1).\nIs this the recommended usage, or am I missing something?</p>\n\n<p>Using DbSet.SqlQuery I found no way to get at the data at all.\nHow is this supposed to be used?</p>\n\n<pre><code>Dim _dbc As New AdventureWorksEntities\n\n''Using DbSet\n'Dim q = _dbc.Product\n'q.Load()\n'Dim r = q.Local\n'grd.ItemsSource = r\n\nConst sql = \"select * from production.product WHERE name LIKE 'fla%' and ProductNumber LIKE '%0'\"\n'Using Database.SqlQuery\nDim q1 = _dbc.Database.SqlQuery(Of Product)(sql)\nDim r1 = New ObservableCollection(Of Product)(q1)\ngrd.ItemsSource = r1\n\n''Using DbSet.SqlQuery\n'Dim q2 = _dbc.Product.SqlQuery(sql)\n''Dim r2 = ???\n''grd.ItemsSource = r2\n</code></pre>\n"},{"tags":["c#","entity-framework","datacontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12736466,"title":"How to setup this query using DbContext","body":"<p>I have two tables in SQL server for customers and their addresses.</p>\n\n<pre><code>CREATE TABLE Customers\n(\n    ID              INT NOT NULL IDENTITY(1,1),\n    LastName        VARCHAR(50) NOT NULL,\n    FirstName       VARCHAR(50) NOT NULL,\n    DateOfBirth     DATETIME2 NOT NULL,\n    CONSTRAINT [PK_Customers] PRIMARY KEY CLUSTERED ([ID] ASC)\n)\nCREATE TABLE CustomerAddresses\n(\n    ID              INT NOT NULL IDENTITY(1,1),\n    CustomerID      INT NOT NULL CONSTRAINT [FK_CustomerAddresses_Customers] FOREIGN KEY([CustomerID]) REFERENCES [dbo].[Customers] ([ID]),\n    Street          VARCHAR(100) NOT NULL,\n    City            VARCHAR(50) NOT NULL,\n    Country         VARCHAR(50) NOT NULL,\n    CONSTRAINT [PK_CustomerAddresses] PRIMARY KEY CLUSTERED ([ID] ASC)\n)\n</code></pre>\n\n<p>I have generated a EFdatamodel and connecting to it using DataContext. I am trying to get all customers for a particular country. My code is as follows.</p>\n\n<pre><code>static List&lt;Customer&gt; GetByCountry(string country)  \n        {  \n            MyDbContext MyContext = new MyDbContext ();  \n            return MyContext.Customers.Where(x =&gt; x.CustomerAddresses.Where( y =&gt; y.Country == country)).ToList();  \n        }  \n</code></pre>\n\n<p>But I am getting following compilation errors.</p>\n\n<blockquote>\n  <p>Cannot implicitly convert type\n  'System.Collections.Generic.IEnumerable' to\n  'bool'     Cannot convert lambda expression to delegate type\n  'System.Func' because some of the return\n  types in the block are not implicitly convertible to the delegate\n  return type</p>\n</blockquote>\n\n<p>What am I doing wrong here?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":144,"score":1,"question_id":10568384,"title":"Why does Project Compile without Reference to Entity Framework?","body":"<p>I have a number of projects in a solution.  One of those projects, call it MyDAL, defines a number of business objects and uses Entity Framework to persist them via</p>\n\n<pre><code>public class MyContext : DbContext\n</code></pre>\n\n<p>I just added a new project to the solution and forgot to reference Entity Framework.</p>\n\n<p><code>MyContext</code> is still available!  There is no compile error (I would think I would get a compiler error telling my I'm missing a reference to the assembly that defines DbContext).</p>\n\n<p>I can reference any of my own properties in <code>MyContext</code>.  However, </p>\n\n<pre><code>using (MyContext ctx = new MyContext())\n</code></pre>\n\n<p>gives a compiler error</p>\n\n<blockquote>\n  <p>'MyNs.MyContext': type used in a using statement must be implicitly\n  convertible to 'System.IDisposable'</p>\n</blockquote>\n\n<p>and </p>\n\n<pre><code>ctx.SaveChanges();\n</code></pre>\n\n<p>gives the error</p>\n\n<blockquote>\n  <p>'MyNs.MyContext' does not contain a definition for 'SaveChanges' and\n  no extension method 'SaveChanges' accepting a first argument of...</p>\n</blockquote>\n\n<p>It's almost as if the compiler silently changed</p>\n\n<pre><code>public class MyContext : DbContext\n</code></pre>\n\n<p>to</p>\n\n<pre><code>public class MyContext : object\n</code></pre>\n\n<p>I know how to resolve the error (add the missing reference), but I'm curious as to why the code compiled in the first place before I started referencing methods and interfaces of DbContext.</p>\n"},{"tags":[".net","vb.net","web-services","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":12734283,"title":"Using a separate application as an asmx webservice","body":"<p>I have been asked at my internship to create a web service using Entity Framework. They told me to start off by creating a separate application that can be later integrated into the main application. If i have the separate application made, how do I integrate it into the existing one?</p>\n\n<p>I looked around and it looks like everybody just creates the webservice inside the application itself?</p>\n"},{"tags":["sql","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":12732277,"title":"JOIN and LEFT JOIN equivalent in LINQ with Method Syntax","body":"<p>I am converting a SQL query to LINQ that creates a left join with 1-to-1 mapping, and it has to be in Method Syntax. I have been pulling off my hair trying to accomplish this to no veil. I can do it in Lambda Syntax. Below is the example query I am trying to run. They are not actual code. Would someone point out what I am doing wrong?</p>\n\n<p>SQL:</p>\n\n<pre><code>SELECT item.*, item_status.*\nFROM item\nLEFT JOIN item_status \n    ON item.ID = item_status.itemID\n    AND item_status.FLAGGED = true\nWHERE item.published_date &gt; \"2008-06-19\"\n</code></pre>\n\n<p>LINQ:</p>\n\n<pre><code>var linq_query = (\n    from selected_item in item\n    join selected_item_status in item_status\n        on selected_item.ID equals item_status.itemID into joined\n    from item_status in joined.DefaultIfEmpty()\n    where item_status.FLAGGED = true\n    select new {selected_item, selected_item_status}).ToList();\n</code></pre>\n"},{"tags":["c#","entity-framework","wcf-data-services","odata"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12598469,"title":"How to create 2 versions of an Odata / EF webservice?","body":"<p>I have an Odata service using the EF provider. I works fine and was easy to create. But now it needs to change. This question is similar to <a href=\"http://stackoverflow.com/questions/7116804/how-can-i-setup-odata-and-ef-with-out-coupling-to-my-database-structure\">this one</a>. But I am not clear on the answer. </p>\n\n<p>I need to be able to serve two (or more) versions of the service concurrently because it is impossible to update all clients at once. I would like to continue using EF code first (because it was so easy until now) but this is not a requirement. I have only few services so I don't mind a rewrite if that will give me the required flexiblity.</p>\n\n<p>What is the best (most easy and maintainable) way to implement an Odata service using c# that can support multiple versions of the same service concurently, from the same db.</p>\n\n<p>I tried using the reflection provider to transform the EF dbcontext. I wanted someting like this:</p>\n\n<pre><code>db -&gt; EF db context -&gt; reflection DB context.v1 -&gt; DataService.v1\n</code></pre>\n\n<p>and</p>\n\n<pre><code>db -&gt; EF db context -&gt; reflection DB context.v2 -&gt; DataService.v2\n</code></pre>\n\n<p>And I almost got it to work (for reads at least), if only EF selects would permit <code>ToList()</code></p>\n\n<p>I do need to support write as wel (for some services) </p>\n\n<p>Having 2 EF db context targeting the same db would be an acceptable solution but I don't know if and how I can accomplish this. </p>\n\n<p>Thanks in advance</p>\n"},{"tags":["visual-studio-2010","entity-framework","asp.net-mvc-3"],"answer_count":14,"favorite_count":5,"up_vote_count":12,"down_vote_count":0,"view_count":31042,"score":12,"question_id":5741109,"title":"The type or namespace name 'DbContext' could not be found","body":"<p>I am VERY new to ASP.NET MVC (3) and am having a hard time resolving a build error in Visual Studio:</p>\n\n<p>The type or namespace name 'DbContext' could not be found (are you missing a using directive or an assembly reference?)</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\nusing System.ComponentModel.DataAnnotations;\nusing System.Data.Entity;\n\nnamespace MyProjectName.Models\n{   \n    public class MachineModel\n    {\n        // name\n        [Required]\n        [Display(Name = \"Nom de la machine\")]\n        public string Name { get; set; }\n\n        // IP\n        [Required]\n        [RegularExpression(@\"(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\",\n           ErrorMessage = \"Donnez une adresse IPv4 valide.\")]\n        [Display(Name = \"Adresse IP de la machine\")]\n        public string IP { get; set; }\n    }\n\n    public class MachineDbContext : DbContext\n    {\n        public DbSet&lt;MachineModel&gt; Machines{ get; set; }\n    }\n}\n</code></pre>\n\n<p>The two errors I am getting are:</p>\n\n<ul>\n<li>The type or namespace name\n'DbContext' could not be found (are\nyou missing a using directive or an\nassembly reference?) </li>\n<li>The type or namespace name 'DbSet'\ncould not be found (are you\nmissing a using directive or an\nassembly reference?)</li>\n</ul>\n\n<p>What am I missing?</p>\n"},{"tags":[".net","sql-server","entity-framework"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12733080,"title":"DbUpdateConcurrencyException on Unchanged entity","body":"<p>It appears that I am getting a concurrency exception on entities that are not modified.  I am using Entity Framework 4.3.1, Code First, and this is happening in a WCF service.</p>\n\n<p>To simplify my example, let's assume I have two entities.</p>\n\n<pre><code>public class Foo\n{\n    public int Id { get; set; }\n    public string BarKey { get; set; }\n    public string SomeValue { get; set; }\n\n    public Bar MyBar { get; set; }\n}\n\npublic class Bar\n{    \n    public string Key { get; set; }\n    public string OtherValue { get; set; }\n\n    public ICollection&lt;Foo&gt; Foos { get; set; }\n}\n</code></pre>\n\n<p>The user can only edit Foos through the application.  Bars can be viewed, but not edited.  Additionally, I use DTOs with the WCF service.  The typical applicaiton flow is as follows.</p>\n\n<ol>\n<li>Client calls service method <code>GetFoo</code>.  This will retrieve Foo from the database and map it to a FooDto.  This will also retrieve the related Bar and map it to a BarDto.</li>\n<li>Client updates FooDto</li>\n<li>Client calls <code>SaveFoo</code> and passes in an updated FooDto.<br>\na. The service will re-retrieve the original Foo, using <code>context.Set&lt;Foo&gt;().Find(fooDto.Id)</code>, then copy the updated values from FooDto.<br>\nb. Business logic runs, which may call <code>context.Set&lt;Bar&gt;().Find(foo.BarKey)</code>.  Values may be read from Bar, but it will not be updated.<br>\nc. The service then calls <code>context.SaveChanged()</code>.</li>\n</ol>\n\n<p>At this point I occassionally get a <code>DbUpdateConcurrencyException</code>.  In my error handling, if the exception is of type <code>DbUpdateException</code>, which is the base class of <code>DbUpdateConcurrencyException</code>, I loop through <code>ex.Entries</code> and log<code>entry.Entity.GetType()</code> and <code>entry.State</code>.</p>\n\n<p>In my error log I have several entries that show the type is <code>Bar</code> and the state is <code>Unchanged</code>.  It is entirely possible that <code>Bar</code> could have been updated.  However, I do not care because <code>Bar</code> is unchanged.</p>\n\n<p>Why am I getting this exception and how to keep it from happening?</p>\n"},{"tags":["asp.net","entity-framework","razor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12732776,"title":"Creating model property with only getter for view in ASP.NET MVC 4 entity framework","body":"<p>I am working with asp.net mvc 4 and entity framework code-first approach. I have the following entity model</p>\n\n<pre><code>public class User\n{\n    public virtual int Id { get; set; }\n    public virtual String FirstName { get; set; }\n    public virtual String MiddleName { get; set; }\n    public virtual String LastName { get; set; }\n}\n</code></pre>\n\n<p>For the user list view page I need to show Full Name, I am trying to create a get only property in user model like</p>\n\n<pre><code>public virtual String FullName{\n    get{\n        return FirstName + \" \" + MiddleName + \" \" + LastName;\n    }\n}\n</code></pre>\n\n<p>But I am not sure if it will work, besides I also don't want entity framework to map this to a database column.</p>\n\n<p>Can I use similar get only property generated from other properties for only view?\nCan any one can give me any suggestion on what to do??</p>\n"},{"tags":["entity-framework","lazy-loading","entity-framework-5","objectcontext","change-tracking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12732102,"title":"The ObjectContext instance has been disposed and can no longer be used for operations that require a connection","body":"<p>I'm having trouble with one of my queries because of EF's change tracking and lazy loading features. The thing is that after I'm getting the result of the query, I'm using AutoMapper to map the domain objects into my business model but it keeps throwing an exception because the context has been disposed.</p>\n\n<blockquote>\n  <p>The ObjectContext instance has been disposed and can no longer be used\n  for operations that require a connection.</p>\n</blockquote>\n\n<p>When I look at the resultant collection in the debugger, I see that it is a list of <code>DynamicProxy</code> and not the actual entity. I tried to stop Change Tracking but that did not help. Here's my code:</p>\n\n<pre><code>    public List&lt;ContentTypeColumn&gt; GetContentTypeColumns(Int64 contentTypeId)\n    {\n        List&lt;ContentTypeColumn&gt; result = new List&lt;ContentTypeColumn&gt;();\n        using (SCGREDbContext context = new SCGREDbContext())\n        {                \n            ContentType contentType = context.ContentTypes.Include(\"Parent\").AsNoTracking().FirstOrDefault(x =&gt; x.Id.Equals(contentTypeId));\n\n            result.AddRange(contentType.ContentTypeColumns.ToList());\n            while (contentType.Parent != null)\n            {\n                result.AddRange(contentType.Parent.ContentTypeColumns.ToList());\n                contentType = contentType.Parent;\n            }    \n        }\n        return result.ToList();\n    }\n</code></pre>\n\n<p>Note: If you need to look into my domain model involved in this operation you can refer to <a href=\"http://stackoverflow.com/questions/12730218/mapping-many-to-many-relationship-with-defined-middle-entity-in-entity-framework/12731877#12731877\">this question.</a></p>\n"}]}
{"total":18927,"page":14,"pagesize":100,"questions":[{"tags":["c#","asp.net-mvc","entity-framework","model","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":55,"score":0,"question_id":12732212,"title":"Map stored procedure into the model generated by EF 4 as a model for MVC Application","body":"<p>Here is the thing I`ve added an EF automaticcaly generated class from the database as a model to my mvc application and everything is working great except one thing . When I add a stored procedure and function import to my model everything is added the way it should be but I get no intellisense for my stored procedure. Any idea? \nEverything works fine if im gonna just add an EF model to the root of my solution.But when my model is in Models folder of my MVC application it seems that it doesnt work !</p>\n"},{"tags":["c#","linq","entity-framework","winrt"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12732083,"title":"how to make a second level include of objects","body":"<p>I have structure like this</p>\n\n<pre><code>class Lesson {\n    List&lt;Sign&gt; signs { get; set; }\n}\n\nclass Sign {\n    List&lt;Media&gt; media { get; set;}\n}\n\nclass Media {\n\n}\n</code></pre>\n\n<p>Now I'm using this LINQ to get all lessons</p>\n\n<pre><code>var items = (from lesson in this.db.Lesson.Include(\"Sign\")\n                     where lesson.module_id == param\n                     select lesson);\n</code></pre>\n\n<p>It works fine but signs list has ampty media list. I mean that attribute <code>media</code> in each object <code>Sign</code> equals null. What do I need to do to include media objects for each Sign ? Whole data is kept in database</p>\n"},{"tags":["entity-framework","mapping","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12730218,"title":"Mapping Many-to-Many Relationship With Defined Middle Entity in Entity Framework 5","body":"<p>I'm trying to define a many-to-many relationship explicitly. By explicitly, I mean that I'm defining the middle entity and configuring it using the Fluent API. Below is my code:</p>\n\n<pre><code>public class ContentType\n{\n    public Int64 Id { get; set; }\n    public Guid SID { get; set; }\n    public String Name { get; set; }\n    public ContentType Parent { get; set; }\n    public Nullable&lt;Int64&gt; ParentId { get; set; }\n    public Category Category { get; set; }\n    public Nullable&lt;Int64&gt; CategoryId { get; set; }\n    public Boolean IsLocked { get; set; }\n    public virtual ICollection&lt;ContentTypeColumn&gt; ContentTypeColumns { get; set; }\n}\n\npublic class Column\n{\n    public Int64 Id { get; set; }\n    public Guid SID { get; set; }\n    public String SchemaName { get; set; }\n    public DataType DataType { get; set; }\n    public Int32 DataTypeId { get; set; }\n    public virtual ICollection&lt;ContentTypeColumn&gt; ContentTypeColumns { get; set; }\n}\n\npublic class ContentTypeColumn\n{\n    public Int64 Id { get; set; }\n    public Int64 ColumnId { get; set; }\n    public Column Column { get; set; }\n    public ContentType ContentType { get; set; }\n    public Int64 ContentTypeId { get; set; }\n    public Boolean IsRequired { get; set; }\n    public Boolean IsCalculated { get; set; }\n    public String Title { get; set; }\n    public Boolean IsSystem { get; set; }\n    public Expression Expression { get; set; }\n    public Int32 ExpressionId { get; set; }\n    public virtual ICollection&lt;ColumnRule&gt; Rules { get; set; }\n}\n\npublic class ContentTypeConfiguration : EntityTypeConfiguration&lt;ContentType&gt;\n{\n    public ContentTypeConfiguration()\n    {\n        this.ToTable(\"ContentType\");\n        this.Property(x =&gt; x.Id).HasColumnName(\"ContentTypeId\").IsRequired();\n\n        this.Property(x =&gt; x.Name).HasMaxLength(30);\n        this.HasOptional(x =&gt; x.Parent)\n            .WithMany()\n            .HasForeignKey(x =&gt; x.ParentId);\n\n        this.Property(x =&gt; x.SID).IsRequired();\n    }\n}\n\npublic class ContentTypeColumnConfiguration : EntityTypeConfiguration&lt;ContentTypeColumn&gt;\n{\n    public ContentTypeColumnConfiguration()\n    {\n        this.ToTable(\"ContentTypeColumn\");\n        this.HasRequired(x =&gt; x.ContentType)\n            .WithMany()\n            .HasForeignKey(x =&gt; x.ContentTypeId);\n        this.Property(x =&gt; x.Title).HasMaxLength(50).IsRequired();\n        this.Property(x =&gt; x.Id).HasColumnName(\"ContentTypeColumnId\");\n    }\n}\n</code></pre>\n\n<p>For some reason, two foreign keys are being created on the resultant <code>ContentTypeColumn</code> table. One is a nullable foreign key, the other is non-nullable. I want only the latter to be generated, and I have no idea where the nullable key is coming from.</p>\n\n<p>Any thoughts?</p>\n"},{"tags":[".net","entity-framework","postgresql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":183,"score":2,"question_id":12709718,"title":"Entity-Framwork 5.0 with PostgreSQL","body":"<p>I would like to use the Entity-Framework 5.0 as an O/R mapper with a PostgreSql database. I already read many HowTos but I'm still stuck. Maybe I don't get the whole idea behind the EF.</p>\n\n<p><strong>What I want:</strong></p>\n\n<ul>\n<li>I want to write the code by my own. Then put some attributes to the properties and classes to tell the EF how to map the objects (like I would do with NHibernate).</li>\n<li>I don't want to generate a database from my model - I just want to use an existing one.</li>\n</ul>\n\n<p><strong>Example Model:</strong></p>\n\n<pre><code>[Table(\"device\")]\npublic class Device\n{\n    [Key]\n    public int Id { get; set; }\n\n    [StringLength(255)]\n    public string Identifier { get; set; }\n}\n\n[Table(\"customer\")]\npublic class Customer\n{\n    public Customer()\n    {\n        this.Devices = new List&lt;Device&gt;();\n    }\n\n    [Key]\n    public int Id { get; set; }\n\n    [StringLength(255)]\n    public string Name { get; set; }\n\n    // attribute required?\n    public List&lt;Device&gt; Devices { get; set; }\n}\n</code></pre>\n\n<p><strong>What I did:</strong></p>\n\n<ul>\n<li>Wrote the code above</li>\n<li>Created a DatabaseContext class</li>\n<li>Added DbProviderFactories and connectionStrings in the app.config</li>\n<li>Generated ssdl, msl, csdl files with the EdmGen.exe tool and copied them in the project (these files are also available in the bin folder)</li>\n</ul>\n\n<p><strong>DatabaseContext:</strong></p>\n\n<pre><code>public class DatabaseContext : DbContext\n{\n    static DatabaseContext()\n    {\n        Database.SetInitializer&lt;DatabaseContext&gt;(null);\n    }\n\n    public DatabaseContext()\n        : base(\"PostgreSQL\")\n    {\n\n    }\n\n    public DbSet&lt;Customer&gt; Customers { get; set; }\n    public DbSet&lt;Device&gt; Devices { get; set; }\n}\n</code></pre>\n\n<p><strong>app.config:</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n  &lt;/configSections&gt;\n  &lt;startup&gt;\n    &lt;supportedRuntime version=\"v4.0\" sku=\".NETFramework,Version=v4.5\" /&gt;\n  &lt;/startup&gt;\n\n  &lt;system.data&gt;\n    &lt;DbProviderFactories&gt;\n      &lt;remove invariant=\"Npgsql\" /&gt;\n      &lt;add name=\"Npgsql Data Provider\" invariant=\"Npgsql\" support=\"FF\" description=\".Net Framework Data Provider for Postgresql Server\" type=\"Npgsql.NpgsqlFactory, Npgsql, Version=2.0.12.0, Culture=neutral, PublicKeyToken=5d8b90d52f46fda7\" /&gt;\n    &lt;/DbProviderFactories&gt;\n  &lt;/system.data&gt;\n\n  &lt;connectionStrings&gt;\n    &lt;add name=\"PostGreSQL\" \n         providerName=\"System.Data.EntityClient\" \n         connectionString=\"metadata=.;provider=Npgsql;provider connection string=&amp;quot;Server=asdf;Port=5432;User Id=asdf;Password=asdf;Database=asdf;enlist=true&amp;quot;\" /&gt;\n  &lt;/connectionStrings&gt;\n\n&lt;/configuration&gt;\n</code></pre>\n\n<p><strong>Test:</strong></p>\n\n<pre><code>using (DatabaseContext context = new DatabaseContext())\n{\n    if (context.Database.Exists())\n    {\n        Console.WriteLine(\"yep\");\n    }\n    else\n    {\n        Console.WriteLine(\"nope\");\n    }\n\n    foreach (Customer c in context.Customers)\n    {\n        Console.WriteLine(\"Name={0}\", c.Name);\n    }\n}\n\nConsole.ReadLine();\n</code></pre>\n\n<p><strong>Output &amp; Error:</strong></p>\n\n<p>\"yep\" .. which means the database exist.\nBut when accessing the context.Customers property I get the following Exception:</p>\n\n<pre><code>The entity type Customer is not part of the model for the current context.\n</code></pre>\n\n<p><strong>Stacktrace:</strong></p>\n\n<pre><code>at System.Data.Entity.Internal.InternalContext.UpdateEntitySetMappingsForType(Type entityType)\n   at System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType)\n   at System.Data.Entity.Internal.Linq.InternalSet`1.Initialize()\n   at System.Data.Entity.Internal.Linq.InternalSet`1.GetEnumerator()\n   at System.Data.Entity.Infrastructure.DbQuery`1.System.Collections.Generic.IEnumerable&lt;TResult&gt;.GetEnumerator()\n   at EF5.Program.Main(String[] args) in c:\\Users\\tba\\Documents\\Visual Studio 2012\\Projects\\EF5\\EF5\\Program.cs:line 26\n   at System.AppDomain._nExecuteAssembly(RuntimeAssembly assembly, String[] args)\n   at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)\n   at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()\n   at System.Threading.ThreadHelper.ThreadStart_Context(Object state)\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx)\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx)\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\n   at System.Threading.ThreadHelper.ThreadStart()\n</code></pre>\n\n<p><strong>What I don't understand:</strong></p>\n\n<ul>\n<li>What are the ssdl, msl, csdl files good for, if DataAnnoations are available?</li>\n<li>Why is the Customer class not part of the model for the current context?</li>\n</ul>\n\n<p>When using the EdmGen.exe Tool it generates also a ObjectLayer.cs file which contains an ObjectContext and entity classes. The problem with that is, the entity classes derive from EntityObject. If I want to use the entity classes as business classes this is a serious problem, because the classes can't derive from any other classes.</p>\n\n<p>Moreover I don't understand why it generates an ObjectContext.. every single HowTo I found uses the DbContext class.</p>\n\n<p><strong>Entity Customer class generated by the EdmGen tool:</strong></p>\n\n<pre><code>/// &lt;summary&gt;\n/// No Metadata Documentation available.\n/// &lt;/summary&gt;\n[EdmEntityTypeAttribute(NamespaceName=\"EF5\", Name=\"Customer\")]\n[Serializable()]\n[DataContractAttribute(IsReference=true)]\npublic partial class Customer : EntityObject\n</code></pre>\n\n<p>I am confused :-) </p>\n\n<p><strong>Edit:</strong></p>\n\n<ul>\n<li>I am not using the ObjectLayer.cs file! And I also don't want to use it, due to the  inheritance problems I stated above. The partial Customer class is just an example to show what the EdmGen tool generates.</li>\n<li><p>When I remove the csdl, msl and ssdl files I get the following error:</p>\n\n<pre><code>At least one SSDL artifact is required for creating StoreItemCollection.\n</code></pre></li>\n<li><p>When I remove the metadata keyword from the connectionString property in the app.config I get the following error:</p>\n\n<pre><code>Some required information is missing from the connection string. The 'metadata' keyword is always required.\n</code></pre></li>\n</ul>\n\n<p><br/>\n<br/></p>\n\n<p><strong>Solution:</strong></p>\n\n<p>I finally figured out how it works. The connectionString in the app.config is wrong. The correct connectionString:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"PostgreSQL\"\n        connectionString=\"Server=asdf;Port=5432;User Id=asdf;Password=asdf;Database=asdf;\"\n         providerName=\"Npgsql\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>I removed the metadata, provider and the provider connection string property from the connectionString. Like <a href=\"http://stackoverflow.com/users/475031/brice\">Brice</a> said, the metadata files aren't necessary, so I just removed them.</p>\n\n<p>Also the Table-Attribute for the Device and the Customer class needs to specify the <strong>schema</strong>. Like this:</p>\n\n<pre><code>[Table(\"customer\", Schema=\"public\")]\npublic class Customer\n</code></pre>\n"},{"tags":["linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":12731317,"title":"differences in LINQ queries","body":"<p>Can someone explain why, when a query should be returning one string item only like in the example below;</p>\n\n<pre><code>From c in context.Products Where c.Id=prodId Select c.Name\n</code></pre>\n\n<p>Why cant that be done like so;</p>\n\n<pre><code>Dim prodDeleted as String = (From c in context.Products Where c.Id=prodId Select c.Name).ToString()\n</code></pre>\n\n<p>bvecause it returns this  (System.Data.Objects.ObjectQuery`1[System.String]) , instead of the product name</p>\n\n<p>versus having to do it like so;</p>\n\n<pre><code> Dim prodDeleted = (From c In ctx.products\n                               Where c.Id = prodId\n                               Select c).FirstOrDefault()\n\n Dim deletedprodname As String = prodDeleted.Name.ToString()\n</code></pre>\n"},{"tags":["c#","entity-framework","error-handling","service-layer","data-layer"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12731158,"title":"How to surface the exception details to the user for resolution in a multi layered application","body":"<p>We have the following code in our Service Layer where we add a new user to the database using EF.</p>\n\n<pre><code>    public User AddUser(User user)\n    {\n        using (var context = DataObjectFactory.CreateContext())\n        {\n            var userEntity = Mapper.Map(user);\n\n            context.AddObject(\"UserEntities\", userEntity);\n\n            context.SaveChanges();\n\n            return Mapper.Map(userEntity);\n        }         \n    }\n</code></pre>\n\n<p>And this is called by the Service Layer via this method:</p>\n\n<pre><code>    public UserResponse GetSubmitUser(UserRequest request)\n    {\n        var response = new UserResponse(request.RequestId);\n\n        var user = Mapper.FromDataTransferObject(request.User);\n\n        response.User = Mapper.ToDataTransferObject(UserDao.AddUser(user));\n\n        return response;\n    }\n</code></pre>\n\n<p>We do certain client and server validations before we reach the AddUser however I am not sure about how to handle the unhandled exception(s).</p>\n\n<p>For instance if somehow context.SaveChanges() throws an error how do we bubble the error details back to the Presentation layer? </p>\n\n<p>I am thinking of putting try / catch within the AddUser like this:</p>\n\n<pre><code>    public User AddUser(User user)\n    {\n        try\n        {\n            using (var context = DataObjectFactory.CreateContext())\n            {\n                var userEntity = Mapper.Map(user);\n\n                context.AddObject(\"UserEntities\", userEntity);\n\n                context.SaveChanges();\n\n                return Mapper.Map(userEntity);\n            }  \n        }\n        catch (Exception)\n        {\n            return ??\n        }      \n    }\n</code></pre>\n\n<p>but the return type of the AddUser is User and I'm not sure what I should be returning when an exception happens. If I can return the exception details to the UserResponse method I can populate some fields within our response object which are there to hold error details, but now sure what to return from within the catch section.</p>\n\n<p>I am trying to understand how to identify exceptions that should be caught and handled in a multi layered application, one with a data access layer, service layer, presentation layer etc. Mainly trying to figure out how to surface the exception details to the user for resolution.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":3,"view_count":57,"score":-3,"question_id":12569618,"title":"EF Context.SaveChanges() does nothing","body":"<pre><code>try \n{\n    Context.SaveChanges();\n}\ncatch(Exception e)\n{\n     Log(e);\n}\nfinally\n{\n    Log(\"Complete\");\n}\n</code></pre>\n\n<p>When Context.SaveChanges() is called it silently fails. An exception is not thrown and the finally clause is never hit. Has anyone run into this before? </p>\n"},{"tags":["entity-framework","design-patterns","orm","domain-driven-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12715150,"title":"Does the following code violate Persistence Ignorance rule","body":"<p>a)  <em>Domain entities</em> shouldn't contain code related to persistence, thus they should be <em>Persistence Ignorant</em> <strong>PI</strong>. But assuming <em>Domain Model</em> <strong>DM</strong> is designed using <em>Entity Framework</em> and assuming  that <em>service layer</em> performs CRUD operation for <strong>POCO</strong> <em>domain entities</em>  via <em>Linq-to-Entities</em>, would we argue that <em>service layer</em> accesses DAL directly or via <em>Domain Model</em>:</p>\n\n<pre><code>class CustomerService\n{\n       public string doSomething( ... )\n       {\n                ...\n                var customer = context.Customers.Where( ... );\n                ...\n        }\n       ...\n}\n</code></pre>\n\n<p>b) Does using <em>Linq-to-Entities</em> within <strong>DM</strong> violate <strong>PI</strong>  rule? For example, does the following <code>Customer</code> entity violate PI:</p>\n\n<pre><code>class Customer\n{\n       public string InterestedWhatOtherCustomerOrdered( ... )\n       {\n                ...\n                var orders = context.Orders.Where( ... ); // does this violate PI rule?\n                ...\n        }\n       ...\n}\n</code></pre>\n\n<p><strong>REPLY TO Luke McGregor:</strong></p>\n\n<p>a)</p>\n\n<blockquote>\n  <p>Yeah it does as it refers to the context directly. A better way would\n  be to use the internal navigation properties on Customer to perform\n  the same action,</p>\n</blockquote>\n\n<p>So instead <em>navigation properties</em> should contact the <em>context</em>?! But since <em>navigation properties</em> also reside within domain model, couldn't we then argue that by contacting the <em>context</em> directly, they too would violate <strong>PI</strong>? </p>\n\n<p>b) According to <em>Fowler's PEAA chapter on Data Mapper</em>, it is ok to extract from <em>Data Mapper</em> any methods needed by the domain code into an interface class, which domain code can then use. How exactly could that be done when using <strong>EF</strong> instead of hand written <em>Data Mapper</em>, in such a manner that we wouldn't violate <strong>PI</strong>?</p>\n\n<p>thank you</p>\n"},{"tags":["c#","linq","entity-framework","elmah"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":138,"score":1,"question_id":12730095,"title":"Another System.InvalidOperationException: Sequence contains no elements (using .Any())","body":"<p>Getting the exception on this line:</p>\n\n<pre><code>public bool isEngageOn()\n    {\nline 149  -&gt; return chatUserRepository.Table.Where(c =&gt; c.TrackingOn).Any();\n    }\n</code></pre>\n\n<p><code>TrackingOn</code> is of type boolean.</p>\n\n<p><strong>.Any()</strong> is suppose to \"Determine weather a sequence contains any elements\", so why the exception \"System.InvalidOperationException Sequence contains no elements\" caught on Elmah?</p>\n\n<p>Error:</p>\n\n<pre><code>System.InvalidOperationException: Sequence contains no elements\n at System.Linq.Enumerable.Single[TSource](IEnumerable`1 source)\n at System.Linq.Queryable.Any[TSource](IQueryable`1 source)\n at sf2015.Models.DomainModels.Services.ChatServices.isEngageOn() in C:\\....\\ChatServices.cs:line 149\n</code></pre>\n\n<p>p.s.: Can't reproduce the error but it shows up on <a href=\"https://code.google.com/p/elmah/\" rel=\"nofollow\">Elmah</a> error logs sometimes.</p>\n\n<p>Below is some of the code for the repository</p>\n\n<pre><code>public virtual IQueryable&lt;T&gt; Table\n    {\n        get\n        {\n            return this.Entities;\n        }\n    }\n\n    private DbSet&lt;T&gt; Entities\n    {\n        get\n        {\n            if (_entities == null)\n                _entities = Context.Set&lt;T&gt;();\n            return _entities;\n        }\n    }\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12730506,"title":"EF 4.4 freeze on large table query","body":"<p>I m using EF 4.4 on ASP.NET MVC project with SQL server and my below query freeze every run.</p>\n\n<p><code>PSSAL</code> has 426.000 rows and <code>PU_CustProduct</code> has 1600 rows</p>\n\n<p>Have any idea or offer for query?</p>\n\n<pre><code>  var model = (from p in dbCont.PU_CustProduct\n         where !(from pt in dbCont.PSSAL\n        where pt.PSSAL_DATE &gt; d1\n        &amp;&amp; pt.PSSAL_PSPRP_ID == p.CustProductID\n        select pt.PSSAL_PSPRP_ID).Contains(p.CustProductID)\n\n     &amp;&amp; p.IsActive == true\n     &amp;&amp; (!p.IsSleepMode == true)\n     &amp;&amp; p.ProductType == intId\n     &amp;&amp; p.CustomerID != null\n     &amp;&amp; p.IsSychSuspend != true\n\nselect new WarningViewModel\n{\n    PrpName = p.LicenceName,\n    CrmID = p.CustomerID.ToString(),\n    PsprpId = p.CustProductID.ToString(),\n}).Distinct().OrderBy(o =&gt; o.PrpName).ToList();\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12730037,"title":"How do I build a dynamic form based on metadata?","body":"<p>I have a database table that contains the metadata for a data record. Basically it is a table of column names and data types for a record.</p>\n\n<p>Does anyone have or know of an example of how to read a table and build a form dynamically based on the values in the table?</p>\n\n<p>I am trying to do this in Asp.net MVC and EF5.</p>\n\n<p>as a side note; after the form is submitted each column value will be saved as its own record in a separate table.</p>\n\n<p>Any assistance is appreciated.</p>\n"},{"tags":["entity-framework","entity-framework-4.3.1"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":12729429,"title":"Entity Framework - closure of Object Contexts","body":"<p>After using EFProfiler (absolutely fantastic tool BTW!) for profiling a few of our Entity Framework applications, it seems that, in most cases, all of the Object Contexts are not closed.</p>\n\n<p>For example, after running it locally, EF Profiler told me that there were <strong>326</strong> Object Context's opened, yet only 1 was closed?</p>\n\n<p>So my question is, should I worry about this? Or is it self-contained within Entity Framework?</p>\n"},{"tags":["c#","entity-framework","fluent-interface"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12715777,"title":"Adding New Column to Mapped Table using Fluent API","body":"<p>I have two entities as below:</p>\n\n<pre><code>public class Project\n{\n    public int ID { get; set; }\n    public string ProjectName { get; set; }\n}\n\npublic Class FourteenSteps\n{\n    public int ID { get; set; }\n    public string StepName { get; set; }\n}\n</code></pre>\n\n<p>I want to map these two into one entity which I am doing using Fluent API as below:</p>\n\n<pre><code>modelBuilder.Entity&lt;Project&gt;()\n    .HasMany(c =&gt; c.FourteenSteps)\n    .WithMany(d =&gt; d.Projects)\n    .Map(m =&gt; m.ToTable(\"FourteenStepStatus\")\n    .MapLeftKey(\"ProjectId\")\n    .MapRightKey(\"FourteenStepsId\"));\n</code></pre>\n\n<p>Now, the new table \"FourteenStepStatus\" got two fields called \"ProjectId\" and<br>\n   \"FourteenStepsId\". </p>\n\n<p>I want to add one more field to \"FourteenStepStatus\" called \"IsCompleted\" which is \n   not part of the other two entities. How can I \n   do that?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#",".net","entity-framework","code-first"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":117,"score":1,"question_id":12698793,"title":"Soft Delete Entity Framework Code First","body":"<p>So I am using Entity Framework Code First</p>\n\n<p>I overrode SaveChanges in DbContext to allow me to do a \"soft delete\"</p>\n\n<pre><code>                        if (item.State == EntityState.Deleted &amp;&amp; \ntypeof(ISoftDelete).IsAssignableFrom(type))\n\n                    {\n                        item.State = EntityState.Modified;\n                        item.Entity.GetType().GetMethod(\"Delete\")\n                         .Invoke(item.Entity,null);\n\n                        continue;\n                    }\n</code></pre>\n\n<p>Which is great, so the object knows how to mark itself as a soft delete (In this case it just sets IsDeleted to true)</p>\n\n<p>My question is how can I make it such that when I retrieve the object it ignores any with IsDeleted ? So if I said <code>_db.Users.FirstOrDefault(UserId == id)</code> if that user had <code>IsDeleted == true</code> it would ignore it.  Essentially I want to filter? </p>\n\n<p>Note: I do not want to just put &amp;&amp; IsDeleted == true \nThat's why I am marking the classes with an interface so the remove knows how to \"Just Work\" and I'd like to somehow modify the retrieval to know how to \"Just Work\" also based on that interface being present.</p>\n\n<p>Thanks in Advance</p>\n"},{"tags":["c#",".net","entity-framework","dbcontext","entity-framework-5"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":12555602,"title":"EF 5 - Collection was modified; enumeration operation may not execute","body":"<p>I want to insert some test data into my database with Entity Framework 5. It works fine - only if I <strong>uncomment</strong> 1 line of code:</p>\n\n<pre><code>var query = DbContext.Set&lt;User&gt;().AsQueryable();\nquery = query.Include(\"Tabs.Boxes\");\nquery = query.Where(u =&gt; u.Name == \"test_guy\");\nUser test_guy = query.Single();\n\nTab mainTab = new Tab() \n{ \n    TabName = \"Main tab\",\n    Order = 1,\n};\nTab otherTab = new Tab()\n{\n    TabName = \"Test Guy's another tab\",\n    Order = 2\n};\n\ntest_guy.Tabs.Add(mainTab);\ntest_guy.Tabs.Add(otherTab);\n\nDbContext.SaveChanges();   // --&gt; If I comment this out, everything breaks!\n\nmainTab.Boxes = new Boxes();\nfor (int i = 0; i &lt; 10; i++)\n{\n    Box box1 = new Box()\n    {\n        Author = test_guy\n    };\n    mainTab.Boxes.Add(box1);\n}\n\nDbContext.SaveChanges();\n</code></pre>\n\n<p>If I <strong>comment out</strong> that SaveChanges call, I will get an exception:\n<code>Collection was modified; enumeration operation may not execute.</code></p>\n\n<p>I just want to know, what is the reason for this behaviour?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":218,"score":0,"question_id":12017089,"title":"How to use a stored procedure for Entity Framework model?","body":"<p>Hi before I use to retrieve and manipulate data directly from my DB..but this time I am using Entity Data Model.. I have all the tables in my <code>.edmx</code> file .... I have some queries in my DB for retrieving data but now as I am using Entity Data Model I don't know how to call that procedure in my controller as I am using MVC 3 here can any one tell me how to get the data using my stored procedure or write a Linq query similar to my stored procedure in my controller</p>\n\n<p>Here is my stored procedure:</p>\n\n<pre><code>  ALTER procedure [dbo].[ProjectReports]\n   (\n    @ProjectID int,\n    @ReleasePhaseID int\n   )\n   as\n   begin\n   select distinct projectName,ReleasePhase,\n   (Select  COUNT(1) from Bugs where ProjectId=a.ProjectId and           \n     ReleasePhaseID=a.ReleasePhaseID and\n     bugid in (select BugID from BugHistory where [status]='New')) as Newbugs,\n     (Select  COUNT(1) from Bugs where ProjectId=a.ProjectId and    \n     ReleasePhaseID=a.ReleasePhaseID and\n     bugid in (select BugID from BugHistory where [status]='Assigned')) as  \n     Assignedbugs,\n     (Select  COUNT(1) from Bugs where ProjectId=a.ProjectId and  \n     ReleasePhaseID=a.ReleasePhaseID and\n     bugid in (select BugID from BugHistory where [status]='Fixed')) as Fixedbugs,\n      (Select  COUNT(1) from Bugs where ProjectId=a.ProjectId and\n       ReleasePhaseID=a.ReleasePhaseID and\n     bugid in (select BugID from BugHistory where [status]='Re-Opened')) as \nReopenedbugs,\n    (Select  COUNT(1) from Bugs where ProjectId=a.ProjectId and \n     ReleasePhaseID=a.ReleasePhaseID and\n     bugid in (select BugID from BugHistory where [status]='Closed')) as Closedbugs,\n     (Select  COUNT(1) from Bugs where ProjectId=a.ProjectId and  \n     ReleasePhaseID=a.ReleasePhaseID and\n     bugid in (select BugID from BugHistory where [status]='Deffered')) as Defferedbugs,\n     (Select  COUNT(1) from Bugs where ProjectId=a.ProjectId and  \n      ReleasePhaseID=a.ReleasePhaseID and\n      bugid in (select BugID from BugHistory where [status]='Not a Bug')) as NotaBug\n      from Bugs a\n      inner join Projects p on p.ProjectId=a.ProjectId\n      inner join ReleasePhase Rp on rp.ReleasePhaseID=a.ReleasePhaseID\n      where a.ProjectId=@ProjectID and a.ReleasePhaseID=@ReleasePhaseID\n     end\n</code></pre>\n\n<p>How do I do this?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","ef-model-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12724088,"title":"How to check unique constraint using EF model first approach?","body":"<p>I'm developing website using MVC3 using <strong>model first approach</strong>.</p>\n\n<p>I have a field in my \"Employee\" model that is \"username\". <strong>And this field is neither a unique field nor foreign key</strong>. my application requirement is <code>username should be unique, and if user enters duplicate value then it show error message</code>. </p>\n\n<p><strong>For my mvc project, i created entity framework as a class library and added its reference in the mvc project for accessing model classes and all this related to entity framework i created for my website.</strong> </p>\n\n<p><strong>How to do this in model itself using EF model first approach ?</strong></p>\n"},{"tags":["entity-framework","change-tracking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12726878,"title":"Global setting for AsNoTracking()?","body":"<p>Originally I believed that              </p>\n\n<pre><code>context.Configuration.AutoDetectChangesEnabled = false;\n</code></pre>\n\n<p>would disable change tracking. But no. Currently I need to do a AsNoTracking() on all my linq queries (for my read only layer).</p>\n\n<p>Isn't there a global setting to disable tracking on the DbContext?</p>\n\n<p>Thanks,\nAnders</p>\n"},{"tags":["sql-server-2008","entity-framework","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12720738,"title":"Stored procedure execution in Entity Framework in SQL Server 2005","body":"<p>I am using MVC3 and Entity Framework for calling a stored procedure in SQL Server 2008. The procedure has no parameters and in the profiler I get the proc execution as</p>\n\n<pre><code>exec sp_executesql N'sp_GetDashSessionboardRoomTimeSlot', N'@p0 nvarchar(4000)', @p0=NULL\n</code></pre>\n\n<p>This is how I call in the c# code.</p>\n\n<pre><code>SqlParameter sa = null;\nvar query = from dashboardData in TBSCIDBContext.Database.SqlQuery&lt;SessionDashboardData&gt;(\"sp_GetDashSessionboardRoomTimeSlot\", sa)\n            select dashboardData;\n</code></pre>\n\n<p>This works fine. But I have changed my database to SQL Server 2005 and I need to use it </p>\n\n<p>So when I call the same procedure using the same C# code the profiler returns the same exec statement but the sql gives error </p>\n\n<blockquote>\n  <p>Incorrect syntax near 'sp_GetDashSessionboardRoomTimeSlot'</p>\n</blockquote>\n\n<p>pls help me in how to fix this problem as I need to use this stored procedure and in SQL Server 2005</p>\n"},{"tags":["entity-framework","task-parallel-library","transactionscope","entity-framework-4.3","sqlcommand"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12725805,"title":"Entity Framework, SqlCommand and TransactionScope","body":"<p>I have a repository done in EF 4.3 Code First (EF) , and another repository that uses regular SqlCommand (SQLCMD). EF pass the connection object to SQLCMD, so both are using the same connection.</p>\n\n<p>In EF I create an entity, and use the entity Id to do other operation with SQLCMD. Of course the entity must exist, otherwise I get a FK error. It works well, but I need to keep both operations in the same transaction, so both are rolledback if something goes wrong.</p>\n\n<p>If I wrap both in the same TransactionScope it does not work, <strong>SQLCMD cannot see the entity created by EF</strong>. But if I remove the TransactionScope it works again. The error is always the same, a SQL error about a wrong FK.</p>\n\n<p>I have tried to enable the MSDTC in my computer, but it is still not working. Although this should not be an issue since both use the same connection.</p>\n\n<p>I have noticed, that EF closes the connection after use, so when SQLCMD get it, it has to open it again. Could it be this the problem?</p>\n\n<p>This is Windows 7 x64 Ultimate and SqlServer 2008.</p>\n\n<p>What is the problem? Thanks!</p>\n\n<p>EDIT:</p>\n\n<p>Apparently the problem is that I am using Tasks in SQLCMD. It is not one, it is a succession of them in a chain, I dunno how to approach this using TransactionDependantClone.</p>\n"},{"tags":["asp.net","entity-framework","validation","web-applications"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12718130,"title":"Validation: Using ModelState w/ Web Forms and EF","body":"<p>I'm using VS 2012/.NET 4.5, EF 5, and a solution which was imported/opened from an older VS 2012/.NET 4 project.  An edmx (w/ self-tracking entities) was generated from the database in the original project and I'm simply trying to add data validation to my model, using ASP.NET web forms, NOT MVC.  MVC is not an option for this project.</p>\n\n<p>I've tried this approach, while Googling for a couple of days and stitching various bits of information together.</p>\n\n<p>I've tried using MetadataType to extend my edmx model...it's just not working.  Here's what it looks like:</p>\n\n<pre><code>//generated by VS 2010\nnamespace DataAccess.Model\n{\n    [DataContract(IsReference = true)]\n    public partial class NoBilling: IObjectWithChangeTracker, INotifyPropertyChanged\n    {\n        //...and so on...all generated by Visual Studio\n    }\n}\n</code></pre>\n\n<p>...extended:</p>\n\n<pre><code>namespace DataAccess.Model\n{\n    [MetadataType(typeof(DataAccess.Model.NoBillingMetadata))]\n    public partial class NoBilling {}\n\n    public partial class NoBillingMetadata\n    {\n        [Required, StringLength(50)]\n        public string Company\n        {\n            get;\n            set;\n        }\n\n        [Required, MaxLength(50)]\n        public string EmailDomain\n        {\n            get;\n            set;\n        }\n    }\n}\n</code></pre>\n\n<p>...in the web form:</p>\n\n<pre><code>protected void SaveButton_Click(object sender, EventArgs e)\n{\n    //assign to entity\n    NoBilling nb = new NoBilling();\n    nb.Zip = \"10001\";\n\n    //save\n    try\n    {\n        NoBillingProxy nbPx = new NoBillingProxy();\n        nbPx.Save(nb);\n    }\n    catch (Exception exp)\n    {               \n        //data validation\n        if (ModelState.IsValid)\n        {\n            //always tests true, no values in ModelState collection\n        }\n\n        throw;\n    }\n}\n</code></pre>\n\n<p>I know I'm missing some things here, but I don't have unlimited time to keep digging and cobbling things together.  I don't know the innards of this ModelState class, how it's called, triggered, etc.  I'm assuming it doesn't work because I haven't actually bound any data?  I won't always bind entities to controls, so is there a way to change the \"IsValid\" state, sans binding?</p>\n\n<p>This is the article I used to get a bunch of what I tried:</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/vs11trainingcourse_aspnetwebforms45_topic3.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/vs11trainingcourse_aspnetwebforms45_topic3.aspx</a></p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["c#","asp.net-mvc","linq","entity-framework","asp.net-mvc-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12726480,"title":"NullReferenceException when trying to add in one-to-many relation","body":"<p><code>Item</code> can contain multiple <code>Sizes</code>. When I try to add new size to my item it throws <code>NullReference</code> error. Same thing happens when I try to add images to my item.</p>\n\n<blockquote>\n  <p>Object reference not set to an instance of an object.</p>\n</blockquote>\n\n<h2>Code</h2>\n\n<pre><code>var size = new Size(){\n    BasePrice = currentBasePrice, // not null, checked in debugger\n    DiscountPrice = currentDiscountPrice // not null, checked in debugger\n};\n\n// item is not null, checked in debugger\nitem.Sizes.Add(size); // nothing here is null, however it throws null reference error here\n</code></pre>\n\n<h2>Item Model</h2>\n\n<pre><code>public class Item\n{\n    public int ID { get; set; }\n    public int CategoryID { get; set; }\n    virtual public Category Category { get; set; }\n    virtual public ICollection&lt;Size&gt; Sizes { get; set; }\n    virtual public ICollection&lt;Image&gt; Images { get; set; }\n}\n</code></pre>\n\n<h2>Size Model</h2>\n\n<pre><code>public class Size\n{\n    public int ID { get; set; }\n    public int ItemID { get; set; }\n    virtual public Item Item { get; set; } // tried to delete this, did not help\n    public decimal BasePrice { get; set; }\n    public decimal? DiscountPrice { get; set; }\n}\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework","asp.net-mvc-4","simplemembership"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":277,"score":0,"question_id":12365392,"title":"MVC 4 SimpleMembershipProvider using SQL Server without EntityFramework","body":"<p>Is it possible to set up MVC 4 with SimpleMembershipProvider without EntityFramework, or do I need to write a custom provider?</p>\n\n<p>Thanks in advance! </p>\n"},{"tags":["entity-framework","stored-procedures","ado.net"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12721226,"title":"In scenario, where only stored procedures are used for ASP.NET MVC 4 application - is better ADO.NET or EntityFramework 5?","body":"<p>I want to know your opinion.</p>\n\n<p>In scenario, where only stored procedures are used for data manipulation - is better to use standard <strong>ADO.NET</strong> <em>or</em> <strong>Entity Framework 5</strong>.</p>\n\n<p>The only (and main) reason for using EF are strongly typed classes (generated complex classes), that can be used as a model in <strong>ASP.NET MVC 4</strong>. Updating complex types could be simpler in EF compare to ADO.NET.</p>\n\n<p>Reason for using ADO.NET is making communication with database more simply.</p>\n\n<p>Thank you for your opinion.</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12724651,"title":"EF Code First exclude column","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1707663/exclude-a-field-property-from-the-database-with-entity-framework-4-code-first\">Exclude a field/property from the database with Entity Framework 4 &amp; Code-First</a>  </p>\n</blockquote>\n\n\n\n<p>I am using EF 4 code-first.</p>\n\n<p>Is there any method to exclude creating a column into the database?</p>\n\n<p>For example I want to exclude the <code>Zip</code> column to be created.</p>\n\n<pre><code>public string Address { get; set; }\n[StringLength(40)]\npublic string City { get; set; }\n[StringLength(30)]\npublic string State { get; set; }\n[StringLength(10)]\npublic string Zip { get; set; }\n</code></pre>\n\n<p>Thank you.</p>\n"},{"tags":["entity-framework","dbcontext","entity-framework-5"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12724092,"title":"DbContext.Entry performance issue","body":"<p>Following Julia Lermas book 'DbContext' on a N-Tier solution of keeping track of changes, I provided each entity with a State property and a OriginalValues dictionary (through IObjectWithState). After the entity is constructed I copy the original values to this dictionary. See this sample (4-23) of the book:</p>\n\n<pre><code>public BreakAwayContext()\n{\n  ((IObjectContextAdapter)this).ObjectContext.ObjectMaterialized += (sender, args) =&gt;\n  {\n      var entity = args.Entity as IObjectWithState;\n      if (entity != null)\n      {\n        entity.State = State.Unchanged;\n        entity.OriginalValues = BuildOriginalValues(this.Entry(entity).OriginalValues);\n      }\n    };\n}\n</code></pre>\n\n<p>In the constructor of the BreakAwayContext (inherited from DbContext) the ObjectMaterialized event is caught. To retrieve the original values of the entity, the DbEntityEntry is retrieved from the context by the call to this.Entry(entity). This call is slowing the process down. 80% of the time of this event handler is spend on this call.</p>\n\n<p>Is there a faster way to retrieve the original values or the entities DbEntityEntry?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12717557,"title":"Quick create Model Class from existing SQL Table","body":"<p>I am using EF Code First in a project with an existing Database, all works well and so far I have been creating the class for each table manually (as they have been very small) but getting to the larger tables I can only assume there must be a better way to 'import' or 'convert' the tables fields into a class somehow.  Had a search around and can't really find what I'm looking for.</p>\n\n<p>To clarify I want to keep it Code First.</p>\n"},{"tags":[".net","sql-server-2005","entity-framework"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1706,"score":4,"question_id":3266295,"title":".Net Entity Framework and Transactions","body":"<p>Being new to the EF, I'm really rather stuck on how to proceed with this set of issues. On the project I am currently working on, the entire site is heavily integrated with the EF model. At first, the access to the EF context was being controlled using an IOC bootstrapper. For operational reasons we were not able to use IOC. I removed this and used a model of individual instances of the context object where required. I started getting the following exception:</p>\n\n<p><code>The type 'XXX' has been mapped more than once.</code></p>\n\n<p>We came to the conclusion that the different instances of the context were causing this issue. I then abstracted the context object into a single static instance which was being accessed by each thread/page. I'm now getting one of several exceptions about transactions:</p>\n\n<p><code>New transaction is not allowed because there are other threads running in the session.</code></p>\n\n<p><code>The transaction operation cannot be performed because there are pending requests working on this transaction.</code></p>\n\n<p><code>ExecuteReader requires the command to have a transaction when the connection assigned to the command is in a pending local transaction. The Transaction property of the command has not been initialized.</code></p>\n\n<p>The last of these exceptions occurred on a load operation. I wasn't trying to save the context state back to the Db on the thread that failed. There was another thread performing such an operation however.</p>\n\n<p>These exceptions are intermittent at best, but I have managed to get the site to go into a state where new connections were refused due to a transaction lock. Unfortunately I cannot find the exception details.</p>\n\n<p>I guess my first question is, should the EF model be used from a static single instance? Also, is it possible to remove the need for transactions in EF? I've tried using a <code>TransactionScope</code> object without success...</p>\n\n<p>To be honest I'm a lot stuck here, and cannot understand why (what should be) fairly simple operations are causing such an issue...</p>\n\n<p>Cheers,\nsicknote</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":24,"score":-2,"question_id":12722191,"title":"How to convert this query into linq to entities?","body":"<pre><code>SELECT  DISTINCT    POS_ItemMaster_Outer.ItemCode AS Code, \n        POS_ItemBrand.ItemBrandNewDesc AS Quality,\n        ISNULL(CAST(POS_ItemSize.[Length] AS VARCHAR), '') + 'x' + ISNULL(CAST(POS_ItemSize.Width AS VARCHAR),'') + 'x' + ISNULL(CAST(POS_ItemSize.Height AS VARCHAR),'') AS Size,\n        POS_ItemCategory.ItemCategoryNewDesc AS Category,\n\n        (SELECT (SUM(POS_StockRegister.StockIn)- SUM(POS_StockRegister.StockOut)) \n        FROM    POS_StockRegister\n        INNER JOIN POS_ItemMaster ON \n        POS_StockRegister.ItemMasterID = POS_ItemMaster.ItemMasterID\n        WHERE   MONTH(POS_StockRegister.TransDate) &lt; 10 AND\n        YEAR(POS_StockRegister.TransDate) = 2012 AND\n        POS_ItemMaster.ItemMasterID = POS_ItemMaster_Outer.ItemMasterID \n        AND DealerID = 22) AS OpeningStock,\n\n       (SELECT SUM(POS_StockRegister.StockIn) \n        FROM    POS_StockRegister\n        INNER JOIN POS_ItemMaster ON \n        POS_StockRegister.ItemMasterID = POS_ItemMaster.ItemMasterID\n        WHERE   MONTH(POS_StockRegister.TransDate) = 10 AND\n        YEAR(POS_StockRegister.TransDate) = 2012 AND\n        POS_ItemMaster.ItemMasterID = POS_ItemMaster_Outer.ItemMasterID \n        AND DealerID = 22) AS Purchased,\n\n        (SELECT SUM(POS_StockRegister.StockOut) \n        FROM    POS_StockRegister\n        INNER JOIN POS_ItemMaster ON \n        POS_StockRegister.ItemMasterID = POS_ItemMaster.ItemMasterID\n        WHERE   MONTH(POS_StockRegister.TransDate) = 10 AND\n        YEAR(POS_StockRegister.TransDate) = 2012 AND\n        POS_ItemMaster.ItemMasterID = POS_ItemMaster_Outer.ItemMasterID \n        AND DealerID = 22) AS Sale\n\n        FROM POS_StockRegister\n        INNER JOIN POS_ItemMaster POS_ItemMaster_Outer ON\n        POS_ItemMaster_Outer.ItemMasterID = POS_StockRegister.ItemMasterID \n        INNER JOIN POS_ItemCategory ON\n        POS_ItemMaster_Outer.CDCategoryID = POS_ItemCategory.ItemCategoryID\n        INNER JOIN POS_ItemSize ON\n        POS_ItemSize.ItemSizeID = POS_StockRegister.ItemSizeID\n        INNER JOIN POS_ItemBrand ON\n        POS_ItemBrand.ItemBrandID = POS_StockRegister.ItemBrandID\n        WHERE POS_StockRegister.DealerID = 22\n</code></pre>\n"},{"tags":["c#",".net","xml","entity-framework"],"answer_count":5,"favorite_count":5,"up_vote_count":15,"down_vote_count":0,"view_count":14693,"score":15,"question_id":608477,"title":"Entity Framework with XML Files","body":"<p>Can someone point me to a good tutorial explaining the Entity Framework using an XML file instead of a database?\nI have seen some good tutorials with SQL databases, but I can't make the leap to an XML file.</p>\n\n<p>Thanks!</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":26,"score":2,"question_id":12684036,"title":"Pregenerate INSERT / UPDATE views in Entity Framework","body":"<p>We're experiencing an issue with Entity Framework where the first time we execute SaveChanges on a very simple object insertion, there is a delay of 2-4 seconds.  I have narrowed this down (via ANTS Performance Profiler) to View Generation.  I've seen and followed the articles for pre-generating views with <a href=\"http://msdn.microsoft.com/en-us/library/bb896240.aspx\" rel=\"nofollow\">EdmGen</a> or a <a href=\"http://blogs.msdn.com/b/adonet/archive/2008/06/20/how-to-use-a-t4-template-for-view-generation.aspx\" rel=\"nofollow\">T4 template</a>, but this doesn't help: the .Views.cs file only contains SELECT statements, not UPDATE or INSERT statements.  There's been a lot of discussion around EF and performance using precompiled queries, cached queries, etc but it all centers around selects, not inserts or updates which are all hidden behind SaveChanges().</p>\n\n<p>The only way I've found to get EF to generate the INSERT view is to try to insert a row at service startup that I know will fail, such as setting a foreign key to an ID that should never exist.  This seems absolutely ridiculous to me.  Is there a better way?  I don't really care if it happens at compile time or at service startup, but is there a way to force EF to generate all the (basic) UPDATE and INSERT views?  Making the first user of the service wait 2-4 seconds to insert a single row is not acceptable.</p>\n\n<p>We're using EF 4 right now but we will make the jump to EF 5 and .NET 4.5 if necessary to solve this issue.</p>\n\n<p>Edit:\nFurther investigation has shown that while there <em>is</em> overhead the first time SaveChanges() is called on a table while it creates / compiles the update view, it is negligible (30-40ms).  Profiling it makes it look worse than it is due to the huge call stack.  My original timings of 2-4 seconds ended up breaking down into other overhead like:\nCreating the first context: 1600ms\nFirst EF operation (which loads or creates query views) 400ms if precompiled, 3000+ms otherwise\nInitial connection to the remote database: 500ms</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":124,"score":1,"question_id":12267869,"title":"how to use ef code first with sql server ce in asp.net mvc 4 visual studio 2012","body":"<p>I am trying to create a simple EF code first sample using SQL server compact edition 4.0.\nTechnologies used include: Visual Studio 2012 Ultimate.</p>\n\n<p>So i created a simple poco class:</p>\n\n<pre><code>namespace MvcApplication2.Models\n{\n    public class Customer\n    {\n        public int CustomerId { get; set; }\n        public string CustomerName { get; set; }\n    }\n}\n</code></pre>\n\n<p>And a simple context class:</p>\n\n<pre><code>namespace MvcApplication2.Models\n{\n    public class CustomerEntity : DbContext\n    {\n        public DbSet&lt;Customer&gt; Customers { get; set; }\n    }\n}\n</code></pre>\n\n<p>Then I tried to create a controller class with the template: MVC Controller with read/write actions and views using entity framework.</p>\n\n<ul>\n<li>Model class -> Customer </li>\n<li>Data context class -> CustomerEntity</li>\n</ul>\n\n<p>I got the following error:</p>\n\n<blockquote>\n  <p>Unable to retreive metadata for ... Using the same dbcompiledmodel to\n  create contexts against different types of database servers is not\n  supported. ...</p>\n</blockquote>\n\n<p>I should say this exact same code worked without problem using LocalDB.</p>\n\n<p>The only difference that I thought was needed, was the addition of the following to the web.config file.</p>\n\n<pre><code>&lt;add name=\"CustomerEntity\"\n     connectionString=\"Data Source=|DataDirectory|CustomerEntity.sdf\"\n     providerName=\"System.Data.SqlServerCe.4.0\" /&gt;\n</code></pre>\n\n<p>Am I missing something else?</p>\n\n<p>I know I can't be the only one having this problem.  </p>\n"},{"tags":["sql-server","entity-framework","code-first","unique-constraint"],"answer_count":9,"favorite_count":17,"up_vote_count":43,"down_vote_count":0,"view_count":11898,"score":43,"question_id":4413084,"title":"Unique Constraint in Entity Framework Code First","body":"<p><strong>Question</strong></p>\n\n<p>Is it possible to define a unique constraint on a property using either the fluent syntax or an attribute? If not, what are the workarounds?</p>\n\n<p>I have a user class with a primary key, but I would like to make sure the email address is also unique. Is this possible without editing the database directly?</p>\n\n<p><strong>Solution (based on Matt's answer)</strong></p>\n\n<pre><code>public class MyContext : DbContext {\n    public DbSet&lt;User&gt; Users { get; set; }\n\n    public override int SaveChanges() {\n        foreach (var item in ChangeTracker.Entries&lt;IModel&gt;())\n            item.Entity.Modified = DateTime.Now;\n\n        return base.SaveChanges();\n    }\n\n    public class Initializer : IDatabaseInitializer&lt;MyContext&gt; {\n        public void InitializeDatabase(MyContext context) {\n            if (context.Database.Exists() &amp;&amp; !context.Database.CompatibleWithModel(false))\n                context.Database.Delete();\n\n            if (!context.Database.Exists()) {\n                context.Database.Create();\n                context.Database.ExecuteSqlCommand(\"alter table Users add constraint UniqueUserEmail unique (Email)\");\n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":220,"score":1,"question_id":8752909,"title":"ASP.NET MVC: Prevent user from editing certain fields on the model","body":"<p>I have a model which has several fields which I never want to be editable by the user. How can I create an edit page which not only hides these fields, but also protects against the user injecting the input elements themselves?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12713728,"title":"Entity Framework Code First Filtering Results for retrieval","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12698793/soft-delete-entity-framework-code-first\">Soft Delete Entity Framework Code First</a>  </p>\n</blockquote>\n\n\n\n<p>Is there any way to filter the results for an entity before results are returned?\nSo say First or Find or whatever method I choose to use against the entity would not return anything older than 3 months let's say.  Also if I include the entity it would be filtered as such too.  I am trying to use this to implement a soft delete amongst other things</p>\n\n<p>I would like this to be done internally somehow if possible so I can say <code>_db.SmallGroups.ToList()</code> and it would know what records to NOT bring back (ie older records, IsDeleted==true records) I don't want to have to put this logic in at every query point if possible</p>\n\n<p>Thanks in Advance</p>\n"},{"tags":["sql-server","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":12307,"score":9,"question_id":5001441,"title":"Using stored procedures with Entity Framework 4 Code First CTP5","body":"<p>I am using Entity Framework 4 Code First CTP5 and ASP.NET MVC 3.  I would like to know how do I make use of stored procedures?</p>\n\n<p>I have the following code in my respository class:</p>\n\n<pre><code>MyDatabaseContext db = new MyDatabaseContext();\n\npublic void Insert(News news)\n{\n   db.Newses.Add(news);\n   db.SaveChanges();\n}\n</code></pre>\n\n<p>And then my insert store procedure will look like this:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[News_Insert]\n(\n   @Title VARCHAR(100),\n   @Body VARCHAR(MAX),\n   @NewsStatusId INT\n)\n\nAS\n\nBEGIN\n\n   INSERT INTO\n      News\n      (\n         Title,\n         Body,\n         NewsStatusId\n      )\n      VALUES\n      (\n         @Title,\n         @Body,\n         @NewsStatusId\n      );\n\n  SELECT SCOPE_IDENTITY();\n\nEND\n</code></pre>\n\n<p>Any articles/advice would be appreciated.</p>\n\n<p><strong>UPDATE 1:</strong></p>\n\n<p>With the designer I could return the new object or news ID, how would I do this here?</p>\n\n<p><strong>UPDATE 2</strong></p>\n\n<p>This is what I did:</p>\n\n<pre><code>public void Insert(News news)\n{\n   int newsId = context.Database.SqlQuery&lt;int&gt;(\"News_Insert @Title, @Body, @Active\",\n      new SqlParameter(\"Title\", news.Title),\n      new SqlParameter(\"Body\", news.Body),\n      new SqlParameter(\"Active\", news.Active)\n   ).FirstOrDefault();\n\n   context.SaveChanges();\n}\n</code></pre>\n\n<p>I get an error here saying:</p>\n\n<p><strong>The specified cast from a materialized 'System.Decimal' type to the 'System.Int32' type is not valid.</strong></p>\n\n<p>My News class:</p>\n\n<pre><code>public class News\n{\n   public int NewsId { get; set; }\n   public string Title { get; set; }\n   public string Body { get; set; }\n   public bool Active { get; set; }\n}\n</code></pre>\n\n<p>I am using an existing database and my connection string looks like this:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n   &lt;add\n      name=\"MyDatabaseContext\"\n      connectionString=\"Data Source=MyServer;Initial Catalog=MyDatabase;Integrated Security=True;\"\n      providerName=\"System.Data.SqlClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>Here is my context class:</p>\n\n<pre><code>public class MyDatabaseContext : DbContext\n{\n   public DbSet&lt;News&gt; Newses { get; set; }\n}\n</code></pre>\n\n<p>I'm not sure what I am doing wrong here?  Is my stored procedure maybe incorrect?  Ideally I would like to return the new updated object.  Can someone please advise?</p>\n"},{"tags":["wcf","entity-framework","domain-driven-design"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12716805,"title":"Problems with EF-Agnostic design consumed by WCF service.","body":"<p>I am trying to set up EF to work on WCF and keeping the domain class models EF Agnostic.</p>\n\n<p>The code is organized into 3 projects. (I am taking a stab a DDD - I am very new to it but am looking forward t learning more)</p>\n\n<pre>\n    Project: QA - Domain Layer. Contains the DataContract models/entities.\n        References \n            QA.Data\n\n    Project: QA.Data - Data Layer. Contains the context and EDMX (code generation stragtegy = \"none\")\n        References\n            Entity Framework/System.Data.Entity\n\n    Project: QA.Repository - Data Access/Repository. Contains the repository classes\n        References\n            QA [Domain Layer]\n            QA.Data [Data Layer]\n            Entity Frame/System.DataEntity\n</pre>\n\n<p>My understanding is that the domain layer can reference the data layer but the data layer should never reference the domain. The problem that this presents is that my Domain Models/Classes are defined in the Domain layer but the Context which creates and returns them is in the Data layer. In order for my context to know to return a \"Widget\" object it would need a reference to the Domain layer which defined the \"Widget\"</p>\n\n<p><b>My (failed) solution</b> : My solution was to create interfaces for each Domain Model and place them in the data layer. The context would return ... IdbSet ... These interfaces would, in turn, be implemented by the Domain Models, therefore keeping my data layer from directly needing to reference my domain (which causes illegal circular references anyway). The domain models were originally contructed using \"ADO.NET DbContext Generator w/WCF Support\" T4 templates. This process resulted in the inclusion of the [KnownType(typeof(IWidgetPiece))] at the beginning of of the widget class defin ition. (A Widget has a navigation property ... ICollection ...)</p>\n\n<p>The problem appears when I attempt to access the service, I get the following error </p>\n\n<blockquote>\n  <p>'QA.Data.IWidgetPiece' cannot be added to list of known types since\n  another type 'System.Object' with the same data contract name\n  'http://www.w3.org/2001/XMLSchema:anyType' is already present. If\n  there are different collections of a particular type - for example,\n  List and Test[], they cannot both be added as known types. \n  Consider specifying only one of these types for addition to the known\n  types list.</p>\n</blockquote>\n\n<p>I can change these to the concrete implementations ... [KnownType(typeof(WidgetPiece))] ... but I continue to get this error because the navigation property they are referring to is still returning an IWidgetPiece interface type which it MUST do in order to satify the interface implementation.</p>\n\n<p>I am trying to figure out how to keep things appropriately divided and still have the context returning what it should. the context returning Interfaces still doesn't \"sit\" right with me for this and other reasons but I cannot think of another way to do this, and even this is presenting the aforementioned issue. HELP!</p>\n\n<p>Some code to hopefully clarify my previous ramblings ...</p>\n\n<pre><code>namespace QA.Data\n{\n\n    public interface IWidgetPiece\n    {\n        String ID { get; set; }\n    }\n\n    public interface IWidget\n    {\n        String ID { get; set; }\n        ICollection&lt;IWidgetPiece&gt; Pieces;    \n    }\n\n    public partial class WidgetEntities : DbContext\n    {\n        IDbSet&lt;IWidget&gt; Widgets { get; set; }\n        IDbSet&lt;IWidgetPiece&gt; WidgetPieces { get; set; }\n    }\n\n}\n\n\nnamespace QA\n{\n    [KnownType(typeof(IWidgetPiece))]\n//  [KnownType(typeof(WidgetPiece))]\n    [DataContract(IsReference = true)]\n    public partial class Widget : QA.Data.IWidget\n    {\n        [DataMember]\n        public String ID { get; set; }\n        [DataMember]\n        public virtual ICollection&lt;IWidgetPiece&gt; Pieces { get; set; }\n    }\n\n    [DataContract(IsReference = true)]\n    public partial class WidgetPiece : QA.Data.IWidgetPiece\n    {\n        [DataMember]\n        public string ID { get; set; }\n    }\n\n}\n\n\nnamespace QA.Repository\n{\n    public class WidgetRepository\n    {\n        public List&lt;Widget&gt; GetWidgetbyID(String sId)\n        {\n            WidgetEntities context = new WidgetEntities();\n            List&lt;IWidget&gt; objs = context.Widgets.Where(b =&gt; b.ID == \"78\").ToList();\n\n            List&lt;Widget&gt; widgetList = new List&lt;Widget&gt;();\n            foreach (var iwidget in widgetList)\n                widgetList((Widget)iwidget);\n\n            return widgetList;\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#","asp.net-mvc","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12715663,"title":"Linq to Entity Select, Exclude 1st result row?","body":"<p>I have a Linq to Entity Select statement that is currently returning all rows from the database.  Since the 1st row of data contains header information, is it possible to exclude the first row from the result set?</p>\n\n<pre><code>var surveyProgramType = surveyProgramTypeRepository\n                        .Find()\n                        .OrderBy(x =&gt; x.ProgramType);\n</code></pre>\n"},{"tags":["linq","entity-framework"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12710936,"title":"Deep LINQ projections, how?","body":"<p>Let's say I have a model created with EF 4.0</p>\n\n<ul>\n<li><p>User</p>\n\n<ul>\n<li><p>Roles</p>\n\n<ul>\n<li>Permissions</li>\n</ul></li>\n</ul></li>\n</ul>\n\n<p>Each entity has a DeleteDate property.</p>\n\n<p>I want to get a specific user (with Name =...) and have the tree filled with items where DeletedDate == null..</p>\n\n<p>This must be done with anonymous type projection as result, but I don't know how to accomplish this with a hierachy deeper than 2..</p>\n\n<p>This is what I already have:</p>\n\n<pre><code>    public MyProjection MyCall(string givenName)\n    {\n      var result = from s in context.Users\n                   where (s.Name == givenName &amp;&amp;\n                                    s.DeletedDate == null)\n                             select new\n                             {\n                                 s,\n                                 roles = from r in s.Roles\n                                         where r.DeletedDate == null\n                                         select r\n                             };\n\n      var outcome = result.FirstOrDefault();\n\n      if (outcome != null)\n      {\n         var myProjection = new MyProjection()\n         {\n             User = outcome.s,\n             Roles = outcome.roles\n         };\n\n         return myProjection;\n       }\n\n    return null;\n   }\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12716395,"title":"The data reader is incompatible with the specified field with Entity Framework 5","body":"<p>I'm getting the below error with EF 5 and have researched it on the web vigorously and figured it was simply a mapping issue. Everything I have checked into comes out fine. </p>\n\n<p>Can someone please possibly inform me what the error might be based on the below info???</p>\n\n<blockquote>\n  <p>The data reader is incompatible with the specified\n  'VisionModel.sSRPTFundexDocCodes1_Test_Result'. A member of the type,\n  'NumEmployeesatApp1', does not have a corresponding column in the data\n  reader with the same name.</p>\n</blockquote>\n\n<p>When I debug the below code snippet, right after that is when I get the above error.</p>\n\n<pre><code>return ((IObjectContextAdapter)this).ObjectContext.ExecuteFunction&lt;sSRPTFundexDocCodes1_Test_Result&gt;(\"sSRPTFundexDocCodes1_Test\", subscriberIDParameter, applicationNumParameter);\n</code></pre>\n\n<p>The parameters going into the stored procedure are OK.</p>\n\n<p>The mapping is just fine. On the left hand side of the mapping is: <code>NumEmployeesatApp</code> and the right hand side is exactly the same. </p>\n\n<p>I completely deleted my EDMX file and created it from scratch with the same error occurring. \nWhen I do a \"Get column info\" from the function, the column name comes out to what is exactly in the above stored procedure. </p>\n\n<p>The template that is generated off of the EDMX file (Vision) and the stored procedure above have the columns matching exactly.</p>\n\n<p>btw, I'm able to run other <code>INSERT</code> &amp; <code>SELECT</code> LINQ queries off of the EF 5 model I have with no problem.</p>\n"},{"tags":["asp.net","entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12714875,"title":"Entity Framework: Mapping Existing Tables w/ no Referential Integrity","body":"<p>In this scenario, I have an existing database with three models:</p>\n\n<p><code>Address</code>, which has a 'AddressId', 'ParentId', 'City', 'State', etc</p>\n\n<p><code>Person</code>, which has a 'PersonId', 'Name', etc.</p>\n\n<p><code>Company</code>, which has a 'CompanyId', 'Name', etc.</p>\n\n<p>Because <code>Address</code> can contain rows for more models than just one table, there's no foreign key; the <code>Address</code> column 'ParentId' would contain either a 'PersonId' or 'CompanyId'.</p>\n\n<p>To generate my <code>DbContext</code>, I used Entity Framework Power Tools Beta 2.  Due to the lack of referential integrity, the classes it generated for <code>Person</code> and <code>Company</code> do not contain a collection of addresses like they should.</p>\n\n<p>How would I go about altering those classes to add in this \"Addresses\" property, and ensure it's mapped to the Address table correctly?</p>\n\n<p>At the moment I'm doing something like this; I'd rather have the context map it if possible:</p>\n\n<pre><code>public IEnumerable&lt;Address&gt; Addresses\n{\n   get \n   {\n       IEnumerable&lt;Address&gt; addresses = null;\n       using(MyDb db = new MyDb())\n       {\n            addresses = db.Addresses.Where(a =&gt; a.ParentId == this.PersonId)\n       }\n\n       return addresses;\n   }\n}\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["c#","oracle","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":106,"score":2,"question_id":12697686,"title":"Linq-to-Entity get primary key back on insert into Oracle","body":"<p>I'm a noob w/ Linq-to-Entity. These are my database tables.</p>\n\n<pre><code>create table Jobs \n( ID            NUMBER PRIMARY KEY,\n  ....\n)\n\ncreate table Responsibilities\n( ID            NUMBER PRIMARY KEY,\n  JobID         NUMBER\n  ....\n)\n</code></pre>\n\n<p>The JobID column is a foreign key that references Jobs(ID).</p>\n\n<p>Using these tables, in Visual Studio I automatically create the classes that allow me to interface to those tables. I then try to create Jobs and insert them into the database. I have triggers on every table to generate a unique ID for each table for the primary key. Below is a snippet of code that creates a Job. </p>\n\n<pre><code>using (Workflow.WorkflowEntities entity = new Workflow.WorkflowEntities(connectionString))\n{\n    JOBS j = new JOBS();\n    entity.AddToJOBS(j);\n    entity.SaveChanges();\n</code></pre>\n\n<p>A problem that I'm having, is that when the Job is saved, I don't get a primary key back for it. This is especially a problem when I want to create Responsibilities objects and add them to the Job and then save everything en masse. Its like it doesn't populate the JobID field correctly in the Responsibilities object. </p>\n\n<p>What is the correct way to do this? Any pointers are greatly appreciated,</p>\n\n<p>mj</p>\n"},{"tags":["silverlight","entity-framework","wcf-ria-services"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":787,"score":1,"question_id":6632246,"title":"An entity with the same identity already exists in this EntitySet","body":"<p>I'm trying to peform an update statement using WCF RIA Services, but everytime I update I keep getting \"An entity with the same identity already exists in this EntitySet. Any insight on where I can start looking or figuring out what is wrong?</p>\n\n<p>Step 1 </p>\n\n<pre><code>LoadOperation&lt;Analysis&gt; AnalysisLP = ((App)Application.Current)._context.\n                Load(((App)Application.Current)._context.GetAnalysisQuery().\n                Where(o =&gt; o.ProjectID == Convert.ToInt32(((App)Application.Current).Project.ProjectID)));\n</code></pre>\n\n<p>Step 2  </p>\n\n<pre><code> AnalysisLP.Completed += delegate\n            {\n                if (!AnalysisLP.HasError)\n                {\n                    Analysis = AnalysisLP.Entities.FirstOrDefault();\n};\n</code></pre>\n\n<p>Step 3</p>\n\n<pre><code>         ((App)Application.Current)._context.Analysis.Attach(Analysis);\n         ((App)Application.Current)._context.SubmitChanges(OnSubmitCompleted, null);\n</code></pre>\n\n<p>Can anyone help me, what is it i'm doing wrong??\nthanks</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":166,"score":0,"question_id":12095436,"title":"Mapping EF Code First to an Existing Database","body":"<p>First let me apologize for the lengthy post.  I figured giving more details would help you understand the situation.</p>\n\n<p>Im trying to develop the data layer of my application using EF 5 Code First and mapping everything to an existing database.  Im wanting to use DbContext, POCOs, fluent table mappings, etc., but our existing database (the tables) isnt straight-forward.  So, Im having trouble with a few things.  Ill try to briefly describe the situation now, then ask a couple questions later.</p>\n\n<p>Tables</p>\n\n<pre><code>AlarmDefinition\nAlarmDefinitionID int (primary key) (is identity)\n...\n\nAlarm\nAlarmID int (primary key) (is identity)\nAlarmDefinitionID int (sort of a foreign key) (is nullable)\nSampleTagID int (is nullable)\nSampleTime DateTime (is nullable)\n...\n\nReasonAction\nTime DateTime (primary key)\nTagID int (primary key)\nReasonActionID int (primary key)\n\nReasonActionDefinition\nReasonActionID int (primary key) (is identity)\n...\n</code></pre>\n\n<p>So, one AlarmDefinition can have many Alarms.  And, one ReasonActionDefinition can have many ReasonActions.  There is an implicit relationship between Alarm and ReasonAction (i.e., one Alarm can have many ReasonActions).  This is where Im having the most troubles.</p>\n\n<p>POCOs</p>\n\n<pre><code>AlarmDefinition\npublic class AlarmDefinition\n{\n    public int AlarmDefinitionID { get; set; }\n    ...\n    public virtual ICollection&lt;Alarm&gt; Alarms { get; set; }\n}\n\nAlarm\npublic class Alarm\n{\n    public int AlarmID { get; set; }\n    public Nullable&lt;int&gt; SampleTagID { get; set; }\n    public Nullable&lt;System.DateTime&gt; SampleTime { get; set; }\n    ...\n    public Nullable&lt;int&gt; AlarmDefinitionID { get; set; }\n    public virtual AlarmDefinition AlarmDefinition { get; set; }\n    // I dont know if this is set up correctly\n    public virtual ICollection&lt;ReasonAction&gt; ReasonActions { get; set; }\n}\n\nReasonAction\npublic class ReasonAction\n{\n    public System.DateTime Time { get; set; }\n    public int TagID { get; set; }\n    public virtual Alarm Alarm { get; set; }\n    public int ReasonActionID { get; set; }  // Primary key\n    public virtual ReasonActionDefinition ReasonActionDefinition { get; set; }\n}\n\nReasonActionDefinition\npublic class ReasonActionDefinition\n{\n    public int ReasonActionID { get; set; }\n    ...\n    public virtual ICollection&lt;ReasonAction&gt; ReasonActions { get; set; }\n}\n</code></pre>\n\n<p>DbContext</p>\n\n<pre><code>public class AppDbContext : DbContext\n{\n    public DbSet&lt;Alarm&gt; Alarms { get; set; }\n    public DbSet&lt;AlarmDefinition&gt; AlarmDefinitions { get; set; }\n    public DbSet&lt;ReasonAction&gt; ReasonActions { get; set; }\n    public DbSet&lt;ReasonActionDefinition&gt; ReasonActionDefinitions { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new AlarmMap());\n        modelBuilder.Configurations.Add(new AlarmDefinitionMap());\n        modelBuilder.Configurations.Add(new ReasonActionMap());\n        modelBuilder.Configurations.Add(new ReasonActionDefinitionMap());\n    }\n}\n</code></pre>\n\n<p>Fluent Mappings</p>\n\n<pre><code>AlarmDefinitionMap\npublic class AlarmDefinitionMap : EntityTypeConfiguration&lt;AlarmDefinition&gt;\n{\n    public AlarmDefinitionMap()\n    {\n        this.HasKey(t =&gt; t.AlarmDefinitionID);\n        ...\n        this.ToTable(\"AlarmDefinition\");\n        this.Property(t =&gt; t.AlarmDefinitionID).HasColumnName(\"AlarmDefinitionID\");\n        ...\n    }\n}\n\nAlarmMap\npublic class AlarmMap : EntityTypeConfiguration&lt;Alarm&gt;\n{\n    public AlarmMap()\n    {\n        this.HasKey(t =&gt; t.AlarmID);\n        ...\n        this.ToTable(\"Alarm\");\n        this.Property(t =&gt; t.AlarmID).HasColumnName(\"AlarmID\");\n        this.Property(t =&gt; t.AlarmDefinitionID).HasColumnName(\"AlarmDefinitionID\");\n        this.Property(t =&gt; t.SampleTagID).HasColumnName(\"SampleTagID\");\n        this.Property(t =&gt; t.SampleTime).HasColumnName(\"SampleTime\");\n        ...\n        this.HasOptional(t =&gt; t.AlarmDefinition)\n            .WithMany(d =&gt; d.Alarms)\n            .HasForeignKey(t =&gt; t.AlarmDefinitionID);\n    }\n}\n\nReasonActionMap\npublic class ReasonActionMap : EntityTypeConfiguration&lt;ReasonAction&gt;\n{\n    public ReasonActionMap()\n    {\n        this.HasKey(t =&gt; new { t.Time, t.TagID, t.ReasonActionID });\n        this.Property(t =&gt; t.TagID).HasDatabaseGeneratedOption(DatabaseGeneratedOption.None);\n        this.Property(t =&gt; t.ReasonActionID).HasDatabaseGeneratedOption(DatabaseGeneratedOption.None);\n        this.ToTable(\"ReasonAction\");\n        this.Property(t =&gt; t.Time).HasColumnName(\"Time\");\n        this.Property(t =&gt; t.TagID).HasColumnName(\"TagID\");\n        this.Property(t =&gt; t.ReasonActionID).HasColumnName(\"ReasonActionID\");\n        // Relationships\n        // Not sure if this is correct since the related column names in the Alarm table are SampleTagId, not TagID and SampleTime, not Time.  And SampleTagID and SampleTime in the Alarm table are not a primary keys.\n        // There's an implicit one-to-many relationship between the Alarm and ReasonAction entities.\n        this.HasRequired(t =&gt; t.Alarm)\n            .WithMany(d =&gt; d.ReasonActions)\n            .HasForeignKey(t =&gt; new { t.TagID, t.Time });\n        this.HasRequired(t =&gt; t.ReasonActionDefinition)\n            .WithMany(d =&gt; d.ReasonActions)\n            .HasForeignKey(t =&gt; t.ReasonActionID);\n    }\n}\n\nReasonActionDefinitionMap\npublic class ReasonActionDefinitionMap : EntityTypeConfiguration&lt;ReasonActionDefinition&gt;\n{\n    public ReasonActionDefinitionMap()\n    {\n        this.HasKey(t =&gt; t.ReasonActionID);\n        ...\n        this.ToTable(\"ReasonActionDefinition\");\n        this.Property(t =&gt; t.ReasonActionID).HasColumnName(\"ReasonActionID\");\n        ...\n    }\n}\n</code></pre>\n\n<p>Whew!  That was a lot of stuff.  Anyway, here are some issues with our database and mapping things to EF: 1.  No declarative referential integrity  all handled in triggers or legacy application code, 2.  In the Alarm table, SampleTagID and SampleTime are not primary keys, yet these two columns are the one-side for an implicit one-to-many relation with the ReasonAction table, 3.  Column names between the Alarms and ReasonAction tables do not match (SampleTagID and SampleTime for the Alarm table and Time and TagID for the ReasonAction table).</p>\n\n<p>So, my questions are: A.  Given the situation described above, can I make EF code first work with my existing database and tables?, B.  How do I need to change my code to make the one-to-many relationship work between the Alarm and ReasonAction tables (so that when I query for Alarms the ReasonActions navigation property is populated with all related records)?, C.  Any other suggestions?</p>\n\n<p>Thanks!!!</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":162,"score":0,"question_id":12691117,"title":"EF5: Multiple result sets from stored procedure","body":"<p>I followed <a href=\"http://milesquaretech.com/Blog/post/2012/03/19/Entity-Framework-5-%E2%80%93-Multiple-Entity-Typed-Result-Sets-from-a-Stored-Procedure.aspx\" rel=\"nofollow\">this</a> article to retrieve multiple entity sets from a stored procedure.</p>\n\n<p>I have altered the column mappings of my entities so they pass through Resharper.\nDo I have to rewrite the column mappings in the result mapping?</p>\n\n<p>For example I have the following EntitySetMapping:</p>\n\n<pre><code>      &lt;EntitySetMapping Name=\"IrmaObjectConfiguraties\"&gt;\n        &lt;EntityTypeMapping TypeName=\"IrmaModel.IrmaObjectConfiguratie\"&gt;\n          &lt;MappingFragment StoreEntitySet=\"IrmaObjectConfiguratie\"&gt;\n            &lt;ScalarProperty Name=\"Gid\" ColumnName=\"GID\" /&gt;\n            &lt;ScalarProperty Name=\"IrmaObjectGid\" ColumnName=\"IrmaObject_GID\" /&gt;\n            &lt;ScalarProperty Name=\"IrmaConfiguratieGid\" ColumnName=\"IrmaConfiguratie_GID\" /&gt;\n          &lt;/MappingFragment&gt;\n        &lt;/EntityTypeMapping&gt;\n      &lt;/EntitySetMapping&gt;\n</code></pre>\n\n<p>This entity is returned bij as part of the stored proc result sets:</p>\n\n<pre><code>        &lt;ResultMapping&gt;\n          &lt;EntityTypeMapping TypeName=\"IrmaModel.IrmaObjectConfiguratie\"&gt;\n            &lt;!--ScalarProperty Name=\"Gid\" ColumnName=\"Gid\" /&gt;\n            &lt;ScalarProperty Name=\"IrmaObjectGid\" ColumnName=\"IrmaObject_Gid\" /&gt;\n            &lt;ScalarProperty Name=\"IrmaConfiguratieGid\" ColumnName=\"IrmaConfiguratie_Gid\" /--&gt;\n          &lt;/EntityTypeMapping&gt;\n        &lt;/ResultMapping&gt;\n</code></pre>\n\n<p>When I remove the remarks the execution of the imported function goes ok, but when there is no column mapping I retrieve the following error:</p>\n\n<blockquote>\n  <p><em>The data reader is incompatible with the specified\n  'IrmaModel.IrmaObjectConfiguratie'. A member of the type,\n  'IrmaObjectGid', does not have a corresponding column in the data\n  reader with the same name.</em></p>\n</blockquote>\n\n<p>As a workaround I could define all column mappings again, but is is also possible to use the column mappings that are defined in the <code>EntitySetMapping</code>?</p>\n"},{"tags":["entity-framework","entity-framework-4","ef-code-first","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":619,"score":5,"question_id":8052105,"title":"add-migration does not function with remote sql server databases in shared hosting","body":"<p>It looks like CodeFirst stops doing its homework when it doesn't have full control of the database (I suppose).\nThe scenario is a web site hosted on Arvixe.com (or I suppose any other shared hosting server), where I have to create databases only from their control panel (and NOT with Sql Server Management Studio, just to say...).\nOnce created an empty database, I register a connection in the web site, and I use it to generate database from poco objects like in:</p>\n\n<p>add-migration m1 -targetdatabase myconnection</p>\n\n<p>This generates correctly my FIRST migration, that I can apply without problems with</p>\n\n<p>update-database -targetdatabase myconnection</p>\n\n<p>The first concern, not too important, is that since the database is existing, it will NOT issue the Seed command, so I have to insert my first records by hand, but this is not a great problem.</p>\n\n<p>Then I change my poco objects, and I need to update the database, but when I issue ANOTHER</p>\n\n<p>add-migration m2 -targetdatabase myconnection</p>\n\n<p>it gives the error:</p>\n\n<p>System.Data.Entity.Migrations.MigrationsPendingException: Unable to generate an explicit migration because the following explicit migrations are pending: [201111081426466_m1]. Apply the pending explicit migrations before attempting to generate a new explicit migration.</p>\n\n<p>This is really strange, since if I look at the database, I can see even the table __MigrationHistory, but then it looks like it cannot recognize it...</p>\n\n<p>Anyone with the same problem, or some good tip to where investigate?\nThanks in advance,\nAndrea Bioli</p>\n"},{"tags":["c#","asp.net","asp.net-mvc","linq","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":104,"score":1,"question_id":12710757,"title":"How can I run this function inside LINQ query","body":"<p>I have function that will generate breadcrumbs format for my category e.g. <code>Root-&gt;Children</code>. It works because when I use it in my view it does work and doing its job. However I cannot cast it inside LINQ query.</p>\n\n<p>Can someone explain how can I cast this particular function inside LINQ query? I've tried getting data and then setting it in <code>foreach</code> loop but it said that property is read only.</p>\n\n<p>Function is <code>Infrastructure.CategoryHelpers.Breadcrumbs({id})</code> it will return <code>string</code>.</p>\n\n<h2>Calling function</h2>\n\n<pre><code>public dynamic List()\n{\n    var categories = _db.Categories.Select(x =&gt; new {\n        ID = x.ID,\n        Breadcrumbs = Infrastructure.CategoryHelpers.Breadcrumbs(x.ID, -1, \"\"), // this method cannot be translated into a store expression\n        Name = x.Name,\n        ItemCount = x.Items.Count\n    });\n\n    foreach (var c in categories)\n    {\n        // c.Breadcrumbs = Infrastructure.CategoryHelpers.Breadcrumbs(c.ID); // Value is read only\n    }\n\n    return Json(categories, JsonRequestBehavior.AllowGet);\n}\n</code></pre>\n\n<h2>Error</h2>\n\n<blockquote>\n  <p>LINQ to Entities does not recognize the method 'System.String\n  Breadcrumbs(Int32, Int32, System.String)' method, and this method\n  cannot be translated into a store expression.</p>\n</blockquote>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":9,"down_vote_count":0,"view_count":108,"score":9,"question_id":12710204,"title":"Entity Framework 5 performing full table scan","body":"<p>I have the following code:</p>\n\n<pre><code>public List&lt;anEntity&gt; Get(int page, int pagesize, Func&lt;anEntity, IComparable&gt; orderby)\n{            \n    using (var ctx = new MyContext())\n    {                \n        return ctx.anEntity.OrderBy(orderby).Skip(pagesize * page).Take(pagesize).ToList();                    \n    }           \n}\n</code></pre>\n\n<p>When I check my database profile (SqlServer 2012) I can see an horrible full table scan without any \"TOP\" clause.</p>\n\n<p>The interesting part:</p>\n\n<p>If I do something similar but specifying a concrete orderby:</p>\n\n<pre><code>return ctx.anEntity.OrderBy(x =&gt; x.aField).Skip(pagesize * page).Take(pagesize).ToList();\n</code></pre>\n\n<p>The profile shows a beautiful \"TOP\" clause.</p>\n\n<p>I would like to avoid having lot's of methods, one for each \"orderby\" possibility. Any hint would be very appreciated.</p>\n"},{"tags":["linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12486191,"title":"complex EF graph linq join","body":"<p><img src=\"http://i.stack.imgur.com/Ai0Qc.png\" alt=\"entity model\"></p>\n\n<p>So, that's my model .. nice and complex.</p>\n\n<p><strong>I'm looking to get Areas by a UserID.</strong> If I were doing this in SQL, I would do a bunch of joins all the way up to the Users table. How would you do this in LINQ query syntax or method chaining?</p>\n\n<p>I can do this pretty straightforward from the other way around, but then I have to do a lot of extra work to flatten the resulting graph and it also requires pulling back all the entities in between.</p>\n\n<p>If I can optionally include AreasPermissions &amp; Permissions, that would be gravy .. but at this point I wouldn't mind an additional query to fetch those.</p>\n\n<p>Another option I was floating was using a function import to a sproc and map that to an Area .. but when I start needing to include other entities it makes that option less elegant. I'm also trying to avoid using sprocs <em>just to use sprocs</em> because it's always a slippery slope with folks .. 'use a sproc for one thing' tends to mold into 'don't use EF (table access) for anything'. </p>\n\n<pre><code>var userByID = new Func&lt;User, bool&gt;(x =&gt; x.UserId.Equals(userID, StringComparison.InvariantCultureIgnoreCase));\nvar user = this._context.Users\n    .Include(\"TeamsUsers.Team.TeamsRoles.Role.RolesAreasPermissions.AreaPermission.Area\")\n    .Include(\"TeamsUsers.Team.TeamsRoles.Role.RolesAreasPermissions.AreaPermission.Permission\")\n    .Single(userByID);\n</code></pre>\n"},{"tags":["entity-framework","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":11952951,"title":"end-to-end RIA-like client/server patterns? non-Entity Framework contexts?","body":"<p>I have posted this same question in the msdn forums, but nothing yet .. \n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/60cf36d1-c11a-4d8a-9446-f1d299db1222\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/60cf36d1-c11a-4d8a-9446-f1d299db1222</a></p>\n\n<p>I'm working on a project that is an MVC app that will be sourced data via a WCF service that may or may not be getting data via EF, but will definitely be using Stored Procedures..</p>\n\n<p>The MVC app will maintain state in the session, and the entity-tracking portion of this state would preferably function much like the RIA Services DomainContext. Whether or not this context encapsulates saves and changesets is not really all that important, but how entities are loaded into the context and relate to one another (navigation properties) are.</p>\n\n<p>Question 1: Is there such a pattern/solution in existence?</p>\n\n<p>Question 2: Should the MVC and WCF layers share the same DTOs/Entities via a class library? (thereby maintaining state-awareness, navigation properties, etc on both ends of the pipe?)</p>\n\n<p>Question 3: Does using WCF Data Services help solve these problems?</p>\n\n<p>Question 4: Is this all misguided and is there a better approach?</p>\n"},{"tags":["wcf","linq","entity-framework","linq-to-entities","ria"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12710701,"title":"LINQPAD Queries not working when running","body":"<p>We are building a wcf ria services application (linq to entity framework)</p>\n\n<p>We used LinqPad to build our linq queries, and they do work inside linqpad, however when running the project they do not work, as if the current user (who is logged in) doesn't exist.</p>\n\n<p>Can anyone help us out?</p>\n\n<pre><code>String userName = WebContext.Current.User.Name;\n\nIEnumerable&lt;aspnet_Users&gt; userList = ctx.aspnet_Users\n              .Where(p =&gt; p.UserName == userName);\nif (userList.Count() &gt; 0)\n{                   \n    aspnet_Users user = userList.First();\n</code></pre>\n"},{"tags":["asp.net","entity-framework",".net-3.5"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":5497,"score":4,"question_id":979664,"title":"Entity Framework error - \"The EntityContainer name must be unique\"","body":"<p>We have a solution which consists of two projects - a console application project and a web application project. Each of these has an identical in schema, but differently named .edmx file used to access the same database.</p>\n\n<p>The console application runs as a scheduled task on the same server as the web application is hosted. The web application contains a reference to the console application as certain actions within the web application lead to methods in the console application being called. \nThis combination has been running in our staging environment successfully for many months. </p>\n\n<p>When released live we are seeing the following error message at least once a day:</p>\n\n<p>Schema specified is not valid. Errors:</p>\n\n<blockquote>\n  <p>ProjectName.csdl(3,4) : error 0019: The EntityContainer name must be\n  unique. An EntityContainer with the name 'ProjectEntities' is already\n  defined. ProjectName.csdl(63,4) : error 0019: Each type name in a\n  schema must be unique. Type name 'ProjectModel.DataSource' was already\n  defined. ProjectName.csdl(75,4) : error 0019: Each type name in a\n  schema must be unique. Type name 'ProjectModel.Error' was already\n  defined.</p>\n</blockquote>\n\n<p>This continues, listing all the type names in our schema.</p>\n\n<p>This error can be fixed by recycling the application pool or restarting IIS. </p>\n\n<p>Please note that the error does not occur until the web application has been running for a while - it is not occuring when we compile or the first time we access the application.</p>\n\n<p>My initial theory was that the two Entity Containers are conflicting with each other because the web application references the console application, but they have different names, which makes the error \"The EntityContainer name must be unique. An EntityContainer with the name 'ProjectEntities' is already defined\" confusing.</p>\n"},{"tags":["entity-framework",".net-4.0","ef-code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12697984,"title":"How to modify this Entity framework code first code?","body":"<p>I am brand new to Entity Framework code first, so any help or direction would be much appreciated.</p>\n\n<p>I currently have the following classes:</p>\n\n<pre><code>public partial class Customer\n{\n    public int Id { get; set; }\n    private ICollection&lt;Address&gt; _addresses;\n}\n\npublic partial class Address\n{\n    public int Id { get; set; }\n    public string Street { get; set; };\n    public string City { get; set; };\n    public string Zip { get; set; };\n}\n</code></pre>\n\n<p>and the following</p>\n\n<pre><code>public partial class CustomerMap : EntityTypeConfiguration&lt;Customer&gt;\n{\n    public CustomerMap()\n    {\n        this.ToTable(\"Customer\");\n        this.HasKey(c =&gt; c.Id);\n\n        this.HasMany&lt;Address&gt;(c =&gt; c.Addresses)\n            .WithMany()\n            .Map(m =&gt; m.ToTable(\"CustomerAddresses\"));\n    }\n}\n</code></pre>\n\n<p>This works as I would expect, and creates a Customer, Address and CustomerAddresses table for the mapping. Now for my question.. what would I do if I needed to modify the code to produce the following...</p>\n\n<p>I want to add a CompanyCode attribute to the \"CustomerAddresses\" table... and then instead of constructing a collection of addresses.. i want to be able to construct a hashtable, where the key is the CompanyCode, and the value is the collection of addresses.</p>\n\n<p>So if I had the following:</p>\n\n<pre><code>Customer\nID     C1\n\nAddress\nID     A1\nID     A2\n\nCustomerAddresses\nCustomerID      C1\nAddressID     A1\nCompanyCode    ABC\n\nCustomerID      C1\nAddressID     A2\nCompanyCode    ABC\n\nCustomerID      C1\nAddressID     A2\nCompanyCode    XYZ\n</code></pre>\n\n<p>so then, Customer.Addresses[\"ABC\"] would return a collection of addresses with ID, A1 and A2. Whereas Customer.Addresses[\"XYZ\"] would return a collection of addresses with ID A2.</p>\n\n<p>Any direction/help would be much appreciated... thanks.</p>\n"},{"tags":["c#","entity-framework","edmx"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12708765,"title":"C# Entity Framework database-first EDMX no relations present","body":"<p>I am using Entity Framework to work against a database using the database-first approach, with an EDMX file representing my database. A problem happened when I changed one property in the database, then when I erased it from the EDMX file and updated it to add it again, it shows up now without the relations to the other tables (Pk-Fk relations).</p>\n\n<p>More Info: \n1. tried connecting from another new project and same result.\n2. tried re-creating the database and re creating the pk-fk relation, and same result.\n3. tried connecting to another database with edmx, and in this case the relations were present. \n4. in the sql management studio it looks like the relations are present in the tables, as well as in the diagram.</p>\n\n<p>Does anyone knows what is the problem?</p>\n"},{"tags":["entity-framework","entity-framework-4","relation"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":12709253,"title":"error in making relationship between aspnet_users table and any custom table","body":"<p>I moved membershiptables to my database by using aspnet_regsql.exe. Then I created a table named \"Article\" and needed to save the user id of the article`s author in \"Article\" table. So I added a column with name \"Author\" and type uniqueidentifier in \"Article\" table and then created a relation between two tables. \nNow I use Entity Framework so I created a edmx file. but when I want to retrieve any data from db there are errors like this : </p>\n\n<blockquote>\n  <p>Schema specified is not valid. \n  Errors:The relationship 'db.FK__aspnet_Us_<em>Appli</em>_173876EA' was not loaded because the type 'db.aspnet_Users' is not available.\n  The following information may be useful in resolving the previous error:\n  The required property 'Articles' does not exist on the type 'aspnet_Users'.</p>\n</blockquote>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12708638,"title":"SUSER_SID() SQL Default Column with Entity Framework Insert Data not working","body":"<p>Issue is with default SQL value <code>suser_sid()</code> </p>\n\n<p>I checked the possibility <code>StoreGeneratedPattern</code> is <code>Identity</code> and I tried to add this <code>suser_sid()</code> in entity model from designer but it creates an error msgs..</p>\n\n<p>In xml of this model property is describe like...</p>\n\n<pre><code>&lt;Property Name=\"TenantID\" Type=\"varbinary(max)\" StoreGeneratedPattern=\"Identity\" /&gt; \n</code></pre>\n\n<p>So, can you tell me what amendment we should do to resolved this? </p>\n\n<p>Really really thanks if you can provide the resolution..</p>\n"},{"tags":["visual-studio-2010","entity-framework","poco"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":466,"score":0,"question_id":8670748,"title":"Entity Framework - cannot generate database from my EDMX because new entities are not in database?","body":"<p>Having got a chunk of my application working with Entity Framework 4.1, I needed to add a couple more tables. I created the entities and associations in the Model Viewer and then ask it to generate the database from the model.</p>\n\n<p>Immediately I get a selection of validation errors and a pop-up informs me that I must clear all validation errors before I can generate the database.</p>\n\n<p>The errors in question are all along the lines of:</p>\n\n<blockquote>\n  <p>Error 11007: Entity type 'EntityName' is not mapped.</p>\n</blockquote>\n\n<p>Or</p>\n\n<blockquote>\n  <p>Error 11008: Association 'AssociationName' is not mapped.</p>\n</blockquote>\n\n<p>I get this error once for each new Entity and Association I have created. </p>\n\n<p>Now I get that they are not mapped to the database yet, this seems quite logical as they are totally new to the model. That is why I'm trying to use the \"Generate Database From Model\" tools to generate the database. </p>\n\n<p>Am I understanding correctly that I cannot generate a new database from the model because the new Entities and Associations I have added to the Model are not already in the database? If so, how do I work around this?</p>\n"},{"tags":["c#","sql","linq","entity-framework","lambda-functions"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":11995228,"title":"How to write an linq statement to get the last of a group of records","body":"<p>I have 2 SQL statements that basically do the same thing, that is, retrieve the last record from a table based on a datetime field for a group of records.  I am using the data-first Entity Framework model.  How would I write either of these SQL statements using LINQ Lambda functions?</p>\n\n<p>ie,</p>\n\n<pre><code>var u = db.AccessCodeUsage.Where(...).GroupBy(...)\n</code></pre>\n\n<p>rather than </p>\n\n<pre><code>var u = from a in db.AccessCodeUsage\n        where ...\n        group by ...\n</code></pre>\n\n<p>SQL Statements:</p>\n\n<pre><code>SELECT  *\nFROM    AccessCodeUsage a  \nWHERE   NOT EXISTS (SELECT  1 \n                    FROM    AccessCodeUsage \n                    WHERE   LocationId = a.LocationId\n                    AND     Timestamp &gt; a.Timestamp)\n\nSELECT    a.*\nFROM    AccessCodeUsage a\nWHERE   a.Timestamp = \n        (SELECT MAX(Timestamp)\n        FROM    AccessCodeUsage\n        WHERE   a.LocationId = LocationId\n        AND     a.AccessCode = AccessCode\n        GROUP   By LocationId, AccessCode)\n</code></pre>\n"},{"tags":[".net","sql-server-2008","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":12707375,"title":"Stored procedure is slow in Entity Framework","body":"<p>I am calling a stored procedure (that returns data) from Entity Framework using the query below</p>\n\n<pre><code>from sp in db.GetSale(bID, SID,m,y).Where(x =&gt; x.isActive == true)\nselect sp\n</code></pre>\n\n<p>If I run this procedure directly, it takes only 2 seconds, but when I call this stored procedure through EF, it is taking 10 to 15 seconds. </p>\n\n<p>Any guidance to improve the situation? I have seen other post here on SO but have no success</p>\n\n<p>Edit</p>\n\n<p>Here is sqlplan for my procedure\n<a href=\"https://skydrive.live.com/redir?resid=87DCBD5D3E9AAA57!374\" rel=\"nofollow\">https://skydrive.live.com/redir?resid=87DCBD5D3E9AAA57!374</a></p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first","asp.net-mvc-4","roleprovider"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12677975,"title":"What could cause many data access exceptions using EF code first in a custom RoleProvider?","body":"<p>My role provider looks like the class below (abridged). I am running on IIS Express, and SQL 2012 Express, from VS 2012, and I get a multitude of seemingly random exceptions in this role provider code.</p>\n\n<pre><code>public class Educ8RoleProvider : RoleProvider\n{\n    private readonly Educ8DbContext _dbContext = new Educ8DbContext();\n    private readonly Authorization _authorization;\n    public Educ8RoleProvider()\n    {\n        _authorization = new Authorization(_dbContext);\n    }\n    public override void Initialize(string name, System.Collections.Specialized.NameValueCollection config)\n    {\n        try\n        {\n            base.Initialize(name, config);\n        }\n        catch (Exception ex)\n        {\n            ErrorSignal.FromCurrentContext().Raise(ex);\n            throw;\n        }\n    }\n    public override bool IsUserInRole(string username, string roleName)\n    {\n        return GetRolesForUser(username).Any(r =&gt; r.ToLower() == roleName);\n    }\n    public override string[] GetRolesForUser(string username)\n    {\n        return _authorization.GetRolesForMember(username).Select(r =&gt; r.Name).ToArray();\n    }\n}\n</code></pre>\n\n<p>Here is a sample of my <code>Authorization</code> class:</p>\n\n<pre><code>public class Authorization\n{\n    private readonly Educ8DbContext _dbContext;\n    private readonly IMemberRepository _memberRepository;\n    private readonly IRoleRepository _roleRepository;\n    private readonly IMemberRoleRepository _memberRoleRepository;\n    public Authorization(Educ8DbContext context)\n    {\n        _dbContext = context;\n        _memberRepository = new MemberRepository(_dbContext);\n        _roleRepository = new RoleRepository(_dbContext);\n        _memberRoleRepository = new MemberRoleRepository(_dbContext);\n    }\n    public IQueryable&lt;Role&gt; GetRoles()\n    {\n        return _roleRepository.ListAll();\n    }\n    public IQueryable&lt;Role&gt; GetRolesForMember(int memberId)\n    {\n        var roleIds = _memberRoleRepository.ListAll()\n            .Where(mr =&gt; mr.MemberId == memberId)\n            .Select(mr =&gt; mr.RoleId);\n        return _roleRepository.ListAll()\n            .Where(r =&gt; roleIds.Contains(r.Id));\n    }\n}\n</code></pre>\n\n<p>I get about two to three of the following exceptions every hour. Restarting the project immediately solves the problem, until the next one.</p>\n\n<ul>\n<li>Not allowed to change the 'ConnectionString' property. The\nconnection's current state is closed.</li>\n<li>The context cannot be used while the model is being created.</li>\n<li>The underlying provider failed on Open.</li>\n</ul>\n\n<p>It may be worth noting that I have absolutely zero data access issues anywhere else in the project.</p>\n\n<p>Any suggestions on what may be causing this would be most welcome.</p>\n"},{"tags":["c#","vb.net","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12707712,"title":"Convert C# linq code to VB. [ Edited ]","body":"<p>I want to port some of my EntityFramework C# code into VB.NET. I'm trying different online code convertor but they can't solve this problem for me.</p>\n\n<p>I have these two functions.</p>\n\n<pre><code>public List&lt;T&gt; Find&lt;T&gt;(Func&lt;T, bool&gt; predicate) where T : class\n    {\n        var objectSet = db.CreateObjectSet&lt;T&gt;();\n        return objectSet.Where&lt;T&gt;(predicate).ToList();\n    }\n\n    public void Delete&lt;T&gt;(Func&lt;T, bool&gt; predicate) where T : class\n    {\n        var objectSet = db.CreateObjectSet&lt;T&gt;();\n        IEnumerable&lt;T&gt; records = from x in objectSet.Where&lt;T&gt;(predicate) select x;\n\n        foreach (T record in records)\n        {\n            objectSet.DeleteObject(record);\n        }\n    }\n</code></pre>\n\n<p>Now convertors tell me this:</p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>Public Function Find(Of T As Class)(predicate As Func(Of T, Boolean)) As List(Of T)\n    Dim objectSet = db.CreateObjectSet(Of T)()\n    Return objectSet.Where(Of T)(predicate).ToList()\nEnd Function\n\nPublic Sub Delete(Of T As Class)(predicate As Func(Of T, Boolean))\n    Dim objectSet = db.CreateObjectSet(Of T)()\n    Dim records As IEnumerable(Of T) = From x In objectSet.Where(Of T)(predicate) Select x\n\n    For Each record As T In records\n        objectSet.DeleteObject(record)\n    Next\nEnd Sub\n</code></pre>\n\n<p>But I get two errors, both for <code>objectSet.Where&lt;T&gt;(predicate)</code> which is:</p>\n\n<blockquote>\n  <p>Overload resolution failed because no accessible 'Where' accepts this number of type arguments.</p>\n</blockquote>\n"},{"tags":["c#","asp.net","sql","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":78,"score":4,"question_id":12635563,"title":"How to handle exception from specific database error","body":"<p>I am trying to create a transaction like so:</p>\n\n<pre><code>using (TransactionScope scope = new TransactionScope(TransactionScopeOption.Required,\n      options))\n{\n    try\n    {\n        dbContext.MyTable.PartnerId = someGuid;\n        dbContext.SaveChanges();\n        scope.Complete();\n        dbContext.AcceptAllChanges()\n    }\n    catch (Exception ex)\n    {\n        log.LogMessageToFile(\"Exception - ExceptionType: \" + \n        ex.GetType().ToString() + \"Exception Messsage: \" + ex.Message);              \n    }\n}\n</code></pre>\n\n<p>I know if I try to insert an item manully in sql with a duplicate in a specific column, I get the following error from sql:</p>\n\n<blockquote>\n  <p>Cannot insert duplicate key row in object 'dbo.MyTable' with unique index 'idx_PartnerId_notnull'. The duplicate key value is (7b072640-ca81-4513-a425-02bb3394dfad).</p>\n</blockquote>\n\n<p>How can I programatically catch this exception specifically, so I can act upon it.</p>\n\n<p>This is the constraint I put on my column:</p>\n\n<pre><code>CREATE UNIQUE NONCLUSTERED INDEX idx_yourcolumn_notnull\nON YourTable(yourcolumn)\nWHERE yourcolumn IS NOT NULL;\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1","poco","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12588266,"title":"How Entity Framework Code First creates the names of the fields in the table?","body":"<p>I'd like to know how the Entity Framework Code First creates the columns in a table. </p>\n\n<p>1 - What is the name convention? </p>\n\n<p>2 - Is there any way of knowing the \"would-be\" name of a column with a POCO property?</p>\n\n<p>I need to compare the property name against the column name among other things.</p>\n\n<p>Any help is much appreciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","asp.net-mvc-3","query","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":32,"score":1,"question_id":12706703,"title":"EF query - getting entities of a certain type","body":"<p>I am trying to filter out entities of a certain type. I am using Entity Framework, and I have a parent entity, and various children that inherit from the parent entity. I am trying to filter out one of these children. </p>\n\n<p>For example, I have the following structure:</p>\n\n<ul>\n<li>Address : Entity\n<ul>\n<li>PostCode : Address</li>\n<li>Street : Address</li>\n</ul></li>\n</ul>\n\n<p>A User entity has a reference to one address. How can I obtain a list of users that are associated to an address of type PostCode?</p>\n\n<p>i.e. I tried: </p>\n\n<pre><code> var query = from User p in context.Users\n                        where p.Address.GetType() == typeof(PostCode)\n                        select p;\n</code></pre>\n\n<p>But I get: </p>\n\n<blockquote>\n  <p>LINQ to Entities does not recognize the method 'System.Type GetType()'\n  method, and this method cannot be translated into a store expression.</p>\n</blockquote>\n\n<p>I have seen couple of solutions that involve obtaining the list of Users first, and then selecting those of a certain type. Problem with this solution is that the query obtains all the users first; I would like my query to include the filter since I have quite a few Users.</p>\n\n<p>Thanks!</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":38,"score":-2,"question_id":12706556,"title":"Entity Framework(EF) does not create table","body":"<p>After deleting database EntityFramework does not create table in database again.How to solve this?\n<br /><br />\nI accidentally deleted the database file(sql compact database).. After creating a new one I changed the connection string to point the database. But if I run the solution the Tables does not created..</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12700407,"title":"C# MVC EF access via navigation property results in entity throwing exception upon db.SaveChanges()","body":"<p>I have an entity with a referential constraint of the form: Entity->Others and am attempting to delete the entity in question.</p>\n\n<p>After loading the entity is deleted, then saved back, this works fine.</p>\n\n<pre><code>Entity entity = null;\nentity = db.Entities.Where(o =&gt; o.Id == loadId).FirstOrDefault();\n\ndb.Entities.DeleteObject(entity);\ndb.SaveChanges();\n</code></pre>\n\n<p>Adding a single check to the entities of type Other related via the referential constraint causes an exception to be thrown on save</p>\n\n<pre><code>Entity entity = null;\nentity = db.Entities.Where(o =&gt; o.Id == loadId).FirstOrDefault();\n\nentity.Others.Count();\n\ndb.Entities.DeleteObject(entity);\ndb.SaveChanges();\n</code></pre>\n\n<p>With the exception being:</p>\n\n<p><em>The operation failed: The relationship could not be changed because one or more of the foreign-key properties is non-nullable. When a change is made to a relationship, the related foreign-key property is set to a null value. If the foreign-key does not support null values, a new relationship must be defined, the foreign-key property must be assigned another non-null value, or the unrelated object must be deleted.</em></p>\n\n<p>I'm not expecting much as I don't have a complete and minimal code here, but the vaguest suggestion of how simply accessing Others invalidates the Entity for saving back would be hugely appreciated.</p>\n"},{"tags":["entity-framework","entity-framework-4","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12699892,"title":"Many to many relationship detecting changes","body":"<p>I am trying to understand why DbContext doesn't detect changesin many-to-many relationship. This is what I have set in model configuration:</p>\n\n<pre><code>this.Configuration.ValidateOnSaveEnabled = false;\nthis.Configuration.ProxyCreationEnabled = false;\nthis.Configuration.LazyLoadingEnabled = false;\n</code></pre>\n\n<p>This is the test code:</p>\n\n<pre><code>var book = Context.Set&lt;Book&gt;().Where(b =&gt; b.Id == 1).Single();\nvar author = Context.Set&lt;Author&gt;().Where(a =&gt; a.Id == 2).Single();\n\nbook.Authors.Add(author);\n</code></pre>\n\n<p>if I check for changes, it doesn't report any:</p>\n\n<pre><code>// returns false\n_context.ChangeTracker.Entries().Any(e =&gt; e.State == EntityState.Added || e.State == EntityState.Modified || e.State == EntityState.Deleted);\n</code></pre>\n\n<p>If I save changes, changes are updated to database correctly.</p>\n\n<pre><code>// 1 record added to BookAuthors table\n_context.SaveChanges();\n</code></pre>\n\n<p>Why is DbContext not tracking changes for many-to-many? WCF is not involved, this is a direct connection to Sql server.</p>\n"},{"tags":["c#","entity-framework","collections","many-to-many"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":90,"score":3,"question_id":12700485,"title":"Entity Framework Code First - Many to Many without Collections","body":"<p>I began working with some many to many relationships in EF code first and found that I don't like having collections on my entities. I would much prefer the many to many relationships be handled in my repository so I can do something like <code>repository.GetUsersForOrganization(organization)</code>. My main concern is not exposing a collection on my entities and having a few methods on my repositories handle everything concerning the many to many relationships including fetching, adding, and deleting the relationships. I'm pretty much at a loss as to the best way to go about removing the collections and replacing it with the repository based approach. How have other people accomplished this?</p>\n"},{"tags":["c#","entity-framework","eager-loading","user-defined-functions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12704286,"title":"Eager loading via user defined function in Entity Framework 4.1","body":"<p>Im using Entity framework 4.1. Fluent API to map my model to pre-defined database. Is there any way to use eager initialization of complex properties via stored procedures or user defined functions?\nFor example:</p>\n\n<pre><code>public class Car\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string Description { get; set; }\n    public Model Model {get;set}\n    public int Year {get;set;}\n    public ICollection&lt;Part&gt; Parts { get; set; }\n}\n</code></pre>\n\n<p>Lets say I have a user defined function in the database that takes Car Id as an input and returns list of parts. Is there any chance to make EF using it?</p>\n\n<p>Thanks.</p>\n"},{"tags":["entity-framework","exception","entity","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12688228,"title":"An item with the same key has already been added exception - entity framework with VS2012","body":"<p>I am currenly reading julie lerman's entity framework book (2nd edition) and implementing its examples on VS 2012.</p>\n\n<p>For those who know/read it, i am currently on chapter 9, using BreakAway database model.</p>\n\n<p>This is the link to download the DB from her site: (on chapter 8)</p>\n\n<p><a href=\"http://learnentityframework.com/LearnEntityFramework/downloads/#2ed\" rel=\"nofollow\">http://learnentityframework.com/LearnEntityFramework/downloads/#2ed</a></p>\n\n<p>When i try to do just a small query like:</p>\n\n<pre><code>var context = new BAGA.BAEntities();\nList&lt;BAGA.Customer&gt; customers=\ncontext.Customers.Include(\"Contact\")\n.Include(\"PrimaryActivity\")\n.Include(\"SecondaryActivity\")\n.Include(\"PrimaryDestination\")\n.Include(\"SecondaryDestination\")\n.Include(\"Reservations.Trip.Destination\")\n.ToList();\ncustomerBindingSource.DataSource = customers;\n</code></pre>\n\n<p>I get the exception say's: An item with the same key has already been added.</p>\n\n<p>I read on some posts that there's might be a problem with primary or foreign keys in the scheme but couldn't find one issue on the database that can cause this.</p>\n\n<p>Can someone point the problem on that database's tables or the domain model it creates?\nI am using VS2012 for the examples on the book.</p>\n\n<p>Or, am i doing somthing wrong? (although, i haven't do anything yet :))</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","visual-studio-2010","entity-framework","windows-forms-designer"],"answer_count":6,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":15642,"score":7,"question_id":5450931,"title":"The specified named connection is either not found in the configuration, not intended to be used with the EntityClient provider, or not valid","body":"<p>I have two projects in a solution.</p>\n\n<ol>\n<li>PizzaSoftware.Data</li>\n<li>PizzaSoftware.UI</li>\n</ol>\n\n<p>In the Data project, I have my Entity Framework model which connects to my database.</p>\n\n<p>My UI project has a project reference to Data and here's how it looks like:</p>\n\n<p><img src=\"http://i.stack.imgur.com/vWRAS.jpg\" alt=\"enter image description here\"></p>\n\n<p>I've created a user control in the UserControls folder.</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Drawing;\nusing System.Data;\nusing System.Linq;\nusing System.Text;\nusing System.Windows.Forms;\nusing PizzaSoftware.Data;\n\nnamespace PizzaSoftware.UI.UserControls\n{\n    public partial class AutoCompleteTextBox : UserControl\n    {\n        AutoCompleteStringCollection completeCollection = new AutoCompleteStringCollection();\n\n        public AutoCompleteTextBox()\n        {\n            InitializeComponent();\n        }\n\n        private void AutoCompleteTextBox_Load(object sender, EventArgs e)\n        {\n            CustomerRepository repo = new CustomerRepository();\n            var customers = repo.FindAllCustomers().ToList();\n\n            foreach (var customer in customers)\n            {\n                completeCollection.Add(customer.Name);\n            }\n\n            txtSearchBox.AutoCompleteMode = AutoCompleteMode.Suggest;\n            txtSearchBox.AutoCompleteSource = AutoCompleteSource.CustomSource;\n            txtSearchBox.AutoCompleteCustomSource = completeCollection;\n        }\n    }\n}\n</code></pre>\n\n<p>When I try to drag this user control into the design pane, I receive the error in the question title.</p>\n\n<p>Here's the contents of the App.config file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"SaharaPizzaEntities\" connectionString=\"metadata=res://*/PizzaSoftwareEntityModel.csdl|res://*/PizzaSoftwareEntityModel.ssdl|res://*/PizzaSoftwareEntityModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=.\\SQLEXPRESS;Initial Catalog=SaharaPizza;Integrated Security=True;MultipleActiveResultSets=True&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>What could be causing this error?</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12691632,"title":"EF5: Attach multiple results from stored proc to context","body":"<p>I have a stored proc in Entity Framework 5, returning multiple result sets of entities.\nAttaching each entity to the context is very slow.\nIs there a better / faster / easier way to do this?</p>\n\n<pre><code>    using (var context = new MyEntities())\n    {                \n        var resultSet1 = context.ExecMyStoredProc();\n        foreach (var a in resultSet1) context.ASet.Attach(a);\n        var resultSet2 = resultSet1.GetNextResult&lt;B&gt;();\n        foreach (var b in resultSet2) context.BSet.Attach(b);\n        var resultSet3 = resultSet2.GetNextResult&lt;C&gt;();\n        foreach (var c in resultSet3) context.CSet.Attach(c);\n        .                \n        .\n    }\n</code></pre>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12363477,"title":"EF Code First - How to prevent duplicate column on created table on Table-Per-Hierarchy Mapping","body":"<p>I have entity like below</p>\n\n<pre><code>public abstract class MyBaseClass\n{\n    public int Id { get; set; }\n}\n\npublic class MyConcrete : MyBaseClass\n{\n    public int TemplateName { get; set; }\n    public int Total { get; set; }\n}\n\npublic class MyOtherConcrete : MyBaseClass\n{\n    public int TemplateName { get; set; }\n    public int MyProperty { get; set; }\n    public string OtherProperty { get; set; }\n}\n</code></pre>\n\n<p>using default initialization, EF will make table with columns like bellow:</p>\n\n<pre><code>Id\nTemplateName\nTemplateName1 // &lt;-- this is the problem\nTotal\nMyPorperty\nMyOtherProperty\n</code></pre>\n\n<p>now my question how to configure EF so all the TemplateName property on derived class automatically mapped into TemplateName column without making another column. is it possible to configure it on <code>OnModelCreating</code> method?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>actually above was simplified version of my problem. i have 10 more entities some property might duplicated everywhere and i don't want to add any abstraction layers.</p>\n\n<p>i have tried manually map the column on the <code>OnModelCreating</code> but having \"<strong>Each property name in a type must be unique. Property name 'TemplateName' was already defined</strong>\" exception any idea?</p>\n\n<p><strong>EDIT 2</strong></p>\n\n<p>so, i found <a href=\"http://stackoverflow.com/a/4390032/212706\">here</a>, that said it is impossible to do such thing like above in EF, it is weird for me..</p>\n"},{"tags":["c#","entity-framework","sql-server-express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12700982,"title":"How do I create a SQL Server Express database at runtime in a C# MVC App?","body":"<p>I'm trying to do this using Entity Framework 5 in C# in an MVC3 web application:</p>\n\n<pre><code>// Local DB connection\nvar dbId = String.Format(@\"Data Source=.\\SQLEXPRESS;AttachDbFilename={0}.mdf;Database=Tests;Integrated Security=True;Pooling=False;Connect Timeout=30;User Instance=True\", _dbPath);\n_connection = new SqlConnection(dbId);\n\nDatabase.SetInitializer&lt;MyContext&gt;(new DropCreateDatabaseAlways&lt;MyContext&gt;());\n\n// Reset database if the file exists\nvar ctx = new MyContext(_connection);\nctx.Database.CreateIfNotExists();\nctx.Database.Initialize(true);\nctx.SaveChanges();\n\nreturn _connection;\n</code></pre>\n\n<p>This works for my tests, but not when I run the web application. When I run the web application, I get:</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: SQL\n  Network Interfaces, error: 26 - Error Locating Server/Instance\n  Specified)</em></p>\n</blockquote>\n\n<p>I see in a few other questions people have suggested removing the 'User Instance' from the connection string, but that results in:</p>\n\n<blockquote>\n  <p><em>CREATE DATABASE permission denied in database 'master'.</em></p>\n</blockquote>\n\n<p>Let me be entirely clear on my goal here: I'm trying to have the web application create database instances (<code>sqlexpress</code>) on demand. </p>\n\n<p>Creating the database instances <em>in advance</em> is not a solution.</p>\n\n<p>I'm quite puzzled about why some kind of special permission is needed when the app worker is the one accessing <em>and creating</em> the database.</p>\n\n<p>How can you do this?</p>\n\n<p>Using sqlite this is a trivial operation, and I'm starting to feel like using Entity Framework (and thus SQL Server Express) was mistake and I should have gone with fluent nhibernate and sqlite instead. </p>\n"},{"tags":["entity-framework","linqpad"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12695603,"title":"Why can't LinqPad autogenerate a context object with EF?","body":"<p>Does anyone know why LinqPad cannot autogenerate an Entity Framework context object (like it does with Linq-to-SQL)? It seems I have to create an assembly containing an EF context and then reference the assembly in LinqPad. But I don't need to do this with L2S.</p>\n\n<p>Thanks very much.</p>\n"},{"tags":["c#","entity-framework","entity-framework-4","fluent"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12700361,"title":"Map multiple PK with Entity Framework","body":"<p>I have 2 classes at the moment. The first is an asset, the second is services associated with that asset. The Asset table in SQL Server has a PK over both ID and workflow_id.</p>\n\n<pre><code>public class Asset\n{\n    public int ID { get; set; }\n    public int workflow_id { get; set; }\n\n    public string name { get; set; }\n}\n</code></pre>\n\n<p>The second table is services which has a PK over the 3 columns, the service ID, workflow_id and the asset_id the service is tied too. </p>\n\n<pre><code>public class Services\n{\n    public int ID { get; set; }\n    public int workflow_id { get; set; }\n    public int asset_id { get; set; }\n\n    public string service_description { get; set; }\n}\n</code></pre>\n\n<p>Example Data: Asset with ID#10 in workflow_id#27 matches all the Services with asset_id#10 in workflow_id#27.</p>\n\n<p>How can I map these two together with the multi-column PKs?</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12698748,"title":"Linq error when returning a List inside a List","body":"<p>I have a class defined as follows:</p>\n\n<pre><code>public class SearchResult\n{\n    public Customer Customer { get; set; }\n    public Receipt Receipt { get; set; }\n    public IEnumerable&lt;ReceiptDetail&gt; ReceiptDetail { get; set; }\n}\n</code></pre>\n\n<p>In my Linq query i would like to return a single SearchResult record but have problems in returning the List of ReceiptDetail. If i do:</p>\n\n<pre><code> var list=(from cust in dbContext.Customers \n     join rec in dbContext.Receipts on cust.IdCustomer equals rec.IdCustomer\n     join recdet in dbContext.ReceiptDetails on rec.IdReceipt equals recdet.IdReceipt\n     select new SearchResult\n     {\n          Customer=cust,\n          Receipt=rec,\n          ReceiptDetail = (from  r1 in recdet select r1).ToList() // COMPILER ERROR HERE\n     }).ToList();\n</code></pre>\n\n<p>I get the \"Could not find an implementation of the query pattern for source type ReceiptDetail   'Select' not found\".</p>\n\n<p>What am i doing wrong?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12692200,"title":"How does EF know the name of the class viewforbaseentityset... with view generation","body":"<p>Using EF5.0 and view compilation, i can see it all working.\nIm see from the call stack  the view gets called.\nThe edmx property metadata artifact processing is set as embed in assembly  </p>\n\n<p>This method below (constructor) gets called. But how did it know the name?\nCan i have multiple models in 1 assembly ?\nIm happy it works, but id like to know what is going on underneath.</p>\n\n<p>Any ideas?</p>\n\n<pre><code>public ViewsForBaseEntitySetsFE35229A04DD6E5585E40F6CE4FBC33EE6C9199EBD58235921B21B951250FF67()\n    {\n        this.EdmEntityContainerName = \"BosMasterEntities\";\n        this.StoreEntityContainerName = \"BosMasterModelStoreContainer\";\n        this.HashOverMappingClosure = \"0edb68dd82ba8436bcabb10d30d018482670a8944e1013c90d795d35afea1b8d\";\n        this.HashOverAllExtentViews = \"d0d326d5289ea43aa6ea7854e053ba0bd410789e3196101e38bace646c0fa404\";\n        this.ViewCount = 34;\n    }\n</code></pre>\n"},{"tags":["sql","entity-framework","dynamic","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12683338,"title":"EntityFramework SQLQuery Dynamic Type at Runtime","body":"<p>Im just wondering if there is a way to run a string based SQL query against the dbContext and inspect the objects coming back to give the object a type at runtime. i.e. I will not know the structure of the SQL string being executed until runtime.</p>\n\n<p>Is this possible?</p>\n\n<p>code example:</p>\n\n<pre><code>My_DataProvidor.DB.Database.SqlQuery&lt;MyDynamicType&gt;(\"SELECT * FROM CUSTOMER\").ToList();\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>My_DataProvidor.DB.Database.SqlQuery(MyDynamicType,\"SELECT * FROM CUSTOMER\").ToList();\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["c#",".net","visual-studio","entity-framework","mvvm"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":93,"score":2,"question_id":12697669,"title":"C# MVVM Upgrade to EF5 - Where have the Entity Member Functions Gone?","body":"<p>I have a large MVVM-type solution which I originally wrote using VS2010 Express with .NET4. The Model uses Entities to access a SQL Server 2012 database.</p>\n\n<p>I managed to lose the Model project recently, which didn't seem a big deal, as it really consists of the Auto-generated Entities with a few minor modifications. I have therefore recreated the model project using VS2012 with .NET4.5 and EF5. I have upgraded the ViewModel to .NET4.5 and have imported EntityFramework using the package manager.</p>\n\n<p>The problem is, my ViewModel (a separate Class Library) throws several compile-time errors which I cannot figure out. These revolve around:</p>\n\n<ol>\n<li>The main Entities class (in my case, CN2Entities) no longer has a constuctor which takes a connection string. This is confirmed by autocomplete, which only offers a parameterless constructor.</li>\n<li><p>The individual database object classes which map to database tables, such as \"Addresses\" no longer contain their static members. For example:</p>\n\n<p>address_ = Address.CreateAddress(-1);</p></li>\n</ol>\n\n<p>This code used to provide me with a nice, empty address record to fill and add to the database. This is no longer valid. In fact, the only static members of the Address class appear to be \"Equals\" and \"ReferenceEquals\".</p>\n\n<ol>\n<li>The main Entities class no longer contains the AddToAddress(Address) function, which would then take the new Address object (representing a row of the Addresses table) and add it to the database. I would then call Entities.SaveChanges() to commit the addition. This function still seems to be present.</li>\n</ol>\n\n<p>Can anyone please help me with what is going on? Is this something to do with the new way EF5 works or do I have a corrupted solution which is not providing me with the correct references?</p>\n"},{"tags":["entity-framework","efpocoadapter"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":239,"score":2,"question_id":4465161,"title":"Entity Framework with POCO Template and FKs in Model - Null Ref Exception","body":"<p>I'm using Entity Framework 4 with the POCO code generation template from Microsoft downloaded from the Visual Studio gallery.  I am also leaving the default option to \"Include foreign keys in model\" selected when generating the EF model from the database.</p>\n\n<p>I've been able to reproduce this problem with a very simple model, only two tables/classes in an optional one-to-many relationship.  In this case, I'm using an Address and a Person.  A Person can have one or zero addresses, and an Address can have zero to many People.</p>\n\n<p>The tables look like this:</p>\n\n<pre><code>CREATE TABLE [dbo].[Person](\n    [PersonID] [uniqueidentifier] NOT NULL,\n    [FirstName] [nvarchar](50) NULL,\n    [LastName] [nvarchar](50) NULL,\n    [AddressID] [uniqueidentifier] NULL,\n CONSTRAINT [PK_Person] PRIMARY KEY CLUSTERED ([PersonID] ASC )\n\n CREATE TABLE [dbo].[Address](\n    [AddressID] [uniqueidentifier] NOT NULL,\n    [Street1] [nvarchar](50) NOT NULL,\n    [Street2] [nvarchar](50) NULL,\n    [City] [nvarchar](50) NOT NULL,\n    [State] [char](2) NOT NULL,\n    [Country] [nvarchar](50) NOT NULL,\n CONSTRAINT [PK_Address] PRIMARY KEY CLUSTERED ([AddressID] ASC)\n\nALTER TABLE [dbo].[Person]  WITH CHECK ADD  CONSTRAINT [FK_Person_Address] \nFOREIGN KEY([AddressID])\nREFERENCES [dbo].[Address] ([AddressID])\n</code></pre>\n\n<p>When I try to create an Address object and add it to an existing Person object pulled from the database, I get a null reference exception:</p>\n\n<pre><code>TestPOCOEntities ctx = new TestPOCOEntities();\n\nvar person = ctx.People.FirstOrDefault(p =&gt; p.PersonID == new Guid(\"58AD37B4-1EBE-4649-940C-A141732C9901\"));\n\nvar addr = new Address {AddressID = Guid.NewGuid(), Street1 = \"123 Main St\"};\nperson.Address = addr; // This line throws the exception\n\nctx.SaveChanges();\n</code></pre>\n\n<p>Digging into the call stack, the exception isn't being thrown from my code, or even the template-generated code, but inside the runtime dynamic proxy for the Person class in the <code>AddressID</code> setter. (Specifically, the <code>System.Data.Objects.EntityEntry.FixupEntityReferenceByForeignKey(EntityReference reference)</code> method.)</p>\n\n<p>This exception does not occur if I use the default EF code generation instead of the POCO template. It also does not occur if I use the POCO template but uncheck the \"Include foreign keys in model\" checkbox when generating the model from the database.</p>\n\n<p>I can get the error to go away if I add the following:</p>\n\n<pre><code>var addr = new Address {AddressID = Guid.NewGuid(), Street1 = \"123 Main St\"};\nctx.Addresses.AddObject(addr); // Adding this line...\nperson.Address = addr; // Means no more exception here!\n</code></pre>\n\n<p>I don't see why the combination of using the POCO template and including foreign keys in the model should require this kind of code change when interacting with my persistent objects.  Is this a known bug?  Am I missing something?  Is this by design for some reason?</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","one-to-one"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":12693580,"title":"EF: one-to-one relationship","body":"<p>I am trying to set up a bi-directional one-to-one relationship. However, I am failing to get a bi-directional setting for two entities. </p>\n\n<p>For example, lets say one person has one phone number, and one phone number can only be associated to one person. I would have:</p>\n\n<pre><code>  public class Person : Entity\n  {\n    public long PersonId { get; set; }\n    public virtual PhoneNumber PhoneNumber {get; set; }\n  }\n\n  public class PhoneNumber : Entity\n  {\n    public long PhoneNumberId { get; set; }\n  }\n</code></pre>\n\n<p>However, with this re-arrangement, I cannot get a bi-directional setting. i.e. I cannot have <code>phoneNumber.Person.</code></p>\n\n<hr>\n\n<p><em>What I have tried:</em></p>\n\n<pre><code>  public class PhoneNumber : Entity\n  {\n    public long PhoneNumberId { get; set; }\n\n    [InverseProperty(\"PersonId\")]\n    public virtual Person Person {get; set; }\n  }\n</code></pre>\n\n<p>This does not seem to work when I execute the following code:</p>\n\n<pre><code>   var realNumber = new PhoneNumber();\n   var person = new Person() {PhoneNumber = realNumber};\n   context.SaveChanges();\n</code></pre>\n\n<p>Here, the PhoneNumber entity has a column Person (set to NULL), and the person has a column for PhoneNumber (has value).</p>\n"},{"tags":["c#","asp.net-mvc","database","entity-framework","orm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":148,"score":0,"question_id":12679765,"title":"Entity framework 5 many to many","body":"<p>I have problem because when I add lines </p>\n\n<pre><code>public int PersonId { get; set; }\n[ForeignKey(\"PersonId\")]\npublic virtual Person Student { get; set; }\n</code></pre>\n\n<p>in class Course i have only 2 tables not 3</p>\n\n<p>you do not have these three lines all good, but I need an additional field in class Course</p>\n\n<pre><code>            public class Person\n            {\n                public int PersonId { get; set; }\n                public string FirstName { get; set; }\n                public string LastName { get; set; }\n\n                public virtual ICollection&lt;Course&gt; CoursesAttending { get; set; }\n\n\n            }\n\n            public class Course\n            {\n                public int CourseId { get; set; }\n                public string Title { get; set; }\n\n                public int PersonId { get; set; }\n                  [ForeignKey(\"PersonId\")]\n                public virtual Person Student { get; set; }\n\n                public virtual ICollection&lt;Person&gt; Students { get; set; }\n\n\n            }\n\n            public class SchoolContext : DbContext\n            {\n                public DbSet&lt;Course&gt; Courses { get; set; }\n                public DbSet&lt;Person&gt; People { get; set; }\n\n                         }\n            class Program\n            {\n                static void Main(string[] args)\n                {\n                    Database.SetInitializer&lt;SchoolContext&gt;(new DropCreateDatabaseAlways&lt;SchoolContext&gt;());\n                    SchoolContext db = new SchoolContext();\n                    var cos = from d in db.Courses\n                              select d;\n                }\n            }\n</code></pre>\n\n<p>please help me</p>\n"},{"tags":["c#",".net","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12696276,"title":"Are different IQueryable objects combined?","body":"<p>I have a little program that needs to do some calculation on a data range. The range maybe contain about half a millon of records. I just looked to my db and saw that a <code>group by</code> was executed.</p>\n\n<p>I thought that the result was executed on the first line, and later I just worked with data in RAM. But now I think that the query builder combine the expression.</p>\n\n<pre><code>var Test = db.Test.Where(x =&gt; x &gt; Date.Now.AddDays(-7));\nvar Test2 = (from p in Test \n             group p by p.CustomerId into g \n             select new { UniqueCount = g.Count() } ); \n</code></pre>\n\n<p>In my real world app I got more subqueries that is based on the range selected by the first query. I think I just added a big overhead to let the DB make different selects.</p>\n\n<p>Now I bascilly just call <code>.ToList()</code> after the first expression.</p>\n\n<p>So my question is am I right about that the query builder combine different IQueryable when it builds the expression tree?</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12694772,"title":"How can I make a news page, with inline comment posting, using MVC3?","body":"<p>I've been learning MVC3 in the last few weeks and I'm trying to write what I believe should be a simple enough piece of functionality, but I'm having real problems getting it to work correctly.</p>\n\n<p><strong>The scenario</strong></p>\n\n<p>My website will contain news posts, summarised on the home page, with links to view the full details of each article in it's own page.</p>\n\n<p>Comments can be made on each article, and these comments are shown at the end of each article's details page. Authenticated users should be able to post their own comments to the article from the page that shows the article itself. I want to avoid users being taken to a seperate page (although I understand this is easier from a code perspective, I disagree that it's a good UX!).</p>\n\n<p>For an example of how I want this to look, Scott Hanselman's blog (<a href=\"http://www.hanselman.com\" rel=\"nofollow\">http://www.hanselman.com</a>) is a perfect example (albeit that his home page shows the entire article rather than just a summary!) - it links through to the comments page, and the \"Add comments\" form sits neatly at the bottom, inline with the article.</p>\n\n<p><strong>Where I'm at so far</strong></p>\n\n<p>I've managed to write the Controller for my news section, with an Index method (which retrieves X number of most recent posts) and a \"Comments\" method to show the full article and comments. I've also created a partal view called \"CommentForm\" with it's own Controller method. Code snippets from the controller below:</p>\n\n<pre><code>//\n// GET: /News/ \npublic ActionResult Index()\n{\n    using (var nm = new NewsManager())\n    {\n        var news = nm.GetLatestActiveNewsArticles(50, \"System\");\n        return View(news);\n    }\n}\n//\n// GET: /News/Comments/20\npublic ActionResult Comments(int id)\n{\n    using (var nm = new Rapallo.Core.Managers.NewsManager())\n    {\n        var article = nm.GetArticle(id);\n        return View(article);\n    }\n}\n// GET: /News/CommentForm/20\n[HttpGet()]\npublic ActionResult CommentForm(int newsId)\n{\n    return View(new Rapallo.DataAccess.Comment() { NewsId = newsId });\n}\n// \n// POST: /News/Comments/20\n[Authorize()]\n[HttpPost()]\npublic ActionResult Comments(Comment comment)\n{\n    using (var nm = new NewsManager())\n    {\n        var article = nm.GetArticle(comment.NewsId.Value);\n        if (null == article) HttpNotFound();\n    }\n    using (var cm = new CommentManager())\n    {\n        if (cm.AddCommentToNews(comment.NewsId.Value, CurrentUser.RapalloUser.Id, comment.Body))\n        return RedirectToAction(\"Comments\", \"News\", new { id = comment.NewsId.Value });\n    }\n    return HttpNotFound();\n}\n</code></pre>\n\n<p>And from the Comments view, the code snippet to show where I'd like my add comment form:</p>\n\n<pre><code>@if (User.Identity.IsAuthenticated)\n{\n    @Html.Partial(\"Comment\", new Rapallo.DataAccess.Comment() { NewsId = Model.Id });\n}\n</code></pre>\n\n<p>This view specifies:</p>\n\n<pre><code>@model Rapallo.DataAccess.News\n</code></pre>\n\n<p>And finally, the comment form itself:</p>\n\n<pre><code>@model Rapallo.DataAccess.Comment\n@using (Html.BeginForm())\n{ \n    @Html.TextAreaFor(m =&gt; m.Body);\n    &lt;input type=\"submit\" value=\"Send Comment\" /&gt;\n}\n</code></pre>\n\n<p><strong>The problem</strong></p>\n\n<p>In a nutshell, when I submit the comment form (which renders correctly), NewsId on the Comment model is not populated so the controller cannot associate the new comment with the correct news post.</p>\n\n<p>I'd appreciate if someone could point out where I'm going wrong! I've tried to adapt some code from NerdDinner to make this work, as well as spending countless hours on the train trying various combinations of partial views, different models, and even renaming methods in my controller in an attempt to get this to work.</p>\n\n<p>I'm quite keen on encapsulating the \"add comment\" functionality into it's own separate form and being able to use this to add comments to more than just news articles. The database schema and domain models already support this, I just can't get the UI to work.</p>\n\n<p>Any help would be very welcome and gratefully received.</p>\n"},{"tags":["c#","sql-server","asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12696643,"title":"db.SaveChanges() changes key value to NULL before saving so it isn't saving at all","body":"<p>I have no relations set within model nor database (and I want it to stay like that) so I'm forced to do all the key-related mathematics. The case is that the SaveChanges function is changing my preset values. The code:</p>\n\n<pre><code>public ActionResult Create(Coach coach, HttpPostedFileBase file)\n    {\n        if (file != null &amp;&amp; file.ContentLength &gt; 0)\n        {\n            [irrelevant]\n            image.Data = data;\n            image.PlayerId = null;\n            image.IfPersonRelated = \"n\";\n\n            if (db.Images.Count() &gt; 0)\n            {\n                image.ImageId = db.Images.\n                image.ImageId = db.Images.Max(i =&gt; i.ImageId) + 1;\n            }\n            else\n            {\n                image.ImageId = 1;\n            }\n\n            if (db.Coaches.Count() &gt; 0)\n            {\n                coach.CoachId = db.Coaches.Max(i =&gt; i.CoachId) + 1;\n            }\n            else\n            {\n                coach.CoachId = 1;\n            }\n\n            image.CoachId = coach.CoachId;\n            coach.ImageId = image.ImageId;\n            image.Desc = coach.Name2nd + \", \" + coach.Name1st;\n\n            if (ModelState.IsValid)\n            {\n                db.Images.Add(image);\n                db.Coaches.Add(coach);\n                db.SaveChanges();\n                return RedirectToAction(\"Index\");\n            }\n        }\n        return View(coach);\n    }\n</code></pre>\n\n<p>Before saving, in debug mode, I had e.g. coach.CoachId == 1 but after saving it's == e.g. 5 (like if I didn't delete previous records); it's obviously destroy coach's relation with image. Now I'm a little lost in this and made some changes - it's always NULL now. How to prevent such behaviors and do everything manually?</p>\n\n<p>I've tried to set StoreGeneratedPattern to None but then I'm unable to save anything at all...</p>\n"},{"tags":["entity-framework","entity-framework-4","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12696215,"title":"EF 4.1 POCO template generator conflicting with ClassObjects.Context.cs","body":"<p>I've been using EF 4.1 and the POCO template generator.</p>\n\n<p>I love and hate EF. I love the time I save. I hate maintaining the EDMX file.</p>\n\n<p>But while keeping the EDMX in sync with the database has been a challenge, I'm now overwhelmed by the POCO generator. Up until now, the POCO generator has created POCO's for me and kept the ClassObjects.Context.cs empty and non-conflicting.</p>\n\n<p>After my most recent refresh I have had constant problems with \"Amiguity between 'perseus.DataLayer.accounts' and 'perseus.DataLayer.accounts'.</p>\n\n<p>I get this error for every POCO.</p>\n\n<p>I'm on the edge of panicking as I recommended and owned the maintenance of EF. I've spent a couple days on trying everything from database refreshes to deleting all items from the EDMX file and reloading them from the database. </p>\n\n<p>Nothing has made a difference. I have no clue what has suddenly changed from the last few months of <em>relative</em> stability. I'm seriously lost as to what I can do from here. </p>\n\n<p><img src=\"http://i.stack.imgur.com/1zoK6.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","entity-framework","code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12695857,"title":"How Does Entity Framework Code First Find Typed Entities From A Base-Class Set When Using TPC","body":"<p>So this question might sound a little esoteric, but I've noticed something \"magical\" and I have a concern about the performance of what's going on under the hood. Assume I create entities using a TPC design, all entities inherit (directly or indirectly) from a root base entity, and the root base entity contains a globally unique identifier (such as a Guid) that is generated in code before saving (I.e., not generated by the database).</p>\n\n<p>I would expect the following code to work by querying the table related to the coorisponding generic type to return a typed dynamic proxy (and it does):</p>\n\n<p><code>context.Set&lt;ConcreteDerivedEntityClass&gt;().Find(someGuid)</code></p>\n\n<p>However, I've also noticed that I can execute the following:</p>\n\n<p><code>context.Set&lt;BaseEntityClass&gt;().Find(someGuid)</code></p>\n\n<p>This is very cool and will magically return a typed dynamic proxy for the requested Id of the proper concrete class. How in the world does EF know which derived class / table the Id belongs to? Does it look at every table / entity type it knows about until it finds a match (hence the performance concern)?</p>\n"},{"tags":["entity-framework","sqldependency"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12695180,"title":"Getting SqlCommand with EF","body":"<p>I made a SqlDependency service in my application. It works perfectly when I type the queries by hand but I cannot include wildcards (I don't really know why).</p>\n\n<p>For example:</p>\n\n<pre><code>//Using this SqlCommand will work\nnew SqlCommand(\"SELECT [employees].[name] FROM [dbo].[employees]\", sqlNotificationConn)\n\n//But this one won't\nnew SqlCommand(\"SELECT [employees].* FROM [dbo].[employees]\", sqlNotificationConn)\n\n//And this one won't either\nnew SqlCommand(\"SELECT * FROM [dbo].[employees]\", sqlNotificationConn)\n</code></pre>\n\n<p>So basically, I want to get my DbContext to generate a full SELECT command with every fields it deals with.</p>\n\n<p>In Linq 2 SQL, I used this service using <code>dbContext.GetCommand(.....);</code></p>\n\n<p>In EF 4.0 (or was it 4.1?), I used <code>dbContext.employee.ToTraceString();</code></p>\n\n<p>But in EF 4.4, I can't find anything to generate that SELECT query string....</p>\n"},{"tags":["entity-framework","frameworks","entity"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12695754,"title":"Unable to create Gridview by dragging Object DataSource to WinForm","body":"<p>I want to create a set of DataGridView controls by dragging their respective DataSources onto a form. I would do that for an object and one of its navigation properties (from the DataSources), thus having two grids in a Master-Detail relationship.</p>\n\n<p>After moving to Visual Studio 2012 (and EF 5.0), the first grid comes through as expected (with the navigator). However, for the \"detail\" grid, only two columns appear (\"Count\" &amp; \"IsReadOnly\"). I've tried it with other tables/objects and I hit the same problem. I've tried \"Edit Columns\" &amp; \"Add Column\" to no available.\nI use northwind as an example. I want 2 datagridview in a form. one for a customer and another for related orders. a typical master/details view. </p>\n\n<ol>\n<li><p>I added a model to project (edmx) file.</p></li>\n<li><p>added a new datasource to model. two objects. customer and orders tables!</p></li>\n<li><p>dragged customer entity as datagridview. All fields (properties) are in grid.</p></li>\n</ol>\n\n<p>4 when dragging the orders from customer entity not order entity itself, there are only two column named \"count\" and \"readonly\"  </p>\n\n<p>Above procedures work fine in linq to sql VS 2012, EF 5.0, .NET 4.5. But NOT for EF.</p>\n\n<p>and,</p>\n\n<p>The steps are exactly same as the way beth massi described in <a href=\"http://blogs.msdn.com/b/bethmassi/archive/2008/12/10/master-details-with-entity-framework-explicit-load.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/bethmassi/archive/2008/12/10/master-details-with-entity-framework-explicit-load.aspx</a> However this is not an issue of lazy or eager loading!</p>\n"},{"tags":["c#",".net","entity-framework","frameworks","entity"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12695061,"title":"Entity Framework, cannot seem to get simple read and writes to Azure DB, whats wrong with this?","body":"<p>I have a simple WCF Service which I am hosting in Azure.</p>\n\n<p>I am using(trying) Entity Framework to handle the CRUD statements.</p>\n\n<p>I have been reading online about DbContext and ObjectContext but I cannot find them.</p>\n\n<p>Here is what my code looks like, I pointed EF to my SQL Azure db and it generated the model for me. </p>\n\n<p>I want to now use that model to add entries in the database and read from the database but cannot get it to work at all.</p>\n\n<pre><code>    /// &lt;summary&gt;\n    /// GetPetition Method returns an Petition based on petition id supplied\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"id\"&gt;&lt;/param&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public Petition GetPetition(int ? id)\n    {\n\n        using (petitionEntities1 pe = new petitionEntities1())\n        {\n            pe.Connection.Open();\n            try\n            {\n                return pe.Petitions.Where(x =&gt; x.Id == id).FirstOrDefault();\n            }\n            catch (Exception ex)\n            {\n                return null;\n            }\n        }\n    }\n</code></pre>\n\n<p>and another example is </p>\n\n<pre><code>    /// &lt;summary&gt;\n    /// GetAllPetitions does exactly what it says, it returns all Petitions in a list\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public List&lt;Petition&gt; GetAllPetitions()\n    {\n\n        using (petitionEntities1 pe = new petitionEntities1())\n        {\n            try\n            {\n                return pe.Petitions.ToList&lt;Petition&gt;();\n            }\n            catch (Exception ex)\n            {\n\n                return null;\n            }\n        }\n    }\n</code></pre>\n\n<p>and lastly </p>\n\n<pre><code>    /// &lt;summary&gt;\n    /// PutPetition , adds a petition to the database\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"petition\"&gt;&lt;/param&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public int PutPetition(Petition petition)\n    {\n        using (petitionEntities1 pe = new petitionEntities1())\n        {\n            try\n            {\n                pe.Petitions.AddObject(petition);\n                pe.SaveChanges();\n                pe.AcceptAllChanges();\n                return 1;\n\n            }\n            catch (Exception ex)\n            {\n\n                return -1;\n            }\n        }\n    }\n</code></pre>\n\n<p>What am i missing and what am I doing wrong, anyone got any ideas why?</p>\n\n<p>When I try and insert an entity it throws an exception on the <code>SaveChanges()</code> method</p>\n\n<blockquote>\n  <p>at\n  System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager\n  stateManager, IEntityAdapter adapter)    at\n  System.Data.Objects.ObjectContext.SaveChanges(SaveOptions options)<br>\n  at EPetitionWCFService.Service.PutPetition(Petition petition) in\n  c:\\ws......Service.svc.cs:line  117</p>\n</blockquote>\n\n<p>When try an get a row from the database it executes successfully as I step through the code but when it returns to the method call it throws the following exception.  I have take out a lot of the stack trace to show the messages.</p>\n\n<pre><code>var a = sc.PutPetition(petition);\n</code></pre>\n\n<blockquote>\n  <p>System.Windows.Markup.XamlParseException was unhandled<br>\n  HResult=-2146233087   Message='The invocation of the constructor on\n  type 'WpfTestApplication.MainWindow' that matches the specified\n  binding constraints threw an exception.' Line number '3' and line\n  position '9'. Source=PresentationFramework</p>\n  \n  <p>HResult=-2146233087 Message=The underlying connection was closed: The\n  connection was closed unexpectedly.\n         Source=mscorlib \n         InnerException: System.Net.WebException\n              HResult=-2146233079\n              Message=The underlying connection was closed: The connection was closed unexpectedly.\n              Source=System\n              StackTrace:\n                   at System.Net.HttpWebRequest.GetResponse()\n                   at System.ServiceModel.Channels.HttpChannelFactory`1.HttpRequestChannel.HttpChannelRequest.WaitForReply(TimeSpan\n  timeout)\n              InnerException:</p>\n</blockquote>\n\n<p>EDIT: After digging around I found this \n<a href=\"http://www.codeproject.com/Tips/326059/The-underlying-connection-was-closed-The-connectio\" rel=\"nofollow\">http://www.codeproject.com/Tips/326059/The-underlying-connection-was-closed-The-connectio</a></p>\n\n<p>It seems that LazyLoading needed to be set to false, something to do with the Using statements already disposing of the ObjectContext.  I can now get data from SQL AZURE, still having issues with inserting. </p>\n"},{"tags":["visual-studio","entity-framework","iis7","web-deployment","webdeploy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12677735,"title":"Webdeploy System.Runtime.Serialization.SerializationException: Member 'ClassName' was not found","body":"<p>When im doing a webdeploy at visual studio 2012 and select the option <em>update database</em> I get the following error at my server log:</p>\n\n<pre><code>User: \nClient IP: xxxx\nContent-Type: application/msdeploy\nVersion: 9.0.0.0\nMSDeploy.VersionMin: 7.1.600.0\nMSDeploy.VersionMax: 9.0.1631.0\nMSDeploy.Method: Sync\nMSDeploy.RequestId: 36abe7a7-87e3-4ffb-a46f-b5918da1e651\nMSDeploy.RequestCulture: nl-NL\nMSDeploy.RequestUICulture: en-US\nServerVersion: 9.0.1631.0\nSkip: objectName=\"^configProtectedData$\"\nProvider: auto, Path: \nA tracing deployment agent exception occurred that was propagated to the client. Request ID '36abe7a7-87e3-4ffb-a46f-b5918da1e651'. Request Timestamp: '1-10-2012 17:39:41'. Error Details:\nSystem.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---&gt; System.Runtime.Serialization.SerializationException: Member 'ClassName' was not found.\n   at System.Runtime.Serialization.SerializationInfo.GetElement(String name, Type&amp; foundType)\n   at System.Runtime.Serialization.SerializationInfo.GetString(String name)\n   at System.Exception..ctor(SerializationInfo info, StreamingContext context)\n   --- End of inner exception stack trace ---\n   at System.RuntimeMethodHandle._SerializationInvoke(Object target, SignatureStruct&amp; declaringTypeSig, SerializationInfo info, StreamingContext context)\n   at System.Runtime.Serialization.ObjectManager.CompleteISerializableObject(Object obj, SerializationInfo info, StreamingContext context)\n   at System.Runtime.Serialization.ObjectManager.FixupSpecialObject(ObjectHolder holder)\n   at System.Runtime.Serialization.ObjectManager.DoFixups()\n   at System.Runtime.Serialization.Formatters.Binary.ObjectReader.Deserialize(HeaderHandler handler, __BinaryParser serParser, Boolean fCheck, Boolean isCrossAppDomain, IMethodCallMessage methodCallMessage)\n   at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Deserialize(Stream serializationStream, HeaderHandler handler, Boolean fCheck, Boolean isCrossAppDomain, IMethodCallMessage methodCallMessage)\n   at System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Deserialize(Stream serializationStream, HeaderHandler handler, Boolean fCheck, IMethodCallMessage methodCallMessage)\n   at Microsoft.Web.Deployment.Base64EncodingHelper.DeserializeHelper(BinaryFormatter formatter, Byte[] buffer)\n   at Microsoft.Web.Deployment.Base64EncodingHelper.Deserialize(String str, Exception&amp; handledException)\n   at Microsoft.Web.Deployment.SerializationHelper.Deserialize(String str)\n   at Microsoft.Web.Deployment.SqlDacPacProvider.ProcessExeOutput()\n   at Microsoft.Web.Deployment.SqlDacPacProvider.RunExecutableAsync(String exeName, String arguments, Int32 waitInterval, Int32 retryAttempts)\n   at Microsoft.Web.Deployment.SqlDacPacProvider.Add(DeploymentObject source, Boolean whatIf)\n   at Microsoft.Web.Deployment.DeploymentObject.Add(DeploymentObject source, DeploymentSyncContext syncContext)\n   at Microsoft.Web.Deployment.DeploymentSyncContext.HandleAdd(DeploymentObject destObject, DeploymentObject sourceObject)\n   at Microsoft.Web.Deployment.DeploymentSyncContext.SyncChildren(DeploymentObject dest, DeploymentObject source)\n   at Microsoft.Web.Deployment.DeploymentSyncContext.SyncChildrenOrder(DeploymentObject dest, DeploymentObject source)\n   at Microsoft.Web.Deployment.DeploymentSyncContext.ProcessSync(DeploymentObject destinationObject, DeploymentObject sourceObject)\n   at Microsoft.Web.Deployment.DeploymentObject.SyncToInternal(DeploymentObject destObject, DeploymentSyncOptions syncOptions, PayloadTable payloadTable, ContentRootTable contentRootTable, Nullable`1 syncPassId)\n   at Microsoft.Web.Deployment.DeploymentAgent.HandleSync(DeploymentAgentAsyncData asyncData, Nullable`1 passId)\n   at Microsoft.Web.Deployment.DeploymentAgent.HandleRequestWorker(DeploymentAgentAsyncData asyncData)\n   at Microsoft.Web.Deployment.DeploymentAgent.HandleRequest(DeploymentAgentAsyncData asyncData)\n</code></pre>\n\n<p>What might be causing this issue?</p>\n\n<p>The error Visual studio gives me is:\nError   2   Web deployment task failed. ((1-10-2012 18:54:34) An error occurred when the request was processed on the remote computer.)</p>\n\n<p>(1-10-2012 18:54:34) An error occurred when the request was processed on the remote computer.\nThe server experienced an issue processing the request. Contact the server administrator for more information.      0   0   Database</p>\n\n<p>--FIX--</p>\n\n<p>For some reason my installation of Webdeploy 3 did not work well (tried reinstalling too) with ms authentication, created a sql auth connectionstring and it resolved the issue.</p>\n"},{"tags":["c#","linq","entity-framework","dynamic-linq"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":66,"score":0,"question_id":12694444,"title":"Dynamic LINQ nested selects","body":"<p>I'm trying to come up with a Dynamic LINQ query that will let me select properties from nested  entity collections. I want to get a list of roles with some associated user information for each role. I will, of course, actually be returning role information, but I left that out of this example because it is trivial.</p>\n\n<p>This LINQ query gives me the information I need:</p>\n\n<pre><code>ROLES.Select(r =&gt; new { ID = r.ID, USER_ROLES = r.USER_ROLES.Select(ur =&gt; new { ID = ur.ID, USER = new { ID = ur.USER.ID, USERNAME = ur.USER.USERNAME } } ) })\n</code></pre>\n\n<p>The results will be serialized to JSON and should contain:</p>\n\n<pre><code>[\n  {ID: 1, USER_ROLES: [\n    {ID: 100, USER: {ID: 3, USERNAME: 'code0100fun'} }\n  ] },\n  {ID: 2, USER_ROLES: [\n    {ID: 100, USER: {ID: 3, USERNAME: 'code0100fun'} },\n    {ID: 101, USER: {ID: 4, USERNAME: 'somedude'   } }\n  ] }\n]\n</code></pre>\n\n<p>What would the Dynamic LINQ (System.Linq.Dynamic) query for this look like?</p>\n"},{"tags":["c#","entity-framework","excel","ado.net","odata"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":1116,"score":2,"question_id":6269868,"title":"Alternatives to the Entity Framework for Serving/Consuming an OData Interface","body":"<p>I'm researching how to set up an OData interface to our database.  I would like to be able to pull/query data from our DB into Excel, as a start.  Eventually I would like to have Excel run queries and pull data over HTTP from a remote client, including authentication, etc.</p>\n\n<p>I've set up a working (rickety) prototype so far, using the ADO.NET Entity Data Model wizard in Visual Studio, and VSTO to create a test Excel worksheet with a button to pull from that ADO.NET interface.  This works OK so far, and I can query the DB using Linq through the entities/objects that are created by the ADO.NET EDM wizard.</p>\n\n<p>However, I have started to run into some problems with this approach.  I've been finding the Entity Framework difficult to work with (and in fact, also difficult to research solutions to, as there's a lot of chaff out there regarding it and older versions of it).  An example of this is my being unable to figure out how to set the SQL command timeout (as opposed to the HTTP request timeout) on the DataServiceContext object that the wizard generates for my schema, but that's not the point of my question.</p>\n\n<p>The real question I have is, if I want to use OData as my interface standard, am I stuck with the Entity Framework?  Are there any other solutions out there (preferably open source) which can set up, serve and consume an OData interface, and are easier to work with and less bloated than the Entity Framework?  I have seen mention of NHibernate as an alternative, but most of the comparison threads I've seen are a few years old.  Are there any other alternatives out there now?</p>\n\n<p>Thanks very much!</p>\n"},{"tags":["sql","linq","entity-framework","entity-framework-4"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":43,"score":3,"question_id":12692640,"title":"Getting SQL string from LINQ to EF query","body":"<p>What is the most efficient way to get the sql query from EF? I need this so I can run the query analysis and find its execution plan.</p>\n\n<p>I know I can hook profiler to SQL server, but this step is a pain and a tremendous hit on productivity, almost enough to give up ORM altogether.</p>\n\n<p>Is there a better, more efficient way to optimize EF queries? </p>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12689761,"title":"When should I use complex types in EF with SP that returns entities","body":"<p>I'm new to EF, with the help of tutorials I developed code for my application. </p>\n\n<p>In this process I got this problem, when should I create Complex type for a SP that return entities? As I understood, it is good practice to create CT for a SP that returns selected columns from table (entity that is different from entities in EDM). </p>\n\n<p>For instance if my table is like</p>\n\n<pre><code>MyTableName {name, age, Bgroup, address, Gender, emailid, rowversion}\n</code></pre>\n\n<p>if SP returns <code>name, age, Bgroup, address, Gender, emailid</code> except <code>rowversion</code> even if I exclude 1 column do I need to create Complex Type?</p>\n"},{"tags":["linq","entity-framework","entity-framework-4","linq-to-entities","dynamic-linq"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12642187,"title":"System.Linq.Dynamic to select a collection inside of a collection from Entity Framework IQueryable","body":"<p>I have an EF model with the relationship User->Roles. It's a one to many relationship in our database. I would like to select the ID from role's record and the name from the user's records.\nWhat I have come up with works for one-to-one relationships. I'm not sure how to generate the a list inside of dynamic linq.  Maybe a <code>SelectMany</code>?</p>\n\n<p>User table: Users</p>\n\n<p>Join Table: User_Role</p>\n\n<p>Role Table: Roles</p>\n\n<pre><code> //does not select inside a collection of USER_ROLES\n q= query.Select(\" new ( ID, (new (USER_ROLES.ID as ID) as USER)\")\n\n //not valid\n //q = query.Select(\" new ( ID, (new List&lt;Object&gt; (USER_ROLES.ID as ID) as USER)\")   something I figure this would give me a list of User_Role's ID\n\n //not valid\n //q = query.Select(\" new ( ID, (new List&lt;Object&gt; (USER_ROLES.ROLE.ID as ID) as USER)\")       something I figure this would give me a list of Role's ID\n</code></pre>\n\n<hr>\n\n<p>Update I'm getting closer.  I used a selectmany, but the results are duplicated</p>\n\n<pre><code>q = query.SelectMany(\"USER_ROLES\",\"new (inner as myUSER,outer as myROLE) \").SelectD(\"new (myROLE.ID as ROLE_ID, new( myROLE.NAME, myUSER.USER.FIRSTNAME,myUSER.USER.ID)as user)\")\n</code></pre>\n\n<p>The results look like this:</p>\n\n<pre><code> Role-&gt;User_Role A-&gt; User A\n       User_Role A-&gt; User B    ..notice the repeat of \"User_Role A\" \n       User_Role A-&gt; User C\n</code></pre>\n\n<p>it should be </p>\n\n<pre><code>     Role-&gt;User Role a -&gt; User A\n                         + User B\n                         + User C\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":5,"favorite_count":1,"up_vote_count":20,"down_vote_count":0,"view_count":32518,"score":20,"question_id":179700,"title":"Get the name of a class as a string in C#","body":"<p>Is there a way to take a class name and convert it to a string in C#? </p>\n\n<p>As part of the Entity Framework, the .Include method takes in a dot-delimited list of strings to join on when performing a query. I have the class model of what I want to join, and for reasons of refactoring and future code maintenance, I want to be able to have compile-time safety when referencing this class.</p>\n\n<p>Thus, is there a way that I could do this:</p>\n\n<pre><code>class Foo\n{\n}\n\ntblBar.Include ( Foo.GetType().ToString() );\n</code></pre>\n\n<p>I don't think I can do GetType() without an instance. Any ideas?</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":85,"score":0,"question_id":12646669,"title":"TryGetObjectByKey not compiling in .net 4.5","body":"<p>I have the following code that does a great job at saving a detached object in a .Net 4 / EF 4 project.  I wanted to use that code in a new .Net 4.5 / EF 5 project.  I copied it in and now it gives me a compile error of:</p>\n\n<p>\"MyEntities does not contain a definition for 'TryGetObjectByKey' and no extension method 'TryGetObjectByKey' accepting a first argument of type MyEntities could be found (are you missing a using directive or an assembly reference?)\"</p>\n\n<p>Allegedly it is in the System.Data.Objects namespace (so I have a using for it) from the System.Data.Entity assembly (.dll) which is referenced.</p>\n\n<pre><code>public bool UpdateChanged(IEntityWithKey DetachedObject = null) {\n    bool Result = false;\n\n    try {\n        using (MyEntities db = new MyEntities()) {\n            if (DetachedObject != null) {\n                object Original = null;\n\n                if (db.TryGetObjectByKey(DetachedObject.EntityKey, out Original))\n                    db.ApplyCurrentValues(DetachedObject.EntityKey.EntitySetName, DetachedObject);\n            } // if they want to Update an Entity\n\n            db.SaveChanges();\n            Result = true;\n        } // using the database\n    } catch (Exception e) {\n\n    } // try-catch\n\n    return Result;\n} // UpdateChanged - Method\n</code></pre>\n\n<p>According to this link it should work: <a href=\"http://msdn.microsoft.com/en-us/library/bb738728.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb738728.aspx</a></p>\n\n<p>Can you please help?</p>\n\n<p><strong>UPDATE / SOLUTION:</strong></p>\n\n<p>Based on @Rowan's answer below I have simply modified my Save method to something like the following instead of creating an UpdateChanged method that takes Detached objects:</p>\n\n<pre><code>using (MyEntities db = new MyEntities()) {\n    if (o.ID &gt; 0) {\n        // Existing Owner\n        db.Owners.Attach(o);\n        db.Entry(o).State = EntityState.Modified;\n        db.Entry(o.Address).State = EntityState.Modified;\n    } else {\n        // New Owner\n        db.Owners.Add(o);\n    } // if this is a New Owner\n\n    db.SaveChanges();\n} // using the database\n</code></pre>\n"},{"tags":[".net","entity-framework","entity-framework-4","sqlconnection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":311,"score":0,"question_id":9773360,"title":"EntityConnection and Opened SqlConnection","body":"<p>I've a question about EntityFramework with CodeFirst approach. Based on  EntityConnection source code and documentation I can't create it with already opened SqlConnection. It requires that is should be closed.\nWe have some different DB data layers(nHibernate,etc), and it would be good, if we can reuse the same SqlConnection between them. But seems, that EntityFramework doesn't allow to do this. I can pass closed SqlConnection to DbContext, but it isn't good for me to close connection for each DbContext.</p>\n\n<p>Is there a way to reuse opened sql connection?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>After EF goes to OpenSource I was able to update it. The only line I changed is in the constructor of System.Data.Entity.Core.EntityClient.EntityConnection class.</p>\n\n<pre><code>if (connection.State != ConnectionState.Closed)\n{\n//throw new ArgumentException(Strings.EntityClient_ConnectionMustBeClosed);\n}\n</code></pre>\n\n<p>After I commented throw exception, I can able to reuse existing opened SQL Connection, and after DBContext used it, it won't close it, and it was still available to other stuff.</p>\n\n<p>My sample code:</p>\n\n<pre><code>var connection = new SqlConnection(connectionString);\nconnection.Open();\n\nMetadataWorkspace workspace = GetWorkspace(connection); // I loaded it from the same context, and save it in memory.\n\nEntityConnection eConnection = new EntityConnection(workspace, connection);\n\nusing(var context = new EFContext(connection, false))\n{\n    var someData = context.SomeTable.ToList();\n}\n\nconnection.Close();\n</code></pre>\n"}]}
{"total":18927,"page":15,"pagesize":100,"questions":[{"tags":["asp.net-mvc","entity-framework","dependency-injection","ninject","simple-injector"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":420,"score":2,"question_id":11042357,"title":"Unable to Create DbContext per Request with Simple Injector","body":"<p>Simple Inject is throwing the following exception when attempting to register my DbContext. </p>\n\n<blockquote>\n  <p>The supplied connection string is not valid, because it contains insufficient mapping or metadata information.\n  Parameter name: connectionString</p>\n</blockquote>\n\n<p>I'm new to DI and could be missing something fairly obvious. The connection string looks fine. It is the same one that gets used to create the DbContext normally. I was attempting the solution <a href=\"http://stackoverflow.com/a/8927881/965935\">here</a></p>\n\n<pre><code>public static class SimpleInjectorInitializer\n{\n    /// &lt;summary&gt;Initialize the container and register \n    // it as MVC3 Dependency Resolver.&lt;/summary&gt;\n    public static void Initialize()\n    {\n        var container = new Container();            \n        InitializeContainer(container);\n        container.RegisterMvcControllers(\n            Assembly.GetExecutingAssembly());            \n        container.RegisterMvcAttributeFilterProvider();       \n        container.Verify();            \n        DependencyResolver.SetResolver(\n            new SimpleInjectorDependencyResolver(container));\n    }\n\n    private static void InitializeContainer(\n        Container container)\n    {\n    }\n}\n</code></pre>\n\n<p>Update: I still haven't solved my issue, but it is very similar to this issue with <a href=\"https://groups.google.com/forum/?fromgroups#!topic/ninject/4PKxjPT-BIA\" rel=\"nofollow\">Ninject</a></p>\n\n<p>Stack Trace: </p>\n\n<pre><code>System.InvalidOperationException was unhandled by user code\n  Message=The configuration is invalid. Creating the instance for type _AccountController failed. Error occurred while trying to get an instance of type _AccountController. The type initializer for 'Web.Controllers._AccountController' threw an exception.\n  Source=SimpleInjector\n  StackTrace:\n       at SimpleInjector.Helpers.Verify(IInstanceProducer instanceProducer, Type serviceType)\n       at SimpleInjector.Container.ValidateRegistrations()\n       at SimpleInjector.Container.Verify()\n       at Web.App_Start.SimpleInjectorInitializer.Initialize() in C:\\workspace\\BrowsarServer\\QARSite\\Web\\App_Start\\SimpleInjectorInitializer.cs:line 24\n  InnerException: SimpleInjector.ActivationException\n       Message=Error occurred while trying to get an instance of type _AccountController. The type initializer for 'Web.Controllers._AccountController' threw an exception.\n       Source=SimpleInjector\n       StackTrace:\n            at SimpleInjector.InstanceProducers.InstanceProducer.ThrowErrorWhileTryingToGetInstanceOfType(Exception innerException)\n            at SimpleInjector.InstanceProducers.InstanceProducer.GetInstance()\n            at SimpleInjector.Helpers.Verify(IInstanceProducer instanceProducer, Type serviceType)\n       InnerException: System.TypeInitializationException\n            Message=The type initializer for 'Web.Controllers._AccountController' threw an exception.\n            Source=Web\n            TypeName=Web.Controllers._AccountController\n            StackTrace:\n                 at Web.Controllers._AccountController..ctor()\n                 at lambda_method(Closure )\n                 at SimpleInjector.InstanceProducers.InstanceProducer.GetInstance()\n            InnerException: System.ArgumentException\n                 Message=The supplied connection string is not valid, because it contains insufficient mapping or metadata information.\nParameter name: connectionString\n                 Source=System.Data.Entity\n                 ParamName=connectionString\n                 StackTrace:\n                      at System.Data.Objects.ObjectContext..ctor(EntityConnection connection, Boolean isConnectionConstructor)\n                      at System.Data.Objects.ObjectContext..ctor(String connectionString, String defaultContainerName)\n                      at Web.Models.BrowsarEntities..ctor() in C:\\workspace\\BrowsarServer\\QARSite\\Web\\Models\\Browsar.Designer.cs:line 90\n                      at Web.Controllers._AccountController..cctor() in C:\\workspace\\BrowsarServer\\QARSite\\Web\\Controllers\\_AccountController.cs:line 15\n                 InnerException: System.InvalidOperationException\n                      Message=Unable to determine application context. The ASP.NET application path could not be resolved.\n                      Source=System.Data.Entity\n                      StackTrace:\n                           at System.Data.Metadata.Edm.AspProxy.GetBuildManagerReferencedAssemblies()\n                           at System.Data.Metadata.Edm.DefaultAssemblyResolver.GetAllDiscoverableAssemblies()\n                           at System.Data.Metadata.Edm.DefaultAssemblyResolver.GetWildcardAssemblies()\n                           at System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.LoadResources(String assemblyName, String resourceName, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver)\n                           at System.Data.Metadata.Edm.MetadataArtifactLoaderCompositeResource.CreateResourceLoader(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver)\n                           at System.Data.Metadata.Edm.MetadataArtifactLoader.Create(String path, ExtensionCheck extensionCheck, String validExtension, ICollection`1 uriRegistry, MetadataArtifactAssemblyResolver resolver)\n                           at System.Data.Metadata.Edm.MetadataCache.SplitPaths(String paths)\n                           at System.Data.Common.Utils.Memoizer`2.&lt;&gt;c__DisplayClass2.&lt;Evaluate&gt;b__0()\n                           at System.Data.Common.Utils.Memoizer`2.Result.GetValue()\n                           at System.Data.Common.Utils.Memoizer`2.Evaluate(TArg arg)\n                           at System.Data.EntityClient.EntityConnection.GetMetadataWorkspace(Boolean initializeAllCollections)\n                           at System.Data.Objects.ObjectContext.RetrieveMetadataWorkspaceFromConnection()\n                           at System.Data.Objects.ObjectContext..ctor(EntityConnection connection, Boolean isConnectionConstructor)\n                      InnerException: System.Reflection.TargetInvocationException\n                           Message=Exception has been thrown by the target of an invocation.\n                           Source=mscorlib\n                           StackTrace:\n                                at System.RuntimeMethodHandle._InvokeMethodFast(IRuntimeMethodInfo method, Object target, Object[] arguments, SignatureStruct&amp; sig, MethodAttributes methodAttributes, RuntimeType typeOwner)\n                                at System.RuntimeMethodHandle.InvokeMethodFast(IRuntimeMethodInfo method, Object target, Object[] arguments, Signature sig, MethodAttributes methodAttributes, RuntimeType typeOwner)\n                                at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture, Boolean skipVisibilityChecks)\n                                at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)\n                                at System.Data.Metadata.Edm.AspProxy.GetBuildManagerReferencedAssemblies()\n                           InnerException: System.InvalidOperationException\n                                Message=This method cannot be called during the application's pre-start initialization stage.\n                                Source=System.Web\n                                StackTrace:\n                                     at System.Web.Compilation.BuildManager.EnsureTopLevelFilesCompiled()\n                                     at System.Web.Compilation.BuildManager.GetReferencedAssemblies()\n                                InnerException: \n</code></pre>\n"},{"tags":["asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12501895,"title":"EF: Update entity stored in session","body":"<p>I'm using EF 5 with Web Forms (ASP.NET 4.5), with the \"one DbContext instance per request\" approach. </p>\n\n<p>But this situation is a bit complicated: I have a multi-step create/edit screen, and I store the current entity in Session, then I manipulate it and in the final step, I commit it to the Database.</p>\n\n<p>Creating a new instance was fine, but I can't for the life of me edit an existing entity... Because it's another request, my original DbContext instance was lost and when I attach it to a new one, I get the <strong>An entity object cannot be referenced by multiple instances of IEntityChangeTracker</strong> error.</p>\n\n<p>My code is far too complex to post here, but I'll try and summarize it accurately:</p>\n\n<p>My DbContext:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class AppContext : DbContext\n{\n    // DbSet declarations...\n\n    public static AppContext Current { \n         get { var context = HttpContext.Current.Items[\"Contexts.AppContext\"] as AppContext;\n             if (context == null)\n             {\n                 context = new AppContext();\n                 HttpContext.Current.Items[\"Contexts.AppContext\"] = context;\n             }\n             return context; \n         }\n    }\n}\n</code></pre>\n\n<p>An example of what the page code looks like:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>protected void Page_Load(object sender, EventArgs e)\n{\n    int? id = null; // After this, I try to get it from the QueryString, parse it, etc.. Omitted for sake of brevity \n\n    // If I have an ID, it means I'm editing...\n    Session[\"Product\"] = id.HasValue ? new Product() : AppContext.Current.Products.Find(id));\n\n    MethodToPopulateFields(); // Internally, it uses the Session variable\n}\n\nprotected void Step1(){ // through n\n    // Manipulates the Session[\"Product\"] based on page input...\n}\n\nprotected void Save(){\n    var product = Session[\"Product\"] as Product;\n\n    if(product.ID == 0)\n        product = AppContext.Current.Products.Add(product);\n\n    // throws an exception:\n    // AppContext.Current.Entry(product).State = EntityState.Modified;\n\n    // this too:\n    // AppContext.Products.Attach(product);\n\n    AppContext.Current.SaveChanges();\n}\n</code></pre>\n\n<p>I know I can get the old entity from the database, update it manually and save, all in the last step, but I really don't want to do that...</p>\n\n<p>Thank you.</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12689334,"title":"Performance DbContext Linq Query versus ObjectContext Linq Query","body":"<p>I just had a look at Performance Considerations for Entity Framework 5:\n<a href=\"http://msdn.microsoft.com/en-us/data/hh949853.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/data/hh949853.aspx</a></p>\n\n<p>In 6.7 a graph it shown that states that the performance of a ObjectContext Linq Query is better than DbContext Linq Query. Any idea why?</p>\n"},{"tags":["entity-framework","mapping","iqueryable","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":160,"score":0,"question_id":12689243,"title":"EF5 Mapping IQueryable to custom class with Column Attributes","body":"<p>Okay so here is the problem, I have got a view in the database that contains a-lot of information, 100ish columns, vwComponantA</p>\n\n<p>I have an entity within my .net app called ComponantA which contains all the mappings using [Column()] attributes, that fine, that works, but is slow because it does a select * on the DB to populate the object, again this works.</p>\n\n<p>To get around the performance issues of above I introduced DynamicLinq. This allows me to cut down the amount of columns I bring back and still allows me to use type safety to dow querying using normal Linq which is great. To then deal with the cut down field I bring back I have seperate POCO componants, each with there own set of [Column] attributes on that get mapped at run time using a mapping class.</p>\n\n<p>The problem is that mapping between these can be quite slow when dealing with large datasets, 10000 records maps 10000 times etc. What EF does is to create a DynamicProxyClass that you then map between your component.</p>\n\n<p>My question is, how can I avoid the mapping and let EF do the mapping for me? (I am dealing with <code>IQueryable</code> NOT <code>IQueryable&lt;T&gt;</code> because of dynamic linq)</p>\n\n<p>There has to be a way to leverage the [Column] attributes whilst keeping the query dynamic.</p>\n\n<p>This is all code first and entity framework 5.</p>\n\n<p>Thanks for any help. Nick</p>\n"},{"tags":["entity-framework","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12688420,"title":"EF 5. Intersection performance","body":"<p>I am using Entity Framework 5 and I have the entities: Users, Roles and Files.</p>\n\n<p>I need to check if two list of roles have at least one item in common:</p>\n\n<pre><code>List&lt;Role&gt; a = user.Roles;\nList&lt;Role&gt; b = file.Roles;\n\nBoolean commonRoleFound = a.Intersect(b).Count() &gt; 0;\n</code></pre>\n\n<p>Is there a better way to do this? Maybe using ANY? Maybe other?</p>\n\n<p>What would be the option with better performance?</p>\n\n<p>Thank You,\nMiguel</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12688091,"title":"Amending Users And Roles With The Entity Framework","body":"<p>I have the typical set up of a Users table, a Roles table and a UsersInRoles join table in the middle. The UsersInRoles uses both the UserID from Users and the RoleId from Roles as a dual key. It's almost identical to the standard membership provider but customised with a few additional params on the user.</p>\n\n<p>I have the DbContext set up so that it works doing this join.</p>\n\n<pre><code>modelBuilder.Entity&lt;User&gt;()\n            .HasMany(u =&gt; u.Roles)\n            .WithMany(r =&gt; r.Users)\n            .Map(m =&gt;\n            {\n                m.ToTable(\"UsersInRoles\");\n                m.MapLeftKey(\"UserId\");\n                m.MapRightKey(\"RoleId\");\n            });\n</code></pre>\n\n<p>I have an admin controller that allows users in the admin role to amend other users. I can retrieve the user and associated roles fine, but I can't seem to update them because the key in UsersInRoles keeps getting violated because the same values appear to be trying to be entered.</p>\n\n<p>The edit form uses a view model that has the user and also takes a list of all the roles, so that I can show which roles the user is in. The roles are shown as a list of tick boxes which are posted back as form data. I use the keys on the form data to get the roles and then associate to the user, like this:</p>\n\n<pre><code>public ActionResult Edit(User user, FormCollection formValues)\n    {\n        var originalUser = _db.Users.Find(user.UserId);\n\n        originalUser.Roles = (from x in _db.Roles join y in formValues.AllKeys on x.RoleName equals y select x).ToList();\n</code></pre>\n\n<p>and then I try and save the user back to the db with the changes</p>\n\n<pre><code>if (ModelState.IsValid)\n        {\n            _db.Entry(originalUser).State = EntityState.Modified;\n            _db.SaveChanges();\n</code></pre>\n\n<p>There are times, usually when I step through the code, the changes are saved, but most of the time, and definitely when the code is just left to run without debugging, I get an exception that:</p>\n\n<pre><code>Violation of PRIMARY KEY constraint 'PK_UsersInRoles'. Cannot insert duplicate key in object 'dbo.UsersInRoles'. The duplicate key value is...\n</code></pre>\n\n<p>Clearly I don't want duplicate rows entering into UsersInRoles so I don't want to turn the constraint off. Is there a reason why the Entity Framework doesn't recognise that the user is the same and just amend the corresponding rows?</p>\n\n<p>Thanks in advance for any help.</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2589,"score":0,"question_id":2142597,"title":"Entity Framework - Correct way to check for single records before using them","body":"<p>To get a LIST of records I normally do something along the lines of:</p>\n\n<pre><code>var efCompany = from a in _dbRiv.Company where a.CompanyId == companyFeedInfo.CompanyId select a;\n</code></pre>\n\n<p>To get a single record, when I know I am using the PK to retrieve it, I use something like:</p>\n\n<pre><code>var efCompany = (from a in _dbRiv.Company where a.CompanyId == companyFeedInfo.CompanyId select a).First();\n</code></pre>\n\n<p>Now, using the single record approach, if the PK is a faulty value (like it purposefully is in testing) the 2nd line throws an error.</p>\n\n<p>What is the <strong>best practice</strong> way of getting a single record and dealing with it?</p>\n"},{"tags":["c#",".net","entity-framework","visual-studio-2012","one-click-web-publishing"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":129,"score":1,"question_id":12674771,"title":"Why could \"update database\" be missing in visual studio 2012 when publishing?","body":"<p>I'm trying to deploy an application to my webserver and everything works, except that it does not update the remote database.</p>\n\n<p>With a new demo MVC project you have the option \"Update database\" when publishing \nFor some reason that options is not available when I want to publish my own MVC project.</p>\n\n<p>Why is this option not showing?</p>\n\n<ul>\n<li>I am using EF (database first)</li>\n<li>I am getting a warning under the connectionstring fields: in order to publish a code first model you must enable EF code first migrations. (<em>although this project should not use code first</em>)</li>\n<li>Web Deploy 3.0 and the dbDacFx provider are installed on the server</li>\n</ul>\n\n<p>-- EDIT --\nI have now recreated the project, and the update database keeps showing <em>until the first web publish</em>. then it just disappears and shows the warning <em>in order to publish a code first model you must enable EF code first migrations</em>. (although im not using code first, im using database first) Is this a bug in VS or what am I doing wrong?</p>\n\n<p>--FIX--\nI got it working by adding another connection string pointing to my database (without EF interference) in web.config: <code>&lt;add name=\"DeployCode\" connectionString=\"Data Source=(localdb)\\Projects;Initial Catalog=xxxxx;Integrated Security=True;Connect Timeout=30;Encrypt=False;TrustServerCertificate=False;\" providerName=\"System.Data.SqlClient\" /&gt;</code> </p>\n"},{"tags":["entity-framework","lazy-loading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12639332,"title":"EF: One-to-many relationship - querying for a subset of the data","body":"<p>I am trying to fetch a collection of entities from a one-to-many relationship as an IQueryable so I can filter the data down before fetching this from the database. </p>\n\n<p>To make it clear, consider the following example: </p>\n\n<p>I currently have an entity \"User\" which has a collection of Pictures: </p>\n\n<pre><code>public virtual ICollection&lt;Picture&gt; Pictures{ get; set; }\n</code></pre>\n\n<p>The Picture entity may or may not belong to a User, and hence, doesnt have the User property in its definition.</p>\n\n<p>A user may have thousands of pictures, but I would like to select the first 10 for example, ordered by Picture.Id. Is there a way to do this?</p>\n\n<p>Maybe something along the lines like: </p>\n\n<pre><code>IQueryable&lt;ICollection&lt;Picture&gt;&gt; pictures = context.Users.Where(u=&gt;u.UserId == userId).Select(c =&gt; c.Pictures) \n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":[".net","linq","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":12673727,"title":"Searching in EF in string/xml","body":"<p>I am working on a web application which uses EF with mysql. The search is getting complicated so i thought about creating a searchTable where i will put all my data which are required for search filters. works pretty well for one to one tables but what about one to many, how should I save that in one row? for example experiences or qualifications etc. the problem is how to put that part in search criteria in EF/Linq? like get users who have the qualification mba.</p>\n\n<pre><code>  for (int i = 0; i &lt; searchFilter.Count; i++)\n        {\n            keyValuePair = searchFilter.ElementAt(i);\n            if (keyValuePair.Key.Equals(\"FullName\"))\n            {\n                whereClause.Add(\"FullName.Contains(@\" + i + \")\");\n                whereValues.Add(keyValuePair.Value);\n            }\n\n           ....\n\n\n            if (keyValuePair.Key.Equals(\"City\"))\n            {\n                whereClause.Add(\"AddressCity.Contains(@\" + i + \")\");\n                whereValues.Add(keyValuePair.Value);\n            }\n        }\n\n        StringBuilder str = new StringBuilder();\n        for (int i = 0; i &lt; whereClause.Count; i++)\n        {\n            str.Append(whereClause[i]).Append(\" &amp;&amp; \");\n        }\n\n        string strWhere = str.ToString().TrimEnd(\" &amp;&amp; \"); //hypothetical code \n\n\n        AcmeDB db = new AcmeDB();\n        var searchResult = db.SearchSummaries.Where(strWhere, whereValues);\n\n        return searchResult;\n</code></pre>\n\n<p>Now if i want to search through lets say experiences, how to do that? because this table contains everything i need to search from in single row per user, so i want to have name,username, address, qualifications, experiences etc  in one row. I hope i am explaining it right?</p>\n"},{"tags":["c#","wpf","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12683405,"title":"Retain EF Code First model in memory","body":"<p>I have few different wpf windows, for example sales.xaml, buy.xaml.</p>\n\n<p>Both of the windows is using the same EF code first model, sales.cs.</p>\n\n<p>I have added some value to the sales model in sales.xaml, how can I retrieve the same model in buy.xaml from sales.xaml, when the sales.xaml is close.</p>\n\n<p>If I didn't make the model attributes to static, the data will be lost.</p>\n\n<p>Thank you.</p>\n"},{"tags":["asp.net-mvc","entity-framework","entity-framework-4","mapping","fluent-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12680571,"title":"EF Many to Many Relationship on 3 Tables(Fluent API)","body":"<p>I have 3 tables that needs to be combined in one table. On below you can see the codes. </p>\n\n<p>The problem is each player could play on one or more team on each tournament. Players and teams arranger by every new tournament. </p>\n\n<p>So how can i map it with fluent api or maybe there is a better way to solve it. Thanks from now on.</p>\n\n<pre><code> public class Player\n    {\n        public int PlayerID { get; set; }\n        public string FirstName { get; set; }\n        public string LastName { get; set; }\n        public string Phone { get; set; }\n        public DateTime TimeStamp { get; set; }\n        public ICollection&lt;Team&gt; Teams { get; set; }\n        public ICollection&lt;Tournament&gt; Tournaments { get; set; }\n\n    }\n\npublic class Team\n    {\n        public int TeamID { get; set; }\n        public string Name { get; set; }\n        public DateTime TimeStamp { get; set; }\n        public ICollection&lt;Player&gt; Players { get; set; }\n        public ICollection&lt;Tournament&gt; Tournaments { get; set; }\n    }\n\npublic class Tournament\n    {\n        public int TournamentID { get; set; }\n        public DateTime Date { get; set; }\n        public int PlaceID { get; set; }\n        public DateTime TimeStamp { get; set; }\n        public virtual Place Place { get; set; }\n        public ICollection&lt;Player&gt; Players { get; set; }\n        public ICollection&lt;Team&gt; Teams { get; set; }\n    }\n\n\n\n  public class BPContext : DbContext\n    {\n        public DbSet&lt;Tournament&gt; Tournaments { get; set; }\n        public DbSet&lt;Place&gt; Places { get; set; }\n        public DbSet&lt;Table&gt; Tables { get; set; }\n        public DbSet&lt;Player&gt; Players { get; set; }\n        public DbSet&lt;Team&gt; Teams { get; set; }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n\n        }\n    }\n</code></pre>\n"},{"tags":["mysql","visual-studio","entity-framework","datasource"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":643,"score":0,"question_id":12684047,"title":"mySQL DataSource on Visual Studio 2012","body":"<p>I've been reading about mySQL DataSource and the ability to use mySQL with Entity Framework, but I can't really generate EF with mySQL without the use of the DataSource Dialog</p>\n\n<p><img src=\"http://i.stack.imgur.com/sOxyV.png\" alt=\"enter image description here\"></p>\n\n<p>How can I add mySQL Database to such dialog? </p>\n\n<p>This is what I have done so far:</p>\n\n<ul>\n<li>Installed <a href=\"http://dev.mysql.com/downloads/connector/net/\" rel=\"nofollow\">mySQL Connector</a> v.6.5.4</li>\n<li>Restarted n-times my Windows 7 machine</li>\n<li>Read all about how well mySQL Connector works on previous versions of Visual Studio</li>\n</ul>\n"},{"tags":["c#","asp.net-mvc","asp.net-mvc-3","entity-framework"],"answer_count":7,"favorite_count":2,"up_vote_count":3,"down_vote_count":1,"view_count":195,"score":2,"question_id":12678833,"title":"C# - when to use public int virtual, and when to just use public int","body":"<p>I am working through a tutorial 'Professional ASP.NET MVC 3' by J Galloway. In this tutorial, Jon shows us how to build the MVC music store.</p>\n\n<p>I am at the part where we are creating CS classes to model the data using EF code first.</p>\n\n<p>I <strong>all</strong> the examples in the book, <code>public virtual int property {get; set; }</code> is used with no explanation. The term virtual is stuffed EVERYWHERE.</p>\n\n<p>Elsewhere on the web, I have not seen the term virtual used with any kind of concistency whatsoever.</p>\n\n<p>Could anybody explain to me:</p>\n\n<ol>\n<li>The purpose of the term 'virtual' in this particular context</li>\n<li>Is using 'virtual' necessary?</li>\n<li>Why do some people use 'virtual' and others do not?</li>\n<li>Why do some people only use 'virtual' when defining foreign keys?</li>\n<li>What is the best practice use of the term 'virtual'?</li>\n</ol>\n\n<p>Many thanks in advance</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12682814,"title":"How can I generate MetadataType Class automatically from the Domain class?","body":"<p>I have a standard EF5 generated Domain Class ie Customer. I need to create a \"buddy\" class for this domain class via an additional partial class which is annotated with \"MetadataType\". Is it possible to generate this in an automated way from the domain class? At present I am copying, pasting and editting to create the new partial class.</p>\n\n<p>Many thanks.</p>\n"},{"tags":["sql-server","asp.net-mvc-3","linq","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":210,"score":0,"question_id":12646899,"title":"Weird Entity Framework error: login failed for user","body":"<p>I have an application with multiple <code>DbContext</code> subclasses that share a connection string (this is to avoid EF's horrible startup time with a single large <code>DbContext</code> type). At certain points (repeatable for me and somewhat for others), I get the following error when trying to make a database query:</p>\n\n<blockquote>\n  <p><em>System.Data.EntityException: \"The underlying provider failed on Open.\"<br>\n  with inner exception:<br>\n  System.Data.SqlClient.SqlException \"Login failed\n  for user 'username'\"</em></p>\n</blockquote>\n\n<p>The problem appears to go away if I switch back to using a single giant <code>DbContext</code>.</p>\n\n<p>Does anyone know what this means/how to fix it? Would it help if I reused the same <code>DbConnection</code> object across <code>DbContexts</code> (as opposed to just using the same connection string)? This connection string has already succeeded in making several queries in the same request, so it can't be that the credentials are bad.</p>\n\n<p>I am using ASP.NET MVC 3, EF 4.3.1, .NET 4.0, VS 2010.</p>\n\n<p>The relevant stack trace is below:</p>\n\n<pre><code> [SqlException (0x80131904): Login failed for user 'testing_net'.]\n    System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection) +6351920\n    System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning() +412\n    System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj) +1363\n    System.Data.SqlClient.SqlInternalConnectionTds.CompleteLogin(Boolean enlistOK) +53\n    System.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, Boolean redirectedUserInstance, SqlConnection owningObject, SqlConnectionString connectionOptions, TimeoutTimer timeout) +6366878\n    System.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(SqlConnection owningObject, TimeoutTimer timeout, SqlConnectionString connectionOptions, String newPassword, Boolean redirectedUserInstance) +6366793\n    System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, Object providerInfo, String newPassword, SqlConnection owningObject, Boolean  redirectedUserInstance) +352\n    System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection) +831\n    System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnection owningConnection, DbConnectionPool pool, DbConnectionOptions options) +49\n    System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject) +6368598\n    System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject) +78\n    System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject) +2194\n    System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection) +89\n    System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory) +6372110\n    System.Data.SqlClient.SqlConnection.Open() +300\n    System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection  storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure) +67\n\n [EntityException: The underlying provider failed on Open.]\n    System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure) +11108990\n    System.Data.EntityClient.EntityConnection.Open() +142\n    System.Data.Objects.ObjectContext.EnsureConnection() +97\n    System.Data.Objects.ObjectQuery`1.GetResults(Nullable`1 forMergeOption) +57\n    System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable&lt;T&gt;.GetEnumerator() +47\n    System.Linq.Enumerable.Single(IEnumerable`1 source) +156\n</code></pre>\n\n<p>A rough outline of the code is as follows:</p>\n\n<pre><code>// db context:\npublic class MyDbContext&lt;T&gt; : DbContext {\n    public MyDbContext(string connectionString) : base(connectionString) { }\n\n    protected override OnModelCreating(DbModelBuilder builder)\n    {\n        // constructs the model base on the type of T\n        // code first POCO entities are annotated with an attribute that links\n        // them to one or more types T\n    }\n}\n</code></pre>\n\n<p>I use AutoFac's DI to inject my DbContext's into the services my data access layer. The lifespan of the context is length of the HttpRequest.</p>\n\n<p>The actual exception occurs on a call to Queryable.Single().</p>\n\n<p>EDIT: I think <a href=\"http://stackoverflow.com/questions/4987787/entity-framework-giving-exception-the-underlying-provider-failed-on-open\">this</a> question might be relevant, but I'm not sure what to make of the race condition described.</p>\n\n<p>EDIT: Now that I understand the issue, I can post the offending piece of code:</p>\n\n<pre><code>MyDbContext&lt;T1&gt; db1 = ...\nvar connectionString = db1.Database.Connection.ConnectionString; \nvar dbContext2 = new MyDbContext&lt;T2&gt;(connectionString);\n</code></pre>\n"},{"tags":["c#","linq","entity-framework","dynamic-linq"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12681685,"title":"Dynamic linq expression for EF","body":"<p>I'm trying to write some dynamic linq expression for my EF app.</p>\n\n<p>I have an enum that represents a type:</p>\n\n<pre><code>public class MyEntity {\n  public int? One { get; set; }\n  public int? Two { get; set; }\n  public int? Three { get; set; }\n  // other fields..\n}\n\npublic enum MyType {\n  One,\n  Two,\n  Three\n}\n\npublic static Expression&lt;Func&lt;MyEntity, int?&gt;&gt; GetItem(MyType myType) {\n  switch(myType) {\n    case One: return (e) =&gt; e.One;\n    case Two: return (e) =&gt; e.Two;\n    case Three: return (e) =&gt; e.Three;\n    default: throw new NotImplementedException();\n  }\n}\n</code></pre>\n\n<p>Depending on the type, I want to perform queries against it. So for example, I want to see if my type column equals to a certain value:</p>\n\n<pre><code>public static Expression&lt;Func&lt;MyEntity, int?&gt;&gt; EqualsValue(MyType myType, int value) {\n  return Expression.Equal(GetItem(myType), Expression.Constant(value));\n}\n</code></pre>\n\n<p>This is giving me a compiler error that it can't cast from BinaryExpression to Expression>. Is there a better way to do this?</p>\n\n<p>UPDATE:</p>\n\n<p>I would like to use it in the EF like: <code>ctx.MyEntities.Where(EqualsValue(myType, value)).Where(u =&gt; u.UserID == userID)</code> so the return type has to be <code>Expression&lt;Func&lt;MyEntity, int?&gt;&gt;</code>.. I need it to work for Linq to SQL as well as EF DataService.</p>\n"},{"tags":["entity-framework","ef-code-first","inversion-of-control","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":139,"score":0,"question_id":12664636,"title":"EF Code First, IoC and DbConnection","body":"<p>I'm using Entity Framework Code First. I want to be able to inject a <code>System.Data.Common.DbConnection</code> object when instantiating the context that derives from <code>System.Data.Entity.DbContext</code>. This is so that I can pass different types of connections depending on what environment the code is running in, i.e. use <code>System.Data.SqlClient</code> (SQL Server) in development, <code>System.Data.SQLite</code> when unit testing and something else in production. The pertinent parts of <code>Context</code> looks like this:</p>\n\n<pre><code>public class Context : DbContext\n{\n    public Context(DbConnection dbConnection)\n        : base(dbConnection, true)\n    {\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        Database.SetInitializer(new MigrateDatabaseToLatestVersion&lt;Context, Configuration&gt;());\n\n        base.OnModelCreating(modelBuilder);\n    }\n\n    public DbSet&lt;Test&gt; Tests { get; set; }\n}\n</code></pre>\n\n<p>That gives me the following error: <code>The target context 'Services.Persistence.Context' is not constructible. Add a default constructor or provide an implementation of IDbContextFactory.</code> I think this happens during model initialization when Entity Framework apparently feels it needs to new up it's own <code>Context</code>, independent of the IoC pattern I'm trying to achieve. The lack of a default constructor is by design. The <code>IDbContextFactory</code> interface is just as useless - it has to have a default constructor too.</p>\n\n<p>Is Entity Framework Code First completely wedded to the idea of setting up it's config by reading a connectionstring from a config file (or alternatively getting the connectionstring passed directly) or can one work around this?</p>\n\n<p><em>UPDATE</em>, here's the Windsor config:</p>\n\n<pre><code>container.Register(Component\n    .For&lt;DbConnection&gt;()\n    .UsingFactoryMethod(() =&gt;\n        new SqlConnection(\"Data Source=(localdb)\\\\v11.0;Database=ThatProject;MultipleActiveResultSets=true\"))\n    .LifeStyle.Transient);\n\ncontainer.Register(Component\n    .For&lt;Context&gt;()\n    .UsingFactoryMethod(k =&gt; new Context(k.Resolve&lt;DbConnection&gt;()))\n    .LifeStyle.PerWebRequest);\n\ncontainer.Register(Component\n    .For&lt;IRepository&gt;()\n    .UsingFactoryMethod(k =&gt; new Repository(k.Resolve&lt;Context&gt;()))\n    .LifeStyle.PerWebRequest);\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4.1"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":317,"score":4,"question_id":7519315,"title":"EntityFramework4.1's .Local().ToBindingList() , How to filter then?","body":"<p>Example Model: Customer -> Order</p>\n\n<pre><code>contex.Order.Load();\norderBindingSource.DataSource = context.Order.Local().ToBindingList();\n</code></pre>\n\n<p>Then, how to filter? e.g.  <code>context.Order.Where(m=&gt;m.customerID &gt; 1)</code> </p>\n\n<p>I want to get the BindingList implementation that stays in sync with the ObservableCollection returned by the Local property. </p>\n"},{"tags":["c#","entity-framework","dapper","ssdt"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":155,"score":2,"question_id":12680626,"title":"A combination of Entity Framework, Dapper and SSDT?","body":"<p>I'm in the early stages of setting up a new development project and I'm unsure how to set up my database access strategy. I'll be using Visual Studio 2012 and I'll target .NET 4.5 and SQL Server 2008 or 2012. </p>\n\n<p>What I'm unsure about is whether or not to use Entity Framework, and if so, to what degree. As reading data from the database and then processing it will be the main job for this application, query performance will be important. I know that EF5 is a lot better than EF4.x in that respect, but it's not the inherent EF overhead that I'm most worried about (though something like Dapper is still at least twice as fast) but more the laziness it affords you as a developer, because querying too much is so easy through LINQ. So I want pure SQL queries to be the main way to fetch data. </p>\n\n<p>However, what I'll miss most about EF is:</p>\n\n<ol>\n<li>Compile time query checking.</li>\n<li>Change-tracking.</li>\n<li>Code first development.</li>\n<li>Unit of work pattern.</li>\n</ol>\n\n<p>I can live without the change tracking, it's usually not that hard to determine what's new or updated. </p>\n\n<p>What I do want is that the developers on this project will not have to mess around with table designers, but that they can simply write POCOs. So for that, I really appreciate EF's code first approach. With that, a developer can clone the source code, call <code>update-database</code> and have a working local database. It's something that has worked nicely for me in the past.</p>\n\n<p>Another thing that's very important to me is a unit of work pattern, or the atomicity of inserts and updates. I want to queue up all changes and have a single point where I call <code>SaveChanges</code>. With libraries like <code>DapperExtensions</code>, you get a <code>Insert</code> method, but it'll immediately do the database call. You can make it atomic by wrapping a transaction around it, but that's not the same as queuing it up. So I'd have to roll some sort of queuing mechanism myself for this.</p>\n\n<p>For the compile time query checking I consider using SQL Server Data Tools (SSDT). Queries would be stored procedures (to avoid big query string blobs in the C# code) and using SSDT these can be checked at build time. Another advantage of SSDT is that you can deploy the stored procedures from Visual Studio to a target database. And most importantly, the SQL scripts for these would live in source control.</p>\n\n<p>So with that, my solution would basically consist of three data access technologies:</p>\n\n<p><strong>Entity Framework</strong></p>\n\n<ul>\n<li>Would be responsible for creating the database from POCO datamodels.</li>\n<li>Would be used to insert/update data through its unit of work pattern. One caveat would be that you would first have to <code>Attach</code> entities you fetched through SQL to the context.</li>\n</ul>\n\n<p><strong>SSDT</strong></p>\n\n<ul>\n<li>Would be used to verify SQL scripts at compile time.</li>\n<li>Allows the scripts to live in Git.</li>\n<li>Would deploy the things EF can't deploy to your database.</li>\n</ul>\n\n<p><strong>Dapper/other Micro ORM</strong></p>\n\n<ul>\n<li>Would be used to fetch data</li>\n</ul>\n\n<p>I can't help but feel this is a bit of a Frankenstein solution where I use various bits and pieces of everything. I'm also not certain yet that SSDT and EF will work together in a nice way. This quick example seems to work fine though:</p>\n\n<pre><code>// Combo of Dapper, EF and a stored proc that was published through SSDT\nstatic void Main(string[] args)\n{\n  var connectionString = ConfigurationManager\n    .ConnectionStrings[\"DbDataContext\"].ConnectionString;\n\n  using (var conn = new SqlConnection(connectionString))\n  using (var ctx = new DbDataContext())\n  {\n    conn.Open();\n\n    var product = conn.Query&lt;Product&gt;(\"GetProduct\", \n      commandType: CommandType.StoredProcedure).First();\n\n    ctx.Products.Attach(product);\n\n    var order = new Order\n    {\n      Product = product\n    };\n\n    ctx.Orders.Add(order);\n\n    ctx.SaveChanges();\n\n  }\n}\n</code></pre>\n\n<p>This approach seems like it would work, but it's messy too. But if I give up SSDT, I'll miss out on compile time checking of SQL, if I give up Entity Framework, I'll miss out on code-first and easier inserts and if I give up on straight SQL I'll miss out on a big chunk of performance.</p>\n\n<p>Is there an alternative that I'm overlooking? If not, what's the best approach here?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12678633,"title":"Is there a GetObjectType in DbContext?","body":"<p>I'm using POCO proxies and I'd like to get the type of a object.  I've found a few <a href=\"http://www.coding4art.com/archive/2012/03/13/entity-framework-1-ndashhow-to-get-the-original-type-of.aspx\" rel=\"nofollow\">examples</a> using GetObjectType for ObjectContext but I'm using DbContext and I don't see it there.  Is this something I need to add to my repository class so it can have access to the DbContext?  Or am I completely wrong?  Thanks</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":161,"score":0,"question_id":12680291,"title":"Entity framework with autoincrement column","body":"<p>I have read <a href=\"http://stackoverflow.com/questions/8989627/entity-framework-id-auto-incrementing\">several</a> <a href=\"http://stackoverflow.com/questions/3011764/autonumber-with-entity-framework?lq=1\">questions</a> <a href=\"http://stackoverflow.com/questions/3188194/c-entity-framework-auto-increment-problem\">on this</a> already, but I have tried their solution (basically the same with each questions) without success.</p>\n\n<p>I have created a model and used it to update a local database (.sdf) file. Now, I'm trying to add even a single entity and it fails. Meaning that it won't even save any entity. I have set the <code>identity</code> field for my PKs, configured the <code>StoredGeneratedPattern</code> properties, looked at manually setting it directly in the XML (it's there). I still can't save anything. What am I missing?</p>\n\n<p><strong>The entity relation model</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/OPfar.png\" alt=\"enter image description here\"></p>\n\n<p><strong>The model XML config (TestDbEntities.edmx)</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;edmx:Edmx Version=\"2.0\" xmlns:edmx=\"http://schemas.microsoft.com/ado/2008/10/edmx\"&gt;\n  &lt;!-- EF Runtime content --&gt;\n  &lt;edmx:Runtime&gt;\n    &lt;!-- SSDL content --&gt;\n    &lt;edmx:StorageModels&gt;\n    &lt;Schema Namespace=\"TestDbModel.Store\" Alias=\"Self\" Provider=\"System.Data.SqlServerCe.3.5\" ProviderManifestToken=\"3.5\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" xmlns=\"http://schemas.microsoft.com/ado/2009/02/edm/ssdl\"&gt;\n  &lt;EntityContainer Name=\"TestDbModelStoreContainer\"&gt;\n    &lt;EntitySet Name=\"UserMessages\" EntityType=\"TestDbModel.Store.UserMessages\" store:Type=\"Tables\" Schema=\"dbo\" /&gt;\n    &lt;EntitySet Name=\"Users\" EntityType=\"TestDbModel.Store.Users\" store:Type=\"Tables\" Schema=\"dbo\" /&gt;\n    &lt;AssociationSet Name=\"Rel_User_Message\" Association=\"TestDbModel.Store.Rel_User_Message\"&gt;\n      &lt;End Role=\"users\" EntitySet=\"Users\" /&gt;\n      &lt;End Role=\"messages\" EntitySet=\"UserMessages\" /&gt;\n    &lt;/AssociationSet&gt;\n  &lt;/EntityContainer&gt;\n  &lt;EntityType Name=\"UserMessages\"&gt;\n    &lt;Key&gt;\n      &lt;PropertyRef Name=\"ID\" /&gt;\n    &lt;/Key&gt;\n    &lt;Property Name=\"ID\" Type=\"int\" StoreGeneratedPattern=\"Identity\" Nullable=\"false\" /&gt;\n    &lt;Property Name=\"Message\" Type=\"nvarchar\" Nullable=\"true\" MaxLength=\"1000\" /&gt;\n    &lt;Property Name=\"Author_ID\" Type=\"int\" Nullable=\"false\" /&gt;\n  &lt;/EntityType&gt;\n  &lt;EntityType Name=\"Users\"&gt;\n    &lt;Key&gt;\n      &lt;PropertyRef Name=\"ID\" /&gt;\n    &lt;/Key&gt;\n    &lt;Property Name=\"ID\" Type=\"int\" StoreGeneratedPattern=\"Identity\" Nullable=\"false\" /&gt;\n    &lt;Property Name=\"Identity\" Type=\"nvarchar\" Nullable=\"false\" MaxLength=\"100\" /&gt;\n    &lt;Property Name=\"Password\" Type=\"nvarchar\" Nullable=\"false\" MaxLength=\"100\" /&gt;\n    &lt;Property Name=\"Name\" Type=\"nvarchar\" Nullable=\"false\" MaxLength=\"100\" /&gt;\n    &lt;Property Name=\"LastName\" Type=\"nvarchar\" Nullable=\"false\" MaxLength=\"100\" /&gt;\n    &lt;Property Name=\"Active\" Type=\"bit\" Nullable=\"false\" DefaultValue=\"false\" /&gt;\n  &lt;/EntityType&gt;\n  &lt;Association Name=\"Rel_User_Message\"&gt;\n    &lt;End Role=\"users\" Type=\"TestDbModel.Store.Users\" Multiplicity=\"1\" /&gt;\n    &lt;End Role=\"messages\" Type=\"TestDbModel.Store.UserMessages\" Multiplicity=\"*\" /&gt;\n    &lt;ReferentialConstraint&gt;\n      &lt;Principal Role=\"users\"&gt;\n        &lt;PropertyRef Name=\"ID\" /&gt;\n      &lt;/Principal&gt;\n      &lt;Dependent Role=\"messages\"&gt;\n        &lt;PropertyRef Name=\"Author_ID\" /&gt;\n      &lt;/Dependent&gt;\n    &lt;/ReferentialConstraint&gt;\n  &lt;/Association&gt;\n&lt;/Schema&gt;&lt;/edmx:StorageModels&gt;\n    &lt;!-- CSDL content --&gt;\n    &lt;edmx:ConceptualModels&gt;\n      &lt;Schema Namespace=\"TestDbModel\" Alias=\"Self\" xmlns:annotation=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\" xmlns=\"http://schemas.microsoft.com/ado/2008/09/edm\"&gt;\n        &lt;EntityContainer Name=\"TestDbEntities\" annotation:LazyLoadingEnabled=\"true\"&gt;\n          &lt;EntitySet Name=\"UserMessages\" EntityType=\"TestDbModel.UserMessage\" /&gt;\n          &lt;EntitySet Name=\"Users\" EntityType=\"TestDbModel.User\" /&gt;\n          &lt;AssociationSet Name=\"Rel_User_Message\" Association=\"TestDbModel.Rel_User_Message\"&gt;\n            &lt;End Role=\"users\" EntitySet=\"Users\" /&gt;\n            &lt;End Role=\"messages\" EntitySet=\"UserMessages\" /&gt;\n          &lt;/AssociationSet&gt;\n        &lt;/EntityContainer&gt;\n        &lt;EntityType Name=\"UserMessage\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"ID\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Type=\"Int32\" Name=\"ID\" Nullable=\"false\" annotation:StoreGeneratedPattern=\"Identity\" /&gt;\n          &lt;Property Type=\"String\" Name=\"Message\" MaxLength=\"1000\" FixedLength=\"false\" Unicode=\"true\" /&gt;\n          &lt;NavigationProperty Name=\"Author\" Relationship=\"TestDbModel.Rel_User_Message\" FromRole=\"messages\" ToRole=\"users\" /&gt;\n        &lt;/EntityType&gt;\n        &lt;EntityType Name=\"User\"&gt;\n          &lt;Key&gt;\n            &lt;PropertyRef Name=\"ID\" /&gt;\n          &lt;/Key&gt;\n          &lt;Property Type=\"Int32\" Name=\"ID\" Nullable=\"false\" annotation:StoreGeneratedPattern=\"Identity\" /&gt;\n          &lt;Property Type=\"String\" Name=\"Identity\" MaxLength=\"100\" FixedLength=\"false\" Unicode=\"true\" Nullable=\"false\" /&gt;\n          &lt;Property Type=\"String\" Name=\"Password\" MaxLength=\"100\" FixedLength=\"false\" Unicode=\"true\" Nullable=\"false\" /&gt;\n          &lt;Property Type=\"String\" Name=\"Name\" MaxLength=\"100\" FixedLength=\"false\" Unicode=\"true\" Nullable=\"false\" /&gt;\n          &lt;Property Type=\"String\" Name=\"LastName\" MaxLength=\"100\" FixedLength=\"false\" Unicode=\"true\" Nullable=\"false\" /&gt;\n          &lt;Property Type=\"Boolean\" Name=\"Active\" Nullable=\"false\" DefaultValue=\"False\" /&gt;\n          &lt;NavigationProperty Name=\"AuthoredMessages\" Relationship=\"TestDbModel.Rel_User_Message\" FromRole=\"users\" ToRole=\"messages\" /&gt;\n        &lt;/EntityType&gt;\n        &lt;Association Name=\"Rel_User_Message\"&gt;\n          &lt;End Type=\"TestDbModel.User\" Role=\"users\" Multiplicity=\"1\" /&gt;\n          &lt;End Type=\"TestDbModel.UserMessage\" Role=\"messages\" Multiplicity=\"*\" /&gt;\n        &lt;/Association&gt;\n      &lt;/Schema&gt;\n    &lt;/edmx:ConceptualModels&gt;\n    &lt;!-- C-S mapping content --&gt;\n    &lt;edmx:Mappings&gt;\n    &lt;Mapping Space=\"C-S\" xmlns=\"http://schemas.microsoft.com/ado/2008/09/mapping/cs\"&gt;\n  &lt;EntityContainerMapping StorageEntityContainer=\"TestDbModelStoreContainer\" CdmEntityContainer=\"TestDbEntities\"&gt;\n    &lt;EntitySetMapping Name=\"UserMessages\"&gt;\n      &lt;EntityTypeMapping TypeName=\"IsTypeOf(TestDbModel.UserMessage)\"&gt;\n        &lt;MappingFragment StoreEntitySet=\"UserMessages\"&gt;\n          &lt;ScalarProperty Name=\"ID\" ColumnName=\"ID\" /&gt;\n          &lt;ScalarProperty Name=\"Message\" ColumnName=\"Message\" /&gt;\n        &lt;/MappingFragment&gt;\n      &lt;/EntityTypeMapping&gt;\n    &lt;/EntitySetMapping&gt;\n    &lt;EntitySetMapping Name=\"Users\"&gt;\n      &lt;EntityTypeMapping TypeName=\"IsTypeOf(TestDbModel.User)\"&gt;\n        &lt;MappingFragment StoreEntitySet=\"Users\"&gt;\n          &lt;ScalarProperty Name=\"ID\" ColumnName=\"ID\" /&gt;\n          &lt;ScalarProperty Name=\"Identity\" ColumnName=\"Identity\" /&gt;\n          &lt;ScalarProperty Name=\"Password\" ColumnName=\"Password\" /&gt;\n          &lt;ScalarProperty Name=\"Name\" ColumnName=\"Name\" /&gt;\n          &lt;ScalarProperty Name=\"LastName\" ColumnName=\"LastName\" /&gt;\n          &lt;ScalarProperty Name=\"Active\" ColumnName=\"Active\" /&gt;\n        &lt;/MappingFragment&gt;\n      &lt;/EntityTypeMapping&gt;\n    &lt;/EntitySetMapping&gt;\n    &lt;AssociationSetMapping Name=\"Rel_User_Message\" TypeName=\"TestDbModel.Rel_User_Message\" StoreEntitySet=\"UserMessages\"&gt;\n      &lt;EndProperty Name=\"users\"&gt;\n        &lt;ScalarProperty Name=\"ID\" ColumnName=\"Author_ID\" /&gt;\n      &lt;/EndProperty&gt;\n      &lt;EndProperty Name=\"messages\"&gt;\n        &lt;ScalarProperty Name=\"ID\" ColumnName=\"ID\" /&gt;\n      &lt;/EndProperty&gt;\n    &lt;/AssociationSetMapping&gt;\n  &lt;/EntityContainerMapping&gt;\n&lt;/Mapping&gt;&lt;/edmx:Mappings&gt;\n  &lt;/edmx:Runtime&gt;\n  &lt;!-- EF Designer content (DO NOT EDIT MANUALLY BELOW HERE) --&gt;\n  &lt;Designer xmlns=\"http://schemas.microsoft.com/ado/2008/10/edmx\"&gt;\n    &lt;Connection&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"MetadataArtifactProcessing\" Value=\"EmbedInOutputAssembly\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/Connection&gt;\n    &lt;Options&gt;\n      &lt;DesignerInfoPropertySet&gt;\n        &lt;DesignerProperty Name=\"ValidateOnBuild\" Value=\"true\" /&gt;\n        &lt;DesignerProperty Name=\"EnablePluralization\" Value=\"False\" /&gt;\n        &lt;DesignerProperty Name=\"IncludeForeignKeysInModel\" Value=\"False\" /&gt;\n      &lt;/DesignerInfoPropertySet&gt;\n    &lt;/Options&gt;\n    &lt;!-- Diagram content (shape and connector positions) --&gt;\n    &lt;Diagrams&gt;\n      &lt;Diagram Name=\"Model1\"&gt;\n        &lt;EntityTypeShape EntityType=\"TestDbModel.UserMessage\" Width=\"1.5\" PointX=\"2.625\" PointY=\"0.5\" Height=\"1.5956835937499996\" /&gt;\n        &lt;EntityTypeShape EntityType=\"TestDbModel.User\" Width=\"1.5\" PointX=\"0.5\" PointY=\"0.5\" Height=\"2.3648893229166665\" /&gt;\n        &lt;AssociationConnector Association=\"TestDbModel.Rel_User_Message\" &gt;\n          &lt;ConnectorPoint PointX=\"2\" PointY=\"1.2978417968749998\" /&gt;\n          &lt;ConnectorPoint PointX=\"2.625\" PointY=\"1.2978417968749998\" /&gt;\n        &lt;/AssociationConnector&gt;\n      &lt;/Diagram&gt;\n    &lt;/Diagrams&gt;\n  &lt;/Designer&gt;\n&lt;/edmx:Edmx&gt;\n</code></pre>\n\n<p><strong>C# (example code)</strong></p>\n\n<pre><code>User user = new User()\n{\n    Identity = name + \".\" + lastName,   // generated value\n    Password = Convert.ToBase64String(password),  // generated value\n    Name = name,                        // ...\n    LastName = lastName,                // ...\n    Active = rand.NextDouble() &gt; 0.7   // 70% de chance d'tre actif\n};\nctx.AddToUsers(user);\n\ntry\n{\n    ctx.SaveChanges();\n\n    Console.WriteLine(\"Created user #\" + (i + 1) + \" : \" + user.Identity);\n}\ncatch (Exception e)\n{\n    Console.WriteLine(e.InnerException);\n    Console.WriteLine(\"Collision for name \" + user.Identity);\n}\n</code></pre>\n\n<p><strong>Error with stack trace</strong></p>\n\n<pre><code>L'exception System.Data.UpdateException n'a pas t gre\n  Message=Une erreur s'est produite lors de la mise  jour des entres. Pour plus d'informations, consultez l'exception interne.\n  Source=System.Data.Entity\n  StackTrace:\n        System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager stateManager, IEntityAdapter adapter)\n        System.Data.EntityClient.EntityAdapter.Update(IEntityStateManager entityCache)\n        System.Data.Objects.ObjectContext.SaveChanges(SaveOptions options)\n        System.Data.Objects.ObjectContext.SaveChanges()\n        TestApplication.entity.EntitiesTest.CreateTestDbEntities(TestDbEntities ctx) dans C:\\Users\\yrochon\\Documents\\Visual Studio 2010\\Projects\\TestApplication\\TestApplication\\entity\\Entities.cs:ligne 119\n        TestApplication.entity.EntitiesTest.Test() dans C:\\Users\\yrochon\\Documents\\Visual Studio 2010\\Projects\\TestApplication\\TestApplication\\entity\\Entities.cs:ligne 26\n        TestApplication.Program.Main(String[] args) dans C:\\Users\\yrochon\\Documents\\Visual Studio 2010\\Projects\\TestApplication\\TestApplication\\Program.cs:ligne 18\n        System.AppDomain._nExecuteAssembly(RuntimeAssembly assembly, String[] args)\n        System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)\n        Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()\n        System.Threading.ThreadHelper.ThreadStart_Context(Object state)\n        System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean ignoreSyncCtx)\n        System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\n        System.Threading.ThreadHelper.ThreadStart()\n  InnerException: System.Data.EntityCommandCompilationException\n       Message=Une erreur s'est produite lors de la prparation de la dfinition de la commande. Pour plus de dtails, consultez l'exception interne.\n       Source=System.Data.Entity\n       StackTrace:\n             System.Data.Mapping.Update.Internal.UpdateTranslator.CreateCommand(DbModificationCommandTree commandTree)\n             System.Data.Mapping.Update.Internal.DynamicUpdateCommand.CreateCommand(UpdateTranslator translator, Dictionary`2 identifierValues)\n             System.Data.Mapping.Update.Internal.DynamicUpdateCommand.Execute(UpdateTranslator translator, EntityConnection connection, Dictionary`2 identifierValues, List`1 generatedValues)\n             System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager stateManager, IEntityAdapter adapter)\n       InnerException: System.NotSupportedException\n            Message=Les cls et les valeurs gnres par le serveur ne sont pas prises en charge par SQL Server Compact.\n            Source=System.Data.SqlServerCe.Entity\n            StackTrace:\n                  System.Data.SqlServerCe.SqlGen.DmlSqlGenerator.GenerateReturningSql(StringBuilder commandText, DbModificationCommandTree tree, ExpressionTranslator translator, DbExpression returning)\n                  System.Data.SqlServerCe.SqlGen.DmlSqlGenerator.GenerateInsertSql(DbInsertCommandTree tree, List`1&amp; parameters, Boolean isLocalProvider)\n                  System.Data.SqlServerCe.SqlGen.SqlGenerator.GenerateSql(DbCommandTree tree, List`1&amp; parameters, CommandType&amp; commandType, Boolean isLocalProvider)\n                  System.Data.SqlServerCe.SqlCeProviderServices.CreateCommand(DbProviderManifest providerManifest, DbCommandTree commandTree)\n                  System.Data.SqlServerCe.SqlCeProviderServices.CreateDbCommandDefinition(DbProviderManifest providerManifest, DbCommandTree commandTree)\n                  System.Data.Common.DbProviderServices.CreateCommandDefinition(DbCommandTree commandTree)\n                  System.Data.Common.DbProviderServices.CreateCommand(DbCommandTree commandTree)\n                  System.Data.Mapping.Update.Internal.UpdateTranslator.CreateCommand(DbModificationCommandTree commandTree)\n            InnerException:\n</code></pre>\n\n<p>Is <a href=\"http://stackoverflow.com/questions/4736177/updateexception-when-using-sql-server-compact-with-entity-framework\">this the only solution</a>? Manually generating identities (even if they are supposed to be auto incremented by the database)?</p>\n"},{"tags":["entity-framework","automapper"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12680062,"title":"AutoMapper - Convert two entity objects to a single DTO","body":"<p>I have two EntityFramework models that I want to combine into a single DTO. Is there a way to do this? There are a couple ideas in the following question, but you would either have to create a composite model, or lose the ability to call Mapper.AssertConfigurationIsValid to verify all of the properties will be set.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/2127786/is-it-possible-to-map-multiple-dto-objects-to-a-\">Is it possible to map multiple DTO objects to a single ViewModel using Automapper?</a>\nsingle-viewmodel-using-automappe</p>\n"},{"tags":["entity-framework","fluent"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12622914,"title":"Foreign Key with Fluent Entity Framework","body":"<p>I have created a News Model. My News have an author which is of the Member Class. \n is this enough for the foreing key to be set?</p>\n\n<pre><code> HasRequired(n =&gt; n.Author);\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>public class Member : Identity\n{\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public string Email { get; set; }\n    public Address Address { get; set; }\n    public int Id { get; set; }\n\n    public virtual ICollection&lt;News&gt; News { get; set; }\n\n}\n\npublic class News\n{\n    public string Title { get; set; }\n    public string Subtile { get; set; }\n    public int Id { get; set; }\n    public string Url { get; set; }\n    public DateTime DateAdded { get; set; }\n\n\n    public virtual Member Author;\n\n}\npublic class NewsMap : EntityTypeConfiguration&lt;News&gt;\n{\n    public NewsMap()\n    {\n\n        HasKey(n =&gt; n.Id);\n        Property(n =&gt; n.Id).\n            HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity)\n            .HasColumnName(\"Id\");\n\n        Property(t =&gt; t.Title)\n            .IsRequired()\n            .HasMaxLength(100)\n            .IsUnicode();\n        Property(t =&gt; t.Subtile)\n            .IsRequired()\n            .HasMaxLength(100)\n            .IsUnicode();\n        Property(t =&gt; t.Url)\n            .IsRequired()\n            .HasMaxLength(255)\n            .IsUnicode();\n        Property(t =&gt; t.DateAdded).HasColumnName(\"DateAdded\")\n            .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Computed);\n\n        HasRequired(n =&gt; n.Author); //is this enough for the foreing key to be set?\n\n\n\n    }\n\n}\npublic class MemberMap : EntityTypeConfiguration&lt;Member&gt;\n{\n    public MemberMap()\n    {\n        // Primary Key\n        this.HasKey(t =&gt; t.Id);\n\n        // Properties\n        this.Property(t =&gt; t.FirstName)\n            .IsRequired()\n            .HasMaxLength(150);\n\n        this.Property(t =&gt; t.LastName)\n            .IsRequired()\n            .HasMaxLength(50);\n\n        this.Property(t =&gt; t.Email)\n            .IsRequired()\n            .HasMaxLength(150);\n\n        this.Property(t =&gt; t.Address.Id)\n            .IsRequired()\n            .HasMaxLength(100)\n            .HasColumnName(\"Address_FirstLine\");\n\n        this.Property(t =&gt; t.Address.ZipCode)\n            .IsRequired()\n            .HasMaxLength(20).HasColumnName(\"Address_Zip\");\n\n        this.Property(t =&gt; t.Address.Contry)\n            .IsRequired()\n            .HasMaxLength(100).HasColumnName(\"Address_Contry\");\n\n        this.Property(t =&gt; t.Address.City)\n            .IsRequired()\n            .HasMaxLength(100).HasColumnName(\"Address_Town\");\n\n        this.Property(t =&gt; t.Id);\n\n\n        // Table &amp; Column Mappings\n        this.ToTable(\"Identities_Member\");\n        this.Property(t =&gt; t.FirstName).HasColumnName(\"FirstName\");\n        this.Property(t =&gt; t.LastName).HasColumnName(\"LastName\");\n        this.Property(t =&gt; t.Email).HasColumnName(\"Email\");\n        this.Property(t =&gt; t.Id).HasColumnName(\"Id\");\n\n        // Relationships\n\n\n\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":189,"score":0,"question_id":12679248,"title":"EF 5 - Model First, How to update DB Schema without dropping database","body":"<p>I am developing in MVC 4, EF 5.0</p>\n\n<p>Model First development - how do I 'easily' get the DB schema to update, without having to drop the database / erase any data?</p>\n\n<p>e.g. I have a Customer table. In this table, we capture name, surname, email address. I now want to collect the telephone number, so I change the model and get EF to update the database schema.</p>\n\n<p>Visual studio 2012 referrs me to <a href=\"http://go.microsoft.com/fwlink/?LinkId=238269\" rel=\"nofollow\">http://go.microsoft.com/fwlink/?LinkId=238269</a>, however this looks like chinese to me.</p>\n\n<p>They talk about running an NUGET package called code first migrations. Does this functionality not come packaged automatically with VS2012?</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12673792,"title":"DateTime .AddDays EntityFramework","body":"<p>I have this code:</p>\n\n<pre><code>from pr in e.ProgramSetup.Include(\"Program\").Include(\"Program.Client\")\n        where pr.DateBegin &lt; DateTime.Now\n        &amp;&amp; pr.DateEnd &gt; DateTime.Now.AddDays(pr.DateEndOffset) \nselect pr).ToList();\n</code></pre>\n\n<p>It does not work, because AddDays() is not possible to use for generating sql.</p>\n\n<p>So is there some another way? Now i select everything and filter it finaly by foreach, but it is not good way in my opinion.</p>\n\n<p>Problem is that pr.DateEndOffset is also only in db, it is not constant...</p>\n"},{"tags":["c#","sql","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":86,"score":4,"question_id":12675577,"title":"Linq Order by List<int> of IDs given","body":"<p>I am trying to sort a linq query so that the results are returned in the order of the IDs found in the List[int]. Here is my current code that returns them just fine, but not sorted.</p>\n\n<pre><code>IEnumerable&lt;NPost&gt; nposts;\n\nList&lt;int&gt; npostIDs = (from tc in db.TopComs\n                      where tc.Type == \"Comments\"\n                      select tc.NPostID).ToList();\n\n            nposts = from np in repository.NPosts\n                     where npostIDs.Contains(np.NPostID)\n                     select np;\n</code></pre>\n\n<p>How can I have it so that nposts returns the results in the order in which npostIDs exists in the List[int]?</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":3,"view_count":116,"score":0,"question_id":12677256,"title":"Convert string to int in an Entity Framework linq query and handling the parsing exception","body":"<p>I've got this problem, I have a table for purchases </p>\n\n<pre><code>Purchases(Date DateTime, Number string)\n</code></pre>\n\n<p>I want is to create a new record, so I need the Max(Number), the problem here is that Number is a <strong>string</strong>, I've tried </p>\n\n<pre><code>Purchases.Select(X=&gt;int.Parse(X.Number)).Max()\n</code></pre>\n\n<p>but it could throw an exception, I've create a custom <code>ToInt()</code> extension so when I use</p>\n\n<pre><code>Purchases.Select(X=&gt;X.Number.ToInt()).Max()\n</code></pre>\n\n<p>it throws an exception saying that my ToInt() can't be used with linq query same as the famous ToString()</p>\n\n<p>so my <strong>question</strong> is : is there a way to cast a string to int in linq query &amp; handling exceptions at the same time or to integrate custom functions to a linq query !!</p>\n\n<p>and this's my extension</p>\n\n<pre><code>    public static int ToInt(this string s)\n    {\n        try\n        {\n            return int.Parse(s);\n        }\n        catch\n        {\n        }\n        return 0;\n    }\n</code></pre>\n"},{"tags":["json","asp.net-mvc-3","entity-framework","jquery-ajax","razor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12676749,"title":"Want to post one to many relation data with json MVC3","body":"<p><strong>Client</strong>    </p>\n\n<pre><code>public class ClientModelData\n{\n    public int ClientID { get; set; }\n    public string ClientName { get; set; }\n    public string Phone { get; set; }\n    public string Address { get; set; }\n    public IList&lt;int&gt; LocationID { get; set; }\n}\n</code></pre>\n\n<p><strong>Controller</strong></p>\n\n<pre><code>[HttpPost]\n    public ActionResult AddClient(ClientModelData client)\n    {\n        Client _client = new Client()\n        {\n            //ClientCode=client.ClientCode,\n            ClientName = client.ClientName,\n            Phone = client.Phone,\n            Ext = client.Ext,\n            Address = client.Address,\n            CreatedBy = 1,\n            CreatedDate = DateTime.Now,\n            ModifiedBy = 1,\n            ModifiedDate = DateTime.Now,\n            ModifiedIP = Request.ServerVariables[\"REMOTE_ADDR\"]\n        };\n        db.Clients.Add(_client);\n        try\n        {\n            db.SaveChanges();\n        }\n        catch (DbEntityValidationException dbEx)\n        {\n            string error = string.Empty;\n            foreach (var validationErrors in dbEx.EntityValidationErrors)\n                foreach (var validationError in validationErrors.ValidationErrors)\n                    error += string.Format(\"Property: {0} Error: {1}\", validationError.PropertyName, \n                        validationError.ErrorMessage);\n\n            return Json(new\n            {\n                status = false,\n                message = \"Unable to update information for selected client, please contact administrator. For detail &lt;a class='errordetail'&gt;click here&lt;/a&gt;\",\n                exception = error\n            });\n        }\n        return Json(_client);\n    }\n</code></pre>\n\n<p>I have a checkbox list:</p>\n\n<pre><code>&lt;ul class=\"locations\"&gt;\n                                @foreach (var item in Model.Locations)\n                                {\n                                    &lt;li&gt;\n                                        &lt;label&gt;\n                                            &lt;input type=\"checkbox\" id=\"chkLocations\" name=\"chkLocations\" \n                                            value=\"@item.LocationID\" /&gt;\n                                            @item.LocationTitle&lt;/label&gt;\n                                    &lt;/li&gt;\n                                }\n                            &lt;/ul&gt;\n</code></pre>\n\n<p>** The Json object contains the values: **</p>\n\n<pre><code>var allVals = [];\n            $('#chkLocations:checked').each(function () {\n                allVals.push($(this).val());\n            });\n            var dataPacket = {\n                ClientName: $(\"#txtClientName\").val(),\n                Phone: $(\"#txtPhone\").val(),\n                Ext: $(\"#txtExt\").val(),\n                Address: $(\"#txtAddress\").val(),\n                LocationID: allVals\n            };\n</code></pre>\n\n<p>Now the problem occurs, when I give the checkbox:checked items it don't populate the ModelData Entity <strong>Location</strong> property</p>\n\n<p>Image:</p>\n\n<blockquote>\n  <p><a href=\"http://tinypic.com/r/4l0bqr/6\" rel=\"nofollow\">http://tinypic.com/r/eapem9/6</a></p>\n</blockquote>\n\n<p><strong>Issue Comes Up POSTING form...JQuery AJAX</strong></p>\n\n<p>Image:</p>\n\n<blockquote>\n  <p><a href=\"http://tinypic.com/r/4l0bqr/6\" rel=\"nofollow\">http://tinypic.com/r/4l0bqr/6</a></p>\n</blockquote>\n"},{"tags":["c#","sql","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12669667,"title":"Performance across to 2 tables, getting latest record from 2nd table","body":"<p>I am using Code First, Entities, MVC3 + Razor, we have forms which have many steps in them (which also have to be audited)</p>\n\n<p>I have <code>Forms</code>, which have <code>Steps</code>, so the model looks like this.</p>\n\n<pre><code>public class MyForm\n{\n    public int FormId { get; set; }\n    public Guid UniqueReferenceId { get; set; }\n    public DateTime DateCreatedOn { get; set; }\n    public string Name { get; set; }\n    public string DetailsOfContact { get; set; }\n\n    public virtual ICollection&lt;AuditItem&gt; AuditItems { get; set; }\n}\n\npublic class AuditItem\n{\n    public int AuditItemId { get; set; }\n    public int FormId { get; set; }\n    public string ActionByUserUid { get; set; }\n    public DateTime DateOfAction { get; set; }\n    public int Step { get; set; }\n\n    public virtual MyForm MyForm { get; set; }\n}\n</code></pre>\n\n<p>The trouble then comes when I want to display a user interface showing summary information from the form along with what the latest step it is at, details the progress of the many forms submitted, a table with which step they are at and a summary.  The performance is bad even with just a handful of records, let alone when we have thousands in it.  I have to query across the tables, with:</p>\n\n<p>I have to get the step from the latest date, rather than just the latest 'step' number, as it's possible for a form to go back to a previous step.</p>\n\n<pre><code>int latestAuditStep = myForm.AuditItems\n    .OrderByDescending(ai =&gt; ai.DateOfAction)\n    .Select(ai =&gt; ai.Step)\n     .First();\n</code></pre>\n\n<p>Obviously this is quite expensive, and I'm looking for a better way to tackle this modelling issue.</p>\n\n<p>Note: I would have ideally liked to look at using WWF, as that seems the best tool to use in conjunction, but I have not had enough time up front to learn that, rather than just having to 'get the job done', so don't know whether it would have helped or not.</p>\n"},{"tags":["c#","xml","linq","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12676830,"title":"Inline EnsureLoaded() with LINQ and EntityFramework","body":"<p>I'm generating some XML with the following code, however the system I'm working on uses manual loading instead of lazy loading within the EntityFramework.  So in effect, I have to call EnsureLoaded() to explicitly say what elements need loading.  The problem is calling EnsureLoaded() withing deeply nested fields.  Here is my code;</p>\n\n<pre><code>public partial class Test\n{\n    public XElement ReturnDetails()\n    {\n        Test.DriverReference.EnsureLoaded();\n\n        return new XElement(\"Test\",\n            new XAttribute(\"CarNum\", CarNum),\n            new XAttribute(\"Make\", Make ?? string.Empty),\n            new XAttribute(\"Model\", Model ?? string.Empty),\n            new XAttribute(\"Colour\", Colour ?? string.Empty),\n            new XElement(\"Drivers\",\n            from driver in Drivers\n            select new XElement(\"Driver\",\n                new XAttribute(\"DriverNum\", driver.DriverNum),\n                new XAttribute(\"Notes\", driver.Notes),\n                new XElement(\"Routes\"),\n                from route in driver.Routes\n                select new XElement(\"Route\",\n                    new XAttribute(\"Name\", route.Name),\n                    new XAttribute(\"Notes\", route.Notes)\n                ))));\n    }\n}\n</code></pre>\n\n<p>The problem is getting the value of Driver, and keep getting NullReferenceExceptions when going beyond three level of Entity hierarchies.  What I want to do is the following;</p>\n\n<pre><code>public partial class Test\n{\n    public XElement ReturnDetails()\n    {\n        Test.DriverReference.EnsureLoaded();\n\n        return new XElement(\"Test\",\n            new XAttribute(\"CarNum\", CarNum),\n            new XAttribute(\"Make\", Make ?? string.Empty),\n            new XAttribute(\"Model\", Model ?? string.Empty),\n            new XAttribute(\"Colour\", Colour ?? string.Empty),\n            new XElement(\"Drivers\",\n            from driver in Drivers.EnsureLoaded() *****\n            select new XElement(\"Driver\",\n                new XAttribute(\"DriverNum\", driver.DriverNum),\n                new XAttribute(\"Notes\", driver.Notes),\n                new XElement(\"Routes\"),\n                from route in driver.Routes.EnsureLoaded() *****\n                select new XElement(\"Route\",\n                    new XAttribute(\"Notes\", route.Notes),\n                    new XAttribute(\"Name\", route.Name)\n                ))));\n    }\n}\n</code></pre>\n"},{"tags":["c#","asp.net","linq","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12665636,"title":"Value setting to null when debuging, not so much when running","body":"<p>I have category that can have child-categories/root-category. When I change my root category to some other category it works but when I try to set it to <code>null</code> (to make it root category) it does not change anything. I'm using code-first approach if that makes any difference.</p>\n\n<p>Here is code where I explicitly state that <code>category.RootCategory = null</code> but it does not work, root category still is what is set previously.</p>\n\n<h2>Controller</h2>\n\n<pre><code>[HttpPost]\npublic ActionResult Edit(Category c, int? rootCategoryID)\n{\n    var category = _db.Categories.Where(x =&gt; x.ID == c.ID).Single();\n\n    if (TryUpdateModel(category))\n    {\n        cateogry.RootCategory = null;\n            _db.SaveChanges();\n        return Content(Infrastructure.Helpers.SerializeObject(category));\n    }\n\n    return Redirect(\"/admin/category\");\n}\n</code></pre>\n\n<h2>Model</h2>\n\n<pre><code>public class Category\n{\n    public int ID { get; set; }\n    virtual public Category RootCategory { get; set; }\n    virtual public ICollection&lt;Category&gt; ChildCategories { get; set; }\n}\n</code></pre>\n\n<h2>Update</h2>\n\n<p>Very strange behavior. When I debug it and go step by step slowly it updates it, when I don't debug it or run fast it is not updating. I have no clue why it is like that.</p>\n"},{"tags":["asp.net-mvc","entity-framework","xval","model-validation"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2920,"score":4,"question_id":2229716,"title":"Auto generating metadata classes for Entity Framework","body":"<p>I am considering using xVal for validation of Entity Framework classes in a MVC application. This involves writing metadata classes as explained in details by Graham O'Neale (<a href=\"http://goneale.com/2009/03/04/using-metadatatype-attribute-with-aspnet-mvc-xval-validation-framework\" rel=\"nofollow\">http://goneale.com/2009/03/04/using-metadatatype-attribute-with-aspnet-mvc-xval-validation-framework</a>). </p>\n\n<p>I am wondering if there's a way to auto generate such metadata classes using the metadata from the SQL database (for example: not null fields will have [Required] class attribute.</p>\n"},{"tags":["asp.net","sql-server-2008","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":145,"score":1,"question_id":12674141,"title":"SQL Server 2012 and .NET Framework 4.0","body":"<p>I have a server which configured for SQL Server 2008 R2 and ASP.NET 4.0.</p>\n\n<p>The hosting company won't support .Net Framework 4.5 and SQL Server 2012 and latest Entity Framework.</p>\n\n<p>I have created my website with .Net Framework 4.5 and latest Entity Framework 5. How can I change the publish settings to old server execute that ? </p>\n"},{"tags":["entity-framework","linq-to-entities","mapping"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12675178,"title":"LINQ to Entity: How to add a method to select the expression LINQ, which will not be transferred to SQL. And will work with the result of the query","body":"<p>I'm making the first steps in learning LINQ to Entity, I Use Entity Framework 5.</p>\n\n<p>I have to write a LINQ expression because the structure database does not allow as easy to write in the style of lambda.</p>\n\n<p>Without going into details, I have the following query.</p>\n\n<pre><code>    var query = from t1 in context.Table1 \n                from t2 in context.Table2\n                where t1.ExternalId = t2.Id &amp;&amp;\n                      t1.Field1= \"some value\" &amp;&amp;\n                      t2.Field1 &lt; SOME_NUMBER\n                select new MyCustomViewModel{\n                      field1 = t1.field1,\n                      field2 = t2.field1,\n                      fieldBySpecificType = MyCustomMapper.Map&lt;SomeType&gt;(t1.field3),\n                }\n</code></pre>\n\n<p>As you can see in the formation of the model is called a mapper that from a string representation deserialize importance to some class. LINQ and tells me that it can not translate this method in SQL expression.\nAs you can see my model contains fields from multiple tables, so I can `t collect it after.</p>\n\n<p>I'm trying to find a solution that will be able to say that LINQ is unnecessary this method to translate into SQL. Something to sort attribute. But all my efforts were unsuccessful. Perhaps there is what is the architectural solution to my problem.</p>\n"},{"tags":["c#",".net","entity-framework","castle-windsor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":12627467,"title":"Castle.Windsor 3.1 - ComponentActivator: could not proxy <FactoryName>","body":"<p>I'm in the process of upgrading from version 2.5.1 to version 3.1.0 and what used to work no long does. I'm attempting to resolve a factory that creates components that utilize generics. The error that is thrown is \"ComponentActivator: could not proxy \" where  is the name of the factory that cannot be resolved</p>\n\n<pre><code>public class MyObject { }\n\npublic class MyContext { }\n\npublic class DummyComponent&lt;T&gt; : IDummyComponent&lt;T&gt; where T : MyObject { }\n\npublic interface IDummyComponent&lt;T&gt; { }\n\npublic interface IDummyComponentFactory\n{\n    IDummyComponent&lt;T&gt; Create&lt;T&gt;(object o);\n}\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        var windsorContainer = new WindsorContainer();\n        windsorContainer.AddFacility&lt;TypedFactoryFacility&gt;()\n            .Register(\n                Component.For(typeof(IDummyComponent&lt;&gt;)).ImplementedBy(typeof(DummyComponent&lt;&gt;)),\n                Component.For&lt;IDummyComponentFactory&gt;().AsFactory());\n        var factory = windsorContainer.Resolve&lt;IDummyComponentFactory&gt;(); &lt;-- Error Occurs Here\n        var myDummyComponent = factory.Create&lt;MyObject&gt;(new object());\n    }\n}\n</code></pre>\n\n<p>This code is utilized in the following fashion within an Entity Framework repository for passing the EntityContext to another repository in order to handle deleted object like so:</p>\n\n<pre><code>    public virtual IEnumerable&lt;T&gt; Where(Expression&lt;Func&lt;T, bool&gt;&gt; predicate, bool showDeleted = false, MergeOption mergeOption = MergeOption.AppendOnly)\n    {           \n        if (typeof(IDeletable).IsAssignableFrom(typeof(T)))\n        {\n            var factory = Container.Instance.Resolve&lt;IDeletableRepositoryFactory&gt;();\n            var repository = factory.GetDeletableRepository&lt;T&gt;(EntityContext);\n            return repository.Where(predicate, showDeleted, mergeOption);\n        }\n\n        return GetObjectSet(mergeOption).Where(predicate);                      \n    }\n</code></pre>\n\n<p><strong>Update:</strong> Including Inner Exception</p>\n\n<pre><code>System.Security.VerificationException\n{\"Operation could destabilize the runtime.\"} at\nCastle.MicroKernel.Proxy.ProxyOptions.get_MixIns() in \nc:\\BuildAgent\\work\\5b096cace0fecb1f\\src\\Castle.Windsor\\MicroKernel\\Proxy\\ProxyOptions.cs:line 96 at \nCastle.Windsor.Proxy.DefaultProxyFactory.CreateProxyGenerationOptionsFrom(ProxyOptions proxyOptions, IKernel kernel, CreationContext context, ComponentModel model) in \nc:\\BuildAgent\\work\\5b096cace0fecb1f\\src\\Castle.Windsor\\Windsor\\Proxy\\DefaultProxyFactory.cs:line 178 at\nCastle.Windsor.Proxy.DefaultProxyFactory.Create(IKernel kernel, Object target, ComponentModel model, CreationContext context, Object[] constructorArguments) in \nc:\\BuildAgent\\work\\5b096cace0fecb1f\\src\\Castle.Windsor\\Windsor\\Proxy\\DefaultProxyFactory.cs:line 105 at\nCastle.MicroKernel.ComponentActivator.DefaultComponentActivator.CreateInstance(CreationContext context, ConstructorCandidate constructor, Object[] arguments) in \nc:\\BuildAgent\\work\\5b096cace0fecb1f\\src\\Castle.Windsor\\MicroKernel\\ComponentActivator\\DefaultComponentActivator.cs:line 123`\n</code></pre>\n"},{"tags":["entity-framework","tfs","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12672171,"title":"Cannot Update EF Model From Database with TFS","body":"<p>I've recently moved to using TFS 2012 and have edited a couple of files and checked in without any problems. However, I've just started work on the EF data model and despite being able to open the file the \"Update Model From Database\" option on the Entity designer right-click menu is greyed out / disabled. </p>\n\n<p>I'm a bit baffled by this.  I've tried checking out the file with the \"Allow other users to check out but prevent them from checking in\" but that doesn't make any difference. Nor does checking out the whole folder the project is in. </p>\n\n<p>Does anyone know what I'm doing wrong?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I've discovered that if I create a project in TFS and add an entity model to it then I can update it. However, if I import an existing project into TFS and then try to edit the .edmx file then that's when the problem happens.</p>\n"},{"tags":["c#","entity-framework","edmx"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":68,"score":2,"question_id":12641447,"title":"Error Creating an Association between Views in Entity Framework EDMX","body":"<p>I have a project where I am using Views and Stored Procedures with EF5.  I have an EDMX with the views in the designer and am trying to manually create the associations between the PK and FK across 2 views, when doing so I first get this error:</p>\n\n<p><strong>Error 5 Error 3027: No mapping specified for the following EntitySet/AssociationSet - vw_borrowervw_borrower_extension</strong>.</p>\n\n<p>Then if I do table mapping on the association and select the pk and fk I receive this error:</p>\n\n<p><strong>Error 5 Error 3007: Problem in mapping fragments starting at lines 309, 351:Column(s) [borrower_fk] are being mapped in both fragments to different conceptual side properties.</strong></p>\n\n<p>In the one view the primary key name is borrower_pk and in the related view the foreign key is named borrower_fk.  </p>\n\n<p>Any help would be much appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":[".net","sql-server-2008","entity-framework","asp.net-4.0","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":12611960,"title":"Entity Framework code first with TimeStamp type","body":"<p>I am using SQL Server 2008 R2 and Entity Framework 5.0. When the database is generated, I cannot add my property of type TimeStamp without having the following error:\nThere is no store type corresponding to the conceptual side type </p>\n\n<blockquote>\n  <p>'Edm.Time(Nullable=True,DefaultValue=,Precision=)' of primitive type\n  'Time'.</p>\n</blockquote>\n\n<p>I have set the Entity Configuration to the type time or timestamp without success</p>\n\n<pre><code>Property(x =&gt; x.RestBetweenSet).HasColumnType(\"timestamp\");\n</code></pre>\n\n<p>When I go in the Sql Server Management Studio and edit the table I can set a column of timestamp.</p>\n\n<p>What do I need to do to have Entity Framework code first be able to generate this column?</p>\n\n<p>Thank you</p>\n"},{"tags":["c#","asp.net","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12673581,"title":"Poor performance when loading child entities with Entity Framework","body":"<p>I'm building an ASP.Net application with Entity Framework (Code First) and I've implemented a Repository pattern <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application\" rel=\"nofollow\">like the one in this example</a>.</p>\n\n<p>I only have two tables in my database. One called <code>Sensor</code> and one called <code>MeasurePoint</code> (containing only <code>TimeStamp</code> and <code>Value</code>). A sensor can have multiple measure points. At the moment I have 5 sensors and around 15000 measure points (approximately 3000 points for each sensor).</p>\n\n<p>In one of my MVC controllers I execute the following line (to get the most recent MeasurePoint for a Sensor)</p>\n\n<pre><code>DbSet&lt;Sensor&gt; dbSet = context.Set&lt;Sensor&gt;();\nvar sensor = dbSet.Find(sensorId);\nvar point = sensor.MeasurePoints.OrderByDescending(measurePoint =&gt; measurePoint.TimeStamp).First();\n</code></pre>\n\n<p>This call takes ~1s to execute which feels like a lot to me. The call results in the following SQL query</p>\n\n<pre><code>SELECT \n[Extent1].[MeasurePointId] AS [MeasurePointId], \n[Extent1].[Value] AS [Value], \n[Extent1].[TimeStamp] AS [TimeStamp], \n[Extent1].[Sensor_SensorId] AS [Sensor_SensorId]\nFROM [dbo].[MeasurePoint] AS [Extent1]\nWHERE ([Extent1].[Sensor_SensorId] IS NOT NULL) AND ([Extent1].[Sensor_SensorId] = @EntityKeyValue1)\n</code></pre>\n\n<p>Which only takes ~200ms to execute, so the time is spent somewhere else.</p>\n\n<p>I've profiled the code with the help of Visual Studio Profiler and found that the call that causes the delay is </p>\n\n<pre><code>System.Data.Objects.Internal.LazyLoadBehavior.&lt;&gt;c_DisplayClass7`2.&lt;GetInterceptorDelegate&gt;b_1(!0,!1)\n</code></pre>\n\n<p>So I guess it has something to do with lazy loading. Do I have to live with performance like this or are there improvements I can make? Is it the ordering by time that causes the performance drop, if so, what options do I have?</p>\n\n<p><strong>Update:</strong>\nI've updated the code to show where <code>sensor</code> comes from. </p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":4,"up_vote_count":2,"down_vote_count":0,"view_count":1941,"score":2,"question_id":8007129,"title":"CodeFirst EF4.1 MVC Against legacy database - Multiplicity conflicts","body":"<p>No matter which way I mix it, it gives me errors.  I have a feeling I'm missing something obvious as I keep getting these errors.</p>\n\n<blockquote>\n  <p>One or more validation errors were detected during model generation:</p>\n  \n  <p>System.Data.Edm.EdmAssociationType: : Multiplicity conflicts with the referential constraint in Role 'Venue_Courses_Source' in relationship 'Venue_Courses'. Because all of the properties in the Dependent Role are non-nullable, multiplicity of the Principal Role must be '1'.</p>\n  \n  <p>System.Data.Edm.EdmAssociationEnd: : Multiplicity is not valid in Role 'Venue_Courses_Target' in relationship 'Venue_Courses'. Because the Dependent Role refers to the key properties, the upper bound of the multiplicity of the Dependent Role must be 1.</p>\n</blockquote>\n\n<p><strong>A Course can only have one venue, venues can be used by many Courses</strong></p>\n\n<pre><code>public class Course\n{\n    [Key]\n    public virtual int Id { get; set; }\n    public string Title { get; set; }\n    public DateTime StartDate { get; set; }\n    public int VenueId { get; set; }\n\n    public virtual Venue Venue { get; set; }\n}\n\npublic class Venue\n{\n    [Key]\n    public int Id { get; set; }\n    public string Name { get; set; }\n\n    public virtual ICollection&lt;Course&gt; Courses { get; set; }\n}\n\n\nprotected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n\n    #region Courses\n    //Table Alias\n    modelBuilder.Entity&lt;Course&gt;().ToTable(\"DBSCHEMA.TR_COURSES\");\n    //Keys\n    modelBuilder.Entity&lt;Course&gt;().HasKey(c =&gt; c.Id);\n    //Joins\n    //Join to Venues\n    modelBuilder.Entity&lt;Course&gt;().HasOptional(c =&gt; c.Venue);\n\n    //Fields\n    modelBuilder.Entity&lt;Course&gt;().Property(c =&gt; c.Id).HasColumnName(\"COURSE_ID\");\n    modelBuilder.Entity&lt;Course&gt;().Property(c =&gt; c.Title).HasColumnName(\"CR_TITLE\");\n    modelBuilder.Entity&lt;Course&gt;().Property(c =&gt; c.StartDate).HasColumnName(\"START_DATE\");\n    modelBuilder.Entity&lt;Course&gt;().Property(c =&gt; c.VenueId).HasColumnName(\"VENUE_ID\");\n    #endregion\n\n\n    #region Venues\n    //Table Alias\n    modelBuilder.Entity&lt;Venue&gt;().ToTable(\"DBSCHEMA.VENUES\");\n    //Keys\n    modelBuilder.Entity&lt;Venue&gt;().HasKey(v =&gt; v.Id);\n    //Joins\n    modelBuilder.Entity&lt;Venue&gt;().HasMany(venue =&gt; venue.Courses);\n    //Fields\n    modelBuilder.Entity&lt;Venue&gt;().Property(v =&gt; v.Id).HasColumnName(\"VENUE_ID\");\n    modelBuilder.Entity&lt;Venue&gt;().Property(v =&gt; v.Name).HasColumnName(\"VENUE_NAME\");\n    #endregion\n\n}\n</code></pre>\n"},{"tags":["c#","asp.net","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12664638,"title":"Get the next and previous sql row by Id and Name, EF?","body":"<p>Assume we have the following data in a SQL Server table (sorted by name) :</p>\n\n<pre><code>Id   Name        LName\n-------------------------\n5   Abbas        Dayyan\n3   Mohammad     KD\n4   Nima         Ahmad\n1   Omid         Zangene\n2   Pedram       Ahmadi\n</code></pre>\n\n<p>we have an Id query string and we wanna get the next and previous row (if exists) from Id.</p>\n\n<p>e.g :</p>\n\n<p>the Id query string is 4, so we wanna get <strong>Mohammad KD</strong> as previous row and <strong>Omid Zangene</strong> as next row.</p>\n\n<p>Could you please guide me how can do it with LINQ to Entity Framework.</p>\n\n<p><strong>Edit:</strong><br />\nIn practice the number of table rows is around 1 million.<br />\nTable rows didn't sort by Name by default, wa need to sort them by Name for the result.</p>\n"},{"tags":["c#","entity-framework","dbml"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12670653,"title":"Adding DB table to dmbl produce strange errors","body":"<p>I have a dbml file that contains almost all the tables of a database.\nEverything is ok, it works as expected (compile + run).</p>\n\n<p>Now I have to add the last table of the model.\nThe table is named \"PRIVATE\".</p>\n\n<p>It add it successfully but then every other classes based on other tables are \"not found\" at compile time.\nI don't have any other error messages.</p>\n\n<p>It this a problem with the name of the table ?\nIs there any solution to this (I cannot rename the current table) ?</p>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","entity-framework","associations","ado.net-entity-data-model"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":163,"score":1,"question_id":12540246,"title":"MVC 3 Entity Data Model not picking up Foreign Keys","body":"<p>I am returning to programming after focusing on databases for a number of years. I used to be a gun in VB6 but .Net has me floundering.</p>\n\n<p>I am attempting to build a web app in MVC from an already existing database. I am roughly following this: <a href=\"http://msdn.microsoft.com/en-us/data/gg685489.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/data/gg685489.aspx</a></p>\n\n<p>I'm using Visual Web Developer Express 2010 10.0.40219.1 SP1Rel\nI'm not sure how to work out the versions of the various templates and plugins.</p>\n\n<p>I am generating an entity data model from an exsting database. The three tables I'm using have Primary and Foreign keys defined, however when I import it, no associations are created in the data model</p>\n\n<p>There seems to be a lot of different ways to build a database enabled web app. If I was more familiar with the syntax I could have hand coded it by now.</p>\n\n<p>Q1: Any idea why associations are not created?</p>\n\n<p>Q2: Can you verify that I need associations to tell the code generator how everything fits together? (i.e. autogenerate the appropriate methods in code). I can't see how it would work otherwise.</p>\n\n<p>Q3: If I create associations manually and Build, I get some errors. It appears that creating associations creates a property against the entity ('CustomerCustomer_ID) and this needs to be mapped to something. However when I press 'Table Mapping' this isn't in the list to map and I can't add it.</p>\n\n<pre><code>Error   1 Error 3004: Problem in mapping fragments starting at line 198:\nNo mapping       specified for properties Task.CustomerCustomer_ID in Set Tasks.\nAn Entity with Key (PK) will not round-trip when: Entity is type [zzzz.Task]\nError   2 Error 11009: Property 'CustomerCustomer_ID' is not mapped.\n</code></pre>\n\n<p>Here's the abridged DDL for two of the tables that I would expect would generate associations</p>\n\n<pre><code>CREATE TABLE [dbo].[Customers](\n    [Customer_ID] [int] IDENTITY(1,1) NOT NULL,\n    [Customer_Name] [varchar](50) NOT NULL,\n........\n....\nCONSTRAINT [PK_Customers] PRIMARY KEY CLUSTERED \n([Customer_ID] ASC))\n\nCREATE TABLE [dbo].[Tasks](\n    [Task_ID] [int] IDENTITY(1,1) NOT NULL,\n    [TaskType_ID] [int] NOT NULL,\n    [Emp_ID] [int] NOT NULL,\n    [Customer_ID] [int] NOT NULL,\n    [Status_ID] [int] NOT NULL,\n    [Task_Desc] [varchar](300) NULL,\n.....\n..\nCONSTRAINT [PK_Tasks] PRIMARY KEY CLUSTERED \n(\n    [Task_ID] ASC\n)\n\nALTER TABLE [dbo].[Tasks]  WITH CHECK ADD  CONSTRAINT [FK_Tasks_Customers] \nFOREIGN KEY([Customer_ID])\nREFERENCES [dbo].[Customers] ([Customer_ID])\nGO\n</code></pre>\n"},{"tags":["asp.net","entity-framework","ef-database-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":41,"score":-5,"question_id":12668344,"title":"why my query it'not working?","body":"<p>hi i used this query for update my db but not working :</p>\n\n<pre><code>if (Request[\"mode\"] != null)\n        {\n            Int32 ID = Int32.Parse(Request[\"Id\"].ToString());\n            using (NoavaranModel.NoavaranEntities1 dbContext = new NoavaranModel.NoavaranEntities1())\n            {\n                var ToEdit = (from n in dbContext.Packages\n                                  where n.Id == ID\n                                  select n).FirstOrDefault();\n                ToEdit.Name = txtName.Text;\n                ToEdit.Level = txtLevel.Text;\n                ToEdit.Description = txtDescription.Text;\n                ToEdit.ForAge = ddlAgeFor.SelectedItem.Text;\n                ToEdit.CatId = ddlCategory.SelectedIndex + 1;\n                dbContext.SaveChanges();\n                //Response.Redirect(\"Packages.aspx\");\n                //return;*/\n            }\n        }\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12666608,"title":"How do i assosiate my PICO class with a specific table in my database with Entity Framework 5","body":"<p>I have a table in my db (a many to many table) that two classes A and B have created like this.</p>\n\n<pre><code>    this.HasMany(t =&gt; t.TrafficImageQuestions)\n       .WithMany(t =&gt; t.TrafficImages)\n        .Map(m =&gt;\n            {\n                m.ToTable(\"TrafficImage_Answers\");\n                m.MapLeftKey(\"TrafficImagesGuid\");\n                m.MapRightKey(\"TrafficImageQuestionsId\");\n\n\n            });\n</code></pre>\n\n<p>Now i would like to assosiate my custom class to this same table \"TrafficImage_Answers\", the class offcause have the left and right key and then also a 3. custom property. </p>\n\n<p>(i did add the column to the database \"Answer\")</p>\n\n<pre><code>    public class TrafficImageAnswer\n    {\n        public System.Guid TrafficImageGuid { get; set; }\n        public int TrafficImageQuestionId { get; set; }\n        public byte Answer { get; set; }\n    }\n</code></pre>\n\n<p>I am doing this as i want entity model to keep track of my many to many relationship of A and B and still be able to look up the 3. property Answer that is in the database.</p>\n\n<p><strong>What i have tried</strong></p>\n\n<p>I tried to do the following:</p>\n\n<pre><code>    this.Property(t =&gt; t.TrafficImageQuestionId)\n        .HasDatabaseGeneratedOption(DatabaseGeneratedOption.None);\n    this.Property(t =&gt; t.TrafficImageGuid)\n        .HasDatabaseGeneratedOption(DatabaseGeneratedOption.None);\n\n    // Table &amp; Column Mappings\n    this.ToTable(\"TrafficImage_Answers\");\n</code></pre>\n\n<p>But i get that the table already exists, logic. I need to tell it that it just should use that table and not try to create it.\n(im doing this with DB mitigrations in EF 5 and Package manager).</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":122,"score":0,"question_id":12661881,"title":"Exclude Property on Update in Entity Framework","body":"<p>I've been looking for a proper way to mark a property to NOT be changed when updating a model in MVC.</p>\n\n<p>For example, let's take this small model:</p>\n\n<pre><code>class Model\n{\n    [Key]\n    public Guid Id {get; set;}\n    public Guid Token {get; set;}\n\n    //... lots of properties here ...\n}\n</code></pre>\n\n<p>then the edit method MVC creates looks like this:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Edit(Model model)\n{\n    if (ModelState.IsValid)\n    {\n        db.Entry(model).State = EntityState.Modified;\n        db.SaveChanges();\n        return RedirectToAction(\"Index\");\n    }\n    return View(model);\n}\n</code></pre>\n\n<p>now if my View does not contain the Token, it will be nullified through that edit.</p>\n\n<p>I'm looking for something like this: </p>\n\n<pre><code>    db.Entry(model).State = EntityState.Modified;\n    db.Entry(model).Property(x =&gt; x.Token).State = PropertyState.Unmodified;\n    db.SaveChanges();\n</code></pre>\n\n<p>The best way so far I found is to be inclusive and set all properties I want included by hand, but I really only want to say which ones to be excluded.</p>\n"},{"tags":["database","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12669363,"title":"ObjectContext.ObjectStateManager","body":"<p>I am using Entity Framework v5;\nI am view link\n<a href=\"http://msdn.microsoft.com/ru-ru/library/system.data.objects.objectcontext.objectstatemanager.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/ru-ru/library/system.data.objects.objectcontext.objectstatemanager.aspx</a>\nBut in this code\n<em>myDbContext.ObjectStateManager.ChangeObjectState(objClass, EntityState.Modified);</em>\nnot have property ObjectStateManager. \nWhere it is property? Or how resolve it problem?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":9737751,"title":"ASP.NET MVC: EF with database first - what do to if models != db tables","body":"<p>What should I do if I have a Model which properties have to be filled from multiple tables from the EDMX file?\nShould the Controller or specific actions do this work for me? Or is EF the wrong technology in this case because I [maybe] have to execute multiple statements to built a single model object for my view?</p>\n\n<p><strong>Update</strong>: Why is nobody mentioning ViewModels? I think this is the way to go? <a href=\"http://jabbr.net/#/rooms/aspnetmvc\" rel=\"nofollow\">http://jabbr.net/#/rooms/aspnetmvc</a> - One of the guys told me that its a standard approach to build a model from multiple entities from the db. So Ill accept that?! Can anyone please give me a last \"OK\" on that? I think all this stuff has confused me because my mind wasnt clear about the term \"Model\". I doesnt have to be a 1:1 relationship and what Im actually working with are VIEWmodels... right?</p>\n"},{"tags":["linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4029,"score":2,"question_id":2874599,"title":"Get top N records using LINQ to Entities","body":"<p>I am using Linq to entities and would like to know if I can get a limited number of records when i query. I just need the top N records as the query do the orderby and other clauses. Is this possible or I will have to get the top N using foreach loop?</p>\n\n<p>Thanks in advance for Ideas and suggestions,<br>\nAbdel Olakara</p>\n"},{"tags":["entity-framework","ef-code-first","code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":291,"score":0,"question_id":10074907,"title":"EF Code First not lazy loading just on property after data import","body":"<p>I'm currently using EF version 4.3.1 with SQL 2008 R2</p>\n\n<p>When I run the application with data generated by the application, everything works fine, but as soon as I import data, then only one of the properties does not want to lazy load.</p>\n\n<p>Here is the Order class I'm using:</p>\n\n<pre><code>[DisplayName(\"Orders\")]\npublic class Order\n{\n    [Key]\n    [DisplayName(\"Order Number\")]\n    public virtual string OrderNumber { get; set; }\n\n    [StringLength(30, ErrorMessage = \"Order name cannot be more than 30 characters.\")]\n    public string Name { get; set; }\n\n    [DisplayName(\"Order Status\")]\n    public virtual OrderStatus OrderStatus { get; set; }\n\n    [Timestamp]\n    public Byte[] TimeStamp { get; set; }\n\n    [DisplayName(\"Customer\")]\n    [Required()]\n    public virtual Customer Customer { get; set; }\n\n    [DisplayName(\"Order Lines\")]\n    public virtual ICollection&lt;OrderLine&gt; OrderLines { get; set; }\n}\n</code></pre>\n\n<p>When loop through all the orders:</p>\n\n<pre><code>foreach (var order in orders)\n        {\n            returnValue.Add(new FriendlyOrder()\n            {\n                Customer = order.Customer.Name,\n                Name = order.Name,\n                OrderNumber = order.OrderNumber,\n                OrderStatus = order.OrderStatus.Status\n            });\n        }\n</code></pre>\n\n<p>The Order status will lazy load, but not the Customer, Customer will be null.  When I run the SQL query manually, then the relationship is there, so it is not related to bad data.</p>\n\n<p>Here is the Customer entity:</p>\n\n<pre><code>[DisplayName(\"Customers\")]\npublic class Customer\n{\n    [Key]\n    [DisplayName(\"Customer Code\")]\n    public string CustomerCode { get; set; }\n\n    public virtual ICollection&lt;Order&gt; Orders { get; set; }\n\n    public bool Active { get; set; }\n\n    [Timestamp]\n    public Byte[] TimeStamp { get; set; }\n\n}\n</code></pre>\n\n<p>Here is the query for orders:</p>\n\n<pre><code>return (from tbl in db.Orders orderby tbl.OrderNumber select tbl).ToList();\n</code></pre>\n\n<p>If I manually include the .Include(\"Customer\") to the above query, then it will load the Customer property, but if I have both properties set to virtual, I shouldn't need to do this?  Also, it works fine on data generated by the application, but data imported does not work unless I add the .Include to the query?</p>\n"},{"tags":["c#","sql-server","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12668983,"title":"EF and table valued function performance","body":"<p>We're using Entity Framework 5.0.0, database first approach.</p>\n\n<p>I've imported a couple of Inline Table-Valued Function (ITVF) to my EDMX which return IQueryable's. Once returned, We most often do some type of operations on them, like .Skip().Take()</p>\n\n<p>The performance is good, for a couple of hours at least. Without doing anything (at least what I know of) the performance degrades over night.</p>\n\n<p>At first, the query will take around 500ms to execute. Over the night the performance degrades to a level where the query returns a Timeout exception (30-60seconds). This only happens when the table function is executed from code, like:</p>\n\n<pre><code>IQueryable&lt;MyResult&gt; results =\n            _context.MyTableFunction(\"searchforthis\")\n                .Skip(currentPagingPosition*20).Take(20);\n</code></pre>\n\n<p>(It's not just the first time we run the query that this happens)</p>\n\n<p>If we however run the same table function direcly from SQL Server Management Studio, the query will execute in ~500ms.</p>\n\n<p>If I \"resave\" the table function like:</p>\n\n<pre><code>ALTER FUNCTION [dbo].[MyTableFunction]......\n</code></pre>\n\n<p>without doing any \"real\" changes, it instantly goes back to being 500ms fast even when called from code.</p>\n\n<p>Am I missing something obvious, any ideas ?</p>\n"},{"tags":["c#","query","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12668469,"title":"Entity Framework partial load","body":"<p>I have the following columns in my table</p>\n\n<ul>\n<li>Id (int)</li>\n<li>Name (nvarchar) usually &lt; 100 characters</li>\n<li>Data (nvarchar) average 1MB</li>\n</ul>\n\n<p>I'm writing a program that will go through each row and perform some operations to the Name field. Since I'm only using the Name field and the Data field is very large, is it possible to direct EF to only load the Id and Name field?</p>\n"},{"tags":["asp.net-mvc","entity-framework","orm","scalability"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":39,"score":-1,"question_id":12198239,"title":"How to achieve EF salability in large web site","body":"<p>What are the best practices to achieve high scalability in a large web site using Entity Framework or any similar ORM? </p>\n"},{"tags":["entity-framework","automapper"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":70,"score":-4,"question_id":12654937,"title":"Using Automapper with Entity Framework, I tried but I am not sure is it right way to do","body":"<pre><code>public int AddQuestions(Question question)\n{\n            MentorEntities context = new MentorEntities();\n// without ignoring these properties it is not mapping giving exception , \n            Mapper.CreateMap&lt;Question, Questions&gt;()\n                  .ForMember(x =&gt; x.EntityKey, opt =&gt; opt.Ignore())\n                  .ForMember(x=&gt;x.Answers,opt=&gt;opt.Ignore())\n                  .ForMember(x=&gt;x.Icon,opt=&gt;opt.Ignore())\n                  .ForMember(x=&gt;x.IconReference,opt=&gt;opt.Ignore())\n                  .ForMember(x=&gt;x.TypeReference,opt=&gt;opt.Ignore())\n                  .ForMember(x=&gt;x.Type,opt=&gt;opt.Ignore());\n            Mapper.AssertConfigurationIsValid();\n            Question qs = new Question();\n            Questions qd = new Questions();\n\n            qd = Mapper.Map&lt;Question, Questions&gt;(question);\n            context.AddToQuestions(qd);\n            context.SaveChanges();\n           return qd.ID;\n}\n</code></pre>\n"},{"tags":["c#",".net","wpf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":92,"score":2,"question_id":12667929,"title":"How to view and edit data from multiple tables in a DataGrid with EF?","body":"<p>I have 2 tables: Orders and Customers. Orders is related to Customers by the IdCustomer foreign key.</p>\n\n<p>Problem: I want to show in the DataGrid the values from both tables and want to be able to edit the data belonging to the Orders table.</p>\n\n<p>I managed to show and edit in the grid the Orders table, but how do I include the data from the Customers table? </p>\n\n<pre><code>this.grdData.ItemsSource = context.Orders;\n\nprivate void btnSave_Click(object sender, RoutedEventArgs e)\n{\n    context.SaveChanges();\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12666186,"title":"Extra Column in Many to Many Relationship in Entity Framework 5.0 reviewed","body":"<p>I'm using the newest Entity Framework and ran into a problem with Many To Many Relationship when I want to create an extra column.</p>\n\n<p>The issue is the same raised in this older post:\n<a href=\"http://stackoverflow.com/questions/7289160/ef-code-first-additional-column-in-join-table-for-ordering-purposes\">EF Code First Additional column in join table for ordering purposes</a></p>\n\n<p>Is it still the problem today that one can not add an extra column without loosing the many to many relation ship (link from object A to B as A.B because the mapping becomes and entity it self) ?</p>\n\n<p>What are the work a rounds ?</p>\n\n<ol>\n<li>Look up the a of class A I need and then query for mapping table <code>where(e=&gt;e.A == a)</code> to get my Bs? And when I need the extra colums i would do <code>MappingTable.find(a,b)</code> ?</li>\n<li>Are there other modeling options, linq to sql that would make it easier ?</li>\n</ol>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12653625,"title":"Custom setter in mvc auto db first","body":"<p>I have a User model that is auto generated DB-First in my MVC application using Entity Framework</p>\n\n<pre><code>User\n  +Username\n  +Password\n</code></pre>\n\n<p>I want to modify the setter of <code>\"Password\"</code> field so that it will be SHA256 incrypted before it is stored in the db.</p>\n\n<p>What would be the best approach?</p>\n"},{"tags":["c#","asp.net-mvc","asp.net-mvc-3","entity-framework","asynchronous"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":201,"score":2,"question_id":7790523,"title":"Inserting data in background/async task what is the best way?","body":"<p>I have an very quick/lightweight mvc action, that is requested very often and I need to maintain minimal response time under heavy load.  </p>\n\n<p>What i need to do, is from time to time depending on conditions to insert small amount of data to sql server (log unique id for statistics, for ~1-5% of queries).</p>\n\n<p>I don't need inserted data for response and if I loose some of it because application restart or smth, I'll survive.</p>\n\n<p>I imagine that I could queue somehow inserting and do it in background, may be even do some kind of buffering - like wait till queue collects 100 of inserts and then make them in one pass.</p>\n\n<p>I'm pretty sure, that somebody must have done/seen such implementation before, there's no need to reinvent wheel, so if somebody could point to right direction, I would be thankful.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12663586,"title":"How to set ID to correspondent to object in entity framework","body":"<p>I have <code>Category</code> that can have <code>RootCategory</code>. Problem is that it does not set <code>RootCategoryID</code> properly, instead it is creating <code>Category_ID</code> in database that I don't even made in my model.</p>\n\n<p>It does map everything like I expect it to if I don't have modified <code>get</code> on RootCategory by the way. But then <code>RootCategory</code> is always null (he does not know where to get it from)</p>\n\n<p>Model</p>\n\n<pre><code>public class Category\n{\n    public int ID { get; set; }\n    // Tried [ForeignKey(\"RootCategoryID\")]\n    public Category RootCategory {\n        get\n        {\n            ORDataContext _db = new ORDataContext();\n            return _db.Categories.Where(x =&gt; x.ID == this.RootCategoryID).SingleOrDefault();\n        }\n    }\n    public int? RootCategoryID { get; set; } // This does not set itself properly\n\n    public ICollection&lt;Category&gt; ChildCategories { get; set; }\n}\n</code></pre>\n\n<p>Generated database after <code>update-database</code></p>\n\n<pre><code>-ID\n-RootCategoryID (that I have created, but it's not used)\n-Category_ID (taht EF created for me, that I don't want)\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","linq-to-entities","asp.net-web-api"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":111,"score":1,"question_id":12658363,"title":"Anonymous type conversion issue with Entity Framework 4 and Web Api","body":"<p>I am fleshing out my data access layer and have run into my first issue. I am using Entity Framework code first along with some repositories and asp.net web api to surface the data in json format.</p>\n\n<p>I am trying to get data from two different poco's served up in a get method. The models are these:</p>\n\n<pre><code>public class Freelancer\n{\n    public int ID { get; set; }\n    public string Email { get; set; }\n    public string Password { get; set; }\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public string CompanyName { get; set; }\n    public string Avatar { get; set; }\n    public Address FreelancerAddress { get; set; }\n    public ICollection&lt;Client&gt; Clients { get; set; }\n}\n</code></pre>\n\n<p>and address:</p>\n\n<pre><code>public class Address\n{\n    public int AddressId { get; set; }\n    public string Street { get; set; }\n    public string City { get; set; }\n    public string State { get; set; }\n    public string PostalCode { get; set; }\n    public string Phone { get; set; }\n    public string Email { get; set; }\n}\n</code></pre>\n\n<p>and finally the list of Client objects:</p>\n\n<pre><code>public class Client\n{\n    public int ID { get; set; }\n    public string Name { get; set; }\n    public Address ClientAddress { get; set; }\n    public string Logo { get; set; }\n    public ICollection&lt;Project&gt; Projects { get; set; }\n    public int FreelancerID { get; set; }\n    public Freelancer Freelancer { get; set; }\n}\n</code></pre>\n\n<p>In my Api Controller I am trying to do something like this (simplified for this question):</p>\n\n<pre><code>public IEnumerable&lt;Freelancer&gt; Get()\n    {\n        var user = Uow.Freelancers.GetFreelancer(1);\n        var result = from x in user\n                     select new\n                     {\n                         ID = x.ID,\n                         Name = x.LastName,\n                         Address = x.FreelancerAddress.Street\n                     };\n        return result;\n    }\n</code></pre>\n\n<p>The error I get is this:</p>\n\n<blockquote>\n  <p>Cannot implicitly convert type 'System.Collections.Generic.IEnumerable' \n      to 'System.Collections.Generic.IEnumerable'. \n      An explicit conversion exists (are you missing a cast?)</p>\n</blockquote>\n\n<p>I can return just the Freelancer object just fine, but in the Json it will show null for address and clients, even though there is related data. Is there a way to get the objects I need using linq, or should I do some kind of re-design of my DAL. I am in the beginning stages so I am looking for a best practice suggestion if you have one.</p>\n\n<p><em><strong>Additional Info</em></strong></p>\n\n<p>This is what gets served up from Uow.Freelancer.GetFreelancer(1);</p>\n\n<pre><code>[{\"iD\":1,\"email\":\"david.stanley.13@gmail.com\",\"password\":\"password\",\"firstName\":\"David\",\"lastName\":\"Stanley\",\"companyName\":null,\"avatar\":null,\"freelancerAddress\":null,\"clients\":null}]\n</code></pre>\n\n<p>GetFreelancer() looks like this:</p>\n\n<pre><code>public IEnumerable&lt;Freelancer&gt; GetFreelancer(int id)\n    {\n        IEnumerable&lt;Freelancer&gt; freelancer = (from x in DbSet\n                         select x);\n        return freelancer;\n    }\n</code></pre>\n\n<p>I don't see any way to use .Reference or .Include, but that may be the right track. I remember doing something like that a few projects ago...</p>\n\n<p><strong>It works!!*</strong></p>\n\n<p>Here is what needed to happen:</p>\n\n<p>I changed the GetFreelancer method to this:</p>\n\n<pre><code>IEnumerable&lt;Freelancer&gt; freelancer = from x in DbSet\n                                     .Include(\"FreelancerAddress\")\n                                     .Include(\"Clients\")\n                                             where x.ID == id\n                                             select x;\n\n        return freelancer;\n</code></pre>\n\n<p>Which did not work at first because Freelancer was referencing Client which had a full reference to Freelance, so it tunnelled forever. I removed the reference in Client so it looks like this instead:</p>\n\n<pre><code>public class Client\n{\n    public int ID { get; set; }\n    public string Name { get; set; }\n    public Address ClientAddress { get; set; }\n    public string Logo { get; set; }\n    public ICollection&lt;Project&gt; Projects { get; set; }\n    public int FreelancerID { get; set; }\n}\n</code></pre>\n\n<p>And my output is exactly what I needed: A freelancer and his address, with a list of his clients.</p>\n"},{"tags":["asp.net-mvc","entity-framework","checkboxfor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":383,"score":0,"question_id":12658183,"title":"Problems with .net mvc 4 razor Html.checkboxfor","body":"<p>I'm having two issues with the above subject line on its use.</p>\n\n<p>I have two strongly typed models that I need to use in one View. The reason why I need two different models is because the data being read is coming from two different databases, so I needed to have an edmx (Entity Framework) data model for each one.</p>\n\n<p>I simply want to bring in a dynamic list of \"templates\" &amp; \"guarantors\". The number of items coming back can obviously change. </p>\n\n<p>Issue 1:\nI want to set each checkbox to \"checked\" and set its name for the display. With this, I don't know if the syntax is correct or not the way I have it set up, even though the second one is not giving me a design time compile error.</p>\n\n<p>Issue 2:\nThe other issue I'm having is that I need to use a different model for each set of check boxes. But, when I set the model in the second set of check boxes, the first model is ignored (which makes sense because it's the last one).</p>\n\n<p>How can I use each of the models successfully in the same View in order to set the check boxes up correctly?</p>\n\n<p>Here is the code:</p>\n\n<pre><code>&lt;tr&gt;\n                            &lt;td colspan=\"5\"&gt;\n                                &lt;b&gt;@Html.Label(\"lbl_Templates\", \"Templates:\")&lt;/b&gt;\n                            &lt;/td&gt;\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                            @model IEnumerable&lt;PDFConverterModel.PDFTemplate&gt;\n                            @foreach (var item in Model)\n                            {\n                                &lt;td&gt;\n                                    @Html.CheckBoxFor(model =&gt; true, item.TemplateName)\n                                &lt;/td&gt;\n                            }\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                            &lt;td colspan=\"5\"&gt;\n                                &lt;b&gt;@Html.Label(\"lbl_Guarantor\", \"Guarantor(s):\")&lt;/b&gt;\n                            &lt;/td&gt;\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                                @model IEnumerable&lt;PDFConverterModel.tGuarantor&gt;\n                                @foreach (var item in Model)\n                                {\n                                    &lt;td&gt;\n                                        @Html.CheckBoxFor(model =&gt; true, item.GuarantorFirstName + \" \" + item.GuarantorLastName)\n                                    &lt;/td&gt;\n                                }\n                        &lt;/tr&gt;\n</code></pre>\n\n<p>btw, is the use of the Label set up correctly syntactically where the first parm is the ID of the Label and the second parm is the Value that is shown?</p>\n\n<p>Part of the Solution:\nI'm almost there... I'm having an issue with getting the indexing of the properties that I want shown via the CheckBoxFor Html Helper on the View (which i haven't used before until now)...</p>\n\n<p>If you could help me with this last part, I would so appreciate it...</p>\n\n<p>You can see that I created the below ViewModel (the one I am working with is the ViewModelTemplate_Guarantors class).</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing PDFConverterModel;\n\nnamespace PDFConverterModel.ViewModels\n{\n    public class ViewModelTemplate\n    {\n        public int SelectedTemplateId { get; set; }\n        public IEnumerable&lt;PDFTemplate&gt; Templates { get; set; }\n    }\n\n    public class ViewModelGuarantors\n    {\n        public int SelectedGuarantorId { get; set; }\n        public IEnumerable&lt;tGuarantor&gt; Guarantors { get; set; }\n    }\n\n    public class ViewModelDepartment\n    {\n        public int SelectedDepartmentId { get; set; }\n        public IEnumerable&lt;Department&gt; Departments { get; set; }\n    }\n\n    public class ViewModelTemplate_Guarantors\n    {\n        public int SelectedTemplateId { get; set; }\n        public IEnumerable&lt;PDFTemplate&gt; Templates { get; set; }\n\n        public int SelectedGuarantorId { get; set; }\n        public IEnumerable&lt;tGuarantor&gt; Guarantors { get; set; }\n    }\n}\n</code></pre>\n\n<p>Below is the Business code method I created in a separate DLL within the client project that populates the Model.</p>\n\n<pre><code>public ViewModelTemplate_Guarantors SelectViewModelTemplate_Guarantors(int LoanId, string LoanTypeId, int DepartmentId)\n        {\n            try\n            {\n                var model = new ViewModelTemplate_Guarantors();\n\n                using (PDFService03Entities DbContext1 = new PDFService03Entities())\n                {\n\n                    DbContext1.Database.Connection.Open();\n\n                    IEnumerable&lt;PDFTemplate&gt; temps = DbContext1.PDFTemplates.Where(p =&gt; p.LoanTypeId == Convert.ToInt32(LoanTypeId) &amp;&amp; p.DepartmentId == DepartmentId).FromCache(CachePolicy.WithSlidingExpiration(TimeSpan.FromSeconds(30)));\n\n                    model.Templates = temps.Select(x =&gt; new PDFTemplate\n                    {\n                        TemplateId = x.TemplateId.ToString(),\n                        TemplateName = x.TemplateName\n                    });\n                }\n\n                using (VisionEntities DbContext2 = new VisionEntities())\n                {\n                    DbContext2.Database.Connection.Open();\n\n                    IEnumerable&lt;tGuarantor&gt; guars = DbContext2.tGuarantors.Where(p =&gt; p.ApplicationNum == LoanId).FromCache(CachePolicy.WithSlidingExpiration(TimeSpan.FromSeconds(30)));\n\n                    model.Guarantors = guars.Select(x =&gt; new tGuarantor\n                    {\n                        ApplicationNum = x.ApplicationNum,\n                        GuarantorFirstName = x.GuarantorFirstName,\n                        GuarantorLastName = x.GuarantorLastName\n                    });\n                }\n\n                return model;\n            }\n            catch (Exception ex)\n            {\n                throw ex;\n            }\n        }\n</code></pre>\n\n<p>Below, is part of the Contoller Action method that calls the above code:</p>\n\n<pre><code>ViewModelTemplate_Guarantors tg = db.SelectViewModelTemplate_Guarantors(Convert.ToInt32(loanID), loanType, Convert.ToInt32(selectedVal));\n</code></pre>\n\n<p>Below is where I'm having my problem in the View...</p>\n\n<p>Since I'm passing back an IEnumerable object, if I was able to send attachments here, I have 4 screen shots that show how I'm using my View. </p>\n\n<p>Suffice it to say, that the screenshots clearly show that the Templates &amp; Guarantors show up. They both are of type IEnumerable ViewModelTemplate_Guarantors.Templates and .Guarantors respectively. </p>\n\n<p>I simply want to put in the index of the item that is coming back, but am getting a design time compile error of:</p>\n\n<p>\"Cannot apply indexing with [ ] to an expression of type 'System.Collections.Generic.IEnumerable\" and tGuarantor respectively.</p>\n\n<p>Call it 101 programming, unless I'm burned out on working on this, but I should be able to apply an index variable for the above collection to get the respective item back, unless I've completely forgot something....</p>\n\n<p>What am I doing wrong below???</p>\n\n<p>Here is my View:</p>\n\n<pre><code>@model IEnumerable&lt;PDFConverterModel.ViewModels.ViewModelTemplate_Guarantors&gt;\n@{\n    ViewBag.Title = \"BHG :: PDF Generator\";\n    int ctr = 0;\n}\n&lt;h2&gt;@ViewBag.Message&lt;/h2&gt;\n\n&lt;form id=\"form1\" runat=\"server\"&gt;\n    &lt;div&gt;\n        &lt;table&gt;\n            &lt;tr&gt;\n                &lt;td&gt;\n                    &lt;table style=\"width: 1000px\"&gt;\n                        &lt;tr&gt;\n                            &lt;td colspan=\"5\"&gt;\n                                &lt;img alt=\"BHG Logo\" src=\"~/Images/logo.gif\" /&gt;\n                            &lt;/td&gt;\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                            &lt;td&gt;\n                                &lt;label for=\"txtLoanID\"&gt;Loan ID :&lt;/label&gt;\n                            @(Html.Kendo().IntegerTextBox()\n                                        .Name(\"txtLoanID\")\n                                        .Placeholder(\"Enter LoanID\")\n                                )\n\n                            &lt;td colspan=\"3\"&gt;\n                                &lt;input type=\"submit\" id=\"btnRefresh\" value='Refresh' /&gt;\n                            &lt;/td&gt;\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                            &lt;td&gt;&lt;@Html.Label(\"lblLoanType1\", \"Loan Type : \")&lt;/td&gt;\n                            &lt;td&gt;&lt;@Html.Label(\"lblLoanType2\", \"SBA\")&lt;/td&gt;\n                            &lt;td&gt;&lt;/td&gt;\n                            &lt;td&gt;\n                                &lt;label for=\"ddlDept\"&gt;Department:&lt;/label&gt;\n                                @(Html.Kendo().DropDownList()\n                                      .Name(\"ddlDept\")\n                                      .DataTextField(\"DepartmentName\")\n                                      .DataValueField(\"DepartmentID\")\n                                      .Events(e =&gt; e.Change(\"Refresh\"))\n                                      .DataSource(source =&gt;\n                                      {\n                                          source.Read(read =&gt;\n                                          {\n                                              read.Action(\"GetDepartments\", \"Home\");\n                                          });\n                                      })\n                                )\n                            &lt;/td&gt;\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                            &lt;td colspan=\"5\"&gt;\n                                &lt;b&gt;@Html.Label(\"lbl_Templates\", \"Templates:\")&lt;/b&gt;\n                            &lt;/td&gt;\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                            @ctr = 0;\n                            @foreach (var item in Model)\n                            {\n                                &lt;td&gt;\n                                    @Html.CheckBoxFor(model =&gt; item.Templates[ctr].TemplateName)\n                                    @ctr = ctr + 1;\n                                    @Html.LabelFor(model =&gt; item.Templates[ctr].TemplateName)\n                                &lt;/td&gt;\n                            }\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                            &lt;td colspan=\"5\"&gt;\n                                &lt;b&gt;@Html.Label(\"lbl_Guarantor\", \"Guarantor(s):\")&lt;/b&gt;\n                            &lt;/td&gt;\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                            @ctr = 0;\n                            @foreach (var item in Model)\n                            {\n                                &lt;td&gt;\n                                    @Html.CheckBoxFor(model =&gt; item.Guarantors[ctr].GuarantorFirstName + \" \" + item.GuarantorLastName)\n                                    @ctr = ctr + 1;\n                                    @Html.LabelFor(model =&gt; item.Guarantors[ctr].GuarantorFirstName + \" \" + item.GuarantorLastName)\n                                &lt;/td&gt;\n                            }\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                            &lt;td colspan=\"2\"&gt;&lt;/td&gt;\n                            &lt;td&gt;\n                                @*@using (Html.BeginForm(\"GeneratePDF\", \"Home\", new { @loanID = loanID }, FormMethod.Post))\n                                { \n                                    &lt;input type=\"submit\" id=\"btnGeneratePDF\" value='Generate PDF' /&gt;\n                                }*@\n                            &lt;/td&gt;\n                            &lt;td colspan=\"2\"&gt;&lt;/td&gt;\n                        &lt;/tr&gt;\n                        &lt;tr&gt;\n                            &lt;td colspan=\"5\"&gt;\n                                &lt;b&gt;@ViewBag.Error&lt;/b&gt;\n                            &lt;/td&gt;\n                        &lt;/tr&gt;\n                    &lt;/table&gt;\n                &lt;/td&gt;\n            &lt;/tr&gt;\n        &lt;/table&gt;\n    &lt;/div&gt;\n&lt;/form&gt;\n\n&lt;script type=\"text/javascript\"&gt;\n\n    $(document).ready(function () {\n        $(\"#ddlDept\").prepend(\"&lt;option value='All' selected='selected'&gt;&lt;/option&gt;\");\n    });\n\n    var txtLoanID;\n\n    $(\"#btnRefresh\").click(function () {\n        Refresh();\n    });\n\n    function Refresh() {\n\n        var txtLoanID = $(\"#txtLoanID\").val();\n\n        if (txtLoanID != \"\") {\n            $.post('/Home/Refresh', { loanID: $('#txtLoanID').val(), loanType: $('#lblLoanType2').val, selectedVal: $(\"#ddlDept option:selected\").text() }, function (data) {\n                data.success;\n                if (data.success == true) {\n                    if (data.templist == true) {\n                        //show the templates\n                        $(\"#lbl_Templates\").visible = true;\n                        $(\"#btnGeneratePDF\").visible = true;\n                    }\n                    if (data.guarlist == true) {\n                        //show the guarantors\n                        $(\"#lbl_Guarantor\").visible = true;\n                        $(\"#btnGeneratePDF\").visible = true;\n                    }\n                    if ((data.templist == true) &amp;&amp; (data.guarlist == true)) {\n                        $(\"#btnGeneratePDF\").visible = true;\n                    }\n                    else {\n                        $(\"#btnGeneratePDF\").visible = false;\n                    }\n                }\n                else {\n                    $(\"#btnGeneratePDF\").visible = false;\n                    //hide the templates\n                    $(\"#lbl_Templates\").visible = false;\n                    $(\"#btnGeneratePDF\").visible = false;\n                    //hide the guarantors\n                    $(\"#lbl_Guarantor\").visible = false;\n                    $(\"#btnGeneratePDF\").visible = false;\n                }\n            });\n        }\n        else {\n            alert(\"Please enter a Loan ID.\");\n        }\n    }\n\n    $(\"#form1\").validate({\n        event: \"submit\",\n        rules: {\n            txtLoanID: {\n                required: true\n            }\n        },\n        messages: {\n            txtLoanID: {\n                required: ' Please enter a Loan ID. '\n            }\n        }\n    });\n\n&lt;/script&gt;\n</code></pre>\n"},{"tags":["entity-framework","poco","efpocoadapter"],"answer_count":8,"favorite_count":2,"up_vote_count":17,"down_vote_count":0,"view_count":10080,"score":17,"question_id":2247891,"title":"\"Metadata information not found\" while using EF4's POCO Template?","body":"<p>I just installed the POCO Template for EF4.  I have a single entity in my model, <strong>AnnouncementText</strong>, and the T4 files seem to be properly generated.  Attempting to access this new entity is throwing the following error when I access the auto-generated property <code>MyObjectContext.AnnouncementTexts</code>:</p>\n\n<blockquote>\n  <p>InvalidOperationException: Mapping and metadata information could not be found for EntityType 'MyNamespace.AnnouncementText'.</p>\n</blockquote>\n\n<p>The properties on the <code>AnnouncementText</code> POCO seem to match up with the columns in the database, and I haven't changed any of the auto-generated code.</p>\n\n<p>The stack trace is:</p>\n\n<pre><code>   at System.Data.Objects.ObjectContext.GetTypeUsage(Type entityCLRType)\n   at System.Data.Objects.ObjectContext.GetEntitySetForNameAndType(String entitySetName, Type entityCLRType, String exceptionParameterName)\n   at System.Data.Objects.ObjectContext.CreateObjectSet[TEntity](String entitySetName)\n   at MyNamespace.MyObjectContext.get_AnnouncementTexts() in C:\\&lt;snip&gt;\\MyObjectContext.Context.cs:line 65\n   at MyNamespace.Class1.Main() in C:\\&lt;snip&gt;\\Class1.cs:line 14\n</code></pre>\n\n<p>If I delete the <code>.tt</code> files from the solution and enable code generation on the model, I am able to access the property without issue.</p>\n\n<p>Here's my code, in case that might help:</p>\n\n<pre><code>using (var context = new MyObjectContext())\n   foreach (var at in context.AnnouncementTexts)\n      Console.WriteLine(at.Title);\n</code></pre>\n\n<p>Any ideas on what might be wrong?</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-membership","asp.net-mvc-4","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":579,"score":2,"question_id":12662587,"title":"How to initialize database with Entity Framework and Membership tables","body":"<p>I have a MVC4 web application that use Entity Framework 5.0 Code First.</p>\n\n<p>In Global.asax.cs I have a bootstrapper that initialize the Entity.Database, force the database to be initialized and initialize the database for the Membership. The code is this one:</p>\n\n<pre><code>        System.Data.Entity.Database.SetInitializer(new DatabaseContextInitializer());\n        Database.Initialize(true);\n        WebSecurity.InitializeDatabaseConnection(DEFAULTCONNECTION, \"UserProfile\", \"UserId\", \"UserName\", autoCreateTables: true);\n</code></pre>\n\n<p>The DatabaseContextInitializer is very simple for the moment:</p>\n\n<pre><code>public class DatabaseContextInitializer : DropCreateDatabaseIfModelChanges&lt;DatabaseContext&gt;\n{\n    protected override void Seed(DatabaseContext dbContext)\n    {\n        base.Seed(dbContext);\n        db.Set&lt;Workout&gt;().Add(new Workout {Id = 1, Name = \"My First workout user1\"})\n\n    }\n}\n</code></pre>\n\n<p>The problem is that I cannot create User to the membership with:</p>\n\n<pre><code>WebSecurity.InitializeDatabaseConnection(DEFAULTCONNECTION, \"UserProfile\", \"UserId\", \"UserName\", autoCreateTables: true);\n</code></pre>\n\n<p>Because I have a problem with that the database is not created. How do you initialize some default user for your database with Entity Framework 5.0 and Asp.Net MVC 4?</p>\n"},{"tags":["c#","entity-framework","postgresql","ef-code-first","npgsql"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":395,"score":0,"question_id":12545228,"title":"npgsql and Entity Framework code first setup problems","body":"<p>The most recent error im getting is</p>\n\n<pre><code>ERROR: 42P01: relation \"dbo.__MigrationHistory\" does not exist\n</code></pre>\n\n<p>but im convinced that this is just because something earlier hasnt been set up properly.</p>\n\n<p>Im currently trying to set up entity framework 4.4 code first to use Npgsql 2.0.12, I have done the following and it seems to atleast be connecting to the database now but giving me the above error when I do context.saveChanges();</p>\n\n<ul>\n<li><p>Updated the machine.config for .net 2.0.50727 with;</p>\n\n<p>&lt; add name=\"Npgsql Data Provider\" invariant=\"Npgsql\" support=\"FF\" \ndescription=\".Net Framework Data Provider for Postgresql Server\"\ntype=\"Npgsql.NpgsqlFactory, Npgsql, Version=2.0.12.0, Culture=neutral,\nPublicKeyToken=5d8b90d52f46fda7\" /></p></li>\n<li><p>Added the dlls to the project</p></li>\n<li><p>Changed the app.config to look like this;</p>\n\n<pre><code>&lt; configuration&gt;\n  &lt; configSections&gt;\n    &lt; section name=\"entityFramework\"\n      type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection,\n      EntityFramework, \n      Version=4.4.0.0, Culture=neutral, \n      PublicKeyToken=b77a5c561934e089\" \n      requirePermission=\"false\" /&gt;\n  &lt; /configSections&gt;\n  &lt; system.data&gt;\n    &lt; DbProviderFactories&gt;\n      &lt; remove invariant=\"Npgsql\"&gt;&lt;/remove&gt;\n      &lt; add name=\"Npgsql Data Provider\" \n           invariant=\"Npgsql\" \n           description=\".Net Framework Data Provider for Postgresql Server\" \n           type=\"Npgsql.NpgsqlFactory, Npgsql, \n                 Version=2.0.12.0, Culture=neutral, \n                 PublicKeyToken=5d8b90d52f46fda7\" /&gt;\n    &lt; /DbProviderFactories&gt;\n  &lt; /system.data&gt;\n  &lt; connectionStrings&gt;\n    &lt; add name=\"DataContext\" \n         connectionString=\"Server=127.0.0.1;Port=5432;Database=postgres;User Id=postgres;Password=*******;CommandTimeout=20;\" \n         providerName=\"Npgsql\" /&gt;\n  &lt; /connectionStrings&gt;\n&lt; /configuration&gt;\n</code></pre></li>\n<li><p>Data passing in looks like the following</p>\n\n<p>public class Animal\n{\n    [Key]\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string Description { get; set; }\n    public int Age { get; set; }\n    public int NoOfLegs { get; set; }\n}</p></li>\n<li><p>Everything else is generic off the shelf set up of contexts</p></li>\n</ul>\n\n<p>Any help on what I'm doing wrong or tip or tutorials, anything would be helpful. This was just a little proof of concept but I wouldnt mind getting it working.</p>\n\n<p>P.s. sorry for the bad use of code formatting, stack exchange will not let me use it properly for some reason even though its formatted correctly. </p>\n"},{"tags":[".net","wcf","entity-framework","wcf-data-services","wcf-data-service"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":754,"score":2,"question_id":5587433,"title":"How do I expose a TimeSpan through a WCF Data Service?","body":"<p>I am creating a WCF Data Service for my database of appointments.</p>\n\n<p>I'm storing the appointment as a DateTime with a duration of type TimeSpan. When I attempt to access my data service, I get the following error:</p>\n\n<blockquote>\n  <p>\"The server encountered an error processing the request. The exception message is 'The property 'Duration' on type 'Appointment' is of type 'Time' which is not a supported primitive type.'. See server logs for more details.\"</p>\n</blockquote>\n\n<p>Any idea how I can represent a time duration and have it accessible through my WCF Data Service?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12661226,"title":"Entity Framework: Metadata informations for relationship","body":"<p>Is there any way to get the metadata informations for the relationships?</p>\n\n<pre><code>public partial class Contact\n{\n    public Contact()\n    {\n        this.Addresses = new HashSet&lt;Address&gt;();\n    }\n\n    public int Id { get; set; }\n    public virtual ICollection&lt;Address&gt; Addresses { get; set; }\n}\n\npublic partial class Address\n{\n    public int Id { get; set; }\n    public int? ContactId { get; set; }\n}\n</code></pre>\n\n<p>How the entity framework knows, that the ContactId is a foreign key?</p>\n"},{"tags":["entity-framework","mysql-connector"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12660932,"title":"Entity Framework + MySql Connector/Net + Group By = Unknown Column","body":"<p>I have the following linq to entities query which throws an exception:</p>\n\n<pre><code>db.Forecasts\n.Where(f =&gt; f.GeoNameID == point.ID)\n.Where(x =&gt; EntityFunctions.AddMinutes(x.DateStamp, utcOffset) &gt;= localTime)\n.GroupBy(x =&gt; EntityFunctions.AddMinutes(x.DateStamp, utcOffset))\n.Select(g =&gt; new\n{\nDate = g.Key,\nMinTemperature = g.Select(x =&gt; x.Temperature).Min(),\nMaxTemperature = g.Select(x =&gt; x.Temperature).Max(),\nMinWindSpeed = g.Select(x =&gt; x.WindSpeed).Min(),\nMaxWindSpeed = g.Select(x =&gt; x.WindSpeed).Max(),\nConditions = g.Select(x =&gt; x.Condition)\n});\n</code></pre>\n\n<p>while the same query without the 'Conditions = g.Select(x => x.Condition)' part works fine.</p>\n\n<p>I read up on the 'Unknown column' issue and found out that it was a known Connector/Net bug in previous versions so I tried this with all the combinations of EF 5 and EF 4.3.1 along with Connector/Net 6.5.4 and the beta Connector/Net 6.6.3. </p>\n\n<p>The previous bug pointed to groupby with sum so it is a little different than my issue. </p>\n\n<p>Is this a bug or just lack of proper error handling from the connector's part (i.e. this shouldnt work but it should catch it during the generation of the query and not at the database level)?</p>\n"},{"tags":["entity-framework","data-migration","bug"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12660259,"title":"Add-Migration makes a mistake - wrong constraint column name?","body":"<p>I'm trying to create a database migration by </p>\n\n<pre><code>PM&gt; Add-Migration\n...\nPM&gt; Update-Database\n...\n</code></pre>\n\n<p>but all I get is an error message telling me that an invalid column is referenced. It gets clear when you look at the generated migration which contains the following Up() method:</p>\n\n<pre><code>    public override void Up()\n    {\n        RenameColumn(table: \"dbo.Bestelllistes\", name: \"Ersteller_Id\", newName: \"PodioUser_Id\");\n        AddColumn(\"dbo.Bestelllistes\", \"ErstelltDatum\", c =&gt; c.DateTime(nullable: false));\n        AddColumn(\"dbo.Bestelllistes\", \"ZuletztModifiziertDatum\", c =&gt; c.DateTime(nullable: false));\n        AddColumn(\"dbo.Bestelllistes\", \"ZuletztModifiziertDurch_Id\", c =&gt; c.Int());\n        AddForeignKey(\"dbo.Bestelllistes\", \"Ersteller_Id\", \"dbo.PodioUsers\", \"Id\");\n        AddForeignKey(\"dbo.Bestelllistes\", \"ZuletztModifiziertDurch_Id\", \"dbo.PodioUsers\", \"Id\");\n        CreateIndex(\"dbo.Bestelllistes\", \"Ersteller_Id\");\n        CreateIndex(\"dbo.Bestelllistes\", \"ZuletztModifiziertDurch_Id\");\n    }\n</code></pre>\n\n<p>RenameColumn contradicts AddForeignKey which still uses the old constraint column name. I could manually change this, but I'm afraid that's not the way it's ought to work. </p>\n\n<p>Is this usual behaviour or is it a bug? Looks like one to me. </p>\n\n<p>//edit: Ah, just to explain what I did before that: I added another <strike>column</strike> property referencing the dbo.PodioUsers table to the \"Bestellliste\" model. So now \"Bestellliste\" has got two properties referencing the \"PodioUser\" model. </p>\n"},{"tags":["asp.net-mvc-3","entity-framework","sql-azure"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12654714,"title":"Using ASP.NET MVC 3 EF with SQL Azure","body":"<p>I am currently developing an ASP.NET MVC3 application using Entity Framework 4.1 Code First. During the development, SQL Express behaves in a sexy way for a lot of reasons : the database is automatically generated when my model changes, and I don't have much more to do except writing my model and my DataContext.</p>\n\n<p>The application is going to be quite big, and I am giving up with the idea of working with MySQL. It will be hosted in my own server, and I would like to work with SQL Azure. Do you think it is possible? How could I configure the connexion? Would the database be automatically generated following the model if I ask to?</p>\n"},{"tags":["c#","entity-framework","reflection"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":12655979,"title":"How to dynamically get a generic C# object reference","body":"<p>With many efforts in my side, i get the following code executing:</p>\n\n<pre><code>var instance = Activator.CreateInstance(\"Assemblyname\", \"TypeName\").Unwrap();\n//Code to fill instance using reflection\nDbContext.Set(instance.GetType()).Add(instance);\nDbContext.SaveChanges();\n</code></pre>\n\n<p>now i want to achieve something like following code:</p>\n\n<pre><code>var u = DbContext.Users;\nvar z = from y in u\nwhere y.Email ==\"some email\"\nselect y;\n</code></pre>\n\n<p>but i want get <code>u</code> Dynamically, i need something first piece of code to reference existent entity inside <code>DbContext</code></p>\n"},{"tags":["sql","entity-framework","profiling","code-first","ef4-code-only"],"answer_count":4,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":1421,"score":6,"question_id":5153776,"title":"How do I get the raw SQL underlying a LINQ query when using Entity Framework CTP 5 \"code only\"?","body":"<p>I've using Entity Framework CTP5 in \"code only\" mode. I'm running a LINQ query on a object that was return from the database, as the query is running really slowly. Is there any way in which I can get the SQL statement that is being generated from the query?</p>\n\n<pre><code>Topic currentTopic =\n    (from x in Repository.Topics\n     let isCurrent = (x.StoppedAt &lt;= x.StartedAt || (x.StartedAt &gt;= currentTopicsStartedAtOrAfter))\n     where x.Meeting.Manager.User.Id == user.Id &amp;&amp; isCurrent\n     orderby x.StartedAt descending\n     select x).FirstOrDefault();\n</code></pre>\n\n<p>The \"Repository\" property is a descendent of DbContext.</p>\n\n<p>It's a little complicated, as EF can't use my helper methods on the objects, so I'm specifying the logic directly in the query.</p>\n\n<p>So, is there any way I can dump the SQL that will be produced by that LINQ query (e.g. to my log4net repository)?</p>\n"},{"tags":["entity-framework","linq-to-sql","code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12658717,"title":"How to combine multiple table using Linq?","body":"<pre><code>public class JobDescription\n    {\n        public int JobDescriptionID { get; set; }\n\n        //          \n\n        public virtual List&lt;Image&gt; Image { get; set; }\n\n    }\n\n public class Image\n    {\n        public int ImageID { get; set; }\n\n        [Required]\n        public int JobDescriptionID { get; set; }\n\n        [ForeignKey(\"JobDescriptionID\")]\n        public virtual JobDescription JobDescription { get; set; }\n\n        public virtual List&lt;ImageSection&gt; ImageSection { get; set; }\n    }\n\n public class ImageSection\n    {\n        public int ImageSectionID { get; set; }\n\n        //\n        public int ImageID { get; set; }\n\n        [ForeignKey(\"ImageID\")]\n        public virtual Image Image { get; set; }\n\n        public virtual DigitalSection DigitalSection { get; set; }\n\n    }\n\npublic class DigitalSection\n    {\n        public int DigitalSectionID { get; set; }\n\n         public int ImageSectionID { get; set; }\n\n         [ForeignKey(\"ImageSectionID\")]\n         public virtual ImageSection ImageSection { get; set; }\n\n         public virtual VerifiedSection VerifiedSection { get; set; }\n    }\n\npublic class VerifiedSection\n    {\n        public int VerifiedSectionID { get; set; }\n\n\n        public string DigitizedText { get; set; }\n\n\n        public int DigitalSectionID { get; set; }\n\n        [ForeignKey(\"DigitalSectionID\")]\n        public virtual DigitalSection DigitalSection { get; set; }\n\n    }\n</code></pre>\n\n<p>I am using CodeFirst approach and I have <code>JobDscriptionID</code>. Now i want to retireve all the <code>DigitizedText</code> from <code>VerifiedSection</code> Table. How to do it ?</p>\n"},{"tags":["c#","asp.net",".net","entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12658816,"title":"DbContext doesn't instantiate navigation property","body":"<p>I created two entities with a simple 1 to many relationship.</p>\n\n<pre><code>public class TestEntity\n{\n    public int Id { get; set; }\n    public string Message { get; set; }\n\n    public virtual ICollection&lt;RelatedTest&gt; RelatedTests { get; set; }\n}\n\npublic class RelatedTest\n{\n    public int Id { get; set; }\n    public bool Something { get; set; }\n\n    public virtual TestEntity TestEntity { get; set; }\n}\n</code></pre>\n\n<p>When I go to test this the <code>ICollection</code> navigation property isn't instantiated. I can't add a related entity.</p>\n\n<pre><code>var dataContext = new DataContext();\nvar testEntity = new TestEntity { Message = \"Test message\" };\nvar related = new RelatedTest { Something = true };\ntestEntity.RelatedTests.Add(related); //fails on this line because RelatedTests is null.\ndataContext.TestEntities.Add(testEntity);\ndataContext.SaveChanges();\n</code></pre>\n\n<p>Is that the expected functionality? Do I have to instantiate the navigation property? I expected Entity Framework to instantiate the collection for me.</p>\n"},{"tags":["c#","entity-framework","automapper"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":121,"score":1,"question_id":12658393,"title":"Getting Automapper to ignore non-scalar and nav properties in EF","body":"<p>Need automapper to map a domain type's properties back to an existing entity from the context (basically just updating the fields that have changed). I need it to ignore Navigation properties and only map the scalar properties.</p>\n\n<p>I can get it to work if I say ForMember(o => o.MyNavProperty, opt => opt.Ignore)  but I'd rather have a generic method for all of my mappings to tell it to only map scalar and not nav properties.</p>\n\n<p>Trying to follow Mauricio's solution:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/7588907/asp-net-mvc-should-i-use-automapper-from-viewmodel-to-entity-framework-entitie\">ASP.net MVC - Should I use AutoMapper from ViewModel to Entity Framework entities?</a></p>\n\n<p>but I can't get it to successfully ignore my navigation properties.</p>\n\n<p>Here's my updated version:</p>\n\n<pre><code>      private static void CreateMapForEF&lt;TDto, TEntity&gt;()\n      {\n         Mapper.CreateMap&lt;TDto, TEntity&gt;()\n    .ForAllMembers(o =&gt; o.Condition(ctx =&gt;\n                                       {\n\n                                          var members = ctx.Parent.SourceType.GetMember(ctx.MemberName); // get the MemberInfo that we are mapping\n\n                                          if (!members.Any())\n                                             return false;\n\n                                          if (members.First().GetCustomAttributes(\n                                                typeof (EdmRelationshipNavigationPropertyAttribute), false).Any())\n                                             return false;\n\n                                          return members.First().GetCustomAttributes(typeof(EdmScalarPropertyAttribute), false).Any(); // determine if the Member has the EdmScalar attribute set\n\n                                       }));\n      }\n</code></pre>\n"},{"tags":["entity-framework",".net-4.0","dataannotations",".net-4.5","upgrade-issue"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":244,"score":1,"question_id":12175389,"title":"Failure after upgrading project from .NET 4.0 to .NET 4.5 => the type or namespace name 'MaxLength'/'Column' could not be found","body":"<p>I have a working website targeting .Net 4.0 and entity framework 4.3.1. \nAfter installing .Net 4.5 ( with Visual Studio Express 2012 ) I can compile the website on Visual Web Developer Express 2010 but when i try to navigate to </p>\n\n<pre><code>http://localhost/ \n</code></pre>\n\n<p>I get this error:</p>\n\n<p>CS0246 The type or namespace name 'MaxLength' could not be found on </p>\n\n<pre><code>[Column(\"titulo\"), Required(), MaxLength(150)]\nLnea 13:         public string Titulo { get; set; }\n</code></pre>\n\n<p>I have this using statement: </p>\n\n<pre><code>using System.ComponentModel.DataAnnotations;\n</code></pre>\n\n<p>The application pool on IIS is configured for .Net 4.0.</p>\n\n<p>I tried updating Entity framework to 4.4 ( from Nuget ) and added this using statement:</p>\n\n<pre><code>using System.ComponentModel.DataAnnotations.Schema;\n</code></pre>\n\n<p>But then the error is:</p>\n\n<p>CS0246 The type or namespace name 'Column' could not be found</p>\n\n<p>Any suggestion to solve the problem?</p>\n\n<p>Thx.</p>\n"},{"tags":["asp.net","entity-framework","entity-framework-4","entity-framework-4.1","dbcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12658361,"title":"EntityFramework creates tables, UserContext tries to use wrong prefix","body":"<p>On my hosting provider, Entity Framework is creating the tables for my simple membership correctly. They are being created with the db prefix being the name of the database:\n<img src=\"http://i.stack.imgur.com/5ltRi.jpg\" alt=\"enter image description here\"></p>\n\n<p>When using my UserContext, it attempts to access [Dbo].UserProfile rather than [DB6002_chuck].UserProfile, thus I am getting this exception </p>\n\n<pre><code>System.Data.SqlClient.SqlException: Invalid object name 'dbo.UserProfile'. at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction) \n</code></pre>\n\n<p>What do I need to do to make sure that my UserContext uses the correct table that was created by EF?</p>\n\n<p>My context looks like this:</p>\n\n<pre><code>public class UsersContext : DbContext\n{\n    public UsersContext()\n        : base(\"DefaultConnection\")\n    {\n    }\n\n    public DbSet&lt;UserProfile&gt; UserProfiles { get; set; }\n}\n\n[Table(\"UserProfile\")]\npublic class UserProfile\n{\n    [Key]\n    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public int UserId { get; set; }\n    public string UserName { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12649603,"title":"EF 5 Model First - Table names are pluralized","body":"<p>I'm using Entity Framewrok 5.0 Model First approach using Visual Studio 2012 express. The generated database tables are pluralized. How do I avoid this? Please advice.</p>\n"},{"tags":["c#","wpf","entity-framework","entity-framework-4.1"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12657088,"title":"Unload Item From Data Context's Local View","body":"<p>I'm loading notes from a database to bind them to a WPF control, like such:</p>\n\n<pre><code>this.DBContext.Notes.Where(n =&gt; n.ID == selectedNote.ID).Load();\nthis.notesBox.DataContext = this.DBContext.Notes.Local;\n</code></pre>\n\n<p>If I want to remove an item from the Local View...</p>\n\n<pre><code>this.DBContext.Local.Notes.Remove(selectedNote);\nthis.notesBox.DataContext = this.DBContext.Notes.Local;\n</code></pre>\n\n<p>...it no longer displays in notesBox, BUT then if I select the note again I can no longer load it into the Local View.</p>\n\n<p><strong>Question: Given that .Load() loads a set of data into the Local View, what is the proper way to unload them from the Local View, so that I can re-load them back in later on?</strong></p>\n\n<p>(I'm assuming that Local.Remove(entity) actually deletes the item from the database if I were to run DBContext.SaveChanges() and that's the reason why I'm not able to load it back in)</p>\n"},{"tags":["c#","asp.net","asp.net-mvc","entity-framework","asp.net-mvc-4"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":12656914,"title":"How to map recursive relation on self in Entity Framework code-first approach","body":"<p>All I want to create is basic recursive category. Category is root if <code>RootCategory_Id</code> is set to null and it belongs to some other category if it is set to some id. I've added category with two child-categories in <code>Seed()</code> method to test and it does not work. (I've checked DB afterwards, there are inserted)</p>\n\n<h3>Category model</h3>\n\n<pre><code>public class Category\n{\n    public int ID { get; set; }\n    public Category RootCategory { get; set; } // This one works good, it also creates \"RootCategory_Id\" in database on \"update-database\"\n\n    public ICollection&lt;Category&gt; ChildCategories { get; set; } // This is always null, how to map it correctly?\n\n    public string Name { get; set; }\n}\n</code></pre>\n\n<h3>Seed method</h3>\n\n<pre><code>protected override void Seed(Test.Infrastructure.TestDataContext context)\n{\n    context.Categories.Add(new Category() {\n        Name = \"First Category\", ChildCategories = new List&lt;Category&gt;() {\n            new Category(){\n                Name = \"Second Category\"\n            },\n            new Category(){\n                Name = \"Third Category\"\n            }\n        }\n    });\n\n    context.SaveChanges();\n}\n</code></pre>\n\n<h3>This is how I tested that it does not work</h3>\n\n<pre><code>public ActionResult Test()\n{\n    // After checking DB my root is 4, and two categories that have RootCategory_Id set to 4\n    var c = _db.Categories.Where(x =&gt; x.ID == 4).Single();\n    return Content(c.ChildCategories.FirstOrDefault().Name); // Always returns null, even c.ChildCategories.Count() returns 'null'\n}\n</code></pre>\n\n<h3>Picture of what I want to achieve</h3>\n\n<p><em>this was generated from database-first approach using linq-to-sql</em>\n<br />\n<img src=\"http://i.stack.imgur.com/y5nUT.png\" alt=\"enter image description here\"></p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":10199353,"title":"EF 4.0 change n_varchar to varchar in ouput sql","body":"<p>I am using Entity Framework 4.0, is there a way to change the sql that's generated by the entity framework from n_varchar to varchar?   Thanks.</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":94,"score":3,"question_id":12649321,"title":"Linq Join with a Group By","body":"<p>Ok, I am trying to replicate the following SQL query into a Linq expression:</p>\n\n<pre><code>SELECT\n    I.EmployeeNumber,\n    E.TITLE,\n    E.FNAM, \n    E.LNAM\nFROM\n    Incidents I INNER JOIN Employees E ON I.IncidentEmployee = E.EmployeeNumber\nGROUP BY\n    I.EmployeeNumber,\n    E.TITLE,\n    E.FNAM, \n    E.LNAM\n</code></pre>\n\n<p>Simple enough (or at least I thought):</p>\n\n<pre><code>var query = (from e in contextDB.Employees\n              join i in contextDB.Incidents on i.IncidentEmployee = e.EmployeeNumber\n              group e by new { i.IncidentEmployee, e.TITLE, e.FNAM, e.LNAM } into allIncEmps\n              select new\n                          {\n                              IncEmpNum = allIncEmps.Key.IncidentEmployee\n                              TITLE = allIncEmps.Key.TITLE,\n                              USERFNAM = allIncEmps.Key.FNAM,\n                              USERLNAM = allIncEmps.Key.LNAM\n                          });\n</code></pre>\n\n<p>But I am not getting back the results I exprected, so I fire up SQL Profiler to see what is being sent down the pipe to SQL Server and this is what I see:</p>\n\n<pre><code>SELECT \n[GroupBy1].[A1] AS [C1]\nFROM ( SELECT \n    COUNT(1) AS [A1]\n    FROM ( SELECT DISTINCT \n        [Extent2].[IncidentEmployee] AS [IncidentEmployee], \n        [Extent1].[TITLE] AS [TITLE], \n        [Extent1].[FNAM] AS [FNAM], \n        [Extent1].[LNAM] AS [LNAM]\n        FROM  [dbo].[Employees] AS [Extent1]\n        INNER JOIN [dbo].[INCIDENTS] AS [Extent2] ON ([Extent1].[EmployeeNumber] = [Extent2].[IncidentEmployee]) OR (([Extent1].[EmployeeNumber] IS NULL) AND ([Extent2].[IncidentEmployee] IS NULL))\n    )  AS [Distinct1]\n)  AS [GroupBy1]\n</code></pre>\n\n<p>As you can see from the SQL string that was sent toSQL Server none of the fields that I was expecting to be return are being included in the Select clause. What am I doing wrong?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>It has been a very long day, I re-ran the code again and now this is the SQL that is being sent down the pipe:</p>\n\n<pre><code>SELECT \n[Distinct1].[IncidentEmployee] AS [IncidentEmployee], \n[Distinct1].[TITLE] AS [TITLE], \n[Distinct1].[FNAM] AS [FNAM], \n[Distinct1].[LNAM] AS [LNAM]\nFROM ( SELECT DISTINCT \n    [Extent1].[OFFNUM] AS [OFFNUM], \n    [Extent1].[TITLE] AS [TITLE], \n    [Extent1].[FNAM] AS [FNAM], \n    [Extent1].[LNAM] AS [LNAM]\n    FROM  [dbo].[Employees] AS [Extent1]\n    INNER JOIN [dbo].[INCIDENTS] AS [Extent2] ON ([Extent1].[EmployeeNumber] = [Extent2].[IncidentEmployee]) OR (([Extent1].[EmployeeNumber] IS NULL) AND ([Extent2].[IncidentEmployee] IS NULL))\n)  AS [Distinct1]\n</code></pre>\n\n<p>But I am still not seeing results when I try to loop through the record set</p>\n\n<pre><code>foreach (var emps in query)\n{\n\n}\n</code></pre>\n"},{"tags":["c#","asp.net-mvc","linq","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12654149,"title":"The specified type member 'Items' is not supported in LINQ to Entities","body":"<p>I'm making my project using code-first approach for the first time and I've never seen this error pop up when I was creating my projects using database-first approach.</p>\n\n<p><em>I know that there is a lot of these errors here but I've checked them and it seems that I need someone explain to me what is wrong in my particular example for me to understand it well.</em></p>\n\n<h2>Error</h2>\n\n<blockquote>\n  <p>The specified type member 'Items' is not supported in LINQ to\n  Entities. Only initializers, entity members, and entity navigation\n  properties are supported.</p>\n  \n  <p>Description: An unhandled exception occurred during the execution of\n  the current web request. Please review the stack trace for more\n  information about the error and where it originated in the code. </p>\n  \n  <p>Exception Details: System.NotSupportedException: The specified type\n  member 'Items' is not supported in LINQ to Entities. Only\n  initializers, entity members, and entity navigation properties are\n  supported.</p>\n</blockquote>\n\n<h2>What causes error</h2>\n\n<pre><code>public dynamic List()\n{\n    var categories = db.Categories.OrderByDescending(x =&gt; x.CreatedDateTime).Select(x =&gt; new\n    {\n        ID = x.ID,\n        Name = x.Name,\n        RootCategoryName = x.RootCategory.Name,\n        ItemCount = x.Items.Count() // This line\n    });\n\n    return Json(categories, JsonRequestBehavior.AllowGet);\n}\n</code></pre>\n\n<h2>Item model</h2>\n\n<pre><code>public class Item\n{\n    public int ID { get; set; }\n\n    public int CategoryID { get; set; } // Seems like here I've done everything correctly\n    public Category Category { get; set; } // Seems like here I've done everything correctly\n\n    [Required]\n    public string Name { get; set; }\n    public string Info { get; set; }\n\n    public bool? IsAccessory { get; set; }\n    public int? RootItemID { get; set; }\n    public Item RootItem { get; set; }\n}\n</code></pre>\n\n<h2>Category model</h2>\n\n<pre><code>public class Category\n{\n    public int ID { get; set; }\n\n    public int? RootCategoryID { get; set; }\n    public Category RootCategory { get; set; }\n\n    [Required]\n    public string Name { get; set; }\n    public string Info { get; set; }\n\n    public IQueryable&lt;Item&gt; Items { get; set; } // Here also it seems that I've done relations correctly\n\n    public DateTime CreatedDateTime { get; set; }\n    public DateTime ModifiedDateTime { get; set; }\n}\n</code></pre>\n\n<p>At first glance it seems to me that it is impossible to call something like <code>Category.Items.Count()</code> or <code>Item.Category.Name</code> using code-first, but I think I did something wrong with code because it should be possible. Please help, what should I do to make this work?</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12654002,"title":"SNIReadSyncOverAsync and WaitForSingleObject blocking EF performance?","body":"<p>I am doing some profiling on a WCF service that uses EF (System.Data.Entities) to read from a sql DB. When I spin up multiple parallel clients that hit the service, the CPUs all go to 100%, performance generally tanks, and everything bogs down.</p>\n\n<p>In profiling this with the concurrency profiler, I found 85% of the time is spent in synchronization, with only about 4% being actual code execution. Looking deeper into the stack trace, most of the synchronization seems to be from a call to WaitForSingleObject in System.Data.SqlClient.TdsParserStateObject.ReadSniSyncOverAsync. The stack shows that call goes to a native method wrapper, and then winds up at kernel32.dll!_WaitForSingleObject.</p>\n\n<p>Has anyone experienced this before? Is there any way to do something about this? I'm not really throwing absurd load at this, only about 20 parallel clients, and it's all read-only, so I'm surprised the threads would even bother to synchronize.</p>\n\n<p>I've been fighting with this for a week now and I just can't explain it. Any help would be appreciated!</p>\n"},{"tags":["c#","visual-studio","entity-framework","transactions","atomic"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12600654,"title":"Performing \"atomic\" operation \"IncreaseIf\" on database","body":"<p>I need to perform <em>atomic</em> operation check value of some field of some entity framework model and increase it if its value is 0.</p>\n\n<p>I thought about transactions, sth like:</p>\n\n<pre><code>bool controlPassed = false;\nusing (TransactionScope scope = new TransactionScope())\n{\n    var model = ...ModelEntities.first_or_default(...)\n    if (model.field == 0){\n        ++model.field;\n        ...saveChanges();\n        controlPassed = true;\n    }\n    scope.Complete();\n}\nif (controlPassed)\n{\n    ...\n    using (TransactionScope scope = new TransactionScope())\n    {\n        --model.field;\n        ...saveChanges();\n        scope.Complete();\n    }\n}\n</code></pre>\n\n<p>Of course, everything in try catch and so on.</p>\n\n<p>My question is: how would it work?</p>\n\n<p>It is really hard to check.\nI have multithreaded application.</p>\n\n<p>Is there a possibility, that two or more threads would pass control (check that <code>field == 0</code> and increase it)?</p>\n\n<p>Whout would be blocked in database (database, table, row, field)?</p>\n\n<p>I can't let two or more threads to be in <code>controlPassed</code> section simultaneously. </p>\n"},{"tags":[".net","entity-framework","stored-procedures","linq-to-entities","iqueryable"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":4455,"score":2,"question_id":2772295,"title":"IQueryable<> from stored procedure (entity framework)","body":"<p>I want to get <code>IQueryable&lt;&gt;</code> result when executing stored procedure.  </p>\n\n<p>Here is peace of code that works fine:  </p>\n\n<pre><code>IQueryable&lt;SomeEntitiy&gt; someEntities;  \nvar globbalyFilteredSomeEntities = \n  from se in m_Entities.SomeEntitiy\n    where\n      se.GlobalFilter == 1234 \n  select se;\n</code></pre>\n\n<p>I can use this to apply global filter, and later use result in such way  </p>\n\n<pre><code>result = globbalyFilteredSomeEntities\n  .OrderByDescending(se =&gt; se.CreationDate)\n  .Skip(500)\n  .Take(10);\n</code></pre>\n\n<hr>\n\n<p>What I want to do - use some stored procedures in global filter.<br>\nI tried:  </p>\n\n<p>Add stored procedure to <code>m_Entities</code>, but it returns <code>IEnumerable&lt;&gt;</code> and executes sp immediately:  </p>\n\n<pre><code>var globbalyFilteredSomeEntities = \n  from se in m_Entities.SomeEntitiyStoredProcedure(1234);\n</code></pre>\n\n<p>Materialize query using EFExtensions library, but it is <code>IEnumerable&lt;&gt;</code>.<br>\nIf I use <code>AsQueryable()</code> and <code>OrderBy()</code>, <code>Skip()</code>, <code>Take()</code><br>\nand after that <code>ToList()</code> to execute that query -<br>\nI get exception that <code>DataReader</code> is open and I need to close it first(can't paste error - it is in russian).</p>\n\n<pre><code>var globbalyFilteredSomeEntities = \n  m_Entities.CreateStoreCommand(\"exec SomeEntitiyStoredProcedure(1234)\")\n            .Materialize&lt;SomeEntitiy&gt;();\n            //.AsQueryable()\n            //.OrderByDescending(se =&gt; se.CreationDate)\n            //.Skip(500)\n            //.Take(10)\n            //.ToList();   \n</code></pre>\n\n<p>Also just skipping <code>.AsQueryable()</code> is not helpful - same exception.<br>\nWhen I put <code>ToList()</code> query executes,<br>\nbut it is too expensive to execute query without <code>Skip()</code>, <code>Take()</code>.</p>\n"},{"tags":[".net","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":291,"score":5,"question_id":4329052,"title":"Creating Entity Framework Objects from Stored Procedures","body":"<p>When using Entity Framework 4, how do you create a <strong>single entity</strong> from a stored procedure?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":596,"score":0,"question_id":696499,"title":"Stored procedure and Entity Framework","body":"<p>I have stored Procedure getSalesOrder() returning a row structure like this:</p>\n\n<p>Order (map with EF), customfield1 , customfield2 ,customfield3.</p>\n\n<p>How can i use EntityFramework to get the order, and custom Fields Values ?</p>\n"},{"tags":["entity-framework","stored-procedures","parameters"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":863,"score":3,"question_id":8332013,"title":"How to pass Parameters to Stored Procedure from Entity Framework?","body":"<p>I want to know how to send parameters to stored procedure from entity framework? Thanks in advance.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":11889559,"title":"Entity Framework - stored procedure","body":"<p>My stored procedure looks like this:</p>\n\n<pre><code>create Procedure procLoc\nAS\nBEGIN\n      select \n          pr.name, loc.address\n      from \n          Profile pr \n      join \n          Location loc on pr.id = loc.id\nEND\n</code></pre>\n\n<p>For the add function Import dialog box that comes up, there are the following options</p>\n\n<ul>\n<li>None</li>\n<li>Scalars</li>\n<li>Complex</li>\n<li>Entities</li>\n</ul>\n\n<p>Which option would I select in this scenario? </p>\n"},{"tags":["c#",".net","sql-server","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":475,"score":0,"question_id":2744760,"title":"Stored Procedure in Entity Framework","body":"<p>I had added the Stored procedure in my Entity framework and i also imported the functions in the edmx. Is it must to add all the three functions insert, update, and delete functions to a table. I had tried with insert alone and also with all, but why can't i get the name of the stored procedure in the connection string.</p>\n\n<p>Let me know what i done clearly.</p>\n\n<ol>\n<li>I had added the sp</li>\n<li>i had imported the functions in the model browser.</li>\n<li><p>i had also mapped the insert, update and delete function to the table with return type only for insert and update.\nStill i can't get the name of SP in the connection string.</p>\n\n<p>Please let me know how could i resolve this issue.\nThanks in Advance,\nKamal.</p></li>\n</ol>\n"},{"tags":["vb.net","entity-framework","linq-to-sql","data-binding"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12651218,"title":"Linq2SQL or EntityFramework and databinding","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/301809/workarounds-for-nameof-operator-in-c-typesafe-databinding\">workarounds for nameof() operator in C#: typesafe databinding</a>  </p>\n</blockquote>\n\n\n\n<p>is there some way to do databinding with linq2SQL or EntityFramework using \"typed links\" to the bound property?</p>\n\n<pre><code>Public Class Form1\n\n    Dim db As New MESDBEntities 'datacontext/ObjectContext\n    Dim bs As New BindingSource\n\n    Private Sub Form1_Load(sender As System.Object, e As System.EventArgs) Handles MyBase.Load\n        bs.DataSource = (From m In db.PROB_GROUP Select m)\n        grid.DataSource = bs\n        TextBox1.DataBindings.Add(\"Text\", bs, \"PGR_NAME\")\n        TextBox1.DataBindings.Add(\"Text\", bs, db.PROB_GROUP) '**&lt;--- Somthing like this**\n    End Sub\nEnd Class\n</code></pre>\n\n<p>I'd like to have type checking when compiling and the model changed.</p>\n"},{"tags":["entity-framework","asp.net-web-api"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":283,"score":1,"question_id":12647219,"title":"Entity Framework not serviceable in my WebAPI Mvc4 solution","body":"<p>I have made Entity Framework Code First with fluent api.</p>\n\n<p>I have a web api controller:</p>\n\n<pre><code>public class NewsController : ApiController\n{\n    private TrafficTheoryContext db = new TrafficTheoryContext();\n\n    // GET api/News\n    public IEnumerable&lt;News&gt; GetNews()\n    {\n        //return new List&lt;News&gt; {\n       //  new News{ Title = \"Featuring Azure ACS Authentication\", Subtile=\"Hello \"}};\n        return db.News.AsEnumerable();\n    }\n} \n</code></pre>\n\n<p>If i make a get request i get an error:</p>\n\n<p>This XML file does not appear to have any style information associated with it. The document tree is shown below.</p>\n\n<pre><code>&lt;Error&gt;\n&lt;Message&gt;An error has occurred.&lt;/Message&gt;\n&lt;ExceptionMessage&gt;\nThe 'ObjectContent`1' type failed to serialize the response body for content type 'application/xml; charset=utf-8'.\n&lt;/ExceptionMessage&gt;\n&lt;ExceptionType&gt;System.InvalidOperationException&lt;/ExceptionType&gt;\n&lt;StackTrace/&gt;\n&lt;InnerException&gt;\n&lt;Message&gt;An error has occurred.&lt;/Message&gt;\n&lt;ExceptionMessage&gt;\nType 'System.Data.Entity.DynamicProxies.News_786DE29B12691F869E9C9DF523A808EABE06546C3FCE3354F77875B83B9EB51C' with data contract name 'News_786DE29B12691F869E9C9DF523A808EABE06546C3FCE3354F77875B83B9EB51C:http://schemas.datacontract.org/2004/07/System.Data.Entity.DynamicProxies' is not expected. Consider using a DataContractResolver or add any types not known statically to the list of known types - for example, by using the KnownTypeAttribute attribute or by adding them to the list of known types passed to DataContractSerializer.\n&lt;/ExceptionMessage&gt;\n&lt;ExceptionType&gt;\nSystem.Runtime.Serialization.SerializationException\n&lt;/ExceptionType&gt;\n&lt;StackTrace&gt;\nat System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeAndVerifyType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, Boolean verifyKnownType, RuntimeTypeHandle declaredTypeHandle, Type declaredType) at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithXsiType(XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle objectTypeHandle, Type objectType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle, Type declaredType) at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle) at WriteArrayOfNewsToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , CollectionDataContract ) at System.Runtime.Serialization.CollectionDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context) at System.Runtime.Serialization.XmlObjectSerializerWriteContext.WriteDataContractValue(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle) at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle) at System.Runtime.Serialization.DataContractSerializer.InternalWriteObjectContent(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver) at System.Runtime.Serialization.DataContractSerializer.InternalWriteObject(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver) at System.Runtime.Serialization.XmlObjectSerializer.WriteObjectHandleExceptions(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver) at System.Runtime.Serialization.DataContractSerializer.WriteObject(XmlWriter writer, Object graph) at System.Net.Http.Formatting.XmlMediaTypeFormatter.&lt;&gt;c__DisplayClass7.&lt;WriteToStreamAsync&gt;b__6() at System.Threading.Tasks.TaskHelpers.RunSynchronously(Action action, CancellationToken token)\n&lt;/StackTrace&gt;\n&lt;/InnerException&gt;\n&lt;/Error&gt;\n</code></pre>\n\n<p>If i just return a List of News it work fines.  I noticed the clases are appended with some kind of name that i do not know what is? </p>\n\n<p>What do i do to get the webapi to work?</p>\n"},{"tags":["mysql","entity-framework","dbcontext","entity-framework-5","notsupportedexception"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12624544,"title":"Entity Framework \"Empty insert statement\"","body":"<p>I am using entity framework code first with dotConnect for MySQL.</p>\n\n<p>I get the following error when I call <code>context.SaveChanges()</code> after adding an object to the context:</p>\n\n<blockquote>\n  <p><strong>DbUpdateException</strong>:<br>\n  An error occurred while updating the entries. See the inner exception for details.</p>\n  \n  <p>Inner Exception:<br>\n  UpdateException: An error occurred while updating the entries. See the inner exception for details.</p>\n  \n  <p>Inner Exception: \n  EntityCommandCompilationException: An error occurred while preparing the command definition. See the inner exception for details.\"}</p>\n  \n  <p>Inner Exception:<br>\n  NotSupportedException: {\"Empty insert statement.\"}</p>\n</blockquote>\n\n<p>when saving the <code>DbContext</code> after I added an item to the <code>DbContext</code></p>\n\n<p><strong>The weird part is that when I add all its content its added successfully, but when I add the object itself I get this error.</strong></p>\n\n<p>This line of code fails:</p>\n\n<pre><code>context.TournamentTables.Add(tournamentTable);\n</code></pre>\n\n<p>While this one works perfectly:</p>\n\n<pre><code>tournamentTable.Columns.ForEach(column =&gt;\n                                   {\n                                       column.Cells.ForEach((cell) =&gt; context.TournamentCells.Add(cell));\n                                       context.TournamentColumns.Add(column);\n\n                                   });\n</code></pre>\n\n<p>Here is the object I try to add:</p>\n\n<pre><code>public class TournamentTable //: IEnumerable&lt;TournamentColumn&gt;\n    {\n        [Key]\n        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n        public int? Id { get; set; }\n\n        public List&lt;TournamentColumn&gt; Columns { get; set; }\n\n        public TournamentTable()\n        {\n            Columns = new List&lt;TournamentColumn&gt;();\n        }\n\n        public void AddColumn(int index, TournamentColumn column)\n        {\n            Columns.Insert(index, column);\n        }\n\n        public void RemoveColumn(int index)\n        {\n            Columns.RemoveAt(index);\n        }\n\n        /// &lt;summary&gt;\n        /// Add a tournament cell at the top of the column.\n        /// &lt;/summary&gt;\n        /// &lt;param name=\"column\"&gt;&lt;/param&gt;\n        public void AddColumn(TournamentColumn column)\n        {\n            Columns.Add(column);\n        }\n\n        /// &lt;summary&gt;\n        /// Returns the tournament column at the index specified.\n        /// &lt;/summary&gt;\n        /// &lt;param name=\"index\"&gt;&lt;/param&gt;\n        /// &lt;returns&gt;&lt;/returns&gt;\n        [NotMapped]\n        public TournamentColumn this[int index]\n        {\n            get { return Columns[index]; }\n        }\n\n        /// &lt;summary&gt;\n        /// Returns the tournament cell at the index specified.\n        /// &lt;/summary&gt;\n        /// &lt;param name=\"columnIndex\"&gt;&lt;/param&gt;\n        /// &lt;param name=\"cellIndex\"&gt;&lt;/param&gt;\n        /// &lt;returns&gt;&lt;/returns&gt;\n        [NotMapped]\n        public TournamentCell this[int columnIndex, int cellIndex]\n        {\n            get { return Columns[columnIndex][cellIndex]; }\n            set\n            {\n\n                Columns[columnIndex][cellIndex] = value;\n            }\n        }\n    }\n</code></pre>\n\n<p>Note that the Tournament Table Id is 0 by default, and if the Id is declared as \"int?\" than it will be null. I've tried both cases and also setting the id by myself and it still fails.</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":186,"score":3,"question_id":9951522,"title":"EF code first error \"The specified index already exists. [ IX_Id ]\" for object tree","body":"<p>Using EF code first 4.3 I'm trying to model an object tree with a required-required relationships and a required-optional relationships.</p>\n\n<p>Here is a simple representation of those classes</p>\n\n<pre><code>public class Top\n{\n    public int Id { get; set; }\n    public virtual Middle Middle { get; set; }\n}\n\npublic class Middle\n{\n    public int Id { get; set; }\n    public virtual Child Child { get; set; }\n}\n\npublic class Child\n{\n    public int Id { get; set; }\n}\n</code></pre>\n\n<p>Here is the OnModelCreating code</p>\n\n<pre><code>modelBuilder.Entity&lt;Top&gt;().HasRequired(t =&gt; t.Middle).WithRequiredPrincipal().WillCascadeOnDelete();\nmodelBuilder.Entity&lt;Middle&gt;().HasRequired(t =&gt; t.Child).WithOptional().WillCascadeOnDelete();\n</code></pre>\n\n<p>This produces the error <strong>\"The specified index already exists. [ IX_Id ]\"</strong> on SQLCE</p>\n\n<p>After checking the db schema, both model binder fluent API configuration lines create an index IX_Id on the table Middles.</p>\n\n<p>Does anyone know how to work around that problem?</p>\n\n<p>Is there a way to set the index name?</p>\n\n<p>Thank you!\nPascal</p>\n"},{"tags":["entity-framework","sql-server-ce","visual-studio-2012","sql-server-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":254,"score":0,"question_id":12427459,"title":"Running SQL Server CE 4 Queries with Visual Studio 2012 and SQL Server Management Studio 2012","body":"<p>I have recently upgraded to Visual Studio 2012 and SQL Server Management Studio 2012, however I cannot seem to see how to execute SQL scripts (created by Entity framework) on a SQL Server CE 4.0 database. With VS2010 + SSMS 2008 the Transact-SQL editor would ask for a connection and you could browse to the object, however this option is not available in SSMS 2012. </p>\n\n<p>I have tried to execute the script via the Server Explorer -> New Query window, but I get parse errors. Any clues?</p>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12648340,"title":"MVC3 Scaffolding will not generate dropdowns in views where foreign keys exist","body":"<p>This is driving me crazy, and I have studied the related posts on StackOverflow.</p>\n\n<p>Basically I have 2 tables, Album and Genre with the former having a foreign key to Genre. I have modelled this using Model First in EF5, and generated the context and class files using MS's T4 generator. Thus my Domains Class code is:</p>\n\n<pre><code>{\nusing System;\nusing System.Collections.Generic;\n\npublic partial class Album\n{\n    public int Id { get; set; }\n    public string Title { get; set; }\n    public decimal Price { get; set; }\n    public string AlbumArtUrl { get; set; }\n\n    public int GenreId {get; set;}\n    public virtual Genre Genre { get; set; }\n}\n}\n</code></pre>\n\n<p>You will notice that I have added :</p>\n\n<pre><code>public int GenreId {get; set;}\n</code></pre>\n\n<p>as per guidance inorder to enable the scaffolding to create the dropdowns in the Views and \"SelectList\" code in the controller. But it does not! However it does create, in the view:</p>\n\n<pre><code>     &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.GenreId)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.GenreId)\n        @Html.ValidationMessageFor(model =&gt; model.GenreId)\n    &lt;/div&gt;\n</code></pre>\n\n<p>So I am really puzzled. Any ideas would be greatly appreciated.</p>\n\n<p>Thanks,</p>\n\n<p>Ed</p>\n\n<p>P.S. I am running VS2010 SP1 with ASP.NET MVC 3 Tools Update it seems, since I tried to install it and it said that it was already installed.</p>\n"},{"tags":["mysql","linq","entity-framework","linq-to-entities","entity"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":272,"score":1,"question_id":10129001,"title":"How to do Bulk Insert using MySQL (like SqlBulkCopy) with Linq to Entities","body":"<p>Hi I need a method to insert a large number of records into a MySQL database table.</p>\n\n<p>I'm using Linq to Entities and the method of using a foreach loop and inserting each record is too slow.</p>\n\n<p>e.g.</p>\n\n<pre><code>foreach(var item in items){\n    context.Add(item);\n    context.SubmitChanges();\n}\n</code></pre>\n\n<p>Is there a method like the MySql command: LOAD DATA INFILE available in the .net connector?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":164,"score":0,"question_id":12627876,"title":"Installed MVC 4 Entity framework configuration errors","body":"<p>I have just installed MVC4.</p>\n\n<p>According to nuGet package manager, my version of EF is 5.0.0, last updated on 11th Sept 2012</p>\n\n<p>When I try to create a new controller (right click controllers -> Add -> Controller), I am faced with an error message and am not able to create a new controller...</p>\n\n<pre><code>Could not load type 'System.ComponentModel.DataAnnotations.Schema.TableAttribute' \nfrom assembly 'EntityFramework, Version=4.1.0.0, Culture=neutral,     \nPublicKeyToken=b77a5c561934e089'.\n</code></pre>\n\n<p>I am just getting started with ASP.NET MVC, so if anybody could help me to resolve, it would be much appreciated.</p>\n\n<p>From the Package Manager Console, I have tried uninstalling and re-installing Entity Framework as follows but this has had no effect:</p>\n\n<pre><code>PM&gt; Uninstall-Package EntityFramework\nSuccessfully removed 'EntityFramework 5.0.0' from GD.\nSuccessfully uninstalled 'EntityFramework 5.0.0'.\n\nPM&gt; Install-Package EntityFramework\nYou are downloading EntityFramework from Microsoft, the license agreement to which is available at http://go.microsoft.com/fwlink/?LinkId=253898&amp;clcid=0x409. Check the package for additional dependencies, which may come with their own license agreement(s). Your use of the package and dependencies constitutes your acceptance of their license agreements. If you do not accept the license agreement(s), then delete the relevant components from your device.\nSuccessfully installed 'EntityFramework 5.0.0'.\nSuccessfully added 'EntityFramework 5.0.0' to GD.\n\nType 'get-help EntityFramework' to see all available Entity Framework commands.\n\nPM&gt; \n</code></pre>\n\n<p>Many thanks in advance for all your help.</p>\n\n<p>UPDATE:</p>\n\n<p>I am following this tutorial. <a href=\"http://msdn.microsoft.com/en-us/data/gg685467.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/data/gg685467.aspx</a></p>\n\n<p>It appears that MVC4 does not like this method of creating a DBContext...</p>\n\n<pre><code>Also there will be a new reference listed in the project references\ncalled EntityFramework. This is the assembly that contains the Code\nFirst runtime.\n\nAdd a new class to the Models folder and name it BlogContext. Modify\nthe class to match the following code: \n\nusing System.Data.Entity;\nnamespace MVC3AppCodeFirst.Models \n{   \n    public class BlogContext : DbContext   \n    {\n        public DbSet&lt;Blog&gt; Blogs { get; set; }\n        public DbSet&lt;Post&gt; Posts { get; set; }\n        public DbSet&lt;Comment&gt; Comments { get; set; }   \n    } \n}\n</code></pre>\n\n<p>It builds fine, so am I missing something ???</p>\n"},{"tags":["c#","entity-framework","stored-procedures","ef-code-first","table-valued-parameters"],"answer_count":3,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":3218,"score":9,"question_id":8157345,"title":"Entity Framework Stored Procedure Table Value Parameter","body":"<p>I'm trying to call a stored procedure that accepts a table value parameter.  I know that this isn't directly supported in Entity Framework yet but from what I understand you can do it using the ExecuteStoreQuery command off of the ObjectContext.  I have a generic entity framework repository where I have the following ExecuteStoredProcecdure method:</p>\n\n<pre><code>public IEnumerable&lt;T&gt; ExecuteStoredProcedure&lt;T&gt;(string procedureName, params object[] parameters)\n{\n    StringBuilder command = new StringBuilder();\n    command.Append(\"EXEC \");\n    command.Append(procedureName);\n    command.Append(\" \");\n\n    // Add a placeholder for each parameter passed in\n    for (int i = 0; i &lt; parameters.Length; i++)\n    {\n        if (i &gt; 0)\n            command.Append(\",\");\n\n        command.Append(\"{\" + i + \"}\");\n    }\n\n    return this.context.ExecuteStoreQuery&lt;T&gt;(command.ToString(), parameters);\n}\n</code></pre>\n\n<p>The command string ends up like this:</p>\n\n<pre><code>EXEC someStoredProcedureName {0},{1},{2},{3},{4},{5},{6},{7}\n</code></pre>\n\n<p>I tried to run this method on a stored procedure that accepts a table valued parameter and it breaks.  I read <a href=\"http://stackoverflow.com/questions/6084061/udt-as-a-parameter-in-ef4-query\">here</a> that the parameters needed to be of type SqlParameter and the table valued parameter needs to have the SqlDbType set to Structured.  So I did this and I get an error stating:</p>\n\n<pre><code>The table type parameter p6 must have a valid type name\n</code></pre>\n\n<p>So, I set the SqlParameter.TypeName to the name of the user defined type I created on the database and then when I run the query I get the following truly helpful error:</p>\n\n<pre><code>Incorrect syntax near '0'.\n</code></pre>\n\n<p>I can get the query to run if I revert back to ADO.NET and and execute a data reader but I was hoping to get it to work using the data context.</p>\n\n<p>Is there a way to pass a table value parameter using ExecuteStoreQuery?  Also, I am actually using Entity Framework Code First and casting the DbContext to an ObjectContext to get the ExecuteStoreQuery method available.  Is this necessary or can I do this against the DbConext as well?</p>\n"}]}
{"total":18927,"page":16,"pagesize":100,"questions":[{"tags":["asp.net-mvc-3","entity-framework","seeding"],"answer_count":0,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":12648269,"title":"EF5 breaks when seeding","body":"<p>I upgraded my MVC project to the latest EF5 from EF4.3.1. From that point my database would always fail to initialize. If I change the reference back to EF4.3.1 everything works fine. what gives?</p>\n\n<pre><code>public class ArticleInitializer : DropCreateDatabaseAlways&lt;ArticleContext&gt;\n{\n    protected override void Seed(ArticleContext context)\n    {\n        Config.Articles.ForEach(article =&gt; context.Articles.Add(article));\n        Config.Categories.ForEach(category =&gt; context.Articles.Add(category));\n        Config.CareerAreas.ForEach(careerArea =&gt; context.Articles.Add(careerArea));\n        context.SaveChanges();\n    }\n}\n</code></pre>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework","razor","webgrid"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":12648122,"title":"Is there a clean pattern for implementing an in-place grid editor with razor and EF?","body":"<p>I'm looking to implement an in-place grid editor but the data schema doesn't fit into the expected view.\nThe model looks like two entities - one that contains the store location (first column) but the recurring data is date based across the rest of the columns. New data elements are created per day.\nI'd like to be able to click on a cell, and automatically be placed into an edit mode so it looks like the spreadsheet example. I'm wondering if this can be done in a grid, or should I create a user control that loads by date with a repeater? Any help is appreciated! \n(I can't post an image so I'll do my best here!)</p>\n\n<blockquote>\n  <p>(simulated spreadsheet!)</p>\n</blockquote>\n\n<pre><code>          Oct 1           Oct 2         Oct 3.....         \n          Screws   Nuts   Screws  Nuts\nStore1      35      35      22     25\n Shelf1     10      10       9      9\n Shelf2     16      16      11     11\n Shelf3      9       9      12     16\nStore2\n Shelf1\n Shelf2\n</code></pre>\n\n<p>The new data rows are displayed as columns with new dates</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12469158,"title":"How to set MergeOption for a Lazy load using DbContext?","body":"<p>I am using EF4.2 and DbContext and need to find a way to set MergeOption globally.</p>\n\n<p>So far have looked at the following scenarios:</p>\n\n<ol>\n<li><p>Cast to ObjectContext via the DbContext. With this method I cant seem to see any way of setting the MergeOption, various other posts using ObjectContext enable this but I believe this is a \"code gen\" ObjectContext.</p></li>\n<li><p>Setting MergeOption for each query: This works for the initial query BUT when I then access a naviagation property a \"Lazy load\" occurs and this load appears to use the default MergeOption, which is Append. </p></li>\n</ol>\n\n<p>So is there a way to set the MergeOption for a Lazy load?</p>\n\n<p>Here are some details: Using DbContext POCO EF4.2, lazy loading is true, tracking = true/proxy generation</p>\n\n<p>Any suggestions? Or do I need another approach?</p>\n"},{"tags":["c#","asp.net",".net","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":105,"score":0,"question_id":12647079,"title":"How to turn a DbSet into a dropdown list, for example?","body":"<p>I'm trying to wrap my head around all of this ViewModel stuff and do things the right way. I have several models linked to SQL tables via Entity Framework, like this one:</p>\n\n\n\n<pre class=\"lang-c# prettyprint-override\"><code>[Table(\"HardwareOptions\", Schema = \"dbo\")]\npublic class HardwareOption {\n  [Key]\n  public int RecordID {get; set;}\n  [ForeignKey(\"Configuration\")]\n  public string Configuration {get; set;}\n  public string ComputerManufacturer {get; set;}\n  public string ComputerModel {get; set;}\n  public string ComputerDescription {get; set;}\n  public int MonitorCount {get; set;}\n  public string MonitorManufacturer {get; set;}\n  public string MonitorModel {get; set;}\n  public string MonitorDescription {get; set;}\n}\n</code></pre>\n\n<p>I have a view model like this:</p>\n\n<pre class=\"lang-c# prettyprint-override\"><code>public class OrderIndexViewModel {\n  public Customer Customer {get; set;}\n  public MetaUser MetaUser {get; set;}\n  public DbSet&lt;HardwareOption&gt; HardwareOptions {get; set;}\n  public DbSet&lt;Machine&gt; Machines {get; set;}\n  public DbSet&lt;PendingOrder&gt; PendingOrders {get; set;}\n}\n</code></pre>\n\n<p>And a bit of my controller like this:</p>\n\n<pre class=\"lang-c# prettyprint-override\"><code>private MyDbContext db = new MyDbContext();\nOrderIndexViewModel viewmodel = new OrderIndexViewModel();\nviewmodel.Customer = db.Customers.Find(\"myselffortesting\");\nviewmodel.MetaUser = db.MetaUsers.Find(\"myselffortesting\");\nviewmodel.HardwareOptions = db.HardwareOptions;\nviewmodel.Machines = db.Machines;\nviewmodel.PendingOrders = db.PendingOrders;\nreturn View(viewmodel);\n</code></pre>\n\n<p>So as you can see, in my view, I only need information about one customer/user, but I need to be able to query the entire HardwareOptions, Machines, and PendingOrders tables. Now, if my architecture is entirely wrong, please tell me, because that is more what this question is about. But for something specific, say I want to make a dropdown list from HardwareOptions. Technically, I want each <code>SelectItem</code> to say a string combination of the values of several columns, but for now I'll say I just want one, like Configuration. What is the right way to do that? I don't know how to manipulate the <code>DbSet</code>. When I tried to make a <code>Html.DropDownList</code> from the <code>DbSet</code>, I got a list with the correct number of items, but they all said \"mynamespace.Models.HardwareOption.\" Which makes sense, I just can't figure out how to do it right.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":40,"score":-1,"question_id":12647479,"title":"How do I assign a return strongly typed object value to a Label text?","body":"<p>I have a stored procedure in which I imported as a function in my entity framework model.   I want to assign one of the values of the stored proc to my label.text but it doesn't appear in the intellisense.   I must be doing something wrong.   Can someone please assist?</p>\n\n<pre><code>    private void GetBackgroundData()\n    {\n        List&lt;GetBackground_Result&gt; results = context.GetBackground().ToList();\n        lblFullName.Text = results.FullName  // FullName doesn't appear in my intellisense\n    }\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4","code-first","dbcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12596562,"title":"Unacceptable response time on the first time that an instance of DbContext is used in the app for a SELECT query?","body":"<p>I'm using CodeFirst,and i have a problem with loading data with DbContext,the problem is that The first time an instance of DbContext is used in the app for a SELECT type of query, i get a very slow(unacceptable)response back on large models,but it gets better in second time,is there any way to reduce this time?</p>\n"},{"tags":["json","entity-framework","serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12645330,"title":"Unwanted Navigation property appearing in entity framework","body":"<p>I am using Entity Framework to create a Model, I am pretty new to the Entity Framework so bear with me.</p>\n\n<p>I want my database to always be the end all be all of what gets generated, so I dont wnat to make modifications to the model itself. I want to amke all modifications to the database and just hit \"Update Model From Database.\" This has been working swimmingly! \nHowever If I have a one to one relationship between two tables, and I have a foreign key constraint set in the database, I get a navigation property in the child table that goes back to the parent table. </p>\n\n<p>So if I want to access the parent from the child I can do child.parent.fieldName</p>\n\n<p>That sounds great in theory but my issue arises when I need to serialize the object for JSON created by the entity Framework. I always get an error because it tries to serialize the parent object along with the child object. which usually has an invalid state at this point so.. A) it cant be serialized and B) I wouldn't want all that extra info anyway.</p>\n\n<p>Am I misconfiguring the database in some way? is there a way to have the database specify that I only want Parent.Child Navigation properties in the model? and not Child.Parent?</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":171,"score":0,"question_id":12645451,"title":"EF 5 Code First Dictionary Mapping","body":"<p>Is there any way to map a dictionary using Entity Framework 5? </p>\n\n<p>From what I found while searching, it has not been supported until EF 4.1, not sure if EF 5 provides any innovative methods to map it easily.</p>\n\n<p>I am using the dictionary to store a \"variable number of properties\"  for each object of a class.</p>\n\n<p>If it's not supported what would be the best alternative data structure to use in this scenario (supported by EF)?</p>\n"},{"tags":["entity-framework","ef-code-first","dbcontext","entity-framework-5","savechanges"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12640650,"title":"How to detect if an Entity added to DbContext?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5407860/dbcontext-added-attached-event\">DBContext Added/Attached Event?</a>  </p>\n</blockquote>\n\n\n\n<p>I'm using a custom <strong><code>ID-Generating</code></strong> strategy in <strong>EF 5</strong>. I override the <strong><code>SaveChanges</code></strong> method to detect added entities and set them <code>ID</code>s. But the new entities's <code>ID</code> is not accessible until calling <strong><code>SaveChanges</code></strong>. I search SO and find some answers. <a href=\"http://stackoverflow.com/questions/9694696/dbcontext-changetracker-id-of-added-entity-for-auditing\">Here</a> and <a href=\"http://stackoverflow.com/questions/5407860/dbcontext-added-attached-event\">here</a>. In the second link, <a href=\"http://stackoverflow.com/a/7409014/974276\"><code>@KVerwold</code>'s answer</a> shows a way to detect changes that seems works. But it has just one up-vote and not accepted. Can I use @KVerwold's suggested way? Do you think it may couse any error -logical or any? <strong>OR</strong> do you have any other suggestions please? Thanks in advance.</p>\n"},{"tags":["entity-framework","poco"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12638439,"title":"Sharing entity types across multiple edmx files","body":"<p>We are using Entity Framework 4 with the POCO Entity Generator. Until now we've just had one .edmx file but we're running into performance problems due to the current size of it (well over 100 entities). </p>\n\n<p>I understand we should be looking to break this into a series of .edmx files which is fine with one exception. We would want to somehow share certain entity types across two or more of these contexts. For example a User class is associated with numerous otherwise unrelated entities throughout our model.</p>\n\n<p>So is it possible to have, say, a security model with its own .edmx and namespace for generated POCOs, but use it in another .emdx? If not I'm concerned we'll have multiple classes modelling the same database table which will need to be updated in sync with the database. I'd say that would be unworkable. (We're using database-first).</p>\n\n<p>Obviously if I'm barking up the wrong tree do let me know! </p>\n"},{"tags":["entity-framework","asp.net-mvc-3","entity-framework-4","code-first","entity-framework-4.1"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1067,"score":3,"question_id":5782507,"title":"Creating entity diagrams from code first classes","body":"<p>i was just reading Asp.net MVC3 tutorials (Models (Data))</p>\n\n<p>on this page <a href=\"http://www.asp.net/entity-framework/tutorials/creating-a-more-complex-data-model-for-an-asp-net-mvc-application\" rel=\"nofollow\">tutorial 4 of 10 </a> on asp.net website, they have shown, entity diagram created from code first classes, how to generate them.</p>\n"},{"tags":["entity-framework","emitmapper"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12642527,"title":"EmitMapper + EF. Collection mapping issue","body":"<p>The source class:</p>\n\n<pre><code>public class Page  : EntityBase \n{\n    public Page()\n    {\n        this.Articles = new List&lt;Article&gt;();\n    }\n\n    public virtual ICollection&lt;Article&gt; Articles { get; set; }\n}\n\npublic class Article : EntityBase \n{\n    public Article()\n    {\n        this.Pages = new List&lt;Page&gt;();\n    }\n\n    public virtual ICollection&lt;Page&gt; Pages { get; set; }\n}\n</code></pre>\n\n<p>the destination class</p>\n\n<pre><code>public class EditPageModel : ModelBase \n{\n    public string Title { get; set; }\n    public List&lt;Article&gt; Articles { get; set; }\n\n    public override ModelBase Initialize(EntityBase entity)\n    {\n        return ObjectMapperManager.DefaultInstance.GetMapper&lt;Page, EditPageModel&gt;().Map((Page)entity);\n    }\n}\n</code></pre>\n\n<p>When I use</p>\n\n<pre><code>var model = (EditPageModel)new EditPageModel().Initialize(entity);\n</code></pre>\n\n<p>I got an error</p>\n\n<blockquote>\n  <p>Unable to cast object of type\n  'System.Data.Entity.DynamicProxies.Article_2F97D0440149ED4566ED7675640D475A23EB97002CFD5941610DD0C9BCE74E55'\n  to type\n  'System.Collections.Generic.ICollection`1[SomeProject.Dal.Models.Articles.Article]'.</p>\n</blockquote>\n\n<p>With AutoMapper it works fine.</p>\n"},{"tags":["sql-server","asp.net-mvc-3","entity-framework","mvc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12642251,"title":"Nicer way to add entry into main db table and link table","body":"<p>Hi all the below solution works in that it creates a record in the MeetingRoomRequest table and also adds the associated amenities to that request into the MeetingRoomRequestAmenityLink table. However it just feels a bit clunky, so I was wondering if there is a nicer solution out there (i.e. not having to create 2 context instances) using MVC 3 and Entity Framework??</p>\n\n<p>Please note i've set up the necessary relationships (one to many) in SQL Server and Entity Framework.</p>\n\n<p>Also please note AmenityList is an array of id's (e.g. [1,2,4])</p>\n\n<pre><code>private readonly IDataRepository&lt;MeetingRoomRequest&gt; _meetingRoomRequestRepository = new DataRepository&lt;MeetingRoomRequest&gt;();\nprivate readonly IDataRepository&lt;MeetingRoomRequestAmenityLink&gt; _meetingRoomRequestAmenityLinkRepository = new DataRepository&lt;MeetingRoomRequestAmenityLink&gt;();\n\nvar meetingRoomRequestToAdd = new MeetingRoomRequest\n{\n    User = meetingRoomRequestViewModel.User,\n    UserEmail = meetingRoomRequestViewModel.UserEmail,\n    Title = meetingRoomRequestViewModel.Title,\n    Comments = meetingRoomRequestViewModel.Comments,\n    StartDateTime = meetingRoomRequestViewModel.StartTime,\n    EndDateTime = meetingRoomRequestViewModel.EndTime,\n    RequestStatusID = (int)Enums.RequestStatus.New,\n    AttendeeCount = meetingRoomRequestViewModel.AttendeeCount,\n    AttendeeType = meetingRoomRequestViewModel.AttendeeType,\n    OfficeID = meetingRoomRequestViewModel.OfficeId,\n    LocationID = meetingRoomRequestViewModel.LocationId, \n};\n_meetingRoomRequestRepository.Add(meetingRoomRequestToAdd);\n_meetingRoomRequestRepository.SaveChanges();\nvar meetingRoomRequestAdded = meetingRoomRequestToAdd;\n\nforeach (var item in meetingRoomRequestViewModel.AmenityList)\n{\n    var meetingRoomRequestAmenityLinkToAdd = new MeetingRoomRequestAmenityLink\n    {\n        AmenityID = item,\n        MeetingRoomRequestID = meetingRoomRequestAdded.MeetingRoomRequestID\n    };\n    _meetingRoomRequestAmenityLinkRepository.Add(meetingRoomRequestAmenityLinkToAdd);\n    _meetingRoomRequestAmenityLinkRepository.SaveChanges();\n}\n</code></pre>\n"},{"tags":["entity-framework","data","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12642866,"title":"SSIS w/ Entity Framework","body":"<p>I'm taking a denormalized Access DB and moving it to a normalized table in SQL based on EF 4.</p>\n\n<p>Let's say I have the following in the Access DB</p>\n\n<pre><code>-------------------\n|  NAME  | FRUIT  |\n-------------------\n| John   | Apple  |\n| Jane   | Apple  |\n| Mark   | Orange |\n| Nancy  | Orange |\n| Jim    | Apple  |\n-------------------\n</code></pre>\n\n<p>I'm creating the following two databases in SQL</p>\n\n<p>tblNames:</p>\n\n<pre><code>-------------------------------\n|   ID   |  Name  |  FruitID  |\n-------------------------------\n|    1   |  John  |     1     |\n|    2   |  Jane  |     1     |\n|    3   |  Mark  |     2     |\n|    4   |  Nancy |     2     |\n|    5   |  Jim   |     1     |\n-------------------------------\n</code></pre>\n\n<p>tblFruits:</p>\n\n<pre><code>--------------------\n|   ID   |  Fruit  |\n--------------------\n|    1   |  Apple  |\n|    2   |  Orange |\n--------------------\n</code></pre>\n\n<p>In my dataflow, I can pull the names using Derived Column (the table is actually larger and I'm doing some data type transformations).  However, how do I take the output from the Derived Column and for each row match it to the proper ID of the fruits table producing the correct output that needs to be inserted into the tblNames database?</p>\n\n<p>Thanks.</p>\n"},{"tags":["entity-framework","intersystems-cache"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12629920,"title":"Does Entity Framework have a provider for Intersystems Cache?","body":"<p>If so, any drawbacks?  Any experience using it?</p>\n"},{"tags":["c#","entity-framework","error-handling","batch-processing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12641591,"title":"Removing a batch of records from Entity Framework when there is an error","body":"<p>I am batch adding a bunch of records from an internal system to our web database server (eBilling type data). I have a problem where if there is a data error (seperate issue), every add after that errors out. </p>\n\n<pre><code>        foreach (InvoiceHeader invoiceHeader in invoiceHeaders)\n        {\n            rrn++;\n            db.AddToInvoiceHeaders(invoiceHeader);\n            if (rrn &gt;= RECORDS_AT_A_TIME)\n            {\n                try\n                {\n                    db.SaveChanges();\n                    rrn = 0;\n                }\n                catch (Exception e)\n                {\n                    string errorText = \"Error in blah blah blah \\n\\n\";\n                    errorText += \"Error: \" + e.ToString();\n                    Log.Error(errorText);\n                    // Delete out bad record or entire set of records here.\n                }\n            }\n        }\n</code></pre>\n\n<p>So the first 500 may go good, then I might get an invalid date. Nothing else gets added to the server and the logs get slammed with errors and crashes.</p>\n\n<p><strong>How can I either clear out the one record in error OR just clear out that batch of records? So it can finish properly and we can go back and fix the errors thus adding back the missing data.</strong></p>\n\n<p>Update: I want to be able to just log the error, remove the problem record(s) and move on. In this case it happens to be a date issue, I am not looking for solving this <strong>one</strong> instance, but all future unknown issues. How do I do the <code>// Delete out bad record or entire set of records here.</code>?</p>\n"},{"tags":["c#",".net","wpf","entity-framework","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12642150,"title":"LINQ to Entities does not recognize the method and this method cannot be translated into a store expression","body":"<pre><code>var ps = dbContext.SplLedgers.Select(p =&gt; new SplLedgerModel\n            {\n                Name = p.Name,\n                VoucherType = Convert.ToString(((JIMS.VoucherTypes)p.VoucherType))\n        });\n</code></pre>\n\n<p>I am getting the following exception, whats wrong with the code.</p>\n\n<p>JIMS.VoucherType is an enum</p>\n\n<pre><code>+       $exception  {\"LINQ to Entities does not recognize the method 'System.String ToString(System.Object)' method, and this method cannot be translated into a store expression.\"}    System.Exception {System.NotSupportedException}\n</code></pre>\n"},{"tags":["entity-framework","code-first","code-first-migrations"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":114,"score":1,"question_id":12624917,"title":"Code First Migrations for a custom NuGet package can't be executed from main application","body":"<p>I have created a module to be included in a main MVC3 web application. The module is packaged into a NuGet package and it can be installed and uninstalled via NuGet. Both, the main site and the module use Code First, EF >= 4.3</p>\n\n<p>To create the package I have another MVC3 site and all the functionality is inside an area, so to create the package I just pack the libraries, the views and all the needed files. Database Migrations work fine in the project and the package is created nicely.</p>\n\n<p>Now I install the package in the main site via NuGet. This site is in another solution, and the solution has two projects:</p>\n\n<ul>\n<li>MyProject.Web.UI: this is an Mvc3 project</li>\n<li>MyProject.EntityFramework: this is a class library with all the models, dbContext for MyProject...</li>\n</ul>\n\n<p>The package is installed correctly and the Area, the Area views and libraries are correctly installed.</p>\n\n<p>The problem now is how I update the database? I've tried first to run \"Update-Database\" but I get the message:</p>\n\n<blockquote>\n  <p>\"No migrations configuration type was found in the assembly\n  'MyProject.Web.UI'. (In Visual Studio you can use the\n  Enable-Migrations command from Package Manager Console to add a\n  migrations configuration).\"</p>\n</blockquote>\n\n<p>I've tried then to enable the migrations with \"Enable-Migrations\" but I got this other message:</p>\n\n<blockquote>\n  <p>\"No context type was found in the assembly 'MyProject.Web.UI'.\"</p>\n</blockquote>\n\n<p>I tried also just to run the site and see if the changes are automatically applied but I get the exception page with the typical message:</p>\n\n<blockquote>\n  <p>\"The model backing the 'NugetPackageDbContext' context has changed\n  since the database was created. Consider using Code First Migrations\n  to update the database\"</p>\n</blockquote>\n\n<p>I don't know what to do to update the database with the required changes in migrations that come in the NuGet package. Any one could put some light here in this matter? I'm quite new to Migrations, maybe there are some configs to update the database if there is a change instead of running the commands in the console, I'm a bit lost.</p>\n\n<p>Thanks in advance :)</p>\n"},{"tags":["c#","sql-server","database","visual-studio","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":117,"score":2,"question_id":12639124,"title":"How to set datetime field value to now","body":"<p>I have models with datetime fields.</p>\n\n<p>My code is working with models setting this reseting this fields to now.\nBut I don't want \"setting\" now, but \"saving\" now: i.e. if I set <code>field1 = now [0:00:00]</code>, then, 10s. later <code>field2 = now [0:00:10]</code> and then, 10s. later, I execute <code>SaveChanges()</code> I'd like to have both field set to 0:00:20 (saving time).</p>\n\n<p>Edit: code example:</p>\n\n<pre><code>var context = new SomeEntities();\nSomeModel model = context.GetSomeModel(...);\n// SomeModel has two DateTime fields: dt1 and dt2\nmodel.dt1 = SavingDateTimeNow(); // .... 13:42:00\n// some code, i.e. Sleep(TimeSpan.FromSeconds(10));\nmodel.dt2 = SavingDateTimeNow(); // .... 13:42:10\n// again 10s. code\ncontext.SaveChanges(); // .... 13:42:20\n</code></pre>\n\n<p>Edit2: More complex example:</p>\n\n<pre><code>var context = new SomeEntities();\nSomeModel model = context.GetSomeModel(...);\n// SomeModel has two DateTime fields: dt1 and dt2\nif(someComplexCondition)model.dt1 = SavingDateTimeNow(); // .... 13:42:00\n// some code from which I would know if someOtherComplexCondition is true\nif(someOtherComplexCondition)model.dt2 = SavingDateTimeNow(); // .... 13:42:10\n// again 10s. code\n// much more code here\ncontext.SaveChanges(); // .... 13:42:20\n</code></pre>\n\n<p>I want both (dt1 and dt2) to be set to ... 13:42:20, not 13:42:00 and 13:42:10</p>\n\n<p>Edit3: Simplest example: I would like it to work just like django's fields with <code>auto_now=True</code>.</p>\n"},{"tags":["entity-framework","entity"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":10734131,"title":"Entity Framework - Removing virtual keyword from navigation properties","body":"<p>I am using entity framework with database first approach, along with EF 4.x DBContext Generator. All my entity classes have navigation properties which are marked as \"virtual\". I want to remove virtual keyword from all my entity classes. There are around 350 entity classes</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":57,"score":-2,"question_id":12545947,"title":"Delete database. Entity Framework","body":"<p>I followed the following MDSN tutorial:</p>\n\n<blockquote>\n  <p><a href=\"http://www.asp.net/mvc/tutorials/mvc-4/getting-started-with-aspnet-mvc4/adding-a-model\" rel=\"nofollow\">http://www.asp.net/mvc/tutorials/mvc-4/getting-started-with-aspnet-mvc4/adding-a-model</a></p>\n</blockquote>\n\n<p>Then I tried this guide according to my needs and I set up a database <code>GAMES.MDF</code>.</p>\n\n<p>Then, I deleted the database and set it up again, is supposedly work (I can write and read data), but there is no such database in the <code>APP_DATA</code> folder. It seems to exist, but somewhere else on my PC.\n\nI even tried a new project and it did not work, works but not in the library, and it even uses the data I created before. I even deleted the DB from SQL Server Management Studio 2008.</p>\n\n<p>How do I delete it permanently, not to remain any trace of it?</p>\n"},{"tags":["asp.net","entity-framework","methods","save"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":38,"score":0,"question_id":12636694,"title":"Saving changes of Entity Framework in Asp.Net","body":"<p>I have created an entity Appraiser and there are methods to select values, display data etc.\nNow I want to save the changes made after data is displayed, I have a button named SAVE, which will be used to save changes.\nI am not able to get how to save the changes of this Entity?</p>\n\n<p>Entity name is Appraiser, and I have created methods like get AppriaserDetails etc in DAL, BL and used them in aspx.cs.</p>\n\n<p>This is my code:</p>\n\n<pre><code> public void UpdateData(Appraiser appId)\n    {\n\n        var Appsave = context.Appraisers.FirstOrDefault(App =&gt; App.AppraiserId == appId.AppraiserId);\n        Appsave.AppraiserName = appId.AppraiserName;\n        Appsave.AppraiserPhones = appId.AppraiserPhones;\n        Appsave.AppraiserAppraiserCompanyId = appId.AppraiserAppraiserCompanyId;\n        Appsave.Address = appId.Address;\n        Appsave.City = appId.City;\n        Appsave.ProvinceState = appId.ProvinceState;\n        Appsave.Email = appId.Email;\n        context.SaveChanges();\n    }\n</code></pre>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12637602,"title":"Entity Framework adding record with a related object ","body":"<p>We have the following AddUser method which adds a new record to the database using EF:</p>\n\n<pre><code>    public User AddUser(User user)\n    {\n        using (var context = DataObjectFactory.CreateContext())\n        {\n            var userEntity = Mapper.Map(user);\n\n            context.AddObject(\"UserEntities\", userEntity);\n\n            context.SaveChanges();\n\n            return Mapper.Map(userEntity);\n        }\n    }\n</code></pre>\n\n<p>Our User type is like this:</p>\n\n<pre><code>public class User\n{\n    public string FirstName { get; set; }\n\n    public string LastName { get; set; }\n\n    public Customer Customer { get; set; }     \n}\n</code></pre>\n\n<p>We have a Customer table and a User table and in User table we have customerid as a foreign key. </p>\n\n<p>In the USER table we have Firstname, Lastname and CustomerId fields, we get the firstname, lastname and customerid (dropdown list of customers) details from the user, create the Customer object with customerid we get from the user and pass all of these to the <code>AddUser</code> method, but what happens is that the User gets inserted into the database and also a new Customer is inserted into the Customer's table (with a new customerid), is there any way of stopping this?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","linq","entity-framework","iqueryable"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":102,"score":2,"question_id":12411728,"title":"How to specify a custom method in a LINQ query (C# Entity Framework)","body":"<p>I have defined a super class \"Validity\" which defines a time span (ValidFrom / ValidTo) in which an object is \"valid\". It also defines a function that returns true for a given timestamp, iff (=if and only if) a (derived) object is valid at this time.</p>\n\n<pre><code>public class Validity\n{\n    public int ValidityID { get; set; }\n\n    public DateTime? ValidFrom { get; set; }\n    public DateTime? ValidTo { get; set; }\n\n    bool isValidAt(DateTime time)\n    {\n        return (ValidFrom == null || ValidFrom &gt;= time)\n            &amp;&amp; (ValidTo == null || ValidTo &lt; time);\n    }\n}\n</code></pre>\n\n<p>Now I would like to write some function that checks isValidAt within a LINQ query. I guess this is possible via IQueriable, but I didn't find out how...\nThe following code snipped is what I want to have \"working\" in some way (especially the <code>where n.isValidAt(t)</code>). So, how can this be achieved?</p>\n\n<pre><code>public class Node : Validity {\n    public int NodeID { get; set; }\n\n    public static getFirstNode(DateTime t)\n    {\n        MyContext db = new MyContext();\n        var items = from n in db.Nodes\n                     where n.isValidAt(t)\n                     orderby n.NodeID descending\n                     select n;\n        return items.FirstOrDefault&lt;Node&gt;();\n    }\n}\n</code></pre>\n\n<p>--- WORKING SOLUTION  ---</p>\n\n<p>I needed to adapt the solution of Zaid Masud a bit, to get it working. Note that I had to remove the <code>this</code> in the parameter list (now the method definition is <code>public static IQueryable&lt;T&gt; isValidAt&lt;T&gt;(IQueryable&lt;T&gt; query, DateTime time) where T : Validity</code>). Here is the source code:</p>\n\n<pre><code>public class Validity\n{\n    public int ValidityID { get; set; }\n\n    public DateTime? ValidFrom { get; set; }\n    public DateTime? ValidTo { get; set; }\n\n    public static IQueryable&lt;T&gt; isValidAt&lt;T&gt;(IQueryable&lt;T&gt; query, DateTime time) where T : Validity\n    {\n        return query.Where&lt;T&gt;(c =&gt; (c.ValidFrom == null || c.ValidFrom &gt;= time)\n            &amp;&amp; (c.ValidTo == null || c.ValidTo &lt; time));\n    }\n}\n</code></pre>\n"},{"tags":["entity-framework","asp.net-web-api"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12637343,"title":"Web API without DTO: POCOs have strange value for navigation properties","body":"<p>I'm developing a Web API application; I'm using EF 5.0 and POCO Classes autogenerated with the  VS2012 template. Lazy loading and proxy generation are disabled.</p>\n\n<p>When my objects are serialized I find that navigation properties are included in the JSON output, and valued with 'null'.</p>\n\n<p>When my object are deserialized (ie: for a \"save\" action) these navigation properties are not valued with 'null', but with an empty istance of the object.</p>\n\n<p>Here is an example of the serialization:</p>\n\n<pre><code> [{\"EmployeeTimeblockId\":1,\"EmployeeId\":1,\"DayOfWeek\":0, \"StartDate\":\"2012-05-    27T00:00:00\", \"EndDate\":\"2012-09- 02T00:00:00\", \"StartTime\":\"16:00:00\",\"EndTime\":\"18:00:00\",\"Notes\":\"null\",\"Employee\":null}]\n</code></pre>\n\n<p>When I send back this object, with the \"Employee\" field still null, the deserializer changes its value with a  new Employee()  istance. This is a problem because Entity Framework obviously tries to attach this object and I don't want this behaviour.</p>\n\n<p>My workaround is to do manually set my object navigation properties to null, as in:</p>\n\n<pre><code>        var uow = new Infrastructure.Database.UnitOfWork();\n        var rep = uow.EmployeeTimeblockRepository;\n        e.Employee = null;\n        rep.Update(e);\n        uow.Save();\n</code></pre>\n\n<p>But this is not an elegant solution. Any suggestion on how I can get clean deserialized object, without using DTOs?</p>\n\n<p>Thanks,\nNicola             </p>\n"},{"tags":["c#","sql-server-2008","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":59,"score":3,"question_id":12626331,"title":"Any way to speed up CreateIfNotExists in Entity Framework?","body":"<p>I'm using EF 4.3 Code First on SQL Server 2008. I run several test suites that delete and recreate the database with CreateIfNotExists. This works fine but is dog slow. It can take up to 15 seconds to create the database on the first call, and typically 3-6 seconds after that. I have several places where this is called. I've already optimized to call this as few times as I can. Is there something I can do to speed up database creation programmatically? I'm willing to go around EF to do this if that helps, but I would like to keep my database build in code and not go back to a SQL script. Thanks!</p>\n"},{"tags":["entity-framework","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12636420,"title":"MVC4 Visual Studio model changes not reflecting throughout Controllers/Views","body":"<p>I have a web project in MVC4. I have created the models, scaffolded the controllers and views and it runs fine.  I then go into the models, add some additional fields, run Add-Migration [migration name] and then Update-Database. The database is updated with the new fields/relationships but they're not accessible via the model in the Controllers or Views.  I.e. So I key model.[fieldName] and the ORIGINAL fields are all accessible, but not the NEW fields. Any ideas why? ... please.</p>\n"},{"tags":["c#","entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12635775,"title":"Some properties/enums are ignored when using code first migration","body":"<p>I'd like to add some properties to a entity to a model, but that property doesn't make any changes in the database nor in a migration script.</p>\n\n<p>When I add this:</p>\n\n<pre><code>    public test test1 { get; set; }\n\n    public enum test { asasas, asdasdasd };\n</code></pre>\n\n<p>I get an empty migration</p>\n\n<pre><code>    public override void Up()\n    {\n    }\n\n    public override void Down()\n    {\n    }\n</code></pre>\n\n<p>But when i add:</p>\n\n<pre><code>    public String test1 { get; set; }\n\n    public enum test { asasas, asdasdasd };\n</code></pre>\n\n<p>I get the expected migration</p>\n\n<pre><code>    public override void Up()\n    {\n        AddColumn(\"dbo.SpiderBatches\", \"test1\", c =&gt; c.String());\n    }\n\n    public override void Down()\n    {\n        DropColumn(\"dbo.SpiderBatches\", \"test1\");\n    }\n</code></pre>\n\n<p>Because the second change does make a correct migration I can assume that the class/context are correctly setup and are working. So the error must be in the enum.</p>\n\n<p>Can anyone help me further?</p>\n"},{"tags":["linq","entity-framework",".net-4.0","dynamic-linq"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12626771,"title":"Dyamic Linq .Net 4 error 'userid' could not be resolved in the current scope or contex","body":"<p>I am trying to use Dynamic Linq library in my code, but it gives this error</p>\n\n<blockquote>\n  <p>'UserId' could not be resolved in the current scope or context. Make sure that all referenced variables are in scope, that required schemas are loaded, and that namespaces are referenced correctly. Near simple identifier, line 6, column 1</p>\n</blockquote>\n\n<p>and here is my code</p>\n\n<pre><code> TestDB db = new TestDB();\n        string filter = \"UserId == 15\";\n        //var searchResult =\n        GridView1.DataSource = from x in db.SearchSummaries.Where(filter)\n                               select x;\n        GridView1.DataBind();\n</code></pre>\n"},{"tags":["entity-framework","duplicate-data"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1315,"score":1,"question_id":3977920,"title":"Entity Framework. View return duplicate records","body":"<p>I use Entity Framework that contain view. And I have query:</p>\n\n<pre><code>var data = this.context.vwRevenues\n    .Where(x =&gt; x.revenue &gt;= 0);\n    .OrderByDescending(x =&gt; x.year)\n    .ThenByDescending(x =&gt; x.month)\n    .Take(10)\n    .ToList();\n</code></pre>\n\n<p>This query return set of entities, but 1st entity equals 5th. </p>\n\n<pre><code>data[0] == data[4] // true\n</code></pre>\n\n<p>I take sql script for this query from sql tracer and run it into SQL Management Studio,\nit return different records.</p>\n"},{"tags":["c#",".net","asp.net-mvc-3","entity-framework","exception-handling"],"answer_count":6,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":14875,"score":6,"question_id":5360372,"title":"The ObjectContext instance has been disposed and can no longer be used for operations that require a connection","body":"<p>I have this view:</p>\n\n<pre><code>@model MatchGaming.Models.ProfileQuery\n@{\n    ViewBag.Title = \"Index\";\n}\n\n&lt;h2&gt;Index&lt;/h2&gt;    \n&lt;script src=\"@Url.Content(\"~/Scripts/jquery.validate.min.js\")\" type=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;script src=\"@Url.Content(\"~/Scripts/jquery.validate.unobtrusive.min.js\")\" type=\"text/javascript\"&gt;&lt;/script&gt;\n\n@using (Html.BeginForm(\"Results\", \"Profiles\")) {\n    @Html.ValidationSummary(true)\n    &lt;fieldset&gt;\n        &lt;legend&gt;ProfileQuery&lt;/legend&gt;\n        @Html.EditorFor(model=&gt;model.SearchString)\n        &lt;p&gt;\n            &lt;input type=\"submit\" value=\"Create\" /&gt;\n        &lt;/p&gt;\n    &lt;/fieldset&gt;\n}\n\n&lt;div&gt;\n    @Html.ActionLink(\"Back to List\", \"Index\")\n&lt;/div&gt;\n</code></pre>\n\n<p>I have this controller for the HttpPost:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Results(ProfileQuery profileQuery)\n{\n    Debug.Write(profileQuery.SearchString);\n    using(var db = new MatchGamingEntities())\n    {\n        var SearchUserName = db.Users.SingleOrDefault(a=&gt; a.UserName.Contains(profileQuery.SearchString));\n        var Users = from m in db.Users\n                    join m2 in db.MyProfiles on m.UserId equals m2.UserId\n                    where m.UserName == SearchUserName.UserName\n                    select new UserViewModel\n                    {\n                        UserName = m.UserName,\n                        LastActivityDate = m.LastActivityDate,\n                        Address = m2.Address,\n                        City = m2.City,\n                        State = m2.State,\n                        Zip = m2.Zip\n                    };\n\n        return View(Users.AsEnumerable());\n    }\n}\n</code></pre>\n\n<p>Here is the View for Results:  </p>\n\n<pre><code>@model IEnumerable&lt;MatchGaming.Models.UserViewModel&gt;    \n@{\n    ViewBag.Title = \"Results\";\n}\n\n&lt;h2&gt;Results&lt;/h2&gt;\n\n&lt;fieldset&gt;\n    &lt;legend&gt;UserViewModel&lt;/legend&gt;\n    @foreach (var item in Model){\n    &lt;div class=\"display-label\"&gt;UserName&lt;/div&gt;\n    &lt;div class=\"display-field\"&gt;@item.UserName&lt;/div&gt;\n\n    &lt;div class=\"display-label\"&gt;LastActivityDate&lt;/div&gt;\n    &lt;div class=\"display-field\"&gt;@String.Format(\"{0:g}\", item.LastActivityDate)&lt;/div&gt;\n\n    &lt;div class=\"display-label\"&gt;Address&lt;/div&gt;\n    &lt;div class=\"display-field\"&gt;@item.Address&lt;/div&gt;\n\n    &lt;div class=\"display-label\"&gt;City&lt;/div&gt;\n    &lt;div class=\"display-field\"&gt;@item.City&lt;/div&gt;\n\n    &lt;div class=\"display-label\"&gt;State&lt;/div&gt;\n    &lt;div class=\"display-field\"&gt;@item.State&lt;/div&gt;\n\n    &lt;div class=\"display-label\"&gt;Zip&lt;/div&gt;\n    &lt;div class=\"display-field\"&gt;@item.Zip&lt;/div&gt;\n    }\n&lt;/fieldset&gt;\n</code></pre>\n\n<p>I keep getting this error:</p>\n\n<blockquote>\n  <p>The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.</p>\n</blockquote>\n\n<p>I can't figure out why.</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities"],"answer_count":4,"favorite_count":4,"up_vote_count":13,"down_vote_count":0,"view_count":21246,"score":13,"question_id":315946,"title":"How do I get the max ID with Linq to Entity?","body":"<p>I have a table User which has an identity column UserID, now what is the correct Linq to Entity line of code that would return me the max UserID?</p>\n\n<p>I've tried</p>\n\n<pre><code>        using (MyDBEntities db = new MyDBEntities())\n        {\n            var User = db.Users.Last();\n            // or\n            var User = db.Users.Max();\n\n            return user.UserID;\n        }\n</code></pre>\n\n<p>but Last and Max don't seem to be supported.</p>\n\n<p>Any ideas?</p>\n\n<p>Thank you,</p>\n\n<p>Ray.</p>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12616276,"title":"Better way to update a record using Entity Framework","body":"<p>I am looking for a more better way to update a record using Entity Framework.</p>\n\n<p>Below is what I am using now, where playerFromModel is data fetched from View.</p>\n\n<pre><code>public bool UpdatePlayer(PlayerEntity playerFromModel)\n{\n    bool updateSuccessfull = false;\n\n    using (var context = new PlayerEntities())\n    {\n        var player = context.Player.Where(m =&gt; m.emailAddress == playerFromModel.EmailAddress).FirstOrDefault();\n\n        if (player != null)\n        {\n            player.emailAddress = playerFromModel.EmailAddress;\n            player.first_name = playerFromModel.FirstName;\n            player.last_name = playerFromModel.LastName;\n            player.alt_email_id1 = playerFromModel.AlternateEmailAddress;\n            player.street = playerFromModel.Street;\n            player.city = playerFromModel.City;\n            player.state = playerFromModel.State;\n            player.zip = playerFromModel.Zip;\n            player.country_code = playerFromModel.CountryCode;\n            player.phone1 = playerFromModel.Phone;\n\n            try\n            {\n                context.SaveChanges();\n                updateSuccessfull = true;\n            }\n            catch\n            {\n                updateSuccessfull = false;\n            }\n        }\n    }\n\n    return updateSuccessfull;\n}\n</code></pre>\n\n<p>As you can see I have to manually map each of the fields and the same approach I have followed everywhere.</p>\n\n<p>I was thinking that there definitely has to be a better way to do this.</p>\n\n<p>Please guide me on this. Thanks.</p>\n"},{"tags":["asp.net","entity-framework","gridview"],"answer_count":8,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":3694,"score":4,"question_id":6075754,"title":"How can you show the date in a gridview as a date only instead of a datetime?","body":"<p>I am pulling in date values from a sql server database using a gridview and and the date gets converted from</p>\n\n<blockquote>\n  <p>12/12/2009 <strong>to</strong> 12/12/2009 12:00:00 AM</p>\n</blockquote>\n\n<p>How do I prevent that from happening ? </p>\n\n<p>Thanks !</p>\n"},{"tags":["c#","entity-framework","poco"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12619633,"title":"modify entity in memory without errors when saving poco EF 4.2","body":"<p>I need to temporarily modify a collection on an entity in memory without the framework exploding with an error. I have two entities I'm working with. Entity A has a collection that I simply need to remove an item from and add another item I created on the fly to it. Entity B uses that item from entity A to do calculations off of but doesn't hold a reference to it in any of its properties. The problem is when I go to save entity B it explodes because of my in memory changes of entity A. In no way am I trying to save entity A, the framework is just figuring out I made a change to it and throwing this error:</p>\n\n<blockquote>\n  <p>The relationship could not be changed because one or more of the foreign-key properties is non-nullable</p>\n</blockquote>\n\n<p>I'm using poco classes and saving each entity individually so I'm confused why when I save entity B the framework is also trying to save entity A. The pocos are all wired up using the EntityTypeConfiguration class if that makes a diff.</p>\n\n<p>Is there a way to tell an individual entity to not track itself for a period of time?</p>\n"},{"tags":["entity-framework","repository-pattern","unit-of-work"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12622166,"title":"Entity Framework with Repository /Unit Of work : navigation property throws exception after context is disposed","body":"<p>I am using EF with Repository Pattern and unit of Work. I am pulling an object Person with inner object Employment.\nThe following is how the classes are constructed:</p>\n\n<pre><code>    class Person\n    {\n       Employment employments;\n    }\n\n   class Employment\n   {\n          int ID {get;set;}\n          string Employer {get;set;}\n   }\n</code></pre>\n\n<p>Lazy Loading is enabled.\nThe following is how i'm getting the Person Object:</p>\n\n<pre><code>     Person p;\n     using (unitOfWork = new UnitOfWork())\n     {\n        p=unitOfWork.PersonRep.Single(s =&gt; s.Id== Id);\n     }\n   return p;\n</code></pre>\n\n<p>Outside this code p.employments is not accessible. What's the best practice for this architecture? And why is the navigation property not persisting?</p>\n"},{"tags":["c#","entity-framework","dependency-injection","domain-driven-design","ninject"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":140,"score":0,"question_id":12555241,"title":"Dependency injection in BAL without adding a project reference to DAL","body":"<p>This is related to question posted <a href=\"http://stackoverflow.com/questions/12538693/how-to-avoid-having-bal-dependent-on-dal-due-to-di-container-binding-requirement\">here</a>. My Core project has following .</p>\n\n<pre><code>public interface IRepository&lt;T&gt; : IDisposable  \n{  \n    IQueryable&lt;T&gt; All { get; }  \n    IQueryable&lt;T&gt; AllIncluding(params Expression&lt;Func&lt;T, object&gt;&gt;[] includeProperties);  \n    TEntity Find(int id);  \n    void InsertOrUpdate(T entity);  \n    void Delete(int id);  \n    void Save();  \n}  \n\npublic class Customer  \n{  \n    public int Id { get; set; }  \n    public string FirstName { get; set; }  \n    public string LastName { get; set; }   \n} \n</code></pre>\n\n<p>DAL has CustomerContext and CustomerRepository. This project depends upon Entity Framework. </p>\n\n<pre><code>public class CustomerContext : DbContext\n{\n    public DbSet&lt;Customer&gt; Customers { get; set; }\n}\n\npublic class CustomerRepository : IRepository&lt;Customer&gt;\n{\n\n}\n</code></pre>\n\n<p>Next comes my BAL. This is a class library project. I need to perform some actions on customer repository but I want to do it without adding dependency on DAL directly. I am trying to do via DI using ninject.  I am setting up binding between IRepository and CustomerRepository as follows. </p>\n\n<pre><code>var Kernel = new StandardKernel();  \nKernel.Bind&lt;IRepository&gt;().To&lt;CustomerRepository&gt;();  \n</code></pre>\n\n<ol>\n<li><p>Let' say I have a UI application that will call some API from BAL. Where exactly above code for binding IRepository to CustomerRepository should be placed? Is there any way of doing this binding via App.config?</p></li>\n<li><p>As you can see if I put this somewhere in BAL, then I will have to add a reference to DAL project because I am using CustomerRepository which is defined in DAL layer.</p></li>\n</ol>\n"},{"tags":["asp.net","entity-framework","gridview-sorting"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12613854,"title":"How Do I Sort My GridView When Using Entity Framework","body":"<p>I call my stored procedure using EF but I can't seem to figure out how to get the sorting to work when clicking a column header in my gridview.   How would I go about doing so?   I do have the AllowSorting = \"True\" set in the GridView along with the SortExpressions and OnSorting property.  Here is my code:</p>\n\n<pre><code>    protected void Page_Load(object sender, EventArgs e)\n    {\n        if (!IsPostBack)\n        {\n            PopulateDropDownLists();\n            BindData();\n        }\n        else\n        {\n            BindFilteredData();\n        }\n    }\n\n    private void BindData()\n    {\n        var query = context.GetReport(0, 0);\n        gvReport.DataSource = query;\n        gvReport.DataBind();\n    }\n\n    private void BindFilteredData()\n    {\n        int clientId = Convert.ToInt32(Request.Form[\"ddClientType\"]);\n        int programId = Convert.ToInt32(Request.Form[\"ddProgram\"]);\n\n        var query = context.GetReport(clientId, programId);\n        gvReport.DataSource = query;\n        gvReport.DataBind();\n    }\n</code></pre>\n\n<p>Need to implement sorting...    Any help is much appreciated!</p>\n\n<p>I implemented something similar to AVD's solution but need to include a descending sort.  It seems there has to be a more elegant solution to performing a ton of if statements to determine asc vs. desc?             </p>\n\n<p>string sort = e.SortExpression + \" \" +  GetSortDirection(e.SortExpression);</p>\n\n<pre><code>        switch (e.SortExpression)\n        {\n            case \"ClientName\":\n                gvReport.DataSource = results.OrderBy(p =&gt; p.ClientName);\n                break;\n            case \"FullName\":\n                gvReport.DataSource = results.OrderBy(p =&gt; p.FullName); ..\n</code></pre>\n"},{"tags":["database","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12629899,"title":"Using existing tools with a custom database","body":"<p>I have a large set of data on a local disk. This data is updated daily by a 3rd party program. I know the format of the data files, and I've written code to read them. To make use of this data I found myself writing a lot of database type code. So I started looking into using existing tools such as LINQ, SQL, The Entity Framework, etc.</p>\n\n<p>This is a large amount data and it is updated daily, so I don't want to duplicate it. Is it possible to setup The Entity Framework or similar tools so that they read data in a custom format?</p>\n"},{"tags":["entity-framework","odbc","lotus-notes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12628810,"title":"Connect EntityFramework to Lotus Notes","body":"<p>theoretically I should be able to connect EntityFramework to any Db I can access through ODBC drivers, is this correct? So if I use a library like the one mentioned at <a href=\"http://www.connectionstrings.com/lotus-notes\" rel=\"nofollow\">http://www.connectionstrings.com/lotus-notes</a> it should be possible to connect EF to Lotus Notes? \nI know this is something one should avoid ;) It's a one time only migration.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12626875,"title":"Exception, with two references in base class with Entity Framework 5","body":"<p>I had this problem in a project, since I don't want to give the whole domain scope, I've tried to simplify the classes as much as possible.</p>\n\n<p>Basically I have a base class <code>BaseClass</code>, where two properties are referencing a a class that is Extending <code>BaseClass</code> => <code>ClassA</code></p>\n\n<p>It works if I remove ClassB.<br>\nIt works if I remove one of the two references.<br>\nIt works when I don't extend <code>ClassA</code> from the <code>BaseClass</code>  </p>\n\n<p>But not in this constellation:</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Data.Entity;\nusing System.Threading;\n\nnamespace EFTestbed\n{\n    public abstract class BaseClass\n    {\n        public int Id { get; set; }\n        public ClassA ClassA1 { get; set; }\n        public ClassA ClassA2 { get; set; }\n    }\n\n    public class ClassA : BaseClass\n    {\n        public string TitleA { get; set; }\n    }\n\n    public class ClassB : BaseClass\n    {\n        public string TitleB { get; set; }\n    }\n\n    public class Context : DbContext\n    {\n        public DbSet&lt;ClassA&gt; ClassAs { get; set; }\n        public DbSet&lt;ClassB&gt; ClassBs { get; set; }\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            base.OnModelCreating(modelBuilder);\n\n            modelBuilder.Entity&lt;ClassA&gt;()\n                .HasOptional(e =&gt; e.ClassA1).WithOptionalDependent();\n            modelBuilder.Entity&lt;ClassA&gt;()\n                .HasOptional(e =&gt; e.ClassA2).WithOptionalDependent();\n\n            modelBuilder.Entity&lt;ClassB&gt;()\n                .HasOptional(e =&gt; e.ClassA1).WithOptionalDependent();\n            modelBuilder.Entity&lt;ClassB&gt;()\n                .HasOptional(e =&gt; e.ClassA2).WithOptionalDependent();\n\n        }\n    }\n\n    public class Program\n    {\n        static void Main(string[] args)\n        {\n            Thread.CurrentThread.CurrentCulture = \n            Thread.CurrentThread.CurrentUICulture = \n                new System.Globalization.CultureInfo(\"en-GB\");\n            System.Console.WriteLine(\"Creating &amp; Updating database...\");\n\n            Database.SetInitializer(new DropCreateDatabaseAlways&lt;Context&gt;());\n            using (var context = new Context())\n            {\n                context.ClassAs.Add(new ClassA() { TitleA = \"Test1\" });\n                System.Console.WriteLine(\n                  string.Format(\"Number of objects written to the database: {0}\", \n                                context.SaveChanges()));\n            }\n\n            System.Console.Write(\"Press Enter to continue...\");\n            System.Console.ReadLine();\n        }\n    }\n}\n</code></pre>\n\n<p>I always get this Exception <em>\"Sequence contains more than one element\"</em></p>\n\n<p>How do I get it to work?</p>\n\n<p>Here is the stack trace of the Exception:</p>\n\n<pre><code>   at System.Linq.Enumerable.Single[TSource](IEnumerable`1 source)\n   at System.Data.Entity.ModelConfiguration.Configuration.Properties.Navigation.NavigationPropertyConfiguration.ConfigureDependentBehavior(EdmAssociationType associationType, EdmModel model, EntityTypeConfiguration entityTypeConfiguration)\n   at System.Data.Entity.ModelConfiguration.Configuration.Properties.Navigation.NavigationPropertyConfiguration.Configure(EdmNavigationProperty navigationProperty, EdmModel model, EntityTypeConfiguration entityTypeConfiguration)\n   at System.Data.Entity.ModelConfiguration.Configuration.Types.EntityTypeConfiguration.ConfigureAssociations(EdmEntityType entityType, EdmModel model)\n   at System.Data.Entity.ModelConfiguration.Configuration.Types.EntityTypeConfiguration.Configure(EdmEntityType entityType, EdmModel model)\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.ConfigureEntities(EdmModel model)\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.Configure(EdmModel model)\n   at System.Data.Entity.DbModelBuilder.Build(DbProviderManifest providerManifest, DbProviderInfo providerInfo)\n   at System.Data.Entity.DbModelBuilder.Build(DbConnection providerConnection)\n   at System.Data.Entity.Internal.LazyInternalContext.CreateModel(LazyInternalContext internalContext)\n   at System.Data.Entity.Internal.RetryLazy`2.GetValue(TInput input)\n   at System.Data.Entity.Internal.LazyInternalContext.InitializeContext()\n   at System.Data.Entity.Internal.InternalContext.Initialize()\n   at System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType)\n   at System.Data.Entity.Internal.Linq.InternalSet`1.Initialize()\n   at System.Data.Entity.Internal.Linq.InternalSet`1.get_InternalContext()\n   at System.Data.Entity.Internal.Linq.InternalSet`1.ActOnSet(Action action, EntityState newState, Object entity, String methodName)\n   at System.Data.Entity.Internal.Linq.InternalSet`1.Add(Object entity)\n   at System.Data.Entity.DbSet`1.Add(TEntity entity)\n   at EFTestbed.Program.Main(String[] args) in d:\\users\\sasp1de\\documents\\visual studio 2010\\Projects\\EFTestbed\\EFTestbed\\TestEF\\Program.cs:line 54\n   at System.AppDomain._nExecuteAssembly(RuntimeAssembly assembly, String[] args)\n   at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)\n   at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()\n   at System.Threading.ThreadHelper.ThreadStart_Context(Object state)\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean ignoreSyncCtx)\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\n   at System.Threading.ThreadHelper.ThreadStart()\n</code></pre>\n"},{"tags":["entity-framework","validation","dataannotations","wcf-ria-services","silverlight-5.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12606092,"title":"Check against DataBase just using DataAnnotations and ValidationMethods","body":"<p>To make my need easier to explain I will use a case that everybody knows.</p>\n\n<p>Remember when you are registering a new Hotmail account, when entering the new Microsoft Account and you <strong>leave the field</strong>, this value is validated against the database to check if it's available.</p>\n\n<p>How do I do that using just DataAnnotations and Validation Methods on the DomainService metadata?</p>\n\n<p>I'm using an ADO NET Entity Model autogenerated from a SQL Express Database, RIA Services, Data Annotations, Validation Methods, and Silverlight 5.</p>\n\n<p>I just checked Jeff Handley's blog on the subject, and he introduces a solution that involves creating a service that makes the Data available from the validation method on the server. The problem is that this solution doesn't work well on my case, he uses a two tables entity model, and makes some tricks that only work with that simple case and not on mine.</p>\n\n<p>Have somebody worked out this problem succesfully?</p>\n\n<p>I could create a stored procedure and invoke it just before submitting changes in the silverlight app or I could make the extra validation in the OnSave method of my ViewModel, but it means that I'm completing the validation process from the client, and I'd like to do it entirely from the server to avoid repeating code.</p>\n\n<p>Besides, I would like to make the validation before pressing \"Save\".</p>\n\n<p>Rafael</p>\n"},{"tags":["c#","entity-framework","reflection"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":12628148,"title":"How to get dynamically the properties from a object T from a dynamically objectset<t> using entity framework?","body":"<p>I'm trying to create a report screen that adjust itself dynamically to the contents of a database view that is present in a model generated with entity framework.</p>\n\n<p>To get the entity i'm using this code:</p>\n\n<pre><code>var view = context.GetType().GetProperty(viewName).GetValue(context, null);\n</code></pre>\n\n<p>This code returns the <code>ObjectSet&lt;viewType&gt;</code> that fulfill part of my needs.</p>\n\n<p>Now I need to get the properties of the view type so I can get the columns. </p>\n\n<p>I tryed to used something like that:</p>\n\n<pre><code>var methodInfo = view .GetType().GetMethod(\"First\");\nvar properties = methodInfo.ReturnType.GetProperties(BindingFlags.Public | BindingFlags.Instance);\n</code></pre>\n\n<p>But its not finding the method \"First\" and I don't know exactly where to find some help of how can I make this works.</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12627323,"title":"Entity Framework 5 add property to join table","body":"<p>Using EF5 and migrations. I want to add a property to my join table ProjectUser. I set up the models as below, but the migration does not generate the property. Thanks or ideas were be greatly appreciated.</p>\n\n<pre><code>User { \npublic int UserGuid { get; set; }\n....\npublic virtual IColllection&lt;Project&gt; Projects { get; set; }\n}\n\nProject {\npublic int ProjectId { get; set; }\n....\npublic virual ICollection&lt;User&gt; Contacts { get; set; }\n}\n\nProjectUser {\npublic int Project_ProjectId { get; set; }\npublic guid User_UserGuid { get; set; }\npublic string ProjectRoles { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":4,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":1155,"score":5,"question_id":1715141,"title":"update disconnected object in entity framework","body":"<p>i can't seem to find the answer to this....\ni have some data coming from other tiers and it represents a EF object.\nWhen it's new, i do this:</p>\n\n<pre><code>context.AddToCustomer(mynewobject);\ncontext.SaveChanges();\n</code></pre>\n\n<p>but now my data forms an existing object, so i want the context to know i want to update the data and not inserting it.</p>\n\n<p>i've seen 'ApplyPropertyChanges' but i can't figure out how to use it.\nI've also seen people doing this:</p>\n\n<pre><code>Customer existingOne = (from n in context.Customers where n.id = mynewobject.id select n).First()\nexistingOne.name = mynewobject.name\nexistingOne.address= mynewobject.address\ncontext.SaveChanges();\n</code></pre>\n\n<p>but that seems a little odd because i have to manually set all the props AND read the entire object first.</p>\n\n<p>Michel</p>\n"},{"tags":["c#","asp.net",".net","database","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12626554,"title":"Mapping a custom entity to stored procedures","body":"<p>I'm trying to map a custom entity to a set of stored procedures. The properties on the entity correspond to the parameters of the insert and update procs as well as the select proc used in the function import. I get the following error for all the properties on my entity object when I open the EDMX file in XML view:</p>\n\n<blockquote>\n  <p><em>Error 11009: Property 'xxx' is not mapped.</em></p>\n</blockquote>\n\n<p>I searched this error on Google and some forums suggested that Entities can only be mapped to tables; custom entities are not permitted to be mapped to stored procedures.</p>\n\n<p>Can custom entities be mapped to stored procedures without mapping to a table in a database? If not, what would be the best approach using the Entity Framework to solve this issue? My initial thought is to create a complex type and then use function imports for all the CRUD methods.</p>\n"},{"tags":["c#",".net","sql-server","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12625327,"title":"amazing DBA create hard queries, and implement it on Entity Framework 5","body":"<p>I do not have much experience with EF5, and my DBA generates just awful complexity queries, and I was very limited in the choice of tools.\nI will describe the problem.\nThe database is not normalized so that such queries is a necessity. And I can not influence its structure and queries\nFor example i have query:</p>\n\n<pre><code>SELECT A.my_id, \n    A.field_1, \n    A.field_2, \n    A.field_3, \n    A.field_4, \n    A.field_5, \n    A.field_6,\n    A.field_7, \n    A.field_8, \n    A.field_9, \n    B.field_10, \n    C.field_11, \n    C.field_12,\n    C.field_13, \n    C.field_14, \n    D.field_15, \n    E.my_id2, \n    E.field_16, \n    E.field_17, \n    E.field_18, \n    G.field_19\n    etc...\nFROM tbl1 A, \ntbl2 B, tbl3 C, tbl4 D, tbl5 E, tbl6 F, tbl7 G\nWHERE A.my_id                   = B.my_id\n  AND A.my_id                   = C.my_id\n  AND A.my_id                   = D.my_id\n  AND A.my_id                   = E.my_id\n  AND E.my_id3                  = F.my_id3\n  AND E.my_id4                  = G.my_id4\n  AND E.my_id2                  = &lt;value from code&gt;\n  AND F.param1                  = &lt;value from code&gt;\n  AND B.param4                  = 'KEY1'\n  AND B.param5                  = 'KEY2'\n  AND E.param8                  &gt; 0 \n  AND E.param9                  = 'KEY3'\n  AND E.param10                 &lt;&gt; 'KEY4'       \n  AND G.param11                 = 'KEY5'\n  AND G.param12                 &lt;= &lt;SYSTEM DATETIME&gt;\n  AND G.param13                 &gt;= &lt;SYSTEM DATETIME&gt;\n  AND A.param2                  &lt;= &lt;SYSTEM DATETIME&gt;\n  AND A.param3                  &gt;= &lt;SYSTEM DATETIME&gt;\n  AND B.param6                  &lt;= &lt;SYSTEM DATETIME&gt;\n  AND B.param7                  &gt;= &lt;SYSTEM DATETIME&gt;`\n</code></pre>\n\n<p>Now I will describe the problems that I encountered when moving the queries in code using Entity Framework 5.</p>\n\n<p>I do INNER JOIN to a main table. Like this.</p>\n\n<pre><code>ObjectContext.CreateQuery&lt;ETbl5&gt;(entityName).\n.Where(E =&gt;\n    E.param2 &gt;= SqlFunctions.GetDate() &amp;&amp; E.param3 &lt;= SqlFunctions.GetDate() &amp;&amp;\n    E.param8 &gt; 0 &amp;&amp; E.param9 == \"KEY3\" &amp;&amp;\n    E.param10 != \"KEY4\" &amp;&amp; E.my_id2 == &lt;value from code&gt;\n)\n.Join((Context as MyDbContext).ETbl7 ,\n    E =&gt; new { A.my_id4},\n    G =&gt; new { B.my_id4},\n    (E, G) =&gt; E\n)\n</code></pre>\n\n<p>How do I add conditions for JOIN as <code>AND G.param12 &lt;= &lt;SYSTEM DATETIME&gt;</code>? How can I add such conditions in an anonymous type?</p>\n\n<p>I have always a lot of problems and I think im on wrong way. Perhaps in addition to solving the problem, you can tell me the correct Strategy for dealing with such queries.\nI understand that it can be transferred to a stored procedure, but the output I want to have the result that IQuerable to use it in Grid with Pagination.\nThank you for your attention.</p>\n"},{"tags":["entity-framework","design-patterns","repository-pattern","unit-of-work"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":51,"score":-1,"question_id":12624023,"title":"Re: UnitOfWork - can the context be decoupled?","body":"<p>I just finished watching Julie Lerman's video on Enterprise EF. I especially like the concept of custom data context as it would give me more granular control over the respective UI's. </p>\n\n<p>Julie has CRUD methods in all her respositories and that is just way too much coding for my likes. I plan to create a Generic Repository that other repositories derive from. I did not like her UOW.</p>\n\n<p>I plan on using this approach to UOW as it relates to the repositories:</p>\n\n<p><a href=\"http://codereview.stackexchange.com/questions/14226/generic-repository-and-unit-of-work-code\">http://codereview.stackexchange.com/questions/14226/generic-repository-and-unit-of-work-code</a></p>\n\n<p><strong>Relative conditions with custom data context objects:</strong></p>\n\n<ol>\n<li><p>Let's assume I create:</p>\n\n<p>i. CustomerLookup class that only has partials properties of the full Customer class.</p></li>\n<li><p>I also create </p>\n\n<p>i. a CustomerLookup db context </p>\n\n<p>ii. an OrdersLookup db context that has the complete Orders class but ignores the associated entity Shipping in the configuration.</p></li>\n</ol>\n\n<p>If I follow the UOW example in the link above, the UOW uses the <strong>FULL DbContext</strong> to save changes.</p>\n\n<p><strong>Question:</strong></p>\n\n<ol>\n<li><p>Is it possible to instantiate the UOW, when in the API controller as example,  so that a specific data context can be used:</p>\n\n<p>i. CustomerLookupContext with UOW.CustomerLookupRepository.Update(customerLookup)?</p>\n\n<p>ii. OrdersLookupContext with UOW.OrdersLookupRepository.Update(order) ?</p></li>\n</ol>\n\n<p>If I cannot decouple the context object from UOW:</p>\n\n<ol>\n<li>Will I have a problem updating partial classes like above; or</li>\n<li>Does using the whole DbContext affect performance; or,</li>\n<li>I have no idea what I'm talking about &amp; just use UOW's full DbContext?</li>\n</ol>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12626650,"title":"Entity Framework Table by Type Design and Insert","body":"<p>I have a table by Type design</p>\n\n<pre><code>class Table1\n{\n  public int id {get;set;}\n  public string data1{get;set;}\n  public string data2{get;set;}\n}\nclass Table2\n{\n  public int table1_id {get;set;}\n  public string data3{get;set;}\n  public string data4{get;set;}\n}\nclass Table3\n{\n  public int table1_id {get;set;}\n  public string data5{get;set;}\n  public string data6{get;set;}\n}\n</code></pre>\n\n<p>In my seed method i insert a row into Table1. new {id=0,...}\nThen i do </p>\n\n<pre><code>context.Table2Set.AddOrUpdate(new Table2{table1_id = 0,...});\n</code></pre>\n\n<p>When i run my Update-Database i get:</p>\n\n<pre><code>System.Data.Entity.Validation.DbEntityValidationException: Validation failed for one or more entities. See 'EntityValidationErrors' property for more details.\n   at System.Data.Entity.Internal.InternalContext.SaveChanges()\n   at System.Data.Entity.Internal.LazyInternalContext.SaveChanges()\n   at System.Data.Entity.DbContext.SaveChanges()\n   at System.Data.Entity.Migrations.DbMigrator.SeedDatabase()\n   at System.Data.Entity.Migrations.Infrastructure.MigratorLoggingDecorator.SeedDatabase()\n   at System.Data.Entity.Migrations.DbMigrator.Upgrade(IEnumerable`1 pendingMigrations, String targetMigrationId, String lastMigrationId)\n   at System.Data.Entity.Migrations.Infrastructure.MigratorLoggingDecorator.Upgrade(IEnumerable`1 pendingMigrations, String targetMigrationId, String lastMigrationId)\n   at System.Data.Entity.Migrations.DbMigrator.Update(String targetMigration)\n   at System.Data.Entity.Migrations.Infrastructure.MigratorBase.Update(String targetMigration)\n   at System.Data.Entity.Migrations.Design.ToolingFacade.UpdateRunner.RunCore()\n   at System.Data.Entity.Migrations.Design.ToolingFacade.BaseRunner.Run()\nValidation failed for one or more entities. See 'EntityValidationErrors' property for more details.\n</code></pre>\n\n<p>Am i doing something wronge? </p>\n\n<p><strong>UPDATE</strong> The real data</p>\n\n<pre><code>public class Identity\n{\n    public Identity()\n    {\n        this.Roles = new List&lt;Role&gt;();\n    }\n\n    public int Id { get; set; }\n    public System.DateTime DateAdded { get; set; }\n    public string identityprovider { get; set; }\n    public string nameidentifier { get; set; }\n    public System.DateTime LastLoggedIn { get; set; }\n\n    public virtual ICollection&lt;Role&gt; Roles { get; set; }\n}\n\npublic class Member : Identity\n{\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public string Email { get; set; }\n    public Address Address { get; set; }\n    public int Id { get; set; }\n\n    public virtual ICollection&lt;News&gt; News { get; set; }\n\n}\n    public IdentityMap()\n    {\n        // Primary Key\n        this.HasKey(t =&gt; t.Id);\n        this.Property(t=&gt;t.Id).HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n        // Properties\n        this.Property(t =&gt; t.identityprovider)\n            .IsRequired()\n            .HasMaxLength(255);\n\n        this.Property(t =&gt; t.nameidentifier)\n            .IsRequired();\n\n        // Table &amp; Column Mappings\n\n        this.Property(t =&gt; t.Id).HasColumnName(\"Id\");\n\n\n\n        this.Property(t =&gt; t.DateAdded).HasColumnName(\"DateAdded\").\n            HasDatabaseGeneratedOption(DatabaseGeneratedOption.Computed);\n        this.Property(t =&gt; t.identityprovider).HasColumnName(\"identityprovider\");\n        this.Property(t =&gt; t.nameidentifier).HasColumnName(\"nameidentifier\");\n        this.Property(t =&gt; t.LastLoggedIn).HasColumnName(\"LastLoggedIn\")\n            .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Computed);\n\n        // Relationships\n        this.HasMany(t =&gt; t.Roles)\n            .WithMany(t =&gt; t.Identities)\n            .Map(m =&gt;\n                {\n                    m.ToTable(\"IdentityRoles\");\n                    m.MapLeftKey(\"Identities_Id\");\n                    m.MapRightKey(\"Roles_Id\");\n                });\n        this.ToTable(\"Identities\");\n\n    }\n  public MemberMap()\n    {\n        // Primary Key\n        this.HasKey(t =&gt; t.Id);\n\n        // Properties\n        this.Property(t =&gt; t.FirstName)\n            .IsRequired()\n            .HasMaxLength(150);\n\n        this.Property(t =&gt; t.LastName)\n            .IsRequired()\n            .HasMaxLength(50);\n\n        this.Property(t =&gt; t.Email)\n            .IsRequired()\n            .HasMaxLength(150);\n\n        this.Property(t =&gt; t.Address.Id)\n            .IsRequired()\n            .HasMaxLength(100)\n            .HasColumnName(\"Address_FirstLine\");\n\n        this.Property(t =&gt; t.Address.ZipCode)\n            .IsRequired()\n            .HasMaxLength(20).HasColumnName(\"Address_Zip\");\n\n        this.Property(t =&gt; t.Address.Contry)\n            .IsRequired()\n            .HasMaxLength(100).HasColumnName(\"Address_Contry\");\n\n        this.Property(t =&gt; t.Address.City)\n            .IsRequired()\n            .HasMaxLength(100).HasColumnName(\"Address_Town\");\n\n        this.Property(t =&gt; t.Id);\n\n\n        // Table &amp; Column Mappings\n        this.ToTable(\"Identities_Member\");\n        this.Property(t =&gt; t.FirstName).HasColumnName(\"FirstName\");\n        this.Property(t =&gt; t.LastName).HasColumnName(\"LastName\");\n        this.Property(t =&gt; t.Email).HasColumnName(\"Email\");\n        this.Property(t =&gt; t.Id).HasColumnName(\"Id\");\n\n        // Relationships\n\n\n\n    }\n        CreateTable(\n            \"dbo.Identities_Member\",\n            c =&gt; new\n                {\n                    Id = c.Int(nullable: false),\n                    FirstName = c.String(nullable: false, maxLength: 150),\n                    LastName = c.String(nullable: false, maxLength: 50),\n                    Email = c.String(nullable: false, maxLength: 150),\n                    Address_FirstLine = c.String(nullable: false, maxLength: 100),\n                    Address_Street = c.String(),\n                    Address_Town = c.String(nullable: false, maxLength: 100),\n                    Address_Zip = c.String(nullable: false, maxLength: 20),\n                    Address_Contry = c.String(nullable: false, maxLength: 100),\n                })\n            .PrimaryKey(t =&gt; t.Id)\n            .ForeignKey(\"dbo.Identities\", t =&gt; t.Id)\n            .Index(t =&gt; t.Id);\n}\nCreateTable(\n                \"dbo.Identities\",\n                c =&gt; new\n                    {\n                        Id = c.Int(nullable: false, identity: true),\n                        DateAdded = c.DateTime(nullable: false, defaultValueSql: \"GETUTCDATE()\"),\n                        identityprovider = c.String(nullable: false, maxLength: 255),\n                        nameidentifier = c.String(nullable: false,maxLength:100),\n                        LastLoggedIn = c.DateTime(nullable: false, defaultValueSql: \"GETUTCDATE()\"),\n                    })\n                .PrimaryKey(t =&gt; t.Id)\n                .Index(t=&gt;t.nameidentifier);\n</code></pre>\n"},{"tags":["c#",".net","sql-server-2008","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":12625453,"title":"How do SQL Server computed columns work in EntityFramework?","body":"<p>I have a table whose column <code>TotalAmount</code> is a computed column from columns <code>Amount+Extra</code>, so how this computation works, if I use Entity Framework on this table?</p>\n\n<p>Thanks.</p>\n"},{"tags":["mysql","visual-studio","entity-framework","many-to-many"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":338,"score":2,"question_id":3643735,"title":"How to update many-to-many related objects with Entity framework 1 & MySQL?","body":"<p>I have such a problem. I'm using EF1 with VS2008 SP1 &amp; MySQL with MySQL Connector/Net 6.3.4</p>\n\n<p>My database schema looks like this:</p>\n\n<pre><code>CREATE TABLE IF NOT EXISTS `credential` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `name` varchar(50) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=3 ;\n\nCREATE TABLE IF NOT EXISTS `user` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `name` varchar(50) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=3 ;\n\nCREATE TABLE IF NOT EXISTS `user_credential` (\n  `user_id` int(11) NOT NULL,\n  `credential_id` int(11) NOT NULL,\n  KEY `credential_id` (`credential_id`),\n  KEY `user_id` (`user_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\nALTER TABLE `user_credential`\n  ADD CONSTRAINT `user_credential_ibfk_2` FOREIGN KEY (`credential_id`) REFERENCES    `credential` (`id`) ON DELETE CASCADE,\n  ADD CONSTRAINT `user_credential_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE CASCADE;\n</code></pre>\n\n<p>While I'm trying to execute the folowing code I have exception that I cannot understand</p>\n\n<pre><code>var entities = new studyEntities();\n\nvar user = new User { Name = \"test\" };\nvar credential = new Credential { Name = \"admin\" };\n\nentities.AddToCredentialSet(credential);\nentities.AddToUserSet(user);\n\nentities.SaveChanges();\nuser.Credentials.Add(credential);\nentities.SaveChanges(); // He I have a strange exception thrown\n\n\nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(SELECT\n  `user_credential`.`credential_id`, \n  `user_credential`.`user_' at line 1\n</code></pre>\n\n<p>What does it mean? How can I see the whole query to seek the problem in it? or maybe what I'm doing wrong?</p>\n"},{"tags":["c#","entity-framework","generics","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":12625929,"title":"Multiple includes using Entity Framework and Repository Pattern","body":"<p>I am using Entity Framework and a Repository Pattern for all my data access, when using table navigation I have noticed that 2 queries are being run when I got the first object and reference a field in a navigation object. As I have lots of relationships in the database using this technique for my navigation properties may cause performance overheads.</p>\n\n<p>I have looked into the <code>Include(string tableName)</code> method and this will work really well (if I was not using a generic RP) but this only takes one table name. I have managed to replicate this in my repository pattern for one include by changing my where from <code>classs</code> to <code>EntityObject</code> but how can I have multiple includes in one query using a repository pattern??</p>\n\n<p>here is my code:</p>\n\n<pre><code>public class GenericRepository&lt;T&gt; : IRepository&lt;T&gt; where T : EntityObject, new()\n{\n    private Entities _Context;\n    private ObjectSet&lt;T&gt; _ObjectSet;\n\n    public IQueryable&lt;T&gt; FindBy(System.Linq.Expressions.Expression&lt;Func&lt;T, bool&gt;&gt; predicate, string include)\n    {\n        // This works OK\n        return this._ObjectSet.Include(include).Where(predicate);\n    }\n\n    public IQueryable&lt;T&gt; FindBy(System.Linq.Expressions.Expression&lt;Func&lt;T, bool&gt;&gt; predicate, param string[] include)\n    {\n        // This will not work but is what I am trying to do\n        return this._ObjectSet.Include(include).Where(predicate);\n    }\n}\n</code></pre>\n"},{"tags":["c#","asp.net-mvc","asp.net-mvc-3","entity-framework","asp.net-mvc-2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":524,"score":0,"question_id":12080339,"title":"N-Tier Architecture with Service Layer, Business Layer, and Entity Framework","body":"<p>Just wanted some feedback/help with the way I'm architecturing my application. My current solution structure looks something like this:</p>\n\n<ul>\n<li>UI (Actual MVC application)</li>\n<li>Core (only Controllers &amp; ViewModels)</li>\n<li>Services</li>\n<li>BLL </li>\n<li>Data (Entity framework DbContext, mapped to Domain objects)</li>\n<li>Domain (Simple POCO objects)</li>\n<li>Interfaces</li>\n</ul>\n\n<p>Other stuff</p>\n\n<ul>\n<li>Ninject to inject DbContext into Controller (per request)</li>\n<li>AutoMapper to map Domain objects to ViewModel</li>\n</ul>\n\n<p>All assemblies have a reference to the Interfaces project, which, as the name suggests, is nothing more than simple interfaces (i.e. IDbContext, IRepository, etc).</p>\n\n<p>The Services project \"ties\" together everything else. It is the only assembly which has a direct reference to the Data access layer (Entity Framework).</p>\n\n<p>I've provided some code below:</p>\n\n<p>An example of a Controller looks like this:</p>\n\n<pre><code>namespace Core.Controllers\n{\n    public class HomeController : Controller\n    {\n        private IDbContext dbContext;\n\n        public HomeController(IDbContext dbContext)\n        {\n            this.dbContext = dbContext;\n        }\n\n        public ActionResult Users()\n        {\n            UserService userService = new UserService(dbContext);\n            var users = userService.GetAllUsers();\n            return View(Mapper.Map&lt;IEnumerable&lt;UserListViewModel&gt;&gt;(users));\n        }\n        ...\n</code></pre>\n\n<p>The UserService class:</p>\n\n<pre><code>namespace Services\n{\n    public class UserService\n    {\n        private readonly IDbContext dbContext;\n\n        public UserService(IDbContext dbContext)\n        {\n            this.dbContext = dbContext;\n        }\n\n        public IEnumerable&lt;User&gt; GetAllUsers()\n        {\n            IRepository&lt;User&gt; userRepository = new Repository&lt;User&gt;(dbContext);\n            UserBLL userBLL = new UserBLL(userRepository);\n            return userBLL.GetAllUsers();\n        }\n        ...\n</code></pre>\n\n<p>Finally, the business layer class:</p>\n\n<pre><code>namespace BLL\n{\n    public class UserBLL\n    {\n        private readonly IRepository&lt;User&gt; userRepository;\n\n        public UserBLL(IRepository&lt;User&gt; userRepository)\n        {\n            this.userRepository = userRepository;\n        }\n\n        public IEnumerable&lt;User&gt; GetAllUsers()\n        {\n            return userRepository.Get();\n        }\n        ...\n</code></pre>\n\n<p>I'm looking for some feedback/ways to improve. I notice that for basic tasks, my service layer methods will be exactly the same as the business layer methods (i.e. \"pass through\" functions). What I'm hoping is that this abstraction will be helpful for more complex tasks which may require calls to multiple business layer methods. Would it just be better to include business logic in the service layer?</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12626352,"title":"Many to many relationship - retrieve both ends","body":"<p>I have the following entities set up in Code First Entity Framework:</p>\n\n<pre><code> public class User\n {\n    public int UserId { get; set; }\n    public virtual ICollection&lt;Task&gt; Tasks { get; set; }\n }\n\n public class Task \n {\n     public int TaskId { get; set; }\n     public virtual ICollection&lt;User&gt; Users { get; set; }\n }\n</code></pre>\n\n<p>How would I write a query that for a given user, returns all tasks assigned to that user, and those tasks include all of the users that are assigned to the task.</p>\n\n<p>For example:</p>\n\n<p>I am assigned two tasks. Those two tasks are assigned to both me and another user.</p>\n\n<p>When I retrieve my user, I want the Tasks collection to include both Tasks I am assigned to, and when I look at one of the Tasks it should have a reference back to my user, and another user.</p>\n\n<p>I don't want to use lazy loading.</p>\n\n<p>I tried something like:</p>\n\n<pre><code> db.Users.Include(t =&gt; t.Tasks.Include(u =&gt; u.Users)).SingleOrDefault(u =&gt; u.UserId == 1)\n</code></pre>\n\n<p>but it did not work</p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-4.3","dbcontext"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":572,"score":1,"question_id":11197754,"title":"Entity Framework: One Database, Multiple DbContexts. Is this a bad idea?","body":"<p>My impression to date has been that a DbContext is meant to represent your database, and thus, if your application uses one database, you'd want only one DbContext. However, some colleagues want to break functional areas out into separate DbContext classes. I believe comes from a good place -- a desire to keep the code cleaner -- but it seems volatile. My gut's telling me it's a bad idea, but unfortunately my gut feeling is not a sufficient condition for a design decision.</p>\n\n<p>So I'm looking for A) concrete examples of why this might be a bad idea, or B) assurances that this'll all work out just fine.</p>\n"},{"tags":["entity-framework","repository","automapper"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12623253,"title":"IRepository in project which my Repository project references makes it hard to actually use them","body":"<p>I'm currently working in asp.net mvc 4 with EF5 and I'm trying to get my Dependency Injection to work with Ninject.</p>\n\n<p>I've made 4 different projects in my solution:</p>\n\n<ul>\n<li>Gui -> contains my MVC-project</li>\n<li>BusinessLogic -> BusinessLogic</li>\n<li>DataAccess -> my edmx-file and Repository (references Common) </li>\n<li>Common -> Models, ViewModels and IRepository.</li>\n</ul>\n\n<p>Now I'm trying to write this:</p>\n\n<p>IRepository:</p>\n\n<pre><code>    IQueryable&lt;PictureSource&gt; PictureSource { get; }\n</code></pre>\n\n<p>Repository:</p>\n\n<pre><code>    IQueryable&lt;PictureSource&gt; IRepository.PictureSource\n        {\n            get { return context.PictureSource }\n        }\n</code></pre>\n\n<p>Now the problem is I can't call on PictureSource in my IRepository because it's an Entity from my EF, which is in my DataAccess. I've tried using automapper the following way in my Repository:</p>\n\n<pre><code>     public IQueryable&lt;PictureSourceModel&gt; PictureSource()\n        {\n            Mapper.CreateMap&lt;List&lt;PictureSource&gt;, List&lt;PictureSourceModel&gt;&gt;();\n     return Mapper.Map&lt;List&lt;PictureSource&gt;,List&lt;PictureSourceModel&gt;&gt;\n     (context.PictureSource.ToList());\n        }\n</code></pre>\n\n<p>This gives errors about it beind a dbSet.\nAny hints?</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12623573,"title":"Entity Framework: Fluent API. How should I map this relationship?","body":"<p>My table is as follows:</p>\n\n<pre><code>create table Entities(\n    EntityId bigint not null identity(1, 1),\n    Name nvarchar(64) not null,\n    ParentEntityId bigint null\n)\nalter table Entities add constraint PK primary key (EntityId)\nalter table Entities add constraint FK foreign key (ParentEntityId) references Entities(EntityId)\n</code></pre>\n\n<p>My model looks like this:</p>\n\n<pre><code>public class Entity\n{\n    [Required]\n    public virtual long EntityId { get; set; }\n\n    [Required]\n    public virtual string Name { get; set; }\n\n    public virtual long? ParentEntityId { get; set; }\n\n    public virtual Entity ParentEntity { get; set; }\n}\n</code></pre>\n\n<p>and I'm trying to map the <code>ParentEntity</code> property with fluent api mapping, but I couldn't get this to work. How can I do it?<br>\nThanks in advance!</p>\n\n<p>EDIT: Fixed code discrepancy.</p>\n"},{"tags":["entity-framework","count"],"answer_count":3,"favorite_count":5,"up_vote_count":13,"down_vote_count":0,"view_count":2567,"score":13,"question_id":2010897,"title":"How To Count Associated Entities Without Fetching Them In Entity Framework","body":"<p>I've been wondering about this one for a while now, so I thought it would be worth using my first Stack Overflow post to ask about it.</p>\n\n<p>Imagine I have a discussion with an associated list of messages:</p>\n\n<pre><code>DiscussionCategory discussionCategory = _repository.GetDiscussionCategory(id);\n</code></pre>\n\n<p>discussionCategory.Discussions is a list of Discussion entities which is not currently loaded.</p>\n\n<p>What I want is to be able to iterate through the discussions in a discussionCategory and say how many messages are in each discussion without fetching the message data.</p>\n\n<p>When I have tried this before I have had to load the Discussions and the Messages so that I could do something like this:</p>\n\n<pre><code>discussionCategory.Discussions.Attach(Model.Discussions.CreateSourceQuery().Include(\"Messages\").AsEnumerable());\n\nforeach(Discussion discussion in discussionCategory.Discussions)\n{\n\nint messageCount = discussion.Messages.Count;\n\nConsole.WriteLine(messageCount);\n\n}\n</code></pre>\n\n<p>This seems rather inefficient to me as I am fetching potentially hundreds of message bodies from the database and holding them in memory when all I wish to do is count their number for presentational purposes.</p>\n\n<p>I have seen some questions which touch on this subject but they did not seem to address it directly.</p>\n\n<p>Thanks in advance for any thoughts you may have on this subject.</p>\n\n<p>Update - Some more code as requested:</p>\n\n<pre><code>public ActionResult Details(int id)\n    {  \n        Project project = _repository.GetProject(id);\n        return View(project);\n    }\n</code></pre>\n\n<p>Then in the view (just to test it out):</p>\n\n<pre><code>Model.Discussions.Load();\nvar items = from d in Model.Discussions select new { Id = d.Id, Name = d.Name, MessageCount = d.Messages.Count() };\n\nforeach (var item in items) {\n//etc\n</code></pre>\n\n<p>I hope that makes my problem a bit clearer. Let me know if you need any more code details.</p>\n"},{"tags":["c#","sql-server","entity-framework","data-modeling"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12613875,"title":"Entity Framework storing arrays of data","body":"<p>I've started playing around with using Entity Framework Code-First because it looks like a nice way to get a database up and running quickly. I'm coming from a PostgreSQL background, which has support for array types in tables, for example <code>time[]</code>. My question is two-fold; does SQL Server support array types, and if so, how can I use them in EF? If they're not supported, what is an alternative way to represent this data?</p>\n\n<pre><code>table Venue\n    openhours time[]\n</code></pre>\n\n<p><strong>Edit:</strong> The array above is intended to store different times for each day of the week- a venue might have different opening hours on different weekends to weekdays, for example.</p>\n"},{"tags":["linq","entity-framework","linq-to-entities"],"answer_count":3,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":505,"score":8,"question_id":5029368,"title":"Entity Framework Linq query: .where chain vs &&","body":"<p>This question pertains to query optimization using Linq with the Entity Framework in .NET 3.5sp1.  </p>\n\n<p><strong>Is there any difference between chaining .Where clauses and using &amp;&amp; in the where clause of a linq query with the entity framwork?</strong></p>\n\n<p>ex: suppose I have the following code:</p>\n\n<pre><code>var result = context.SomeEntity.Where(exp1).Where(exp2);\n</code></pre>\n\n<p>or</p>\n\n<pre><code>var result = context.SomeEntity.Where(exp1 &amp;&amp; exp2);\n</code></pre>\n\n<p>When evaluating these statements which yield the same result, does the linq and the entity framwork evaluate them in the same way?  ie: will both have the same execution plan, and therefore be equally efficient?</p>\n"},{"tags":["mysql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":216,"score":0,"question_id":12340878,"title":"Entity Framework 5 with MySql - Connection string example needed for web.config","body":"<p>I just need an example with a default MySQL developer installation.  I have this working fine with SQLExpress.  Here's my SQL Express connection string:</p>\n\n<pre><code>  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\"&gt;\n      &lt;parameters&gt;\n        &lt;parameter value=\"Data Source=.\\SQLEXPRESS; Integrated Security=True; MultipleActiveResultSets=True\" /&gt;\n      &lt;/parameters&gt;\n    &lt;/defaultConnectionFactory&gt;\n  &lt;/entityFramework&gt;\n</code></pre>\n\n<p>What should I put to make this work for MySQL</p>\n"},{"tags":["c#","linq","entity-framework","tolist"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":97,"score":6,"question_id":12622353,"title":"Why, the first query.ToList() work, but the second not work?","body":"<p>my problem is with the ToLinq() method :</p>\n\n<p>I don't understind why the first request work without problem, but the second give me an exception like :</p>\n\n<p>(the node type of the LINQ expression arrayIndex n is not supported in LINQ to Entities)</p>\n\n<pre><code>            var q = from a in ctx.ImmImmobilisations select a;\n            q = q.Where(x =&gt; x.CodeEntite      == \"EDEF\");\n            q = q.Where(x =&gt; x.CodeAffectation == \"000001\");\n            q = q.Where(x =&gt; x.Unite           == \"ITS\");\n            q = q.OrderBy(x =&gt; x.CodeImmobilisation);\n            List&lt;ImmImmobilisation&gt; res = q.ToList();\n\n            var query = from e in ctx.ImmImmobilisations select e;\n            if (!string.IsNullOrEmpty(args[0])) query = query.Where(x =&gt; x.CodeEntite      == args[0]);\n            if (!string.IsNullOrEmpty(args[1])) query = query.Where(x =&gt; x.CodeAffectation == args[1]);\n            if (!string.IsNullOrEmpty(args[2])) query = query.Where(x =&gt; x.CodeFamille     == args[2]);\n            if (!string.IsNullOrEmpty(args[3])) query = query.Where(x =&gt; x.CodeCCout       == args[3]);\n            if (!string.IsNullOrEmpty(unite))   query = query.Where(x =&gt; x.Unite      == unite);\n            query = query.OrderBy(x =&gt; x.CodeImmobilisation);\n            var ress = query.ToList();\n</code></pre>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":131,"score":0,"question_id":12622408,"title":"No connection string named 'MyEntities' could be found in the application config file","body":"<p>I am using entity framework and ASP.NET MVC 4 to build an application</p>\n\n<p>My solution is split into two projects;</p>\n\n<ul>\n<li>A class library that includes my data model (.edmx) file and a few custom interfaces</li>\n<li>The 'container' MVC project that references the class library above</li>\n</ul>\n\n<p>My problem is that when I attempt to use the 'MyEntites' DbContext I get the the following error</p>\n\n<pre><code>No connection string named 'MyEntities' could be found in the application config file.\n</code></pre>\n\n<p>I guess the problem has something to do with the fact that connection string lies within the app.config of the class library rather than the MVC project.</p>\n\n<p>Does anyone have any suggestions?</p>\n"},{"tags":["asp.net","asp.net-mvc","visual-studio","entity-framework","visual-studio-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":318,"score":0,"question_id":12256519,"title":"Entity Framework Issue in VS2012 - Rename Properties not Sticking","body":"<p>I was attempting to create a new project in VS2012 with an Administrative MVC4 project, Website MVC4 project, and a Common Entity Framework dll project.</p>\n\n<p>I used an existing database an database and generated my entities from it. I updated the names of some of the relation properties and saved. I then added references to the Entity Framework project to both of my MVC4 projects, copied the Entity Framework connection string from App.config fileto each of the Web.config files, and made sure I was referencing the same System.Data.Entity assembly in all 3 projects.</p>\n\n<p>I tried to add an MVC Controller using Entity Framework and received an error. The error stated that my entities did not have properties with certain names. It just so happened the names it was griping about were the ones that I renamed in the Entity Designer. So I ran Clean Solution, rebuilt, and attempted to add the controller again...Same error.</p>\n\n<p>Since it was complaining that it didn't have properties with certain names, I used ILSpy to inspect the assembly that was generated. Sure enough, it did not carry over the names I assigned to the properties in entity designer. Below is a photo of the Designer interface showing that I renamed the classes (yes I saved it), the error message I was getting when attempting to add the MVC controller, and the ILSpy output showing that the properties were not properly renamed in the output assembly.</p>\n\n<p><img src=\"http://i.stack.imgur.com/GP5Pc.png\" alt=\"Screen shot of entity designer, error, and ILSpy output\"></p>\n\n<p>Is this a bug? Am I doing something wrong?</p>\n\n<hr>\n\n<p>Update: It seems the .tt files are not automatically firing and regenerating the entities when I make changes to the .edmx design. Not sure what I need to do to get them to run automatically when I save the edmx?</p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":141,"score":3,"question_id":12424917,"title":"Entity framework, automatically link to existing entity on insert","body":"<p>I'm not sure if this is possible but I am inserting a lot of entities into the database, and for each item it has say a language property which is an entity. Currently I create a new language object for each item that is being inserted but this is just for testing as it creates a lot of duplicates. The languages should be unique in the database and should just point to an existing language record, the only way I can think of is to do seperate service calls for every insert to lookup a language code and get the id of the existing language which is a lot of overhead.</p>\n\n<p>Is there a way for it to automatically lookup a record based on the language code and use that record?</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework","ado.net","transactions","transactionscope","msdtc"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1329,"score":1,"question_id":2026626,"title":"Does ADO Entity Framework support non DTC transactions? Multiple queries inside one EntityContext and one TransactionScope is causing DTC promotion","body":"<p>I have a web application that uses the Entity Framework - we make use of the TransactionScope class to provide ambient transactions.</p>\n\n<p>Is there any way to tell EF to use a standard T-SQL transaction in preference to DTC transaction?  Quite often we make a number of queries to different tables inside one EntityContext and one TransactionScope instance, however this seems to always promote the transaction to DTC</p>\n\n<p><strong>I have put a short example together, see below....\nThe query to the individual table correctly starts a T-SQL transaction and was on connection SPID 54\nThen the query to the ContactUs table is made and EF does this on a different connection (SPID 53) which has the knock on effect of promoting the transaction to a DTC transaction.</strong></p>\n\n<pre><code>using (MyEntities DB = new MyEntities())\n{\n    using (TransactionScope t = new TransactionScope())\n    {\n        DB.Individual.First().EmailAddress = \"bob\" + DateTime.Now.Second.ToString() + \"@bob.com\"; // done on connection 54\n        DB.ContactUs.First(); // done on connection 53 thus promoting the transaction!!\n        DB.SaveChanges();\n        t.Complete();\n    }\n}\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12620404,"title":"Save data to database using Entity Framework and return newly inserted Id","body":"<p>I have a simple method where I save the given customer information into the database using entity Framework:</p>\n\n<pre><code>    public Customer AddCustomer(Customer customer)\n    {\n        using (var context = DataObjectFactory.CreateContext())\n        {\n            context.AddObject(\"CustomerEntities\", Mapper.Map(customer));\n\n            context.SaveChanges();\n\n            return customer;\n        }\n    }\n</code></pre>\n\n<p>Customer type is very simple, it consists of Id, and Name of the customer, so when we want to save a customer I simply pass a customer object to AddCustomer method, at this point the Id is null and the Name field contains the name I want save to the database. </p>\n\n<p>This works fine, the name gets inserted into the database, however what I want to do is to get the saved customer Id back and return to the calling function, is there anyway of achieving this?</p>\n\n<p>EDIT:</p>\n\n<p>This is the Mapper method used:</p>\n\n<pre><code>internal static class Mapper\n{\n    internal static IList&lt;Customer&gt; Map(IEnumerable&lt;CustomerEntity&gt; entity)\n    {\n        return entity.Select(Map).ToList();\n    }\n\n    internal static Customer Map(CustomerEntity entity)\n    {\n        return new Customer\n        {\n            CustomerId = entity.CustomerId,\n            Name = entity.Name\n        };\n    }\n\n    internal static CustomerEntity Map(Customer customer)\n    {\n        return new CustomerEntity\n        {\n            CustomerId = customer.CustomerId,\n            Name = customer.Name\n        };\n    }\n}\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["asp.net-mvc","entity-framework","razor","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12620100,"title":"MVC MultiSelect modelbinding","body":"<p>i want to be able to display and update my User's Organisations preferably using the htmlhelper Html.TextBoxFor(</p>\n\n<p>I have an entityframework 5 database first database with relationships defined as expected on the 3 tables \nUser\nOrganisation\nUserOrganisation</p>\n\n<p>which yield the classes below</p>\n\n<pre><code>public partial class User\n{\n    public System.Guid UserId { get; set; }\n    public string Fullname { get; set; }\n    ...\n}\npublic partial class Organisation\n{\n    public int OrganisationID { get; set; }\n    public string Title { get; set; }\n    ...\n}\npublic partial class UserOrganisation\n{\n    public System.Guid UserId { get; set; }\n    public int OrganisationID { get; set; }\n}\n</code></pre>\n\n<p>I pass in the user as the model and also populate a list of potential organisations in the viewbag i.e.</p>\n\n<pre><code>ViewBag.PossibleOrganisations = OrganisationFactories.GetOrganisations()\n</code></pre>\n\n<p>and the razor markup is.\n      @Html.ListBoxFor(model => model.UserOrganisations,\n                new MultiSelectList(ViewBag.PossibleOrganisations,\"OrganisationID\",\"Title\"))</p>\n\n<p>Now this displays the list of Organisations correctly and i can multiselect them. But it doesn't show the selected Organisations, and it also wont write this back to the database when posting back (incidentally all other fields did write back prior to this change).</p>\n\n<p>Does anyone have any suggestions or examples of a multiselect list working in this fashion?</p>\n\n<p>Cheers\nTim</p>\n"},{"tags":["entity-framework","database-design","entity-framework-4","database-schema"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":230,"score":2,"question_id":4844800,"title":"Relate a Notes table to multiple Entity tables using Entity Framework 4","body":"<p>Im after some advice on database/entity design (Im using the model designer for Entity Framework 4).  </p>\n\n<p>I have a number of entities (<code>Entity_1</code>, <code>Entity_2</code>, <code>Entity_3</code>   <code>Entity_n</code>) Id like to be able to attach notes to each entity where each record in <code>Entity_1</code> can have 0 or multiple notes, like wise for <code>Entity_2</code> etc. </p>\n\n<p>After some Googling and messing around Ive come up with the following, but Im getting my <code>01s</code>,<code>1-1s</code> and <code>*-*s</code> all confused now and could do with a reality check :) so Id like to know Stack Overflows suggestions on the best way to architect this scenario for maintainability and ease of programing against.</p>\n\n<p>I found 2 SO questions that are related but opinion seems divided, Id also like to get opinions in the context of using EF4 once the database is created.</p>\n\n<p>/questions/3738344/associating-notes-with-different-entities-in-a-database</p>\n\n<p>/questions/3584517/best-way-to-implement-a-notes-table-for-many-entities-tables-in-sql </p>\n\n<h2>Option 1</h2>\n\n<p><img src=\"http://i.stack.imgur.com/Si7qK.png\" alt=\"Option 1\"></p>\n\n<h2>Option 2</h2>\n\n<p><img src=\"http://i.stack.imgur.com/C105j.png\" alt=\"enter image description here\"></p>\n\n<h2>Option 3</h2>\n\n<p>Every record has a globally unique Id and that Id links to a Note.</p>\n\n<p>What are your thoughts?</p>\n\n<p>Cheers\nSi</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12619578,"title":"How to reduce my code length without changing concept?","body":"<p>can Any one hep me on this. There are three servers. I want to assign a job to a server which has least Notstarted jobs. we want to consider the started jobs and not started jobs. ihave achieved this. But my code is very lengthy. I dont know how to minimize my code without changing my concept. Here is my code:</p>\n\n<pre><code>    public List&lt;int&gt; GetPaServer()\n    {\n        List&lt;int&gt; PaServers = new List&lt;int&gt;();\n        using (PaEntities pa = new PaEntities())\n        {\n            var PaServer = from server in pa.AppPM_Pa_Server\n                              where server.IsActive == true\n                              select server.ServerId;\n            foreach (var paServer in PaServer)\n            {\n                PaServers.Add(paServer);\n            }\n        }\n        return PaServers;\n    }\n\n\n    //Method to get the serverid for each request.\n    public int GetPaQueue()\n    {\n        using (PaEntities server = new PaEntities())\n        {\n            List&lt;int&gt; Paserver = new List&lt;int&gt;();\n            Paserver = GetPaServer();\n            string server1 = string.Empty;\n            string server2 = string.Empty;\n            string server3 = string.Empty;\n            foreach (int paserver in Paserver)\n            {\n                if (paserver == 1)\n                {\n                    server1 = \"active\";\n                }\n                else if (paserver == 2)\n                {\n                    server2 = \"active\";\n                }\n                else if (paserver == 3)\n                {\n                    server3 = \"active\";\n                }\n            }\n            int retVal = 0;\n\n            // Get the Server NotStarted details here\n            var NotStarted1 = (from serverID in server.AppPM_Pat\n                               where serverID.Status == \"NotStarted\" &amp;&amp; serverID.ServerId == 1\n                               select serverID.ServerId).Count();\n            var NotStarted2 = (from serverID in server.AppPM_Pat\n                               where serverID.Status == \"NotStarted\" &amp;&amp; serverID.ServerId == 2\n                               select serverID.ServerId).Count();\n            var NotStarted3 = (from serverID in server.AppPM_Pat\n                               where serverID.Status == \"NotStarted\" &amp;&amp; serverID.ServerId == 3\n                               select serverID.ServerId).Count();\n\n            // Get the  Server Started details here\n            var server_Started1 = (from serverID in server.AppPM_Pat\n                                   where serverID.Status == \"Started\" &amp;&amp; serverID.ServerId == 1\n                                   select serverID.ServerId).Count();\n            var server_Started2 = (from serverID in server.AppPM_Pat\n                                   where serverID.Status == \"Started\" &amp;&amp; serverID.ServerId == 2\n                                   select serverID.ServerId).Count();\n            var server_Started3 = (from serverID in server.AppPM_Pat\n                                   where serverID.Status == \"Started\" &amp;&amp; serverID.ServerId == 3\n                                   select serverID.ServerId).Count();\n\n            //Get the server number for each  request\n            //control comes here only when the server is active \n            if (server1 == \"active\" &amp;&amp; server2 == \"active\" &amp;&amp; server3 == \"active\")\n            {\n                if (NotStarted1 == 0 &amp;&amp; NotStarted2 == 0 &amp;&amp; NotStarted3 == 0)\n                {\n                    if ((server_Started1 &gt; server_Started2) &amp;&amp; (server_Started1 &gt; server_Started3))\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started1 == 0 &amp;&amp; server_Started2 == 0 &amp;&amp; server_Started3 == 0)\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == 1 &amp;&amp; server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                    else if ((server_Started2 &gt; server_Started1) &amp;&amp; (server_Started2 &gt; server_Started3))\n                    {\n                        retVal = 1;\n                    }\n                    else if ((server_Started3 &gt; server_Started1) &amp;&amp; (server_Started3 &gt; server_Started2))\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == server_Started2 &amp;&amp; server_Started3 == 0)\n                    {\n                        retVal = 3;\n                    }\n                    else if (server_Started1 == server_Started3 &amp;&amp; server_Started2 == 0)\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started2 == server_Started3 &amp;&amp; server_Started1 == 0)\n                    {\n                        retVal = 1;\n                    }\n                }\n                //control comes here only when the third server is active after some time\n                else if (NotStarted1 == NotStarted2 &amp;&amp; NotStarted3 == 0)\n                {\n                    if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 0)\n                    {\n                        retVal = 3;\n                    }\n                    else if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 1)\n                    {\n                        retVal = 3;\n                    }\n                }\n                else if ((NotStarted1 &gt; NotStarted2) &amp;&amp; NotStarted3 == 0)\n                {\n                    if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 0)\n                    {\n                        retVal = 3;\n                    }\n                    else if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 1)\n                    {\n                        retVal = 3;\n                    }\n                }\n                else if ((NotStarted2 &gt; NotStarted1) &amp;&amp; NotStarted3 == 0)\n                {\n                    if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 0)\n                    {\n                        retVal = 3;\n                    }\n                    else if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 1)\n                    {\n                        retVal = 3;\n                    }\n                }\n                //control comes here only when the first server is active after some time\n                else if (NotStarted2 == NotStarted3 &amp;&amp; NotStarted1 == 0)\n                {\n                    if (server_Started3 == 1 &amp; server_Started2 == 1 &amp; server_Started1 == 0)\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                }\n                else if ((NotStarted2 &gt; NotStarted3) &amp;&amp; NotStarted1 == 0)\n                {\n                    if (server_Started3 == 1 &amp; server_Started2 == 1 &amp; server_Started1 == 0)\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                }\n                else if ((NotStarted3 &gt; NotStarted2) &amp;&amp; NotStarted1 == 0)\n                {\n                    if (server_Started3 == 1 &amp; server_Started2 == 1 &amp; server_Started1 == 0)\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                }\n                //control comes here only when the second server is active after some time\n                else if (NotStarted3 == NotStarted1 &amp;&amp; NotStarted2 == 0)\n                {\n                    if (server_Started3 == 1 &amp; server_Started1 == 1 &amp; server_Started2 == 0)\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 1)\n                    {\n                        retVal = 2;\n                    }\n                }\n                else if ((NotStarted3 &gt; NotStarted1) &amp;&amp; NotStarted2 == 0)\n                {\n                    if (server_Started3 == 1 &amp; server_Started1 == 1 &amp; server_Started2 == 0)\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 1)\n                    {\n                        retVal = 2;\n                    }\n                }\n                else if ((NotStarted1 &gt; NotStarted3) &amp;&amp; NotStarted2 == 0)\n                {\n                    if (server_Started3 == 1 &amp; server_Started1 == 1 &amp; server_Started2 == 0)\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started1 == 1 &amp; server_Started2 == 1 &amp; server_Started3 == 1)\n                    {\n                        retVal = 2;\n                    }\n                }\n                else if (NotStarted1 == 1 &amp;&amp; NotStarted2 == 0 &amp;&amp; NotStarted3 == 0)\n                {\n                    if ((server_Started1 &gt; server_Started2) &amp;&amp; (server_Started1 &gt; server_Started3))\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started1 == 0 &amp;&amp; server_Started2 == 0 &amp;&amp; server_Started3 == 0)\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == 1 &amp;&amp; server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                    else if ((server_Started2 &gt; server_Started1) &amp;&amp; (server_Started2 &gt; server_Started3))\n                    {\n                        retVal = 1;\n                    }\n                    else if ((server_Started3 &gt; server_Started1) &amp;&amp; (server_Started3 &gt; server_Started2))\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == server_Started2 &amp;&amp; server_Started3 == 0)\n                    {\n                        retVal = 3;\n                    }\n                    else if (server_Started1 == server_Started3 &amp;&amp; server_Started2 == 0)\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started2 == server_Started3 &amp;&amp; server_Started1 == 0)\n                    {\n                        retVal = 1;\n                    }\n                }\n                else if (NotStarted1 == 1 &amp;&amp; NotStarted2 == 1 &amp;&amp; NotStarted3 == 0)\n                {\n                    if ((server_Started1 &gt; server_Started2) &amp;&amp; (server_Started1 &gt; server_Started3))\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started1 == 0 &amp;&amp; server_Started2 == 0 &amp;&amp; server_Started3 == 0)\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == 1 &amp;&amp; server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                    else if ((server_Started2 &gt; server_Started1) &amp;&amp; (server_Started2 &gt; server_Started3))\n                    {\n                        retVal = 1;\n                    }\n                    else if ((server_Started3 &gt; server_Started1) &amp;&amp; (server_Started3 &gt; server_Started2))\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == server_Started2 &amp;&amp; server_Started3 == 0)\n                    {\n                        retVal = 3;\n                    }\n                    else if (server_Started1 == server_Started3 &amp;&amp; server_Started2 == 0)\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started2 == server_Started3 &amp;&amp; server_Started1 == 0)\n                    {\n                        retVal = 1;\n                    }\n                }\n                else if (NotStarted1 &gt; NotStarted2 &amp;&amp; NotStarted1 &gt; NotStarted3)\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        if (NotStarted2 &gt; NotStarted3)\n                        {\n                            retVal = 3;\n                        }\n                        else\n                        {\n                            retVal = 2;\n                        }\n                    }\n                }\n                else if (NotStarted2 &gt; NotStarted3 &amp;&amp; NotStarted2 &gt; NotStarted1)\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        if (NotStarted1 &gt; NotStarted3)\n                        {\n                            retVal = 3;\n                        }\n                        else\n                        {\n                            retVal = 1;\n                        }\n                    }\n                }\n                else if (NotStarted3 &gt; NotStarted1 &amp;&amp; NotStarted3 &gt; NotStarted2)\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        if (NotStarted1 &gt; NotStarted2)\n                        {\n                            retVal = 2;\n                        }\n                        else\n                        {\n                            retVal = 1;\n                        }\n                    }\n                }\n                else if (NotStarted1 == NotStarted2 &amp;&amp; NotStarted2 == NotStarted3 &amp;&amp; NotStarted1 == NotStarted3)\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                }\n                else if (NotStarted1 == NotStarted2 &amp;&amp; NotStarted1 &gt; NotStarted3 &amp;&amp; NotStarted2 &gt; NotStarted3)\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 3;\n                    }\n                }\n                else if (NotStarted2 == NotStarted3 &amp;&amp; NotStarted2 &gt; NotStarted1 &amp;&amp; NotStarted3 &gt; NotStarted1)\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                }\n                else if (NotStarted1 == NotStarted3 &amp;&amp; NotStarted1 &gt; NotStarted2 &amp;&amp; NotStarted3 &gt; NotStarted2)\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 2;\n                    }\n                }                    \n            }\n            //control comes here only when server1 and server2 is active\n            else if (server1 == \"active\" &amp;&amp; server2 == \"active\")\n            {\n                if (NotStarted1 &gt; NotStarted2)\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started2 == 1)\n                    {\n                        retVal = 2;\n                    }\n                }\n                else if (NotStarted1 == NotStarted2)\n                {\n                    if (server_Started1 == 0 &amp;&amp; server_Started2 == 0)\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == 1 &amp;&amp; server_Started2 == 0)\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started1 == 0 &amp;&amp; server_Started2 == 1)\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == 1 &amp;&amp; server_Started2 == 1)\n                    {\n                        retVal = 1;\n                    }\n                }\n                else\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started2 == 1)\n                    {\n                        retVal = 1;\n                    }\n                }\n            }\n            //control comes here only when server3 and server2 is active\n            else if (server2 == \"active\" &amp;&amp; server3 == \"active\")\n            {\n                if (NotStarted2 &gt; NotStarted3)\n                {\n                    if (server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 3;\n                    }\n                }\n                else if (NotStarted2 == NotStarted3)\n                {\n                    if (server_Started2 == 0 &amp;&amp; server_Started3 == 0)\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started2 == 1 &amp;&amp; server_Started3 == 0)\n                    {\n                        retVal = 3;\n                    }\n                    else if (server_Started2 == 0 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 2;\n                    }\n                    else if (server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 2;\n                    }\n                }\n                else\n                {\n                    if (server_Started2 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 2;\n                    }\n                }\n            }\n            //control comes here only when server1 and server3 is active\n            else if (server1 == \"active\" &amp;&amp; server3 == \"active\")\n            {\n                if (NotStarted1 &gt; NotStarted3)\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 3;\n                    }\n                }\n                else if (NotStarted1 == NotStarted3)\n                {\n                    if (server_Started1 == 0 &amp;&amp; server_Started3 == 0)\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == 1 &amp;&amp; server_Started3 == 0)\n                    {\n                        retVal = 3;\n                    }\n                    else if (server_Started1 == 0 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                    else if (server_Started1 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                }\n                else\n                {\n                    if (server_Started1 == 1 &amp;&amp; server_Started3 == 1)\n                    {\n                        retVal = 1;\n                    }\n                }\n            }\n            return retVal;\n        }\n    }\n</code></pre>\n"},{"tags":["linq","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12618481,"title":"LINQ select a date range to join on other queries","body":"<p>I wish to create a LINQ query that will result in a resultset that contains a range of dates. I want to give it 2012-09-01 and 2012-09-05 and it should return a resultset containing:</p>\n\n<ul>\n<li>2012-09-01</li>\n<li>2012-09-02</li>\n<li>2012-09-03</li>\n<li>2012-09-04</li>\n<li>2012-09-05</li>\n</ul>\n\n<p>I want this because I wish to use it in a join for subsequent queries, that may not contain all dates. However, I want the final result to contain all dates in the interval, regardless of whether any of the other queries returned any results.</p>\n\n<p>I use LINQ to Entities.</p>\n\n<p>As a real example, it could look something like this:</p>\n\n<pre><code>from p in projects\nwhere p.StartDate &gt; dateFrom &amp;&amp; p.StartDate &lt; dateTo\n// somehow 'select' every date between dateFrom and dateTo,\n// so you get one row in the resultset for each date in between.\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12619585,"title":"Entity Framework: prevent generation of foreign key constraints","body":"<p>Using code-first. Is there a way to prevent EF from creating foreign key constraints in the database?</p>\n\n<pre><code>alter table ... add constraint ... foreign key (...) references ... (...);\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1533,"score":2,"question_id":5529733,"title":"Entity framework 4 CRUD creating errors","body":"<p>I have 3 related tables in my database.</p>\n\n<p>Farm ----> FarmCrops &lt;----- Crops</p>\n\n<p>I'm trying to update the a farm entity with a collection of crops but am running into problems. I've been working on this with no success for hours now so any help would be greatly appreciated.</p>\n\n<p>The error I'm receiving is this:</p>\n\n<blockquote>\n  <p>The object cannot be attached because\n  it is already in the object context.\n  An object can only be reattached when\n  it is in an unchanged state.</p>\n</blockquote>\n\n<p>My update logic is as follows (my apologies for the large amount of code. I'd just like to be as clear as possible):</p>\n\n<pre><code>            bool isNew = false;\n            Farm farm;\n\n            // Insert or update logic.\n            if (viewModel.Farm.FarmId.Equals(Guid.Empty))\n            {\n                farm = new Farm\n                {\n                    FarmId = Guid.NewGuid(),\n                    RatingSum = 3,\n                    RatingVotes = 1\n                };\n                isNew = true;\n            }\n            else\n            {\n                farm = this.ReadWriteSession\n                       .Single&lt;Farm&gt;(x =&gt; x.FarmId == viewModel.Farm.FarmId);\n\n            }\n\n            // Edit/Add the properties.\n            farm.Name = viewModel.Farm.Name;\n            farm.Owner = viewModel.Farm.Owner;\n            farm.Address = viewModel.Farm.Address;\n            farm.City = viewModel.Farm.City;\n            farm.Zip = viewModel.Farm.Zip;\n            farm.WebAddress = viewModel.Farm.WebAddress;\n            farm.PhoneNumber = viewModel.Farm.PhoneNumber;\n            farm.Hostel = viewModel.Farm.Hostel;\n            farm.Details = viewModel.Farm.Details;\n            farm.Latitude = viewModel.Farm.Latitude;\n            farm.Longitude = viewModel.Farm.Longitude;\n            farm.Weather = viewModel.Farm.Weather;\n\n            // Add or update the crops.\n            string[] cropIds = Request.Form[\"crop-token-input\"].Split(',');\n            List&lt;Crop&gt; allCrops = this.ReadWriteSession.All&lt;Crop&gt;().ToList();\n\n            if (!isNew)\n            {\n                // Remove all previous crop/farm relationships.\n                farm.Crops.Clear();\n            }\n\n            // Loop through and add any crops.\n            foreach (Crop crop in allCrops)\n            {\n                foreach (string id in cropIds)\n                {\n                    Guid guid = Guid.Parse(id);\n                    if (crop.CropId == guid)\n                    {\n                        farm.Crops.Add(crop);\n                    }\n                }\n            }\n\n            if (isNew)\n            {\n                this.ReadWriteSession.Add&lt;Farm&gt;(farm);\n            }\n            else\n            {\n                this.ReadWriteSession.Update&lt;Farm&gt;(farm);\n            }\n            this.ReadWriteSession.CommitChanges();\n</code></pre>\n\n<p>My update code within the ReadWriteSession is simple enough (<code>GetSetName&lt;T&gt;</code> just returns the types name from it's PropertyInfo.):</p>\n\n<pre><code>    /// &lt;summary&gt;\n    /// Updates an instance of the specified type.\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"item\"&gt;The instance of the given type to add.&lt;/param&gt;\n    /// &lt;typeparam name=\"T\"&gt;The type of entity for which to provide the method.&lt;/typeparam&gt;\n    public void Update&lt;T&gt;(T item) where T : class, new()\n    {\n        this.context.AttachTo(this.GetSetName&lt;T&gt;(), item);\n        this.context.ObjectStateManager.ChangeObjectState(item, EntityState.Modified);\n    }\n</code></pre>\n"},{"tags":[".net","entity-framework"],"answer_count":3,"favorite_count":9,"up_vote_count":16,"down_vote_count":0,"view_count":8416,"score":16,"question_id":1715501,"title":"Is is possible to check if an object is already attached to a data context in Entity Framework?","body":"<p>I am getting the following error when trying to attach an object that is already attached to a given context via <code>context.AttachTo(...)</code>:</p>\n\n<blockquote>\n  <p>An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key.</p>\n</blockquote>\n\n<p>Is there a way of achieving something along the lines of:</p>\n\n<p><code>context.IsAttachedTo(...)</code></p>\n\n<p>Cheers!</p>\n\n<p><b>Edit:</b></p>\n\n<p>The extension method Jason outlined is close, but it doesn't work for my situation.</p>\n\n<p>I am trying to do some work using the method outlined in the answer to another question:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/1601350/how-do-i-delete-one-or-more-rows-from-my-table-using-linq-to-entities-without-r\">http://stackoverflow.com/questions/1601350/how-do-i-delete-one-or-more-rows-from-my-table-using-linq-to-entities-without-r</a></p>\n\n<p>My code looks a bit like this:</p>\n\n<pre><code>var user = new User() { Id = 1 };\ncontext.AttachTo(\"Users\", user);\ncomment.User = user;\ncontext.SaveChanges();\n</code></pre>\n\n<p>This works fine, except when I do something else for that user where I use the same method and try to attach a dummy <code>User</code> object. This fails because I have previously attached that dummy user object. How can I check for this?</p>\n"},{"tags":[".net","entity-framework",".net-4.0","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12618422,"title":"stackoverflow exception with extension methods","body":"<p>How can I add extension methods off the DbContext?</p>\n\n<p>This throws a stack overflow exception:</p>\n\n<pre><code>    public IQueryable&lt;T&gt; All&lt;T&gt;() where T : class, new()\n    {\n        return this.All&lt;T&gt;();\n    }\n</code></pre>\n\n<p>I am calling this using the code:</p>\n\n<pre><code>var u = UnitOfWork.All&lt;User&gt;().ToList();\n</code></pre>\n\n<p>Unit of work is:</p>\n\n<pre><code>    protected DBContext UnitOfWork = new DBContext ();\n</code></pre>\n\n<p>This also throws:</p>\n\n<pre><code>return this.All&lt;T&gt;().AsQueryable();\n</code></pre>\n\n<p>My Class:</p>\n\n<pre><code>public class DBContext : DbContext, ISession\n{\n\n    public DBContext ()\n        : this(\"name=myConnString\")\n    {\n\n    }\n\n    public SurventrixContext(string dbcontext)\n        : base(dbcontext)\n    {\n\n    }\n\n    #region mappings\n\n    private void UserMappings(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;User&gt;().ToTable(\"tUsers\");\n\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.UserID).HasColumnName(\"fU_UserID\")\n            .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.FirstName).HasColumnName(\"fU_First_Name\");\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.LastName).HasColumnName(\"fU_Last_Name\");\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.Login).HasColumnName(\"fU_Login\");\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.Password).HasColumnName(\"fU_Password\");\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.Email).HasColumnName(\"fU_Email\");\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.Tel).HasColumnName(\"fU_Tel\");\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.CreateDate).HasColumnName(\"fU_CreateDate\");\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.LastPasswordChangedDate).HasColumnName(\"fU_LastPasswordChangedDate\");\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.PasswordKey).HasColumnName(\"fU_PasswordKey\");\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.KeyExpiryDate).HasColumnName(\"fU_KeyExpiryDate\");\n        modelBuilder.Entity&lt;User&gt;().Property(x =&gt; x.ApiToken).HasColumnName(\"fU_ApiToken\");\n\n        modelBuilder.Entity&lt;User&gt;().HasKey(t =&gt; t.UserID)\n            .Property(x =&gt; x.UserID);\n    }\n\n    #endregion\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        UserMappings(modelBuilder);\n\n        base.OnModelCreating(modelBuilder);\n    }\n\n    public DbSet&lt;User&gt; User { get; set; }\n\n    public DbSet&lt;ReportCommit&gt; ReportCommit { get; set; }\n\n    public DbSet&lt;Organization&gt; Organization { get; set; }\n\n    public void CommitChanges()\n    {\n        this.SaveChanges();\n    }\n\n    public void Delete&lt;T&gt;(System.Linq.Expressions.Expression&lt;Func&lt;T, bool&gt;&gt; expression) where T : class, new()\n    {\n        this.Delete&lt;T&gt;(expression);\n    }\n\n    public void Delete&lt;T&gt;(T item) where T : class, new()\n    {\n        this.Delete&lt;T&gt;(item);\n    }\n\n    public void DeleteAll&lt;T&gt;() where T : class, new()\n    {\n        this.DeleteAll&lt;T&gt;();\n    }\n\n    public T Single&lt;T&gt;(System.Linq.Expressions.Expression&lt;Func&lt;T, bool&gt;&gt; expression) where T : class, new()\n    {\n        return this.Single&lt;T&gt;(expression);\n    }\n\n    public IQueryable&lt;T&gt; All&lt;T&gt;() where T : class, new()\n    {\n        return this.All&lt;T&gt;().AsQueryable();\n    }\n\n    public void Add&lt;T&gt;(T item) where T : class, new()\n    {\n        this.Add&lt;T&gt;(item);\n    }\n\n    public void Add&lt;T&gt;(IEnumerable&lt;T&gt; items) where T : class, new()\n    {\n        foreach (var item in items)\n        {\n            this.Add&lt;T&gt;(item);\n        }\n    }\n\n    public void Update&lt;T&gt;(T item) where T : class, new()\n    {\n        this.Update&lt;T&gt;(item);\n    }\n}\n</code></pre>\n"},{"tags":[".net","entity-framework","fluent-interface"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":12618091,"title":"EF 5 mapping relation mapping with fluent API","body":"<p>These are tables, the fields end with * are PK. In the <strong>Image</strong> table one of the <strong>HomeID</strong> or <strong>CarID</strong> must have the value and the other one is null. Similar to this in the <strong>Feature</strong>\nthey are 0 instead of null so can use it as a Key (<code>this.HasKey</code>). But When I tried to mapping the they cannot be found in the related record. For example <code>Home.Images</code> returns 0 record.</p>\n\n<pre>+---------------+ +-----------------+ +---------------+ +---------------+ +---------------+\n|Home           | |Car              | |Image          | |Feature        | |FeatureType    |\n|---------------| |-----------------| |---------------| |---------------| |---------------|\n|HomeID*        | |CarID*           | |ImageID*       | |FeatureTypeId* | |FeatureTypeId* |\n|Title          | |Brand            | |Name           | |HomeID*        | |Name           |\n|Description    | |Model            | |URL            | |CarID*         | |               |\n|Address        | |Year             | |HomeID(null)   | |               | |               |\n|               | |                 | |CarID (null)   | |               | |               |\n+---------------+ +-----------------+ +---------------+ +---------------+ +---------------+</pre>\n\n<p>These are the codes for my models and mapping.</p>\n\n<pre><code>    public class BaseModel\n    {\n        /// &lt;summary&gt;\n        /// Gets or sets Id\n        /// &lt;/summary&gt;\n        public int Id { get; set; }\n    }\n\n    public class Home : BaseModel\n    {\n        /*All direct fields*/\n\n        public List&lt;Image&gt; Images{get; set;}\n    }\n\n    internal class HomeMap : EntityTypeConfiguration&lt;Home&gt;\n    {\n        public HomeMap()\n        {\n            /* All direct mapping to Properties to ColumnsNames */\n\n            // I tried the following 2 lines \n\n            //this.HasOptional(p =&gt; p.Images).WithRequired().WillCascadeOnDelete(false);\n            //this.HasOptional(p =&gt; p.Images).WithMany().Map(m =&gt; m.MapKey(\"ImageId\")).WillCascadeOnDelete(false);\n        }\n     }\n\n    /* All the same definition and mapping for the others*/\n    /* ImageMap for the relation*/\n    /* Image model has a field type `Home` name **Home** */\n\n    internal class ImageMap: EntityTypeConfiguration&lt;Image&gt;\n    {\n        public ImageMap()\n        {\n            /* All direct mapping to Properties to ColumnsNames */\n            //Currently this is what I am using for the mapping\n            this.HasOptional(i =&gt; i.Home).WithMany(h =&gt; h.Images).HasForeignKey(i =&gt; i.HomeID).WillCascadeOnDelete(false);\n\n        }\n     }\n</code></pre>\n"},{"tags":["c#","performance","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12605647,"title":"EF code first iterates over all properties while creating object","body":"<p>I use EF Code First in my application and have the following class:</p>\n\n<pre><code>   [Table(\"TBL_XYZ\")]\n    public class XYZ\n    {\n        [Required]\n        public string PropA { get; set; }\n\n        [Required]\n        public int PropB  { get; set; }\n\n        public int FormulaA \n        {\n          get \n          {\n            return PropB *  Math.PI / 100;\n          }\n        }\n    }\n</code></pre>\n\n<p>This is how I get the data from the database:</p>\n\n<pre><code>var data = (from e in db.XYZ where e.PropB &lt; 100 select e).ToList();\n</code></pre>\n\n<p>After I added some more fields which do calculations and don't have a set accessor (like FormulaA), I realized a drop in performance when executing the above line.</p>\n\n<p>After some debugging I found out that EF iterates over all Properties.  It calls all get-functions of the properties, while creating the object, even if I don't access them.</p>\n\n<p>What is the purpose of this behaviour and is there a workaround. Does this maybe have something to do with keeping track of changes?\nIt is really convenient for me to have my formulas in the object itself, but right now it severely affects the performance.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":3550,"score":8,"question_id":1501616,"title":"Is the combination of ADO.NET Entity Framework and ASP.MVC wrong by any chance?","body":"<p>I have one solution with three projects. </p>\n\n<ol>\n<li>DomainModel (C# Library with ADO.NET Entity Framework)</li>\n<li>DomainModelTest (Unit Testing for Business Logic)</li>\n<li>WebApp (Using DomainModel)</li>\n</ol>\n\n<p>For some reason, I cannot even bring the view if I pass any of the objects in the DomainModel, not even simple.  I get the error below:</p>\n\n<p>Any ideas?</p>\n\n<blockquote>\n  <p>Compiler Error Message: CS0012: The\n  type\n  'System.Data.Objects.DataClasses.EntityObject'\n  is defined in an assembly that is not\n  referenced. You must add a reference\n  to assembly 'System.Data.Entity,\n  Version=3.5.0.0, Culture=neutral,\n  PublicKeyToken=b77a5c561934e089'.</p>\n  \n  <p>Source Error:</p>\n  \n  <p>Line 146:     Line 147:<br />\n  [System.Runtime.CompilerServices.CompilerGlobalScopeAttribute()]\n  Line 148:    public class\n  views_home_index_aspx :\n  System.Web.Mvc.ViewPage,\n  System.Web.SessionState.IRequiresSessionState,\n  System.Web.IHttpHandler { Line 149:<br />\n  Line 150:        private static bool\n  @__initialized;</p>\n</blockquote>\n\n<p>I thought this might be helpful, the actual error comes up on the Default.aspx file in the line pointed below:</p>\n\n<pre><code>public partial class _Default : Page\n{\n    public void Page_Load(object sender, System.EventArgs e)\n    {\n        // Change the current path so that the Routing handler can correctly interpret\n        // the request, then restore the original path so that the OutputCache module\n        // can correctly process the response (if caching is enabled).\n\n        string originalPath = Request.Path;\n        HttpContext.Current.RewritePath(Request.ApplicationPath, false);\n        IHttpHandler httpHandler = new MvcHttpHandler();\n        httpHandler.ProcessRequest(HttpContext.Current); //**HERE**\n        HttpContext.Current.RewritePath(originalPath, false);\n    }\n}\n</code></pre>\n"},{"tags":["entity-framework","code-first","entity-framework-4.1"],"answer_count":4,"favorite_count":1,"up_vote_count":13,"down_vote_count":0,"view_count":8109,"score":13,"question_id":5634392,"title":"EF 4.1 Code First error - The entity type SomeType is not part of the model for the current context","body":"<p>While working with EF code first I get error given below at different times:</p>\n\n<p><em>The entity type SomeType is not part of the model for the current context.</em></p>\n\n<p>What are the possible causes of this error?</p>\n"},{"tags":[".net","asp.net-mvc","asp.net-mvc-3","entity-framework","c#-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12603280,"title":"Entity Framework CodeFirst Move Data From One table To another","body":"<p>I'm using EF Code First 4.3 For My Asp.Net Mvc3 Application . Now I have the following situation:Data of table A must be copied (along with some other data) to table B and table A Data Will be Removed when Click Save Button  how to implement this?</p>\n"},{"tags":["linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12613529,"title":"LINQ to Entities method 'System.String ToString Error","body":"<p>I need to combine 2 fields into 1 field. Name and Price.\nHowever, I am getting a LINQ error</p>\n\n<p><em>LINQ to Entities does not recognize the method 'System.String ToString</em></p>\n\n<p>Here is my linq statement.</p>\n\n<pre><code>        var results = ctx.Plans.Select(p =&gt; new PlansView\n        {\n            PlanID = p.planID,\n            PlanActive = p.planActive,\n            PlanCost = p.planCost,\n            PlanName = p.planName,\n            PlanNameAndCost = p.planName + \" \" + Convert.ToString(p.planCost)\n        }).OrderBy(p =&gt; p.planName).ToList();\n</code></pre>\n\n<p><strong>PlanNameAndCost = p.planName + \" \" + Convert.ToString(p.planCost)</strong> is causing the error.\nI understand that SQL does not have a ToString, \nbut how can I get this to work?</p>\n"},{"tags":["entity-framework","stored-procedures","dapper"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12611059,"title":"Entity Framework vs Dapper and support for stored procedure","body":"<p>I've read that there is a performance hit when using Entity Framework compared to the lighter Dapper. </p>\n\n<p>When comparing the two when it comes to stored procedures is there much of a difference? </p>\n\n<p>If there is a difference is it a significant enough difference to move away from one or the other?</p>\n"},{"tags":["c#","mysql","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":12613397,"title":"Object must implement IConvertible","body":"<blockquote>\n  <p>Description: An unhandled exception occurred during the execution of\n  the current web request. Please review the stack trace for more\n  information about the error and where it originated in the code. </p>\n  \n  <p>Exception Details: System.InvalidCastException: Object must implement\n  IConvertible.</p>\n</blockquote>\n\n<p>Source Error: </p>\n\n<pre><code>Line 20:         public ActionResult Index()\nLine 21:         {\nLine 22:             var feeds = (from f in _db.AlertRules.Include(\"AlertRuleOutages\")\nLine 23:                          select f).ToList();\nLine 24: \n</code></pre>\n\n<p>Stack Trace: </p>\n\n<pre><code>[InvalidCastException: Object must implement IConvertible.]\n   System.Convert.ChangeType(Object value, Type conversionType, IFormatProvider provider) +9508841\n   MySql.Data.Entity.EFMySqlDataReader.ChangeType(Object sourceValue, Type targetType) +376\n   MySql.Data.Entity.EFMySqlDataReader.GetValue(Int32 ordinal) +129\n   System.Data.Common.Internal.Materialization.ErrorHandlingValueReader`1.GetValue(DbDataReader reader, Int32 ordinal) +215\n   lambda_method(Closure , Shaper ) +468\n   System.Data.Common.Internal.Materialization.Shaper.HandleEntityAppendOnly(Func`2 constructEntityDelegate, EntityKey entityKey, EntitySet entitySet) +218\n   lambda_method(Closure , Shaper ) +218\n   System.Data.Common.Internal.Materialization.Coordinator`1.ReadNextElement(Shaper shaper) +170\n   System.Data.Common.Internal.Materialization.RowNestedResultEnumerator.MoveNext() +235\n   System.Data.Common.Internal.Materialization.ObjectQueryNestedEnumerator.TryReadToNextElement() +16\n   System.Data.Common.Internal.Materialization.ObjectQueryNestedEnumerator.MoveNext() +57\n   System.Collections.Generic.List`1..ctor(IEnumerable`1 collection) +327\n   System.Linq.Enumerable.ToList(IEnumerable`1 source) +58\n</code></pre>\n\n<p>DataBase DDL:</p>\n\n<pre><code>CREATE TABLE alertruleoutage\n(\nId        INT NOT NULL auto_increment,\nRuleId    INT NOT NULL,\nStartTime TIME NULL DEFAULT 00:00:00,\nEndTime   TIME NULL DEFAULT 23:59:59,\nWeekDays  TINYINT NULL,\nCount     INT NULL,\nTimeFrame TIME NULL DEFAULT 01:00:00,\nPRIMARY KEY (Id),\nKEY RuleId (RuleId),\nCONSTRAINT RuleId FOREIGN KEY (RuleId) REFERENCES alertrule (Id)\n);\n\n\n\nCREATE TABLE alertrule\n    (\n    Id             INT NOT NULL auto_increment,\n    FeedId         INT NOT NULL,\n    TemplateId     INT NOT NULL,\n    Enable         BIT (1) NULL DEFAULT b'1',\n    `Rule`         VARCHAR (250) NULL,\n    UpdateDateTime TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,\n    PRIMARY KEY (Id),\n    KEY AlertFeedId (FeedId),\n    KEY AlertTemplateId (TemplateId),\n    CONSTRAINT FK_AlertFeedId FOREIGN KEY (FeedId) REFERENCES feed (Id),\n    CONSTRAINT FK_AlertTemplateId FOREIGN KEY (TemplateId) REFERENCES alertruletemplate (Id)\n    );\n</code></pre>\n\n<p>POCO Models:</p>\n\n<pre><code> [Table(\"AlertRuleOutage\")]\npublic class AlertRuleOutage\n{\n    [Key]\n    public int Id { get; set; }\n\n    public int RuleId { get; set; }\n\n    public DateTime? StartTime { get; set; }\n\n    public DateTime? EndTime { get; set; }\n\n    //public Week WeekDays { get; set; }\n\n    public int? Count { get; set; }\n\n    public DateTime? TimeFrame { get; set; }\n\n    public virtual AlertRule Rule { get; set; }\n}\n\n    [Table(\"AlertRule\")]\npublic class AlertRule\n{\n    [Key]\n    public int Id { get; set; }\n\n    public int FeedId { get; set; }\n\n    public int TemplateId { get; set; }\n\n    public bool? Enable { get; set; }\n\n    public string Rule { get; set; }\n\n    public DateTime? UpdateDateTime { get; set; }\n\n    public virtual Feed Feed { get; set; }\n\n    public virtual AlertRuleTemplate Template { get; set; }\n\n    public virtual List&lt;AlertRuleOutage&gt; AlertRuleOutages { get; set; }\n}\n</code></pre>\n\n<p>db context:</p>\n\n<pre><code>    public DbSet&lt;AlertRule&gt; AlertRules { get; set; }\n\n    public DbSet&lt;AlertRuleOutage&gt; AlertRuleOutages { get; set; }\n</code></pre>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12224205,"title":"How do I set a default date using code first entity framework","body":"<p>I am trying to set a default value for the last date (DateAdded) property using Entity Framework with code first methods. Here is my code:</p>\n\n<pre><code>namespace BackOffice.Models\n{\n    public class UsersContext : DbContext\n    {\n        public UsersContext()\n            //: base(\"DefaultConnection\")\n            : base(\"ProofPixDB\")\n        {\n        }\n\n        public DbSet&lt;UserProfile&gt; UserProfiles { get; set; }\n    }\n\n    [Table(\"UserProfile\")]\n    public class UserProfile\n    {\n        [Key]\n        [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n        public int UserId { get; set; }\n        public string UserName { get; set; }\n\n\n        //public DateTime DOB { get; set; }\n        [DataType(DataType.Date)]\n        public DateTime? DOB { get; set; } //This allows null\n\n        [Required]\n        [DataType(DataType.Date)]\n        public DateTime DateAdded { get; set; }\n\n    }\n}\n</code></pre>\n\n<p>Your help is appreciated. Thanks!</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12610883,"title":"Entity Framework One - Many relationship Save","body":"<p>I have the following:</p>\n\n<pre><code>    if (chemexist == false) // conditionally creating WtrChem record\n    {\n      WtrChem wc = new WtrChem();\n      wc.Contact = \"John Smith\";\n      ..\n      wc.Phone = (\"800-888-9988\");\n      Db.WtrChem.Add(wc);\n      Db.SaveChanges();\n    }\n\n\n    WtrChemDetail psw = new WtrChemDetail (); // creating details record for WtrChem\n    psw.Comments = comment;\n    ..\n    .. \n    Db.WtrChemDetail.Add(psw);\n    Db.SaveChanges();\n</code></pre>\n\n<p>The code will first create the master record and then create a detail record. What I have works. I am wondering if there is a more efficient way to doing what I have above in terms of best practices.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12611454,"title":"Where is the source code for entity framework 5","body":"<p>I know EF is open source on CodePlex, but I don't see the branch for the currently released 5.0 build.  Where can I get this source code?</p>\n"},{"tags":["mysql","entity-framework","devart","dotconnect"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12608868,"title":"The number of members in the conceptual type does not match","body":"<p>I am using entity framework code first with dotConnect for MySQL, and for some reason I get an error about one of my models mapping.</p>\n\n<p>I've searched this error and it is usually caused by bad xml file or entity framework specific files. I am not using any of these, only a .cs code file with the models.</p>\n\n<p>Exception Details: </p>\n\n<blockquote>\n  <p>System.Data.MappingException: The number of members in the conceptual\n  type 'SiteModels.TournamentTable' does not match with the number of\n  members on the object side type 'SiteModels.TournamentTable'. Make\n  sure the number of members are the same.</p>\n</blockquote>\n\n<p>I have no idea why I am getting this error, since I don't have any designer,\nonly one file containing the code.</p>\n\n<p><strong>Here is the problematic class:</strong></p>\n\n<pre><code>public class TournamentTable\n{\n    [Key]\n    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public int Id { get; set; }\n\npublic List&lt;TournamentColumn&gt; Columns { get; set; }\n\npublic TournamentTable()\n{\n    Columns = new List&lt;TournamentColumn&gt;();\n}\n\npublic void AddColumn(int index, TournamentColumn column)\n{\n    Columns.Insert(index, column);\n}\n\npublic void RemoveColumn(int index)\n{\n    Columns.RemoveAt(index);\n}\n\n/// &lt;summary&gt;\n/// Add a tournament cell at the top of the column.\n/// &lt;/summary&gt;\n/// &lt;param name=\"column\"&gt;&lt;/param&gt;\npublic void AddColumn(TournamentColumn column)\n{\n    Columns.Add(column);\n}\n\n/// &lt;summary&gt;\n/// Returns the tournament column at the index specified.\n/// &lt;/summary&gt;\n/// &lt;param name=\"index\"&gt;&lt;/param&gt;\n/// &lt;returns&gt;&lt;/returns&gt;\npublic TournamentColumn this[int index]\n{\n    get { return Columns[index]; }\n}\n\n/// &lt;summary&gt;\n/// Returns the tournament cell at the index specified.\n/// &lt;/summary&gt;\n/// &lt;param name=\"columnIndex\"&gt;&lt;/param&gt;\n/// &lt;param name=\"cellIndex\"&gt;&lt;/param&gt;\n/// &lt;returns&gt;&lt;/returns&gt;\npublic TournamentCell this[int columnIndex, int cellIndex]\n{\n    get { return Columns[columnIndex][cellIndex]; }\n    set\n    {\n\n        Columns[columnIndex][cellIndex] = value;\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>Context configuration:</p>\n\n<pre><code>public class EntitiesContext : DbContext\n{\n\n    public EntitiesContext()\n        : base()\n    {\n        System.Data.Entity.Database.SetInitializer&lt;EntitiesContext&gt;(new DropCreateDatabaseIfModelChanges&lt;EntitiesContext&gt;());\n    }\n\npublic EntitiesContext(DbConnection connection)\n    : base(connection, true)\n{\n}\n\nprotected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n    modelBuilder.Conventions\n      .Remove&lt;System.Data.Entity.ModelConfiguration.Conventions\n        .ColumnTypeCasingConvention&gt;();\n}\n\npublic DbSet&lt;User&gt; Users { get; set; }\npublic DbSet&lt;Player&gt; Players { get; set; }\npublic DbSet&lt;Game&gt; Games { get; set; }\npublic DbSet&lt;TournamentTable&gt; TournamentTables { get; set; }\n</code></pre>\n\n<p>}</p>\n\n<p>Thanks for the help, I don't have any clue.</p>\n"},{"tags":["entity-framework","visual-studio-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12604004,"title":"How to preserve non-nullable setting in edmx when refreshing model?","body":"<p>I have a project that I recently migrated from VS2010 to VS2012.</p>\n\n<p>It contains an EF4.1 edmx file containing my entities. A few of these entities are based on views and are read-only.  Although some columns returned by the views are nullable, I have changed the return value of these columns in the view to ensure that they do not return null by using</p>\n\n<pre><code>ISNULL(NumericColumnName, 0) AS NumericValueColumn\n</code></pre>\n\n<p>When updating the model via the \"Update Model From Database\" function in VS2010, the columns that were returned in this way were being created as non-nullable in my model. However, since the move to VS2012, this is no longer the case. </p>\n\n<p>Now, whenever I use the \"Update Model From Database\" functionality, these properties are generated as nullable. What I have to do is manually set the columns to non-nullable. However, the entity properties will be regenerated as nullable the next time that I run \"Update Model From Database\". I then have to update them to non-nullable again.</p>\n\n<p>Another work-around that I have tried is to move the view-based entities to their own edmx file. However, I am seeing the same behavior when updating <strong>either</strong> of the edmx files.</p>\n\n<p>Another detail is that I am using Self-Tracking Entities, generated via the EF4.1 T4 STE templates.</p>\n\n<p>Is there any way to prevent the VS2012's EF designer from overwriting my non-nullable attribute for the view-based entities?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>It turns out that the designer in VS2012 is trying to prevent you from shooting yourself in the foot, and consequently changes the member properties inside my entity.</p>\n\n<p>When generating a member from the following:</p>\n\n<pre><code>SELECT ISNULL(Quantity,0) * ISNULL(Number, 0) AS Total FROM SomeTable\n</code></pre>\n\n<p>VS2012 will always set the member Total on the SomeTable entity to nullable because it does not understand that there is no way for the result of the multiplication to be 0. To prevent this behavior, change it to:</p>\n\n<pre><code>SELECT ISNULL(Quantity * Number, 0) AS Total FROM SomeTable.\n</code></pre>\n\n<p>Watch out for aggregations as <code>ISNULL(SUM(SomeCol),0)</code> is not the same as <code>SUM(ISNULL(SomeCol,0))</code>.</p>\n"},{"tags":["linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":12610472,"title":"LINQ - join with OR condition","body":"<p>I've got two entities, Users and Friendships which look like:</p>\n\n<pre><code>    public class User\n    {\n        public int UserId { get; set; }\n        (...)\n    }\n\n    public class Friendship\n    {\n         public int SenderId { get; set; }\n         public int ReceiverId { get; set; }\n         (...)\n    }\n</code></pre>\n\n<p>And I would like to create simple query which in SQL would look like:</p>\n\n<pre><code>    SELECT * FROM Users as U\n    INNER JOIN Friendships as F ON U.UserId = F.ReceiverId OR U.UserId = F.SenderId\n    Where U.Nick != VARIABLE\n</code></pre>\n\n<p>In other words I would like to select all friends of the user.</p>\n\n<p>And I can't accomplish that. I've found solution where one creates two separate join queries with union and it works - but it's not efficient to create such query to db.</p>\n\n<p>Could anyone help me, please?\nThanks in advice.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12610524,"title":"entity framework plural table names","body":"<p>I am trying to get EF 5 to generate singular table names.  I have the following code in my DbContext...</p>\n\n<pre><code>public partial class LiveoModelContainer : DbContext\n{\n    protected override void OnModelCreating(System.Data.Entity.DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n\n        base.OnModelCreating(modelBuilder);\n    }\n}\n</code></pre>\n\n<p>We are using Model First, and have our own generated code to follow our internal development patterns.  So we are not using the out of the box code gen that comes with EF.  I have set pluralization to false in the edmx properties, in the Database Tools/O/R Designer, and removing the convention in the OnModelCreating above.  However, the table names remain plural.</p>\n\n<p>How do I fix this?</p>\n"},{"tags":["entity-framework","entity-relationship","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12581835,"title":"Map tables relationship from legacy database w/ entity framework with only primary keys","body":"<p><strong>data (table name)</strong></p>\n\n<p>dataid PK,</p>\n\n<p>value1,</p>\n\n<p>value2,</p>\n\n<p>value3</p>\n\n<p><strong>data_address (table name)</strong></p>\n\n<p>dataaddressid PK,</p>\n\n<p>dataid - id to errenddataid,</p>\n\n<p>addressid1 - id to en addressid,</p>\n\n<p>addressid2 - id to en addressid,</p>\n\n<p>type</p>\n\n<p><strong>address (table namne)</strong></p>\n\n<p>addressid PK - id to addressid1 or addressid2,</p>\n\n<p>address1,</p>\n\n<p>address2,</p>\n\n<p>name,</p>\n\n<p>zipcode,</p>\n\n<p>city</p>\n\n<p>I have a really hard time trying to map this relations using Entity Framework 5, if some one have an idea or good links I would much appreciate that!</p>\n"},{"tags":[".net","linq","entity-framework","express","code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12380326,"title":"Error when I want to change my mappings","body":"<pre><code>public class MovieTotal:DbContext\n{\n    public DbSet&lt;Movie&gt; Movies { get;set; }\n    public DbSet&lt;Person&gt; Persons { get; set;}\n\n    protected override void OnModelCreating(System.Data.Entity.ModelConfiguration.ModelBuilder modelBuilder)\n    {\n        Movie mov = new Movie();\n        modelBuilder.Entity&lt;Movie&gt;().Property(GetPropert(\"MovieName\")).HasColumnName(\"Actors\");\n    }\n\n    public System.Linq.Expressions.Expression&lt;Func&lt;Movie,string&gt;&gt; GetPropert(string  properName)\n    {\n        // Func&lt;Movie, string&gt; dele = \n        System.Linq.Expressions.Expression&lt;Func&lt;Movie, string&gt;&gt; exp = k =&gt; (string)(typeof(Movie).GetProperty(properName).GetValue(k, null));\n        return exp ;\n    }\n\n    public string GetColumnName(string value)\n    {\n        return \"Actors\";\n    }\n\n    public MovieTotal()\n    {   \n        this.Database.Connection.ConnectionString = @\"Data Source=(local);Initial Catalog=MovieTotal6;Integrated Security=SSPI;\";\n    }\n}\n</code></pre>\n\n<p>Here is the error message:</p>\n\n<blockquote>\n  <p>The expression 'k => Convert(Movie.GetProperty(value(MovieTotal+ &lt;>c__DisplayClass0).properName).GetValue(k, null))' is not a valid  property expression. It must be of the form 'e => e.Property[.Property]'. </p>\n</blockquote>\n"},{"tags":["c#",".net","entity-framework","serialization","xml-serialization"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":117,"score":3,"question_id":12604585,"title":"Using Serialization to copy entities between two ObjectContexts in Entity Framework","body":"<h2>Preface</h2>\n\n<p>I know this is probably already regarded as <a href=\"http://stackoverflow.com/q/6925028/1426433\"><strong>crazy question</strong></a>, but I am looking for the most educated advice and <strong>PROVEN</strong> recommendation on how to proceed with copying <strong>ALL</strong> data (i.e., all entities and relationships) from an <code>ObjectContext</code> to a newly created <code>ObjectContext</code> backed in a different store. <strong>See <a href=\"http://stackoverflow.com/q/12589017/1426433\">&quot;Cloning&quot; EntityConnections and ObjectContexts in Entity Framework</a> to check out how I'm setting this up.</strong></p>\n\n<hr>\n\n<h2>Intro</h2>\n\n<p><strong>I've seen <a href=\"http://stackoverflow.com/q/2185155/1426433\">Cloning data on Entity Framework</a>,</strong> but:</p>\n\n<ol>\n<li><p>I'm looking for <strong>the whole enchilada</strong>, i.e., the whole object graph: all entities &amp; relationships. Later on, I'll go for a more fined-grained selection of what parts of the object graph)</p></li>\n<li><p>As per my updates below, I haven't made serialization to work, but only on special cases. I feels like it really be a not-so-complex task, but it's been surprisingly challenging. I definitely need some insight on how to make it work.</p></li>\n</ol>\n\n<hr>\n\n<h2>Step 1</h2>\n\n<p>OK, this is what I've tried so far. </p>\n\n<p>I am aware that when I use the <code>Detach</code>/<code>Attach</code> power duo, relationships are kaput<strong>and I ACTUALLY want to preserve the whole object graph.</strong></p>\n\n<p>Therefore, I was thinking of loading the root entities with the <code>MergeOption.NoTracking</code> option:</p>\n\n<pre><code>var serializer = new DataContractSerializer(typeof(Root));\n\nvar query = (ObjectQuery&lt;Root&gt;) sourceContext.Roots\n    .Include(d =&gt; d.Children.Select(c =&gt; c.MoreChildren.Select(r =&gt; r.EvenMoreChildren)))\n    .Include(d =&gt; d.Children.Select(c =&gt; c.MoreChildren.Select(r =&gt; r.MoreAndMoreChildren)))\n    .Include(d =&gt; d.Children.Select(c =&gt; c.MoreChildren.Select(r =&gt; r.Shizzle)));\n\nforeach (var d in query.Execute(MergeOption.NoTracking)) {\n    //sourceContext.Detach(d); // not needed\n    Print(d);\n    using (var ios = new MemoryStream()) {\n        serializer.WriteObject(ios, d);\n        ios.Seek(0, SeekOrigin.Begin);\n        var dd = (Root) serializer.ReadObject(ios);\n        //Console.WriteLine(string.Join(\",\", dd.EntityKey.EntityKeyValues.Select(k =&gt; k.Key + \"=\" + k.Value)));\n        targetContext.Roots.AddObject(dd);\n    }\n}\n</code></pre>\n\n<p>Given that I am loading entities as non-tracked, the I don't need to call <code>sourceContext.Detach(d)</code> anymore.</p>\n\n<p>The <code>Print</code> method simply prints the child-object tree, and it shows that up to that point things are going well (I won't show it here cuz it's huge and irrelevant).</p>\n\n<p>However, now the whole thing is blowing @ <code>serializer.WriteObject(ios, d)</code> with the following message:</p>\n\n<p><strong>\"When an object is returned with a <code>NoTracking</code> merge option, Load can only be called when the <code>EntityCollection</code> or <code>EntityReference</code> does not contain objects.\"</strong></p>\n\n<p>(Which kinda makes sense, because the serializer is probably trying to lazy load related entities.)</p>\n\n<p>Remember, if I don't use <code>NoTracking</code>, I have to detach the entities but then I would lose my relationships...</p>\n\n<hr>\n\n<h2>Step 2</h2>\n\n<p>Of course I've tried setting <code>sourceContext.ContextOptions.LazyLoadingEnabled = false</code> just before executing the serializing loop, and that fixes the error above, but that results in the infamous:</p>\n\n<p><strong>\"The object could not be added or attached because its <code>EntityReference</code> has an <code>EntityKey</code> property value that does not match the <code>EntityKey</code> for this object.\"</strong></p>\n\n<p>Also, remember I still cannot uncomment the <code>sourceContext.Detach(d)</code> since I loaded the roots with <code>NoTracking</code>...</p>\n\n<hr>\n\n<h2>Step 3</h2>\n\n<p>I've tried setting the <code>EntityKey = null</code> before serialization and even after deserialization on the cloned entity... all to no avail:</p>\n\n<pre><code>sourceContext.ContextOptions.LazyLoadingEnabled = false;\n\nforeach (var d in query.Execute(MergeOption.NoTracking)) {\n    //sourceContext.Detach(d);\n    Print(d);\n    d.EntityKey = null;\n    using (var ios = new MemoryStream()) {\n        serializer.WriteObject(ios, d);\n        ios.Seek(0, SeekOrigin.Begin);\n        var dd = (Root) serializer.ReadObject(ios);\n        if (dd.EntityKey != null) {\n            Console.WriteLine(\"Deserialized EntityKey: {0}\", string.Join(\",\", dd.EntityKey.EntityKeyValues.Select(k =&gt; k.Key + \"=\" + k.Value)));\n            dd.EntityKey = null;\n        }\n        targetContext.Roots.AddObject(dd);\n    }\n}\n</code></pre>\n\n<p><strong>What's fishy is that I don't even know what bloody \"object\" is the exception above talking about.</strong></p>\n\n<p>Am I really, really, really, really DOOMED in my attempt to have a purely EF approach to solve this problem???</p>\n\n<p>Am I completely DOOMED?!?!?! :(</p>\n"},{"tags":["database","asp.net-mvc-3","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12606166,"title":"Database error InValidOperationException when attempting to save to database","body":"<p>I get this error when I attempt to save to the database.\nIn the Controller I have the Edit HttpPut </p>\n\n<pre><code> public ActionResult EditSubject(Models.xxxx model)\n {\n    //Database Model Class    \n    SubjectDB subjectdb = new SubjectDB();\n    // Name of DB Access in Web.config\n    BeaconDBEntities db = new BeaconDBEntities();\n\n\n    if (ModelState.IsValid)\n    {\n        subjectdb.SubjectId = model.SubjectId;\n\n        db.SubjectDBs.Add(subjectdb);   --&gt; Pops InvalidOperationsException\n        db.SaveChanges();\n    }\n</code></pre>\n\n<p>In Models folder is the model for the database table</p>\n\n<p>SubjectDB.cs</p>\n\n<pre><code>    namespace xxx.Models\n    {\n       public class SubjectDB\n       {\n          public string SubjectId { get; set;}\n       }\n       public class BeaconDBEntities: DbContext\n       {\n           public DbSet&lt;SubjectDB&gt; SubjectDBs { get; set; }\n       }\n    }\n</code></pre>\n\n<p>Web.config is the connect string for the database</p>\n\n<pre><code>    &lt;coneectionStrings&gt;\n       &lt;add name=\"BeaconDBEntities\" ...............\n    &lt;/connectionStrings&gt;\n</code></pre>\n"},{"tags":["wcf","entity-framework","poco"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12591430,"title":"Entity Framework with WCF POCOs Referential Integrity Issue","body":"<p>I have a fairly simple scenario where I can't seem to get the correct logic.  I am using a WCF Service with POCOs to read and write data to a database.  I have a keywords table that has a foreign key UserID linked to a UserProfile table.  I am adding and modifying the keywords collection but when I try to include the UserProfile in the GetKeywords method and then make some changes and call the StoreKeywords method I get Referential Integrity issues.  If I don't include the UserProfiles I can add and update no problem. I used the POCO generator with WCF support and modified the T4 to remove virtual and use the FixupCollections.</p>\n\n<p>Any help would be much appreciated.  Thanks in advance.</p>\n\n<p>GetKeywords service:</p>\n\n<pre><code>    public class Service : IService\n    {\n    public List&lt;Keyword&gt; GetKeywords()\n    {\n        var context = new myDBEntities();\n\n        var query = from c in context.Keywords\n                        .Include(\"UserProfile\")\n                    select c;\n\n        //var query = from c in context.Keywords.Take(100)\n        //            select c;\n\n        return query.ToList();\n\n    }\n</code></pre>\n\n<p>Client Code that calls GetKeywords makes some changes and then calls StoreKeywords:</p>\n\n<pre><code>    public partial class MainWindow : Window\n{\n    ObservableCollection&lt;Keyword&gt; keylist;\n    public MainWindow()\n    {\n        InitializeComponent();\n        PopulateGrid();\n    }\n\n    private void button1_Click(object sender, RoutedEventArgs e)\n    {\n        myServiceClient client = new myServiceClient();\n\n        List&lt;Keyword&gt; updates = new List&lt;Keyword&gt;();\n\n        foreach (Keyword keyword in keylist)\n        {\n            if (keyword.State == State.Added)\n            {\n                keyword.CreationDate = DateTime.Now;\n                updates.Add(keyword);\n            }\n\n            if (keyword.State == State.Modified)\n            {\n                keyword.EditDate = DateTime.Now;\n                if (keyword.IsVoid == false) keyword.VoidDate = null;\n                if (keyword.IsVoid == true) keyword.VoidDate = DateTime.Now;\n                updates.Add(keyword);\n            }\n        }\n\n        client.StoreKeywords(updates.ToArray());\n\n        foreach (var kw in keylist)\n        {\n            kw.State = State.Unchanged;\n        }\n\n        PopulateGrid();\n        gridControl1.RefreshData();\n    }\n\n    private void PopulateGrid()\n    {\n        myServiceClient client = new myServiceClient();\n\n        keylist = new ObservableCollection&lt;Keyword&gt;(client.GetKeywords());\n\n        gridControl1.ItemsSource = keylist;\n\n    }\n</code></pre>\n\n<p>StoreKeywords service:</p>\n\n<pre><code>public string StoreKeywords(List&lt;Keyword&gt; keywords)\n    {\n        try\n        {\n            using (var context = new myDBEntities())\n            {\n                context.ContextOptions.LazyLoadingEnabled = false;\n\n                foreach (Keyword kw in keywords)\n                {\n\n                        context.Keywords.Attach(kw);\n                        context.ObjectStateManager.ChangeObjectState(kw, StateHelpers.GetEquivalentEntityState(kw.State));\n\n                }\n                context.SaveChanges();\n                return \"\";\n            }\n        }\n        catch (Exception ex)\n        {\n\n            return ex.Message;\n        }\n\n    }\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12597221,"title":"Using Linq, get all items from list that are in another List<int>","body":"<p>I have the following scenario:\na list of int: <code>List&lt;int&gt; idsOnly = new List&lt;int&gt;();</code>\nand another list of object that should bring all items that their ids matching the list idsOnly</p>\n\n<pre><code>var myList = db.Items.Where(item =&gt; idsOnly.Contains(item.ID.Value))\n                     .Select(a =&gt; new { a.Title })\n                     .ToList();\n</code></pre>\n\n<p>I only need to get the titles from the myList</p>\n\n<p>Any help will be appreciated</p>\n"},{"tags":["c#",".net","entity-framework",".net-4.5","entity-framework-5"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":122,"score":5,"question_id":12589017,"title":"\"Cloning\" EntityConnections and ObjectContexts in Entity Framework","body":"<p>(This used to be a 2-part question, but since the second part is literally the important one, I decided to split this into two separate posts. <strong>See <a href=\"http://stackoverflow.com/q/12604585/1426433\">Using Serialization to copy entities between two ObjectContexts in Entity Framework</a> for the second part.</strong></p>\n\n<p>I want to create a fairly generic \"cloner\" of databases for my entity model. Also, I might need to support different providers and such. I'm using <code>ObjectContext</code> API.</p>\n\n<p>I am aware of <a href=\"http://stackoverflow.com/a/6003101/1426433\">this question already</a> and the <a href=\"http://msdn.microsoft.com/en-us/library/system.data.entityclient.entityconnectionstringbuilder.aspx\" rel=\"nofollow\">EntityConnectionStringBuilder MDSN documentation</a> example, but I need to know if there is a programmatic way to obtain the values to initialize the <code>Provider</code> and <code>Metadata</code> properties of an <code>EntityConnectionStringBuilder</code>?</p>\n\n<pre><code>using (var sourceContext = new EntityContext()) {\n    var sourceConnection = (EntityConnection) sourceContext.Connection;\n    var targetConnectionBuilder = new EntityConnectionStringBuilder();\n\n    targetConnectionBuilder.ProviderConnectionString = GetTargetConnectionString();\n    targetConnectionBuilder.Provider = \"System.Data.SqlClient\"; // want code\n    targetConnectionBuilder.Metadata = \"res://*/EntityModel.csdl|res://*/EntityModel.ssdl|res://*/EntityModel.msl\"; // want code\n\n    using (var targetContext = new EntityContext(targetConnectionBuilder.ConnectionString)) {\n        if (!targetContext.DatabaseExists())\n            targetContext.CreateDatabase();\n\n        // how to copy all data from the source DB to the target DB???\n    }\n}\n</code></pre>\n\n<p>That is, is there a way to fetch the</p>\n\n<ul>\n<li><code>\"System.Data.SqlClient\"</code></li>\n<li><code>\"res://*/EntityModel.csdl|res://*/EntityModel.ssdl|res://*/EntityModel.msl\"</code></li>\n</ul>\n\n<p>from somewhere and not use literal values?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":115,"score":1,"question_id":12599732,"title":"Entity Framework conflict with same table name from different databases","body":"<p>I am using Entity Framework 4 with MVC 3 in Visual Studio 2012 (C#).</p>\n\n<p>I am using <em>database first</em>; there are two separate databases each with its own namespace and with two separate edmx files. Each database has a table with the same name and fields (but different content). When I added the second table I started to get compile errors.</p>\n\n<pre><code>Ambiguity between 'Interface.CodeFormStatus.FormStatusCodeID' \nand 'Interface.CodeFormStatus.FormStatusCodeID' \n</code></pre>\n\n<p>There seem to be some complex workarounds or I could rename one of the tables. Is there not a straightforward solution as this must be a fairly common issue.</p>\n"},{"tags":["entity-framework","entity-framework-4","linq-to-entities","ef-code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":173,"score":2,"question_id":11529881,"title":"Entity Framework Code First 4.3 / LINQKit predicate for related table","body":"<p>I am using Entity Framework 4.3.1 with a Code First approach. Also, I am using LinqKit so as to use the PredicateBuilder.</p>\n\n<p>If I have tables like so:</p>\n\n<p>Location, TimeZone (Many:1)</p>\n\n<p>..and I wish to have something like so:</p>\n\n<pre><code>Expression&lt;Func&lt;TimeZone, bool&gt;&gt; pred = PredicateBuilder.True&lt;TimeZone&gt;();\npred = pred.And(tz =&gt; tz.TimeZoneCode == \"EST\");\n\nList&lt;Location&gt; locations = context.Locations\n    .AsExpandable().Where(pred)\n    .Select(loc =&gt; loc).ToList();\n</code></pre>\n\n<p>This does not work, because the predicate is built to accept a TimeZone, but the Where() method receives a Location.</p>\n\n<p>I can rewrite the predicate like so, but I do not want to, because I want to have a predicate factory that creates predicates for specific types (I do not want to use the Navigator properties in this manner):</p>\n\n<pre><code>Expression&lt;Func&lt;Location, bool&gt;&gt; pred = PredicateBuilder.True&lt;Location&gt;();\npred = pred.And(loc =&gt; loc.TimeZone.TimeZoneCode == \"EST\");\n</code></pre>\n\n<p>What syntax could I use (if any) to use the predicate as constructed in the first example, where it takes a TimeZone, rather than have it take a Location and walk the tree via the navigation properties (as this is less reusable). It would be nice if there was a way to leverage the knowledge that EF has about the navigation properties in the first place, and be able to use a predicate scoped to the type of the navigation property.</p>\n"},{"tags":["c#","asp.net","json","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":12602952,"title":"LINQ query output groups and subgroups in JSON","body":"<p>I have a table like this (Groups):</p>\n\n<pre><code>ID       Name           ParentID\n1        Group 1        null\n2        Group 2        null\n3        SubGr 1-1      1\n4        SubGr 1-2      1\n5        SubGr 2-1      2\n6        Group 3        null\n7        SubGr 1-2-1    4\n..... and so on\n</code></pre>\n\n<p>I want to serialize this to JSON looking like this:</p>\n\n<pre><code>[{\"id\":1,\n  \"name\":\"Group 1\",\n  \"children\": [\n    {\n     \"id\":3,\n     \"name\":\"SubGr 1-1\",\n     \"children\":null\n    },{\n     \"id\":4,\n     \"name\":\"SubGr 1-2\",\n     \"children\": [\n       {\n        \"id\":7,\n        \"name\":\"SubGr 1-2-1\", \n        \"children\": null\n       }\n      ]\n    }\n   ]\n  },\n {\"id\":2,\n  \"name\":\"Group 2\",\n  \"children\": [\n    {\n     \"id\":5,\n     \"name\":\"SubGr 2-1\",\n     \"children\":null\n    }\n   ]\n },\n {\"id\":6,\n  \"name\": \"Group 3\",\n  \"children\": null\n }\n]\n</code></pre>\n\n<p>As you can see, you can have indefinite subgroups.</p>\n\n<p>How can I make such a query in LINQ and output it in JSON like the example above?</p>\n\n<p>I have no problem outputting the JSON as seperated elements, with ParentID, but I need to have the structure as mentioned above.</p>\n\n<p>This is the code that I am currently working with, after trying different things around, but with no luck still (this version only gives two levels):</p>\n\n<pre><code>    public ActionResult GetGroups()\n    {\n        var groupobjs = db.GroupObjs.ToList();\n\n        var items = groupobjs.Where(p =&gt; p.ParentID == null).Select(p =&gt; new\n        {\n            id = p.ID,\n            name = p.Name,\n            children = groupobjs.Where(c =&gt; c.ParentID == p.ID).Select(c =&gt; new {\n                id = c.ID,\n                name = c.Name\n            })\n        });\n\n\n\n        return Json(items, JsonRequestBehavior.AllowGet);\n    }      \n</code></pre>\n"}]}
{"total":18927,"page":17,"pagesize":100,"questions":[{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":12592833,"title":"Entity Framework 5 complex type and unknown column in field list error","body":"<p>Bare with me as I'm new to C# and programming in general.</p>\n\n<p>I'm trying to define a complex type that is in the same table as the principle class.  Basically, it's the good old User and Address example.</p>\n\n<pre><code>public class Customer\n{\n    [Key]\n    public int customerId { get; set; }\n\n    //some attributes\n\n    public string street { get; set; }\n    public string city { get; set; }\n    public string province { get; set; }\n    public string country { get; set; }\n    public string postal { get; set; }\n}\n</code></pre>\n\n<p>So I try to slice off the address information into its own class:</p>\n\n<pre><code>public class Customer\n{\n    [Key]\n    public int customerId { get; set; }\n\n    //some attributes\n    public Address address { get; set; }\n}\n\n[ComplexType]\npublic class Address\n{\n    public string street { get; set; }\n    public string city { get; set; }\n    public string province { get; set; }\n    public string country { get; set; }\n    public string postal { get; set; }\n}\n</code></pre>\n\n<p>I get no compile error and when I load a view that access the Customer model, I get an unknown column in field set error.</p>\n\n<blockquote>\n  <p>Unknown column 'Extent1.address_street' in 'field list'</p>\n</blockquote>\n\n<p>I basically followed this example: <a href=\"http://weblogs.asp.net/manavi/archive/2010/12/11/entity-association-mapping-with-code-first-part-1-one-to-one-associations.aspx\" rel=\"nofollow\">http://weblogs.asp.net/manavi/archive/2010/12/11/entity-association-mapping-with-code-first-part-1-one-to-one-associations.aspx</a></p>\n\n<p>Is there something I\"m missing or something different with EF5?</p>\n"},{"tags":["entity-framework","many-to-many","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12603122,"title":"EF code first; many-to-many collections are null?","body":"<p>With EF many to many relationships, do I have to instantiate the corresponding collections of the objects manually?</p>\n\n<p>Like...</p>\n\n<pre><code>public class Class1 {\n  [Key]\n  public int Id { get; set;\n  public List&lt;Class2&gt; OtherObjects {get; set;}\n}\n\npublic class Class2 {\n  [Key]\n  public int Id { get; set;\n  public List&lt;Class1&gt; OtherObjects {get; set;}\n}\n</code></pre>\n\n<p>And somewhere else...</p>\n\n<pre><code>Class1 c = new Class1 {\n  OtherObjects = new List&lt;Class2&gt;(); // necessary? Do I have to do this?\n};\n\nc.OtherObjects.Add(new Class2());\n</code></pre>\n\n<p>Like this? Because when I build a one-to-many relationship the collection seems to be instantiated automatically. Is that different to many-to-many relationships? Or is there an error or misbehaviour in my application when the collection <em>OtherObjects</em> is null?</p>\n"},{"tags":["vb.net","entity-framework","usercontrols"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12603176,"title":"Why can my VB.NET User Control not instantiate an ObjectContext?","body":"<p>I have the following lines of code as a test user control. When the project is built, and I drag this user control onto a form, I get an error dialogue to the effect that EF can't find the connection string for the context. Yet when I use the same variable in a form, all is well. It seems the user control is using a different context within which to look for the connection string than the usual app.config.</p>\n\n<pre><code>Public Class InvoiceWorkOrderSearch\n    Private _dataHelper As WorkOrderData = New WorkOrderData()\nEnd Class\n</code></pre>\n"},{"tags":["c#","entity-framework","associations"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":12602715,"title":"Add Association by using Non-Key","body":"<p>I want to manually add the Association between <strong>Qualification</strong> and <strong>QualificationUnit</strong> by using the Non-keys.  Qualification has a Zero-To-Many relationship to QualificationUnit</p>\n\n<p>I want to join OakQualificationNumber and QualificationNumber.</p>\n\n<p>The below is the database structure and entity diagram in my project.</p>\n\n<p><img src=\"http://i.stack.imgur.com/KcNwg.png\" alt=\"enter image description here\"></p>\n\n<p>I tried to associate them but I couldn't.  I couldn't change the PrincipalKey to OakQualificationNumber.  Could you please advise me how I could add the Association with Non Key Fields?  Thanks.</p>\n\n<p><img src=\"http://i.stack.imgur.com/yUVpV.png\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","asp.net","linq","entity-framework","linq-to-entities"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":132,"score":2,"question_id":12602506,"title":"Why should I use Any method instead of Count?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/305092/which-method-performs-better-any-vs-count-0\">Which method performs better: .Any() vs .Count() &gt; 0?</a>  </p>\n</blockquote>\n\n\n\n<p>I just wonder why should I use <code>Any()</code> instead of <code>Count()</code>?,  if we took the <a href=\"http://msdn.microsoft.com/en-us/library/bb343630.aspx\" rel=\"nofollow\">msdn</a> example :</p>\n\n<pre><code>class Pet\n{\n    public string Name { get; set; }\n    public int Age { get; set; }\n}\nclass Person\n{\n    public string LastName { get; set; }\n    public Pet[] Pets { get; set; }\n}\n\npublic static void AnyEx2()\n{\n    List&lt;Person&gt; people = new List&lt;Person&gt;\n        { new Person { LastName = \"Haas\",\n                       Pets = new Pet[] { new Pet { Name=\"Barley\", Age=10 },\n                                          new Pet { Name=\"Boots\", Age=14 },\n                                          new Pet { Name=\"Whiskers\", Age=6 }}},\n          new Person { LastName = \"Fakhouri\",\n                       Pets = new Pet[] { new Pet { Name = \"Snowball\", Age = 1}}},\n          new Person { LastName = \"Antebi\",\n                       Pets = new Pet[] { }},\n          new Person { LastName = \"Philips\",\n                       Pets = new Pet[] { new Pet { Name = \"Sweetie\", Age = 2},\n                                          new Pet { Name = \"Rover\", Age = 13}} }\n        };\n\n    // Determine which people have a non-empty Pet array.\n    IEnumerable&lt;string&gt; names = from person in people\n                            where person.Pets.AsQueryable().Any()\n                            select person.LastName;\n\n    foreach (string name in names)\n        Console.WriteLine(name);\n\n    /* This code produces the following output:\n\n       Haas\n       Fakhouri\n       Philips\n    */\n}\n</code></pre>\n\n<p>What if I used :</p>\n\n<pre><code>  IEnumerable&lt;string&gt; names = from person in people\n                            where person.Pets.Count() &gt; 0\n                            select person.LastName;\n</code></pre>\n\n<p>It will give same result ! , (I don't think it created for shortness or something) , is there any feature for <code>Any()</code> ??</p>\n"},{"tags":["c#","sql","entity-framework","connection-string"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":231,"score":2,"question_id":12364617,"title":"EF 5.0 & dynamic connection string?","body":"<p>One thing is driving me crazy right now.</p>\n\n<p>My (Database-first) EF-Model needs a dynamic connection string (IP-Adress of Server might change once in a while).</p>\n\n<p>So in older EF-Versions you could pass a connection-string via constructor, but that is not possible in 5.0 as is seems.</p>\n\n<p>What I have read so far, you could change your datatemplate, but that will be overwritten each time you re-generate your model etc., so not the best way to do it.</p>\n\n<p>Another thing is the SQLConnectionFactory, but that does not seem to work at all \n<code>(Database.DefaultConnectionFactory = new SqlConnectionFactory( ... )</code> seems to be ignored completely).</p>\n\n<p>What would be the right approach for that?</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":11571662,"title":"Unnecessary updates...?","body":"<p>Here is myu scenario: I have an object Account which is referenced by many objects Payment. I am seeing that when I change the state of the payment the Account's rowversion property Version is also updated with a SQL like this:</p>\n\n<pre><code>update [dbo].[Account]\nset    @p = 0\nwhere  (([Id] = 2606 /* @0 */)\n        and ([Version] = 0x0000000000000C8C /* @1 */))\n\nselect [Version]\nfrom   [dbo].[Account]\nwhere  @@ROWCOUNT &gt; 0\n       and [Id] = 2606 /* @0 */\n</code></pre>\n\n<p>Absolutely no other updates on the Account in that transaction. I checked my code several times and do not see any modifications on the Account object. Also I have overridden the DbContext's SaveChanges and I do not see an entry for the Account object in an EntityState.Modified... </p>\n\n<p>The big problem is not only the unnecessary update but the fact that several payments associated with an account may get updated at the same time and of course an optimistic concurrency exception will be thrown and the transaction will roll-back and must be repeated.</p>\n\n<p>Can someone suggest what to check/fix/change in my code to stop all that.</p>\n\n<p>Thank you\nVal</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":12600660,"title":"Use service layer or IValidatableObject","body":"<p>I would like to know what is the best way to validate a model before saving it and the pros and cons.\nI'm in doubt between service layer and IValidatableObject.</p>\n\n<p>Service layer:</p>\n\n<pre><code>public class PersonService\n{\n    public void Insert(Person person)\n    {\n        if (!IsValid(person))\n        {\n            //something\n        }\n    }\n}\n</code></pre>\n\n<p>IValidatableObject:</p>\n\n<pre><code>public class Person:IValidatableObject\n{\n    public IEnumerable&lt;ValidationResult&gt; Validate(ValidationContext validationContext)\n    {\n        if (!IsValid(this))\n        {\n            //something\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":164,"score":0,"question_id":12599470,"title":"Populating multiselect list with data MVC 3 .NET","body":"<p>I have been searching a lot on Google and Stackoverflow for soltuions on how to Populate a Multiselect box with values that can be selected. But no luck.</p>\n\n<pre><code>public class PriceObj\n{\n    public int ID { get; set; }\n    public decimal Price { get; set; }\n    public string Name { get; set; }\n    public string Description { get; set; }\n    public virtual ICollection&lt;PriceGroupObj&gt; PriceGroup {get; set;}\n}\n\npublic class PriceGroupObj\n{\n   public int ID { get; set; }\n   public string Name { get; set; }\n}\n\n\npublic class PriceDatabaseContext : DbContext\n{\n    public DbSet&lt;PriceObj&gt; PriceObjs { get; set; }\n    public DbSet&lt;PriceGroupObj&gt; PriceGroupObjs { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        base.OnModelCreating(modelBuilder);\n        modelBuilder.Conventions.Remove&lt;System.Data.Entity.ModelConfiguration.Conventions.PluralizingTableNameConvention&gt;();\n\n        modelBuilder.Entity&lt;PriceObj&gt;()\n            .HasMany(g =&gt; g.PriceGroup)\n            .WithMany()\n            .Map(t =&gt; t.MapLeftKey(\"GroupID\").MapRightKey(\"PriceID\").ToTable(\"PriceGroup\"));\n    }\n\n\n}\n</code></pre>\n\n<p>Then I want in to be able to choose all appropriated price groups for a price in the edit view of the price objects. But I do not get it working, it is not populating all the already created groups in the MultiSelect box.</p>\n\n<p>This is the code I am using in the Razor veiw:</p>\n\n<pre><code>@Html.ListBoxFor(model =&gt; model.PriceGroup, Model.PriceGroup.Select(pg =&gt; new SelectListItem { Text = pg.Name, Value = pg.ID.ToString() }), new { Multiple = \"multiple\" })\n</code></pre>\n\n<p>The select element shows up on the website, but no values are to select from.</p>\n\n<p>Please help me sort out, where my chain is falling of.</p>\n"},{"tags":["c#","silverlight","entity-framework","ado.net","visual-studio-lightswitch"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12558234,"title":"How to check get list code in LightSwitch 2011?","body":"<p>LightSwitch automatically generates most of the code. I was wondering anyone knows how to check the get list code in LightSwitch 2011 ? Where is it located ? </p>\n\n<p><strong>Root Issue:</strong> The reason I'm looking for it is to address the below issue. I still can't quite understand whether it is a bug in LightSwitch or something wrong with my data model or code. </p>\n\n<p><a href=\"http://stackoverflow.com/questions/9796359/comparing-two-fields-using-linq\">Comparing two fields using LINQ</a></p>\n\n<p><a href=\"http://social.msdn.microsoft.com/Forums/en-US/lightswitch/thread/37225c64-951a-4ea8-93ce-0cce22976e4e/\" rel=\"nofollow\">Drop Down Problem in LightSwitch</a></p>\n"},{"tags":["entity-framework",".net-4.0","entity-framework-5"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":727,"score":1,"question_id":12183944,"title":"Entity Framework 5 on .NET 4.0 - DatabaseGeneratedOption.Identity is undefined","body":"<p>I need to use EF5 on .NET 4 and I've run into a reference issue when mapping my class with HasDatabaseGenerationOption.Identity which doesn't exist in the 4.0 version of the library.</p>\n\n<p>The following is failing:</p>\n\n<pre><code>this.Property(t =&gt; t.DeploymentLogId)\n              .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n</code></pre>\n\n<p>Does anyone know of a work around?</p>\n"},{"tags":["asp.net-mvc","database","entity-framework","visual-studio-2012","ef-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":179,"score":0,"question_id":12598883,"title":"Entity Framework 5 delete my database changing model","body":"<p>I have an ASP.NET MVC 4 project with Entity Framework 5, .NET 4.5 and Visual Studio 2012.\nIn my solution I've put all the models in a project called Model, all the Repositories and my DbContext in one more project called Data.\nI activate the migrations in the Data project with the Enable-Migrations command. I decide to handle them manually. If I create a new migration with the Add-Migration command everything works very well. If, for example, I add a new column to a table, it works fine. I can see the new column in the database schema and I see the new record into the _MigrationHistory table.\nAt this point, with the new column created, I need to add this column to the right model. So, i add this method to my code-first model class and I run the project.\nIt delete my database, and init it with the initial migration.\nI can't tweak a model without loosing all data.\nHow I can avoid this behavior?\nThanks</p>\n\n<p>UPDATE:</p>\n\n<p>Configuration.cs</p>\n\n<pre><code>namespace NegoziazioneEventi.Data.Migrations\n{\n    using System;\n    using System.Data.Entity;\n    using System.Data.Entity.Migrations;\n    using System.Linq;\n\n    internal sealed class Configuration : DbMigrationsConfiguration&lt;NegoziazioneEventi.Data.NeDataContext&gt;\n    {\n        public Configuration()\n        {\n            AutomaticMigrationsEnabled = false;\n        }\n\n        protected override void Seed(NegoziazioneEventi.Data.NeDataContext context)\n        {\n\n        }\n    }\n}\n</code></pre>\n\n<p>Application_Start() in Global.asax</p>\n\n<pre><code>protected void Application_Start()\n        {\n\n            // init basic data on database\n            System.Data.Entity.Database.SetInitializer(new Models.InitData());\n\n            AreaRegistration.RegisterAllAreas();\n\n            RegisterGlobalFilters(GlobalFilters.Filters);\n            RegisterRoutes(RouteTable.Routes);\n\n            _container = Bootstrapper.GetWindsorContainer();\n\n        }\n</code></pre>\n"},{"tags":["c#","database","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":12598004,"title":"Cannot insert duplicate key row in object with unique index 'in_name'","body":"<p>I get this error: Cannot insert duplicate key row in object with unique index 'in_name'\nWhat can be the problem?</p>\n\n<pre><code>var ing = (from x in db.tblTable where x.ing_name == ing_name select x);\nvar ing1 = ing.First();\ning1.ing_name = ing1.ing_name + \" (\" + FormatC(ing_brand) + \")\";\ndb.SaveChanges();            \n</code></pre>\n\n<p>And here is FormatC:</p>\n\n<pre><code>public static string FormatC(string str)\n    {\n        if (!string.IsNullOrEmpty(str))\n            return str.Substring(0, 1).ToUpper() + \"\" + str.Substring(1).ToLower();\n        else\n            return \"\";\n    }\n</code></pre>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12591244,"title":"EF Migrations, conflicting for property id when setting it to databasegenerated identity","body":"<p>I have this setup for my identity class:</p>\n\n<pre><code>   public class Identity \n   {\n        public Identity()\n        {\n            this.Roles = new List&lt;Role&gt;();\n        }\n\n        public int Id { get; set; }\n        public System.DateTime DateAdded { get; set; }\n        public string identityprovider { get; set; }\n        public string nameidentifier { get; set; }\n        public System.DateTime LastLoggedIn { get; set; }\n\n        public virtual ICollection&lt;Role&gt; Roles { get; set; }\n    }\n\npublic class IdentityMap : EntityTypeConfiguration&lt;Identity&gt;\n{\n    public IdentityMap()\n    {\n        // Primary Key\n        this.HasKey(t =&gt; t.Id);\n\n        // Properties\n        this.Property(t =&gt; t.identityprovider)\n            .IsRequired()\n            .HasMaxLength(255);\n\n        this.Property(t =&gt; t.nameidentifier)\n            .IsRequired();\n\n        // Table &amp; Column Mappings\n        this.ToTable(\"Identities\");\n        this.Property(t =&gt; t.Id).HasColumnName(\"Id\")\n            .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity);\n//ERROR WHEN ADDING ABOVE LINE DatabaseGeneratedOption.Identity\n\n\n        this.Property(t =&gt; t.DateAdded).HasColumnName(\"DateAdded\").\n            HasDatabaseGeneratedOption(DatabaseGeneratedOption.Computed);\n        this.Property(t =&gt; t.identityprovider).HasColumnName(\"identityprovider\");\n        this.Property(t =&gt; t.nameidentifier).HasColumnName(\"nameidentifier\");\n        this.Property(t =&gt; t.LastLoggedIn).HasColumnName(\"LastLoggedIn\")\n            .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Computed);\n\n        // Relationships\n        this.HasMany(t =&gt; t.Roles)\n            .WithMany(t =&gt; t.Identities)\n            .Map(m =&gt;\n                {\n                    m.ToTable(\"IdentityRoles\");\n                    m.MapLeftKey(\"Identities_Id\");\n                    m.MapRightKey(\"Roles_Id\");\n                });\n\n\n    }\n}\n</code></pre>\n\n<p>I get the following error when trying to add a migration:</p>\n\n<blockquote>\n  <p>Conflicting configuration settings were specified for property 'Id' on\n  type 'S_Innovations.TrafficTheory.EFModel.Models.Identity': \n    DatabaseGeneratedOption = Identity conflicts with\n  DatabaseGeneratedOption = None</p>\n</blockquote>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12593553,"title":"How should I write an Entity Framework migration that transforms data (preferably using the DbContext)?","body":"<p>Say my object has a Name field, and I wish to split it into FirstName and LastName fields. Or maybe it has an address string and I'm adding Lat and Lng fields that require geocoding. Etc etc.</p>\n\n<p>I expected to have access to my DbContext in the Up() and Down() methods, but all I've been able to find (besides the builtin functions) is the .Sql() call. This is enough for adding and removing columns, but not for transforming existing data into new formats.</p>\n\n<p>Is it safe to reference my DbContext inside an Up() invocation? Or is there another recommended pattern for implement migrations that require more than trivial SQL?</p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework","entity-framework-4","database-connection"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12594743,"title":"Cannot connect to Database with Entity Framework","body":"<p>Every time I have a fresh install of Windows, Visual Studio and Sql Server I always have problems getting an application to connect to the local instance of Sql Server.</p>\n\n<p>I am trying to start an application using Entity Framework code first.  Here is my connection string.</p>\n\n<pre><code>&lt;add name=\"KCSoccerDataContext\" \n     connectionString=\"Data Source=.\\MSSQLSERVER;Initial Catalog=KCSoccer;Integrated Security=SSPI\" \n     providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>I am able to connect to the database instance using Sql Server Management Studio, but can't seem to connect using this connection string.  I am assuming the problem has to do with how the database instance is configured.</p>\n\n<p>The error I'm getting is </p>\n\n<blockquote>\n  <p>{\"The provider did not return a ProviderManifestToken string.\"}</p>\n</blockquote>\n\n<p>I'm not exactly sure what this means or where to go from here.</p>\n\n<p>Any help anyone could give on this would be awesome.</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework","mvc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12596115,"title":"Entity Framework code-first not generating database in SQL Server","body":"<p>I am new to EF code first approach, what I am trying to do is just inserting a record but somehow the database fails to generate in my SQL Server when my SubmitResult method is executed. I placed a breakpoint at <code>unitOfWork.Save();</code> and it went through without catching any errors, I assume that if my connection string is invalid it would have thrown an exception. What could possibly be causing this? </p>\n\n<p>Thanks.</p>\n\n<pre><code>[HttpPost]\npublic JsonResult SubmitResult(String signedRequest, String facebookName, String email, int score, String title)\n{\n    DateTime now = ConstantHelper.GetCurrentTime();\n    try\n    {\n        FacebookSignedRequestUtility fbSignedRequestUtility = new FacebookSignedRequestUtility();\n        fbData = fbSignedRequestUtility.Parse(FacebookUtility.AppSecret, signedRequest);\n\n        Entry entry = new Entry();\n        entry.Fbuid = fbData.FBUID;\n        entry.FacebookName = facebookName;\n        entry.Email = email;\n        entry.Score = score;\n        entry.Title = title;\n        entry.CreatedDateTime = now;\n        entry.ModifiedDateTime = now;\n\n        unitOfWork.EntryRepository.Insert(entry);\n        unitOfWork.Save();\n    }\n    catch (Exception ex)\n    {\n        return Json(new { status = \"false\" });\n    }\n\n    return Json(new { status = \"true\" });\n}\n</code></pre>\n"},{"tags":["mysql","wcf","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":12593341,"title":"how can i use Mysql in EntityFramework with WCF","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/8705108/mysql-entity-framework-error-the-specified-store-provider-cannot-be-found-in-t\">MySQL Entity Framework Error - The specified store provider cannot be found in the configuration, or is not valid</a>  </p>\n</blockquote>\n\n\n\n<p>actually my project is WCF application, service read MySQL database with help of EntityFramework. I need to download the Mysql.Data connecter with NuGet, that allow me connect to Mysql.\nI test it locally, works good. But when i upload to server through FTP(Godaddy hosting), it just says <code>{\"ExceptionDetail\":null,\"ExceptionType\":null,\"Message\":\"The specified store provider cannot be found in the configuration, or is not valid.\",\"StackTrace\":null}</code>\ni know the error is because i need to download that connecter, but i do, i download the Mysql.Data, ADO.net driver for Mysql, however, it does not work.</p>\n"},{"tags":["entity-framework","dvcs","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":11,"down_vote_count":0,"view_count":171,"score":11,"question_id":10298298,"title":"Using Entity Framework Code First Migrations in a DVCS Project","body":"<p>I have always found version control a bit of an issue when it comes to database schemas. </p>\n\n<p>So - I am currently evaluating Entity Framework Code First Migrations and so far I'm really impressed.</p>\n\n<p>My question is, does anyone have any experience of using Migrations in a team using a DVCS?</p>\n\n<p>If developers working on different branches each create their own Migrations, does the 'Update-Database' tool cope well with that when the branches are merged?</p>\n\n<p>I guess what could happen is that a new Migration would appear in the middle of the list. Would this then get picked up, or does it just look for 'newer' migrations than the last one deployed?</p>\n\n<p>I appreciate the team are going to have to be careful not to create conflicting schema changes - this is something we can manage - but it would be useful to know if 'Update-Database' is smart enough to spot the 'missing' migration?</p>\n\n<p>Thanks,\n- Chris</p>\n"},{"tags":[".net","entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":103,"score":2,"question_id":12393337,"title":"Pluggable conventions in EF 5?","body":"<p>Was Pluggable conventions removed from the EF 5 release, i saw it in the pre releases?  Looking for a way to force ef code use datetime2 by convention, so don't need to explicit map each column of every entity.</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12591219,"title":"Fastest way to mass-update the database?","body":"<p>So I'm changing a lot of entries at once in a certain part of my program.\nThe code right now looks like this for each one:</p>\n\n<pre><code>foreach(newentry)\n{\n    oldentry = context.Users.Find(entry.userid);\n    newentry.oldvalue = newvalue;\n    context.Entry(oldentry).CurrentValues.SetValues(newentry);\n}\ncontext.SaveChanges();\n</code></pre>\n\n<p>However, this ends up querying the database 300+ times and is killing my performance.\nThe only way I thought of is to pre-load the database, but I don't think this is the best way either.</p>\n\n<pre><code>var userlist = context.Users.ToList();\nforeach(newentry in userlist)\n{\n    var original = entry;\n    entry.originalvalue = newvalue;\n    context.Entry(original).CurrentValues.SetValues(newentry);\n}\ncontext.SaveChanges();\n</code></pre>\n\n<p>I'm still accessing the database 300+ times, aren't I? What would you recommend?</p>\n"},{"tags":["asp.net-mvc","entity-framework","automapper"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12589957,"title":"Error copying a record from one entity to another using Entity Framework and Automapper","body":"<p>I am trying to move a record from one table into another matching (almost) table using EF5, MVC, and Automapper.\nThis code is what I am using:</p>\n\n<p>In My Global Application_Start</p>\n\n<pre><code>//Create Map and manually map StatusCode to Status\n            Mapper.CreateMap&lt;InstitutionStaging, InstitutionStaging_Archive&gt;()\n               .ForMember(dest =&gt; dest.Status,o =&gt;o.MapFrom(src=&gt;src.StatusCode));\n</code></pre>\n\n<p>In my Controller</p>\n\n<pre><code> private MyContext db = new MyContext();\n\n   Public ActionResult ArchiveMe(int id = 0){\n\n  var institutionstaging = db.InstitutionStagings.Find(id);\n\n        if (institutionstaging == null)\n        {\n            return HttpNotFound();\n        }\n        if (ModelState.IsValid)\n        {  \n\n            var institutionArchive = Mapper.Map&lt;InstitutionStaging, InstitutionStaging_Archive&gt;(institutionstaging);\n            //Set Archive date to now.\n            institutionArchive.ArchiveDate = DateTime.Now;\n//Error happens on the next line\ndb.InstitutionStaging_Archives.Add(institutionArchive);\n\n            db.InstitutionStagings.Remove(institutionstaging);\n            db.Entry(institutionArchive).State = EntityState.Added;\n            //Commit the changes\n            var result = db.SaveChanges();\n            }\n}\n</code></pre>\n\n<p>When it hits the line marked <em>\"Error happens here==>\"</em> I get the following error message.</p>\n\n<pre><code>{\"The entity type InstitutionStaging_Archive is not part of the model for the current context.\"}\n</code></pre>\n\n<p>The MyContext contains DbSets for both InstitutionStaging and InstitutionStaging_Archive.</p>\n\n<p>Any idea what is happening?\nTIA \nJ</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12573802,"title":"Using EntityFramework - how to dynamically change ssdl Function attributes","body":"<p>Question: Does anyone know how to dynamically change the value of the \"StoreFunctionName\" attribute as listed under the \"Function\" node within the SSDL content section of the edmx file? \nExample:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;edmx:Edmx Version=\"2.0\" xmlns:edmx=\"http://schemas.microsoft.com/ado/2008/10/edmx\"&gt;\n  &lt;!-- EF Runtime content --&gt;\n  &lt;edmx:Runtime&gt;\n    &lt;!-- SSDL content --&gt;\n    &lt;edmx:StorageModels&gt;\n    &lt;Schema Namespace=\"Myapp.Store\" Alias=\"Self\" Provider=\"Oracle.DataAccess.Client\"\n\n\nProviderManifestToken=\"10.2\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" xmlns=\"http://schemas.microsoft.com/ado/2009/02/edm/ssdl\"&gt;\n        &lt;EntityContainer Name=\"myappStoreContainer\" /&gt;\n        &lt;Function Name=\"FOO\" Aggregate=\"false\" BuiltIn=\"false\" NiladicFunction=\"false\" IsComposable=\"false\" ParameterTypeSemantics=\"AllowImplicitConversion\" Schema=\"\" StoreFunctionName=\"PKG1.FOO\"&gt;\n</code></pre>\n\n<p>Background: I'm using EntityFramework to connect to and map my Oracle database.  The DBA's I have to work with insist on my application connecting to the DB with a \"user\" schema while the tables and stored procedures are defined under another schema (let's just call it \"admin\").  They also require that the stored procedures are defined under a package within the DB (in the example this would be PKG1).</p>\n\n<p>I figured out that I could map my stored procedures into the EntityFramework model (using the \"admin\" schema), and by manually changing the \"Schema\" attribute to an empty string, I could connect and call the desired stored procedure from another schema (the \"user\" schema\") - as long as it wasn't defined in a package.  Once the stored procedure was placed in a package I had to manually add the \"StoreFunctionName\" attribute and provide it with the \"package name.stored proc name\" string as a value.  I could then call the stored procedure that was defined in the package.  While in debug mode, I could also manually change the StoreFunctionName in the edmx file, save the file and a subsequent call to the method invoking the stored procedure would succesfully call the stored procedure as defined in another package.  So any ideas on how I would make the change to the edmx file dynamically (it doesn't appear that published solution comes with the edmx file)?</p>\n\n<p>Update: OK, so the reason there is no edmx file is because the data is compiled into a dll.  I've been going through Brandon Haynes EFModelAdapter code but I'm still having trouble figuring out how to manipulate the StoreFunctionName value (or any of the \"FUnction\" node attributes for that matter). </p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","wcf-data-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":89,"score":1,"question_id":12572020,"title":"MVC with nested actions, WCF Data Service with EF5, and DataServiceQuery<>.Expand()","body":"<p>Consider this code:</p>\n\n<pre><code>var svc = new ProductDesignerEntities(AppSettings.ProductDesignerServiceLocation);\n\nvar scenariox = svc.Scenarios\n    .Where(o =&gt; o.ID == id)\n    .FirstOrDefault();\n\nvar scenario = svc.Scenarios\n    .Expand(o =&gt; o.SomeNavigationProperty)\n    .Where(o =&gt; o.ID == id)\n    .FirstOrDefault();\n</code></pre>\n\n<p>When this code runs, <code>scenario.SomeNavigationProperty</code> will be unpopulated. Commenting out the code which populates <code>scenariox</code> fixes it. Why is this? Is it possible to fix this through configuration of the service context or the data service, or will I have to change the design of my code in some fashion?</p>\n\n<p>The alternatives that I can think of are all inferior in some capacity:</p>\n\n<ul>\n<li>Create a <code>ProductDesignerEntities</code> instance per action. This kills within-request caching almost entirely.</li>\n<li>Create a <code>ProductDesignerEntities</code> instance per controller. Less annoying with a base controller class, but this kills caching between controllers, and wouldn't fix the issue if different actions in the same controller needed different sets of navigation properties from the same table.</li>\n<li>Manually populate the property if it is empty. Difficult to consistently implement a manual solution like this; bound to be a source of bugs.</li>\n<li>Always manually populate the property. Kind of defeats the purpose of navigation properties.</li>\n<li>Ensure that all uses of the table within a request have the same .Expand() list. Extremely annoying and begging for hard-to-fix bugs.</li>\n</ul>\n\n<p>I'm starting to lean toward the first alternative. It seems to have the least issues, despite the additional overhead of a new connection for each instance :/</p>\n\n<p><strong>EDIT:</strong> I managed to get the service queries to run through Fiddler, and they look correct. But the navigation property on <code>scenario</code> still winds up empty unless I comment out the <code>scenariox</code> code.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12588742,"title":"Invalid Column Name with EF","body":"<p>I modified the table UserProfile in the database with some extra columns and then modified the UserProfile class to reflect them:</p>\n\n<pre><code>[Table(\"UserProfile\")]\npublic class UserProfile\n{\n    [Key]\n    [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n    public int UserId { get; set; }\n    public string UserName { get; set; }\n    public string Firstname { get; set; }\n    public string Surname { get; set; }\n    public string School { get; set; }\n}\n</code></pre>\n\n<p>Obviously they are FirstName, Surname and School.  For some reason though despite the register action saving details into all 3 of these new columns when I try to load the data via:</p>\n\n<pre><code>var context = new UsersContext();\nvar user = context.UserProfiles.First(n =&gt; n.UserName == model.UserName);\n</code></pre>\n\n<p>It says that School is an invalid ColumnName.  I checked it was a string in both class and table so bit confused how to debug, help!</p>\n"},{"tags":["c#","database","entity-framework","zip"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":84,"score":0,"question_id":11916256,"title":"Uploading a zip file to a database","body":"<p>I am using Entity Framework as part of a school/course project where users should be allowed to upload files or directories. If it's a directory it has to be zipped(I got hold of DotNetZip) but I am not sure of how convert the zip file into a <code>byte[]</code>. Also should I store the zip in the temp directory and delete it once it has been saved?</p>\n"},{"tags":["c#","performance","entity-framework","x86","x64"],"answer_count":1,"favorite_count":5,"up_vote_count":17,"down_vote_count":0,"view_count":182,"score":17,"question_id":12584628,"title":"Entity Framework spinup much slower on x64 vs x86","body":"<p>My coworker posted this question yesterday: <a href=\"http://stackoverflow.com/questions/12572623/7-second-ef-startup-time-even-for-tiny-dbcontext\">7-second EF startup time even for tiny DbContext</a>.</p>\n\n<p>After taking his code and moving it to a separate solution to isolate it as much as possible, I found that the containing project's platform target had a profound affect on the runtime of the EF startup process.</p>\n\n<p>When targeting x64, I saw that the test took ~7 seconds to spin up the first DbContext and &lt;1 second to spin up the second DbContext (consistent with my coworker's findings who is also targeting x64). However when I switched the platform target to x86, the first DbContext spin up time was reduced by about 4 seconds down to 3.34633 seconds while the second DbContext took the same amount of time as the x64 case.</p>\n\n<p>Given this, it appears the Entity Framework is going through a much different initialization process when targeting a 64-bit system vs 32-bit system. Does anyone have any insight into what is going on under the hood to explain this?</p>\n"},{"tags":["entity-framework","entity-framework-4.1","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12587407,"title":"Many-to-many (unidirectional) relationship with Entity Framework","body":"<p>I am using Entity Framework 4.1 with MVC 3. </p>\n\n<p>The issue I am getting is when I save a new question with attached categories to the database it should just update the Question and the QuestionCategories tables, however it adds a new duplicate entry to the Category table.</p>\n\n<pre><code>public class Question{\n   public int QuestionId{ get; set; }\n   public string QuestionName { get; set;}\n   public virtual IList&lt;Category&gt; Categories{ get; set; }\n}\n\npublic class Category{\n  public int CategoryId{ get; set; }\n  public string CategoryName { get; set; }\n}\n\n\nmodelBuilder.Entity&lt;Question&gt;()\n   .HasMany(e =&gt; e.Categories)\n   .WithMany() // don't need?\n   .Map(mc =&gt; mc\n   .ToTable(\"QuestionCategories\")\n   .MapLeftKey(\"QuestionId\")\n   .MapRightKey(\"CategoryId\"));\n\n\npublic long CreateQuestion(Question question)\n{ \n   this.repository.questions.Add(question); \n   this.repository.SaveChanges();\n   return question.Id;\n\n}\n\n\npublic void AddCategoryToQuestion(question question, List&lt;long&gt; CategoryIds)\n{\n   if (question.Categories == null)\n       question.Categories = new List&lt;Category&gt;();\n\n   foreach (long CategoryId in CategoryIds)\n   {\n       if (question.Categories.FirstOrDefault(q =&gt; q.Id == CategoryId) == null)\n       {\n           Category category = this.CategoryService.GetCategoryById(CategoryId);\n           if (category != null)\n           {\n              question.Categories.Add(category);\n           }\n        }\n   }\n}\n\npublic void SaveQuestion(Question Question)\n{\n    this.repository.Questions.Attach(Question);\n    this.repository.SetModified(Question);\n    this.repository.SaveChanges();\n}\n\n\nCategory Table \nBefore SaveQuestion runs when user assigns Operations Category to a new question.\n\nCategoryId  CategoryName \n1           Operations\n2           Safety\n\n\nAfter SaveQuestion runs\n\nCategoryId  CategoryName \n1           Operations\n2           Safety\n3           Operations\n</code></pre>\n\n<p>Thank you in advance.</p>\n"},{"tags":["c#","asp.net","sql-server","asp.net-mvc-3","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12587843,"title":"Entity Framework sending wrong date to update statement","body":"<p>I am working on an MVC 3 application in C# that is having trouble updating an entry in the table.</p>\n\n<p>The update string that is being called from EF is sending in the date as such <strong>(all other values in the where statement have been removed for clarity)</strong>:</p>\n\n<pre><code>where [CreateDate] = '2012-09-24 19:12:08'\n</code></pre>\n\n<p>The actual database entry has the date and the sql data type is datetime2(7):</p>\n\n<pre><code>2012-09-24 19:12:08.6457698\n</code></pre>\n\n<p>When the code is executed the dates don't match and nothing is updated. I created my models using Reverse Engineering Code First from existing database. Here is my Model:</p>\n\n<pre><code>public class NPost\n{\n    [HiddenInput(DisplayValue = false)]\n    public int NPostID { get; set; }\n\n    [HiddenInput(DisplayValue = false)]\n    public System.Guid UserId { get; set; }\n\n    [Required(ErrorMessage = \"Please enter a title!\")]\n    [StringLength(Int32.MaxValue)]\n    public string Title { get; set; }\n\n    [AllowHtml]\n    [Required(ErrorMessage = \"Please enter the body of the post!\")]\n    [StringLength(Int32.MaxValue)]\n    public string Body { get; set; }\n\n    [Required(ErrorMessage = \"Please enter at least one tag!\")]\n    [StringLength(Int32.MaxValue)]\n    public string Tags { get; set; }\n\n    public System.DateTime CreateDate { get; set; }\n    public Nullable&lt;System.DateTime&gt; PublishDate { get; set; }\n    public Nullable&lt;double&gt; Rating { get; set; }\n\n    [Required(ErrorMessage = \"Please enter a topic!\")]\n    [StringLength(Int32.MaxValue)]\n    public string Topic { get; set; }\n\n    [StringLength(Int32.MaxValue)]\n    public string TitleImage { get; set; }\n\n    [StringLength(Int32.MaxValue)]\n    public string ListingImage { get; set; }\n\n    [StringLength(Int32.MaxValue)]\n    public string BoxImage { get; set; }\n\n    public virtual aspnet_Users aspnet_Users { get; set; }\n}\n</code></pre>\n\n<p>What do I need to do to get these dates to line up and work correctly?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12490302,"title":"Saving the union of two lists to database with entity framework","body":"<p>I have a database with weather forecasts. A forecast consists of a timepoint and a temperature for a specific location and is loaded from a xml service. Each time new forecasts is loaded they streach from the current time point to 48 hours in the future with a forecast for each hour in between. I would like to save these new forecasts to a database using entity framework such that duplicates (same timepoint) gets overwritten. That is, I would like to make a union of the data in the database and the new forecasts and then save the result to the database.</p>\n\n<p>Is this possible to do using Entity framework? If not, is there any smart way to do this such that the number of database accesses are minimized?</p>\n\n<p><strong>Edit:</strong>\nIn order to make my question somewhat clearer. I have two entities, ForecastLocation and Forecast:</p>\n\n<pre><code>public class ForecastLocation\n{\n    private ICollection&lt;Forecast&gt; _forecasts;\n    private decimal _longitude;\n    private decimal _latitude;\n\n    public int ForecastLocationId { get; set; }\n\n    public decimal Longitude \n    {\n        get { return Math.Round(_longitude, 1); }\n        set { _longitude = value; }\n    }\n\n    public decimal Latitude \n    {\n        get { return Math.Round(_latitude, 1); }\n        set { _latitude = value; }\n    }\n\n    public DateTime LastIssued { get; set; }\n\n    public virtual ICollection&lt;Forecast&gt; Forecasts \n    { \n        get { return _forecasts ?? (_forecasts = new List&lt;Forecast&gt;());}\n        set { _forecasts = value;}\n    }\n}\n\npublic class Forecast\n{\n    private decimal _temperature;\n    private decimal _cloudiness;\n\n    public int ForecastId { get; set; }\n\n    public DateTime TimePoint { get; set; }\n\n    public decimal Temperature \n    {\n        get { return Math.Round(_temperature, 1); }\n        set { _temperature = value; }\n    }\n\n    public decimal Cloudiness \n    {\n        get { return Math.Round(_cloudiness, 1); }\n        set { _cloudiness = value; }\n    }\n\n    public int ForecastLocationId { get; set; }\n\n}\n</code></pre>\n\n<p>Every ForecastLocation object has a list consisting of forecasts. When a new forecast has been loaded and converted to a list of forecast objects, some of the timepoints will be overlapping (since the forecasts by the xml service are overlapping). However, it is assumed that new newest forecasts are more valid than the old ones in case of overlapping. This means that the forecasts with overlapping timepoints should be overwritten by the new forecasts and the rest of the new forecasts should be added to the list aswell.</p>\n\n<p>I have solved this temporarily by manually deleting the old forecasts that are overlapping and then simply adding all the new forecasts to the list in forecastlocation. This however, yields lots of database accesses.</p>\n\n<pre><code>    public void DeleteForecast(ICollection&lt;Forecast&gt; newForecasts)\n    {\n        var timePoints = (from o in newForecasts\n                          select o.TimePoint);\n\n        var oldForecasts = (from o in _context.Forecasts\n                            where timePoints.Contains(o.TimePoint)\n                            select o);\n\n        foreach (var oldForecast in oldForecasts)\n        {\n            _context.Forecasts.Remove(oldForecast);\n        }\n    }\n</code></pre>\n\n<p>One solution would perhaps to write custom SQL when deleting.</p>\n\n<p>I'm using Entity Framework 5.</p>\n"},{"tags":["c#","entity-framework","ninject","repository-pattern","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":326,"score":3,"question_id":12585664,"title":"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key","body":"<p>Using EF5 with a generic Repository Pattern and ninject for dependency injenction and running into an issue when trying to update an entity to the database utilizing stored procs with my edmx.  </p>\n\n<p>my update in DbContextRepository.cs is:</p>\n\n<pre><code>public override void Update(T entity)\n    {\n        if (entity == null)\n            throw new ArgumentException(\"Cannot add a null entity.\");\n\n        var entry = _context.Entry&lt;T&gt;(entity);\n\n        if (entry.State == EntityState.Detached)\n        {\n            _context.Set&lt;T&gt;().Attach(entity);\n            entry.State = EntityState.Modified;\n        }\n    }\n</code></pre>\n\n<p>From my AddressService.cs which goes back to my repository I have:</p>\n\n<pre><code> public int Save(vw_address address)\n    {\n        if (address.address_pk == 0)\n        {\n            _repo.Insert(address);\n        }\n        else\n        {\n            _repo.Update(address);\n        }\n\n        _repo.SaveChanges();\n\n        return address.address_pk;\n    }\n</code></pre>\n\n<p>When it hits the Attach and EntityState.Modified it pukes with the error:</p>\n\n<p><strong>An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key.</strong></p>\n\n<p>I have looked through many of the suggestions in stack and on the Internet and not coming up with anything that resolves it.  Any work arounds would be appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":77,"score":1,"question_id":11923674,"title":"Selecting all but one property using LINQ/Entity Framework","body":"<p>I am using Entity Framework as part of a project that should allow students and trainers to up- and download files and directories.</p>\n\n<p>In order to show the documents I make a call to the db:</p>\n\n<pre><code>public static ObjectSet&lt;Document&gt; doc = frmFocus._context.Documents;\n</code></pre>\n\n<p>But this delivers all the properties including the actual data of the files. What I would like to do is retrieve only those that are relevant to the listview until the files to download have been selected.</p>\n\n<p>Is this possible? I haven't been able to find a way.</p>\n"},{"tags":["c#","entity-framework","entity-framework-5","fix"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":12538004,"title":"Entity Framework 5 - The abstract type 'X' has no mapped descendents and so cannot be mapped","body":"<p>I'm getting the following error when trying to operate on <a href=\"https://github.com/gbirchmeier/quickfixn/blob/master/QuickFIXn/Message/FIX44/TradeCaptureReportRequestAck.cs\" rel=\"nofollow\">this object</a>.  Anybody got any ideas?  The <a href=\"https://github.com/gbirchmeier/quickfixn\" rel=\"nofollow\">project</a> is on GitHub, but you will most likely not be able to run it unless you have a <a href=\"http://fixprotocol.org/\" rel=\"nofollow\">FIX</a> server laying around.  I can't seem to internet this error message. </p>\n\n<pre><code>    System.InvalidOperationException was unhandled by user code\n      Message=The abstract type 'QuickFix.Fields.IField' has no mapped descendents and so cannot be mapped. Either remove 'QuickFix.Fields.IField' from the model or add one or more types deriving from 'QuickFix.Fields.IField' to the model. \n      Source=EntityFramework\n      StackTrace:\n           at System.Data.Entity.ModelConfiguration.Edm.Services.StructuralTypeMappingGenerator.GetEntityTypeMappingInHierarchy(DbDatabaseMapping databaseMapping, EdmEntityType entityType)\n           at System.Data.Entity.ModelConfiguration.Edm.Services.AssociationTypeMappingGenerator.GenerateIndependentAssociationType(EdmAssociationType associationType, DbDatabaseMapping databaseMapping)\n           at System.Data.Entity.ModelConfiguration.Edm.Services.AssociationTypeMappingGenerator.Generate(EdmAssociationType associationType, DbDatabaseMapping databaseMapping)\n           at System.Data.Entity.ModelConfiguration.Edm.Services.DatabaseMappingGenerator.GenerateAssociationTypes(EdmModel model, DbDatabaseMapping databaseMapping)\n           at System.Data.Entity.ModelConfiguration.Edm.Services.DatabaseMappingGenerator.Generate(EdmModel model)\n           at System.Data.Entity.ModelConfiguration.Edm.EdmModelExtensions.GenerateDatabaseMapping(EdmModel model, DbProviderManifest providerManifest)\n           at System.Data.Entity.DbModelBuilder.Build(DbProviderManifest providerManifest, DbProviderInfo providerInfo)\n           at System.Data.Entity.DbModelBuilder.Build(DbConnection providerConnection)\n           at System.Data.Entity.Internal.LazyInternalContext.CreateModel(LazyInternalContext internalContext)\n           at System.Data.Entity.Internal.RetryLazy`2.GetValue(TInput input)\n           at System.Data.Entity.Internal.LazyInternalContext.InitializeContext()\n           at System.Data.Entity.Internal.InternalContext.Initialize()\n           at System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(Type entityType)\n           at System.Data.Entity.Internal.Linq.InternalSet`1.Initialize()\n           at System.Data.Entity.Internal.Linq.InternalSet`1.get_InternalContext()\n           at System.Data.Entity.Internal.Linq.InternalSet`1.ActOnSet(Action action, EntityState newState, Object entity, String methodName)\n           at System.Data.Entity.Internal.Linq.InternalSet`1.Add(Object entity)\n           at System.Data.Entity\n</code></pre>\n"},{"tags":["c#","performance","linq","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":202,"score":6,"question_id":12572623,"title":"7-second EF startup time even for tiny DbContext","body":"<p>I am trying to reduce the startup time of my EF-based application, but I find that I cannot reduce the amount of time taken for an initial read below 7 seconds even for a single-entity context. What's especially strange is that this time is not context-type specific. </p>\n\n<p>Can anyone explain what causes these slow times and/or how I can get things to run faster?</p>\n\n<p>Here's the complete sample code:</p>\n\n<p>In my database, I have a table named se_stores with a primary key column AptId:</p>\n\n<pre><code>    // a sample entity class\npublic class Apartment\n{\n    public int AptId { get; set; }\n}\n\n    // two identical DbContexts        \n\npublic class MyDbContext1 : DbContext\n{\n    public MyDbContext1(string connectionString) : base(connectionString)\n    {           \n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        Database.SetInitializer&lt;MyDbContext1&gt;(null);\n\n        var config = new EntityTypeConfiguration&lt;Apartment&gt;();\n        config.HasKey(a =&gt; a.AptId).ToTable(\"se_stores\");\n        modelBuilder.Configurations.Add(config);\n\n        base.OnModelCreating(modelBuilder);\n    }\n}\n\npublic class MyDbContext2 : DbContext\n{\n    public MyDbContext2(string connectionString)\n        : base(connectionString)\n    {\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        Database.SetInitializer&lt;MyDbContext2&gt;(null);\n\n        var config = new EntityTypeConfiguration&lt;Apartment&gt;();\n        config.HasKey(a =&gt; a.AptId).ToTable(\"se_stores\");\n        modelBuilder.Configurations.Add(config);\n\n        base.OnModelCreating(modelBuilder);\n    }\n}\n\n    // finally, I run this code using NUnit:\n\nvar start = DateTime.Now;\nvar apt1 = new MyDbContext1(connectionString).Set&lt;Apartment&gt;().FirstOrDefault();\nvar t1 = DateTime.Now - start;\nstart = DateTime.Now;\nvar apt2 = new MyDbContext2(connectionString).Set&lt;Apartment&gt;().FirstOrDefault();\nvar t2 = DateTime.Now - start;\nConsole.WriteLine(t1.TotalSeconds + \", \" + t2.TotalSeconds);\n</code></pre>\n\n<p>It reliably prints something like the following: 7.5277527, 0.060006. When I switch the test to use MyDbContext2 first, I get the same result (so it happens for whichever DbContext gets initialized first). I also tried pre-generating views using EF power tools. This reduced the time for the first context to around 6.8 seconds, and thus was only a small win.</p>\n\n<p>I understand that DateTime.Now is a terrible profiling method, but these results have held up while using dotTrace. I'm also aware that running some code for the first time invokes a JITing cost, but 7 seconds seems far too high to attribute to that. </p>\n\n<p>I am using EF 4.3.1 and .NET 4 with VS 2010.</p>\n\n<p>Thanks in advance for your help!</p>\n\n<p>EDIT: It was suggested that opening the SQL connection might be causing the problem. </p>\n\n<ol>\n<li>I first tried running a random query using a raw SqlConnection and create command with the same connection string. This took 1 second and did not affect the time of DbContext initialization.</li>\n<li>I then tried creating a SqlConnection with the connection string and passing it through to DbContext's constructor that takes a connection. I passed contextOwnsConnection=false. This also made no difference in the DbContext initialization time.</li>\n<li>Finally, I tried connecting through management studio using the same credentials and connection string options. This was nearly instantaneous.</li>\n<li>In the dotTrace profile, it measures SqlConnectionFactory.CreateConnection(connectionString) as taking 0.7 seconds, which is consistent with the raw SQL time.</li>\n</ol>\n\n<p>EDIT: I wanted to know if the delay was per connection or once only. Thus, I tried having MyDbContext1 and MyDbContext2 connect to entirely different databases on different servers. This DID NOT make a difference regardless of which database was connected to first: the use of a first DbContext took ~7 seconds, while the use of a second context is blazingly fast.</p>\n"},{"tags":["entity-framework","orm"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":12586008,"title":"entity framework update property without loading related entities","body":"<p>I have a straight forward scenario</p>\n\n<pre><code>class Person\n{\n    [Required]\n    public int Age {get;set;}\n\n    [Required]\n    public virtual Pet Pet {get;set;}\n}\n\nclass Pet\n{\n      ...\n}\n</code></pre>\n\n<p>both <code>Person</code> &amp; <code>Pet</code> are mapped in the context. lazy loading is enabled.\nIf I attempt to update the age of the person I receive a validation error stating <code>Pet</code> is required.</p>\n\n<pre><code>var person = context.People.Find(id)\nperson.Age = 30;\ncontext.SaveChanges(); //causes validation error.\n</code></pre>\n\n<p>I wouldn't think I need to load related entities for the context to produce the correct sql statements. Am I missing something, or is this just not possible?</p>\n\n<p><strong>solution</strong>\ngiven the limited options EF provides for this I went with disabling validation via an <code>ActionFitler</code></p>\n\n<pre><code>public class DoNotValidateEntityFrameworkAttribute\n    : ActionFilterAttribute\n{\n    public override void OnActionExecuting(HttpActionContext actionContext)\n    {\n        actionContext\n            .ControllerContext\n            .Configuration\n            .DependencyResolver\n            .GetService&lt;DbContext&gt;()\n            .Configuration\n            .ValidateOnSaveEnabled = false;\n\n        base.OnActionExecuting(actionContext);\n    }\n}\n\nclass MyController : ApiController\n{\n    [DoNotValidateEntityFramework]\n    public void Put(int id, Model model)\n    {\n          ...\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","c#-4.0","table-per-type"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":47,"score":-1,"question_id":12521548,"title":"One Controller with many views for table per type","body":"<p>I have a table per type structure, I want to write an mvc razor application where my only parameter in the mvc routing is the primary key ID. From there the application will establish which type in my tpt structure the ID belongs to then displays the view formatted for particular type.</p>\n\n<p>In addition, based on the type of the ID the view will also contain information related to that ID in from other tables in the tpt structure.</p>\n\n<p>E.g.\nBob is a person with ID 1234</p>\n\n<ul>\n<li>Entity 1234 has comments in the comments table</li>\n<li>Entity 1234 has an entry in the entity relationship table to Simon</li>\n</ul>\n\n<p>I've read a number of articles about making a base class controller, but would my URL change from <code>www.something.burp/1234?</code></p>\n\n<p>Is it possible to have a set of Index, Edit, Create, Details views that have byType separation?</p>\n\n<p>Just looking for some pointers or ideas for me to research.</p>\n\n<p>Thanks for you help.</p>\n\n<hr>\n\n<p>MVC4, EF4, C#, SQL 2008</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12585827,"title":"LINQ Projected Filtering C#","body":"<p>I want to filter my LINQ query based on an included table but am having some trouble.</p>\n\n<p>Here is the original statement, which works:</p>\n\n<pre><code>return \n    this.ObjectContext.People.\n        Include(\"Careers\").\n        Include(\"Careers.Titles\").\n        Include(\"Careers.Titles.Salaries\");\n</code></pre>\n\n<p>Now I'm trying to filter on Careers using projected filtering but am having trouble.  It  compiles but it leaves out the Titles and Salaries tables, which causes runtime errors, and I can't seem to add those tables back in:</p>\n\n<pre><code>var query1 = (\n    from c in \n    this.ObjectContext.People.\n        Include(\"Careers\").\n        Include(\"Careers.Titles\").\n        Include(\"Careers.Titles.Salaries\")\n    select new\n    {\n        c,\n        Careers = from Careers in c.Careers\n                  where Careers.IsActive == true\n                  select Careers\n    });\n\n    var query = query1.AsEnumerable().Select(m =&gt; m.c);\n    return query.AsQueryable();\n</code></pre>\n\n<p>How can I include the titles and salaries tables in the filtered query?</p>\n"},{"tags":[".net","silverlight","entity-framework","ria","domaincontext"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":12584476,"title":"HowTo use record of same Table in two DomainContexts?","body":"<p>i have following problem in my Silverlight(5) RIA project.\nFor performance-reason i have to package my serverside queries and the send it per invokeOperation as byte[] to the client.\nAll is working well, but the following problem:</p>\n\n<pre><code>//two DomainContexts with all my table structures\ndcOverview = new DomainContext();\ndcDetail = new DomainContext();\n\n// the query-result\nIEnumerable&lt;TABLE1&gt; records = helper.GetClass&lt;IEnumerable&lt;TABLE1&gt;&gt;(\"TABLE1\"); // result from deserialization package\n// assigning the records to the dc table of the overview\ndcOverview.TABLE1s.EntityContainer.LoadEntities(records, LoadBehavior.RefreshCurrent);\n\n// load the first record into the details dc for viewing and editing\ndcDetail.TABLE1s.Clear();\ndcDetail.TABLE1s.EntityContainer.LoadEntities(records.Take(1), LoadBehavior.RefreshCurrent);\n// sending dc per message to other viewmodel\n...\n</code></pre>\n\n<p>Here at this last code-line i get the error <strong>\"The entity being added is already attached.\"</strong>.\nWhy is this? I have used two dc's, one for the overview, and one for the detail...</p>\n\n<p>Anyone can help me with this?</p>\n\n<p><em><strong></em>* COMMENTED <em>*</em></strong></p>\n\n<p>I have found an workaround for me at the meantime, but still not clear why the above does not work...</p>\n\n<p>I have added the first record which i want to assign to the detail-dc as a own \"node\" in the transfer-package from the server and attach it then to the detail-dc.</p>\n\n<p>Instead of loading it from the previous loaded IEnumerable,\ni do...</p>\n\n<pre><code>TABLE1 detailRec = helper.GetClass&lt;TABLE1&gt;(\"MY_DETAIL\"); // result from deserialized packaging\ndcDetail.TABLE1s.Attach(detailRec);\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12583688,"title":"EF5 Attached entity validation","body":"<p>A bit of a mystery has popped up with EF5 and non-null strings in the schema.  For example, say we have this simple user table:</p>\n\n<pre><code>CREATE TABLE Users\n(\n   UserID INT PRIMARY KEY NOT NULL IDENTITY(1,1),\n   UserName VARCHAR(50) NOT NULL,\n   UserFirst VARCHAR(50) NULL,\n   UserLast VARCHAR(50) NULL\n)\n</code></pre>\n\n<p>... and I create a POCO class to represent it.  This all works fine.  I can retrieve and create data, however update has caused some serious pain.  Say for a moment that I want to update a given user's first name:</p>\n\n<pre><code>User user = new User { UserID = 12345 };\ncontext.Users.Attach(user);\nuser.FirstName = \"SomethingElse\";\ncontext.SaveChanges();\n</code></pre>\n\n<p>This should work.  After attachment, the non-nullable <code>UserName</code> is null.  Which should be fine - I'm not trying to change it, and the change detection states that the value is unchanged.  However, when I call <code>SaveChanges</code>, a DB validation exception is thrown stating the <code>UserName</code> is invalid.</p>\n\n<p>So, from this, two questions:</p>\n\n<ol>\n<li>Am I doing something egregiously wrong?  I'm entirely willing to believe my understanding of entity framework is flawed.</li>\n<li>Why is the change state by <em>property</em> not used at save-time?  I'm aware of <code>context.Configuration.ValidateOnSaveEnabled</code>, but I don't think simply turning validation off is a valid answer.  Is there another similar option I can lean on?</li>\n</ol>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12568137,"title":"Entity Framework: what do I do with edmgen.exe's output?","body":"<p>I'm forced to use a legacy SQL Server 2000 database for an EF-based app I am writing. The tables already exist, so I need to generate the <code>Entities</code> layer. I can do this in VS2010 using MySQL and recent versions of SQL Server, but not 2000. </p>\n\n<p>To get around this, I followed some tutorials that explain how to generate <code>csl</code>, <code>msdl</code> and <code>ssdl</code> files using <code>edmgen.exe</code>.</p>\n\n<p>That works fine. I now have those files in e.g. <code>c:\\temp</code>. </p>\n\n<p>Please can someone tell me what to do with these files? I want to Entity Framework-ify a simple console application that I have written. Can I somehow create an 'ADO.NET Entity Data Model' from these files so I end up with what I would have if I had used VS2010 all along?</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework","c#-4.0","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":121,"score":1,"question_id":12581887,"title":"Entity Framework 4.0 - The underlying provider failed on Open","body":"<p>We have a web application with Entity Framework 4.0. Unfortunately, when the large volume of users hit the application the EF throws an error\n<em>The underlying provider failed on Open</em></p>\n\n<p>Below is the code snippet:</p>\n\n<pre><code>//DAL\npublic IQueryable&lt;EmployeeEntity&gt; GetEmployeeDetail()\n{\n    DatabaseEntities ent = new DatabaseEntities(this._connectionString);\n    IQueryable&lt;EmployeeEntity&gt; result = from employee in ent.EmployeeEntity\n                                           select employee;\n\n    return result;\n}\n</code></pre>\n\n<p>Please note the above code returns IQuerable.</p>\n\n<ol>\n<li>Is anything wrong with above pattern that could cause the exception to occur?</li>\n<li>When and how does Entity Framework determine to close / open db connection and also how long to retain?</li>\n<li>On what scenario does above error occurs?</li>\n<li>What's the maximum number of connection pool for EF and how do we configure?</li>\n<li>Do we need to explicitely specify open and close</li>\n<li>Is code below a best way to resolve above issue?</li>\n</ol>\n\n<hr>\n\n<pre><code>public IQueryable&lt;EmployeeEntity&gt; GetEmployeeDetail()\n{\n    using (DatabaseEntities ent = new DatabaseEntities(this._connectionString))\n    {\n        IQueryable&lt;EmployeeEntity&gt; result = from employee in ent.EmployeeEntity \n                                            select employee;                     \n        return result.ToList().AsQuerable();\n    }\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12582498,"title":"how to insert null or valid value in nullable column of database in EF 4.1","body":"<p>I am in scenerio where I need to inset a dateTime value in the database using the EF 4.1.\n DateColumn in database in Nullable.</p>\n\n<p>While creating the entity i am filling it as,</p>\n\n<pre><code> DTCLOSE = referenceProblemLog.DateClosed.HasValue ? \n            referenceProblemLog.DateClosed.Value.ToFeedFormatString() : \n            System.DBNull.Value.ToString(), \n</code></pre>\n\n<p>where ToFeedFormatString is an extension method.</p>\n\n<p>Now problem i observed is, if I have a proper value then it is inserted correctly but\n<strong>when i dont have a proper date value, i want to insert NULL in database column. However EF is saving column with Empty string</strong></p>\n\n<p>I tried to change the StoreGeneratedPattern for the field to \"Identity\" but problem with it is, I cant assign value to DTCLose field.</p>\n\n<p>How can i have both the things?\n1. EF should insert NULL in database when proper value is not there\n2. proper value otherwise</p>\n\n<p>Please help</p>\n\n<p>Thanks\nAnup</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12565943,"title":"Unable to set field/property on entity","body":"<p>I have been on a project with entity framework in ddd pattern. I don't use the default custom tool for entity and I have repository and some model classes.</p>\n\n<p>I have 3 tables in my entity framework:</p>\n\n<ol>\n<li>Category</li>\n<li>CategoryContent</li>\n<li>Content</li>\n</ol>\n\n<p>Category with categoryContent and content with categoryContent have 1 to many relationship. (I don't use many to many here because I have some properties in CategoryContent table)</p>\n\n<p>When I send a request for list of CategoryContent and show content.Title of this list in MVC I have seen this error:</p>\n\n<p><code>Unable to set field/property CategoryContents on entity type System.Data.Entity.DynamicProxies.Content_731FEFC3E064D6098DC133918117C2359E2F308D2EB1E5D8D986538641AAB7CD.</code></p>\n\n<p>But when I traced, program dosen't have any problems and returned data and show.</p>\n\n<p>I use message system (request and response message in service project).</p>\n\n<p>this code is a method for return list of contentcategory.</p>\n\n<pre><code> public IEnumerable&lt;CategoryContent&gt; GetContents(int categoryID)\n    {\n        Query query = new Query();\n        OrderByClause order = new OrderByClause();\n        order.PropertyName = \"ID\";\n        order.Desc = true;\n        query.OrderByProperty = order;\n        query.Add(new Criterion(\"CategoryID\", categoryID, CriteriaOperator.Equal));\n\n        return  categoryContentRepository.FindBy(query);\n    }\n</code></pre>\n\n<p>categoryContentRepository is an object from CategoryContentRepository class in Repository project for management work with DB.</p>\n\n<p>in MVC Controllers:</p>\n\n<pre><code>public ActionResult Content(int id)\n    {\n        var contentService = ServiceFactory.CreatContentService();\n        var response = contentService.GetContents(id).ToList();\n\n        return PartialView(\"_Content\", response);\n    }\n</code></pre>\n\n<p>in view (_content.cshtml):</p>\n\n<pre><code>@model List&lt;Plus.Model.CategoryContent&gt;\n\n@foreach (var item in Model)\n{\n    @Html.ActionLink(item.Content.Title, \"Amir\")\n}\n</code></pre>\n\n<p>Model Classes:</p>\n\n<pre><code>public class Category : ValidationBase, IAggregateRoot\n{\n    public int ID { get; set; }\n\n    [NotNullOrEmpty()]\n    public string Name { get; set; }\n\n    [NotNullOrEmpty()]\n    public int Ordering { get; set; }\n\n    public int? ParentID { get; set; }\npublic Guid ModifiedBy { get; set; }\npublic DateTime ModifiedOn { get; set; }\npublic string ModifiedReason { get; set; }\npublic bool Deleted { get; set; }\npublic bool Active { get; set; }\n\n\n    public virtual Category Parent { get; set; }\n    public virtual IList&lt;Category&gt; Childeren { get; set; }\n    public virtual IList&lt;CategoryContent&gt; CategoryContents { get; set; }\n}\n\npublic class CategoryContent : ModelBase, IAggregateRoot\n{\n    public int ID { get; set; }\n    public int ContentID { get; set; }\n    public int CategoryID { get; set; }\n\n    public virtual Content Content { get; set; }\n    public virtual Category Category { get; set; }\n}\n\npublic class Content : ModelBase, IAggregateRoot\n{\n    public int ID { get; set; }\n    public string Title { get; set; }\n    public string Intro { get; set; }\n    public int? ParentID { get; set; }\n    public bool IsSeries { get; set; }\n    public byte LikeVoteStatus { get; set; }\n\n    public virtual IList&lt;SubContent&gt; SubContents { get; set; }\n    public virtual Content Parent { get; set; }\n    public virtual IList&lt;Content&gt; Childeren { get; set; }\n    public virtual CategoryContent CategoryContents { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4","wcf-ria-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":154,"score":1,"question_id":6138928,"title":"Entity Framework delayed when call SaveChanges","body":"<p>I'm using Entity Framework 4 with Ria Service. I have a problem with it, that is when I call SaveChanges it does not submit those changes to database yet, it take a while (which I'm not sure how long does it take) before it actually write that data into the table.</p>\n\n<p>I want to know how can I configure entity framework (or wcf ria) to write data immediately after I call SaveChanged()</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12580473,"title":"Overwriting String Property Issue","body":"<p>Just some background about my application. I am developing an ASP.Net MVC 3 Web App which uses Entity Framework 4.1 for data persistence. My application is tiered in that it has a UI layer, Service layer, Repository layer etc. I also use Unity for my Inversion of Control Container.</p>\n\n<p>When a user registers on my application, I create two random codes (Email and Mobile verification codes) using the <strong>StringBuilder</strong>. I then assign these two random codes to their appropriate properties in a User Object, see below.</p>\n\n<pre><code>User validateUser = new User();\n\nvalidateUser.firstName = model.firstName.Trim();\nvalidateUser.lastName = model.lastName.Trim();\nvalidateUser.email = model.Email.Trim();\n\n//Create Email and Mobile Verification Codes\nstring randomEmailCode = \"\";\nrandomEmailCode = _notifyService.GenerateEmailCode();\nvalidateUser.emailVerificationCode = randomEmailCode;\n\nstring randomMobileCode = \"\";\nrandomMobileCode = _notifyService.GenerateMobileCode();\nvalidateUser.mobileVerificationCode = randomMobileCode;\n</code></pre>\n\n<p><strong>NotifyService</strong></p>\n\n<pre><code>public string GenerateEmailCode()\n{\n    StringBuilder builder = new StringBuilder();\n\n    builder.Append(RandomString(4, true));\n    builder.Append(RandomNumber(1000, 9999));\n    builder.Append(RandomString(2, false));\n    return builder.ToString();\n}\n\npublic string GenerateMobileCode()\n{\n    StringBuilder builder = new StringBuilder();\n\n    builder.Append(RandomString(3, true));\n    builder.Append(RandomNumber(1000, 9999));\n    builder.Append(RandomString(2, false));\n    return builder.ToString();\n}\n\nprivate int RandomNumber(int min, int max)\n{\n    Random random = new Random();\n    return random.Next(min, max);\n}\n\nprivate string RandomString(int size, bool lowerCase)\n{\n    StringBuilder builder = new StringBuilder();\n    Random random = new Random();\n    char ch;\n    for (int i = 0; i &lt; size; i++)\n        {\n            ch = Convert.ToChar(Convert.ToInt32(Math.Floor(26 * random.NextDouble() + 65)));\n            builder.Append(ch);\n        }\n        if (lowerCase)\n            return builder.ToString().ToLower();\n        return builder.ToString();\n    }\n</code></pre>\n\n<p>I then add the user to my DBcontext and call the SaveChanges() method to save the new User into my database.</p>\n\n<pre><code>_accountService.AddUser(validateUser);\n_accountService.Save();\n</code></pre>\n\n<p>Now, when I go into my database and find the new User which has been added, the <strong>emailVerificationCode</strong> and the <strong>mobileVerificationCode</strong> are both the same. However, if I put a break point on my code at the following line</p>\n\n<pre><code>randomEmailCode = _notifyService.GenerateEmailCode();\n</code></pre>\n\n<p>And trace through until the Save, and then go check the database for the new User, both <strong>emailVerificationCode</strong> and the <strong>mobileVerificationCode</strong> codes are different, as expected.</p>\n\n<p>I cannot understand why when I run the application it inserts the same code for both properties.</p>\n\n<p>Can anyone please help with this?</p>\n\n<p>Thanks.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I did as Jane suggested, ie, put in hard coded values for each property like so</p>\n\n<pre><code>validateUser.emailVerificationCode = \"emailCode\";\nvalidateUser.mobileVerificationCode = \"mobileCode\";\n</code></pre>\n\n<p>Ran the application again, and this time the two hardcoded values were inserted as expected. Does this mean that that my two methods <strong>GenerateEmailCode()</strong> and <strong>GenerateMobileCode()</strong> are not working correctly?</p>\n"},{"tags":["entity-framework","ef-code-first","t4"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12188618,"title":"How to output T? not Nullable<T> in EF Reverse Engineer Code First?","body":"<p>The \"Reverse Engineer Code First\" functionality of <a href=\"http://visualstudiogallery.msdn.microsoft.com/72a60b14-1581-4b9b-89f2-846072eff19d\" rel=\"nofollow\">Entity Framework Power Tools, Beta 2</a> is very good and I am working on customising the Reverse Engineer Templates.</p>\n\n<p>In Entity.tt, take a look at the following line (line breaks introduced):</p>\n\n<pre><code>&lt;#= Accessibility.ForProperty(property) #&gt; \n&lt;#= code.Escape(property.TypeUsage) #&gt; \n&lt;#= code.Escape(property) #&gt; \n{ get; set; }\n</code></pre>\n\n<p>For a database column named \"SomeDate\" of type datetime, you will have the following code outputted:</p>\n\n<pre><code>public Nullable&lt;System.DateTime&gt; SomeDate { get; set; }\n</code></pre>\n\n<p>How can I modify the Entity.tt code to produce this instead:</p>\n\n<pre><code>public DateTime? SomeDate { get; set; }\n</code></pre>\n\n<p>Thank you,</p>\n\n<p>R.</p>\n"},{"tags":["asp.net-mvc","entity-framework","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12578807,"title":"Entity-framework code-first migrations NOCHECK constraint?","body":"<p>Is it possible to alter tables in code-first migrations with nocheck constraints? I haven't found any way to do this except of getting SQL script via <code>Update-Database -Script</code> and modifying the sql statements.</p>\n"},{"tags":["c#","linq","entity-framework","lambda"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12571415,"title":"Most efficent way to do where search with unknown amount of variables to match with EF linq?","body":"<p>I'm using entity framework and am making a method that can take in up to three variables</p>\n\n<pre><code>public SearchTable(int var1, int var2, int var3)\n</code></pre>\n\n<p>I want to be able to do a where with entity framework, but only on the variables passed in.</p>\n\n<p>So if all three were passed in, it would be something like this:</p>\n\n<pre><code>var results = entities.vw_ToSearch.Where(x =&gt; x.var1 == var1 &amp;&amp; x.var2 == var2 &amp;&amp; x.var3 == var3);\n</code></pre>\n\n<p>but if for example var2 is passed in as null and no value, i want it to only do the where on var1 and var2.</p>\n\n<p>I started writing this out making a different where statement for each possibility and was going to do a bunch of if statements to check which one to use, but it seems like there would be a better way to do this that i am not thinking of.</p>\n\n<p>Any thoughts?</p>\n"},{"tags":["sql","sql-server","entity-framework","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12575800,"title":"Deleting objects through foreign key relationship with T-SQL query","body":"<p>Looking for a way to write the following LinQ to entities query as a T-SQL statement.</p>\n\n<pre><code>repository.ProductShells.Where(x =&gt; x.ShellMembers.Any(sm =&gt; sm.ProductID == pid)).ToList().ForEach(x =&gt; repository.ProductShells.Remove(x));\n</code></pre>\n\n<p>The below is obviously not correct but I need it to delete respective ProductShell object where\nany ShellMember contains a ProductID equal to the passed in variable <code>pid</code>. I would presume this would involve a join statement to get the relevant ShellMembers.</p>\n\n<pre><code>repository.Database.ExecuteSqlCommand(\"FROM Shellmembers WHERE ProductID={0} DELETE FK_ProductShell\", pid);\n</code></pre>\n\n<p>I have cascade delete enabled for the FK_ShellMembers_ProductShells foreign key, so when I delete the ProductShell it will delete all the ShellMembers that are associated with it. I am going to pass this statement to System.Data.Entity <code>Database.ExecuteSqlCommand</code> method.</p>\n"},{"tags":["asp.net-mvc","entity-framework","visual-studio-2012","scaffolding"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":677,"score":2,"question_id":12575665,"title":"MVC4 scaffolding of database-first Entity Framework model in Visual Studio 2012","body":"<p>I'm having problems with Visual Studio 2012, trying to add an MVC4 Controller with scaffolding. Ideally I would like to have an Entity Framework model (edmx file, etc) generated from a database using Add New Item - ADO.NET Entity Data Model (i.e. not Code First) in a separate assembly from my web application. However, when I set this up and use Add Controller, specifying \"MVC controller with read/write actions and views, using Entity Framework\" and choosing a Model class and Data context class from my DatabaseModel assembly the following alert message pops up.</p>\n\n<blockquote>\n  <p>'Ifl.Payforit4.DatabaseModel.Mno' is not part of the specified\n  'Ifl.Payforit4.DatabaseModel.Payforit4Entities' class, and the\n  'Ifl.Payforit4.DatabaseModel.Payforit4Entities' class could not be\n  modified to add a 'DbSet' property to\n  it. (For example, the 'Ifl.Payforit4.DatabaseModel.Payforit4Entities'\n  class might be in a compiled assembly.)</p>\n</blockquote>\n\n<p>Not being able to modify the class makes sense since it is in another assembly, although in the same solution, and auto-generated via T4 but looking at the auto-generated code for Payforit4Entities the 'DbSet' property is quite clearly there already.</p>\n\n<blockquote>\n<pre><code>    public DbSet&lt;Mno&gt; Mnoes { get; set; }\n</code></pre>\n</blockquote>\n\n<p>I've tried a number of other things.</p>\n\n<ol>\n<li>putting the data model directly in the web application</li>\n<li>changing the model class to a variety of other tables in the database in case there is a problem with the Mno class</li>\n<li>reducing the data model to just a single, simple table</li>\n<li>using the Entity Framework Power Tools Beta 2 to reverse engineer a Code First model. This generated a new set of errors. I can see why it is a beta.</li>\n<li>changing the ADO.NET Data Model Code Generation Strategy from None to Default to create a data model based on ObjectContext rather than DbContext</li>\n<li>Turning off pluralisation so the property name is Mno instead of Mnoes</li>\n</ol>\n\n<p>None of them worked. The only thing that did work was writing a Code First DbContext-derived class and POCO by hand. Coincidentally every example I've found that demonstrates MVC4 scaffolding uses this sort of data model. Is there something somewhere that says Code First is the only sort of data model that works with MVC4 scaffolding? Has anyone managed to scaffold a database first (.edmx) data model in Visual Studio 2012? The database is complex enough that I'd rather stick with a database first strategy.</p>\n\n<p>I can see that there would have to be some differences in the scaffolding of Code First versus Database First models. For example, the former has the POCO property holding the key indicated by a KeyAttribute whereas the latter holds that information in the edmx model files. Is this the rationale for the reverse engineer feature in Entity Framework Power Tools? Are we expected to move away from edmx files to reverse engineered Code First models in order to use MVC4 scaffolding? If so, are we expected to carry on using Dynamic Data projects until the Entity Framework Power Tools are finished?</p>\n"},{"tags":["c#","entity-framework","ef-code-first","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12470837,"title":"Where can I learn about EF migration feature that recurses into referenced types?","body":"<p>I just ran into a feature of code first migrations that I didn't realize was there and that's pretty much because everything I know about it comes from a few getting started blog posts.</p>\n\n<p>Is there any more in-depth info on the following behavior (which I find pretty cool because it seems that I can combine it with AutoMapper to simply my web service ETL life)?</p>\n\n<p>For example I have:</p>\n\n<pre><code>public class foo\n{\n  [Key]\n  public int id { get; set; }\n  public bar { get; set; }\n}\n\npublic class bar\n{\n  public int id { get; set; }\n  public string name { get; set; }\n}\n\npublic class Context : DbContext\n{\n  public DbSet&lt;foo&gt; Foos { get; set; }\n}\n</code></pre>\n\n<p>Then I run the migration commands:</p>\n\n<pre><code>Enable-Migrations\nAdd-Migration FirstMigration\n</code></pre>\n\n<p>And  I get:</p>\n\n<pre><code>public partial class FirstMigration : DbMigration\n{\n    public override void Up()\n    {\n        CreateTable(\n            \"dbo.foos\",\n            c =&gt; new\n                {\n                    id = c.Int(nullable: false, identity: true),\n                    name = c.String(),\n                    bar_id = c.Int(nullable: false),\n                    bar_name = c.String(),\n                })\n                .PrimaryKey(t =&gt; t.id);\n    }\n    public override void Down()\n    {\n        DropTable(\"dbo.foos\");\n    }\n}\n</code></pre>\n"},{"tags":["linq","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":12572886,"title":"Grouping by range of values with linq and entity framework","body":"<p>I need some data aggregated by age range, something like:</p>\n\n<pre><code> Age    |   Members\n ------------------\n 0-13   |   150\n 14-19  |   250\n 20-30  |   400\n</code></pre>\n\n<p>In my linq query I'm using <a href=\"http://msdn.microsoft.com/en-us/library/system.data.objects.entityfunctions.diffyears.aspx\" rel=\"nofollow\">EntityFunctions.DiffYears</a> to get age based on birth date:</p>\n\n<pre><code>let age = EntityFunctions.DiffYears(contact.Birthday, today)\n</code></pre>\n\n<p>however if I group group by the age field I will get 19,20,21... and not the ranges.\nWhat is the recommended way to acomplish this with linq and entity framework?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","savechanges"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":367,"score":0,"question_id":12573568,"title":"Entity Framework 5 Using SaveChanges to add audit log","body":"<p>Seems straight forward override SaveChanges in EF to add an audit logger. See the ApplyAuditLogging method to set the audit properties (created, createdby, updated, updatedby) below.</p>\n\n<pre><code>   public override int SaveChanges()\n    {\n        var autoDetectChanges = Configuration.AutoDetectChangesEnabled;\n\n        try\n        {\n            Configuration.AutoDetectChangesEnabled = false;\n            ChangeTracker.DetectChanges();\n            var errors = GetValidationErrors().ToList();\n            if(errors.Any())\n            {\n                throw new DbEntityValidationException(\"Validation errors were found during save: \" + errors);\n            }\n\n            foreach (var entry in ChangeTracker.Entries().Where(e =&gt; e.State == EntityState.Added || e.State == EntityState.Modified))\n            {\n                ApplyAuditLogging(entry);\n            }\n\n            ChangeTracker.DetectChanges();\n\n            Configuration.ValidateOnSaveEnabled = false;\n\n            return base.SaveChanges();\n        }\n        finally\n        {\n            Configuration.AutoDetectChangesEnabled = autoDetectChanges;\n        }\n    }\n\n    private static void ApplyAuditLogging(DbEntityEntry entityEntry)\n    {\n\n        var logger = entityEntry.Entity as IAutidtLogger;\n        if (logger == null) return;\n\n        var currentValue = entityEntry.Cast&lt;IAutidtLogger&gt;().Property(p =&gt; p.Audit).CurrentValue;\n        if (currentValue == null) currentValue = new Audit();\n        currentValue.Updated = DateTime.Now;\n        currentValue.UpdatedBy = \"???????????????????????\";\n        if(entityEntry.State == EntityState.Added)\n        {\n            currentValue.Created = DateTime.Now;\n            currentValue.CreatedBy = \"????????????????????????\";\n        }\n    }\n</code></pre>\n\n<p>The problem is that how to get the windows user logon/username to set the UpdatedBy and CreatedBy properties of the object? I could therefore not use this!</p>\n\n<p>Also, in another case I wanted to automatically add a new CallHistory record to my Contact; whenever the contact is modified, a new record needs to be added to the child table CallHistory. So I did it in InsertOrUpdate of the Repository but it feels dirty, would be nice if I could do it at a higher level as now I have to set the current user from the database. Again here the problem is that I need to fetch the user from the database to create a CallHisotry record (SalesRep = User).</p>\n\n<p>The code in my Repository does 2 things now, 1, it created an audit entry on the object when it is created or updated and, 2, it also created a CallHistory entry whenever the Contact is updated:</p>\n\n<pre><code>ContactRepository.SetCurrentUer(User).InsertOrUpdate(contact)\n</code></pre>\n\n<p>In order to have the user in the Repository context for:</p>\n\n<pre><code>    var prop = typeof(T).GetProperty(\"Id\", BindingFlags.Public | BindingFlags.Instance | BindingFlags.IgnoreCase);\n\n    if (prop.GetValue(entity, null).ToString() == \"0\")\n    {\n        // New entity\n        _context.Set&lt;T&gt;().Add(entity);\n        var autidtLogger = entity as IAutidtLogger;\n        if (autidtLogger != null)\n            autidtLogger.Audit = new Audit(true, _principal.Identity.Name);\n    }\n    else\n    {\n        // Existing entity\n        _context.Entry(entity).State = EntityState.Modified;\n        var autidtLogger = entity as IAutidtLogger;\n        if (autidtLogger != null &amp;&amp; autidtLogger.Audit != null)\n        {\n            (entity as IAutidtLogger).Audit.Updated = DateTime.Now;\n            (entity as IAutidtLogger).Audit.UpdatedBy = _principal.Identity.Name;\n        }\n\n        var contact = entity as Contact;\n        if (_currentUser != null)\n            contact.CallHistories.Add(new CallHistory\n                {\n                    CallTime = DateTime.Now,\n                    Contact = contact,\n                    Created = DateTime.Now,\n                    CreatedBy = _currentUser.Logon,\n                    SalesRep = _currentUser\n                });\n    }\n}\n</code></pre>\n\n<p>Is there a way to somehow inject the windows user into the SaveChanges override in the DbCOntext and is there also a way to fetch a User from the database based on windows logon id so I can set the SalesRep on my CallHistory (see above code)?</p>\n\n<p>Here is my Action on controller on MVC app:</p>\n\n<pre><code>[HttpPost]\npublic ActionResult Create([Bind(Prefix = \"Contact\")]Contact contact, FormCollection collection)\n{\n    SetupVOs(collection, contact, true);\n    SetupBuyingProcesses(collection, contact, true);\n\n    var result = ContactRepository.Validate(contact);\n\n    Validate(result);\n\n    if (ModelState.IsValid)\n    {\n        ContactRepository.SetCurrentUer(User).InsertOrUpdate(contact);\n        ContactRepository.Save();\n        return RedirectToAction(\"Edit\", \"Contact\", new {id = contact.Id});\n    }\n\n    var viewData = LoadContactControllerCreateViewModel(contact);\n\n    SetupPrefixDropdown(viewData, contact);\n\n    return View(viewData);\n}\n</code></pre>\n"},{"tags":["asp.net","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12572761,"title":"How to write Entity Framework when the table has foreign key","body":"<p>Tables <code>t1 {id, name, addr_id}</code> and <code>t2 {addr_id, addr}</code></p>\n\n<p>When you create entity for <code>t1</code> like</p>\n\n<pre><code>dim db = new t1entity()\ndim tt = from t in db.t1s where t.addr_id\n</code></pre>\n\n<p>Here, I cannot use <code>addr_id</code> corresponding to the t</p>\n"},{"tags":["entity-framework","events","properties","handler"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12572742,"title":"EF: Is there any \"property changed\" event?","body":"<p>I want to do something as soon as my entity (class) changes its Id:</p>\n\n<pre><code>[Key]\npublic int MyId { get; set; }\n</code></pre>\n\n<p>Is it possible?\nI would put that handler code within \"set\" ( <code>set { ...handler code... }</code>), but then EF wouldn't map MyId as a column</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":12573206,"title":"getting Entity Framework raw query to respect attributes","body":"<p>I'm using EF4, code first. As such, my model classes have a mix of public properties, some virtual properties (for lazy loaded data from other tables) and some properties that are affixed with <code>[NotMapped]</code> attributes so that they are skipped by EF. </p>\n\n<p>Sometimes I like to make use of the raw query : <code>c.Database.SqlQuery&lt;T&gt;(\"select ...\")</code> to use EF as a row mapper. </p>\n\n<p>I noticed in Intellitrace that these queries were generating a lot of thrown and caught exceptions for \"IndexOutOfRange\". After some looking, the exceptions are all for the virtual and [NotMapped] properties on the model object. I don't want to have to construct a new data model class or parent class with just the table properties in it; is there some configuration step I've missed to tell the row mapper in the raw query runner to pay attention to the same annotations that the rest of EF uses? Maybe they fixed this in EF5?</p>\n"},{"tags":["entity-framework","c#-4.0","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12572388,"title":"Using .include in my repo findbyid ","body":"<p>I have the following function in my generic repository which works fine:</p>\n\n<pre><code>public IQueryable&lt;T&gt; FindWhere(System.Linq.Expressions.Expression&lt;Func&lt;T, bool&gt;&gt; predicate, params string[] includes)\n{\n        IQueryable&lt;T&gt; query = _dbSet;\n\n        foreach (var child in includes)\n        {\n            query = query.Include(child);\n        }\n\n        return query.Where(predicate);            \n}\n</code></pre>\n\n<p>I then also have this to find a single item:</p>\n\n<pre><code>public T FindById(int id)\n{\n        return _dbSet.Find(id);\n}\n</code></pre>\n\n<p>What I need is an override for <code>FindById</code> that will allow me to pass in <code>params string[]</code> includes to allow me to eager load properties on the individual item found.</p>\n\n<p>How can I do this? </p>\n"},{"tags":["asp.net-mvc-3","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12565519,"title":"MVC 3 Display Order Attribute seems to not work?","body":"<p>I am trying to define the order of my properties in a view which I am generating using the MVC scaffolding. I have defined a Metatype buddy class to hold all the data annotations alongside the T4 generated Table class file. </p>\n\n<p>My code looks like:</p>\n\n<pre><code>namespace STD_TTT.Models\n{\nusing System;\nusing System.Collections.Generic;\nusing System.ComponentModel.DataAnnotations;\n\n[MetadataType(typeof(CustomerMetadata))]\npublic partial class Customer\n{\n    class CustomerMetadata\n    {\n    public int Id { get; set; }\n    [Required]\n    [Display(Order=30)]\n    public string Name { get; set; }\n    [Required(ErrorMessage=\"Company required\")]\n    [Display(Name=\"Customer Company Name\",Order=20)]\n    public string Company { get; set; }\n    [Display(Order = 10)]\n    public string Country { get; set; }\n    //public string County { get; set; }\n    }\n    //[Display(Order = 40)]\n    //public string CountryCheck { get; set; }\n}\n}\n</code></pre>\n\n<p>Any thoughts gratefully received. Perhaps this order issued is still unresolved from MVC2.]</p>\n\n<p>Thanks,</p>\n\n<p>Ed</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12572437,"title":"Why won't EF and Automapper save these changes?","body":"<p>I am trying to use AutoMapper and EntityFramework to take a record from one SQL table and add it to a second table (archive)</p>\n\n<pre><code>var institutionstaging = dbContext.InstitutionStagings.Find(id);\nMapper.CreateMap&lt;InstitutionStaging, InstitutionStaging_Archive&gt;();\nvar test = Mapper.Map&lt;InstitutionStaging, InstitutionStaging_Archive&gt;(institutionstaging);\ndbContext.InstitutionStaging_Archive.Add(test);\ndbContext.Entry(test).State = EntityState.Added;\nvar result = dbContext.SaveChanges();\n</code></pre>\n\n<p>Using SQL Profiler I can see the SQL is correctly generated but the values being pushed in are nulls or empty.  What am I missing?</p>\n\n<p>test does contain the expected record data.\nresult = 1 when this is run.</p>\n\n<p>TIA\nJ</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12568004,"title":"Code first detect changes in database","body":"<p>I'm wondering whats the best way to go about if I want an event that will listen to changes made in the database when using EF Code First?</p>\n\n<p>Like if I have a method <code>Update()</code> that will be raised if a change to the database is made like adding a user to it.</p>\n"},{"tags":["entity-framework","delete","constraints","cascade"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12572317,"title":"Not able to delete inherited entity","body":"<p>I use Entity Framework 3.1 Database First (not possible to update) and I have an abstract class called <em>Person</em>. When I try to delete inherited entity <em>Player</em>, I get this error:</p>\n\n<pre><code>The DELETE statement conflicted with the REFERENCE constraint \"FK_Player_inherits_Person\". The conflict occurred in database \"Admin\", table \"dbo.People_Player\", column 'Id'.The statement has been terminated.\n</code></pre>\n\n<p>C# (<em>this</em> is loaded <em>Player</em> entity):</p>\n\n<pre><code>// &lt;-- here I delete all related entities in foreach first --&gt;\n\nStorage.Actual.People.DeleteObject(this);\nStorage.Actual.SaveChanges();\n</code></pre>\n\n<p>First I thought it is caused by some another related entity, so now I manually delete all related entities before I call the delete, but no change.</p>\n"},{"tags":["entity-framework","c#-4.0","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12571538,"title":"Entity Framework 4.1 Relationships and Inserts?","body":"<p>I have an Entity Framework model that has 3 tables (each with indentity primary keys).  The root table has a 1 to many relationship to a child table, that child table has a 1 to many relationship with it's child table. This model is reflected correctly in the model that was generated from the database.</p>\n\n<p>In code, we do an Insert (Add) into the parent table, we then do an insert of that children's tables, and then finally we do inserts on the children's children.  The code looks similar to the example below:</p>\n\n<pre><code>foreach(var parentItemDTO in someDTOCollection) {\n    foreach(var someChildDTOItem in someChildDTOCollection) {\n        // Do some mapping here to the childEntity from DTO\n        // The foreign key relationship isn't set during mapping.\n\n        childTable.Insert(childEntity); // Underlying code is _dbSet.Add(entity)\n\n        foreach(var someChildChildDTOItem in someDTOChildChildCollection) {\n            // Do some mapping here to childChildEntity from DTO\n            // The foreign key relationship isn't set during mapping.\n\n            childChildTable.Insert(childChildEntity);   // Underlying code is _dbSet.Add(entity)\n        } \n    }\n\n    // Do mapping here of the parentEntity from DTO\n\n    parentTable.Insert(someEntity);  // Underlying code is _dbSet.Add(entity)\n}\n</code></pre>\n\n<p>The inserts into the database seem to be working.  However, what I would like to understand is under the hood how does EF maintain the relationship of these objects without me explicitly defining the foreign key relationship during the mapping?  Is these inserts scope safe?  Will this cause orphans or children being inserted into the wrong parent (right now we don't see this happening but does it have the potential)?</p>\n\n<p>Thanks!</p>\n\n<p><strong>EDITED (CORRECTION):</strong></p>\n\n<p>The code has been updated to reflect that the parent insert is happening AFTER all the children inserts.</p>\n"},{"tags":["wpf","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1013,"score":0,"question_id":5928306,"title":"Individual DataGrid Row Visibility","body":"<p>I have a WPF <code>DataGrid</code> bound to a collection of <code>Entity Framework</code> objects that's inside a parent EF object. Something along the lines of:</p>\n\n<pre><code>&lt;DataGrid ItemsSource=\"{Binding SelectedCustomer.Orders}\" /&gt;\n</code></pre>\n\n<p>Now when I want to \"delete\" an Order, I don't want to actually delete it from the data source, I simply want to set its <code>IsDeleted</code> property to true so the data is retained.</p>\n\n<p>My question is: how can I get my <code>DataGrid</code> to skip a row if it's <code>IsDeleted</code> property is true? I would really like to use binding and not codebehind. Something like this would be wonderful:</p>\n\n<pre><code>&lt;DataGrid ItemsSource=\"{Binding SelectedCustomer.Orders}\" RowVisibilityPath=\"IsDeleted\" /&gt;\n</code></pre>\n\n<p>Kind of along the lines of <code>DisplayMemberPath</code>. I realize I would need to convert the state of <code>IsDeleted</code>, but that's a different topic.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["entity-framework","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12566058,"title":"Why do I get different values from my EntitySet depending on how I LINQ to it?","body":"<p>In debugging the issue in this thread: <a href=\"http://stackoverflow.com/questions/12483434/invalidcastexception-when-querying-nested-collection-with-linq\">InvalidCastException when querying nested collection with LINQ</a> I found out that something is wrong with how my Category EntitySet is populated. After selecteding a Category and throwing this exception to see what's going on I get this:</p>\n\n<pre><code>throw new Exception(\"CID: \" + cat.CategoryID +\n  \" LCID: \"        + cat.LocalizedCategories.First().LocalizedCategoryID +\n  \" CID from LC: \" + cat.LocalizedCategories.First().Category.CategoryID);\n</code></pre>\n\n<blockquote>\n  <p>CID: 352 LCID: 352 CID from LC: 191</p>\n</blockquote>\n\n<p>What am I doing wrong that causes CategoryID to have different values depending on how I LINQ to it? It should be 191, and not the same value as the LocalizedCategoryID.</p>\n\n<p>This is the code I use to get the Category:</p>\n\n<pre><code>int categoryId = 352; // In reality this comes from a parameter and is supposed\n                      // to be 191 to get the Category.\nvar cat = categoriesRepository.Categories.First(c =&gt; c.CategoryID == categoryId);\n</code></pre>\n\n<p>This is my domain object with some unrelated stuff stripped:</p>\n\n<pre><code>[Table(Name = \"products\")]\npublic class Product\n{\n    [HiddenInput(DisplayValue = false)]\n    [Column(Name = \"id\", IsPrimaryKey = true, IsDbGenerated = true, AutoSync = AutoSync.OnInsert)]\n    public int ProductID { get; set; }\n\n    [Required(ErrorMessage = \"Please enter a product name\")]\n    [Column]\n    public string Name { get; set; }\n\n    [Required(ErrorMessage = \"Please enter a description\")]\n    [DataType(DataType.MultilineText)]\n    [Column(Name = \"info\")]\n    public string Description { get; set; }\n\n    private EntitySet&lt;Category&gt; _Categories = new EntitySet&lt;Category&gt;();\n    [System.Data.Linq.Mapping.Association(Storage = \"_Categories\", OtherKey = \"CategoryID\")]\n    public ICollection&lt;Category&gt; Categories\n    {\n        get { return _Categories; }\n        set { _Categories.Assign(value); }\n    }\n}\n\n[Table(Name = \"products_types\")]\npublic class Category\n{\n    [HiddenInput(DisplayValue = false)]\n    [Column(Name = \"id\", IsPrimaryKey = true, IsDbGenerated = true, AutoSync = AutoSync.OnInsert)]\n    public int CategoryID { get; set; }\n\n    public string NameByCountryId(int countryId)\n    {\n        return _LocalizedCategories.Single(lc =&gt; lc.CountryID == countryId).Name;\n    }\n\n    private EntitySet&lt;LocalizedCategory&gt; _LocalizedCategories = new EntitySet&lt;LocalizedCategory&gt;();\n    [System.Data.Linq.Mapping.Association(Storage = \"_LocalizedCategories\", OtherKey = \"LocalizedCategoryID\")]\n    public ICollection&lt;LocalizedCategory&gt; LocalizedCategories\n    {\n        get { return _LocalizedCategories; }\n        set { _LocalizedCategories.Assign(value); }\n    }\n\n    private EntitySet&lt;Product&gt; _Products = new EntitySet&lt;Product&gt;();\n    [System.Data.Linq.Mapping.Association(Storage = \"_Products\", OtherKey = \"ProductID\")]\n    public ICollection&lt;Product&gt; Products\n    {\n        get { return _Products; }\n        set { _Products.Assign(value); }\n    }\n}\n\n[Table(Name = \"products_types_localized\")]\npublic class LocalizedCategory\n{\n    [HiddenInput(DisplayValue = false)]\n    [Column(Name = \"id\", IsPrimaryKey = true, IsDbGenerated = true, AutoSync = AutoSync.OnInsert)]\n    public int LocalizedCategoryID { get; set; }\n\n    [Column(Name = \"products_types_id\")]\n    private int CategoryID;\n    private EntityRef&lt;Category&gt; _Category = new EntityRef&lt;Category&gt;();\n    [System.Data.Linq.Mapping.Association(Storage = \"_Category\", ThisKey = \"CategoryID\")]\n    public Category Category\n    {\n        get { return _Category.Entity; }\n        set { _Category.Entity = value; }\n    }\n\n    [Column(Name = \"country_id\")]\n    public int CountryID { get; set; }\n\n    [Column]\n    public string Name { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":12570396,"title":"What is the simplest way to copy a record from one entity to another entity with Entity framework?","body":"<p>I have a SQL table that contains records that I want to move over to an almost identical table using Entity Framework. i.e. moving records from main table to an archive table.</p>\n\n<p>The second table is a superset of the original table in that it has a few extra fields to designate archive date, etc...</p>\n\n<p>Is there a simpler way to accomplish this then manually matching each field from the original entity to the archive entity? \nI looked at Automapper but see that it only works with in memory entities and not my data which is Iqueryable.</p>\n\n<p>TIA \nJohn\n(EF newbie)</p>\n"},{"tags":["c#","entity-framework","c#-4.0","linq-to-sql"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":122,"score":0,"question_id":12568587,"title":"Linq to sql select into a new class","body":"<p>My problem is that when I have following 2 queries, 1st one is not populating the CampaignID property but 2nd one does. Here is my code; </p>\n\n<p><strong>query 1</strong>;</p>\n\n<pre><code>var query = from c in _context.MCTargets\n                    where c.TargetDateFrom==d1 &amp;&amp; c.TargetDateTo&lt;=d2\n                    group c by c.MarketingCampaignID into g\n                    select new MSReport{\n                        CampaignID = g.Key, // CampaignID is not populated here.\n                               StartDate = d1,\n                               EndDate = d2\n                    };\n</code></pre>\n\n<p><strong>query 2</strong>;</p>\n\n<pre><code>var query2 = from c in _context.MCTargets\n                    where c.TargetDateFrom == d1 &amp;&amp; c.TargetDateTo &lt;= d2\n                    group c by c.MarketingCampaignID into g\n                    select new \n                    {\n                        CampaignID = g.Key,\n                        StartDate = d1,\n                        EndDate = d2\n                    };\n</code></pre>\n\n<p><strong>MSReport.cs</strong></p>\n\n<pre><code>public class MSReport\n{\n    public DateTime StartDate { get; set; }\n    public DateTime EndDate { get; set; }\n    public int CampaignID { get; set; }\n\n    public MSReport()\n    {\n        // CampaignID = 0 here  \n        // doing something with CampaignID here like setting some calculated properties.    \n    }  \n }\n</code></pre>\n\n<p>Thanks in advance and sorry for my poor explanation. </p>\n"},{"tags":["c#","multithreading","entity-framework","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12570029,"title":"DbModelBuilder concurrency issue","body":"<p>I'm having a strange concurrency issue with some code I wrote. First thing you will ask is why am I using CF and using DbModelBuilder... well I have situation where I could have Nth number of databases that will all be identical and I must maintain seperation of data. I'm using CF to prevent a massive model generation issues with multiple devs foobaring my models with their GUI's. Alas, this is the basic code for what I'm doing. </p>\n\n<p>The two console writelines should never be hit and yet they are.</p>\n\n<p>Can you please try this and let me know where the issue is?</p>\n\n<p>This is the Test Harness console app:</p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        for (int i = 0; i &lt; 100; i++)\n        {\n            var workerObject = new Worker();\n            var workerThread = new Thread(workerObject.DoWork);\n            workerThread.Start();\n        }\n    }\n}\n\npublic class Worker\n{\n    public void DoWork()\n    {\n        var connections = new List&lt;KeyValuePair&lt;string, DynamicDb&gt;&gt;\n            {\n                new KeyValuePair&lt;string, DynamicDb&gt;(\"db1\", new MyDynamicEntityLayer(\"db1\").DynamicDb()),\n                new KeyValuePair&lt;string, DynamicDb&gt;(\"db2\", new MyDynamicEntityLayer(\"db2\").DynamicDb())\n            };\n\n        foreach (var db in connections)\n        {\n            if (db.Key == \"db1\" &amp;&amp; db.Value.ConnectionString.Contains(\"db2\"))\n                Console.WriteLine(\"THIS SHOULD NEVER HAPPEN!!! db1 : \" + db.Value.ConnectionString);\n            if (db.Key == \"db2\" &amp;&amp; db.Value.ConnectionString.Contains(\"db1\"))\n                Console.WriteLine(\"THIS SHOULD NEVER HAPPEN!!! db2 : \" + db.Value.ConnectionString);\n        }\n    }\n}\n</code></pre>\n\n<p>Here is the entity class:</p>\n\n<pre><code>public class MyDynamicEntityLayer\n{\n    public static string ConnectionString { get; set; }\n    public MyDynamicEntityLayer(string db = null)\n    {\n        MakeAConnectionString(db);\n        Database.SetInitializer&lt;DynamicDb&gt;(null);\n    }\n\n    public void MakeAConnectionString(string db)\n    {\n        var sqlBuilder = new SqlConnectionStringBuilder();\n        if (db == \"db1\")\n        {\n            sqlBuilder.DataSource = \"MySqlServer\";\n            sqlBuilder.InitialCatalog = \"db1\";\n            sqlBuilder.ConnectTimeout = 180;\n            sqlBuilder.IntegratedSecurity = true;\n        }\n        else\n        {\n            sqlBuilder.DataSource = \"MySqlServer\";\n            sqlBuilder.InitialCatalog = \"db2\";\n            sqlBuilder.ConnectTimeout = 180;\n            sqlBuilder.IntegratedSecurity = true;\n        }\n\n        ConnectionString = sqlBuilder.ToString();\n    }\n\n    public DynamicDb DynamicDb()\n    {\n        var builder = new DbModelBuilder(DbModelBuilderVersion.Latest);\n        TableMappingToBuilder(builder);\n        var compiled = builder.Build(Database.DefaultConnectionFactory.CreateConnection(ConnectionString)).Compile();\n        return new DynamicDb(compiled);\n    }\n\n    public void TableMappingToBuilder(DbModelBuilder builder)\n    {\n        builder.Configurations.Add(new EntityTypeConfiguration&lt;ConcurrencyTest&gt;());\n        builder.Entity&lt;ConcurrencyTest&gt;().ToTable(\"ConcurrencyTest\", \"dbo\");\n    }\n}\n</code></pre>\n\n<p>and my DbContext CS file:</p>\n\n<pre><code>public class DynamicDb : DbContext\n{\n    public string ConnectionString { get; set; }\n    public DynamicDb(DbCompiledModel model)\n        : base(MyDynamicEntityLayer.ConnectionString, model)\n    {\n        ConnectionString = MyDynamicEntityLayer.ConnectionString;\n        ((IObjectContextAdapter)this).ObjectContext.CommandTimeout = 100;\n    }\n    public DbSet&lt;ConcurrencyTest&gt; ConcurrencyTests { get; set; }\n}\n\npublic class ConcurrencyTest\n{\n    public int ID { get; set; }\n    public string MyColumn { get; set; }\n}\n</code></pre>\n"},{"tags":["c#","entity-framework","partial-classes"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":751,"score":3,"question_id":4786142,"title":"Set extended property via Linq-to-entities","body":"<p>I want retrieve the data, and set property that was added to entityobject(via partial class)  on fly.</p>\n\n<p>How can I do that?</p>\n\n<p>this is my query: </p>\n\n<pre><code>var ret = (from item in contex.Items\n               select new Itemm\n               {   \n                  Title = item.Title,\n                  Count = 1 // more complex: Count =item.refToAnotherEntity.Count()                                          \n               });\n\npublic partial class Itemm \n{\n     public int Count { get; set; }\n}\n</code></pre>\n\n<p>I get error that: The entity or complex type cannot be constructed in a LINQ to Entities query</p>\n"},{"tags":["entity-framework","visual-studio-2012","t4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":173,"score":0,"question_id":12553925,"title":"use a different T4 template while generating EDMX file - VS2012","body":"<p>In VS2012, while using Entity Framework 5.0\nwhen you add an .EDMX file (ADO.NET Data Model) file to your project, VS uses \n<a href=\"http://visualstudiogallery.msdn.microsoft.com/da740968-02f9-42a9-9ee4-1a9a06d896a2\" rel=\"nofollow\">http://visualstudiogallery.msdn.microsoft.com/da740968-02f9-42a9-9ee4-1a9a06d896a2</a>\nto generate the context and the entity classes as well.</p>\n\n<p>But, I would like it to generate the code using the following template instead which generates the context, entity classes and fluent API mapping classes as well.\n<a href=\"http://visualstudiogallery.msdn.microsoft.com/5d663b99-ed3b-481d-b7bc-b947d2457e3c\" rel=\"nofollow\">http://visualstudiogallery.msdn.microsoft.com/5d663b99-ed3b-481d-b7bc-b947d2457e3c</a></p>\n\n<p>Is there a way to associate this second template with the edmx file so that it automatically uses this template and not the one that comes in VS by default.</p>\n\n<p>Currently, I have to manually delete the code generated by first template and then re-generate it again using the newly added template.  I hope there is a cleaner way.</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12566798,"title":"How to filter data in collection using asp.net with EF","body":"<p>I am using EF in my project and i fill my Datagridview  with collection see below...</p>\n\n<pre><code> private void FillGrid()\n        {\n            int ID = Convert.ToInt32(Session[\"testID\"]);\n            var data = dbData.tbltest2.Where(x =&gt; x.ID== ID &amp;&amp; x.testIsDeleted == false &amp;&amp; x.testStatus == 1).ToList();\n            if (data.Count &gt; 0)\n            {\n                grdViewtestList.DataSource = data;\n                grdViewtestList.DataBind();\n                Session[\"JobListData\"] = data;\n            }\n            else\n            {\n                grdViewtestList.DataSource = null;\n                grdViewtestList.DataBind();\n            }\n\n        }\n</code></pre>\n\n<p>i wont to use RowFilter with data which is i fill my Data Gridview . \nso can you please tell me how can i use rowfilter with collection in EF.</p>\n\n<p>anyone please help me it's argent.</p>\n\n<p>thanks in advance.  </p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":66,"score":2,"question_id":12566404,"title":"How can I define how my entity is filled?","body":"<p>Using entity framework (with MVC, but I think that's irrelevant), I'm trying to make an entity that's...extensible.</p>\n\n<p>I have a number of classes that users can label as favorites or bookmarks...there's actually several different objects that utilize this functionality.  The way I currently have this implemented in my model is like this (as an example):</p>\n\n<pre><code>public class Favorite\n{\n   [key]\n   public int FavoriteId {get; set;}\n\n   public int? BikeId {get; set;}\n   public virtual Bike Bike {get;set;}\n\n   public int? HelmetId {get;set;}\n   public virtual Helmet Helmet {get;set;}\n\n   public int? ShoeId {get;set;}\n   public virtual Shoe Shoe{get;set;}\n\n   public int UserId {get;set;}\n   public virtual User User {get;set;}\n}\n</code></pre>\n\n<p>and the bike, helmet, user, and shoe class all resemble this:</p>\n\n<pre><code>public class Bike\n{\n   public int BikeId {get;set;}\n   ...\n   public virtual list&lt;Favorties&gt; Favorites {get;set;}\n}\n</code></pre>\n\n<p>So currently my table looks like this:</p>\n\n<pre><code>Favorites:\n|   Id   |  BikeId  |  HelmetId  | ShoeId   | UserId        |\n|   1    |    5     |            |          | snowburnt     |\n|   2    |    6     |            |          | jonh          |\n|   3    |          |     2      |          | snowburnt     |\n</code></pre>\n\n<p>I would prefer a structure for the favorite object where there is a differentiator column that stores the name of the object being reference as part of a multiple column primary key so that the favorites table looks more like this (I know the user ID isn't an int):</p>\n\n<pre><code>Favorites:\n|   ID    |   Differentiator   |   foreignKeyId    | UserId       |\n|    1    |     Bike           |    5              | snowburnt    |\n|    2    |     Bike           |    6              | john         |\n|    3    |     Helmet         |    2              | snowburnt    |\n</code></pre>\n\n<p>The primary reason for wanting to do this is so that if I have new objects that I want to integrate into favorites I won't have to modify the structure of the favorites object.</p>\n\n<p>The hierarchy should be something like:</p>\n\n<p>Bike, helmet, etc have 0 to many favorites</p>\n\n<p>Is this possible in asp.net entity framework?  How can I do this?  Any good references out there for getting deep into the entity framework?</p>\n\n<p>One note: I've seen the posts here, <a href=\"http://weblogs.asp.net/manavi/archive/2010/12/24/inheritance-mapping-strategies-with-entity-framework-code-first-ctp5-part-1-table-per-hierarchy-tph.aspx\" rel=\"nofollow\">http://weblogs.asp.net/manavi/archive/2010/12/24/inheritance-mapping-strategies-with-entity-framework-code-first-ctp5-part-1-table-per-hierarchy-tph.aspx</a> which would work great...If I had an inheritance situation here (most of the reason I can't have an inheritance situation is that I have multiple classes or interfaces that require the same relationship: favorites, bookmarks, comments, reviews, etc).  It's very probably that I could/should use interfaces for the favorites (make bike, helmet Favoritables).  I haven't found any notes on how that would end up mapping in the SQL Schema (would there even be a favorites table then?)</p>\n"},{"tags":["entity-framework","entity-framework-5","ef-model-first"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":157,"score":3,"question_id":12508031,"title":"Entity Framework 5 model first - Where is IDisposable gone?","body":"<p>In Entity Framework 5 model first, there seem to be some breaking changes due to the way the class files are generated (No more code generation, but T4 templates)</p>\n\n<p>2 examples: </p>\n\n<ul>\n<li>The generated context file doesn't implement IDisposable anymore</li>\n<li>There isn't a constructor which takes a connectionstring anymore </li>\n</ul>\n\n<p>Are there more breaking changes? And what is the solution to them?</p>\n"},{"tags":["entity-framework","database-connection","connection-string","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12568647,"title":"DBcontext, dinamically specify connection string","body":"<p>I'm dealing with a C# application using EntityFramework and an object derived from DbContext.\nI need to set programmatically the connection string when a new instance of MyDbContext object is created. In order to do so I use the following code:</p>\n\n<pre><code>public MyDbContext(string myString)\n{\n    this.Database.Connection.ConnectionString = myString\n}\n\nmyString =  \"Server=MYSERVER\\\\SQLEXPRESS; Database=MyDB; User ID=user; Password=pass;\";\nor\nmyString =  \"Data Source=|DataDirectory|\\\\AirecCalcDatabase.sdf\";\n</code></pre>\n\n<p>The database providers are different for the two strings. SQLExpress for the first one, SQLCompact for the second one.\nIf I try to run this code with the first string, I get ArgumentException coming from the connection string. For example \"Keyword not valid: server\" but also \"Keyword not valid: database\". The connection string works when using the DbContext with no arguments, which is, reading the string from app.config</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":130,"score":1,"question_id":12544441,"title":"Entity Framework using BeginTransaction()","body":"<p>I am trying to implement Entity Framework in my application and i should be able to commit and rollback the changes manually.</p>\n\n<p>First time when i execute the update statement it updates the table successfully and i am able to rollback the changes. <strong>This is correct</strong></p>\n\n<p>But second time when i execute the update statement, it updates the table successfully and also commits the changes. So I am unable to rollback manually. <strong>This is wrong</strong></p>\n\n<p>Please let me know why it is happening and how to solve this issue.</p>\n\n<p>The below code is just sample to reproduce my problem.</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Data.Common;\nusing System.Data;\n\nnamespace EFTest\n{\n    public class DBOperations\n    {\n        NorthwindEntities NorthwindContext;\n        DbTransaction transObject;\n\n        public DBOperations()\n        {\n        }\n\n        public void ConnectDB()\n        {\n            try\n            {\n                if (NorthwindContext == null)\n                {\n                    NorthwindContext = new NorthwindEntities();\n                    if (NorthwindContext != null &amp;&amp; NorthwindContext.Connection.State != ConnectionState.Open)\n                    {\n                        NorthwindContext.Connection.Open();\n                        transObject = NorthwindContext.Connection.BeginTransaction(IsolationLevel.ReadUncommitted);\n                    }\n                }\n            }\n            catch (Exception ex)\n            {\n                throw new Exception(\"Database Error \" + ex.Message);\n            }\n        }\n\n        public int disconnect()\n        {\n            if (NorthwindContext != null &amp;&amp; transObject != null)\n            {\n                try\n                {\n                    transObject.Rollback();\n                }\n                catch (Exception)\n                {\n                }\n                transObject.Dispose();\n                NorthwindContext.Connection.Close();\n                NorthwindContext.Dispose();\n            }\n\n            return 0;\n        }\n\n        public void CommitTransaction()\n        {\n            if (NorthwindContext != null &amp;&amp; transObject != null)\n            {\n                try\n                {\n                    transObject.Commit();\n                }\n                catch (Exception)\n                {\n                }\n            }\n        }\n\n        public void RollbackTransaction()\n        {\n            if (NorthwindContext != null &amp;&amp; transObject != null)\n            {\n                try\n                {\n                    transObject.Rollback();\n                }\n                catch (Exception)\n                {\n                }\n            }\n        }\n\n        public int UpdateDB()\n        {\n            int _returnVal = 0;\n\n\n            try\n            {\n                NorthwindContext.ExecuteStoreCommand(\"UPDATE Orders SET OrderDate = GETDATE() WHERE OrderID = '10248'\");\n            }\n            catch (Exception ex)\n            {\n                throw new Exception(\"Database Error \" + ex.Message);\n            }\n\n            return _returnVal;\n        }\n    }\n\n    public class program\n    {\n        public program()\n        {\n            //Establishing the connection.\n            DBOperations _DBOperations = new DBOperations();\n            _DBOperations.ConnectDB();\n\n            //Update the datebase\n            _DBOperations.UpdateDB();                           //Update the database but it doesn't commit the changes.                       \n\n            //Issue Rollback to rollback the transaction.\n            _DBOperations.RollbackTransaction();                //Successfully Rollbacks the database changes.\n\n\n            //Again Update the datebase\n            _DBOperations.UpdateDB();                           //Update the database it commits the changes. \n\n            //Issue Rollback to rollback the transaction.\n            _DBOperations.RollbackTransaction();                //Rollback fails.\n\n        }\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":142,"score":1,"question_id":12528756,"title":"Master-details style view in MVC 4","body":"<p>I have an ASP.NET MVC 4 internet application with EF.</p>\n\n<p>My model: Orders and OrderDetails:\n<img src=\"http://i.stack.imgur.com/vj0op.jpg\" alt=\"Orders and OrderDetails\"></p>\n\n<p>My View:\n<img src=\"http://i.stack.imgur.com/2AyXN.jpg\" alt=\"Order View\"></p>\n\n<p><strong>Q: How can I display my orderdetails records in my order view?</strong>\n(with or without JS?; in a webgrid or a table?)</p>\n\n<p><em>Create.cshtml</em></p>\n\n<pre><code>    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.OrderDate)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.OrderDate)\n        @Html.ValidationMessageFor(model =&gt; model.OrderDate)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.OrderNo)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.OrderNo)\n        @Html.ValidationMessageFor(model =&gt; model.OrderNo)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Total)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Total)\n        @Html.ValidationMessageFor(model =&gt; model.Total)\n    &lt;/div&gt;\n\n    &lt;div class=\"editor-label\"&gt;\n        @Html.LabelFor(model =&gt; model.Shipping)\n    &lt;/div&gt;\n    &lt;div class=\"editor-field\"&gt;\n        @Html.EditorFor(model =&gt; model.Shipping)\n        @Html.ValidationMessageFor(model =&gt; model.Shipping)\n    &lt;/div&gt;\n    @*OrderDetails Part - Works only on the Edit part*@\n    &lt;table&gt;\n        &lt;tr&gt;\n            &lt;th&gt;Product&lt;/th&gt;\n            &lt;th&gt;Unit Price&lt;/th&gt;\n            &lt;th&gt;Quantity&lt;/th&gt;\n            &lt;th&gt;Discount&lt;/th&gt;\n        &lt;/tr&gt;\n    @foreach (OrderDetails item in Model.OrderDetails.OrderBy(d=&gt;d.Products.ProductName))\n    {\n        &lt;tr&gt;\n            &lt;td&gt;@item.Products.ProductName&lt;/td&gt;\n            &lt;td&gt;@item.UnitPrice&lt;/td&gt;\n            &lt;td&gt;@item.Quantity&lt;/td&gt;\n            &lt;td&gt;@item.Discount&lt;/td&gt;\n            &lt;td&gt;\n                @Html.ActionLink(\"Edit\", \"Edit\", \"OrderDetails\", new { id = item.OrderDetailId }, new { }) |\n                @Html.ActionLink(\"Details\", \"Details\", \"OrderDetails\", new { id = item.OrderDetailId }, new { }) |\n                @Html.ActionLink(\"Delete\", \"Delete\", \"OrderDetails\", new { id = item.OrderDetailId }, new { })\n            &lt;/td&gt;\n        &lt;/tr&gt;  \n    }\n    &lt;/table&gt;\n\n    &lt;p&gt;\n        &lt;input type=\"submit\" value=\"Create\" /&gt;\n    &lt;/p&gt;\n</code></pre>\n"},{"tags":["sql-server","asp.net-mvc-3","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12565885,"title":"Entity Framework on remote existing database","body":"<p>I am trying to upload an MVC project in which I use EF 4 Code First.</p>\n\n<p>I have stumbled upon the problem that I can only create databases over the admin-console, while EF rigorously demands to create the database itself.</p>\n\n<p>How can I make EF use the (already existing, but empty) database I created for it? The connectionstring is correct and it CAN connect, but I get this error:</p>\n\n<pre><code>Model compatibility cannot be checked because the database does not contain\nmodel metadata. Model compatibility can only be checked for databases created\nusing Code First or Code First Migrations.\n</code></pre>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4.1","automapper"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":79,"score":0,"question_id":12566253,"title":"Updating one field in model using MVC 3 and EF","body":"<p><code>Model</code> class</p>\n\n<pre><code>public class product : BaseModel\n    {\n        [key] public string id { get; set; }\n        [Required] public string title { get; set; }\n        [Required] public bool valid { set; get; }\n        public decimal discount { get; set; }\n        public string summery { get; set; }\n        public string icon { get; set; }\n        public DateTime date { get; set; }\n    }\n</code></pre>\n\n<p>in <code>View</code> I just need update <code>title</code> column , \nhere is model code</p>\n\n<pre><code>@using (Html.BeginForm()){\n @Html.HiddenFor(o =&gt; o.id);\n @Html.ValidationSummary(true)\n Title: @Html.EditorFor(model =&gt; model.title)\n @Html.ValidationMessageFor(model =&gt; model.title)\n}\n</code></pre>\n\n<p>in <code>Controller</code> , <code>product</code> lost other values except <code>id</code> and <code>title</code></p>\n\n<p>according to <a href=\"http://stackoverflow.com/questions/12154120/update-single-property-on-ef4-entity-without-having-have-hidden-fields\">this post</a> one of the best solution is creating helper class for this specific form and use <a href=\"http://automapper.org/\" rel=\"nofollow\">AutoMapper</a> to map the helper to original model . but in my case ( over 60 models ) takes extra resources to implement helper classes. is there any better solution ? </p>\n"},{"tags":["asp.net-mvc-3","entity-framework","c#-4.0","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":53,"score":0,"question_id":12565606,"title":"One or zero to many relation without foreign key","body":"<p>I need to configure a relation with following classes:\nUser have or not a profile. Structure:\nUser: UserID, Username, Password\nProfile: UserID, FullName, Address, Phone</p>\n\n<pre><code>public class User\n{\n    #region Feilds\n    public int UserID { get; set; }\n    public string Email { get; set; }\n    public string Password { get; set; }\n    #endregion\n\n    public virtual Profile Profile { get; set; }\n}\n\npublic class Profile\n{\n    #region Fields\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n    public string Phone { get; set; }\n    public string Address { get; set; }\n    #endregion\n\n    public virtual User User { get; set; }\n}\n</code></pre>\n\n<p><strong>Configuration:</strong></p>\n\n<pre><code>public class UserConfiguration : EntityTypeConfiguration&lt;User&gt;\n{\n    public UserConfiguration()\n        : base()\n    {\n        // Primary Key\n        this.HasKey(p =&gt; p.UserID);\n\n        //Foreign Key\n        this.HasOptional(p =&gt; p.Profile).\n            WithMany().\n            HasForeignKey(p =&gt; p.UserID);\n    }\n}\n</code></pre>\n\n<p><strong>Error:</strong></p>\n\n<p>System.Data.Edm.EdmEntityType: : EntityType 'Profile' has no key defined. Define the key for this EntityType.\nSystem.Data.Edm.EdmEntitySet: EntityType: EntitySet Profiles is based on type Profile that has no keys defined.</p>\n\n<p>Please help.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","sql-server","entity-framework","linked-server","openquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":135,"score":0,"question_id":12564327,"title":"Entity Framework v4 - Simple Stored Procedure Select Statement from Linked Server (Open Query) Returning -1","body":"<p>In SQL Server, I have created a stored procedure which fires a simple select statement (with SET NOCOUNT OFF) using Open Query to query data from a linked server. When querying this data in SQL Server, the correct results are brought back, e.g:</p>\n\n<pre><code>SELECT * FROM OPENQUERY(SERVER, ''SELECT * FROM db.table WHERE field = ' + '''' + '''' + @var+ '''' + ''''')'\n</code></pre>\n\n<p>I now have a C# WinForms application that uses Entity Framework v4 to access the data, and want to access this stored procedure in code.</p>\n\n<p>I did the usual 'Update Model from Database' and added the stored procedure, then chose to add a function import (called getData for example).  I then noticed after clicking 'Get Column Information', I received the following message:</p>\n\n<pre><code>'The selected stored procedure returns no columns'\n</code></pre>\n\n<p>At this point I clicked OK and then wrote some simple code to access the SP (as follows):</p>\n\n<pre><code>using(var context = new MyContext())\n{\n    var result = context.getData('paramdata');\n}\n</code></pre>\n\n<p>When stepping through the code, result is set to '-1'.  After doing some reading someone suggested to set NOCOUNT to OFF in the stored procedure which I did but made no difference.</p>\n\n<p>I am not sure why this works from a query in SQL Server but not Entity Framework?</p>\n\n<p>Is there a way I can get this to work?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["asp.net-mvc","entity-framework","domain-driven-design"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12452234,"title":"Use data annonations in ASP.NET MVC using DDD","body":"<p>I've started to develop ASP.NET MVC application using Entity Framework and I wish to use DDD. It's my first time using DDD in ASP.NET (used until now in PHP), so I'm little confused.\nI'm using code-first approach, so I'm creating my entites in the core and then the DbContext in the Infrastructure.</p>\n\n<p>My questions is about data annotations: Is it OK to annonate the entities in the core? with Required, DataType, etc. or I have to create entries with pure C# validation (in the setters and getters) and then create a map objects for the database creation?</p>\n\n<p>For example, I got:</p>\n\n<pre><code>public class Account\n{\n    public string AccountName { get; set; }\n}\n</code></pre>\n\n<p>Can I annonate the AccountName with [Required] or I need to create a map class which will just reflect the exact same properties in the Account class but will have attributes and that will be the class that I'll use in Entity Framework DbContext?</p>\n\n<p>Thanks!</p>\n"},{"tags":["asp.net","sql","asp.net-mvc","entity-framework","email"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12564621,"title":"asp.net mvc mailbox open source","body":"<p>I need to incorporate mailbox functionlity in my asp.net mvc web app. So, I am looking for mailbox source code that i can intergrate with my existing application.  </p>\n\n<p>Please let me know, if you know some open source mailbox module. </p>\n\n<p>thanks,</p>\n"},{"tags":["entity-framework","ef-code-first","fluent-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12564408,"title":"How to find which Table is mapped by fluent API?","body":"<p>I need to find which table is mapped to an EntityTypeConfiguration class.\nFor example:</p>\n\n<pre><code>  public class PersonMap : EntityTypeConfiguration&lt;Person&gt;\n    {\n        public PersonMap()\n        {\n    ...\n            this.ToTable(\"Persons\");\n    ....\n\n        }\n    }\n</code></pre>\n\n<p>I need something like reverse mapping:</p>\n\n<pre><code>var map=new PersonMap(); \nstring table =map.GetMappedTableName();\n</code></pre>\n\n<p>How can I achieve this?</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities","iqueryable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12564236,"title":"LINQ expression node type is not supported in LINQ to Entities","body":"<p>I get an error when I try to run the following query in LINQ to Entities:</p>\n\n<pre><code> var query = DBConn.myView\n                            .Select(dm =&gt; new App.DTOs.MyDTO\n                            {\n                                ID = dm.ID,\n                                Prop1 = dm.Prop1\n                                ....\n                            })\n                            .Where(dm =&gt; dm.TypeID != 4); \n</code></pre>\n\n<p>The Error message is:</p>\n\n<pre><code>LINQ expression node type 'TypeID' is not supported in LINQ to Entities\n</code></pre>\n\n<p>It fails on the <code>.ToList()</code> call:</p>\n\n<pre><code>private List&lt;MyDTO&gt; lstDTO;\nlstDTO = query.ToList();\n</code></pre>\n\n<p>However, if I remove the <code>.Where()</code> from the query, it works. Is there any way to use the <code>Where</code> clause with this query? </p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":78,"score":-1,"question_id":12564123,"title":"MVC 4 Entity Framework multiple insert","body":"<p>Whats best way for that on MVC 4 with Entity Framework.</p>\n\n<p><strong>Example:</strong></p>\n\n<p>We have a form like that. Date will be same for all records. But Pax and Price will be change. And i dont want post that so many times. I need an ADD button for Pax and Price. And Date and Region will be same.</p>\n\n<p>Pax: 1</p>\n\n<p>Price: 500$</p>\n\n<p>Date: DateTime.Now</p>\n\n<p>Region: Location</p>\n\n<p>And im using MVC model and Entity Framework</p>\n\n<p>Im asking <strong>BEST</strong> way. I can do that with my old knowledges. Jquery append and Split at Form Behind my think. Thats true way?</p>\n"},{"tags":["c#","entity-framework","stored-procedures","ef-code-first","table-valued-parameters"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":177,"score":0,"question_id":10540778,"title":"Generating table argument for stored proc accepting table-valued parameter","body":"<p>I'm calling a stored proc that takes table-valued parameter.</p>\n\n<p>I know the following options for passing this parameter: create <code>DataTable</code>, <code>DbDataReader</code>, or <code>IList&lt;SqlDataRecord&gt;</code>.</p>\n\n<p>I'm using <code>IList&lt;SqlDataRecord&gt;</code> (using <code>DataTable</code> is similar), but it involves writing tons of boilerplate code: create collection, set types of each the columns, add rows, set value of each cell.</p>\n\n<p>I think that is exactly the type of code that Entity Framework is supposed to automate. So I hoped to define C# class matching SQL TVP type, add usual EF attributes, create collection of those objects and let EF implement <code>DbDataReader</code> or <code>IList&lt;SqlDataRecord&gt;</code> on top of my collection. But I cannot find any way to do it - e.g. there is <code>EntityDataReader</code>, but that's for reading from SQL - there is no implementation I can find that implements any of the suitable interfaces on top of in-memory collection.</p>\n\n<p>Any suggestions, before I start writing it myself using Reflection?</p>\n"},{"tags":["entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12423162,"title":"Entity Framework - limit results on grandchild fk","body":"<p>I have the following entities mapped in my edmx file which is a mirror of my tables in my DB:\n<br /><br />\nI am only interested in a questionnaire for a particular person.</p>\n\n<p>How can I construct a query that will only bring back one questionnaire for one person so that I can still iterate through it naturally as in:</p>\n\n<p>questionnaire.questionnaire_section.questionnaire_field.questionnaire_data\n<br /></p>\n\n<p><strong>questionnaire</strong><br />\nid<br />\nname<br />\norder_position<br />\nother properties<br /></p>\n\n<p><strong>questionnaire_section</strong><br />\nid<br />\nname<br />\norder_position<br />\nother properties<br />\nquestionnaire_fk<br /></p>\n\n<p><strong>questionnaire_field</strong><br />\nid<br />\nname<br />\norder_position<br />\nother properties<br />\nquestionnaire_fk<br />\nsection_fk<br /></p>\n\n<p><strong>questionnaire_data</strong><br />\nid<br />\nvalue<br />\nother properties<br />\nfield_fk<br />\nquestionnaire_fk<br />\nsection_fk<br />\nperson_pk<br /></p>\n\n<p><strong>person</strong><br />\nid<br />\nname<br />\nfield_fk<br /></p>\n\n<p>Each <strong>questionnaire</strong> has many <strong>questionnaire_sections</strong><br />\nEach <strong>questionnaire_section</strong> has many <strong>questionnaire_fields</strong><br />\nEach <strong>questionnaire_field</strong> has many entries in the <strong>questionnaire_data</strong> entity but \nonly one entry for each person, field, section &amp; questionnaire</p>\n\n<p>Using my navigational properties I can navigate like this:\nquestionnaire.questionnaire_section.questionnaire_field.questionnaire_data</p>\n\n<p>I am only interested in a questionnaire for a particular person.</p>\n\n<p>How can I construct a query that will only bring back 1 questionnaire for one person so that I can iterate through it as follows:</p>\n\n<pre><code>IQueryable&lt;questionnaire&gt; queryResult = from q in _db.questionnaires\n                                        where q.id == 1 //only intrested in 1 questionnaire\n                                        select q;\n\nforeach (questionnaire myQuestionnaire in queryResult)\n{\n    Console.WriteLine(myQuestionnaire.name);\n    foreach (questionnaire_section mySection in myQuestionnaire.questionnaire_section)\n    {\n        Console.WriteLine(mySection.name);\n        foreach (questionnaire_field myField in mySection.questionnaire_field)\n        {\n            Console.WriteLine(myField.name);\n            foreach (questionnaire_data myData in myField.questionnaire_data)\n            {                                    \n                // here I will get the data for all people                      \n                Console.WriteLine(myData.value); \n\n                // I am only intrested in the data for 1 person\n                // so I could do this:\n\n                if (myData.person_fk == 1) \n                // I dont want to bring all the questionnaire_data for each person back from the db.\n                {\n                    Console.WriteLine(myData.value);\n                    // I'm only interested in the questionnaire_data for a single person\n                }\n             }           \n         }\n     }       \n}\n</code></pre>\n"},{"tags":["entity-framework","c#-4.0","asp.net-mvc-2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12560929,"title":"Overload EF Validation with Custom class","body":"<p>I m using Entity Framework, and have one view which is strongly type view model of type tblAuthorMaster. On Post ModelState returns me following error :</p>\n\n<pre>\n\nThe value '0' is not valid for Status.\n\n</pre>\n\n<p>Here Status is of boolen datatype in DB/EF and on view it's dropdown (TEXT=\"active/inactive\", VALUE=\"1/0\"), so whenever i post my form i used to get the above error message.</p>\n\n<p>I have tried some solution to overcome with this issue but it seems not wotking properly. </p>\n\n<p>Following is my code base:</p>\n\n<p>Here tblAuthorMaster is EF Class and AuthorModel is my Custom Class, which i m using for some custom validation and other stuff.</p>\n\n<pre>\n\n    [MetadataType(typeof(AuthorModel))]\n    public partial class tblAuthorMaster { }\n\n    public class AuthorModel\n    {\n        [Required(ErrorMessage = \"*\")]\n        public string AuthorName { get; set; }\n        [Required(ErrorMessage = \"*\")]\n        public bool Status { get; set; }        \n\n    }\n\n</pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12560278,"title":"C# Linq : Group By different columns of different entity","body":"<p>I have three entities ClassC, ClassS and ClassSA. I want to apply group by using LINQ.</p>\n\n<pre><code>using (var db = new SEntities())\n{\n    var result = from c in db.ClassC\n    join s in db.ClassS on c.ID equals s.CID\n    join sa in db.ClassSA on s.SAID equals sa.ID\n    group sa by\n    new { c.Type, s.Date.Year}\n    into g\n    select new ClassSAY { Year = g.Key.Year, CI = g.Key.CIType, Count = g.Count(sa =&gt; sa.ID)};\n}\n</code></pre>\n\n<p>I want to join ClassC, ClassS and ClassSA; group by two different properties of two different classes and store some part of result in another class's properties. I have searched by found group by only one class' properties.</p>\n\n<p>It's giving error:</p>\n\n<ol>\n<li><p>Cannot convert lambda expression to delegate type 'System.Func&lt;SG.DAL.SA,bool&gt;' because some of the return types in the block are not implicitly convertible to the delegate return type</p></li>\n<li><p>Cannot implicitly convert type 'long' to 'bool'</p></li>\n</ol>\n\n<p>Thanks.</p>\n"},{"tags":["c#",".net","entity-framework","ado.net","object-context"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":673,"score":0,"question_id":2097883,"title":"How to delete an asociated object in Entity Framework without having access to the object context","body":"<p>Having two models, Site and Link, where a site has many links, how do I delete a link from inside a method of Site, which doesn't have access to the object context?</p>\n\n<p>I've tried something like:</p>\n\n<pre><code>public void DeleteFirstLink() {\n    var link = LinkSet.First();\n    LinkSet.Remove(link);\n}\n</code></pre>\n\n<p>but it seems that is not really deleting the link, but breaking the association. Since there's a database constraints it throws this error:</p>\n\n<blockquote>\n  <p>A relationship is being added or deleted from an AssociationSet 'Sites_have_Links'. With cardinality constraints, a corresponding 'Links' must also be added or deleted.</p>\n</blockquote>\n\n<p>How do I actually delete the link from the database?</p>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12535380,"title":"EntityRef returns null during SubmitOperation","body":"<p>I am struggling with what appears to be the same problem as posted in <a href=\"http://stackoverflow.com/questions/6318598/silverlight-databinding-entityref\">Silverlight / DataBinding / EntityRef</a>, however, no solution has been given.  I will restate the problem hoping it might spark a solution.</p>\n\n<p>In my Silverlight application, I have two Entity Framework Composite entities: InsuranceProvider and ContactInfo where InsuranceProvider -> ContactInfo.  The properties of ContactInfo are data bound to UI controls which bind and display the data properly until a SubmitOperation is performed on the DataContext for a newly created InsuranceProvider entity (i.e. Entity.EntityState == New).  </p>\n\n<p>I have tracked the problem down (I think) to client side generated code, see below.</p>\n\n<pre><code>    [Association(\"ContactInfo_InsuranceProvider\", \"ContactInfoID\", \"ContactInfoID\", IsForeignKey=true)]\n    [Composition()]\n    [MyCreateEntityAlways()]\n    [XmlIgnore()]\n    public ContactInfo ContactInfo\n    {\n        get\n        {\n            if ((this._contactInfo == null))\n            {\n                this._contactInfo = new EntityRef&lt;ContactInfo&gt;(this, \"ContactInfo\", this.FilterContactInfo);\n            }\n            return this._contactInfo.Entity;\n        }\n        set\n        {\n            ContactInfo previous = this.ContactInfo;\n            if ((previous != value))\n            {\n                this.ValidateProperty(\"ContactInfo\", value);\n                if ((previous != null))\n                {\n                    this._contactInfo.Entity = null;\n                    previous.ContactInfo_InsuranceProviders.Remove(this);\n                }\n                if ((value != null))\n                {\n                    this.ContactInfoID = value.ContactInfoID;\n                }\n                else\n                {\n                    this.ContactInfoID = default(Nullable&lt;int&gt;);\n                }\n                this._contactInfo.Entity = value;\n                if ((value != null))\n                {\n                    value.ContactInfo_InsuranceProviders.Add(this);\n                }\n                this.RaisePropertyChanged(\"ContactInfo\");\n            }\n        }\n    }\n</code></pre>\n\n<p>During the SubmitOperation, the ContactInfo binding is re-evaluated and the statement <code>this._contactInfo.Entity;</code> returns null.  However, once the <code>SubmitOperation</code> completes, inspecting <code>this._contactInfo.Entity;</code> in the debugger reveals that it has the correct data, however, the binding is never again re-evaluated to get the final value. Setting a breakpoint inside the <code>ContactInfo</code> setter method also shows that it is never invoked during the <code>SubmitOperation</code>, which would have caused the <code>RaisePropertyChanged(\"ContactInfo\")</code> notification to be called, allowing the binding to update.  </p>\n\n<p>I still don't know what is causing the <code>ContactInfo</code> binding to re-evaluate in the middle of a <code>SubmitOperation</code> nor why once <code>this._contactInfo.Entity;</code> has valid data in it again that <code>RaisePropertyChanged(\"ContactInfo\")</code> is not invoked.</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":176,"score":0,"question_id":12553973,"title":"Entity Framework 5 Foreign Key New Record on SaveChanges","body":"<p>I'm using .NET4.5/EF5 and have created the model from an existing database.</p>\n\n<p>I'm using the following code:</p>\n\n<pre><code>Order currentOrder = new Order();\nusing (var db = new ILSEntities())\n{\n    try\n    {\n        Event currentEvent = db.Events.OrderByDescending(u =&gt; u.EventID).FirstOrDefault();\n        currentOrder.Event = currentEvent;\n        db.Orders.Add(currentOrder);\n\n        db.SaveChanges();\n</code></pre>\n\n<p>And I'm seeing that a duplicate record is being created of the Event object I find, which is not what I wanted to happen.</p>\n\n<p>I've read a lot of posts relating to similar problems, but where the context of the two participants in the foreign key relationships are different. Here, I'm saving with the same context I use to find one, and the other object is new.</p>\n\n<p>I've also tried:</p>\n\n<pre><code>currentOrder.Event.EventID = currentEvent.EventID;\n</code></pre>\n\n<p>but that fails as well as I get an EF validation error telling me it needs values for the other members of the Event object.</p>\n\n<p>I've also tried specifically setting the <code>EntityState</code> of the object being duplicated to <code>Detached</code>, <code>Modified</code> etc. after adding the <code>Order</code> object but before <code>SaveChanges</code> without success.</p>\n\n<p>I'm sure this is a basic problem, but it's got me baffled</p>\n"},{"tags":["c#","oracle","entity-framework","odp.net"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":762,"score":0,"question_id":11544822,"title":"Cannot see Oracle Data Provider for .NET in Visual Studio 2012 RC","body":"<p>I am  porting a web application to Entity Framework 4.5. My main goal is to support both MSSQL and Oracle databases and be able to tell the ORM which data source to target programmatically (in the Global.asax). The SQL and Oracle schemas are obviously functionally identical; this is an approach we already use in production with another ORM we want to throw away.</p>\n\n<p>NOTE: The machine we are testing it on has Windows 8 Release Preview Build 8400 64 bit, Visual Studio Professional 2012 RC 11.0.50706.0 and .NET framework 4.5.50501. It is not a standard development machine (the others have XP and 7 w/Visual Studio 2010 and .NET 4), but a new one we are using to test these new technologies. I have no idea if any of this new technologies may be the problem, haven't tested it on a \"standard\" dev machine yet.</p>\n\n<p><strong>Short version</strong></p>\n\n<p>I'll explain the situation in detail right below, but the main questions are:</p>\n\n<ol>\n<li>In the \"Add new ADO.NET Entity Data Model\" wizard, I cannot see the ODP.NET data provider I installed (see below) and thus I cannot create a model from an Oracle database. Why? Furthermore, in the \"About Visual Studio\" pop-up I don't see listed Oracle Developer Tools for Visual Studio. My fear is that the Oracle Developer Tools aren't working somehow, but the Oracle Universal Installer said everything was correctly installed (and I rebooted several times).</li>\n<li>What is  the best practise to achieve this requirement?</li>\n</ol>\n\n<p><strong>Long version</strong></p>\n\n<p>First, we created the Entity Data Model from a SQL Server database. So far so good.</p>\n\n<p>Then, we installed ODAC 11.2 Release 4 and Oracle Developer Tools for Visual Studio (11.2.0.3.0) from <a href=\"http://www.oracle.com/technetwork/topics/dotnet/utilsoft-086879.html\" rel=\"nofollow\">http://www.oracle.com/technetwork/topics/dotnet/utilsoft-086879.html</a></p>\n\n<p>I have managed to initialize our model, <code>SIAEntities</code> (which inherites from  <code>ObjectContext</code>), with:</p>\n\n<pre><code>            System.Data.EntityClient.EntityConnectionStringBuilder builder = new System.Data.EntityClient.EntityConnectionStringBuilder();\n        builder.Metadata = \"res://*/SIA.Models.SIAModelOracle.ssdl|res://*/Models.SIAModel.csdl|res://*/Models.SIAModel.msl\";\n        builder.ProviderConnectionString = \"data source=***;persist security info=True;user id=***;password=***\";\n        builder.Provider = \"Oracle.DataAccess.Client\"; \n        SIAEntities db2 = new SIAEntities(builder.ConnectionString);\n</code></pre>\n\n<p>where <code>SIA.Models.SIAModelOracle.ssdl</code> is a custom written file (embedded resource) which overrides the SSDL part of the .edmx and has the following modifications:</p>\n\n<ol>\n<li><code>Provider</code> attribute of the root <code>Schema</code> node set to <code>Oracle.DataAccess.Client</code></li>\n<li>All data type names converted to their Oracle equivalent (datetime > date, nvarchar > varchar2, image > blob, etc)</li>\n<li>An <code>oracle.dataaccess.client</code> node added in the <code>web.config</code> which maps <code>bool</code> to <code>number(1,0)</code> and <code>tinyint</code> to <code>number(3,0)</code></li>\n</ol>\n\n<p>The error arrived when executing the first query (a simple <code>SELECT</code>): I tracked it as being due to the double quotes in the query that gets executed against the db, forcing it to be case-sensitive.</p>\n\n<p>By manually editing the custom .ssdl file and uppercasing everything I can let EF \"see\" the table and recognize a column after the other, but I didn't push this solution too far (thus stopping before getting to read the whole table) because a) it didn't seem too clean b) I have difficulties understanding the links between the .ssdl and the .csdl/.msl parts so I wasn't sure where to uppercase and where not to!</p>\n\n<p>Another strategy I was contemplating to avoid this manual work could be to try and generate a separate model from the Oracle schema and wrap the two <code>ObjectContext</code>s with another class that handles the choice between either of them, but as question #2 says, I cannot do that. </p>\n"},{"tags":["multithreading","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12557988,"title":"Recommended strategy for fetching data asynchornously","body":"<p>Lets say that I need to executed several different queries to database. Each query returns different data. Each query will be executed on a thread different than UI thread.</p>\n\n<p>Should I have one thread for all queries to database, or I can freely have one thread per query? What is the recommended practice?</p>\n"},{"tags":[".net","entity-framework","code-first"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":186,"score":0,"question_id":4587170,"title":"Code First Why can't I see the database which was created","body":"<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"AnalysedCompanies\" \n         connectionString=\"Data Source=|DataDirectory|AnalysedCompanies.sdf\" \n         providerName=\"System.Data.SqlServerCe.4.0\"/&gt;\n&lt;/connectionStrings&gt;\n\npublic class AnalysedCompanies:DbContext\n{\n    public DbSet&lt;CompanyAnalyse.WebServiceLibrary.MinisterulFinantelorData&gt; DateMinisterulFinantelor { get; set; }\n    public DbSet&lt;CompanyAnalyse.WebServiceLibrary.ONRCData&gt; DateONRC { get; set; }\n    public DbSet&lt;CompanyAnalyse.WebServiceLibrary.InsolventaData&gt; DateInsolventa { get; set; }\n    public DbSet&lt;CompanyAnalyse.WebServiceLibrary.Bilant&gt; Bilant { get; set; }\n    public DbSet&lt;CompanyAnalyse.WebServiceLibrary.ContProfitSiPierdere&gt; ContProfitSiPierdere { get; set; }\n    public DbSet&lt;CompanyAnalyse.WebServiceLibrary.DateInformativeBilant&gt; DateInformativeBilant { get; set; }  \n}\n</code></pre>\n\n<p>Why can't I see the sdf file created in the solution explorer? Show all files is active.</p>\n\n<p>The data is saved, because I can retrieve it the next time I run, but I can't see my database that Code First should create.</p>\n"},{"tags":["vb.net","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12556916,"title":"Linq in entity framework","body":"<p>I am having trouble with a select with a select.</p>\n\n<p>The select query in () which is selecting the userid is not liked by the IDE. How do you accomplish a select within a select?</p>\n\n<pre><code>Dim newctx As teckModel.teckEntities\n        Dim pending = From c In newctx.my_aspnet_membership Where c.userId = (From c In newctx.my_aspnet_usersinroles Where c.roleId = 8 Select c.userId) Select c.Email, c.CreationDate, c.LastLoginDate\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","navigation-properties"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":104,"score":2,"question_id":12554577,"title":"Entity Framework - Why are navigation properties selected?","body":"<p>I have a base repository that looks like this:</p>\n\n<pre><code>public class BaseRepository&lt;T&gt; : IBaseRepository&lt;T&gt; where T : class\n{\n    private DbContext _context;\n    private IDbSet&lt;T&gt; _dbSet;\n\n    protected DbContext Context\n    {\n        get\n        {\n            if (_context == null)\n            {\n                EFUnitOfWork currentUnitOfWork = (EFUnitOfWork)UnitOfWork.Current;\n                _context = currentUnitOfWork.Context;\n            }\n\n            return _context;\n        }\n    }\n\n    protected IDbSet&lt;T&gt; DbSet\n    {\n        get\n        {\n            if (_dbSet == null)\n            {\n                _dbSet = Context.Set&lt;T&gt;();\n            }\n\n            return _dbSet;\n        }\n    }\n\n    public void Add(T entity)\n    {\n        DbSet.Add(entity);\n    }\n\n    public void Attach(T entity)\n    {\n        DbSet.Attach(entity);\n    }\n\n    public void Delete(T entity)\n    {\n        DbSet.Remove(entity);\n    }\n\n    public void Update(T entity)\n    {\n        Context.Entry(entity).State = System.Data.EntityState.Modified;\n    }             \n\n    public IQueryable&lt;T&gt; Get(string[] includes=null)\n    {\n        IQueryable&lt;T&gt; set = DbSet;\n        if (includes != null)\n        {\n            foreach (string include in includes)\n            {\n                set = set.Include(include);\n            }\n        }\n        return set;\n    }\n</code></pre>\n\n<ol>\n<li><p><code>User user = _usersRepository.Get().SingleOrDefault(u =&gt; u.Username == \"gigi\");</code>\nThis returns the user without the Roles property, which is ok.</p></li>\n<li><p><code>User user = _usersRepository.Get(new string[] { \"Roles\" }).SingleOrDefault(u =&gt; u.Username == \"gigi\");</code> This returns the user and the Roles property, which is ok.</p></li>\n<li><p><code>List&lt;User&gt; users = _usersRepository.Get().Where(u =&gt; u.Username.StartsWith(\"gi\")).ToList();</code></p></li>\n<li><p><code>List&lt;User&gt; users = _usersRepository.Get(new string[] { \"Roles\" }).Where(u =&gt; u.Username.StartsWith(\"gi\")).ToList();</code></p></li>\n</ol>\n\n<p>Query 3 and 4 both return a list of users with the Roles property.\nWhy is query 3 returns Roles?</p>\n\n<p>LE: This is the call, i examine the users collection after the context is disposed. </p>\n\n<pre><code>            List&lt;User&gt; users = _usersRepository.Get().Where(u =&gt; u.Username.StartsWith(\"gi\")).ToList();\n            UnitOfWork.Current.Dispose();\n</code></pre>\n\n<p>LE2: I did the same thing separately:</p>\n\n<ol>\n<li><pre><code>        List&lt;User&gt; users;\n        using (MyEntities ctx = new MyEntities ())\n        {\n            users= ctx.Users.ToList();\n        }\n</code></pre></li>\n<li><pre><code>            List&lt;User&gt; users;\n            using (MyEntities ctx = new MyEntities ())\n            {\n                users= ctx.Users.Include(\"Roles\").ToList();\n            }\n</code></pre></li>\n</ol>\n\n<p>In the first case the Roles are not loaded, in the second they are which is ok.</p>\n\n<p>I don't see what i am doing wrong in the repository sample.</p>\n\n<p>LE3: This is the Unit of work</p>\n\n<pre><code>    public class UnitOfWork\n    {\n        private const string HTTPCONTEXTKEY = \"Repository.Key\";\n\n        private static IUnitOfWorkFactory _unitOfWorkFactory;\n        private static readonly Hashtable _threads = new Hashtable();\n\n        public static IUnitOfWork Current\n        {\n            get\n            {\n                IUnitOfWork unitOfWork = GetUnitOfWork();\n\n                if (unitOfWork == null)\n                {\n                    _unitOfWorkFactory = ObjectFactory.GetInstance&lt;IUnitOfWorkFactory&gt;();\n                    unitOfWork = _unitOfWorkFactory.Create();\n                    SaveUnitOfWork(unitOfWork);\n                }\n\n                return unitOfWork;\n            }\n        }\n\n        private static IUnitOfWork GetUnitOfWork()\n        {\n            if (HttpContext.Current != null)\n            {\n                if (HttpContext.Current.Items.Contains(HTTPCONTEXTKEY))\n                {\n                    return (IUnitOfWork)HttpContext.Current.Items[HTTPCONTEXTKEY];\n                }\n\n                return null;\n            }\n            else\n            {\n                Thread thread = Thread.CurrentThread;\n                if (string.IsNullOrEmpty(thread.Name))\n                {\n                    thread.Name = Guid.NewGuid().ToString();\n                    return null;\n                }\n                else\n                {\n                    lock (_threads.SyncRoot)\n                    {\n                        return (IUnitOfWork)_threads[Thread.CurrentThread.Name];\n                    }\n                }\n            }\n        }\n\n        private static void SaveUnitOfWork(IUnitOfWork unitOfWork)\n        {\n            if (HttpContext.Current != null)\n            {\n                HttpContext.Current.Items[HTTPCONTEXTKEY] = unitOfWork;\n            }\n            else\n            {\n                lock (_threads.SyncRoot)\n                {\n                    _threads[Thread.CurrentThread.Name] = unitOfWork;\n                }\n            }\n        }\n    }\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first","relational-database"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12552365,"title":"Parent to child connection not wiring up","body":"<p>I've got an EntityFramework based database here created by code first approach. The database contains two tables with a parent-child-relationship between them: </p>\n\n<ol>\n<li><code>Orderlists</code> (based on model <em>\"Orderlist\"</em>)</li>\n<li><code>Orders</code> (based on model <em>\"Order\"</em>)</li>\n</ol>\n\n<p>where Orderlists contains an <em><code>ICollection&lt;Order&gt; Orders</code></em> which should (!) list all related orders. For some reason it doesn't. </p>\n\n<p>The DbContext of the controller contains two DbSets:</p>\n\n<ol>\n<li><code>DbSet&lt;Orderlist&gt;</code></li>\n<li><code>DbSet&lt;Order&gt;</code></li>\n</ol>\n\n<p>The model <em>Order</em> on the other hand has got two properties (with its type in brackets):</p>\n\n<ol>\n<li><code>int OrderlistId</code></li>\n<li><code>Orderlist OrderList</code></li>\n</ol>\n\n<p>In the controller in a [HttpPost] <em>Create</em> method for a new <em>Order</em> object I'm wiring up this relation by picking the appropriate <em>Orderlist</em> object (with the correctly provided/selected ID) from the DbContext, setting <em>OrderlistId</em> and <em>Orderlist</em> of the newly created <em>Order</em> object appropriately and adding the <em>Order</em> to the <em>Orders</em> collection of the picked <em>Orderlist</em> (creating the collection if it is null). </p>\n\n<p>Then I do a <code>db.SaveChages();</code> which does what it's supposed to do. </p>\n\n<p>When the database is generated at first from the code of the models, regarding the relationship only the <em>OrderlistId</em> property generates a field in the datatables. Neither the <em>Orders</em> collection of the <em>Orderlist</em> nor the <em>Orderlist</em> property of the <em>Order</em> generate fields in the tables. That's okay since it is still a valid relation: the ID of the <em>Orderlist</em> is a PK and the <em>OrderlistId</em> value is set correctly. The schemes of the datatables also reflect the relation by foreign keys. </p>\n\n<p>Now, the problem is that the relation isn't restored when processing the data at a different point in my application. The <em>Orders</em> ICollection is <strong>always</strong> <em>null</em> when I pick it from the DbContext.</p>\n\n<p>My question is: should the <strong>Orders</strong> <code>ICollection</code> be filled automatically when creating the <code>DbContext</code> object? Or do I have to fill it manually by iterating through the Orders <code>DbSet</code> of the <code>DbContext</code> and add every appropriate Order manually to its related Orderlist? And, if I have to, where and how do I have to do that?</p>\n"},{"tags":["c#","linq","entity-framework","lambda"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12554713,"title":"Immediate execution with EF","body":"<p>I have this code that executes a Stored Procedure mapped via EF EDM.</p>\n\n<pre><code>meTest&lt;MCTEntities, ObjectResult&lt;retrieveMedia_Result&gt;&gt;(u =&gt; u.retrieveMedia(campaign_id: 1), ConnectionResolver.MCT_DB_Connection);\n</code></pre>\n\n<p>The method:</p>\n\n<pre><code>public static TValue meTest&lt;U, TValue&gt;(Func&lt;U, TValue&gt; func, String connection)\n            where U : ObjectContext, new()\n        {\n            using (U entitiesContext = (U)Activator.CreateInstance(typeof(U), new[] { connection }))\n            {\n                return func(entitiesContext);\n            }\n    }\n</code></pre>\n\n<p>The issue is that retrieveMedia returns <code>ObjectResult&lt;retrieveMedia_Result&gt;</code> and this is done with deferred execution that results in error: <code>Calling 'Read' when the data reader is closed is not a valid operation.</code></p>\n\n<p>Now, I know that I can call ToList() or ToArray(), but is there any other way to force immediate execution? </p>\n\n<p><strong>I am not sure that casting <code>ObjectResult&lt;retrieveMedia_Result&gt;</code> to <code>List&lt;retrieveMedia_Result&gt;</code> is the right thing to do.</strong></p>\n"},{"tags":["asp.net","mysql","asp.net-mvc","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":339,"score":2,"question_id":12546545,"title":"Unable to Retrieve Metadata","body":"<p><strong>MVC4 + Entity Framework 4.4 + MySql + POCO/Code First</strong></p>\n\n<p>I'm setting up the above configuration .. here are my classes:</p>\n\n<pre><code>namespace BTD.DataContext\n{\npublic class BTDContext : DbContext\n{\n\n    public BTDContext()\n        : base(\"name=BTDContext\")\n    {\n\n    }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        base.OnModelCreating(modelBuilder);\n\n        //modelBuilder.Conventions.Remove&lt;System.Data.Entity.Infrastructure.IncludeMetadataConvention&gt;();\n    }\n\n    public DbSet&lt;Product&gt; Products { get; set; }\n\n    public DbSet&lt;ProductImage&gt; ProductImages { get; set; }        \n\n\n}\n}\n\nnamespace BTD.Data\n{\n[Table(\"Product\")]\npublic class Product\n{\n    [Key]\n    public long ProductId { get; set; }\n\n    [DisplayName(\"Manufacturer\")]\n    public int? ManufacturerId { get; set; }\n\n    [Required]\n    [StringLength(150)]\n    public string Name { get; set; }\n\n    [Required]\n    [DataType(DataType.MultilineText)]\n    public string Description { get; set; }\n\n    [Required]\n    [StringLength(120)]\n    public string URL { get; set; }\n\n    [Required]\n    [StringLength(75)]\n    [DisplayName(\"Meta Title\")]\n    public string MetaTitle { get; set; }\n\n    [DataType(DataType.MultilineText)]\n    [DisplayName(\"Meta Description\")]\n    public string MetaDescription { get; set; }\n\n    [Required]\n    [StringLength(25)]\n    public string Status { get; set; }\n\n    [DisplayName(\"Create Date/Time\")]\n    public DateTime CreateDateTime { get; set; }\n\n    [DisplayName(\"Edit Date/Time\")]\n    public DateTime EditDateTime { get; set; }\n}\n\n[Table(\"ProductImage\")]\npublic class ProductImage\n{\n    [Key]\n    public long ProductImageId { get; set; }\n\n    public long ProductId { get; set; }\n\n    public long? ProductVariantId { get; set; }\n\n    [Required]\n    public byte[] Image { get; set; }\n\n    public bool PrimaryImage { get; set; }\n\n    public DateTime CreateDateTime { get; set; }\n\n    public DateTime EditDateTime { get; set; }\n\n}\n}\n</code></pre>\n\n<p><strong>Here is my web.config setup...</strong></p>\n\n<pre><code>&lt;connectionStrings&gt;\n&lt;add name=\"BTDContext\" connectionString=\"Server=localhost;Port=3306;Database=btd;User Id=root;Password=mypassword;\" providerName=\"MySql.Data.MySqlClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<ol>\n<li>The database AND tables already exist...</li>\n<li>I'm still pretty new with mvc but was using <a href=\"http://dotnetspeak.com/index.php/2010/10/developing-asp-net-mvc-3-application-with-ef-ctp-part-1/\" rel=\"nofollow\">this tutorial</a></li>\n</ol>\n\n<p>The application builds fine... however when I try to add a controller using Product (BTD.Data) as my model class and BTDContext (BTD.DataContext) as my data context class I receive the following error:</p>\n\n<blockquote>\n  <p>Unable to retrieve metadata for BTD.Data.Product using the same\n  DbCompiledModel to create context against different types of database\n  servers is not supported. Instead, create a separate DbCompiledModel\n  for each type of server being used.</p>\n</blockquote>\n\n<p>I am at a complete loss - I've scoured google with almost every different variation of that error message above I can think of but to no avail. </p>\n\n<p><strong>Here are the things i can verify...</strong></p>\n\n<ol>\n<li>MySql is working properly</li>\n<li>I'm using MySql Connector version 6.5.4 and have created other ASP.net web forms + entity framework applications with ZERO problems</li>\n</ol>\n\n<p><strong>I have also tried including/removing this in my web.config:</strong></p>\n\n<pre><code>&lt;system.data&gt;\n&lt;DbProviderFactories&gt;\n  &lt;remove invariant=\"MySql.Data.MySqlClient\"/&gt;\n  &lt;add name=\"MySQL Data Provider\" invariant=\"MySql.Data.MySqlClient\" description=\".Net Framework Data Provider for MySQL\" type=\"MySql.Data.MySqlClient.MySqlClientFactory, MySql.Data, Version=6.5.4.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d\" /&gt;\n&lt;/DbProviderFactories&gt;\n</code></pre>\n\n<p></p>\n\n<p>I've literally been working on this bug for days - I'm to the point now that I would be willing to pay someone to solve it.. no joke... I'd really love to use MVC 4 and Razor - I was so excited to get started on this, but now i'm pretty discouraged - I truly appreciate any help/guidance on this!</p>\n\n<p>Also note - i'm using Entityframework from Nuget...</p>\n\n<p><strong>Another Note</strong></p>\n\n<p>I was using the default visual studio template that creates your MVC project with the account pages and other stuff. I JUST removed all references to the added files because they were trying to use the \"DefaultConnection\" which didn't exist - so i thought those files may be what was causing the error - however still no luck after removing them - </p>\n\n<p>I just wanted to let everyone know i'm using the visual studio MVC project template which pre-creates a bunch of files. I will be trying to recreate this all from a blank MVC project which doesn't have those files - i will update this once i test that</p>\n\n<p><strong>UPDATE TO USING VS MVC Basic Template:</strong> Same error resulted - still no solution</p>\n\n<p><strong>ANOTHER PERSON EXPERIENCING THE SAME PROBLEM</strong></p>\n\n<p><a href=\"http://stackoverflow.com/questions/12165185/mvc4-scaffolding-add-controller-gives-error-unable-to-retrieve-metadata?rq=1\">Right here is another stackoverflow question that mimics mine</a> - however I tried his solution to no avail - maybe someone else who is having this same problem can benefit from the link</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I recently just tried putting this into MS Sql Server and the view scaffolding adds fine with no error - so I'm not sure if its my MySql database or connection string or what... driving me nuts..</p>\n\n<p><strong>Other References</strong></p>\n\n<p>It appears someone else is having the same issues I am - the only difference is they are using sql server - I tried tweaking all my code to follow the suggestions on <a href=\"http://stackoverflow.com/questions/12172074/add-controller-in-mvc4-not-working\">this stackoverflow question/answer here</a> but still to no avail</p>\n\n<p><strong>POSSIBLE FIX???</strong></p>\n\n<p>So this is weird... after hooking it up to MS Sql Server and adding the controller, then reverting the connection string to MySql it is actually WORKING with MySql... what the heck!?? </p>\n\n<p>So it seems that when you try to add your controller and the view scaffolding (is that the right phrase?) is added WITH the mysql connection string it fails...however if you hook it up to a sql server db, generate the scaffolding/controller, then revert to mysql connection string it works.... ?!?!</p>\n"},{"tags":["c#",".net","entity-framework","nhibernate","orm"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":110,"score":3,"question_id":12554213,"title":"Does the \"session per request\" pattern take advantage of the cache? (\"Session per session\" or \"Session per request\")","body":"<p>I build a new application from scratch this days in a web application.<br>\n(The technologies  are <code>Asp.Net</code> and the ORM I'm using is <code>Entity Framework</code>. if it matters)</p>\n\n<p>I'm uncertain if the widely used pattern <strong><em>session per request</em></strong> is really a good one.<br>\nAs I see it, the advantage of the pattern is that the cache isn't increases until the database session crash\\ being too big and thus inefficient.</p>\n\n<p>But isn't a new session for every request is too much? It means every server call reset the cache, even simple ajax request like auto-complete has a brand new cache, in fact for every key stroke the cache resets.</p>\n\n<p>The chances you will query the same object-entity-row in one request is small.</p>\n\n<p>Isn't <strong><em>Session per session</em></strong> is a better pattern? it has both the advantages meaning</p>\n\n<ol>\n<li>The cache won't grow for ever.</li>\n<li>The cache can actually be used...</li>\n</ol>\n\n<p>So... <strong>Why is <em>session per request</em> is so widely used and <em>session per session</em> is not?</strong></p>\n\n<hr>\n\n<p>Clarifications:</p>\n\n<ol>\n<li>When I wrote ORM session it applies both to <code>NHibernate's session</code> and <code>EntityFramework's DbContext</code>. </li>\n<li>I do  mean to flush-commit-SaveChanges of the session\\dbcontext on each request.</li>\n</ol>\n"}]}
{"total":18927,"page":18,"pagesize":100,"questions":[{"tags":["c#","performance","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":89,"score":2,"question_id":12532692,"title":"High lock contention and slow performance on ToList() with EF4","body":"<p>I've got a project that uses EF4 (System.Data.Entities, no nuget package) and hits the context directly for LINQ queries. Whenever I load-test by having multiple users log in (using VS test load testing), I get horrible performance, my CPU shoots to 100%, and VS.NET throws alerts on high .NET lock contention and high garbage collection.</p>\n\n<p>In doing a good deal of profiling and tweaking, everything seems to point to the execution of the LINQ query itself (to be expected to some degree), and an incredible amount of contention on the .ToList() call we make in a bunch of places on the results.</p>\n\n<p>Has anyone experienced this? What's the cause and how do I resolve this? Do I need to thread out the .ToList() call for some reason?</p>\n\n<p>UPDATE:\nA few people have asked for more details.. Here is the code in question (tweaked a bit to remove stuff I can't release).</p>\n\n<pre><code>var query =\n            from f in context.fs\n            where f.usr.Any((u) =&gt; u.id == id)\n            select new\n            {\n                FS = f,\n                f.fList,\n                E = from e in f.fList select new { e.er },\n                L = from l in f.fList select new { l.id }\n            };\n    var res = query.ToList();\n</code></pre>\n\n<p>Under heavy load this same code runs on multiple threads (profiler says 13). The ToList() call is absolute murder, and accounts for nearly all the delays.</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12553882,"title":"Entity Framework System.ObjectDisposedException","body":"<p>I am doing this:</p>\n\n<pre><code>User user = _usersRepository.SingleOrDefault(u =&gt; u.Username == \"gigi\", new string[] { \"Roles\" });\nUnitOfWork.Current.Dispose();\n</code></pre>\n\n<p>and i don't get the roles associated to that user, i get that System.ObjectDisposedException.</p>\n\n<p>If instead of doing that repository call , i simply do:</p>\n\n<pre><code>            User user;\n            using (MyEntities ctx = new MyEntities ())\n            {\n                user = ctx.Users.Include(\"Roles\").SingleOrDefault(u =&gt; u.Username == \"gigi\");\n            }\n</code></pre>\n\n<p>i do get the roles.\nWhat am i missing?</p>\n\n<p>LE:This is how my base repository looks like:</p>\n\n<pre><code>    public class BaseRepository&lt;T&gt; : IBaseRepository&lt;T&gt; where T : class\n    {\n        private DbContext _context;\n        private IDbSet&lt;T&gt; _dbSet;\n\n        protected DbContext Context\n        {\n            get\n            {\n                if (_context == null)\n                {\n                    EFUnitOfWork currentUnitOfWork = (EFUnitOfWork)UnitOfWork.Current;\n                    _context = currentUnitOfWork.Context;\n                }\n\n                return _context;\n            }\n        }\n\n        protected IDbSet&lt;T&gt; DbSet\n        {\n            get\n            {\n                if (_dbSet == null)\n                {\n                    _dbSet = Context.Set&lt;T&gt;();\n                }\n\n                return _dbSet;\n            }\n        }\n\n        public void Add(T entity)\n        {\n            DbSet.Add(entity);\n        }\n\n        public void Attach(T entity)\n        {\n            DbSet.Attach(entity);\n        }\n\n        public void Delete(T entity)\n        {\n            DbSet.Remove(entity);\n        }\n\n        public void Update(T entity)\n        {\n            Context.Entry(entity).State = System.Data.EntityState.Modified;\n        }\n\n        public T SingleOrDefault(Expression&lt;Func&lt;T, bool&gt;&gt; where, string[] includes=null)\n        {            \n            if (includes != null)\n            {\n                foreach (string property in includes)\n                {\n                    DbSet.Include(property);\n                }\n            }\n            return DbSet.SingleOrDefault(where);\n        }\n\n        public IQueryable&lt;T&gt; Get(Expression&lt;Func&lt;T, bool&gt;&gt; where, string[] includes=null)\n        {\n            if (includes != null)\n            {\n                foreach (string property in includes)\n                {\n                    DbSet.Include(property);\n                }\n            }\n            return DbSet.Where(where);\n        }\n    }\n</code></pre>\n"},{"tags":["entity-framework","ef-code-first","poco","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12553639,"title":"EF CodeFirst: Get all POCO types for DbContext","body":"<p>Is there any way to get POCO's types from specified DbContext instance?</p>\n"},{"tags":["entity-framework","save","savechanges"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":519,"score":2,"question_id":3240839,"title":"Entity Framework - Initial Save is slow","body":"<p>We are implementing a system using EF4 and WPF.  We are noticing an issue with the initial saving of data: when the initial SaveChanges is run there is a 4 to 6 second delay when context.SaveChanges() command is run. Every subsequent SaveChanges is very fast with no noticable delay. This is not a major issue - but an annoyance none-the-less.</p>\n\n<p>Has anyone out there experienced this issue and know a way around it?  </p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12552696,"title":"Entity Framework 4 many to many relationship issue","body":"<p>Considering this database:\n<img src=\"http://i.stack.imgur.com/eLQtT.png\" alt=\"enter image description here\"></p>\n\n<p>This is what EF generates:\n<img src=\"http://i.stack.imgur.com/qsk2Q.png\" alt=\"enter image description here\"></p>\n\n<p>I think that HeroesItem class, is useless, and there should be a navigation property Items on Hero class and a navigation property Heroes on Item class.</p>\n\n<p>I saw this can be done easily with code first, but how to get it done using database first?</p>\n"},{"tags":["entity-framework","stored-procedures","join"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12553319,"title":"Stored procedures with joined data in entity framework","body":"<p>We currently have a system with quite large database and stored procedures are used both for CUD and querying. DataSets are used to retrieve the results from the SP querys.</p>\n\n<p>Now we are looking into developing another project against the same database using Entity Framework. When querying the database, the stored procedures often perform a lot of joins to gather some fields not in the target table, but data from the joined tables that is needed by the client in some way. When using DataSets, all the fields returned by the SP was included in the DataTable. So the DataTable doesn't actually match the target database table.</p>\n\n<p>What is the correct way of handling this scenario in EF? When creating my model, the entities are mapped to each table which as mentioned above only sometimes matches the result of the SP. Can I add the \"additional\" fields of the SP query result to the entity class as properties and have them filled by the query but with these properties being excluded when it comes to CUD on the specific entity type? Seems like the EF-way, if queried through LINQ to Entities and not SPs, would be to have entity instances with relational properties to the joined entities so that using those \"additional\" properties would be done by navigating the relational properties?</p>\n"},{"tags":["entity-framework","entity-framework-4","asp.net-mvc-4","asp.net-web-api","json.net"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12553116,"title":"Entity framework doesn't generate JsonIgnoreAttribute","body":"<p>I'm trying to return from MVC 4 web api ApiController objects generated from entity framework 4 edmx, with accept:json/application.</p>\n\n<p>The problem is json formatter returns also the Navigation Properties, which I don't want to return (I want to return only the Primitive Properties).</p>\n\n<p>So I've looked in the entity framework 4 code generated, in the Navigation Properties, and there are only XmlIgnoreAttribute and SoapIgnoreAttribute while I need JsonIgnoreAttribute.</p>\n\n<p>I cannot change the code generated because it will be overwritten in the next change to the edmx, \nso how can I configure that the model generation will be produced with JsonIgnoreAttribute?</p>\n\n<p>Thank you</p>\n"},{"tags":["mysql","linq","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12553046,"title":"Mysql / Entity Framework performance issue on order by","body":"<p>We have a InnoDB table on MySQL 5.5 with close to 10 million records, no foreign keys, and proper indexes for queries we do. We are using the latest 6.5.4 MySQL release for the .NET Entity Framework 5.</p>\n\n<p><strong>EF LINQ Query</strong></p>\n\n<pre><code>var failsForAcct1001 = db.Failures.Where(x =&gt; x.AccountId == 1001);\nreturn failsForAcct1001.OrderBy(x =&gt; x.FailureId).Take(50);\n</code></pre>\n\n<p><strong>MySQL Code Generated</strong></p>\n\n<p>Please ignore the column names they aren't nessisary to understand the problem</p>\n\n<pre><code>select\n    External1.FailureId,\n    External1.col2,\n    External1.col3,\nfrom (select\n          Inner1.FailureId,\n          Inner1.col2,\n          Inner1.col3,\n      from Failures Inner1\n      where External1.AccountId = 1001\n    ) External1\norder by External1.FailureId\nlimit 50\n</code></pre>\n\n<p>This SQL being generated is very similar to what happens in SQL Server, and SQL handles it with out a problem. And this isn't just an Entity Framework issue, when I take this query and execute in MySQL Workbench it also times out. However the following query returns in under a half second.</p>\n\n<pre><code>select\n    External1.FailureId,\n    External1.col2,\n    External1.col3,\nfrom Failures External1\nwhere External1.AccountId = 1001\norder by External1.FailureId\nlimit 50\n</code></pre>\n\n<p>I assume this performance problem has to do with the fact that MySQL is trying to execute the inner query which pulls back all the records in the database and then tries to sort and take 50, instead of doing this all as one operation like the second query does.</p>\n\n<p>I really just want to confirm my observations, and ask if there is anything I can do to get the first SQL statement to execute faster, without modifying the query in any way.</p>\n"},{"tags":["entity-framework","orm","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12543626,"title":"Usage of EF 4.1 Mapper classes","body":"<p>I'm using <a href=\"http://visualstudiogallery.msdn.microsoft.com/72a60b14-1581-4b9b-89f2-846072eff19d\" rel=\"nofollow\">EF Power Tools</a> to generate POCO classes from the database that already exists.\nIt generates a class and a mapper class, for example:\nclass Person\nclass PersonMapper\nSince I'm using reverse code first, do I really need mapper classes?\nI need DB table name and column names and they're generated in Mapper class. \nShould I move them as attributes to POCO class?</p>\n"},{"tags":["entity-framework","entity-framework-4"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":448,"score":2,"question_id":6470157,"title":"What is the difference between a Navigation Property and an Association in EF?","body":"<p>I use EF4.</p>\n\n<p>Hope my question is not to trivial:</p>\n\n<pre><code>What is the difference between a Navigation Property and an Association in EF?\n</code></pre>\n\n<p>If you could give me a simple explanation with an example would be great thanks!</p>\n"},{"tags":["asp.net","sql-server","entity-framework","history"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12410017,"title":"Entity framework - history table","body":"<p>I have the following 2 tables defined in a SQL Server database:</p>\n\n<pre><code>create table Project\n(\nId int,\nName varchar(100)\nIdIdentity int\n)\n\ncreate table ProjectHistory\n(\nId int,\nName varchar(100)\nIdIdentity int,\nDtChange datetime\n)\n</code></pre>\n\n<p>When I updated \"Project\" I would like to insert new record to table <code>ProjectHistory</code> with setting <code>DtChange</code> to actual date.</p>\n\n<p>I use Entity Framework 4.1. Can you suggest me some way how this can be accomplished?\nThere is possibility change sql that generate Entity Framework when saving changes.</p>\n"},{"tags":["asp.net-mvc","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12545565,"title":"Find a record in dbSet using Find without a primary key","body":"<p>I have a users table:</p>\n\n<pre><code>Users:\n +ID\n +Username\n +...\n</code></pre>\n\n<p>I want to use <code>myDBContext.Users.Find(Username)</code> to fin a users.\nin my current context I can not use his ID.</p>\n\n<p>do i have to use a full LINQ query ? e.g.</p>\n\n<pre><code>var user = from users in myDBContext.Users.Find(Username) \n           where users.Username == username\n           select users\n</code></pre>\n\n<p>I have also tried to define the username as a primary key in my edmx but that resulted in the following error:</p>\n\n<blockquote>\n  <p>Properties referred by the Principal Role User must be exactly\n  identical to the key of the EntityType\n  CamelotShiftManagementModel.User referred to by the Principal Role in\n  the relationship constraint for Relationship\n  CamelotShiftManagementModel.AssociationUserFK1. Make sure all the key\n  properties are specified in the Principal\n  Role. C:\\Code\\CamelotShiftManagement\\CamelotShiftManagement\\Models\\CamelotDB.edmx 278 11  CamelotShiftManagement</p>\n</blockquote>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-4"],"answer_count":4,"favorite_count":4,"up_vote_count":8,"down_vote_count":0,"view_count":206,"score":8,"question_id":12500085,"title":"Model Ownership Checking - MVC4","body":"<p><strong>ASP.NET 4.5 / MVC4 / C# / EF 5.0 &amp; POCO Code First Models</strong></p>\n\n<p>I built a prototype for a website and have been working on tightening things up a bit.</p>\n\n<p>My current concern is with ownership checking, for example, in my controller before a model is updated or deleted I make sure the user that is performing the action actually owns the object they are trying to modify.</p>\n\n<p>I am currently doing this at the method level and it seems a bit redundant.</p>\n\n<pre><code>    [HttpPost]\n    public ActionResult Edit(Notebook notebook)\n    {\n        if (notebook.UserProfileId != WebSecurity.CurrentUserId) { return HttpNotFound(); }\n\n        if (ModelState.IsValid)\n        {\n            db.Entry(notebook).State = EntityState.Modified;\n            db.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n        return View(notebook);\n    }\n</code></pre>\n\n<p>Is there a better place or way of checking the UserProfileID with the current users ID or perhaps a more generic way of doing this that could be a bit more reusable across various models?</p>\n\n<p>I thought about creating a custom action filter to do this checking but wanted to get some opinions from everyone here before I start pushing forward.</p>\n\n<p>Are they any pros/cons to the approach I am using now?</p>\n\n<p>I am open to any ideas or suggestions!</p>\n\n<p>Thanks for reading!</p>\n"},{"tags":["entity-framework","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12549296,"title":"How does EF codefirst know which model class to create a table for?","body":"<p>I was not able to find the answer to this online - please link me if I've overlooked any resources.</p>\n\n<p>I understand how Entity Framework's codefirst works.  The question is: how does EF know which model class to create a table for and which model class to just treat as a class?</p>\n\n<p>For example, in the sample MVC4 application that comes from creating a new MVC project with VS 2012 Express Developer, there are classes (LocalPasswordModel, LoginModel, RegisterModel, etc) in the Account Model that have no tables, and EF knows not to generate tables for these classes.  </p>\n\n<p>How does EF know this?</p>\n"},{"tags":["c#","asp.net","sql-server","asp.net-mvc-3","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12549258,"title":"Creating Model(s) for data found in two tables and profile properties? ","body":"<p>I've only been working with Asp.Net MVC 3 for a few months now so fairly new to the MVC pattern. Have worked with .net and C# for years.</p>\n\n<p>I am confused as the best way to go about creating the models needed for my situation. I am creating a news posting site and am working on the actual post data itself. I have a NPost table in the database that has the post's data like Title, Body, UserId, CreationDate, etc. I am also using the build in Forms Authentication with the tables auto generated for it as well as use with the profile properties for data such as name, and avatar picture.</p>\n\n<p>You should also know I am using EntityFramework and Reverse Engineer Code First to generate the models I have been using so far.</p>\n\n<p><strong>My Question:</strong> How do I connect the post with the author? </p>\n\n<p>Before I would have just joined the tables on the UserId in a stored proc and connected it with a control using a data source, but I am confused as the best way to do it in MVC.</p>\n\n<p>Thanks for any and all help you can give me!</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":112,"score":1,"question_id":12548957,"title":"LINQ to Entity Association not working as expected","body":"<p>I have a class WorkOrder that can have multiple comments associated with it:</p>\n\n<pre><code>  [System.Data.Linq.Mapping.Table( Name = \"WorkOrders\" )]\n  public class WorkOrder\n  {\n    [System.Data.Linq.Mapping.Column( IsPrimaryKey = true, IsDbGenerated = true, DbType = \"INT NOT NULL IDENTITY(10000,1)\", Name = \"ID\" )]\n    public int ID { get; set; }\n\n    private EntitySet&lt;Comment&gt; _Comments = new EntitySet&lt;Comment&gt;();\n    [System.Data.Linq.Mapping.Association( Storage = \"_Comments\", ThisKey = \"ID\", OtherKey=\"ItemID\", IsForeignKey = false )]\n    public EntitySet&lt;Comment&gt; Comments\n    {\n      get { return this._Comments; }\n      set { this._Comments.Assign( value ); }\n    }\n\n    ...\n  }\n</code></pre>\n\n<p>And the Comment class</p>\n\n<pre><code>  [System.Data.Linq.Mapping.Table( Name = \"Comments\" )]\n  public class Comment\n  {\n    [System.Data.Linq.Mapping.Column( IsPrimaryKey = true, IsDbGenerated = true, DbType = \"INT NOT NULL IDENTITY(10000,1)\", Name = \"ID\" )]\n    public int ID { get; set; }\n\n    [System.Data.Linq.Mapping.Column( DbType = \"INT NOT NULL\", CanBeNull = false, Name = \"ItemID\" )]\n    public int ItemID { get; set; }\n\n    ...\n  }\n</code></pre>\n\n<p>There is no foreign key between WorkOrders and Comments because I intend to have a collection of Comments for other objects as well. The association is always between the ID column of the parent class and the ItemID of the Comment class.</p>\n\n<p>Whenever I try to query from the Comments table using LINQ to Entity:</p>\n\n<pre><code>from comment in db.Comments\nwhere comment.DeletedDate == null\n   &amp;&amp; comment.ItemID == id\nselect comment\n</code></pre>\n\n<p>I receive the following error:</p>\n\n<blockquote>\n  <p>Invalid column name 'WorkOrder_ID'.</p>\n</blockquote>\n\n<p>WorkOrder_ID is not part of my database or part of my model classes. I believe this column is being added to each query because of the association between WorkOrder and Comment. This is obviously not what I want to happen.</p>\n\n<p>Is there any way to do what I've described? What have I done wrong to create this error?</p>\n\n<p><strong>Update:</strong>\nChanging my WorkOrder class a little:</p>\n\n<pre><code>[NotMapped]\npublic Comment[] Comments\n{\n  get\n  {\n    return DBContext.GetCommentsForItem( this.ID );\n  }\n}\n</code></pre>\n\n<p>Solved my problem. I'm still not clear what I did wrong here.</p>\n"},{"tags":["entity-framework","entity","ado"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4103,"score":0,"question_id":2666601,"title":"Why is this Exception?- The relationship between the two objects cannot be defined because they are attached to different ObjectContext objects","body":"<p>I m getting this Exception-\"The relationship between the two objects cannot be defined because they are attached to different ObjectContext objects.\"</p>\n\n<p>I ve user table and country table. The countryid is referred in user table.</p>\n\n<p>I am getting the above Exception when I am trying to add entry in user table.</p>\n\n<p>This is my code-</p>\n\n<pre><code>using (MyContext _db = new MyContext ())    \n{                \n    User user = User .CreateUser(0, Name, address, city, 0, 0, email, zip); \n\n    Country country = _db.Country.Where(\"it.Id=@Id\", new ObjectParameter(\"Id\",countryId)).First(); \n\n    user.Country = country;\n\n    State state = _db.State.Where(\"it.Id=@Id\", new ObjectParameter(\"Id\", stateId)).First(); \n\n    user.State = state;\n\n    _db.AddToUser(user );//Here I am getting that Exception\n\n    _db.SaveChanges();    \n}\n</code></pre>\n"},{"tags":["c#","entity-framework","database-migration"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12547835,"title":"Can't update database using EF migration","body":"<p>My connectionString:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n  &lt;add name=\"ClimateContext\" \n       connectionString=\"Data Source=|DataDirectory|\\db.sdf\" \n       providerName=\"System.Data.SqlServerCe.4.0\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>Current migration class:</p>\n\n<pre><code>  public partial class add : DbMigration\n    {\n        public override void Up()\n        {\n            CreateTable(\n                \"dbo.Conditioner\",\n                c =&gt; new\n                    {\n                        Id = c.Int(nullable: false, identity: true),\n                        Name = c.String(maxLength: 4000),\n                    })\n                .PrimaryKey(t =&gt; t.Id);\n\n        }\n\n        public override void Down()\n        {\n            DropTable(\"dbo.Conditioner\");\n        }\n    }\n</code></pre>\n\n<p>And update-database:</p>\n\n<pre><code>   PM&gt; update-database -Verbose\nUsing StartUp project 'Climate'.\nUsing NuGet project 'Climate'.\nSpecify the '-Verbose' flag to view the SQL statements being applied to the target database.\nTarget database is: '|DataDirectory|\\db.sdf' (DataSource: |DataDirectory|\\db.sdf, Provider: System.Data.SqlServerCe.4.0, Origin: Configuration).\nApplying code-based migrations: [201209222056583_add].\nApplying code-based migration: 201209222056583_add.\nCREATE TABLE [Conditioner] (\n    [Id] [int] NOT NULL IDENTITY,\n    [Name] [nvarchar](4000),\n    CONSTRAINT [PK_dbo.Conditioner] PRIMARY KEY ([Id])\n)\nCREATE TABLE [__MigrationHistory] (\n    [MigrationId] [nvarchar](255) NOT NULL,\n    [Model] [image] NOT NULL,\n    [ProductVersion] [nvarchar](32) NOT NULL,\n    CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId])\n)\n[Inserting migration history record]\nRunning Seed method.\n</code></pre>\n\n<p>But migration not updates database (DB is empty). But when I replace connectionString on code below, database updates without problem.</p>\n\n<pre><code>connectionString=\"Data Source=E:\\Dropbox\\Projects\\Climate\\Climate\\db.sdf\" \n</code></pre>\n\n<p>How can I set |DataDirectory| for using in EF migration?</p>\n"},{"tags":["asp.net-mvc-3","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12546442,"title":"how can i show custom exception next to textbox?","body":"<p>I have register form. I want to check new username that is in db or not and if there is in DB , exception show next to it's textbox \"UserName already exist...\", what should I do?\nthis my method with exception that I have used it in Register action.:</p>\n\n<pre><code>public void InsertNewUser(MemberRegisterModel mm)\n    {\n        EShopThemeDBEntities context = new EShopThemeDBEntities(idbconnection.ConnStr);\n        using (context)\n        {\n            var listUsers = (from o in context.Users\n                             select o.Username).ToList();\n            var a = listUsers.Count();\n            foreach (var item in listUsers)\n            {\n                if (mm.Username == item.ToString())\n                {\n                   throw new Exception(\"UserName already exist...\");\n                }\n\n                User mmr = new User();\n                mmr.FName = mm.FName;\n                mmr.LName = mm.LName;\n                mmr.Username = mm.Username;\n                mmr.Password = mm.Password;\n                mmr.Email = mm.Email;\n                mmr.Phone = mm.Phone;\n                mmr.Mobile = mm.Mobile;\n                mmr.CreateDate = DateTime.Now;\n                mmr.RoleId = 2;\n                context.AddToUsers(mmr);\n                context.SaveChanges();\n\n            }\n        }\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12516314,"title":"EF with Lazy Loading. Can't Delete a Record","body":"<p>Receiving the following error when I try to delete my Teacher record.</p>\n\n<blockquote>\n  <p>The DELETE statement conflicted with the REFERENCE constraint\n  \"FK_dbo.Department_dbo.Teacher_TeacherID\". The conflict occurred in\n  database \"MySchoolBook\", table \"dbo.Department\", column 'TeacherID'.\n  The statement has been terminated.</p>\n</blockquote>\n\n<p>My Teacher Model:</p>\n\n<pre><code>public class Teacher : Person\n{\n    [Key]\n    public Guid TeacherID { get; set; }\n\n    public Guid? AccountID { get; set; }\n\n    public virtual ICollection&lt;Classroom&gt; Classrooms { get; set; }\n\n    public virtual Office Office { get; set; }\n}\n</code></pre>\n\n<p>My Department Model:</p>\n\n<pre><code>public class Department\n{\n    [Key]\n    public Guid DepartmentID { get; set; }\n\n    [Display(Name = \"Administrator\")]\n    public Guid? TeacherID { get; set; }\n\n    [Required(ErrorMessage = \"Name is required.\")]\n    public String Name { get; set; }\n\n    public virtual Teacher Administrator { get; set; }\n    public virtual ICollection&lt;Classroom&gt; Classrooms { get; set; }\n}\n</code></pre>\n\n<p>My DbContext:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();\n\n            modelBuilder.Entity&lt;Department&gt;()\n                .HasOptional(d =&gt; d.Administrator);\n        }\n</code></pre>\n\n<p>Edit:</p>\n\n<p>What I would like to happen is when I delete my Teacher record, for my Department's TeacherID Column to go NULL.</p>\n"},{"tags":[".net","entity-framework","refactoring","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12543015,"title":"Refactor solution to use Entity Framework 4.3 (Code First)","body":"<p>I'd like to have some advices on the problem:\nWe're having a solution that uses classic ADO.NET for data access (its like 4+ years old).\nThe data-access architecture has been built back in times of .NET 2.0.\nOur data classes are simple classes that are inherited from, say, FooDataBaseObject (the name doesn't actually matter), which has a default implementation of CRUD operations. Our properties are marked with Custom Attributes ( holding necessary data, like the name of the respective column in the table and so on). And the same with data-classes (custom attribute is used to specify table-name etc).</p>\n\n<hr>\n\n<p>The relations among entities are specified in special .xsd and .xml files.  The tables themselves rarely have foreign keys and other typical constraints (we actually have this table inherited and customer has forbidden us to modify them, since they still use import and export engines on their side). But i am sure i will be able to persuade people to refactor the database.</p>\n\n<hr>\n\n<p>The problem is with the existing services. Is there a way to introduce EF still having the possibility to use old ado.net services? \ni am currently considering the idea of using EF Code First approach, since i don't need my entities to be generated or inheriting some specific class, etc, rather then i will be able (i hope) to construct a DbContext for them and map to the existing database.\nAlso, probably there is a way to create <em>mirroring</em> classes for our old data-classes. Say Customer -> CustomerEntity. And CustomerEntity would mirror all the necessary properties of the Customer and then be used in DbContext and DbSet, so that we'll be using CustomerEntity in new services and just Customer in old.</p>\n\n<p>I want to hear about the potential bottlenecks of this approaches and about the very possibility of this (is this actually real?) or maybe some other advices, etc.\nThank you!</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12538561,"title":"Entity Framework. How to automatically update comboBox when data base table changes?","body":"<p>I am just starting with C# and Entity Framework (5.0) .\nI have the following code that binds my combo box to my database table but when I update my list of employees the comboBox does not update automatically.\nThe only solution I can think of is to put the linq query into a separate method <code>update_cmbEmployees()</code> and call it every time I need it updated but this is not a very elegant solution  and can be messy in a complex application. So I imagine that there must be a better solution to a problems like this. Is there a some sort of event that I could hook up to? Or maybe I am binding it all wrong? </p>\n\n<pre><code>BindingSource bsCmbEmployees;\n    private void Form1_Load(object sender, EventArgs e)\n    {\n        using( var ctx = new TimeKeepEntities())\n        {\n            var activeEEs = from ee in ctx.tblEmployees\n                            where ee.Active\n                            select ee;\n\n            bsCmbEmployees = new BindingSource();\n            bsCmbEmployees.DataSource = activeEEs.ToList();\n            cmbEmployees.DataSource = bsCmbEmployees;\n            cmbEmployees.DisplayMember = \"Name\";\n            cmbEmployees.ValueMember = \"EeID\";\n          }\n   }\n</code></pre>\n\n<p>Edit1: Added entity framework version</p>\n"},{"tags":["c#","entity-framework","inversion-of-control","unity","repository-pattern"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12545429,"title":"Is my context too coupled with my repository?","body":"<p>Learning Entity Framework, Repositories and IOC, what I am trying to achieve is to implement the repository pattern in order to change my data source provider.</p>\n\n<p>Please see this example from an open-source project:</p>\n\n<pre><code>namespace MyApp.Domain.Interfaces\n{\n    public interface IEFContext : IDisposable\n    {\n    }\n}\n</code></pre>\n\n<h3>EFContext (implementing IEFContext)</h3>\n\n<pre><code>namespace MyApp.Data.Context\n{\n    public class EFContext : DbContext, IEFContext\n    {\n        public const string DBConnectionName = @\"MyDBName\";\n\n        public EFContext() : base(DBConnectionName)      \n        {\n        }\n\n        public DbSet&lt;Member&gt; Member { get; set; }\n    }\n}\n</code></pre>\n\n<h3>IMemberRepository</h3>\n\n<pre><code>namespace MyApp.Domain.Interfaces.Repositories\n{\n    public interface IMemberRepository\n    {\n        Member GetUser(string username);\n    }\n}\n</code></pre>\n\n<h3>MemberRepository (implementing IMemberRepository)</h3>\n\n<pre><code>namespace MyApp.Data.Repositories\n{\n    public class MemberRepository : IMemberRepository\n    {\n        private readonly EFContext _context;\n\n        public MemberRepository(IEFContext context)\n        {\n            _context = context as EFContext;\n        }\n\n        // update\n        public Member GetUser(string username)\n        {\n            return _context.Member.SingleOrDefault(name =&gt; name.UserName.ToUpper().Contains(username.ToUpper()));\n        }\n    }\n}\n</code></pre>\n\n<p>and this is my application console using Unity</p>\n\n<h3>Console App</h3>\n\n<pre><code>namespace MyApp.ConsoleApp\n{\n    public class Program\n    {\n        static void Main(string[] args)\n        {\n            var container = new UnityContainer();\n            container.RegisterType&lt;IEFContext, EFContext&gt;();\n            container.RegisterType&lt;IMemberRepository, MemberRepository&gt;();\n            var repository = container.Resolve&lt;MemberRepository&gt;();\n            var user = repository.GetUser(\"johnDoe\");\n            Console.WriteLine(user.Email);\n            Console.ReadLine();\n        }\n    }\n}\n</code></pre>\n\n<h1>My question is the following:</h1>\n\n<p>if I decide to add a new context, such as:</p>\n\n<pre><code>namespace MyApp.Data.Context\n{\n    public class EFContext2 : DbContext, IEFContext\n    {\n        public const string DBConnectionName = @\"MyNewDBName\";\n\n        public EFContext2() : base(DBConnectionName)      \n        {\n        }\n\n         public DbSet&lt;Member&gt; Member { get; set; }\n    }\n}\n</code></pre>\n\n<p>I should have only to change the dependency like:</p>\n\n<pre><code>namespace MyApp.ConsoleApp\n{\n    public class Program\n    {\n        static void Main(string[] args)\n        {\n            ...\n            container.RegisterType&lt;IEFContext, EFContext2&gt;();\n            ...         \n        }\n    }\n}\n</code></pre>\n\n<p>but in this example my MemberRepository is loosely-coupled with my first context. So if I have to change my Context I must also change my repository.</p>\n\n<p>I would be please to have your point of view on this.\nKind regards</p>\n"},{"tags":["c#","database","entity-framework","code-first","ef-code-first"],"answer_count":3,"favorite_count":5,"up_vote_count":11,"down_vote_count":0,"view_count":2733,"score":11,"question_id":4324052,"title":"EF4 Code-First causes InvalidOperationException","body":"<p>I'm having an issue when trying to run my project each time it builds. It seems the initializer runs, but when it comes to the first query - it dies with the following <code>InvalidOperationException</code>.</p>\n\n<pre><code>This operation requires a connection to the 'master' database. Unable to create a\nconnection to the 'master' database because the original database connection has\nbeen opened and credentials have been removed from the connection string. Supply\nan unopened connection.\n</code></pre>\n\n<p>For reference, I'm using the EF Code First CTP4, imported directly with NuGet. Connecting to a SQL Server 2008 R2</p>\n\n<p>What I want to happen is to re-create the database if there are any model amendments and seed it with a few values for the lookup table. Both of these things seem to be supported* out of the box.</p>\n\n<p>My setup is like so:</p>\n\n<p>Global.asax</p>\n\n<pre><code> protected void Application_Start()\n {\n    Database.SetInitializer&lt;CoreDB&gt;(new CoreDBInitialiser());\n    // et al...\n }\n</code></pre>\n\n<p>CoreDB.cs</p>\n\n<pre><code>public class CoreDB : DbContext\n{\n    public DbSet&lt;User&gt; Users { get; set; }\n    public DbSet&lt;Login&gt; Logins { get; set; }\n    public DbSet&lt;Permission&gt; Permissions { get; set; }\n    public DbSet&lt;Role&gt; Roles { get; set; }\n    public DbSet&lt;RolePermission&gt; RolePermissions { get; set; }\n    public DbSet&lt;UserRole&gt; UserRoles { get; set; }\n    public DbSet&lt;Setting&gt; Settings { get; set; }\n}\n\npublic class CoreDBInitialiser : RecreateDatabaseIfModelChanges&lt;CoreDB&gt;\n{\n    protected override void Seed(CoreDB context)\n    {\n        var settings = new List&lt;Setting&gt;\n        {\n            new Setting\n            {\n                SettingName = \"ExampleSetting\",\n                SettingValue = \"This is a sample setting value\",\n            }\n        };\n\n        settings.ForEach(d =&gt; context.Settings.Add(d));\n    }\n}\n</code></pre>\n\n<p>When it runs, it dies on a line similar to this, which is basically the first query it comes across after creating the database.</p>\n\n<pre><code>User data = (from u in _data.Users where u.Username == userName  select u).SingleOrDefault();\n</code></pre>\n\n<p>Things I don't think it is:</p>\n\n<ul>\n<li><strong>It's not permissions</strong>: I've deleted the actual database itself within the SQL Server. The application recreates it around about the same time as that query is attempted to run (the initializer is set, then obviously it holds off creating until it's needed). I've also logged on to SQL Server as the user that is specified in my Web.config and they have full read/write access to the database. In fact, they probably should do as that account creates the databases also.</li>\n<li><strong>The database is being created</strong>: Deleting the DB and it automatically recreates fine.</li>\n<li><strong>The connection string is correctly defined</strong>, including the <code>providerName</code> attribute.</li>\n</ul>\n\n<p><code>&lt;add name=\"CoreDB\" connectionString=\"Data Source=localhost\\SQLEXPRESS;Initial Catalog=TheDatabase;User Id=TheUsername;Password=ThePassword;\" providerName=\"System.Data.SqlClient\" /&gt;</code></p>\n\n<ul>\n<li>It doesn't <em>appear</em> to be a bug in my code/logic, as once the query has failed successfully, <strong>the code will start properly until the next time the application is rebuilt</strong>. It's obviously could be, and likely I'd have to apply a work around in my code no matter what anyway. :)</li>\n</ul>\n\n<p><strong>What to do?</strong></p>\n\n<p>Ideally, I'd like to \"not think about the database schema\" much. I'd like it to be as it seemed to be in <a href=\"http://weblogs.asp.net/scottgu/archive/2010/07/23/entity-framework-4-code-first-custom-database-schema-mapping.aspx#7573964\" rel=\"nofollow\">Scott Gu's excellent blog post</a> (and follow up for <a href=\"http://weblogs.asp.net/scottgu/archive/2010/08/03/using-ef-code-first-with-an-existing-database.aspx\" rel=\"nofollow\">working with existing databases</a>) where things just worked out and disappeared away. For the most part this is true. It seems to be an issue with the connection not being closed at some point, but I can't find out how to rectify this issue.</p>\n\n<p>A <a href=\"http://social.msdn.microsoft.com/Forums/en-NZ/adonetefx/thread/c5329e4b-0efb-4951-85b1-0a123579cc3d\" rel=\"nofollow\">few forum</a> / SO posts do imply the issue I'm having is basically because the initializers aren't working exactly as planned and the connection might be left open. The solution in other places appears to be to simply \"don't create your own initializer\", which isn't the greatest solution - but unless anyone has any ideas, I'll probably have to do until CTP5 maybe.</p>\n\n<p>*yep, I know it's a CTP, so \"supported\" is probably not the word :)</p>\n"},{"tags":["entity-framework","code-first","webdeploy","code-first-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":245,"score":0,"question_id":12514521,"title":"Entity Framework Code First Data Migrations not working with VS2012 Web Deploy","body":"<p>I have created an MVC 3.0 application using Visual Studio 2012, .NET 4.5 and Entity Framework 5.0.</p>\n\n<p>Using Code First Data Migrations, I am able to correctly propagate model changes to my local test database, but I can't figure out how to get this to work when deploying to my staging and production servers using Web Deploy.</p>\n\n<p>I have read the following article ...</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/dd394698(v=vs.110)#dbdacfx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/dd394698(v=vs.110)#dbdacfx</a></p>\n\n<p>... which explains what's supposed to happen, but it's not working for me, as Web Deploy seems unable to detect that I am using Entity Framework. The tutorial shows a checkbox to enable execution of Code First Migrations ...</p>\n\n<p><img src=\"http://i.stack.imgur.com/TaEGA.png\" alt=\"Web Deploy Publish Dialog\"></p>\n\n<p>... but my dialog shows the only <code>Update Database</code> checkbox for each database.</p>\n\n<p>I have read that, in order for Visual Studio to detect the use of an Entity Framework context, the <code>Web.config</code> must include an element that defines it. Here's mine:</p>\n\n<pre><code>&lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\" /&gt;\n\n    &lt;contexts&gt;\n        &lt;context type=\"MyContext, MyAssembly\"&gt;\n            &lt;databaseInitializer type=\"System.Data.Entity.MigrateDatabaseToLatestVersion`2[[MyContext, MyAssembly], [MyConfig, MyAssembly]], EntityFramework\"&gt;\n                &lt;parameters&gt;\n                    &lt;parameter value=\"MyConnectionStringName\"/&gt;\n                &lt;/parameters&gt;\n            &lt;/databaseInitializer&gt;\n        &lt;/context&gt;\n    &lt;/contexts&gt;\n&lt;/entityFramework&gt;\n</code></pre>\n\n<p>Any suggestions would be greatly appreciated.</p>\n\n<p>Thanks,</p>\n\n<p>Tim</p>\n"},{"tags":[".net","entity-framework","repository"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12543770,"title":"General persist method in Entity Framework - inserting or updating (if exists) entity","body":"<p>What is the best solution in entity framework to implement generic persist method?</p>\n\n<p>For example there is a Company entity:</p>\n\n<pre><code>public class Company\n{\n    public Company()\n    {\n        Id = Guid.NewGuid();\n    }\n\n    public Guid Id { get; set; }\n\n    public string Name { get; set; }\n}\n</code></pre>\n\n<p>The Id property can be generated before entity is stored into the Database.</p>\n\n<p>So the task is to implement Persist method:</p>\n\n<pre><code>public class Repository\n{\n    private DbSet&lt;Company&gt; _dbSet;\n\n    public void Persist(Company company)\n    {\n        // How to implement body here to Add entity if it doesn't exists yet\n        // or Modify it in opposit case?\n        // In terms of database entity record is required to be inserted or updated.\n    }\n}\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["entity-framework","migration"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":382,"score":0,"question_id":10391873,"title":"How do I generate automatic migration scripts with model-first?","body":"<p>How do I generate automatic migration scripts with model-first in Entity Framework 4.3 or 5.0?</p>\n\n<p>I've seen plenty of samples with this for code-first, but none that can be used in my scenario.</p>\n\n<p>My problem is that I have a staging environment and a live environment. I may be making many model and database changes to the staging environment before publishing it all to the live environment.</p>\n\n<p>This adds complexity when I then want to generate a migration script from my staging database to my live database. </p>\n\n<p>Is this possible automatically somehow? Can this be achieved through the Entity Framework Power Tools?</p>\n"},{"tags":[".net","entity-framework","entity-framework-4","ef-model-first"],"answer_count":1,"favorite_count":7,"up_vote_count":9,"down_vote_count":0,"view_count":1219,"score":9,"question_id":4221938,"title":"How to do Migration when Generate database from model in Entity Framework Model First","body":"<p>I have an existing model and initially generated the database from this model and had populated the existing tables with some data. Now I've added a new table to the model. Is there a way to update the database from the new model without losing all the data in the existing tables? Thanks.</p>\n"},{"tags":["vb.net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":122,"score":0,"question_id":7780692,"title":"Entity Framework Context Not Working","body":"<p>I am trying to figure out Entity Framework but I keep running into issues with the context. I create my .edmx file and it works fine but when I try to declare my context on my pages Visual Studio will not find them. My .edmx file is called YCLModel.edmx and my connectionstring for it is YCLEntites.</p>\n\n<p>I try to declare the context as:</p>\n\n<pre><code>Dim yclcontext as new YCLEntites\n</code></pre>\n\n<p>I have also tried going into design mode and dragging  from the toolbox but when I select my named connection it gives me the following error:</p>\n\n<blockquote>\n  <p>The metadata specified in the connection string could not be loaded.\n  Consider rebuilding the web project to build assemblies that may\n  contain metadata. The following error(s) occurred:</p>\n  \n  <p>Unable to load the specified metadata resource.</p>\n</blockquote>\n"},{"tags":["entity-framework","lookup-tables"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12540743,"title":"Lookup tables in Entity Framework 5.0 (Single table for Multiple Lookup Values)","body":"<p>In my legacy database we have following way of storing lookup tables.</p>\n\n<pre><code>Lookup Table\n----------\n1 Category \n2 Country \n3 Region\n4 Cities\n5 Roles\n</code></pre>\n\n<p>Each lookup table record will have multiple Lookup Details</p>\n\n<p>Example:\nInside LookupDetails table, Country will contains all the list of countries, Region will contains all list of region and so on for other values.</p>\n\n<p>Now I am trying to access Categories value inside Product table.  </p>\n\n<p>My Product Table is like</p>\n\n<ul>\n<li>ProductID</li>\n<li>ProductName</li>\n<li>CategoryID</li>\n</ul>\n\n<p>Now CategoryID in Product table refers to LookupDetails value.  Can someone help me to access LookupDetails name (i.e. In my case category name)</p>\n\n<p>I believe EF works smoothly if we have proper relationship among tables.  Since in this case my Product Table is not referenced to Lookupdetails table things are bit complicated, can someone help me with this?</p>\n\n<p>Thank you</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","configuration","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12540962,"title":"Complex many to many configuration with Entity Framework and Codefirst","body":"<p>I am creating an application in MVC3 using EF and CF. I have following entities</p>\n\n<p><strong>Tests:</strong> User can create multiple tests</p>\n\n<p><strong>Sections:</strong> A test can contains multiple sections with multiple questions. User need to give a range how much questions randomly he needed.</p>\n\n<p><strong>Questions:</strong> There are questions in bulk, but user needed to specify how many questions does he needs.</p>\n\n<p><strong>QuestionsBindToTest:</strong> Contains IDs of random questions and Test Code.</p>\n\n<p><strong>Candidates:</strong> A list of candidates will be uploaded when test is being created.</p>\n\n<p><strong>AttemptedQuestion:</strong> Answers of the questions that candidate has given.</p>\n\n<pre><code>public class Question\n{\n    //Fields\n    public virtual Client Client { get; set; }\n    public virtual Section Section { get; set; }\n    public virtual IList&lt;Test&gt; Tests { get; set; }\n    public virtual IList&lt;DifficultyLevel&gt; DifficultyLevel { get; set; }\n    public virtual IList&lt;AttemptedQuestion&gt; AttemptedQuestion { get; set; }\n    public virtual IList&lt;QuestionBindToTest&gt; QuestionsBindedToTest { get; set; }\n}\n\npublic class Test\n{\n    //Fields\n    public virtual Client Client { get; set; }\n    public virtual IList&lt;Question&gt; Questions { get; set; }\n    public virtual IList&lt;QuestionBindToTest&gt; QuestionsBindedToTest { get; set; }\n    public virtual IList&lt;Section&gt; Sections { get; set; }                \n}\n\npublic class QuestionBindToTest\n{\n    public virtual Test Test { get; set; }\n    public virtual Question Question { get; set; }\n}\n\npublic class Client\n{\n    //Fields\n\n    public virtual IList&lt;Test&gt; Tests { get; set; }\n    public virtual IList&lt;Question&gt; Questions { get; set; }\n    public virtual IList&lt;Candidate&gt; Candidates { get; set; }        \n}\n\n public class DifficultyLevel\n{\n    //Fields\n\n    public virtual IList&lt;JobType&gt; JobTypes { get; set; }\n    public virtual IList&lt;Question&gt; Questions { get; set; }\n}\n\npublic class Candidate\n{\n    //Fields\n\n    public virtual IList&lt;Client&gt; Clients { get; set; }\n    public virtual IList&lt;AttemptedQuestion&gt; AttemptedQuestion { get; set; }\n}\n\npublic class AttemptedQuestion\n{\n    //Fields\n\n    public virtual Question Question { get; set; }\n    public virtual Candidate Candidate { get; set; }\n}\n</code></pre>\n\n<p>I am getting confused while creating there configurations, help me to sort this out. Thanks in advance.</p>\n"},{"tags":["entity-framework","linqpad","dbcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12524625,"title":"Error with LINQPad 4 - The type initializer for 'System.Data.Entity.Internal.AppConfig' threw an exception","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10605859/having-trouble-with-linqpad-adding-a-connection-to-entity-framework\">Having trouble with LinqPad Adding a Connection to Entity Framework</a>  </p>\n</blockquote>\n\n\n\n<p>I am trying to use LINQPad for the first time and I keep getting the following error when it tries to read the app.config:</p>\n\n<pre><code>The type initializer for 'System.Data.Entity.Internal.AppConfig' threw an exception.\n</code></pre>\n\n<p>I can successfully test my connection and it shows all my entities in my model but as soon as I execute anything the above error occurs.</p>\n\n<p>I am connecting to an existing model in my dll using EF 4.3 DBContext. I have tried installing the release and beta version because I saw a previous similar issue which said to install the beta version 4.42.05 however the beta has moved on to 4.42.14 and the problem is still there. </p>\n\n<p>Has anyone got this working with EF4.3 DBContext or is LINQPad just busted?</p>\n"},{"tags":["asp.net-mvc","entity-framework","lambda","fluent"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12539654,"title":"MVC 4 explicitly load a many to many EF lookup and filter by both keys","body":"<p>I have the following in an MVC4 app.  I want to filter the load by both keys, there could be many to many but both the keys together represent a unique row.  The goal to to explicitly load these collections only when needed and filter by both sides of the relationship.</p>\n\n<p>I have the following Entity.DBContext, it works but only for the UserId key.  </p>\n\n<pre><code>context.UserProfiles.Include(o =&gt; o.CoachOfOrginizations).Where(p =&gt; p.UserId == UserId).Single()\n</code></pre>\n\n<p>Also this loads all of them, but of course doesnt filter at all, just showing you so you know that I set up my fluent code properly.</p>\n\n<pre><code>    context.Entry(this).Collection(t =&gt; t.AdministratorOfOrginizations).Load();\n\nmodelBuilder.Entity&lt;UserProfile&gt;()\n                .HasMany(p =&gt; p.CoachOfOrginizations)\n                .WithMany(t =&gt; t.Coaches)\n                .Map(mc =&gt;\n                {\n                    mc.ToTable(\"OrganizationCoaches\");\n                    mc.MapLeftKey(\"UserProfileID\");\n                    mc.MapRightKey(\"OrganizationID\");\n                });\n</code></pre>\n\n<p>CoachOfOrginizations is the following property on UserProfile.</p>\n\n<pre><code>public ICollection&lt;Organization&gt; CoachOfOrginizations { get; set; }\n</code></pre>\n\n<p>What i would like is to filter my original .Include above based on Organization.ID (the other key) and the currently used key p.UserId.  I've tried the following and it doesn't work, any advice?  \"this\" is the UserProfile object.</p>\n\n<pre><code>context.Entry(this)\n                .Collection(b =&gt; b.CoachOfOrginizations)\n                .Query()\n                .Where(p =&gt; p.ID == orgID)\n                .Load();\n</code></pre>\n"},{"tags":[".net","entity-framework","ado.net"],"answer_count":10,"favorite_count":6,"up_vote_count":43,"down_vote_count":0,"view_count":13444,"score":43,"question_id":682429,"title":"How can i query for null values in entity framework?","body":"<p>I want to execute a query like this</p>\n\n<pre><code>   var result = from entry in table\n                     where entry.something == null\n                     select entry;\n</code></pre>\n\n<p>and get an <code>IS NULL</code> generated. </p>\n\n<p>Edited:\nAfter the first two answers i feel the need to clarify that I'm using Entity Framework\nand not Linq to SQL. The object.Equals() method does not seem to work in EF.</p>\n\n<p>Edit no.2:\nThe above query works as intended. It correctly generates <code>IS NULL</code>. My production code however was</p>\n\n<pre><code>var value = null;\nvar result = from entry in table\n                         where entry.something == value\n                         select entry;\n</code></pre>\n\n<p>and the generated SQL was <code>something = @p; @p = NULL</code>. It seems that EF correctly translates the constant expression but if a variable is involved it treats it just like a normal comparison. Makes sense actually. I'll close this question</p>\n"},{"tags":["c#",".net","entity-framework","oop","ado.net"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12537407,"title":"Object Oriented From A Database?","body":"<p>I've done a lot of ADO.NET EF programming, but never one where one of the objects/tables inherits from another object/table.</p>\n\n<p>If I have an existing database with three tables (square, triangle, polygon) and add an ADO.NET model to give me Linq access to these tables, how do I establish that the square and triangle objects derive from polygon?</p>\n\n<p>Is there a requirement in the schema where columns in the parent table exist in the columns of the child classes?</p>\n\n<p>And then what if I want to override a method like ComputeArea()? Would I use an extension method or is there a better way?</p>\n\n<p>My underlying question is how/where/if object oriented programming brings value to ORM, but I realize value/subjective questions are discouraged on stackoverflow.</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12530698,"title":"How to validate if PO Detail quantity exceed in PoOrder quantity?","body":"<p>My question is, \nhow to validate first the quantity in PoDetail table before adding new data \nif the quantity is exceed in PoOrder table?\nif im right this is a business rule that i want to create.\nI'm using asp.net mvc 4,EF code first and repository pattern.</p>\n\n<p>here is a sample data.</p>\n\n<pre><code>INSERT INTO PoOrders\nSELECT 1,'PO123',5000\n\nINSERT INTO PoDetails\nSELECT 1,1,2500\nUNION ALL\nSELECT 2,1,2000\n</code></pre>\n\n<p>If i try to add new PoDetail(e.g. Qty is 1000) it must show a\nmessage or prevent adding new record.</p>\n\n<p>The POCO class </p>\n\n<pre><code>public class PoOrder\n{\n    [Key]\n    public int PoID { get; set; }\n\n    public string PoNumber { get; set;}\n\n    public int PoQty {get; set;}\n }\n\n public class PoDetail\n {\n    [Key]\n    public int ID { get; set; }\n    public int Po_ID {get; set;}\n    public int ReleaseQty { get; set;}\n\n    [ForeignKey(\"Po_ID\")]\n    public virtual PoOrder PoOrders { get; set; }     \n }\n</code></pre>\n\n<p>Any tips or solution is very much appreciated. thanks</p>\n"},{"tags":["entity-framework","c#-4.0","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":137,"score":0,"question_id":12537099,"title":"Mapping Foreign Key in EF5.0","body":"<p>I have the below tables as my entities</p>\n\n<pre><code>public class Customer\n{\n  public int CustId{get;set;}\n  public string Name {get;set;}\n}\n\n\npublic class Address\n{\n  public int Id{get;set;}\n  public string Name {get;set;}\n   **public virtual Customer Customer {get;set;}**\n}\n</code></pre>\n\n<p>In my model configuration for Address using Fluent API. I have the below code</p>\n\n<pre><code>HasKey(p =&gt; p.Id);\nHasRequired(p =&gt; p.Customer).WithMany().Map(m =&gt; m.MapKey(\"CustId\"));\n</code></pre>\n\n<p>What I really want is instead of using \n   <strong>public virtual Customer Customer {get;set;}</strong> \n  I want to have Public Int CustID; property in Address Class... and still do the mapping<br>\n   as foreign key.</p>\n\n<p>Could someone please throw some suggestions...</p>\n"},{"tags":["c#","entity-framework","encryption","xml-serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12536956,"title":"How can I store a string of encrypted data in an xml element?","body":"<p>So I have EntityFramework solution.  i have customized the context to insert an audit trail, and it stores the trail in an xml field.  the context serializes an entity and that is what is stored.  I have certain fields that i am encrypting before they are written to the db.  I have a helper class that uses AESManaged to perform the encryption.  The values that wind up being stored contain ascii special characters, and this causes an exception during serialization.</p>\n\n<p>my question is, how should i hande these encrypted fields so that they can be serialized?</p>\n"},{"tags":["entity-framework","foreign-keys","code-first","navigation-properties"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12536775,"title":"EF Code First - Multiple Properties Pointing to Another Table","body":"<p>I have a pair of simple classes generating a database in Code First in EF 4.1: </p>\n\n<pre><code>public class User\n{\n    public int UserId { get; set; }\n    public string UserName { get; set; }\n}\n\npublic class Purchase\n{\n    public int PurchaseId { get; set; }\n    public int UserId { get; set; }\n    public int? SalespersonUserId { get; set; }\n\n    public User User { get; set; }\n    public User SalespersonUser { get; set; }\n}\n\npublic class NewItemsDataContext : DbContext\n{\n    public DbSet&lt;User&gt; Users { get; set; }\n    public DbSet&lt;Purchase&gt; Purchases { get; set; }\n}\n</code></pre>\n\n<p>In my program, I create and write some data to it.</p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        Database.SetInitializer&lt;NewItemsDataContext&gt;(new DropCreateDatabaseIfModelChanges&lt;NewItemsDataContext&gt;());\n\n        using (NewItemsDataContext sadc = new NewItemsDataContext())\n        {\n            sadc.Users.Add(new User());\n\n            sadc.SaveChanges();\n        }\n        using (NewItemsDataContext sadc = new NewItemsDataContext())\n        {\n            sadc.Purchases.Add(new Purchase() { UserId = 1 });\n            sadc.SaveChanges();\n        }\n        using (NewItemsDataContext sadc = new NewItemsDataContext())\n        {\n            var sql = sadc.Purchases.Include(p =&gt; p.User);\n            foreach (Purchase purchase in sql)\n                Console.WriteLine(purchase.User.UserId.ToString());\n        }\n    }\n}\n</code></pre>\n\n<p>Note, when I read the Purchase records back, I get an exception of purchase.User being null -- that is, the .Include did not pull anything in for the User.  Now, if I ignore the salespersonUser navigation property in my OnModelCreating (or just comment it out):</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n    modelBuilder.Entity&lt;Purchase&gt;().Ignore(p =&gt; p.SalespersonUser);\n\n    base.OnModelCreating(modelBuilder);\n}\n</code></pre>\n\n<p>The code works, and the User is loaded in the .Include.</p>\n\n<p>When the SalespersonUser nav property is ignored, the created database looks as you would expect it.  The Purchase table has a PurchaseId, UserId, and SalespersonId.  But once you add the SalespersonUser nav property back in (stop ignoring it), you end up with two more keys in the table: User_UserId and SalespersonUser_UserId (as well as the original UserId and SalespersonUserId).</p>\n\n<p>Also, the SQL generated definitely shows where the problem arises.</p>\n\n<p>Without the nav property:</p>\n\n<pre><code>{SELECT \n[Extent1].[PurchaseId] AS [PurchaseId], \n[Extent1].[UserId] AS [UserId], \n[Extent1].[SalespersonUserId] AS [SalespersonUserId], \n[Extent2].[UserId] AS [UserId1], \n[Extent2].[UserName] AS [UserName]\nFROM  [Purchases] AS [Extent1]\nINNER JOIN [Users] AS [Extent2] ON [Extent1].[UserId] = [Extent2].[UserId]}\n</code></pre>\n\n<p>and with the nav property:</p>\n\n<pre><code>{SELECT \n[Extent1].[PurchaseId] AS [PurchaseId], \n[Extent1].[UserId] AS [UserId], \n[Extent1].[SalespersonUserId] AS [SalespersonUserId], \n[Extent2].[UserId] AS [UserId1], \n[Extent2].[UserName] AS [UserName], \n[Extent1].[SalespersonUser_UserId] AS [SalespersonUser_UserId]\nFROM  [Purchases] AS [Extent1]\nLEFT OUTER JOIN [Users] AS [Extent2] ON [Extent1].[User_UserId] = [Extent2].[UserId]}\n</code></pre>\n\n<p>Notice how it pulls the UserId, but joins with the User_UserId, and a left join, no less.  The SalespersonUserId isn't even referenced in a join.  Inside the database after writing the record, the UserId is set, but the User_UserID is null.  Thus, nothing to join, and we get null for the Included User.</p>\n\n<p>It would seem to me that this is a bug in EF, but it is possible there is a design reason for it.  If so, can someone clear it up for me, and perhaps describe some fluent API that may work around it?  I'm kind of partial to my nav properties.</p>\n"},{"tags":["asp.net-mvc","entity-framework","orm","database-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12512778,"title":"Adding to EntitySet not working","body":"<p>I'm trying to add an object to a database-first ORM EntitySet in an MVC project.  I use a piece of code something like this:</p>\n\n\n\n<pre><code>public static Boolean CreateListing(string title, string description)\n{\n    ListingEntities ce = new ListingEntities();\n    ce.Ads.AddObject(new Ad()\n    {\n        ID = Guid.NewGuid(),\n        Title = title,\n        Description = description,\n    });\n    return ce.SaveChanges() == 1;\n}\n</code></pre>\n\n<p>However, the SaveChanges method throws a Data.UpdateException which is thrown by a SqlClient.SqlException.  The latter says </p>\n\n<p>\"Cannot insert the value NULL into column 'ID', table 'Listings.dbo.Ads'; column does not allow nulls. INSERT fails.\nThe statement has been terminated.\"</p>\n\n<p>I wholeheartedly agree.  I just don't see why the ID should be null when it seems I set it immediately prior.  Any suggestions?</p>\n\n<p>Thanks,<br>\nNathan</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":128,"score":1,"question_id":12534331,"title":"Table attribute in MVC 4 is not recognized","body":"<p>I have a model like the following:</p>\n\n<pre><code>[Table(\"forms\", Schema = \"mySchema\")]\npublic class forms\n{\n  [Key]\n  public int ID { get; set; }\n  public string field1 { get; set; }\n  public string field2 { get; set; }\n}\n</code></pre>\n\n<p>This works in MVC 3, however in MVC 4 the attribute Table in not recognized. I have the System.ComponentModel.DataAnnotations namespace included, and the dll referenced, along with EntityFramework.dll. The version of EF has changed between MVC 3 and 4. If I reference the MVC 3 EF dll, Table is recognized, however Schema is not. The reason for using the table attribute is so I can specify the schema. What am I missing?</p>\n"},{"tags":["c#","asp.net-mvc","asp.net-mvc-3","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":66,"score":1,"question_id":12536355,"title":"Displaying records in view by id","body":"<p>I have a table that holds Questions and i also have a table that has the Questions ID listed in an answers table. For sake of duplicate data i only use the id. </p>\n\n<p>My question is how do i populate \"in the view\" the question based on an ID from the current table. They are already joined by MainQuestionID. I am using DBEntities code first. </p>\n\n<p>Here is my viewModel for the page.</p>\n\n<pre><code>    public class AuditFormEdit\n    {\n    public Models.MainQuestion MainQuestionID { get; set; }\n\n    public ICollection&lt;MainQuestion&gt; mainQuestion { get; set; }\n\n    public List&lt;SubcategoryHelper&gt; SubcategoryHelperGet { get; set; }\n\n    public class SubcategoryHelper : Models.SubCategory\n    {\n        public SubcategoryHelper(Models.SubCategory subCat)\n        {\n            this.SubCategoryID = subCat.SubCategoryID;\n            this.SubcategoryName = subCat.SubcategoryName;\n        }\n\n    }\n\n\n    public Models.MainAnswer MainAnswerInstance { get; set; }\n\n    public List&lt;ScoreCardCheckBoxHelper&gt; ScoreCardCheckBoxHelperList { get; set; }\n\n    public void InitializeScoreCheckBoxHelperList(List&lt;Models.Score&gt; ScoreList)\n    {\n        if (this.ScoreCardCheckBoxHelperList == null)\n            this.ScoreCardCheckBoxHelperList = new List&lt;ScoreCardCheckBoxHelper&gt;();\n\n        if (ScoreList != null\n            &amp;&amp; this.MainAnswerInstance != null)\n        {\n            this.ScoreCardCheckBoxHelperList.Clear();\n            ScoreCardCheckBoxHelper scoreCardCheckBoxHelper;\n            string scoreTypes =\n                string.IsNullOrEmpty(this.MainAnswerInstance.Score) ?\n                string.Empty : this.MainAnswerInstance.Score;\n            foreach (Models.Score scoreType in ScoreList)\n            {\n                scoreCardCheckBoxHelper = new ScoreCardCheckBoxHelper(scoreType);\n                if (scoreTypes.Contains(scoreType.ScoreName))\n                    scoreCardCheckBoxHelper.Checked = true;\n                this.ScoreCardCheckBoxHelperList.Add(scoreCardCheckBoxHelper);\n            }\n        }\n    }\n\n\n    public void PopulateCheckBoxsToScores()\n    {\n        this.MainAnswerInstance.Score = string.Empty;\n        var scoreType = this.ScoreCardCheckBoxHelperList.Where(x =&gt; x.Checked)\n                              .Select&lt;ScoreCardCheckBoxHelper, string&gt;(x =&gt; x.ScoreName)\n                              .AsEnumerable();\n        this.MainAnswerInstance.Score = string.Join(\", \", scoreType);\n    }\n\n\n    public class ScoreCardCheckBoxHelper : Models.Score\n    {\n        public bool Checked { get; set; }\n\n        public ScoreCardCheckBoxHelper() : base() { }\n\n        public ScoreCardCheckBoxHelper(Models.Score score)\n        {\n            this.ScoreID = score.ScoreID;\n            this.ScoreName = score.ScoreName;\n        }\n    }\n\n\n\n}\n</code></pre>\n\n<p>AS you can see i am calling out an ICollection for the MainQuestions but i am not sure how to populate the questions. They also have to populate based on a sectionID. </p>\n\n<p>Revised 2:51 9-21-2012</p>\n\n<p>Or how would i relate the two if i displayed the list of questions and then when answering it would update the answers table and not the current shown table.</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","entity-framework-4","asp.net-mvc-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12534049,"title":"In which namespace is the extension method EntityTypeConfiguration.MapSingleType","body":"<p>I am trying to implement the following code to map a database to a POCO that has slightly different Property names then the corresponding columns, and a slightly different class name than the table name. </p>\n\n<p><img src=\"http://weblogs.asp.net/blogs/scottgu/image_thumb_54C65380.png\" alt=\"map to single type\"></p>\n\n<p><a href=\"http://weblogs.asp.net/scottgu/archive/2010/07/23/entity-framework-4-code-first-custom-database-schema-mapping.aspx\" rel=\"nofollow\">Here's the article</a></p>\n\n<p>The problem is there is no method called MapSingleType. I have the following two methods available:</p>\n\n<pre><code>public EntityTypeConfiguration&lt;TEntityType&gt; Map&lt;TDerived&gt;(Action&lt;EntityMappingConfiguration&lt;TDerived&gt;&gt; derivedTypeMapConfigurationAction) where TDerived : class, TEntityType;\n\npublic EntityTypeConfiguration&lt;TEntityType&gt; Map(Action&lt;EntityMappingConfiguration&lt;TEntityType&gt;&gt; entityMappingConfigurationAction);\n</code></pre>\n\n<p>However, I can't find any examples of how to use them and I'm hoping to find the MapSingleType method since that works perfect for the very large number of columns I have to map. </p>\n\n<p>I have downloaded CTP4 <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=8812\" rel=\"nofollow\">from here</a></p>\n\n<p>And I am using EF 4.0.3</p>\n\n<p>Here is the code I have so far:</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\nusing System.Data.Entity;\nusing System.ComponentModel.DataAnnotations;\nusing PlayingWithEF.DAL.CLS.Classes;\nusing System.Data.Entity.ModelConfiguration;\n\nnamespace PlayingWithEF.DAL.CLS.Context\n{\n\n    public class CLSContext : DbContext\n    {\n        public DbSet&lt;Listing&gt; Listings { get; set; }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            modelBuilder.Entity&lt;Listing&gt;().Map(...?)\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#","entity-framework","xaml","data-binding","datasource"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12396404,"title":"I'm not seeing one of my grid rows....(two WrapPanel ListBox's in a XAML Grid)","body":"<p>I have two ListBox's in a grid. The ListBox ItemsPanelTemplate is set to \"WrapPanel.\" I'm expecting to see two separate rows but only see 1. I'm very new to xaml. Your help would be much appreciated. Thanks.</p>\n\n<pre><code>&lt;navigation:Page\nx:Class=\"BusMasterControl.Home\" \nxmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\" \nxmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\" \nxmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\" xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\nxmlns:navigation=\"clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Navigation\"\nxmlns:sdk=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation/sdk\" \nxmlns:riaControls=\"clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.DomainServices\" \nxmlns:ds=\"clr-namespace:BusMasterControl.Web\"\nxmlns:toolkit=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation/toolkit\"\nxmlns:Controls=\"clr-namespace:BusMasterControl.Controls\" \nxmlns:converters=\"clr-namespace:BusMasterControl.Controls.Converters\"\nmc:Ignorable=\"d\" \nd:DesignWidth=\"640\" \nd:DesignHeight=\"480\" \nStyle=\"{StaticResource PageStyle}\"&gt;\n\n&lt;UserControl.Resources&gt;\n    &lt;converters:UriToMachineNameConverter x:Key=\"uriToMachineNameConverter\" /&gt;\n&lt;/UserControl.Resources&gt;\n&lt;Grid x:Name=\"LayoutRoot\" VerticalAlignment=\"Top\" HorizontalAlignment=\"Left\" ShowGridLines=\"True\"&gt;\n    &lt;Grid.ColumnDefinitions&gt;\n        &lt;ColumnDefinition /&gt;\n    &lt;/Grid.ColumnDefinitions&gt;\n    &lt;Grid.RowDefinitions&gt;\n        &lt;RowDefinition /&gt;\n        &lt;RowDefinition /&gt;\n    &lt;/Grid.RowDefinitions&gt;\n\n    &lt;riaControls:DomainDataSource Name=\"busMasterControlDomainDataSource2\" LoadSize=\"500\" QueryName=\"GetResourceByDomainAndUriFilter\" AutoLoad=\"True\"&gt;\n        &lt;riaControls:DomainDataSource.DomainContext&gt;\n            &lt;ds:BusMasterControlDomainContext /&gt;\n        &lt;/riaControls:DomainDataSource.DomainContext&gt;\n        &lt;riaControls:DomainDataSource.QueryParameters&gt;\n            &lt;riaControls:Parameter ParameterName=\"domain\" Value=\"//bus.mydomain.com\" /&gt;\n            &lt;riaControls:Parameter ParameterName=\"uriFilter\" Value=\"red\" /&gt;\n        &lt;/riaControls:DomainDataSource.QueryParameters&gt;\n\n        &lt;riaControls:DomainDataSource.SortDescriptors&gt;\n            &lt;riaControls:SortDescriptor PropertyPath=\"resourceId\" Direction=\"Ascending\" /&gt;\n        &lt;/riaControls:DomainDataSource.SortDescriptors&gt;\n    &lt;/riaControls:DomainDataSource&gt;\n\n    &lt;riaControls:DomainDataSource Name=\"busMasterControlDomainDataSource\" LoadSize=\"500\" QueryName=\"GetResourceByDomainAndUriFilter\" AutoLoad=\"True\"&gt;\n        &lt;riaControls:DomainDataSource.DomainContext&gt;\n            &lt;ds:BusMasterControlDomainContext /&gt;\n        &lt;/riaControls:DomainDataSource.DomainContext&gt;\n        &lt;riaControls:DomainDataSource.QueryParameters&gt;\n            &lt;riaControls:Parameter ParameterName=\"domain\" Value=\"//bus.test.mydomain.com\" /&gt;\n            &lt;riaControls:Parameter ParameterName=\"uriFilter\" Value=\"red\" /&gt;\n        &lt;/riaControls:DomainDataSource.QueryParameters&gt;\n        &lt;riaControls:DomainDataSource.SortDescriptors&gt;\n            &lt;riaControls:SortDescriptor PropertyPath=\"resourceId\" Direction=\"Ascending\" /&gt;\n        &lt;/riaControls:DomainDataSource.SortDescriptors&gt;\n    &lt;/riaControls:DomainDataSource&gt;\n\n    &lt;ListBox Name=\"machines2\" BorderThickness=\"0\" ItemsSource=\"{Binding Data, ElementName=busMasterControlDomainDataSource2}\"  ScrollViewer.HorizontalScrollBarVisibility=\"Disabled\" Grid.RowSpan=\"1\"&gt;\n        &lt;ListBox.ItemsPanel&gt;\n            &lt;ItemsPanelTemplate&gt;\n                &lt;toolkit:WrapPanel /&gt;\n            &lt;/ItemsPanelTemplate&gt;\n        &lt;/ListBox.ItemsPanel&gt;\n        &lt;ListBox.ItemTemplate&gt;\n            &lt;DataTemplate&gt;\n                &lt;Controls:BusBench \n                   Background=\"Gray\"\n                   BorderBrush=\"Black\"\n                   BorderThickness=\"1\"\n                   Caption=\"{Binding Path=uri, Converter={StaticResource uriToMachineNameConverter},FallbackValue=Collapsed}\"/&gt;\n            &lt;/DataTemplate&gt;\n        &lt;/ListBox.ItemTemplate&gt;\n    &lt;/ListBox&gt;\n    &lt;ListBox Name=\"machines\" BorderThickness=\"0\" ItemsSource=\"{Binding Data, ElementName=busMasterControlDomainDataSource}\"  ScrollViewer.HorizontalScrollBarVisibility=\"Disabled\"  Grid.RowSpan=\"1\"&gt;\n        &lt;ListBox.ItemsPanel&gt;\n            &lt;ItemsPanelTemplate&gt;\n                &lt;toolkit:WrapPanel /&gt;\n            &lt;/ItemsPanelTemplate&gt;\n        &lt;/ListBox.ItemsPanel&gt;\n        &lt;ListBox.ItemTemplate&gt;\n            &lt;DataTemplate&gt;\n                &lt;Controls:BusBench \n               Background=\"Gray\"\n               BorderBrush=\"Black\"\n               BorderThickness=\"1\"\n               Caption=\"{Binding Path=uri, Converter={StaticResource uriToMachineNameConverter},FallbackValue=Collapsed}\"/&gt;\n            &lt;/DataTemplate&gt;\n        &lt;/ListBox.ItemTemplate&gt;\n    &lt;/ListBox&gt;\n&lt;/Grid&gt;\n</code></pre>\n\n<p></p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":78,"score":0,"question_id":12508250,"title":"Save Column Names of a Table in an array using LINQ in entity model with C#","body":"<p>I am new to C# just started a week ago ... Searched around for 2 days now but didnt find any useful help. I have made a data model which has 3 tables. I am trying to get the names of columns in a particular table in an array. </p>\n\n<p>I would prefer something like: </p>\n\n<pre><code>MISSEntities ms= New MISSEntities();\n\nvar List= from m in ms.TableName\n          select m.Column names;\n</code></pre>\n\n<p>i want result something like the List has name of columns eg. Name, address, phone number</p>\n"},{"tags":[".net","entity-framework","entity-framework-4","objectquery","dbquery"],"answer_count":3,"favorite_count":0,"up_vote_count":9,"down_vote_count":0,"view_count":2401,"score":9,"question_id":4766122,"title":"How can i convert a DBQuery<T> to an ObjectQuery<T>?","body":"<p>I've got a <code>DBQuery&lt;T&gt;</code> which converts to an <code>IQueryable&lt;T&gt;</code> (this bit works fine). But then I'm trying to convert the IQueryable to an ObjectQuery .. which fails :-</p>\n\n<pre><code>public void Foo(this IQueryable&lt;T&gt; source)\n{\n    // ... snip ...\n\n    ObjectQuery&lt;T&gt; objectQuery = source as ObjectQuery&lt;T&gt;;\n    if (objectQuery != null)\n    {\n        // ... do stuff ...\n    }\n}\n</code></pre>\n\n<p>This used to work before I changed over to Entity-Framework 4 CTP5 <em>Magic Unicorn blah blah blah</em>. Now, it's not working - ie. <code>objectQuery</code> is <code>null</code>.</p>\n\n<p>Now, <code>DBQuery&lt;T&gt; inherits IQueryable&lt;T&gt;</code> .. so I thought this should work.</p>\n\n<p>If i change the code to ..</p>\n\n<pre><code>var x = (ObjectQuery&lt;T&gt;) source;\n</code></pre>\n\n<p>then the following exception is thrown :-</p>\n\n<blockquote>\n  <p>System.InvalidCastException: Unable to\n  cast object of type\n  'System.Data.Entity.Infrastructure.DbQuery<code>1[Tests.Models.Order]'\n  to type\n  'System.Data.Objects.ObjectQuery</code>1[Tests.Models.Order]'.</p>\n</blockquote>\n\n<p>Any suggestions?</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":579,"score":3,"question_id":9376663,"title":"How to Clear Cache of Visual Studio 2010, Entity Data Model Wizard","body":"<p>I am using Entity Framework in my projects. First I do the following:</p>\n\n<ol>\n<li>Start Visual Studio</li>\n<li>Select Project >> Add New Items >> Ado.Net Entity Data Model</li>\n<li>Select Generate From Database and Next    </li>\n<li>Click New Connection Button And Connect To Oracle</li>\n<li>Connect</li>\n<li>Finish</li>\n</ol>\n\n<p>Then I Disconnect From Oracle Server:</p>\n\n<ol>\n<li>In Visual Studio</li>\n<li>Project >> Add New Items >> Ado.Net Entity Data Model</li>\n<li>Select Generate From Database and Next</li>\n</ol>\n\n<p>Then the Oracle Connection Wizard opened automatically, and I closed the connection dialog box, and the Entity Framework Wizard closed immediately.\nI cannot connect to any server after this step.</p>\n"},{"tags":["c#","mvc","entity-framework"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":636,"score":0,"question_id":6883998,"title":"C# MVC saving a list of sub items","body":"<p>I'm new to MVC and Entity frame work but i've come across an issue and i'm not sure how to resolve it some guidance is more then welcome.  I'm editing an object which has a sub list of different objects. I've got a working edit screen but i cant get the details stored back the database. I think the issue is around the context of the db but as i said i'm new to this.  Here are the 2 classes i'm using:</p>\n\n<pre><code>public class Role\n{    \n    [Key]    \n    public string Role { get; set; }    \n    public virtual ICollection&lt;Template&gt; Templates { get; set; }\n}\npublic class Template\n{    \n    [Key][Required]    \n    public string TemplateID { get; set; }    \n    [Required]    \n    public string Header { get; set; }    \n    [Required][DataType(DataType.MultilineText)]    \n    public string Description { get; set; }    \n    public virtual ICollection&lt;CorrespondenceRole&gt; Roles { get; set; }\n}\n</code></pre>\n\n<p>I also have this in my context </p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n{    \n    modelBuilder.Entity&lt;Template&gt;()        \n        .HasMany(c =&gt; c.Roles)        \n        .WithMany(c =&gt; c.Templates)        \n        .Map(m =&gt; m.ToTable(\"Template_Roles\")            \n            .MapLeftKey(\"TemplateID\")            \n            .MapRightKey(\"Role\"));\n}\n</code></pre>\n\n<p>If i use</p>\n\n<pre><code>public ActionResult Edit(Template ctemplate)\n{\n    db.Entry(ctemplate).State = EntityState.Modified;\n    db.SaveChanges();\n}\n</code></pre>\n\n<p>The changes to the template object are recorded to the database but any changes to the roles list  are totally ignored even if i hardcode ctemplate.roles.add(somerole) before the db save.</p>\n\n<p>However if i use</p>\n\n<pre><code>public ActionResult Edit(Template ctemplate)\n{\n    Template ct = db.Templates.Find(ctemplate.TemplateID);\n    ct.Roles.Add(db.Roles.Find(\"Other Party\"));\n    db.Entry(ct).State = EntityState.Modified;\n    db.SaveChanges();\n}\n</code></pre>\n\n<p>The \"role\" is saved against in the template in the database. So i could use this code to find the object then copy all the form fields into it and save it but it seems long winded when the first option does actually work but it just does not save my list.  Any comments or suggestions how best to save the changes to the object and its associated list of different objects? Thanks.</p>\n\n<p><strong>UPDATE</strong>\nI found this worked for me, but i have no idea if its the best way to go about it.</p>\n\n<pre><code>db.Entry(ct).State = EntityState.Modified;\n\nforeach (var entity in db.Roles.Where(cr =&gt; cr.TemplateID == ct.ID))\n    db.Roles.Remove(entity);\n\nforeach (Role cr in ct.Roles)\n    db.Roles.Add(cr);\n\ndb.SaveChanges();\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":12533266,"title":"Entity Framework 5 - Conditionally add entities","body":"<p>I have a fairly complex object which I am adding to the database. I use this object outside of the context scope, make changes to it and then re-attach the entity to the context and save it. The purpose is to provide versioning of the entity.</p>\n\n<p>I can change the entity state of the top level object to 'Added' which will create a new version of it in the database when changes have been made which is what I want, but this creates a new record for every single navigation property of the entity.</p>\n\n<p>I always want to create a new record for the top level object, but only want to create new records for the elements of the properties (some collections) that have changed.</p>\n\n<pre><code>context.Entry&lt;MyEntity&gt;(entity).State = System.Data.EntityState.Added;\n\ncontext.MyEntities.Attach(entity);\n\ncontext.MyEntities.Add(entity);\n\ncontext.SaveChanges(); \n</code></pre>\n\n<p>If I manually attach another top level property before saving, it seems to work, it will create a new record for the main entity, but no new record for that property (although not ideal as it doesn't know if its changed)</p>\n\n<pre><code>context.Organisations.Attach(entity.PropertyThatMayNotNeedANewVersion);\n</code></pre>\n\n<p>But it breaks if you try attaching all the items from a navigation property that is a collection.</p>\n\n<p><em>An error occurred while saving entities that do not expose foreign key properties for their relationships. The EntityEntries property will return null because a single entity cannot be identified as the source of the exception. Handling of exceptions while saving can be made easier by exposing foreign key properties in your entity types. See the InnerException for details.</em></p>\n\n<p><em>Store update, insert, or delete statement affected an unexpected number of rows (0). Entities may have been modified or deleted since entities were loaded. Refresh ObjectStateManager entries.</em></p>\n"},{"tags":["asp.net-mvc-3","sql-server-2008","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12529086,"title":"Entity Framework multiple parent tables","body":"<p>I have an existing database that I am trying to access via Entity Framework 4.3. Most tables and relationships haven't been a problem, but this set of tables is causing me a few issues which I can't seem to find an answer to.</p>\n\n<p>Here are the (condensed) entities:</p>\n\n<p><strong>Customer</strong></p>\n\n<pre><code>public class Customer\n{\n    public int CustomerID { get; set; }\n    public string Name { get; set; }\n\n    private int addressSourceTypeID = 2;\n    [NotMapped]\n    public int AddressSourceTypeID { \n        get { return addressSourceTypeID; } \n        set { addressSourceTypeID = value; } }\n\n    public virtual ICollection&lt;User&gt; Users { get; set; }\n    public virtual ICollection&lt;Contract&gt; Contracts { get; set; }\n    public virtual ICollection&lt;Address&gt; Addresses { get; set; }\n}\n</code></pre>\n\n<p><strong>Contract</strong></p>\n\n<pre><code>public class Contract\n{\n    public int ContractID { get; set; }\n    public string Name { get; set; }\n\n    private int addressSourceTypeID = 4;\n    [NotMapped]\n    public int AddressSourceTypeID { \n        get { return addressSourceTypeID; } \n        set { addressSourceTypeID = value; } }\n\n    public virtual int CustomerID { get; set; }\n    public virtual Customer Customer { get; set; }\n\n    //public virtual ICollection&lt;Address&gt; Addresses { get; set; }\n}\n</code></pre>\n\n<p><strong>Address</strong></p>\n\n<pre><code>public class Address\n{\n    [Key]\n    public int AddressID { get; set; }\n    public int AddressSourceTypeID { get; set; }\n\n    [ForeignKey(\"Customer\")]\n    public int SourceKey { get; set; }\n\n    public virtual Customer Customer { get; set; }\n    //public virtual Contract Contract { get; set; }\n    public virtual ICollection&lt;Contact&gt; Contacts { get; set; }\n}\n</code></pre>\n\n<p>What I have above is two entities <code>Customer</code> and <code>Contract</code> that both can have child <code>Address</code> entities. Currently the <code>Address</code> entity is set up to be a child of the <code>Customer</code> entity and this works fine as there isn't a link to <code>Contract</code> from <code>Address</code>.</p>\n\n<p>I have tried adding in <code>Contract</code> to the <code>Address</code> entity as I have done with the <code>Customer</code> entity as you can see from the commented out code segments. Unfortunatly this doesn't work, but I'm not surprised due to the reference to <code>Customer</code> in the <code>Address</code> ForeignKey annotation. I even tried to create specific version of the <code>Address</code> entity (i.e. <code>CustomerAddress</code>), but I get an error when more than one entity is attempting to bind to the same table.</p>\n\n<p>I have also tried using <code>ModelBuilder</code> in the EF <code>DBContext</code> however my knowledge here is pretty limited and I'm not sure how to do it in this case.</p>\n\n<p>Overall, what I need is the following:</p>\n\n<ul>\n<li>Customer entity to have a collection of child Addresses.</li>\n<li>Contract entity to have a collection of child Addresses.</li>\n</ul>\n\n<p>The link between these 'parent' tables to the Address table uses the following:</p>\n\n<ul>\n<li>Customer: CustomerID => Address: SourceKey AND Customer: AddressSourceTypeID (always 2) => Address: AddressSourceTypeID.</li>\n<li>Contract: ContractID => Address: SourceKey AND Contract: AddressSourceTypeID (always 4) => Address: AddressSourceTypeID.</li>\n</ul>\n\n<p>If anyone could help me or point me in the correct direction that would be great.</p>\n\n<p>Thanks very much.</p>\n"},{"tags":["multithreading","entity-framework","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":125,"score":0,"question_id":12521695,"title":"Multithreading Entity Framework: The connection was not closed. The connection's current state is connecting","body":"<p>So I have a windows service process that performs a workflow process. The back end uses Repository and UnitofWork Pattern and Unity on top of Entity Framework with the entities class generated from the edmx. I won't go into a whole lot of detail as its not necessary but basically there are 5 steps that the workflow goes through. A particular process might be at any stage at any point in time (in order of course). Step one just generates data for step two, which validates the data via a long running process to another server. Then step there generates a pdf with that data. For each stage we spawn a timer, however it is configurable to allow more than one timer to be spawned for each stage. Therein lays the problem. When I add a processor to a particular stage, it the following error randomly:</p>\n\n<p>The connection was not closed. The connection's current state is connecting.</p>\n\n<p>Reading up on this it seems obvious that this is happening because the context is trying to access the same entity from two threads. But this is where it is kind of throwing me for a loop. All of the information I can find on this states that we should be using a instance context per thread. Which as far as I can tell I am doing (see the code below). I am not using singleton pattern or statics or anything so I am not really sure why this is happening or how to avoid it. I have posted the relevant bits of my code below for your review.</p>\n\n<p>The base repository:</p>\n\n<pre><code> public class BaseRepository\n{\n    /// &lt;summary&gt;\n    /// Initializes a repository and registers with a &lt;see cref=\"IUnitOfWork\"/&gt;\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"unitOfWork\"&gt;&lt;/param&gt;\n    public BaseRepository(IUnitOfWork unitOfWork)\n    {\n        if (unitOfWork == null) throw new ArgumentException(\"unitofWork\");\n        UnitOfWork = unitOfWork;\n    }\n\n\n    /// &lt;summary&gt;\n    /// Returns a &lt;see cref=\"DbSet\"/&gt; of entities.\n    /// &lt;/summary&gt;\n    /// &lt;typeparam name=\"TEntity\"&gt;Entity type the dbset needs to return.&lt;/typeparam&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    protected virtual DbSet&lt;TEntity&gt; GetDbSet&lt;TEntity&gt;() where TEntity : class\n    {\n\n        return Context.Set&lt;TEntity&gt;();\n    }\n\n    /// &lt;summary&gt;\n    /// Sets the state of an entity.\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"entity\"&gt;object to set state.&lt;/param&gt;\n    /// &lt;param name=\"entityState\"&gt;&lt;see cref=\"EntityState\"/&gt;&lt;/param&gt;\n    protected virtual void SetEntityState(object entity, EntityState entityState)\n    {\n        Context.Entry(entity).State = entityState;\n    }\n\n    /// &lt;summary&gt;\n    /// Unit of work controlling this repository.       \n    /// &lt;/summary&gt;\n    protected IUnitOfWork UnitOfWork { get; set; }\n\n    /// &lt;summary&gt;\n    /// \n    /// &lt;/summary&gt;\n    /// &lt;param name=\"entity\"&gt;&lt;/param&gt;\n    protected virtual void Attach(object entity)\n    {\n        if (Context.Entry(entity).State == EntityState.Detached)\n            Context.Entry(entity).State = EntityState.Modified;\n    }\n\n    protected virtual void Detach(object entity)\n    {\n        Context.Entry(entity).State = EntityState.Detached;\n    }\n\n    /// &lt;summary&gt;\n    /// Provides access to the ef context we are working with\n    /// &lt;/summary&gt;\n    internal StatementAutoEntities Context\n    {\n        get\n        {                \n            return (StatementAutoEntities)UnitOfWork;\n        }\n    }\n}\n</code></pre>\n\n<p>StatementAutoEntities is the autogenerated EF class.</p>\n\n<p>The repository implementation:</p>\n\n<pre><code>public class ProcessingQueueRepository : BaseRepository, IProcessingQueueRepository\n{\n\n    /// &lt;summary&gt;\n    /// Creates a new repository and associated with a &lt;see cref=\"IUnitOfWork\"/&gt;\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"unitOfWork\"&gt;&lt;/param&gt;\n    public ProcessingQueueRepository(IUnitOfWork unitOfWork) : base(unitOfWork)\n    {\n    }\n\n    /// &lt;summary&gt;\n    /// Create a new &lt;see cref=\"ProcessingQueue\"/&gt; entry in database\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"Queue\"&gt;\n    ///     &lt;see cref=\"ProcessingQueue\"/&gt;\n    /// &lt;/param&gt;\n    public void Create(ProcessingQueue Queue)\n    {\n        GetDbSet&lt;ProcessingQueue&gt;().Add(Queue);\n        UnitOfWork.SaveChanges();\n    }\n\n    /// &lt;summary&gt;\n    /// Updates a &lt;see cref=\"ProcessingQueue\"/&gt; entry in database\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"queue\"&gt;\n    ///     &lt;see cref=\"ProcessingQueue\"/&gt;\n    /// &lt;/param&gt;\n    public void Update(ProcessingQueue queue)\n    {\n        //Attach(queue);\n        UnitOfWork.SaveChanges();\n    }\n\n    /// &lt;summary&gt;\n    /// Delete a &lt;see cref=\"ProcessingQueue\"/&gt; entry in database\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"Queue\"&gt;\n    ///     &lt;see cref=\"ProcessingQueue\"/&gt;\n    /// &lt;/param&gt;\n    public void Delete(ProcessingQueue Queue)\n    {\n        GetDbSet&lt;ProcessingQueue&gt;().Remove(Queue);  \n        UnitOfWork.SaveChanges();\n    }\n\n    /// &lt;summary&gt;\n    /// Gets a &lt;see cref=\"ProcessingQueue\"/&gt; by its unique Id\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"id\"&gt;&lt;/param&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public ProcessingQueue GetById(int id)\n    {\n        return (from e in Context.ProcessingQueue_SelectById(id) select e).FirstOrDefault();\n    }\n\n    /// &lt;summary&gt;\n    /// Gets a list of &lt;see cref=\"ProcessingQueue\"/&gt; entries by status\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"status\"&gt;&lt;/param&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public IList&lt;ProcessingQueue&gt; GetByStatus(int status)\n    {\n        return (from e in Context.ProcessingQueue_SelectByStatus(status) select e).ToList();\n    }\n\n    /// &lt;summary&gt;\n    /// Gets a list of all &lt;see cref=\"ProcessingQueue\"/&gt; entries\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public IList&lt;ProcessingQueue&gt; GetAll()\n    {\n        return (from e in Context.ProcessingQueue_Select() select e).ToList();\n    }\n\n    /// &lt;summary&gt;\n    /// Gets the next pending item id in the queue for a specific work        \n    /// &lt;/summary&gt;\n    /// &lt;param name=\"serverId\"&gt;Unique id of the server that will process the item in the queue&lt;/param&gt;\n    /// &lt;param name=\"workTypeId\"&gt;type of &lt;see cref=\"WorkType\"/&gt; we are looking for&lt;/param&gt;\n    /// &lt;param name=\"operationId\"&gt;if defined only operations of the type indicated are considered.&lt;/param&gt;\n    /// &lt;returns&gt;Next pending item in the queue for the work type or null if no pending work is found&lt;/returns&gt;\n    public int GetNextPendingItemId(int serverId, int workTypeId, int? operationId)\n    {\n        var id = Context.ProcessingQueue_GetNextPending(serverId, workTypeId,  operationId).SingleOrDefault();\n        return id.HasValue ? id.Value : -1;\n    }\n\n    /// &lt;summary&gt;\n    /// Returns a list of &lt;see cref=\"ProcessingQueueStatus_dto\"/&gt;s objects with all\n    /// active entries in the queue\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public IList&lt;ProcessingQueueStatus_dto&gt; GetActiveStatusEntries()\n    {\n        return (from e in Context.ProcessingQueueStatus_Select() select e).ToList();\n    }\n    /// &lt;summary&gt;\n    /// Bumps an entry to the front of the queue \n    /// &lt;/summary&gt;\n    /// &lt;param name=\"processingQueueId\"&gt;&lt;/param&gt;\n    public void Bump(int processingQueueId)\n    {\n        Context.ProcessingQueue_Bump(processingQueueId);\n    }\n}\n</code></pre>\n\n<p>We use Unity for dependency injection, some calling code for example:</p>\n\n<pre><code>#region Members\n    private readonly IProcessingQueueRepository _queueRepository;       \n    #endregion\n\n    #region Constructors\n    /// &lt;summary&gt;Initializes ProcessingQueue services with repositories&lt;/summary&gt;\n    /// &lt;param name=\"queueRepository\"&gt;&lt;see cref=\"IProcessingQueueRepository\"/&gt;&lt;/param&gt;        \n    public ProcessingQueueService(IProcessingQueueRepository queueRepository)\n    {\n        Check.Require(queueRepository != null, \"processingQueueRepository is required\");\n        _queueRepository = queueRepository;\n\n    }\n    #endregion\n</code></pre>\n\n<p>The code in the windows service that kicks off the timers is as follows:</p>\n\n<pre><code>            _staWorkTypeConfigLock.EnterReadLock();\n        foreach (var timer in from operation in (from o in _staWorkTypeConfig.WorkOperations where o.UseQueueForExecution &amp;&amp; o.AssignedProcessors &gt; 0 select o) \n                              let interval = operation.SpawnInternval &lt; 30 ? 30 : operation.SpawnInternval \n                              select new StaTimer\n                            {\n                                Interval = _runImmediate ? 5000 : interval*1000,\n                                Operation = (ProcessingQueue.RequestedOperation) operation.OperationId\n                            })\n        {\n            timer.Elapsed += ApxQueueProcessingOnElapsedInterval;\n            timer.Enabled = true;\n            Logger.DebugFormat(\"Queue processing for operations of type {0} will execute every {1} seconds\", timer.Operation, timer.Interval/1000);                \n        }\n        _staWorkTypeConfigLock.ExitReadLock();\n</code></pre>\n\n<p>StaTimer is just a wrapper on timer adding operation type. ApxQueueProcessingOnElapsedInterval then bascially just assigns work to the process based on the operation.</p>\n\n<p>I will also add a bit of the ApxQueueProcessingOnElapsedInterval code where we are spawning tasks.</p>\n\n<pre><code>            _staTasksLock.EnterWriteLock();\n        for (var x = 0; x &lt; tasksNeeded; x++)\n        {\n            var t = new Task(obj =&gt; ProcessStaQueue((QueueProcessConfig) obj),\n                             CreateQueueProcessConfig(true, operation), _cancellationToken);\n\n\n            _staTasks.Add(new Tuple&lt;ProcessingQueue.RequestedOperation, DateTime, Task&gt;(operation, DateTime.Now,t));\n\n            t.Start();\n            Thread.Sleep(300); //so there are less conflicts fighting for jobs in the queue table\n        }\n        _staTasksLock.ExitWriteLock();\n</code></pre>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12532942,"title":"Moving typed include expressions for child objects to parent object in Entity Framework Code first","body":"<p>I am trying to convert an Include statement for a child object, <code>Expression&lt;Func&lt;ChildObject, object&gt;&gt;&gt;</code> into an Include statement for a parent object <code>Expression&lt;Func&lt;ParentObject, object&gt;&gt;&gt;</code> to use when eagerly loading entities via EF code first.</p>\n\n<p>I have the following classes (other properties etc removed for brevity)</p>\n\n<pre><code>public class Channel\n{\n    public int Id  { get; set; }\n    public ICollection&lt;Video&gt; Videos { get; set; }\n}\n\npublic class Video\n{\n    public int Id  { get; set; }\n    public string Name  { get; set; }\n    public ICollection&lt;Tag&gt; Tags { get; set; }\n}\n\npublic class Tag\n{\n    public int Id  { get; set; }\n    public string Name  { get; set; }\n}\n</code></pre>\n\n<p>In my EF DbContext LazyLoading is disabled and is hidden behind a generic repository interface and is injected into my video repository.</p>\n\n<pre><code>public class MyDbContext : EntityDataContext : IRepository\n{\n    public MyDbContext(string connectionString) : base(connectionString)\n    {\n        this.Configuration.LazyLoadingEnabled = false;\n    }\n    ...\n    public IQueryable&lt;T&gt; List&lt;T&gt;(params Expression&lt;Func&lt;T, object&gt;&gt;[] associations) where T : class\n    {\n      IQueryable&lt;T&gt; source = (IQueryable&lt;T&gt;) this.Set&lt;T&gt;();\n      if (associations != null)\n      {\n        foreach (Expression&lt;Func&lt;T, object&gt;&gt; path in associations)\n          source = DbExtensions.Include&lt;T, object&gt;(source, path);\n      }\n      return source;\n    }\n    ...\n}\n</code></pre>\n\n<p>As per the single responsibility principle I have a repository of entities (Videos) that works with an MyDbContext, hidden behind an interface, to load Videos with included child objects via the <a href=\"http://msdn.microsoft.com/en-us/library/gg671236%28v=vs.103%29.aspx\" rel=\"nofollow\">Include</a> method.  The repository knows about Videos and how to load them with the required includes.  I have made the includes public to show what I am trying to do, please ignore where they are at the moment, the main idea is that they are only specified once anywhere in the application.</p>\n\n<pre><code>public class VideoRepository\n{\n    public VideoRepository(IRepository repository) { ... }\n    public Expression&lt;Func&lt;Video, object&gt;&gt;[] DefaultIncludes\n    {\n        get \n        {\n             // In reality there are many more includes, not just one.\n             return new Expression&lt;Func&lt;Video, object&gt;&gt;[] { v =&gt; v.Tags };\n        }\n    }\n\n    public IQueryable&lt;Video&gt; LoadAll()\n    {\n        return this.repository.List&lt;Video&gt;(this.DefaultIncludes)\n    }\n}\n</code></pre>\n\n<p>I also have a repository of Channels with works with the same DbContext, again hidden behind the interface.</p>\n\n<p>I now need to load channels with all of their associated videos, this did not happen previously, and again, as per the single responsibility principle, I would like to keep the video includes in a single place and use them in the ChannelRepository, something like this:</p>\n\n<pre><code>public class ChannelRepository\n{\n    public ChannelRepository(IRepository repository, IVideoRepository videoRepository) { ... }\n    public IQueryable&lt;Channel&gt; LoadWithVideos()\n    {\n        return this.repository.List&lt;Channel&gt;(new Expression&lt;Func&lt;Channel, object&gt;&gt;[] { c =&gt; c.Videos, this.videoRepository.DefaultIncludes });\n    }\n}\n</code></pre>\n\n<p>However, this will not work because the Default[Video]Includes are of the incorrect type <code>Expression&lt;Func&lt;Video, object&gt;&gt;</code> rather than <code>Expression&lt;Func&lt;Channel, object&gt;&gt;</code></p>\n\n<p>I have tried to convert to the correct type using the following code:</p>\n\n<pre><code>var channelIncludes = new List&lt;Expression&lt;Func&lt;Channel, object&gt;&gt;&gt;();\n            channelAssociations.Add(c=&gt; c.Videos);\nforeach (var videoInclude in this.videoRepository.DefaultIncludes)\n{\n    Expression&lt;Func&lt;Video, object&gt;&gt; include = videoInclude;\n    channelAssociations.Add(c =&gt; c.Videos.Select(include.Compile()));\n}\n</code></pre>\n\n<p>but this produces this exception:</p>\n\n<pre><code>System.ArgumentException was unhandled by user code\n  HResult=-2147024809\n  Message=The Include path expression must refer to a navigation property defined on the type. Use dotted paths for reference navigation properties and the Select operator for collection navigation properties.\nParameter name: path\n  Source=EntityFramework\n  ParamName=path\n  StackTrace:\n       at System.Data.Entity.DbExtensions.Include[T,TProperty](IQueryable`1 source, Expression`1 path)\n       at My.Data.Generic.EntityFramework41.EntityDataContext.List[T](Expression`1[] associations)\n...\n  InnerException: \n</code></pre>\n\n<p>This suggest that EF can not evaluate the expression tree, probably because of the <code>include.Compile()</code> turning it into a <code>Func&lt;Channel, object&gt;</code>.  However, I think I have to include the compile method because <code>.Select&lt;T&gt;(...)</code> which .<a href=\"http://msdn.microsoft.com/en-us/library/gg671236%28v=vs.103%29.aspx\" rel=\"nofollow\">Include</a> requires me to use, only takes <code>Func&lt;T, object&gt;</code> as an argument.</p>\n\n<p>Can anyone help me convert between the two different expressions or suggest a different/better way of implementing this whilst still maintaining the single responsibility principle?</p>\n"},{"tags":["asp.net","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12531270,"title":"difference between DBContext and Object context in Entity Framework","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/9176967/objectcontext-vs-dbcontext\">ObjectContext vs DbContext</a>  </p>\n</blockquote>\n\n\n\n<p>What is the difference between DBContext and Object context in Entity Framework? Do they differ only in properties or they have any other significant difference?</p>\n"},{"tags":["entity-framework","entity-framework-4.1","ef-code-first","dbcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12531874,"title":"Loading particular peoperties for entity and assigning it as reference to another entity","body":"<p>Example:</p>\n\n<p>I am entering a new invoice. For this invoice I need to enter a customer. Lets assume that we retrieved a list of customers:</p>\n\n<pre><code>var list = Context.Set&lt;Customer&gt;().ToList();\n</code></pre>\n\n<p>Here I see two issues:</p>\n\n<p>1) I do not need to bring all information for customer, I only need Id, Code and Name</p>\n\n<p>2) Customer in current DbContext is read-only, so it would be nice if it is possible to tell DbContext not to monitor their states, to improve performance.</p>\n\n<p>Questions:</p>\n\n<p>1) Can we load only partial data for customer, but still be able to assign it to Invoice (see code bellow)?</p>\n\n<p>2) Can we tell DbContext not to monitor Customers for changes, and still be able to do this:</p>\n\n<pre><code>Invoice.Customer = CustomerList[10];\n</code></pre>\n"},{"tags":["c#","entity-framework"],"answer_count":5,"favorite_count":9,"up_vote_count":30,"down_vote_count":0,"view_count":13493,"score":30,"question_id":5325797,"title":"The entity cannot be constructed in a LINQ to Entities query","body":"<p>There is an entity type called product that is generated by entity framework.\nI have writen this query</p>\n\n<pre><code>    public IQueryable&lt;Product&gt; GetProducts(int categoryID)\n    {\n        return from p in db.Products\n               where p.CategoryID== categoryID\n               select new Product { Name = p.Name};\n    }\n</code></pre>\n\n<p>The code below throws the following error : \"The entity or complex type Shop.Product cannot be constructed in a LINQ to Entities query\"</p>\n\n<pre><code>var products = productRepository.GetProducts(1).Tolist();\n</code></pre>\n\n<p>But when I use <code>select p</code> instead of <code>select new Product { Name = p.Name};</code> it works correctly.</p>\n\n<p>How can I preform a custom select section?</p>\n"},{"tags":["sql-server","entity-framework","sql-server-ce","database-connection","connection-string"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12531258,"title":"Automatically switching connection string on database connection error","body":"<p>I'm dealing with a C# application with a EntityFramework backbone using a DbContext.\nThe application has two choices: connect to a remote SQL server express or connect to a local SQL compact 4.0 database in case the network connection is not available.\nWhen my application starts, a thread is checking if a connection to the remote database is possible. Otherwise it automatically needs to switch the connection string and provider in order to connect to the local database.\nSo far I was trying to deal with this issue by modifying the connection string section in app.config and forcing the application to refresh the section, after saving the configuration. This approach is not the best since I need to have access rights to write into the app.config file.\nCould you suggest a better approach?</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12531468,"title":"Add association in entity framework 5","body":"<p>In a legacy product I have the following two tables:</p>\n\n<pre><code>Create Table City (\n    Id int identity not null,\n    Gid uniqueidentifier not null,\n    Name varchar(25) not null,\n    constraint PK_City Primary Key(Id)\n    )   \nCreate Table CityExtra(\n    Gid uniqueidentifier not null,\n    CityGid  uniqueidentifier not null,\n    ExtraName varchar(25) not null,\n    constraint PK_CityExtra Primary Key(Gid)\n    )\n</code></pre>\n\n<p>In the EF editor I would like to create a one-one relation between these two entities.\nCreating the association is not a problem, but how do I create the association mappings between City.Gid and CityExtra.CityGid (City.Gid is not a key)?\nOr is this not possible?</p>\n"},{"tags":["asp.net","mysql","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1898,"score":0,"question_id":4068007,"title":"Arithmetic operation resulted in an overflow","body":"<p>After updating my website on ii7 on window server 2008 from framework 3.5 to work with framework 4\ni got my c# base database class stop working copmlitly with this error: \"Arithmetic operation resulted in an overflow\".\nI am working with mysql server from different server.</p>\n\n<p>I did not find any solution on this so i had very sadness to role bakce to framework 3.5</p>\n\n<p>here is some of my logs for this error in the event viewr on my server:</p>\n\n<hr>\n\n<p>Process information: \n    Process ID: 3680 \n    Process name: w3wp.exe \n    Account name: NT AUTHORITY\\NETWORK SERVICE </p>\n\n<p>Exception information: \n    Exception type: OverflowException \n    Exception message: Arithmetic operation resulted in an overflow.\n   at DataAccess.ExecuteStringQuery(String strSQL) in d:\\webSites\\s2s\\App_Code\\DB\\DataAccess.cs:line 214\n   at DataSelect.generalString(String rowName, String tableName, String idName, String ID) in d:\\webSites\\s2s\\App_Code\\DB\\DataSelect.cs:line 48\n   at camsBaseShowWeb.OnPreInit(EventArgs e) in d:\\webSites\\s2s\\App_Code\\Bases\\camsBaseShowWeb.cs:line 134\n   at System.Web.UI.Page.PerformPreInit()</p>\n\n<h2>   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)</h2>\n\n<p>big thanks for any halp</p>\n\n<hr>\n\n<p>i got this error - no matter wich function i try to call from this code</p>\n\n<p>here is my code:</p>\n\n<pre><code>using System;\nusing System.Data;\n//using Microsoft.Data.Odbc;\nusing System.Data.Odbc;\nusing System.Configuration;\nusing System.Web;\nusing System.Web.Security;\nusing System.Web.UI;\nusing System.Web.UI.WebControls;\nusing System.Web.UI.WebControls.WebParts;\nusing System.Web.UI.HtmlControls;\n\npublic class DataAccess\n{\n    #region Private Variables\n    private static DataAccess _DataAccess = null;\n    private static object _SyncLock = new object();\n    private string _strCon = \"Driver={MySQL ODBC 5.1 Driver};Server=theIP;Database=theDatabase; UID=root;Password=thePassword;Option=3;\";\n    private OdbcConnection myConnection = null;\n    #endregion\n\n    #region Instance Method\n    public static DataAccess Instance\n    {\n        get\n        {\n            lock (_SyncLock)\n            {\n                if (_DataAccess == null)\n                    _DataAccess = new DataAccess();\n                return _DataAccess;\n            }\n        }\n    }\n    #endregion\n\n    #region Constractors\n    public DataAccess()\n    {\n        myConnection = new OdbcConnection(_strCon);\n        myConnection.Open();\n    }\n    #endregion\n\n    #region Public Functions\n    public OdbcDataReader ExecuteQueryReader(string strSQL)\n    {\n        try\n        {\n            OdbcCommand myCommand = new OdbcCommand(strSQL, myConnection);\n            return myCommand.ExecuteReader();\n        }\n        catch (Exception ex)\n        {\n            if (Dict.IsRemote == true)\n            {\n                sendMail(\"error ExecuteQueryReader SQL s2s\", strSQL, ex);\n            }\n            throw ex;\n        }\n    }\n\n    public DataTable ExecuteQuery(string strSQL)\n    {\n        DataTable dt = new DataTable();\n        OdbcDataAdapter objDataAdapter = null;\n        try\n        {\n            objDataAdapter = new OdbcDataAdapter(strSQL, myConnection);\n            objDataAdapter.Fill(dt);\n        }\n        catch (Exception ex)\n        {\n            if (Dict.IsRemote == true)\n            {\n                sendMail(\"error ExecuteQuery SQL s2s\", strSQL, ex);\n            }\n\n            throw ex;\n        }\n        finally\n        {\n            if (objDataAdapter != null) objDataAdapter.Dispose();\n        }\n        return dt;\n    }\n\n    public DataView ExecuteQueryDV(string strSQL)\n    {\n        DataTable dt = new DataTable();\n        OdbcDataAdapter objDataAdapter = null;\n        try\n        {\n            objDataAdapter = new OdbcDataAdapter(strSQL, myConnection);\n            objDataAdapter.Fill(dt);\n        }\n        catch (Exception ex)\n        {\n            if (Dict.IsRemote == true)\n            {\n                sendMail(\"error ExecuteQuery SQL s2s\", strSQL, ex);\n            }\n\n            throw ex;\n        }\n        finally\n        {\n            if (objDataAdapter != null) objDataAdapter.Dispose();\n        }\n        return new DataView(dt);\n    }\n\n    public DataTable ExecuteLimitedQuery(string strSQL, int startRow, int rowNum)\n    {\n        DataTable dt;\n        DataSet ds = new DataSet();\n        OdbcDataAdapter objDataAdapter = null;\n        try\n        {\n            objDataAdapter = new OdbcDataAdapter(strSQL, myConnection);\n            objDataAdapter.Fill(ds, startRow, rowNum, \"rowTable\");\n            dt = (DataTable)ds.Tables[\"rowTable\"];\n        }\n        catch (Exception ex)\n        {\n            if (Dict.IsRemote == true)\n            {\n                sendMail(\"error ExecuteLimitedQuery SQL s2s\", strSQL, ex);\n            }\n\n            throw ex;\n        }\n        finally\n        {\n            if (objDataAdapter != null) objDataAdapter.Dispose();\n        }\n        return dt;\n    }\n\n    public object ExecuteScalarQuery(string strSQL)\n    {\n        OdbcCommand myCommand = null;\n        object obj = null;\n\n        try\n        {\n            myCommand = new OdbcCommand(strSQL, myConnection);\n            obj = myCommand.ExecuteScalar();\n        }\n        catch (Exception ex)\n        {  \n            if (Dict.IsRemote == true)\n            {\n                sendMail(\"error ExecuteScalarQuery SQL s2s\", strSQL, ex);\n            }\n\n            throw ex; \n        }\n        finally\n        {\n            if (myCommand != null) myCommand.Dispose();  \n        }\n\n        return obj;\n    }\n\n    public string ExecuteStringQuery(string strSQL)\n    {\n        OdbcCommand myCommand = null;\n        object obj = null;\n\n        try\n        {\n            myCommand = new OdbcCommand(strSQL, myConnection);\n            obj = myCommand.ExecuteScalar();\n        }\n        catch (Exception ex)\n        {\n            if (myConnection.State != ConnectionState.Open)\n            {\n                myConnection.Open();\n                if (myCommand != null) myCommand.Dispose();\n\n                try\n                {\n                    myCommand = new OdbcCommand(strSQL, myConnection);\n                    obj = myCommand.ExecuteScalar();\n                }\n                catch (Exception ex2)\n                {\n                    if (Dict.IsRemote == true)\n                    {\n                        sendMail(\"error -    ExecuteStringQuery SQL s2s\", strSQL, ex2);\n                    }\n\n                    throw ex2;\n                }\n            }\n            else\n            {\n                if (Dict.IsRemote == true)\n                {\n                    sendMail(\"error ExecuteStringQuery SQL s2s\", strSQL, ex);\n                }\n\n                throw ex;\n            }\n        }\n        finally\n        {\n            if (myCommand != null) myCommand.Dispose();\n        }\n\n        return obj != null ? obj.ToString() : string.Empty;\n    }\n\n    public int ExecuteNoneQuery(string strSQL)\n    {\n        OdbcCommand myCommand = null;\n        int i;\n        try\n        {\n            myCommand = new OdbcCommand(strSQL, myConnection);\n            i = myCommand.ExecuteNonQuery();\n        }\n        catch (Exception ex)\n        {\n            if (Dict.IsRemote == true)\n            {\n                sendMail(\"error ExecuteNoneQuery SQL s2s\", strSQL, ex);\n            }\n\n            throw ex;\n        }\n        finally\n        {\n            if (myCommand != null) myCommand.Dispose();  \n        }\n        return i;\n    }\n\n    public int InsertGetLastID(string strSQL)\n    {\n        OdbcCommand myCommand = null;\n        int LastID = 0;\n        object objID = null;\n\n        try\n        {\n            myCommand = new OdbcCommand(strSQL, myConnection);\n            if (myCommand.ExecuteNonQuery() == 1)\n            {\n                myCommand = new OdbcCommand(\"SELECT LAST_INSERT_ID()\", myConnection);\n                objID = myCommand.ExecuteScalar();\n                if (objID != null)\n                {\n                    LastID = int.Parse(objID.ToString());\n                }\n            }\n        }\n        catch (Exception ex)\n        {\n            if (Dict.IsRemote == true)\n            {\n                sendMail(\"error InsertGetLastID SQL s2s\", strSQL, ex);\n            }\n\n            throw ex;\n        }\n        finally\n        {\n            if (myCommand != null) myCommand.Dispose();  \n        }\n        return LastID;\n    }\n\n    private void sendMail(string title, string sql, Exception ex)\n    {\n        string body = string.Empty +\n            \"SQL:\\n\\n\" + sql + \"\\n\\n\" +\n            \"Exeption:\\n\\n\" + ex.Message + \"\\n\\n\" +\n            \"Stack Trace:\\n\\n\" + ex.StackTrace + \"\\n\\n\" +\n            \"Source:\\n\\n\" + ex.Source + \"\\n\\n\";\n\n        mailSend mailS = new mailSend(\"theMail\", \"mailTo\", title, body);\n    }\n    #endregion\n}\n</code></pre>\n"},{"tags":["c#","database","visual-studio","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12530396,"title":"Is there any librar, plugin for Visual Studio 2012, or any other tool or way to create C# initializer class for existing database?","body":"<p>Using SQL Server Management Studio we have ability to script entire existing database to one sql script with all database schema and data. What I need is some tool, which will automatically create similar C# database initializer class or classes, which will represent database structure model, and fill this database with it's data. Maybe is it possible somehow to convert SQL script to C#? Any suggestions?</p>\n\n<p>P.S. To create database I use EntityFramework codefirst strategy.</p>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12527861,"title":"MVC: Updating a FK Relationship from a SelectList","body":"<p>I'm playing with MVC4 and EF Code First and I'm having a problem getting a DropDownList to update a foreign key of a model type. </p>\n\n<p>Here are my models:</p>\n\n<pre><code>public class Customer\n{\n    public int CustomerID { get; set; }\n\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n\n}\n\npublic class Party\n{\n    public int PartyID { get; set; }\n\n    public virtual Customer Host { get; set; }\n    public string Location { get; set; }\n    public DateTime Date { get; set; }\n}\n</code></pre>\n\n<p>So a Party has a <code>Host</code> which is a <code>Customer</code></p>\n\n<p>In the controller for the <code>/Party/Create</code> GET method, I'm passing a list of customers in the ViewBag:</p>\n\n<p><code>ViewBag.Customers = new SelectList(db.Customers, \"CustomerID\", \"FirstName\");</code></p>\n\n<p>And then in the View I'm rendering this as a DropDownList:</p>\n\n<p><code>@Html.DropDownListFor(model =&gt; model.Host, ViewBag.Customers as SelectList, String.Empty)</code></p>\n\n<p>This all works fine, I can choose from a list of customers in the dropdown. However, when I submit the form, the /Party/Create POST method doesn't insert the data because the <code>ModelState</code> is not valid. Looking at the <code>ModelState</code>, I can see that the <code>CustomerID</code> of the chosen Customer is present, but it is failing to be converted from a String to an object of type <code>Customer</code></p>\n\n<p>What have I missed?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":12529395,"title":"On Demand data loading with Entity Framework","body":"<p>I am creating graphic application and where the user can import the graphic data from a SQL Sever database. This application should be capable of handling at least 100,000+ entities. The idea to load the data faster is to load the visual data while opening the database file and non-visual data will be loaded on demand. So, the problem which I am facing is with the data loading from database using Entity Framework.</p>\n\n<p>Each entity has a visual and a non-visual data associated and following is an example of one of the entity:</p>\n\n<pre><code>class Polyline\n{\n  Guid ID {get; set;}\n  PolylineGeometry PGeometry {get; set;}\n  PolylineAttribData PAttribData {get; set;}\n}\nclass PolylineGeometry\n{\n  List&lt;Point3D&gt; PointCollection {get; set;}\n}\nclass PolylineAttribData\n{\n  Image ImageData {get; set;}\n}\n</code></pre>\n\n<p>My context class is as follows:</p>\n\n<pre><code>class GeometryData : DbContext\n{\n  DbSet&lt;Polyline&gt; Polylines {get; set;}\n}\n</code></pre>\n\n<p>So, when we create the database context or the geometry data initially only the ID is loaded into polyline and PGeometry &amp; PAttribData is not loaded. So, how do I load this data?</p>\n\n<p>Thank You,</p>\n\n<p>Pankaj</p>\n"},{"tags":["wcf","silverlight","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":173,"score":0,"question_id":9755876,"title":"WCF calls from silverlight being executed sequentially rather than in parallel","body":"<p>I am using Silverlight 5.0 and WCF 4.0 with entity framework 4.0. My design is as follows - Silverlight client calls a service agent(this is just a wrapper to a in process WCF service) through normal synchronous method call.  THe service agent inturn calls a WCF service which is configured with a custombinding with binary encoding and httptransport. This WCF service is hoested in the same application as Silverlight and the calls from service agent is being made through \"operationame\"Async methods. Theservice agent has custom events that will be fired when \"operation\"Completed method is called. This service agent event will be handled by silverlight. This WCF service again makes a call to a distributed WCF service using \"operationame\"Async method.</p>\n\n<p>My silverlight application has four different widgets in the screen and they make four calls to the service agent. The four calls from the service agent are being triggered parallely to the in process WCF service. But from the in process WCF service the calls are being made sequentially to the ditributed wcf service. I just checked with fiddler which shows that in process wcf is making sequential calls to ditributed wcf service. I would like to make it in parallel. Can somebody please help. The problem is my server is processing them ony by one as against running them in parallel. I confirmed this through fiddler where i saw the calls were arriving at the WCF sequentially. The WCF distributed service is configured as a percall with concurrencymode single and webhttpbinding.</p>\n\n<p>Also does anybody have any resource/links to understand how the silverlight / wcf threading model works. I am interested in knowing if proxymethodAsync call is spawning a new thread?If not how does it work without blocking the UI thread?</p>\n"},{"tags":["asp.net-mvc","entity-framework","azure","cloud"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12528643,"title":"Entity Framework creating settings table that I can't put on Azure","body":"<p>I've been trying to create an ASP.net - MVC app that uses entity framework to connect to an Azure database.</p>\n\n<p>I used a database first method to try and create the Model, I was able to connect to my azure database and successfully create the model.</p>\n\n<p>Everything was working perfectly and I was able to retrieve my values from my azure database then I tried to publish the website to an Azure website. The website works fine and I have the website registered as able to use the azure database. When I click on the button that hits the controller to access the database I then get \"Sorry, an error occurred while processing your request.\"</p>\n\n<p>When I looked into this a bit more I seen that when I created my Entity Data model using the wizard it created a connection string to a local db for my entity connection settings. I'm guessing this is saving some entity framework settings but my problem is obviously when I publish the website to Azure it can't access this local db.</p>\n\n<p>Any suggestions on how to either get this DB onto Azure or avoid using this extra database?</p>\n\n<p>Thanks</p>\n"},{"tags":[".net","visual-studio","entity-framework","poco"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12528631,"title":"Adding persistence awareness to POCO , EF5","body":"<p>[edited for clarity]</p>\n\n<p>Here is my scenario\nIve managed to create a POCO model of my db, consisting of only two tables, Blog and Post.[Model]</p>\n\n<p>I want to create another project that references these classes and adds some db persistence code to it, which i dont know how. [DAL]</p>\n\n<p>Later on, ill use this [DAL] inside the [BLL] to validate the data and present it to [Presentation].</p>\n\n<p>In other projects i used EF but didnt create POCOS, so i ended up having data access code in the BLL and this time am trying to keep things strictly compartimentalized.</p>\n\n<p>In the past, EF did everything for me, i just added a model and i could then call SaveChanges(). Now, do i have to write my self \"insert..into...\" in this new [DAL] im trying to create? there has to be an automated way</p>\n"},{"tags":["asp.net","entity-framework","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":340,"score":0,"question_id":7233640,"title":"How do I include a foreign key on a one-to-many relationship in an Entity Data Source?","body":"<p>I am working through this tutorial: <a href=\"http://www.asp.net/entity-framework/tutorials/the-entity-framework-and-aspnet-%E2%80%93-getting-started-part-3\" rel=\"nofollow\">http://www.asp.net/entity-framework/tutorials/the-entity-framework-and-aspnet-%E2%80%93-getting-started-part-3</a></p>\n\n<p>About 2/3 down the page, you will see this:</p>\n\n<blockquote>\n  <p>The OrderByExpression element specifies that the result set will be ordered by course title within department name. Notice how department name is specified: Department.Name. Because the association between the Course entity and the Department entity is one-to-one, the Department navigation property contains a Department entity. (If this were a one-to-many relationship, the property would contain a collection.) To get the department name, you must specify the Name property of the Department entity.</p>\n</blockquote>\n\n<p>How do I setup a collection for my one-to-many relationship? I looked around on the net and couldn't find an answer. I get the following message when I run the page:</p>\n\n<blockquote>\n  <p>DataBinding: 'System.Data.Objects.DataClasses.EntityCollection`1[[QCPropertiesModel.Property, App_Code.s8yp4uy2, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null]]' does not contain a property with the name 'DataPublished'.</p>\n</blockquote>\n\n<p>This is my code:</p>\n\n<pre><code>&lt;asp:EntityDataSource ID=\"PropertiesDataSource\" runat=\"server\" \nConnectionString=\"name=QCPlacesEntities\" \n    DefaultContainerName=\"QCPlacesEntities\" EnableFlattening=\"False\" \nEntitySetName=\"CustomerDetails\"\ninclude=\"Properties\"&gt;\n&lt;/asp:EntityDataSource&gt;\n\n    &lt;asp:QueryExtender ID=\"SearchQueryExtender\" runat=\"server\" \n    TargetControlID=\"PropertiesDataSource\" &gt;\n&lt;/asp:QueryExtender&gt;\n    &lt;asp:GridView ID=\"SearchGridView\" runat=\"server\" AutoGenerateColumns=\"False\" \n    DataKeyNames=\"CustomerID\" DataSourceID=\"PropertiesDataSource\"  AllowPaging=\"true\"&gt;\n    &lt;Columns&gt;\n        &lt;asp:TemplateField HeaderText=\"Date Published\"&gt;\n            &lt;ItemTemplate&gt;\n                &lt;asp:Label ID=\"Label2\" runat=\"server\" Text='&lt;%# Eval(\"Properties.DatePublished\") %&gt;'&gt;&lt;/asp:Label&gt;\n            &lt;/ItemTemplate&gt;\n        &lt;/asp:TemplateField&gt;\n        &lt;asp:BoundField DataField=\"CustomerID\" HeaderText=\"ID\"/&gt;\n        &lt;asp:BoundField DataField=\"CustomerLName\" HeaderText=\"Last Name\" /&gt;\n        &lt;asp:BoundField DataField=\"CustomerFName\" HeaderText=\"First Name\" /&gt;\n    &lt;/Columns&gt;\n&lt;/asp:GridView&gt;\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12528014,"title":"delete and then insert object Entity framework","body":"<p>I have this method that delete object if exist and insert the new instance any way :</p>\n\n<pre><code>  internal void SaveCarAccident(WcfContracts.BLObjects.Contract.Dtos.CarAccident DTOCarAccident)\n    {                       \n         using(var context = BLObjectsFactory.Create())\n        {\n            context.ContextOptions.ProxyCreationEnabled = false;\n            CarAccident NewCarAccident = ConvertToCarAccident(DTOCarAccident);\n            CarAccident carFromDB = context.CarAccident.FirstOrDefault(current =&gt; current.CarAccidentKey.Equals(NewCarAccident.CarAccidentKey));\n            if(carFromDB != null)\n                context.CarAccident.DeleteObject(carFromDB);\n            context.CarAccident.AddObject(NewCarAccident);\n            context.SaveChanges();\n        }\n    }\n</code></pre>\n\n<p>I sometimes get exception that the key already exist in table.<br>\nI wnted to know if the way I save the changes is a problem (saving after delete and insert and not after each one)<br>\nAt the time I got the exception there were few clients that activate the method at the same time I blocked other clients from writing already, but is this may be the problem ?<br>\nThanks<br>\nEran</p>\n"},{"tags":["c#",".net","sql","sql-server","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":485,"score":1,"question_id":6479720,"title":"Inserting many items to multiple relationship tables in parallel in SQL Server?","body":"<p>I have 1M html files that I need to parse and then insert the extracted information into my sql server. Each file parsed out information end up in multiple tables due to relationships among the objects I have parsed out</p>\n\n<p>I am using Entity Framework right now to do this but adding each piece of my information to the proper object on the EF context takes a long time and not efficient! I need this faster especially that I have so many file to process.</p>\n\n<p>What is the fasted way to parse out a lot of file in parallel and insert it in SQL server where items you are adding have relationships?</p>\n\n<p>Also, is there a better technology for this? Like Informatica?</p>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12525244,"title":"Entity Framework Code First Transaction","body":"<p>I am using Entity Framework 4 with SqlServer CE as the database.</p>\n\n<p>Because SqlServer CE does not support TransactionScope, so I have to resort to using BeginTransaction and RollbackTransaction method.</p>\n\n<p>I have two GRUD functions to delete and create rows in the database.</p>\n\n<p>What I want to achieve is something like this :</p>\n\n<pre><code>    using (var context = new MyContext())\n                {\n                    using (var tx = context.BeginTransaction()) \n                    { \n                       // grud functions\n                       deleteRows();\n                       addRows();\n\n                       // do db stuff here... \n                       tx.Commit(); \n                    } \n                }\n</code></pre>\n\n<p>But I cannot find BeginTransaction in the context.</p>\n\n<p>How can I go about it?</p>\n\n<p>Thank you.</p>\n"},{"tags":["entity-framework","filtering","wcf-data-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":479,"score":1,"question_id":776473,"title":"ADO.NET Data Services: How to filter a entity based on foreign keys?","body":"<p>This might be a entity framework related question, anyway, here goes:</p>\n\n<p>Consider the following simple database schema:</p>\n\n<pre><code>CREATE TABLE Supplier(\n    SupplierId int identity(1,1) not null primary key,\n    DisplayName nvarchar(50)\n)\n\nCREATE TABLE Category(\n    CategoryId int identity(1,1) not null primary key,\n    DisplayName nvarchar(50)\n)\n\nCREATE TABLE Product(\n    ProductId int identity(1,1) not null primary key,\n    SupplierId int references Supplier.SupplierId,\n    CategoryId int references Category.CategoryId,\n    DisplayName nvarchar(50)\n)\n</code></pre>\n\n<p>What I want is to filter products based on a supplier and a category. Normally I would just supply a category id and a supplier id, but since I am exposing my database through EF, Data Services do not allow me to do something like this: </p>\n\n<pre><code>$filter=SupplierId eq 1 and CategoryId eq 2\n</code></pre>\n\n<p>This seems like a pretty common scenario, so it must be possible. But how?</p>\n"},{"tags":["performance","entity-framework","entity-framework-4","linq-to-entities"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":12513865,"title":"ToTraceString takes long time to execute","body":"<p>I have a service that executes a query through Entity Framework 4, and it doesn't have any problem, until now I tried to execute it on a Windows Server 2003 with IIS 6 or a Windows 7 with IIS 7.</p>\n\n<p>Now, when I try to run the same service on a Windows Server 2008 R2 and IIS 7.5 the <strong>same query</strong> becomes very slow (From like 200ms to 3 seconds). Analyzing the problem I discovered that takes so long when it tries to generate the sql query to execute, just calling a <strong>ToTraceString() take almost 3 seconds.</strong></p>\n\n<p>I don't know if the OS and IIS version could be the problem, but they are the only differences I see.</p>\n\n<p>Thank you</p>\n\n<p><strong>Update</strong></p>\n\n<p>I have found out that problem is effectively in the time that Entity Framework takes to generate the query, and it depends about the processor, with Intel it works very well, <strong>with AMD it is much slower and it gets worse if the application runs with multi-cores</strong>, forcing the w3wp to use a single core it get better but still slower than the Intel solution</p>\n"},{"tags":["asp.net","entity-framework","asp.net-mvc-3","iis","warm-up"],"answer_count":3,"favorite_count":5,"up_vote_count":10,"down_vote_count":0,"view_count":2143,"score":10,"question_id":7387123,"title":"How to warm up an ASP.NET MVC application on IIS 7.5?","body":"<p>We would like to warm up an ASP.NET MVC application hosted on IIS 7.5 server. The warm up module that used to be available at <a href=\"http://forums.iis.net/t/1176740.aspx\">http://forums.iis.net/t/1176740.aspx</a> has been removed since sometime.</p>\n\n<p>The application should be warmed up everytime IIS or ASP.NET worker-process restarts for any reason. During the warm up period, IIS should return some HTTP status code signifying its warm up state or its inability to serve any clients.</p>\n\n<p>Would creating a executable that navigates through necessary pages in the site via HttpRequests be a good idea? The executable can be triggered from IProcessHostPreloadClient implementation. Is it possible to configure IIS so that it would only accept requests from localhost and once the executable is done, it can switch over to all clients - but that switch should not trigger an IIS restart (obviously).</p>\n\n<p>Is it possible to use an Visual Studio 2010 - Web Performance Test to warm-up an application instead of creating an manual executable? Any other alternatives?</p>\n\n<p>PS: The application uses Forms Authentication and uses sessions - so maintaining state cookie and other cookies is important.</p>\n\n<p>UPDATE 1 - We are using .NET Framework 4.0 and Entity Framework (database first) in our application. The first time hits to EF queries are slow. The reason behind the warm up is to get these first time hits out of the way. We are already using compiled queries at most places and we have implemented pre-compiled views for EF. The size of the model and application is very large and complex. Warm up needs to walk through many pages to ensure that compiled and non-compiled EF queries get executed at-least once before any end user gets access to the application.</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12525482,"title":"Entity Framework, strange behaviour with required reference, lazy loading","body":"<p>This goes for both Entity Framework 4 (4.3.1) and 5.</p>\n\n<p>I have a User class (to go with my Entity Framework MembershipProvider). I've removed some of the properties to simplify. The actual User is from the MVCBootstrap project, so it's not part of the same assembly as the other classes.</p>\n\n<pre><code>public class User {\n    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public Guid Id { get; set; }\n    [Required]\n    [StringLength(256)]\n    public String Username { get; set; }\n}\n</code></pre>\n\n<p>And then I have this class:</p>\n\n<pre><code>public class NewsItem {\n    public Int32 Id { get; set; }\n    [Required]\n    [StringLength(100)]\n    public String Headline { get; set; }\n    [Required]\n    public virtual User Author { get; set; }\n    [Required]\n    public virtual User LastEditor { get; set; }\n}\n</code></pre>\n\n<p>Then I create the database context (The DbSet for the user is in the MembershipDbContext):</p>\n\n<pre><code>public class MyContext : MVCBootstrap.EntityFramework.MembershipDbContext {\n    public MyContext(String connectString) : base(connectString) { }\n    public DbSet&lt;NewsItem&gt; NewsItems { get; set; }\n}\n</code></pre>\n\n<p>Running this code will give me this exception when the database is being created:</p>\n\n<blockquote>\n  <p>Introducing FOREIGN KEY constraint 'FK_dbo.WebShop_dbo.User_LastEditor_Id' on table 'WebShop' may cause cycles or multiple cascade paths. Specify ON DELETE NO ACTION or ON UPDATE NO ACTION, or modify other FOREIGN KEY constraints.\n  Could not create constraint. See previous errors.</p>\n</blockquote>\n\n<p>So I change the database context:</p>\n\n<pre><code>public class MyContext : MVCBootstrap.EntityFramework.MembershipDbContext {\n    public MyContext(String connectString) : base(connectString) { }\n    public DbSet&lt;NewsItem&gt; NewsItems { get; set; }\n    protected override void OnModelCreating(DbModelBuilder modelBuilder) {\n        base.OnModelCreating(modelBuilder);\n        modelBuilder.Configurations.Add(new NewsItemConfiguration());\n    }\n}\n</code></pre>\n\n<p>And this configuration:</p>\n\n<pre><code>public class NewsItemConfiguration : EntityTypeConfiguration&lt;NewsItem&gt; {\n    public NewsItemConfiguration() {\n        HasRequired(n =&gt; n.Author).WithOptional();\n        HasRequired(n =&gt; n.LastEditor).WithOptional();\n    }\n}\n</code></pre>\n\n<p>Or is this wrong?</p>\n\n<p>Anyway, when I run the code, the database get's created, and the database seems okay (looking at foreign key constraints etc.).</p>\n\n<p>But, then I get the 10 latest NewsItems from the context, and start loading them into view models, part of this is accessing the Author property on the NewsItem. The controller doing this takes forever to load, and fails after a long, long time. When running in debug mode, I get an exception in this piece of code: <code>this.AuthorId = newsItem.Author.Id;</code>, then exception I get is this:</p>\n\n<blockquote>\n  <p>A relationship multiplicity constraint violation occurred: An EntityReference can have no more than one related object, but the query returned more than one related object. This is a non-recoverable error.</p>\n</blockquote>\n\n<p>It's probably something simple and stupid I'm doing wrong, I'm sure I've get similar code running on several sites, so .. what is causing this? Are my models wrong, is it the database context, or?</p>\n"},{"tags":["asp.net-mvc","entity-framework","razor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12525181,"title":"Correct way to update related field for 1-to-many relation","body":"<p>Issuer has as a related field KeyEntity. My code works, but I think that there must be a better way to update the related field other than loading entities from database.\nThere should be something wrong in ViewModeling and templating... Thanks in advance.</p>\n\n<p>OpViewModel</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class OpViewModel\n{   \n    public Connect.Models.Issuer Issuer { get; set; }\n    public IEnumerable&lt;SelectListItem&gt; KeyEntities { get; set; }\n\n    public OpViewModel() { } \n    public OpViewModel(Connect.Models.Issuer issuer, \n                        IEnumerable&lt;Jose.Models.KeyEntity&gt; key_entities)\n    {   \n        this.Issuer = issuer;\n        this.KeyEntities = key_entities.Select(k =&gt;\n                        new SelectListItem()\n                        {   \n                            Selected = (k.Id == issuer.KeyEntity.Id),\n                            Text = k.Id.ToString(),\n                            Value = k.Id.ToString()\n                        }); \n    }   \n}   \n</code></pre>\n\n<p>Op/Edit.chtml(Razor)</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>@model AdConnect.Models.OpViewModel\n@using (Html.BeginForm()) {\n\n    &lt;div class=\"editor-field\"&gt;\n        @Html.DropDownListFor(model =&gt; model.Issuer.KeyEntity.Id,\n                                Model.KeyEntities)\n    &lt;/div&gt;\n\n}   \n</code></pre>\n\n<p>OpController</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>    [HttpPost]\n    public ActionResult Edit(Models.OpViewModel obj)\n    {   \n        if (ModelState.IsValid)\n        { \n            //  This works for most data fields of Issuer, but KeyEntity's Id \n            //  (dbo.Issuers.KeyEntity_Id) is not updated.\n            //\n            //  ctx.Entry(obj.Issuer).State = System.Data.EntityState.Modified\n\n            //  So load Issuer and KeyEntity from the database and update.\n\n            var issuer = ctx.Issuers.Find(obj.Issuer.Id);\n            if (obj.Issuer.KeyEntity != null)\n            {   \n                 issuer.KeyEntity =\n                    ctx.KeyEntities.Find(obj.Issuer.KeyEntity.Id);\n            }   \n            ctx.Entry(issuer).CurrentValues.SetValues(obj.Issuer);\n\n            ctx.SaveChanges();\n            return RedirectToAction(\"Index\");\n        }\n\n        return View(obj);\n    }\n</code></pre>\n"},{"tags":["c#","entity-framework","lambda","expression","iqueryable"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12525173,"title":"How to create filter expression dynamically in EF IQueryable?","body":"<p>Lets say we have interface:</p>\n\n<pre><code>public interface ISystemCompany\n{\n    Guid SystemCompanyId { get; set; }\n}\n</code></pre>\n\n<p>We also have <code>IQueryable&lt;&gt;</code> of type, that implements <code>ISystemCompany</code>.</p>\n\n<p>We have specific SystemCompanyId value: <code>432486bc-95f2-e111-be6e-74de2b99e249</code></p>\n\n<p>We want to write function, that filters IQueryable by value of this field. This is example of function like that:</p>\n\n<pre><code>public IQueryable FilterByValue(IQueryable listToFilter, Guid valueToFilter)\n{\n    var parameter = Expression.Parameter(typeof(object)); \n    // item\n    var converted = Expression.Convert(parameter, typeof(ISystemCompany)); \n    // (ISystemCompany)item\n    var member = Expression.Property(converted, \"SystemCompanyId\"); \n    // ((ISystemCompany)item).SystemCompanyId\n    var comparison = Expression.Equal(member, Expression.Constant(valueToFilter)); \n    // ((ISystemCompany)item).SystemCompanyId == valueToFilter\n    var expression = Expression.Lambda&lt;Func&lt;object, bool&gt;&gt;(comparison, new[] { parameter } ); \n    //item =&gt; ((ISystemCompany)item).SystemCompanyId == valueToFilter\n    return ((IQueryable&lt;object&gt;)listToFilter).Where(expression); \n    // listToFilter.Where(((ISystemCompany)item).SystemCompanyId == valueToFilter)\n}\n</code></pre>\n\n<p>This function doesn't work with Entity Framework, because it doesn't support deferred execution. How can I improve it to introduce this support?</p>\n"},{"tags":["c#","entity-framework","wcf-ria-services","silverlight-5.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12522410,"title":"Where to find the EntityList<T> in silverlight ria services?","body":"<p>I can't find any assembly which contains <code>EntityList&lt;T&gt;</code> class.</p>\n\n<p>I was reading in old posts that I need a toolkit. But I can't find it because the assembly name has changed. I'm currently using SL5.0.</p>\n\n<p>I'm looking for that object because I need an <code>ObservableCollection&lt;T&gt;</code> which supports <code>EntitySet&lt;T&gt;</code>. In fact, at the beginning I started using <code>ObservableCollection&lt;T&gt;</code> but I realized that it could not update my items.</p>\n\n<p>I've read, <code>EntityList&lt;T&gt;</code> is the solution.</p>\n"},{"tags":["asp.net-mvc","entity-framework","linq-to-sql","exception"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":2588,"score":5,"question_id":6774871,"title":"Why am I getting a \"Unable to update the EntitySet because it has a DefiningQuery...\" exception when trying to update a model in Entity Framework?","body":"<p>While updating with the help of LINQ to SQL using Entity Framework, an exception is thrown.</p>\n\n<pre><code>System.Data.UpdateException: Unable to update the EntitySet 't_emp' because it has \na DefiningQuery and no &lt;UpdateFunction&gt; element exists in the   \n&lt;ModificationFunctionMapping&gt;\n</code></pre>\n\n<p>The code for update is :</p>\n\n<pre><code>public void Updateall()\n    {\n        try\n        {\n\n\n            var tb = (from p in _te.t_emp\n                      where p.id == \"1\"\n                      select p).FirstOrDefault();\n            tb.ename = \"jack\";\n\n            _te.ApplyPropertyChanges(tb.EntityKey.EntitySetName, tb);\n            _te.SaveChanges(true);\n        }\n        catch(Exception e)\n        {\n\n        }\n    }\n</code></pre>\n\n<p>Why am I getting this error?</p>\n"},{"tags":["asp.net-mvc","entity-framework","entity-framework-4","asp.net-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12517938,"title":"Adding related entities","body":"<p>I have these 2 tables, </p>\n\n<pre><code>Student\n(Id, Name, DOB)\nSchool\n(Id, name)\n\nTable 3\n(student.Id, School.Id, expiryDate) \n</code></pre>\n\n<p>I need to ADD, new student, new school and create new record for table 3)</p>\n\n<p>Is there a way I can do this through entity framework? </p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":777,"score":0,"question_id":12504002,"title":"SimpleMembership MVC 4 get data from UserProfile having role in webpages_Roles","body":"<p>I have the following code.  But there must be a more database efficient way to do this, because, correct me if Im wrong the number of database queries is \n(1 + (qty of users with admin role))</p>\n\n<p>With a new MVC 4 project the membership defaults are the tables UserProfile, webpages_Roles and webpages_UsersInRoles.  I see lots of built in methods for Roles.Get*.  If I want to avoid writing code like what I have below do I need to explicitly create a model for webpages_Roles and webpages_UsersInRoles as well as all the code first properties?  Getting just the username from Roles.Get* doesnt suffice, I need the full UserProfile.</p>\n\n<p>FYI the \"UserRole\" object below is just an enum</p>\n\n<pre><code>public ActionResult Admins()\n    {\n        var dbContext = new UsersContext();\n        var usernames = Roles.GetUsersInRole(UserRole.SiteAdministrator.ToString());\n        var adminUsers = new List&lt;UserProfile&gt;();\n        foreach (string username in usernames)\n        {\n            var adminUser = dbContext.UserProfiles.FirstOrDefault(u =&gt; u.UserName.ToLower() == username);\n            adminUser.Roles.Add(UserRole.SiteAdministrator);\n            adminUsers.Add(adminUser);\n        }\n\n        return View(adminUsers);\n    }\n</code></pre>\n"},{"tags":["c#","sql-server","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":186,"score":2,"question_id":9327447,"title":"EF ToTraceString SQL generation result columns order","body":"<p>My question is if I can predict or choose the exact order of the columns the sql generation through <code>ToTraceString()</code> returns.</p>\n\n<p>I use <code>ToTraceString()</code> for an IQueryable to get the resulted SQL command and then insert the results directly in a database table.</p>\n\n<p>So, I kind of need the generated SQL to be consistent with my table structure...</p>\n\n<pre><code>string insertQuery = string.Format(\"INSERT INTO {0} {1}\", sqlTableName ((System.Data.Objects.ObjectQuery&lt;TRow&gt;)results).ToTraceString());\nContext.ExecuteStoreCommand(string.Format(\"TRUNCATE TABLE {0}\", sqlTableName));\nContext.ExecuteStoreCommand(insertQuery);\n</code></pre>\n\n<p><code>results = IQueryable&lt;Row&gt;</code> where Row is a type with the same properties as the table columns</p>\n\n<p>I choose to do a direct insert into a table because i see no point in getting a ToList() enumerable on the webserver, just to send it back to SQL through some kind of bulk insert (which EF doesn;t support for the moment...) My query returns a considerable amount of rows and I do not want to use Stored Procedures.</p>\n\n<p>Hope I make sense...thanks</p>\n"},{"tags":["entity-framework","database-design","foreign-key-relationship"],"answer_count":2,"favorite_count":1,"up_vote_count":14,"down_vote_count":0,"view_count":3823,"score":14,"question_id":6531671,"title":"What does principal end of an association means in 1:1 relationship in Entity framework","body":"<pre><code>public class Foo\n{\n    public string FooId{get;set;}\n    public Boo Boo{get;set;}\n}\n\n\npublic class Boo\n{\n    public string BooId{get;set;}\n    public Foo Foo{get;set;}\n}\n</code></pre>\n\n<p>I was trying to do this in entity framework where i got the error </p>\n\n<p>Unable to determine the principal end of an association between the types 'ConsoleApplication5.Boo' and 'ConsoleApplication5.Foo'. The principal end of this association must be explicitly configured using either the relationship fluent API or data annotations.</p>\n\n<p><strong>i have seen questions on stackoverflow having solution for this error, but i want to understand what does the term \"principal end\" means</strong></p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12521856,"title":"Entity Framework Versions Issue","body":"<p>Have a class library and a WPF application and am trying to contain all the Entity Framework items within the class library and use an interface to get the info out.  Everything is setup but I get this message each time I try it out:       </p>\n\n<p>Message \"The type initializer for 'System.Data.Entity.Internal.AppConfig' threw an exception.\"</p>\n\n<p>When I looked at the Inner Exceptions it appeared it couldn't find version 5.0.0.0 of EntityFramework and when I checked the Reference for it, it was 4.4.0.0.  Tried uninstalling and reinstalling EntityFramework via NuGet but having no luck.  Any ideas on what to try next?</p>\n\n<p>App Config:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n&lt;configSections&gt;\n&lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n  &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n&lt;/configSections&gt;\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\" /&gt;\n  &lt;/entityFramework&gt;\n&lt;/configuration&gt;\n</code></pre>\n"},{"tags":["asp.net",".net","entity-framework","ef-code-first","entity-framework-4.3"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12518703,"title":"Entity Framework code first already open data reader?","body":"<p>I added a simple method to a code-first entity in my application called <code>TopicCount</code> which accepts a boolean. It counts the number of items in a navigation property and the count filters differently based on if the passed in boolean is true or false.</p>\n\n<pre><code>public class Board\n{\n    public short BoardID { get; set; }\n    public string Name { get; set; }\n    public string Description { get; set; }\n    public bool Hidden { get; set; }\n    public bool ModsOnly { get; set; }\n    public bool Locked { get; set; }\n    public bool Anonymous { get; set; }\n    public bool AllTopics { get; set; }\n\n    public virtual ICollection&lt;Topic&gt; Topics { get; set; }\n\n    public long TopicCount(bool isModerator)\n    {\n        if (isModerator)\n            return this.Topics.ToList().Count;\n        else\n            return this.Topics\n                .Where(x =&gt; !x.ModsOnly)\n                .Where(x =&gt; !x.Board.ModsOnly)\n                .Where(x =&gt; !x.Board.Hidden)\n                .Count();\n    }\n}\n</code></pre>\n\n<p>When I call this <code>TopicCount</code> method it fails (whether the bool is true or false) with the following error:</p>\n\n<blockquote>\n  <p>There is already an open DataReader associated with this Command which must be closed first.</p>\n</blockquote>\n\n<p>Any ideas?</p>\n"},{"tags":["c#","entity-framework","lambda","expression-trees"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":12516279,"title":"Expression conversion","body":"<p>I am still a little green to Expressions and having difficulty figuring this problem out.  This may be more of a Lambda expression issue over EF, but I am hoping someone can atleast point me in the correct direction:</p>\n\n<p>I am attempting to do the following:</p>\n\n<pre><code>internal static IQueryable&lt;TSource&gt; WithSecurity&lt;TSource&gt;(thisIQueryable&lt;TSource&gt; source, Expression&lt;Func&lt;Security.Access, TSource, bool&gt;&gt; predicate, params MyRoles[] roles)\n{\n\n    DL.MyContext ctx = Csla.Data.DbContextManager&lt;DL.MyContext&gt;.GetManager().DbContext;\n\n    var accessData = ctx.Access.Where(e =&gt; roles.Contains((MyRoles)e.Role_ID));\n\n    Expression x = predicate asLambdaExpression;\n\n    source =\n        from c in source\n        where accessData.Any(predicate)\n        select c;\n\n    return source;\n}\n</code></pre>\n\n<p>On the where clause, there is clearly a problem as the predicate is of type <code>Expression&lt;Func&lt;Security.Access, TSource, bool&gt;&gt;</code>, but the Any is expecting <code>Expression&lt;Func&lt;Security.Access, bool&gt;&gt;</code>.  Any assistance on how to convert will be greatly appreciated.</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":273,"score":0,"question_id":12360868,"title":"MVC 4 DbContext Enable-Migrations re-writes seed code in Configuration.cs","body":"<p>I'm trying to do code first in a new MVC 4 project and have a \"journal\" mvc that works just fine and its Seed function in /Migrations/Configuration.cs working as well.  However, when I went to work on the UserProfile model in AccountModels.cs and then use the Enable-Migrations for it I lost all my seed code for the journal model and it was replace with a shell for UserProfile.  :( </p>\n\n<p>When using code first and having multiple models, inevitably all with their own DbContext (unless they should all share one?) how can I retain the seed code for each DbContext and model?</p>\n\n<p>I'm shocked no one else has ran into this problem before.  I simply don't want Configuration.cs re-written every-time I use the package manager console in a code first mvc project when doing the Enable-Migrations command, or at least why cant each dbcontext have their own configuration.cs, or something!  Looks like I may have to offer a bounty soon.</p>\n"},{"tags":[".net","oracle","entity-framework","odp.net"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12519891,"title":"Using EF with a legacy Oracle database (with stored procedures)?","body":"<p>I am curious if anyone has some thoughts on whether or not moving to the Entity Framework is worthwhile for a department working with a large legacy Oracle database and mandated stored procedure use?  </p>\n\n<p>Many of our tables do not have numerical primary keys and some use composite keys.</p>\n\n<p>I gave the Entity Framework version of ODP.NET a try when it was in beta and was not impressed.  Calling stored procedures was no cleaner than with regular ODP and the framework was not able to automatically generate mappings between the stored procedures and POCO objects.</p>\n"},{"tags":["c#","sql","asp.net-mvc-3","entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":187,"score":0,"question_id":12429212,"title":"How do you call a stored procedure in MVC3 C#","body":"<p>I am looking for a way to call my stored procedure in my C# code in the controller. I already have everything that I need in the controller. I have the ID on the post of the edit, and what I need to do when submitted is call the stored procedure with the parameter id. \nIn SQL you do this:   </p>\n\n<pre><code> EXEC [dbo].[AddGlassCutting] @AuditScheduleID = 1192\n</code></pre>\n\n<p>to test. This does not work in my code for the site. \nThe database is done with code first approach.</p>\n\n<p>Updated 1:33 Sept 14 2012</p>\n\n<p>Added code from edit Post - this is where i need it too execute:</p>\n\n<pre><code>        [HttpPost]\n    public ActionResult Edit(int id, AuditScheduleEdit viewModel)\n    {            \n        if (ModelState.IsValid)\n        {\n            viewModel.PopulateCheckBoxsToSpacerType();\n            _db.Entry(viewModel.AuditScheduleInstance).State = System.Data.EntityState.Modified;\n            _db.SaveChanges();\n            return RedirectToAction(\"Audit\", new {id});\n        }\n        else\n        {\n            return View(viewModel);\n        }\n\n    }\n</code></pre>\n\n<p>Updated 09/18/2012 </p>\n\n<pre><code>        [HttpPost]\n    public ActionResult Edit(int id, AuditScheduleEdit viewModel)\n    {            \n        if (ModelState.IsValid)\n        {\n            var addGlassCutting = new SqlParameter(\"@AuditScheduleID\", id);\n            _db.Database.SqlQuery&lt;QQAForm.ViewModels.AuditScheduleEdit.AddGlassCutting&gt;\n                (\"AddGlassCutting @AuditScheduleID\", addGlassCutting);\n            viewModel.PopulateCheckBoxsToSpacerType();\n            _db.Entry(viewModel.AuditScheduleInstance).State = System.Data.EntityState.Modified;\n            _db.SaveChanges();\n            return RedirectToAction(\"Audit\", new {id});\n        }\n        else\n        {\n            return View(viewModel);\n        }\n\n    }\n</code></pre>\n\n<p>Here is my Stored Procedure: </p>\n\n<pre><code>ALTER PROCEDURE [dbo].[AddGlassCutting] \n-- Add the parameters for the stored procedure here\n@AuditScheduleID int = null\nAS\nBEGIN\n-- SET NOCOUNT ON added to prevent extra result sets from\n-- interfering with SELECT statements.\nSET NOCOUNT ON;\n\n-- Insert statements for procedure here\n/****** Script for adding Glass Cutting  ******/\nINSERT INTO QQAEntities.dbo.MainAnswers (AuditScheduleID, MainQuestionID)\nSELECT @AuditScheduleID, MainQuestionID\nFROM QQAEntities.dbo.MainQuestions\nWHERE ReferenceNo &gt; 0\n</code></pre>\n\n<p>END</p>\n\n<p>At this point there are no errors in the code, it compiles, but when it is executed it does not run the stored procedure. </p>\n\n<p>Any Help would be appreciated. </p>\n"},{"tags":["wpf","entity-framework","validation","dataannotations","idataerrorinfo"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12484997,"title":"Validation for ComboBox reference property","body":"<p>I cannot get IDataErrorInfo to validate reference properties that have [Required] attribute set to them (or [ReferenceKey]) and that contains null as initial value. I am using WPF + EF 4.1. Validation is done through data annotations and IDataErrorInfo. For each property everything is working fine, except for the Reference properties that cannot contain null. This properties are This properties contain null as default value, and I cannot set it to any other value.</p>\n\n<p>This in practice mean that this[string propertyName] is never executed for reference properties, and therefore UI doesn't catch any validation errors. I have inherited [Required] attribute just to see if this property is being validated at all, and it returns that it is non-valid, as it should, but IDataErrorInfo is totally unaware of this.</p>\n\n<p>An example of reference property implementation in UI</p>\n\n<pre><code>&lt;ComboBox DisplayMemberPath=\"Name\"\n          ItemsSource=\"{Binding UnitList}\"\n          SelectedValue=\"{Binding CurrentItem.UnitId, Mode=TwoWay, ValidatesOnExceptions=True, ValidatesOnDataErrors=True, NotifyOnValidationError=True}\"\n          SelectedValuePath=\"Id\" /&gt;\n</code></pre>\n\n<p>What can I do to overcome this problem?</p>\n"},{"tags":["asp.net","entity-framework","generics","dbcontext"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12519817,"title":"Can I get a DbList from a string of the name of the entity?","body":"<p>I am builing a ui query builder with Entity Framework. I was thinking of letting the user choose a base entity type from a drop down list of entities, then populate a grid view as test. If you select this entity, your basic result will be the contexts of this grid view. Later I will add the ability to 'Include' other entities and filter. But for now I can't even get the basics. I have a drop down of all entities. But I do not see how to get a generic list based on the name of the entity. I think I need to use reflection, but can't figure that out. I can get this easily if I hard code the entity type, but that does not solve my problem.</p>\n\n<p>I have DbContext set up, using entity Framework 5, and want the results on a ASP .Net webforms page.</p>\n"},{"tags":["c#","asp.net-mvc-3","sql-server-2008","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":122,"score":0,"question_id":12519160,"title":"MVC Entity Framework get one column as an array","body":"<p>my application is asp.net MVC3 using Entity Framework.  I am trying to get a list of one column from a table as an array using the following:</p>\n\n<pre><code>   public ActionResult Index()\n        {\n            //var list = db.CasesProgresses.ToList();\n            var SeriesList = GetSeriesList(Learner_ID);\n            return View();\n        }\n\n\n\n        public List&lt;string&gt; GetSeriesList(string item)\n        {\n            // get DataTable dt from somewhere.\n            List&lt;string&gt; sList = new List&lt;string&gt;();\n            foreach (CasesProgress row in db.CasesProgresses)\n            {\n                sList.Add(row[0].ToString());\n            }\n            return sList;  \n        }\n</code></pre>\n\n<p>I get two errors:</p>\n\n<pre><code>Cannot apply indexing with [] to an expression of type 'caseprog.Models.CasesProgress' and\nThe name 'Learner_ID' does not exist in the current context\n</code></pre>\n\n<p>Would appreciate your suggestions.</p>\n"},{"tags":["performance","oracle","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12484605,"title":"Entity Framework SQL Selecting 600+ Columns","body":"<p>I have a query generated by entity framework running against oracle that's too slow. It runs in about 4 seconds. </p>\n\n<p>This is the main portion of my query</p>\n\n<pre><code>var query = from x in db.BUILDINGs\n                    join pro_co in db.PROFILE_COMMUNITY on x.COMMUNITY_ID equals pro_co.COMMUNITY_ID\n                    join co in db.COMMUNITies on x.COMMUNITY_ID equals co.COMMUNITY_ID\n                    join st in db.STATE_PROFILE on co.STATE_CD equals st.STATE_CD\n                    where pro_co.PROFILE_NM == authorizedUser.ProfileName\n\n                    select new\n                    {\n                        COMMUNITY_ID = x.COMMUNITY_ID,\n                        COUNTY_ID = x.COUNTY_ID,\n                        REALTOR_GROUP_NM = x.REALTOR_GROUP_NM,\n                        BUILDING_NAME_TX = x.BUILDING_NAME_TX,\n                        ACTIVE_FL = x.ACTIVE_FL,\n                        CONSTR_SQFT_AVAIL_NB = x.CONSTR_SQFT_AVAIL_NB,\n                        TRANS_RAIL_FL = x.TRANS_RAIL_FL,\n                        LAST_UPDATED_DT = x.LAST_UPDATED_DT,\n                        CREATED_DATE = x.CREATED_DATE,\n                        BUILDING_ADDRESS_TX = x.BUILDING_ADDRESS_TX,\n                        BUILDING_ID = x.BUILDING_ID,\n                        COMMUNITY_NM = co.COMMUNITY_NM,\n                        IMAGECOUNT = x.BUILDING_IMAGE2.Count(),\n                        StateCode = st.STATE_NM,\n                        BuildingTypeItems = x.BUILDING_TYPE_ITEM,\n                        BuildingZoningItems = x.BUILDING_ZONING_ITEM,\n                        BuildingSpecFeatures = x.BUILDING_SPEC_FEATURE_ITEM,\n                        buildingHide = x.BUILDING_HIDE,\n                        buildinghideSort = x.BUILDING_HIDE.Count(y =&gt; y.PROFILE_NM == ProfileName) &gt; 0 ? 1 : 0,\n                        BUILDING_CITY_TX = x.BUILDING_CITY_TX,\n                        BUILDING_ZIP_TX = x.BUILDING_ZIP_TX,\n                        LPF_GENERAL_DS = x.LPF_GENERAL_DS,\n                        CONSTR_SQFT_TOTAL_NB = x.CONSTR_SQFT_TOTAL_NB,\n                        CONSTR_STORIES_NB = x.CONSTR_STORIES_NB,\n                        CONSTR_CEILING_CENTER_NB = x.CONSTR_CEILING_CENTER_NB,\n                        CONSTR_CEILING_EAVES_NB = x.CONSTR_CEILING_EAVES_NB,\n                        DESCR_EXPANDABLE_FL = x.DESCR_EXPANDABLE_FL,\n                        CONSTR_MATERIAL_TYPE_TX = x.CONSTR_MATERIAL_TYPE_TX,\n                        SITE_ACRES_SALE_NB = x.SITE_ACRES_SALE_NB,\n                        DESCR_PREVIOUS_USE_TX = x.DESCR_PREVIOUS_USE_TX,\n                        CONSTR_YEAR_BUILT_TX = x.CONSTR_YEAR_BUILT_TX,\n                        DESCR_SUBDIVIDE_FL = x.DESCR_SUBDIVIDE_FL,\n                        LOCATION_CITY_LIMITS_FL = x.LOCATION_CITY_LIMITS_FL,\n                        TRANS_INTERSTATE_NEAREST_TX = x.TRANS_INTERSTATE_NEAREST_TX,\n                        TRANS_INTERSTATE_MILES_NB = x.TRANS_INTERSTATE_MILES_NB,\n                        TRANS_HIGHWAY_NAME_TX = x.TRANS_HIGHWAY_NAME_TX,\n                        TRANS_HIGHWAY_MILES_NB = x.TRANS_HIGHWAY_MILES_NB,\n                        TRANS_AIRPORT_COM_NAME_TX = x.TRANS_AIRPORT_COM_NAME_TX,\n                        TRANS_AIRPORT_COM_MILES_NB = x.TRANS_AIRPORT_COM_MILES_NB,\n                        UTIL_ELEC_SUPPLIER_TX = x.UTIL_ELEC_SUPPLIER_TX,\n                        UTIL_GAS_SUPPLIER_TX = x.UTIL_GAS_SUPPLIER_TX,\n                        UTIL_WATER_SUPPLIER_TX = x.UTIL_WATER_SUPPLIER_TX,\n                        UTIL_SEWER_SUPPLIER_TX = x.UTIL_SEWER_SUPPLIER_TX,\n                        UTIL_PHONE_SVC_PVD_TX = x.UTIL_PHONE_SVC_PVD_TX,\n                        CONTACT_ORGANIZATION_TX = x.CONTACT_ORGANIZATION_TX,\n                        CONTACT_PHONE_TX = x.CONTACT_PHONE_TX,\n                        CONTACT_EMAIL_TX = x.CONTACT_EMAIL_TX,\n                        TERMS_SALE_PRICE_TX = x.TERMS_SALE_PRICE_TX,\n                        TERMS_LEASE_SQFT_NB = x.TERMS_LEASE_SQFT_NB\n                    };\n</code></pre>\n\n<p>There is a section of code that tacks on dynamic where and sort clauses to the query but I've left those out. The query takes about 4 seconds to run no matter what is in the where and sort. </p>\n\n<p>I dropped the generated SQL in Oracle and an explain plan didn't appear to show anything that screamed fix me. Cost is 1554</p>\n\n<p>If this isn't allowed I apologize but I can't seem to find a good way to share this information. I've uploaded the explain plan generated by Sql Developer here: <a href=\"http://www.123server.org/files/explainPlanzip-e1d291efcd.html\" rel=\"nofollow\">http://www.123server.org/files/explainPlanzip-e1d291efcd.html</a></p>\n\n<p>Table Layout</p>\n\n<pre><code>Building\n--------------------\n- BuildingID\n- CommunityId\n- Lots of other columns\n\nProfile_Community\n-----------------------\n- CommunityId\n- ProfileNM\n- lots of other columns\n\nstate_profile\n---------------------\n- StateCD\n- ProfileNm\n- lots of other columns\n\nProfile\n---------------------\n- Profile-NM\n- a few other columns\n</code></pre>\n\n<p>All of the tables with allot of columns have 120-150 columns each. It seems like entity is generating a select statement that pulls every column from every table instead of just the ones I want. </p>\n\n<p>The thing that's bugging me and I think might be my issue is that in my LINQ I've selected 50 items, but the generated sql is returning 677 columns. I think returning so many columns is the source of my slowness possibly.</p>\n\n<p>Any ideas why I am getting so many columns returned in SQL or how to speed my query?</p>\n"},{"tags":[".net","entity-framework","sql-server-2008","ef-code-first"],"answer_count":3,"favorite_count":4,"up_vote_count":14,"down_vote_count":0,"view_count":6580,"score":14,"question_id":4653095,"title":"How to store images using Entity Framework Code First CTP 5?","body":"<p>I'm just trying to figure out if there is a simple way to store and retrieve binary (file) data using EF Code First CTP 5? I would really like it to use the FILESTREAM type, but I'm really just looking for some way to make it work.</p>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":979,"score":7,"question_id":3555072,"title":"Changing Entity accessibility","body":"<p>I want to make an entity internal. I've changed entity, its scalar properties and navigation properties to internal. I'm getting this error when I try to build it:</p>\n\n<p><em>Error 6036: EntityType 'File' has 'Internal' accessibility and EntitySet 'Files' has a get property with 'Public' accessibility. EntitySet's get property must not have less restrictive access than containing EntityType's access.</em></p>\n\n<p>I can't edit designer.cs because of this error it isn't generated. I've checked edmx file but there aren't any public values associated to \"File\" or \"Files\". What should I do?</p>\n"},{"tags":["entity-framework","linq-to-entities","match","wildcard"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":12517077,"title":"Entity Framework: combining exact and wildcard searching conditional on search term","body":"<p>I'm creating a query to search the db using EF.  TdsDb being the EF context.</p>\n\n<pre><code>string searchValue = \"Widget\";\nTdsDb tdsDb = new TdsDb();\nIQueryable&lt;Counterparty&gt; counterparties;\n</code></pre>\n\n<p>I can do exact match:</p>\n\n<pre><code>counterparties = tdsDb.Counterparties.Where(x =&gt; x.CounterpartyName == searchValue);\n</code></pre>\n\n<p>or wildcard match:</p>\n\n<pre><code>counterparties = tdsDb.Counterparties.Where(x =&gt; x.CounterpartyName.Contains(searchValue));\n</code></pre>\n\n<p>But I want to be able to do both i.e. (psudo code)</p>\n\n<pre><code>counterparties = tdsDb.Counterparties.Where(x =&gt; \n          if (searchValue.EndsWith(\"%\")) \n                 {\n                      if (searchValue.StartsWith(\"%\"))\n                          {x.CounterpartyName.Contains(searchValue)}\n                      else \n                          {x.CounterpartyName.StartsWith(searchValue)}\n                 }   \n          else\n                 {x =&gt; x.CounterpartyName == searchValue}\n      );\n</code></pre>\n\n<p>Now clearly I can't put an if statement in the where clause like that.  But I also can't duplicate the queries: shown here they are hugely dumbed down.  The production query is far longer, so having multiple versions of the same long query that vary on only one clause seems very unhealthy and unmaintainable.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["entity-framework","asp.net-web-api","model-binding"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12516526,"title":"Send partial objects with only changed fields to Web API and Entity Framework","body":"<p>WebApi and EF POCOs work really well together. An issue I've been thinking on is that some objects can become really quite large over time. They can have lots of properties that map back to columns in the database. With these objects it would be rare to ever update more than one or two fields at a time so it begs the question, why require all the fields to do the full trip back from client to server to database.</p>\n\n<p>Some JavaScript frameworks provide the option as to whether to send all fields or just changed ones back to the server so client side is clean and simple.</p>\n\n<p>Server side is a little bit more of a challenge from what I see. The serializer will step in and try to map some json or xml to a type. JSON.NET for example handles missing values well provided the corresponding properties in the object are nullable.</p>\n\n<p>Reattaching the deserialized model back to entity framework on the other hand is where things get tricky. The default WebApi template for a controller does it in one line:</p>\n\n<pre><code>db.Entry(user).State = EntityState.Modified;\n</code></pre>\n\n<p>This obviously sets the whole object to modified. It's of course possible to set individual properties to modified rather than the whole object and I would assume this means EF is a little more clever and only sends the modified properties back in the SQL UPDATE.</p>\n\n<p>So the problem here is, how do I know what properties are updated? I only get a object back in my controller method so I cant ask the serializer what properties it pulled in (even if that was possible for a given serializer).\nIf I have a list of properties then I could set current values with their state to modified in EF and hopefully that should result in my clean db query.</p>\n\n<p>The other perhaps more obvious option is to first retrieve the object I want to update from a database, and modify only the changed properties one by one on the retrieved object or if EF has support for it, perhaps I can pass it the unattached object and have it do this itself. This isn't as desirable an option as it does mean a whole database read where the whole point of the exercise is efficiency. What we would be doing is trading the clients http efficiency and bandwidth for hit on server to db efficiency.</p>\n\n<p>So to me it seems if I want to do this on the server, I'm between a rock and a hard place. WebApi and EF do most of the work, but at the cost of flexibility. I'm looking for options or angles that I haven't mentioned in hope of a simple solution that doesn't throw away one of these two great technologies.</p>\n"},{"tags":["javascript","sql","json","asp.net-mvc-3","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12516890,"title":"ASP.NET MVC JSON Entity Framework - Saving data","body":"<p>I have an asp.net MVC3 application, trying to save data to MS SQL table (Entity Framework).<br>\nHere is the table:</p>\n\n<pre><code>public class CasesProgress\n    {\n        public virtual long ID { get; set; }\n        public virtual long Learner_ID { get; set; }\n        public virtual long Course_ID { get; set; }\n        public virtual long StudyCase_ID { get; set; }\n        public virtual long CaseList_ID { get; set; }\n        public virtual bool Viewed { get; set; }\n    }\n</code></pre>\n\n<p>Here is my controller:</p>\n\n<pre><code>public ActionResult StoreProgress(long Learner_ID, long Course_ID, long StudyCase_ID, long CaseList_ID)\n    {\n        CasesProgress casesprogress = new CasesProgress();\n        casesprogress.Learner_ID = Learner_ID;\n        casesprogress.Course_ID = Course_ID;\n        casesprogress.StudyCase_ID = StudyCase_ID;\n        casesprogress.CaseList_ID = CaseList_ID;\n        casesprogress.Viewed = true;\n        db.CasesProgresses.AddObject(casesprogress);\n        db.SaveChanges();\n        return Json(new { success = true });\n    }\n</code></pre>\n\n<p>and here is my Javascript:</p>\n\n<pre><code>   function StoreProgress1() {\n        $.ajax({\n            url: '/Home/StoreProgress',\n            type: 'POST',\n            data: {\n                LearnerID: \"211\",\n                Course_ID: \"6\",\n                StudyCase_ID: \"19\",\n                CaseList_ID: \"2\"\n            },\n            contentType: 'application/json; charset=utf-8',\n            success: function (data) {\n                alert(data.success);\n            },\n            error: function () {\n                alert(\"error\");\n            }\n        });\n    }\n</code></pre>\n\n<p>I get error message without even going to the breakpoint I have in the controller.  Any idea, I am new to this.  Thanks in advance.</p>\n"},{"tags":["entity-framework","esql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12507264,"title":"How to ORDER BY non-column field?","body":"<p>I am trying to create an Entity SQL that is a union of two sub-queries. </p>\n\n<pre><code>(SELECT VALUE DISTINCT ROW(e.ColumnA, e.ColumnB, 1 AS Rank) FROM Context.Entity AS E WHERE ...)\nUNION ALL \n(SELECT VALUE DISTINCT ROW(e.ColumnA, e.ColumnB, 2 AS Rank) FROM Context.Entity AS E WHERE ...)\nORDER BY *??*  LIMIT 50\n</code></pre>\n\n<p>I have tried:</p>\n\n<pre><code>ORDER BY Rank\n</code></pre>\n\n<p>and </p>\n\n<pre><code>ORDER BY e.Rank\n</code></pre>\n\n<p>but I keep getting:</p>\n\n<pre><code>System.Data.EntitySqlException: The query syntax is not valid. Near keyword 'ORDER'  \n</code></pre>\n\n<p><strong>Edit</strong>: </p>\n\n<p>This is Entity Framework.  In C#, the query is executed using:</p>\n\n<pre><code>var esql = \"...\";\nObjectParameter parameter0 = new ObjectParameter(\"p0\", value1);\nObjectParameter parameter1 = new ObjectParameter(\"p1\", value2);\nObjectQuery&lt;DbDataRecord&gt; query = context.CreateQuery&lt;DbDataRecord&gt;(esql, parameter0, parameter1);\nvar queryResults = query.Execute(MergeOption.NoTracking);\n</code></pre>\n\n<p>There is only a small portion of my application where I have to resort to using Entity SQL.  Generally, the main use case is when I need to do: \"WHERE Column LIKE 'A % value % with % multiple % wildcards'\".</p>\n\n<p>I do not think it is a problem with the Rank column. I do think it is how I am trying to apply an order by to two different esql statements joined by union all.  Could someone suggest:</p>\n\n<ol>\n<li>How to apply a ORDER BY to this kind of UNION/UNION ALL statment</li>\n<li>How to order by the non-entity column expression.</li>\n</ol>\n\n<p>Thanks.</p>\n"},{"tags":["c#","winforms","entity-framework","entity-framework-4","datagridview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12515745,"title":"DataGridViewComboBoxColumn not taking ValueMember","body":"<p>I have a Many to Many mixed with some Master-Detail DataGrid setup.</p>\n\n<ul>\n<li>4 DataGridView</li>\n<li>6 Entities (2 mapping tables)</li>\n<li>5 Data relations</li>\n</ul>\n\n<p>To give you a visual image, there is 1 big Employe DGV (DataGridView), and 3 smaller ones which updates depending on the Employe DGV selected row.</p>\n\n<p>One of the 3 smaller grid is a really simple relation without a mapping table.</p>\n\n<p>The other 2, however, displays a mapping table rows that uses formatedinfo of the entity it is mapping to. Those 2 DGV only have 1 column, a ComboBox with a formated string (overriden <code>.ToString()</code>) which (should) have the underlying object that the mapping is pointing to (EF will handle setting the ID accordingly when receiving the entire object). However, when I try to add a new rows, it will say it is unable to convert a String to a <em>Put Object Name Here</em>. This led me to think that if you did not set a ValueMember, the combobox would try to get a string representation using .ToString(). So I attempted to bypass that behavior by adding a <code>Self</code> property to the entity which simply returns himself. No success, it is still trying to convert a string somewhere.</p>\n\n<p>The exact error (in french) is:</p>\n\n<p><code>System.FormatException: Cast non valide de 'System.String' en 'InvInformatique.logiciels'.</code></p>\n\n<p>Which traducts to \"Invalid cast from System.String to InvInformatique.logiciels.</p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>InventaireInformatiqueEntities iidb = new InventaireInformatiqueEntities();\n\nbsEmployes.DataSource = iidb.employes;\nbsMateriels.DataSource = iidb.materiels;\nbsLogiciels.DataSource = iidb.logiciels;\nbsLogicielEmployeMaps.DataSource = iidb.logiciel_employe_maps; // Needed to provoke the load query\nbsAcces.DataSource = iidb.acces;\nbsAccesEmployeMaps.DataSource = iidb.acces_employe_maps; // Needed to provoke the load query\n\ndgvEmployes.AutoGenerateColumns = false;\ndgvEmployes.Columns.AddRange(\n    new DataGridViewTextBoxColumn { Name = \"Nom\", DataPropertyName = \"nom\" },\n    new DataGridViewTextBoxColumn { Name = \"Dpartement\", DataPropertyName = \"departement\" }\n);\ndgvEmployeMateriels.AutoGenerateColumns = false;\ndgvEmployeMateriels.Columns.AddRange(\n    new DataGridViewTextBoxColumn { HeaderText = \"Nom\", DataPropertyName = \"nom\" },\n    new DataGridViewTextBoxColumn { HeaderText = \"Satisfaction\", Name = \"satisfaction\", DataPropertyName = \"satisfaction\" }\n);\ndgvEmployeAcces.AutoGenerateColumns = false;\ndgvEmployeAcces.Columns.AddRange(\n    new DataGridViewComboBoxColumn { HeaderText = \"Accs\", DataPropertyName = \"acces\", DataSource = bsAcces }\n);\ndgvEmployeLogiciel.AutoGenerateColumns = false;\ndgvEmployeLogiciel.Columns.AddRange(\n    new DataGridViewComboBoxColumn { HeaderText = \"Logiciels\", DataPropertyName = \"logiciels\", DataSource = bsLogiciels }\n);\n\ndgvEmployes.DataSource = bsEmployes;\ndgvEmployeMateriels.DataBindings.Add(new Binding(\"DataSource\", bsEmployes, \"materiels\"));\ndgvEmployeLogiciel.DataBindings.Add(new Binding(\"DataSource\", bsEmployes, \"logiciel_employe_maps\"));\ndgvEmployeAcces.DataBindings.Add(new Binding(\"DataSource\", bsEmployes, \"acces_employe_maps\"));\n</code></pre>\n\n<p><strong>Database</strong></p>\n\n<pre><code>Employes\n-&gt;id\n-&gt;nom\n-&gt;departement\n\nAcces\n-&gt;id\n-&gt;nom\n-&gt;description\n\nLogiciel\n-&gt;id\n-&gt;nom\n\nMateriel\n-&gt;id\n-&gt;employe_id\n-&gt;nom\n-&gt;description\n\nAcces_Employe_Maps\n-&gt;id\n-&gt;acces_id\n-&gt;employe_id\n\nLogiciel_Employe_Maps\n-&gt;id\n-&gt;logiciel_id\n-&gt;employe_id\n</code></pre>\n\n<p><strong>Database relations</strong></p>\n\n<pre><code>Employes &lt;-&gt; Logiciel_Employe_Maps &lt;-&gt; Logiciels\nEmployes &lt;-&gt; Acces_Employe_Maps &lt;-&gt; Acces\nEmployes -&gt; Materiel\n</code></pre>\n"},{"tags":["sql-server","entity-framework","c#-4.0","linq-to-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12515682,"title":"Improving a Linq statement to remove the need for a foreach loop","body":"<p>I have an MS SQL table with the following fields. I am using entity framework:</p>\n\n<pre><code>EntryId\nEntryType\nOperation\nUpdatedTime_UTC\n</code></pre>\n\n<p>The EntryId and EntryType fields can contain duplicate values. When an object is created a record is added and its operation field will be set to added. If the object is modified another record is written with the same EntryId and EntryType values as the first record but the operation field will be set to modified. When the object is deleted (youve guessed it), another record is written with the same EntryId and EntryType values as the previous records but the operation field will be set to deleted.</p>\n\n<p>Some example data is shown below:</p>\n\n<pre><code>ID1, Type1, added,    2012-08-20 09:15:50\nID2, Type1, added,    2012-08-21 09:15:50\nID1, Type1, modified, 2012-08-22 09:15:50\nID1, Type1, modified, 2012-08-23 09:15:50\nID2, Type1, deleted,  2012-08-24 09:15:50\n</code></pre>\n\n<p>This shows information about two objects (ID1 and ID2). Both were added to the table but ID1 was modified and ID2 was deleted. As part of a reconcile procedure I need to check that if an object has been deleted there must be a record in my table with a matching EntryId that has an operation set to deleted. If there isnt my code will add one.</p>\n\n<p>Now to my problem. I have a function that is called when my system believes that there are no objects for a given EntryType. I need to confirm that all the records in my table for that EntryType have a record with an operation set to deleted. In the data shown above ID1 doesnt have a deleted entry. This is fine if the object still exists but bad if the object has gone. I am using the following Linq to get a grouped list where I pass in the entityType I am interested in.</p>\n\n<pre><code>        var item = _ctx.JournalSet\n            .Where(x =&gt; x.EntryType == entityType)\n            .OrderBy(x =&gt; x.UpdatedTime_UTC)\n            .GroupBy(x =&gt; x.EntryId);\n</code></pre>\n\n<p>I then use this code to look into each group to see that it has a deleted entry. If it doesnt I add a new record to my table.</p>\n\n<pre><code>        foreach (var item in result)\n        {\n            if (item.Last().Operation != \"deleted\")\n            {\n                // no 'deleted' entry found. time to add a new entry.\n            }\n        }\n</code></pre>\n\n<p>What I would like to do is to modify my Linq statement so that it only returns the EntryId and EntryType details when a deleted entry needs to be added.</p>\n\n<p><strong>Additional information</strong>: A deleted record will always have a datetime later than an add or modify record so when ordering by UpdatedTime_UTC the last entry should be a deleted one if it exists for the given entryId</p>\n\n<p>Is it possible to create a Linq statement to do the above without the need for the foreach stuff? </p>\n"},{"tags":["asp.net-mvc","entity-framework","generics","ef-code-first","destructor"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":202,"score":0,"question_id":8913913,"title":"Declare generic type parameter as having a destructor?","body":"<p>I've got a generic class that starts with:</p>\n\n<pre><code>public class EntityContextFactory&lt;T&gt;\n    where T: class, IDisposable, IObjectContextAdapter, new()\n</code></pre>\n\n<p>Later in the class when I have a method that contains:</p>\n\n<pre><code>            T context = HttpContext.Current.Items[objectContextKey] as T;\n            if (context != null)\n            {\n                context.Dispose();\n                GC.SuppressFinalize(context);\n                HttpContext.Current.Items.Remove(objectContextKey);\n            }\n</code></pre>\n\n<p>I get a warning from ReSharper that says <code>GC.SuppressFinalize</code> is invoked on a type without destructor. How can I remove this error? I know Dbcontexts do have a destructor  because when I write this type of class non generically, I get no such error. I tried declaring that T implements the same interfaces as a Dbcontext but that didn't seem to work...</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12514088,"title":"How can update exist project to entity framework 5.0","body":"<p>i have an entity framework project. i want to update ef 5 to this project. i use nuget with this command;\nPM> Install-Package EntityFramework\ndownload ef5.0. it add some line in my config file;</p>\n\n<pre><code>enter code here\n&lt;section name=\"entityFramework\"\n         type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\"\n         requirePermission=\"false\" /&gt;\n</code></pre>\n\n<p>is this enough upgrade my project to ef 5.0. i am not sure is this true way for update ?</p>\n"}]}
{"total":18927,"page":19,"pagesize":100,"questions":[{"tags":["entity-framework","deployment","ef-code-first","entity-framework-5","code-first-migrations"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12514281,"title":"Publish Web dialog doesn't detect my entity framework 5 context as Code First","body":"<p>I've recently upgraded a WFC project that uses Entity Framework from v4.3.1 to 5.0.<br>\nI'm running Coded migrations only (no automatic migrations).</p>\n\n<p>Previously, I was using the Publish Profiles to deploy this solution and apply the migrations.  Since upgrading the project to EF5, the migrations portion no longer works and the publish dialog doesn't detect the context as having code-first migrations.</p>\n\n<p>Specifically, the <code>.pubxml</code>file changed from detecting my context as <code>&lt;Object Type=\"DbCodeFirst\"&gt;</code>to <code>&lt;Object type=\"DbDacFx\"&gt;</code> which is incorrect for my context.</p>\n\n<p>As a workaround, I've manually added the <code>&lt;entityFramework&gt;</code> database initializer configuration to my web.config transforms, but I'd like to understand why the publish profiles aren't working. That was a much nicer solution.</p>\n"},{"tags":["asp.net-mvc","entity-framework","annotations","ef-code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12513606,"title":"ASP MVC + EF Code First - are data annotations for validation purposes only?","body":"<p>In my application, i have models for database, and models for view forms. When i have data annotations at my view forms models properties for validating inputs, do i need to copy those annotations at my database models properties? I mean, when i specify something like <code>[Range(5,10)]</code> on some property, does it make any changes to database? Or maybe is <code>context.SaveChanges()</code> using those annotations for validating final model before saving it into database?</p>\n\n<p>Reassuming: is it necessary to put data annotations at my database model classes, when i already have those at my view model classes?</p>\n"},{"tags":["entity-framework","exception","sql-server-ce","syntax-error"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":548,"score":0,"question_id":12226842,"title":"The specified store provider cannot be found in the configuration, or is not valid","body":"<p>i use entity framwork with SQL Server CE 3.5 and i have this error </p>\n\n<p><strong>The specified store provider cannot be found in the configuration, or is not valid.</strong></p>\n\n<pre><code>&lt;Schema Namespace=\"OimDBModel.Store\" Alias=\"Self\" Provider=\"System.Data.SqlServerCe.3.5\" ProviderManifestToken=\"3.5\" xmlns:store=\"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator\" xmlns=\"http://schemas.microsoft.com/ado/2009/02/edm/ssdl\"&gt;\n    &lt;EntityContainer Name=\"OimDBModelStoreContainer\"&gt;\n      &lt;EntitySet Name=\"OfflineMessages\" EntityType=\"OimDBModel.Store.OfflineMessages\" store:Type=\"Tables\" /&gt;\n    &lt;/EntityContainer&gt;\n  &lt;/Schema&gt;&lt;/edmx:StorageModels&gt;\n</code></pre>\n"},{"tags":["c#","entity-framework","exception"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12329395,"title":"Collection was modified; enumeration operation may not execute. Exception","body":"<p>this code give me and Exception </p>\n\n<p><strong>Collection was modified; enumeration operation may not execute</strong></p>\n\n<p>i use Entity Framework to work with data</p>\n\n<pre><code>            foreach (OfflineMessage omc in _offMsgs)\n            {\n\n                var OimDB = new OimDBEntities();\n\n                if (omc.MsgTo == e.MessageData.ToHeader.Uri)\n                {\n                    var offlineMessage = new OfflineMessage\n                    {\n                        Delivered = false,\n                        MsgContent = omc.MsgContent,\n                        MsgFrom = omc.MsgFrom,\n                        MsgTime = omc.MsgTime,\n                        MsgTo = omc.MsgTo,\n                        ID = OimDB.OfflineMessages.NextId(f =&gt; f.ID)\n\n                    };\n\n                    oimRepository.InsertOIM(offlineMessage);\n\n                    //InsertData(omc.MsgFrom, omc.MsgTo, omc.MsgContent, omc.MsgTime);\n                }\n            }\n            _toHeader = e.MessageData.ToHeader.Uri;\n        }\n</code></pre>\n"},{"tags":["c#",".net","linq","entity-framework","lazy-loading"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":88,"score":5,"question_id":12510826,"title":"Does LINQ with a scalar result trigger the lazy loading","body":"<p>I read the <a href=\"http://msdn.microsoft.com/en-US/data/jj574232\"> Loading Related Entities</a> post by the <code>Entity Framework</code> team and got a bit confused by the last paragraph:</p>\n\n<blockquote>\n  <p>Sometimes it is useful to know how many entities are related to another entity in the database without actually incurring the cost of loading all those entities. The Query method with the LINQ Count method can be used to do this. For example:</p>\n</blockquote>\n\n<pre><code>using (var context = new BloggingContext())\n{\n    var blog = context.Blogs.Find(1);\n\n    // Count how many posts the blog has \n    var postCount = context.Entry(blog)\n                          .Collection(b =&gt; b.Posts)\n                          .Query()\n                          .Count();\n}\n</code></pre>\n\n<p>Why do the <code>Query</code> + <code>Count</code> method needed here?<br>\nCan't we simple use the LINQ's <code>COUNT</code> method instead?</p>\n\n<pre><code>var blog = context.Blogs.Find(1);\nvar postCount = blog.Posts.Count();\n</code></pre>\n\n<p>Will that trigger the lazy loading and all the collection will be loaded to the memory and just than I'll get my desired scalar value?</p>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12511838,"title":"Grouping records using LINQ method syntax","body":"<p>I'm trying to find a way to group records by date (not taking into account time) using the LINQ method syntax but only select one instance of each record (which is ItemId within the model)</p>\n\n<p>My simple query is as follows:</p>\n\n<pre><code>range1.Count(x =&gt; ((x.OpenedDate &gt;= todayFirst) &amp;&amp; (x.OpenedDate &lt;= todayLast))\n</code></pre>\n\n<p>How could I count the unique records within this range by <code>ItemId</code>?</p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":12499091,"title":"Entity Framework - Unable to determine a valid ordering for dependent operations","body":"<p>Adding a record, using Entity framework, I get this error.</p>\n\n<p>Unable to determine a valid ordering for dependent operations. Dependencies may exist due to foreign key constraints, model requirements, or store-generated values.</p>\n\n<p>This is my DB table:</p>\n\n<pre><code>CREATE TABLE [dbo].[CalendarItem](\n[id] [int] IDENTITY(1,1) NOT NULL,\n[title] [nvarchar](100) NOT NULL,\n[content] [ntext] NULL,\n[type] [int] NOT NULL,\n[parent] [int] NULL,\n[starttime] [datetime] NULL,\n[endtime] [datetime] NULL,\nCONSTRAINT [PK_calendarItem] PRIMARY KEY CLUSTERED \n([id] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF,\n  ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON, FILLFACTOR = 80) ON [PRIMARY]\n) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]\n</code></pre>\n\n<p>It has this CIRCULAR REFERENCE</p>\n\n<pre><code>ALTER TABLE [dbo].[CalendarItem]  WITH CHECK ADD  CONSTRAINT  \n[FK_calendarItem_calendarItem] FOREIGN KEY([parent])\nREFERENCES [dbo].[CalendarItem] ([id])\n</code></pre>\n\n<p>So, Parent (which is nullable) can have an id which refers to another record in the table.</p>\n\n<p><strong>_context.AddToCalendarItems(calendarItem);\n _context.SaveChanges();</strong></p>\n\n<p>The EF Code is found here:  <a href=\"http://pastebin.com/AWEF0GVy\" rel=\"nofollow\">http://pastebin.com/AWEF0GVy</a></p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12392691,"title":"Entity Framework Fluent API Mapping","body":"<p><strong>Let's assume I have these tables:</strong></p>\n\n<pre><code>Role\n- RoleId\n- Name\n\nUserRole\n- UserId\n- RoleId\n\nUser\n- UserId\n- Username\n\nUserEmail\n- UserId\n- EmailId\n- IsPrimary\n\nEmail\n- EmailId\n- Address\n</code></pre>\n\n<p><strong>Now my model, should look something like this:</strong></p>\n\n<pre><code>public class Role {\n    public int RoleId { get; set; }\n    public string Name { get; set; }\n    public virtual ICollection&lt;User&gt; Users { get; set; }\n}\n\npublic class User {\n    public int UserId { get; set; }\n    public string Username { get; set; }\n    public virtual ICollection&lt;Role&gt; Roles { get; set; }\n    public virtual ICollection&lt;UserEmail&gt; UserEmails { get; set; }\n}\n\npublic class UserEmail {\n    public int UserId { get; set; }\n    public int EmailId { get; set; }\n    public bool IsPrimary { get; set; }\n    public virtual User User { get; set; }\n    public virtual Email Email { get; set; }\n}\n\npublic class Email {\n    public int EmailId { get; set; }\n    public string Address { get; set; }\n    public virtual ICollection&lt;UserEmail&gt; UserEmails { get; set; }\n}\n</code></pre>\n\n<p><strong>These are common and specific things I would like to do in this particular case:</strong></p>\n\n<p><strong>Add the primary keys:</strong></p>\n\n<pre><code>modelBuilder.Entity&lt;Role&gt;().HasKey(q =&gt; q.RoleId);\n</code></pre>\n\n<p>Will this have the same <em>effect</em> than using the <code>Key</code> attribute in the entity property? If so, why bother using the <code>modelBuilder</code> when using <em>Data Annotations</em> is shorter and easier to read/write? Is there any <em>convention</em> on when to use <em>Data Annotations</em> or <em>Fluent API</em>?</p>\n\n<p><strong>Add many to many relationships:</strong></p>\n\n<pre><code>modelBuilder.Entity&lt;Role&gt;()\n    .HasMany(q =&gt; q.Users)\n    .WithMany(q =&gt; q.Roles)\n    .Map(q =&gt; {\n                  q.MapLeftKey(\"RoleId\");\n                  q.MapRightKey(\"UserId\");\n                  q.ToTable(\"UserRoles\");\n              });\n</code></pre>\n\n<p><strong>Add one to many relationships:</strong></p>\n\n<pre><code>modelBuilder.Entity&lt;UserEmail&gt;()\n    .HasRequired(q =&gt; q.User)\n    .WithMany(q =&gt; q.UserEmails)\n    .HasForeignKey(q =&gt; q.EmailId);\n</code></pre>\n\n<p>Is the last line required?</p>\n"},{"tags":["entity-framework","security","symfony2"],"answer_count":2,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":4320,"score":8,"question_id":7680917,"title":"How do I get the entity that represents the current user in Symfony2?","body":"<p>I am using the Symfony security setup. Everything works fine, but I don't know how to do one important thing:</p>\n\n<p>In twig, I can reach the current user's info by doing:</p>\n\n<pre><code>Welcome, {{ app.user.username }}\n</code></pre>\n\n<p>or similar</p>\n\n<p>How do I access this same information in the Controller? Specifically, I want to get the current user entity so I can store it relationally in another entity (one-to-one mapping).</p>\n\n<p>I was really hoping it'd be</p>\n\n<pre><code>$this-&gt;get('security.context')-&gt;getToken()-&gt;getUser()\n</code></pre>\n\n<p>but that doesn't work. It gives me a class of type</p>\n\n<pre><code>Symfony\\Component\\Security\\Core\\User\\User\n</code></pre>\n\n<p>and I want one of type</p>\n\n<pre><code>Acme\\AuctionBundle\\Entity\\User\n</code></pre>\n\n<p>which is my entity....</p>\n"},{"tags":[".net","json","entity-framework","asp.net-web-api"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":12461875,"title":"JSON not deserialize correctly Web API","body":"<p>Im getting a error when converting JSON to an object. I can get the JSON thru Fiddler, so there is nothing wrong with my Web API I guess.</p>\n\n<p>This is the error that I have:</p>\n\n<blockquote>\n  <p>{\"Cannot deserialize the current JSON object (e.g. {\\\"name\\\":\\\"value\\\"}) into type 'System.Collections.Generic.List`1[MvcMobile.WebAPI.Model.Person]' because the type requires a JSON array (e.g. [1,2,3]) to deserialize correctly.\\r\\nTo fix this error either change the JSON to a JSON array (e.g. [1,2,3]) or change the deserialized type so that it is a normal .NET type (e.g. not a primitive type like integer, not a collection type like an array or List) that can be deserialized from a JSON object. JsonObjectAttribute can also be added to the type to force it to deserialize from a JSON object.\\r\\nPath 'BusinessEntityID', line 1, position 30.\"}</p>\n</blockquote>\n\n<p>This is the JSON:</p>\n\n<pre><code>{\"$id\":\"1\", \"BusinessEntityID\":1,\"PersonType\":\"EM\",\"NameStyle\":false,\"Title\":null,\n\"FirstName\":\"Ken\", \"MiddleName\":\"J\",\"LastName\":\"Snchez\",\"Suffix\":null,\n\"EmailPromotion\":0,\"AdditionalContactInfo\":null,\"Demographics\":\"0\",\n\"rowguid\":\"92c4279f-1207-48a3-8448-4636514eb7e2\",\n\"ModifiedDate\":\"2003-02-    08T00:00:00\",\"Employee\":null}\n</code></pre>\n\n<p>And this is the code:</p>\n\n<pre><code>HttpResponseMessage resp = client.GetAsync(\"http://localhost:8080/api/person/GetPerson/\" + id).Result;\nresp.EnsureSuccessStatusCode();\n\nvar result = resp.Content.ReadAsAsync&lt;IEnumerable&lt;Person&gt;&gt;().Result;\n</code></pre>\n\n<p>In Entity Framework I have set the following two options:</p>\n\n<pre><code>this.Configuration.LazyLoadingEnabled = false; \nthis.Configuration.ProxyCreationEnabled = false;\n</code></pre>\n\n<p>Could it be because I only get back one entity that JSON has a problem with that? Or something with missing []{}? Or mabye their is a better way to go from JSON to an object?</p>\n"},{"tags":["sql-server","entity-framework","database-design","database-migration"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12507618,"title":"Entity Framework on different database","body":"<p>I have a project which uses entity framework.\nWe map a mssql db with entity framework. Now we want to change mssql db to oracle db. But I don't want to change my model of db in entity framework. Two dbs are same tables columns etc.\nonly difference is their technologies(mssql and oracle) and some of the column data types.In mssql we use bigint instead of number in oracle. Is it possible to use same model with difference dbs which have same tables on Entity framework?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12495593,"title":"Better way to dispose EF context in the controller","body":"<p>I have a simple MagazineRepository class</p>\n\n<pre><code>public class MagazineRepository : IDisposable\n{\n    //EntityFramewokr context\n    private DataBaseContext _context;\n\n    public MagazineRepository() \n    {            \n        _context = new DataBaseContext();\n    }    \n\n    public void Dispose()\n    {\n    if (_context != null) \n    { \n        _context.Dispose(); \n    } \n        GC.SuppressFinalize(this);\n    }\n}\n</code></pre>\n\n<p>And a simple controller:</p>\n\n<pre><code>public class MagazineController : Controller\n{      \n    public ActionResult Index()\n    {     \n        //Should to implement using to dispose\n        using(MagazineRepository magazineRepository = new MagazineRepository())\n        {\n            var magazine = magazineRepository.GetAll().ToList(); //Should use ToList() to avoid \"Object has been disposed exception\".\n            return View(magazine);\n        }\n    }       \n}\n</code></pre>\n\n<p>What if i don't want to use \"using\" and \"ToList()\" in each Action? What if i will call Dispose() context method in the destructor of the controller? Something like this:</p>\n\n<pre><code>public class MagazineController : Controller\n{      \n    MagazineRepository _magazineRepository;\n    public MagazineController()\n    {\n        _magazineRepository= new MagazineRepository();\n    }\n    ~MagazineRepository();   \n    {\n        if(_magazineRepository!=null)\n        {\n            _magazineRepository.Dispose();\n        }\n    }\n    public ActionResult Index()\n    {              \n        var magazine = magazineRepository.GetAll();  \n         return View(magazine);              \n    }       \n}\n</code></pre>\n\n<p>This code works, but i think it should be written in some other way. Context is able to live too long in last code example.\nSo are there any patterns that can give me my db records without \"using\" and \"ToList()\" each time?</p>\n"},{"tags":["wpf","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":51,"score":-3,"question_id":12508552,"title":"Is dbContext effects on performance of WPF Application?","body":"<pre><code> public DEV_MasterPOSEntities Context = new DEV_MasterPOSEntities();\n</code></pre>\n\n<p>I am using WPF and MVVM but system performance is very slow. Is it due to Context? Is it then what can I do to increase performance?</p>\n"},{"tags":["c#","linq","entity-framework","lambda"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12507935,"title":"How to pass instance method as a delegate","body":"<p>I have this method that I use with <em>EF</em></p>\n\n<pre><code>RetryGetWithExpression&lt;city, List&lt;city&gt;&gt;(u =&gt; u.Take(10).ToList());\n\npublic static TValue RetryGetWithExpression&lt;T, TValue&gt;(\n        Func&lt;ObjectSet&lt;T&gt;, TValue&gt; func)\n    where T : class\n{\n    var entitySet = entitiesContext.CreateObjectSet&lt;T&gt;();\n    return func(entitySet);\n}\n</code></pre>\n\n<p>The above code works with the table entities generated by EF. What I am trying to do is to change the code in such way that it works with stored procedures.</p>\n\n<p>This is the code that <em>executes the SP</em>:</p>\n\n<pre><code>Entities G = new Entities();\nObjectResult&lt;retrieveMedia_Result&gt; F = G.retrieveMedia(1);\n</code></pre>\n\n<p>When I try to convert RetryGetWithExpression to accept SPs, I get a problem that retrieveMedia is instance method and I cant pass it as u.retrieveMedia(1)</p>\n\n<pre><code>RetryGetWithExpression&lt;Entities, ObjectResult&lt;retrieveMedia_Result&gt;&gt;(\n    u =&gt; u.retrieveMedia(1));\n\npublic static TValue RetryGetWithExpression&lt;T, TValue&gt;(\n        Func&lt;ObjectSet&lt;T&gt;, TValue&gt; func)\n    where T : class\n{\n\n}\n</code></pre>\n\n<p>How to change the above code so that It works with SPs?</p>\n"},{"tags":["json","entity-framework","dynamic","complextype"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12506410,"title":"Entity Framework 5 complex type mapping different representation of the data","body":"<p>If I want to represent different appearances of data, for example, I want to store something in the database as string, however, it's a special type of string, for example, let's say it's a json string. My application is well aware of this type and knows how to deal with it (as a dynamic object in this case). How would I go about representing it as a dynamic object in my application but store it as string in the database, without having to manually serialize and deserialize the json on save and retrieve?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12507132,"title":"Copying a collection of entites","body":"<p>I am trying to copy a list of users roles from one user to another with the method: </p>\n\n<pre><code>public bool CopyUsersRoles(Guid copyFromUserId, Guid copyToUserId)\n{\n    //Delete existing roles for user\n    var rolesToDelete = context.UserApplicationRoles.Where(x =&gt; x.UserID == copyToUserId);\n\n    foreach (var u in rolesToDelete)\n    {\n        context.UserApplicationRoles.DeleteObject(u);\n    }    \n\n    var rolesToAdd = context.UserApplicationRoles.Where(x =&gt; x.UserID == copyFromUserId)\n                                  .ToList();                             \n\n    for(int i = 0; i &lt; rolesToAdd.Count; i++)\n    {\n        rolesToAdd[i].UserID = copyToUserId;                           \n    }    \n\n    foreach (var u in rolesToAdd)\n    {\n        context.UserApplicationRoles.AddObject(u);\n    }    \n\n    context.SaveChanges();    \n}\n</code></pre>\n\n<p>I am getting the following exception when assigning a new <code>UserId</code>:</p>\n\n<blockquote>\n  <p>The property 'UserID' is part of the object's key information and cannot be modified. \n       at System.Data.Objects.EntityEntry.VerifyEntityValueIsEditable(StateManagerTypeMetadata typeMetadata, Int32 ordinal, String memberName)</p>\n</blockquote>\n\n<p>I would have thought that the ToList() would have prevented this...</p>\n\n<p>What is the correct way to achieve this?</p>\n\n<p><strong>EDIT - class details:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/hJLtU.png\" alt=\"enter image description here\"></p>\n\n<p>I see there is no PK set on the legacy table. I'm assuming manually setting the PK to UserApplicationRoleId will fix this.</p>\n\n<p>UserId Looks like this: </p>\n\n<pre><code>    [EdmScalarPropertyAttribute(EntityKeyProperty=true, IsNullable=false)]\n    [DataMemberAttribute()]\n    public global::System.Guid UserID\n    {\n        get\n        {\n            return _UserID;\n        }\n        set\n        {\n            if (_UserID != value)\n            {\n                OnUserIDChanging(value);\n                ReportPropertyChanging(\"UserID\");\n                _UserID = StructuralObject.SetValidValue(value);\n                ReportPropertyChanged(\"UserID\");\n                OnUserIDChanged();\n            }\n        }\n    }\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","ef-code-first","ef-migrations"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":341,"score":3,"question_id":11291010,"title":"How to reset database migrations using EF code first?","body":"<p>I have a class library project with my DbContext and migration enabled with following config file:</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.3.1.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n  &lt;/configSections&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"DataContext\" connectionString=\"Data Source=Data.sdf\" providerName=\"System.Data.SqlServerCe.4.0\" /&gt;\n  &lt;/connectionStrings&gt;\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\"&gt;\n      &lt;parameters&gt;\n        &lt;parameter value=\"System.Data.SqlServerCe.4.0\" /&gt;\n      &lt;/parameters&gt;\n    &lt;/defaultConnectionFactory&gt;\n  &lt;/entityFramework&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>Some time before I played with migrations for this project and Get-Migrations command always returns following to me:</p>\n\n<pre><code>PM&gt; Get-Migrations -StartupProjectName \"Data\"\nRetrieving migrations that have been applied to the target database.\n201207012104355_Initial\n201207012031234_Initial\n201207012024250_Initial\n</code></pre>\n\n<p>The problem is that command always returns these items even if I delete Data.sdf or delete all project and make new one. The only way I can create new database is changing database file name in connection string from Data.sdf to Data1.sdf for example.\nSo how can i reset migration history without changing database name?</p>\n"},{"tags":["c#",".net","entity-framework","automapper"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":12496484,"title":"EF 4.4 Doesn't detect changes done by AutoMapper","body":"<p>I'm using a repository patter for my webApi, and trying to make Update work.\nWhat this does is receives a \"new\" entity from the mvc webapi controller, and tries to update the existing object</p>\n\n<pre><code>public void Update(TEntity entity)\n        {\n\n            var oldEntry = _context.Set&lt;TEntity&gt;().Find(entity.Id);\n\n            oldEntry = Mapper.Map(entity, oldEntry);\n\n            Console.WriteLine(oldEntry.ToString());\n\n            _context.SaveChanges();\n\n        }\n</code></pre>\n\n<p>Save changes does nothing.</p>\n\n<p>If I explicitly specify </p>\n\n<pre><code>oldEntry.SomeTextProperty = \"TestText\";\n</code></pre>\n\n<p>and then call </p>\n\n<pre><code> _context.SaveChanges();\n</code></pre>\n\n<p>all is good. \nHow to fix this ? or work around this ?\nMaybe there is a way to tell AutoMapper to invoke property setters ? </p>\n"},{"tags":["linq","entity-framework","orm","entity"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12504231,"title":"How to filter everything from an Entity using Entity Framework","body":"<p>I'm using VS2010, VB.NET and Entity Framework.</p>\n\n<p>I have a textbox in my application where you can search a person by texting his name, his identification number or his last name. And obviously I have a table in Data Base called PERSON, how can I do to retrieve all persons from database that match with the search.</p>\n\n<p>For example I have this two people in my database:</p>\n\n<p><strong>Person 1.</strong><br>\nName: Samantha<br>\nLast Name: Randf<br>\nID: 702020406</p>\n\n<p><strong>Person 2</strong><br>\nName: Eric<br>\nLast Name: Salas<br>\nID: 405670233</p>\n\n<p>And if a person texts in the search text field the letter <strong>\"s\"</strong> ...both person should be retrieve from database because there is a coincidence with person 1 in the name and with person 2 in the last name.\nIt's a global search, any idea?  </p>\n"},{"tags":["entity-framework",".net-4.0","mysql-connector"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12506637,"title":".NET framework 4 with Entity Framework and MySQL Connector","body":"<p>Have a .net framework 4 windows forms application. I use Mysql .NET connector 6.5.4 to connect to database with Entity Framework. I am developing it in my Windows 7 x64 machine. I tried building the project with x64 and it runs perfectly in my machine and any other x86 machines other than this. </p>\n\n<p>But gives the following error when run in the x64 machines in my friends computers.</p>\n\n<pre><code>Problem signature:\n  Problem Event Name:   CLR20r3\n  Problem Signature 01: dengue_project.exe\n  Problem Signature 02: 1.0.0.0\n  Problem Signature 03: 50596b3f\n  Problem Signature 04: Dengue_project\n  Problem Signature 05: 1.0.0.0\n  Problem Signature 06: 50596b3f\n  Problem Signature 07: 4e4\n  Problem Signature 08: 10\n  Problem Signature 09: System.IO.FileNotFoundException\n  OS Version:   6.1.7601.2.1.0.256.48\n  Locale ID:    1033\n  Additional Information 1: 2a49\n  Additional Information 2: 2a49e006c888f45db5496d2a223605c3\n  Additional Information 3: c2c6\n  Additional Information 4: c2c6d82383431b8182089af1c8bd4de3\n</code></pre>\n\n<p>I do not know what causing this error.Whenever I run the .EXE it stops responding and gives the above mentioned problem signature. Please help me.</p>\n"},{"tags":[".net","performance","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":87,"score":3,"question_id":12493965,"title":"EF Code First and Performance With Large Model","body":"<p>Previously, with an EF model, while there was no restriction on the number of entities in a model, it was said that for the best performance, <a href=\"http://thedatafarm.com/blog/data-access/entity-framework-designer-and-large-databases/\" rel=\"nofollow\">a model should be limited to 200 or 400 entitie</a>s.  While you could have an EDMX with over 400 entities, EF may <a href=\"http://blogs.msdn.com/b/adonet/archive/2008/11/24/working-with-large-models-in-entity-framework-part-1.aspx\" rel=\"nofollow\">slow down</a> as a result.</p>\n\n<p>With Code First, is there recommended size limit on a model?  Do we have a cap on the number of entities we can use in a model, before potentially running into performance problems?  I could not find information on this...</p>\n\n<p>Thanks.</p>\n"},{"tags":[".net","entity-framework","ef-code-first","ado.net-entity-data-model","edmx"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":151,"score":1,"question_id":12500625,"title":"Entity Framework Migrations Error - Sequence contains no elements","body":"<p><strong>command:</strong> add-migration blahblah -verbose<br>\n<strong>error:</strong> Sequence contains no elements</p>\n\n<p>I did a few things before getting this error. I made a change to my code-first model but did not run<code>add-migration</code> yet. Then I added an EDMX model to play around with an idea visually. I realized the EDMX model was messing with my code so I removed it. I tried to run <code>add-migration</code> and got \"Sequence contains no elements\". I upgraded to EF 5 and uninstalled the old Migrations package except for my configurations. Then I tried <code>add-migration</code> again and I am still getting \"Sequence contains no elements\". Below is the rest of the error.</p>\n\n<pre><code>System.InvalidOperationException: Sequence contains no elements\n   at System.Linq.Enumerable.Single[TSource](IEnumerable`1 source)\n   at System.Data.Entity.Migrations.Infrastructure.EdmModelDiffer.GetQualifiedTableName(XDocument model, String entitySetName)\n   at System.Data.Entity.Migrations.Infrastructure.EdmModelDiffer.&lt;FindRenamedIndependentAssociationColumns&gt;b__ba(&lt;&gt;f__AnonymousType16`2 &lt;&gt;h__TransparentIdentifieraa)\n   at System.Linq.Enumerable.&lt;&gt;c__DisplayClass12`3.&lt;CombineSelectors&gt;b__11(TSource x)\n   at System.Linq.Enumerable.WhereSelectEnumerableIterator`2.MoveNext()\n   at System.Linq.Enumerable.&lt;ConcatIterator&gt;d__71`1.MoveNext()\n   at System.Linq.Enumerable.&lt;ConcatIterator&gt;d__71`1.MoveNext()\n   at System.Linq.Enumerable.&lt;DistinctIterator&gt;d__81`1.MoveNext()\n   at System.Collections.Generic.List`1..ctor(IEnumerable`1 collection)\n   at System.Linq.Enumerable.ToList[TSource](IEnumerable`1 source)\n   at System.Data.Entity.Migrations.Infrastructure.EdmModelDiffer.Diff(XDocument sourceModel, XDocument targetModel, String connectionString)\n   at System.Data.Entity.Migrations.DbMigrator.Scaffold(String migrationName, String namespace, Boolean ignoreChanges)\n   at System.Data.Entity.Migrations.Design.MigrationScaffolder.Scaffold(String migrationName, Boolean ignoreChanges)\n   at System.Data.Entity.Migrations.Design.ToolingFacade.ScaffoldRunner.Scaffold(MigrationScaffolder scaffolder)\n   at System.Data.Entity.Migrations.Design.ToolingFacade.ScaffoldRunner.RunCore()\n   at System.Data.Entity.Migrations.Design.ToolingFacade.BaseRunner.Run()\nSequence contains no elements\n</code></pre>\n"},{"tags":["c#","entity-framework","binding","datagridview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12498652,"title":"Binding DataGridView to data from different entities","body":"<p>I'm trying to show data from two related entities in a DataGridView. I know I could just select the values like this: </p>\n\n<pre><code>  from tasks in context.TaskSettings\n     join train in context.Trainings on tasks.TrainingID equals train.TrainingID\n     where tasks.TrainingID == task\n           select new {TrainingName = train.TrainingName,  \n                       DriversNeeded = tasks.DriversNeeded, \n                       EmployeesPerSupervisor = tasks.EmployeesPerSupervisor};\n</code></pre>\n\n<p>But that gives me immutable values and my interest is showing those values in a DataGridView so the user can just edit the values and click Save Changes.</p>\n\n<p>I've tried this other approach</p>\n\n<pre><code>ObjectQuery&lt;TaskSetting&gt; trainingSettings = \n    (ObjectQuery&lt;TaskSetting&gt;)context.TaskSettings.Where(t =&gt; t.TrainingID == task);\ndgvTask.DataSource = trainingSettings.Execute(MergeOption.AppendOnly);\n</code></pre>\n\n<p>but that just puts the whole Training entity in a single column</p>\n\n<p>I want to be able to, at least, get the training name from the Training entity and still be able to make changes and update the Data Context accordingly. I wanted to post pictures to be more helpful, but this is my fist question. Any help would be greatly appreciated!</p>\n"},{"tags":["c#","linq","entity-framework","tsql","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12490004,"title":"LINQ-Entities Group By With Range Variable Query","body":"<p>Here's my T-SQL which i'm trying to convert to a LINQ-Entities query....</p>\n\n<pre><code>SELECT  [a].[ModLimit], [b].[NumberOfMods]\nFROM    [dbo].[Site][a]\nINNER JOIN\n(\n    SELECT          [SiteId], ISNULL(COUNT(*),0) AS [NumberOfMods]\n    FROM            [dbo].[Users][a]\n    WHERE           [a].[IsMod] = 1\n    GROUP BY        [SiteId]\n) [b] ON [a].[SiteId] = [b].[SiteId]\nWHERE   [a].[SiteId] = 1\n</code></pre>\n\n<p>What i'm working with so far (not compiling...)</p>\n\n<pre><code>from u in db.Set&lt;User&gt;()\njoin s in db.Set&lt;Site&gt;() on u.SiteId equals s.SiteId\nlet x = t.ModLimit\nwhere s.SiteId == 1\ngroup u by u.SiteId into g\nselect new { g,x});\n</code></pre>\n\n<p>Ideas?</p>\n\n<p>Cutdown Structure of tables:</p>\n\n<p><strong>Site</strong></p>\n\n<p><em>SiteId</em> int PK</p>\n\n<p><em>ModLimit</em> int</p>\n\n<p><strong>Users</strong></p>\n\n<p>UserId int PK</p>\n\n<p><em>SiteId</em> int FK\n<em>IsMod</em>  bit</p>\n"},{"tags":["entity-framework","entity-framework-5","entity-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":138,"score":2,"question_id":12490192,"title":"Entity Framework 5 SaveChanges Not Working, No Error","body":"<p>None of the many questions on this topic seem to match my situation. I have a large data model. In certain cases, only a few of the fields need be displayed on the UI, so for those I replaced the LINQ to Entity query that pulls in everything with an Entity SQL query retrieving only the columns needed, using a Type constructor so that I got an entity returned and not a DbDataRecord, like this: </p>\n\n<pre><code>SELECT VALUE MyModelNameSpace.INCIDENT(incident.FieldA, incident.FieldB, ...) FROM ... AS ...\n</code></pre>\n\n<p>This works and displays the fields in the UI. And if I make a change, the change makes it back to the entity model when I tab out of the UI element. But when I do a SaveChanges, the changes do not get persisted to the database. No errors show up in the Log. Now if I very carefully replace the above query with an Entity Sql query that retrieves the entire entity, like this:</p>\n\n<pre><code>SELECT VALUE incident FROM MyDB.INCIDENTs AS incident...\n</code></pre>\n\n<p>Changes do get persisted in the database! So as a test, I created another query like the first that named every column in the entity, which should be the exact equivalent of the second Entity SQL query. Yet it did not persist changes to the database either.</p>\n\n<p>I've tried setting the MergeOption on the returned result to PreserveChanges, to start tracking, like this:</p>\n\n<pre><code>incidents.MergeOption = MergeOption.PreserveChanges;\n</code></pre>\n\n<p>But that has no effect. But really, if retrieving the entire entity with Entity Sql persists changes, what logical purpose would there be for behaving differently when a subset of the fields are retrieved? I'm wondering if this is a bug?</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":3,"favorite_count":3,"up_vote_count":7,"down_vote_count":0,"view_count":2524,"score":7,"question_id":5866705,"title":"Function imports cannot be created for composable functions","body":"<p>I have generated Entity CodeBlock for my database objects and choose some of my user defined scalar functions. But when i tried to double click on functions in Model.Store to import function i get this error. </p>\n\n<p>Function imports cannot be created for composable functions.</p>\n\n<p>How can i import my functions?</p>\n"},{"tags":["c#","entity-framework","sql-server-2012","localdb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":123,"score":0,"question_id":12503688,"title":"Entity Framework doesn't save updates to the underlying database","body":"<p>I am using the following code to update clock in and clock out times in the record table but it doesn't save the data to the database. I checked the mdf file with sql management studio and there is no data saved. What am I doing wrong?</p>\n\n<pre><code>private void btClockIn_Click(object sender, EventArgs e)\n    {\n        using (TimeKeepEntities ctx = new TimeKeepEntities())\n        {\n          // if employee clocked out add new clock in record else update existing record with clock out time\n            if (cmbProjects.Enabled)\n            {\n                tblTimeRecord record = new tblTimeRecord();\n                record.RecordID = DateTime.Now; \n                record.EmployeeID = (int)cmbEmployees.SelectedValue;\n                record.ProjectID = (int)cmbProjects.SelectedValue;\n                record.ClockIn = DateTime.Now;\n\n\n                ctx.tblTimeRecords.Add(record);\n                ctx.SaveChanges();\n\n                update_cmbProjects_btClockIn();\n\n            }\n            else\n            {\n                tblTimeRecord record = (from r in ctx.tblTimeRecords\n                                        where r.EmployeeID == (int)cmbEmployees.SelectedValue &amp;&amp; !r.ClockOut.HasValue\n                                        select r).FirstOrDefault();\n                record.ClockOut = DateTime.Now;\n                ctx.SaveChanges();\n\n                update_cmbProjects_btClockIn();\n            }\n        }\n    }\n</code></pre>\n\n<p>EDIT 1: Here is my app.config file (including what looks like a connection string)</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n    &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n  &lt;/configSections&gt;\n  &lt;startup&gt;\n    &lt;supportedRuntime version=\"v4.0\" sku=\".NETFramework,Version=v4.5\" /&gt;\n  &lt;/startup&gt;\n  &lt;connectionStrings&gt;\n    &lt;add name=\"TimeKeepEntities\" connectionString=\"metadata=res://*/Model1.csdl|res://*/Model1.ssdl|res://*/Model1.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=(LocalDB)\\v11.0;attachdbfilename=|DataDirectory|\\TimeKeep.mdf;integrated security=True;connect timeout=30;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\" /&gt;\n  &lt;/entityFramework&gt;\n&lt;/configuration&gt;\n</code></pre>\n"},{"tags":["c#","entity-framework","orm","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12500604,"title":"Mapping relationships to collections of abstractions in Entity Framework","body":"<p>I have two classes that each implement an interface. One of the classes contains an ICollection of the other's interfaces.</p>\n\n<p>Now I want to map this to my database using EF but get an exception (below). Is this supposed to be possible somehow?</p>\n\n<p>Entity definitions for my classes (products and categories):</p>\n\n<pre><code>public interface IProduct\n{\n    string ProductId { get; set; }\n    string CategoryId { get; set; }\n}\n\npublic interface ICategory\n{\n    string CategoryId { get; set; }\n    ICollection&lt;IProduct&gt; Products  { get; set; };\n}\n\npublic class ProductImpl : IProduct\n{\n    public string ProductId { get; set; }\n    public string CategoryId { get; set; }\n}\n\npublic class CategoryImpl : ICategory\n{\n    public string CategoryId { get; set; }\n    public ICollection&lt;IProduct&gt; Products { get; set; }\n}\n</code></pre>\n\n<p>I want to map the relationship between CategoryImpl and ProductImpl so I'm using the following <code>OnModelCreating</code> method in my DbContext:</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n    var a = modelBuilder.Entity&lt;CategoryImpl&gt;();\n    a.ToTable(\"Categories\");\n    a.HasKey(k =&gt; k.CategoryId);\n    a.Property(p =&gt; p.CategoryId);\n    a.HasMany(p =&gt; p.Products).WithOptional().HasForeignKey(p =&gt; p.CategoryId);\n\n    var b = modelBuilder.Entity&lt;ProductImpl&gt;();\n    b.ToTable(\"Products\");\n    b.HasKey(k =&gt; k.ProductId);\n    b.Property(p =&gt; p.ProductId);\n}\n</code></pre>\n\n<p>The exception I get is below. Am I supposed to somehow specify that the concrete type to be used for <code>IProduct</code> is <code>ProductImpl</code>?</p>\n\n<pre><code>    System.InvalidOperationException: The navigation property 'Products' \nis not a declared property on type 'CategoryImpl'. Verify that it has \nnot been explicitly excluded from the model and that it is a valid navigation property.\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12495601,"title":"Project nested entity into nested view model","body":"<p>I need to project some POCO entities from EF into their cut down view model representations for passing to a serializer. The entities in this situation are Shipment and Requisition and have a 0..1 relationship. If I don't pass view models then it'll throw a stack overflow exception while trying to serialize the cyclic references between Requisition and Shipment.</p>\n\n<pre><code>return db.ShipmentRequisitions\n                .Include(c =&gt; c.Shipment)\n                .Select(r =&gt; new ViewModels.Requisition\n                {\n                    ID = r.ID,\n                    ...\n                    Shipment = r.Shipment != null ? new ViewModels.Shipment\n                    {\n                        ID = r.Shipment.ID,\n                        ...\n                    } : null\n                }).AsQueryable();\n</code></pre>\n\n<p>If the Shipment is null, then I get an exception when trying to access r.Shipment.ID. I added a null check as above and now get the following exception.</p>\n\n<blockquote>\n  <p>Unable to create a constant value of type 'Api.ViewModels.Shipment'.\n  Only primitive types ('such as Int32, String, and Guid') are supported\n  in this context.</p>\n</blockquote>\n\n<p>This strikes me as odd, as it was quite happy to create the nested ViewModels.Shipment as part of the select before I added the null check, so it must be something to do with this.</p>\n\n<p>I can see some EF in the call stack so I tried it in a quick test project with just straight objects to try it with pure LINQ.</p>\n\n<pre><code>var user = users.Select(u =&gt; new ViewModel.User\n                {\n                    Id = u.Id,\n                    Profile = u.Profile != null ? new ViewModel.Profile\n                    {\n                        Id = u.Profile.Id\n                    } : null\n                }).ToList();\n</code></pre>\n\n<p>To my surprise with worked. I can't quite figure out what this doesn't work in the first code sample.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I've discovered that if as part of a select I do something like:</p>\n\n<pre><code>.Select(r =&gt; new ViewModels.Requisition\n                    {\n                        ID = r.ID,\n                        ShipmentDescription = r.Shipment.Description\n                    })\n</code></pre>\n\n<p>This is effectively flattening the required Shipment properties into a single DTO. Here I would expect to get a NullReferenceExcetion if Shipment is null on any of the records when setting the Description property. It doesn't happen however. LINQ seems to suppress the exception and the ShipmentDescription comes through just as null. It saves me doing an inline is null check on Shipment for each nested property. Unfortunately this doesn't appear to extend to the same sort of thing when creating a nested object where I'm not flattening.</p>\n"},{"tags":["entity-framework","tsql","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":178,"score":1,"question_id":10710277,"title":"Transaction deadlocked on lock resources when using EF code first","body":"<p>I am using EF code first. Recently I had to replace the following code:</p>\n\n<pre><code>User user = userRepository.GetByEmail(\"some@email.com\");\n\nif (user == null)\n{\n    user = New User { Email = email, CreatedAt = DateTime.Now };\n\n    userRepository.Add(user);\n    unitOfWork.Commit();\n}\n</code></pre>\n\n<p>with</p>\n\n<pre><code>Context.ExecuteSqlCommand(\"IF NOT EXISTS(SELECT 1 FROM Users WHERE Email = '{0}')\n                           INSERT INTO Users(Email, CreatedAt)\n                           VALUES ('email', GETDATE())\");\n</code></pre>\n\n<p>The reason behind this is that it took EF a very long time to run the first piece of code when trying to add thousands of rows. By changing it to a ExecuteSqlCommand, the time to handle that many rows decreased by a multitude.</p>\n\n<p>The problem I am seeing now (only occurred twice so far) is the following message from the database: Transaction (Process ID 52) was deadlocked on lock resources with another process and has been chosen as the deadlock victim. Rerun the transaction.</p>\n\n<p>How would I go about resolving this? Most of my data access is done through EF with a few exceptions like the the one above. I have never seen a deadlock in my logs before so I assume this ha something to do with the query.</p>\n\n<p>My questions are:</p>\n\n<ol>\n<li>Is there a way to write the query using No LOCK? How would that\nquery look?</li>\n<li>Is there a way to tell EF to use NO LOCK for certain queries?</li>\n</ol>\n"},{"tags":["asp.net-mvc-3","entity-framework","azure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":138,"score":0,"question_id":12495792,"title":"Execute Code First Migrations is Grayed Out in Publish Settings","body":"<p>Using Windows Azure and attempting to publish my MVC3 Application. The check box for Execute Code First Migration in the settings panel of the Publish web application is grayed out. What changes do I need to make to be able to enable it?</p>\n"},{"tags":["linq","entity-framework","c#-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12495661,"title":"Left Join Entity Framework","body":"<p>I am going to trash Entity Framework 5! I have spent two days to find solution from web but found nothing!</p>\n\n<p>I tried a simple left join from table Artworks and EndValidities with the input IDFondazione as 2620</p>\n\n<pre><code>var query = from art in db.Artworks\n  join endVal in db.EndValidities.DefaultIfEmpty() \n  on art.ID_Dtsl equals endVal.IDdtsl \n  where art.ID_Cdgs == IDFondazione\n  select new SchedaOpera()\n  {\n    Cdscheda = art.Cdscheda,\n    Confirmed = art.FGconfermata,\n    DSimmagine = art.DSimmgine,\n    Dtsf = art.Dtsf,\n    Dtsi = art.Dtsi,\n    Dtsl = endVal != null ? endVal.Dtsl : \"\",\n    Iscr = art.Iscr,\n    Misa = art.Misa,\n    Ldcn = art.Ldcn,\n    Ldcs = art.Ldcs,\n    Misd = art.Misd,\n    Misl = art.Misl,\n    Misn = art.Misn,\n    Misp = art.Misp,\n    Miss = art.Miss,\n    Pvcc = art.Pvcc,\n    Pvcp = art.Pvcp,\n    Sgtt = art.Sgtt\n  };\n</code></pre>\n\n<p>The marvellous entity framework continues to produce</p>\n\n<pre><code>SELECT [Extent1].[ID_Dtsl] AS [ID_Dtsl], [Extent1].[CDscheda] AS [CDscheda], \n[Extent1].[FGconfermata] AS [FGconfermata], \n[Extent1].[DSimmagine] AS [DSimmagine], \n[Extent1].[DS_DTSF] AS [DS_DTSF], \n[Extent1].[DS_DTSI] AS [DS_DTSI], \nCASE WHEN (cast(1 as bit) &lt;&gt; cast(0 as bit)) THEN [Extent2].[DSdtsl] ELSE N'_' END AS [C1], \n[Extent1].[DS_ISCR] AS [DS_ISCR], \n[Extent1].[NR_MISA] AS [NR_MISA], \n[Extent1].[DS_LDCN] AS [DS_LDCN], \n[Extent1].[DS_LDCS] AS [DS_LDCS], \n[Extent1].[NR_MISD] AS [NR_MISD], \n[Extent1].[NR_MISL] AS [NR_MISL], \n[Extent1].[NR_MISN] AS [NR_MISN], \n[Extent1].[NR_MISP] AS [NR_MISP], \n[Extent1].[NR_MISS] AS [NR_MISS], \n[Extent1].[FGpubblicata] AS [FGpubblicata], \n[Extent1].[DS_PVCC] AS [DS_PVCC], \n[Extent1].[DS_PVCP] AS [DS_PVCP], \n[Extent1].[DS_SGTT] AS [DS_SGTT]\nFROM  [dbo].[TPD_OPERE] AS [Extent1]\nINNER JOIN [dbo].[TSA_DTSL] AS [Extent2] ON [Extent1].[ID_Dtsl] = [Extent2].[IDdtsl]\nWHERE [Extent1].[CD_CDGS] = '2620'\n</code></pre>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":148,"score":0,"question_id":12488152,"title":"Entity Framework 5 not updating navigation properties in both entities","body":"<p>I have updated a project to use the new <code>Entity Framework</code> shipped with <code>VS2012</code>. However, I ran into some issues 'cause of which my code is throwing exceptions.</p>\n\n<p>In the <code>VS2010</code> version of <code>Entity Framework</code>, I was able to create or modify an <code>Entity</code> and use its navigation properties before calling <code>SaveChanges()</code></p>\n\n<p>For example:\nA Navigation property of a client having a collection of Invoices.</p>\n\n<pre><code>Client c = new Client();\nInvoice I = new Invoice();\nc.Invoices.Add(I);\n</code></pre>\n\n<p>I would then be able to use <code>Invoice.Client</code> somewhere in my code before actually saving it without issue. Now <code>Invoice.Client == null</code>.</p>\n\n<p>Similarly in setting <code>I.Client = C</code>, <code>I</code> does not show up under <code>C.Invoices</code></p>\n\n<p>What am I missing here or is this just simply how <code>Entity Framework 5</code> is?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>In <code>VS2010</code>, I Created a new project, added the same <code>DataSource</code> and the following code worked as expected:</p>\n\n<pre><code>Client C = new Client();\nC.Name = \"Test\";\nInvoice I = new Invoice();\nC.Invoices.Add(I);\nMessageBox.Show(I.Client.Name);\n</code></pre>\n\n<p>Did the exact same thing in <code>VS2012</code> and no dice.</p>\n"},{"tags":["sql","entity-framework","locking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12459338,"title":"Locking tables in Entity Framework","body":"<p>I have an SQL Database with a table that I would like to lock. I'm using Entity Framework. Basically, there are a number of processes that each want to write to the database concurrently. Each of them wants to update a row in some table. However, I want only one of them to be able to do this at the same time.</p>\n\n<p>Is there a way of locking an entire table, such as to prevent anyone from putting new rows or updating rows?</p>\n\n<p>Thanks,\nChristian</p>\n"},{"tags":["entity-framework","interface"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12503036,"title":"Use virtual property in interface (EF)","body":"<p>How can I use a virtual property in an interface in Entity Framework?:</p>\n\n<pre><code>public interface ICommentable\n{\n    int CommentableId { get; set; }\n    virtual ICollection&lt;Comment&gt; Comments { get; set; }\n}\n</code></pre>\n\n<p>That throws an error for the virtual keyword, but if I do it this way:</p>\n\n<pre><code>public interface ICommentable\n{\n    int CommentableId { get; set; }\n    ICollection&lt;Comment&gt; Comments { get; set; }\n}\n</code></pre>\n\n<p>Then this (below) throws an error (\"does not implement ...\")</p>\n\n<pre><code>public class Something : ICommentable\n{\n    int CommentableId { get; set; }\n    public virtual ICollection&lt;Comment&gt; Comments { get; set; }\n    ...more properties....\n}\n</code></pre>\n"},{"tags":["c#","entity-framework","entity-framework-5"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":214,"score":1,"question_id":12501183,"title":"Data binding linq query to datagridView in Entity Framework 5.0","body":"<p>I am learning the Entity Framework (5.0 and VSExpress 2012) and I'm having real trouble binding my query to a dataGridView in WinForms.\nI have the below code and it displays my query okay when I start the application but I don't know what I need to do to update the dataGridView after changing the data in the underlying database. What's the best way of doing this? What am I doing wrong here?</p>\n\n<pre><code>private void Form1_Load(object sender, EventArgs e)\n    {\n        using( var ctx = new TimeKeepEntities())\n        {\n\n            var qLoggedIn = from r in ctx.tblTimeRecords\n                        where (r.tblEmployee.Active &amp;&amp; !r.ClockOut.HasValue) || System.Data.Objects.EntityFunctions.DiffDays(r.ClockOut, DateTime.Now)&lt;30\n                        select new { Name = r.tblEmployee.Last + \", \" + r.tblEmployee.First, r.tblProject.ProjName, r.ClockIn, r.ClockOut };\n\n            dataGridView1.DataSource = qLoggedIn.ToList();\n\n        }\n    }\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12501333,"title":"Entity Framework - How to load empty children","body":"<p>Am getting started using Entity Framework and have run into a problem.</p>\n\n<p>Say I have 2 tables in my database. One called Agent that contains an ID and a password and another table called AgentDetail that contains more information about the Agent. However, there might not be a corresponding AgentDetail record for every Agent record.</p>\n\n<p>I have these 2 classes to represent those 2 tables:</p>\n\n<pre><code>public class Agent\n{\n    public string AgentId { get; set; }\n    public string Password { get; set; }\n    public virtual AgentDetail AgentDetail { get; set; }\n}\n\npublic class AgentDetail\n{\n    public string AgentDetailId { get; set; }\n    public string AgentName { get; set; }\n    public string Postcode { get; set; }\n}\n</code></pre>\n\n<p>Using EF I can add data to the database OK. I can also retrieve data OK when there is a corresponding record in both tables.</p>\n\n<pre><code>        var agents = from a in context.Agents\n                     select a;\n\n        return View(agents.ToList());\n</code></pre>\n\n<p>However I get a NullReferenceException in my view when rendering values within AgentDetail if that record doesn't exist in the AgentDetail table.</p>\n\n<p>Now that's totally expected as there is no AgentDetail record.</p>\n\n<p>My question is how do I get EF to create an AgentDetail with empty values when the record doesn't exist in the table.</p>\n\n<p>Can I add an empty child object in the LINQ query - something like:</p>\n\n<pre><code>        var agents = (from a in rb.Agents\n                      select new\n                      {\n                          AgentId = a.AgentId,\n                          Password = a.Password,\n                          AgentDetail = a.AgentDetail == null ? new AgentDetail() : a.AgentDetail,\n                      }).ToList();\n</code></pre>\n\n<p>(the above doesn't work however as I get the following message:</p>\n\n<p>The entity or complex type 'Models.AgentDetail' cannot be constructed in a LINQ to Entities query.)</p>\n"},{"tags":["sql-server","linq","entity-framework","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12501919,"title":"Not sure how to convert a SQL FullText search query to a Linq to Entities expression","body":"<p>I need help converting a simple SQL contains query to the Linq to Entities equivalent. I'm using EF 4, MVC 4, VS 2012, and SQL 2008. I have a fulltext index created on the table.</p>\n\n<p>This is my query:</p>\n\n<pre><code>SELECT * FROM Media WHERE CONTAINS (*, 'cat')\n</code></pre>\n"},{"tags":["c#","sql","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":154,"score":2,"question_id":12481868,"title":"How to use scalar-valued function with linq to entity?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10625955/can-sql-level-functions-be-made-available-to-linq-to-entity-queries\">Can SQL level functions be made available to LINQ to Entity queries?</a>  </p>\n</blockquote>\n\n\n\n<p>I have a scalar function that gets the distance between two points and I want to use it to query closest record to point.\nThe scalar function works with linq to sql but fails with EF</p>\n\n<p>the scalar function </p>\n\n<pre><code>USE [GeoData]\nGO\n\n/****** Object:  UserDefinedFunction [dbo].[DistanceBetween]    Script Date: 09/18/2012 19:40:44 ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\n\n\nCREATE FUNCTION [dbo].[DistanceBetween](@Lat1 as real,\n@Long1 as real, @Lat2 as real, @Long2 as real)\nRETURNS real\nAS\nBEGIN\n\nDECLARE @dLat1InRad as float(53);\nSET @dLat1InRad = @Lat1;\nDECLARE @dLong1InRad as float(53);\nSET @dLong1InRad = @Long1;\nDECLARE @dLat2InRad as float(53);\nSET @dLat2InRad = @Lat2;\nDECLARE @dLong2InRad as float(53);\nSET @dLong2InRad = @Long2 ;\n\nDECLARE @dLongitude as float(53);\nSET @dLongitude = @dLong2InRad - @dLong1InRad;\nDECLARE @dLatitude as float(53);\nSET @dLatitude = @dLat2InRad - @dLat1InRad;\n/* Intermediate result a. */\nDECLARE @a as float(53);\nSET @a = SQUARE (SIN (@dLatitude / 2.0)) + COS (@dLat1InRad)\n* COS (@dLat2InRad)\n* SQUARE(SIN (@dLongitude / 2.0));\n/* Intermediate result c (great circle distance in Radians). */\nDECLARE @c as real;\nSET @c = 2.0 * ATN2 (SQRT (@a), SQRT (1.0 - @a));\nDECLARE @kEarthRadius as real;\n/* SET kEarthRadius = 3956.0 miles */\nSET @kEarthRadius = 6376.5;        /* kms */\n\nDECLARE @dDistance as real;\nSET @dDistance = @kEarthRadius * @c;\nreturn (@dDistance);\nEND\n\nGO\n</code></pre>\n\n<p>I added an ado.net entity model, updated the model from the database and chose distancebetween</p>\n\n<pre><code> &lt;Function Name=\"DistanceBetween\" ReturnType=\"real\" Aggregate=\"false\" BuiltIn=\"false\" NiladicFunction=\"false\" IsComposable=\"true\" ParameterTypeSemantics=\"AllowImplicitConversion\" Schema=\"dbo\"&gt;\n      &lt;Parameter Name=\"Lat1\" Type=\"real\" Mode=\"In\" /&gt;\n      &lt;Parameter Name=\"Long1\" Type=\"real\" Mode=\"In\" /&gt;\n      &lt;Parameter Name=\"Lat2\" Type=\"real\" Mode=\"In\" /&gt;\n      &lt;Parameter Name=\"Long2\" Type=\"real\" Mode=\"In\" /&gt;\n    &lt;/Function&gt;\n</code></pre>\n\n<p>I made a partial class and wrote this method</p>\n\n<pre><code>public partial class GeoDataEntities\n{\n    [EdmFunction(\"GeoDataModel.Store\", \"DistanceBetween\")]\n    public double DistanceBetween(double lat1, double lon1, double lat2, double lon2)\n    {\n        throw new NotImplementedException();\n    }\n}\n</code></pre>\n\n<p>I tried many times to query the function with this code but it gets an error</p>\n\n<pre><code>var NParcel = db.geoAddresses.Where(g=&gt; db.DistanceBetween(21.5,39.5, g.lat,g.lon) &lt; 20);\n</code></pre>\n\n<p>when i try to <code>count</code> or <code>foreach</code> the NParcel I get this error </p>\n\n<blockquote>\n  <p>The specified method 'Double DistanceBetween(Double, Double, Double,\n  Double)' on the type 'EFSample.GeoDataEntities' cannot be translated\n  into a LINQ to Entities store expression.</p>\n</blockquote>\n\n<p>and stacktrace</p>\n\n<blockquote>\n  <p>at\n  System.Data.Objects.ELinq.ExpressionConverter.ThrowUnresolvableFunction(Expression\n  Expression)    at\n  System.Data.Objects.ELinq.ExpressionConverter.MethodCallTranslator.FunctionCallTranslator.TranslateFunctionCall(ExpressionConverter\n  parent, MethodCallExpression call, EdmFunctionAttribute\n  functionAttribute)    at\n  System.Data.Objects.ELinq.ExpressionConverter.MethodCallTranslator.TypedTranslate(ExpressionConverter\n  parent, MethodCallExpression linq)    at\n  System.Data.Objects.ELinq.ExpressionConverter.BinaryTranslator.TypedTranslate(ExpressionConverter\n  parent, BinaryExpression linq)    at\n  System.Data.Objects.ELinq.ExpressionConverter.TranslateExpression(Expression\n  linq)    at\n  System.Data.Objects.ELinq.ExpressionConverter.TranslateLambda(LambdaExpression\n  lambda, DbExpression input)    at\n  System.Data.Objects.ELinq.ExpressionConverter.MethodCallTranslator.OneLambdaTranslator.Translate(ExpressionConverter\n  parent, MethodCallExpression call, DbExpression&amp; source,\n  DbExpressionBinding&amp; sourceBinding, DbExpression&amp; lambda)    at\n  System.Data.Objects.ELinq.ExpressionConverter.MethodCallTranslator.OneLambdaTranslator.Translate(ExpressionConverter\n  parent, MethodCallExpression call)    at\n  System.Data.Objects.ELinq.ExpressionConverter.MethodCallTranslator.TypedTranslate(ExpressionConverter\n  parent, MethodCallExpression linq)    at\n  System.Data.Objects.ELinq.ExpressionConverter.TranslateExpression(Expression\n  linq)    at\n  System.Data.Objects.ELinq.ExpressionConverter.MethodCallTranslator.AggregateTranslator.Translate(ExpressionConverter\n  parent, MethodCallExpression call)    at\n  System.Data.Objects.ELinq.ExpressionConverter.MethodCallTranslator.TypedTranslate(ExpressionConverter\n  parent, MethodCallExpression linq)    at\n  System.Data.Objects.ELinq.ExpressionConverter.Convert()    at\n  System.Data.Objects.ELinq.ELinqQueryState.GetExecutionPlan(Nullable<code>1\n  forMergeOption)    at\n  System.Data.Objects.ObjectQuery</code>1.GetResults(Nullable<code>1\n  forMergeOption)    at\n  System.Data.Objects.ObjectQuery</code>1.System.Collections.Generic.IEnumerable.GetEnumerator()\n  at System.Linq.Enumerable.Single[TSource](IEnumerable<code>1 source)    at\n  System.Linq.Queryable.Count[TSource](IQueryable</code>1 source)</p>\n</blockquote>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":100,"score":1,"question_id":12429579,"title":"How do I create multiple joins using LINQ extension methods?","body":"<p>I'm having trouble using LINQ method calls with multiple joins. I'm trying to do something like this:</p>\n\n<pre><code>            if (!isDepSelect)\n            {                \n                query = (from Items in db.DEPARTMENTs\n                             select Items);\n            }\n            else\n            {                    \n                    query = (from Items in db.DEPARTMENTs\n                             from gDept in db.DEPT_PROFILE\n                             from wAccess in db.WEB_ACCESS\n                             where Items.DEPT_CODE == gDept.DEPT_CODE &amp;&amp; gDept.USER_ID == wAccess.USER_ID &amp;&amp; wAccess.EMP_ID == id\n                             select Items);\n            }\n</code></pre>\n\n<p>I had done this:</p>\n\n<pre><code>IQueryable&lt;DEPARTMENT&gt; query = db.DEPARTMENTs;\n\n\n            if (isDepSelect)\n            { \n                query = query.Join(db.DEPT_PROFILE,depts =&gt; depts.DEPT_CODE,prof =&gt; prof.DEPT_CODE,(depts, prof) =&gt; depts);    \n            }\n</code></pre>\n\n<p>But now I don't know how to add the JOIN of DEPT_PROFILE table with the WEB_ACCESS table and the condition of the EMP_ID = id.</p>\n\n<p>The reason I'm doing this is that the isDepSelect boolean is not the only condition that this query will change its relations and I need someway to add this relations without repeating my LINQ for each of my conditions.</p>\n\n<p>Thank you for your time.</p>\n"},{"tags":["asp.net-mvc","entity-framework","dependency-injection","ninject","ninject.web.mvc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":110,"score":0,"question_id":12501012,"title":"No Parameterless constructor defined for this object...With a twist?","body":"<p>I'm building an MVC4 app using EF5 and ninject.  Something broke when I upgraded from MVC3 to 4.  So I created a brand new solution, got all my nuget packages, added all my references, then copied in my code.  </p>\n\n<p>Project builds, thats fabulous.</p>\n\n<p>My problem is the (Ninjection) sp? doesn't seem to be wiring up correctly.  I get the \"No Parameterless constructor defined for this object\" as a runtime error when I try to load the page.  However, if I simply add an empty public parameterless constructor, the page renders and all is right with the world.</p>\n\n<p>My App_Start Code runs fine, NinjectWebCommon.cs (included at the bottom of the question)  I've stepped through the code, but other that copying and pasting, and following tutorials online.  I don't understand IoC well enough to know what to do next.</p>\n\n<pre><code>namespace search.Controllers\n{\n    public class HomeController : Controller\n    {\n        ICamaService _service = null;\n\n        [Inject]\n        public HomeController(ICamaService  service)\n        {\n            _service = service;\n        }\n        ************** ADDING THIS FIXES THE RUNTIME ERROR *********\n        public HomeController(){\n        ;\n        }\n        ***********\n\n        //TODO: ADD ACTIONS\n\n        public ViewResult Index()\n        {\n            return View();\n\n        }\n    }\n}\n</code></pre>\n\n<p>Here is my composition root:</p>\n\n<pre><code>[assembly:     WebActivator.PreApplicationStartMethod(typeof(search4.App_Start.NinjectWebCommon), \"Start\")]\n[assembly: WebActivator.ApplicationShutdownMethodAttribute(typeof(search4.App_Start.NinjectWebCommon), \"Stop\")]\n\nnamespace search4.App_Start\n{\nusing System;\nusing System.Web;\n\nusing Microsoft.Web.Infrastructure.DynamicModuleHelper;\n\nusing Ninject;\nusing Ninject.Web.Common;\nusing search.Services;\nusing search.Data;\n\npublic static class NinjectWebCommon \n{\n    private static readonly Bootstrapper bootstrapper = new Bootstrapper();\n\n    public static void Start() \n    {\n        DynamicModuleUtility.RegisterModule(typeof(OnePerRequestHttpModule));\n        DynamicModuleUtility.RegisterModule(typeof(NinjectHttpModule));\n        bootstrapper.Initialize(CreateKernel);\n    }\n\n    public static void Stop()\n    {\n        bootstrapper.ShutDown();\n    }\n\n    private static IKernel CreateKernel()\n    {\n        var kernel = new StandardKernel();\n        kernel.Bind&lt;Func&lt;IKernel&gt;&gt;().ToMethod(ctx =&gt; () =&gt; new Bootstrapper().Kernel);\n        kernel.Bind&lt;IHttpModule&gt;().To&lt;HttpApplicationInitializationHttpModule&gt;();\n\n        RegisterServices(kernel);\n        return kernel;\n    }\n\n    private static void RegisterServices(IKernel kernel)\n    {\n        kernel.Bind&lt;ICamaContext&gt;().To&lt;CamaContext&gt;().InRequestScope();\n        kernel.Bind&lt;ICamaService&gt;().To&lt;CamaService&gt;().InRequestScope();\n\n    }        \n\n}\n}\n</code></pre>\n\n<p>![Screen Capture of Exception][1]</p>\n\n<p><a href=\"http://shareimage.ro/viewer.php?file=svs5kwamqy0pxbyntig4.gif\" rel=\"nofollow\">http://shareimage.ro/viewer.php?file=svs5kwamqy0pxbyntig4.gif</a> </p>\n"},{"tags":["entity-framework","iqueryable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12486741,"title":"Entity Framework eager loading/\"IncludeEverything()\"?","body":"<p>In EF4, I have a small object map and the volume of data is also small. So for queries I want to eager load all associated data. Is there any single method call that can do the job, like <code>\"IQueryable.IncludeEverything()\"</code>, rather than call <code>Include()</code> repeatedly with hardcoded property names?</p>\n"},{"tags":["wpf","entity-framework","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":120,"score":1,"question_id":10341216,"title":"How to Soft Delete with Entity Data Model","body":"<p>I have a WPF Application with Entity Data Model.</p>\n\n<p>I would like to set IsDeleted flag to true when entity is deleted instead of deleting from database.</p>\n\n<p>I read many thread here and alot of threads are suggesting to use Modification Function Mapping with the use of conditional mapping.  </p>\n\n<p>I used conditional mapping for filtering IsDeleted = true rows and works great.</p>\n\n<p>However, While I'd like to use Modification Function Mapping for just Delete Function, the program give me error, trying to find Function for Insert and Update as well on SaveChanges() method.  </p>\n\n<p>I only specified for Delete Function.  Is there a way to use only Delete Modification Function and not all Insert, Update, Delete?</p>\n\n<p>If not, is there any other ways that can achieve this?  P.S.  I read about using Instead Of Delete trigger.  However, I would like to avoid it, if possible, since we are developing the program for a mobile application and triggers might slow down the application.</p>\n\n<p>Thank you in advance! </p>\n"},{"tags":["entity-framework","c#-4.0","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12494726,"title":"Limit the rows returned in Include entity","body":"<p>I have simple data model Project,Member and ProjectMember where Project to Member has many-to-many relationship. Therefore ProjectMember table contains the both foreign keys.</p>\n\n<p>I writes the code </p>\n\n<pre><code>var result= db.Projects.Include(p=&gt;p.ProjectMembers).Where(p=&gt;p.ProjectMembers.Any(pm=&gt;pm.DeletedUser==1));\n</code></pre>\n\n<p>and I see <code>result.ProjectMembers</code> count is 2 . Here I have got additional record with DeletedUser is not equal to 1</p>\n\n<p>Did I do something wrong here?</p>\n\n<p>What is the expression I have to use to get the only one record (or many with DeletedUser=1) for <code>result.ProjectMembers</code></p>\n"},{"tags":["c#","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12500506,"title":"LINQ to Entities: nullable datetime in where clause","body":"<p>I have a where clause that looks up child objects on an entity:</p>\n\n<pre><code>var Lookup = row.Offenses.Where(x =&gt; x.Desc == co.Desc &amp;&amp; x.Action == co.Action &amp;&amp; x.AppealYN == co.AppealYN &amp;&amp; x.OffDate == co.OffDate).ToList();\n</code></pre>\n\n<p>Sometimes the <code>co.OffDate</code> can be null, which will cause an exception.  Right now, the only way I can think of to get around that, is to use an if statement:</p>\n\n<pre><code> if (co.OffDate.HasValue)\n                                {\n var Lookup = row.Offenses.Where(x =&gt; x.Desc == co.Desc &amp;&amp; x.Action == co.Action &amp;&amp; x.AppealYN == co.AppealYN &amp;&amp; x.OffDate == co.OffDate).ToList();\n                                }\n                                else\n                                {\n                                     var Lookup = row.Offenses.Where(x =&gt; x.Desc == co.Desc &amp;&amp; x.Action == co.Action &amp;&amp; x.AppealYN == co.AppealYN).ToList();\n                                }\n</code></pre>\n\n<p>Is there anyway I can re-write the linq query to accomplish what the if statement does?  I still want to do a lookup, even if the <code>co.OffDate</code> is null.  </p>\n"},{"tags":[".net","entity-framework","c#-4.0","entity-framework-4"],"answer_count":4,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":1491,"score":7,"question_id":4019895,"title":"Modifying an Entity Framework Model at Run-Time","body":"<p>This is purely a conceptual and design idea related to EF4.</p>\n\n<p>The example/scenario is a large ERP or CRM type system where companies may need to add traditional \"user defined fields\" to capture additional data.</p>\n\n<p>I know that the EF has some capabilities to push out the model to a database at run-time but the question really is can you use EF to modify a model and update the data store in real-time?</p>\n\n<p>In other words, if I provide the user a mechanism to add a user defined column, associated data type and null requirements can that be done on the fly with EF and then remembered for all future sessions?</p>\n\n<p>It's out there but I think you all will see what I'm getting at.</p>\n\n<p>Brent</p>\n"},{"tags":[".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":11967952,"title":"Keep entity framework context open","body":"<p>I have a few sets of data that are used by all users on site. I would traditionally look at caching these.</p>\n\n<p>My current EF setup uses uow and repository patterns, so I tend to use context for a single transaction and dispose of it.</p>\n\n<p>I plan to introduce some user interaction, so the data that was once entirely static, won't be as users will be allowed to add, delete and perhaps edit. I estimate that data will still only be refreshed every 2 minutes or so still a reasonable candidate for caching.</p>\n\n<p>One option would be to keep with the cache idea, but retrieve and recache after each change. The biggest data sets will have around 5-10k rows.</p>\n\n<p>Another option I thought of would be to have a single context for each data set which I keep open (static) and manage the data that way. I'm pretty new to EF so I'm not sure whether this is a good or bad idea but on face value it seems similar to the way caching would work. The only thing I'm unsure of is how to deal with the additional table data as I believe you can't track and use Include().</p>\n\n<p>Anyone got advise on this?  </p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12497559,"title":"EF Code Migration - Migrating string to decimal field (v. 4.3.1.0)","body":"<p>I'm supporting an application in which we need to migrate the code first generated database.  The change is to modify three properties (all on the same table/entity) from a string to a nullable decimal.</p>\n\n<p>Part of the requirement of doing this is that I need to output the changes to a SQL file, since we a deploying the patch to our client, who is also hosting the product in production.</p>\n\n<p>I was told that this is possible but I am unsure how to do it.</p>\n\n<p>Question:  How can I, using EF code first, migrate the database table to have nullable decimals instead of strings and have the changes outputted to a SQL file.  I am making the assumption that all the values currently in the column are convertible to decimals, but if not how would that change the complexity?</p>\n"},{"tags":["c#","visual-studio-2010","visual-studio","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12468710,"title":"Creating a project data source from an entity framework model located in a seperate class project","body":"<p>I am having a very hard time trying to find an example of creating a project data source which points to an entity framework model that is located in a separate project. To be more specific I have a simple class project which only contains my entity framework model which I re-use in many projects with no problems. </p>\n\n<p>In a new project I would like to utilize some of the design time data binding facilities of a few commercial data bound controls to speed up some of my development tasks. If I go to add a new project data source, I can only generate a new EF model or add an empty model I cannot add an existing model from a seperate project. </p>\n\n<p>I have tried copying both the connection string and .datasource files from the EF class project but nothing shows up in the \"Data Sources\" window. I have seen many many articles on how to move the EF model to a seperate class project which works just fine, I just haven't found anything on creating the \"design time\" project datasource that points to it.</p>\n\n<p>Can anyone point me in the right direction please? Thank you very much in advance.</p>\n"},{"tags":["entity-framework","entity-framework-4","t4","texttransform"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":542,"score":4,"question_id":6449192,"title":"Text Transformations & Finding Entity Plural (Collection)","body":"<p>If I have a .tt template, I can use entity.Name to write out the name of an entity, e.g:</p>\n\n<pre><code>foreach (EntityType entity in ItemCollection.GetItems&lt;EntityType&gt;().OrderBy(e =&gt; e.Name))\n{;\n    WriteLine(entity.Name); \n}\n</code></pre>\n\n<p>Using normal transformations or T4, How do I write out the <em>actual</em> name of the entity set? (E.g. for Person, it might be Persons - but maybe I changed it to People in the designer, so I'd want that instead).</p>\n\n<p>Thanks!</p>\n\n<p>Richard</p>\n"},{"tags":["asp.net","sql-server","entity-framework","compatibility","entitydatasource"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12495130,"title":"Limitations of queries in CommandText property for EntityDataSource","body":"<p>I'm using <code>EntityDataSource</code> control in my ASP.NET application developed under Visual Studio 2012. It has a <code>CommandText</code> property which one can use to select the data for the control. While it is set as an SQL query, I often have the situation when a query executes well under SSMS, but fails for <code>EntityDataSource</code>. Here is the short list of limitations encountered this week:</p>\n\n<ul>\n<li>Cannot use <code>SELECT *</code>, need to specify fields explicitly</li>\n<li>Obligatory aliases for nested queries</li>\n<li>Cannot use some system functions, like <code>isnull</code></li>\n</ul>\n\n<p>Bottom line, I have two questions:</p>\n\n<ol>\n<li>How to get the full list of such limitations?</li>\n<li>What to use instead of the <code>isnull</code> function?</li>\n</ol>\n"},{"tags":[".net","entity-framework","ado.net-entity-data-model"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12495012,"title":"Using DbContext API instead of ObjectContext API with Entity Data Model","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/9176967/objectcontext-vs-dbcontext\">ObjectContext vs DbContext</a>  </p>\n</blockquote>\n\n\n\n<p>The author of this answer wrote that <a href=\"http://stackoverflow.com/a/12494339/1662812\">http://stackoverflow.com/a/12494339/1662812</a> \"Both T4 and DbContext API are currently recommended approach for using EF\"</p>\n\n<p>I still wonder what exactly is the difference between DbContext API and ObjectContext API when used with Entity Data Model and I am also looking for any reference about DbContext API being recommended approach for using EF.</p>\n"},{"tags":["wpf","entity-framework","mvvm","visual-studio-2012","ef-model-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12482934,"title":"Create Database Instance from Model","body":"<p>*Seems like there is some confusion.  I created a SQL Server Compact Edition file and can see it from the Server Explorer.  I can also right click and add tables manually.  What I want to do is run the generated sqlce file to add all of the tables and columns from my model to the SDF.  </p>\n\n<p>-- background --</p>\n\n<p>In Visual Studio 2012 (Ultimate), I designed a model using the model designer.  It created an edmx file.  I right clicked the model and chose \"Generate Database from Model...\" and created an sqlce file.  My understanding is that I should be able to execute this file on an sdf somehow to create a SQL Server Compact Edition Instance of my database.  I don't see the option on right click to execute the sql code, and the other option is to \"Run SQL Scripts in Solution Explorer\" which doesn't seem to make sense.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/yea4bc1b.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/yea4bc1b.aspx</a>  It says to drag the sqlce file to a database reference, but I'm not really sure what they mean.  I have tried to drag it to the server explorer where the sdf is connected.</p>\n\n<p>I tried right clicking on the sdf in the Server Explorer to do New SQL Query and pasting the sqlce in, but it seems that Create Table isn't supported.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["entity-framework","ef-migrations"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":11548959,"title":"Entity Framework Migrations: Including Go statement only in -Script output","body":"<p>As part of planning an Entity Framework migration, in order to debug data movement, I would often use the -Script parameter to generate the script.</p>\n\n<p>I could then take this script to Query Analyzer and wrap it in a transaction in order to test it manually.</p>\n\n<p>I came across a situation where we needed a Go statement to execute the script properly. The following code was added to the migration in order to output a Go in the proper place.</p>\n\n<pre><code>Sql(\"GO\");\n</code></pre>\n\n<p>This adds a GO statement in the proper position when -Script is used. But when -Script isn't used. I get the exception...</p>\n\n<pre><code>System.Data.SqlClient.SqlException (0x80131904): Could not find stored procedure 'GO'.\n</code></pre>\n\n<p>Is there a safe way to add a Go command to the script?</p>\n"},{"tags":[".net","entity-framework","visual-studio-2012","ado.net-entity-data-model","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":321,"score":1,"question_id":12493656,"title":"Using Entity Data Model in VS 2012","body":"<p>I have used Entity Data Model before with VS 2010, but now I am having trouble with VS 2012.\nFirst of all, now in 2012 Entity Data Model there are two new files with .tt extension. Also the Designer.cs file is empty and has a message how to enable the code generation, but when I do enable the code generation it says that the objects already exist. </p>\n\n<p>I am also missing the CreateObjectSet();</p>\n\n<pre><code> using (MyEntities entitiesContext = new MyEntities())\n            {\n                var entitySet = entitiesContext.CreateObjectSet&lt;T&gt;();\n\n            }\n</code></pre>\n\n<p>Not sure why, but now the entitiesContext doesn't have the .CreateObjectSet();</p>\n\n<p>I wonder if someone could clear up what is going on.</p>\n"},{"tags":["c#","linq","entity-framework","group-by","ef-code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":142,"score":3,"question_id":12470002,"title":"Getting Entity Framework to eager load on Group By","body":"<p>I know that changing the shape of a query causes Entity Framework to ignore the include calls but is there a way I can get it to load the sub properties when I do a select many and a group by. In the following example I want to notify all the employees who have a job booked in a certain time period. Calling .ToArray() after the where only hits the database once but I am doing the SelectMany and GroupBy in memory. Is there a way I can get the SelectMany and the GroupBy to happen on the SQL server and still include the ServiceType and Ship and the Employee details?</p>\n\n<p>I am looking for a way to make one SQL call to the database and end up with a list of Employees who have a job in the time period and the jobs they are assigned to.</p>\n\n<pre><code>var employeeJobs = DataContext.Jobs.\n    Include(\"ServiceType\").\n    Include(\"Ship\").\n    Include(\"JobEmployees.Employee\").\n    Where(j =&gt; j.Start &gt;= now &amp;&amp; j.Start &lt;= finish).\n    OrderBy(j =&gt; j.Start).\n    ToArray().\n    SelectMany(j =&gt; j.JobEmployees, (j, je) =&gt; new { \n        Job = j, \n        Employee = je.Employee \n    }).GroupBy(j =&gt; j.Employee);\n</code></pre>\n"},{"tags":["c#","entity-framework","entity"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":39,"score":3,"question_id":12493641,"title":"Entity with default filter on EF","body":"<p>I have an entity called Client on my .edmx file.</p>\n\n<p>I have to run several linq querys agains it but on all of them, i need a filter (lets say active=1).</p>\n\n<p>I dont want to have a <code>where c.active == 1</code> on all my queries, it makes more sense that my entity has a default filter applied. Is it something that can be done?</p>\n\n<p>Or maybe can I have a query as base to an entity instead of a table? (I'm on a database first approach)</p>\n\n<p>I know another solution would be to create a view on the DB and link the entity to the view, but I don't want that either.</p>\n"},{"tags":["sql-server","asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12493302,"title":"EF5 How to Add missing Relationships","body":"<p>Hi i have a database first EF5 model defined. \nMy user table has a primary key guid UserGUID \nand another key field UserID with an auto-incrementing integer. \nI have created a table called UserCustomField which has \nUserID and I have created a foreign key constraint to UserID in my User Table.</p>\n\n<p>When I update the model from the database all foreign key relationships to primary keys are generated but none to Key fields. Ignoring the potential point about using the guid through all my tables.....\nA/ shouldn't EF add this relationship?\nB/ how can i manually add it?</p>\n\n<p>Cheers\nTim</p>\n"},{"tags":[".net","entity-framework","entity-framework-4",".net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12492059,"title":"How functional is DbContext as an ObjectContext provider?","body":"<p>We have a large EF 4.0 data framework (based on <code>ObjectContext</code>, <code>EntitySet</code>, <code>EntityObject</code> and <code>ObjectStateManager</code>) which was developed with DB-first in mind. Given that one can obtain an <code>ObjectContext</code> from a <code>DbContext</code>, could we use our existing framework with a code-first <code>DbContext</code> just by using <code>IObjectContextAdapter</code>?   </p>\n\n<p>I know that <code>DbContext</code> uses POCOs (and not <code>EntityObject</code> descendants), but those POCOs are internally proxy objects of type <code>Proxy&lt;TPOCO&gt;</code>. Do those proxies inherit or provide access to underlying <code>EntityObject</code> and is there an underlying <code>EntityObject</code> at all?</p>\n"},{"tags":["c#","linq","entity-framework","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":270,"score":2,"question_id":3231766,"title":"How can I set custom property of an Entity type in LINQ to Entities query and still return a IQueryable<T>?","body":"<p>I have a EF4 model where I have Product entity that have one-to-many relation with Task entity (ChildTasks). I have to get some Projects from db based on some user criteria. The Project has one custom property (not associated with any column) named EstimatedProgress where I have to store additional information about Project - computed weighted average progress of each child task. The problem is that finally I can't return an IEnumerable<code>&lt;Project&gt;</code> but <strong>IQueryable<code>&lt;Project&gt;</code></strong>. The code below demonstrates what I want to achieve (I know it does not compile). </p>\n\n<pre><code>var q = from p in ObjectContext.ProjectSet.Include(\"ProjectBase\") \n        where p.ProjectBase.IsTemplate == false \n        from ct in p.ProjectBase.ChildTasks\n        where ct.Progress != null\n           &amp;&amp; ct.EstimatedTime != null\n        group ct by ct.prjProjectBase.Project into g\n        select new {\n            Project = g.Key,\n            EstimatedProgress = g.Sum(oo =&gt; oo.Progress.Value * oo.EstimatedTime.Value) \n                              / g.Sum(oo =&gt; oo.EstimatedTime.Value),\n        };\n\nvar sortedQ = q.OrderByDescending(o =&gt; o.Project.ProjectBase.Status)\n          .ThenBy(o =&gt; o.Project.ProjectBase.Name);\n\n// this is where I want to return IQueryable&lt;Project&gt; \n// where each project has set custom property EstimatedProgress\nreturn sortedQ.Select(o =&gt;\n{\n    o.Project.EstimatedTime = o.EstimatedProgress;\n    return o.Project;\n});\n</code></pre>\n\n<p>The question is: Is it possible to do something similiar with EF4 linq query or maybe some of you have a workaround ;) Thanks in advance.</p>\n"},{"tags":["c#",".net","database","entity-framework","sqlite"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":302,"score":0,"question_id":12350202,"title":"SQLite in VS 2012","body":"<p>Ok, spent too much time banging my head with this :)</p>\n\n<p>I need to persist small (under 1000) collection of items between sessions on windows without using full database server. Items are simple objects with dozen or so string properties.\nDatabase/collection/whatever should be stored in a single file that can be created through code in runtime.</p>\n\n<p>Started with SQL server CE then switched to SQLite but now I'm told Entity is a way to go.\nI don't mind learning Entity, but seems like too much of an overhead for a simple storage.</p>\n\n<p>What should I do? (if anyone still actually codes windows small databases)</p>\n\n<ol>\n<li>Ditch Entity and access SQLite directly through commands.</li>\n<li>Use Entity with SQLite (Would appreciate link on proper way to create databases at runtime tho)</li>\n<li>Ditch the whole concept of database (I put this one in because, before, every book had a chapter on databases, now I don't have a single book that mention it. Also not much new stuff on Internet either, so people might moved on to some other concept)</li>\n</ol>\n\n<p>Thanks.</p>\n"},{"tags":["c#","entity-framework","app-config","desktop-application"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12403398,"title":"Copied App.config to (Assembly).exe.config but from folder debug application doesn't run","body":"<p>Gives error: </p>\n\n<blockquote>\n  <p>The specified named connection is either not found in the\n  configuration, not intended to be used with the EntityClient provider,\n  or not valid</p>\n</blockquote>\n\n<p>App.config looks like and it's same as (Assembly.exe.config) config file for output:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;connectionStrings&gt;\n\n    &lt;add name=\"Entities1\" connectionString=\"metadata=res://*/;provider=System.Data.SqlClient;provider connection string='data source=localhost;initial catalog=DatabaseName;integrated security=True;multipleactiveresultsets=True;App=EntityFramework'\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>How to run exe with it's configuration file? I tried to change '' to quot but nothing has changed.</p>\n\n<p>UPD: \nApplication requires \"run as administrator\" but why?</p>\n"},{"tags":[".net","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12491963,"title":"Default value instead of getting \"A member of the type does not have a corresponding column in the data reader with the same name\" error","body":"<p>I am working with some versions of databases for the same .NET Code. </p>\n\n<p>is there an option to set a default value for specific entity framework property to be returned if there is no corresponding column in the database instead of getting the error: \"A member of the type does not have a corresponding column in the data reader with the same name\" ?</p>\n"},{"tags":["c#","winforms","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12490876,"title":"Updating database using listbox","body":"<p>I encountered a problem whereby my listbox cannot update data. I have 2 tables, timing and trolleyservice. The listbox reads and show the data from the timing table. both tables were linked. Whenever I update the time in the trolley service table, it prompt me this error:</p>\n\n<blockquote>\n  <p>The property 'TimingID' is part of the object's key information and cannot be modified.</p>\n</blockquote>\n\n<p>Can anyone help about this?</p>\n\n<pre><code>private void btnUpdateTS_Click(object sender, EventArgs e)\n    {\n\n        int ID = Int32.Parse(lblID.Text);\n        foreach (timing selectedTiming in lstTime.SelectedItems)\n        {\n            var EditTS = (from ets in db.trolleyservices\n                          where ets.idtrolleyservice == ID\n                          select ets).First();\n            EditTS.Type = txtType.Text;\n            EditTS.TimingID = selectedTiming.TimingID;\n\n            db.SaveChanges();\n            txtType.Text = \"\";\n        }\n   }\n</code></pre>\n"},{"tags":["entity-framework","sql-server-ce"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":183,"score":1,"question_id":12490190,"title":"EF 5 + SqlCe 4: How to specify custom location for database file?","body":"<p>I am developing a client system that needs a small local database.\nI want to avoid installation of SQL Express and have decided to go with SqlCe 4.</p>\n\n<p>I use EntityFramework 5 for data access and have created my custom context.\nEverything works fine in development where I can use app.config to either set specific file location or dynamic \"Data Source=|DataDirectory|\\MyDatabase.sdf\".</p>\n\n<p>But on deploy I want the database to be located in the users documents folder: \\My Documents\\ApplicationName\\MyDatabase.sdf</p>\n\n<p>How can I do that?</p>\n\n<p>All I need is actually to be able to set custom connection string in code!</p>\n\n<p>This is what I tried so far:</p>\n\n<pre><code>    private MyApplicationDataContext(string connectionString) : base(connectionString)\n    {\n    }\n\n    public static MyApplicationDataContext CreateInstance()\n    {\n        var directory = Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments);\n        var path = Path.Combine(directory, @\"ApplicationName\\MyDatabase.sdf\");\n\n        //var connectionString = string.Format(\"provider=System.Data.SqlServerCe.4.0;provider connection string=\\\"Data Source={0}\\\"\", path);\n        var connectionString = string.Format(\"Data Source={0}\", path);\n\n        return new MyApplicationDataContext(connectionString);\n    }\n</code></pre>\n\n<p>As you can see I tried two kinds of connection strings but both caused exceptions.</p>\n\n<p>The first one said: Keyword not supported: 'provider'.</p>\n\n<p>The second one: The provider did not return a ProviderManifestToken string.</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12481645,"title":"Updates on an entity object not firing before delete","body":"<p>So basically I'm trying to do this sequence of events in entity framework. </p>\n\n<ol>\n<li>Create a new account</li>\n<li>Get an existing account</li>\n<li>Move all the data from the old account to the new account (transactions, users, etc)</li>\n<li>Delete the old account</li>\n</ol>\n\n<p>I'm doing this all in 'one go', inside a single ObjectContext.</p>\n\n<p>It fails when I call SaveChanges on the context. I get an foreign key constraint error. </p>\n\n<p>I checked this in SQL profiler and it turns out that entity framework isn't sending any of the updates, just the selected and then a delete. </p>\n\n<p>I kinda understand WHY it is working like that but there must be some way to force it do work properly, without having to call SaveChanges() twice or something.</p>\n\n<p>Hopefully. </p>\n\n<hr>\n\n<p>My merge function basically looks like this</p>\n\n<pre><code>public void Merge(Account newAccount, Account oldAccount)\n{\n    // ...\n\n    foreach (var user in oldAccount.Users.ToList())\n    {\n        oldAccount.Users.Remove(user);\n        newAccount.Users.Add(user);\n    }\n\n    // ...\n\n    _unitOfWork.Accounts.Delete(oldAccount);\n}      \n</code></pre>\n\n<p>The objects are POCO objects created by the E.F.4 POCO Entity Generator. To avoid pasting the entire class here's just one of the association properties with it's 'fixup' function. </p>\n\n<pre><code>public virtual ICollection&lt;User&gt; Users\n{\n    get\n    {\n        if (_users == null)\n        {\n            var newCollection = new FixupCollection&lt;User&gt;();\n            newCollection.CollectionChanged += FixupUsers;\n            _users = newCollection;\n        }\n        return _users;\n    }\n    set\n    {\n        if (!ReferenceEquals(_users, value))\n        {\n            var previousValue = _users as FixupCollection&lt;User&gt;;\n            if (previousValue != null)\n            {\n                previousValue.CollectionChanged -= FixupUsers;\n            }\n            _users = value;\n            var newValue = value as FixupCollection&lt;User&gt;;\n            if (newValue != null)\n            {\n                newValue.CollectionChanged += FixupUsers;\n            }\n        }\n    }\n}   \n\nprivate void FixupUsers(object sender, NotifyCollectionChangedEventArgs e)\n{\n    if (e.NewItems != null)\n    {\n        foreach (User item in e.NewItems)\n        {\n            item.Account = this;\n        }\n    }\n\n    if (e.OldItems != null)\n    {\n        foreach (User item in e.OldItems)\n        {\n            if (ReferenceEquals(item.Account, this))\n            {\n                item.Account = null;\n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc-3","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12484143,"title":"How to prevent user from modifying some fields on the form?","body":"<p>I am using MVC3 and EF4 to write a web application. I am using an action header like below to capture the form values submitted by the user.</p>\n\n<pre><code>&lt;HttpPost()&gt;\nPublic Function Edit(ByVal prod as Product) As ActionResult\n</code></pre>\n\n<p>I use the below code for updating the record.</p>\n\n<pre><code>db.Attach(prod)\ndb.ObjectStateManager.ChangeObjectState(prod, EntityState.Modified)\ndb.SaveChanges()\n</code></pre>\n\n<p>I get the submitted values in prod object which I update in the database. The problem is that there are some users who are not allowed to modify certain fields in a Product, say ProductCost. I have disabled the textboxes for such fields in the HTML. But since it is clientside, the user can easily enable it using some tool like Firebug and modify the value.</p>\n\n<p>The only solution I could come up was to retrieve the existing record from the database and copy its ProductCost value into prod.ProductCost. But I don't like firing a query for achieving this. Is there a better way to achieve this?</p>\n\n<p><strong>Edit</strong>: I found the below link to update particular fields. <a href=\"http://stackoverflow.com/questions/3642371/how-to-update-only-one-field-using-entity-framework\">How to update only one field using Entity Framework?</a></p>\n\n<p>You can use the below code to modify a particular field.</p>\n\n<pre><code>context.ObjectStateManager.GetObjectStateEntry(user).SetModifiedProperty(\"FieldName\");\n</code></pre>\n\n<p>Now the question is do I have to write the above statement for every field the user is able to modify? If yes, suppose the Product model has 10 fields (1 primary key) and the user is allowed to modify all of them except the primary key, I need to write 9 statements?? Is there a method where you can specify multiple properties at once. Or even better something where you specify the properties which are not modified. (Note: I know I can run a loop over an array of field names to avoid writing 9 statements. I am asking for an alternative method and not refactoring the above)</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12489878,"title":"How to make EF Code First load \"ICollection\" properties, when calling DBSet<T>.Find(id)","body":"<p>When I'm searching for a \"list\" like this  <code>DbSet&lt;T&gt;.Where(predicate)</code> I Can Add <code>.Include(\"xxx\")</code> but that doesn't apply for a single object. </p>\n\n<p>I can't figure out how to make EF load <code>virtual</code> <code>Icollection&lt;T&gt;</code> properties, when calling <code>DbSet&lt;T&gt;.Find(id)</code></p>\n"},{"tags":["entity-framework","ef-code-first","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12489363,"title":"EF Code First Integer Discriminator Column","body":"<p>According to this source</p>\n\n<p><a href=\"http://weblogs.asp.net/manavi/archive/2010/12/24/inheritance-mapping-strategies-with-entity-framework-code-first-ctp5-part-1-table-per-hierarchy-tph.aspx\" rel=\"nofollow\">http://weblogs.asp.net/manavi/archive/2010/12/24/inheritance-mapping-strategies-with-entity-framework-code-first-ctp5-part-1-table-per-hierarchy-tph.aspx</a></p>\n\n<p>it should be possible to have the TPH discriminator column be an integer:</p>\n\n<blockquote>\n  <p>Also, changing the data type of discriminator column is interesting.\n  In the above code, we passed strings to HasValue method but this\n  method has been defined to accepts a type of object:</p>\n  \n  <p>public void HasValue(object value);</p>\n  \n  <p>Therefore, if for example we pass a value of type int to it then Code\n  First not only use our desired values (i.e. 1 &amp; 2) in the\n  discriminator column but also <strong>changes the column type to be (INT, NOT\n  NULL)</strong>:</p>\n  \n  <p>modelBuilder.Entity()\n              .Map(m => m.Requires(\"BillingDetailType\").HasValue(1))\n              .Map(m => m.Requires(\"BillingDetailType\").HasValue(2));</p>\n</blockquote>\n\n<p>However, when I do that in my code I see discriminator values like \"1\" and \"2\", but the column type is still </p>\n\n<blockquote>\n  <p>nvarchar(128), not null</p>\n</blockquote>\n\n<p>Is it in fact possible to specify an integer discriminator column?  If so, how?</p>\n\n<p>I'm certain that I specify my mapping as <em>.HasValue(1)</em> and not <em>.HasValue(\"1\")</em>.</p>\n"},{"tags":["c#",".net","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12488347,"title":"linq group data","body":"<p>raw data:</p>\n\n<pre><code>StrDateTime ServerName \n9/15/2012 3:01:19 PM 'srvr1'\n9/15/2012 3:01:19 PM 'srvr2'\n9/15/2012 3:01:19 PM 'srvr33'\n9/15/2012 3:02:15 PM 'srvr1'\n9/15/2012 3:02:15 PM 'srvr5'\n</code></pre>\n\n<p>my code(<code>not work</code>):</p>\n\n<pre><code>(from data in dataInToday\ngroup data by data.StrDateTime into grp\nlet srvrs = (from i in grp select i.ServerName).ToString()\nselect new\n{ \n    grp.Key,\n    srvrs\n}).Take(20).Dump();\n</code></pre>\n\n<p>expected output:</p>\n\n<pre><code>Key srvrs \n9/15/2012 3:01:19 PM 'srvr1, srvr2, srvr33'\n9/15/2012 3:02:15 PM 'srvr1, srvr5'\n9/15/2012 3:02:43 PM 'srvr1, srvr2'\n9/15/2012 3:03:19 PM 'srvr9, srvr2'\n9/15/2012 3:04:19 PM 'srvr5, srvr11'\n9/15/2012 3:05:19 PM 'srvr1, srvr2'\n</code></pre>\n\n<p>is there a linq function can implement it</p>\n"},{"tags":["asp.net","linq","mvc","entity-framework"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":964,"score":1,"question_id":5224734,"title":"ASP.NET MVC and Entity Framework. How to avoid duplicate rows?","body":"<p>So I'm new to ASP.NET MVC and I'm trying to implement an address manager.I'm using Linq2Entity Framework. I've got a table with contacts and one with phone numbers. These two tables are linked by a contact_has_phone_number table. The Entity Framework enables me to get all phone numbers that are assigned to one contact. This is done by calling contact.PhoneNumbers which returns a collection of phone numbers. A new number is added with contact.PhoneNumber.Add(number). The Problem is that I am getting duplicate phone number entries in the phone number table. What I would like to get is that an existing phone number only gets linked in the contact_has_phone_number table. \nFor Example:</p>\n\n<p>Table \"contact\"  </p>\n\n<pre><code>ID_Contact  | First_Name |  Last_Name  \n1           |   Jeff     |    Bridges  \n2           |   Peter    |    Miller  \n</code></pre>\n\n<p>Table \"contact_has_phone_number\"  </p>\n\n<pre><code>ID_Contact  | ID_Number  \n1           |    1  \n1           |    2  \n2           |    1  \n</code></pre>\n\n<p>Table \"phone_number\"  </p>\n\n<pre><code>ID_Number  | Number  \n1          | 1234567  \n2          | 7654321  \n</code></pre>\n\n<p>At the momonet I would get 3 rows in the \"phone_number\" table with 2 rows with identical numbers.</p>\n\n<pre><code>ID_Number  | Number  \n1          | 1234567  \n2          | 7654321  \n3          | 1234567  \n</code></pre>\n\n<p>Would be a blast if you could help me with this.</p>\n"},{"tags":["c#","entity-framework","asp.net-mvc-4"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12484996,"title":"How to update using Entity Framwork by passing in object","body":"<p>How do I update using Entity Framework?  I'm passing in the object with the updated values, but I don't see an Update method. </p>\n\n<pre><code>   public void UpdateRecipient(Domain.Entities.RecipientEntity recipient)\n    {\n        using (EfDbContext context = CreateEfDbContext(recipient.ApplicationId.ToString()))\n        {\n\n            context.Recipients. //?? I don't see an update method\n            context.SaveChanges();\n\n        }\n    }\n</code></pre>\n"},{"tags":["entity-framework","entity-framework-4","t4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12486732,"title":"Static creates when migrating from EF4 to EF5","body":"<p>I'm moving a large project from EF4 to EF5.. The project makes heavy use of the static Create functions and I'd rather not edit all 5,000 references.. Is it possible to have EF5 create these functions? I suspect I can just hack up the T4 template somehow, but if anyone has a better way, or a sample of the T4 change, I'd appreciate a pointer!</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12484987,"title":"The underlying provider failed on Open","body":"<p>I made 3 Ajax processes to run the below code at the same time.\nbut one of the processes throw exception that message says <em>\"The underlying provider failed on Open.\"</em></p>\n\n<pre><code>try{\n    orderRepository orderRepo = new orderRepository(); // get context (Mysql)\n\n    var result = (from x in orderRepo.orders\n          where x.orderid == orderno\n          select new {x.tracking, x.status, x.charged }).SingleOrDefault();\n\n    charged = result.charged;\n}catch(Exception e){\n    log.Error(e.Message); //    The underlying provider failed on Open.\n} \n</code></pre>\n\n<p>And, I run the 1 Ajax call that failed before, then It passes through.</p>\n\n<p>It happen to 1 of 3 (Ajax) process, sometimes, 2 of 5 process. </p>\n\n<p>I guess it because all process try to using Database same time. but I couldn't find the solution.</p>\n\n<p>This is my connection string,</p>\n\n<pre><code>&lt;add name=\"EFMysqlContext\" connectionString=\"server=10.0.0.10;User Id=root;pwd=xxxx;Persist Security Info=True;database=shop_db\" providerName=\"Mysql.Data.MySqlClient\" /&gt;\n</code></pre>\n\n<p>Anybody know the solution or something I can try, please advise me.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","unity","idisposable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12484910,"title":"How to use Unity and recreate ObjectContext every request","body":"<p>I have some problem with IoC - Unity.</p>\n\n<p>I made a simple web app. It consists of one Table \"Post\" which have three fields: PostId, title, Text. I use generic repository:</p>\n\n<pre><code>    public abstract class BaseRepository&lt;T&gt; : IBaseRepository&lt;T&gt; where T : class\n    {\n        protected ObjectContext db = new BlogDbEntities();\n\n        /* CRUD */\n    }\n\n    public class PostRepository : BaseRepository&lt;Post&gt;, IPostRepository\n    {\n        public void Search(Expression&lt;Func&lt;Post, object&gt;&gt; predicate) \n        {\n          /* some search specific entity logic */   \n        }\n    }\n\n    public interface IPostRepository : IBaseRepository&lt;Post&gt;\n    {\n        void Search(Expression&lt;Func&lt;Post, object&gt;&gt; predicate);\n    }\n</code></pre>\n\n<p>int that repository as you see i create new BlogDbEntities - ObjectContext.\nAnd in controller i use IPostRepository, controller is very simple:</p>\n\n<pre><code>public class PostController : Controller\n    {\n\n        IPostRepository postRepository;\n\n        public PostController(IPostRepository postRepository) \n        {\n            this.postRepository = postRepository;\n        }\n\n\n        public ActionResult Index()\n        {\n            postRepository.All.ToList();\n            return View();\n        }\n\n\n        protected override void Dispose(bool disposing)\n        {\n            postRepository.Dispose();\n            base.Dispose(disposing);\n        }\n\n    }\n</code></pre>\n\n<p>And in Global.asax i resolve dependencies with Unity:</p>\n\n<pre><code> var container = new UnityContainer();\n            var controllerFactory = new UnityControllerFactory(container);\n            ControllerBuilder.Current.SetControllerFactory(controllerFactory);\n            container.RegisterType&lt;IPostRepository, PostRepository&gt;(new ContainerControlledLifetimeManager());\n</code></pre>\n\n<p>After starting application when i do request for example /Post/  first request executed normally. But when i try to execute request again i get Exception <strong>\"The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.\"</strong></p>\n\n<p>When i try to execute request without Unity IoC framework exception not displayed and ObjectContext work normally.</p>\n\n<p><strong>I guess that cause of that behavior is Unity, i think that context stored in Unity Container. Who can help me how to properly configure Unity with recreating context after each request.</strong></p>\n"},{"tags":["c#","mysql","winforms","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":12469423,"title":"Calling a method from another Form in C#","body":"<p>I want that when I insert or update records in another form (<code>Form2</code>), the <code>DataGridView</code> on <code>Form1</code> should automatically refresh (call <code>btnRefresh</code>) after each operation or <em>preferably</em> wait until all change operations have finished, and update the <code>DataGridView</code> form <code>Form2</code>'s closing event with all changes. </p>\n\n<p>I believe in VB.NET this is achieved with <code>Form1.DataGridView.Refresh</code>, but I am not sure in C#. I was told that I pass the reference of the <code>DataGridView</code> on <code>Form1</code> to <code>Form2</code> using properties but since I'm new to C#, I didn't know how to. How can I resolve this issue?</p>\n\n<p>My refresh button code:</p>\n\n<pre><code>private void btnRefresh_Click(object sender, EventArgs e)\n{\n    GVThesis.DataSource = thesisRepository.GetThesis();\n    GVThesis.Refresh();\n}\n</code></pre>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":12478232,"title":"What happens if the ObjectContext.Refresh method cannot connect to your SQL server to perform a refresh if your SQL server is no longer reachable?","body":"<p>I am using Entity Framework and am wondering what happens if the ObjectContext.Refresh method cannot connect to your SQL server to perform a refresh if your SQL server is no longer reachable.</p>\n\n<p>This MSDN article does not, as far as I can tell, show any related exceptions for this method: <a href=\"http://msdn.microsoft.com/en-us/library/bb896255%28v=vs.90%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb896255(v=vs.90).aspx</a></p>\n\n<p>So what actually happens in this scenario? In my specific case I am trying to refresh an entity data model accessor table: <code>_entities.Refresh(System.Data.Objects.RefreshMode.StoreWins, _entities.ProfilesTable);</code></p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":149,"score":1,"question_id":12451011,"title":"External Enums in EF5","body":"<p>Im new to Entity framework 5 and Im trying the enum support but Im having some problems with it. Im using EF5 as I used the previous versions, this is to create the database and generate the model from the database and use code generation. So, I change the code generation property of the model to \"default\" and I remove the .tt files. </p>\n\n<p>I have a solution with multiple dlls, one of them has the DataModel (edmx) and another one has an enum called \"EnumGender\" which has 2 values: male and female.</p>\n\n<p>In the db I have a table Users which has a field called \"Gender\" (smallint) and im trying to use the \"EnumGender\" for it.</p>\n\n<p>EnumGender is in a namespace called \"Sample.Datatypes.Enums\", so in the edmx model browser im trying to add a Enum. For this I set \"EnumGender\" as the name, I didnt add any value and I checked the checkbox \"Reference external type\" and I entered \"Sample.Datatypes.Enums.EnumGender\" in the textbox. </p>\n\n<p>The problem is that it seems that EF is creating a new enum in the data model namespace, which I dont want, I would like to use EnumGender in the \"Sample.Datatypes.Enums\" namespace. Also the new enum that the EF creates has no values... If I enter to the datamodel cs file (the code generated) this is what it added:</p>\n\n<pre><code>/// &lt;summary&gt;\n/// No Metadata Documentation available.\n/// &lt;/summary&gt;\n[EdmEnumTypeAttribute(NamespaceName=\"SampleModel\", Name=\"EnumGender\")]\n[DataContractAttribute()]\npublic enum EnumGender : short\n{\n}\n</code></pre>\n\n<p>I have no clue of what is happening... maybe I cant use a datatype from an external dll... But for what I read about the enums support I should be able to do this... </p>\n\n<p>I would really appreciate it if you can help me with this issue.</p>\n\n<p>Thanks!\nJuan</p>\n"},{"tags":["winforms","entity-framework","form-validation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12483606,"title":"Winforms User Input Validation","body":"<p>Most of my work is SQL database driven desktop apps using winforms.  I'm now using Entity Framework - Code First with the typical Program (UI), Model and DataAccess layers.  I've always done data validation at the UI level using the errorprovider.  With Entity Framework I could now do some validation like required entry on the entity.  I would still have to do some validation at the UI level.  Question 1: Is splitting the validation like this OK or not advised? Question 2: Should I do form validation in each forms class or have a separate validation class used by all forms?</p>\n"},{"tags":["entity-framework","database-first"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12468351,"title":"EF4 db-first: how to add missing relationships","body":"<p>I am using db-first to creating object model for a readonly database, but some relationships are not automatically picked up. For example in Foo.BarId is not automatically connected to  Bar object. If I click on BarId property, I don't see anything to associate it to a Bar in the context menu or properties window. How can I manually claim foreign keys without messing up anything?</p>\n"},{"tags":["c#","entity-framework","t4",".net-4.5","edmx"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12483454,"title":"Removing underscores from model classes","body":"<p>I have a database with tables that contain underscore in their name. I want to have them removed from the classes that are generated when I create a model. I was able to achieve it by customizing the t4 templates but the names should also be modified in the edmx file. Is there any way to customize the edmx generation?</p>\n"},{"tags":["c#","linq","entity-framework","ado.net","linq-to-entities"],"answer_count":5,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":1771,"score":7,"question_id":662873,"title":"How to load varbinary(max) fields only when necessary with ADO.NET Entity Framework?","body":"<p>I have a varbinary(max) field in one of my tables but I don't need it every time and I'm looking for a way to fetch it from the database only when necessary. I'm using ADO.NET Entity Framework. How to do that?</p>\n"},{"tags":["asp.net-mvc","entity-framework","unit-of-work"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12482982,"title":"Entity Framework as UnitOfWork/Repository?","body":"<p>I'm in the process of learning Entity Framework/MVC 4, and started following some tutorials on creating Repositories and abstracting away EF.</p>\n\n<p>What I've noticed is that EF seems to already be a UnitOfWork/Repository pattern.</p>\n\n<p>I tried creating custom DbSets by using <code>DbSet&lt;TEntity&gt;</code> as a base class, but couldn't get it to work because of the following exception: <code>The type 'System.Data.Entity.DbSet&lt;TEntity&gt;' has no constructors defined</code>.</p>\n\n<p>Here's what I'm attempting to do:</p>\n\n<pre><code>public class RolesDbSet : DbSet&lt;Role&gt;\n{\n    public bool IsNameInUse(string name, int id = 0)\n    {\n        if (id == 0)\n            return this.Any(r =&gt; r.Name == name);\n        return this.Any(r =&gt; r.Name == name &amp;&amp; r.ID != id);\n    }\n}\n\npublic class MyEntities : DbContext\n{\n    public MyEntities() : base(\"MyEntities\")\n    {\n        Database.SetInitializer(new MyDevelopmentInitializer());\n    }       \n\n    public RolesDbSet Roles { get; set; }\n    public DbSet&lt;User&gt; Users { get; set; }\n    public DbSet&lt;Password&gt; Passwords { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Configurations.Add(new UserConfiguration());\n        base.OnModelCreating(modelBuilder);\n    }\n}\n</code></pre>\n\n<p>Then I would be able do do this:</p>\n\n<pre><code>bool inUse;\nusing (var db = new MyEntities())\n{\n    inUse = db.Roles.IsNameInUse(\"Employee\");\n}\n</code></pre>\n\n<p>Is there a way to accomplish this?</p>\n"},{"tags":["c#","sql","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":12481530,"title":"Issue with relational tables in Entity Framework","body":"<p>I have a one-to-many relationship of <strong>order</strong> to <strong>payment</strong>:</p>\n\n<pre><code>public class Order\n{\n    [Key]\n    public Guid SerialNumber { get; set; }\n\n    public string OrderNumber { get; set; }\n\n    ...\n\n    [ForeignKey(\"OrderNumber\")]\n    public virtual ICollection&lt;Payment&gt; Payments { get; set; }\n}\n\npublic class Payment\n{\n    [Key]\n    public string SerialNumber { get; set; }\n\n    public string OrderNumber { get; set; }\n\n    ...\n\n    public decimal Amount { get; set; }\n}\n</code></pre>\n\n<p>Despite the records being available, the Payments collection always shows 0 elements. I've looked at the trace and the problem seems to be with the generated SQL query - it's trying to match Order.SerialNumber to Payment.OrderNumber.</p>\n\n<p>How can I resolve this, preferably with data annotations? Thanks in advance!</p>\n"},{"tags":["sql","asp.net-mvc","entity-framework","asp.net-membership"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":159,"score":2,"question_id":12449126,"title":"Asp.net MVC + Membership + Code-First + Existing Database","body":"<p>After lot of research and attempts I failed, here is the situation :</p>\n\n<p>Technologies</p>\n\n<ul>\n<li>Asp.Net MVC4</li>\n<li>Entity Framework Code First</li>\n<li>SQL Server 2008</li>\n</ul>\n\n<p>I used Code First to create my domain classes, example :</p>\n\n<pre><code>public class Country{\n   public int IdCountry {get;set;}\n   public int NameCountry {get;set;}\n}\npublic class Sex{\n   public int IdSex {get;set;}\n   public int NameSex{get;set;}\n}\n</code></pre>\n\n<p>etc... I have like 20 classes</p>\n\n<p>All I want is :</p>\n\n<p>Use the Asp.Net Membership system, and plug it to my classes. I have a domain class called UserProfile</p>\n\n<pre><code>public class UserProfile{\n   public int IdUserProfile {get;set;}\n   public virtual Sex sex {get;set;}\n   public virtual Country country {get;set;}\n   public virtual ICollection&lt;Photos&gt; photos {get;set;}\n   etc...\n}\n</code></pre>\n\n<p>I want to be able to connect all this with the Asp.Net User registered via Asp.Net Membership and the AccountController</p>\n\n<p>I search in stackoverflow, codeplex etc.. and I dont find a solution for that or perhaps I did not understand. </p>\n\n<p>I hope someone have achieved this in real world application :)</p>\n\n<p>ps : I am working on a \"dating\" Website</p>\n"},{"tags":["c#","winforms","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12468100,"title":"EF 5, How to add one parent data with two child data?","body":"<p>Actually now, I am able to do it but I am looking for a simpler way that does the same.\nthist is how I do it:</p>\n\n<pre><code>Kolon kopyalanacakkolon = ctx.Kolons.First(i =&gt; i.KolonID == id);\n\nKolon yenikolon = new Kolon { KolonAdi = textBox9.Text, En = kopyalanacakkolon.En, Boy = kopyalanacakkolon.Boy, Yukseklik = kopyalanacakkolon.Yukseklik, KatID = kopyalanacakkolon.KatID };\n\nint b = kopyalanacakkolon.Kolonminhas.Count(i =&gt; i.KolonID == id);\nfor (int t = 0; t &lt; b; t++)\n{\n    Kolonminha yeniminha = kopyalanacakkolon.Kolonminhas.Skip(t).First();\n    yenikolon.Kolonminhas.Add(yeniminha);\n}\nctx.Kolons.Add(yenikolon);\nctx.SaveChanges();\n</code></pre>\n\n<p>First thing came to my mind was that: </p>\n\n<pre><code>Kolon kopyalanacakkolon = ctx.Kolons.First(i =&gt; i.KolonID == id);\nKolon yenikolon = new Kolon { KolonAdi = textBox9.Text, En =kopyalanacakkolon.En, Boy = kopyalanacakkolon.Boy, Yukseklik = kopyalanacakkolon.Yukseklik, KatID = kopyalanacakkolon.KatID };\nyenikolon.Kolonminhas = kopyalanacakkolon.Kolonminhas\nctx.Kolons.Add(yenikolon);\nctx.SaveChanges();\n</code></pre>\n\n<p>But this just doesn't work.</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12480155,"title":"How can i display the first element of a navigation property collection in my asp.net listview (Using Entity Framework)?","body":"<p>I am using a listview to display a list of all the users of my site. A user can upload multiple images, so when i generated my model with entity framework, 2 entities were created: Users and Images. User had a navigation property to a collection of images and Images had a navigation property to a single user.</p>\n\n<p>I am now trying to display in my listview 1 of the images uploaded by the user (if he has uploaded any).It doesn't matter which one is being displayed. </p>\n\n<p>I created an EntityDataSource, and i've added \"Images\" into it's include property. Then, i branched my listview to the datasource. usually, to display the content of the navigation property, i use something like </p>\n\n<pre><code>&lt;asp:Label ID=\"fn\" runat=\"server\" Text='&lt;%# Eval(\"Users.Firstname\") %&gt;' /&gt;\n</code></pre>\n\n<p>However, since it's column of a collection that i'm trying to display,can i use something like this? IF so, what would be a propper way to manage the case where the user didn't upload any image?</p>\n\n<p><code>&lt;asp:image ID=\"img\" runat=\"server\" ImageUrl='&lt;%# Eval(\"Images[0].path\") %&gt;' AlternateText=\"\" /&gt;</code></p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12480758,"title":"EF5 DB first- when creating a context object getting error that there is no key on a table but there is","body":"<p>I have an existing table that I have brought to the designer surface (EDMX). \nWhen I go to Add a Code Generation object and choose EF 5.x Self-tracking entity I get an error that there is no ket defined on the table even though there is as a simple identity field inthe actual table. The key also shows in the designer and is marked as an entity key in the properties.</p>\n\n<p>The only thing I can think of is the name of the field may be causing the problem. (\"UniqID\")</p>\n\n<p>Any ideas?\nTIA J</p>\n\n<p>This is the create script of the table in question</p>\n\n<pre><code>CREATE TABLE [MySchema].[ActivityStaging](\n[UnqID] [int] IDENTITY(1,1) NOT NULL,\n[SEQN] [nvarchar](10) NULL,\n[SFDCID] [nvarchar](32) NOT NULL,\n[IMISID] [nvarchar](10) NULL,\n[RELATEDTOIMISID] [nvarchar](10) NULL,\n[ASSIGNEDTO] [nvarchar](40) NULL,\n[ACTIVITYTYPE] [nvarchar](40) NOT NULL,\n[SUBJECT] [nvarchar](80) NOT NULL,\n[ACTIVITYDATE] [datetime] NOT NULL\n CONSTRAINT [PK_ActivityStaging] PRIMARY KEY CLUSTERED \n(\n[UnqID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]\nGO\n</code></pre>\n"},{"tags":["c#","linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12480689,"title":"Linq multiple join if exits","body":"<p>I'm strugling to implement this code. If anyone help, will be really appreciated.</p>\n\n<pre><code>var result = (from fv in db.UsFavourites.Where(m =&gt; m.UserID == currentUserId)\n                      join ad in db.CtArticleDetails.Where(m =&gt; m.ArticleStatusId == ConfigHelper.Published) on fv.ArticleReferenceID equals ad.ArticleReference\n                      join pcs in db.PcPages.Where(m =&gt; m.Status == ConfigHelper.Published) on fv.PageReferenceID equals pcs.Reference\n                      join prd in db.PrProducts.Where(m =&gt; m.ProductStatusID == ConfigHelper.Published) on fv.ProductReferenceID equals prd.ProductReference\n                      select new FavouriteModel\n                      {\n                          FavouriteId = fv.FavouriteID,\n                          Title = ad.Title ?? pcs.PageName ?? prd.Name,\n                          Url = ad.Title ?? pcs.PageName ?? prd.Name,\n                          ArticleReferenceID = (int)fv.ArticleReferenceID,\n                          PageReferenceID = (int)fv.PageReferenceID,\n                          ProductReferenceID = (int)fv.ProductReferenceID\n                      });\n</code></pre>\n\n<p>Basically, I'm trying to join 3 tables as you see: ad, pcs, prd.   If Pcs is not existed, the code should ignore.  Can anyone advice ?</p>\n\n<p>Added db design to make clear : \n<img src=\"http://i.stack.imgur.com/6zYia.png\" alt=\"enter image description here\"></p>\n"},{"tags":["asp.net-mvc-3","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2053,"score":1,"question_id":7206273,"title":"Disabling identity (auto-incrementing) on integer primary key using code first","body":"<p>I am using code first approach in a ASP.NET MVC 3 application and all integer primary keys in models (<code>public int Id { get; set; }</code>) are by default configured as an identity with auto-incrementing. How to disable this and enable a way to manually enter the integer for the primary key?</p>\n\n<p>The actual situation is that the <code>Id</code> integers have a special meaning and I would therefore like to have them choosable at creation and later editable. It would be ideal if in case the integer is not given at creation time it is auto-incremented, else the specified value is used. But editable primary fields is my primary need. Is there any way to do this elegantly in ASP.NET MVC 3?</p>\n"},{"tags":["visual-studio","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12479975,"title":"EF Power Tools Beta 2 Generate Views gives error: \"a constructible type deriving from dbcontext could not be found in the selected file\"","body":"<p>I get this error when running Generate Views for a file that contains 1 class:</p>\n\n<pre><code>public class MyDbContext : DbContext {\n    public MyDbContext() { ... }\n\n    public MyDbContext(string connectionString) { ... }\n\n    // more constructors\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder) { ... }\n}\n</code></pre>\n\n<p>I am using EF 4.3.1.0, VS 10, and Entity Framework Power Tools Beta 2 0.6.0.0. This is my first time installing these tools, so I don't think it's the issue mentioned <a href=\"http://blogs.msdn.com/b/adonet/archive/2012/04/09/ef-power-tools-beta-2-available.aspx\" rel=\"nofollow\">here</a>.</p>\n\n<p>How can I get around this issue and generate precompiled views for my DbContext?</p>\n"},{"tags":["sql-server","visual-studio","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12358305,"title":"Newbie: How to execute MyData.edmx.sql","body":"<p>I've created a simple Entity Framework model-first app in VS 2012 by creating an MVC 4 project and adding a single data entity using the designer.</p>\n\n<p>The first time I right-click the designer surface and select Generate Database it prompts me for the particulars of my database connection.  I tell it to use a local database file in my App_data folder.  When it's done, it has created my (empty) database file, and it presents me with a shiny new MyData.edmx.sql file.</p>\n\n<p>Ok, so I assume that I need to execute this sql file against my new database file.  But I can't figure out the magic to do so.  When I right-click the sql file and select Execute, it tells me that I'm using a server type of Database Engine, and it asks me for a Server Name.  The only available option seems to be MyPC\\SQLEXPRESS.  But when I select that and click on the Connect button, it complains that the the [MyData] database doesn't exist (because I've  told it to use SQL Express and not LocalDb with my database file).</p>\n\n<p>HELP.  How do I wire up VS to my new database file?</p>\n\n<p>Bob</p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":678,"score":0,"question_id":6395204,"title":"Updating multiple objects in single transaction in entity framework","body":"<p>I'm adding a set of objects using entity framework in single context but want to be in a transaction. How I can do that?</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12477968,"title":"Lazy loading, change tracking, virtual keyword and primary key properties","body":"<p>Should I add the virtual keyword to my primary key properties?</p>\n\n<p>After reading about lazy loading, change tracking and the virtual keyword, I realized that I pretty much should have all my properties marked virtual. I am not so sure about my ID properties though, as it makes no sense to load an entity without ID, it would only serve the purpose of more efficient change tracking.</p>\n"},{"tags":["c#","asp.net-mvc-3","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12472714,"title":"Map tables relationship w/ only primary keys from existing database to entity framework objects","body":"<p>I have the following tables in a legacy database.</p>\n\n<p><strong>data</strong>\ndataid PK,\nyear,\nnumber</p>\n\n<p><strong>data_1</strong>\ndataid PK,\nnote_1,\ncompleted</p>\n\n<p><strong>data_2</strong>\ndataid PK,\nnote_2,\ntype,\nobject</p>\n\n<p><strong>data_other</strong>\ndataid PK,\nnote_other,\na,\nb,\nc</p>\n\n<p>My model classes looks like;\n</p>\n\n<pre><code>public class Data\n{\n    public int DataID { get; set; }\n    public int Year { get; set; }\n    public int Number { get; set; }\n}\n\npublic class Data1\n{\n    public int DataID { get; set; }\n    public int Note1{ get; set; }\n    public int Completed { get; set; }\n}\n\npublic class Data1\n{\n    public int DataID { get; set; }\n    public int Note2 { get; set; }\n    public string Type { get; set; }\n    public string Object { get; set; }\n}\n\npublic class DataOther\n{\n    public int DataID { get; set; }\n    public int NoteOther { get; set; }\n    public string A { get; set; }\n    public string B { get; set; }\n    public string C { get; set; }\n}\n</code></pre>\n\n<pre class=\"lang-C# prettyprint-override\"><code>    public DbSet&lt;Data&gt; Datas { get; set; }\n    public DbSet&lt;Data1&gt; Data1s { get; set; }\n    public DbSet&lt;Data2&gt; Data2s { get; set; }\n    public DbSet&lt;DataOther&gt; DataOthers { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n            modelBuilder.Entity&lt;Data&gt;().ToTable(\"data\");\n            modelBuilder.Entity&lt;Data&gt;().HasKey(t =&gt; t.DataID);\n\n            modelBuilder.Entity&lt;Data1&gt;().ToTable(\"data_1\");\n            modelBuilder.Entity&lt;Data1&gt;().HasKey(t =&gt; t.DataID);\n\n            modelBuilder.Entity&lt;Data2&gt;().ToTable(\"data_2\");\n            modelBuilder.Entity&lt;Data2&gt;().HasKey(t =&gt; t.DataID);\n\n            modelBuilder.Entity&lt;DataOther&gt;().ToTable(\"data_other\");\n            modelBuilder.Entity&lt;DataOther&gt;().HasKey(t =&gt; t.DataID);\n    }\n</code></pre>\n\n<p>I have tried different solutions from tutorials and blogs but I cant seem to make it happen,</p>\n\n<pre class=\"lang-C# prettyprint-override\"><code>modelBuilder.Entity&lt;Data&gt;()\n    .HasRequired(a =&gt; a)\n    .WithMany()\n    .HasForeignKey(a =&gt; a);\n</code></pre>\n\n<p>The problem as I see it is that we only have Primary keys and no Foreign keys. Im using MVC3 and Entity Framework 5. What I want is to only go thrue for example in the view @Model.Datas.Others.NoteOther</p>\n\n<p>But any tips on how I can create relationships between these tables are great!</p>\n"},{"tags":["linq","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":34,"score":-1,"question_id":12466034,"title":"how to Get Most Viewed posts grouped by date?","body":"<p>I want to sort my posts to show most viewed posts grouped by date, so that top viewed posts each day appear then the next then the next.</p>\n\n<p>How to write this query in linq? method based if possible.</p>\n"},{"tags":["c#","asp.net-mvc-3","linq","entity-framework","razor"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":73,"score":3,"question_id":12476686,"title":"What is equivalent to clause between, for comparasion strings in LINQ or lambda expression of?","body":"<p>How do I filter a query interval of two string using LINQ or Lambda Expression.</p>\n\n<p>example:</p>\n\n<pre><code>SELECT * FROM dbo.Country WHERE Name BETWEEN \"Argentina\" AND \"Jamaica\";\n</code></pre>\n"},{"tags":["c#","linq","entity-framework","lambda"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12473558,"title":"OrderByDesc col1 divided by col2","body":"<p>I need to <code>sort</code> a result based on <code>col1</code> divided by <code>col2</code>.. so what I would like to do is something like this:</p>\n\n<pre><code>var x = uploadsQuerySelectionBuilder.Where(e =&gt; e.uploadNumberOfVotes \n&gt; 0)**.OrderByDescending(e=&gt;(e.uploadScore/e.uploadNumberOfVotes))\n** : uploadsQuerySelectionBuilder;\n</code></pre>\n\n<p>As for now.. it doesnt seems to order the result at all, but its just random..\nIs this even possible, how would I get this to work ?</p>\n\n<p>EDIT:</p>\n\n<pre><code>var x = tSearch.SortByDate != false ? uploadsQuerySelectionBuilder.Where(e =&gt; e.uploadNumberOfVotes &gt; 0).OrderByDescending(e =&gt; (e.uploadScore / e.uploadNumberOfVotes)) : uploadsQuerySelectionBuilder;\n</code></pre>\n\n<p>is the very valid and \"compileable\" code :).. the other one were not written in VS, so my bad..</p>\n"},{"tags":["wcf","entity-framework","dbcontext"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":127,"score":1,"question_id":12455953,"title":"DataMember and DataContract attributes for DBContext template","body":"<p>I just started a project using EF. In VS 2012 the default template for edm model is now DBContext code generated template. I've searched a lot but could not find clarification anywhere on how to use WCF with DbContext. I need to build a WCF Service (not a WCF data service), so my questions are:</p>\n\n<ol>\n<li><p>Do I have to add WCF DataContract/DataMember attributes to serialize. How should I use DBContext with WCF (I am not using any DTOs). I will send POCOs generated from DBContext template across the wire.</p></li>\n<li><p>If I have to add attributes is there any way to modify the template to automaticaly add DataMember/DataContract attributes like they do <a href=\"http://stackoverflow.com/questions/3678121/adding-datamember-datacontract-attributes-in-entity-framework-poco-template\">in this post</a>?</p></li>\n</ol>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12475443,"title":"An item with the same key has already been added in Entity Framework","body":"<p>I have table with 2 foreign keys. when I am trying to insert duplicate value (for foreign keys) it gives erroe says \"An item with the same key has already been added\"</p>\n\n<p>below is my code</p>\n\n<pre><code>                 CheckListTrack CheckListtrack = new CheckListTrack();\n                    trackId = entityCollection.WorkItemTrack.Max(p =&gt; p.TrackID) ;\n                    foreach (int ListID in tracklist)\n                    {\n                        CheckListtrack.WorkItemTrackReference.EntityKey = new EntityKey(\"SEIESSEntities.WorkItemTrack\", \"TrackID\", trackId);   // foreign key\n\n                        CheckListtrack.CheckListReference.EntityKey = new EntityKey(\"SEIESSEntities.CheckList\", \"CheckListID\", ListID);     // foreign key\n\n                        entityCollection.AddToCheckListTrack(CheckListtrack); // error comes after second time control passes here\n\n                    }\n                    curentScope.Complete();\n                    success = true;\n</code></pre>\n\n<p>Please help me</p>\n"}]}
{"total":18927,"page":20,"pagesize":100,"questions":[{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12473681,"title":"Update an EntityObject with an another EntityObject","body":"<p>I have a little problem and I need your help with it. I'm using Entity Framework for database handling and I want to update a dataset in this database.</p>\n\n<p>I have an EntityObject with all the changes and want to be able to update this Object with  existing Object.</p>\n\n<p>I'm using the following code to update the data:</p>\n\n<pre><code>IQueryable&lt;Competitors&gt; getCompetitor = DatabaseObject.Competitors.Where(SelectOnly =&gt; SelectOnly.competitorID == competitorObject.competitorID);\nCompetitors competitor = getCompetitor.First();\ncompetitor = competitorObject;\nDatabaseObject.SaveChanges();\n</code></pre>\n\n<p>But this deosn't work. How can I update the date in database?</p>\n"},{"tags":["c#","entity-framework","reflection"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12455389,"title":"Entity framework - get entity by name","body":"<p>I have the following code (example)</p>\n\n<pre><code>public dynamic GetData(string name) \n{\n    using(var ctx = GetObjectContext()) \n    {\n        switch (name) \n        {\n        case \"entity1\":\n            return ctx.entity1.ToList();\n        case \"entity2:\n            return ctx.entity2.ToList();\n        ......\n        default:\n            return null;\n        }\n    }\n}\n</code></pre>\n\n<p>I want to avoid switch in this sample. How can I find needed entity clas by name, call ToList() method and return data? Can I do this using reflection? Can you help me?</p>\n"},{"tags":["linq","entity-framework","stored-procedures","pagedlist"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12472834,"title":"Pagination with LINQ on Stored Procedures?","body":"<p>Is there a way where I can use something like the following code to paginate data without loading the whole data-set to the program?</p>\n\n<pre><code>var r = from c in entities.GetSearchData(null,\"en\",null,true) select c;\nIPagedList&lt;Models.SearchResult&gt; results = r.ToPagedList&lt;Models.SearchResult&gt;(1, 10);\n</code></pre>\n\n<p>I'm trying to use a stored procedure with LINQ to get a paged result. (BTW the above code gives a \"The result of a query cannot be enumerated more than once.\" error). Is it possible?</p>\n"},{"tags":["asp.net-mvc","entity-framework","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":12469995,"title":"Custom fields using Entity Framework 5","body":"<p>I'm starting to write a project and its my first time using ASP.NET MVC and Entity Framework (since now I've used PHP for around 5 years).</p>\n\n<p>I got categories and posts, each category has to have its own unique filters that can be strings or Booleans (I'll get them via textboxes or checkboxes). I'm starting to get confused when designing the entities.</p>\n\n<p>I'm using code-first approach but don't know how to set-up custom fields in Entity Framework. If I'd design that in PHP and pure SQL, I think that in order to keep it perform good, I'd create extra columns on the fly (e.g. \"filter_1\", \"filter_2\") and then create mapping table that contains the description of the field, the type, etc. and I didn't figure out if this kind of implementation is possible in EF.</p>\n\n<p>I've thought about some options:\n- I can create the filter using many-to-many relationships when creating a filters and filters-values tables and when creating a post add the filter values into that table. The main con about it is he performance - I'll most likely have 40k+ rows and more than 20 custom filters for sure... so searching and data fetching will be too slow...\n- I thought about serializing the filtered values into some form of content, for example into bytes array and then only desterilize it - but the problem is that I won't be able to search within that...\n- I can use the traditional ADO.NET way in order to create my initial idea (that I've described when talking about PHP - using the \"filter_N\" columns) but that'd create too much mess with EF...</p>\n\n<p>There's any other way to achieve my goal (to create custom filters)? any way to create custom fields using EF?</p>\n\n<p>Thanks for your help!</p>\n"},{"tags":["c#","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":129,"score":0,"question_id":10499358,"title":"entity - Removing \".dbo\" from table name in Entity Code First","body":"<p>I'm using Entity Code First in a project, and I want to make my tables have names different from the models.</p>\n\n<p>I tried to use the DataAnnotation <code>Table</code> in the model class:</p>\n\n<pre><code>[Table(\"tbBudget\")]\npublic class Budget : IValidatableObject\n{\n...\n</code></pre>\n\n<p>But the table created is named <code>dbo.tbBudget</code>. The question is simple: how do I remove the <code>dbo.</code> from the table name in Entity?</p>\n"},{"tags":["c#",".net","multithreading","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12469243,"title":"Use a single context container to perform multiple queries simultaneously using threads?","body":"<p>I have one context created and then using Parallel.ForEach(...) I perform multiple EF queries simultaneously.</p>\n\n<p>I have been encountering 'The connection was not closed. The connection's current state is connecting.' and other exceptions along those lines.</p>\n\n<p>I this due to the threaded nature of my application? Can you not use a single context simulataneously to simply read?</p>\n"},{"tags":["c#","sql","linq","entity-framework","c#-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":185,"score":0,"question_id":12468469,"title":"modelcontainer update method","body":"<p>Heloo everyone - \nI have this quiz question to see if there is anything wrong with this method, I solved the other ones but I can't see anything wrong with this method. Can you guys spot something wrong in this method?  </p>\n\n<pre><code>private void UpdateUsers(List&lt;string&gt; users) \n    {\n foreach (var user in users) \n    { \n    ModelContainer DBContext = new ModelContainer(); \n    var u = from q in DBContext.Users \n    where q.Name == user \n    select q; \n    u.IsActive = true;\n     DBContext.SaveChanges();\n     } \n    }\n</code></pre>\n\n<p>Thanks in advance, Laziale</p>\n"},{"tags":["asp.net-mvc","vb.net","entity-framework","controller"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12460179,"title":"Cannot add ASP.NET MVC Controller","body":"<p>I'm new to ASP.NET MVC, altough could call myself experinced programmer in web forms field.\nI'm learning MVC now. Trying to add controller with Entity framework abolities.\nHere is below code of model class:</p>\n\n<pre><code>Imports System.Data.Entity\nPublic Class Users\n    Public Property ID() As Integer\n    Public Property Login() As String\n    Public Property Password() As String\n    Public Property Avatar() As Image\n    Public Property Country() As Integer\n    Public Property City() As Integer\n    Public Property Phone() As String\n    Public Property Email() As String\n    Public Property Registered() As Date\nEnd Class\nPublic Class StopSaleDBContext\n    Inherits DbContext\n    Public Property Users() As DbSet(Of Users)\nEnd Class\n</code></pre>\n\n<p>When I'm adding controller I got error Unable retrieve metadata from ProjectName.Users Object reference not set to an instance of object.</p>\n"},{"tags":["entity-framework"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2030,"score":3,"question_id":4911329,"title":"EF CodeFirst CTP5 - Manually drop and create DB?","body":"<p>For testing purposes I would like to manually be able to drop and recreate a DB using EF CodeFirst CTP5. How would I do this?</p>\n"},{"tags":["asp.net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":157,"score":0,"question_id":12445065,"title":"ASP Entity Framework Fluent API [ForeignKey] annotation error","body":"<p>I'm trying to set up a one to one relationship and ran into some issue with declaring an attribute as FK.  I already searched and read some of the questions posted here but doesn't address my problem.</p>\n\n<pre><code>public class User\n{\n    [Key]\n    public int userId {get;set;}\n    [DisplayName(\"User Name\")]\n    [Required(ErrorMessage=\"User name required.\")]\n    public string username {get;set;}\n    [DisplayName(\"Password\")]\n    [Required(ErrorMessage=\"Password required.\")]\n    [MinLength(6)]\n    public string password {get;set;}\n    [DisplayName(\"Email\")]\n    [Required(ErrorMessage=\"Email required.\")]\n    public string email {get;set;}\n\n    public virtual List&lt;RoleDetail&gt; roleDetails { get; set; }\n    public virtual Customer customer { get; set; }\n}\n\npublic class Customer\n{\n    [Key]\n    public int cusomterId { get; set; }\n    [DisplayName(\"First Name\")]\n    [Required(ErrorMessage=\"First name required.\")]\n    public string firstname {get;set;}\n    [DisplayName(\"Last Name\")]\n    [Required(ErrorMessage=\"Last name required.\")]\n    public string lastname {get;set;}\n    [ForeignKey(\"userId\")]\n    public int userId {get;set;}\n}\n</code></pre>\n\n<p>I'm getting this error when I use the [ForeignKey] annotation.  And I'm using <strong>System.ComponentModel.DataAnnotations</strong>.  Also, [Key] works fine.</p>\n\n<pre><code>The type or namespace name 'ForeignKeyAttribute' could not be \nfound (are you missing a using directive or an assembly reference?) \n</code></pre>\n\n<p>What am I missing here?</p>\n"},{"tags":["entity-framework","mstest"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12447249,"title":"Unit Testing and Equals/GetHashCode in entities","body":"<p>So I have created a few POCO's and currently one of them is part of a collection that I am testing. I am using MS Test and apparently when I need to compare two collections I will use CollectionsAssert.AreEquivalent(). Now in my entity besides all the properties I have overriden .Equals() and .GetHashCode() because these two are needed by CollectionAssert.AreEquivalent(). My simple question is - are these two methods ok to be there?</p>\n"},{"tags":["asp.net-mvc-3","entity-framework","nopcommerce"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12450569,"title":"nopCommerce inserting entity fail","body":"<p>I'm creating import from XML function for categories.\nFirst of all, using XDocument, I create list of categories to be added. I turned off isIdentity option for ID in Categories table, because I'm planning to use ID from XML.</p>\n\n<p>XML example:</p>\n\n<pre><code>&lt;cat&gt;\n&lt;id&gt;17&lt;/id&gt;\n&lt;name&gt;Category name&lt;/name&gt;\n&lt;parent_id&gt;0&lt;/parent_id&gt;\n&lt;/cat&gt;\n</code></pre>\n\n<p>Then, I wrote method, which tries to get category by ID and update, or insert new:</p>\n\n<pre><code>var category = _categoryService.GetCategoryById(Id);\n        if (category != null)\n        {\n            category.Name = model.Name;\n            category.ParentCategoryId = model.ParentCategoryId;\n            category.UpdatedOnUtc = DateTime.UtcNow;\n            category.Published = true;\n            category.Deleted = false;\n\n            _categoryService.UpdateCategory(category);\n        }\n        else\n        {\n            category = new Core.Domain.Catalog.Category();\n\n            category.Id = model.Id;\n            category.ParentCategoryId = model.ParentCategoryId;\n            category.Name = model.Name;\n            category.UpdatedOnUtc = DateTime.UtcNow;\n            category.CreatedOnUtc = DateTime.UtcNow;\n            category.Published = true;\n            category.Deleted = false;\n\n            _categoryService.InsertCategory(category);\n        }\n</code></pre>\n\n<p>And then comes the most weird - application throws exception: Cannot insert the value NULL into column 'Id', table 'nopCommerce.dbo.Category'; column does not allow nulls. INSERT fails.\nThe statement has been terminated.\nBUT even in debugger, category ID is not null.. Asking for help!\nThanks in advance!</p>\n\n<p>Update: InsertCategory is a standard nopCommerce method:</p>\n\n<pre><code> /// &lt;summary&gt;\n    /// Inserts category\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"category\"&gt;Category&lt;/param&gt;\n    public virtual void InsertCategory(Category category)\n    {\n        if (category == null)\n            throw new ArgumentNullException(\"category\");\n\n        _categoryRepository.Insert(category);\n\n        //cache\n        _cacheManager.RemoveByPattern(CATEGORIES_PATTERN_KEY);\n        _cacheManager.RemoveByPattern(PRODUCTCATEGORIES_PATTERN_KEY);\n\n        //event notification\n        _eventPublisher.EntityInserted(category);\n    }\n</code></pre>\n"},{"tags":["c#",".net","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12448475,"title":"Context not pulling in an object","body":"<p>Alright, so I have two models Teacher and Account:</p>\n\n<pre><code>public class Teacher : Person\n{\n    [Key]\n    public Guid TeacherID { get; set; }\n\n    public Guid? AccountID { get; set; }\n\n    [Display(Name = \"Hire Date\")]\n    [DataType(DataType.Date)]\n    public DateTime? HireDate { get; set; }\n\n    public virtual ICollection&lt;Classroom&gt; Classrooms { get; set; }\n\n    public virtual Office Office { get; set; }\n\n    public virtual Account Account { get; set; }\n}\n\npublic class Account\n{\n    [Key]\n    public Guid AccountID { get; set; }\n\n    public Guid? TeacherID { get; set; }\n\n    public String Username { get; set; }\n\n    public String Salt { get; set; }\n\n    [DataType(DataType.Password)]\n    [Display(Name = \"Password\")]\n    public String SaltedPassword { get; set; }\n\n    [Display(Name = \"Secert Question\")]\n    public Guid SecertQuestionID { get; set; }\n\n    [Display(Name = \"Answer\")]\n    public String SecertAnswer { get; set; }\n\n    public Guid RoleID { get; set; }\n\n    public virtual SecertQuestion Question { get; set; }\n\n    public virtual Role Role { get; set; }\n\n    public virtual Teacher Teacher { get; set; }\n}\n</code></pre>\n\n<p>When I run my GetAll query:</p>\n\n<pre><code>public IEnumerable&lt;Account&gt; GetAll()\n{\n    return context.Accounts;\n}\n</code></pre>\n\n<p>My Teacher Object returns null instead of filled in like my Role and SecertQuestion object.</p>\n\n<p>I have fake data that makes sure I have the same GUID for TeacherID and AccountID in the two tables. Also, inside my context creation, I'm using this code to create an optional relationship:</p>\n\n<pre><code>modelBuilder.Entity&lt;Account&gt;()\n    .HasOptional(a =&gt; a.Teacher)\n    .WithOptionalDependent(a =&gt; a.Account);\n</code></pre>\n\n<p>Is this correct?</p>\n\n<p>So my question is why is my Teacher object returning null, when I do a GetAll() for my object Account? Is it because my Account Object has a nullable Teacher Object associated with it?</p>\n\n<p><strong>Update:</strong></p>\n\n<p>So after analyzing my database, I noticed that with my current mappings, my Account table is creating a new Foreign key called Teacher_TeacherID. How do I go about fixing this while retaining my navigation mappings (virtual objects) in both Teacher and Account.  </p>\n"},{"tags":["c#","winforms","entity-framework","iqueryable"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12465993,"title":"How to populate a dataGridView with an IQueryable","body":"<p>I've added required columns and with right DataPropertyName s and I use following code to populate a datagridview. However, my dataGridView Shows columnheaders and one empty row only. What is wrong with my code?</p>\n\n<pre><code>public static IQueryable&lt;Kolon&gt; kolonlistele()\n{\n    using (Pehlivan.pehkEntities ctx = new Pehlivan.pehkEntities())\n    {\n        var result = from k in ctx.Kolons\n                     select k;\n\n        return result;\n    }\n}\n\nprivate void Form1_Load(object sender, EventArgs e)\n{\n    dataGridView1.DataSource = veritabani_islemleri.kolonlistele();\n}\n</code></pre>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12465828,"title":"Entity framework table relationship not showing","body":"<p>I have the following tables:</p>\n\n<h1>Users</h1>\n\n<p>ItemID(int), identity --Primary Key\nUserID varchar(25) --Unique Index</p>\n\n<h1>UserItems</h1>\n\n<p>ItemID(int), identity --Primary key\nUserID varchar(25)\nUserItems varchar(100)</p>\n\n<p>There is a relationship between users.userID and userItems.userid , however when loading the Model it doesn't display the relaionship.</p>\n\n<p>Any reasons why?</p>\n"},{"tags":["visual-studio-2010","entity-framework","ado.net","webmatrix","edmx"],"answer_count":4,"favorite_count":8,"up_vote_count":18,"down_vote_count":0,"view_count":14615,"score":18,"question_id":5696436,"title":"No Entity Data Model (EDMX) Template with Visual Studio 2010 SP1 & ADO.NET Entity Framework 4.1","body":"<p>I'm having a lot of issues with the templates of Visual Studio 2010 SP1 &amp; ADO.NET Entity Framework 4.1</p>\n\n<p>I noticed that other people had these problems, and asked similar questions, but I don't think they gave enough information to make it solve-able.</p>\n\n<p>The Problem: <strong>ADO.NET Entity Data Model Templates are not appearing whatsoever</strong></p>\n\n<p>Screenshot: <a href=\"http://c0848462.cdn.cloudfiles.rackspacecloud.com/f067439f6e8f25d5fd36761fd1efc88a74fd765ff1.png\" rel=\"nofollow\">http://c0848462.cdn.cloudfiles.rackspacecloud.com/f067439f6e8f25d5fd36761fd1efc88a74fd765ff1.png</a></p>\n\n<h2>Solution File</h2>\n\n<pre><code>Microsoft Visual Studio Solution File, Format Version 11.00\n# Visual Studio 2010\nProject(\"{E24C65DC-7377-472B-9ABA-BC803B73C61A}\") = \"localhost\", \"http://localhost:36626\", \"{9BA46BAD-E736-4943-ACAD-EDE2E7A1A21E}\"\n    ProjectSection(WebsiteProperties) = preProject\n        UseIISExpress = \"true\"\n        TargetFrameworkMoniker = \".NETFramework,Version%3Dv4.0\"\n        Debug.AspNetCompiler.VirtualPath = \"/localhost_36626\"\n        Debug.AspNetCompiler.PhysicalPath = \"..\\..\\My Web Sites\\Jantire\\\"\n        Debug.AspNetCompiler.TargetPath = \"PrecompiledWeb\\localhost_36626\\\"\n        Debug.AspNetCompiler.Updateable = \"true\"\n        Debug.AspNetCompiler.ForceOverwrite = \"true\"\n        Debug.AspNetCompiler.FixedNames = \"false\"\n        Debug.AspNetCompiler.Debug = \"True\"\n        Release.AspNetCompiler.VirtualPath = \"/localhost_36626\"\n        Release.AspNetCompiler.PhysicalPath = \"..\\..\\My Web Sites\\Jantire\\\"\n        Release.AspNetCompiler.TargetPath = \"PrecompiledWeb\\localhost_36626\\\"\n        Release.AspNetCompiler.Updateable = \"true\"\n        Release.AspNetCompiler.ForceOverwrite = \"true\"\n        Release.AspNetCompiler.FixedNames = \"false\"\n        Release.AspNetCompiler.Debug = \"False\"\n        SlnRelativePath = \"..\\..\\My Web Sites\\Jantire\\\"\n    EndProjectSection\nEndProject\nGlobal\n    GlobalSection(SolutionConfigurationPlatforms) = preSolution\n        Debug|Any CPU = Debug|Any CPU\n    EndGlobalSection\n    GlobalSection(ProjectConfigurationPlatforms) = postSolution\n        {9BA46BAD-E736-4943-ACAD-EDE2E7A1A21E}.Debug|Any CPU.ActiveCfg = Debug|Any CPU\n        {9BA46BAD-E736-4943-ACAD-EDE2E7A1A21E}.Debug|Any CPU.Build.0 = Debug|Any CPU\n    EndGlobalSection\n    GlobalSection(SolutionProperties) = preSolution\n        HideSolutionNode = FALSE\n    EndGlobalSection\nEndGlobal\n</code></pre>\n\n<p>Relevant System Specs:</p>\n\n<ul>\n<li>Visual Studio 2010 Professional SP1 </li>\n<li>ADO.NET Entity Data Model 4.1</li>\n<li>ASP.NET MVC 3 Tools Update </li>\n<li>Windows 7 x64 SP1</li>\n<li>WebMatrix</li>\n</ul>\n\n<p>I'm coding this using both WebMatrix and Visual Studio 2010 Professional SP1</p>\n\n<p>Help would be very much appreciated.</p>\n"},{"tags":["sql-server","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12442999,"title":"Entity Framework: Can I set a custom name for a Navigation Property in SQL Server to be used when generating from the database?","body":"<p>Anyone know if I can setup something in SQL Server that Entity Framework will read when setting up Foreign Key Navigation properties?</p>\n\n<p>My Issue: I have a table call \"SurveyEntry\" with a child table called \"SurveyInvite\"</p>\n\n<p>I have 2 FK setup from the Invite to the Entry table - one for parent (what orignal entry the invite was created from) and one nullable for what \"Entry\" is completed related to the invite...</p>\n\n<p>When I generate the EDMX - it creates two Navigation Properties:\nSurveyEntry and SurveyEntry1</p>\n\n<p>I renamed the 2nd to \"CompletedEntry\" to make sense in code.</p>\n\n<p>But if I have to re-build the EDMX (early stages of dev, will be adding must more stuff and will probably blow it out and completely rebuild it a few times) - I don't want to have to remember to go in and re-name the property whenever I do that - I'm sure I will forgot it sometime!</p>\n\n<p>Tried to use the Description value in SQL in the Field and FK relationship, no luck - if not possible, sure would be nice to have this as a feature...</p>\n"},{"tags":["c#","linq","entity-framework","ef-code-first"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12465369,"title":"EF code first - getting DynamicProxies instead of objects. Why?","body":"<p>I have a following query:</p>\n\n<pre><code>using (var forumsDb = new ForumsDb())\n{\n   forumsDb.Configuration.LazyLoadingEnabled = false;\n   var categoryList = forumsDb.Categories.Select(c =&gt; c).ToList();\n   /***some code here***/\n}\n</code></pre>\n\n<p>Now, <code>categoryList</code> contains 4 items (i have 4 categories in database), but all of them are of type <code>dynamicproxies</code>, and not (as i would expect) <code>Category</code>.</p>\n\n<p>What am i doing wrong?</p>\n"},{"tags":["entity-framework","datetime"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":6472192,"title":"Pull transactions by Date in Entity Framework","body":"<p>In order to process our daily transactions on the back office server, I need to pull the transactions from the web server's database. What is the recommended approach to pull all records for a given date in a DateTime field on the SQL Server? </p>\n\n<pre><code>var transactions = from i in db.Transactions\n                   where i.TransactionTimestamp.Year == transactionDate.Year &amp;&amp; \n                         i.TransactionTimestamp.Month == transactionDate.Month &amp;&amp; \n                         i.TransactionTimestamp.Day == transactionDate.Day\n                   select new Transaction();\n</code></pre>\n\n<p>I got the following error when i tried the above:</p>\n\n<blockquote>\n  <p>System.NotSupportedException was unhandled</p>\n  \n  <p>Message=The entity or complex type 'db_eGovModel.Transaction' cannot be constructed in a LINQ to Entities query.</p>\n</blockquote>\n"},{"tags":["c#","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12465213,"title":"What is the Entity Framework equivalent of SQL UPDATE?","body":"<p>I looked all over the internet and still couldn't find a solution to this. </p>\n\n<p>I tried the attach method: </p>\n\n<pre><code>    public static void updatePhoto(string name, string albumName, string newName, string newPath)\n    {\n        //updates photo... no delete and adding...\n        var photo = new Image(){Label=newName, Path = newPath};\n        using (var db = new EzPrintsEntities())\n        {\n            db.Images.Attach(photo);\n            db.SaveChanges();\n        }\n\n    }\n</code></pre>\n\n<p>but that did not do anything at all.</p>\n\n<p><strong>So the question then is how do you implement an UPDATE to the sql database through EF in the code below?</strong></p>\n\n<pre><code>    public static void updatePhoto(string name, string albumName, string newName, string newPath)\n    {\n         EzPrintsEntities db = new EzPrintsEntities();\n\n    }\n</code></pre>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12465043,"title":"Insert removes backslash","body":"<p>With Entity Framework I'm inserting a json string with all quotes escaped. <br/>\nFor example:<br/><br/> <code>\"{\\\"PDFName\\\":\\\"Test \\\",\\\"PDFDesc\\\":\\\"test desc\\\"}\"</code>  </p>\n\n<p>Somehow the backslashes are getting removed from my string before the insert and the value in the database is:</p>\n\n<p><code>\"{\"PDFName\":\"Test \",\"PDFDesc\":\"test desc\"}\"</code>  </p>\n\n<p>Any ideas?</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":123,"score":0,"question_id":12462100,"title":"Default value for Required fields in Entity Framework migrations?","body":"<p>I've added <code>[Required]</code> data annotation to one of my models in <a href=\"http://www.asp.net/mvc/tutorials/mvc-4/getting-started-with-aspnet-mvc4/adding-validation-to-the-model\" rel=\"nofollow\">ASP.NET MVC application</a>. After creating a migration, running <code>update-database</code> resuilts in the following error:</p>\n\n<blockquote>\n  <p>Cannot insert the value NULL into column 'Director', table\n  'MOVIES_cf7bad808fa94f89afa2e5dae1161e78.dbo.Movies'; column does not\n  allow nulls. UPDATE fails. The statement has been terminated.</p>\n</blockquote>\n\n<p>This is due to some records having NULL in their <code>Director</code> columns. How can I automatically change those values to some default (say \"John Doe\") director?</p>\n\n<p>Here is my model:</p>\n\n<pre><code>  public class Movie\n    {\n        public int ID { get; set; }\n        [Required]\n        public string Title { get; set; }\n\n        [DataType(DataType.Date)]\n        public DateTime ReleaseDate { get; set; }\n\n        [Required]\n        public string Genre { get; set; }\n\n        [Range(1,100)]\n        [DataType(DataType.Currency)]\n        public decimal Price { get; set; }\n\n        [StringLength(5)]\n        public string Rating { get; set; }\n\n        [Required]     /// &lt;--- NEW\n        public string Director { get; set; }\n    }\n</code></pre>\n\n<p>and here is my latest migration:</p>\n\n<pre><code>public partial class AddDataAnnotationsMig : DbMigration\n{\n    public override void Up()\n    {\n        AlterColumn(\"dbo.Movies\", \"Title\", c =&gt; c.String(nullable: false));\n        AlterColumn(\"dbo.Movies\", \"Genre\", c =&gt; c.String(nullable: false));\n        AlterColumn(\"dbo.Movies\", \"Rating\", c =&gt; c.String(maxLength: 5));\n        AlterColumn(\"dbo.Movies\", \"Director\", c =&gt; c.String(nullable: false));\n    }\n\n    public override void Down()\n    {\n        AlterColumn(\"dbo.Movies\", \"Director\", c =&gt; c.String());\n        AlterColumn(\"dbo.Movies\", \"Rating\", c =&gt; c.String());\n        AlterColumn(\"dbo.Movies\", \"Genre\", c =&gt; c.String());\n        AlterColumn(\"dbo.Movies\", \"Title\", c =&gt; c.String());\n    }\n}\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","entity-framework-4","jstree","table-per-hierarchy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12456145,"title":"Entity Framework Table per hierarchy using TypeID both as property and condition","body":"<p>I'm implementing a domain tree structure using entity framework + mvc.\nI use JSTree to present the org structure.</p>\n\n<p><img src=\"http://i.stack.imgur.com/U2War.png\" alt=\"My model scheme so far:\">\nNote that in that model scheme i use the TypeID property both as a condition of my inheritance and as a property for DomainEntity.\nThis of corse throw the following error:</p>\n\n<blockquote>\n  <p>Error 3 Error 3032: Problem in mapping fragments starting at line\n  139:Condition member 'DomainEntities.EntityTypeID' with a condition\n  other than 'IsNull=False' is mapped. Either remove the condition on\n  DomainEntities.EntityTypeID or remove it from the mapping.\n  C:\\Code\\CamelotShiftManagement\\CamelotShiftManagement\\Models\\CamelotDB.edmx   140 15  CamelotShiftManagement</p>\n</blockquote>\n\n<p>lets say i will not use TypeID as a property and keep it as a condition for the inheritance association that will result in the following when i'll try to populate a tree of my domain entities:</p>\n\n<pre><code>            foreach (var entity in entities)\n            {\n                JsTreeModel tree = new JsTreeModel()\n                {\n                    attr = new JsTreeAttribute() \n                    { \n                        id = entity.EntityID.ToString(),\n\n                    },\n                    data = entity.EntityName\n                };\n\n                if (entity is OrganizatioanlUnit)\n                {\n                    tree.attr.type = eNodeType.OrganizationalUnit;\n                }\n                if (entity is Calendar)\n                {\n                    tree.attr.type = eNodeType.Calendar;\n                }\n\n                PopulateTree(entity, tree);\n                io_Node.children.Add(tree);\n            }\n</code></pre>\n\n<p>this code is not maintainable because when a new entity will be introduced i will have to change this code, if i could only access a property that will tell me the type of entity i'm dealing with .. :) .</p>\n\n<p><strong>Here is the dilemma:</strong>\nIf i use inheritances and TypeID as a condition for each inheritance i can not access it as a property of DomainEntity, that will require me to use switch-case against typof(entity) to determine what type i should send to my JSTree plugin because he expects a type identification for each node in his JSON, if i will not use inheritance i will loose the polymorphic capabilities.</p>\n\n<p>It is not only polymorphism i am after.. there will be other methods and properties relevant only for the inherited entities and i can see some injections points in the future...</p>\n"},{"tags":["entity-framework","ef-code-first","poco"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12464421,"title":"How to trigger change detection / validation in Entity Framework with POCO classes","body":"<p>We are using the Entity Framework 4.3.1 with POCO classes (no proxies). \nOur User class stores an email address which should be not be used by any other user.\nThe following test is used to check the validation of this:</p>\n\n<pre><code>  [TestMethod]\n    public void UserEmailNotUniqueTest()\n    {\n        // arrange\n        // - create user one and store in db\n        User userOne = TIF.GetUser(model, true);\n        // - create user two and store in db\n        User userTwo = TIF.GetUserTwo(model, true);\n\n        // act\n        // - change user one email to user two email\n        userOne.EmailAddress = userTwo.EmailAddress;\n        // - save\n        model.SaveChanges();\n</code></pre>\n\n<p>The test initialize creates an empty database and hooks it up to the model DbContext  decendant. The TIF class creates the test instances of users and stores them in database.  This works, both users are present in the database. \nThis validation requires the state of the database to be unchanged, so we have an overridden SaveChanges method so we can pass in serializable transaction:   </p>\n\n<pre><code>public virtual int SaveChanges(bool commitWhenDone)\n    {\n            try\n            {\n                saving = true;\n                int result;\n                TransactionScope scope;\n                using (scope = new TransactionScope( modelTransaction.Get() ))\n                {\n           // open connection etc. \n                    ChangeTracker.DetectChanges();\n                    IEnumerable&lt;DbEntityValidationResult&gt; validationResults = \n                        GetValidationErrors();\n           // handle the errors\n                    result = base.SaveChanges();\n</code></pre>\n\n<p>The test fails as not any change is detected.  No validation code is executed.  Inspecting model.Entity(userOne).State returns Unchanged, and yet the CurrentValues contains the proper value i.e. the userOne has the email address of userTwo.</p>\n\n<p>What are we missing?</p>\n"},{"tags":["entity-framework","ef-code-first","code-first-migrations","entity-framework-5"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":560,"score":2,"question_id":9674983,"title":"The term 'Update-Database' is not recognized as the name of a cmdlet","body":"<p>I am using EF5 beta1 and while I was able to run the \"Update-Database\" before.  Now that I shut down Visual Studio, I cannot get it to run.  I get the following error:</p>\n\n<blockquote>\n  <p>The term 'Update-Database' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.\n  At line:1 char:16\n  + Update-Database &lt;&lt;&lt;&lt;  -verbose\n      + CategoryInfo          : ObjectNotFound: (Update-Database:String) [], CommandNotFoundException\n      + FullyQualifiedErrorId : CommandNotFoundException</p>\n</blockquote>\n\n<p>I have tried to re-install EF5b1 and while was successful (already installed), the 'Update-Database' still does not work.</p>\n\n<p>Can anyone help???</p>\n"},{"tags":["wcf","entity-framework","wcf-data-services","odata","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12398231,"title":"WCF Odata Entity Framework Relationship Names","body":"<p>I'm having an issue with EF code first and Odata.</p>\n\n<p>If I navigate to the metadata then I find that all of my relationships are defined like this:</p>\n\n<pre><code>&lt;NavigationProperty Name=\"Jobs\" ToRole=\"Jobs\" FromRole=\"Applicant\" Relationship=\".Applicant_Jobs\"/&gt;\n</code></pre>\n\n<p>Notice the full stop before the relationship name?</p>\n\n<p>This stops me from adding a service reference to a Console Application. It gives a custom tool error:</p>\n\n<p>Schema specified is not valid. Errors: The relationship attribute is invalid - The value '.Applicant_Jobs' is invalid according to its datatype.</p>\n\n<p>My data contract is defined here:</p>\n\n<pre><code>[DataContract]\npublic class Applicant\n{\n[DataMember]\npublic int ID { get; set; }\n\n[DataMember]\npublic string Forename { get; set; }\n\n[DataMember]\npublic string Surname { get; set; }\n\n[DataMember]\npublic string EmailAddress { get; set; }\n\n[DataMember]\npublic string PassPhrase { get; set; }\n\n[DataMember]\npublic string City { get; set; }\n\n[DataMember]\npublic string County { get; set; }\n\n[DataMember]\npublic string Country { get; set; }\n\n[DataMember]\npublic DateTime CreationDate { get; set; }\n\n[DataMember]\npublic ICollection&lt;Job&gt; Jobs { get; set; }\n}\n\n[DataContract]\npublic class Job\n{\n[DataMember]\npublic Applicant Applicant { get; set; }\n\n[DataMember]\npublic JobStatus JobStatus { get; set; }\n\n[DataMember]\npublic int ID { get; set; }\n\n[DataMember]\n[ForeignKey(\"Applicant\")]\npublic int ApplicantID { get; set; }\n\n[DataMember]\n[ForeignKey(\"JobStatus\")]\npublic int JobStatusID { get; set; }\n\n[DataMember]\npublic string JobTitle { get; set; }\n\n[DataMember]\npublic string WebsiteURL { get; set; }\n\n[DataMember]\npublic string Reference { get; set; }\n\n[DataMember]\npublic string Location { get; set; }\n\n[DataMember]\npublic string Salary { get; set; }\n\n[DataMember]\npublic string ContactName { get; set; }\n\n[DataMember]\npublic string ContactEmail { get; set; }\n\n[DataMember]\npublic string ContactPhone { get; set; }\n\n[DataMember]\npublic string Pros { get; set; }\n\n[DataMember]\npublic string Cons { get; set; }\n\n[DataMember]\npublic string GeneralNotes { get; set; }\n\n[DataMember]\npublic DateTime CreationDate { get; set; }\n\n[DataMember]\npublic bool Archived { get; set; }\n\n[DataMember]\npublic ICollection&lt;JobProgression&gt; JobProgress { get; set; }\n}\n</code></pre>\n\n<p>As you can see, I'm not putting a full stop anywhere, but for some reason one is generated for each relationship in my model, meaning the custom tool fails.</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12463747,"title":"How to search through Database with entity that matches to part of the string?","body":"<p>I know <code>Where()</code> searches through my database for anything that matches and returns me a list, however it matches whole words. How do you search through the database and find everything without matching whole words?</p>\n\n<p>For example, the user wants to search for: <em>funny</em></p>\n\n<p>then my search function will return anything that has the word \"funny\" in it, such as </p>\n\n<ul>\n<li>funnygirls</li>\n<li>funnydogs </li>\n<li>funnypeople</li>\n<li>funnybikes; etc...</li>\n</ul>\n\n<p>I implemented the <code>Where()</code>, but it doesn't do the feature above? Is there any fixes? or any Alternatives?</p>\n\n<p>Edit: </p>\n\n<p>Context Code: </p>\n\n<blockquote>\n<pre><code>   public static List&lt;PhotoAlbumDto&gt; searchAlbumsFromDA(string inputName)\n   {\n       EzPrintsEntities db = new EzPrintsEntities();\n       List&lt;PhotoAlbum&gt; albums = new List&lt;PhotoAlbum&gt;();\n       albums = db.PhotoAlbums.Where(b =&gt; b.NAME == inputName).ToList();\n   }\n</code></pre>\n</blockquote>\n\n<p>This returns me only things that match \"funny\" EXACTLY... so in other words, I can't search up everything that only has the word \"funny\" in it, such as funnycats... Only \"funny\" will be returned, and nothing else.</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12463593,"title":"Entity Framework: Code First - Column Mapping","body":"<p>I have a model like this:</p>\n\n<pre><code>public class Entity\n{\n    [Key, Required]\n    public virtual long EntityId { get; set; }\n    [Required]\n    public virtual string Name { get; set; }\n    public virtual long? ParentEntityId { get; set; }\n}\n</code></pre>\n\n<p>and this is my table:</p>\n\n<pre><code>create table Entities(\n    EntityId bigint not null identity(1, 1),\n    Name nvarchar(64) not null,\n    ParentEntityId bigint null\n)\n</code></pre>\n\n<p>ParentMenuItemId is a foreign key to MenuItemId.</p>\n\n<p>When I try to create a MenuItem entity this is the exception I get:\n<code>Invalid column name 'ParentEntity_EntityId'.</code></p>\n\n<p>I don't know why EF is picking that <em>convention</em> for that particular column, but if I do this:</p>\n\n<pre><code>[Column(\"TryPickThisName\")]\npublic virtual int? ParentEntityId { get; set; }\n</code></pre>\n\n<p>The same error shows up with \"TryPickThisName\" column name. And finally if I write the column name correctly <strong>or</strong> remove the attribute it will show the <em>original</em> error message.</p>\n"},{"tags":["multithreading","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":51,"score":3,"question_id":12463048,"title":"Multiple thread in EF 5","body":"<p>I have two thread in my application . one thread(actually it is a web api which can be called by another system.) new a Context to save entity (calling savechanges() method). Another thread (it is a real working thread .)new a Context to count entity(calling count() method). and these two thread are working on a same entity . As my application run , sometimes a exception will be thrown .\nhere is it .please check it .</p>\n\n<pre><code>System.InvalidOperationException\nStack:\nat System.Data.Entity.Internal.LazyInternalContext.InitializeContext()\nat System.Data.Entity.Internal.InternalContext.GetEntitySetAndBaseTypeForType(System.Type)\nat System.Data.Entity.Internal.Linq.InternalSet`1[[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]].Initialize()\nat System.Data.Entity.Internal.Linq.InternalSet`1[[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]].get_InternalContext()\nat System.Data.Entity.Infrastructure.DbQuery`1[[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]].System.Linq.IQueryable.get_Provider()\nat System.Linq.Queryable.Count[[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]](System.Linq.IQueryable`1&lt;System.__Canon&gt;, System.Linq.Expressions.Expression`1&lt;System.Func`2&lt;System.__Canon,Boolean&gt;&gt;)\nat Accela.HotDeploy.Website.Facade.DeployLogService.GetUpgradeProcess(System.Guid)\n</code></pre>\n\n<p>I believed it must be caused by some threading issue.Any ideas for this issue? thanks.</p>\n"},{"tags":["c#","sql-server-2008","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12462863,"title":"How do you implement Any<> to find something (preferably case insensitive) in the database?","body":"<p>I've looked everywhere on the internet. What I've found is that people use Entity's framework to communicate with the Database. There's is a function in this framework called Any&lt;> that mimics Contains() SQL method. I tried to implement the ANY&lt;> method but it doesn't work. It kept giving me conversion type errors.</p>\n\n<p>So my question is this... what is the CORRECT way of implementing ANY&lt;> function. Hope some guru can answer soon. Thanks in advance!</p>\n\n<p>-\nSo just for some context, I had something like this:</p>\n\n<pre><code>   public static List&lt;PhotoAlbumDto&gt; searchAlbumsFromDA(string inputName)\n    {\n        EzPrintsEntities db = new EzPrintsEntities();\n        List&lt;PhotoAlbum&gt; albums = db.PhotoAlbums.ToList().Any(b =&gt; b.NAME == inputName);\n    }\n</code></pre>\n\n<p>The second like would throw me an :</p>\n\n<p>Error   14  Cannot implicitly convert type 'bool' to 'System.Collections.Generic.List'   C:\\Users\\cding\\Documents\\Visual Studio 2010\\Projects\\ConsoleApplication6\\EZP.Album.Data\\PhotoAlbumDA.cs 22  39  EZP.Album.Data</p>\n\n<p>I think I know the reason why this is giving me an error, but I don't know how to fix it. I'm simply trying to search the database for any PhotoAlbum Objects that matches a certain name.</p>\n\n<p>EDIT: New Question: How do you use Where&lt;> to search for things that match to part of it?</p>\n\n<p>For Example:</p>\n\n<p>User wants to search up: funny</p>\n\n<p>then my search function will return anything that has the word \"funny\" in it, such as funnygirls, funnydogs, funnypeople, funnybikes, etc...</p>\n\n<p>I implemented the Where&lt;>, but i doesn't do the feature above? Is there any fixes? or any Alternatives?</p>\n"},{"tags":["c#",".net","entity-framework","self-tracking-entities"],"answer_count":1,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":200,"score":8,"question_id":12462319,"title":"Entity Framework Self-Tracking Entities not recommended by Microsoft","body":"<p>While looking at Microsoft's web site, I discovered that they no longer recommend using Self-Tracking Entities.</p>\n\n<p>Each link below is a MS resource that mentions not to use STEs:</p>\n\n<ul>\n<li><p>Shows what templates are available by the Entity Framework team:\n<a href=\"http://msdn.microsoft.com/en-US/data/JJ613116\">EF Designer Code Generation Templates</a></p></li>\n<li><p><a href=\"http://msdn.microsoft.com/en-us/data/jj613924\">Self-Tracking Entities</a></p></li>\n<li><p><a href=\"http://msdn.microsoft.com/en-us/data/jj613668\">Recommended technologies for N-Tier applications</a></p></li>\n</ul>\n\n<p>Does anyone know why Microsoft no longer recommends using STEs?</p>\n"},{"tags":[".net","entity-framework","entity-framework-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12426404,"title":"MapInheritedProperties() not mapping inherited foreign key properties","body":"<p>Here's my entity class:</p>\n\n<pre><code>public abstract class Entity: IEntity\n{\n    public Guid? Id { get; set; }    \n    public bool IsDead { get; set; }\n    public DateTime Created { get; set; }\n    public DateTime Modified { get; set; }\n    public ICollection&lt;EntityAccess&gt; AccessList { get; set; }\n    public ICollection&lt;Message&gt; Discussion { get; set; }\n    public User Owner { get; set; }\n}\n</code></pre>\n\n<p>Most of my entities (including User) inherit from this class. OnModelCreating, they all go through this code:</p>\n\n<pre><code>m.MapInheritedProperties();\nm.ToTable(entity.Name); };\n</code></pre>\n\n<p>After EF creates the database, something really peculiar happens. The properties inherited from Entity are indeed mapped to every table, <strong>except the Owner property</strong>. Owner is not mapped, unlike the other inherited properties. What could explain this?</p>\n\n<p>Additional info: my entities are simple POCO objects, no annotations, no constructors, no nothing. For example, here's the User entity:</p>\n\n<pre><code>public class User : RuntimeEntity\n{\n    public string Email { get; set; }\n    public ICollection&lt;UserGroup&gt; Groups { get; set; }\n    public byte[] Password { get; set; }\n    public ICollection&lt;Membership&gt; Memberships { get; set; }\n}\n</code></pre>\n\n<p><strong>Edit:</strong></p>\n\n<p>Since this problem is still going on, here's the full model:</p>\n\n<pre><code>namespace ConSol.Templex.Data.Entities\n{\n    public abstract class Association : IEntity\n    {\n        public Guid? Id { get; set; }\n        [NotMapped]\n        public virtual RuntimeEntity Entity1 { get; set; }\n        [NotMapped]\n        public virtual RuntimeEntity Entity2 { get; set; }\n    }\n\npublic class Attachment : RuntimeEntity\n    {\n        public AttachmentValidity Validity { get; set; }\n        public ICollection&lt;Blob&gt; Versions { get; set; }\n        public Profile Profile { get; set; }\n\n    #region Computed properties\n        public string Name\n        {   \n            get \n            {\n                    return this.Versions.Last().Name;\n            }\n        }\n        #endregion\n    }\n\npublic enum AttachmentValidity\n    {\n        Unverified,\n        Verified,\n        WorkInProgress\n    }\n\npublic class Blob : RuntimeEntity\n    {\n        public string Name { get; set; }\n        public byte[] Data { get; set; }\n        public Attachment Attachment { get; set; }\n        public WorkLog WorkLog { get; set; }\n    }\n\npublic class EntityAccess : Association\n    {\n        #region Association implementation\n        public override RuntimeEntity Entity1 { get { return this.Entity; } }\n        public override RuntimeEntity Entity2\n        {\n            get\n            {\n                return this.UserGroup ?? this.User as RuntimeEntity;\n            }\n            set\n            {\n                if (value is User) this.User = (User)value; else this.UserGroup = (UserGroup)value;\n            }\n        }\n        #endregion\n\n    public RuntimeEntity Entity { get; set; }\n        public UserGroup UserGroup { get; set; }\n        public User User { get; set; }\n    }\n}\n?\n    public interface IEntity\n    {\n    }\n}\n?\n    public abstract class MasterEntity : IEntity\n    {\n        public string Code { get; set; }\n        public string Name { get; set; }\n    }\n\npublic class Membership : Association\n    {\n        #region Association implementation\n        public override RuntimeEntity Entity1 { get { return this.User; } }\n        public override RuntimeEntity Entity2 { get { return this.UserGroup; } }\n        #endregion\n\n    public User User { get; set; }\n        public UserGroup UserGroup { get; set; }\n        public bool IsAdmin { get; set; }\n    }\n\npublic class Message : RuntimeEntity\n    {\n        public string Text { get; set; }\n        public RuntimeEntity RuntimeEntity { get; set; }\n\n    #region Computed properties\n        public User Author\n        {\n            get\n            {\n                return this.Owner;\n            }\n        }\n        #endregion\n    }\n\npublic class Parameter : RuntimeEntity\n    {\n        public string Code { get; set; }\n        public string Name { get; set; }\n        public string Description { get; set; }\n\n    public Worker Worker\n        {\n            get\n            {\n                throw new System.NotImplementedException();\n            }\n            set\n            {\n            }\n        }\n    }\n\npublic class ParameterValue : ConSol.Templex.Data.Entities.RuntimeEntity\n    {\n        public string Value { get; set; }\n        public Parameter Parameter { get; set; }\n        public Worker Worker { get; set; }\n\n    public Profile Profile\n        {\n            get\n            {\n                throw new System.NotImplementedException();\n            }\n            set\n            {\n            }\n        }\n    }\n\npublic class ProductStatus : RuntimeEntity\n    {\n        public Profile Profile { get; set; }\n        public Guid ProductId { get; set; }\n        public ExportStatus Status { get; set; }\n        public WorkLog WorkLog { get; set; }\n\n    public enum ExportStatus\n        {\n            Exported,\n            Imported,\n            Error\n        }\n    }\n\npublic class Profile : RuntimeEntity\n    {\n        public string Name { get; set; }\n        public ICollection&lt;Attachment&gt; Attachments { get; set; }\n        public ICollection&lt;ParameterValue&gt; Parameters { get; set; }\n        public ICollection&lt;WorkLog&gt; WorkLogs { get; set; }\n        public Worker Exporter { get; set; }\n        public Worker Importer { get; set; }\n        public TimeSpan? Frequency { get; set; }\n        public DateTime FirstRun { get; set; }\n        public string Destination { get; set; }\n        public ICollection&lt;ProductStatus&gt; ProductQueue { get; set; }\n    }\n}\n?\n    public abstract class RuntimeEntity : IEntity, ISoftDeletable\n    {\n        public Guid? Id { get; set; }\n\n    public bool IsDead { get; set; }\n        public DateTime Created { get; set; }\n        public DateTime Modified { get; set; }\n        //public ICollection&lt;EntityAccess&gt; AccessList { get; set; }\n        public ICollection&lt;Message&gt; Discussion { get; set; }\n        public User Owner { get; set; }\n\n    /// &lt;summary&gt;\n        /// This defines the default filter for all entities\n        /// &lt;/summary&gt;\n        public static Expression&lt;Func&lt;TIn,bool&gt;&gt; DefaultFilterFor&lt;TIn&gt;(User user)\n            where TIn : RuntimeEntity\n        {\n            return x =&gt; true;\n        }\n\n    /// &lt;summary&gt;\n        /// This defines an optional filter to be used most of the time\n        /// &lt;/summary&gt;\n        public static Expression&lt;Func&lt;TIn, bool&gt;&gt; AdditionalFilterFor&lt;TIn&gt;(User user)\n            where TIn : RuntimeEntity\n        {\n            return x =&gt; !x.IsDead;\n        }\n    }\n\npublic class Schedule : RuntimeEntity\n    {\n        public DateTime Start { get; set; }\n        public TimeSpan Frequency { get; set; }\n    }\n\npublic class User : RuntimeEntity\n    {\n        public string Email { get; set; }\n        public ICollection&lt;UserGroup&gt; Groups { get; set; }\n        public byte[] Password { get; set; }\n        public ICollection&lt;Membership&gt; Memberships { get; set; }\n    }\n\npublic class UserGroup : RuntimeEntity\n    {\n        public string CustomerId { get; set; }\n        public string Name { get; set; }\n        public bool IsSuperGroup { get; set; }\n        public ICollection&lt;Membership&gt; Memberships { get; set; }\n\n    #region Computed properties\n        public IEnumerable&lt;User&gt; Admins\n        {\n            get\n            {\n                return this.Memberships.Where(x =&gt; x.IsAdmin).Select(x =&gt; x.User);\n            }\n        }\n        #endregion\n    }\n\npublic class Worker : RuntimeEntity\n    {\n        public ICollection&lt;Parameter&gt; Parameters { get; set; }\n        public string AssemblyName { get; set; }\n        public byte[] Assembly { get; set; }\n        public WorkType Work { get; set; }\n\n    public enum WorkType\n        {\n            Import,\n            Export\n        }\n    }\n\npublic class WorkerMessage : RuntimeEntity\n    {\n        public string Message { get; set; }\n        public MessageType Outcome { get; set; }\n        public WorkLog WorkLog { get; set; }\n\n    public enum MessageType\n        {\n            Information,\n            Warning,\n            Error\n        }\n    }\n\npublic class WorkLog : RuntimeEntity\n    {\n        public DateTime End { get; set; }\n        public Profile Profile { get; set; }\n        public Worker Worker { get; set; }\n        public WorkResult Result { get; set; }\n        public ICollection&lt;Blob&gt; Files { get; set; }\n        public ICollection&lt;WorkerMessage&gt; Report { get; set; }\n    }\n\n    public enum WorkResult\n        {\n            Success,\n            Warning,\n            Failure\n        }\n    }\n}\n</code></pre>\n\n<p>And here's the dbcontext:</p>\n\n<pre><code>public class TemplexDB : DbContextBase\n{\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;Attachment&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"Attachment\");\n        });\n        modelBuilder.Entity&lt;Blob&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"Blob\");\n        });\n        modelBuilder.Entity&lt;Message&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"Message\");\n        });\n        modelBuilder.Entity&lt;Parameter&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"Parameter\");\n        });\n        modelBuilder.Entity&lt;ParameterValue&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"ParameterValue\");\n        });\n        modelBuilder.Entity&lt;ProductStatus&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"ProductStatus\");\n        });\n        modelBuilder.Entity&lt;Profile&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"Profile\");\n        });\n        modelBuilder.Entity&lt;Schedule&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"Schedule\");\n        });\n        modelBuilder.Entity&lt;User&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"User\");\n        });\n        modelBuilder.Entity&lt;UserGroup&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"UserGroup\");\n        });\n        modelBuilder.Entity&lt;Worker&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"Worker\");\n        });\n        modelBuilder.Entity&lt;WorkerMessage&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"WorkerMessage\");\n        });\n        modelBuilder.Entity&lt;WorkLog&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"WorkLog\");\n        });\n        modelBuilder.Entity&lt;EntityAccess&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"EntityAccess\");\n        });\n        modelBuilder.Entity&lt;Membership&gt;().Map(m =&gt;\n        {\n            m.MapInheritedProperties();\n            m.ToTable(\"Membership\");\n        });\n    }\n\npublic DbSet&lt;Attachment&gt; Attachments { get; set; }\n    public DbSet&lt;Blob&gt; Blobs { get; set; }\n    public DbSet&lt;Message&gt; Messages { get; set; }\n    public DbSet&lt;Parameter&gt; Parameters { get; set; }\n    public DbSet&lt;ParameterValue&gt; ParameterValues { get; set; }\n    public DbSet&lt;ProductStatus&gt; ProductStatuses { get; set; }\n    public DbSet&lt;Profile&gt; Profiles { get; set; }\n    public DbSet&lt;Schedule&gt; Schedules { get; set; }\n    public DbSet&lt;User&gt; Users { get; set; }\n    public DbSet&lt;UserGroup&gt; UserGroups { get; set; }\n    public DbSet&lt;Worker&gt; Workers { get; set; }\n    public DbSet&lt;WorkerMessage&gt; WorkerMessages { get; set; }\n    public DbSet&lt;WorkLog&gt; WorkLogs { get; set; }\n\n// associations\n    public DbSet&lt;EntityAccess&gt; EntityAccess { get; set; }\n    public DbSet&lt;Membership&gt; Membership { get; set; }\n}\n</code></pre>\n"},{"tags":["entity-framework","c#-4.0","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12461811,"title":"quickly switching data contexts","body":"<p>So I have an ADO.NET object that I use to access a database via a data context.</p>\n\n<p>I have test data in 2 separate databases with very similar schemas. I am considering creating 2 models from the 2 databases. But I'm not sure what the easiest way is to \"switch\" the models.</p>\n\n<p>Ideally I'd like to be able to switch contexts by changing 1 line of code. The switching is just for diagnostics purposes.</p>\n\n<p>Since I access this model from several methods, I can't (easily) create a static instance of the data context and then just change the model of the context at the beginning because I have to explicitly declare the type of the context in the method parameters (and then change the type every time I change the model).</p>\n\n<p>Something like this:</p>\n\n<pre><code>(using SF_EntitiesDEV1 ctx = new SF_EntitiesDEV1()) {\n    checkForStrangeStuff(ctx);\n    runTests(ctx);\n    checkResults(ctx);\n    ... etc\n}\n</code></pre>\n\n<p>Now if I want to change SF_EntititesDEV1 to SF_EntitiesDEV2 I have to change the method parameter types in every method.</p>\n"},{"tags":["c#","database","winforms","entity-framework","methods"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12457950,"title":"How to make a class for linq queries (EF)","body":"<p>first of all I am very new (noob). Probably my question is very stupid but I got stuck. Here is the situation.</p>\n\n<p>I started programming a winforms database application using EF 5.0 . Everything is fine I can do what I want in forms like this:</p>\n\n<pre><code>private void Form1_Load(object sender, EventArgs e)\n{        \n    using (var ctx = new pehkEntities())\n    {\n        var result = from k in ctx.Kolons\n                     select new\n                     {\n                         KolonAd = k.KolonAdi,\n                         En = k.En,\n                         Boy = k.Boy,\n                         Ykseklik = k.Yukseklik,\n                         ID = k.KolonID\n                     };\n\n\n        dataGridView1.DataSource = result.ToList();\n    }\n}\n</code></pre>\n\n<p>But my form1 codes are really messed up right now and I want to clean it by using classes and methods. I tried to create a class and a method in program.cs but I have failed.\nHow should I fix it?</p>\n\n<pre><code>public class veritabani_islemleri\n{\n    public ???? kolonlistele()\n    {\n    using(pehkEntities ctx = new pehkEntities())\n\n\n\n        var result =from k in ctx.Kolons\n               select new\n               {\n                   KolonAd = k.KolonAdi,\n                   En = k.En,\n                   Boy = k.Boy,\n                   Ykseklik = k.Yukseklik,\n                   ID = k.KolonID\n               };\n\n        return ????\n    }\n}\n</code></pre>\n\n<p>My problem is I can not fill the question marks. \nI just want to do this in my form.</p>\n\n<pre><code>private void Form1_Load(object sender, EventArgs e)\n{\n   dataGridview.DataSource=myfunction();  \n}\n</code></pre>\n\n<p>Or if my method is completely wrong how should I do this?</p>\n"},{"tags":["c#","asp.net","entity-framework","linq-to-entities"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12461592,"title":"how can i Show Search Time in Result?","body":"<p>hi i have search form and when i search item in database i want display time of search like google : <img src=\"http://i.stack.imgur.com/LQYQ7.jpg\" alt=\"enter image description here\"></p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["entity-framework","unit-testing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":12431912,"title":"Entity Framework issue when creating unit tests","body":"<p>I am specifically getting the following error:</p>\n\n<p>\"The specified named connection is either not found in the configuration, not intended to be used with the EntityClient provider, or not valid.\"</p>\n\n<pre><code>[TestMethod()]\n        public void salesOrderFillListTest()\n        {\n            SalesOrderController_Accessor target = new SalesOrderController_Accessor(); \n            string orderNumber = \"1954120\";\n\n            SalesOrderData result;\n            result = target.FillingOrder(orderNumber);\n            Assert.AreEqual(null, result.ErrorMessage);\n            Assert.AreEqual(32, result.LineItems.Count);\n            Assert.AreEqual(\"WRA-24-NFL-CLEV\", result.LineItems[7].ItemNumber);\n            Assert.AreEqual(2, result.LineItems[7].OrderQuantity);\n            Assert.AreEqual(1, result.LineItems[7].FillingFilledQty);\n            Assert.AreEqual(1, result.LineItems[7].FillingRemainQty);\n        }\n</code></pre>\n\n<p>The error is coming up on the line:</p>\n\n<pre><code>result = target.FillingOrder(orderNumber);\n</code></pre>\n\n<p>I'm a junior developer and haven't had much experience with the many possible causes for this error. My App.config page contains the appropriate connection strings. Any ideas where to look for this one?</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework","asp.net-membership","asp.net-mvc-4"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":870,"score":2,"question_id":12435252,"title":"How to create custom additional fields in UserProfile in MVC4","body":"<p>I faced with new ASP MVC 4 feature, it shipped with new membership db schema and new initialization. In mvc 3 and old versions developer able to create custom user profile fields using specifications in web.config, but now i faced with method in filters namespace in default mvc 4 project:</p>\n\n<pre><code>WebSecurity.InitializeDatabaseConnection(\"DefaultConnection\", \"UserProfile\", \"UserId\", \"UserName\", autoCreateTables: true);\n</code></pre>\n\n<p>and user profile table:</p>\n\n<pre><code>[Table(\"UserProfile\")]\n    public class UserProfile\n    {\n        [Key]\n        [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n        public int UserId { get; set; }\n        public string UserName { get; set; }\n    }\n</code></pre>\n\n<p>But the method InitializeDatabaseConnection generate only UserName and UserId i need to generate other additional fields.</p>\n\n<p>I have good experience in EF codeFirst approach, and in that case i try to edit UserProfile Class:</p>\n\n<pre><code>[Table(\"UserProfile\")]\n    public class UserProfile\n    {\n        [Key]\n        [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n        public int UserId { get; set; }\n        [Column]\n        [Required]\n        public string UserName { get; set; }\n        [Column]\n        [Required]\n        public string FirstName { get; set; }\n        [Column]\n        [Required]\n        public string LastName { get; set; }\n    }\n</code></pre>\n\n<p>But when i regenerate database, i havent see any changes, Custom Db fields not generated.\nHelp me please, how can i create custom user fields?</p>\n"},{"tags":[".net","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12424919,"title":"Quickie: where's the ForeignKeyAttribute in EF5?","body":"<p>I can't find this attribute in EF5: <a href=\"http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.schema.foreignkeyattribute.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.schema.foreignkeyattribute.aspx</a></p>\n\n<p>Can someone tell me where it went? Is it obsolete and replaced by another class from DataAnnotations?</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12419873,"title":"Map names for generated relationship tables in EF code first","body":"<p>I'm giving Code first a try and I have the requirement of a prefix of (all) my tables in db.</p>\n\n<p>In my DbContext I have these entities:</p>\n\n<pre><code>    public DbSet&lt;Person&gt; People { get; set; }\n    public DbSet&lt;Department&gt; Departments { get; set; }\n</code></pre>\n\n<p>I can successfully map table names for my entities by overriding:</p>\n\n<pre><code>    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;Person&gt;().ToTable(\"w_people\");\n        modelBuilder.Entity&lt;Department&gt;().ToTable(\"w_departments\");\n    }\n</code></pre>\n\n<p>However for tables that created that don't directly map to a table I can't figure out to prefix.</p>\n\n<p>In my example people can belong to many departments so a \"non-entity\" table is created by EF. <em>(I'm a EF noob so these tables probably have a fancy name)</em> So in my db I get three tables:</p>\n\n<pre><code>w_people\nw_departments\nPersonsDepartments\n</code></pre>\n\n<p>The PersonsDepartments table is what I'm after. How can I prefix these generated tables or change name/mapping after generation?</p>\n\n<p>TIA</p>\n"},{"tags":["entity-framework","mvc","razor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12460152,"title":"DropDownListFor enums in EF5","body":"<p>using MVC4 Razor and Entityframework 5.  I have a table called organisation with a integer TypeID field which i have created an enum type. In the code i can set and compare the typeid using the enum. </p>\n\n<pre><code> public enum OrganisationType : int\n    {\n        Company = 1,\n        Department = 2,\n        Location = 4\n    }\n</code></pre>\n\n<p>However when i generate the create.cshtml either using the default vs2012 mvc 4 razor templates, or the via the mvcscaffolding nuget package both ignore the TypeID field. I was thinking of amending the tt templates so that they are autogenerated. But initially is it possible to display the descriptive name of the enum in a dropdownlistfor.</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12460336,"title":"EntityFramework,Add a property and divide by other columns","body":"<p>I have this database model where I have one column holding a score, which in this case is a summuraized value of all the score give to an item over the past x months..anyway..\nand I also have another column which holds the number of votes that has been done dureing the same x months as the score...\n(the score can be give by a user in the values of 1-10)</p>\n\n<p>I now need to get the score/votes value.. and I would like to create a new property for my entity-model that holds the value of score/votes.. how would I do this?.. I have tried by simply creating a Scalar Property, but I just cant get it to work.. can anyone point me in the right direction?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":12459466,"title":"Why is Entity Framework missing the last s in a table that ends with 'Status'","body":"<p>This is a really weird error, I have looked online and can not see any obvious reasons why this is happening.</p>\n\n<p>I am using Database ffirst Entity Framework version 5 and have added 4 tables called:</p>\n\n<ul>\n<li>WorkStatus</li>\n<li>JobStatus</li>\n<li>SubJobStatus</li>\n<li>SubJobStageStatus</li>\n</ul>\n\n<p>JobStatus, SubJobStatus and SubJobStageStatus each has a foriegn key constraint to WorkStatus.</p>\n\n<p>I have updated my edmx to include these tables but for some reason each table is missing the last s from the word Status. So the tables and thier navigation properties are now called:</p>\n\n<ul>\n<li>WorkStatu</li>\n<li>JobStatu</li>\n<li>SubJobStatu</li>\n<li>SubJobStageStatu</li>\n</ul>\n\n<p>Does anyone know why this happens?</p>\n"},{"tags":["c#","entity-framework"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":91,"score":2,"question_id":12458887,"title":"Entity Framework Fluent API to map simple one-to-many relation","body":"<p>Ive got two tables  Documents(Id, DocumentTypeId, Title, Details) and DocumentTypes (Id, Name, Description). DocumentTypeId is a foreign key that refers to DocumentTypes table. I.e. all documents can should have a type assigned to them.\nIve got two classes:</p>\n\n<pre><code>public class Document\n{\n    public string Id { get; set; }\n    public string Title { get; set; }\n    public DocumentType DocumentType { get; set; }\n}\n</code></pre>\n\n<p>and </p>\n\n<pre><code>public class DocumentType\n{\n    public string Id { get; set; }\n    public string Name { get; set; }\n    public string Description { get; set; }\n}\n</code></pre>\n\n<p>and Ive got a configuration</p>\n\n<pre><code>internal class DocumentsConfiguration : EntityTypeConfiguration&lt;Document&gt;\n{\n    public DocumentsConfiguration()\n    {\n        ToTable(\"Documents\");\n        HasKey(document =&gt; document.Id);\n        Property(document =&gt; document.Id).HasColumnName(\"Id\");\n\n        HasRequired(document =&gt; document.DocumentType);//????????\n\n        Property(document =&gt; document.Title).HasColumnName(\"Title\").IsRequired();\n    }\n}\n</code></pre>\n\n<p>And this is not working. Im getting error message - \"Invalid column name 'DocumentType_Id'.\" If I rename the fk column to be DocumentType_Id then Im getting error message: \"Invalid column name 'DocumentTypeId'.\" </p>\n\n<p>My question is how do I set such one-to-many relation? I.e. Id like to have many documents with different document types.</p>\n"},{"tags":["c#","entity-framework","return","yield","savechanges"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12452696,"title":"Saving changes from yield return via Entity Framework","body":"<p>I am facing a problem getting Entity Framework to save results from yield return properly. To illustrate the problem I created 2 sets of methods, one returns an entity and the other returns an IEnumerable using yield return. Journal references UserProfile.</p>\n\n<p>Set 1:</p>\n\n<pre><code>public static UserProfile CreateUser()\n{\n    return new UserProfile() { \n                 UserId = Guid.Parse(\"60a3987c-0aa6-4a93-  a5d2-68c51122858b\"), \n                 UserName = \"jason\"\n               };\n}\npublic static Journal CreateJournal(UserProfile userProfile)\n{\n    return new Journal() { UserProfile = userProfile };\n}\n</code></pre>\n\n<p>Set 2:</p>\n\n<pre><code>public static IEnumerable&lt;UserProfile&gt; CreateUsers()\n{\n     yield return new UserProfile() { \n                          UserId = \n                             Guid.Parse(\"02cd1e9f-5947-4b08-9616-5b4f4033d074\"), \n                          UserName = \"john\"\n                      };\n}\npublic static IEnumerable&lt;Journal&gt; CreateJournals(UserProfile userProfile)\n{\n    yield return new Journal() { UserProfile = userProfile };\n}\n</code></pre>\n\n<p>TestSet1 and TestSet2 save the results from Set1 and Set2 respectively. TestSet1 works but TestSet2 throws an exception of Violation of PRIMARY KEY constraint 'PK_dbo.UserProfiles'. Another observation - if I initialize a List and return it instead of yield return then it works.</p>\n\n<pre><code>public static void TestSet1()\n{\n   var u = CreateUser();\n   var j = CreateJournal(u);\n   _db.UserProfiles.Add(u);\n   _db.Journals.Add(j);\n   _db.Commit();\n}\n\npublic static void TestSet2()\n{\n   var uList = CreateUsers();\n   var jList = CreateJournals(uList.ElementAt(0));\n   _db.UserProfiles.Add(uList.ElementAt(0));\n   _db.Journals.Add(jList.ElementAt(0));\n   _db.Commit();\n}\n</code></pre>\n\n<p>What is your view on why yield return in Set2 doesn't work?\nThanks</p>\n"},{"tags":["c#","entity-framework","mvc","asp.net-mvc-4"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":93,"score":3,"question_id":12458372,"title":"MVC Controller not Binding for ViewModels","body":"<p>I hope you can help me, I am quite new to MVC and Entity Framework and trying to get my head around it. I am using MVC4 and EF5. </p>\n\n<p>Here is an overview of what I am trying to do...</p>\n\n<p>I have two entities, Site and SiteType. Each Site can have multiple SiteTypes so they have a Many-to-Many relationship. I setup the database with a typical Many-to-Many relationship by creating 3 tables, Site, SiteType and SiteSiteType. SiteSiteType just contained 2 columns, the  SiteId and the SiteType Id.</p>\n\n<p>I updated the Entity Model and it worked perfectly creating my entities like this for Site...</p>\n\n<pre><code>public partial class Site\n{\n    public Site()\n    {\n        this.SiteTypes = new HashSet&lt;SiteType&gt;();\n    }\n\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public string Address { get; set; }\n\n    public virtual ICollection&lt;SiteType&gt; SiteTypes { get; set; }\n}\n</code></pre>\n\n<p>And this for SiteType</p>\n\n<blockquote>\n<pre><code>public partial class SiteType\n{\n    public SiteType()\n    {\n        this.Sites = new HashSet&lt;Site&gt;();\n    }    \n    public int Id { get; set; }\n    public string Name { get; set; }    \n    public virtual ICollection&lt;Site&gt; Sites { get; set; }\n}\n</code></pre>\n</blockquote>\n\n<p>Now I am using a strongly typed view, however instead of using Site as the type, i am using a custom ViewModel I created called SiteViewModel which looks like this...</p>\n\n<blockquote>\n<pre><code>public class SiteViewModel\n{\n    public Site Site { get; set; }\n    public bool WasPosted { get; set; }\n    public IEnumerable&lt;SiteType&gt; AvailableSiteTypes { get; set; }\n    public IEnumerable&lt;SiteType&gt; SelectedSiteTypes { get; set; }\n}\n</code></pre>\n</blockquote>\n\n<p>The reason for this is I want to use the CheckBoxList extension for MVC as described <a href=\"http://www.codeproject.com/Articles/292050/CheckBoxList-For-a-missing-MVC-extension\" rel=\"nofollow\" title=\"here\">here</a></p>\n\n<p>Now everything works when I am creating a new Site and adding SiteTypes to it, however when I tried to edit and existing record i started having problems. </p>\n\n<p>Here is my edit GET method in the controller....</p>\n\n<pre><code>    public ActionResult Edit(int id = 0)\n    {\n        Site site = _repository.GetSiteByID(id);\n        if (site == null)\n        {\n            return HttpNotFound();\n        }\n\n        var model = new SiteViewModel();\n        model.AvailableSiteTypes = _repository.GetSiteTypes();\n        model.SelectedSiteTypes = site.SiteTypes;\n        model.Site = site;\n\n        return View(model);\n    }\n</code></pre>\n\n<p>And the post method originally looked like this....</p>\n\n<pre><code>    [HttpPost]\n    public ActionResult Edit(SiteViewModel siteViewModel, int[] siteTypes)\n    {\n\n        if (ModelState.IsValid)\n        {\n            _repository.UpdateSite(siteViewModel.Site, siteTypes);\n            _repository.Save();\n            return RedirectToAction(\"Index\");\n        }\n\n        siteViewModel.AvailableSiteTypes = _repository.GetSiteTypes();\n        List&lt;SiteType&gt; selectedSiteTypes = _repository.GetSiteTypes(siteTypes).ToList();\n        if (selectedSiteTypes.Count &gt; 0)\n        {\n            siteViewModel.SelectedSiteTypes = selectedSiteTypes;\n        }\n        return View(siteViewModel);\n\n    }\n</code></pre>\n\n<p>Now the problem I was having was that siteViewModel.Site was being populated properly from the form with the updated data, however the Id column was being set to \"0\" even though it was an existing record and not a new one. I have tried everything and I can't work out why. The only way I could get it working was to take in an \"id\" parameter and manually set it to the Site object like this...</p>\n\n<pre><code>HttpPost]\n    public ActionResult Edit(int id, SiteViewModel siteViewModel, int[] siteTypes)\n    {\n        siteViewModel.Site.Id = id;\n        ......\n</code></pre>\n\n<p>But it just feels really messy compared to how well everything else binds together. </p>\n\n<p>Is this the only way to do this? Am I missing something? </p>\n\n<p>Thanks a lot for taking the time to read my post. Sorry it it is too long, i didn't know how else to explain it...</p>\n"},{"tags":["linq","entity-framework","odp.net"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":2,"question_id":12164679,"title":"entity framework and LINQ - Arithmetic operation resulted in an overflow","body":"<p>I'm recieving the error</p>\n\n<blockquote>\n  <p>Arithmetic operation resulted in overflow.</p>\n</blockquote>\n\n<p>when running this:</p>\n\n<pre><code>using (MyEntities ctx = new MyEntities())\n{\n    var OraLINQEX1 = from e in ctx.TABLE_A\n        select e;\n    Console.WriteLine(\"LINQ to Entities Result\");\n    foreach (var result in OraLINQEX1)\n    {\n        //Console.WriteLine(String.Format(\"ID: {0}    Name: {1}\", result.FIELDA,           result.FIELDB));\n    }\n}\n</code></pre>\n\n<p>My database is Oracle, I'm using <a href=\"http://www.oracle.com/webfolder/technetwork/tutorials/obe/db/dotnet/EntityFrameworkOBE/EntityFrameworkOBE.htm\" rel=\"nofollow\">this reference</a>.</p>\n\n<p>I used another table and it worked. My table has many fields. The fields are varchar2 and number without size.</p>\n\n<p>I know the exact record of table that generetes the error, but I dont know how to get a more detailed message.</p>\n\n<p>Please, help me.</p>\n"},{"tags":["oracle","entity-framework","migration"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12457943,"title":"EF migration to Oracle","body":"<p>Is it possible to migrate EF/NHibernate entities to Oracle database with free provider(No Devart)?\nI've got this message:</p>\n\n<blockquote>\n  <p>No MigrationSqlGenerator found for provider 'Oracle.DataAccess.Client'. Use the SetSqlGenerator method in the target migrations configuration class to register additional SQL generators.</p>\n</blockquote>\n\n<p>Thank you in advance.</p>\n"},{"tags":["c#","asp.net-mvc","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12454023,"title":"How to Add records from classt type List to Class object?","body":"<p>hi friends i have list bellow </p>\n\n<pre><code>List&lt;Authors&gt;listAuthor=new  List&lt;Authors&gt;();\n</code></pre>\n\n<p>in that list i have 100 records, now my question is this i wanna to save these list into database only with one round trip(only one hit to database) in Asp.Net MVc using Database First Technique in Entity Framework</p>\n\n<p>I have created object  </p>\n\n<pre><code>  Author objAuthor=new Author();\n  objAuthor=listAuthor;\n</code></pre>\n\n<p>i am getting conversion error,  any  idea  friends?</p>\n\n<p>This  is  my full Code  </p>\n\n<pre><code>    public ActionResult SaveAuthorConsol()\n    {\n        List&lt;Author&gt; listAuthor = new List&lt;Author&gt;(); // declare list\n\n        List&lt;Bib&gt; bib = new List&lt;Bib&gt;(); // geting records from this table\n        bib = db.Bibs.ToList();\n\n        var q = db.Authors.ToList(); \n\n        foreach (var c in q)\n        {\n            db.Authors.DeleteObject(c); //Note:deleting previous records from Author table\n        }\n\n        db.SaveChanges();\n\n        foreach (var bibitems in bib) // return Author type list \n        {\n            Authors objAuthor = new Authors();\n           listAuthor.AddRange(objAuthor.SaveAouthor(0, bibitems.Contents));\n        }\n        foreach (Author objauthor in listAuthor) //adding my list records to database\n        {\n            db.Authors.Attach(objauthor); //   getting error here\n        }\n\n\n        db.SaveChanges();\n        return View();\n    }\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework","transactions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12451723,"title":"Is it necessary to manage transactions in Entity Famework 5? (multiple contexts)","body":"<p>in a case where there may be multiple DbContexts within a custom unit of work, would EF5 manage <strong>all</strong> the transactional requirements or is the code below still valid / required? If not, how far can the code be reduced and still provide the same functionality?</p>\n\n<pre><code>public void SaveAllChanges()\n{\n    var transactions = new List&lt;DbTransaction&gt;();\n\n    foreach (var context in this.contexts\n        .Where(context =&gt; context != null)\n        .Select(dbcontext =&gt; ((IObjectContextAdapter)dbcontext).ObjectContext))\n    {\n        context.Connection.Open();\n\n        var databaseTransaction = context.Connection.BeginTransaction();\n\n        transactions.Add(databaseTransaction);\n\n        try\n        {\n            context.SaveChanges();\n        }\n        catch\n        {\n            foreach (var transaction in transactions)\n            {\n                try\n                {\n                    transaction.Rollback();\n                }\n                finally\n                {\n                    databaseTransaction.Dispose();\n                }\n            }\n\n            transactions.Clear();\n\n            throw;\n        }\n    }\n\n    try\n    {\n        foreach (var transaction in transactions)\n        {\n            transaction.Commit();\n        }\n    }\n    finally\n    {\n        foreach (var transaction in transactions)\n        {\n            transaction.Dispose();\n        }\n\n        transactions.Clear();\n\n        foreach (var context in this.contexts\n            .Select(dbcontext =&gt; ((IObjectContextAdapter)dbcontext).ObjectContext)\n            .Where(context =&gt; context.Connection.State != ConnectionState.Closed))\n        {\n            context.Connection.Close();\n        }\n    }\n}\n</code></pre>\n\n<p>Assume SQL Server 2008 and above.</p>\n"},{"tags":["entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":686,"score":3,"question_id":3487990,"title":"Cannot drag tables from Server Explorer to .edmx designer pane","body":"<p>Why can't I drag tables from the Server Explorer to the .edmx designer pane? I've done this before in the exact same steps and it worked, but since yesterday instead of getting the classic + sign for dropping items, I get the no entry symbol (circle with slash in the middle).</p>\n\n<p>What am I doing wrong? As I said, I've done this before but now it doesn't let me drag things.\n<img src=\"http://i.imgur.com/pZKRm.jpg\" alt=\"alt text\"></p>\n"},{"tags":["sql","asp.net-mvc","database","entity-framework","vwdexpress"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":110,"score":1,"question_id":12450515,"title":"When to use .mdf and when .sdf?","body":"<p>After seeing a lot of things in the internet I haven't found any explanation between the two file types: <code>.mdf</code> and <code>.sdf</code>.</p>\n\n<p><code>.sdf</code> would be a compact version of SQL Server (<code>.mdf</code>) I believe. Still they appear utterly different.</p>\n\n<p>Have followed the two tutorials on msdn, i.e. <a href=\"http://www.asp.net/mvc/tutorials/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3\" rel=\"nofollow\">MVC Movie App</a> and the <a href=\"http://www.asp.net/mvc/tutorials/mvc-music-store/mvc-music-store-part-1\" rel=\"nofollow\">Musicstore</a>. Both use <code>.sdf</code>.</p>\n\n<p>Partial quote (<a href=\"http://stackoverflow.com/questions/12169590/where-is-that-file-on-my-system\">full</a>): 'First of all it should be \"|DataDirectory|ASPNETDBContext.mdf\" (notice the extension difference). Your applic...'</p>\n\n<p>Both tutorials have the connection string to <code>.sdf</code>, i.e.:</p>\n\n<pre><code>&lt;add name             =\"MovieDBContext\"\n     connectionString =\"Data Source=|DataDirectory|Movies.sdf\" \n     providerName     =\"System.Data.SqlServerCe.4.0\"\n/&gt;\n\n&lt;add name             =\"MusicStoreEntities\" \n     connectionString =\"Data Source=|DataDirectory|MvcMusicStore.sdf\" \n     providerName     =\"System.Data.SqlServerCe.4.0\"\n/&gt; \n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>My question is what to use where and when? More over <strong>why</strong> to use which where.</p>\n"},{"tags":["visual-studio-2010","entity-framework","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":166,"score":0,"question_id":12447732,"title":"Microsoft visual studio 2010 ADO.NET Entity Framework tools error","body":"<p><a href=\"http://i.stack.imgur.com/3UHF5.png\" rel=\"nofollow\"><img src=\"http://i.stack.imgur.com/3UHF5.png\" alt=\"enter image description here\"></a></p>\n\n<p>Hey anytime I start up visual studio i get an error popping up in relation to the title of this post. </p>\n\n<p>The error message says enter a path to <code>ADONETEntityFrameworkTools_enu.msi</code>. In the use source box it says </p>\n\n<blockquote>\n  <p>c:\\users\\conor\\appdata\\local\\temp\\rar$exa0.270\\wcu\\eftools\\</p>\n</blockquote>\n\n<p>but there is no folder when trying to locate it.  Can anyone help ?</p>\n"},{"tags":["asp.net","entity-framework","complextype"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12450925,"title":"Using ComplexType with ToList causes InvalidOperationException","body":"<p>I have this model</p>\n\n<pre><code>namespace ProjectTimer.Models\n{\n    public class TimerContext : DbContext\n    {\n        public TimerContext()\n            : base(\"DefaultConnection\")\n        {\n        }\n\n        public DbSet&lt;Project&gt; Projects { get; set; }\n        public DbSet&lt;ProjectTimeSpan&gt; TimeSpans { get; set; }\n    }\n\n    public class DomainBase\n    {\n        [Key]\n        public int Id { get; set; }\n    }\n\n    public class Project : DomainBase\n    {\n        public UserProfile User { get; set; }\n        public string Name { get; set; }\n        public string Description { get; set; }\n        public IList&lt;ProjectTimeSpan&gt; TimeSpans { get; set; }\n    }\n\n    [ComplexType]\n    public class ProjectTimeSpan\n    {\n        public DateTime TimeStart { get; set; }\n        public DateTime TimeEnd { get; set; }\n        public bool Active { get; set; }\n    }\n}\n</code></pre>\n\n<p>When I try to use this action I get the exception <code>The type 'ProjectTimer.Models.ProjectTimeSpan' has already been configured as an entity type. It cannot be reconfigured as a complex type.</code></p>\n\n<pre><code>public ActionResult Index()\n        {\n            using (var db = new TimerContext())\n            {\n                return View(db.Projects.ToList);\n            }\n        }\n</code></pre>\n\n<p>The view is using the model <code>@model IList&lt;ProjectTimer.Models.Project&gt;</code></p>\n\n<p>Can any one shine some light as to why this would be happening?</p>\n"},{"tags":["entity-framework","asp.net-membership","asp.net-webforms","asp.net-4.5","simplemembership"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":209,"score":1,"question_id":12291371,"title":"How to use SimpleMembership with WebForm 4.5 and EntityFramework?","body":"<p>Ive heard there new providers with ASP.NET 4.5 (such membership provider) but it seem i can't find anything decent about using the SimpleMembership with WebForm ASP.NET 4.5 and EntityFramework. Is there any good documentation or explanation about how to implement the SimpleMembership with the technologies specified over (sql shema creation, configuring the project)?</p>\n"},{"tags":["wpf","entity-framework","flowdocument"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":2162,"score":5,"question_id":2473101,"title":"Creating blob properties with Entity Framework 4?","body":"<p>I am creating an EF4 model-first application with a WPF UI. One of the controls on my UI is a RichTextDocument, which outputs a WPF FlowDocument. I can either serialize the FlowDocument to a byte array, or extract its XAML markup as a string. I would prefer to use binary serialization, if I can. Here are my questions: </p>\n\n<ul>\n<li><p>If I serialize to a byte array, how do I specify an entity property as a byte array in the EDM Designer? </p></li>\n<li><p>If I extract a XAML markup string, can I specify that the EDM Designer create the corresponding database column as a <code>nvarchar(max)</code> column?</p></li>\n</ul>\n\n<p>As to the second question, I assume I could always manually edit the <em>MyModel.edmx.sql</em> file to change the data type from <code>nvarchar(4000)</code> to <code>nvarchar(max)</code> before executing it, but I would like to know if it can be done in the Designer.</p>\n\n<p>Thanks for your help.</p>\n"},{"tags":["c#","entity-framework","reflection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12450451,"title":"Get entities by passing just the name of the entity","body":"<p>I'm using entity framework, and I need to get a list of entities only by passing the name of the entity.</p>\n\n<p>Example:</p>\n\n<pre><code>string tableName = \"PRODUCT\";\n\nList&lt;tableName&gt; myList = (from prod in dbContext.tableName\n                          select prod).ToList();\n</code></pre>\n\n<p>What I can't get to do, is that, using the table name (string) to make a EF query (or LINQ).</p>\n\n<p>I'm trying to get this to work by using Reflection or EntityDataModel, but I just can't.</p>\n"},{"tags":["c#","wpf","entity-framework","dependency-properties","inotifypropertychanged"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":75,"score":4,"question_id":12449947,"title":"Using DependencyProperty on ViewModel with Entity Framework","body":"<p>I am writing a desktop application in C# using the MVVM pattern with  an Entity Framework model. I tend to use DependencyProperties in my VM's and have come to (generally) prefer this system over implementing INotifyPropertyChanged. I would like to keep things consistent. My VM accesses the Entities in the Model and I have managed to keep things pretty separate - the View has no knowlege of the VM except for binding and command names and the Model has know knowlege of the VM. </p>\n\n<p>Using INotifyPropertyChanged in the VM, it seems pretty easy to update the Entities in the Model:</p>\n\n<pre><code>public string Forename\n    {\n        get { return CurrentPerson.Forename; }\n        set\n        {\n            if (Forename != value)\n            {\n                CurrentPerson.Forename = value;\n                NotifyPropertyChanged(\"Forename\");\n            }\n        }\n    }\n</code></pre>\n\n<p>...where CurrentPerson is a Person object auto-created by the Entity Data Model. There is therefore no private field created specifically to store the Forename.</p>\n\n<p>With DependencyProperties, it appears that I would have to create a DP, add the default Property, using GetValue and Setvalue and then use the PropertyChangedCallback in order to update the CurrentPerson Entity. Calling a callback in this situation appears to be adding overhead for the sake of being consistent with my other VM's.</p>\n\n<p>The question is therefore whether one or other of these methods is the way I <em>should</em> do things? In this instance, should I use a DependencyProperty or INotifyPropertyChanged? One thing that should be pointed out is that this will potentially be a very large scale project (with plugins and a lot of database accesses from different machines) and that everything really should be as reusable, and the modules as \"disconnected\", as possible.</p>\n"},{"tags":["database","linq","entity-framework","entity-framework-4.1"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12447879,"title":"How to get top most parent in self reference object","body":"<p><strong>UPDATE</strong>\nThis is my comment from bellow that I have discused with @Slauma:</p>\n\n<blockquote>\n  <p>Because I need to get all locations that are connected to passed root\n  category. As you can see if I pass 2 and some location have category\n  44 and 44 is child of 32 which is child of 2 I need to get this\n  location. LocationCategory is N:N table in database between Locations\n  and PlaceCategories. Not important but can give a better picture. I\n  have a map and markers on that map. I can click on Education(id:2)\n  link and I need to get all markers where root of location category is\n  '2' (like on foursquare.com map)</p>\n</blockquote>\n\n<p>I have a self reference table in database.\nSo I created the following object:</p>\n\n<pre><code>public class PlaceCategory\n    {\n        public int PlaceCategoryId { get; set; }\n        public string Name{ get; set; }\n        public int? ParentId { get; set; }\n\n        public virtual PlaceCategory Parent { get; set; }\n        public virtual ICollection&lt;PlaceCategory&gt; Children { get; set; }\n\n        public string Icon { get; set; }\n    }\n</code></pre>\n\n<p>Because Location object can have multiple categories I have LocationCategory object:</p>\n\n<pre><code>public class LocationCategory\n    {\n        [Key, Column(Order = 1)]\n        public int LocationId { get; set; }\n        [Key, Column(Order = 2)]\n        public int PlaceCategoryId { get; set; }\n        public Guid UserId { get; set; }\n        public DateTime CreatedOnDate { get; set; }\n        public bool IsPrimary { get; set; }\n\n        public virtual Location Location { get; set; }\n        public virtual PlaceCategory PlaceCategory { get; set; }\n        public virtual User User { get; set; }\n    }\n</code></pre>\n\n<p>Location object have:</p>\n\n<pre><code>public class Location\n{\n    ...\n    public virtual ICollection&lt;LocationCategory&gt; LocationCategories { get; set; } \n    ...\n</code></pre>\n\n<p>In database in self reference table I have:</p>\n\n<pre><code>root: Education (id:2, parentId:null)\nchild1: School(id:32, parentId:2) \nchild2: Elementary(id:42,parentId:32), High(id:43,parentId:32), Higher(id:44,parentId:32) etc.\n</code></pre>\n\n<p>I have to take list of locations based on passed root category.</p>\n\n<pre><code>var model = locationRepository.GetLocationss().Where(x =&gt; x.LocationCategories???); // but it's a list and don't know how to check top most parent here?\n</code></pre>\n\n<p>So if I pass '2' I should get all items which have category 2,32,42,43,44</p>\n"},{"tags":["c#","asp.net","entity-framework"],"answer_count":5,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":554,"score":3,"question_id":6274411,"title":"How to apply transaction in Entity framework","body":"<p>I have two tables. I am updating those tables using entity framework. here is my code</p>\n\n<pre><code>public bool UpdateTables()\n{\n      UpdateTable1();\n      UpdateTable2();\n}\n</code></pre>\n\n<p>If any table update operation fails other should not be committed how do i achieve this in entity framework?</p>\n"},{"tags":[".net","entity-framework","inheritance","ef-code-first","table-per-type"],"answer_count":2,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":426,"score":7,"question_id":10961690,"title":"Inheritance and composite foreign keys - one part of the key in base class, the other part in derived class","body":"<p>I am having problems to create an Entity Framework Code-First mapping for the following sample database schema (in SQL Server):</p>\n\n<p><img src=\"http://i.stack.imgur.com/vFGvn.png\" alt=\"Database schema with composite foreign keys\"></p>\n\n<p>Every table contains a <code>TenantId</code> which is part of all (composite) primary and foreign keys (Multi-Tenancy).</p>\n\n<p>A <code>Company</code> is either a <code>Customer</code> or a <code>Supplier</code> and I try to model this via Table-Per-Type (TPT) inheritance mapping:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public abstract class Company\n{\n    public int TenantId { get; set; }\n    public int CompanyId { get; set; }\n\n    public int AddressId { get; set; }\n    public Address Address { get; set; }\n}\n\npublic class Customer : Company\n{\n    public string CustomerName { get; set; }\n\n    public int SalesPersonId { get; set; }\n    public Person SalesPerson { get; set; }\n}\n\npublic class Supplier : Company\n{\n    public string SupplierName { get; set; }\n}\n</code></pre>\n\n<p>Mapping with Fluent API:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>modelBuilder.Entity&lt;Company&gt;()\n    .HasKey(c =&gt; new { c.TenantId, c.CompanyId });\n\nmodelBuilder.Entity&lt;Customer&gt;()\n    .ToTable(\"Customers\");\n\nmodelBuilder.Entity&lt;Supplier&gt;()\n    .ToTable(\"Suppliers\");\n</code></pre>\n\n<p>The base table <code>Companies</code> has a one-to-many relationship to an <code>Address</code> (every company has an address, no matter if customer or supplier) and I can create a mapping for this association:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code> modelBuilder.Entity&lt;Company&gt;()\n     .HasRequired(c =&gt; c.Address)\n     .WithMany()\n     .HasForeignKey(c =&gt; new { c.TenantId, c.AddressId });\n</code></pre>\n\n<p>The foreign key is composed of one part of the primary key - the <code>TenantId</code> - and a separate column - the <code>AddressId</code>. This works. </p>\n\n<p>As you can see in the database schema, from database perspective the relationship between <code>Customer</code> and <code>Person</code> is basically the same kind of one-to-many relationship as between <code>Company</code> and <code>Address</code> - the foreign key is composed again of the <code>TenantId</code> (part of the primary key) and the column <code>SalesPersonId</code>. (Only a customer has a sales person, not a <code>Supplier</code>, therefore the relationship is in the derived class this time, not in the base class.)</p>\n\n<p>I try to create a mapping for this relationship with Fluent API the same way as before:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>modelBuilder.Entity&lt;Customer&gt;()\n    .HasRequired(c =&gt; c.SalesPerson)\n    .WithMany()\n    .HasForeignKey(c =&gt; new { c.TenantId, c.SalesPersonId });\n</code></pre>\n\n<p>But when EF tries to compile the model an <code>InvalidOperationException</code> is thrown:</p>\n\n<blockquote>\n  <p>The foreign key component 'TenantId' is not a declared property on\n  type 'Customer'. Verify that it has not been explicitly excluded from\n  the model and that it is a valid primitive property.</p>\n</blockquote>\n\n<p>Apparently I cannot compose a foreign key from a property in the base class and from another property in the derived class (although in the database schema the foreign key is composed of columns <em>both</em> in the derived type's table <code>Customer</code>).</p>\n\n<p>I tried two modifications to get it working perhaps:</p>\n\n<ul>\n<li><p>Changed the foreign key association between <code>Customer</code> and <code>Person</code> to an independent association, i.e. removed the property <code>SalesPersonId</code>, and then tried the mapping:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>modelBuilder.Entity&lt;Customer&gt;()\n    .HasRequired(c =&gt; c.SalesPerson)\n    .WithMany()\n    .Map(m =&gt; m.MapKey(\"TenantId\", \"SalesPersonId\"));\n</code></pre>\n\n<p>It doesn't help (I didn't really hope, it would) and the exception is:</p>\n\n<blockquote>\n  <p>Schema specified is not valid. ... Each property name in a type must\n  be unique. Property name 'TenantId' was already defined.</p>\n</blockquote></li>\n<li><p>Changed TPT to TPH mapping, i.e. removed the two <code>ToTable</code> calls. But it throws the same exception.</p></li>\n</ul>\n\n<p>I see two workarounds:</p>\n\n<ul>\n<li><p>Introduce a <code>SalesPersonTenantId</code> into the <code>Customer</code> class:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public class Customer : Company\n{\n    public string CustomerName { get; set; }\n\n    public int SalesPersonTenantId { get; set; }\n    public int SalesPersonId { get; set; }\n    public Person SalesPerson { get; set; }\n}\n</code></pre>\n\n<p>and the mapping:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>modelBuilder.Entity&lt;Customer&gt;()\n    .HasRequired(c =&gt; c.SalesPerson)\n    .WithMany()\n    .HasForeignKey(c =&gt; new { c.SalesPersonTenantId, c.SalesPersonId });\n</code></pre>\n\n<p>I tested this and it works. But I will have a new column <code>SalesPersonTenantId</code> in the <code>Customers</code> table in addition to the <code>TenantId</code>. This column is redundant because both columns always must have the same value from business perspective.</p></li>\n<li><p>Abandon inheritance mapping and create one-to-one mappings between <code>Company</code> and <code>Customer</code> and between <code>Company</code> and <code>Supplier</code>. <code>Company</code> must become a concrete type then, not abstract and I would have two navigation properties in <code>Company</code>. But this model wouldn't express correctly that a company is <em>either</em> a customer <em>or</em> a supplier and cannot be both at the same time. I didn't test it but I believe it would work.</p></li>\n</ul>\n\n<p>I paste the full example I tested with (console application, reference to EF 4.3.1 assembly, downloaded via NuGet) in here if someone likes to experiment with it:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>using System;\nusing System.Data.Entity;\n\nnamespace EFTPTCompositeKeys\n{\n    public abstract class Company\n    {\n        public int TenantId { get; set; }\n        public int CompanyId { get; set; }\n\n        public int AddressId { get; set; }\n        public Address Address { get; set; }\n    }\n\n    public class Customer : Company\n    {\n        public string CustomerName { get; set; }\n\n        public int SalesPersonId { get; set; }\n        public Person SalesPerson { get; set; }\n    }\n\n    public class Supplier : Company\n    {\n        public string SupplierName { get; set; }\n    }\n\n    public class Address\n    {\n        public int TenantId { get; set; }\n        public int AddressId { get; set; }\n\n        public string City { get; set; }\n    }\n\n    public class Person\n    {\n        public int TenantId { get; set; }\n        public int PersonId { get; set; }\n\n        public string Name { get; set; }\n    }\n\n    public class MyContext : DbContext\n    {\n        public DbSet&lt;Company&gt; Companies { get; set; }\n        public DbSet&lt;Address&gt; Addresses { get; set; }\n        public DbSet&lt;Person&gt; Persons { get; set; }\n\n        protected override void OnModelCreating(DbModelBuilder modelBuilder)\n        {\n            modelBuilder.Entity&lt;Company&gt;()\n                .HasKey(c =&gt; new { c.TenantId, c.CompanyId });\n\n            modelBuilder.Entity&lt;Company&gt;()\n                .HasRequired(c =&gt; c.Address)\n                .WithMany()\n                .HasForeignKey(c =&gt; new { c.TenantId, c.AddressId });\n\n            modelBuilder.Entity&lt;Customer&gt;()\n                .ToTable(\"Customers\");\n\n            // the following mapping doesn't work and causes an exception\n            modelBuilder.Entity&lt;Customer&gt;()\n                .HasRequired(c =&gt; c.SalesPerson)\n                .WithMany()\n                .HasForeignKey(c =&gt; new { c.TenantId, c.SalesPersonId });\n\n            modelBuilder.Entity&lt;Supplier&gt;()\n                .ToTable(\"Suppliers\");\n\n            modelBuilder.Entity&lt;Address&gt;()\n                .HasKey(a =&gt; new { a.TenantId, a.AddressId });\n\n            modelBuilder.Entity&lt;Person&gt;()\n                .HasKey(p =&gt; new { p.TenantId, p.PersonId });\n        }\n    }\n\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            Database.SetInitializer(new DropCreateDatabaseAlways&lt;MyContext&gt;());\n            using (var ctx = new MyContext())\n            {\n                try\n                {\n                    ctx.Database.Initialize(true);\n                }\n                catch (Exception e)\n                {\n                    throw;\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><strong>Question: Is there any way to map the database schema above to a class model with Entity Framework?</strong></p>\n"},{"tags":["c#",".net","asp.net-mvc","wcf","entity-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12447747,"title":"As the client to apply the attribute - ScaffoldColumn","body":"<p>My application consists of the following components:</p>\n\n<ol>\n<li>Server (DataLibrary) -  entity data model.</li>\n<li>Service (WCF) - at the request of the client accesses the database (DataLibrary).</li>\n<li>Client (ASP.NET MVC) - using the service(WCF) receives the data from the database server.</li>\n</ol>\n\n<p>In the service (WCF) in section [DataContract] have declared classes that hide the implementation details of the classes (EF). Example:</p>\n\n<pre><code>// ProductEntity[EF] -&gt; Product[DataContract]\n\n[DataContract]\npublic class Product\n{\n    [DataMember]\n    public int id { get; set; }\n    [DataMember]\n    public string name { get; set; }\n}   \n</code></pre>\n\n<p>In the client(MVC), I instantiate the service(WCF) and the requested product. \nThen received the product in view for editing( return View(Product)). I want the id field is not displayed (ScaffoldColumn(false)). How to do it?</p>\n"},{"tags":[".net","entity-framework","partial-classes"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12446398,"title":"Entity Framework - adding new constructors","body":"<p>I'm using EF4.3. It's my first project so I'm learning as I go along.</p>\n\n<p>There are instances where I need to implment additional constructors for entities. I create an additional partial class to do this, so entity Users, will have an associated class User2.</p>\n\n<p>I've noticed that EF on the whole doesn't create constructors, but there are instances like this:</p>\n\n<pre><code>public partial class User\n{\n    public User()\n    {\n        this.BookmarkedDeals = new HashSet&lt;BookmarkedDeal&gt;();\n        this.BookmarkedStores = new HashSet&lt;BookmarkedStore&gt;();\n    }\n\n    public System.Guid UserId { get; set; }\n    public int UserStatusId { get; set; }\n    public int UserRoleId { get; set; }\n    public System.DateTime CreatedOn { get; set; }\n    public System.DateTime LastVisitedOn { get; set; }\n\n    public virtual ICollection&lt;BookmarkedDeal&gt; BookmarkedDeals { get; set; }\n    public virtual ICollection&lt;BookmarkedStore&gt; BookmarkedStores { get; set; }\n    public virtual Subscriber Subscriber { get; set; }\n}\n</code></pre>\n\n<p>This got me worrying a little because its so easy to add a navigation property via the designer, and code within the base constructor missed.</p>\n\n<pre><code>    public User()\n    {\n        this.BookmarkedDeals = new HashSet&lt;BookmarkedDeal&gt;();\n        this.BookmarkedStores = new HashSet&lt;BookmarkedStore&gt;();\n    }\n</code></pre>\n\n<p>My question is, do I need to call the base constructor from my additional contructors and should I put the code (: this User()) to call my base constructor in all cases as a safeguard? </p>\n"},{"tags":["asp.net-mvc","entity-framework","many-to-many","code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":76,"score":3,"question_id":12445991,"title":"Updating a many to many collection with EF code first","body":"<p>I'm using EF Code First with the following configuration</p>\n\n<pre><code>protected override void OnModelCreating(DbModelBuilder modelBuilder)\n{\n    base.OnModelCreating(modelBuilder);\n    modelBuilder.Entity&lt;UserProfile&gt;()\n        .HasMany(x =&gt; x.TeamLeaders)\n        .WithMany()\n        .Map(m =&gt; m.MapLeftKey(\"UserId\")\n        .MapRightKey(\"TeamLeaderId\")\n        .ToTable(\"UserTeamLeaders\"));\n}\n</code></pre>\n\n<p>TeamLeaders is an ICollection of Users i.e. it is a self referencing many-many relationship.</p>\n\n<p>In plain English, a user can have more than one team leader. This configuration appears to be correct, as it creates the duel FK/PK link table as I would expect.</p>\n\n<p>I have an MVC4 application that allows editing, adding and removal of team leaders from the collection.</p>\n\n<p>In my controller, I originally had the following:</p>\n\n<pre><code>    var original = context.UserProfiles\n        .Include(\"TeamLeaders\")\n        .Single(x =&gt; x.UserId == model.UserId);\n\n    context.Entry(original).CurrentValues.SetValues(model);\n</code></pre>\n\n<p>However, that last line was failing to mark the TeamLeaders collection as updated, and when I called SaveChanges(), no changes were recorded.</p>\n\n<p>Instead I wrote a simple CopyProperties method on my User class, which uses reflection to manually copy the properties across, so in my controller I now have:</p>\n\n<pre><code>    var original = context.UserProfiles\n        .Include(\"TeamLeaders\")\n        .Single(x =&gt; x.UserId == model.UserId);\n\n    //context.Entry(original).CurrentValues.SetValues(model);\n\n    original.CopyProperties(model);\n</code></pre>\n\n<p>However, this goes too far, and SaveChanges attempts to add a new user to the system matching the profile of the selected team leader.</p>\n\n<p>Can anyone advise as to which part of this I am doing wrong? I am not sure whether I need to update the mappings, or change the way I copy properties from the view model to the model</p>\n"},{"tags":["asp.net-mvc","entity-framework","asp.net-web-api"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":12437540,"title":"Don't get result from MVC Web API with EF, 504 Fiddler - Receive Failure","body":"<p>Im using the MVC Web API to expose my data out of my local database with Entity Framework 5. The database that I use is the Microsoft AdventureWorks2012 database.</p>\n\n<p>When I expose one entity, it all works fine and I see JSON result with Fiddler. But when I add multiple entities which have relationships and when I for instance want all the sales person and the stores which belong to the sales person (return context.SalesPerson.Include(Store)), I get the next message in Fiddler [Fiddler] ReadResponse() failed: The server did not return a response for this request., 504 Fiddler - Receive Failure.</p>\n\n<p>I dont now if I have to transform the entity to some type or set a feature in EF, anybody got a idea/solution?</p>\n"},{"tags":["entity-framework","nhibernate","orm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":123,"score":-1,"question_id":12380344,"title":"EF vs NHibernate vs Drapper ORM","body":"<p>I am trying to understand which ORM is fast in performance?</p>\n\n<ul>\n<li>NHibernate support Level 2 caching can we compare its performance with EF or Drapper?</li>\n<li>EF Code First looks promising, but do we have inbuilt Level 2 cache support for EF?  </li>\n<li>Don't know much about Drapper ORM</li>\n</ul>\n\n<p>Can someone please explains me pros and cons of this ORM and which one to choose for application performance boost.</p>\n"},{"tags":["entity-framework","ef-code-first","exists","any"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":69,"score":0,"question_id":12429185,"title":"Linq To Entities - Any VS First VS Exists","body":"<p>I am using Entity Framework and I need to check if a product with name = \"xyz\" exists ... </p>\n\n<p>I think I can use Any(), Exists() or First().</p>\n\n<p>Which one is the best option for this kind of situation? Which one has the best performance?</p>\n\n<p>Thank You,</p>\n\n<p>Miguel</p>\n"},{"tags":["asp.net-mvc","entity-framework","3-tier","layered"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":12437904,"title":"Good implementation approach for Layered application with 3-tier architecture?","body":"<p>I am developing an application using MVC3 and Entity Framework. Its a three layered approach with Presentation Layer hosted in Web Server and Business Layer and Data Access Layer in Application Server. We are not exposing the Object Context to Presentation Layer or Business Layer. Object Context is wrapped in Data Access Layer only and exposing data access and data persistence as functionalities as Data Access Layer methods(ie data access logic is separated and implemented in Data Access Layer only). Business Layer is calling data access layer methods and returns data to Presentation Layer.</p>\n\n<p>My concern is most of the Business Layer Methods are for just to access the data and it is just forwarding the call to Data Access Layer without any operation. So we are repeating the code in both layers. Do we have any other better approach to avoid this duplication.</p>\n\n<p>Is it a good practise to implement the data access logic in the business layer in Layered approach?</p>\n\n<p>Can someone suggest a good implementation approach for Layered application with 3-tier architecture?</p>\n"},{"tags":["c#",".net","entity-framework","mapping","code-first"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":83,"score":2,"question_id":12436087,"title":"Tricky Entity Framework one to one relationship","body":"<p>I have an app which records entries into different events of tennis tournaments. It also records who the winner was of each event</p>\n\n<p>The 2 classes in question are:</p>\n\n<pre><code>public class Event {\n  public int EventId { get; set; }\n  public string EventName { get; set; }\n  public virtual ICollection&lt;Entry&gt; Entries { get; set; }\n  public int? WinningEntryId { get; set; }\n\n  [ForeignKey(\"WinningEntryId\")]\n  public virtual Entry WinningEntry { get; set; }\n}\n\npublic class Entry {\n  public int EntryId { get; set; }\n  public int EventId { get; set; }\n\n  [ForeignKey(\"EventId\")]\n  public virtual Event Event { get; set; }\n}\n</code></pre>\n\n<p>Note that the Event.WinningEntryId column is nullable as I don't want to have to specify the winner as the tournament may still be in progress.</p>\n\n<p>Now, the problem is that when I run the Update-Database command, it generates the following tables:</p>\n\n<pre><code>Entry\n - EntryId\n - EventId\n - Event_EventId\n\nEvent\n - EventId\n - WinningEntryId\n</code></pre>\n\n<p>Why is EF generating the Event_EventId column in the Event table? I simply want the Event.WinningEntryId column to point to the Entry.EntryId column in a foreign key relationship.</p>\n\n<p>I must be doing this wrong somehow. Anybody know how I can accomplish this?</p>\n"},{"tags":["entity-framework","entity-framework-4","azure","ef-code-first","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":481,"score":1,"question_id":11963331,"title":"Azure EF Code First Migration Initializer","body":"<p>I am just messing with Azure, and I can't seem to get my Db to work.  I am following what it says here: <a href=\"https://www.windowsazure.com/en-us/develop/net/tutorials/web-site-with-sql-database/\" rel=\"nofollow\">https://www.windowsazure.com/en-us/develop/net/tutorials/web-site-with-sql-database/</a> and I updated my web.config to have this:</p>\n\n<pre><code>  &lt;entityFramework&gt;\n    &lt;defaultConnectionFactory type=\"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework\" /&gt;\n      &lt;contexts&gt;\n          &lt;context type=\"DownloadThis.Models.DownloadThisDb, DownloadThisDb\"&gt;\n              &lt;databaseInitializer type=\"System.Data.Entity.MigrateDatabaseToLatestVersion\"&gt;\n                  &lt;parameters&gt;\n                      &lt;parameter value=\"DownloadThisDb_DatabasePublish\" /&gt;\n                  &lt;/parameters&gt;\n              &lt;/databaseInitializer&gt;\n          &lt;/context&gt;\n      &lt;/contexts&gt;\n  &lt;/entityFramework&gt;\n</code></pre>\n\n<p>As is shown in the example, but I keep getting this error:</p>\n\n<blockquote>\n  <p>Format of the initialization string does not conform to specification\n  starting at index 0.</p>\n</blockquote>\n\n<p>I have triple checked my connectionString, so that isn't it - any ideas?</p>\n"},{"tags":["linq","entity-framework","collections","ef-code-first","extension-methods"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12437070,"title":"Linq extension methods - how to get list of items that are equal to items in my collection?","body":"<p>I have something like this:</p>\n\n<pre><code>public bool Function(IEnumerable&lt;MyObject&gt; MyObj)\n{\n    var context = new ContextDb();\n    var MyObjFromContext = context.MyObjects.Where(obj =&gt; obj == MyObj) //that does not compile!\n}\n</code></pre>\n\n<p>At commented section, i cannot do <code>obj == MyObj</code> comparison, because <code>obj</code> is a single item, and <code>MyObj</code> is a list of items.</p>\n\n<p>So how can i obtain <code>MyObjFromContext</code> that is equal to <code>MyObj</code>, but comes from context?</p>\n"},{"tags":["c#",".net","entity-framework","localization"],"answer_count":1,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":113,"score":1,"question_id":12436577,"title":"Modeling Localized Data in Entity Framework Code First","body":"<p>I'm trying to create a domain model that supports localization. I've looked at some SO questions that were asked before but I did not really like the solutions proposed. For example, in <a href=\"http://stackoverflow.com/questions/1668033/localized-tables-and-entity-framework\">this question</a> I think it's an overkill to create an additional entity for each and every entity that should support localized data. I'd rather have the localized data for all of my entities be in one entity whose sole purpose is to hold the localized data. </p>\n\n<p>My proposed solution is as follows:</p>\n\n<ol>\n<li><p>Create a <code>LocalizedEntity</code> class from which all of the entities that should support localization would inherit.</p></li>\n<li><p>Create a <code>LocalizedData</code> entity which will basically hold the actual localized values by culture.</p></li>\n</ol>\n\n<p><strong>UPDATE:</strong></p>\n\n<pre><code>public class LocalizedEntity\n{\n    public String Code { get; set; }\n}\n\npublic enum ResourceType\n{\n    CityName,\n    CityDescription,\n    StreetName,\n    AreaName\n    //others...\n}\n\npublic class LocalizedData\n{\n    public Int32 Id { get; set; }\n    public String Code { get; set; }\n    public ResourceType Type { get; set; }\n    public Int32 CultureId { get; set; }\n    public String Value { get; set; }\n}\n\npublic class City : LocalizedEntity\n{\n    public Int32 Id { get; set; }\n    public virtual ICollection&lt;Area&gt; Areas { get; set; }\n    //others\n}\n</code></pre>\n\n<p>Accordingly, the business layer will fetch the localized entity, and then go and get its localized value from the <code>LocalizedData</code> entity by <code>Code</code> and <code>ResourceType</code>. And of course, in order to avoid many round-trips to the database, some caching could be appropriate.</p>\n\n<p>Your thoughts?</p>\n"},{"tags":["nhibernate","entity-framework","merge","objectcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":852,"score":1,"question_id":2819070,"title":"Merge Function In Entity FrameWork?","body":"<p>In NHibernate there is a merge function that does the following:</p>\n\n<ul>\n<li>if there is a persistent instance with the same identifier currently associated with the session, copy the state of the given object onto the persistent instance</li>\n<li>if there is no persistent instance currently associated with the session, try to load it from the database, or create a new persistent instance</li>\n<li>the persistent instance is returned</li>\n</ul>\n\n<p>Is this possible in EF?  I mean this part : copy the state of the given object onto the persistent instance.  And if i used ApplyCurrentValues it seemes to be as update behavior or not?</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12431740,"title":"Is image type not supported in code first configuration any longer?","body":"<p>Using EF4.3 Code First with SQL Server 2008 R2 Express (version 10.0.5500).</p>\n\n<p>I am trying to set the <code>ColumnType</code> property in my model to instruct the database to use the <code>image</code> datatype for a column instead of the default <code>varbinary(max)</code>. I have tried using both data annotations <code>[Column(TypeName=\"image\")]</code> and the Fluent API: <code>.HasColumnType(\"image\")</code>.  </p>\n\n<p>Neither seems to work (although no exceptions generated), the type of the database column remains <code>varbinary(max)</code> after re-creation.</p>\n\n<p>All other configuration seems to work fine.</p>\n\n<p>Is this datatype no longer supported in Code First?  It seems to be still supported in SQL Server 2008 R2 Express if I look at the database in SSMS.</p>\n\n<p>Thanks</p>\n"},{"tags":["entity-framework","entity-framework-5"],"answer_count":2,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":551,"score":6,"question_id":12053627,"title":"How can I stop Entity Framework 5 migrations adding dbo. into key names?","body":"<p>I started a project using Entity Framework 4.3 Code First with manual migrations and SQL Express 2008 and recently updated to EF5 (in VS 2010) and noticed that now when I change something like a foreign key constraint, the migrations code adds the \"dbo.\" to the start of the table name and hence the foreign key name it constructs is incorrect for existing constraints (and in general now seem oddly named).</p>\n\n<p>Original migration script in EF 4.3 (note <strong>ForeignKey(\"Products\", t => t.Product_Id)</strong>):\n</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>    CreateTable(\n        \"Products\",\n        c =&gt; new\n            {\n                Id = c.Int(nullable: false, identity: true),\n                ProductName = c.String(),\n            })\n        .PrimaryKey(t =&gt; t.Id);\n\n    CreateTable(\n        \"KitComponents\",\n        c =&gt; new\n            {\n                Id = c.Int(nullable: false, identity: true),\n                Component_Id = c.Int(),\n                Product_Id = c.Int(),\n            })\n        .PrimaryKey(t =&gt; t.Id)\n        .ForeignKey(\"Products\", t =&gt; t.Component_Id)\n        .ForeignKey(\"Products\", t =&gt; t.Product_Id)\n        .Index(t =&gt; t.Component_Id)\n        .Index(t =&gt; t.Product_Id);\n</code></pre>\n\n<p>Foreign Key names generated: \nFK_KitComponents_Products_Product_Id\nFK_KitComponents_Products_Component_Id</p>\n\n<p>If I then upgrade to EF5 and change the foreign key the migration code looks something like (note the <strong>\"dbo.KitComponents\" and \"dbo.Products\"</strong> as opposed to just <strong>\"KitComponents\" and \"Products\"</strong>):</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>DropForeignKey(\"dbo.KitComponents\", \"Product_Id\", \"dbo.Products\");\nDropIndex(\"dbo.KitComponents\", new[] { \"Product_Id\" });\n</code></pre>\n\n<p>and the update-database fails with the message:\n'<strong>FK_dbo.KitComponents_dbo.Products_Product_Id</strong>' is not a constraint.\nCould not drop constraint. See previous errors.</p>\n\n<p>so it seems as of EF5 the constraint naming has changed from\nFK_KitComponents_Products_Product_Id\nto\nFK_dbo.KitComponents_dbo.Products_Product_Id (with dbo. prefix)</p>\n\n<p>How can I get EF5 to behave as it was in EF 4.3 so I don't have to alter every piece of new migration code it spits out?</p>\n\n<p>I haven't been able to find any release notes about why this changed and what to do about it :(</p>\n"},{"tags":["c#","entity-framework","datacontext","eager-loading"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":260,"score":3,"question_id":6136446,"title":"Can I define eager loading per datacontext instead per query?","body":"<p>Is there a way to define eager loading per entire data context, so I could state something like this -- \"when using this data context when loading Customer always load associated City as well\"?</p>\n\n<p>So, something very similar to Options and LoadWith in Linq to Sql.</p>\n"},{"tags":["entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12428757,"title":"Entity Framework 5 POCOs not included in TFS?","body":"<p>I'm working on project where we recently upgraded to Entity Framework 5.  After we upgraded I created a new .edmx model and moved all out entities over to the new model.  </p>\n\n<p>From what I can tell Entity Framework 5 runs of POCO objects.  The problem I'm having is that POCO objects don't seem to be included in source control.  If a new developer opens the solution it doesn't include any generated POCO objects.  To get around this we can right click \"MyModel.Context.tt\" and \"MyModel.tt\" and click \"run custom tool\" to generate the POCO objects.  So is there a way to include the POCO objects in tfs so we don't have to generate them when a new dev opens the solution?  </p>\n\n<p>UPDATE</p>\n\n<p>So I tried what a few people have suggested and use \"include in project\" but if I look at the the folder that contains the model in visual studio with the show all files options on none of the classes show up.  BUT if I look at the folder with windows explorer it shows all the files... what give?</p>\n"},{"tags":["asp.net","asp.net-mvc","entity-framework","oop"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12429913,"title":"Is it possible to map an entity to the result of a stored procedure in Entity Framework?","body":"<p>I'm attempting to setup Entity Framework using Code First on an existing database. The database isnt in great shape (poor naming convention and some constraints are needed). The application I'm building is an MVC app. I have a \"Model\", \"Repository\", and \"Web\" (mvc) tiers. </p>\n\n<p>To setup EF and map my model objects (POCO objects), is it required that I match my objects to database tables? Can I, instead, use my own stored procedures for CRUD operations? Would it help if I use WCF data services?</p>\n\n<p>I'm planning on using fluent configurations to map my objects, but having some issues due to the database schema. I'm know considering redesigning the database just to get EF to map correctly. Any suggestions would be greatly appreciated!!</p>\n"},{"tags":["c#","entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":12429312,"title":"Entity Framework: Code First. Shared and Instance context","body":"<p>I'm building a layered application using Entity Framework code first approach with an mvc4 web application, separated mainly in <code>Data</code>, <code>Services</code>, and <code>Web</code>.</p>\n\n<p>From my web I do this:</p>\n\n<pre><code>public void Foo() {\n    EntityService _svc = new EntityService();\n    Entity = _svc.FindById(1);\n}\n</code></pre>\n\n<p>The service method looks like this:</p>\n\n<pre><code>private readonly MyContext _ctx = new MyContext();\n\npublic Entity FindById(long id) {\n    return _ctx.Entities.SingleOrDefault(q =&gt; q.EntityId == id);\n}\n</code></pre>\n\n<p><strong>The problem is when I need to use more than one service because each service will create it's own context.</strong></p>\n\n<p>Trying to solve this I did something like this:</p>\n\n<pre><code>public class MyContext : DbContext {\n    private static MyContext _ctx;\n\n    public MyContext() : base(\"name=myConnectionString\") { }\n\n    public static MyContext GetSharedInstance() {\n        return GetSharedInstance(false);\n    }\n\n    public static MyContext GetSharedInstance(bool renew) {\n        if(_ctx == null || renew)\n            _ctx = new MyContext();\n\n        return _ctx;\n    }\n}\n</code></pre>\n\n<p>Changed my services as follows:</p>\n\n<pre><code>public class EntityService\n{\n    private readonly MyContext _ctx;\n\n    public bool SharedContext { get; private set; }\n\n    public EntityService()\n        : this(false) { }\n\n    public EntityService(bool sharedContext)\n        : this(sharedContext, false) { }\n\n    public EntityService(bool sharedContext, bool renew)\n    {\n        SharedContext = sharedContext;\n\n        if (SharedContext)\n            _ctx = MyContext.GetInstance(renew);\n        else\n            _ctx = new MyContext();\n    }\n}\n</code></pre>\n\n<p>Now if I want to share an instance of my context, I'd do something like this:</p>\n\n<pre><code>EntityService _entitySvc = new EntityService(true, true);\nAnotherEntityService _anotherEntitySvc = new AnotherEntityService(true);\n</code></pre>\n\n<p>Is this, at least, a decent way to overcome this? I'll appreciate any help provided. Thanks.</p>\n"},{"tags":["entity-framework","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":2,"question_id":12407579,"title":"inheritance for EF code first. mixture of TPH and TPT","body":"<p>Interesting inheritance for EF code first.  Do you think there is a mapping strategy that can make this work?</p>\n\n<p>So I have a base abstract class called Animal and 3 derived classes from the Animal class, Fish, Dog, and UnknownAnimal.  Animal class has a SQL table of its own, Fish and Dog has SQL table Fish and Dog respectively.  UnknownAnimal does not have any extra fields so there is no need a SQL table for this class.  To make it a bit easier, Animal SQL Table has a discriminator column (TypeName) to determine the Animal type.</p>\n\n<p>The codes and a picture of the SQL tables is below.  It is neither TPH or TPT but a mixture.  The only solution I see is to make it TPT, by creating a SQL table UnknownAnimal and point UnknownAnimal Class to use this table.  But I do not want to approach this way since UnknownAnimal does not have any extra property and is taking up space in the SQL server (not much).  </p>\n\n<p>Code for full test project with integration Nunit test and even database .bak file.\n<a href=\"https://bitbucket.org/RomeoQNgo/efinheritancetest/downloads\" rel=\"nofollow\">https://bitbucket.org/RomeoQNgo/efinheritancetest/downloads</a></p>\n\n<p>I tried TPT but that required an extra UnknownAnimal SQL table.  That mean if I have another class like UnknownAnimal (inherit from Animal but has no extra property) then I have to create a new table for it.  One easy approach would be have a discriminator field called something like TypeName in the Animal SQL Table and let that determine class type.  But then I dont want to use TPH because if there are more animal type with new property unique for that animal (like elephant with property like TrunkLength) then we have to create a new column in the Animals SQL table which I dont want to go this path unless there are no possible way.</p>\n\n<p>So I want to combine both TPH and TPT which use discriminator field (TypeName) to determine class type and extra table for the animals extra properties unique for that class.  I want to use Code First and do not want to use any EDMX file for this.</p>\n\n<p>I wonder if there are any good approach for this currently with EF Code First.  Thank you for your helps in advance.</p>\n\n<pre><code>public interface IEntity2\n{\n    string Creator { get; set; }\n}\n\npublic interface IEntity\n{\n    int Id { get; set; }\n    string DisplayName { get; set; }\n}\n\n[Table(\"Animals\")]\npublic abstract class Animal : IEntity, IEntity2\n{\n    public virtual int Id { get; set; }\n    public virtual string DisplayName { get; set; }\n    public virtual int TotalLegs { get; set; }\n    public string Creator { get; set; }\n}\n\n[Table(\"UnknownAnimals\")]\npublic class UnknownAnimal : Animal\n{\n    int test { get { return 1; } }\n}\n\n[Table(\"Fishes\")]\npublic class Fish : Animal\n{\n    public virtual int WaterType { get; set; }\n}\n\n[Table(\"Dogs\")]\npublic class Dog : Animal\n{\n    public virtual int FurLength { get; set; }\n}\n</code></pre>\n\n<p>The database diagram is:</p>\n\n<p><img src=\"http://i.stack.imgur.com/kKnzD.png\" alt=\"http://i.stack.imgur.com/4JiCJ.png\"></p>\n"},{"tags":["linq","entity-framework","linq-to-entities","many-to-many"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12426940,"title":"LINQ query in EF - many to many and a cross join","body":"<p>A simple stored procedure that I want to handle with LINQ instead:</p>\n\n<pre><code>SELECT \nCASE  WHEN mg.MovieID IS NULL THEN 0 else 1 end as Selected ,\ng.genreID, g.GenreName\nFROM dbo.Genres g LEFT JOIN \n(\n    SELECT MovieID, GenreID FROM [dbo].[MovieGenre] m \n    WHERE m.MovieID = @Movie\n) MG \nON g.[GenreID]  = mg.[GenreID]\nORDER BY g.GenreName\n</code></pre>\n\n<p>I think this should be simple and I think it would be a common requirement, yet I can't figure it out nor have I found a solution via searching the web.  </p>\n\n<p>The app is in WPF backed by an EF model.  Since EF hides the join table I need LINQ syntax that can deal with the absence of the intermediary table.</p>\n\n<p>Classic many-to-many with a simple join table: table 1:Movies, table 2: Genres, Join table: MovieGenres.  In the UI the user selects a specfic movie.  For that movie I want to bring back ALL the genres and a bool value indicating whether the genre has been assigned to the movie.  Hours of attempting this in LINQ have failed me, so the solution is currently to have the stored procedure above generate the values for me.  I won't always be abe to do this with a stored procedure and would love to see a LINQ solution.</p>\n\n<p>Here's the actual SQL table structures</p>\n\n<pre><code>CREATE TABLE [dbo].[Genres](\n    [GenreID] [int] IDENTITY(1,1) NOT NULL,\n    [GenreName] [nvarchar](15) NOT NULL,\n CONSTRAINT [PK_Genres] PRIMARY KEY CLUSTERED \n(\n    [GenreID] ASC\n)) ON [PRIMARY]\n\nGO  \n\nCREATE TABLE [dbo].[Movies](\n    [MovieID] [int] IDENTITY(1,1) NOT NULL,\n    [MovieTitle] [nvarchar](50) NOT NULL,\n CONSTRAINT [PK_Movies] PRIMARY KEY CLUSTERED \n(\n    [MovieID] ASC\n))\nON [PRIMARY]\nGO\n\nCREATE TABLE [dbo].[MovieGenre](\n    [MovieID] [int] NOT NULL,\n    [GenreID] [int] NOT NULL,\n CONSTRAINT [PK_MovieGenre] PRIMARY KEY CLUSTERED \n(\n    [MovieID] ASC,\n    [GenreID] ASC\n)) ON [PRIMARY]\nGO\n\nALTER TABLE [dbo].[MovieGenre]  WITH CHECK ADD  CONSTRAINT [FK_Genres] FOREIGN KEY([GenreID])\nREFERENCES [dbo].[Genres] ([GenreID])\nGO\nALTER TABLE [dbo].[MovieGenre] CHECK CONSTRAINT [FK_Genres]\nGO\nALTER TABLE [dbo].[MovieGenre]  WITH CHECK ADD  CONSTRAINT [FK_Movies] FOREIGN KEY([MovieID])\nREFERENCES [dbo].[Movies] ([MovieID])\nGO\nALTER TABLE [dbo].[MovieGenre] CHECK CONSTRAINT [FK_Movies]\nGO\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","mini-profiler"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12405233,"title":"profiling asp.net mvc4 code first","body":"<p>I made a new asp.net mvc4 app and then installed miniprofiler.</p>\n\n<p>then i just enabled-migration and after adding migration i updated my database.</p>\n\n<p>using miniprofiler i found out there are 3 sql queries that i don't know about them.</p>\n\n<p>i don't know where this initialization take place </p>\n\n<pre><code> InitializeDatabase &lt;PerformDatabaseInitialization&gt;b__6 PerformInitializationAction PerformDatabaseInitialization\n</code></pre>\n\n<p>here is a picture of the miniprofiler <img src=\"http://i.stack.imgur.com/FBkgq.jpg\" alt=\"miniprofiler\"></p>\n\n<p>what are these 3 sql queries? where they come from?</p>\n"},{"tags":["c#","wcf","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":488,"score":0,"question_id":11743708,"title":"\"The underlying provider failed on Open\"","body":"<p>I keep getting this error when trying to open a connection using entity framework.\nI can update the model from the database with no problems at all, but when I run the code in debug it gives this error.\n(Running on a Windows 2008 VM)</p>\n\n<p>The code fragment where the error appears looks like this:</p>\n\n<pre><code>public partial class SpatialDatabase : global::System.Data.Objects.ObjectContext\n{\n    try\n    {\n        using (EntityConnection conn = new EntityConnection(this.Connection.ConnectionString))\n        {\n            conn.Open(); // &lt;== fails here\n\n            EntityCommand cmd = conn.CreateCommand();\n            ...\n</code></pre>\n\n<p>This is connection to an Oracle database.</p>\n\n<p>This code is apparently running ok elsewhere so I have a feeling it is to do with the connection.\nWe are using an Oracle for .NET (ODAC) driver. I have no idea whether it's 64 or 32 bit, but it works when updating the model but not when run in debug.</p>\n\n<p>(I would show additional code if I knew what to show!)</p>\n\n<p>Connection string from app.config:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n  &lt;add name=\"SpatialDatabaseContext\" connectionString=\"metadata=res://*/SpatialDatabase.csdl|res://*/SpatialDatabase.ssdl|res://*/SpatialDatabase.msl;provider=Oracle.DataAccess.Client;provider connection string=&amp;quot;DATA SOURCE=ds_name_here;PASSWORD=password_here;PERSIST SECURITY INFO=True;USER ID=user_id_here&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>[Edit]</p>\n\n<pre><code>System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)\n</code></pre>\n\n<p>[/Edit]</p>\n\n<p>[Edit2]</p>\n\n<p>The above might be a red herring. I ran it again and didn;t see that error, but I did see this InnerException:</p>\n\n<pre><code>[Oracle.DataAccess.Client.OracleException] = {\"ORA-12154: TNS:could not resolve the connect identifier specified\"}\n</code></pre>\n\n<p>[/Edit2]</p>\n\n<p>[Edit 3]</p>\n\n<p>I tried to use the EFOracleProvider instead.\nIt builds ok, but when I go to generate the entity model I get this:</p>\n\n<pre><code>Microsoft (R) EdmGen version 3.5.0.0\nCopyright (C) 2008 Microsoft Corporation. All rights reserved.\n\nerror 7001: The provider did not return a ProviderManifestToken string.\nAttempt to load Oracle client libraries threw BadImageFormatException. This problem will occur when running in 64 bit mode with the 32 bit Oracle client components installed.\nAn attempt was made to load a program with an incorrect format. (Exception from HRESULT: 0x8007000B)\n\nGeneration Complete -- 1 errors, 0 warnings\n</code></pre>\n\n<p>I have both 32 bit and 64 bit versions of the Oracle client components installed.\nHow do I choose whether to run 32 bit or 64 bit??</p>\n\n<p>[/Edit3]</p>\n"},{"tags":["c#","wpf","sql-server","entity-framework","exception"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12425212,"title":"EntityFramework Exception : New transaction is not allowed because there are other threads running in the session","body":"<p>I am using ServiceBrokerClass which i got from <a href=\"http://www.codeproject.com/KB/database/autorefresh_ef_ssb.aspx\" rel=\"nofollow\">CodeProject</a>. But now when i try to save any record into database using EnityFramework and .Net WPF. I am getting the following error.</p>\n\n<p>ServiceBrokerUtility Class :</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Data.Objects;\nusing System.Collections;\nusing System.Data.SqlClient;\nusing System.Runtime.Remoting.Messaging;\nusing System.Collections.Specialized;\n\nnamespace JIMS.UtilityClasses\n{\n    // see http://www.codeproject.com/KB/database/autorefresh_ef_ssb.aspx\n    public static class ServiceBrokerUtility\n    {\n        private static readonly List&lt;string&gt; connectionStrings = new List&lt;string&gt;();\n        private const string sqlDependencyCookie = \"MS.SqlDependencyCookie\";\n        private static ObjectContext objectContext;\n        private static RefreshMode refreshMode;\n        private static readonly Dictionary&lt;string, IEnumerable&gt; collections = new Dictionary&lt;string, IEnumerable&gt;();        \n\n        static public void AutoRefresh(this ObjectContext objectContext, RefreshMode refreshMode, IEnumerable collection)\n        {                        \n            string efConnStr=System.Configuration.ConfigurationManager.ConnectionStrings[objectContext.Connection.ConnectionString.Replace(\"name=\", \"\").Trim()].ConnectionString;\n            string dbConnectionString = new System.Data.EntityClient.EntityConnectionStringBuilder(efConnStr).ProviderConnectionString;\n            if (!connectionStrings.Contains(dbConnectionString))\n            {\n                connectionStrings.Add(dbConnectionString);\n                SqlDependency.Start(dbConnectionString);\n            }\n            ServiceBrokerUtility.objectContext = objectContext;\n            ServiceBrokerUtility.refreshMode = refreshMode;\n            AutoRefresh(collection);\n        }\n\n        /// &lt;summary&gt;\n        /// Stops the auto refresh.\n        /// &lt;/summary&gt;\n        /// &lt;param name=\"collection\"&gt;The collection.&lt;/param&gt;\n        static public void StopAutoRefresh(IEnumerable collection)\n        {\n            var kvp = collections.FirstOrDefault(x =&gt; x.Value == collection);\n            if (!kvp.Equals(new KeyValuePair&lt;string, IEnumerable&gt;()))\n                collections.Remove(kvp.Key);\n        }\n\n        static private void AutoRefresh(IEnumerable collection)\n        {\n            var oldCookie = CallContext.GetData(sqlDependencyCookie);\n            try\n            {\n                var dependency = new SqlDependency();\n                collections.Add(dependency.Id, collection);\n                CallContext.SetData(sqlDependencyCookie, dependency.Id);\n                dependency.OnChange += dependency_OnChange;\n                objectContext.Refresh(refreshMode, collection);\n            }\n            finally\n            {\n                CallContext.SetData(sqlDependencyCookie, oldCookie);\n            }\n        }\n\n        static void dependency_OnChange(object sender, SqlNotificationEventArgs e)\n        {\n            if (e.Info == SqlNotificationInfo.Invalid)\n            {                \n                return;\n            }\n            try\n            {\n                var id = ((SqlDependency)sender).Id;\n                IEnumerable collection;\n                if (collections.TryGetValue(id, out collection))\n                {\n                    collections.Remove(id);\n                    AutoRefresh(collection);\n                    var notifyRefresh = collection as INotifyRefresh;\n                    if (notifyRefresh != null)\n                        System.Windows.Application.Current.Dispatcher.BeginInvoke(\n                         (Action)(notifyRefresh.OnRefresh));\n                }\n            }\n            catch (Exception ex)\n            {\n                System.Diagnostics.Debug.Print(\"Error in OnChange: {0}\", ex.Message);\n            }\n        }\n    }\n    public interface INotifyRefresh : INotifyCollectionChanged\n    {\n        void OnRefresh();\n    }\n}\n</code></pre>\n\n<p>AutoRefreshCollection Class :</p>\n\n<pre><code>namespace JIMS.UtilityClasses\n{\n    public class AutoRefreshCollection&lt;T&gt; : IEnumerable&lt;T&gt;, INotifyRefresh\n        where T : EntityObject\n    {\n        public IEnumerable&lt;T&gt; objectQuery;\n        public AutoRefreshCollection(ObjectQuery&lt;T&gt; objectQuery, RefreshMode refreshMode)\n        {\n            this.objectQuery = objectQuery;\n            objectQuery.Context.AutoRefresh(refreshMode, this);\n        }\n\n        public void StopAutoRefresh()\n        {\n            ServiceBrokerUtility.StopAutoRefresh(this);\n        }\n\n        public IEnumerator&lt;T&gt; GetEnumerator()\n        {\n            return objectQuery.GetEnumerator();\n        }\n\n        IEnumerator IEnumerable.GetEnumerator()\n        {\n            return this.GetEnumerator();\n        }\n\n        public void OnRefresh()\n        {\n            try\n            {\n                if (this.CollectionChanged != null)\n                    CollectionChanged(this,\n                      new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));\n\n            }\n            catch (Exception ex)\n            {\n                System.Diagnostics.Debug.Print(\"Error in OnRefresh: {0}\", ex.Message);\n            }\n        }\n\n        public event NotifyCollectionChangedEventHandler CollectionChanged;\n    }\n}\n</code></pre>\n\n<p>My Code :</p>\n\n<pre><code>public void Create()\n{\n    try\n    {\n        dbContext.AddToLedgers(\n            new JIMSDAL.Ledger\n            {\n                LedgerName = LedgerName,\n                Group = LedgerGroup,\n                Street = Street,\n                City = City,\n                PinCode = PinCode,\n                State = State,\n                Phone = Phone,\n                TIN = TIN,\n                Balance = Balance\n            }\n        );                \n        dbContext.SaveChanges();\n        JIMSMessage.Show(\"Ledger Created Successfully.\");\n        Clear();\n    }\n}\n</code></pre>\n\n<p>Can anyone help me on this.</p>\n\n<p>Inner Exception Stack Trace :</p>\n\n<pre><code> at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\n   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\n   at System.Data.SqlClient.TdsParser.TdsExecuteTransactionManagerRequest(Byte[] buffer, TransactionManagerRequestType request, String transactionName, TransactionManagerIsolationLevel isoLevel, Int32 timeout, SqlInternalTransaction transaction, TdsParserStateObject stateObj, Boolean isDelegateControlRequest)\n   at System.Data.SqlClient.SqlInternalConnectionTds.ExecuteTransactionYukon(TransactionRequest transactionRequest, String transactionName, IsolationLevel iso, SqlInternalTransaction internalTransaction, Boolean isDelegateControlRequest)\n   at System.Data.SqlClient.SqlInternalConnectionTds.ExecuteTransaction(TransactionRequest transactionRequest, String name, IsolationLevel iso, SqlInternalTransaction internalTransaction, Boolean isDelegateControlRequest)\n   at System.Data.SqlClient.SqlInternalConnection.BeginSqlTransaction(IsolationLevel iso, String transactionName)\n   at System.Data.SqlClient.SqlInternalConnection.BeginTransaction(IsolationLevel iso)\n   at System.Data.SqlClient.SqlConnection.BeginDbTransaction(IsolationLevel isolationLevel)\n   at System.Data.Common.DbConnection.BeginTransaction(IsolationLevel isolationLevel)\n   at System.Data.EntityClient.EntityConnection.BeginDbTransaction(IsolationLevel isolationLevel)\n</code></pre>\n"},{"tags":["asp.net-mvc","entity-framework","ef-code-first","asp.net-mvc-4","poco"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12425789,"title":"Entity Framework - Best way to tie one -> many relation","body":"<p>I want to add images to my item using POCO approach. In order for everything to work I need to modify my view/controller.</p>\n\n<h2>Item</h2>\n\n<pre><code>namespace POCOExample.Models\n{\n    public class Item\n    {\n        public int ID { get; set; }\n        public string Name { get; set; }\n        public string Info { get; set; }\n        public List&lt;Image&gt; Images { get; set; }\n    }\n}\n</code></pre>\n\n<p>Image</p>\n\n<pre><code>namespace POCOExample.Models\n{\n    public class Image\n    {\n        public int ID { get; set; }\n        public int ItemID { get; set; }\n        public Item Item { get; set; }\n        public string FileName { get; set; }\n    }\n}\n</code></pre>\n\n<h2>Controller Create(POST) action</h2>\n\n<pre><code>[HttpPost]\npublic ActionResult Create(Item item, List&lt;HttpPostedFileBase&gt; iamges)\n{\n    if (ModelState.IsValid)\n    {\n        // Added code START\n        foreach (var image in images)\n        {\n            item.Images.Add(new Image {\n                FileName = Infrastructure.Image.Upload(image) // Returns file name, just what I need\n            });\n        }\n        // Added code END\n\n        db.Items.Add(item);\n        db.SaveChanges();\n        return RedirectToAction(\"Index\");\n    }\n\n    return View(item);\n}\n</code></pre>\n\n<h2>Question</h2>\n\n<p>This code works, however I wonder if I'm doing this is the most optimal/correct way?</p>\n"},{"tags":["c#","asp.net","entity-framework","ef-code-first","asp.net-membership"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":12425708,"title":"How can I reference User Information off the SimpleMembership Provider","body":"<p>Using EF-Code-First I want to set up a DB table that is related (1-1) to the inbuilt Simple Membership provider that comes OOTB with ASP.Net 4.0+</p>\n\n<p>The UserProfile class in AccountModels.cs is a simple 2 field class:</p>\n\n<pre><code>[Table(\"UserProfile\")]\npublic class UserProfile\n{\n    [Key]\n    [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]\n    public int UserId { get; set; }\n    public string UserName { get; set; }\n}\n</code></pre>\n\n<p>My class with other user info I want to keep separate has this format:</p>\n\n<pre><code>[Table(\"UserInfo\")]\npublic class UserInfo\n{\n    [Key]\n    public int ID { get; set; }\n    &lt;user info fields here...&gt;\n    public virtual UserProfile UserProfile { get; set; }\n}\n</code></pre>\n\n<p>The Context is:</p>\n\n<pre><code>public class UsersContext : DbContext\n{\n    public UsersContext()\n        : base(\"DefaultConnection\")\n    {\n    }\n    public DbSet&lt;UserProfile&gt; UserProfiles { get; set; }\n    public DbSet&lt;UserInfo&gt; UsersInfo { get; set; }\n\n    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity&lt;UserInfo&gt;()\n                    .HasRequired(u =&gt; u.UserProfile)\n                    .WithRequiredPrincipal();\n    }\n}\n</code></pre>\n\n<p>Now, without changing anything else, when I run the app, the models build fine, but I'm getting a error when <code>WebSecurity.CreateUserAndAccount(model.UserName, model.Password);</code> runs (Acct Controller Line 82). <code>The INSERT statement conflicted with the FOREIGN KEY constraint \"UserInfo_UserProfile\".</code></p>\n\n<p>What is the (assumed) preferred method of storing user information that I want to be able to reference directly from the DB later (ie. not in blobs as per the old Profile provider)</p>\n\n<p>How do I set this up using EF-CodeFirst as opposed to running everything through a repository layer? Should I just go the repository route?</p>\n\n<p>I had trouble getting azureSQL to include more columns in the UserProfile table when I tested that method, so would like to keep the userInfo stuff out of UserProfile.</p>\n\n<p>Thanks</p>\n"},{"tags":[".net","entity-framework","inheritance","entity-framework-4"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":358,"score":0,"question_id":2270789,"title":"EF 4.0 Code only assocation from abstract to derived","body":"<p>Using EF 4.0 Code only i want to make an assocation between an abstract and normal class.</p>\n\n<p>I have class 'Item', 'ContentBase' and 'Test'.</p>\n\n<p>'ContentBase' is abstract and 'Test' derives from it.</p>\n\n<p>'ContentBase' has a property 'Item' that links to an instance of 'Item'.</p>\n\n<p>So that 'Test.Item' or any class that derives from 'ContentBase' has an 'Item' navigation property.</p>\n\n<p>In my DB every record for Test has a matching record for Item.</p>\n\n<hr>\n\n<pre><code>public class Item\n{\n    public int Id { get; set;}\n}\n\npublic abstract class ContentBase\n{\n    public int ContentId { get; set;}\n    public int Id { get; set;}\n\n    public Item Item { get; set;}\n}\n\npublic class Test : ContentBase\n{\n    public string Name { get; set;}\n}\n</code></pre>\n\n<p>now some init code</p>\n\n<pre><code>public void SomeInitFunction()\n{\n\n    var itemConfig = new EntityConfiguration&lt;Item&gt;();\n    itemConfig.HasKey(p =&gt; p.Id);\n    itemConfig.Property(p =&gt; p.Id).IsIdentity();\n    this.ContextBuilder.Configurations.Add(itemConfig);\n\n    var testConfig = new EntityConfiguration&lt;Test&gt;();\n    testConfig.HasKey(p =&gt; p.ContentId);\n    testConfig.Property(p =&gt; p.ContentId).IsIdentity();\n\n    // the problem \n    testConfig.Relationship(p =&gt; p.Item).HasConstraint((p, q) =&gt; p.Id == q.Id);\n\n    this.ContextBuilder.Configurations.Add(testConfig);  \n}\n</code></pre>\n\n<p>This gives an error:\nA key is registered for the derived type 'Test'. Keys must be registered for the root type 'ContentBase'.</p>\n\n<p>anyway i try i get an error. What am i a doing wrong?</p>\n"},{"tags":["c#","wcf","visual-studio","entity-framework","race-condition"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12421893,"title":"Multithreaded WCF Server with Entity Framework: transactions and synchronization, race condition","body":"<p>I have multithreaded C# WCF server with resources stored in database.\nI'm accessing db with EF.</p>\n\n<p>Server is handling requests from many workers.\nWorkers are connected in groups.\nEach group has his own resources in database.\nSome group has some resources shared with another group.</p>\n\n<p>All requests are about resources: synchronization, creating, updating, deleting.</p>\n\n<p>I have a problem with race condition:\nIf workers A and B are with the same group, worker A request some update, then B request synchronization, and B's request would start and end before A's request will end, then worker B would never get A's update.</p>\n\n<p>Is there any way with entity framework to do atomic operations like <code>get_and_increase_if</code>?\nI would like to implement semaphore like tool on database value.</p>\n\n<p>Is there any other way to resolve this problem?</p>\n\n<p>Synchronization is done by revision counter.\nGroup has revision.\nCreating/Updating is done by:</p>\n\n<ol>\n<li><code>Increase group revision()</code></li>\n<li><code>Set new/updated object revision to new group revision()</code></li>\n</ol>\n\n<p>Edit: There are many resources types, each in its own table in db. So I can't just set next value as revision for resource.</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":12424353,"title":"An object that has a key that matches the key of the supplied object could not be found in the ObjectStateManager","body":"<p>I Use following code</p>\n\n<pre><code>Tel_CallHistory CallHistory = new Tel_CallHistory();\n\n\n                     CallHistory.MobileNo = MobileNo;\n                     CallHistory.CRId = CallResponse;\n                     CallHistory.CallRemark = CallRemark;\n                     CallHistory.UserId = UserId;\n                     CallHistory.CallDate = DateTime.Now;\n                     CallHistory.CallTime = DateTime.Now.TimeOfDay;\n\n                     CallHistory.MeetingPoint = meetingpoint;\n                     if (CallResponse == 1)\n                     {\n                         CallHistory.NCallDateOn = null;\n                         CallHistory.NCallTimeAt = null;\n                         CallHistory.MeetingDate = Convert.ToDateTime( meetingdate);\n\n                         CallHistory.MeetingTime =  DateTime.Parse(meetingtime).TimeOfDay;\n                     }\n                     else\n                     {\n\n                         CallHistory.NCallDateOn =  Convert.ToDateTime(NCallDateOn);\n\n                         CallHistory.NCallTimeAt =  DateTime.Parse(NCallTimeAt).TimeOfDay;  \n\n                         CallHistory.MeetingDate = null;\n                         CallHistory.MeetingTime = null;\n                     }\n\n\n                     db.Tel_CallHistory.AddObject(CallHistory);\n\n\n                     Tel_Mobile TelMobile = _teacher.getDB().Tel_Mobile.Single(a =&gt; a.MobileNo == MobileNo);\n                     TelMobile.CallDate = CallHistory.NCallDateOn;\n                     TelMobile.CallTime = CallHistory.NCallTimeAt;\n\n                     TelMobile.LCallDateOn = CallHistory.CallDate;\n                     TelMobile.LCallTimeAt = CallHistory.CallTime;\n                     TelMobile.LCRId = CallHistory.CRId;\n                     TelMobile.LCallRemark = CallHistory.CallRemark;\n                     TelMobile.LMeetingPoint = CallHistory.MeetingPoint;\n                     TelMobile.LMeetingDate = CallHistory.MeetingDate;\n                     TelMobile.LMeetingTime = CallHistory.MeetingTime;\n\n                      db.Tel_Mobile.ApplyOriginalValues(TelMobile);\n\n\n                     db.SaveChanges();\n\n\n\n                     db.AcceptAllChanges();\n</code></pre>\n\n<p>but when <code>db.Tel_Mobile.ApplyOriginalValues(TelMobile)</code> executes, show error </p>\n\n<blockquote>\n  <p>An object that has a key that matches the key of the supplied object\n  could not be found in the ObjectStateManager. Verify that the object\n  to which changes must be applied is not in the Added state and that\n  its key values match the key values of the supplied object.</p>\n</blockquote>\n"},{"tags":["c#",".net","entity-framework","ef-code-first"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12425490,"title":"Issue creating a database from a xml file","body":"<p>I have an issue creating a database from a xml file.</p>\n\n<p>I am monitoring a directory for a specific file, when this file is updated I call my method.</p>\n\n<p>Everytime I run my code it works as intended (only) the first time, but when my method is called the second time, I get the following exception:</p>\n\n<p>[System.Data.SqlClient.SqlException] = {\"Cannot open database \\\"MyDatabase\\\" requested by the login. The login failed.\\r\\nLogin failed for user 'DOM\\myuseraccount'.\"}</p>\n\n<pre><code>public bool ImportXmlToDatabase(string filename)\n    {\n      try\n      {\n        var path = Assembly.GetExecutingAssembly().Location;\n        filename = path.Substring(0, path.LastIndexOf('\\\\') + 1) + filename;\n        if (!File.Exists(filename))\n        {\n          Log(LogMessageType.Warning, \"File didn't exist: \" + filename);\n          return false;\n        }\n        using (var inputStream = new FileStream(filename, FileMode.Open))\n        {\n          var serializer = new DataContractSerializer(typeof(IChangeTrackingEntity), new List&lt;Type&gt;(), int.MaxValue, false, true /* preserveObjectReferences */, null, new SharedTypeResolver());\n          Database.Delete(\"MyDatabase\");\n          using (var repository = new DbRepository(\"MyDatabase\"))\n          {\n            var list = (IEnumerable)serializer.ReadObject(inputStream);\n            foreach (dynamic obj in list)\n            {\n              repository.Insert(obj);\n            }\n            repository.SaveChanges();\n          }\n        }\n        return true;\n      }\n      catch (Exception exc)\n      {\n        Log(LogMessageType.Error, \"Did not manage to import data from the xml to the database. The following error occured: \" + exc);\n        return false;\n      }\n    }\n</code></pre>\n"},{"tags":["c#","sql","entity-framework","entity-framework-5","code-first-migrations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":133,"score":0,"question_id":12418144,"title":"Is there a good way to extend the Code-First Migrations","body":"<p>I am starting a new project that uses Entity Framework.  I have researched my options for how to create the database and found Code-First Migrations make the most sense (see bottom if you need to know why).  Code-First Migrations lets me drop down to arbitrary SQL meaning I still have full control.  In practice I found that issue is that dropping down to SQL seems terribly repetitive for some of the common tasks.</p>\n\n<p>For my purposes, I do not care that extensions in the migration be provider agnostic (the SQL I am in-lining is not).  However, I am not really finding a good seam or extension point in the migrations framework for adding such things.</p>\n\n<p>To give a concrete example, suppose I want to specify a RowGuid column for MS-SQL replication.  Every occurance takes the form of</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>Sql(\n    string.Format(\n        \"Alter Table {0} Alter Column {1} Add ROWGUIDCOL\",\n        table,\n        column ));\n</code></pre>\n\n<p>So I write static methods to get rid of some of the redundancy</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>Sql( MigrationHelper.SetRowGuid( table, column );\n</code></pre>\n\n<p>-or-</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>MigrationHelper.SetRowGuid(Sql, table, column); //passing the Sql method\n</code></pre>\n\n<p>Possibly could make either of those extension methods on DbMigration, and access them by <code>this.</code>  But still this looks out of place:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>CreateTable(\n    \"dbo.CustomerDirectory\",\n     c =&gt; new\n         {\n             Uid = c.Int(nullable: false),\n             CustomerUid = c.Int(nullable: false),\n             Description = c.String(nullable: false, maxLength: 50, unicode: false),\n             RowGuid = c.Guid(nullable: false),\n         })\n     .PrimaryKey(t =&gt; t.Uid)\n     .ForeignKey(\"dbo.Customer\", t =&gt; t.CustomerUid);\n\nthis.SetRowGuid( Sql, \"dbo.CustomerDirectory\", \"RowGuid\" );\n//Custom method here because of desired naming convention of Constraint\nthis.SetDefaultConstraint( Sql, \"dbo.CustomerDirectory\", \"''\" ):\n</code></pre>\n\n<p>It is not terribly, but it still feels like a hack to me.  I have I have to repeat the table name, and I need to make sure I get the generated column name right. I find the table name needs to be repeated a lot, but so do columns.  Yet what I am really trying to do as add onto the table declaration that just happened where both table name and column names were all known.</p>\n\n<p>I, however, could not find a good extension point for extending the fluent interface or otherwise extending the code first migrations in a way that feels consistent.  Am I missing something?  Has anyone founds a good way of doing this?</p>\n\n<p>Some justification as to why I am in this situation:</p>\n\n<p>I did not like the what seemed like a common solution of using common custom attributes solution to indicate non-mapping database for a few reasons, but most strongly because they are not automatically picked up by migrations meaning extra maintenance.  Model-first solutions were out out because they does not give full control over the database.  Database-First was appealing because of the control; however, it does does not have the out-of-the-box change management functionality Code-First Migrations provides.  Thus, Code-First Migrations seemed to be a winner because [code-first] model-driven changes are automatic and it meant there would be only one thing to maintain.</p>\n"},{"tags":["asp.net-mvc","entity-framework","unit-testing"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":68,"score":2,"question_id":12424379,"title":"Create a fake DbContext","body":"<p>I am creating an MVC application with EF and currently have used the generic repository pattern, like this one: <a href=\"http://www.tugberkugurlu.com/archive/generic-repository-pattern-entity-framework-asp-net-mvc-and-unit-testing-triangle\" rel=\"nofollow\">Generic Repository Pattern</a>. Everything worked great except for the fact that for each repository a new context was created and working with two or more repositories is needed in my application. As I am using StructureMap I added </p>\n\n<pre><code>x.For&lt;IDbContext&gt;().HttpContextScoped().Use(context =&gt; new MyContext());\n</code></pre>\n\n<p>where IDbContext has the respective methods and is no longer generic but is passed through the constructor.</p>\n\n<p>The problem comes when I have to test things - I want to create an in memory storage (faster than db, custom, easy to control data), something like a HashTable or HashSet for example. What I cannot figure out is how to make a fake implementation of IDbContext that retreives the data from that HashTable. For reference IDbContext looks like this (only the methods used by the DbContext in the generic repository):</p>\n\n<pre><code>    public interface IDbContext : IDisposable\n    {\n        IDbSet&lt;TEntity&gt; Set&lt;TEntity&gt;() where TEntity : class;\n        DbEntityEntry&lt;TEntity&gt; Entry&lt;TEntity&gt;(TEntity entity) where TEntity : class;\n        int SaveChanges();\n    }\n</code></pre>\n\n<p>In the current situation I suppose I have made a major mistake as creating a fake context does not seem to be a regular routine. Any advices on how to improve the architecture of my application and make it more testable are appreciated.</p>\n"},{"tags":["c#",".net","entity-framework","entity-framework-4"],"answer_count":5,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":340,"score":7,"question_id":10745859,"title":"Entity Framework Traverse and return child records in self reference table","body":"<p>I am using Entity Framework and have a table of BusinessUnits which can reference another record of the same type to form a child-parent hierarchy.</p>\n\n<p>I also have a set of users, and user permissions, where each user defined in this table should have access to the BusinessUnit and all sub-business units in the hierarchy. Users should not have access to the BusinessUnit above the one referenced (if exists).</p>\n\n<p>How can I go about forming LINQ queries to handle this self-referencing relationship tree and return all the business units (with child units) for which this user has access? Is it possible to do it in one query, or do I need to manually build the tree myself with a for-loop?</p>\n\n<p>I have seen schema's reference in this way from node to parent, does this mean I have to start at the furthest child node to build the tree by one parent at a time?</p>\n\n<p>Thanks in advance,</p>\n\n<p>Chris</p>\n\n<pre><code>class BusinessUnit\n{\n    int BusinessUnitID {get;set;}\n    public string BusinessName {get;set;}\n    BusinessUnit ParentBusinessUnit {get;set;}\n}\n\nclass User\n{\n    int UserID {get;set;}\n    string Firstname {get;set;}\n}\n\nclass UserPermissions\n{\n    [Key, ForeignKey(\"BusinessUnit\"), Column(Order = 0)] \n    BusinessUnit BusinessUnit {get;set;}\n    [Key, ForeignKey(\"User\"), Column(Order = 1)] \n    User User {get;set;}\n}\n\nIEnumerable&lt;BusinessUnit&gt; GetUnitsForWhichUserHasAccess(User user)\n{\n/* Example 1\n given: BusinessUnitA (ID 1) -&gt; BusinessUnitB (ID 2) -&gt; BusinessUnitC (ID 3)\n with user with ID 1:\n and UserPermissions with an entry: BusinessUnit(2), User(1)\n the list { BusinessUnitB, BusinessUnitC } should be returned\n*/\n\n/* Example 2\n given: BusinessUnitA (ID 1) -&gt; BusinessUnitB (ID 2) -&gt; BusinessUnitC (ID 3)\n with user with ID 1:\n and UserPermissions with an entry: BusinessUnit(1), User(1)\n the list { BusinessUnitA, BusinessUnitB, BusinessUnitC } should be returned\n*/\n}\n</code></pre>\n"},{"tags":["c#","sql-server","sql-server-2008","entity-framework","sqlparameters"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":194,"score":1,"question_id":12023443,"title":"Entity Framework. ExecuteStoreQuery Error converting data type varchar to real","body":"<p>I'm trying to execute a story query with Entity Framework.</p>\n\n<p>I've been trying this for ages. The data type I'm passing in starts off as double. I then found that real in SQL was a single, so I convert to single.</p>\n\n<p>(radius is an int)</p>\n\n<p>But I get this error.</p>\n\n<p>Error converting data type varchar to real.</p>\n\n<pre><code>var query = context.ExecuteStoreQuery&lt;SearchIndex&gt;(\"select * FROM dbo.ItemsWidthinRadiusMilesSearchIndex('{0}','{1}','{2}')\", Convert.ToSingle(geo.Latitude), Convert.ToSingle(geo.Longitude), radius).ToList();\n</code></pre>\n\n<p>Can anyone help?</p>\n\n<p>Edit, problem still happening with this syntax:</p>\n\n<pre><code>SqlParameter lat = new SqlParameter() { ParameterName = \"p1\", Value =      Convert.ToSingle(geo.Latitude) };\nSqlParameter lng = new SqlParameter() { ParameterName = \"p2\", Value = Convert.ToSingle(geo.Longitude) };\nSqlParameter radiusParam = new SqlParameter() { ParameterName = \"p3\", Value = radius, DbType = System.Data.DbType.Int32 };\nvar paramsToPass = new object[] {lat,lng,radiusParam};\nvar query = context.ExecuteStoreQuery&lt;SearchIndex&gt;(\"select * FROM dbo.ItemsWidthinRadiusMilesSearchIndex('@p1','@p2','@p3')\",paramsToPass).ToList();\n</code></pre>\n"},{"tags":["asp.net-mvc","linq","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12415791,"title":"Entity Framework select object with grandparent ID","body":"<p>With SQL I would do the following...</p>\n\n<pre><code>SELECT G.* FROM GOAL G\nINNER JOIN Plan P ON\nP.planID = G.planID\nINNER JOIN User U ON\nU.userID = P.userID\nWHERE U.userID = @userID\n</code></pre>\n\n<p>In my Controller (MVC4) <code>\"ActionResult Edit\"</code> Im doing the following, which is two queries, how could I do just one?  The goal is to make sure the user is only able to do the \"Edit\" action on their own data vs. someone else's goal. </p>\n\n<pre><code>var plan = db.Plan.Where(b =&gt; b.UserID == CurrentUserID).FirstOrDefault();\nGoal goal = db.Goals\n            .Where(b =&gt; b.PlanID == plan.ID)\n            .FirstOrDefault();\nreturn View(goal);\n</code></pre>\n\n<p>Model</p>\n\n<pre><code>public class Plan\n{\n    public int ID { get; set; }\n    [Required]\n    public int UserID { get; set; }\n}\n[Table(\"PlanGoal\")]\npublic class Goal\n{\n    public int ID { get; set; }\n\n    [Required]\n    public int PlanID { get; set; } \n}\n</code></pre>\n"},{"tags":["c#","entity-framework","connection-string"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2032,"score":3,"question_id":10540438,"title":"What is the connection string for localdb for version 11","body":"<p>I'm trying to do the Code First Walkthrough of the entity framework ( <a href=\"http://blogs.msdn.com/b/adonet/archive/2011/09/28/ef-4-2-code-first-walkthrough.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/adonet/archive/2011/09/28/ef-4-2-code-first-walkthrough.aspx</a> ).</p>\n\n<p>I have the latest SQL Server Express and when I check my versions available via command line (<em>sqllocaldb info</em>): I see localdbApp1 and v11.0.  When I try to run the walkthrough with a few minor tweaks, I get a can't connect error.</p>\n\n<p>My app.config looks like this:</p>\n\n<pre><code>&lt;parameter value=\"Server=(LocalDB)\\v11.0; Integrated Security=True; MultipleActiveResultSets=True\" /&gt;\n</code></pre>\n\n<p>I wrote a simple connection test like below and the code returns the same SQL Connection error ((provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)). </p>\n\n<pre><code>new System.Data.SqlClient.SqlConnection(\"Data Source=(LocalDB)\\v11.0; Integrated Security=True; MultipleActiveResultSets=True\").Open();\n</code></pre>\n\n<p>I've tried replacing <code>\"Data Source=...\"</code> with <code>\"Server=...\"</code> but to no avail there.</p>\n\n<p>Any ideas what the connection string should be?</p>\n"},{"tags":["asp.net-mvc","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2249,"score":3,"question_id":490769,"title":"How To Save Navigation Properties in the Entity Framework","body":"<p>I'm trying to use the repository pattern to save an entity using the Entity Framework.  I'm unclear on how to save the Navigation Properties (like Account below).  Can anyone shed some light on this.  Especially how one would set the AccountId from an MVC controller all the way through to the repository where it's saved.</p>\n\n<p>Thanks!</p>\n\n<p>--- Sample Code ---</p>\n\n<pre><code>public void SavePerson(Person person)\n    {           \n        if (person != null)\n        {\n            using (xxxxxxEntities bbEntities = new xxxxxxEntities())\n            {\n                //see if it's in the db\n                Person cPerson;\n\n                ObjectQuery&lt;Person&gt; persons = bbEntities.Person;\n\n                cPerson = (from p in persons\n                         where p.PersonId == person.PersonId\n                         select p).FirstOrDefault() ?? new Person();\n\n                //synch it\n                cPerson.Account.AccountId = person.Account.AccountId; //&lt;=== ????\n                cPerson.Active = person.Active;\n                cPerson.BirthDay = person.BirthDay;\n                cPerson.BirthMonth = person.BirthMonth;\n                cPerson.BirthYear = person.BirthYear;\n                cPerson.CellPhone = person.CellPhone;\n                cPerson.CreatedBy = person.CreatedBy;\n                cPerson.CScore = person.CScore;\n\nEtc....\n</code></pre>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":7897,"score":6,"question_id":2060278,"title":"C# - Entity Framework - The EntityContainer name must be unique. An EntityContainer with the name 'Entities' is already defined","body":"<p>For a little background:</p>\n\n<p>I have a DLL project with the following structure:  </p>\n\n<pre><code>Rivworks.Model (project)  \n  \\Negotiation (folder)  \n      Model.edmx (model from DB #1)  \n  \\NegotiationAutos (folder)  \n      Model.edmx (model from DB #2)  \n</code></pre>\n\n<p>I have moved the connection strings from this project's app.config to the web.config file.  They are <strong>not</strong> in the ConnectionString section.  Rather, I have a static class that consumes part of the web.config and exposes them to my app as AppSettings.[settingName].  </p>\n\n<pre><code>&lt;FeedAutosEntities_connString&gt;metadata=res://*/;provider=System.Data.SqlClient;provider connection string='Data Source=db4;Initial Catalog=RivFeeds;Persist Security Info=True;User ID=****;Password=&amp;quot;****&amp;quot;;MultipleActiveResultSets=True'&lt;/FeedAutosEntities_connString&gt;\n&lt;RivWorkEntities_connString&gt;metadata=res://*/NegotiationAutos.NegotiationAutos.csdl|res://*/NegotiationAutos.NegotiationAutos.ssdl|res://*/NegotiationAutos.NegotiationAutos.msl;provider=System.Data.SqlClient;provider connection string='Data Source=db2;Initial Catalog=RivFramework_Dev;Persist Security Info=True;User ID=****;Password=&amp;quot;****&amp;quot;;MultipleActiveResultSets=True'&lt;/RivWorkEntities_connString&gt;\n</code></pre>\n\n<p>I have 2 classes, one for each Context and they look like this:</p>\n\n<pre><code>namespace RivWorks.Model\n{\n    public class RivWorksStore\n    {\n        private RivWorks.Model.Negotiation.Entities _dbNegotiation;\n\n        public RivWorksStore(string connectionString, string metadata, string provider)\n        {\n            EntityConnectionStringBuilder entityBuilder = new EntityConnectionStringBuilder();\n            entityBuilder.ConnectionString = connectionString;\n            entityBuilder.Metadata = \"res://*/\";    // metadata;\n            //entityBuilder.Provider = provider;\n            _dbNegotiation = new RivWorks.Model.Negotiation.Entities(entityBuilder.ConnectionString);\n        }\n\n        public RivWorks.Model.Negotiation.Entities NegotiationEntities()\n        {\n            return _dbNegotiation;\n        }\n    }\n}\n\nnamespace RivWorks.Model\n{\n    public class FeedStoreReadOnly\n    {\n        private RivWorks.Model.NegotiationAutos.Entities _dbFeed;\n\n        public FeedStoreReadOnly(string connectionString, string metadata, string provider)\n        {\n            EntityConnectionStringBuilder entityBuilder = new EntityConnectionStringBuilder();\n            entityBuilder.ConnectionString = connectionString;\n            entityBuilder.Metadata = \"res://*/\";    // metadata;\n            //entityBuilder.Provider = provider;\n            _dbFeed = new RivWorks.Model.NegotiationAutos.Entities(entityBuilder.ConnectionString);\n        }\n\n        public RivWorks.Model.NegotiationAutos.Entities ReadOnlyEntities()\n        {\n            return _dbFeed;\n        }\n    }\n}\n</code></pre>\n\n<p>You will note that the MetaData is being rewritten to a short version.  </p>\n\n<p>When I comment out that line in each class I get this error:  </p>\n\n<blockquote>\n  <p>Unable to load the specified metadata resource.</p>\n</blockquote>\n\n<p>When I leave that line in in each class I get this error:  </p>\n\n<blockquote>\n  <p>Schema specified is not valid. Errors: </p>\n  \n  <p>Negotiation.Model.csdl(3,4) : error 0019: The EntityContainer name must be unique. An EntityContainer with the name 'Entities' is already defined.  </p>\n</blockquote>\n\n<p>I know it is something simple, something obvious.  Any suggestions welcome...</p>\n"},{"tags":["c#",".net","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12419760,"title":"Map existing database to existing model","body":"<p>If I have a database (SQL Server 2008) with about 100 tables, 50 stored procedures e.t.c.  it has really good proven design. And lets say I already have a very convenient model which we use in several applications  it is set of classes that reflect database structure. I.e. I have database and dont want to create the model and I have a model and dont want to create the database, but I still keen in using EF 5.0. Here is my question. Is there any way to map existing database to existing model without recreating one of them. The only option, I can think of is using CodeFirst approach and creating all the DbSets via FluentApi and setting database initializer to null at the same time. Is this correct?</p>\n"},{"tags":["entity-framework","linq-to-entities","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12419684,"title":"How to write a linq Query for Retrieving Productimages from entity model for the selected PriceRange?","body":"<p>Hi all i have a Entity model ProdcutTable in my MVC4 WebApi application which has the following column names</p>\n\n<pre><code>  [ProductID] [ProductName] [ProductDescritpion] [Price] [ImageURL] and so on\n</code></pre>\n\n<p>now i have to pass the price range as parameters \nexample</p>\n\n<pre><code>     frstvale=$200\n     SecoundVal=$500\n</code></pre>\n\n<p>i have to retrive the [ProductID] [ProductName] [ProductDescritpion] [Price] [ImageURL] from the ProdcutTable for the selected price range how can i write the linq query for this at present i am retrieving all images from the table via a ajax call now i have to pass the paramaters for the price to my method and retrieve the records for the selected price range can any one help in writing the query for this</p>\n\n<pre><code>    this is my model\n\n\n     public class Products\n{\n    public int ProductID { get; set; }\n    public string ProductName{get;set;}\n    public string ProductDescription { get; set; }\n    public string ProductColor { get; set;}\n    public string ProductSize { get; set; }\n    public string Brand { get; set; }\n    public int Price { get; set; }\n    public string Department { get; set; }\n    public string ImageURL { get; set; }\n    public string DetailsURL { get; set; }\n    public string Gender { get; set; }\n    public string Firstvalue { get; set; }\n    public string Lastvalue { get; set; }\n}\n</code></pre>\n\n<p>this is how i am retrieving all my images</p>\n\n<pre><code>    private ProductsEntities products = new ProductsEntities();\n     public IEnumerable&lt;ProductTable&gt; GetAllProdcuts()\n    {\n        return products.ProductTables.AsEnumerable();\n    }\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","entity-framework","stored-procedures","entity-framework-4"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":602,"score":2,"question_id":8020751,"title":"Getting a result feedback from a stored procedure in Entity Framework","body":"<p>In a SQL Server 2008 I have a simple stored procedure moving a bunch of records to another table:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].MyProc(@ParamRecDateTime [datetime])\nAS\nBEGIN\nSET NOCOUNT ON;\n\nINSERT INTO [dbo].Table2 \nSELECT \n...,\n    ...\nFROM [dbo].Table1 \n      WHERE RecDateTime &lt;= @ParamRecDateTime    \n\nDELETE FROM [dbo].Table1 \n      WHERE RecDateTime &lt;= @ParamRecDateTime        \nEND\n</code></pre>\n\n<p>Running it from within SQL Server Management Studio, I get the job done and return value = 0</p>\n\n<pre><code> DECLARE @return_value int\n EXEC    @return_value = dbo.MyProc @ParamRecDateTime = '2011-06-25 11:00:00.000'\n SELECT  'Return Value' = @return_value\n</code></pre>\n\n<p>But when I call the same stored procedure from an app using Entity framework, I also get the job done but the return value is \"-1\":</p>\n\n<pre><code>int result = myrepository.MyProc(datetimePar);\nMessageBox.Show(result.ToString());\n</code></pre>\n\n<p>I didn't manage to find an explanation for this error, but found <a href=\"http://stackoverflow.com/questions/1035789/return-value-from-a-stored-proc-on-error\">this</a> discouraging post, where it's said that there is no standard for this type of return codes in SQL Server.</p>\n\n<p><strong>What is the good, reliable way of getting know of a Stored Procedure execution result when calling it from Entity Framework and when the Stored Procedure doesn't return any entities?</strong></p>\n"}]}
